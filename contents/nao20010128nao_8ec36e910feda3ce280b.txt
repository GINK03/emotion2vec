{"context": "\n\n\u60a9\u307f\n\u3042\u308b\u65e5\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3092GitLab CI\u3067\u4f5c\u308d\u3046\u3068\u3057\u307e\u3057\u305f\u3002\n\u3088\u30fc\u3057\u3001\u3053\u3046\u3057\u3088\u3046(\u4ee5\u4e0b\u306b\u793a\u3059.gitlab-ci.yml\u306f\u4f8b\u3067\u3059\u3002\u3044\u3064\u3082\u306e\u7656\u3067\"\"\u304c\u591a\u3044\u306e\u306f\u8a31\u3057\u3066\u4e0b\u3055\u3044\u3002)\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n\n\u5931\u6557\u3057\u3061\u3083\u3046\u3093\u3067\u3059\u306d\n\u3058\u3083\u3042\u3053\u3046\u3060\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - service docker start\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n\n\u3053\u308c\u3067\u3082\u99c4\u76ee\n\u3042\u308c\u308c\u30fc?\n\u3058\u3083\u3042\u3053\u3046\u3060\u308d?\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: ubuntu\n  stage: docker\n  script:\n    - \"apt update ; apt -y install apt-transport-https ca-certificates curl\"\n    - \"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\"\n    - \"sudo add-apt-repository \\\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\\\"\"\n    - \"apt update ; apt-get -y install docker-ce\"\n    - service docker start\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n\n\u9055\u3046\u3093\u3067\u3059\u306d\u3002\n\u3058\u3083\u3042StackOverflow\u3067\u805e\u3044\u3066\u3053\u3088\u3046\n\n\u3053\u3053\u307e\u3067\u6765\u307e\u3057\u305f\u3002\u3082\u3046\u6295\u7a3f\u30dc\u30bf\u30f3\u30dd\u30c1\u3067\u7d42\u308f\u308a\u3067\u3059\u3002\n\u3067\u3082\u3001\u4e00\u5fdc\u30b0\u30b0\u3063\u3066\u307f\u3088\u3046\u3001\u3068\u3002\n\n\u3042\u3063\u305f\n\u3042\u3000\u3063\u3000\u305f\n\u3057\u304b\u3082docs.gitlab.com\u306b\u3042\u3063\u305f\u3058\u3083\u306a\u3044\u3067\u3059\u304b\u30fc\u30e4\u30fc\u30c0\u30fc\n\u305d\u3046\u3001\u3053\u308c\u3002\n\u3058\u3083\u3042\u3069\u3046\u3059\u308b\u306e\u304b\n\n\u3058\u3083\u3042\u3069\u3046\u3059\u308b\u306e?\n\u5148\u306b\u7b54\u3048\u3092\u793a\u3057\u307e\u3059\u3002\nstages:\n  - build\n  - docker\n# \u8ffd\u52a0\u884c \u59cb\u3081\nvariables:\n  DOCKER_DRIVER: overlay\nservices:\n  - docker:dind\n# \u8ffd\u52a0\u884c \u7d42\u308f\u308a\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n\n\u3042\u30fc\u3084\u3063\u3068\u3067\u304d\u305f\n\u30b3\u30e1\u30f3\u30c8\u9664\u3044\u30664\u884c\u3067\u826f\u3044\u3093\u3067\u3059\u3002\nDOCKER_DRIVER=overlay\u306e\u74b0\u5883\u5909\u6570\u3068\u3001docker:dind\u3068\u3044\u3046Docker\u30a4\u30e1\u30fc\u30b8\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3046\u3088\u3046\u5ba3\u8a00\u3059\u308c\u3070docker build\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u8a33\u3067\u3059\u3002\n\n\u6700\u5f8c\u306b\n\u3053\u306e\u3084\u308a\u65b9\u306b\u5230\u9054\u3059\u308b\u307e\u3067\u6570\u6642\u9593\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\u30b0\u30b0\u308b\u3063\u3066\u5927\u4e8b\u3067\u3059\u306d\n# \u60a9\u307f\n\u3042\u308b\u65e5\u3001Docker\u30a4\u30e1\u30fc\u30b8\u3092GitLab CI\u3067\u4f5c\u308d\u3046\u3068\u3057\u307e\u3057\u305f\u3002\n\u3088\u30fc\u3057\u3001\u3053\u3046\u3057\u3088\u3046(\u4ee5\u4e0b\u306b\u793a\u3059`.gitlab-ci.yml`\u306f\u4f8b\u3067\u3059\u3002<strike>\u3044\u3064\u3082\u306e\u7656\u3067`\"\"`\u304c\u591a\u3044\u306e\u306f\u8a31\u3057\u3066\u4e0b\u3055\u3044\u3002</strike>)\n\n```yaml\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n```\n\n\u5931\u6557\u3057\u3061\u3083\u3046\u3093\u3067\u3059\u306d\n\u3058\u3083\u3042\u3053\u3046\u3060\n\n```yaml\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - service docker start\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n```\n\n\u3053\u308c\u3067\u3082\u99c4\u76ee\n\u3042\u308c\u308c\u30fc?\n\u3058\u3083\u3042\u3053\u3046\u3060\u308d?\n\n```yaml\nstages:\n  - build\n  - docker\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: ubuntu\n  stage: docker\n  script:\n    - \"apt update ; apt -y install apt-transport-https ca-certificates curl\"\n    - \"curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -\"\n    - \"sudo add-apt-repository \\\"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\\\"\"\n    - \"apt update ; apt-get -y install docker-ce\"\n    - service docker start\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n```\n\n\u9055\u3046\u3093\u3067\u3059\u306d\u3002\n\u3058\u3083\u3042[StackOverflow](http://ja.stackoverflow.com)\u3067\u805e\u3044\u3066\u3053\u3088\u3046\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/111609/b94722a3-4753-bcbf-536a-804407bb0b11.png)\n\n\u3053\u3053\u307e\u3067\u6765\u307e\u3057\u305f\u3002\u3082\u3046\u6295\u7a3f\u30dc\u30bf\u30f3\u30dd\u30c1\u3067\u7d42\u308f\u308a\u3067\u3059\u3002\n\u3067\u3082\u3001\u4e00\u5fdc\u30b0\u30b0\u3063\u3066\u307f\u3088\u3046\u3001\u3068\u3002\n\n# \u3042\u3063\u305f\n\n**\u3042\u3000\u3063\u3000\u305f**\n\u3057\u304b\u3082`docs.gitlab.com`\u306b\u3042\u3063\u305f\u3058\u3083\u306a\u3044\u3067\u3059\u304b\u30fc\u30e4\u30fc\u30c0\u30fc\n\n\u305d\u3046\u3001[\u3053\u308c](https://docs.gitlab.com/ce/ci/docker/using_docker_build.html)\u3002\n\u3058\u3083\u3042\u3069\u3046\u3059\u308b\u306e\u304b\n\n# \u3058\u3083\u3042\u3069\u3046\u3059\u308b\u306e?\n\u5148\u306b\u7b54\u3048\u3092\u793a\u3057\u307e\u3059\u3002\n\n```yaml\nstages:\n  - build\n  - docker\n# \u8ffd\u52a0\u884c \u59cb\u3081\nvariables:\n  DOCKER_DRIVER: overlay\nservices:\n  - docker:dind\n# \u8ffd\u52a0\u884c \u7d42\u308f\u308a\nbuild:\n  image: ubuntu\n  stage: build\n  script:\n    - echo some build tasks here\n  artifacts:\n    paths:\n      - \"result.file\"\ndocker:\n  image: docker\n  stage: docker\n  script:\n    - \"sh -c \\\"$DOCKER_LOGIN_COMMAND\\\" > /dev/null\"\n    - \"docker build -t a-docker-image .\"\n    - \"docker push a-docker-image\"\n```\n\n\u3042\u30fc\u3084\u3063\u3068\u3067\u304d\u305f\n\n\u30b3\u30e1\u30f3\u30c8\u9664\u3044\u30664\u884c\u3067\u826f\u3044\u3093\u3067\u3059\u3002\n`DOCKER_DRIVER=overlay`\u306e\u74b0\u5883\u5909\u6570\u3068\u3001`docker:dind`\u3068\u3044\u3046Docker\u30a4\u30e1\u30fc\u30b8\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3046\u3088\u3046\u5ba3\u8a00\u3059\u308c\u3070`docker build`\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u8a33\u3067\u3059\u3002\n\n# \u6700\u5f8c\u306b\n\u3053\u306e\u3084\u308a\u65b9\u306b\u5230\u9054\u3059\u308b\u307e\u3067\u6570\u6642\u9593\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\u30b0\u30b0\u308b\u3063\u3066\u5927\u4e8b\u3067\u3059\u306d\n", "tags": ["docker", "GitLab-CI"]}