{"context": " More than 1 year has passed since last update.\u5c11\u3057\u524d\u306bKickStarter\u3067Espruino\u306e\u8d85\u7d76\u5c0f\u578b\u7248\u3067\u3042\u308b Espruino Pico \u304c\u767b\u5834\u3057\u3066\u8a71\u984c\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u5b9f\u306f\u305d\u306e\u3068\u304d\u540c\u6642\u306b\u300c\u91d1\u984d\u304c\u4e00\u5b9a\u984d\u306b\u9054\u3057\u305f\u3089 MQTT\u5bfe\u5fdc\u3059\u308b \u300d\u3068\u306e\u30a2\u30ca\u30a6\u30f3\u30b9\u3082\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u3002\n\u305d\u306e\u5f8c\u898b\u4e8b\u306b\u76ee\u6a19\u91d1\u984d\u3092\u9054\u6210\u3057\u305f\u3088\u3046\u3067\u3001Espruino\u306eMQTT\u5bfe\u5fdc\u304c\u6c7a\u5b9a\u3057\u305f\u3089\u3057\u3044\u3067\u3059\u3002\u3068\u3042\u308b\u30c8\u30a4\u30ec\u306e\u30c9\u30a2\u306e\u7a7a\u304d\u72b6\u6cc1\u3092\u8d85\u7d76\u4e0d\u5b89\u5b9a\u306aWifi/CC3000\u306e\u4e0a\u3067\u3072\u305f\u3059\u3089post\u30ea\u30af\u30a8\u30b9\u30c8\u4f7f\u3063\u3066\u6295\u3052\u7d9a\u3051\u3066\u304d\u305f\u50d5\u306b\u3068\u3063\u3066\u306f\u3001\u307e\u3055\u306b\u5f85\u3061\u671b\u3093\u3060\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u3042\u3063\u305f\u305f\u3081\u306b\u3001\u3053\u308c\u306f\u6625\u307e\u3067\u5f85\u3061\u304d\u308c\u306a\u3044\uff01\u3068\u3044\u3046\u5177\u5408\u306b\u30c6\u30f3\u30b7\u30e7\u30f3\u304c\u4e0a\u304c\u3063\u3066\u3044\u305f\u8a33\u3067\u3059\u3002\n\u3067\u3001Espruino\u306e\u516c\u5f0f\u30d5\u30a9\u30fc\u30e9\u30e0\u898b\u3066\u3044\u305f\u3089\u3001\u306a\u3093\u3068PICO\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u5148\u99c6\u3051\u3066\u300cMQTT\u306f\u3082\u3046\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u59cb\u3081\u3066\u308b\u3088\u300d\u306a\u3093\u3066\u8a00\u3063\u3066\u3044\u308b\u306e\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3055\u3063\u305d\u304f\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\uff08\u8a18\u4e8b\u3068\u3057\u3066\u306f11\u6708\u306a\u3093\u3067\u3059\u304c\u306d\uff09\n\n\u76ee\u6a19\n\nMQTT\u3067\u30b3\u30bf\u30c4\u306e\u6e29\u5ea6\u3092\u30b5\u30fc\u30d0(subscriber)\u306b\u9001\u308a\u3064\u3051\u307e\u3059\u3002\n\nMQTT\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\n17\u65e5\u76ee\u306b\u5f15\u304d\u7d9a\u304d\u3001\u30b3\u30bf\u30c4\u3070\u3063\u304b\u308a\u3067\u3059\u307f\u307e\u305b\u3093\u3002\n\n\n\n\u6d41\u308c\n\n\u30d1\u30fc\u30c4\u306e\u8abf\u9054\u3068\u7d50\u7dda\nEspruino\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nMQTT\u306ebroker / subscriber \u3092\u7528\u610f\n\u5b9f\u884c\n\n\n\u30d1\u30fc\u30c4\u306e\u8abf\u9054\u3068\u7d50\u7dda\n\u5fc5\u8981\u7269\u54c1\u306f\u4ee5\u4e0b\u300215\u65e5\u76ee\u306e\u8a18\u4e8b\u53ca\u30735\u65e5\u76ee\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u8abf\u9054\u53ca\u3073\u7d50\u7dda\u3057\u307e\u3059\u3002\n\nEspruino\nCC3000Wifi\u30e2\u30b8\u30e5\u30fc\u30eb\n\u6e29\u5ea6\u30bb\u30f3\u30b5\n\n\nEspruino\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u901a\u5e38\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u4f7f\u3048\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fMQTT\u3092\u4f7f\u3048\u306a\u3044\uff082014/12/21\u6642\u70b9)\u306e\u3067\u3001\u6700\u65b0\u7248\u306e\u30d0\u30a4\u30ca\u30ea\u306eURL\u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3067\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\nWebIDE\u306e\u8a2d\u5b9a\u753b\u9762 > Flusher > Advanced Firmeware Update\u306e\u4e0b\u306b\u3042\u308b\u30c6\u30ad\u30b9\u30c8\u30a4\u30f3\u30d7\u30c3\u30c8\u306b\u4e0b\u8a18URL\u3092\u5165\u529b\u3057\u3066Advanced Flush Firmware\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u306f\u901a\u5e38\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3068\u540c\u624b\u9806\u3067\u3059\u3002(2\u65e5\u76ee\u306e\u8a18\u4e8b\u3092\u53c2\u7167)\nhttp://www.espruino.com/binaries/git/commits/1f5e0ac3cd62ff9328e3c38a03f07d7644fff3e8/espruino_1v72_espruino_1r3.bin\n\n\n\nMQTT Broker/subscriber \u306e\u6e96\u5099\nEspruino\u30e1\u30a4\u30f3\u3068\u306f\u3044\u3048\u3001MQTT\u306e\u30b5\u30fc\u30d0(broker)\u3068\u3001\u672c\u5f53\u306b\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u304b\u3081\u308b\u305f\u3081\u306bsubscriber\u304c\u5fc5\u8981\u3067\u3059\u3002MQTT.js\u3092\u5229\u7528\u3057\u305fbroker\u3068subscriber\u3092Github\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u7f6e\u3044\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3057\u3087\u3046\u3002\u4e2d\u8eab\u306fExample\u306esubscriber\u3068broadcast server\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001node.js,npm\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u74b0\u5883\u3067\u306e\u624b\u9806\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\ngit clone https://github.com/rockymanobi/espruino-mqtt-sample.git\ncd espruino-mqtt-sample\nnpm install\n\n\u30bf\u30fc\u30df\u30ca\u30eb2\u753b\u9762\u3067\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u305d\u308c\u305e\u308c\u5b9f\u884c\u3057\u307e\u3059\u3002\nbroker\u306e\u5b9f\u884c\nnode broker.js\n\nsubscriber\u306e\u5b9f\u884c\nnode subscriber.js\n\n\n\u3053\u3093\u306a\u98a8\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002Ctrl + c\u3067\u7d42\u4e86\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\u8a66\u3057\u306bnode publisher.js\u3092\u5b9f\u884c\u3059\u308b\u3068subscriber.js\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u306b\u4f55\u304b\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3067\u758e\u901a\u78ba\u8a8d\u3092\u3057\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\n\u4e0b\u8a18\u30d7\u30ed\u30b0\u30e9\u30e0\u306evar config\u306e\u5024\u3092\u3001\u5b9f\u884c\u3059\u308b\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u7de8\u96c6\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306bmqttHost\u306b\u306flocalhost\u3088\u308a\u3082\u3001IP\u30a2\u30c9\u30ec\u30b9(broker.js\u5b9f\u884c\u6642\u306b\u8868\u793a\u3055\u308c\u307e\u3059)\u3092\u6307\u5b9a\u3057\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\uff08Espruino\u3001\u305f\u307e\u306blocalhost\u63a5\u7d9a\u3060\u3068wifi\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u843d\u3061\u305f\u308a\u3059\u308b\u306e\u3067\uff09\nvar config = {\n  wifiSSID: 'ssid',\n  wifiKey: 'password',\n  mqttHost: '192.168.xxx.xxx',\n  mqttPort: '1883',\n};\n\nfunction mtStr(s) {\n  return String.fromCharCode(s.length>>8,s.length&255)+s;\n} function mtPacket(cmd, variable, payload) {\n  return String.fromCharCode(cmd, variable.length+payload.length)+variable+payload;\n}\nfunction mtpConnect(name) {\n  return mtPacket(0b00010000, \n           mtStr(\"MQTT\")/*protocol name*/+\n           \"\\x04\"/*protocol level*/+\n           \"\\x00\"/*connect flag*/+\n           \"\\xFF\\xFF\"/*Keepalive*/, mtStr(name));\n}\nfunction mtpPub(topic, data) {\n  return  mtPacket(0b00110001, mtStr(topic), data);\n}\n\nvar client;\nfunction onConnected() {\n  console.log('creating client');\n  client = require(\"net\").connect({host : config.mqttHost , port:config.mqttPort}, function() {\n    console.log('client connected');\n    client.write(mtpConnect(\"Espruino\"));\n\n    setWatch(function() {\n      var temperature = sensor.getTemp();\n      console.log(\"Publishing \" + temperature );\n      client.write(mtpPub(\"message\", temperature. toFixed(4)));\n    }, BTN1, { repeat:true, edge: 'falling' } );\n\n    client.on('end', function() {\n      console.log('client disconnected');\n    });\n  });\n}\n\n\n\nvar wlan,sensor, ow;\n// main\nfunction main(){ \n  // Setup Temperature Sensor\n  ow = new OneWire(A1);\n  sensor = require(\"DS18B20\").connect(ow);\n  sensor.getTemp();\n  // WIFI\n  wlan = require(\"CC3000\").connect();\n  wlan.connect( config.wifiSSID , config.wifiKey, function (s) { \n    if (s==\"dhcp\") {\n      console.log(\"My IP is \"+wlan.getIP().ip);\n      onConnected();\n    }\n  });\n}\n\nmain();\n\n\n\u57fa\u672c\u7684\u306b\u306f\u30d5\u30a9\u30fc\u30e9\u30e0\u306e\u30b5\u30f3\u30d7\u30eb\u306e\u307e\u307e\u3067\u3059\u304c\u3001\u6700\u65b0\u30d3\u30eb\u30c9\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305fEspruino\u3067(espruino_1v72_espruino_1r3.bin)\u3067\u306a\u305c\u304bsetInterval,setTimeout\u304c\u3046\u307e\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067setWatch\u3092\u4f7f\u3044\u3001BTN1\u3092\u62bc\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6e29\u5ea6\u3092MQTT\u3067\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\nEspruino\u306e\u63a5\u7d9a\u8a2d\u5b9a\u304c\u3001broker/sbscriber\u304c\u52d5\u3044\u3066\u3044\u308bPC\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3064\u3064\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u5b9f\u884c\u6642\u306bnet\u306a\u3093\u3066\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u7121\u3044\u3068\u8a00\u308f\u308c\u307e\u3059\u304c\u666e\u901a\u306b\u52d5\u304d\u307e\u3059\u3002\n\n\u753b\u50cf\n\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u305f\u3073\u306b\u3001Espruino\u304b\u3089MQTT\u3067\u9001\u4fe1\u3057\u305f\u6e29\u5ea6\u304c\u3001subscriber\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3069\u3046\u3084\u3089\u6210\u529f\u306e\u3088\u3046\u3067\u3059\u3002\u6696\u304b\u305d\u3046\u3067\u3059\u306d\u3002\n\n\u307e\u3068\u3081\n\u30d5\u30a9\u30fc\u30e9\u30e0\u306e\u6587\u7ae0\u306b\u3082\u3042\u308b\u901a\u308a\u3001\u5358\u7d14\u3059\u304e\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3082\u3042\u308b\u306e\u3067\u3053\u306e\u307e\u307e\u4f7f\u3048\u308b\u4ee3\u7269\u3067\u306f\u7121\u3044\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3001MQTT\u30c7\u30ad\u30bd\u30a6\u30c0\uff01\u3068\u601d\u3048\u308b\u611f\u3058\u306b\u306f\u52d5\u304b\u3059\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u4eca\u5f8c\u306f\u63a5\u7d9a\u55aa\u5931\u6642\u306e\u518d\u63a5\u7d9a\u3068\u304b\u3001\u8010\u4e45\u6027\u3068\u304b\u3001\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u3044\u3051\u305f\u3089\u3068\u601d\u3044\u307e\u3059\u3002\n\u5c11\u3057\u524d\u306b[KickStarter](https://www.kickstarter.com/projects/gfw/espruino-pico-javascript-on-a-usb-stick)\u3067Espruino\u306e\u8d85\u7d76\u5c0f\u578b\u7248\u3067\u3042\u308b **Espruino Pico** \u304c\u767b\u5834\u3057\u3066\u8a71\u984c\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u5b9f\u306f\u305d\u306e\u3068\u304d\u540c\u6642\u306b\u300c\u91d1\u984d\u304c\u4e00\u5b9a\u984d\u306b\u9054\u3057\u305f\u3089 **[MQTT](https://sango.shiguredo.jp/mqtt)\u5bfe\u5fdc\u3059\u308b** \u300d\u3068\u306e\u30a2\u30ca\u30a6\u30f3\u30b9\u3082\u3055\u308c\u3066\u304a\u308a\u307e\u3057\u305f\u3002\n\n\u305d\u306e\u5f8c\u898b\u4e8b\u306b\u76ee\u6a19\u91d1\u984d\u3092\u9054\u6210\u3057\u305f\u3088\u3046\u3067\u3001Espruino\u306eMQTT\u5bfe\u5fdc\u304c\u6c7a\u5b9a\u3057\u305f\u3089\u3057\u3044\u3067\u3059\u3002\u3068\u3042\u308b\u30c8\u30a4\u30ec\u306e\u30c9\u30a2\u306e\u7a7a\u304d\u72b6\u6cc1\u3092\u8d85\u7d76\u4e0d\u5b89\u5b9a\u306aWifi/CC3000\u306e\u4e0a\u3067\u3072\u305f\u3059\u3089post\u30ea\u30af\u30a8\u30b9\u30c8\u4f7f\u3063\u3066\u6295\u3052\u7d9a\u3051\u3066\u304d\u305f\u50d5\u306b\u3068\u3063\u3066\u306f\u3001\u307e\u3055\u306b\u5f85\u3061\u671b\u3093\u3060\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u3042\u3063\u305f\u305f\u3081\u306b\u3001\u3053\u308c\u306f\u6625\u307e\u3067\u5f85\u3061\u304d\u308c\u306a\u3044\uff01\u3068\u3044\u3046\u5177\u5408\u306b\u30c6\u30f3\u30b7\u30e7\u30f3\u304c\u4e0a\u304c\u3063\u3066\u3044\u305f\u8a33\u3067\u3059\u3002\n\n\u3067\u3001Espruino\u306e\u516c\u5f0f\u30d5\u30a9\u30fc\u30e9\u30e0\u898b\u3066\u3044\u305f\u3089\u3001\u306a\u3093\u3068PICO\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u5148\u99c6\u3051\u3066\u300c[MQTT\u306f\u3082\u3046\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u59cb\u3081\u3066\u308b\u3088](http://forum.espruino.com/conversations/258515/#comment11954062)\u300d\u306a\u3093\u3066\u8a00\u3063\u3066\u3044\u308b\u306e\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3055\u3063\u305d\u304f\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\uff08\u8a18\u4e8b\u3068\u3057\u3066\u306f11\u6708\u306a\u3093\u3067\u3059\u304c\u306d\uff09\n\n# \u76ee\u6a19\n\n* MQTT\u3067\u30b3\u30bf\u30c4\u306e\u6e29\u5ea6\u3092\u30b5\u30fc\u30d0(subscriber)\u306b\u9001\u308a\u3064\u3051\u307e\u3059\u3002\n* [MQTT](https://sango.shiguredo.jp/mqtt)\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n* [17\u65e5\u76ee](http://qiita.com/rockymanobi/items/e85a57408fa07da6b29c)\u306b\u5f15\u304d\u7d9a\u304d\u3001\u30b3\u30bf\u30c4\u3070\u3063\u304b\u308a\u3067\u3059\u307f\u307e\u305b\u3093\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/51384/edad78b4-51d4-1c04-9b4f-598401424b60.png)\n\n# \u6d41\u308c\n\n1. \u30d1\u30fc\u30c4\u306e\u8abf\u9054\u3068\u7d50\u7dda\n2. Espruino\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n3. MQTT\u306ebroker / subscriber \u3092\u7528\u610f\n4. \u5b9f\u884c\n\n# \u30d1\u30fc\u30c4\u306e\u8abf\u9054\u3068\u7d50\u7dda\n\n\u5fc5\u8981\u7269\u54c1\u306f\u4ee5\u4e0b\u3002[15\u65e5\u76ee\u306e\u8a18\u4e8b](http://qiita.com/rockymanobi/items/1dd62833b4c055a71460)\u53ca\u3073[5\u65e5\u76ee\u306e\u8a18\u4e8b](http://qiita.com/rockymanobi/items/6e1dad4ffb1644b60b51)\u3092\u53c2\u8003\u306b\u8abf\u9054\u53ca\u3073\u7d50\u7dda\u3057\u307e\u3059\u3002\n\n* Espruino\n* CC3000Wifi\u30e2\u30b8\u30e5\u30fc\u30eb\n* \u6e29\u5ea6\u30bb\u30f3\u30b5\n\n# Espruino\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n\u901a\u5e38\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u4f7f\u3048\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306fMQTT\u3092\u4f7f\u3048\u306a\u3044\uff082014/12/21\u6642\u70b9)\u306e\u3067\u3001\u6700\u65b0\u7248\u306e\u30d0\u30a4\u30ca\u30ea\u306eURL\u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u3067\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n`WebIDE\u306e\u8a2d\u5b9a\u753b\u9762 > Flusher > Advanced Firmeware Update`\u306e\u4e0b\u306b\u3042\u308b\u30c6\u30ad\u30b9\u30c8\u30a4\u30f3\u30d7\u30c3\u30c8\u306b\u4e0b\u8a18URL\u3092\u5165\u529b\u3057\u3066Advanced Flush Firmware\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u306f\u901a\u5e38\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3068\u540c\u624b\u9806\u3067\u3059\u3002([2\u65e5\u76ee\u306e\u8a18\u4e8b](http://qiita.com/rockymanobi/items/bbc9481d43cd4fc19d65)\u3092\u53c2\u7167)\n\n```\nhttp://www.espruino.com/binaries/git/commits/1f5e0ac3cd62ff9328e3c38a03f07d7644fff3e8/espruino_1v72_espruino_1r3.bin\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/51384/f1280c2d-6f15-37f0-0dca-64f822bc9667.png)\n\n\n\n\n# MQTT Broker/subscriber \u306e\u6e96\u5099\n\nEspruino\u30e1\u30a4\u30f3\u3068\u306f\u3044\u3048\u3001MQTT\u306e\u30b5\u30fc\u30d0(broker)\u3068\u3001\u672c\u5f53\u306b\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u304b\u3081\u308b\u305f\u3081\u306bsubscriber\u304c\u5fc5\u8981\u3067\u3059\u3002[MQTT.js](https://github.com/adamvr/MQTT.js/)\u3092\u5229\u7528\u3057\u305f`broker`\u3068`subscriber`\u3092Github\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u7f6e\u3044\u305f\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3057\u3087\u3046\u3002\u4e2d\u8eab\u306fExample\u306esubscriber\u3068broadcast server\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u3001`node.js`,`npm`\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u74b0\u5883\u3067\u306e\u624b\u9806\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```bash\ngit clone https://github.com/rockymanobi/espruino-mqtt-sample.git\ncd espruino-mqtt-sample\nnpm install\n```\n\u30bf\u30fc\u30df\u30ca\u30eb2\u753b\u9762\u3067\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u305d\u308c\u305e\u308c\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nbroker\u306e\u5b9f\u884c\n\n```bash\nnode broker.js\n```\n\nsubscriber\u306e\u5b9f\u884c\n\n```bash\nnode subscriber.js\n```\n![image](https://qiita-image-store.s3.amazonaws.com/0/51384/2f1f5f7a-0cb3-cf0a-48cc-3cabc8ae3cca.png)\n\n\u3053\u3093\u306a\u98a8\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002`Ctrl + c`\u3067\u7d42\u4e86\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u8a66\u3057\u306b`node publisher.js`\u3092\u5b9f\u884c\u3059\u308b\u3068`subscriber.js`\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30a6\u30a3\u30f3\u30c9\u30a6\u306b\u4f55\u304b\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3067\u758e\u901a\u78ba\u8a8d\u3092\u3057\u3066\u3082\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u30d7\u30ed\u30b0\u30e9\u30e0\n\n\u4e0b\u8a18\u30d7\u30ed\u30b0\u30e9\u30e0\u306e`var config`\u306e\u5024\u3092\u3001\u5b9f\u884c\u3059\u308b\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u7de8\u96c6\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b`mqttHost`\u306b\u306f`localhost`\u3088\u308a\u3082\u3001IP\u30a2\u30c9\u30ec\u30b9(`broker.js`\u5b9f\u884c\u6642\u306b\u8868\u793a\u3055\u308c\u307e\u3059)\u3092\u6307\u5b9a\u3057\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\uff08Espruino\u3001\u305f\u307e\u306blocalhost\u63a5\u7d9a\u3060\u3068wifi\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u843d\u3061\u305f\u308a\u3059\u308b\u306e\u3067\uff09\n\n```js\nvar config = {\n  wifiSSID: 'ssid',\n  wifiKey: 'password',\n  mqttHost: '192.168.xxx.xxx',\n  mqttPort: '1883',\n};\n\nfunction mtStr(s) {\n  return String.fromCharCode(s.length>>8,s.length&255)+s;\n} function mtPacket(cmd, variable, payload) {\n  return String.fromCharCode(cmd, variable.length+payload.length)+variable+payload;\n}\nfunction mtpConnect(name) {\n  return mtPacket(0b00010000, \n           mtStr(\"MQTT\")/*protocol name*/+\n           \"\\x04\"/*protocol level*/+\n           \"\\x00\"/*connect flag*/+\n           \"\\xFF\\xFF\"/*Keepalive*/, mtStr(name));\n}\nfunction mtpPub(topic, data) {\n  return  mtPacket(0b00110001, mtStr(topic), data);\n}\n\nvar client;\nfunction onConnected() {\n  console.log('creating client');\n  client = require(\"net\").connect({host : config.mqttHost , port:config.mqttPort}, function() {\n    console.log('client connected');\n    client.write(mtpConnect(\"Espruino\"));\n\n    setWatch(function() {\n      var temperature = sensor.getTemp();\n      console.log(\"Publishing \" + temperature );\n      client.write(mtpPub(\"message\", temperature. toFixed(4)));\n    }, BTN1, { repeat:true, edge: 'falling' } );\n\n    client.on('end', function() {\n      console.log('client disconnected');\n    });\n  });\n}\n\n\n\nvar wlan,sensor, ow;\n// main\nfunction main(){ \n  // Setup Temperature Sensor\n  ow = new OneWire(A1);\n  sensor = require(\"DS18B20\").connect(ow);\n  sensor.getTemp();\n  // WIFI\n  wlan = require(\"CC3000\").connect();\n  wlan.connect( config.wifiSSID , config.wifiKey, function (s) { \n    if (s==\"dhcp\") {\n      console.log(\"My IP is \"+wlan.getIP().ip);\n      onConnected();\n    }\n  });\n}\n\nmain();\n\n```\n\n\u57fa\u672c\u7684\u306b\u306f[\u30d5\u30a9\u30fc\u30e9\u30e0\u306e\u30b5\u30f3\u30d7\u30eb](http://forum.espruino.com/conversations/258515/#comment11954062)\u306e\u307e\u307e\u3067\u3059\u304c\u3001[\u6700\u65b0\u30d3\u30eb\u30c9]()\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305fEspruino\u3067(espruino_1v72_espruino_1r3.bin)\u3067\u306a\u305c\u304b`setInterval`,`setTimeout`\u304c\u3046\u307e\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067`setWatch`\u3092\u4f7f\u3044\u3001`BTN1`\u3092\u62bc\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6e29\u5ea6\u3092MQTT\u3067\u9001\u4fe1\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n# \u5b9f\u884c\n\nEspruino\u306e\u63a5\u7d9a\u8a2d\u5b9a\u304c\u3001broker/sbscriber\u304c\u52d5\u3044\u3066\u3044\u308bPC\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3064\u3064\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u5b9f\u884c\u6642\u306b`net`\u306a\u3093\u3066\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u7121\u3044\u3068\u8a00\u308f\u308c\u307e\u3059\u304c\u666e\u901a\u306b\u52d5\u304d\u307e\u3059\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/51384/f343c248-cdb8-9037-796e-0ac8f433d22c.png)\n\n**\u753b\u50cf**![image](https://qiita-image-store.s3.amazonaws.com/0/51384/9c8c7c59-e8ef-5f4d-e770-bff8b20b4dba.png)\n\n\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u305f\u3073\u306b\u3001Espruino\u304b\u3089MQTT\u3067\u9001\u4fe1\u3057\u305f\u6e29\u5ea6\u304c\u3001subscriber\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3069\u3046\u3084\u3089\u6210\u529f\u306e\u3088\u3046\u3067\u3059\u3002\u6696\u304b\u305d\u3046\u3067\u3059\u306d\u3002\n\n# \u307e\u3068\u3081\n\n\u30d5\u30a9\u30fc\u30e9\u30e0\u306e\u6587\u7ae0\u306b\u3082\u3042\u308b\u901a\u308a\u3001\u5358\u7d14\u3059\u304e\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3082\u3042\u308b\u306e\u3067\u3053\u306e\u307e\u307e\u4f7f\u3048\u308b\u4ee3\u7269\u3067\u306f\u7121\u3044\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3001MQTT\u30c7\u30ad\u30bd\u30a6\u30c0\uff01\u3068\u601d\u3048\u308b\u611f\u3058\u306b\u306f\u52d5\u304b\u3059\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u4eca\u5f8c\u306f\u63a5\u7d9a\u55aa\u5931\u6642\u306e\u518d\u63a5\u7d9a\u3068\u304b\u3001\u8010\u4e45\u6027\u3068\u304b\u3001\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u3044\u3051\u305f\u3089\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["JavaScript", "Espruino", "mqtt"]}