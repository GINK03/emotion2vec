{"context": "\n\nHAWQ\u3068\u306f\nHAWQ\u306fPivotal\u304c\u958b\u767a\u3057\u305fHadoop\u4e0a\u3067\u52d5\u4f5c\u3059\u308bSQL\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\n\u73fe\u5728\u306fApache\u306b\u5bc4\u8d08\u3055\u308c\u3001Apache HAWQ\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nHAWQ\u306b\u8fd1\u3044\u4f4d\u7f6e\u4ed8\u3051\u306e\u3082\u306e\u306b\u306f\u3001Cloudera\u304c\u4e3b\u5c0e\u3059\u308bImpala\u304c\u3042\u308a\u307e\u3059\u3002\nHAWQ\u306e\u4e2d\u8eab\u306fPostgreSQL\u3092\u30d9\u30fc\u30b9\u306b\u5206\u6563\u74b0\u5883\u306b\u5bfe\u5fdc\u3057\u305fGreenplum\u3092Hadoop\u306b\u5bfe\u5fdc\u3057\u305f\u3082\u306e\u3068\u8003\u3048\u308c\u3070\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nPostgreSQL\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u3001\u6570\u3042\u308bSQL on Hadoop\u306e\u4e2d\u3067\u3082SQL\u3078\u306e\u6e96\u62e0\u30ec\u30d9\u30eb\u304c\u9ad8\u3044\u3053\u3068\u304c\u7279\u5fb4\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u8a73\u7d30\u306fEnterprise SQL on Hadoop with Pivotal HDB\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nPivotal\u3068ODPi\nODPi\u306fHadoop\u306e\u76f8\u4e92\u904b\u7528\u6027\u3092\u76ee\u7684\u3068\u3057\u3066Hortonworks\u3001Pivotal\u3092\u4e2d\u5fc3\u306b\u8a2d\u7acb\u3055\u308c\u305f\u56e3\u4f53\u3067\u3059\u3002\nHadoop\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u4e71\u7acb\u3057\u3066\u3044\u3066\u3001\u305d\u308c\u305e\u308c\u304c\u72ec\u81ea\u306e\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\u305f\u3081\u3001\u76f8\u4e92\u904b\u7528\u6027\u304c\u5371\u3046\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u72b6\u6cc1\u306e\u4e2d\u3001\u30b3\u30a2\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u76f8\u4e92\u904b\u7528\u6027\u3092\u7dad\u6301\u3057\u3088\u3046\u3068\u3044\u3046\u306e\u304cODPi\u306e\u8da3\u65e8\u3067\u3059\u3002\n\u3057\u304b\u3057\u5b9f\u614b\u306f\u3001ODPi\u306e\u5404\u793e\u304cHortonworks\u306eHDP\u3092OEM\u3068\u3057\u3066\u63a1\u7528\u3059\u308b\u72b6\u6cc1\u306b\u3042\u308a\u3001\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u6226\u7565\u3067\u3042\u308b\u3068\u306e\u6279\u5224\u304c\u3042\u308a\u307e\u3059\u3002\n\u5b9f\u969b\u3001Pivotal\u306f\u81ea\u8eab\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3042\u308bPivotal HD\u3092HDP\u30d9\u30fc\u30b9\u306b\u5207\u308a\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u4e8b\u60c5\u304b\u3089\u3001HAWQ\u306fPivotal HD\u3084HDP\u3078\u5bb9\u6613\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u30021\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0/\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3042\u308bAmbari\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a6\u30a3\u30b6\u30fc\u30c9\u306b\u5f93\u3063\u3066\u30af\u30ea\u30c3\u30af\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3059\u3002\n\nHAWQ\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u524d\u306b\nHAWQ\u306fHadoop\u4e0a\u3067\u52d5\u4f5c\u3059\u308bSQL\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u306a\u306e\u3067\u3001Cloudera\u306eCDH\u3067\u3082\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001Ambari\u304cHDP\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u30812\u3001Ambari\u3092\u4f7f\u3063\u3066CDH\u306eHadoop\u30af\u30e9\u30b9\u30bf\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u4eca\u56de\u306fHAWQ\u3092\u624b\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nHAWQ\u306f\u30d3\u30eb\u30c9\u74b0\u5883\u3092\u6574\u3048\u308b\u306e\u3082\u4e00\u82e6\u52b4\u306a\u306e\u3067\u3001Pivotal\u304c\u914d\u5e03\u3057\u3066\u3044\u308bPivotal HDB\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u306fPivotal Network\u3078\u306e\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\n\nHAWQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nHAWQ\u3092\u624b\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u306fInstalling HAWQ from the Command Line\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u591a\u5c11\u3001\u7a7a\u6c17\u3092\u8aad\u3093\u3067\u624b\u9806\u3092\u98db\u3070\u3057\u305f\u308a\u3001\u8ffd\u52a0\u3057\u305f\u308a\u3057\u306a\u304c\u3089\u9032\u3081\u307e\u3059\u3002\n\u307e\u305a\u59cb\u3081\u306b\u3001\u30de\u30b9\u30bf\u306b\u6700\u4f4e\u9650\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u30de\u30b9\u30bf\u306e\u8cc7\u6750\u3092\u3001pssh/pscp\u306e\u3088\u3046\u306a\u30c4\u30fc\u30eb\u3092\u7528\u3044\u3066\u3001\u30b9\u30ec\u30fc\u30d6\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\u3053\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u6700\u521d\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u306a\u308f\u3051\u3067\u3059\u3002\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305ftar\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3057\u3066rpm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ngpadmin\u30e6\u30fc\u30b6\u30fc/\u30b0\u30eb\u30fc\u30d7\u304c\u7121\u3044\u3068\u3044\u3046\u8b66\u544a\u306f\u7121\u8996\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n# tar xvf PADS-1.3.1.1-19631-rhel5_x86_64.tgz\n# rpm -ivh PADS-1.3.1.1/hawq-1.3.1.1-19631.x86_64.rpm\n\nHAWQ\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092.bash_profile\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n# echo . /usr/local/hawq/greenplum_path.sh >> .bash_profile\n# . .bash_profile\n\n\u5168\u30ce\u30fc\u30c9\u306bHAWQ\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u30db\u30b9\u30c8\u540d\u306e\u4e00\u89a7\u3092\u7528\u610f\u3057\u3066\u3001\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002(\u30de\u30b9\u30bf\u306bHAWQ\u30922\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6c17\u306b\u3057\u306a\u3044\u3053\u3068\u306b\u3057\u307e\u3059...)\n\u3053\u306e\u904e\u7a0b\u3067\u3001\u9375\u4ea4\u63db\u306b\u3088\u308aroot\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u30ec\u30b9\u30ed\u30b0\u30a4\u30f3\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\u3002\n# mkdir /opt/servers\n# vi /opt/servers/all_hosts\nhawq-ma01          # \u30de\u30b9\u30bf\nhawq-sl01          # \u30b9\u30ec\u30fc\u30d6\nhawq-sl02          # \u3003\n:\n\n# gpssh-exkeys -f /opt/servers/all_hosts\n# gpscp -f /opt/servers/all_hosts PADS-1.3.1.1/hawq-1.3.1.1-19631.x86_64.rpm =:~/\n# gpssh -f /opt/servers/all_hosts -e \"rpm -ivh hawq-1.3.1.1-19631.x86_64.rpm\"\n\ngpadmin\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nHadoop\u3068\u9023\u643a\u3057\u3066\u52d5\u304b\u3059\u5834\u5408\u306f\u3001hadoop\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3057\u305f\u307b\u3046\u304c\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3044\u3067\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3054\u81ea\u7531\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n# gpssh -f /opt/servers/all_hosts -e 'useradd -d /home/gpadmin -s /bin/bash -g hadoop -m gpadmin'\n# gpssh -f /opt/servers/all_hosts -e 'echo -e \"gpadmin\\ngpadmin\" | passwd gpadmin'\n\ngpadmin\u30e6\u30fc\u30b6\u30fc\u306bsu\u3057\u3066.bash_profile\u306b\u30d1\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067gpadmin\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u30ec\u30b9\u30ed\u30b0\u30a4\u30f3\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\u3002\n# su - gpadmin\n$ source /usr/local/hawq/greenplum_path.sh\n$ gpssh-exkeys -f /opt/servers/all_hosts\n$ gpssh -f /opt/servers/all_hosts -e \"echo . /usr/local/hawq/greenplum_path.sh >> .bash_profile\"\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n$ gpssh -f /opt/servers/all_hosts -e \"ls -l $GPHOME\"\n  bin\n  :\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nHAWQ\u304c\u4f7f\u7528\u3059\u308b\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n\u30de\u30b9\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nNameNode\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001HAWQ\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n# vi /opt/servers/master_hosts\nhawq-ma01          # \u30de\u30b9\u30bf\n\n# gpssh -f /opt/servers/master_hosts -e 'mkdir -p /hadoop/data/hawq/master'\n# gpssh -f /opt/servers/master_hosts -e 'chown -R gpadmin /hadoop/data/hawq/master'\n\n\n\n\u30b9\u30ec\u30fc\u30d6\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nDataNode\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001HAWQ\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7528\u610f\u3057\u307e\u3059\u3002\n\u30b9\u30ec\u30fc\u30d6\u306e\u30c7\u30a3\u30b9\u30af\u6570\u306b\u5408\u308f\u305b\u3066\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# vi /opt/servers/slave_hosts\nhawq-sl01          # \u30b9\u30ec\u30fc\u30d6\nhawq-sl02          # \u3003\n:\n\n# gpssh -f /opt/servers/slave_hosts -e 'mkdir -p /hadoop/data{0,1,2,3}/hawq/tmp'\n# gpssh -f /opt/servers/slave_hosts -e 'chown -R gpadmin /hadoop/data{0,1,2,3}/hawq/tmp'\n# gpssh -f /opt/servers/slave_hosts -e 'mkdir -p /hadoop/data{0,1,2,3}/hawq/primary'\n# gpssh -f /opt/servers/slave_hosts -e 'chown -R gpadmin /hadoop/data{0,1,2,3}/hawq/primary'\n\n\n\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# gpssh -f /opt/servers/master_hosts -e \"ls -l /hadoop/data/hawq\"\nmaster\n\n# gpssh -f /opt/servers/slave_hosts -e \"ls -l /hadoop/data{0,1,2,3}/hawq\"\nprimary\ntmp\n:\n\n\nOS\u306e\u8a2d\u5b9a\nSet the OS Parameters\u3092\u53c2\u8003\u306b\u3001\u5168\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066OS\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u30de\u30b9\u30bf\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304b\u3089\u30b9\u30ec\u30fc\u30d6\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n# vi /etc/sysctl.conf\nkernel.shmmax = 500000000\nkernel.shmmni = 4096\nkernel.shmall = 4000000000\nkernel.sem = 250 512000 100 2048\nkernel.sysrq = 1\nkernel.core_uses_pid = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.msgmni = 2048\nnet.ipv4.tcp_syncookies = 0\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.accept_source_route = 0\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_max_syn_backlog = 200000\nnet.ipv4.conf.all.arp_filter = 1\nnet.ipv4.ip_local_port_range = 1025 65535\nnet.core.netdev_max_backlog = 200000\nvm.overcommit_memory = 2\nfs.nr_open = 3000000\nkernel.threads-max = 798720\nkernel.pid_max = 798720\nnet.core.rmem_max = 2097152\nnet.core.wmem_max = 2097152\n\n# gpscp -f /opt/servers/slave_hosts /etc/sysctl.conf =:/etc\n\n# vi /etc/security/limits.d/hawq.conf\ngpadmin soft nofile 65536\ngpadmin hard nofile 65536\ngpadmin soft nproc 131072\ngpadmin hard nproc 131072\n\n# gpscp -f /opt/servers/slave_hosts /etc/security/limits.d/hawq.conf =:/etc/security/limits.d/\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u306b\u306fOS\u306e\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u306a\u304a\u3001OS\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u3067\u3082\u3001\"kernel.sem\"\u3060\u3051\u306f\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u300ccould not create semaphores: No space left on device\u300d\u3092\u907f\u3051\u308b\u305f\u3081\u3067\u3059\u3002(PostgreSQL\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u8a73\u3057\u3044\u3067\u3059)\n\nHAWQ\u306e\u521d\u671f\u5316\n\u521d\u671f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n# su - gpadmin\n$ mkdir gpconfigs\n$ cp /usr/local/hawq/docs/cli_help/gpconfigs/gpinitsystem_config ~/gpconfigs/\n$ chmod u+w ~/gpconfigs/gpinitsystem_config\n\n$ vi ~/gpconfigs/gpinitsystem_config\n:\ndeclare -a DATA_DIRECTORY=(/hadoop/data0/hawq/primary /hadoop/data0/hawq/primary /hadoop/data1/hawq/primary /hadoop/data1/hawq/primary /hadoop/data2/hawq/primary /hadoop/data2/hawq/primary /hadoop/data3/hawq/primary /hadoop/data3/hawq/primary)\n                                            # HAWQ\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3002\u30b9\u30ec\u30fc\u30d6\u306e\u53f0\u6570 x \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6570\u5206\u7e70\u308a\u8fd4\u3059\nMASTER_HOSTNAME=hawq-ma01                   # HAWQ\u306e\u30de\u30b9\u30bf\u306e\u30db\u30b9\u30c8\u540d\nMASTER_DIRECTORY=/hadoop/data/hawq/master   # HAWQ\u306e\u30de\u30b9\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nDFS_URL=hawq-ma01:8020/hawq                 # HAWQ\u306eHDFS\u4e0a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306eURL\nDATABASE_NAME=hawq_db                       # HAWQ\u306eDB\u540d\u3002\u5f8c\u3067createdb\u3067\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\nMACHINE_LIST_FILE=/opt/servers/slave_hosts  # \u30b9\u30ec\u30fc\u30d6\u306e\u4e00\u89a7\u3092\u8a18\u8ff0\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n\nNameNode HA\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u521d\u671f\u5316\u306e\u524d\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001HAWQ\u81ea\u8eab\u306fHA\u306e\u4ed5\u7d44\u307f\u304c\u306a\u304f\u3001PostgreSQL\u3068\u540c\u3058\u65b9\u5f0f\u3067\u5b9f\u73fe\u3059\u308b\u3088\u3046\u3067\u3059\u30021\n$ vi ~/gpconfigs/gpinitsystem_config\nDFS_URL=nn-cluster/hawq    # NameServiceID\u306b\u5909\u66f4\u3059\u308b\n\n# vi /usr/local/hawq/etc/hdfs-client.xml\n<!-- HA -->\n<property>\n  <name>dfs.nameservices</name>\n  <value>nn-cluster</value>\n</property>\n\n<property>\n  <name>dfs.ha.namenodes.nn-cluster</name>\n  <value>nn1,nn2</value>\n</property>\n\n<property>\n  <name>dfs.namenode.rpc-address.nn-cluster.nn1</name>\n  <value>hawq-ma01:8020</value>\n</property>\n\n<property>\n  <name>dfs.namenode.rpc-address.nn-cluster.nn2</name>\n  <value>hawq-ma02:8020</value>\n</property>\n\n<property>\n  <name>dfs.namenode.http-address.nn-cluster.nn1</name>\n  <value>hawq-ma01:50070</value>\n</property>\n\n<property>\n  <name>dfs.namenode.http-address.nn-cluster.nn2</name>\n  <value>hawq-ma02:50070</value>\n</property>\n\n# gpscp -f /opt/servers/all_hosts /usr/local/hawq/etc/hdfs-client.xml =:/usr/local/hawq/etc\n\nHDFS\u4e0a\u306bHAWQ\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n# su - hdfs\n$ hdfs dfs -mkdir /hawq\n$ hdfs dfs -chown gpadmin /hawq\n$ hdfs dfs -mkdir /user/gpadmin\n$ hdfs dfs -chown gpadmin /user/gpadmin\n\n\u3044\u3088\u3044\u3088HAWQ\u306e\u521d\u671f\u5316\u3092\u5b9f\u884c\u3057\u307e\u3059\uff01\n# su - gpadmin\n$ gpinitsystem -c ~/gpconfigs/gpinitsystem_config\n:\nContinue with Greenplum creation Yy/Nn>\ny\n\n\u3061\u306a\u307f\u306b\u521d\u671f\u5316\u306e\u7834\u68c4\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u521d\u671f\u5316\u3092\u3084\u308a\u76f4\u3059\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n$ /bin/bash /home/gpadmin/gpAdminLogs/backout_gpinitsystem_gpadmin_yyyyMMdd_hhmmss    # yyyyMMdd_hhmmss\u306f\u521d\u671f\u5316\u3057\u305f\u65e5\u4ed8\n\n\n\u521d\u671f\u5316\u5f8c\u306e\u8a2d\u5b9a\n.bash_profile\u306b\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n# su - gpadmin\n$ vi ~/.bash_profile\nexport MASTER_DATA_DIRECTORY=/hadoop/data/hawq/master/gpseg-1\n\nPrepare HDFS\u3092\u53c2\u8003\u306bHadoop\u30af\u30e9\u30b9\u30bf\u306e\u8a2d\u5b9a\u3092\u898b\u76f4\u3057\u307e\u3059\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u30b7\u30e7\u30fc\u30c8\u30b5\u30fc\u30ad\u30c3\u30c8\u30ea\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3059\u308b\u3068\u3053\u308d\u3067\u3059\u3002\n\u4e2d\u3067\u3082\u6700\u8fd1\u306eHadoop\u3067\u306f\u4e0d\u8981\u306a\"dfs.block.local-path-access.user\"\u304c\u5fc5\u8981\u3067\u3059\u3002\n# vi /etc/hadoop/conf/hdfs-site.xml\n:\n<property>\n  <name>dfs.client.read.shortcircuit</name>\n  <value>true</value>\n</property>\n\n<property>\n  <name>dfs.block.local-path-access.user</name>\n  <value>gpadmin</value>\n</property>\n\n<property>\n  <name>dfs.datanode.data.dir.perm</name>\n  <value>750</value>\n</property>\n\n\u4efb\u610f\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089HAWQ\u306e\u30de\u30b9\u30bf\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306fpg_hba.conf\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\nPostgreSQL\u3068\u540c\u3058\u3067\u3059\u306d\u3002\n# vi /hadoop/data/hawq/master/gpseg-1/pg_hba.conf\n:\n#host     all         gpadmin         172.27.1.102/32       trust\nhost     all         gpadmin         172.27.1.0/24       trust\n\n\nHAWQ\u306e\u5229\u7528\n\u521d\u671f\u5316\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067HAWQ\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3059\u3067\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\nhawq_db\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3082\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n# su - gpadmin\n$ vi t_user.csv\n1   ajis_ka\n2   adachij2002\n3   takeuchikzm\n\n$ psql hawq_db\nhawq_db=#\n  CREATE TABLE t_user\n  (\n    id INTEGER,\n    name TEXT\n  )\n  WITH (appendonly=true) DISTRIBUTED RANDOMLY;\nCREATE TABLE\n\nhawq_db=# COPY t_user FROM '/home/gpadmin/t_user.csv' DELIMITER E'\\t';\nCOPY 3\n\nhawq_db=# SELECT * FROM t_user ORDER BY id;\n id |    name\n----+-------------\n  1 | ajis_ka\n  2 | adachij2002\n  3 | takeuchikzm\n(3 rows)\n\n\u52d5\u304d\u307e\u3057\u305f\uff01\n\n\u6b21\u56de\u4e88\u544a\n\u3053\u3053\u307e\u3067\u3067\u6c17\u4ed8\u3044\u305f\u4eba\u3082\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001HAWQ\u306fHDFS\u4e0a\u306e\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(\u4eca\u56de\u306a\u3089/hawq)\u3092\u5c02\u7528\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n# sudo -u hdfs hdfs dfs -ls /hawq\ndrwx------   - gpadmin supergroup          0 2016-04-22 22:23 /hawq/gpseg0\ndrwx------   - gpadmin supergroup          0 2016-04-22 22:23 /hawq/gpseg1\n:\n\nHDFS\u306e\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u8aad\u3081\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\nHive\u3068\u306e\u9023\u643a\u306f\uff1f\n\u305d\u306e\u7b54\u3048\u306fPXF(Pivotal eXtension Framework)\u306b\u3042\u308a\u307e\u3059\u3002\n\u6b21\u56de\u306fPXF\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001HDFS\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3084Hive\u3068\u306e\u9023\u643a\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8ffd\u8a18\nPXF\u306b\u3064\u3044\u3066\u7d9a\u304d\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\n\n\nInstall HAWQ and PXF with Ambari\u00a0\u21a9\n\n\n[AMBARI-3524] Set up generic puppet module architecture to manage both HDP and CDH (and Apache?) stacks\u00a0\u21a9\n\n\n\nHAWQ\u3068\u306f\n-----------------------\n[HAWQ](http://pivotal.io/big-data/white-paper/a-true-sql-engine-for-hadoop-pivotal-hd-hawq)\u306f[Pivotal](http://pivotal.io/)\u304c\u958b\u767a\u3057\u305f[Hadoop](http://hadoop.apache.org/)\u4e0a\u3067\u52d5\u4f5c\u3059\u308bSQL\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\n\u73fe\u5728\u306fApache\u306b\u5bc4\u8d08\u3055\u308c\u3001[Apache HAWQ](http://hawq.incubator.apache.org/)\u3068\u3057\u3066\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nHAWQ\u306b\u8fd1\u3044\u4f4d\u7f6e\u4ed8\u3051\u306e\u3082\u306e\u306b\u306f\u3001[Cloudera](http://www.cloudera.com/)\u304c\u4e3b\u5c0e\u3059\u308b[Impala](http://impala.io/)\u304c\u3042\u308a\u307e\u3059\u3002\nHAWQ\u306e\u4e2d\u8eab\u306f[PostgreSQL](http://www.postgresql.org/)\u3092\u30d9\u30fc\u30b9\u306b\u5206\u6563\u74b0\u5883\u306b\u5bfe\u5fdc\u3057\u305f[Greenplum](http://pivotal.io/big-data/pivotal-greenplum)\u3092Hadoop\u306b\u5bfe\u5fdc\u3057\u305f\u3082\u306e\u3068\u8003\u3048\u308c\u3070\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nPostgreSQL\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u3001\u6570\u3042\u308bSQL on Hadoop\u306e\u4e2d\u3067\u3082SQL\u3078\u306e\u6e96\u62e0\u30ec\u30d9\u30eb\u304c\u9ad8\u3044\u3053\u3068\u304c\u7279\u5fb4\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u8a73\u7d30\u306f[Enterprise SQL on Hadoop with Pivotal HDB](https://pivotal.io/big-data/hadoop/sql-on-hadoop)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nPivotal\u3068ODPi\n-----------------------\n[ODPi](https://www.odpi.org/)\u306fHadoop\u306e\u76f8\u4e92\u904b\u7528\u6027\u3092\u76ee\u7684\u3068\u3057\u3066[Hortonworks](http://hortonworks.com/)\u3001Pivotal\u3092\u4e2d\u5fc3\u306b\u8a2d\u7acb\u3055\u308c\u305f\u56e3\u4f53\u3067\u3059\u3002\nHadoop\u306f\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u4e71\u7acb\u3057\u3066\u3044\u3066\u3001\u305d\u308c\u305e\u308c\u304c\u72ec\u81ea\u306e\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\u305f\u3081\u3001\u76f8\u4e92\u904b\u7528\u6027\u304c\u5371\u3046\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u72b6\u6cc1\u306e\u4e2d\u3001\u30b3\u30a2\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u76f8\u4e92\u904b\u7528\u6027\u3092\u7dad\u6301\u3057\u3088\u3046\u3068\u3044\u3046\u306e\u304cODPi\u306e\u8da3\u65e8\u3067\u3059\u3002\n\u3057\u304b\u3057\u5b9f\u614b\u306f\u3001ODPi\u306e\u5404\u793e\u304cHortonworks\u306e[HDP](http://hortonworks.com/products/hdp/)\u3092OEM\u3068\u3057\u3066\u63a1\u7528\u3059\u308b\u72b6\u6cc1\u306b\u3042\u308a\u3001\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u6226\u7565\u3067\u3042\u308b\u3068\u306e\u6279\u5224\u304c\u3042\u308a\u307e\u3059\u3002\n\u5b9f\u969b\u3001Pivotal\u306f\u81ea\u8eab\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3042\u308b[Pivotal HD](http://pivotalhd.docs.pivotal.io/)\u3092HDP\u30d9\u30fc\u30b9\u306b\u5207\u308a\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u4e8b\u60c5\u304b\u3089\u3001HAWQ\u306fPivotal HD\u3084HDP\u3078\u5bb9\u6613\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002[^1]\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0/\u7ba1\u7406\u30c4\u30fc\u30eb\u3067\u3042\u308b[Ambari](https://ambari.apache.org/)\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a6\u30a3\u30b6\u30fc\u30c9\u306b\u5f93\u3063\u3066\u30af\u30ea\u30c3\u30af\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3059\u3002\n\n[^1]: [Install HAWQ and PXF with Ambari](http://hawq.docs.pivotal.io/docs-hawq/topics/install-ambari.html)\n\nHAWQ\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u524d\u306b\n-----------------------\nHAWQ\u306fHadoop\u4e0a\u3067\u52d5\u4f5c\u3059\u308bSQL\u5b9f\u884c\u30a8\u30f3\u30b8\u30f3\u306a\u306e\u3067\u3001Cloudera\u306e[CDH](https://www.cloudera.com/products/apache-hadoop/key-cdh-components.html)\u3067\u3082\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001Ambari\u304cHDP\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081[^2]\u3001Ambari\u3092\u4f7f\u3063\u3066CDH\u306eHadoop\u30af\u30e9\u30b9\u30bf\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u4eca\u56de\u306fHAWQ\u3092\u624b\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nHAWQ\u306f[\u30d3\u30eb\u30c9\u74b0\u5883](https://cwiki.apache.org/confluence/display/HAWQ/Build+and+Install)\u3092\u6574\u3048\u308b\u306e\u3082\u4e00\u82e6\u52b4\u306a\u306e\u3067\u3001Pivotal\u304c\u914d\u5e03\u3057\u3066\u3044\u308b[Pivotal HDB](https://network.pivotal.io/products/pivotal-hdb)\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u306f[Pivotal Network](https://network.pivotal.io/)\u3078\u306e\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n[^2]: [[AMBARI-3524] Set up generic puppet module architecture to manage both HDP and CDH (and Apache?) stacks](https://issues.apache.org/jira/browse/AMBARI-3524)\n\nHAWQ\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n-----------------------\nHAWQ\u3092\u624b\u52d5\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u306f[Installing HAWQ from the Command Line](http://hawq.docs.pivotal.io/docs-hawq/topics/InstallingHAWQ.html)\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u591a\u5c11\u3001\u7a7a\u6c17\u3092\u8aad\u3093\u3067\u624b\u9806\u3092\u98db\u3070\u3057\u305f\u308a\u3001\u8ffd\u52a0\u3057\u305f\u308a\u3057\u306a\u304c\u3089\u9032\u3081\u307e\u3059\u3002\n\n\u307e\u305a\u59cb\u3081\u306b\u3001\u30de\u30b9\u30bf\u306b\u6700\u4f4e\u9650\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u30de\u30b9\u30bf\u306e\u8cc7\u6750\u3092\u3001pssh/pscp\u306e\u3088\u3046\u306a\u30c4\u30fc\u30eb\u3092\u7528\u3044\u3066\u3001\u30b9\u30ec\u30fc\u30d6\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\u3053\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u6700\u521d\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u306a\u308f\u3051\u3067\u3059\u3002\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305ftar\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3057\u3066rpm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ngpadmin\u30e6\u30fc\u30b6\u30fc/\u30b0\u30eb\u30fc\u30d7\u304c\u7121\u3044\u3068\u3044\u3046\u8b66\u544a\u306f\u7121\u8996\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n\n``` console\n# tar xvf PADS-1.3.1.1-19631-rhel5_x86_64.tgz\n# rpm -ivh PADS-1.3.1.1/hawq-1.3.1.1-19631.x86_64.rpm\n```\n\nHAWQ\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092.bash_profile\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n``` console\n# echo . /usr/local/hawq/greenplum_path.sh >> .bash_profile\n# . .bash_profile\n```\n\n\u5168\u30ce\u30fc\u30c9\u306bHAWQ\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u30db\u30b9\u30c8\u540d\u306e\u4e00\u89a7\u3092\u7528\u610f\u3057\u3066\u3001\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002(\u30de\u30b9\u30bf\u306bHAWQ\u30922\u56de\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6c17\u306b\u3057\u306a\u3044\u3053\u3068\u306b\u3057\u307e\u3059...)\n\u3053\u306e\u904e\u7a0b\u3067\u3001\u9375\u4ea4\u63db\u306b\u3088\u308aroot\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u30ec\u30b9\u30ed\u30b0\u30a4\u30f3\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\u3002\n\n``` console\n# mkdir /opt/servers\n# vi /opt/servers/all_hosts\nhawq-ma01          # \u30de\u30b9\u30bf\nhawq-sl01          # \u30b9\u30ec\u30fc\u30d6\nhawq-sl02          # \u3003\n:\n\n# gpssh-exkeys -f /opt/servers/all_hosts\n# gpscp -f /opt/servers/all_hosts PADS-1.3.1.1/hawq-1.3.1.1-19631.x86_64.rpm =:~/\n# gpssh -f /opt/servers/all_hosts -e \"rpm -ivh hawq-1.3.1.1-19631.x86_64.rpm\"\n```\n\ngpadmin\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nHadoop\u3068\u9023\u643a\u3057\u3066\u52d5\u304b\u3059\u5834\u5408\u306f\u3001hadoop\u30b0\u30eb\u30fc\u30d7\u306b\u6240\u5c5e\u3057\u305f\u307b\u3046\u304c\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3044\u3067\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3054\u81ea\u7531\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n``` console\n# gpssh -f /opt/servers/all_hosts -e 'useradd -d /home/gpadmin -s /bin/bash -g hadoop -m gpadmin'\n# gpssh -f /opt/servers/all_hosts -e 'echo -e \"gpadmin\\ngpadmin\" | passwd gpadmin'\n```\n\ngpadmin\u30e6\u30fc\u30b6\u30fc\u306bsu\u3057\u3066.bash_profile\u306b\u30d1\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067gpadmin\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u30ec\u30b9\u30ed\u30b0\u30a4\u30f3\u304c\u8a31\u53ef\u3055\u308c\u307e\u3059\u3002\n\n``` console\n# su - gpadmin\n$ source /usr/local/hawq/greenplum_path.sh\n$ gpssh-exkeys -f /opt/servers/all_hosts\n$ gpssh -f /opt/servers/all_hosts -e \"echo . /usr/local/hawq/greenplum_path.sh >> .bash_profile\"\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n``` console\n$ gpssh -f /opt/servers/all_hosts -e \"ls -l $GPHOME\"\n  bin\n  :\n```\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n-----------------------\nHAWQ\u304c\u4f7f\u7528\u3059\u308b\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n1. \u30de\u30b9\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n    NameNode\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001HAWQ\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n    ``` console\n    # vi /opt/servers/master_hosts\n    hawq-ma01          # \u30de\u30b9\u30bf\n\n    # gpssh -f /opt/servers/master_hosts -e 'mkdir -p /hadoop/data/hawq/master'\n    # gpssh -f /opt/servers/master_hosts -e 'chown -R gpadmin /hadoop/data/hawq/master'\n    ```\n\n1. \u30b9\u30ec\u30fc\u30d6\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n    DataNode\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3001HAWQ\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7528\u610f\u3057\u307e\u3059\u3002\n    \u30b9\u30ec\u30fc\u30d6\u306e\u30c7\u30a3\u30b9\u30af\u6570\u306b\u5408\u308f\u305b\u3066\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n    ``` console\n    # vi /opt/servers/slave_hosts\n    hawq-sl01          # \u30b9\u30ec\u30fc\u30d6\n    hawq-sl02          # \u3003\n    :\n\n    # gpssh -f /opt/servers/slave_hosts -e 'mkdir -p /hadoop/data{0,1,2,3}/hawq/tmp'\n    # gpssh -f /opt/servers/slave_hosts -e 'chown -R gpadmin /hadoop/data{0,1,2,3}/hawq/tmp'\n    # gpssh -f /opt/servers/slave_hosts -e 'mkdir -p /hadoop/data{0,1,2,3}/hawq/primary'\n    # gpssh -f /opt/servers/slave_hosts -e 'chown -R gpadmin /hadoop/data{0,1,2,3}/hawq/primary'\n    ```\n\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n``` console\n# gpssh -f /opt/servers/master_hosts -e \"ls -l /hadoop/data/hawq\"\nmaster\n\n# gpssh -f /opt/servers/slave_hosts -e \"ls -l /hadoop/data{0,1,2,3}/hawq\"\nprimary\ntmp\n:\n```\n\nOS\u306e\u8a2d\u5b9a\n-----------------------\n[Set the OS Parameters](http://hawq.docs.pivotal.io/docs-hawq/topics/InstallingHAWQ.html#settingtheosparameters)\u3092\u53c2\u8003\u306b\u3001\u5168\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066OS\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u30de\u30b9\u30bf\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304b\u3089\u30b9\u30ec\u30fc\u30d6\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n``` console\n# vi /etc/sysctl.conf\nkernel.shmmax = 500000000\nkernel.shmmni = 4096\nkernel.shmall = 4000000000\nkernel.sem = 250 512000 100 2048\nkernel.sysrq = 1\nkernel.core_uses_pid = 1\nkernel.msgmnb = 65536\nkernel.msgmax = 65536\nkernel.msgmni = 2048\nnet.ipv4.tcp_syncookies = 0\nnet.ipv4.ip_forward = 0\nnet.ipv4.conf.default.accept_source_route = 0\nnet.ipv4.tcp_tw_recycle = 1\nnet.ipv4.tcp_max_syn_backlog = 200000\nnet.ipv4.conf.all.arp_filter = 1\nnet.ipv4.ip_local_port_range = 1025 65535\nnet.core.netdev_max_backlog = 200000\nvm.overcommit_memory = 2\nfs.nr_open = 3000000\nkernel.threads-max = 798720\nkernel.pid_max = 798720\nnet.core.rmem_max = 2097152\nnet.core.wmem_max = 2097152\n\n# gpscp -f /opt/servers/slave_hosts /etc/sysctl.conf =:/etc\n```\n``` console\n# vi /etc/security/limits.d/hawq.conf\ngpadmin soft nofile 65536\ngpadmin hard nofile 65536\ngpadmin soft nproc 131072\ngpadmin hard nproc 131072\n\n# gpscp -f /opt/servers/slave_hosts /etc/security/limits.d/hawq.conf =:/etc/security/limits.d/\n```\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u306b\u306fOS\u306e\u518d\u8d77\u52d5\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u306a\u304a\u3001OS\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u3067\u3082\u3001\"kernel.sem\"\u3060\u3051\u306f\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u300ccould not create semaphores: No space left on device\u300d\u3092\u907f\u3051\u308b\u305f\u3081\u3067\u3059\u3002([PostgreSQL\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://www.postgresql.org/docs/8.2/static/server-start.html)\u304c\u8a73\u3057\u3044\u3067\u3059)\n\nHAWQ\u306e\u521d\u671f\u5316\n-----------------------\n\u521d\u671f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n``` console\n# su - gpadmin\n$ mkdir gpconfigs\n$ cp /usr/local/hawq/docs/cli_help/gpconfigs/gpinitsystem_config ~/gpconfigs/\n$ chmod u+w ~/gpconfigs/gpinitsystem_config\n\n$ vi ~/gpconfigs/gpinitsystem_config\n:\ndeclare -a DATA_DIRECTORY=(/hadoop/data0/hawq/primary /hadoop/data0/hawq/primary /hadoop/data1/hawq/primary /hadoop/data1/hawq/primary /hadoop/data2/hawq/primary /hadoop/data2/hawq/primary /hadoop/data3/hawq/primary /hadoop/data3/hawq/primary)\n                                            # HAWQ\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3002\u30b9\u30ec\u30fc\u30d6\u306e\u53f0\u6570 x \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u6570\u5206\u7e70\u308a\u8fd4\u3059\nMASTER_HOSTNAME=hawq-ma01                   # HAWQ\u306e\u30de\u30b9\u30bf\u306e\u30db\u30b9\u30c8\u540d\nMASTER_DIRECTORY=/hadoop/data/hawq/master   # HAWQ\u306e\u30de\u30b9\u30bf\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nDFS_URL=hawq-ma01:8020/hawq                 # HAWQ\u306eHDFS\u4e0a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306eURL\nDATABASE_NAME=hawq_db                       # HAWQ\u306eDB\u540d\u3002\u5f8c\u3067createdb\u3067\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\nMACHINE_LIST_FILE=/opt/servers/slave_hosts  # \u30b9\u30ec\u30fc\u30d6\u306e\u4e00\u89a7\u3092\u8a18\u8ff0\u3057\u305f\u30d5\u30a1\u30a4\u30eb\n```\n\nNameNode HA\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u521d\u671f\u5316\u306e\u524d\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001HAWQ\u81ea\u8eab\u306fHA\u306e\u4ed5\u7d44\u307f\u304c\u306a\u304f\u3001PostgreSQL\u3068\u540c\u3058\u65b9\u5f0f\u3067\u5b9f\u73fe\u3059\u308b\u3088\u3046\u3067\u3059\u3002[^1]\n\n[^1]: http://hawq.docs.pivotal.io/docs-hawq/docs-hawq-shared/admin_guide/highavail/topics/g-overview-of-high-availability-in-greenplum-database.html\n\n``` console\n$ vi ~/gpconfigs/gpinitsystem_config\nDFS_URL=nn-cluster/hawq    # NameServiceID\u306b\u5909\u66f4\u3059\u308b\n```\n\n``` console\n# vi /usr/local/hawq/etc/hdfs-client.xml\n<!-- HA -->\n<property>\n  <name>dfs.nameservices</name>\n  <value>nn-cluster</value>\n</property>\n\n<property>\n  <name>dfs.ha.namenodes.nn-cluster</name>\n  <value>nn1,nn2</value>\n</property>\n\n<property>\n  <name>dfs.namenode.rpc-address.nn-cluster.nn1</name>\n  <value>hawq-ma01:8020</value>\n</property>\n\n<property>\n  <name>dfs.namenode.rpc-address.nn-cluster.nn2</name>\n  <value>hawq-ma02:8020</value>\n</property>\n\n<property>\n  <name>dfs.namenode.http-address.nn-cluster.nn1</name>\n  <value>hawq-ma01:50070</value>\n</property>\n\n<property>\n  <name>dfs.namenode.http-address.nn-cluster.nn2</name>\n  <value>hawq-ma02:50070</value>\n</property>\n\n# gpscp -f /opt/servers/all_hosts /usr/local/hawq/etc/hdfs-client.xml =:/usr/local/hawq/etc\n```\n\nHDFS\u4e0a\u306bHAWQ\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n``` console\n# su - hdfs\n$ hdfs dfs -mkdir /hawq\n$ hdfs dfs -chown gpadmin /hawq\n$ hdfs dfs -mkdir /user/gpadmin\n$ hdfs dfs -chown gpadmin /user/gpadmin\n```\n\n\u3044\u3088\u3044\u3088HAWQ\u306e\u521d\u671f\u5316\u3092\u5b9f\u884c\u3057\u307e\u3059\uff01\n\n``` console\n# su - gpadmin\n$ gpinitsystem -c ~/gpconfigs/gpinitsystem_config\n:\nContinue with Greenplum creation Yy/Nn>\ny\n```\n\n\u3061\u306a\u307f\u306b\u521d\u671f\u5316\u306e\u7834\u68c4\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u521d\u671f\u5316\u3092\u3084\u308a\u76f4\u3059\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n``` console\n$ /bin/bash /home/gpadmin/gpAdminLogs/backout_gpinitsystem_gpadmin_yyyyMMdd_hhmmss    # yyyyMMdd_hhmmss\u306f\u521d\u671f\u5316\u3057\u305f\u65e5\u4ed8\n```\n\n\u521d\u671f\u5316\u5f8c\u306e\u8a2d\u5b9a\n-----------------------\n.bash_profile\u306b\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n``` console\n# su - gpadmin\n$ vi ~/.bash_profile\nexport MASTER_DATA_DIRECTORY=/hadoop/data/hawq/master/gpseg-1\n```\n\n[Prepare HDFS](http://hawq.docs.pivotal.io/docs-hawq/topics/InstallingHAWQ.html#preparingtoinstallhawq)\u3092\u53c2\u8003\u306bHadoop\u30af\u30e9\u30b9\u30bf\u306e\u8a2d\u5b9a\u3092\u898b\u76f4\u3057\u307e\u3059\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u30b7\u30e7\u30fc\u30c8\u30b5\u30fc\u30ad\u30c3\u30c8\u30ea\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3059\u308b\u3068\u3053\u308d\u3067\u3059\u3002\n\u4e2d\u3067\u3082\u6700\u8fd1\u306eHadoop\u3067\u306f\u4e0d\u8981\u306a\"dfs.block.local-path-access.user\"\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n``` console\n# vi /etc/hadoop/conf/hdfs-site.xml\n:\n<property>\n  <name>dfs.client.read.shortcircuit</name>\n  <value>true</value>\n</property>\n\n<property>\n  <name>dfs.block.local-path-access.user</name>\n  <value>gpadmin</value>\n</property>\n\n<property>\n  <name>dfs.datanode.data.dir.perm</name>\n  <value>750</value>\n</property>\n```\n\n\u4efb\u610f\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089HAWQ\u306e\u30de\u30b9\u30bf\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306fpg_hba.conf\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\nPostgreSQL\u3068\u540c\u3058\u3067\u3059\u306d\u3002\n\n``` console\n# vi /hadoop/data/hawq/master/gpseg-1/pg_hba.conf\n:\n#host     all         gpadmin         172.27.1.102/32       trust\nhost     all         gpadmin         172.27.1.0/24       trust\n```\n\nHAWQ\u306e\u5229\u7528\n-----------------------\n\u521d\u671f\u5316\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067HAWQ\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3059\u3067\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\nhawq_db\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3082\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n``` console\n# su - gpadmin\n$ vi t_user.csv\n1\tajis_ka\n2\tadachij2002\n3\ttakeuchikzm\n\n$ psql hawq_db\nhawq_db=#\n  CREATE TABLE t_user\n  (\n    id INTEGER,\n    name TEXT\n  )\n  WITH (appendonly=true) DISTRIBUTED RANDOMLY;\nCREATE TABLE\n\nhawq_db=# COPY t_user FROM '/home/gpadmin/t_user.csv' DELIMITER E'\\t';\nCOPY 3\n\nhawq_db=# SELECT * FROM t_user ORDER BY id;\n id |    name\n----+-------------\n  1 | ajis_ka\n  2 | adachij2002\n  3 | takeuchikzm\n(3 rows)\n```\n\n\u52d5\u304d\u307e\u3057\u305f\uff01\n\n\u6b21\u56de\u4e88\u544a\n-----------------------\n\u3053\u3053\u307e\u3067\u3067\u6c17\u4ed8\u3044\u305f\u4eba\u3082\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001HAWQ\u306fHDFS\u4e0a\u306e\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(\u4eca\u56de\u306a\u3089/hawq)\u3092\u5c02\u7528\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n``` console\n# sudo -u hdfs hdfs dfs -ls /hawq\ndrwx------   - gpadmin supergroup          0 2016-04-22 22:23 /hawq/gpseg0\ndrwx------   - gpadmin supergroup          0 2016-04-22 22:23 /hawq/gpseg1\n:\n```\n\nHDFS\u306e\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u8aad\u3081\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\nHive\u3068\u306e\u9023\u643a\u306f\uff1f\n\n\u305d\u306e\u7b54\u3048\u306f[PXF(Pivotal eXtension Framework)](http://hawq.docs.pivotal.io/docs-hawq/topics/PXFInstallationandAdministration.html)\u306b\u3042\u308a\u307e\u3059\u3002\n\u6b21\u56de\u306fPXF\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001HDFS\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3084Hive\u3068\u306e\u9023\u643a\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8ffd\u8a18\n-----------------------\n[PXF\u306b\u3064\u3044\u3066](http://qiita.com/adachij2002/items/e652f172aa48898b4825)\u7d9a\u304d\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n", "tags": ["HAWQ", "hadoop", "CDH"]}