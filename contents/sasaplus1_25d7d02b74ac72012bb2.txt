{"context": " More than 1 year has passed since last update.SFTP\u7528\u30e6\u30fc\u30b6\u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u305d\u308c\u3092\u4f5c\u308b\u30e1\u30e2\u3067\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u78ba\u8a8d\n\nTerminal\n$ less /etc/group\n$ less /etc/passwd\n\n\n\u306a\u3093\u304b\u307e\u3042\u3001\u30b0\u30eb\u30fc\u30d7\u3068\u304b\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\u3002\n\n\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\nTerminal\n# groupadd username\n# useradd -d /home/username -g username username\n\n\nSFTP\u7528\u30e6\u30fc\u30b6\u3068SFTP\u7528\u30e6\u30fc\u30b6\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u307e\u3059\u3002\n# mktemp -u XXXXXXXX\n# passwd username\n\n\u521d\u671f\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6307\u5b9a\u3092\u3059\u308b\u306e\u306bmkpasswd\u3068\u304b\u3044\u3046\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u3089\u3057\u3044\u306e\u3060\u3051\u3069\u3001\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u306e\u3067mktemp\u3067\u4ee3\u7528\u3057\u305f\u2026\u2026\uff08\u3044\u3044\u306e\u304b\u306a\u3053\u308c\uff09\n# mkdir -p /home/username/.ssh\n# touch /home/username/.ssh/authorized_keys\n# chmod 0700 /home/username/.ssh\n# chmod 0600 /home/username/.ssh/authorized_keys\n\n\u3042\u3068\u306f.ssh\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u304b\u4f5c\u3063\u305f\u308a\u3068\u304b\u3002authorized_keys\u306b\u9375\u306e\u8ffd\u52a0\u3082\u3057\u3066\u304a\u304f\u3002\n\nSSH\u30ed\u30b0\u30a4\u30f3\u6642\u306e\u30b3\u30de\u30f3\u30c9\u6307\u5b9a\nusername\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3068\u304d\u306b\u6700\u521d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u3002authorized_keys\u306e\u5148\u982d\u306b\u66f8\u3051\u3070\u826f\u3044\u307f\u305f\u3044\u3002\n# vi /home/username/.ssh/authorized_keys\n\n\n~username/.ssh/authorized_keys\n-ssh-rsa ...\n+command=\"internal-sftp\" ssh-rsa ...\n\n\nauthoriezed_keys\u306e\u8ffd\u52a0\u3057\u305f\u9375\u306e\u884c\u306e\u5148\u982d\u306bcommand=\"internal-sftp\"\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nsshd\u5468\u308a\u306e\u8a2d\u5b9a\n\u4e0a\u3067command\u306e\u8a2d\u5b9a\u3057\u305f\u304b\u3089ForceCommand\u306e\u6307\u5b9a\u306f\u8981\u3089\u306a\u304b\u3063\u305f\u304b\u3082\u2026\u2026\n\n/etc/ssh/sshd_config\n# Example of overriding settings on a per-user basis\n#Match User anoncvs\n#       X11Forwarding no\n#       AllowTcpForwarding no\n#       ForceCommand cvs server\n\nMatch User username\n       X11Forwarding no\n       AllowTcpForwarding no\n       ForceCommand internal-sftp\n\n\nChrootDirectory\u3082\u6307\u5b9a\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u304b\u306a\u3002\n\nsshd\u306e\u518d\u8d77\u52d5\n# service sshd restart\n\nsshd\u3092\u518d\u8d77\u52d5\u3057\u3066\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\u3002\n\n\u78ba\u8a8d\n\nTerminal\n$ sftp -o IdentityFile=/path/to/private-key -P port username@ipaddr\nConnected to ipaddr.\nsftp>\n\n\nSFTP\u3067\u63a5\u7d9a\u3067\u304d\u305f\u3002\n\nTerminal\n$ ssh -o IdentityFile=/path/to/private-key -p port username@ipaddr\nThis service allows sftp connections only.\nConnection to ipaddr closed.\n\n\nSSH\u3060\u3068\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u305f\u3002\n\u3053\u308c\u3067SFTP\u7528\u306e\u30e6\u30fc\u30b6\u304c\u3067\u304d\u308b\u306f\u305a\u3002\nSFTP\u7528\u30e6\u30fc\u30b6\u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u305d\u308c\u3092\u4f5c\u308b\u30e1\u30e2\u3067\u3059\u3002\n\n## \u3068\u308a\u3042\u3048\u305a\u78ba\u8a8d\n\n```console:Terminal\n$ less /etc/group\n$ less /etc/passwd\n```\n\n\u306a\u3093\u304b\u307e\u3042\u3001\u30b0\u30eb\u30fc\u30d7\u3068\u304b\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\u3002\n\n## \u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n```console:Terminal\n# groupadd username\n# useradd -d /home/username -g username username\n```\n\nSFTP\u7528\u30e6\u30fc\u30b6\u3068SFTP\u7528\u30e6\u30fc\u30b6\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\n# mktemp -u XXXXXXXX\n# passwd username\n```\n\n\u521d\u671f\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6307\u5b9a\u3092\u3059\u308b\u306e\u306b`mkpasswd`\u3068\u304b\u3044\u3046\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u3089\u3057\u3044\u306e\u3060\u3051\u3069\u3001\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u306e\u3067`mktemp`\u3067\u4ee3\u7528\u3057\u305f\u2026\u2026\uff08\u3044\u3044\u306e\u304b\u306a\u3053\u308c\uff09\n\n```\n# mkdir -p /home/username/.ssh\n# touch /home/username/.ssh/authorized_keys\n# chmod 0700 /home/username/.ssh\n# chmod 0600 /home/username/.ssh/authorized_keys\n```\n\n\u3042\u3068\u306f`.ssh`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u304b\u4f5c\u3063\u305f\u308a\u3068\u304b\u3002`authorized_keys`\u306b\u9375\u306e\u8ffd\u52a0\u3082\u3057\u3066\u304a\u304f\u3002\n\n## SSH\u30ed\u30b0\u30a4\u30f3\u6642\u306e\u30b3\u30de\u30f3\u30c9\u6307\u5b9a\n\nusername\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3068\u304d\u306b\u6700\u521d\u306b\u5b9f\u884c\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u6307\u5b9a\u3059\u308b\u3002`authorized_keys`\u306e\u5148\u982d\u306b\u66f8\u3051\u3070\u826f\u3044\u307f\u305f\u3044\u3002\n\n```\n# vi /home/username/.ssh/authorized_keys\n```\n\n```diff:~username/.ssh/authorized_keys\n-ssh-rsa ...\n+command=\"internal-sftp\" ssh-rsa ...\n```\n\n`authoriezed_keys`\u306e\u8ffd\u52a0\u3057\u305f\u9375\u306e\u884c\u306e\u5148\u982d\u306b`command=\"internal-sftp\" `\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n## sshd\u5468\u308a\u306e\u8a2d\u5b9a\n\n\u4e0a\u3067`command`\u306e\u8a2d\u5b9a\u3057\u305f\u304b\u3089ForceCommand\u306e\u6307\u5b9a\u306f\u8981\u3089\u306a\u304b\u3063\u305f\u304b\u3082\u2026\u2026\n\n```conf:/etc/ssh/sshd_config\n# Example of overriding settings on a per-user basis\n#Match User anoncvs\n#       X11Forwarding no\n#       AllowTcpForwarding no\n#       ForceCommand cvs server\n\nMatch User username\n       X11Forwarding no\n       AllowTcpForwarding no\n       ForceCommand internal-sftp\n```\n\n`ChrootDirectory`\u3082\u6307\u5b9a\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u304b\u306a\u3002\n\n## sshd\u306e\u518d\u8d77\u52d5\n\n```\n# service sshd restart\n```\n\nsshd\u3092\u518d\u8d77\u52d5\u3057\u3066\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\u3002\n\n## \u78ba\u8a8d\n\n```console:Terminal\n$ sftp -o IdentityFile=/path/to/private-key -P port username@ipaddr\nConnected to ipaddr.\nsftp>\n```\n\nSFTP\u3067\u63a5\u7d9a\u3067\u304d\u305f\u3002\n\n```console:Terminal\n$ ssh -o IdentityFile=/path/to/private-key -p port username@ipaddr\nThis service allows sftp connections only.\nConnection to ipaddr closed.\n```\n\nSSH\u3060\u3068\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u305f\u3002\n\n\u3053\u308c\u3067SFTP\u7528\u306e\u30e6\u30fc\u30b6\u304c\u3067\u304d\u308b\u306f\u305a\u3002\n", "tags": ["CentOS", "sftp"]}