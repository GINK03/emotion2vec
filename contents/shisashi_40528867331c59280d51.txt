{"context": " More than 1 year has passed since last update.[2015/3/20 \u8272\u3005\u8abf\u3079\u3066\u5206\u304b\u3063\u305f\u5185\u5bb9\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3002\u306a\u3093\u304b\u5225\u7269\u306b\u306a\u3063\u305f]\n\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3042\u308a & \u8a8d\u8a3c\u6e08\u307f\u30da\u30fc\u30b8\u3067\u306f\u3069\u306e\u753b\u9762\u3067\u3082\u30d8\u30c3\u30c0\u90e8\u5206\u306b\u30e6\u30fc\u30b6\u540d\u3092\u8868\u793a\u3001\u307f\u305f\u3044\u306a\u3042\u308a\u304c\u3061\u306a Web \u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3068\u304d\u306e\u5b9a\u5f62\u51e6\u7406\u3092\u81ea\u52d5\u5316\u3002\n\n\u8a8d\u8a3c\u6e08\u307f\u3067 user \u3068\u3044\u3046 permission \u3092\u6301\u3063\u3066\u3044\u308b\u3068\u304d\u3060\u3051 view \u306e\u5b9f\u884c\u304c\u8a31\u53ef\u3055\u308c\u308b\u3088\u3046\u306a view_decorator \u3092\u5b9a\u7fa9\u3059\u308b\n\n\n\u540c\u69d8\u306b admin \u3068\u3044\u3046 permission \u3067\u3060\u3051 view \u306e\u5b9f\u884c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n\nrequest.user \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3067 User \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\n\n\u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b\u3060\u3051\u3001SQL \u3092\u5b9f\u884c\u3057\u3066 models.User \u3092\u691c\u7d22\n\n\n\ndef permission_view_config(permission):\n    def pvc(**params):\n        settings = dict(permission=permission, _depth=1)\n        settings.update(params)\n\n        def wrapped_view_config(original_func):\n            return view_config(**settings)(original_func)\n        return wrapped_view_config\n    return pvc\n\n\nuser_view_config = permission_view_config('user')\nadmin_view_config = permission_view_config('admin')\n\n\n__init__.py\ndef groupfinder(user_code, request):\n    if not request.user:\n        return []\n    elif request.user.is_admin:\n        return ['group:users', 'group:admin']\n    else:\n        return ['group:users']\n\n\ndef get_user(request):\n    user_id = unauthenticated_userid(request)\n    if user_id is not None:\n        return DBSession.query(User).get(user_id)\n\n\nclass RootFactory(object):\n    __acl__ = [\n        (Allow, 'group:users', 'user'),\n        (Allow, 'group:admin', 'admin')\n    ]\n\n    def __init__(self, request):\n        pass\n\n\ndef main(global_config, **settings):\n    # ...\n    config = Configurator(settings=settings, root_factory='.RootFactory')\n\n    # request \u306e user \u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089 get_user \u3057\u3066\u306d\u3001\u3068\u3044\u3046\u6307\u5b9a\u3002\u3053\u308c\u91cd\u8981\u3002\n    config.set_request_property(get_user, 'user', reify=True)\n\n    authn_policy = AuthTktAuthenticationPolicy('...', callback=groupfinder, hashalg='sha512')\n    authz_policy = ACLAuthorizationPolicy()\n    config.set_authentication_policy(authn_policy)\n    config.set_authorization_policy(authz_policy)\n    # ...\n\n\n\u3053\u3093\u306a\u98a8\u306b\u4f7f\u3048\u3070\n\nviews.py\n@user_view_config(route_name='index', renderer='templates/index.jinja2')\ndef index(request):\n    # \u3053\u3053\u306f user \u306e permission \u3092\u6301\u3063\u3066\u3044\u308b\u4eba\u3060\u3051\n    do_something_with(request.user)  # user \u304c\u4f7f\u3048\u308b\n    return {'name': 'my_app'}\n\n@admin_view_config(route_name='index', renderer='templates/add_user.jinja2')\ndef add_user(request):\n    # \u3053\u3053\u306f admin \u306e permission \u3092\u6301\u3063\u3066\u3044\u308b\u4eba\u3060\u3051\n    do_something_with(request.user)  # user \u304c\u4f7f\u3048\u308b\n    return {'name': 'my_app'}\n\n\ninspired by Pyramid \u3067\u30ab\u30b9\u30bf\u30e0\u306e View Decorator \u3092\u5b9f\u88c5\u3059\u308b\n[2015/3/20 \u8272\u3005\u8abf\u3079\u3066\u5206\u304b\u3063\u305f\u5185\u5bb9\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3002\u306a\u3093\u304b\u5225\u7269\u306b\u306a\u3063\u305f]\n\n\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3042\u308a & \u8a8d\u8a3c\u6e08\u307f\u30da\u30fc\u30b8\u3067\u306f\u3069\u306e\u753b\u9762\u3067\u3082\u30d8\u30c3\u30c0\u90e8\u5206\u306b\u30e6\u30fc\u30b6\u540d\u3092\u8868\u793a\u3001\u307f\u305f\u3044\u306a\u3042\u308a\u304c\u3061\u306a Web \u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3068\u304d\u306e\u5b9a\u5f62\u51e6\u7406\u3092\u81ea\u52d5\u5316\u3002\n\n- \u8a8d\u8a3c\u6e08\u307f\u3067 user \u3068\u3044\u3046 permission \u3092\u6301\u3063\u3066\u3044\u308b\u3068\u304d\u3060\u3051 view \u306e\u5b9f\u884c\u304c\u8a31\u53ef\u3055\u308c\u308b\u3088\u3046\u306a view_decorator \u3092\u5b9a\u7fa9\u3059\u308b\n  - \u540c\u69d8\u306b admin \u3068\u3044\u3046 permission \u3067\u3060\u3051 view \u306e\u5b9f\u884c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n- request.user \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3067 User \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n  - \u6700\u521d\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b\u3060\u3051\u3001SQL \u3092\u5b9f\u884c\u3057\u3066 models.User \u3092\u691c\u7d22\n\n```py\ndef permission_view_config(permission):\n    def pvc(**params):\n        settings = dict(permission=permission, _depth=1)\n        settings.update(params)\n\n        def wrapped_view_config(original_func):\n            return view_config(**settings)(original_func)\n        return wrapped_view_config\n    return pvc\n\n\nuser_view_config = permission_view_config('user')\nadmin_view_config = permission_view_config('admin')\n```\n\n```__init__.py\ndef groupfinder(user_code, request):\n    if not request.user:\n        return []\n    elif request.user.is_admin:\n        return ['group:users', 'group:admin']\n    else:\n        return ['group:users']\n\n\ndef get_user(request):\n    user_id = unauthenticated_userid(request)\n    if user_id is not None:\n        return DBSession.query(User).get(user_id)\n\n\nclass RootFactory(object):\n    __acl__ = [\n        (Allow, 'group:users', 'user'),\n        (Allow, 'group:admin', 'admin')\n    ]\n\n    def __init__(self, request):\n        pass\n\n\ndef main(global_config, **settings):\n    # ...\n    config = Configurator(settings=settings, root_factory='.RootFactory')\n\n    # request \u306e user \u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089 get_user \u3057\u3066\u306d\u3001\u3068\u3044\u3046\u6307\u5b9a\u3002\u3053\u308c\u91cd\u8981\u3002\n    config.set_request_property(get_user, 'user', reify=True)\n\n    authn_policy = AuthTktAuthenticationPolicy('...', callback=groupfinder, hashalg='sha512')\n    authz_policy = ACLAuthorizationPolicy()\n    config.set_authentication_policy(authn_policy)\n    config.set_authorization_policy(authz_policy)\n    # ...\n```\n\n\u3053\u3093\u306a\u98a8\u306b\u4f7f\u3048\u3070\n\n```views.py\n@user_view_config(route_name='index', renderer='templates/index.jinja2')\ndef index(request):\n    # \u3053\u3053\u306f user \u306e permission \u3092\u6301\u3063\u3066\u3044\u308b\u4eba\u3060\u3051\n    do_something_with(request.user)  # user \u304c\u4f7f\u3048\u308b\n    return {'name': 'my_app'}\n\n@admin_view_config(route_name='index', renderer='templates/add_user.jinja2')\ndef add_user(request):\n    # \u3053\u3053\u306f admin \u306e permission \u3092\u6301\u3063\u3066\u3044\u308b\u4eba\u3060\u3051\n    do_something_with(request.user)  # user \u304c\u4f7f\u3048\u308b\n    return {'name': 'my_app'}\n```\n\ninspired by [Pyramid \u3067\u30ab\u30b9\u30bf\u30e0\u306e View Decorator \u3092\u5b9f\u88c5\u3059\u308b](http://qiita.com/ledmonster/items/60f778fa171e149bc988)\n", "tags": ["Python", "pyramid"]}