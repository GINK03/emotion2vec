{"context": "\u3053\u3093\u306b\u3061\u306f\u3001\u4e45\u3057\u3076\u308a\u306b\u30d6\u30ed\u30b0\u3092\u66f8\u304f@kenmatsu4\u3067\u3059\u3002\nStan Advent Calendar\u306e23\u65e5\u76ee\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306e\u30d6\u30ed\u30b0\u3067\u306f\u3001Graphical Lasso\u3068\u3044\u3046\u3001L1\u6b63\u5247\u5316\u3092\u304b\u3051\u305f\u7cbe\u5ea6\u884c\u5217(\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u9006\u884c\u5217)\u3092\u63a8\u5b9a\u3059\u308b\u624b\u6cd5\u3092Stan\u3092\u7528\u3044\u3066\u3084\u3063\u3066\u307f\u3088\u3046\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\u30b3\u30fc\u30c9\u306e\u5168\u6587\u306fGitHub\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n\n1. \u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\u306e\u751f\u6210\n\u307e\u305a\u3001\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306b\u5f93\u3046\u4e71\u6570\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306a\u5e73\u5747\u3001\u5206\u6563\u3092\u3082\u3064\uff16\u6b21\u5143\u306e\u30c7\u30fc\u30bf\u3092300\u500b\u751f\u6210\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u7121\u7406\u3084\u308ax6x6x_6\u3068x4x4x_4\u3001\u3055\u3089\u306bx6x6x_6\u3068x5x5x_5\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u3001x4x4x_4\u3068x5x5x_5\u304c\u9593\u63a5\u76f8\u95a2\u3092\u6301\u3064\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3082\u3068\u3082\u3068x4x4x_4\u3068x5x5x_5\u304c\u306a\u304b\u3063\u305f\u3082\u306e\u306e\u3001x6x6x_6\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3066x6x6x_6\u306e\u5909\u52d5\u3068\u9023\u52d5\u3057\u3066x4x4x_4\u3068x5x5x_5\u306e\u5024\u3082\u52d5\u304f\u306e\u3067\u672c\u6765\u76f8\u95a2\u304c\u306a\u3044\u5909\u6570\u540c\u58eb\u304c\u76f8\u95a2\u3092\u6301\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u307f\u3048\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\u2190(*)\u306e\u7b87\u6240\n\npython\n    m = np.zeros(M)\n    # \u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306e\u4e71\u6570\u751f\u6210\u7528\u306e\u5171\u5206\u6563\u884c\u5217\n    cov = [[   1, .29, .49, .10, .30,  0],\n           [ .29,   1,-.49, .49, .40,  0],\n           [ .49,-.49,   1,   0,   0,  0],\n           [ .10, .49,   0,   1,   0,  0],\n           [ .30, .40,   0,   0,   1,  0],\n           [   0,   0,   0,   0,   0,  1]]\n\n    # 6\u3064\u306e\u5909\u6570\u3092\u4f5c\u6210\n    X = st.multivariate_normal.rvs(mean=m, cov=cov, size=size, random_state=random_state)\n\n    # x4\u3068x6\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u308b\uff08*\uff09\n    X[:,3] += 0.6*X[:,5]\n\n    # x5\u3068x6\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u308b\uff08*\uff09\n    X[:,4] += 0.6*X[:,5]\n\n\n\u56f3\uff1a\u9593\u63a5\u76f8\u95a2\u306e\u30a4\u30e1\u30fc\u30b8\n\n\u5f97\u3089\u308c\u305f\u30c7\u30fc\u30bf\u3092pairplot\u3067\u6563\u5e03\u56f3\u3092\u66f8\u304f\u3068\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u76f8\u95a2\u884c\u5217\u3068\u3001\u504f\u76f8\u95a2\u884c\u5217\u3092\u7b97\u51fa\u3059\u308b\u3068\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\u504f\u76f8\u95a2\u3068\u306f\u3001\u5148\u307b\u3069\u306e\u56f3\u306b\u3042\u3063\u305f\u3088\u3046\u306a\u9593\u63a5\u76f8\u95a2\u306e\u52b9\u679c\u3092\u9664\u304d\u3001\u76f4\u63a5\u7684\u306a\u76f8\u95a2\u304c\u3069\u306e\u7a0b\u5ea6\u304b\u3092\u8868\u3059\u5024\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u65e9\u901f\u3001\u504f\u76f8\u95a2\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u504f\u76f8\u95a2\u884c\u5217\u306f\u7cbe\u5ea6\u884c\u5217\uff08\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u9006\u884c\u5217\uff09\u039b\u039b\\Lambda\u306e\u8981\u7d20\u03bbij\u03bbij\\lambda_{ij}\u3092\u4f7f\u3063\u3066\u8868\u3059\u3068\n\\hat{\\rho}_{ij} = {-\\lambda_{ij} \\over \\sqrt{\\lambda_{ii}\\lambda_{jj}}}\n\u02c6\u03c1ij=\u2212\u03bbij\u221a\u03bbii\u03bbjj\u03c1^ij=\u2212\u03bbij\u03bbii\u03bbjj\u2212\u2212\u2212\u2212\u2212\u221a{\\hat{\\rho}_{ij} = {-\\lambda_{ij} \\over \\sqrt{\\lambda_{ii}\\lambda_{jj}}}\n}\n\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u53f3\u304c\u504f\u76f8\u95a2\u884c\u5217\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u304b\u3089\u7d20\u76f4\u306b\u7b97\u51fa\u3057\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3092\u4f7f\u3063\u3066\u8a08\u7b97\u3059\u308b\u3068\u30ce\u30a4\u30ba\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3066\u3057\u307e\u3044\u3001\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u5024\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3042\u307e\u308a\u30c7\u30fc\u30bf\u306e\u69cb\u9020\u304c\u898b\u3048\u3066\u3044\u308b\u3088\u3046\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5168\u90e8\u306e\u5909\u6570\u304c\u95a2\u4fc2\u3057\u5408\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u3082\u898b\u3048\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u306d\u30fb\u30fb\u30fb\u3002\u305d\u3093\u306a\u306f\u305a\u306f\u306a\u3044\u3093\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001\u30ce\u30a4\u30ba\u306e\u5f71\u97ff\u3092L1\u6b63\u5247\u5316\u3001\u3064\u307e\u308aLasso\u3092\u7528\u3044\u3066\u9664\u5916\u3057\u3001\u63a8\u5b9a\u3057\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3001\u7cbe\u5ea6\u884c\u5217\u3092\u4f7f\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n2. Graphical Lasso\n\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u3092\u60f3\u5b9a\u3057\u305f\u30de\u30eb\u30b3\u30d5\u30b0\u30e9\u30d5\u3092\u30ac\u30a6\u30b9\u578b\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u547c\u3073\u3001\u3053\u306e\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u3042\u308b\u7cbe\u5ea6\u884c\u5217\u039b\u039b\\Lambda\u3092\u7528\u3044\u3066\u5909\u6570\u306e\u95a2\u4fc2\u6027\u3092\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u7cbe\u5ea6\u884c\u5217\u306ei,j\u8981\u7d20\u03bbij\u03bbij\\lambda_{ij}\u304c0\u3067\u306a\u3044\u5834\u5408\u3001xixix_i\u3068xjxjx_j\u3068\u306e\u9593\u306b\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u72b6\u614b\u306e\u3082\u306e\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30b0\u30e9\u30d5\u3067\u8868\u73fe\u3057\u3001\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u547c\u3073\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bfxx\\boldsymbol{x}\u304c\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306b\u5f93\u3046\u3068\u3059\u308b\u3068\u3001\u305d\u306e\u5206\u5e03\u306f\n\\mathcal{N}(\\boldsymbol{x} | {\\bf 0}, \\Lambda^{-1}) \\sim {|\\Lambda|^{1/2} \\over (2\\pi)^{M/2}} \\exp\\left( -{1 \\over 2} \\boldsymbol{x}^\\intercal \\Lambda \\boldsymbol{x} \\right)\nN(x|0,\u039b\u22121)\u223c|\u039b|1/2(2\u03c0)M/2exp(\u221212x\u22ba\u039bx){\\mathcal{N}(\\boldsymbol{x} | {\\bf 0}, \\Lambda^{-1}) \\sim {|\\Lambda|^{1/2} \\over (2\\pi)^{M/2}} \\exp\\left( -{1 \\over 2} \\boldsymbol{x}^\\intercal \\Lambda \\boldsymbol{x} \\right)\n}\n\u3068\u8868\u305b\u307e\u3059\u3002\u305f\u3060\u3057\u3053\u306e\u307e\u307e\u3060\u3068\uff10\u4ee5\u5916\u306e\u5024\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308b\u3068\u307f\u306a\u3059\u3053\u3068\u306b\u3057\u305f\u306e\u3067\u3001\u5927\u4f53\u306e\u63a8\u5b9a\u7d50\u679c\u306f\u30ce\u30a4\u30ba\u304c\u4e57\u308b\u3053\u3068\u3082\u8003\u3048\u308b\u3068\u5148\u307b\u3069\u306e\u30b0\u30e9\u30d5\u69cb\u9020\u306f\u307b\u3068\u3093\u3069\u306e\u5909\u6570\u9593\u306b\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u306a\u308b\u3079\u304f\u30b9\u30d1\u30fc\u30b9\u306a\u7cbe\u5ea6\u884c\u5217\u3092\u6c42\u3081\u3089\u308c\u308b\u3088\u3046\u5de5\u592b\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u7cbe\u5ea6\u884c\u5217\u039b\\Lambda\u306b\u30e9\u30d7\u30e9\u30b9\u5206\u5e03p(\u039b)p(\\Lambda)\u306e\u4e8b\u524d\u5206\u5e03\u3092\u60f3\u5b9a\u3059\u308b\u3053\u3068\u3067\u30b9\u30d1\u30fc\u30b9\u306a\u89e3\u304c\u6c42\u307e\u308a\u307e\u3059\u3002\u4e8b\u5f8c\u5206\u5e03\u306f\np(\\Lambda|\\boldsymbol{x}) \\propto p(\\Lambda)\\prod_{n=1}^{N}\\mathcal{N}(\\boldsymbol{x}^{(n)}|{\\bf 0}, \\Lambda)\np(\u039b|x)\u221dp(\u039b)N\u220fn=1N(x(n)|0,\u039b){p(\\Lambda|\\boldsymbol{x}) \\propto p(\\Lambda)\\prod_{n=1}^{N}\\mathcal{N}(\\boldsymbol{x}^{(n)}|{\\bf 0}, \\Lambda)\n}\n\u3068\u306a\u308b\u305f\u3081\u3001log\u3092\u53d6\u3063\u3066\u039b\\Lambda\u3067\u5fae\u5206\u3059\u308b\u3053\u3068\u3067\n\\ln |\\Lambda| - \\mathrm{tr}(S\\Lambda)-\\alpha\\|\\Lambda\\|_1\nln|\u039b|\u2212tr(S\u039b)\u2212\u03b1\u2225\u039b\u22251{\\ln |\\Lambda| - \\mathrm{tr}(S\\Lambda)-\\alpha\\|\\Lambda\\|_1\n}\n\u3068\u306a\u308a\u3001\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u306e\u4e8b\u524d\u5206\u5e03\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u3001L1\u6b63\u5247\u5316\u3092\u304b\u3051\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n3. Scikit-Learn\u3092\u7528\u3044\u3066Graphical Lasso\u306e\u89e3\u3092\u6c42\u3081\u308b\nScikit-Learn\u306b\u306f\u3053\u306eGraphical Lasso\u3092\u5b9f\u88c5\u3057\u305fGraphLasso\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u5ea7\u6a19\u964d\u4e0b\u6cd5\u3068\u3044\u3046\u6700\u9069\u5316\u624b\u6cd5\u304c\u7528\u3044\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305a\u306f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u5b9f\u88c5\u306f\u975e\u5e38\u306b\u7c21\u5358\u3067\u3059\u3002\u3044\u3064\u3082\u306e\u3068\u304a\u308afit\u3059\u308b\u3060\u3051\u3067\u3059 \u3059\u308b\u3068\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3068\u7cbe\u5ea6\u884c\u5217\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\npython\nalpha = 0.2 # L\uff11\u6b63\u5247\u5316\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\nmodel = GraphLasso(alpha=alpha,\n                     max_iter=100,                     \n                     verbose=True,\n                     assume_centered = True)\n\nmodel.fit(X)\ncov_ = model.covariance_ # \u5206\u6563\u5171\u5206\u6563\u884c\u5217\nprec_ = model.precision_ # \u7cbe\u5ea6\u884c\u5217\n\n\n\u5f97\u3089\u308c\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3068\u7cbe\u5ea6\u884c\u5217\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u307e\u305f\u3001\u305d\u3053\u304b\u3089\u8a08\u7b97\u3057\u305f\u76f8\u95a2\u884c\u5217\u3068\u3001\u504f\u76f8\u95a2\u884c\u5217\u304c\u4e0b\u8a18\u3067\u3059\u3002\n\u7121\u7406\u3084\u308a\u4f5c\u308a\u51fa\u3057\u305fx4,x5,x6x_4, x_5, x_6\u306e\u76f8\u95a2\u306e\u3046\u3061\u3001x4x_4\u3068x5x_5\u306e\u76f8\u95a2\u304c\u504f\u76f8\u95a2\u884c\u5217\u4e0a\u30670\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u3055\u3066\u3001\u3053\u308c\u3067\u30b9\u30d1\u30fc\u30b9\u306a\u7cbe\u5ea6\u884c\u5217\u304b\u3089\u504f\u76f8\u95a2\u884c\u5217\u3092\u6c42\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u306a\u306e\u3067\u3059\u304c\u3001\u672c\u30d6\u30ed\u30b0\u306fStan Advent Calendar 2016\u306e\u8a18\u4e8b\u3067\u3059\u3002\u305d\u3057\u3066\u3001\u5148\u307b\u3069\u3001\u3053\u306eL1\u6b63\u5247\u5316\u306f\u039b\\Lambda\u306e\u4e8b\u524d\u5206\u5e03\u306b\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u3092\u60f3\u5b9a\u3057\u305f\u3082\u306e\u3068\u89e3\u91c8\u3067\u304d\u308b\u3053\u3068\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\u305d\u3057\u305f\u3089\u3001\u3053\u308c\u3092Stan\u3067\u3084\u3063\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u306d\u3002\n\n4. Stan\u3092\u7528\u3044\u3066Graphical Lasso\u306e\u89e3\u3092\u6c42\u3081\u308b\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001stan\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3053\u306eGraphical Lasso\u3068\u540c\u3058\u3053\u3068\u3092\u3084\u3063\u3066\u307f\u307e\u3059\u3002stan\u3067\u306f\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u306fdouble exponential\u5206\u5e03\u3068\u547c\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002stan\u30b3\u30fc\u30c9\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\u3002\n\nglasso.stan\ndata {\n  int N;           // Sample size\n  int P;           // Feature size\n  matrix[N, P] X;  // Data\n  real alpha;      // scale parameter of double exponential (L1 parameter)\n}\nparameters {\n  corr_matrix[P] Lambda; // Covariance matrix\n}\nmodel {\n  vector[P] zeros;\n  for (i in 1:P) {\n     zeros[i] = 0;\n  }\n\n  // Precision matrix follows laplace distribution\n  to_vector(Lambda) ~ double_exponential(0, 1/alpha);\n\n  for (j in 1:N){\n    // X follows multi normal distribution\n    X[j] ~ multi_normal(zeros, inverse(Lambda));\n  }\n}\ngenerated quantities {\n  matrix[P, P] Sigma;\n  Sigma = inverse(Lambda);\n}\n\n\n\u3053\u308c\u3092\u547c\u3073\u51fa\u3059Python\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\npython\n%time sm = pystan.StanModel(file='glasso.stan')\nprint('Compile finished.')\n\nn_sample = 1000  # 1 chain\u3042\u305f\u308a\u306e\u30b5\u30f3\u30d7\u30eb\u6570\nn_warm   = 1000  # warm up\u306b\u4f7f\u3046\u6570\nn_chain  = 4     # chain\u6570\nstan_data = {'N': X.shape[0], 'P': P, 'X': X, 'alpha': alpha}\n%time fit = sm.sampling(data=stan_data, chains=n_chain, iter=n_sample+n_warm, warmup=n_warm)\nprint('Sampling finished.')\n\nfit\n\n\n\u7d50\u679c\u304c\u3053\u3061\u3089\u3067\u3059\u3002\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u5bfe\u89d2\u8981\u7d20\u306eRhat\u304cnan\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u8981\u6ce8\u610f\u3067\u3059\u304c\u3001\u5024\u306f\u304a\u304b\u3057\u304f\u306a\u3055\u305d\u3046\u3067\u3001\u4ed6\u306e\u8981\u7d20\u306eRhat\u306f\u5168\u30661.0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nout\nInference for Stan model: anon_model_31ac7e216f1b5eccff16f1394bd9827e.\n4 chains, each with iter=2000; warmup=1000; thin=1; \npost-warmup draws per chain=1000, total post-warmup draws=4000.\n\n              mean se_mean     sd   2.5%    25%    50%    75%  97.5%  n_eff   Rhat\nLambda[0,0]    1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan\nLambda[1,0]  -0.31  8.7e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.21   2891    1.0\nLambda[2,0]  -0.42  7.1e-4   0.04   -0.5  -0.45  -0.42  -0.39  -0.33   3735    1.0\nLambda[3,0]   0.04  1.0e-3   0.05  -0.07 2.1e-3   0.04   0.07   0.14   2808    1.0\nLambda[4,0]  -0.12  9.1e-4   0.05  -0.22  -0.15  -0.11  -0.08-9.5e-3   3437    1.0\nLambda[5,0]   0.02  1.0e-3   0.06  -0.09  -0.01   0.02   0.06   0.13   3014    1.0\nLambda[0,1]  -0.31  8.7e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.21   2891    1.0\nLambda[1,1]    1.0 1.5e-189.0e-17    1.0    1.0    1.0    1.0    1.0   3633    nan\nLambda[2,1]   0.47  6.3e-4   0.04   0.39   0.44   0.47    0.5   0.55   4000    1.0\nLambda[3,1]  -0.31  7.6e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.22   3810    1.0\nLambda[4,1]  -0.19  9.4e-4   0.05  -0.29  -0.22  -0.19  -0.15  -0.08   3021    1.0\nLambda[5,1]    0.2  8.8e-4   0.05    0.1   0.16    0.2   0.23    0.3   3395    1.0\nLambda[0,2]  -0.42  7.1e-4   0.04   -0.5  -0.45  -0.42  -0.39  -0.33   3735    1.0\nLambda[1,2]   0.47  6.3e-4   0.04   0.39   0.44   0.47    0.5   0.55   4000    1.0\nLambda[2,2]    1.0 3.6e-188.7e-17    1.0    1.0    1.0    1.0    1.0    594    nan\nLambda[3,2]  -0.11  8.9e-4   0.05  -0.22  -0.15  -0.11  -0.08  -0.01   3623    1.0\nLambda[4,2]  -0.04  9.1e-4   0.05  -0.15  -0.08  -0.04-5.8e-3   0.07   3642    1.0\nLambda[5,2]   0.03  9.0e-4   0.05  -0.08-9.2e-3   0.03   0.06   0.13   3495    1.0\nLambda[0,3]   0.04  1.0e-3   0.05  -0.07 2.1e-3   0.04   0.07   0.14   2808    1.0\nLambda[1,3]  -0.31  7.6e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.22   3810    1.0\nLambda[2,3]  -0.11  8.9e-4   0.05  -0.22  -0.15  -0.11  -0.08  -0.01   3623    1.0\nLambda[3,3]    1.0 2.0e-181.2e-16    1.0    1.0    1.0    1.0    1.0   3553    nan\nLambda[4,3]  -0.02  9.3e-4   0.06  -0.13  -0.06  -0.02   0.02   0.09   3503    1.0\nLambda[5,3]  -0.38  7.5e-4   0.04  -0.47  -0.41  -0.38  -0.35  -0.29   3591    1.0\nLambda[0,4]  -0.12  9.1e-4   0.05  -0.22  -0.15  -0.11  -0.08-9.5e-3   3437    1.0\nLambda[1,4]  -0.19  9.4e-4   0.05  -0.29  -0.22  -0.19  -0.15  -0.08   3021    1.0\nLambda[2,4]  -0.04  9.1e-4   0.05  -0.15  -0.08  -0.04-5.8e-3   0.07   3642    1.0\nLambda[3,4]  -0.02  9.3e-4   0.06  -0.13  -0.06  -0.02   0.02   0.09   3503    1.0\nLambda[4,4]    1.0 2.0e-181.2e-16    1.0    1.0    1.0    1.0    1.0   3633    nan\nLambda[5,4]  -0.36  7.2e-4   0.05  -0.45  -0.39  -0.36  -0.33  -0.27   4000    1.0\nLambda[0,5]   0.02  1.0e-3   0.06  -0.09  -0.01   0.02   0.06   0.13   3014    1.0\nLambda[1,5]    0.2  8.8e-4   0.05    0.1   0.16    0.2   0.23    0.3   3395    1.0\nLambda[2,5]   0.03  9.0e-4   0.05  -0.08-9.2e-3   0.03   0.06   0.13   3495    1.0\nLambda[3,5]  -0.38  7.5e-4   0.04  -0.47  -0.41  -0.38  -0.35  -0.29   3591    1.0\nLambda[4,5]  -0.36  7.2e-4   0.05  -0.45  -0.39  -0.36  -0.33  -0.27   4000    1.0\nLambda[5,5]    1.0 2.2e-181.3e-16    1.0    1.0    1.0    1.0    1.0   3381    nan\nSigma[0,0]    1.31  1.1e-3   0.07   1.19   1.26    1.3   1.35   1.45   3507    1.0\nSigma[1,0]    0.26  1.3e-3   0.08   0.11   0.21   0.27   0.32   0.43   4000    1.0\nSigma[2,0]    0.45  1.3e-3   0.08   0.29   0.39   0.44   0.51   0.62   4000    1.0\nSigma[3,0]     0.1  1.2e-3   0.08  -0.05   0.05    0.1   0.15   0.25   4000    1.0\nSigma[4,0]    0.23  1.2e-3   0.08   0.09   0.18   0.23   0.28   0.38   4000    1.0\nSigma[5,0]    0.03  1.2e-3   0.08  -0.13  -0.02   0.03   0.08   0.18   4000    1.0\nSigma[0,1]    0.26  1.3e-3   0.08   0.11   0.21   0.27   0.32   0.43   4000    1.0\nSigma[1,1]    1.55  1.5e-3   0.09   1.38   1.48   1.54   1.61   1.74   4000    1.0\nSigma[2,1]   -0.56  1.4e-3   0.09  -0.74  -0.62  -0.56  -0.49  -0.39   4000    1.0\nSigma[3,1]    0.41  1.3e-3   0.08   0.24   0.35    0.4   0.46   0.57   4000    1.0\nSigma[4,1]    0.29  1.3e-3   0.08   0.14   0.24   0.29   0.34   0.46   4000    1.0\nSigma[5,1]   -0.04  1.3e-3   0.08   -0.2  -0.09  -0.04   0.02   0.13   4000    1.0\nSigma[0,2]    0.45  1.3e-3   0.08   0.29   0.39   0.44   0.51   0.62   4000    1.0\nSigma[1,2]   -0.56  1.4e-3   0.09  -0.74  -0.62  -0.56  -0.49  -0.39   4000    1.0\nSigma[2,2]    1.47  1.3e-3   0.08   1.32   1.41   1.46   1.52   1.65   4000    1.0\nSigma[3,2]  2.9e-3  1.3e-3   0.08  -0.15  -0.05 1.3e-3   0.06   0.16   4000    1.0\nSigma[4,2]    0.04  1.2e-3   0.08  -0.12  -0.02   0.03   0.09   0.19   4000    1.0\nSigma[5,2]    0.07  1.3e-3   0.08  -0.08   0.02   0.08   0.13   0.23   4000    1.0\nSigma[0,3]     0.1  1.2e-3   0.08  -0.05   0.05    0.1   0.15   0.25   4000    1.0\nSigma[1,3]    0.41  1.3e-3   0.08   0.24   0.35    0.4   0.46   0.57   4000    1.0\nSigma[2,3]  2.9e-3  1.3e-3   0.08  -0.15  -0.05 1.3e-3   0.06   0.16   4000    1.0\nSigma[3,3]    1.36  1.1e-3   0.07   1.23    1.3   1.35    1.4   1.51   4000    1.0\nSigma[4,3]    0.31  1.2e-3   0.08   0.17   0.26   0.31   0.36   0.47   4000    1.0\nSigma[5,3]    0.55  1.4e-3   0.09   0.39   0.49   0.55    0.6   0.73   4000    1.0\nSigma[0,4]    0.23  1.2e-3   0.08   0.09   0.18   0.23   0.28   0.38   4000    1.0\nSigma[1,4]    0.29  1.3e-3   0.08   0.14   0.24   0.29   0.34   0.46   4000    1.0\nSigma[2,4]    0.04  1.2e-3   0.08  -0.12  -0.02   0.03   0.09   0.19   4000    1.0\nSigma[3,4]    0.31  1.2e-3   0.08   0.17   0.26   0.31   0.36   0.47   4000    1.0\nSigma[4,4]    1.29  9.9e-4   0.06   1.19   1.25   1.29   1.33   1.43   4000    1.0\nSigma[5,4]    0.53  1.3e-3   0.08   0.38   0.47   0.52   0.58    0.7   4000    1.0\nSigma[0,5]    0.03  1.2e-3   0.08  -0.13  -0.02   0.03   0.08   0.18   4000    1.0\nSigma[1,5]   -0.04  1.3e-3   0.08   -0.2  -0.09  -0.04   0.02   0.13   4000    1.0\nSigma[2,5]    0.07  1.3e-3   0.08  -0.08   0.02   0.08   0.13   0.23   4000    1.0\nSigma[3,5]    0.55  1.4e-3   0.09   0.39   0.49   0.55    0.6   0.73   4000    1.0\nSigma[4,5]    0.53  1.3e-3   0.08   0.38   0.47   0.52   0.58    0.7   4000    1.0\nSigma[5,5]    1.42  1.3e-3   0.08   1.28   1.36   1.41   1.47   1.59   4000    1.0\nlp__        -713.2    0.06   2.67 -719.3 -714.9 -712.9 -711.2 -709.0   1983    1.0\n\nSamples were drawn using NUTS at Sat Dec 24 00:05:39 2016.\nFor each parameter, n_eff is a crude measure of effective sample size,\nand Rhat is the potential scale reduction factor on split chains (at \nconvergence, Rhat=1).\n\n\n\u3053\u308c\u3060\u3051\u3060\u3068\u3061\u3087\u3063\u3068\u898b\u3065\u3089\u3044\u306e\u3067\u3001\u30b0\u30e9\u30d5\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\npython\n# \u63a8\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u53d6\u308a\u51fa\u3057\nLambda = fit.extract()[\"Lambda\"]\nSigma  = fit.extract()[\"Sigma\"]\n\n# EAP\u63a8\u5b9a\u91cf\u306e\u7b97\u51fa\nEAP_Sigma  = np.mean(Sigma, axis=0)\nEAP_Lambda = np.mean(Lambda, axis=0)\n\n# EAP\u63a8\u5b9a\u91cf\u306e\u53ef\u8996\u5316\nplt.figure(figsize=(10,4))\nax = plt.subplot(121)\nsns.heatmap(pd.DataFrame(EAP_Sigma), annot=EAP_Sigma, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Graphical Lasso with Stan: Covariance matrix\")\n\nax = plt.subplot(122)\nsns.heatmap(pd.DataFrame(EAP_Lambda), annot=EAP_Lambda, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Graphical Lasso with Stan: Precision matrix\")\nplt.savefig(img_path+\"glasso_stan_cov_prec.png\", dpi=128)\nplt.show()\n\n\n\n\npython\n# \u76f8\u95a2\u884c\u5217\u306e\u7b97\u51fa\nEAP_cor = np.empty_like(EAP_Sigma)\nfor i in range(P):\n    for j in range(P):\n        EAP_cor[i, j] = EAP_Sigma[i, j]/np.sqrt(EAP_Sigma[i, i]*EAP_Sigma[j, j])\n\n# \u504f\u76f8\u95a2\u884c\u5217\u306e\u7b97\u51fa\nEAP_rho = np.empty_like(EAP_Lambda)\nfor i in range(P):\n    for j in range(P):\n        EAP_rho[i, j] = -EAP_Lambda[i, j]/np.sqrt(EAP_Lambda[i, i]*EAP_Lambda[j, j])\n\nplt.figure(figsize=(11,4))\nax = plt.subplot(122)\nsns.heatmap(pd.DataFrame(EAP_rho), annot=EAP_rho, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Partial correlation Coefficiant with stan\")\n#plt.savefig(img_path+\"partial_corr_sklearn.png\", dpi=128)\n\nax = plt.subplot(121)\nsns.heatmap(pd.DataFrame(EAP_cor), annot=EAP_cor, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Correlation Coefficiant with stan\")\nplt.savefig(img_path+\"corr_pcorr_stan.png\", dpi=128)\nplt.show()\n\n\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u4e71\u6570\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u305f\u3081\u3001\u5b8c\u5168\u306b0\u306b\u306a\u308b\u8981\u7d20\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3046\u3044\u3063\u305f\u610f\u5473\u3067\u306f\u3042\u307e\u308aL1\u6b63\u5247\u5316\u306e\u52b9\u529b\u306fStan\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u5f97\u3089\u308c\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\n\u3053\u3061\u3089\u306f\u5148\u307b\u3069\u306eScikit-Learn\u306e\u3082\u306e\u3002\u6bd4\u8f03\u5bfe\u8c61\u7528\u3002\n\n\u3061\u3087\u3063\u3068\u5024\u304c\u9055\u3046\u306e\u3067\u3059\u304c\u3001\u4f3c\u305f\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nx4x_4\u3068x5x_5\u306e\u9593\u63a5\u76f8\u95a2\u3082\u504f\u76f8\u95a2\u884c\u5217\u3067\u306f\u3061\u3083\u3093\u3068\u6d88\u3048\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u305f\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3068Scikit-Learn\u306e\u7d50\u679c\u3092\u91cd\u306d\u305f\u3082\u306e\u3092\u4e0b\u8a18\u306b\u63cf\u753b\u3057\u307e\u3057\u305f\u3002\n\n\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u7d50\u679c\u306e\u53ef\u8996\u5316\n\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u7d50\u679c\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\n\n\u62e1\u5927\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\n\u8d64\u3044\u7dda\u304cScikit-Learn\u306e\u7d50\u679c\u3002\u70b9\u7dda\u304c\u4e8b\u5f8c\u5206\u5e03\u306e2.5%\u70b9\u3068\u300097.5%\u70b9\u3002\u5e7e\u3064\u304b\u306f\u5916\u308c\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u3053\u305d\u3053\u306e\u5272\u5408\u3067\u533a\u9593\u5185\u306b\u5165\u3063\u3066\u3044\u308b\u69d8\u5b50\u304c\u898b\u3066\u53d6\u308c\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u3060\u3044\u305f\u3044\u540c\u3058\u7d50\u679c\uff08\u5bfe\u89d2\u8981\u7d20\u3092\u9664\u304f\uff09\u3068\u8a00\u3048\u308b\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5168\u3066\u304c\u78ba\u4fe1\u533a\u9593\u306b\u5165\u3063\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nTrace Plot\n\n\n5. \u304a\u308f\u308a\u306b\nGraphical Lasso\u306eL1\u6b63\u5247\u5316\u304c\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u4e8b\u524d\u5206\u5e03\u3092Laplace\u5206\u5e03\u306b\u3057\u305f\u3082\u306e\u3060\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u77e5\u308a\u305d\u308c\u3092Stan\u3067\u8a66\u3057\u3066\u307f\u305f\u304f\u3066\u66f8\u3044\u305f\u8a18\u4e8b\u3067\u3057\u305f\u3002\u8fd1\u3057\u3044\u69cb\u9020\u306e\u504f\u76f8\u95a2\u884c\u5217\u304c\u5f97\u3089\u308c\u307e\u3057\u305f\u304c\u3001Scikit-Learn\u306e\u7d50\u679c\u3068\u30ba\u30ec\u304c\u5c11\u3057\u3042\u308b\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\n\u300c\u7570\u5e38\u691c\u77e5\u3068\u5909\u5316\u691c\u77e5\uff08\u6a5f\u68b0\u5b66\u7fd2\u30d7\u30ed\u30d5\u30a7\u30c3\u30b7\u30e7\u30ca\u30eb\u30b7\u30ea\u30fc\u30ba\uff09\u300d\u4e95\u624b\u525b\u3001\u6749\u5c71\u5c06\nStan Modeling Language User\u2019s Guide and Reference Manual\n\u3000\u21d2 http://www.uvm.edu/~bbeckage/Teaching/DataAnalysis/Manuals/stan-reference-2.8.0.pdf\n\u504f\u76f8\u95a2\u4fc2\u6570(Partial Correration Coefficient)\u3000\u3000\n\u3000\u21d2 http://www.ae.keio.ac.jp/lab/soc/takeuchi/lectures/5_Parcor.pdf\n\u3053\u3093\u306b\u3061\u306f\u3001\u4e45\u3057\u3076\u308a\u306b\u30d6\u30ed\u30b0\u3092\u66f8\u304f@kenmatsu4\u3067\u3059\u3002\n[Stan Advent Calendar](http://qiita.com/advent-calendar/2016/stan)\u306e23\u65e5\u76ee\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306e\u30d6\u30ed\u30b0\u3067\u306f\u3001Graphical Lasso\u3068\u3044\u3046\u3001L1\u6b63\u5247\u5316\u3092\u304b\u3051\u305f\u7cbe\u5ea6\u884c\u5217(\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u9006\u884c\u5217)\u3092\u63a8\u5b9a\u3059\u308b\u624b\u6cd5\u3092Stan\u3092\u7528\u3044\u3066\u3084\u3063\u3066\u307f\u3088\u3046\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\u30b3\u30fc\u30c9\u306e\u5168\u6587\u306f[GitHub](https://github.com/matsuken92/Qiita_Contents/blob/master/Advent2016_stan/Graphical_Lasso_with_Stan-Release.ipynb)\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n# 1. \u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\u306e\u751f\u6210\n\u307e\u305a\u3001\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306b\u5f93\u3046\u4e71\u6570\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306a\u5e73\u5747\u3001\u5206\u6563\u3092\u3082\u3064\uff16\u6b21\u5143\u306e\u30c7\u30fc\u30bf\u3092300\u500b\u751f\u6210\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u7121\u7406\u3084\u308a$x_6$\u3068$x_4$\u3001\u3055\u3089\u306b$x_6$\u3068$x_5$\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u3001$x_4$\u3068$x_5$\u304c\u9593\u63a5\u76f8\u95a2\u3092\u6301\u3064\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3082\u3068\u3082\u3068$x_4$\u3068$x_5$\u304c\u306a\u304b\u3063\u305f\u3082\u306e\u306e\u3001$x_6$\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3066$x_6$\u306e\u5909\u52d5\u3068\u9023\u52d5\u3057\u3066$x_4$\u3068$x_5$\u306e\u5024\u3082\u52d5\u304f\u306e\u3067\u672c\u6765\u76f8\u95a2\u304c\u306a\u3044\u5909\u6570\u540c\u58eb\u304c\u76f8\u95a2\u3092\u6301\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u307f\u3048\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\u2190(*)\u306e\u7b87\u6240\n\n```py:python\n    m = np.zeros(M)\n    # \u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306e\u4e71\u6570\u751f\u6210\u7528\u306e\u5171\u5206\u6563\u884c\u5217\n    cov = [[   1, .29, .49, .10, .30,  0],\n           [ .29,   1,-.49, .49, .40,  0],\n           [ .49,-.49,   1,   0,   0,  0],\n           [ .10, .49,   0,   1,   0,  0],\n           [ .30, .40,   0,   0,   1,  0],\n           [   0,   0,   0,   0,   0,  1]]\n\n    # 6\u3064\u306e\u5909\u6570\u3092\u4f5c\u6210\n    X = st.multivariate_normal.rvs(mean=m, cov=cov, size=size, random_state=random_state)\n\n    # x4\u3068x6\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u308b\uff08*\uff09\n    X[:,3] += 0.6*X[:,5]\n    \n    # x5\u3068x6\u306b\u76f8\u95a2\u3092\u6301\u305f\u305b\u308b\uff08*\uff09\n    X[:,4] += 0.6*X[:,5]\n```\n\n**\u56f3\uff1a\u9593\u63a5\u76f8\u95a2\u306e\u30a4\u30e1\u30fc\u30b8**\n<img width=\"340\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-23 20.43.46.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/50670/60209515-3a4a-9db6-ab76-c654a44e56ad.png\">\n\n\u5f97\u3089\u308c\u305f\u30c7\u30fc\u30bf\u3092[pairplot](http://seaborn.pydata.org/generated/seaborn.pairplot.html)\u3067\u6563\u5e03\u56f3\u3092\u66f8\u304f\u3068\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n<img width=\"854\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-23 20.48.58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/50670/789a5e80-1d84-aa5e-8155-9ee40d132d75.png\">\n\n\u76f8\u95a2\u884c\u5217\u3068\u3001\u504f\u76f8\u95a2\u884c\u5217\u3092\u7b97\u51fa\u3059\u308b\u3068\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\u504f\u76f8\u95a2\u3068\u306f\u3001\u5148\u307b\u3069\u306e\u56f3\u306b\u3042\u3063\u305f\u3088\u3046\u306a\u9593\u63a5\u76f8\u95a2\u306e\u52b9\u679c\u3092\u9664\u304d\u3001\u76f4\u63a5\u7684\u306a\u76f8\u95a2\u304c\u3069\u306e\u7a0b\u5ea6\u304b\u3092\u8868\u3059\u5024\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u65e9\u901f\u3001\u504f\u76f8\u95a2\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u504f\u76f8\u95a2\u884c\u5217\u306f\u7cbe\u5ea6\u884c\u5217\uff08\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u9006\u884c\u5217\uff09$\\Lambda$\u306e\u8981\u7d20$\\lambda_{ij}$\u3092\u4f7f\u3063\u3066\u8868\u3059\u3068\n\n```math\n\\hat{\\rho}_{ij} = {-\\lambda_{ij} \\over \\sqrt{\\lambda_{ii}\\lambda_{jj}}}\n```\n\u3068\u306a\u308a\u307e\u3059\u3002\n\n![partial_corr_est.png](https://qiita-image-store.s3.amazonaws.com/0/50670/ee9570e3-2896-4245-11f8-a6b7c280009d.png)\n\n\n\u53f3\u304c\u504f\u76f8\u95a2\u884c\u5217\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u304b\u3089\u7d20\u76f4\u306b\u7b97\u51fa\u3057\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3092\u4f7f\u3063\u3066\u8a08\u7b97\u3059\u308b\u3068\u30ce\u30a4\u30ba\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3066\u3057\u307e\u3044\u3001\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u5024\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3042\u307e\u308a\u30c7\u30fc\u30bf\u306e\u69cb\u9020\u304c\u898b\u3048\u3066\u3044\u308b\u3088\u3046\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5168\u90e8\u306e\u5909\u6570\u304c\u95a2\u4fc2\u3057\u5408\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u3082\u898b\u3048\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u306d\u30fb\u30fb\u30fb\u3002\u305d\u3093\u306a\u306f\u305a\u306f\u306a\u3044\u3093\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u3001\u30ce\u30a4\u30ba\u306e\u5f71\u97ff\u3092L1\u6b63\u5247\u5316\u3001\u3064\u307e\u308aLasso\u3092\u7528\u3044\u3066\u9664\u5916\u3057\u3001\u63a8\u5b9a\u3057\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3001\u7cbe\u5ea6\u884c\u5217\u3092\u4f7f\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# 2. Graphical Lasso\n\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u3092\u60f3\u5b9a\u3057\u305f\u30de\u30eb\u30b3\u30d5\u30b0\u30e9\u30d5\u3092\u30ac\u30a6\u30b9\u578b\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u547c\u3073\u3001\u3053\u306e\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u3042\u308b\u7cbe\u5ea6\u884c\u5217$\\Lambda$\u3092\u7528\u3044\u3066\u5909\u6570\u306e\u95a2\u4fc2\u6027\u3092\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u7cbe\u5ea6\u884c\u5217\u306ei,j\u8981\u7d20$\\lambda_{ij}$\u304c0\u3067\u306a\u3044\u5834\u5408\u3001$x_i$\u3068$x_j$\u3068\u306e\u9593\u306b\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u72b6\u614b\u306e\u3082\u306e\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30b0\u30e9\u30d5\u3067\u8868\u73fe\u3057\u3001\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u30e2\u30c7\u30eb\u3068\u547c\u3073\u307e\u3059\u3002\n\n<img width=\"321\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-23 21.26.05.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/50670/4225fd11-7096-b97a-92df-59fde21f5160.png\">\n\n\u30c7\u30fc\u30bf$\\boldsymbol{x}$\u304c\u591a\u5909\u91cf\u6b63\u898f\u5206\u5e03\u306b\u5f93\u3046\u3068\u3059\u308b\u3068\u3001\u305d\u306e\u5206\u5e03\u306f\n\n```math\n\\mathcal{N}(\\boldsymbol{x} | {\\bf 0}, \\Lambda^{-1}) \\sim {|\\Lambda|^{1/2} \\over (2\\pi)^{M/2}} \\exp\\left( -{1 \\over 2} \\boldsymbol{x}^\\intercal \\Lambda \\boldsymbol{x} \\right)\n```\n\u3068\u8868\u305b\u307e\u3059\u3002\u305f\u3060\u3057\u3053\u306e\u307e\u307e\u3060\u3068\uff10\u4ee5\u5916\u306e\u5024\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308b\u3068\u307f\u306a\u3059\u3053\u3068\u306b\u3057\u305f\u306e\u3067\u3001\u5927\u4f53\u306e\u63a8\u5b9a\u7d50\u679c\u306f\u30ce\u30a4\u30ba\u304c\u4e57\u308b\u3053\u3068\u3082\u8003\u3048\u308b\u3068\u5148\u307b\u3069\u306e\u30b0\u30e9\u30d5\u69cb\u9020\u306f\u307b\u3068\u3093\u3069\u306e\u5909\u6570\u9593\u306b\u76f4\u63a5\u76f8\u95a2\u304c\u3042\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u306a\u308b\u3079\u304f\u30b9\u30d1\u30fc\u30b9\u306a\u7cbe\u5ea6\u884c\u5217\u3092\u6c42\u3081\u3089\u308c\u308b\u3088\u3046\u5de5\u592b\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u7cbe\u5ea6\u884c\u5217$\\Lambda$\u306b\u30e9\u30d7\u30e9\u30b9\u5206\u5e03$p(\\Lambda)$\u306e\u4e8b\u524d\u5206\u5e03\u3092\u60f3\u5b9a\u3059\u308b\u3053\u3068\u3067\u30b9\u30d1\u30fc\u30b9\u306a\u89e3\u304c\u6c42\u307e\u308a\u307e\u3059\u3002\u4e8b\u5f8c\u5206\u5e03\u306f\n\n```math\np(\\Lambda|\\boldsymbol{x}) \\propto p(\\Lambda)\\prod_{n=1}^{N}\\mathcal{N}(\\boldsymbol{x}^{(n)}|{\\bf 0}, \\Lambda)\n```\n\n\u3068\u306a\u308b\u305f\u3081\u3001log\u3092\u53d6\u3063\u3066$\\Lambda$\u3067\u5fae\u5206\u3059\u308b\u3053\u3068\u3067\n\n```math\n\\ln |\\Lambda| - \\mathrm{tr}(S\\Lambda)-\\alpha\\|\\Lambda\\|_1\n```\n\n\u3068\u306a\u308a\u3001\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u306e\u4e8b\u524d\u5206\u5e03\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u3001L1\u6b63\u5247\u5316\u3092\u304b\u3051\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n# 3. Scikit-Learn\u3092\u7528\u3044\u3066Graphical Lasso\u306e\u89e3\u3092\u6c42\u3081\u308b\nScikit-Learn\u306b\u306f\u3053\u306eGraphical Lasso\u3092\u5b9f\u88c5\u3057\u305f[GraphLasso](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.GraphLasso.html#sklearn.covariance.GraphLasso)\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u5ea7\u6a19\u964d\u4e0b\u6cd5\u3068\u3044\u3046\u6700\u9069\u5316\u624b\u6cd5\u304c\u7528\u3044\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305a\u306f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u5b9f\u88c5\u306f\u975e\u5e38\u306b\u7c21\u5358\u3067\u3059\u3002\u3044\u3064\u3082\u306e\u3068\u304a\u308afit\u3059\u308b\u3060\u3051\u3067\u3059:relaxed: \u3059\u308b\u3068\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3068\u7cbe\u5ea6\u884c\u5217\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```py:python\nalpha = 0.2 # L\uff11\u6b63\u5247\u5316\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\nmodel = GraphLasso(alpha=alpha,\n                     max_iter=100,                     \n                     verbose=True,\n                     assume_centered = True)\n\nmodel.fit(X)\ncov_ = model.covariance_ # \u5206\u6563\u5171\u5206\u6563\u884c\u5217\nprec_ = model.precision_ # \u7cbe\u5ea6\u884c\u5217\n```\n\n\u5f97\u3089\u308c\u305f\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u3068\u7cbe\u5ea6\u884c\u5217\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n![glasso_cov_prec.png](https://qiita-image-store.s3.amazonaws.com/0/50670/4321ab3f-1339-b3ce-ba8f-9d16cc4c0d0c.png)\n\n\u307e\u305f\u3001\u305d\u3053\u304b\u3089\u8a08\u7b97\u3057\u305f\u76f8\u95a2\u884c\u5217\u3068\u3001\u504f\u76f8\u95a2\u884c\u5217\u304c\u4e0b\u8a18\u3067\u3059\u3002\n\u7121\u7406\u3084\u308a\u4f5c\u308a\u51fa\u3057\u305f$x_4, x_5, x_6$\u306e\u76f8\u95a2\u306e\u3046\u3061\u3001$x_4$\u3068$x_5$\u306e\u76f8\u95a2\u304c\u504f\u76f8\u95a2\u884c\u5217\u4e0a\u30670\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n![corr_pcorr_sklearn.png](https://qiita-image-store.s3.amazonaws.com/0/50670/dfd4bd51-f4d6-83f3-81ab-5f7552d8061d.png)\n\n\u3055\u3066\u3001\u3053\u308c\u3067\u30b9\u30d1\u30fc\u30b9\u306a\u7cbe\u5ea6\u884c\u5217\u304b\u3089\u504f\u76f8\u95a2\u884c\u5217\u3092\u6c42\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u306a\u306e\u3067\u3059\u304c\u3001\u672c\u30d6\u30ed\u30b0\u306fStan Advent Calendar 2016\u306e\u8a18\u4e8b\u3067\u3059\u3002\u305d\u3057\u3066\u3001\u5148\u307b\u3069\u3001\u3053\u306eL1\u6b63\u5247\u5316\u306f$\\Lambda$\u306e\u4e8b\u524d\u5206\u5e03\u306b\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u3092\u60f3\u5b9a\u3057\u305f\u3082\u306e\u3068\u89e3\u91c8\u3067\u304d\u308b\u3053\u3068\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\u305d\u3057\u305f\u3089\u3001\u3053\u308c\u3092Stan\u3067\u3084\u3063\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u306d\u3002\n\n# 4. Stan\u3092\u7528\u3044\u3066Graphical Lasso\u306e\u89e3\u3092\u6c42\u3081\u308b\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001stan\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3053\u306eGraphical Lasso\u3068\u540c\u3058\u3053\u3068\u3092\u3084\u3063\u3066\u307f\u307e\u3059\u3002stan\u3067\u306f\u30e9\u30d7\u30e9\u30b9\u5206\u5e03\u306fdouble exponential\u5206\u5e03\u3068\u547c\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002stan\u30b3\u30fc\u30c9\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\u3002\n\n```stan:glasso.stan\ndata {\n  int N;           // Sample size\n  int P;           // Feature size\n  matrix[N, P] X;  // Data\n  real alpha;      // scale parameter of double exponential (L1 parameter)\n}\nparameters {\n  corr_matrix[P] Lambda; // Covariance matrix\n}\nmodel {\n  vector[P] zeros;\n  for (i in 1:P) {\n     zeros[i] = 0;\n  }\n  \n  // Precision matrix follows laplace distribution\n  to_vector(Lambda) ~ double_exponential(0, 1/alpha);\n  \n  for (j in 1:N){\n    // X follows multi normal distribution\n    X[j] ~ multi_normal(zeros, inverse(Lambda));\n  }\n}\ngenerated quantities {\n  matrix[P, P] Sigma;\n  Sigma = inverse(Lambda);\n}\n```\n\n\u3053\u308c\u3092\u547c\u3073\u51fa\u3059Python\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n```py:python\n%time sm = pystan.StanModel(file='glasso.stan')\nprint('Compile finished.')\n\nn_sample = 1000  # 1 chain\u3042\u305f\u308a\u306e\u30b5\u30f3\u30d7\u30eb\u6570\nn_warm   = 1000  # warm up\u306b\u4f7f\u3046\u6570\nn_chain  = 4     # chain\u6570\nstan_data = {'N': X.shape[0], 'P': P, 'X': X, 'alpha': alpha}\n%time fit = sm.sampling(data=stan_data, chains=n_chain, iter=n_sample+n_warm, warmup=n_warm)\nprint('Sampling finished.')\n\nfit\n```\n\u7d50\u679c\u304c\u3053\u3061\u3089\u3067\u3059\u3002\u5206\u6563\u5171\u5206\u6563\u884c\u5217\u306e\u5bfe\u89d2\u8981\u7d20\u306eRhat\u304cnan\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u8981\u6ce8\u610f\u3067\u3059\u304c\u3001\u5024\u306f\u304a\u304b\u3057\u304f\u306a\u3055\u305d\u3046\u3067\u3001\u4ed6\u306e\u8981\u7d20\u306eRhat\u306f\u5168\u30661.0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```:out\nInference for Stan model: anon_model_31ac7e216f1b5eccff16f1394bd9827e.\n4 chains, each with iter=2000; warmup=1000; thin=1; \npost-warmup draws per chain=1000, total post-warmup draws=4000.\n\n              mean se_mean     sd   2.5%    25%    50%    75%  97.5%  n_eff   Rhat\nLambda[0,0]    1.0     0.0    0.0    1.0    1.0    1.0    1.0    1.0   4000    nan\nLambda[1,0]  -0.31  8.7e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.21   2891    1.0\nLambda[2,0]  -0.42  7.1e-4   0.04   -0.5  -0.45  -0.42  -0.39  -0.33   3735    1.0\nLambda[3,0]   0.04  1.0e-3   0.05  -0.07 2.1e-3   0.04   0.07   0.14   2808    1.0\nLambda[4,0]  -0.12  9.1e-4   0.05  -0.22  -0.15  -0.11  -0.08-9.5e-3   3437    1.0\nLambda[5,0]   0.02  1.0e-3   0.06  -0.09  -0.01   0.02   0.06   0.13   3014    1.0\nLambda[0,1]  -0.31  8.7e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.21   2891    1.0\nLambda[1,1]    1.0 1.5e-189.0e-17    1.0    1.0    1.0    1.0    1.0   3633    nan\nLambda[2,1]   0.47  6.3e-4   0.04   0.39   0.44   0.47    0.5   0.55   4000    1.0\nLambda[3,1]  -0.31  7.6e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.22   3810    1.0\nLambda[4,1]  -0.19  9.4e-4   0.05  -0.29  -0.22  -0.19  -0.15  -0.08   3021    1.0\nLambda[5,1]    0.2  8.8e-4   0.05    0.1   0.16    0.2   0.23    0.3   3395    1.0\nLambda[0,2]  -0.42  7.1e-4   0.04   -0.5  -0.45  -0.42  -0.39  -0.33   3735    1.0\nLambda[1,2]   0.47  6.3e-4   0.04   0.39   0.44   0.47    0.5   0.55   4000    1.0\nLambda[2,2]    1.0 3.6e-188.7e-17    1.0    1.0    1.0    1.0    1.0    594    nan\nLambda[3,2]  -0.11  8.9e-4   0.05  -0.22  -0.15  -0.11  -0.08  -0.01   3623    1.0\nLambda[4,2]  -0.04  9.1e-4   0.05  -0.15  -0.08  -0.04-5.8e-3   0.07   3642    1.0\nLambda[5,2]   0.03  9.0e-4   0.05  -0.08-9.2e-3   0.03   0.06   0.13   3495    1.0\nLambda[0,3]   0.04  1.0e-3   0.05  -0.07 2.1e-3   0.04   0.07   0.14   2808    1.0\nLambda[1,3]  -0.31  7.6e-4   0.05   -0.4  -0.34  -0.31  -0.28  -0.22   3810    1.0\nLambda[2,3]  -0.11  8.9e-4   0.05  -0.22  -0.15  -0.11  -0.08  -0.01   3623    1.0\nLambda[3,3]    1.0 2.0e-181.2e-16    1.0    1.0    1.0    1.0    1.0   3553    nan\nLambda[4,3]  -0.02  9.3e-4   0.06  -0.13  -0.06  -0.02   0.02   0.09   3503    1.0\nLambda[5,3]  -0.38  7.5e-4   0.04  -0.47  -0.41  -0.38  -0.35  -0.29   3591    1.0\nLambda[0,4]  -0.12  9.1e-4   0.05  -0.22  -0.15  -0.11  -0.08-9.5e-3   3437    1.0\nLambda[1,4]  -0.19  9.4e-4   0.05  -0.29  -0.22  -0.19  -0.15  -0.08   3021    1.0\nLambda[2,4]  -0.04  9.1e-4   0.05  -0.15  -0.08  -0.04-5.8e-3   0.07   3642    1.0\nLambda[3,4]  -0.02  9.3e-4   0.06  -0.13  -0.06  -0.02   0.02   0.09   3503    1.0\nLambda[4,4]    1.0 2.0e-181.2e-16    1.0    1.0    1.0    1.0    1.0   3633    nan\nLambda[5,4]  -0.36  7.2e-4   0.05  -0.45  -0.39  -0.36  -0.33  -0.27   4000    1.0\nLambda[0,5]   0.02  1.0e-3   0.06  -0.09  -0.01   0.02   0.06   0.13   3014    1.0\nLambda[1,5]    0.2  8.8e-4   0.05    0.1   0.16    0.2   0.23    0.3   3395    1.0\nLambda[2,5]   0.03  9.0e-4   0.05  -0.08-9.2e-3   0.03   0.06   0.13   3495    1.0\nLambda[3,5]  -0.38  7.5e-4   0.04  -0.47  -0.41  -0.38  -0.35  -0.29   3591    1.0\nLambda[4,5]  -0.36  7.2e-4   0.05  -0.45  -0.39  -0.36  -0.33  -0.27   4000    1.0\nLambda[5,5]    1.0 2.2e-181.3e-16    1.0    1.0    1.0    1.0    1.0   3381    nan\nSigma[0,0]    1.31  1.1e-3   0.07   1.19   1.26    1.3   1.35   1.45   3507    1.0\nSigma[1,0]    0.26  1.3e-3   0.08   0.11   0.21   0.27   0.32   0.43   4000    1.0\nSigma[2,0]    0.45  1.3e-3   0.08   0.29   0.39   0.44   0.51   0.62   4000    1.0\nSigma[3,0]     0.1  1.2e-3   0.08  -0.05   0.05    0.1   0.15   0.25   4000    1.0\nSigma[4,0]    0.23  1.2e-3   0.08   0.09   0.18   0.23   0.28   0.38   4000    1.0\nSigma[5,0]    0.03  1.2e-3   0.08  -0.13  -0.02   0.03   0.08   0.18   4000    1.0\nSigma[0,1]    0.26  1.3e-3   0.08   0.11   0.21   0.27   0.32   0.43   4000    1.0\nSigma[1,1]    1.55  1.5e-3   0.09   1.38   1.48   1.54   1.61   1.74   4000    1.0\nSigma[2,1]   -0.56  1.4e-3   0.09  -0.74  -0.62  -0.56  -0.49  -0.39   4000    1.0\nSigma[3,1]    0.41  1.3e-3   0.08   0.24   0.35    0.4   0.46   0.57   4000    1.0\nSigma[4,1]    0.29  1.3e-3   0.08   0.14   0.24   0.29   0.34   0.46   4000    1.0\nSigma[5,1]   -0.04  1.3e-3   0.08   -0.2  -0.09  -0.04   0.02   0.13   4000    1.0\nSigma[0,2]    0.45  1.3e-3   0.08   0.29   0.39   0.44   0.51   0.62   4000    1.0\nSigma[1,2]   -0.56  1.4e-3   0.09  -0.74  -0.62  -0.56  -0.49  -0.39   4000    1.0\nSigma[2,2]    1.47  1.3e-3   0.08   1.32   1.41   1.46   1.52   1.65   4000    1.0\nSigma[3,2]  2.9e-3  1.3e-3   0.08  -0.15  -0.05 1.3e-3   0.06   0.16   4000    1.0\nSigma[4,2]    0.04  1.2e-3   0.08  -0.12  -0.02   0.03   0.09   0.19   4000    1.0\nSigma[5,2]    0.07  1.3e-3   0.08  -0.08   0.02   0.08   0.13   0.23   4000    1.0\nSigma[0,3]     0.1  1.2e-3   0.08  -0.05   0.05    0.1   0.15   0.25   4000    1.0\nSigma[1,3]    0.41  1.3e-3   0.08   0.24   0.35    0.4   0.46   0.57   4000    1.0\nSigma[2,3]  2.9e-3  1.3e-3   0.08  -0.15  -0.05 1.3e-3   0.06   0.16   4000    1.0\nSigma[3,3]    1.36  1.1e-3   0.07   1.23    1.3   1.35    1.4   1.51   4000    1.0\nSigma[4,3]    0.31  1.2e-3   0.08   0.17   0.26   0.31   0.36   0.47   4000    1.0\nSigma[5,3]    0.55  1.4e-3   0.09   0.39   0.49   0.55    0.6   0.73   4000    1.0\nSigma[0,4]    0.23  1.2e-3   0.08   0.09   0.18   0.23   0.28   0.38   4000    1.0\nSigma[1,4]    0.29  1.3e-3   0.08   0.14   0.24   0.29   0.34   0.46   4000    1.0\nSigma[2,4]    0.04  1.2e-3   0.08  -0.12  -0.02   0.03   0.09   0.19   4000    1.0\nSigma[3,4]    0.31  1.2e-3   0.08   0.17   0.26   0.31   0.36   0.47   4000    1.0\nSigma[4,4]    1.29  9.9e-4   0.06   1.19   1.25   1.29   1.33   1.43   4000    1.0\nSigma[5,4]    0.53  1.3e-3   0.08   0.38   0.47   0.52   0.58    0.7   4000    1.0\nSigma[0,5]    0.03  1.2e-3   0.08  -0.13  -0.02   0.03   0.08   0.18   4000    1.0\nSigma[1,5]   -0.04  1.3e-3   0.08   -0.2  -0.09  -0.04   0.02   0.13   4000    1.0\nSigma[2,5]    0.07  1.3e-3   0.08  -0.08   0.02   0.08   0.13   0.23   4000    1.0\nSigma[3,5]    0.55  1.4e-3   0.09   0.39   0.49   0.55    0.6   0.73   4000    1.0\nSigma[4,5]    0.53  1.3e-3   0.08   0.38   0.47   0.52   0.58    0.7   4000    1.0\nSigma[5,5]    1.42  1.3e-3   0.08   1.28   1.36   1.41   1.47   1.59   4000    1.0\nlp__        -713.2    0.06   2.67 -719.3 -714.9 -712.9 -711.2 -709.0   1983    1.0\n\nSamples were drawn using NUTS at Sat Dec 24 00:05:39 2016.\nFor each parameter, n_eff is a crude measure of effective sample size,\nand Rhat is the potential scale reduction factor on split chains (at \nconvergence, Rhat=1).\n```\n\n\u3053\u308c\u3060\u3051\u3060\u3068\u3061\u3087\u3063\u3068\u898b\u3065\u3089\u3044\u306e\u3067\u3001\u30b0\u30e9\u30d5\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n```py:python\n# \u63a8\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u53d6\u308a\u51fa\u3057\nLambda = fit.extract()[\"Lambda\"]\nSigma  = fit.extract()[\"Sigma\"]\n\n# EAP\u63a8\u5b9a\u91cf\u306e\u7b97\u51fa\nEAP_Sigma  = np.mean(Sigma, axis=0)\nEAP_Lambda = np.mean(Lambda, axis=0)\n\n# EAP\u63a8\u5b9a\u91cf\u306e\u53ef\u8996\u5316\nplt.figure(figsize=(10,4))\nax = plt.subplot(121)\nsns.heatmap(pd.DataFrame(EAP_Sigma), annot=EAP_Sigma, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Graphical Lasso with Stan: Covariance matrix\")\n\nax = plt.subplot(122)\nsns.heatmap(pd.DataFrame(EAP_Lambda), annot=EAP_Lambda, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Graphical Lasso with Stan: Precision matrix\")\nplt.savefig(img_path+\"glasso_stan_cov_prec.png\", dpi=128)\nplt.show()\n```\n\n![glasso_stan_cov_prec.png](https://qiita-image-store.s3.amazonaws.com/0/50670/5ffde1fa-3110-1e33-0ece-06f62ff8f5a2.png)\n\n\n```py:python\n# \u76f8\u95a2\u884c\u5217\u306e\u7b97\u51fa\nEAP_cor = np.empty_like(EAP_Sigma)\nfor i in range(P):\n    for j in range(P):\n        EAP_cor[i, j] = EAP_Sigma[i, j]/np.sqrt(EAP_Sigma[i, i]*EAP_Sigma[j, j])\n        \n# \u504f\u76f8\u95a2\u884c\u5217\u306e\u7b97\u51fa\nEAP_rho = np.empty_like(EAP_Lambda)\nfor i in range(P):\n    for j in range(P):\n        EAP_rho[i, j] = -EAP_Lambda[i, j]/np.sqrt(EAP_Lambda[i, i]*EAP_Lambda[j, j])\n        \nplt.figure(figsize=(11,4))\nax = plt.subplot(122)\nsns.heatmap(pd.DataFrame(EAP_rho), annot=EAP_rho, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Partial correlation Coefficiant with stan\")\n#plt.savefig(img_path+\"partial_corr_sklearn.png\", dpi=128)\n\nax = plt.subplot(121)\nsns.heatmap(pd.DataFrame(EAP_cor), annot=EAP_cor, fmt='0.2f', ax=ax, xticklabels=label, yticklabels=label)\nplt.title(\"Correlation Coefficiant with stan\")\nplt.savefig(img_path+\"corr_pcorr_stan.png\", dpi=128)\nplt.show()\n```\n\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001\u4e71\u6570\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u305f\u3081\u3001\u5b8c\u5168\u306b0\u306b\u306a\u308b\u8981\u7d20\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3046\u3044\u3063\u305f\u610f\u5473\u3067\u306f\u3042\u307e\u308aL1\u6b63\u5247\u5316\u306e\u52b9\u529b\u306fStan\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u5f97\u3089\u308c\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n![corr_pcorr_stan.png](https://qiita-image-store.s3.amazonaws.com/0/50670/4a267f10-5562-24b7-4531-57797bd8d151.png)\n\n\n\u3053\u3061\u3089\u306f\u5148\u307b\u3069\u306eScikit-Learn\u306e\u3082\u306e\u3002\u6bd4\u8f03\u5bfe\u8c61\u7528\u3002\n\n![corr_pcorr_sklearn.png](https://qiita-image-store.s3.amazonaws.com/0/50670/dfd4bd51-f4d6-83f3-81ab-5f7552d8061d.png)\n\n\u3061\u3087\u3063\u3068\u5024\u304c\u9055\u3046\u306e\u3067\u3059\u304c\u3001\u4f3c\u305f\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$x_4$\u3068$x_5$\u306e\u9593\u63a5\u76f8\u95a2\u3082\u504f\u76f8\u95a2\u884c\u5217\u3067\u306f\u3061\u3083\u3093\u3068\u6d88\u3048\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u305f\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3068Scikit-Learn\u306e\u7d50\u679c\u3092\u91cd\u306d\u305f\u3082\u306e\u3092\u4e0b\u8a18\u306b\u63cf\u753b\u3057\u307e\u3057\u305f\u3002\n\n### \u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u7d50\u679c\u306e\u53ef\u8996\u5316\n**\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u7d50\u679c\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0**\n![grid_dist_plot1.png](https://qiita-image-store.s3.amazonaws.com/0/50670/a97dced4-756d-022e-858c-7bdbfbcba9bc.png)\n\n\n\u62e1\u5927\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\n\u8d64\u3044\u7dda\u304cScikit-Learn\u306e\u7d50\u679c\u3002\u70b9\u7dda\u304c\u4e8b\u5f8c\u5206\u5e03\u306e2.5%\u70b9\u3068\u300097.5%\u70b9\u3002\u5e7e\u3064\u304b\u306f\u5916\u308c\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u3053\u305d\u3053\u306e\u5272\u5408\u3067\u533a\u9593\u5185\u306b\u5165\u3063\u3066\u3044\u308b\u69d8\u5b50\u304c\u898b\u3066\u53d6\u308c\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u3060\u3044\u305f\u3044\u540c\u3058\u7d50\u679c\uff08\u5bfe\u89d2\u8981\u7d20\u3092\u9664\u304f\uff09\u3068\u8a00\u3048\u308b\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5168\u3066\u304c\u78ba\u4fe1\u533a\u9593\u306b\u5165\u3063\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n![grid_dist_plot2.png](https://qiita-image-store.s3.amazonaws.com/0/50670/84246816-2589-eaf9-0e6d-5f40f60b1f10.png)\n\n\n**Trace Plot**\n![trace_plot.png](https://qiita-image-store.s3.amazonaws.com/0/50670/a55e8d03-e9cc-eeee-f8ae-aa2d350518f4.png)\n\n# 5. \u304a\u308f\u308a\u306b\nGraphical Lasso\u306eL1\u6b63\u5247\u5316\u304c\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u4e8b\u524d\u5206\u5e03\u3092Laplace\u5206\u5e03\u306b\u3057\u305f\u3082\u306e\u3060\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u77e5\u308a\u305d\u308c\u3092Stan\u3067\u8a66\u3057\u3066\u307f\u305f\u304f\u3066\u66f8\u3044\u305f\u8a18\u4e8b\u3067\u3057\u305f\u3002\u8fd1\u3057\u3044\u69cb\u9020\u306e\u504f\u76f8\u95a2\u884c\u5217\u304c\u5f97\u3089\u308c\u307e\u3057\u305f\u304c\u3001Scikit-Learn\u306e\u7d50\u679c\u3068\u30ba\u30ec\u304c\u5c11\u3057\u3042\u308b\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n# \u53c2\u8003\n\u300c\u7570\u5e38\u691c\u77e5\u3068\u5909\u5316\u691c\u77e5\uff08\u6a5f\u68b0\u5b66\u7fd2\u30d7\u30ed\u30d5\u30a7\u30c3\u30b7\u30e7\u30ca\u30eb\u30b7\u30ea\u30fc\u30ba\uff09\u300d\u4e95\u624b\u525b\u3001\u6749\u5c71\u5c06\nStan Modeling Language User\u2019s Guide and Reference Manual\n\u3000\u21d2 http://www.uvm.edu/~bbeckage/Teaching/DataAnalysis/Manuals/stan-reference-2.8.0.pdf\n\u504f\u76f8\u95a2\u4fc2\u6570(Partial Correration Coefficient)\u3000\u3000\n\u3000\u21d2 http://www.ae.keio.ac.jp/lab/soc/takeuchi/lectures/5_Parcor.pdf\n    \n\n\n\n\n\n\n\n\n", "tags": ["Python", "statistics", "Stan", "\u6a5f\u68b0\u5b66\u7fd2", "\u7d71\u8a08\u5b66"]}