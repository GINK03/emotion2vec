{"tags": ["kintone"], "context": "\n\nkintone \u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u306e\u95a2\u6570\u5316\n\u3088\u304f\u3042\u308b\u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u3092\u95a2\u6570\u306b\u3057\u3066\u3001\u7c21\u5358\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u96c6\u8a08\u30ad\u30fc\u3001\u96c6\u8a08\u9805\u76ee\u3068\u3082\u8907\u6570\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u96c6\u8a08\u51e6\u7406\u306f\u3001\u300cjavascript \u306e Array.reduce() \u3092\u4f7f\u3063\u3066 JSON \u30c7\u30fc\u30bf\u3092 group by (sum) \u3059\u308b\u300d \u3092\u57fa\u306b\u958b\u767a\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n\u5728\u5eab\u30a2\u30d7\u30ea\u306e\u4e00\u89a7\u8868\u793a\n\n\n\u96c6\u8a08\u51e6\u7406\u306e\u4f8b\nrecordsSummary \u95a2\u6570\u306b\u30ec\u30b3\u30fc\u30c9\u30fb\u96c6\u8a08\u30ad\u30fc\u30fb\u96c6\u8a08\u9805\u76ee\u3092\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u4e00\u89a7\u8868\u793a\u30a4\u30d9\u30f3\u30c8\u3067\u3001\u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u3059\u308b\u4f8b\u3067\u3059\u3002\n\u30fb\u5546\u54c1\u540d\u3067\u3001\u5728\u5eab\u6570\u3092\u96c6\u8a08\n\u30fb\u5009\u5eab\u5e97\u8217\u540d\u3001\u5546\u54c1\u540d\u3067\u3001\u5728\u5eab\u6570\u3068\u91d1\u984d\u3092\u96c6\u8a08\n\u203bevent.records \u306f\u3001\u8868\u793a\u30da\u30fc\u30b8\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u306a\u308a\u307e\u3059\u3002\n\u30a2\u30d7\u30ea\u306e\u30ec\u30b3\u30fc\u30c9\u5168\u4ef6\u3092\u96c6\u8a08\u3059\u308b\u5834\u5408\u306f\u3001API \u3067\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n////////////////////////////////////////////////////////////////////////////\n// kintone JavaScript: Summary of kintone records.\n//  2016.11.11 by rex0220\n////////////////////////////////////////////////////////////////////////////\n(function() {\n    \"use strict\";\n\n    // \u4e00\u89a7\u8868\u793a\n    kintone.events.on(\"app.record.index.show\", function(event) {\n        var records = event.records;\n        console.log('records',records);\n\n        var summary1 = recordsSummary(records,['\u5546\u54c1\u540d'],['\u5728\u5eab\u6570']);\n        console.log('summary1',summary1);\n\n        var summary2 = recordsSummary(records,['\u5009\u5eab\u5e97\u8217\u540d','\u5546\u54c1\u540d'],['\u5728\u5eab\u6570','\u91d1\u984d']);\n        console.log('summary2',summary2);\n\n        return event;\n    });\n\n    // \u30ec\u30b3\u30fc\u30c9\u914d\u5217\u3092\u6307\u5b9a\u306e\u30ad\u30fc\u3067\u96c6\u8a08\u3059\u308b\n    function recordsSummary(records, keys, sumKeys) {\n        var sumKeys2 = sumKeys.concat(['$count']);\n\n        var hash = records.reduce(function(res,record) {\n            // \u96c6\u8a08\u30ad\u30fc\u3092\u4f5c\u6210\n            var key = keys.reduce(function(s,k) {\n                if(s) s += '\\t';\n                s += record[k]['value'];\n                return s;\n            },'');\n            // \u521d\u3081\u3066\u306e\u96c6\u8a08\u30ad\u30fc\n            if(!(key in res)) {\n                // \u96c6\u8a08\u30ad\u30fc\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\n                var keyList = keys.reduce(function(h,k) {\n                    h[k] = record[k]['value'];\n                    return h;\n                },{});\n                // \u96c6\u8a08\u9805\u76ee\u306e\u521d\u671f\u5024\u3092\u8a2d\u5b9a\n                res[key] = sumKeys2.reduce(function(h,k) {\n                    h[k] = 0;\n                    return h;\n                }, keyList);\n            }\n            // \u30c7\u30fc\u30bf\u3092\u96c6\u8a08\uff08\u52a0\u7b97\uff09\n            sumKeys.forEach(function(k){\n                if(record[k]['value'])\n                    res[key][k] += Number(record[k]['value']);\n            });\n            res[key]['$count']++;\n\n            return res;\n        },{});\n\n        // \u30ad\u30fc\u30bd\u30fc\u30c8\n        var hashKeys = Object.keys(hash);\n        hashKeys.sort();\n\n        // \u914d\u5217\u5316\n        var summary = [];\n        for(var i in hashKeys){\n            var k = hashKeys[i];\n            if(hash.hasOwnProperty(k)){\n                summary.push(hash[k]);\n            }\n        }\n\n        return summary;\n    }\n\n})();\n\n\n\n\u96c6\u8a08\u7d50\u679c\n$count \u306f\u3001\u96c6\u8a08\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u6570\u3067\u3059\u3002\n\u5e73\u5747\u3092\u7b97\u51fa\u3059\u308b\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n#kintone \u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u306e\u95a2\u6570\u5316\n\n\u3088\u304f\u3042\u308b\u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u3092\u95a2\u6570\u306b\u3057\u3066\u3001\u7c21\u5358\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u96c6\u8a08\u30ad\u30fc\u3001\u96c6\u8a08\u9805\u76ee\u3068\u3082\u8907\u6570\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n\u96c6\u8a08\u51e6\u7406\u306f\u3001[\u300cjavascript \u306e Array.reduce() \u3092\u4f7f\u3063\u3066 JSON \u30c7\u30fc\u30bf\u3092 group by (sum) \u3059\u308b\u300d](http://qiita.com/tbtbt/items/cb9b746f099b93c1fd64) \u3092\u57fa\u306b\u958b\u767a\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n#\u5728\u5eab\u30a2\u30d7\u30ea\u306e\u4e00\u89a7\u8868\u793a\n\n![recordsSummary1.png](https://qiita-image-store.s3.amazonaws.com/0/100572/553611a4-ccfd-5f5b-d3bc-450474a27a2a.png)\n\n#\u96c6\u8a08\u51e6\u7406\u306e\u4f8b\n\nrecordsSummary \u95a2\u6570\u306b\u30ec\u30b3\u30fc\u30c9\u30fb\u96c6\u8a08\u30ad\u30fc\u30fb\u96c6\u8a08\u9805\u76ee\u3092\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\n\u4e00\u89a7\u8868\u793a\u30a4\u30d9\u30f3\u30c8\u3067\u3001\u30ec\u30b3\u30fc\u30c9\u96c6\u8a08\u3059\u308b\u4f8b\u3067\u3059\u3002\n\u30fb\u5546\u54c1\u540d\u3067\u3001\u5728\u5eab\u6570\u3092\u96c6\u8a08\n\u30fb\u5009\u5eab\u5e97\u8217\u540d\u3001\u5546\u54c1\u540d\u3067\u3001\u5728\u5eab\u6570\u3068\u91d1\u984d\u3092\u96c6\u8a08\n\n\u203bevent.records \u306f\u3001\u8868\u793a\u30da\u30fc\u30b8\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u306a\u308a\u307e\u3059\u3002\n\u30a2\u30d7\u30ea\u306e\u30ec\u30b3\u30fc\u30c9\u5168\u4ef6\u3092\u96c6\u8a08\u3059\u308b\u5834\u5408\u306f\u3001API \u3067\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\n////////////////////////////////////////////////////////////////////////////\n// kintone JavaScript: Summary of kintone records.\n//  2016.11.11 by rex0220\n////////////////////////////////////////////////////////////////////////////\n(function() {\n    \"use strict\";\n    \n    // \u4e00\u89a7\u8868\u793a\n    kintone.events.on(\"app.record.index.show\", function(event) {\n        var records = event.records;\n        console.log('records',records);\n\n        var summary1 = recordsSummary(records,['\u5546\u54c1\u540d'],['\u5728\u5eab\u6570']);\n        console.log('summary1',summary1);\n\n        var summary2 = recordsSummary(records,['\u5009\u5eab\u5e97\u8217\u540d','\u5546\u54c1\u540d'],['\u5728\u5eab\u6570','\u91d1\u984d']);\n        console.log('summary2',summary2);\n\n        return event;\n    });\n\n    // \u30ec\u30b3\u30fc\u30c9\u914d\u5217\u3092\u6307\u5b9a\u306e\u30ad\u30fc\u3067\u96c6\u8a08\u3059\u308b\n    function recordsSummary(records, keys, sumKeys) {\n        var sumKeys2 = sumKeys.concat(['$count']);\n\n        var hash = records.reduce(function(res,record) {\n            // \u96c6\u8a08\u30ad\u30fc\u3092\u4f5c\u6210\n            var key = keys.reduce(function(s,k) {\n                if(s) s += '\\t';\n                s += record[k]['value'];\n                return s;\n            },'');\n            // \u521d\u3081\u3066\u306e\u96c6\u8a08\u30ad\u30fc\n            if(!(key in res)) {\n                // \u96c6\u8a08\u30ad\u30fc\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\n                var keyList = keys.reduce(function(h,k) {\n                    h[k] = record[k]['value'];\n                    return h;\n                },{});\n                // \u96c6\u8a08\u9805\u76ee\u306e\u521d\u671f\u5024\u3092\u8a2d\u5b9a\n                res[key] = sumKeys2.reduce(function(h,k) {\n                    h[k] = 0;\n                    return h;\n                }, keyList);\n            }\n            // \u30c7\u30fc\u30bf\u3092\u96c6\u8a08\uff08\u52a0\u7b97\uff09\n            sumKeys.forEach(function(k){\n                if(record[k]['value'])\n                    res[key][k] += Number(record[k]['value']);\n            });\n            res[key]['$count']++;\n    \n            return res;\n        },{});\n\n        // \u30ad\u30fc\u30bd\u30fc\u30c8\n        var hashKeys = Object.keys(hash);\n        hashKeys.sort();\n\n        // \u914d\u5217\u5316\n        var summary = [];\n        for(var i in hashKeys){\n            var k = hashKeys[i];\n            if(hash.hasOwnProperty(k)){\n                summary.push(hash[k]);\n            }\n        }\n\n        return summary;\n    }\n\n})();\n\n```\n\n#\u96c6\u8a08\u7d50\u679c\n\n$count \u306f\u3001\u96c6\u8a08\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u6570\u3067\u3059\u3002\n\u5e73\u5747\u3092\u7b97\u51fa\u3059\u308b\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n![recordsSummary2.png](https://qiita-image-store.s3.amazonaws.com/0/100572/58ca8f6d-af80-f800-e0e3-15e9905a78c7.png)\n\n"}