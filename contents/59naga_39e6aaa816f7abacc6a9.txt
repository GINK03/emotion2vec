{"context": " More than 1 year has passed since last update.React Components\u3067DRAG\u3001SORTABLE\u306a\u3069\u3067\u691c\u7d22\u3059\u308b\u3068\u51fa\u3066\u304f\u308b\u4e2d\u3001\u661f\u304c\u4e00\u756a\u591a\u3044\u306e\u304creact-dnd\u3067\u3059\u304c\u3001\u6050\u3089\u304f\u4e00\u756a\u5c11\u306a\u3044\u30b3\u30fc\u30c9\u91cf\u3067\u3042\u308d\u3046\u300104 Sortable/Simple\u306e\u4e2d\u8eab\u304c\u306a\u304b\u306a\u304b\u798d\u3005\u3057\u304f\u3001\u304b\u3064flux\u3067\u3082\u7121\u3044\u305f\u3081\u3001\u8aad\u3080\u306e\u306b\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\n\n\u74b0\u5883\u8a2d\u5b9a\n\u3069\u3046\u3059\u308c\u3070react-dnd@2.0.2\u304c\u6700\u4f4e\u9650\u52d5\u304f\u306e\u304b\n\nview\u306baction / store\u3092\u4ed8\u4e0e\u3057\u3066\u64cd\u4f5c\u3059\u308b\nmobile\u5bfe\u5fdc\uff08\u7533\u3057\u8a33\u7a0b\u5ea6\u306e\uff09\n\n\u3092\u8003\u3048\u305f\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\u8a2d\u5b9a\n\u4ee5\u4e0b\u306epackage.json\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n{\n  \"name\": \"try-dnd\",\n  \"scripts\": {\n    \"start\": \"webpack-dev-server --port 59798 --host 0.0.0.0 --content-base dist\",\n    \"build\": \"webpack\"\n  },\n  \"dependencies\": {\n    \"react\": \"^0.14.2\",\n    \"react-addons-update\": \"^0.14.2\",\n    \"react-dnd\": \"^2.0.2\",\n    \"react-dnd-html5-backend\": \"^2.0.0\",\n    \"react-dnd-touch-backend\": \"^0.2.0\",\n    \"react-dom\": \"^0.14.2\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^5.8.33\",\n    \"babel-loader\": \"^5.3.3\",\n    \"webpack\": \"^1.12.4\",\n    \"webpack-dev-server\": \"^1.12.1\"\n  },\n  \"babel\": {\n    \"stage\": 0\n  }\n}\n\n\u4ee5\u4e0b\u306ewebpack.config.babel.js\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nimport webpack from 'webpack'\n\nexport default {\n  context: __dirname + '/src',\n  entry: {\n    javascript: './index.js',\n  },\n\n  output: {\n    path: __dirname + '/dist',\n    filename: 'bundle.js',\n  },\n\n  module: {\n    loaders: [\n      {\n        test: /\\.js$/,\n        exclude: /node_modules/,\n        loaders: ['babel-loader'],\n      },\n    ],\n  },\n\n  devtool: '#source-map',\n  plugins: [\n    // new webpack.optimize.UglifyJsPlugin({compress:{warnings:false}}),\n    new webpack.optimize.OccurenceOrderPlugin(),\n    new webpack.HotModuleReplacementPlugin(),\n    new webpack.NoErrorsPlugin()\n  ],\n}\n\n\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3067\u3042\u308bsrc\u3001\u30d3\u30eb\u30c9\u5148dist\u3092\u751f\u6210\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u306e\u78ba\u8a8d\u7528index.html\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nmkdir src dist\ntouch dist/index.html\n\n\nindex.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>react-dnd</title>\n</head>\n<body>\n\n  <script src=\"bundle.js\"></script>\n  <main></main>\n\n</body>\n</html>\n\n\nsrc/index.js\u306b\u52d5\u4f5c\u78ba\u8a8d\u7528\u306eComponent\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nsrc/index.js\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <li id={item.id} key={i}>{item.text}</li>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\naddEventListener('load',()=>{\n  ReactDOM.render(<Sortable />,document.querySelector('main'))\n})\n\n\n\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u6e96\u5099\u3067\u304d\u305f\u306e\u3067\u3001\u6700\u5f8c\u306bnpm install\u3067\u4f9d\u5b58\u3092\u89e3\u6d88\u3057\u307e\u3059\u3002\nnpm install\n# npm WARN EPACKAGEJSON ... (\u7121\u8996)\n\ntree .\n# .\n# \u251c\u2500\u2500 dist\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 index.html\n# \u251c\u2500\u2500 node_modules\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 (330 directories...)\n# \u251c\u2500\u2500 package.json\n# \u251c\u2500\u2500 src\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 index.js\n# \u2514\u2500\u2500 webpack.config.babel.js\n\nnpm start\u3067\u958b\u767a\u7528\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001http://localhost:59798/webpack-dev-server/ \u3067src/index.js\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u7d50\u679c\u3092index.html\u7d4c\u7531\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u8868\u793a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001\u3053\u306eli\u8981\u7d20\u306b\u4e26\u3073\u66ff\u3048\u306e\u8981\u7d20\u3092\u52a0\u3048\u3066\u3044\u304f\u624b\u9806\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3069\u3046\u3059\u308c\u3070react-dnd@2.0.2\u304c\u6700\u4f4e\u9650\u52d5\u304f\u306e\u304b\n\u307e\u305a\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fSortable\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306bDecorator\u69cb\u6587\u3067DragDropContext(ReactDnDHTML5Backend)\u3092\u6ce8\u5165\u3057\u307e\u3059\u3002\n\nindex.js\n// ...\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n// ...\n\n\n\u6b21\u306b\u3001\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u8981\u7d20\u3092\u5225\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u76f4\u3057\u307e\u3059\u3002\n\nindex.js>Sortable>render()\n// ...\n          this.state.items.map((item,i) =>\n            // li -> Item\n            <Item id={item.id} key={i}>{item.text}</Item>\n          )\n// ...\n\n\n//...\nclass Item extends React.Component{\n  render(){\n    return (\n      <li>\n        {this.props.children}\n      </li>\n    )\n  }\n}\n//...\n\n\u5b9a\u7fa9\u3057\u76f4\u3057\u305fItem\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u3001\u30c9\u30e9\u30c3\u30b0\u5143\u3067\u3042\u308b\u3053\u3068\u3092\u5b9a\u7fa9\u3059\u308bDragSource\u3001\u30c9\u30e9\u30c3\u30b0\u5148\u3067\u3042\u308b\u3053\u3068\u3092\u5b9a\u7fa9\u3059\u308bDropTarget\u3092Decorator\u69cb\u6587\u3067\u6ce8\u5165\u3057\u3001Item\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u6ce8\u5165\u3055\u308c\u305f\u30e9\u30c3\u30d1\u95a2\u6570this.props.connectDragSource,this.props.connectDropTarget\u3067\u3001render\u6642\u306e\u8981\u7d20\u3092\u68b1\u5305\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nDecorate\u3055\u308c\u305fItem\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n\n    console.log(hoverProps.id,dragProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n\n\n\u4ee5\u4e0a\u306e\u30b3\u30fc\u30c9\u306f\u3001src/index.js\u4e0a\u3067\u5168\u3066\u66f8\u3044\u305f\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u8aac\u660e\u3067\u3059\u3002\u7d50\u679c\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nsrc/index.js\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <Item id={item.id} key={i}>{item.text}</Item>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n\n    console.log(hoverProps.id,dragProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n\naddEventListener('load',()=>{\n  ReactDOM.render(<Sortable />,document.querySelector('main'))\n})\n\n\n\u3053\u3053\u307e\u3067\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3068\u3001\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u3044\u308b\u8981\u7d20\u3068\u3001\u30de\u30a6\u30b9\u306e\u4e0a\u306e\u8981\u7d20\u306eprops\u3092\u3001console.log\u3092\u5410\u304d\u51fa\u3059\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nview\u306baction / store\u3092\u4ed8\u4e0e\u3057\u3066\u64cd\u4f5c\u3059\u308b\n\n\u91cd\u306a\u3063\u305f\u8981\u7d20\u304c\u5225id\u3067\u3042\u308c\u3070\u3001state.items\u3092\u4e26\u3073\u66ff\u3048\u3066view\u3092\u66f4\u65b0\u3059\u308b\n\n\u3092\u3001action->store->views->action\u306e\u7c21\u6613flux\u3067\u884c\u3044\u307e\u3059\u3002\nAction\u30af\u30e9\u30b9\u3001Store\u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3084\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u3001\u6240\u5b9a\u306e\u30af\u30e9\u30b9\u3078\u79fb\u52d5\u3055\u305b\u307e\u3059\u3002\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\nimport EventEmitter from 'events'\nimport update from 'react-addons-update'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= this.props.store.get()\n    this._onChange= ::this.onChange\n  }\n  onChange(){\n    this.setState(this.props.store.get())\n  }\n  componentDidMount(){\n    this.props.store.on('change',this._onChange)\n  }\n  componentWillUnmount(){\n    this.props.store.removeListener('change',this._onChange)\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <Item action={this.props.action} id={item.id} key={i}>{item.text}</Item>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n    if(hoverProps.id === dragProps.id){\n      return\n    }\n\n    hoverProps.action.emit('exchange',dragProps.id,hoverProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n\nclass Action extends EventEmitter{\n  exchange(aId,bId){\n    this.emit('exchange',aId,bId)\n  }\n}\nclass Store extends EventEmitter{\n  constructor(action){\n    super()\n\n    this.data= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n\n    action.on('exchange',::this.onExchange)\n  }\n  onExchange(aId,bId){\n    let aItem= this.data.items.filter(item => item.id === aId)[0]\n    let aIndex= this.data.items.indexOf(aItem)\n    let bItem= this.data.items.filter(item => item.id === bId)[0]\n    let bIndex= this.data.items.indexOf(bItem)\n\n    this.data= update(this.data,{items:{\n      $splice: [[aIndex,1,bItem]],\n    }})\n    this.data= update(this.data,{items:{\n      $splice: [[bIndex,1,aItem]],\n    }})\n\n    this.emit('change')\n  }\n  get(){\n    return this.data\n  }\n}\n\naddEventListener('load',()=>{\n  const action= new Action\n  const store= new Store(action)\n  ReactDOM.render(<Sortable action={action} store={store} />,document.querySelector('main'))\n})\n\n\u307e\u305f\u540c\u6642\u306b\u3001action\u304b\u3089exchange\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u3063\u305fstore\u304c\u3001\u81ea\u8eab\u306eonExchange\u30e1\u30bd\u30c3\u30c9\u3067\u3001React\u306eupdate\u30a2\u30c9\u30aa\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001this.data.items\u3092\u5165\u308c\u66ff\u3048\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n// ...\n  onExchange(aId,bId){\n    let aItem= this.data.items.filter(item => item.id === aId)[0]\n    let aIndex= this.data.items.indexOf(aItem)\n    let bItem= this.data.items.filter(item => item.id === bId)[0]\n    let bIndex= this.data.items.indexOf(bItem)\n\n    this.data= update(this.data,{items:{\n      $splice: [[aIndex,1,bItem]],\n    }})\n    this.data= update(this.data,{items:{\n      $splice: [[bIndex,1,aItem]],\n    }})\n\n    this.emit('change')\n  }\n// ...\n\n\u5909\u66f4\u304c\u5b8c\u4e86\u3057\u305f\u3089change\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3057\u3001store\u3092\u8cfc\u8aad\u3057\u3066\u3044\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306bstate\u306e\u66f4\u65b0\u3092\u4fc3\u3057\u307e\u3059\u3002\n\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\nmobile\u5bfe\u5fdc\uff08\u7533\u3057\u8a33\u7a0b\u5ea6\u306e\uff09\n\nThe second package instructs React DnD to use the HTML5 drag and drop API under the hood. You may choose to use a third-party backend instead, such as the touch backend.\n\nhttp://gaearon.github.io/react-dnd/\n\n\u3068\u3042\u308b\u3088\u3046\u306b\u3001DragDropContext\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u6ce8\u5165\u3057\u3066\u3044\u308bReactDnDHTML5Backend\u3092\nimport ReactDnDTouchBackend from 'react-dnd-touch-backend'\n\n@DragDropContext(ReactDnDTouchBackend)\n// ...\n\n\u3068\u3059\u308b\u3068\u52d5\u304f\u306e\u3067\u3059\u304c\u3001\u4eca\u5ea6\u306f\u901a\u5e38\u306ePC\u3067\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001\u6b63\u898f\u8868\u73fe\u3067navigator.userAgent\u3092\u898b\u3066\u3001\u3069\u3061\u3089\u3092\u6ce8\u5165\u3059\u308b\u304b\u3092\u76f4\u524d\u306b\u6c7a\u3081\u3066\u304f\u3060\u3055\u3044\u3002\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\nimport ReactDnDTouchBackend from 'react-dnd-touch-backend'\n\nconst isMobile= navigator.userAgent.match(/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i) !== null\n\n@DragDropContext(isMobile? ReactDnDTouchBackend: ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n// ...\n\n\n\u2026\u4e0a\u8a18\u307e\u3067\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n\u53c2\u8003\n\n(cjsx/CoffeScript) React\u3067\u30c9\u30e9\u30c3\u30b0\u30a2\u30f3\u30c9\u30c9\u30ed\u30c3\u30d7\u3092\u5b9f\u88c5\u3057\u305f\u3044\u306e\u3067\u3001react-dnd\u3092\u4f7f\u3063\u3066\u307f\u305f | WebDesign Dackel\n\n` React Components`\u3067[DRAG](http://react-components.com/search/drag)\u3001[SORTABLE](http://react-components.com/search/sortable)\u306a\u3069\u3067\u691c\u7d22\u3059\u308b\u3068\u51fa\u3066\u304f\u308b\u4e2d\u3001\u661f\u304c\u4e00\u756a\u591a\u3044\u306e\u304c[react-dnd](https://github.com/gaearon/react-dnd)\u3067\u3059\u304c\u3001\u6050\u3089\u304f\u4e00\u756a\u5c11\u306a\u3044\u30b3\u30fc\u30c9\u91cf\u3067\u3042\u308d\u3046\u3001[04 Sortable/Simple](https://github.com/gaearon/react-dnd/tree/v2.0.2/examples/04%20Sortable/Simple)\u306e\u4e2d\u8eab\u304c\u306a\u304b\u306a\u304b\u798d\u3005\u3057\u304f\u3001\u304b\u3064[flux](http://azu.github.io/slide/react-meetup/flux.html)\u3067\u3082\u7121\u3044\u305f\u3081\u3001\u8aad\u3080\u306e\u306b\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002\n\n\u305d\u3053\u3067\n\n* \u74b0\u5883\u8a2d\u5b9a\n* \u3069\u3046\u3059\u308c\u3070`react-dnd@2.0.2`\u304c\u6700\u4f4e\u9650\u52d5\u304f\u306e\u304b\n* `view`\u306b`action` / `store`\u3092\u4ed8\u4e0e\u3057\u3066\u64cd\u4f5c\u3059\u308b\n* mobile\u5bfe\u5fdc\uff08\u7533\u3057\u8a33\u7a0b\u5ea6\u306e\uff09\n\n\u3092\u8003\u3048\u305f\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\u8a2d\u5b9a\n---\n\n\u4ee5\u4e0b\u306e`package.json`\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```json\n{\n  \"name\": \"try-dnd\",\n  \"scripts\": {\n    \"start\": \"webpack-dev-server --port 59798 --host 0.0.0.0 --content-base dist\",\n    \"build\": \"webpack\"\n  },\n  \"dependencies\": {\n    \"react\": \"^0.14.2\",\n    \"react-addons-update\": \"^0.14.2\",\n    \"react-dnd\": \"^2.0.2\",\n    \"react-dnd-html5-backend\": \"^2.0.0\",\n    \"react-dnd-touch-backend\": \"^0.2.0\",\n    \"react-dom\": \"^0.14.2\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^5.8.33\",\n    \"babel-loader\": \"^5.3.3\",\n    \"webpack\": \"^1.12.4\",\n    \"webpack-dev-server\": \"^1.12.1\"\n  },\n  \"babel\": {\n    \"stage\": 0\n  }\n}\n```\n\n\u4ee5\u4e0b\u306e`webpack.config.babel.js`\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```js\nimport webpack from 'webpack'\n\nexport default {\n  context: __dirname + '/src',\n  entry: {\n    javascript: './index.js',\n  },\n\n  output: {\n    path: __dirname + '/dist',\n    filename: 'bundle.js',\n  },\n\n  module: {\n    loaders: [\n      {\n        test: /\\.js$/,\n        exclude: /node_modules/,\n        loaders: ['babel-loader'],\n      },\n    ],\n  },\n\n  devtool: '#source-map',\n  plugins: [\n    // new webpack.optimize.UglifyJsPlugin({compress:{warnings:false}}),\n    new webpack.optimize.OccurenceOrderPlugin(),\n    new webpack.HotModuleReplacementPlugin(),\n    new webpack.NoErrorsPlugin()\n  ],\n}\n```\n\n\u30a8\u30f3\u30c8\u30ea\u30dd\u30a4\u30f3\u30c8\u3067\u3042\u308b`src`\u3001\u30d3\u30eb\u30c9\u5148`dist`\u3092\u751f\u6210\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u306e\u78ba\u8a8d\u7528`index.html`\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\nmkdir src dist\ntouch dist/index.html\n```\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>react-dnd</title>\n</head>\n<body>\n\n  <script src=\"bundle.js\"></script>\n  <main></main>\n  \n</body>\n</html>\n```\n\n`src/index.js`\u306b\u52d5\u4f5c\u78ba\u8a8d\u7528\u306eComponent\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```js:src/index.js\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <li id={item.id} key={i}>{item.text}</li>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\naddEventListener('load',()=>{\n  ReactDOM.render(<Sortable />,document.querySelector('main'))\n})\n```\n\n\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u6e96\u5099\u3067\u304d\u305f\u306e\u3067\u3001\u6700\u5f8c\u306b`npm install`\u3067\u4f9d\u5b58\u3092\u89e3\u6d88\u3057\u307e\u3059\u3002\n\n```bash\nnpm install\n# npm WARN EPACKAGEJSON ... (\u7121\u8996)\n\ntree .\n# .\n# \u251c\u2500\u2500 dist\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 index.html\n# \u251c\u2500\u2500 node_modules\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 (330 directories...)\n# \u251c\u2500\u2500 package.json\n# \u251c\u2500\u2500 src\n# \u2502\u00a0\u00a0 \u2514\u2500\u2500 index.js\n# \u2514\u2500\u2500 webpack.config.babel.js\n```\n\n`npm start`\u3067\u958b\u767a\u7528\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3059\u308b\u306e\u3067\u3001http://localhost:59798/webpack-dev-server/ \u3067`src/index.js`\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u7d50\u679c\u3092`index.html`\u7d4c\u7531\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-11-11 23.30.46.png](https://qiita-image-store.s3.amazonaws.com/0/28576/68e70023-894a-2772-d014-05460af2e699.png)\n\n\u8868\u793a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001\u3053\u306e`li`\u8981\u7d20\u306b\u4e26\u3073\u66ff\u3048\u306e\u8981\u7d20\u3092\u52a0\u3048\u3066\u3044\u304f\u624b\u9806\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3069\u3046\u3059\u308c\u3070`react-dnd@2.0.2`\u304c\u6700\u4f4e\u9650\u52d5\u304f\u306e\u304b\n---\n\n\u307e\u305a\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f`Sortable`\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b[Decorator\u69cb\u6587](https://github.com/wycats/javascript-decorators)\u3067`DragDropContext(ReactDnDHTML5Backend)`\u3092\u6ce8\u5165\u3057\u307e\u3059\u3002\n\n```js:index.js\n// ...\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n// ...\n```\n\n\u6b21\u306b\u3001\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u8981\u7d20\u3092\u5225\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u76f4\u3057\u307e\u3059\u3002\n\n```js:index.js>Sortable>render()\n// ...\n          this.state.items.map((item,i) =>\n            // li -> Item\n            <Item id={item.id} key={i}>{item.text}</Item>\n          )\n// ...\n```\n\n```js\n//...\nclass Item extends React.Component{\n  render(){\n    return (\n      <li>\n        {this.props.children}\n      </li>\n    )\n  }\n}\n//...\n```\n\n\u5b9a\u7fa9\u3057\u76f4\u3057\u305f`Item`\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u3001\u30c9\u30e9\u30c3\u30b0\u5143\u3067\u3042\u308b\u3053\u3068\u3092\u5b9a\u7fa9\u3059\u308b`DragSource`\u3001\u30c9\u30e9\u30c3\u30b0\u5148\u3067\u3042\u308b\u3053\u3068\u3092\u5b9a\u7fa9\u3059\u308b`DropTarget`\u3092Decorator\u69cb\u6587\u3067\u6ce8\u5165\u3057\u3001`Item`\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u6ce8\u5165\u3055\u308c\u305f\u30e9\u30c3\u30d1\u95a2\u6570`this.props.connectDragSource`,`this.props.connectDropTarget`\u3067\u3001render\u6642\u306e\u8981\u7d20\u3092\u68b1\u5305\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```js:Decorate\u3055\u308c\u305fItem\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n\n    console.log(hoverProps.id,dragProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n```\n\n\u4ee5\u4e0a\u306e\u30b3\u30fc\u30c9\u306f\u3001`src/index.js`\u4e0a\u3067\u5168\u3066\u66f8\u3044\u305f\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u8aac\u660e\u3067\u3059\u3002\u7d50\u679c\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```js:src/index.js\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <Item id={item.id} key={i}>{item.text}</Item>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n\n    console.log(hoverProps.id,dragProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n\naddEventListener('load',()=>{\n  ReactDOM.render(<Sortable />,document.querySelector('main'))\n})\n```\n\n\u3053\u3053\u307e\u3067\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3068\u3001\u30c9\u30e9\u30c3\u30b0\u3057\u3066\u3044\u308b\u8981\u7d20\u3068\u3001\u30de\u30a6\u30b9\u306e\u4e0a\u306e\u8981\u7d20\u306eprops\u3092\u3001`console.log`\u3092\u5410\u304d\u51fa\u3059\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3059\u3002\n\n![foo.gif](https://qiita-image-store.s3.amazonaws.com/0/28576/271ebbfe-3bee-469e-9177-d9cb44629851.gif)\n\n`view`\u306b`action` / `store`\u3092\u4ed8\u4e0e\u3057\u3066\u64cd\u4f5c\u3059\u308b\n---\n\n* \u91cd\u306a\u3063\u305f\u8981\u7d20\u304c\u5225id\u3067\u3042\u308c\u3070\u3001state.items\u3092\u4e26\u3073\u66ff\u3048\u3066view\u3092\u66f4\u65b0\u3059\u308b\n\n\u3092\u3001action->store->views->action\u306e[\u7c21\u6613flux](http://azu.github.io/slide/react-meetup/flux.html)\u3067\u884c\u3044\u307e\u3059\u3002\n\n`Action`\u30af\u30e9\u30b9\u3001`Store`\u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3084\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u3001\u6240\u5b9a\u306e\u30af\u30e9\u30b9\u3078\u79fb\u52d5\u3055\u305b\u307e\u3059\u3002\n\n```js\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\n\nimport EventEmitter from 'events'\nimport update from 'react-addons-update'\n\n@DragDropContext(ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n  constructor(props){\n    super(props)\n\n    this.state= this.props.store.get()\n    this._onChange= ::this.onChange\n  }\n  onChange(){\n    this.setState(this.props.store.get())\n  }\n  componentDidMount(){\n    this.props.store.on('change',this._onChange)\n  }\n  componentWillUnmount(){\n    this.props.store.removeListener('change',this._onChange)\n  }\n\n  render(){\n    return(\n      <ul>\n        {\n          this.state.items.map((item,i) =>\n            <Item action={this.props.action} id={item.id} key={i}>{item.text}</Item>\n          )\n        }\n      </ul>\n    )\n  }\n}\n\n@DropTarget('item',{\n  hover(hoverProps,monitor,hoverComponent){\n    let dragProps= monitor.getItem()\n    if(hoverProps.id === dragProps.id){\n      return\n    }\n\n    hoverProps.action.emit('exchange',dragProps.id,hoverProps.id)\n  },\n},(connect)=>{\n  return {\n    connectDropTarget: connect.dropTarget(),\n  }\n})\n@DragSource('item',{\n  beginDrag(props){\n    return props\n  }\n},(connect,monitor)=>{\n  return {\n    connectDragSource: connect.dragSource(),\n    isDragging: monitor.isDragging(),\n  }\n})\nclass Item extends React.Component{\n  render(){\n    return this.props.connectDragSource(this.props.connectDropTarget(\n      <li>\n        {this.props.children}\n      </li>\n    ))\n  }\n}\n\nclass Action extends EventEmitter{\n  exchange(aId,bId){\n    this.emit('exchange',aId,bId)\n  }\n}\nclass Store extends EventEmitter{\n  constructor(action){\n    super()\n    \n    this.data= {\n      items: [\n        {id:0,text:'Lorem ipsum dolor sit amet'},\n        {id:1,text:'consectetur adipisicing elit'},\n        {id:2,text:'Voluptatibus repellendus vitae officia'},\n        {id:3,text:'earum ea eligendi voluptates quidem harum'},\n        {id:4,text:'voluptas numquam aliquam cum eaque?'},\n      ],\n    }\n\n    action.on('exchange',::this.onExchange)\n  }\n  onExchange(aId,bId){\n    let aItem= this.data.items.filter(item => item.id === aId)[0]\n    let aIndex= this.data.items.indexOf(aItem)\n    let bItem= this.data.items.filter(item => item.id === bId)[0]\n    let bIndex= this.data.items.indexOf(bItem)\n\n    this.data= update(this.data,{items:{\n      $splice: [[aIndex,1,bItem]],\n    }})\n    this.data= update(this.data,{items:{\n      $splice: [[bIndex,1,aItem]],\n    }})\n\n    this.emit('change')\n  }\n  get(){\n    return this.data\n  }\n}\n\naddEventListener('load',()=>{\n  const action= new Action\n  const store= new Store(action)\n  ReactDOM.render(<Sortable action={action} store={store} />,document.querySelector('main'))\n})\n```\n\n\u307e\u305f\u540c\u6642\u306b\u3001action\u304b\u3089`exchange`\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u3063\u305f`store`\u304c\u3001\u81ea\u8eab\u306e`onExchange`\u30e1\u30bd\u30c3\u30c9\u3067\u3001React\u306e[update\u30a2\u30c9\u30aa\u30f3](https://facebook.github.io/react/docs/update.html)\u3092\u4f7f\u7528\u3057\u3066\u3001`this.data.items`\u3092\u5165\u308c\u66ff\u3048\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```js\n// ...\n  onExchange(aId,bId){\n    let aItem= this.data.items.filter(item => item.id === aId)[0]\n    let aIndex= this.data.items.indexOf(aItem)\n    let bItem= this.data.items.filter(item => item.id === bId)[0]\n    let bIndex= this.data.items.indexOf(bItem)\n\n    this.data= update(this.data,{items:{\n      $splice: [[aIndex,1,bItem]],\n    }})\n    this.data= update(this.data,{items:{\n      $splice: [[bIndex,1,aItem]],\n    }})\n\n    this.emit('change')\n  }\n// ...\n```\n\n\u5909\u66f4\u304c\u5b8c\u4e86\u3057\u305f\u3089`change`\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3057\u3001`store`\u3092\u8cfc\u8aad\u3057\u3066\u3044\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b`state`\u306e\u66f4\u65b0\u3092\u4fc3\u3057\u307e\u3059\u3002\n\n\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n![foo.gif](https://qiita-image-store.s3.amazonaws.com/0/28576/cd5320d9-5aac-52a6-c260-92375be110af.gif)\n\nmobile\u5bfe\u5fdc\uff08\u7533\u3057\u8a33\u7a0b\u5ea6\u306e\uff09\n---\n> The second package instructs React DnD to use the HTML5 drag and drop API under the hood. You may choose to use a third-party backend instead, such as [the touch backend](https://github.com/yahoo/react-dnd-touch-backend).\n> <p align=\"right\">http://gaearon.github.io/react-dnd/</p>\n\n\u3068\u3042\u308b\u3088\u3046\u306b\u3001`DragDropContext`\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u6ce8\u5165\u3057\u3066\u3044\u308b`ReactDnDHTML5Backend`\u3092\n\n```js\nimport ReactDnDTouchBackend from 'react-dnd-touch-backend'\n\n@DragDropContext(ReactDnDTouchBackend)\n// ...\n```\n\n\u3068\u3059\u308b\u3068\u52d5\u304f\u306e\u3067\u3059\u304c\u3001\u4eca\u5ea6\u306f\u901a\u5e38\u306ePC\u3067\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001[\u6b63\u898f\u8868\u73fe\u3067`navigator.userAgent`\u3092\u898b\u3066](http://stackoverflow.com/questions/11381673/detecting-a-mobile-browser)\u3001\u3069\u3061\u3089\u3092\u6ce8\u5165\u3059\u308b\u304b\u3092\u76f4\u524d\u306b\u6c7a\u3081\u3066\u304f\u3060\u3055\u3044\u3002\n\n```js\nimport {DragDropContext,DropTarget,DragSource} from 'react-dnd'\nimport ReactDnDHTML5Backend from 'react-dnd-html5-backend'\nimport ReactDnDTouchBackend from 'react-dnd-touch-backend'\n\nconst isMobile= navigator.userAgent.match(/(Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone)/i) !== null\n\n@DragDropContext(isMobile? ReactDnDTouchBackend: ReactDnDHTML5Backend)\nclass Sortable extends React.Component{\n// ...\n```\n\n[^hoka]: `::` [Function Bind Syntax](https://github.com/zenparsing/es-function-bind#readme) \u53c2\u7167\u3002`onChange= ()=>{}`\u306e\u3088\u3046\u306a[\u64ec\u4f3cautobind](https://gist.github.com/jeffmo/054df782c05639da2adb#gistcomment-1467210)\u3067\u3082\u826f\u3044\u3093\u3067\u3059\u304c\u3001\u3053\u308c\u306fbabel@5\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u7d50\u679c\u898b\u308b\u3068constructor\u5185\u3067`this`\u306b\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u3057\u3066\u95a2\u6570\u3092\u7a81\u3063\u8fbc\u3093\u3067\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001`super`\u3067\u547c\u3073\u51fa\u305b\u306a\u304f\u306a\u308b\u5f0a\u5bb3\u304c\u3042\u3063\u305f\u308a\u3001\u305d\u3082\u305d\u3082[babel@6\u3067\u52d5\u4f5c\u3057\u307e\u305b\u3093](https://github.com/babel/babel/issues/2774)\u3002\n\n![PC/iPhone](https://qiita-image-store.s3.amazonaws.com/0/28576/99cdcc18-9113-436f-86f9-67a07c2e1256.gif)\n\n\n[\u2026\u4e0a\u8a18\u307e\u3067\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://gist.github.com/59naga/ed6714519284d36792ba)\n\n\u53c2\u8003\n---\n* [(cjsx/CoffeScript) React\u3067\u30c9\u30e9\u30c3\u30b0\u30a2\u30f3\u30c9\u30c9\u30ed\u30c3\u30d7\u3092\u5b9f\u88c5\u3057\u305f\u3044\u306e\u3067\u3001react-dnd\u3092\u4f7f\u3063\u3066\u307f\u305f | WebDesign Dackel](http://webdesign-dackel.com/2015/06/04/react-dnd/)\n", "tags": ["JavaScript", "reactjs", "babel", "flux"]}