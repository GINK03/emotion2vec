{"context": "\n\nInstall\n[centos@haas ~]$ sudo install setuptools\n[centos@haas ~]$ sudo install ansible-container\n[centos@haas ~]$ ansible-container init\nAnsible Container initialized.\n\n\n\u4f5c\u308b\n\u4e3b\u306b\u30012\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\u3002\n\ncontainer.yml\nmain.yml\n\n\u3064\u307e\u308a\u3001\u300cApache httpd\u304c\u52d5\u304f\u30b3\u30f3\u30c6\u30ca\u304c\u307b\u3057\u3044\u306a\u300d\u3068\u3044\u3046\u3068\u304d\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3084\u3001\u30b3\u30de\u30f3\u30c9\u3001\u30dd\u30fc\u30c8\u3001\u30ea\u30f3\u30af\u3001\u30a8\u30af\u30b9\u30dd\u30fc\u30ba\u306a\u3093\u304b\u306fcontainer.yml\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u304b\u3059httpd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u8a2d\u5b9a\u3057\u3066\u30fb\u30fb\u30fb\u306a\u3093\u304b\u306e\u60c5\u5831\u306fmain.yml\u306b\u66f8\u304f\u3002main.yml\u306e\u65b9\u306f\u3001\u307e\u3093\u307eAnsible\u306eYAML\u3092\u66f8\u3051\u3070\u3044\u3044\uff08\u3082\u3061\u308d\u3093\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u304f\u3082\u306e\u51e6\u7406\u3067\u304d\u308b\u3082\u306e\u304c\u524d\u63d0\u3068\u306a\u308b\uff09\u3002\n\ncontainer.yml\n\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\u969b\u306e\u60c5\u5831\u3001Docker Compose \u30e9\u30a4\u30af\u306b YAML \u3067\u66f8\u304f\u3002\nversion: \"1\"\nservices:\n  hands_temp:\n    image: centos:latest\n\n    command: [\"/usr/sbin/sshd\",\"-D\"]\n  # Add your containers here, specifying the base image you want to build from\n  # For example:\n  #\n  # web:\n  #   image: ubuntu:trusty\n  #   ports:\n  #     - \"80:80\"\n  #   command: ['/usr/bin/dumb-init', '/usr/sbin/apache2ctl', '-D', 'FOREGROUND']\n  #   dev_overrides:\n  #     environment:\n  #       - \"DEBUG=1\"\n  #\nregistries: {}\n  # Add optional registries used for deployment. For example:\n  #  google:\n  #    url: https://gcr.io\n  #    namespace: my-cool-project-xxxxxx\n\n\nmain.yml\ncontainer.yml \u3067\u30d3\u30eb\u30c9\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u4e2d\u8eab\u306e\u51e6\u7406\u306e\u60c5\u5831\n# This should be your Ansible playbooks to provision your containers.\n# An inventory will be automatically created using the names of the services\n# from your container.yml file.\n# Add any roles or other modules you'll need to this directory too.\n# For many examples of roles, check out Ansible Galaxy: https://galaxy.ansible.com/\n#\n---\n- hosts: all\n  gather_facts: false\n\n  vars:\n    hands_name: \"handsonname\"\n\n  tasks:\n    - name: Only say hello when running via Ansible Container\n      command: echo \"Hello!\"\n      when: ansible_env.ANSIBLE_CONTAINER is defined\n\n    - block:\n      - name: Install openssh-server and clients\n        yum: name={{ item }} state=present\n        with_items:\n          - \"openssh-server\"\n          - \"openssh-clients\"\n\n      - name: Generate Host RSA Key\n        raw: \"ssh-keygen -q -t rsa1 -f /etc/ssh/ssh_host_rsa_key -C '' -N ''\"\n      - name: Generate Host ECDSA Key\n        raw: \"ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -C '' -N ''\"\n      - name: Generate Host ED25519 Key\n        raw: \"ssh-keygen -q -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -C '' -N ''\"\n\n      - name: Add PS\n        blockinfile:\n          dest: /root/.bashrc\n          block: |\n            export PS1=\"[\\u@{{ hands_name }} \\W] $ \"\n            cd ~/\n\n\n\u30d3\u30eb\u30c9\n[centos@haas ~]$ ansible-container build\nNo DOCKER_HOST environment variable found. Assuming UNIX socket at /var/run/docker.sock\nStarting Docker Compose engine to build your images...\nAttaching to ansible_ansible-container_1\nCleaning up Ansible Container builder...\nNo image found for tag centos-hands_temp:latest, so building from scratch\nAttaching to ansible_ansible-container_1, ansible_hands_temp_1\nansible-container_1  | Host hands_temp running\nansible-container_1  |\nansible-container_1  | PLAY [all] *********************************************************************\nansible-container_1  |\nansible-container_1  | TASK [Only say hello when running via Ansible Container] ***********************\nansible-container_1  | skipping: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Install openssh-server and clients] **************************************\nansible-container_1  | changed: [hands_temp] => (item=[u'openssh-server', u'openssh-clients'])\nansible-container_1  |\nansible-container_1  | TASK [Generate Host RSA Key] ***************************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Generate Host ECDSA Key] *************************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Generate Host ED25519 Key] ***********************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Add PS] ******************************************************************\nansible-container_1  | changed: [hands_temp]\nansible-container_1  |\nansible-container_1  | PLAY RECAP *********************************************************************\nansible-container_1  | hands_temp                 : ok=5    changed=2    unreachable=0    failed=0\nansible-container_1  |\nansible_ansible-container_1 exited with code 0\nAborting on container exit...\nStopping ansible_hands_temp_1 ... done\nExporting built containers as images...\nCommitting image...\nExported centos-hands_temp with image ID sha256:85e018efb704ce2970871a80b7a1fc0377e2d4f869ed134268b2e16f68b8317b\nCleaning up hands_temp build container...\nCleaning up Ansible Container builder...\n\n\n\u30e9\u30f3\n[centos@haas ~]$ ls -F\nansible/\n[centos@haas ~]$ ansible-container run\nNo DOCKER_HOST environment variable found. Assuming UNIX socket at /var/run/docker.sock\nAttaching to ansible_ansible-container_1\nCleaning up Ansible Container builder...\nAttaching to ansible_hands_temp_1\n\n\n# Install \n```shell-session\n[centos@haas ~]$ sudo install setuptools\n[centos@haas ~]$ sudo install ansible-container\n[centos@haas ~]$ ansible-container init\nAnsible Container initialized.\n```\n\n# \u4f5c\u308b\n\u4e3b\u306b\u30012\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\u3002\n\n* container.yml\n* main.yml\n\n\u3064\u307e\u308a\u3001\u300cApache httpd\u304c\u52d5\u304f\u30b3\u30f3\u30c6\u30ca\u304c\u307b\u3057\u3044\u306a\u300d\u3068\u3044\u3046\u3068\u304d\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3084\u3001\u30b3\u30de\u30f3\u30c9\u3001\u30dd\u30fc\u30c8\u3001\u30ea\u30f3\u30af\u3001\u30a8\u30af\u30b9\u30dd\u30fc\u30ba\u306a\u3093\u304b\u306f`container.yml`\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u304b\u3059httpd\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u8a2d\u5b9a\u3057\u3066\u30fb\u30fb\u30fb\u306a\u3093\u304b\u306e\u60c5\u5831\u306f`main.yml`\u306b\u66f8\u304f\u3002`main.yml`\u306e\u65b9\u306f\u3001\u307e\u3093\u307eAnsible\u306eYAML\u3092\u66f8\u3051\u3070\u3044\u3044\uff08\u3082\u3061\u308d\u3093\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u304f\u3082\u306e\u51e6\u7406\u3067\u304d\u308b\u3082\u306e\u304c\u524d\u63d0\u3068\u306a\u308b\uff09\u3002\n\n## container.yml\n\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\u969b\u306e\u60c5\u5831\u3001Docker Compose \u30e9\u30a4\u30af\u306b YAML \u3067\u66f8\u304f\u3002\n\n```yaml\nversion: \"1\"\nservices:\n  hands_temp:\n    image: centos:latest\n\n    command: [\"/usr/sbin/sshd\",\"-D\"]\n  # Add your containers here, specifying the base image you want to build from\n  # For example:\n  #\n  # web:\n  #   image: ubuntu:trusty\n  #   ports:\n  #     - \"80:80\"\n  #   command: ['/usr/bin/dumb-init', '/usr/sbin/apache2ctl', '-D', 'FOREGROUND']\n  #   dev_overrides:\n  #     environment:\n  #       - \"DEBUG=1\"\n  #\nregistries: {}\n  # Add optional registries used for deployment. For example:\n  #  google:\n  #    url: https://gcr.io\n  #    namespace: my-cool-project-xxxxxx\n```\n## main.yml\n`container.yml` \u3067\u30d3\u30eb\u30c9\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u4e2d\u8eab\u306e\u51e6\u7406\u306e\u60c5\u5831\n\n```yaml\n# This should be your Ansible playbooks to provision your containers.\n# An inventory will be automatically created using the names of the services\n# from your container.yml file.\n# Add any roles or other modules you'll need to this directory too.\n# For many examples of roles, check out Ansible Galaxy: https://galaxy.ansible.com/\n#\n---\n- hosts: all\n  gather_facts: false\n\n  vars:\n    hands_name: \"handsonname\"\n\n  tasks:\n    - name: Only say hello when running via Ansible Container\n      command: echo \"Hello!\"\n      when: ansible_env.ANSIBLE_CONTAINER is defined\n\n    - block:\n      - name: Install openssh-server and clients\n        yum: name={{ item }} state=present\n        with_items:\n          - \"openssh-server\"\n          - \"openssh-clients\"\n\n      - name: Generate Host RSA Key\n        raw: \"ssh-keygen -q -t rsa1 -f /etc/ssh/ssh_host_rsa_key -C '' -N ''\"\n      - name: Generate Host ECDSA Key\n        raw: \"ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -C '' -N ''\"\n      - name: Generate Host ED25519 Key\n        raw: \"ssh-keygen -q -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -C '' -N ''\"\n\n      - name: Add PS\n        blockinfile:\n          dest: /root/.bashrc\n          block: |\n            export PS1=\"[\\u@{{ hands_name }} \\W] $ \"\n            cd ~/\n```\n\n# \u30d3\u30eb\u30c9\n\n```shell-session\n[centos@haas ~]$ ansible-container build\nNo DOCKER_HOST environment variable found. Assuming UNIX socket at /var/run/docker.sock\nStarting Docker Compose engine to build your images...\nAttaching to ansible_ansible-container_1\nCleaning up Ansible Container builder...\nNo image found for tag centos-hands_temp:latest, so building from scratch\nAttaching to ansible_ansible-container_1, ansible_hands_temp_1\nansible-container_1  | Host hands_temp running\nansible-container_1  |\nansible-container_1  | PLAY [all] *********************************************************************\nansible-container_1  |\nansible-container_1  | TASK [Only say hello when running via Ansible Container] ***********************\nansible-container_1  | skipping: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Install openssh-server and clients] **************************************\nansible-container_1  | changed: [hands_temp] => (item=[u'openssh-server', u'openssh-clients'])\nansible-container_1  |\nansible-container_1  | TASK [Generate Host RSA Key] ***************************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Generate Host ECDSA Key] *************************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Generate Host ED25519 Key] ***********************************************\nansible-container_1  | ok: [hands_temp]\nansible-container_1  |\nansible-container_1  | TASK [Add PS] ******************************************************************\nansible-container_1  | changed: [hands_temp]\nansible-container_1  |\nansible-container_1  | PLAY RECAP *********************************************************************\nansible-container_1  | hands_temp                 : ok=5    changed=2    unreachable=0    failed=0\nansible-container_1  |\nansible_ansible-container_1 exited with code 0\nAborting on container exit...\nStopping ansible_hands_temp_1 ... done\nExporting built containers as images...\nCommitting image...\nExported centos-hands_temp with image ID sha256:85e018efb704ce2970871a80b7a1fc0377e2d4f869ed134268b2e16f68b8317b\nCleaning up hands_temp build container...\nCleaning up Ansible Container builder...\n````\n\n# \u30e9\u30f3\n\n```shell-session\n[centos@haas ~]$ ls -F\nansible/\n[centos@haas ~]$ ansible-container run\nNo DOCKER_HOST environment variable found. Assuming UNIX socket at /var/run/docker.sock\nAttaching to ansible_ansible-container_1\nCleaning up Ansible Container builder...\nAttaching to ansible_hands_temp_1\n```\n", "tags": ["Ansible", "container", "docker"]}