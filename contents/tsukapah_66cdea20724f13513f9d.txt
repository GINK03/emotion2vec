{"tags": ["Embulk", "Elasticsearch"], "context": "\u306a\u3093\u304b\u82e6\u52b4\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n\u8aad\u307f\u8fbc\u3080\u30ed\u30b0\n\nlog.json\n{\"time_local\":\"05/Feb/2017:03:38:34 +0900\",\"hoge\":\"piyo\"}\n\n\nNginx\u3084Apache\u3067\u3088\u304f\u898b\u304b\u3051\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3002\n\nEmbulk\u306e\u8a2d\u5b9a\nElasticsearch\u7684\u306bUTC\u3067\u5165\u308c\u305f\u307b\u3046\u304c\u6271\u3044\u3084\u3059\u3044\u306e\u3067timestamp\u578b\u3067\u53d6\u308a\u8fbc\u3093\u3067UTC\u306b\u623b\u3057\u3066\u3042\u3052\u308b\u3002\n\nconfig.yml\nin:\n  type: file\n  path_prefix: /path/to/json/\n  parser:\n    type: jsonl\n    charset: UTF-8\n    newline: LF\n    columns:\n      - { name: \"time_local\", type: \"timestamp\", format: \"%d/%b/%Y:%T %z\" }\n      - { name: \"hoge\", type: \"string\" }\nout:\n  type: elasticsearch_ruby\n  cluster_name: elasticsearch\n  mode: normal\n  nodes:\n    - {host: \"es_host\", port: 9200}\n  index: jsonlog\n  index_type: log\n\n\n\u3053\u306eEmbulk\u306e\u5b9a\u7fa9\u3067\u8aad\u307f\u8fbc\u3080\u3068time_local\u306e\u5024\u306f\u4ee5\u4e0b\u306e\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u308b\u3002\n2017-02-04 18:38:34 UTC\n\n\nElasticsearch\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\nEmbulk\u3067UTC\u306b\u623b\u3059\u306e\u306f\u3044\u3044\u304c\u3001\u3053\u306e\u307e\u307e\u7a81\u3063\u8fbc\u3080\u3060\u3051\u3060\u3068Elasticsearch\u306fdate\u578b\u3068\u3057\u3066\u306f\u53d7\u3051\u5165\u308c\u3066\u304f\u308c\u306a\u3044\u3002\n\u7a81\u3063\u8fbc\u3080\u524d\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u3066\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u767b\u9332\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\ntemplate.json\n{\n  \"template\": \"jsonlog\",\n  \"mappings\": {\n    \"log\": {\n      \"properties\": {\n        \"time_local\": {\n          \"type\": \"date\",\n          \"format\": \"YYYY-MM-dd HH:mm:ss' UTC'\"\n        },\n        \"hoge\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        }\n      }\n    }\n  }\n}\n\n\n$ curl -XPUT es_host:9200/_template/jsonlog?pretty -d \"$(cat template.json)\"\n\n\u3042\u3068\u306f\u4e0a\u306e\u8a2d\u5b9a\u3067Embulk\u3092\u4f7f\u3063\u3066bulk\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3042\u3052\u308c\u3070\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3068\u3057\u3066\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306b\u306a\u308b\u3002\n\n\u306a\u3093\u304b\u82e6\u52b4\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n#\u8aad\u307f\u8fbc\u3080\u30ed\u30b0\n\n```log.json\n{\"time_local\":\"05/Feb/2017:03:38:34 +0900\",\"hoge\":\"piyo\"}\n```\n\nNginx\u3084Apache\u3067\u3088\u304f\u898b\u304b\u3051\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3002\n\n#Embulk\u306e\u8a2d\u5b9a\n\nElasticsearch\u7684\u306bUTC\u3067\u5165\u308c\u305f\u307b\u3046\u304c\u6271\u3044\u3084\u3059\u3044\u306e\u3067`timestamp`\u578b\u3067\u53d6\u308a\u8fbc\u3093\u3067UTC\u306b\u623b\u3057\u3066\u3042\u3052\u308b\u3002\n\n```config.yml\nin:\n  type: file\n  path_prefix: /path/to/json/\n  parser:\n    type: jsonl\n    charset: UTF-8\n    newline: LF\n    columns:\n      - { name: \"time_local\", type: \"timestamp\", format: \"%d/%b/%Y:%T %z\" }\n      - { name: \"hoge\", type: \"string\" }\nout:\n  type: elasticsearch_ruby\n  cluster_name: elasticsearch\n  mode: normal\n  nodes:\n    - {host: \"es_host\", port: 9200}\n  index: jsonlog\n  index_type: log\n```\n\n\u3053\u306eEmbulk\u306e\u5b9a\u7fa9\u3067\u8aad\u307f\u8fbc\u3080\u3068`time_local`\u306e\u5024\u306f\u4ee5\u4e0b\u306e\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```\n2017-02-04 18:38:34 UTC\n```\n\n#Elasticsearch\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\nEmbulk\u3067UTC\u306b\u623b\u3059\u306e\u306f\u3044\u3044\u304c\u3001\u3053\u306e\u307e\u307e\u7a81\u3063\u8fbc\u3080\u3060\u3051\u3060\u3068Elasticsearch\u306fdate\u578b\u3068\u3057\u3066\u306f\u53d7\u3051\u5165\u308c\u3066\u304f\u308c\u306a\u3044\u3002\n\u7a81\u3063\u8fbc\u3080\u524d\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u3066\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u767b\u9332\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\n```template.json\n{\n  \"template\": \"jsonlog\",\n  \"mappings\": {\n    \"log\": {\n      \"properties\": {\n        \"time_local\": {\n          \"type\": \"date\",\n          \"format\": \"YYYY-MM-dd HH:mm:ss' UTC'\"\n        },\n        \"hoge\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        }\n      }\n    }\n  }\n}\n```\n\n```bash\n$ curl -XPUT es_host:9200/_template/jsonlog?pretty -d \"$(cat template.json)\"\n```\n\n\u3042\u3068\u306f\u4e0a\u306e\u8a2d\u5b9a\u3067Embulk\u3092\u4f7f\u3063\u3066bulk\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3042\u3052\u308c\u3070\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3068\u3057\u3066\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306b\u306a\u308b\u3002\n"}