{"context": "php7(\u3068\u3001symfony) + mariadb10 \u3092\u4f7f\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\u306e\u305f\u3081\u306e\u74b0\u5883\u3092vagrant\u3067\u4f5c\u308b\u65b9\u6cd5\u3002\nCentOS7.1\u306e\u30c7\u30d5\u30a9\u30eb\u30c8yum\u30ea\u30dd\u30b8\u30c8\u30ea\u3060\u3068php5.4\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3057\u3001remi\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u4e91\u3005\u3068\u3044\u308d\u3044\u308d\u9762\u5012\u306a\u306e\u3067chef\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u307e\u305f\u3001\u958b\u767a\u6642\u306b\u306fapache\u3068\u304bnginx\u3092\u4f7f\u308f\u305aphp\u306e\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3067\u826f\u3044\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u78ba\u8a8d\u7528\u306e\u30dd\u30fc\u30c8(8000)\u3092\u958b\u3051\u3066\u304a\u304f\u306e\u3068\u3001symfony\u30b3\u30de\u30f3\u30c9\u3001composer\u30b3\u30de\u30f3\u30c9\u3092\u3044\u3061\u3044\u3061\u30ed\u30fc\u30c9\u3057\u305f\u304f\u306a\u3044\u306e\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3002  \n\n\u74b0\u5883\u7b49\n\n\u3053\u3053\u3067\u306fWindows10 + ChefDK + Vagrant + VirtualBox\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\nVagrant\u30d5\u30a1\u30a4\u30eb\u306e\u7f6e\u304d\u5834\u6240\u306f c:/vagrant/sample \u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\n\n\n\u57fa\u672c\u7684\u306a\u6d41\u308c\n\nVagrantfile\u3092\u6e96\u5099\u3059\u308b\nchef cookbook repository \u6e96\u5099\nberkshelf \u3067\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u53d6\u308a\u8fbc\u3080\nphp7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\nfirewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\nvagrant VM\u306b\u5bfe\u3059\u308bjson\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\nVM\u8d77\u52d5\n\u52d5\u4f5c\u78ba\u8a8d\n\n\nVagrantfile\u3092\u6e96\u5099\u3059\u308b\nvagrant init \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u521d\u671fVagrantfile\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nPS > cd c:\\vagrant\\sample\nPS > vagrant init\n\nc:/vagrant/sample/Vagrantfile \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\nVagrant.configure(2) do |config|\n  config.vm.box = \"bento/centos-7.1\"\n  config.vm.network \"private_network\", ip: \"192.168.33.101\"\n  config.omnibus.chef_version = :latest\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.memory = \"1024\"\n  end\n\n  config.vm.provision \"chef_zero\" do |chef|\n    chef.cookbooks_path = [\"chef-repo/cookbooks\", \"chef-repo/site-cookbooks\"]\n    chef.nodes_path = [\"chef-repo/nodes\"]\n    chef.node_name = \"sample\"\n  end\nend\n\n\nchef cookbook repository \u6e96\u5099\nchef generate \u30b3\u30de\u30f3\u30c9\u3067cookbook \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\nPS > cd c:\\vagrant\\sample\nPS > chef generate repo chef-repo\n\n\nberkshelf \u3067\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u53d6\u308a\u8fbc\u3080\nchef-repo/BerksFile\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3059\u308b\nsource \"https://supermarket.chef.io\"\n\ncookbook 'yum'\ncookbook 'yum-remi'\ncookbook 'yum-epel'\ncookbook 'mariadb'\n\n\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\nPS > cd chef-repo\nPS > berks vendor cookbooks\n\n\nphp7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\nknife cookbook \u30b3\u30de\u30f3\u30c9\u3067php\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\nPS >  knife cookbook create php -o site-cookbooks\n\nchef-repo/site-cookbooks/php/recipe/default.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\ninclude_recipe 'yum::default'\ninclude_recipe 'yum-remi::default'\n\n%w[\n  gd-last\n  t1lib\n].each do |pkg|\n    package \"#{pkg}\" do\n        action [ :install ]\n        options \"--enablerepo=remi\"\n    end\nend\n\n%w[\n  php\n  php-cli\n  php-common\n  php-gd\n  php-xml\n  php-pdo\n  php-mbstring\n  php-mysqlnd\n  php-opcache\n].each do |pkg|\n  package \"#{pkg}\" do\n    action :install\n    options '--enablerepo=remi-php70'\n  end\nend\n\nexecute \"composer-install\" do\n  command \"curl -sS https://getcomposer.org/installer | php ;mv composer.phar /usr/local/bin/composer\"\n  not_if { ::File.exists?(\"/usr/local/bin/composer\")}\nend\n\nexecute \"symfony-install\" do\n  command \"curl -LsS https://symfony.com/installer -o /usr/local/bin/symfony;chmod a+x /usr/local/bin/symfony\"\n  not_if { ::File.exists?(\"/usr/local/bin/symfony\")}\nend\n\nphp-gd \u3092\u4f7f\u3046\u306e\u306b gd-last, t1lib\u304c\u5fc5\u8981\u306a\u306e\u3067\u3042\u3089\u304b\u3058\u3081 remi\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3042\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u9069\u5b9c\u8abf\u6574\u3002\n\u307e\u305f\u3001symfony\u30b3\u30de\u30f3\u30c9\u3068composer\u30b3\u30de\u30f3\u30c9\u306f\u3042\u3068\u304b\u3089\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3092\u305f\u305f\u3044\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u3053\u306e\u6642\u70b9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u306eyum,yum-remi\u3092\u4f7f\u3046\u306e\u3067 chef-repo/site-cookbooks/php/metadata.rb \u306b\u4f9d\u5b58\u30ec\u30b7\u30d4\u3092\u8a18\u8ff0\u3059\u308b\u3002\ndepends 'yum'\ndepends 'yum-remi'\n\n\nfirewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\napache\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u8a2d\u5b9a\u3068\u304b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3068\u304b\u3084\u3089\u306a\u304f\u3066\u3044\u3044\u306e\u3067php\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u3046\u3002\u3053\u306e\u305f\u3081\u306b\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u304c\u4f7f\u3046\u30dd\u30fc\u30c8\u3092\u958b\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nknife cookbook \u30b3\u30de\u30f3\u30c9\u3067firewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\nPS >  knife cookbook create init -o site-cookbooks\n\nchef-repo/site-cookbooks/init/recipe/default.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\nservice \"firewalld\" do\n    supports [ :restart, :reload ]\n    action [ :enable, :start ]\nend\n\nexecute \"allow port 8000\" do\n    command \"firewall-cmd --add-port=8000/tcp --zone=public --permanent\"\n    notifies :restart, \"service[firewalld]\"\nend\n\nfirewall-cmd \u3092\u4f7f\u3063\u3066 \u30dd\u30fc\u30c88000 \u3092\u958b\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u30ec\u30b7\u30d4\u306e\u540d\u524d\u304c \"firewalld\" \u3067\u306a\u304f \"init\" \u306a\u306e\u306f\u30ed\u30b1\u30fc\u30eb\u3068\u304b\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3068\u304b\u306e\u521d\u671f\u8a2d\u5b9a\u3082\u542b\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u305f\u3044\u3057\u3066\u610f\u5473\u306f\u306a\u3044\u3051\u3069\u3001\u305d\u306e\u8fba\u306f\u30ec\u30b7\u30d4\u4f5c\u6210\u30dd\u30ea\u30b7\u30fc\u6b21\u7b2c\u3002\n\nvagrant VM\u306b\u5bfe\u3059\u308bjson\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067 chef-repo/nodes/sample.json\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n{\n  \"name\": \"sample\",\n  \"chef_type\": \"node\",\n  \"json_class\": \"Chef::Node\",\n  \"normal\":{\n    \"mariadb\": {\n      \"use_default_repository\": true,\n      \"allow_root_pass_change\": true,\n      \"server_root_password\": \"test\",\n      \"install\": {\n        \"type\": \"package\",\n        \"version\": \"10.1.13\",\n        \"prefer_os_package\": false\n      },\n      \"mysqld\": {\n        \"options\":{\n          \"collation-server\" : \"utf8_unicode_ci\",\n          \"init-connect\" : \"'SET NAMES utf8'\",\n          \"character-set-server\" : \"utf8\"\n        }\n      },\n      \"innodb\": {\n          \"log_file_size\": \"\",\n          \"bps_percentage_memory\": false,\n          \"buffer_pool_size\": \"256M\",\n          \"log_buffer_size\": \"8M\",\n          \"file_per_table\": \"1\",\n          \"open_files\": \"400\",\n          \"io_capacity\": \"400\",\n          \"flush_method\": \"O_DIRECT\",\n          \"options\": {\n\n          }\n      }     \n    },\n    \"yum\": {\n      \"remi-php70\": {\n        \"repositoryid\": \"remi-php70\",\n        \"baseurl\": \"http://rpms.famillecollet.com/enterprise/7/php70/x86_64/\",\n        \"description\": \"Les RPM de remi de PHP 7 pour Enterprise Linux 7 - $basearch\",\n        \"mirrorlist\": \"http://rpms.famillecollet.com/enterprise/7/php70/mirror\"\n      }\n    },\n    \"yum-remi\": {\n      \"repositories\": [\n        \"remi\",\n        \"remi-php70\"\n      ]\n    }\n  },  \n  \"run_list\": [\n    \"recipe[yum]\",\n    \"recipe[yum-epel]\",\n    \"recipe[mariadb::server]\",\n    \"recipe[mariadb::client]\",\n    \"recipe[php]\",\n    \"recipe[init]\"\n\n  ]\n}\n\nmariadb\u306eattributes\u306f\u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u3002root\u30d1\u30b9\u30ef\u30fc\u30c9\u306fdatabag\u7b49\u3067\u66f8\u304f\u3079\u304d\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u3088\u304f\u3042\u308bvagrant\u306e\u89e3\u8aac\u3067\u306f Vagrantfile\u306b\u5c5e\u6027\u3068\u304b\u5b9f\u884c\u30ec\u30b7\u30d4\u3068\u304b\u3092 chef.runlist =[] \u3068\u304b chef.json={}\u3068\u304b\u8a18\u8ff0\u3057\u3066\u3044\u308b\u3051\u308c\u3069\u3082\u6700\u7d42\u7684\u306b\u306f\u8a18\u8ff0\u3057\u305f\u30ec\u30b7\u30d4\u3068\u8a2d\u5b9a\u3092vagrant\u3067\u306f\u306a\u304f\u5b9f\u74b0\u5883\u306b\u9069\u7528\u3057\u305f\u304f\u306a\u308b\u306e\u3067nodes/json\u306b\u8a18\u8ff0\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nVM\u8d77\u52d5\n\u6e96\u5099\u304c\u3067\u304d\u305f\u3089VM\u3092\u8d77\u52d5\u3059\u308b\u3002\nPS > cd c:\\vagrant\\sample\nPS > vagrant up\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bphp\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066 php \u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u3001\u30db\u30b9\u30c8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n/vagrant/check/info.php\n\n<?php\nphpinfo();\n\n\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\n$> php -S 0.0.0.0:8000\n\n\u30db\u30b9\u30c8\u304b\u3089 http://192.168.33.101/info.php \u306b \u30a2\u30af\u30bb\u30b9\n\n\u305d\u306e\u4ed6\n\n\"\u30ec\u30b7\u30d4\u306f\u4e0a\u304b\u3089\u9806\u306b\u5b9f\u884c\u3055\u308c\u306a\u3044\"\u3068\u3044\u3046\u8a71\u306a\u306e\u3067\u3001php-gd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u304b\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\nnodes|environments|data_bags\u306e\u4f7f\u3044\u5206\u3051\u3001\u512a\u5148\u9806\u4f4d\u304c\u4eca\u4e00\u308f\u304b\u3089\u306a\u3044\u3002\n\u3061\u3087\u3063\u3068\u53e4\u3044\u89e3\u8aac\u3060\u3068 box\u30d5\u30a1\u30a4\u30eb\u3092 http://www.vagrantbox.es/ \u304b\u3089\u5165\u624b\u3059\u308b\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u73fe\u5728(\u30d0\u30fc\u30b8\u30e7\u30f31.8.1)\u3067\u306fhttps://atlas.hashicorp.com/boxes/search \u304b\u3089\u63a2\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3002\n\u3082\u3057\u304b\u3057\u305f\u3089 CentOS 7 \u306bPHP7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u304c\u3042\u308b\u306e\u304b\u3082\u3002\nvagrant up \u5f8c\u306b chef-repo/nodes/sample.json \u304c\u66f8\u304d\u63db\u3048\u3089\u308c\u3066\u3057\u307e\u3046\u3002\u4f55\u6545\u3060\u304b\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u60c5\u5831\u52df\u96c6\u3002\n\u4e0a\u3067\u4f5c\u3063\u305fVagrantfile\u3068\u30ec\u30b7\u30d4\u7b49\u306f https://github.com/okadabasso/vagrant-centos-php7 \u306b\u3042\u308a\u307e\u3059\u3002\n\nphp7(\u3068\u3001symfony) + mariadb10 \u3092\u4f7f\u3046\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\u306e\u305f\u3081\u306e\u74b0\u5883\u3092vagrant\u3067\u4f5c\u308b\u65b9\u6cd5\u3002  \nCentOS7.1\u306e\u30c7\u30d5\u30a9\u30eb\u30c8yum\u30ea\u30dd\u30b8\u30c8\u30ea\u3060\u3068php5.4\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3057\u3001remi\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u4e91\u3005\u3068\u3044\u308d\u3044\u308d\u9762\u5012\u306a\u306e\u3067chef\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u3002  \n\u307e\u305f\u3001\u958b\u767a\u6642\u306b\u306fapache\u3068\u304bnginx\u3092\u4f7f\u308f\u305aphp\u306e\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3067\u826f\u3044\u306e\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u78ba\u8a8d\u7528\u306e\u30dd\u30fc\u30c8(8000)\u3092\u958b\u3051\u3066\u304a\u304f\u306e\u3068\u3001symfony\u30b3\u30de\u30f3\u30c9\u3001composer\u30b3\u30de\u30f3\u30c9\u3092\u3044\u3061\u3044\u3061\u30ed\u30fc\u30c9\u3057\u305f\u304f\u306a\u3044\u306e\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3002  \n\n## \u74b0\u5883\u7b49\n\n* \u3053\u3053\u3067\u306fWindows10 + ChefDK + Vagrant + VirtualBox\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3002\n* Vagrant\u30d5\u30a1\u30a4\u30eb\u306e\u7f6e\u304d\u5834\u6240\u306f c:/vagrant/sample \u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\n\n## \u57fa\u672c\u7684\u306a\u6d41\u308c\n\n* Vagrantfile\u3092\u6e96\u5099\u3059\u308b\n* chef cookbook repository \u6e96\u5099\n* berkshelf \u3067\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u53d6\u308a\u8fbc\u3080\n* php7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n* firewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n* vagrant VM\u306b\u5bfe\u3059\u308bjson\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n* VM\u8d77\u52d5\n* \u52d5\u4f5c\u78ba\u8a8d\n\n\n## Vagrantfile\u3092\u6e96\u5099\u3059\u308b\n\nvagrant init \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u521d\u671fVagrantfile\u3092\u4f5c\u6210\u3059\u308b\u3002\n```\nPS > cd c:\\vagrant\\sample\nPS > vagrant init\n```\n\n\nc:/vagrant/sample/Vagrantfile \u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n\n```\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\nVagrant.configure(2) do |config|\n  config.vm.box = \"bento/centos-7.1\"\n  config.vm.network \"private_network\", ip: \"192.168.33.101\"\n  config.omnibus.chef_version = :latest\n  \n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.memory = \"1024\"\n  end\n  \n  config.vm.provision \"chef_zero\" do |chef|\n    chef.cookbooks_path = [\"chef-repo/cookbooks\", \"chef-repo/site-cookbooks\"]\n    chef.nodes_path = [\"chef-repo/nodes\"]\n    chef.node_name = \"sample\"\n  end\nend\n```\n\n## chef cookbook repository \u6e96\u5099\n\nchef generate \u30b3\u30de\u30f3\u30c9\u3067cookbook \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\n```\nPS > cd c:\\vagrant\\sample\nPS > chef generate repo chef-repo\n```\n\n## berkshelf \u3067\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u53d6\u308a\u8fbc\u3080\n\nchef-repo/BerksFile\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3059\u308b\n\n```\nsource \"https://supermarket.chef.io\"\n\ncookbook 'yum'\ncookbook 'yum-remi'\ncookbook 'yum-epel'\ncookbook 'mariadb'\n```\n\n\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n```\nPS > cd chef-repo\nPS > berks vendor cookbooks\n```\n\n## php7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n\nknife cookbook \u30b3\u30de\u30f3\u30c9\u3067php\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n\n```\nPS >  knife cookbook create php -o site-cookbooks\n```\n\nchef-repo/site-cookbooks/php/recipe/default.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n\n```\ninclude_recipe 'yum::default'\ninclude_recipe 'yum-remi::default'\n\n%w[\n  gd-last\n  t1lib\n].each do |pkg|\n    package \"#{pkg}\" do\n        action [ :install ]\n        options \"--enablerepo=remi\"\n    end\nend\n\n%w[\n  php\n  php-cli\n  php-common\n  php-gd\n  php-xml\n  php-pdo\n  php-mbstring\n  php-mysqlnd\n  php-opcache\n].each do |pkg|\n  package \"#{pkg}\" do\n    action :install\n    options '--enablerepo=remi-php70'\n  end\nend\n\nexecute \"composer-install\" do\n  command \"curl -sS https://getcomposer.org/installer | php ;mv composer.phar /usr/local/bin/composer\"\n  not_if { ::File.exists?(\"/usr/local/bin/composer\")}\nend\n\nexecute \"symfony-install\" do\n  command \"curl -LsS https://symfony.com/installer -o /usr/local/bin/symfony;chmod a+x /usr/local/bin/symfony\"\n  not_if { ::File.exists?(\"/usr/local/bin/symfony\")}\nend\n```\n\nphp-gd \u3092\u4f7f\u3046\u306e\u306b gd-last, t1lib\u304c\u5fc5\u8981\u306a\u306e\u3067\u3042\u3089\u304b\u3058\u3081 remi\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3042\u308b\u3002  \n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u9069\u5b9c\u8abf\u6574\u3002  \n\u307e\u305f\u3001symfony\u30b3\u30de\u30f3\u30c9\u3068composer\u30b3\u30de\u30f3\u30c9\u306f\u3042\u3068\u304b\u3089\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3092\u305f\u305f\u3044\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u3053\u306e\u6642\u70b9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u306eyum,yum-remi\u3092\u4f7f\u3046\u306e\u3067 chef-repo/site-cookbooks/php/metadata.rb \u306b\u4f9d\u5b58\u30ec\u30b7\u30d4\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n```\ndepends 'yum'\ndepends 'yum-remi'\n```\n\n## firewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n\napache\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u8a2d\u5b9a\u3068\u304b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u8a2d\u5b9a\u3068\u304b\u3084\u3089\u306a\u304f\u3066\u3044\u3044\u306e\u3067php\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u3046\u3002\u3053\u306e\u305f\u3081\u306b\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u304c\u4f7f\u3046\u30dd\u30fc\u30c8\u3092\u958b\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nknife cookbook \u30b3\u30de\u30f3\u30c9\u3067firewalld\u3092\u8a2d\u5b9a\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u6210\u3059\u308b\n\n```\nPS >  knife cookbook create init -o site-cookbooks\n```\n\nchef-repo/site-cookbooks/init/recipe/default.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n\n```\nservice \"firewalld\" do\n    supports [ :restart, :reload ]\n    action [ :enable, :start ]\nend\n\nexecute \"allow port 8000\" do\n    command \"firewall-cmd --add-port=8000/tcp --zone=public --permanent\"\n    notifies :restart, \"service[firewalld]\"\nend\n```\n\nfirewall-cmd \u3092\u4f7f\u3063\u3066 \u30dd\u30fc\u30c88000 \u3092\u958b\u3051\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u30ec\u30b7\u30d4\u306e\u540d\u524d\u304c \"firewalld\" \u3067\u306a\u304f \"init\" \u306a\u306e\u306f\u30ed\u30b1\u30fc\u30eb\u3068\u304b\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3068\u304b\u306e\u521d\u671f\u8a2d\u5b9a\u3082\u542b\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u305f\u3044\u3057\u3066\u610f\u5473\u306f\u306a\u3044\u3051\u3069\u3001\u305d\u306e\u8fba\u306f\u30ec\u30b7\u30d4\u4f5c\u6210\u30dd\u30ea\u30b7\u30fc\u6b21\u7b2c\u3002\n\n\n## vagrant VM\u306b\u5bfe\u3059\u308bjson\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067 chef-repo/nodes/sample.json\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```\n{\n  \"name\": \"sample\",\n  \"chef_type\": \"node\",\n  \"json_class\": \"Chef::Node\",\n  \"normal\":{\n    \"mariadb\": {\n      \"use_default_repository\": true,\n      \"allow_root_pass_change\": true,\n      \"server_root_password\": \"test\",\n      \"install\": {\n        \"type\": \"package\",\n        \"version\": \"10.1.13\",\n        \"prefer_os_package\": false\n      },\n      \"mysqld\": {\n        \"options\":{\n          \"collation-server\" : \"utf8_unicode_ci\",\n          \"init-connect\" : \"'SET NAMES utf8'\",\n          \"character-set-server\" : \"utf8\"\n        }\n      },\n      \"innodb\": {\n          \"log_file_size\": \"\",\n          \"bps_percentage_memory\": false,\n          \"buffer_pool_size\": \"256M\",\n          \"log_buffer_size\": \"8M\",\n          \"file_per_table\": \"1\",\n          \"open_files\": \"400\",\n          \"io_capacity\": \"400\",\n          \"flush_method\": \"O_DIRECT\",\n          \"options\": {\n\n          }\n      }     \n    },\n    \"yum\": {\n      \"remi-php70\": {\n        \"repositoryid\": \"remi-php70\",\n        \"baseurl\": \"http://rpms.famillecollet.com/enterprise/7/php70/x86_64/\",\n        \"description\": \"Les RPM de remi de PHP 7 pour Enterprise Linux 7 - $basearch\",\n        \"mirrorlist\": \"http://rpms.famillecollet.com/enterprise/7/php70/mirror\"\n      }\n    },\n    \"yum-remi\": {\n      \"repositories\": [\n        \"remi\",\n        \"remi-php70\"\n      ]\n    }\n  },  \n  \"run_list\": [\n    \"recipe[yum]\",\n    \"recipe[yum-epel]\",\n    \"recipe[mariadb::server]\",\n    \"recipe[mariadb::client]\",\n    \"recipe[php]\",\n    \"recipe[init]\"\n      \n  ]\n}\n```\n\nmariadb\u306eattributes\u306f\u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u3002root\u30d1\u30b9\u30ef\u30fc\u30c9\u306fdatabag\u7b49\u3067\u66f8\u304f\u3079\u304d\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u3088\u304f\u3042\u308bvagrant\u306e\u89e3\u8aac\u3067\u306f Vagrantfile\u306b\u5c5e\u6027\u3068\u304b\u5b9f\u884c\u30ec\u30b7\u30d4\u3068\u304b\u3092 chef.runlist =[] \u3068\u304b chef.json={}\u3068\u304b\u8a18\u8ff0\u3057\u3066\u3044\u308b\u3051\u308c\u3069\u3082\u6700\u7d42\u7684\u306b\u306f\u8a18\u8ff0\u3057\u305f\u30ec\u30b7\u30d4\u3068\u8a2d\u5b9a\u3092vagrant\u3067\u306f\u306a\u304f\u5b9f\u74b0\u5883\u306b\u9069\u7528\u3057\u305f\u304f\u306a\u308b\u306e\u3067nodes/json\u306b\u8a18\u8ff0\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n## VM\u8d77\u52d5\n\n\u6e96\u5099\u304c\u3067\u304d\u305f\u3089VM\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nPS > cd c:\\vagrant\\sample\nPS > vagrant up\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bphp\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066 php \u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u3001\u30db\u30b9\u30c8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n /vagrant/check/info.php\n```\n<?php\nphpinfo();\n```\n\n\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\n\n```\n$> php -S 0.0.0.0:8000\n```\n\n\u30db\u30b9\u30c8\u304b\u3089 http://192.168.33.101/info.php \u306b \u30a2\u30af\u30bb\u30b9\n\n\n## \u305d\u306e\u4ed6\n\n* \"\u30ec\u30b7\u30d4\u306f\u4e0a\u304b\u3089\u9806\u306b\u5b9f\u884c\u3055\u308c\u306a\u3044\"\u3068\u3044\u3046\u8a71\u306a\u306e\u3067\u3001php-gd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u304b\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n* nodes|environments|data_bags\u306e\u4f7f\u3044\u5206\u3051\u3001\u512a\u5148\u9806\u4f4d\u304c\u4eca\u4e00\u308f\u304b\u3089\u306a\u3044\u3002\n* \u3061\u3087\u3063\u3068\u53e4\u3044\u89e3\u8aac\u3060\u3068 box\u30d5\u30a1\u30a4\u30eb\u3092 http://www.vagrantbox.es/ \u304b\u3089\u5165\u624b\u3059\u308b\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u73fe\u5728(\u30d0\u30fc\u30b8\u30e7\u30f31.8.1)\u3067\u306fhttps://atlas.hashicorp.com/boxes/search \u304b\u3089\u63a2\u3057\u305f\u307b\u3046\u304c\u826f\u3044\u3002\n* \u3082\u3057\u304b\u3057\u305f\u3089 CentOS 7 \u306bPHP7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u30ec\u30b7\u30d4\u304c\u3042\u308b\u306e\u304b\u3082\u3002\n* vagrant up \u5f8c\u306b chef-repo/nodes/sample.json \u304c\u66f8\u304d\u63db\u3048\u3089\u308c\u3066\u3057\u307e\u3046\u3002\u4f55\u6545\u3060\u304b\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u60c5\u5831\u52df\u96c6\u3002\n* \u4e0a\u3067\u4f5c\u3063\u305fVagrantfile\u3068\u30ec\u30b7\u30d4\u7b49\u306f https://github.com/okadabasso/vagrant-centos-php7 \u306b\u3042\u308a\u307e\u3059\u3002\n", "tags": ["vagrant", "PHP", "mariadb", "chef"]}