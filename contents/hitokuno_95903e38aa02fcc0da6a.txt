{"context": "\u30c6\u30b9\u30c8\u3001\u52c9\u5f37\u306e\u70ba\u3001\u51fa\u6765\u308b\u3060\u3051\u7c21\u5358\u306bPuppet\u306eMaster/Agent\u69cb\u6210\u3092\u4f5c\u308b\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\nRHEL 7.2\nPuppet 4.4.2\nMaster\u306ehostname rhel7, rhel7.local\u3067\u898b\u3064\u304b\u308b\nAgent\u306ehostname rhel7agent, rhel7agent.local\u3067\u898b\u3064\u304b\u308b\n\n\nMaster\u8a2d\u5b9a\nrpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\nyum install -y puppet\nyum install -y puppetserver\nexport PATH=/opt/puppetlabs/bin:$PATH\n/opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true\npuppet apply -e \"user { 'jargyle': ensure => present, }\"\npuppet apply -e \"group { 'web': ensure => present, }\"\npuppet resource group web > /etc/puppetlabs/code/environments/production/manifests/site.pp\npuppet resource user jargyle | sed -e 's/gid.*/comment          => '\\''Judy Argyle'\\'',\\n  groups           => '\\''web'\\'',/' >> /etc/puppetlabs/code/environments/production/manifests/site.pp\necho \"\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"[main]\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"dns_alt_names = rhel7,rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"certname = rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\nfirewall-cmd --zone=public --add-port=8140/tcp --permanent\nsystemctl restart firewalld\npuppet master --verbose  # This command daemonize puppet\n\n\nAgent\u8a2d\u5b9a\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nrpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\nyum install -y puppet\nexport PATH=/opt/puppetlabs/bin:$PATH\necho \"\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"[agent]\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"server = rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\n\n\n\n\u30c6\u30b9\u30c8\nCertificate\u304cMaster\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u5fc5\u305a\u5931\u6557\u3057\u307e\u3059\u3002\n# puppet agent -t\nInfo: Caching certificate for ca\nInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\nInfo: Creating a new SSL certificate request for rhel7agent\nInfo: Certificate Request fingerprint (SHA256): 92:91:97:A5:2B:9D:C8:3C:51:20:2F:66:11:01:70:46:8F:70:C9:E6:3F:E7:E6:96:57:31:93:A3:1A:1A:85:8B\nInfo: Caching certificate for ca\nExiting; no certificate found and waitforcert is disabled\n\n\n\n\nMater\u3067Agent\u3092\u30b5\u30a4\u30f3\n\n\n\u7533\u8acb\u3092\u78ba\u8a8d\n# puppet cert list\n\"rhel7agent\" (SHA256) 92:91:97:A5:2B:9D:C8:3C:51:20:2F:66:11:01:70:46:8F:70:C9:E6:3F:E7:E6:96:57:31:93:A3:1A:1A:85:8B\n\n\n\n\u30b5\u30a4\u30f3\n# puppet cert sign rhel7agent\nNotice: Signed certificate request for rhel7agent\nNotice: Removing file Puppet::SSL::CertificateRequest rhel7agent at '/etc/puppetlabs/puppet/ssl/ca/requests/rhel7agent.pem'\n\n\n\n\nMater\u306bAgent\u306e\u5b9a\u7fa9(manifests)\u767b\u9332\n\n\napache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb  \n\n/etc/puppetlabs/code/environments/production/manifests/site.pp\ngroup { 'web':\nensure => 'present',\ngid    => '1002',\n}\nuser { 'jargyle':\nensure           => 'present',\ncomment          => 'Judy Argyle',\ngroups           => 'web',\nhome             => '/home/jargyle',\npassword         => '!!',\npassword_max_age => '99999',\npassword_min_age => '0',\nshell            => '/bin/bash',\nuid              => '1001',\n}\nnode 'rhel7agent' {\n          package { 'httpd' :\n          ensure => installed,\n                   }\n}\n\n\n\n\n\nAgent\u3067\u53d6\u308a\u8fbc\u3080\n\n\n\u9069\u7528\n# puppet agent --onetime --no-daemonize --verbose\nInfo: Using configured environment 'production'\nInfo: Retrieving pluginfacts\nInfo: Retrieving plugin\nInfo: Caching catalog for rhel7agent\nInfo: Applying configuration version '1462547748'\nNotice: /Stage[main]/Main/Group[web]/ensure: created\nNotice: /Stage[main]/Main/User[jargyle]/ensure: created\nNotice: /Stage[main]/Main/Node[rhel7agent]/Package[httpd]/ensure: created\nInfo: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml\nNotice: Applied catalog in 32.74 seconds\n\n\n\n\n\u3053\u306e\u5f8c\nPuppet\u3092\u4f7f\u3063\u305fLinux\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a\u81ea\u52d5\u7ba1\u7406\u3092\u8aad\u3093\u3067\u3044\u3051\u3070\u4e0a\u624b\u304f\u884c\u304f\u7b48\u3001\u3001\u3001\n\n\u53c2\u8003\n\nIT'z Geek Install and Configure Puppet on CentOS 7 / RHEL 7\n\nPuppet\u516c\u5f0f Installing Puppet: Red Hat Enterprise Linux (and Derivatives)\n\nPuppet\u3092\u4f7f\u3063\u305fLinux\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a\u81ea\u52d5\u7ba1\u7406\n\n\u30c6\u30b9\u30c8\u3001\u52c9\u5f37\u306e\u70ba\u3001\u51fa\u6765\u308b\u3060\u3051\u7c21\u5358\u306bPuppet\u306eMaster/Agent\u69cb\u6210\u3092\u4f5c\u308b\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n# \u524d\u63d0\u6761\u4ef6\n* RHEL 7.2\n* Puppet 4.4.2\n* Master\u306ehostname rhel7, rhel7.local\u3067\u898b\u3064\u304b\u308b\n* Agent\u306ehostname rhel7agent, rhel7agent.local\u3067\u898b\u3064\u304b\u308b\n\n# Master\u8a2d\u5b9a\n\n``` code\nrpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\nyum install -y puppet\nyum install -y puppetserver\nexport PATH=/opt/puppetlabs/bin:$PATH\n/opt/puppetlabs/bin/puppet resource service puppet ensure=running enable=true\npuppet apply -e \"user { 'jargyle': ensure => present, }\"\npuppet apply -e \"group { 'web': ensure => present, }\"\npuppet resource group web > /etc/puppetlabs/code/environments/production/manifests/site.pp\npuppet resource user jargyle | sed -e 's/gid.*/comment          => '\\''Judy Argyle'\\'',\\n  groups           => '\\''web'\\'',/' >> /etc/puppetlabs/code/environments/production/manifests/site.pp\necho \"\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"[main]\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"dns_alt_names = rhel7,rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"certname = rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\nfirewall-cmd --zone=public --add-port=8140/tcp --permanent\nsystemctl restart firewalld\npuppet master --verbose  # This command daemonize puppet\n```\n\n# Agent\u8a2d\u5b9a\n* \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n    ```\nrpm -Uvh https://yum.puppetlabs.com/puppetlabs-release-pc1-el-7.noarch.rpm\nyum install -y puppet\nexport PATH=/opt/puppetlabs/bin:$PATH\necho \"\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"[agent]\" >> /etc/puppetlabs/puppet/puppet.conf\necho \"server = rhel7.local\" >> /etc/puppetlabs/puppet/puppet.conf\n```\n* \u30c6\u30b9\u30c8\nCertificate\u304cMaster\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u5fc5\u305a\u5931\u6557\u3057\u307e\u3059\u3002\n\n    ```\n# puppet agent -t\nInfo: Caching certificate for ca\nInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\nInfo: Creating a new SSL certificate request for rhel7agent\nInfo: Certificate Request fingerprint (SHA256): 92:91:97:A5:2B:9D:C8:3C:51:20:2F:66:11:01:70:46:8F:70:C9:E6:3F:E7:E6:96:57:31:93:A3:1A:1A:85:8B\nInfo: Caching certificate for ca\nExiting; no certificate found and waitforcert is disabled\n```\n\n# Mater\u3067Agent\u3092\u30b5\u30a4\u30f3\n* \u7533\u8acb\u3092\u78ba\u8a8d\n\n    ```\n# puppet cert list\n  \"rhel7agent\" (SHA256) 92:91:97:A5:2B:9D:C8:3C:51:20:2F:66:11:01:70:46:8F:70:C9:E6:3F:E7:E6:96:57:31:93:A3:1A:1A:85:8B\n```\n* \u30b5\u30a4\u30f3\n\n    ```\n# puppet cert sign rhel7agent\nNotice: Signed certificate request for rhel7agent\nNotice: Removing file Puppet::SSL::CertificateRequest rhel7agent at '/etc/puppetlabs/puppet/ssl/ca/requests/rhel7agent.pem'\n```\n\n# Mater\u306bAgent\u306e\u5b9a\u7fa9(manifests)\u767b\u9332\n* apache\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb  \n\n    ``` /etc/puppetlabs/code/environments/production/manifests/site.pp\ngroup { 'web':\n  ensure => 'present',\n  gid    => '1002',\n}\nuser { 'jargyle':\n  ensure           => 'present',\n  comment          => 'Judy Argyle',\n  groups           => 'web',\n  home             => '/home/jargyle',\n  password         => '!!',\n  password_max_age => '99999',\n  password_min_age => '0',\n  shell            => '/bin/bash',\n  uid              => '1001',\n}\nnode 'rhel7agent' {\n              package { 'httpd' :\n              ensure => installed,\n                       }\n}\n```\n\n# Agent\u3067\u53d6\u308a\u8fbc\u3080\n* \u9069\u7528\n\n    ```\n# puppet agent --onetime --no-daemonize --verbose\nInfo: Using configured environment 'production'\nInfo: Retrieving pluginfacts\nInfo: Retrieving plugin\nInfo: Caching catalog for rhel7agent\nInfo: Applying configuration version '1462547748'\nNotice: /Stage[main]/Main/Group[web]/ensure: created\nNotice: /Stage[main]/Main/User[jargyle]/ensure: created\nNotice: /Stage[main]/Main/Node[rhel7agent]/Package[httpd]/ensure: created\nInfo: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml\nNotice: Applied catalog in 32.74 seconds\n```\n\n# \u3053\u306e\u5f8c\n[Puppet\u3092\u4f7f\u3063\u305fLinux\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a\u81ea\u52d5\u7ba1\u7406](http://knowledge.sakura.ad.jp/tech/755/)\u3092\u8aad\u3093\u3067\u3044\u3051\u3070\u4e0a\u624b\u304f\u884c\u304f\u7b48\u3001\u3001\u3001\n\n# \u53c2\u8003\n* IT'z Geek [Install and Configure Puppet on CentOS 7 / RHEL 7](http://www.itzgeek.com/how-tos/linux/centos-how-tos/install-and-configure-puppet-on-centos-7-rhel-7.html)\n* Puppet\u516c\u5f0f [Installing Puppet: Red Hat Enterprise Linux (and Derivatives)](https://docs.puppet.com/puppet/3.8/reference/install_el.html)\n* [Puppet\u3092\u4f7f\u3063\u305fLinux\u30b7\u30b9\u30c6\u30e0\u306e\u8a2d\u5b9a\u81ea\u52d5\u7ba1\u7406](http://knowledge.sakura.ad.jp/tech/755/)\n", "tags": ["REHL7", "Puppet"]}