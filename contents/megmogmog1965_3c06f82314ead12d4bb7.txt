{"tags": ["dns", "consul"], "context": " More than 1 year has passed since last update.\n\n\u3057\u305f\u3044\u3053\u3068\nConsul\u306b\u767b\u9332\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u540d\u3067 $ host xxx \u3068\u304b\u3001$ curl xxx, $ ping xxx \u307f\u305f\u3044\u306b\u3001Unix OS\u304b\u3089\u666e\u901a\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u3002\n\nnote\n\n\nsudo \u3068\u304b\u306f\u7701\u7565\u3057\u3066\u307e\u3059\nAmazon Linux (AWS) \u3067\u8a66\u3057\u3066\u3044\u307e\u3059\n\u7c21\u5358\u306e\u70ba /etc/resolv.conf \u3092\u76f4\u63a5\u5f04\u3063\u3066\u3044\u307e\u3059 (\u3042\u307e\u308a\u826f\u304f\u306a\u3044)\nAmazon Linux\u306e /etc/resolv.conf \u306fnetwork\u518d\u8d77\u52d5\u3067\u5143\u306b\u623b\u3063\u3061\u3083\u3044\u307e\u3059\n\n\n\u624b\u9806\ndocker-consul \u304c\u7121\u3044\u3068\u59cb\u307e\u3089\u306a\u3044\u306e\u3067\u3001Run\u3059\u308b.\n$ docker run -d -p 8400:8400 -p 8500:8500 -p 8600:53/udp -h node1 --name consul progrium/consul -server -bootstrap -ui-dir /ui\n\n\u7acb\u3061\u4e0a\u304c\u3063\u305fdocker container\u306eIP\u3092\u77e5\u308a\u305f\u3044.\n$ docker inspect -f '{{.NetworkSettings.IPAddress}}' consul\n\n172.17.0.1\n\nConsul\u306eIP\u3092 /etc/resolv.conf \u306b nameserver xxx.xxx.xxx.xxx \u3068\u66f8\u304f.\nConsul\u304c\u7ba1\u7406\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u304c service.dc1.consul \u306a\u306e\u3067\u3001search ... \u306b\u8ffd\u8a18\u3059\u308b.\n; generated by /sbin/dhclient-script\nsearch ap-northeast-1.compute.internal service.dc1.consul  ; service.dc1.consul\u3092\u8ffd\u52a0.\nnameserver 172.17.0.1  ; \u3053\u306e\u884c\u3092\u8ffd\u52a0.\nnameserver 172.31.0.2\n\n\nAmazon Linux\u306e\u5834\u5408\u3001Consul\u306eIP\u3092\u65e2\u5b58\u306enameserver 172.31.0.2 \u3088\u308a\u5148\u306b\u8a18\u8ff0\u3057\u306a\u3044\u3068\u3001\u540d\u524d\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u3002\n\n\n\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n$ host any-service-name\n\nany-service-name.service.dc1.consul has address 172.17.0.2\n\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u767b\u9332\u65b9\u6cd5\u306f\uff1f\nConsul\u3092DNS\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u4f7f\u3046 \u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n## \u3057\u305f\u3044\u3053\u3068\n\nConsul\u306b\u767b\u9332\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u540d\u3067 ``$ host xxx`` \u3068\u304b\u3001``$ curl xxx``, ``$ ping xxx`` \u307f\u305f\u3044\u306b\u3001Unix OS\u304b\u3089\u666e\u901a\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u3002\n\n\n## note\n\n* ``sudo`` \u3068\u304b\u306f\u7701\u7565\u3057\u3066\u307e\u3059\n* Amazon Linux (AWS) \u3067\u8a66\u3057\u3066\u3044\u307e\u3059\n* \u7c21\u5358\u306e\u70ba ``/etc/resolv.conf`` \u3092\u76f4\u63a5\u5f04\u3063\u3066\u3044\u307e\u3059 (\u3042\u307e\u308a\u826f\u304f\u306a\u3044)\n* Amazon Linux\u306e ``/etc/resolv.conf`` \u306fnetwork\u518d\u8d77\u52d5\u3067\u5143\u306b\u623b\u3063\u3061\u3083\u3044\u307e\u3059\n\n\n## \u624b\u9806\n\n[docker-consul] \u304c\u7121\u3044\u3068\u59cb\u307e\u3089\u306a\u3044\u306e\u3067\u3001Run\u3059\u308b.\n\n```\n$ docker run -d -p 8400:8400 -p 8500:8500 -p 8600:53/udp -h node1 --name consul progrium/consul -server -bootstrap -ui-dir /ui\n```\n\n\u7acb\u3061\u4e0a\u304c\u3063\u305fdocker container\u306eIP\u3092\u77e5\u308a\u305f\u3044.\n\n```\n$ docker inspect -f '{{.NetworkSettings.IPAddress}}' consul\n\n172.17.0.1\n```\n\nConsul\u306eIP\u3092 ``/etc/resolv.conf`` \u306b ``nameserver xxx.xxx.xxx.xxx`` \u3068\u66f8\u304f.\nConsul\u304c\u7ba1\u7406\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u304c ``service.dc1.consul`` \u306a\u306e\u3067\u3001``search ...`` \u306b\u8ffd\u8a18\u3059\u308b.\n\n```\n; generated by /sbin/dhclient-script\nsearch ap-northeast-1.compute.internal service.dc1.consul  ; service.dc1.consul\u3092\u8ffd\u52a0.\nnameserver 172.17.0.1  ; \u3053\u306e\u884c\u3092\u8ffd\u52a0.\nnameserver 172.31.0.2\n```\n\n> Amazon Linux\u306e\u5834\u5408\u3001Consul\u306eIP\u3092\u65e2\u5b58\u306enameserver ``172.31.0.2`` \u3088\u308a\u5148\u306b\u8a18\u8ff0\u3057\u306a\u3044\u3068\u3001\u540d\u524d\u89e3\u6c7a\u3067\u304d\u306a\u304b\u3063\u305f\u3002\n\n## \u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\n```\n$ host any-service-name\n\nany-service-name.service.dc1.consul has address 172.17.0.2\n```\n\n\n## \u30b5\u30fc\u30d3\u30b9\u306e\u767b\u9332\u65b9\u6cd5\u306f\uff1f\n\n[Consul\u3092DNS\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u4f7f\u3046] \u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\n\n[docker-consul]:https://github.com/gliderlabs/docker-consul\n[Consul\u3092DNS\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u4f7f\u3046]:http://qiita.com/megmogmog1965/items/2c1e72932ea958fb1831\n\n"}