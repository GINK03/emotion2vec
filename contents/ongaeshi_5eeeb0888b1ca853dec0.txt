{"tags": ["mruby", "kokuban", "rubykokuban", "Ruby"], "context": " More than 1 year has passed since last update.RubyKokuban\u306e Image#map_pixels \u3092\u4f7f\u3063\u3066\u66f8\u3044\u305f\u3002\u3053\u3046\u3044\u3046\u306e\u306fRubyKokuban\u304c\u5f97\u610f\u3068\u3057\u3066\u3044\u308b\u3002\n\ndef setup\n  set_window_size(520, 420)\n  set_background(Color::Linen)\n  @image = Image.load(\"red-flower.jpg\")\n  @rate = 0.0\n  @frame = 0\n  @image_gray = gray(@image, @rate)\nend\n\ndef update\n  @frame += 1\n  @rate += 0.003\n  @rate -= 1.0 if @rate > 1.0\n  @image_gray = gray(@image, @rate) if @frame % 10 == 0\n\n  # @sequence_shot = SequenceShot.new(10, 40) unless @sequence_shot\n  # @sequence_shot.update\nend\n\ndef draw\n  x = 10; y = 30\n  set_color(Color::White)\n  @image_gray.draw(x, y, @image_gray.width * 2.5, @image_gray.height * 2.5)\n\n  # debug info\n  set_color(0, 0, 0)\n  # text(DebugInfo.fps, 10, 15)\n  text(\"gray rate: #{@rate}\", 10, 15)\nend\n\n# ----------------------------------------------------------\n\ndef gray(image, rate)\n  image.map_pixels do |x, y|\n    c = image.color(x, y)\n    b = c.brightness\n    Color.new(c.r * (1.0 - rate) + b * rate,\n              c.g * (1.0 - rate) + b * rate,\n              c.b * (1.0 - rate) + b * rate,\n              c.a)\n  end\nend\n\n\ngif\u30a2\u30cb\u30e1\u306e\u4f5c\u308a\u65b9\n  # @sequence_shot = SequenceShot.new(10, 40) unless @sequence_shot\n  # @sequence_shot.update\n\n\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068sequence_shot_xxx.png\u3068\u3044\u3046\u540d\u524d\u3067\u9023\u756a\u753b\u50cf\u304c\u4f5c\u3089\u308c\u308b\u3002\n\u305d\u306e\u5f8c\u3067ImageMagick\u3092\u4f7f\u3063\u3066gif\u30a2\u30cb\u30e1\u306b\u5909\u63db\u3059\u308b\u3002 \n$ convert -layers optimize -loop 0 -delay 36 sequence_shot_*.png gray_anim.gif\n\n\n[RubyKokuban](http://ongaeshi.hatenablog.com/entry/rubykokuban-release)\u306e `Image#map_pixels` \u3092\u4f7f\u3063\u3066\u66f8\u3044\u305f\u3002\u3053\u3046\u3044\u3046\u306e\u306fRubyKokuban\u304c\u5f97\u610f\u3068\u3057\u3066\u3044\u308b\u3002\n\n![gray-anim.gif](http://d3j5vwomefv46c.cloudfront.net/photos/large/814276272.gif?1381423434)\n\n```ruby\ndef setup\n  set_window_size(520, 420)\n  set_background(Color::Linen)\n  @image = Image.load(\"red-flower.jpg\")\n  @rate = 0.0\n  @frame = 0\n  @image_gray = gray(@image, @rate)\nend\n\ndef update\n  @frame += 1\n  @rate += 0.003\n  @rate -= 1.0 if @rate > 1.0\n  @image_gray = gray(@image, @rate) if @frame % 10 == 0\n\n  # @sequence_shot = SequenceShot.new(10, 40) unless @sequence_shot\n  # @sequence_shot.update\nend\n\ndef draw\n  x = 10; y = 30\n  set_color(Color::White)\n  @image_gray.draw(x, y, @image_gray.width * 2.5, @image_gray.height * 2.5)\n\n  # debug info\n  set_color(0, 0, 0)\n  # text(DebugInfo.fps, 10, 15)\n  text(\"gray rate: #{@rate}\", 10, 15)\nend\n\n# ----------------------------------------------------------\n\ndef gray(image, rate)\n  image.map_pixels do |x, y|\n    c = image.color(x, y)\n    b = c.brightness\n    Color.new(c.r * (1.0 - rate) + b * rate,\n              c.g * (1.0 - rate) + b * rate,\n              c.b * (1.0 - rate) + b * rate,\n              c.a)\n  end\nend\n```\n\n## gif\u30a2\u30cb\u30e1\u306e\u4f5c\u308a\u65b9\n\n```ruby\n  # @sequence_shot = SequenceShot.new(10, 40) unless @sequence_shot\n  # @sequence_shot.update\n```\n\n\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068`sequence_shot_xxx.png`\u3068\u3044\u3046\u540d\u524d\u3067\u9023\u756a\u753b\u50cf\u304c\u4f5c\u3089\u308c\u308b\u3002\n\n\u305d\u306e\u5f8c\u3067[ImageMagick\u3092\u4f7f\u3063\u3066](http://qiita.com/ongaeshi/items/21fceae420b7330b0c1b)gif\u30a2\u30cb\u30e1\u306b\u5909\u63db\u3059\u308b\u3002 \n\n```\n$ convert -layers optimize -loop 0 -delay 36 sequence_shot_*.png gray_anim.gif\n```\n"}