{"context": "\n\n\u306f\u3058\u3081\u306b\nAWS Lambda\u304cVPC\u306b\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306eRDS\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nPython\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u306e\u3067\u3001\u624b\u9806\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nPython Lambda\u304b\u3089RDS\u3078\u306e\u63a5\u7d9a\u306fMySQL-python\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5408\u308f\u305b\u3066zip\u5727\u7e2e\u3057\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fEC2(Amazon Linux AMI 2016.03.0)\u3067\u6e96\u5099\u3057\u305f\u3068\u304d\u306e\u624b\u9806\u3067\u3059\u3002\n\n\u6e96\u5099\n\u30c6\u30b9\u30c8\u7528RDS\u3092\u7528\u610f\u3057\u307e\u3059\u3002\nhttp://qiita.com/Keisuke69/items/cba4b501e91da95188f8\n\u3053\u3053\u3068\u540c\u3058\u624b\u9806\u3067\u3001RDS(MySQL)\u306e\u8d77\u52d5\u3068\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n$ mkdir lambda-rds\n$ cd lambda-rds/\n\n\npip\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\n$ sudo pip install --upgrade pip\n\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum -y install mysql mysql-devel gcc\n\n\nMySQL-python\u3092\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u305d\u306e\u307e\u307e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001\nException:\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/site-packages/pip/basecommand.py\", line 209, in main\n    status = self.run(options, args)\n  File \"/usr/local/lib/python2.7/site-packages/pip/commands/install.py\", line 357, in run\n    for item in os.listdir(lib_dir):\nOSError: [Errno 2] \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093: '/tmp/tmpxhz25M/lib/python'\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nsetup.cfg\n[install]\ninstall-purelib=$base/lib64/python\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\npip\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3059\u308b\u3068pip\u306e\u30d1\u30b9\u304c/usr/bin\u304b\u3089/usr/local/bin\u306b\u4ee3\u308f\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u30d5\u30eb\u30d1\u30b9\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n$ /usr/local/bin/pip install MySQL-python -t .\n\n$ ls\nMySQL_python-1.2.5.egg-info\nMySQLdb\n_mysql.so\n_mysql_exceptions.py\n_mysql_exceptions.pyc\nsetup.cfg\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u30d5\u30a1\u30a4\u30eb\u540d\u306flambda_function.py\u3001\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u540d\u306flambda_handler\u306b\u3057\u307e\u3059\u3002\n\nlambda_function.py\nimport MySQLdb\n\ndef lambda_handler(event, context):\n\n  connect = MySQLdb.connect(host='lambda.xxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com', db=\"lambda\", user=\"lambda\", passwd=\"XXXXXXXX\")\n  connect.cursorclass = MySQLdb.cursors.DictCursor\n  cursor = connect.cursor()\n  cursor.execute('SELECT * FROM sample')\n  row = cursor.fetchone()\n  cursor.close()\n  connect.close()\n  return  row\n\n\n\nShared Object File\u306e\u30b3\u30d4\u30fc\nlibmysqlclient.so.18\u3092\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ cp /usr/lib64/mysql/libmysqlclient.so.18 .\n\n\u3053\u308c\u304c\u306a\u3044\u3068lambda\u5b9f\u884c\u6642\u306b\u3001\n\nUnable to import module 'lambda_function': libmysqlclient.so.18: cannot open shared object file: No such file or directory\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://www.iheavy.com/2016/02/14/getting-errors-building-amazon-lambda-python-functions-help-howto/\n\n\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3059\u3079\u3066\u3092zip\u5727\u7e2e\n$ zip -r upload.zip *\n\n\nAWS\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda Function\u306e\u4f5c\u6210\n\nSelect blueprint \u2192 Skip\n\nConfigure function\n\nName: \u9069\u5f53\nDescription: \u9069\u5f53\nRuntime: Python 2.7\n\n\n\nLambda function code\n\nCode entry type: Upload a .ZIP file \u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001upload.zip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n\n\nLambda function handler and role\n\nHandler: lambda_function.lambda_handler   (\u30d5\u30a1\u30a4\u30eb\u540d.\u95a2\u6570\u540d)\nRole: Basic with VPC \u3092\u9078\u629e\nRole Name\u3092\u7de8\u96c6\u3057\u3001Allow\u3092\u9078\u629e\n\n\n\nAdvanced settings\n\nVPC: RDS\u306eVPC\u3092\u9078\u629e\nSubnets: \u30c7\u30d5\u30a9\u30eb\u30c8(\u5168\u9078\u629e) \u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u56fa\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001\u9078\u629e\nSecurity Groups: RDS\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\n\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nInput test event\u306f\u305d\u306e\u307e\u307e\u3067\u3001Test\n\u3053\u3093\u306a\u611f\u3058\u3067\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n{\n  \"id\": 1,\n  \"value\": \"test\"\n}\n\n# \u306f\u3058\u3081\u306b\n\nAWS Lambda\u304cVPC\u306b\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306eRDS\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nPython\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u306e\u3067\u3001\u624b\u9806\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nPython Lambda\u304b\u3089RDS\u3078\u306e\u63a5\u7d9a\u306fMySQL-python\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5408\u308f\u305b\u3066zip\u5727\u7e2e\u3057\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fEC2(Amazon Linux AMI 2016.03.0)\u3067\u6e96\u5099\u3057\u305f\u3068\u304d\u306e\u624b\u9806\u3067\u3059\u3002\n\n# \u6e96\u5099\n\n\u30c6\u30b9\u30c8\u7528RDS\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nhttp://qiita.com/Keisuke69/items/cba4b501e91da95188f8\n\n\u3053\u3053\u3068\u540c\u3058\u624b\u9806\u3067\u3001RDS(MySQL)\u306e\u8d77\u52d5\u3068\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\n# \u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\n```bash\n$ mkdir lambda-rds\n$ cd lambda-rds/\n```\n\n# pip\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\n\n```bash\n$ sudo pip install --upgrade pip\n```\n\n\n# \u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo yum -y install mysql mysql-devel gcc\n```\n\n# MySQL-python\u3092\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u305d\u306e\u307e\u307e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001\n\n```\nException:\nTraceback (most recent call last):\n  File \"/usr/local/lib/python2.7/site-packages/pip/basecommand.py\", line 209, in main\n    status = self.run(options, args)\n  File \"/usr/local/lib/python2.7/site-packages/pip/commands/install.py\", line 357, in run\n    for item in os.listdir(lib_dir):\nOSError: [Errno 2] \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093: '/tmp/tmpxhz25M/lib/python'\n```\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```setup.cfg\n[install]\ninstall-purelib=$base/lib64/python\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\npip\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3059\u308b\u3068pip\u306e\u30d1\u30b9\u304c/usr/bin\u304b\u3089/usr/local/bin\u306b\u4ee3\u308f\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u30d5\u30eb\u30d1\u30b9\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ /usr/local/bin/pip install MySQL-python -t .\n\n$ ls\nMySQL_python-1.2.5.egg-info\nMySQLdb\n_mysql.so\n_mysql_exceptions.py\n_mysql_exceptions.pyc\nsetup.cfg\n```\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u306flambda_function.py\u3001\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u540d\u306flambda_handler\u306b\u3057\u307e\u3059\u3002\n\n```python:lambda_function.py\nimport MySQLdb\n\ndef lambda_handler(event, context):\n\n  connect = MySQLdb.connect(host='lambda.xxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com', db=\"lambda\", user=\"lambda\", passwd=\"XXXXXXXX\")\n  connect.cursorclass = MySQLdb.cursors.DictCursor\n  cursor = connect.cursor()\n  cursor.execute('SELECT * FROM sample')\n  row = cursor.fetchone()\n  cursor.close()\n  connect.close()\n  return  row\n```\n\n# Shared Object File\u306e\u30b3\u30d4\u30fc\n\nlibmysqlclient.so.18\u3092\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```bash\n$ cp /usr/lib64/mysql/libmysqlclient.so.18 .\n```\n\n\u3053\u308c\u304c\u306a\u3044\u3068lambda\u5b9f\u884c\u6642\u306b\u3001\n\n> Unable to import module 'lambda_function': libmysqlclient.so.18: cannot open shared object file: No such file or directory\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nhttp://www.iheavy.com/2016/02/14/getting-errors-building-amazon-lambda-python-functions-help-howto/\n\n# \u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3059\u3079\u3066\u3092zip\u5727\u7e2e\n\n```bash\n$ zip -r upload.zip *\n```\n\n# AWS\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda Function\u306e\u4f5c\u6210\n\n- Select blueprint \u2192 Skip\n\n- Configure function\n    - Name: \u9069\u5f53\n    - Description: \u9069\u5f53\n    - Runtime: Python 2.7\n  \n- Lambda function code\n    - Code entry type: Upload a .ZIP file \u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001upload.zip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n- Lambda function handler and role\n    - Handler: lambda_function.lambda_handler   (\u30d5\u30a1\u30a4\u30eb\u540d.\u95a2\u6570\u540d)\n    - Role: Basic with VPC \u3092\u9078\u629e\n    - Role Name\u3092\u7de8\u96c6\u3057\u3001Allow\u3092\u9078\u629e\n\n-  Advanced settings\n    - VPC: RDS\u306eVPC\u3092\u9078\u629e\n    - Subnets: \u30c7\u30d5\u30a9\u30eb\u30c8(\u5168\u9078\u629e) \u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u56fa\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001\u9078\u629e\n    - Security Groups: RDS\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\nInput test event\u306f\u305d\u306e\u307e\u307e\u3067\u3001Test\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\n```json\n{\n  \"id\": 1,\n  \"value\": \"test\"\n}\n```\n\n", "tags": ["lambda", "RDS", "AWS"]}