{"context": "EBS\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u306e\u969b\u306b\u3001\u81ea\u52d5\u7684\u306b\u30a2\u30bf\u30c3\u30c1\u53ca\u3073\u6307\u5b9a\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002AutoScaling\u3068\u304b\u3067\u52d5\u7684\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5909\u308f\u308b\u69cb\u6210\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\uff08WEB\u30b3\u30f3\u30c6\u30f3\u30c4\u3092Attach\u3059\u308bEBS\u306b\u4fdd\u5b58\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u5fa9\u65e7\u3055\u305b\u308b\u4ed5\u7d44\u307f\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001EBS\u304cAZ\u3092\u8d85\u3048\u3066\u3001\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u306e\u3067\u3001Single-AZ\u306b\u306a\u308a\u307e\u3059\u3002\uff09\n\u4e88\u3081\u3001IAM Role\u3067\u3001\u8a72\u5f53\u3059\u308bEC2\u306e\u64cd\u4f5c\u6a29\u9650(describe-instances/attach-volume)\u3092\u4e0e\u3048\u3066\u304a\u304d\u3001jq\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002jq\u306fUserData\u3067yum -y install jq\u3067\u3082\u5bfe\u5fdc\u53ef\u80fd\u3002\n\u203bdescrbe-instances\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304crunning\u306b\u306a\u3089\u306a\u3044\u3067\u3001attach-volume\u3092\u884c\u3046\u3068EBS\u306eattach\u304c\u5931\u6557\u3059\u308b\u306e\u3067\u3001wait\u51e6\u7406\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\nAWS_DEFAULT_REGION\u306f\u3001\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n#!/bin/bash\n\n\ncp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\nexport AWS_DEFAULT_REGION=ap-northeast-1\n\nINSTANCE_ID=`wget -q -O - http://169.254.169.254/latest/meta-data/instance-id`\n\nwhile [ \"$state\" != \"running\" ]\ndo\nresult=`aws ec2 describe-instances --filters Name=instance-id,Values=$INSTANCE_ID | jq '.Reservations[].Instances[].State.Name' | grep running`\n# echo $result\nstate=`echo $result | cut -d '\"' -f 2`\necho $state\ndone\n\n# attach to the EBS volume and wait for attachment to complete\naws ec2 attach-volume  --volume-id vol-XXXXXXXX --instance-id $INSTANCE_ID --device  /dev/sdf\n\nwhile [ ! -e /dev/xvdf ]\ndo\n  echo \"Waiting for disk to appear..\"\n  sleep 30\ndone\n\n# mount it\nchown ec2-user:ec2-user /www\n\ncat >>/etc/fstab <<EOF\n/dev/xvdf /www ext4 defaults 1 1\nEOF\n\nmount -a\n\nAWS CLI\u3092\u4f7f\u3063\u3066\u306e\u5b9f\u88c5\u65b9\u6cd5\u3067\u3059\u3002\nEBS\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u306e\u969b\u306b\u3001\u81ea\u52d5\u7684\u306b\u30a2\u30bf\u30c3\u30c1\u53ca\u3073\u6307\u5b9a\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002AutoScaling\u3068\u304b\u3067\u52d5\u7684\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5909\u308f\u308b\u69cb\u6210\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\uff08WEB\u30b3\u30f3\u30c6\u30f3\u30c4\u3092Attach\u3059\u308bEBS\u306b\u4fdd\u5b58\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u5fa9\u65e7\u3055\u305b\u308b\u4ed5\u7d44\u307f\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001EBS\u304cAZ\u3092\u8d85\u3048\u3066\u3001\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u306e\u3067\u3001Single-AZ\u306b\u306a\u308a\u307e\u3059\u3002\uff09\n\n\u4e88\u3081\u3001IAM Role\u3067\u3001\u8a72\u5f53\u3059\u308bEC2\u306e\u64cd\u4f5c\u6a29\u9650(describe-instances/attach-volume)\u3092\u4e0e\u3048\u3066\u304a\u304d\u3001jq\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002jq\u306fUserData\u3067yum -y install jq\u3067\u3082\u5bfe\u5fdc\u53ef\u80fd\u3002\n\n\u203bdescrbe-instances\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304crunning\u306b\u306a\u3089\u306a\u3044\u3067\u3001attach-volume\u3092\u884c\u3046\u3068EBS\u306eattach\u304c\u5931\u6557\u3059\u308b\u306e\u3067\u3001wait\u51e6\u7406\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\nAWS_DEFAULT_REGION\u306f\u3001\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n#!/bin/bash\n\n\ncp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\nexport AWS_DEFAULT_REGION=ap-northeast-1\n\nINSTANCE_ID=`wget -q -O - http://169.254.169.254/latest/meta-data/instance-id`\n\nwhile [ \"$state\" != \"running\" ]\ndo\nresult=`aws ec2 describe-instances --filters Name=instance-id,Values=$INSTANCE_ID | jq '.Reservations[].Instances[].State.Name' | grep running`\n# echo $result\nstate=`echo $result | cut -d '\"' -f 2`\necho $state\ndone\n\n# attach to the EBS volume and wait for attachment to complete\naws ec2 attach-volume  --volume-id vol-XXXXXXXX --instance-id $INSTANCE_ID --device  /dev/sdf\n\nwhile [ ! -e /dev/xvdf ]\ndo\n  echo \"Waiting for disk to appear..\"\n  sleep 30\ndone\n\n# mount it\nchown ec2-user:ec2-user /www\n\ncat >>/etc/fstab <<EOF\n/dev/xvdf /www ext4 defaults 1 1\nEOF\n\nmount -a\n```\nAWS CLI\u3092\u4f7f\u3063\u3066\u306e\u5b9f\u88c5\u65b9\u6cd5\u3067\u3059\u3002\n", "tags": ["AutoScaling", "AWS"]}