{"tags": ["IDCF\u30af\u30e9\u30a6\u30c9", "DockerSwarm1.0.1", "docker1.9.1", "Zeppelin0.5.0", "Ambari2.2.0"], "context": " More than 1 year has passed since last update.\u3000Hortonworks Gallery\u306bAmbari\u306eZeppelin\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308bambari-zeppelin-service\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002Option 2\u306eAmbari Blueprint\u3092\u4f7f\u3046\u65b9\u6cd5\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u306b\u65b0\u3057\u304fHDP\u30af\u30e9\u30b9\u30bf\u3068Zeppelin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f\u306a\u304f\u3001Docker Swarm\u4e0a\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306bDebian 8.2.0 64-bit\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3044\u4eee\u60f3\u30de\u30b7\u30f3\u30923\u53f0\u4f5c\u6210\u3057\u307e\u3059\u3002\u30e1\u30e2\u30ea\u3092\u591a\u3081\u306b\u30b9\u30da\u30c3\u30af\u306fstandard.M8\u3092\u9078\u3073\u307e\u3057\u305f\u3002\n\n\n\nDocker\u30db\u30b9\u30c8\u306ehostname\nDocker\u30db\u30b9\u30c8\u306eeth0\nDocker Swarm\n\n\n\n\nswarm-1\n10.3.0.201\nSwarm Manager/Agent\n\n\nswarm-2\n10.3.0.202\nSwarm Agent\n\n\nswarm-3\n10.3.0.203\nSwarm Agent\n\n\n\n\u3000\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066Debian\u3068\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f5c\u696d\u306froot\u30e6\u30fc\u30b6\u30fc\u3067\u884c\u3044\u307e\u3059\u3002\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u69cb\u7bc9\u304c\u3067\u304d\u305f\u5f8c\u306fSalt\u3067\u69cb\u6210\u7ba1\u7406\u3092\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Debian\nDescription:    Debian GNU/Linux 8.2 (jessie)\nRelease:        8.2\nCodename:       jessie\n$ uname -r\n3.16.0-4-amd64\n\n\nOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u3000\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066swarm-[1-3]\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306bOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nIDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 1: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n\n\nConsul\n\u3000Consul\u306foverlay\u30c9\u30e9\u30a4\u30d0\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u7528\u9014\u3067\u3059\u3002\n$ curl -LO https://releases.hashicorp.com/consul/0.6.3/consul_0.6.3_linux_amd64.zip\n$ unzip consul_0.6.3_linux_amd64.zip\n$ mv consul /usr/local/bin\n$ consul version\nConsul v0.6.3\nConsul Protocol: 3 (Understands back to: 1)\n\n\u3000Consul\u3092\u5b9f\u884c\u3059\u308b\u306econsul\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ useradd consul\n\n\u3000swawrm-[1-3]\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u5168\u3066\u306b\u540c\u3058\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002Consul\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u30aa\u30fc\u30ca\u30fc\u3092consul\u30e6\u30fc\u30b6\u30fc\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n$ mkdir /var/consul /etc/consul.d /etc/sysconfig\n$ chown consul:consul /var/consul\n\n\n/etc/default/consul\n\u3000Debian\u7528\u306e\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002-advertise\u306b\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nswarm-1\n\n\n/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.201 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n\n\n\nswarm-2\n\n\n/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.202 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n\n\n\nswarm-3\n\n\n/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.203 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n\n\n\n/etc/consul.d/config.json\n\nbootstrap_expect: Consul\u30af\u30e9\u30b9\u30bf\u306f3\u53f0\u3067\u69cb\u6210\u3057\u307e\u3059\u3002\nretry_join: \u30ce\u30fc\u30c9\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5217\u6319\u3057\u30663\u53f0\u304c\u53c2\u52a0\u3059\u308b\u307e\u3067\u8d77\u52d5\u3092\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\n\n/etc/consul.d/config.json\n{\n  \"bootstrap_expect\": 3,\n  \"server\": true,\n  \"data_dir\": \"/var/consul\",\n  \"log_level\": \"INFO\",\n  \"enable_syslog\": false,\n  \"retry_join\": [\"10.3.0.201\", \"10.3.0.202\", \"10.3.0.203\"],\n  \"client_addr\": \"0.0.0.0\"\n}\n\n\n\nsystemd\n\u3000Consul\u306eSystemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/lib/systemd/system/consul.service\n[Unit]\nDescription=Consul agent\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=consul\nGroup=consul\nEnvironmentFile=-/etc/default/consul\nExecStart=/usr/local/bin/consul $CMD_OPTS\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u3000Consul\u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ systemctl daemon-reload\n$ systemctl enable consul\nCreated symlink from /etc/systemd/system/multi-user.target.wants/consul.service to /lib/systemd/system/consul.service.\n$ systemctl start consul\n\n\u3000Consul\u30b5\u30fc\u30d3\u30b9\u306estatus\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n$ systemctl status consul\n\u25cf consul.service - Consul agent\n   Loaded: loaded (/lib/systemd/system/consul.service; enabled)\n   Active: active (running) since \u91d1 2016-01-15 14:41:20 JST; 9s ago\n Main PID: 5437 (consul)\n   CGroup: /system.slice/consul.service\n           \u2514\u25005437 /usr/local/bin/consul agent -advertise 10.3.0.201 -config-d...\n\n\nswarm-1\u4eee\u60f3\u30de\u30b7\u30f3\n\u3000\u6700\u521d\u306bSwarm Manager\u306b\u306a\u308bswarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u4f5c\u696d\u3092\u884c\u3044\u307e\u3059\u3002\n\nDocker\n\u3000https://get.docker.com/\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u3044Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ curl -sSL https://get.docker.com/ | sh\n\n\u3000Docker\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u3057\u3066\u304b\u3089Docker\u306eSystemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n$ systemctl stop docker\n\n\u3000Docker\u30c7\u30fc\u30e2\u30f3\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3001Swarm Manager\u304c\u4f7f\u3046\u30ea\u30e2\u30fc\u30c8API\u3001UNIX\u30bd\u30b1\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/default/docker\nDOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n\n\n\u3000systemd\u306edocker.service\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\nEnvironmentFile: \u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3089DOCKER_OPTS\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\nExecStart: Docker daemon\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u8ffd\u52a0\n\n\n/lib/systemd/system/docker.service\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network.target docker.socket\nRequires=docker.socket\n\n[Service]\nType=notify\nEnvironmentFile=-/etc/default/docker \nExecStart=/usr/bin/docker daemon -H fd:// $DOCKER_OPTS\nMountFlags=slave\nLimitNOFILE=1048576\nLimitNPROC=1048576\nLimitCORE=infinity\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u3000Systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066Docker\u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n$ systemctl daemon-reload\n$ systemctl start docker\n\n\nSwarm Manager\u30b3\u30f3\u30c6\u30ca\n\u3000\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066Docker Swarm\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nIDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 2: Docker Swarm\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\n\u3000swawrm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306eDocker\u30db\u30b9\u30c8\u306bSwarm Manager\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u516c\u958b\u3059\u308b\u30dd\u30fc\u30c8\u306f3333\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n$ docker pull swarm\n$ docker run -d \\\n  --name swarm-manage \\\n  -p 3333:2375 \\\n  swarm \\\n  manage \\\n  consul://10.3.0.201:8500/swarm\n\n\nSwarm Agent\u30b3\u30f3\u30c6\u30ca\n\u3000\u6b21\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306fSwarm Manager\u3068Swarm Agent\u306e\u4e21\u65b9\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker run -d \\\n  --name swarm-node-1 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.201:2375 \\\n  consul://10.3.0.201:8500/swarm\n\n\u3000-H\u30d5\u30e9\u30b0\u3067Docker\u30c7\u30fc\u30e2\u30f3\u3092Docker Manager\u306b\u6307\u5b9a\u3057\u3066\u304b\u3089info\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Docker Swarm\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n$ docker -H tcp://10.3.0.201:3333 info\nContainers: 2\nImages: 1\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 1\n swarm-1: 10.3.0.201:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 2\nTotal Memory: 8.202 GiB\nName: 8cc34ebf6290\n\n\nOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n\u3000Docker Swarm\u3067\u4f7f\u3046Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Apache Zeppelin\u7528\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d\u3092zeppelin\u3068\u3057\u307e\u3057\u305f\u3002\n$ docker network create \\\n  --subnet=192.168.0.0/24 \\\n  --driver=overlay \\\n  zeppelin\n\n\nswarm-[2-3]\u4eee\u60f3\u30de\u30b7\u30f3\n\u3000swarm-[2-3]\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306fSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nSwarm Agent\u30b3\u30f3\u30c6\u30ca\n\u3000Docker\u306e\u8a2d\u5b9a\u307e\u3067\u306fswarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u3068\u540c\u3058\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4eee\u60f3\u30de\u30b7\u30f3\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nswarm-2\u4eee\u60f3\u30de\u30b7\u30f3\u306eswarm-node-2\u30b3\u30f3\u30c6\u30ca\n\n$ docker run -d \\\n  --name swarm-node-2 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.202:2375 \\\n  consul://10.3.0.202:8500/swarm\n\n\nswarm-3\u4eee\u60f3\u30de\u30b7\u30f3\u306eswarm-node-3\u30b3\u30f3\u30c6\u30ca\n\n$ docker run -d \\\n  --name swarm-node-3 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.203:2375 \\\n  consul://10.3.0.203:8500/swarm\n\n\u3000swarm-2\u307e\u305f\u306fswarm-3\u4eee\u60f3\u30de\u30b7\u30f3\u304b\u3089Swarm Manager\u3092\u6307\u5b9a\u3057\u3066info\u3092\u8868\u793a\u3057\u307e\u3059\u30023\u53f0\u306e\u30ce\u30fc\u30c9\u304cHealthy\u306b\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.201:3333 info\nContainers: 4\nImages: 3\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n swarm-1: 10.3.0.201:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n swarm-2: 10.3.0.202:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n swarm-3: 10.3.0.203:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 6\nTotal Memory: 24.61 GiB\nName: 8cc34ebf6290\n\n\nAmbari Node\u30b3\u30f3\u30c6\u30ca\n\u3000swarm-1\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u30de\u30b7\u30f3\u3068\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002DOCKER_HOST\u74b0\u5883\u5909\u6570\u3092Swarm Manager\u306b\u6307\u5b9a\u3057\u3066\u30013\u53f0\u306eSwarm Node\u306b\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306eCentOS 6.x\u30a4\u30e1\u30fc\u30b8\u3092pull\u3057\u307e\u3059\u3002\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker pull centos:6\nswarm-1: Pulling centos:6...\nswarm-2: Pulling centos:6...\nswarm-3: Pulling centos:6...\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\n\u3000Ambari\u3067\u4f7f\u3046\u30b3\u30f3\u30c6\u30ca\u306fnode[1-4]\u306e4\u53f0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002node1\u306e\u30b3\u30f3\u30c6\u30ca\u306fAmbari Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nambari-server\u30b5\u30fc\u30d3\u30b9\u304cforeground\u3067\u30d5\u30ed\u30f3\u30c8\u3067\u5b9f\u884c\u3067\u304d\u306a\u3044\u306e\u3067tail -f /dev/null\u3059\u308bcommand\u306b\u3057\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\n--privileged: ambari-bootstrap\u306b\u6a29\u9650\u304c\u5fc5\u8981\u306a\u305f\u3081\n--name: /etc/host\u306b\u308f\u304b\u308a\u3084\u3059\u3044hostname\u3092\u3064\u3051\u308b\n--hostname: /etc/host\u306bzeppelin\u30c9\u30e1\u30a4\u30f3\u306ehostname\u3092\u3064\u3051\u308b\n--net: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3046\n--env: swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u5236\u7d04\u3092\u5165\u308c\u308b\n\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker run -d \\\n  --privileged \\\n  --name node1 \\\n  --hostname node1.zeppelin \\\n  --net zeppelin \\\n  --env constraint:node==swarm-1 \\\n  centos:6 \\\n  tail -f /dev/null\n\n\u3000node[2-4]\u306e3\u53f0\u306f--name\u3068--hostname\u4ee5\u5916\u306f\u540c\u3058\u3067\u3059\u3002\n\nnode2\u30b3\u30f3\u30c6\u30ca\n\n$ docker run -d \\\n  --privileged \\\n  --name node2 \\\n  --hostname node2.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n\n\nnode3\u30b3\u30f3\u30c6\u30ca\n\n$ docker run -d \\\n  --privileged \\\n  --name node3 \\\n  --hostname node3.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n\n\nnode4\u30b3\u30f3\u30c6\u30ca\n\n$ docker run -d \\\n  --privileged \\\n  --name node4 \\\n  --hostname node4.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n\n\u3000docker ps\u3067\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u304cswarm-[1-3]\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u5206\u6563\u3057\u3066\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                   NAMES\nea0cfa4631e9        centos:6            \"tail -f /dev/null\"      11 seconds ago      Up 10 seconds                                                                               swarm-2/node4\nac1d338d54ce        centos:6            \"tail -f /dev/null\"      26 seconds ago      Up 24 seconds                                                                               swarm-3/node3\n7643d9256e83        centos:6            \"tail -f /dev/null\"      33 seconds ago      Up 31 seconds                                                                               swarm-2/node2\nceb2fc18d7f3        centos:6            \"tail -f /dev/null\"      42 seconds ago      Up 40 seconds                                                                               swarm-1/node1\n\n\nambari-bootstrap\u3092\u4f7f\u3046\n\u3000ambari-bootstrap\u3092\u4f7f\u3063\u3066Ambari\u30ce\u30fc\u30c9\u306ebootstrapping\u3092\u3057\u307e\u3059\u3002\u672c\u6765\u306fDocker\u30a4\u30e1\u30fc\u30b8\u306b\u843d\u3068\u3057\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u306a\u306e\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066\u4f5c\u696d\u3057\u3066\u3044\u304d\u307e\u3059\u3002An Ambari Service for Zeppelin\u306eOption2\u306e\u624b\u9806\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nnode[2-4]\u30b3\u30f3\u30c6\u30ca\n\u30003\u53f0\u306eAmbari Node\u306b\u5165\u3063\u3066\u4f5c\u696d\u3057\u307e\u3059\u3002Docker Swarm\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308bDocker\u30db\u30b9\u30c8\u4ee5\u5916\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306b\u3082docker exec\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306fnode2\u306e\u4f8b\u3067\u3059\u3002node3\u3068node4\u3082\u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nnode2\u30b3\u30f3\u30c6\u30ca\n\n$ docker exec -it node2 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n\n\nnode3\u30b3\u30f3\u30c6\u30ca\n\n$ docker exec -it node3 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n\n\nnode4\u30b3\u30f3\u30c6\u30ca\n\n$ docker exec -it node4 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n\n\nnode1\u30b3\u30f3\u30c6\u30ca\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306bAmbari Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Hortnworks Gallery\u306eambari-zeppelin-service\u3092git clone\u3057\u3066\u3001Ambari\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066Zeppelin\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n$ docker exec -it node1 bash\n$ export install_ambari_server=true\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n$ yum install -y git\n$ VERSION=2.3\n$ git clone https://github.com/hortonworks-gallery/ambari-zeppelin-service.git /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/ZEPPELIN\n\n\u3000ambari-server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001role_command_order.json\u306egeneral_deps\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u9069\u5f53\u306a\u4f4d\u7f6e\u306b\"ZEPPELIN_MASTER-START\": [\"NAMENODE-START\", \"DATANODE-START\"],\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/var/lib/ambari-server/resources/stacks/HDP/2.3/role_command_order.json\n...\n    \"KAFKA_BROKER-START\" : [\"ZOOKEEPER_SERVER-START\", \"RANGER_USERSYNC-START\", \"NAMENODE-START\"],\n    \"NIMBUS-START\" : [\"ZOOKEEPER_SERVER-START\", \"RANGER_USERSYNC-START\", \"NAMENODE-START\"],\n    \"ZEPPELIN_MASTER-START\": [\"NAMENODE-START\", \"DATANODE-START\"],\n    \"STORM_UI_SERVER-START\" : [\"NIMBUS-START\", \"NAMENODE-START\"]\n  }\n}\n\n\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306eambari-server\u3068ambari-agent\u3092restart\u3057\u307e\u3059\u3002\n$ service ambari-server restart\n$ service ambari-agent restart\n\n\u3000Ambari\u306eREST API\u3092\u5b9f\u884c\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3059\u308b\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/hosts\n{\n  \"href\" : \"http://localhost:8080/api/v1/hosts\",\n  \"items\" : [\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node1.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node1.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node2.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node2.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node3.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node3.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node4.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node4.zeppelin\"\n      }\n    }\n  ]\n}\n\n\nAmbari Blueprint\n\u3000\u5f15\u304d\u7d9a\u304dnode1\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n$ docker exec -it node1 bash\n\n\u3000\u6700\u521d\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068ambari-bootstrap\u3092clone\u3057\u307e\u3059\u3002\n$ yum install -y python-argparse\n$ cd \n$ git clone https://github.com/seanorama/ambari-bootstrap.git\n\n\nbluerprint.json\u3068cluster.json\u3092\u4f5c\u6210\n\u3000ambari-bootstrap/deploy\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066Ambari\u30b5\u30fc\u30d3\u30b9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002Zeppelin\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30df\u30cb\u30de\u30eb\u306a\u69cb\u6210\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n$ export ambari_services=\"HDFS MAPREDUCE2 YARN ZOOKEEPER HIVE ZEPPELIN SPARK\"\n\n\u3000deploy-recommended-cluster.bash\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u9014\u4e2d\u3067\u30db\u30b9\u30c8\u53f0\u6570\u3092\u805e\u304b\u308c\u307e\u3059\u3002\u5148\u307b\u3069\u78ba\u8a8d\u3057\u305f4\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n$ cd ambari-bootstrap/deploy\n$ export deploy=false\n$ bash ./deploy-recommended-cluster.bash\n\n        Please enter the number of hosts you are expecting,\n        or enter \"skip\" to proceed without the host check.\n\n        This prompt when timeout in 30 seconds.\n\n        host_count: 4\nDeploying the cluster once 4 hosts are registered.\n\n\nFri Jan 15 08:01:42 UTC 2016\n\n# Checking the number of registered hosts before proceeding with deployment\n===========================================================================\n\n  * Hosts expected:   4\n  * Hosts registered: 4\n\nSuccess: All hosts have checked in!\n\n# Deploying Hortonworks Data Platform using Ambari Blueprint Recommendations\n============================================================================\n\n\u3000tempdir*\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u79fb\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308bblueprint.json\u3068cluster.json\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n$ cd tempdir*\n$ ls\nblueprint.json  configurations.json  request-configurations.json\ncluster.json    host_groups.json     request-host_groups.json\n\n\u3000ambari_services\u74b0\u5883\u5909\u6570\u306bHDFS MAPREDUCE2 YARN ZOOKEEPER HIVE ZEPPELIN SPARK\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u304cAmbari\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066blueprint.json\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002zeppelin.host.publicname\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002node1\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b--env constraint:node==swarm-1`\u306e\u5236\u7d04\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3057\u3066\u3044\u308b\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nblueprint.json\n...\n \"configurations\": [\n    {\n      \"zeppelin-ambari-config\": {\n        \"zeppelin.executor.mem\": \"512m\",\n        \"zeppelin.executor.instances\": \"2\",\n        \"zeppelin.host.publicname\": \"210.xxx.xxx.xxx\",\n        \"zeppelin.install.dir\": \"/opt\"\n      }\n    },\n...\n}\n\n\n\u3000\u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u306b\u5411\u3051\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5185\u90e8\u304b\u3089\u3082\u901a\u4fe1\u3092\u884c\u3044\u307e\u3059\u3002IDCF\u30af\u30e9\u30a6\u30c9\u306e\u5834\u5408\u306f\u3053\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30eb\u30fc\u30bf\u5185\u304b\u3089\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n10.3.0.101/21\nTCP: 1-65535\n\n\n\u3000blueprint.json\u306b\u306fhost-group-[1-4]\u307e\u30674\u3064\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\u6b21\u306ecluster.json\u306e\u4e2d\u3067\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u3077\u3068\u30db\u30b9\u30c8(Ambari Node\u306eDocker\u30b3\u30f3\u30c6\u30ca)\u3092\u30de\u30c3\u30d7\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nblueprint.json\n  \"host_groups\": [\n    {\n      \"name\": \"host-group-2\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-4\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"HIVE_SERVER\"\n        },\n        {\n          \"name\": \"APP_TIMELINE_SERVER\"\n        },\n        {\n          \"name\": \"HISTORYSERVER\"\n        },\n        {\n          \"name\": \"HIVE_METASTORE\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"RESOURCEMANAGER\"\n        },\n        {\n          \"name\": \"WEBHCAT_SERVER\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        },\n        {\n          \"name\": \"SECONDARY_NAMENODE\"\n        },\n        {\n          \"name\": \"MYSQL_SERVER\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-3\",\n      \"components\": [\n        {\n          \"name\": \"YARN_CLIENT\"\n        },\n        {\n          \"name\": \"ZEPPELIN_MASTER\"\n        },\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"HDFS_CLIENT\"\n        },\n        {\n          \"name\": \"HIVE_CLIENT\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        },\n        {\n          \"name\": \"MAPREDUCE2_CLIENT\"\n        },\n        {\n          \"name\": \"NAMENODE\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_CLIENT\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"SPARK_CLIENT\"\n        },\n        {\n          \"name\": \"SPARK_JOBHISTORYSERVER\"\n        },\n        {\n          \"name\": \"HCAT\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-1\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        }\n      ]\n    }\n  ],\n\n\n\u3000\u7de8\u96c6\u3057\u305fblueprint.json\u3092Ambari Server\u306bupload\u3057\u307e\u3059\u3002URL\u306e/zeppelinBP\u304cblueprint\u306e\u540d\u524d\u3067\u3059\u3002\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/blueprints/zeppelinBP -d @blueprint.json\n\n\u3000cluster.json\u306b\u306fAmbari Node\u306e\u30b3\u30f3\u30c6\u30ca\u304cFQDN\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002blueprint\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u4f7f\u7528\u3059\u308bblueprint\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ncluster.json\n{\n  \"blueprint\": \"zeppelinBP\",\n  \"default_password\": \"hadoop\",\n  \"host_groups\": [\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node3.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-3\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node2.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-2\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node4.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-4\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node1.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-1\"\n    }\n  ]\n}\n\n\n\n\n\n\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\n\u30db\u30b9\u30c8(Ambari Node\u30b3\u30f3\u30c6\u30ca)\n\u4eee\u60f3\u30de\u30b7\u30f3\n\n\n\n\nhost-group-1\nnode1.zeppelin\nswarm-1\n\n\nhost-group-2\nnode2.zeppelin\nswarm-2\n\n\nhost-group-3\nnode3.zeppelin\nswarm-3\n\n\nhost-group-4\nnode4.zeppelin\nswarm-2\n\n\n\n\u3000\u7de8\u96c6\u3057\u305fcluster.json\u30d5\u30a1\u30a4\u30eb\u3092Ambari Server\u306bPOST\u3057\u3066HDP\u30af\u30e9\u30b9\u30bf\u3068Zeppelin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002URL\u306e/zeppelin\u304cHDP\u30af\u30e9\u30b9\u30bf\u306e\u540d\u524d\u306b\u306a\u308a\u307e\u3059\u3002Accepted\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308aAmbari\u30b5\u30fc\u30d3\u30b9\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u958b\u59cb\u3057\u307e\u3057\u305f\u3002\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/clusters/zeppelin -d @cluster.json\n{\n  \"href\" : \"http://localhost:8080/api/v1/clusters/zeppelin/requests/1\",\n  \"Requests\" : {\n    \"id\" : 1,\n    \"status\" : \"Accepted\"\n  }\n}[\n\n\nNginx\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305fAmbari Server\u3092\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306bNginx\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Ambari Server\u306enode1\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u540c\u3058swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ mkdir ~/nginx\n$ cd ~/nginx\n\n\u3000Nginx\u306e\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30a4\u30e1\u30fc\u30b8\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066Dockerfile\u3092\u66f8\u304d\u307e\u3059\u3002\n\nDockerfile\nFROM nginx\nADD default.conf /etc/nginx/conf.d/default.conf\n\n\n\u3000Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u30029995\u30dd\u30fc\u30c8\u306fZeppelin\u304c\u4f7f\u3044\u307e\u3059\u3002WebSocket\u3082\u540c\u3058\u30dd\u30fc\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002Zeppelin\u306eNotebook\u304c\u3059\u3050\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u306a\u3044\u3088\u3046\u306b\u6642\u9593\u3092\u5ef6\u3070\u3057\u307e\u3059\u30028080\u30dd\u30fc\u30c8\u304cAmbari Server\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u3059\u3002\n\ndefault.conf\nserver {\n  listen 9995;\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://node1.zeppelin:9995;\n    proxy_http_version 1.1;\n    proxy_set_header   Upgrade $http_upgrade;\n    proxy_set_header   Connection \"upgrade\";\n    proxy_read_timeout 86400;\n  }\n}\n\nserver {\n  listen 8080;\n  location / {\n    proxy_set_header   Host $host:$server_port;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://node1.zeppelin:8080;\n  }\n}\n\n\n\u3000Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002--env constraint:node==swarm-1\u306e\u5236\u7d04\u3092\u5165\u308c\u3066swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n$ docker build -t masato/nginx .\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker run -d \\\n  --name nginx \\\n  --net zeppelin \\\n  --env constraint:node==swarm-1 \\\n  -p 8080:8080 \\\n  -p 9995:9995 \\\n  masato/nginx\n\n\u3000docker ps\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067Nginx\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                   NAMES\n5be44394b88b        masato/nginx        \"nginx -g 'daemon off\"   4 seconds ago       Up 4 seconds        80/tcp, 10.3.0.201:8080->8080/tcp, 443/tcp, 10.3.0.201:9995->9995/tcp   swarm-1/nginx\n\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304dAmbari Server\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\nUsername: admin\nPassword: admin\n\n\n\u3000\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002Ambari\u30b5\u30fc\u30d3\u30b9\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306a\u306e\u9ec4\u8272\u3044\u30a2\u30a4\u30b3\u30f3\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u30029 ops\u306fn\u73fe\u5728\u5b9f\u884c\u4e2d\u306e\u51e6\u7406\u6570\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30a4\u30b3\u30f3\u304c\u5168\u3066\u7dd1\u8272\u306b\u306a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u4e86\u3057\u307e\u3059\u3002Hadoop\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3082Ambari Blueprint\u304b\u3089\u7c21\u5358\u306b\u30bb\u30c3\u30c8\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002\n\n\nAmbari View\n\u3000Ambari View\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u5f62\u5f0f\u3067Ambari\u753b\u9762\u306bAmbari\u30b5\u30fc\u30d3\u30b9\u306e\u753b\u9762\u3092\u57cb\u3081\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000Ambari\u753b\u9762\u306e\u4e0a\u30e1\u30cb\u30e5\u30fc\u306eAmbari View\u306e\u30e1\u30cb\u30e5\u30fc\u3067\u3059\u3002\n\n\nHive View\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308aroot\u30e6\u30fc\u30b6\u30fc\u3068admin\u30e6\u30fc\u30b6\u30fc\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092HDFS\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306fZeppelin View\u3084Hive View\u304b\u3089Hive\u306e\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u6642\u306b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n$ docker exec -it node1 bash\n$ su hdfs \n$ hadoop fs -mkdir /user/root\n$ hadoop fs -chown root /user/root\n$ hadoop fs -mkdir /user/admin\n$ hadoop fs -chown admin /user/admin\n\nHDFS\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u753b\u9762\u3092\u958b\u304d\u307e\u3059\u3002\n\n\u3000Advanced\u30bf\u30b0\u3092\u4e0b\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3066Custom core-site\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u958b\u304d\u307e\u3059\u3002Add Property\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002root\u306e\u7b87\u6240\u306fOS\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u304croot\u306e\u5834\u5408\u3067\u3059\u3002\n\nkey: hadoop.proxyuser.root.groups, value: *\nkey: hadoop.proxyuser.root.hosts, value: *\n\n\n\u3000Sava\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u5909\u66f4\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u305d\u306e\u3042\u3068\u306bRestart\u30dc\u30bf\u30f3\u306eRestart All Affected\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u5909\u66f4\u306e\u5f71\u97ff\u304c\u3042\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002MapReduce2\u30b5\u30fc\u30d3\u30b9\u3068YARN\u30b5\u30fc\u30d3\u30b9\u3082\u5f71\u97ff\u30de\u30fc\u30af\u306e\u30a2\u30a4\u30b3\u30f3\u304c\u51fa\u3066\u3044\u308b\u306e\u3067\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002\n\u3000Ambari View\u304b\u3089Hive\u30d3\u30e5\u30fc\u3092\u958b\u304d\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3082\u8868\u793a\u3055\u308c\u30a8\u30e9\u30fc\u3082\u306a\u304f\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n\nZeppelin View\n\u3000Zeppelin\u306fAmbari Server\u3068\u540c\u3058node1\u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u306e\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3068\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n$ docker exec -it node1 bash\n$ service ambari-server restart\n\n\u3000Zeppelin\u304cAmbari\u753b\u9762\u306e\u4e2d\u306b\u57cb\u3081\u8fbc\u307e\u308c\u305f\u72b6\u614b\u3067\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u30009995\u30dd\u30fc\u30c8\u304b\u3089Zeppelin\u3092\u76f4\u63a5\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u3000[Hortonworks Gallery](https://community.hortonworks.com/gallery/index.html)\u306bAmbari\u306eZeppelin\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b[ambari-zeppelin-service](https://github.com/hortonworks-gallery/ambari-zeppelin-service)\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002Option 2\u306e[Ambari Blueprint](https://cwiki.apache.org/confluence/display/AMBARI/Blueprints)\u3092\u4f7f\u3046\u65b9\u6cd5\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u306b\u65b0\u3057\u304fHDP\u30af\u30e9\u30b9\u30bf\u3068Zeppelin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f\u306a\u304f\u3001Docker Swarm\u4e0a\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4f5c\u6210\n\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306bDebian 8.2.0 64-bit\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3044\u4eee\u60f3\u30de\u30b7\u30f3\u30923\u53f0\u4f5c\u6210\u3057\u307e\u3059\u3002\u30e1\u30e2\u30ea\u3092\u591a\u3081\u306b\u30b9\u30da\u30c3\u30af\u306f`standard.M8`\u3092\u9078\u3073\u307e\u3057\u305f\u3002\n\n|Docker\u30db\u30b9\u30c8\u306ehostname|Docker\u30db\u30b9\u30c8\u306eeth0| Docker Swarm |\n|:--|:--|:--|\n|swarm-1|10.3.0.201| Swarm Manager/Agent |\n|swarm-2|10.3.0.202| Swarm Agent |\n|swarm-3|10.3.0.203| Swarm Agent |\n\n\u3000\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066Debian\u3068\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f5c\u696d\u306froot\u30e6\u30fc\u30b6\u30fc\u3067\u884c\u3044\u307e\u3059\u3002\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u69cb\u7bc9\u304c\u3067\u304d\u305f\u5f8c\u306fSalt\u3067\u69cb\u6210\u7ba1\u7406\u3092\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n\n```bash\n$ lsb_release -a\nNo LSB modules are available.\nDistributor ID: Debian\nDescription:    Debian GNU/Linux 8.2 (jessie)\nRelease:        8.2\nCodename:       jessie\n$ uname -r\n3.16.0-4-amd64\n```\n\n\n## Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n\u3000\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066swarm-[1-3]\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306bOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n* [IDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 1: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210](http://qiita.com/masato/items/6a1fa797b6c25d4c5745)\n\n\n### Consul\n\n\u3000Consul\u306foverlay\u30c9\u30e9\u30a4\u30d0\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u7528\u9014\u3067\u3059\u3002\n\n```bash\n$ curl -LO https://releases.hashicorp.com/consul/0.6.3/consul_0.6.3_linux_amd64.zip\n$ unzip consul_0.6.3_linux_amd64.zip\n$ mv consul /usr/local/bin\n$ consul version\nConsul v0.6.3\nConsul Protocol: 3 (Understands back to: 1)\n```\n\n\u3000Consul\u3092\u5b9f\u884c\u3059\u308b\u306econsul\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ useradd consul\n```\n\n\u3000swawrm-[1-3]\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u5168\u3066\u306b\u540c\u3058\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002Consul\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u30aa\u30fc\u30ca\u30fc\u3092consul\u30e6\u30fc\u30b6\u30fc\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```bash\n$ mkdir /var/consul /etc/consul.d /etc/sysconfig\n$ chown consul:consul /var/consul\n```\n\n### /etc/default/consul\n\n\u3000Debian\u7528\u306e\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002`-advertise`\u306b\u306f\u4eee\u60f3\u30de\u30b7\u30f3\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\n* swarm-1\n\n```bash:/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.201 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n```\n\n* swarm-2\n\n```bash:/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.202 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n```\n\n* swarm-3\n\n```bash:/etc/default/consul\nGOMAXPROCS=2\nCMD_OPTS=\"agent -advertise 10.3.0.203 -config-dir=/etc/consul.d -data-dir=/var/consul\"\n```\n\n### /etc/consul.d/config.json\n\n* bootstrap_expect: Consul\u30af\u30e9\u30b9\u30bf\u306f3\u53f0\u3067\u69cb\u6210\u3057\u307e\u3059\u3002\n* retry_join: \u30ce\u30fc\u30c9\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5217\u6319\u3057\u30663\u53f0\u304c\u53c2\u52a0\u3059\u308b\u307e\u3067\u8d77\u52d5\u3092\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\n```json:/etc/consul.d/config.json\n{\n  \"bootstrap_expect\": 3,\n  \"server\": true,\n  \"data_dir\": \"/var/consul\",\n  \"log_level\": \"INFO\",\n  \"enable_syslog\": false,\n  \"retry_join\": [\"10.3.0.201\", \"10.3.0.202\", \"10.3.0.203\"],\n  \"client_addr\": \"0.0.0.0\"\n}\n```\n\n### systemd\n\n\u3000Consul\u306eSystemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:/lib/systemd/system/consul.service\n[Unit]\nDescription=Consul agent\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=consul\nGroup=consul\nEnvironmentFile=-/etc/default/consul\nExecStart=/usr/local/bin/consul $CMD_OPTS\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u3000Consul\u30b5\u30fc\u30d3\u30b9\u306e\u81ea\u52d5\u8d77\u52d5\u3092\u6709\u52b9\u306b\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ systemctl daemon-reload\n$ systemctl enable consul\nCreated symlink from /etc/systemd/system/multi-user.target.wants/consul.service to /lib/systemd/system/consul.service.\n$ systemctl start consul\n```\n\n\u3000Consul\u30b5\u30fc\u30d3\u30b9\u306estatus\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ systemctl status consul\n\u25cf consul.service - Consul agent\n   Loaded: loaded (/lib/systemd/system/consul.service; enabled)\n   Active: active (running) since \u91d1 2016-01-15 14:41:20 JST; 9s ago\n Main PID: 5437 (consul)\n   CGroup: /system.slice/consul.service\n           \u2514\u25005437 /usr/local/bin/consul agent -advertise 10.3.0.201 -config-d...\n```\n\n## swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\n\n\u3000\u6700\u521d\u306bSwarm Manager\u306b\u306a\u308bswarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u4f5c\u696d\u3092\u884c\u3044\u307e\u3059\u3002\n\n### Docker\n\n\u3000[https://get.docker.com/](https://get.docker.com/)\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f7f\u3044Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -sSL https://get.docker.com/ | sh\n```\n\n\u3000Docker\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u3057\u3066\u304b\u3089Docker\u306eSystemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```bash\n$ systemctl stop docker\n```\n\n\u3000Docker\u30c7\u30fc\u30e2\u30f3\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3001Swarm Manager\u304c\u4f7f\u3046\u30ea\u30e2\u30fc\u30c8API\u3001UNIX\u30bd\u30b1\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:/etc/default/docker\nDOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n\u3000systemd\u306edocker.service\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n* EnvironmentFile: \u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3089DOCKER_OPTS\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u3080\n* ExecStart: Docker daemon\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u8ffd\u52a0\n\n```bash:/lib/systemd/system/docker.service\n[Unit]\nDescription=Docker Application Container Engine\nDocumentation=https://docs.docker.com\nAfter=network.target docker.socket\nRequires=docker.socket\n\n[Service]\nType=notify\nEnvironmentFile=-/etc/default/docker \nExecStart=/usr/bin/docker daemon -H fd:// $DOCKER_OPTS\nMountFlags=slave\nLimitNOFILE=1048576\nLimitNPROC=1048576\nLimitCORE=infinity\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u3000Systemd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066Docker\u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```bash\n$ systemctl daemon-reload\n$ systemctl start docker\n```\n\n### Swarm Manager\u30b3\u30f3\u30c6\u30ca\n\n\u3000\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066Docker Swarm\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n* [IDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 2: Docker Swarm\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210](http://qiita.com/masato/items/a047798e48ccc1e56eb8)\n\n\u3000swawrm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306eDocker\u30db\u30b9\u30c8\u306bSwarm Manager\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u516c\u958b\u3059\u308b\u30dd\u30fc\u30c8\u306f3333\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker pull swarm\n$ docker run -d \\\n  --name swarm-manage \\\n  -p 3333:2375 \\\n  swarm \\\n  manage \\\n  consul://10.3.0.201:8500/swarm\n```\n\n### Swarm Agent\u30b3\u30f3\u30c6\u30ca\n\n\u3000\u6b21\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306fSwarm Manager\u3068Swarm Agent\u306e\u4e21\u65b9\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ docker run -d \\\n  --name swarm-node-1 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.201:2375 \\\n  consul://10.3.0.201:8500/swarm\n```\n\n\u3000`-H`\u30d5\u30e9\u30b0\u3067Docker\u30c7\u30fc\u30e2\u30f3\u3092Docker Manager\u306b\u6307\u5b9a\u3057\u3066\u304b\u3089info\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Docker Swarm\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker -H tcp://10.3.0.201:3333 info\nContainers: 2\nImages: 1\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 1\n swarm-1: 10.3.0.201:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 2\nTotal Memory: 8.202 GiB\nName: 8cc34ebf6290\n```\n\n### Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n\n\u3000Docker Swarm\u3067\u4f7f\u3046Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002[Apache Zeppelin](https://zeppelin.incubator.apache.org/)\u7528\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d\u3092`zeppelin`\u3068\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker network create \\\n  --subnet=192.168.0.0/24 \\\n  --driver=overlay \\\n  zeppelin\n```\n\n## swarm-[2-3]\u4eee\u60f3\u30de\u30b7\u30f3\n\n\u3000swarm-[2-3]\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306fSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n### Swarm Agent\u30b3\u30f3\u30c6\u30ca\n\n\u3000Docker\u306e\u8a2d\u5b9a\u307e\u3067\u306fswarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u3068\u540c\u3058\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4eee\u60f3\u30de\u30b7\u30f3\u306eeth0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n* swarm-2\u4eee\u60f3\u30de\u30b7\u30f3\u306eswarm-node-2\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker run -d \\\n  --name swarm-node-2 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.202:2375 \\\n  consul://10.3.0.202:8500/swarm\n```\n\n* swarm-3\u4eee\u60f3\u30de\u30b7\u30f3\u306eswarm-node-3\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker run -d \\\n  --name swarm-node-3 \\\n  swarm \\\n  join \\\n  --addr=10.3.0.203:2375 \\\n  consul://10.3.0.203:8500/swarm\n```\n\n\u3000swarm-2\u307e\u305f\u306fswarm-3\u4eee\u60f3\u30de\u30b7\u30f3\u304b\u3089Swarm Manager\u3092\u6307\u5b9a\u3057\u3066info\u3092\u8868\u793a\u3057\u307e\u3059\u30023\u53f0\u306e\u30ce\u30fc\u30c9\u304c`Healthy`\u306b\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.201:3333 info\nContainers: 4\nImages: 3\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n swarm-1: 10.3.0.201:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n swarm-2: 10.3.0.202:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n swarm-3: 10.3.0.203:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 6\nTotal Memory: 24.61 GiB\nName: 8cc34ebf6290\n```\n\n## Ambari Node\u30b3\u30f3\u30c6\u30ca\n\n\u3000swarm-1\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4f5c\u696d\u30de\u30b7\u30f3\u3068\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002`DOCKER_HOST`\u74b0\u5883\u5909\u6570\u3092Swarm Manager\u306b\u6307\u5b9a\u3057\u3066\u30013\u53f0\u306eSwarm Node\u306b\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306e[CentOS 6.x](https://hub.docker.com/_/centos/)\u30a4\u30e1\u30fc\u30b8\u3092pull\u3057\u307e\u3059\u3002\n\n```bash\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker pull centos:6\nswarm-1: Pulling centos:6...\nswarm-2: Pulling centos:6...\nswarm-3: Pulling centos:6...\n```\n\n\n### \u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\n\n\u3000Ambari\u3067\u4f7f\u3046\u30b3\u30f3\u30c6\u30ca\u306fnode[1-4]\u306e4\u53f0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002node1\u306e\u30b3\u30f3\u30c6\u30ca\u306fAmbari Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n`ambari-server`\u30b5\u30fc\u30d3\u30b9\u304cforeground\u3067\u30d5\u30ed\u30f3\u30c8\u3067\u5b9f\u884c\u3067\u304d\u306a\u3044\u306e\u3067`tail -f /dev/null`\u3059\u308bcommand\u306b\u3057\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u826f\u3044\u65b9\u6cd5\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\n* --privileged: [ambari-bootstrap](https://github.com/seanorama/ambari-bootstrap)\u306b\u6a29\u9650\u304c\u5fc5\u8981\u306a\u305f\u3081\n* --name: `/etc/host`\u306b\u308f\u304b\u308a\u3084\u3059\u3044hostname\u3092\u3064\u3051\u308b\n* --hostname: `/etc/host`\u306b`zeppelin`\u30c9\u30e1\u30a4\u30f3\u306ehostname\u3092\u3064\u3051\u308b\n* --net: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3046\n* --env: swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u5236\u7d04\u3092\u5165\u308c\u308b\n\n```bash\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker run -d \\\n  --privileged \\\n  --name node1 \\\n  --hostname node1.zeppelin \\\n  --net zeppelin \\\n  --env constraint:node==swarm-1 \\\n  centos:6 \\\n  tail -f /dev/null\n```\n\n\u3000node[2-4]\u306e3\u53f0\u306f`--name`\u3068`--hostname`\u4ee5\u5916\u306f\u540c\u3058\u3067\u3059\u3002\n\n* node2\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker run -d \\\n  --privileged \\\n  --name node2 \\\n  --hostname node2.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n```\n\n* node3\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker run -d \\\n  --privileged \\\n  --name node3 \\\n  --hostname node3.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n```\n\n* node4\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker run -d \\\n  --privileged \\\n  --name node4 \\\n  --hostname node4.zeppelin \\\n  --net zeppelin \\\n  centos:6 \\\n  tail -f /dev/null\n```\n\n\u3000`docker ps`\u3067\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u304cswarm-[1-3]\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u5206\u6563\u3057\u3066\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                   NAMES\nea0cfa4631e9        centos:6            \"tail -f /dev/null\"      11 seconds ago      Up 10 seconds                                                                               swarm-2/node4\nac1d338d54ce        centos:6            \"tail -f /dev/null\"      26 seconds ago      Up 24 seconds                                                                               swarm-3/node3\n7643d9256e83        centos:6            \"tail -f /dev/null\"      33 seconds ago      Up 31 seconds                                                                               swarm-2/node2\nceb2fc18d7f3        centos:6            \"tail -f /dev/null\"      42 seconds ago      Up 40 seconds                                                                               swarm-1/node1\n```\n\n## ambari-bootstrap\u3092\u4f7f\u3046\n\n\u3000[ambari-bootstrap](https://github.com/seanorama/ambari-bootstrap)\u3092\u4f7f\u3063\u3066Ambari\u30ce\u30fc\u30c9\u306ebootstrapping\u3092\u3057\u307e\u3059\u3002\u672c\u6765\u306fDocker\u30a4\u30e1\u30fc\u30b8\u306b\u843d\u3068\u3057\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u306a\u306e\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066\u4f5c\u696d\u3057\u3066\u3044\u304d\u307e\u3059\u3002[An Ambari Service for Zeppelin](https://github.com/hortonworks-gallery/ambari-zeppelin-service)\u306eOption2\u306e\u624b\u9806\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n### node[2-4]\u30b3\u30f3\u30c6\u30ca\n\n\u30003\u53f0\u306eAmbari Node\u306b\u5165\u3063\u3066\u4f5c\u696d\u3057\u307e\u3059\u3002Docker Swarm\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308bDocker\u30db\u30b9\u30c8\u4ee5\u5916\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306b\u3082`docker exec`\u3067\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306fnode2\u306e\u4f8b\u3067\u3059\u3002node3\u3068node4\u3082\u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n* node2\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker exec -it node2 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n```\n\n* node3\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker exec -it node3 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n```\n\n* node4\u30b3\u30f3\u30c6\u30ca\n\n```bash\n$ docker exec -it node4 bash\n$ export ambari_server=node1\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n```\n\n### node1\u30b3\u30f3\u30c6\u30ca\n\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306bAmbari Server\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Hortnworks Gallery\u306e[ambari-zeppelin-service](https://github.com/hortonworks-gallery/ambari-zeppelin-service)\u3092`git clone`\u3057\u3066\u3001Ambari\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066Zeppelin\u3092\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```bash\n$ docker exec -it node1 bash\n$ export install_ambari_server=true\n$ curl -sSL https://raw.githubusercontent.com/seanorama/ambari-bootstrap/master/ambari-bootstrap.sh | sh\n$ yum install -y git\n$ VERSION=2.3\n$ git clone https://github.com/hortonworks-gallery/ambari-zeppelin-service.git /var/lib/ambari-server/resources/stacks/HDP/$VERSION/services/ZEPPELIN\n```\n\n\u3000ambari-server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u308f\u3063\u305f\u3089\u3001role_command_order.json\u306egeneral_deps\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u9069\u5f53\u306a\u4f4d\u7f6e\u306b`\"ZEPPELIN_MASTER-START\": [\"NAMENODE-START\", \"DATANODE-START\"],`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```json:/var/lib/ambari-server/resources/stacks/HDP/2.3/role_command_order.json\n...\n    \"KAFKA_BROKER-START\" : [\"ZOOKEEPER_SERVER-START\", \"RANGER_USERSYNC-START\", \"NAMENODE-START\"],\n    \"NIMBUS-START\" : [\"ZOOKEEPER_SERVER-START\", \"RANGER_USERSYNC-START\", \"NAMENODE-START\"],\n    \"ZEPPELIN_MASTER-START\": [\"NAMENODE-START\", \"DATANODE-START\"],\n    \"STORM_UI_SERVER-START\" : [\"NIMBUS-START\", \"NAMENODE-START\"]\n  }\n}\n```\n\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306eambari-server\u3068ambari-agent\u3092restart\u3057\u307e\u3059\u3002\n\n```bash\n$ service ambari-server restart\n$ service ambari-agent restart\n```\n\n\u3000Ambari\u306eREST API\u3092\u5b9f\u884c\u3057\u3066\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3059\u308b\u30db\u30b9\u30c8\u306e\u60c5\u5831\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/hosts\n{\n  \"href\" : \"http://localhost:8080/api/v1/hosts\",\n  \"items\" : [\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node1.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node1.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node2.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node2.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node3.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node3.zeppelin\"\n      }\n    },\n    {\n      \"href\" : \"http://localhost:8080/api/v1/hosts/node4.zeppelin\",\n      \"Hosts\" : {\n        \"host_name\" : \"node4.zeppelin\"\n      }\n    }\n  ]\n}\n```\n\n## Ambari Blueprint\n\n\u3000\u5f15\u304d\u7d9a\u304dnode1\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker exec -it node1 bash\n```\n\n\u3000\u6700\u521d\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068[ambari-bootstrap](https://github.com/seanorama/ambari-bootstrap)\u3092clone\u3057\u307e\u3059\u3002\n\n```bash\n$ yum install -y python-argparse\n$ cd \n$ git clone https://github.com/seanorama/ambari-bootstrap.git\n```\n\n### bluerprint.json\u3068cluster.json\u3092\u4f5c\u6210\n\n\u3000`ambari-bootstrap/deploy`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066Ambari\u30b5\u30fc\u30d3\u30b9\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002Zeppelin\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30df\u30cb\u30de\u30eb\u306a\u69cb\u6210\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n```bash\n$ export ambari_services=\"HDFS MAPREDUCE2 YARN ZOOKEEPER HIVE ZEPPELIN SPARK\"\n```\n\n\u3000`deploy-recommended-cluster.bash`\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u9014\u4e2d\u3067\u30db\u30b9\u30c8\u53f0\u6570\u3092\u805e\u304b\u308c\u307e\u3059\u3002\u5148\u307b\u3069\u78ba\u8a8d\u3057\u305f4\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```bash\n$ cd ambari-bootstrap/deploy\n$ export deploy=false\n$ bash ./deploy-recommended-cluster.bash\n\n        Please enter the number of hosts you are expecting,\n        or enter \"skip\" to proceed without the host check.\n\n        This prompt when timeout in 30 seconds.\n\n        host_count: 4\nDeploying the cluster once 4 hosts are registered.\n\n\nFri Jan 15 08:01:42 UTC 2016\n\n# Checking the number of registered hosts before proceeding with deployment\n===========================================================================\n\n  * Hosts expected:   4\n  * Hosts registered: 4\n\nSuccess: All hosts have checked in!\n\n# Deploying Hortonworks Data Platform using Ambari Blueprint Recommendations\n============================================================================\n```\n\n\u3000`tempdir*`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u79fb\u52d5\u3057\u307e\u3059\u3002\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308bblueprint.json\u3068cluster.json\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```bash\n$ cd tempdir*\n$ ls\nblueprint.json  configurations.json  request-configurations.json\ncluster.json    host_groups.json     request-host_groups.json\n```\n\n\u3000`ambari_services`\u74b0\u5883\u5909\u6570\u306b`HDFS MAPREDUCE2 YARN ZOOKEEPER HIVE ZEPPELIN SPARK`\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u304c`Ambari\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066blueprint.json\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002`zeppelin.host.publicname`\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002node1\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b`--env constraint:node==swarm-1`\u306e\u5236\u7d04\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3057\u3066\u3044\u308b\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```json:blueprint.json\n...\n \"configurations\": [\n    {\n      \"zeppelin-ambari-config\": {\n        \"zeppelin.executor.mem\": \"512m\",\n        \"zeppelin.executor.instances\": \"2\",\n        \"zeppelin.host.publicname\": \"210.xxx.xxx.xxx\",\n        \"zeppelin.install.dir\": \"/opt\"\n      }\n    },\n...\n}\n```\n\n\u3000\u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u306b\u5411\u3051\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5185\u90e8\u304b\u3089\u3082\u901a\u4fe1\u3092\u884c\u3044\u307e\u3059\u3002IDCF\u30af\u30e9\u30a6\u30c9\u306e\u5834\u5408\u306f\u3053\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30eb\u30fc\u30bf\u5185\u304b\u3089\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n* 10.3.0.101/21\n* TCP: 1-65535\n\n<img width=\"512\" alt=\"idcfcloud-vr.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/c6e09244-1dbc-84e6-9806-798652953846.png\">\n\n\u3000blueprint.json\u306b\u306fhost-group-[1-4]\u307e\u30674\u3064\u306e\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\u6b21\u306ecluster.json\u306e\u4e2d\u3067\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u3077\u3068\u30db\u30b9\u30c8(Ambari Node\u306eDocker\u30b3\u30f3\u30c6\u30ca)\u3092\u30de\u30c3\u30d7\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```json:blueprint.json\n  \"host_groups\": [\n    {\n      \"name\": \"host-group-2\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-4\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"HIVE_SERVER\"\n        },\n        {\n          \"name\": \"APP_TIMELINE_SERVER\"\n        },\n        {\n          \"name\": \"HISTORYSERVER\"\n        },\n        {\n          \"name\": \"HIVE_METASTORE\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"RESOURCEMANAGER\"\n        },\n        {\n          \"name\": \"WEBHCAT_SERVER\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        },\n        {\n          \"name\": \"SECONDARY_NAMENODE\"\n        },\n        {\n          \"name\": \"MYSQL_SERVER\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-3\",\n      \"components\": [\n        {\n          \"name\": \"YARN_CLIENT\"\n        },\n        {\n          \"name\": \"ZEPPELIN_MASTER\"\n        },\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"HDFS_CLIENT\"\n        },\n        {\n          \"name\": \"HIVE_CLIENT\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        },\n        {\n          \"name\": \"MAPREDUCE2_CLIENT\"\n        },\n        {\n          \"name\": \"NAMENODE\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_CLIENT\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"SPARK_CLIENT\"\n        },\n        {\n          \"name\": \"SPARK_JOBHISTORYSERVER\"\n        },\n        {\n          \"name\": \"HCAT\"\n        }\n      ]\n    },\n    {\n      \"name\": \"host-group-1\",\n      \"components\": [\n        {\n          \"name\": \"NODEMANAGER\"\n        },\n        {\n          \"name\": \"ZOOKEEPER_SERVER\"\n        },\n        {\n          \"name\": \"JOURNALNODE\"\n        },\n        {\n          \"name\": \"DATANODE\"\n        }\n      ]\n    }\n  ],\n```\n\n\u3000\u7de8\u96c6\u3057\u305fblueprint.json\u3092Ambari Server\u306bupload\u3057\u307e\u3059\u3002URL\u306e`/zeppelinBP`\u304cblueprint\u306e\u540d\u524d\u3067\u3059\u3002\n\n```bash\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/blueprints/zeppelinBP -d @blueprint.json\n```\n\n\u3000cluster.json\u306b\u306fAmbari Node\u306e\u30b3\u30f3\u30c6\u30ca\u304cFQDN\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002`blueprint`\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u4f7f\u7528\u3059\u308bblueprint\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```json:cluster.json\n{\n  \"blueprint\": \"zeppelinBP\",\n  \"default_password\": \"hadoop\",\n  \"host_groups\": [\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node3.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-3\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node2.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-2\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node4.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-4\"\n    },\n    {\n      \"hosts\": [\n        {\n          \"fqdn\": \"node1.zeppelin\"\n        }\n      ],\n      \"name\": \"host-group-1\"\n    }\n  ]\n}\n```\n\n|\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7|\u30db\u30b9\u30c8(Ambari Node\u30b3\u30f3\u30c6\u30ca)|\u4eee\u60f3\u30de\u30b7\u30f3|\n|:--|:--|:--|\n|host-group-1|node1.zeppelin|swarm-1|\n|host-group-2|node2.zeppelin|swarm-2|\n|host-group-3|node3.zeppelin|swarm-3|\n|host-group-4|node4.zeppelin|swarm-2|\n\n\u3000\u7de8\u96c6\u3057\u305fcluster.json\u30d5\u30a1\u30a4\u30eb\u3092Ambari Server\u306bPOST\u3057\u3066HDP\u30af\u30e9\u30b9\u30bf\u3068Zeppelin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002URL\u306e`/zeppelin`\u304cHDP\u30af\u30e9\u30b9\u30bf\u306e\u540d\u524d\u306b\u306a\u308a\u307e\u3059\u3002Accepted\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308aAmbari\u30b5\u30fc\u30d3\u30b9\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u958b\u59cb\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ curl -u admin:admin -H  X-Requested-By:ambari http://localhost:8080/api/v1/clusters/zeppelin -d @cluster.json\n{\n  \"href\" : \"http://localhost:8080/api/v1/clusters/zeppelin/requests/1\",\n  \"Requests\" : {\n    \"id\" : 1,\n    \"status\" : \"Accepted\"\n  }\n}[\n```\n\n## Nginx\n\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305fAmbari Server\u3092\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306bNginx\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Ambari Server\u306enode1\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u540c\u3058swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ mkdir ~/nginx\n$ cd ~/nginx\n```\n\n\u3000Nginx\u306e[\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30a4\u30e1\u30fc\u30b8](https://hub.docker.com/_/nginx/)\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066Dockerfile\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```bash:Dockerfile\nFROM nginx\nADD default.conf /etc/nginx/conf.d/default.conf\n```\n\n\u3000Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u30029995\u30dd\u30fc\u30c8\u306fZeppelin\u304c\u4f7f\u3044\u307e\u3059\u3002WebSocket\u3082\u540c\u3058\u30dd\u30fc\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002Zeppelin\u306eNotebook\u304c\u3059\u3050\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u306a\u3044\u3088\u3046\u306b\u6642\u9593\u3092\u5ef6\u3070\u3057\u307e\u3059\u30028080\u30dd\u30fc\u30c8\u304cAmbari Server\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u3059\u3002\n\n```bash:default.conf\nserver {\n  listen 9995;\n  location / {\n    proxy_set_header   Host $host;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://node1.zeppelin:9995;\n    proxy_http_version 1.1;\n    proxy_set_header   Upgrade $http_upgrade;\n    proxy_set_header   Connection \"upgrade\";\n    proxy_read_timeout 86400;\n  }\n}\n\nserver {\n  listen 8080;\n  location / {\n    proxy_set_header   Host $host:$server_port;\n    proxy_set_header   X-Real-IP $remote_addr;\n    proxy_set_header   X-Forwarded-Host $host;\n    proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header   X-Forwarded-Proto $scheme;\n    proxy_pass         http://node1.zeppelin:8080;\n  }\n}\n```\n\n\u3000Docker\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002`--env constraint:node==swarm-1`\u306e\u5236\u7d04\u3092\u5165\u308c\u3066swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\n```bash\n$ docker build -t masato/nginx .\n$ export DOCKER_HOST=tcp://10.3.0.201:3333\n$ docker run -d \\\n  --name nginx \\\n  --net zeppelin \\\n  --env constraint:node==swarm-1 \\\n  -p 8080:8080 \\\n  -p 9995:9995 \\\n  masato/nginx\n```\n\n\u3000`docker ps`\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002swarm-1\u4eee\u60f3\u30de\u30b7\u30f3\u4e0a\u3067Nginx\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                                   NAMES\n5be44394b88b        masato/nginx        \"nginx -g 'daemon off\"   4 seconds ago       Up 4 seconds        80/tcp, 10.3.0.201:8080->8080/tcp, 443/tcp, 10.3.0.201:9995->9995/tcp   swarm-1/nginx\n```\n\n\u3000IDCF\u30af\u30e9\u30a6\u30c9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304dAmbari Server\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n* Username: admin\n* Password: admin\n\n<img width=\"512\" alt=\"ambari-login.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/0b00c15b-2744-3ba1-a8d6-c4cfc9003a56.png\">\n\n\n\u3000\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002Ambari\u30b5\u30fc\u30d3\u30b9\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306a\u306e\u9ec4\u8272\u3044\u30a2\u30a4\u30b3\u30f3\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u3002`9 ops`\u306fn\u73fe\u5728\u5b9f\u884c\u4e2d\u306e\u51e6\u7406\u6570\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n<img width=\"512\" alt=\"ambari-dashboard.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/93386cf3-8857-a898-db34-47dd7674af2c.png\">\n\n\u3000\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30a4\u30b3\u30f3\u304c\u5168\u3066\u7dd1\u8272\u306b\u306a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u7d42\u4e86\u3057\u307e\u3059\u3002Hadoop\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3082Ambari Blueprint\u304b\u3089\u7c21\u5358\u306b\u30bb\u30c3\u30c8\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002\n\n\n<img width=\"512\" alt=\"ambari-dashboard.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/cd63a7b3-1865-fd0f-3245-4107daf576a3.png\">\n\n\n## Ambari View\n\n\u3000[Ambari View](https://cwiki.apache.org/confluence/display/AMBARI/Views)\u306f\u30d7\u30e9\u30b0\u30a4\u30f3\u5f62\u5f0f\u3067Ambari\u753b\u9762\u306bAmbari\u30b5\u30fc\u30d3\u30b9\u306e\u753b\u9762\u3092\u57cb\u3081\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3000Ambari\u753b\u9762\u306e\u4e0a\u30e1\u30cb\u30e5\u30fc\u306eAmbari View\u306e\u30e1\u30cb\u30e5\u30fc\u3067\u3059\u3002\n\n<img width=\"512\" alt=\"ambari-menus.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/a4e87216-aeee-5c5b-ae2f-89aa64e90d6b.png\">\n\n### Hive View \n\n\u3000node1\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308aroot\u30e6\u30fc\u30b6\u30fc\u3068admin\u30e6\u30fc\u30b6\u30fc\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092HDFS\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306fZeppelin View\u3084Hive View\u304b\u3089Hive\u306e\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u6642\u306b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ docker exec -it node1 bash\n$ su hdfs \n$ hadoop fs -mkdir /user/root\n$ hadoop fs -chown root /user/root\n$ hadoop fs -mkdir /user/admin\n$ hadoop fs -chown admin /user/admin\n```\n\n HDFS\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u753b\u9762\u3092\u958b\u304d\u307e\u3059\u3002\n\n<img width=\"512\" alt=\"hdfs-service.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/14cc6dd2-b987-192e-65b6-c32c667200a9.png\">\n\n\u3000Advanced\u30bf\u30b0\u3092\u4e0b\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3066Custom core-site\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u958b\u304d\u307e\u3059\u3002Add Property\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002`root`\u306e\u7b87\u6240\u306fOS\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u304croot\u306e\u5834\u5408\u3067\u3059\u3002\n\n* key: hadoop.proxyuser.root.groups, value: *\n* key: hadoop.proxyuser.root.hosts, value: *\n\n<img width=\"512\" alt=\"hdfs-add-property.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/3aa29b8b-60be-fe27-ea04-3175d538b60e.png\">\n\n\u3000`Sava`\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u5909\u66f4\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u305d\u306e\u3042\u3068\u306b`Restart`\u30dc\u30bf\u30f3\u306e`Restart All Affected`\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u5909\u66f4\u306e\u5f71\u97ff\u304c\u3042\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002MapReduce2\u30b5\u30fc\u30d3\u30b9\u3068YARN\u30b5\u30fc\u30d3\u30b9\u3082\u5f71\u97ff\u30de\u30fc\u30af\u306e\u30a2\u30a4\u30b3\u30f3\u304c\u51fa\u3066\u3044\u308b\u306e\u3067\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n\n\u3000Ambari View\u304b\u3089Hive\u30d3\u30e5\u30fc\u3092\u958b\u304d\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3082\u8868\u793a\u3055\u308c\u30a8\u30e9\u30fc\u3082\u306a\u304f\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n<img width=\"512\" alt=\"hive-view.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/c1ac1cdd-46ba-76fc-873d-9cd67cb9c24c.png\">\n\n\n### Zeppelin View\n\n\u3000Zeppelin\u306fAmbari Server\u3068\u540c\u3058node1\u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308b\u306e\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3068\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ docker exec -it node1 bash\n$ service ambari-server restart\n```\n\n\u3000Zeppelin\u304cAmbari\u753b\u9762\u306e\u4e2d\u306b\u57cb\u3081\u8fbc\u307e\u308c\u305f\u72b6\u614b\u3067\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n<img width=\"512\" alt=\"zeppelin-iframe.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/5c9018f6-2023-c360-a1e9-e79f9a644190.png\">\n\n\n\n\u30009995\u30dd\u30fc\u30c8\u304b\u3089Zeppelin\u3092\u76f4\u63a5\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n<img width=\"512\" alt=\"zeppelin-solo.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43745/a1186f84-ed06-484b-ee43-5a136b3ab832.png\">\n"}