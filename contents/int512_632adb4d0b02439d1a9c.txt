{"context": "\n\n\u74b0\u5883\n\n\u79fb\u884c\u5143: Fedora22\u4e0a\u306e\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fGitLab 8.9.3\n\u79fb\u884c\u5148: CentOS7 (1511)\u4e0a\u306eGitLab 8.9.3 (omnibus\u7248)\n\n\n\u30c7\u30fc\u30bf\u306e\u79fb\u884c\u65b9\u6cd5\n\u79fb\u884c\u5148\u306e\u74b0\u5883\u306b\u516c\u5f0f\u306e\u624b\u9806\u901a\u308aGitLab\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\uff0cgitlab-ctl reconfigure\u3057\u3066\u304b\u3089gitlab-rake gitlab:backup:restore\u3067\u79fb\u884c\u5143\u306e\u74b0\u5883\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ea\u30b9\u30c8\u30a2\uff0e\n(\u3053\u306e\u8fba\u306f\u3042\u307e\u308a\u3061\u3083\u3093\u3068\u899a\u3048\u3066\u306a\u3044)\n\n\u73fe\u8c61\nGitLab\u3092\u5225\u30b5\u30fc\u30d0\u306b\u79fb\u884c\u5f8c\uff0c\u4e00\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30da\u30fc\u30b8\u3092\u958b\u3044\u305f\u6642\u306b500\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u60c5\u5831\u304c\u898b\u308c\u306a\u304f\u306a\u308b\uff0e\nproduction.log\u306b\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u5185\u5bb9\u304c\u8a18\u9332\u3055\u308c\u308b\uff0e\nParameters: {\"namespace_id\"=>\"...\", \"id\"=>\"...\"}\nCompleted 500 Internal Server Error in 71ms (ActiveRecord: 5.5ms)\n\nOpenSSL::Cipher::CipherError (bad decrypt):\napp/models/project.rb:456:in `import_url'\napp/models/project.rb:486:in `external_import?'\napp/models/project.rb:478:in `import?'\napp/models/project.rb:494:in `import_in_progress?'\napp/controllers/projects_controller.rb:93:in `show'\nlib/gitlab/middleware/go.rb:16:in `call'\n\n\n\u5bfe\u51e6\u6cd5\n\u79fb\u884c\u524d\u306e\u74b0\u5883\u304b\u3089db_key_base\u3092\u30b3\u30d4\u30fc\u3057\u3066\u6301\u3063\u3066\u304f\u308b\uff0e\n\n\u3068\u308a\u3042\u3048\u305agitlab-ctl stop\u3067GitLab\u3092\u6b62\u3081\u308b\uff0e\n\u30bd\u30fc\u30b9\u304b\u3089\u306e\u79fb\u884c\u306e\u5834\u5408\u306f\u79fb\u884c\u5143\u306e\u74b0\u5883\u306e/home/git/config/gitlab_secrets.yml\u306b\u305d\u308c\u3063\u307d\u3044\u30ad\u30fc\u304c\u3042\u308b\u306e\u3067\u305d\u306e\u5024\u3092\u30e1\u30e2\u3059\u308b\uff0e(\u5f8c\u8ff0\u306e\u901a\u308aomnibus\u7248\u306e\u5834\u5408\u306f/etc/gitlab/gitlab-secrets.json\u306b\u3042\u308b)\n\u79fb\u884c\u5148\u306e\u74b0\u5883\u3067/etc/gitlab/gitlab-secrets.json\u3092\u958b\u304d\uff0cgitlab_ci\u306edb_key_base\u306e\u5024\u30922.\u3067\u30e1\u30e2\u3057\u305f\u5024\u306b\u66f8\u304d\u63db\u3048\u308b\uff0e\nCE\u7248\u3067\u3042\u308c\u3070gitlab-rails runner \"Project.where.not(import_url: nil).each { |p| p.import_data.destroy if p.import_data }\"\u3092\u5b9f\u884c\u3057\u3066\u4e0d\u8981\u306b\u306a\u3063\u305f\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\uff1f (\u3042\u307e\u308a\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044)\n\ngitlab-ctl start\u3067GitLab\u3092\u8d77\u52d5\u3059\u308b\uff0e\n\n\u3053\u308c\u3067\u3061\u3083\u3093\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u306f\u305a\uff0e\n\n\u53c2\u8003\u30da\u30fc\u30b8\n\nhttps://gitlab.com/gitlab-org/gitlab-ce/issues/17873\n\n# \u74b0\u5883\n* \u79fb\u884c\u5143: Fedora22\u4e0a\u306e\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fGitLab 8.9.3\n* \u79fb\u884c\u5148: CentOS7 (1511)\u4e0a\u306eGitLab 8.9.3 (omnibus\u7248)\n\n# \u30c7\u30fc\u30bf\u306e\u79fb\u884c\u65b9\u6cd5\n\u79fb\u884c\u5148\u306e\u74b0\u5883\u306b\u516c\u5f0f\u306e\u624b\u9806\u901a\u308aGitLab\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\uff0c`gitlab-ctl reconfigure`\u3057\u3066\u304b\u3089`gitlab-rake gitlab:backup:restore`\u3067\u79fb\u884c\u5143\u306e\u74b0\u5883\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ea\u30b9\u30c8\u30a2\uff0e\n\n(\u3053\u306e\u8fba\u306f\u3042\u307e\u308a\u3061\u3083\u3093\u3068\u899a\u3048\u3066\u306a\u3044)\n\n# \u73fe\u8c61\nGitLab\u3092\u5225\u30b5\u30fc\u30d0\u306b\u79fb\u884c\u5f8c\uff0c\u4e00\u90e8\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30da\u30fc\u30b8\u3092\u958b\u3044\u305f\u6642\u306b500\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u60c5\u5831\u304c\u898b\u308c\u306a\u304f\u306a\u308b\uff0e\n\nproduction.log\u306b\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u5185\u5bb9\u304c\u8a18\u9332\u3055\u308c\u308b\uff0e\n<pre>\nParameters: {\"namespace_id\"=>\"...\", \"id\"=>\"...\"}\nCompleted 500 Internal Server Error in 71ms (ActiveRecord: 5.5ms)\n\nOpenSSL::Cipher::CipherError (bad decrypt):\napp/models/project.rb:456:in \\`import_url'\napp/models/project.rb:486:in \\`external_import?'\napp/models/project.rb:478:in \\`import?'\napp/models/project.rb:494:in \\`import_in_progress?'\napp/controllers/projects_controller.rb:93:in \\`show'\nlib/gitlab/middleware/go.rb:16:in \\`call'\n</pre>\n\n# \u5bfe\u51e6\u6cd5\n\u79fb\u884c\u524d\u306e\u74b0\u5883\u304b\u3089`db_key_base`\u3092\u30b3\u30d4\u30fc\u3057\u3066\u6301\u3063\u3066\u304f\u308b\uff0e\n\n1. \u3068\u308a\u3042\u3048\u305a`gitlab-ctl stop`\u3067GitLab\u3092\u6b62\u3081\u308b\uff0e\n2. \u30bd\u30fc\u30b9\u304b\u3089\u306e\u79fb\u884c\u306e\u5834\u5408\u306f\u79fb\u884c\u5143\u306e\u74b0\u5883\u306e`/home/git/config/gitlab_secrets.yml`\u306b\u305d\u308c\u3063\u307d\u3044\u30ad\u30fc\u304c\u3042\u308b\u306e\u3067\u305d\u306e\u5024\u3092\u30e1\u30e2\u3059\u308b\uff0e(\u5f8c\u8ff0\u306e\u901a\u308aomnibus\u7248\u306e\u5834\u5408\u306f`/etc/gitlab/gitlab-secrets.json`\u306b\u3042\u308b)\n3. \u79fb\u884c\u5148\u306e\u74b0\u5883\u3067`/etc/gitlab/gitlab-secrets.json`\u3092\u958b\u304d\uff0c`gitlab_ci`\u306e`db_key_base`\u306e\u5024\u30922.\u3067\u30e1\u30e2\u3057\u305f\u5024\u306b\u66f8\u304d\u63db\u3048\u308b\uff0e\n4. CE\u7248\u3067\u3042\u308c\u3070`gitlab-rails runner \"Project.where.not(import_url: nil).each { |p| p.import_data.destroy if p.import_data }\"`\u3092\u5b9f\u884c\u3057\u3066\u4e0d\u8981\u306b\u306a\u3063\u305f\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\uff1f (\u3042\u307e\u308a\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044)\n5. `gitlab-ctl start`\u3067GitLab\u3092\u8d77\u52d5\u3059\u308b\uff0e\n\n\u3053\u308c\u3067\u3061\u3083\u3093\u3068\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u306f\u305a\uff0e\n\n# \u53c2\u8003\u30da\u30fc\u30b8\n* https://gitlab.com/gitlab-org/gitlab-ce/issues/17873\n", "tags": ["GitLab"]}