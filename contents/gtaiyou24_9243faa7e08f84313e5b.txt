{"context": "\n\n\u74b0\u5883\n\nubuntu\npython 2.7.10\nmysql\n\u4f7f\u7528\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\n\n\nMySQLdb\u3000\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u3063\u3066\u304f\u308b\u305f\u3081\ngoogleapiclient\u3000CustomSearchAPI\u3092\u4f7f\u3046\u305f\u3081\n\n\n\n\n\u524d\u63d0\nDatabase\n\u30c6\u30fc\u30d6\u30eb\u540d: companies\n\n\n\nid\nname(\u4f01\u696d\u540d)\naddress(\u4f4f\u6240)\nurl(\u4f01\u696d\u306eURL)\n\n\n\n\n1\n\u682a\u5f0f\u4f1a\u793e\u30a8\u30cc\u30fb\u30c6\u30a3\u30fb\u30c6\u30a3\u30fb\u30bd\u30eb\u30b3\n\u6771\u4eac\u90fd\u6e2f\u533a\u864e\u30ce\u95803-8-21\n\n\n\n2\n\u682a\u5f0f\u4f1a\u793e\u30e9\u30a6\u30f3\u30c9\u30ef\u30f3\n\u5927\u962a\u5e9c\u583a\u5e02\u583a\u533a\u620e\u5cf6\u753a\u56db\u4e0145\u756a\u57301\u583a\u99c5\u524d\u30dd\u30eb\u30bf\u30b9\u30bb\u30f3\u30bf\u30fc\u30d3\u30eb\n\n\n\n3\n\u682a\u5f0f\u4f1a\u793e\u30b8\u30a7\u30a4\u30fb\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u30fb\u30a2\u30ab\u30c7\u30df\u30fc\n\u6771\u4eac\u90fd\u65b0\u5bbf\u533a\u897f\u65b0\u5bbf3-20-2\u6771\u4eac\u30aa\u30da\u30e9\u30b7\u30c6\u30a3\u30fcB1\u30fb2\u968e\n\n\n\n4\n\u3000~\n~\n~\n\n\n5\n\u3000~\n~\n~\n\n\n6\n\u3000~\n~\n~\n\n\n\n\n\u3084\u308b\u3053\u3068\n\u4f01\u696d\u306eURL\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306bCustomSearchAPI\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u51e6\u7406\u306e\u6d41\u308c\u306f\n\n\n$ python main.py\u3092\u5b9f\u884c\u3059\u308b\ncompanies\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u7a7a\u306eurl\u3092\u53d6\u5f97\u3059\u308b(SELECT id, name, address FROM companies where url = '' or url IS NULL)\nname\u3068address\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u3064\u304f\u308a\u691c\u7d22\u3057\u3066URL\u3092\u53d6\u5f97\u3059\u308b\nurl\u3092DB\u306b\u683c\u7d0d\n\nfrom MySQLdb import connect, cursors\nfrom googleapiclient.discovery import build\n\ndef get_records_with_url_is_null(cursor):\n  res = None\n  sql = u\"SELECT id, name, address FROM companies WHERE url = '' or url IS NULL\"\n  cursor.execute(sql)\n  res = cursor.fetchall()\n  return res\n\nif __name__ == '__main__':\n  try:\n    connnector = connnect(\n      host='',\n      db='',\n      user='',\n      password='',\n      cursorclass=cursors.DictCursor\n    )\n  except:\n    print('MySQL connection Error!!!!')\n    exit()\n  finally:\n    cursor = connector.cursor()\n\n  rows = get_records_with_url_is_null(cursor)\n\n  service = build('customsearch', 'v1', developerKey='https://console.developers.google.com/\u3067customsearchapi\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3057\u3066API Key\u3092\u53d6\u5f97\u3059\u308b')\n  for row in rows:\n      res = service.cse().list(\n              q='{name} {address}'.format(name=row['name'], address=row['address']),\n              cx='https://cse.google.com\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066customsearch\u3092\u4f5c\u6210\u3057\u3066\u691c\u7d22\u30a8\u30f3\u30b8\u30f3ID\u3092\u53d6\u5f97'\n          ).execute()\n\n      print('==============================================')\n      print(res['queries']['request'][0]['searchTerms']) # query \n      print(res['items'][0]['link']) # url\n      sql = u\"UPDATE companies SET url='{url}' WHERE id={id}\".format(url=res['items'][0]['link'], id=row['id'])\n      cursor.execute(sql)\n      connector.commit()\n\n  print('finished!!!')\n\n\u53c2\u8003URL\nhttp://qiita.com/ysekky/items/92febaf8bbea541b1e36\nhttp://qiita.com/katryo/items/0db3195e35e916db56bc\nhttps://github.com/google/google-api-python-client/blob/master/samples/customsearch/main.py\nhttps://cse.google.com\nhttps://developers.google.com/custom-search/json-api/v1/reference/cse/list?hl=ja#response\n### \u74b0\u5883\n - ubuntu\n - python 2.7.10\n - mysql\n - \u4f7f\u7528\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\n  - MySQLdb\u3000\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u3063\u3066\u304f\u308b\u305f\u3081\n  - googleapiclient\u3000CustomSearchAPI\u3092\u4f7f\u3046\u305f\u3081\n\n### \u524d\u63d0\n\nDatabase\n\u30c6\u30fc\u30d6\u30eb\u540d: companies\n\n| id | name(\u4f01\u696d\u540d) | address(\u4f4f\u6240) | url(\u4f01\u696d\u306eURL) |\n|:---:|:--------------:|:-------------:|:--------------:|\n| 1 | \u682a\u5f0f\u4f1a\u793e\u30a8\u30cc\u30fb\u30c6\u30a3\u30fb\u30c6\u30a3\u30fb\u30bd\u30eb\u30b3 | \u6771\u4eac\u90fd\u6e2f\u533a\u864e\u30ce\u95803-8-21 |    |\n| 2 | \u682a\u5f0f\u4f1a\u793e\u30e9\u30a6\u30f3\u30c9\u30ef\u30f3 | \u5927\u962a\u5e9c\u583a\u5e02\u583a\u533a\u620e\u5cf6\u753a\u56db\u4e0145\u756a\u57301\u583a\u99c5\u524d\u30dd\u30eb\u30bf\u30b9\u30bb\u30f3\u30bf\u30fc\u30d3\u30eb |  |\n| 3 | \u682a\u5f0f\u4f1a\u793e\u30b8\u30a7\u30a4\u30fb\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u30fb\u30a2\u30ab\u30c7\u30df\u30fc       | \u6771\u4eac\u90fd\u65b0\u5bbf\u533a\u897f\u65b0\u5bbf3-20-2\u6771\u4eac\u30aa\u30da\u30e9\u30b7\u30c6\u30a3\u30fcB1\u30fb2\u968e | |\n| 4 |\u3000~  | ~ | ~ |\n| 5 |\u3000~  | ~ | ~ |\n| 6 |\u3000~  | ~ | ~ |\n\n### \u3084\u308b\u3053\u3068\n\u4f01\u696d\u306eURL\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306bCustomSearchAPI\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u51e6\u7406\u306e\u6d41\u308c\u306f\n\n1. `$ python main.py`\u3092\u5b9f\u884c\u3059\u308b\n2. companies\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u7a7a\u306eurl\u3092\u53d6\u5f97\u3059\u308b(```SELECT id, name, address FROM companies where url = '' or url IS NULL```)\n3. name\u3068address\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u3064\u304f\u308a\u691c\u7d22\u3057\u3066URL\u3092\u53d6\u5f97\u3059\u308b\n4. url\u3092DB\u306b\u683c\u7d0d\n\n```py\nfrom MySQLdb import connect, cursors\nfrom googleapiclient.discovery import build\n\ndef get_records_with_url_is_null(cursor):\n  res = None\n  sql = u\"SELECT id, name, address FROM companies WHERE url = '' or url IS NULL\"\n  cursor.execute(sql)\n  res = cursor.fetchall()\n  return res\n\nif __name__ == '__main__':\n  try:\n    connnector = connnect(\n      host='',\n      db='',\n      user='',\n      password='',\n      cursorclass=cursors.DictCursor\n    )\n  except:\n    print('MySQL connection Error!!!!')\n    exit()\n  finally:\n    cursor = connector.cursor()\n\n  rows = get_records_with_url_is_null(cursor)\n  \n  service = build('customsearch', 'v1', developerKey='https://console.developers.google.com/\u3067customsearchapi\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3057\u3066API Key\u3092\u53d6\u5f97\u3059\u308b')\n  for row in rows:\n      res = service.cse().list(\n              q='{name} {address}'.format(name=row['name'], address=row['address']),\n              cx='https://cse.google.com\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066customsearch\u3092\u4f5c\u6210\u3057\u3066\u691c\u7d22\u30a8\u30f3\u30b8\u30f3ID\u3092\u53d6\u5f97'\n          ).execute()\n\n      print('==============================================')\n      print(res['queries']['request'][0]['searchTerms']) # query \n      print(res['items'][0]['link']) # url\n      sql = u\"UPDATE companies SET url='{url}' WHERE id={id}\".format(url=res['items'][0]['link'], id=row['id'])\n      cursor.execute(sql)\n      connector.commit()\n\n  print('finished!!!')\n```\n\n\u53c2\u8003URL\n\nhttp://qiita.com/ysekky/items/92febaf8bbea541b1e36\nhttp://qiita.com/katryo/items/0db3195e35e916db56bc\nhttps://github.com/google/google-api-python-client/blob/master/samples/customsearch/main.py\nhttps://cse.google.com\nhttps://developers.google.com/custom-search/json-api/v1/reference/cse/list?hl=ja#response\n", "tags": ["googleapi", "GoogleAppEngine", "JSON", "python2.7"]}