{"tags": ["VyOS", "VPN"], "context": " More than 1 year has passed since last update.\n\n\u30ed\u30b0\u30a4\u30f3\n\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u3082\u306b\u300cvyos\u300d\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\n$ configure\n# set interfaces ethernet eth0 address [IPADDRESS]/[MASK]\n# set system gateway-address [GATEWAY ADDRESS]\n# set system name-server [NAME SERVER ADDRESS]\n# set system time-zone Asia/Tokyo\n# delete system ntp server\n# set system ntp server ntp.jst.mfeed.ad.jp\n# set service ssh\n# commit\n# save\n# exit\n\n\n\u758e\u901a\u78ba\u8a8d\n$ ping 8.8.8.8\n\n\n\u30e6\u30fc\u30b6\u4f5c\u6210\n$ configure\n# set system login user [USERNAME]\n# set system login user [USERNAME] authentication plaintext-password [PASSWORD]\n# commit\n# save\n# exit\n\n\n\u521d\u671f\u30e6\u30fc\u30b6\u524a\u9664\n$ configure\n# delete system login user vyos\n# commit\n# save\n# exit\n\n\n\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\n$ ssh-keygen\n$ cat ~/.ssh/id_rsa.pub\n$ cat ~/.ssh/id_rsa\n$ configure\n# set system login user [USERNAME] authentication public-keys [USERNAME]@[HOSTNAME] type ssh-rsa\n# set system login user [USERNAME] authentication public-keys [USERNAME]@[HOSTNAME] key [PUBKEY]\n# set service ssh disable-password-authentication\n# commit\n# save\n# exit\n\n\nIPsec\u306e\u8a2d\u5b9a\n$ configure\n# set vpn ipsec ipsec-interfaces interface eth0\n# set vpn ipsec nat-traversal enable\n# set vpn ipsec nat-networks allowed-network 0.0.0.0/0\n# commit\n# save\n\n\nL2TP\u306e\u8a2d\u5b9a\n# set vpn l2tp remote-access outside-address [IPADDRESS]\n# set vpn l2tp remote-access outside-nexthop [GATEWAY ADDRESS]\n# set vpn l2tp remote-access client-ip-pool start 192.168.110.1\n# set vpn l2tp remote-access client-ip-pool stop 192.168.110.100\n# set vpn l2tp remote-access dns-servers server-1 8.8.8.8\n# set vpn l2tp remote-access dns-servers server-2 8.8.4.4\n# set vpn l2tp remote-access ipsec-settings authentication mode pre-shared-secret\n# set vpn l2tp remote-access ipsec-settings authentication pre-shared-secret [SHARED SECRET]\n# set vpn l2tp remote-access authentication mode local\n# set vpn l2tp remote-access authentication local-users username [USERNAME] password [PASSWORD]\n# commit\n# save\n\n\nNAT\u8a2d\u5b9a\n# set nat source rule 999 outbound-interface eth0\n# set nat source rule 999 translation address masquerade\n# commit\n# save\n# exit\n\n\n\u904b\u7528\u4e2d\u306b\u4f7f\u3046\u304b\u3082\u306a\u30b3\u30de\u30f3\u30c9\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074IP\u30a2\u30c9\u30ec\u30b9\u56fa\u5b9a\nset vpn l2tp remote-access authentication local-users username TESTUSER static-ip 192.168.1.105\n\n\n\u30e6\u30fc\u30b6\u7121\u52b9\u5316\nset vpn l2tp remote-access authentication local-users username TESTUSER disable\n\n\n\u53c2\u8003\n\u3055\u304f\u3089\u306eVPS\u3067Vyatta\u3092\u4f7f\u3063\u305fVPN\u30c8\u30f3\u30cd\u30eb\u306e\u69cb\u7bc9\n\u3055\u304f\u3089\u306eVPS\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nVyOS\u3067IPSec VPN\u306e\u8a2d\u5b9a\n#\u30ed\u30b0\u30a4\u30f3\n\u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u3082\u306b\u300cvyos\u300d\n#\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\n```\n$ configure\n# set interfaces ethernet eth0 address [IPADDRESS]/[MASK]\n# set system gateway-address [GATEWAY ADDRESS]\n# set system name-server [NAME SERVER ADDRESS]\n# set system time-zone Asia/Tokyo\n# delete system ntp server\n# set system ntp server ntp.jst.mfeed.ad.jp\n# set service ssh\n# commit\n# save\n# exit\n```\n#\u758e\u901a\u78ba\u8a8d\n```\n$ ping 8.8.8.8\n```\n#\u30e6\u30fc\u30b6\u4f5c\u6210\n```\n$ configure\n# set system login user [USERNAME]\n# set system login user [USERNAME] authentication plaintext-password [PASSWORD]\n# commit\n# save\n# exit\n```\n#\u521d\u671f\u30e6\u30fc\u30b6\u524a\u9664\n```\n$ configure\n# delete system login user vyos\n# commit\n# save\n# exit\n```\n#\u516c\u958b\u9375\u8a8d\u8a3c\u306e\u8a2d\u5b9a\n```\n$ ssh-keygen\n$ cat ~/.ssh/id_rsa.pub\n$ cat ~/.ssh/id_rsa\n$ configure\n# set system login user [USERNAME] authentication public-keys [USERNAME]@[HOSTNAME] type ssh-rsa\n# set system login user [USERNAME] authentication public-keys [USERNAME]@[HOSTNAME] key [PUBKEY]\n# set service ssh disable-password-authentication\n# commit\n# save\n# exit\n```\n#IPsec\u306e\u8a2d\u5b9a\n```\n$ configure\n# set vpn ipsec ipsec-interfaces interface eth0\n# set vpn ipsec nat-traversal enable\n# set vpn ipsec nat-networks allowed-network 0.0.0.0/0\n# commit\n# save\n```\n#L2TP\u306e\u8a2d\u5b9a\n```\n# set vpn l2tp remote-access outside-address [IPADDRESS]\n# set vpn l2tp remote-access outside-nexthop [GATEWAY ADDRESS]\n# set vpn l2tp remote-access client-ip-pool start 192.168.110.1\n# set vpn l2tp remote-access client-ip-pool stop 192.168.110.100\n# set vpn l2tp remote-access dns-servers server-1 8.8.8.8\n# set vpn l2tp remote-access dns-servers server-2 8.8.4.4\n# set vpn l2tp remote-access ipsec-settings authentication mode pre-shared-secret\n# set vpn l2tp remote-access ipsec-settings authentication pre-shared-secret [SHARED SECRET]\n# set vpn l2tp remote-access authentication mode local\n# set vpn l2tp remote-access authentication local-users username [USERNAME] password [PASSWORD]\n# commit\n# save\n```\n#NAT\u8a2d\u5b9a\n```\n# set nat source rule 999 outbound-interface eth0\n# set nat source rule 999 translation address masquerade\n# commit\n# save\n# exit\n```\n#\u904b\u7528\u4e2d\u306b\u4f7f\u3046\u304b\u3082\u306a\u30b3\u30de\u30f3\u30c9\n###\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074IP\u30a2\u30c9\u30ec\u30b9\u56fa\u5b9a\n```\nset vpn l2tp remote-access authentication local-users username TESTUSER static-ip 192.168.1.105\n```\n###\u30e6\u30fc\u30b6\u7121\u52b9\u5316\n```\nset vpn l2tp remote-access authentication local-users username TESTUSER disable\n```\n\n#\u53c2\u8003\n[\u3055\u304f\u3089\u306eVPS\u3067Vyatta\u3092\u4f7f\u3063\u305fVPN\u30c8\u30f3\u30cd\u30eb\u306e\u69cb\u7bc9](http://blog.d6rkaiz.com/archives/2013/09/07/configure-personal-vpn-tunnel-in-vyatta-with-sakura-vps/)\n[\u3055\u304f\u3089\u306eVPS\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://kentai-shiroma.blogspot.jp/2014/06/vpsvyos.html)\n[VyOS\u3067IPSec VPN\u306e\u8a2d\u5b9a](http://qiita.com/khayama/items/c63d4d5f02abdf348889)\n"}