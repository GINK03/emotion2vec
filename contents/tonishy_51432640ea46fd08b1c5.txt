{"tags": ["AWS", "CloudFormation"], "context": "\n\n1. \u306f\u3058\u3081\u306b\n\n\u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u6982\u8981\n\n\nsample.json\n    \"Resources\": {\n        \"VPC\": {\n            \"Type\": \"AWS::EC2::VPC\",\n        \"InternetGateway\": {\n            \"Type\": \"AWS::EC2::InternetGateway\",\n        \"VPCGatewayAttachment\": {\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",\n        \"SecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n        \"LogsLogGroupCloudTrail\": {\n            \"Type\": \"AWS::Logs::LogGroup\",\n        \"Route53HostedZoneInternal\": {\n            \"Type\": \"AWS::Route53::HostedZone\",\n        \"DHCPOptions\": {\n            \"Type\": \"AWS::EC2::DHCPOptions\",\n        \"VPCDHCPOptionsAssociation\": {\n            \"Type\": \"AWS::EC2::VPCDHCPOptionsAssociation\",\n        \"SNSTopicCrit\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"SNSTopicWarn\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"SNSTopicInfo\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"S3BucketCloudTrail\": {\n            \"Type\": \"AWS::S3::Bucket\",\n        \"S3BucketPolicyCloudTrail\": {\n            \"Type\": \"AWS::S3::BucketPolicy\",\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n        \"CloudTrail\": {\n            \"Type\": \"AWS::CloudTrail::Trail\",\n        \"IAMRoleOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n        \"IAMRoleOpsWorksService\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"RouteTable\": {\n            \"Type\": \"AWS::EC2::RouteTable\",\n        \"Route\": {\n            \"Type\": \"AWS::EC2::Route\",\n        \"Subnet\": {\n            \"Type\": \"AWS::EC2::Subnet\",\n        \"SubnetRouteTableAssociation\": {\n            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",\n        \"OpsWorksStack\": {\n            \"Type\": \"AWS::OpsWorks::Stack\",\n        \"OpsWorksLayer\": {\n            \"Type\": \"AWS::OpsWorks::Layer\",\n            \"Properties\": {\n                \"CustomRecipes\": {\n                    \"Setup\": [\n                        \"bashrc::default\",\n                        \"basic-package-install::default\",\n                        \"cloudwatchlogs-install::default\",\n                        \"disable-ipv6::default\",\n                        \"etc_logrotateconf::default\",\n                        \"etc_profile-history_prompt::default\",\n                        \"etc_ssh_sshdconfig-security::default\",\n                        \"etc_sysconfig_ntpd::default\",\n                        \"etc_yumconf-keepcache::default\",\n                        \"iptables_off::default\",\n                        \"lang::default\",\n                        \"monit-basicsetting::default\",\n                        \"monit-install::default\",\n                        \"postfix::default\",\n                        \"rsyslog::default\",\n                        \"sysstat::default\",\n                        \"system-scripts::default\",\n                        \"timezone::default\"\n        }\n        \"OpsWorksInstance\" : {\n          \"Type\": \"AWS::OpsWorks::Instance\",\n\n\n\n\n\u4f7f\u7528\u4e0a\u306e\u6ce8\u610f\u306f\u3001\u3053\u3061\u3089\n\n\n\n2. \u5236\u9650\n\nAWS::OpsWorks::Layer  OpsWorksLayer   Shortname: only lower case a-z, 0-9, and - or _ characters are allowed\n\n\n3. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\nsample.json\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"sample.json\",\n    \"Parameters\": {\n        \"AccountCodeName\": {\n            \"Description\": \"AWS Account Code name\",\n            \"Type\": \"String\",\n            \"ConstraintDescription\": \"Input AWS account code name here.\"\n        },\n        \"GitSSHKey\": {\n            \"Description\": \"Change SSH key newlines to commas.\",\n            \"Type\": \"CommaDelimitedList\",\n            \"NoEcho\": \"true\"\n        }\n    },\n    \"Resources\": {\n        \"VPC\": {\n            \"Type\": \"AWS::EC2::VPC\",\n            \"Properties\": {\n                \"EnableDnsSupport\": \"true\",\n                \"EnableDnsHostnames\": \"true\",\n                \"CidrBlock\": \"10.1.0.0/16\",\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"InternetGateway\": {\n            \"Type\": \"AWS::EC2::InternetGateway\",\n            \"Properties\": {\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"VPCGatewayAttachment\": {\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"InternetGatewayId\": {\n                    \"Ref\": \"InternetGateway\"\n                }\n            }\n        },\n        \"SecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n            \"Properties\": {\n                \"GroupDescription\": \"demo\",\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ],\n                \"SecurityGroupIngress\": [\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"CidrIp\": \"10.1.0.0/16\",\n                        \"FromPort\": \"22\",\n                        \"ToPort\": \"22\"\n                    },\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"CidrIp\": \"xxx.xxx.xxx.xxx/32\",\n                        \"FromPort\": \"22\",\n                        \"ToPort\": \"22\"\n                    }\n                ]\n            }\n        },\n        \"LogsLogGroupCloudTrail\": {\n            \"Type\": \"AWS::Logs::LogGroup\",\n            \"Properties\": {\n                \"RetentionInDays\": 7\n            }\n        },\n        \"Route53HostedZoneInternal\": {\n            \"Type\": \"AWS::Route53::HostedZone\",\n            \"Properties\": {\n                \"HostedZoneConfig\": {\n                    \"Comment\": \"Internal DNS\"\n                },\n                \"Name\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \".local\"\n                        ]\n                    ]\n                },\n                \"VPCs\": [\n                    {\n                        \"VPCId\": {\n                            \"Ref\": \"VPC\"\n                        },\n                        \"VPCRegion\": \"ap-northeast-1\"\n                    }\n                ]\n            }\n        },\n        \"DHCPOptions\": {\n            \"Type\": \"AWS::EC2::DHCPOptions\",\n            \"Properties\": {\n                \"DomainName\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            \"ap-northeast-1.compute.internal \",\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \".local\"\n                        ]\n                    ]\n                },\n                \"DomainNameServers\": [\n                    \"AmazonProvidedDNS\"\n                ],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": {\n                            \"Ref\": \"AccountCodeName\"\n                        }\n                    }\n                ]\n            }\n        },\n        \"VPCDHCPOptionsAssociation\": {\n            \"Type\": \"AWS::EC2::VPCDHCPOptionsAssociation\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"DhcpOptionsId\": {\n                    \"Ref\": \"DHCPOptions\"\n                }\n            }\n        },\n        \"SNSTopicCrit\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"crit\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"SNSTopicWarn\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"warn\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"SNSTopicInfo\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"info\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"S3BucketCloudTrail\": {\n            \"DeletionPolicy\": \"Retain\",\n            \"Type\": \"AWS::S3::Bucket\",\n            \"Properties\": {\n                \"BucketName\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"-cloudtrail-logs\"\n                        ]\n                    ]\n                }\n            }\n        },\n        \"S3BucketPolicyCloudTrail\": {\n            \"Type\": \"AWS::S3::BucketPolicy\",\n            \"Properties\": {\n                \"Bucket\": {\n                    \"Ref\": \"S3BucketCloudTrail\"\n                },\n                \"PolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Sid\": \"AWSCloudTrailAclCheck\",\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"cloudtrail.amazonaws.com\"\n                            },\n                            \"Action\": \"s3:GetBucketAcl\",\n                            \"Resource\": {\n                                \"Fn::Join\": [\n                                    \"\",\n                                    [\n                                        \"arn:aws:s3:::\",\n                                        {\n                                            \"Ref\": \"S3BucketCloudTrail\"\n                                        }\n                                    ]\n                                ]\n                            }\n                        },\n                        {\n                            \"Sid\": \"AWSCloudTrailWrite\",\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"cloudtrail.amazonaws.com\"\n                            },\n                            \"Action\": \"s3:PutObject\",\n                            \"Resource\": {\n                                \"Fn::Join\": [\n                                    \"\",\n                                    [\n                                        \"arn:aws:s3:::\",\n                                        {\n                                            \"Ref\": \"S3BucketCloudTrail\"\n                                        },\n                                        \"/AWSLogs/\",\n                                        {\n                                            \"Ref\": \"AWS::AccountId\"\n                                        },\n                                        \"/*\"\n                                    ]\n                                ]\n                            },\n                            \"Condition\": {\n                                \"StringEquals\": {\n                                    \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n                                }\n                            }\n                        }\n                    ]\n                }\n            }\n        },\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": [\n                                    \"cloudtrail.amazonaws.com\"\n                                ]\n                            },\n                            \"Action\": [\n                                \"sts:AssumeRole\"\n                            ]\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"CloudTrail_CloudWatchLogs\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"CloudTrail_CloudWatchLogs\",\n                        \"PolicyDocument\": {\n                            \"Version\": \"2012-10-17\",\n                            \"Statement\": [\n                                {\n                                    \"Effect\": \"Allow\",\n                                    \"Action\": [\n                                        \"logs:CreateLogStream\",\n                                        \"logs:PutLogEvents\"\n                                    ],\n                                    \"Resource\": [\n                                        {\n                                            \"Fn::GetAtt\": [\n                                                \"LogsLogGroupCloudTrail\",\n                                                \"Arn\"\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": [\n                                    \"ec2.amazonaws.com\"\n                                ]\n                            },\n                            \"Action\": [\n                                \"sts:AssumeRole\"\n                            ]\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"EC2_CloudWatchLogs\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"EC2_CloudWatchLogs\",\n                        \"PolicyDocument\": {\n                            \"Version\": \"2012-10-17\",\n                            \"Statement\": [\n                                {\n                                    \"Effect\": \"Allow\",\n                                    \"Action\": [\n                                        \"logs:CreateLogGroup\",\n                                        \"logs:CreateLogStream\",\n                                        \"logs:PutLogEvents\",\n                                        \"logs:DescribeLogStreams\"\n                                    ],\n                                    \"Resource\": [\n                                        \"arn:aws:logs:*:*:*\"\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n            \"Properties\": {\n                \"Path\": \"/\",\n                \"Roles\": [\n                    {\n                        \"Ref\": \"IAMRoleEC2CloudWatchLogs\"\n                    }\n                ]\n            }\n        },\n        \"CloudTrail\": {\n            \"Type\": \"AWS::CloudTrail::Trail\",\n            \"Properties\": {\n                \"CloudWatchLogsLogGroupArn\": {\n                    \"Fn::GetAtt\": [\n                        \"LogsLogGroupCloudTrail\",\n                        \"Arn\"\n                    ]\n                },\n                \"CloudWatchLogsRoleArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMRoleCloudTrailCloudWatchLogs\",\n                        \"Arn\"\n                    ]\n                },\n                \"IncludeGlobalServiceEvents\": true,\n                \"IsLogging\": true,\n                \"IsMultiRegionTrail\": true,\n                \"S3BucketName\": {\n                    \"Ref\": \"S3BucketCloudTrail\"\n                }\n            }\n        },\n        \"IAMRoleOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2008-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"ec2.amazonaws.com\"\n                            },\n                            \"Action\": \"sts:AssumeRole\"\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"OpsWorks_EC2\"\n            }\n        },\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n            \"Properties\": {\n                \"Path\": \"/\",\n                \"Roles\": [\n                    {\n                        \"Ref\": \"IAMRoleOpsWorksEC2\"\n                    }\n                ]\n            }\n        },\n        \"IAMRoleOpsWorksService\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2008-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"opsworks.amazonaws.com\"\n                            },\n                            \"Action\": \"sts:AssumeRole\"\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"OpsWorks_Service\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"OpsWorks_Service\",\n                        \"PolicyDocument\": {\n                            \"Statement\": [\n                                {\n                                    \"Action\": [\n                                        \"ec2:*\",\n                                        \"iam:PassRole\",\n                                        \"cloudwatch:GetMetricStatistics\",\n                                        \"cloudwatch:DescribeAlarms\",\n                                        \"ecs:*\",\n                                        \"elasticloadbalancing:*\",\n                                        \"rds:*\"\n                                    ],\n                                    \"Effect\": \"Allow\",\n                                    \"Resource\": [\n                                        \"*\"\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"RouteTable\": {\n            \"Type\": \"AWS::EC2::RouteTable\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"Route\": {\n            \"Type\": \"AWS::EC2::Route\",\n            \"Properties\": {\n                \"RouteTableId\": {\n                    \"Ref\": \"RouteTable\"\n                },\n                \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                \"GatewayId\": {\n                    \"Ref\": \"InternetGateway\"\n                }\n            }\n        },\n        \"Subnet\": {\n            \"Type\": \"AWS::EC2::Subnet\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"AvailabilityZone\": \"ap-northeast-1a\",\n                \"CidrBlock\": \"10.1.0.0/24\",\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"SubnetRouteTableAssociation\": {\n            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",\n            \"Properties\": {\n                \"SubnetId\": {\n                    \"Ref\": \"Subnet\"\n                },\n                \"RouteTableId\": {\n                    \"Ref\": \"RouteTable\"\n                }\n            }\n        },\n        \"OpsWorksStack\": {\n            \"Type\": \"AWS::OpsWorks::Stack\",\n            \"Properties\": {\n                \"Name\": \"ami\",\n                \"ConfigurationManager\": {\n                    \"Name\": \"Chef\",\n                    \"Version\": \"12\"\n                },\n                \"UseCustomCookbooks\": \"true\",\n                \"CustomCookbooksSource\": {\n                    \"Type\": \"git\",\n                    \"Url\": \"git@github.com:tonishy/awsec2-settings.git\",\n                    \"Revision\": \"master\",\n                    \"SshKey\": {\n                        \"Fn::Join\": [\n                            \"\\n\",\n                            {\n                                \"Ref\": \"GitSSHKey\"\n                            }\n                        ]\n                    }\n                },\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"DefaultSubnetId\": {\n                    \"Ref\": \"Subnet\"\n                },\n                \"DefaultInstanceProfileArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMInstanceProfileOpsWorksEC2\",\n                        \"Arn\"\n                    ]\n                },\n                \"ServiceRoleArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMRoleOpsWorksService\",\n                        \"Arn\"\n                    ]\n                },\n                \"DefaultOs\": \"Amazon Linux 2016.03\",\n                \"DefaultRootDeviceType\": \"ebs\",\n                \"DefaultSshKeyName\": \"aws-tonishy\",\n                \"HostnameTheme\": \"Layer_Dependent\",\n                \"UseOpsworksSecurityGroups\": \"false\"\n            }\n        },\n        \"OpsWorksLayer\": {\n            \"Type\": \"AWS::OpsWorks::Layer\",\n            \"Properties\": {\n                \"Type\": \"custom\",\n                \"Name\": \"demo\",\n                \"Shortname\": \"demo\",\n                \"StackId\": {\n                    \"Ref\": \"OpsWorksStack\"\n                },\n                \"EnableAutoHealing\": \"true\",\n                \"CustomRecipes\": {\n                    \"Setup\": [\n                        \"bashrc::default\",\n                        \"basic-package-install::default\",\n                        \"cloudwatchlogs-install::default\",\n                        \"disable-ipv6::default\",\n                        \"etc_logrotateconf::default\",\n                        \"etc_profile-history_prompt::default\",\n                        \"etc_ssh_sshdconfig-security::default\",\n                        \"etc_sysconfig_ntpd::default\",\n                        \"etc_yumconf-keepcache::default\",\n                        \"iptables_off::default\",\n                        \"lang::default\",\n                        \"monit-basicsetting::default\",\n                        \"monit-install::default\",\n                        \"postfix::default\",\n                        \"rsyslog::default\",\n                        \"sysstat::default\",\n                        \"system-scripts::default\",\n                        \"timezone::default\"\n                    ]\n                },\n                \"AutoAssignPublicIps\": \"true\",\n                \"AutoAssignElasticIps\": \"false\",\n                \"CustomSecurityGroupIds\": [\n                    {\"Ref\": \"SecurityGroup\"}\n                ],\n                \"CustomInstanceProfileArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\",\n                        \"Arn\"\n                    ]\n                }\n            }\n        },\n        \"OpsWorksInstance\" : {\n          \"Type\": \"AWS::OpsWorks::Instance\",\n          \"Properties\": {\n            \"StackId\" : {\"Ref\": \"OpsWorksStack\"},\n            \"LayerIds\" :  [ {\"Ref\": \"OpsWorksLayer\"}],\n            \"InstanceType\" : \"t2.micro\"\n          }\n        }\n    },\n    \"Outputs\": {\n        \"VPC\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"VPC\"\n            }\n        },\n        \"InternetGateway\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"InternetGateway\"\n            }\n        },\n        \"VPCGatewayAttachment\": {\n            \"Value\": {\n                \"Ref\": \"VPCGatewayAttachment\"\n            }\n        },\n        \"SecurityGroup\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"SecurityGroup\"\n            }\n        },\n        \"LogsLogGroupCloudTrail\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"LogsLogGroupCloudTrail\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"Route53HostedZoneInternal\": {\n            \"Description\": \"Internal DNS\",\n            \"Value\": {\n                \"Ref\": \"Route53HostedZoneInternal\"\n            }\n        },\n        \"VPCDHCPOptionsAssociation\": {\n            \"Value\": {\n                \"Ref\": \"VPCDHCPOptionsAssociation\"\n            }\n        },\n        \"SNSTopicCrit\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicCrit\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"SNSTopicWarn\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicWarn\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"SNSTopicInfo\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicInfo\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"S3BucketCloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"S3BucketCloudTrail\"\n            }\n        },\n        \"S3BucketPolicyCloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"S3BucketPolicyCloudTrail\"\n            }\n        },\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Value\": {\n                \"Ref\": \"IAMRoleCloudTrailCloudWatchLogs\"\n            }\n        },\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Description\": \"Name:template\",\n            \"Value\": {\n                \"Ref\": \"IAMRoleEC2CloudWatchLogs\"\n            }\n        },\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Description\": \"Name:template\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"CloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"CloudTrail\"\n            }\n        },\n        \"IAMRoleOpsWorksEC2\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMRoleOpsWorksEC2\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMInstanceProfileOpsWorksEC2\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"IAMRoleOpsWorksService\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMRoleOpsWorksService\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"RouteTable\": {\n            \"Description\": \"public\",\n            \"Value\": {\n                \"Ref\": \"RouteTable\"\n            }\n        },\n        \"Route\": {\n            \"Value\": {\n                \"Ref\": \"Route\"\n            }\n        },\n        \"Subnet\": {\n            \"Value\": {\n                \"Ref\": \"Subnet\"\n            }\n        },\n        \"SubnetRouteTableAssociation\": {\n            \"Value\": {\n                \"Ref\": \"SubnetRouteTableAssociation\"\n            }\n        },\n        \"OpsWorksStack\": {\n            \"Description\": \"Name: ami\",\n            \"Value\": {\n                \"Ref\": \"OpsWorksStack\"\n            }\n        },\n        \"OpsWorksLayer\": {\n            \"Description\": \"Name:ami\",\n            \"Value\": {\n                \"Ref\": \"OpsWorksLayer\"\n            }\n        },\n        \"OpsWorksInstance\" : {\n          \"Description\" : \"Name:ami\",\n          \"Value\" :  { \"Ref\" : \"OpsWorksInstance\" }\n        }\n    }\n}\n\n\n#1. \u306f\u3058\u3081\u306b\n* \u4f5c\u6210\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u6982\u8981\n\n```json:sample.json\n    \"Resources\": {\n        \"VPC\": {\n            \"Type\": \"AWS::EC2::VPC\",\n        \"InternetGateway\": {\n            \"Type\": \"AWS::EC2::InternetGateway\",\n        \"VPCGatewayAttachment\": {\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",\n        \"SecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n        \"LogsLogGroupCloudTrail\": {\n            \"Type\": \"AWS::Logs::LogGroup\",\n        \"Route53HostedZoneInternal\": {\n            \"Type\": \"AWS::Route53::HostedZone\",\n        \"DHCPOptions\": {\n            \"Type\": \"AWS::EC2::DHCPOptions\",\n        \"VPCDHCPOptionsAssociation\": {\n            \"Type\": \"AWS::EC2::VPCDHCPOptionsAssociation\",\n        \"SNSTopicCrit\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"SNSTopicWarn\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"SNSTopicInfo\": {\n            \"Type\": \"AWS::SNS::Topic\",\n        \"S3BucketCloudTrail\": {\n            \"Type\": \"AWS::S3::Bucket\",\n        \"S3BucketPolicyCloudTrail\": {\n            \"Type\": \"AWS::S3::BucketPolicy\",\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n        \"CloudTrail\": {\n            \"Type\": \"AWS::CloudTrail::Trail\",\n        \"IAMRoleOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n        \"IAMRoleOpsWorksService\": {\n            \"Type\": \"AWS::IAM::Role\",\n        \"RouteTable\": {\n            \"Type\": \"AWS::EC2::RouteTable\",\n        \"Route\": {\n            \"Type\": \"AWS::EC2::Route\",\n        \"Subnet\": {\n            \"Type\": \"AWS::EC2::Subnet\",\n        \"SubnetRouteTableAssociation\": {\n            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",\n        \"OpsWorksStack\": {\n            \"Type\": \"AWS::OpsWorks::Stack\",\n        \"OpsWorksLayer\": {\n            \"Type\": \"AWS::OpsWorks::Layer\",\n            \"Properties\": {\n                \"CustomRecipes\": {\n                    \"Setup\": [\n                        \"bashrc::default\",\n                        \"basic-package-install::default\",\n                        \"cloudwatchlogs-install::default\",\n                        \"disable-ipv6::default\",\n                        \"etc_logrotateconf::default\",\n                        \"etc_profile-history_prompt::default\",\n                        \"etc_ssh_sshdconfig-security::default\",\n                        \"etc_sysconfig_ntpd::default\",\n                        \"etc_yumconf-keepcache::default\",\n                        \"iptables_off::default\",\n                        \"lang::default\",\n                        \"monit-basicsetting::default\",\n                        \"monit-install::default\",\n                        \"postfix::default\",\n                        \"rsyslog::default\",\n                        \"sysstat::default\",\n                        \"system-scripts::default\",\n                        \"timezone::default\"\n        }\n        \"OpsWorksInstance\" : {\n          \"Type\": \"AWS::OpsWorks::Instance\",\n\n```\n\n* \u4f7f\u7528\u4e0a\u306e\u6ce8\u610f\u306f\u3001[\u3053\u3061\u3089](http://qiita.com/tonishy/items/1fabf5af607927f3e6ba)\n\n\n#2. \u5236\u9650\n* AWS::OpsWorks::Layer\tOpsWorksLayer\tShortname: only lower case a-z, 0-9, and - or _ characters are allowed\n\n\n#3. \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n```json:sample.json\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"sample.json\",\n    \"Parameters\": {\n        \"AccountCodeName\": {\n            \"Description\": \"AWS Account Code name\",\n            \"Type\": \"String\",\n            \"ConstraintDescription\": \"Input AWS account code name here.\"\n        },\n        \"GitSSHKey\": {\n            \"Description\": \"Change SSH key newlines to commas.\",\n            \"Type\": \"CommaDelimitedList\",\n            \"NoEcho\": \"true\"\n        }\n    },\n    \"Resources\": {\n        \"VPC\": {\n            \"Type\": \"AWS::EC2::VPC\",\n            \"Properties\": {\n                \"EnableDnsSupport\": \"true\",\n                \"EnableDnsHostnames\": \"true\",\n                \"CidrBlock\": \"10.1.0.0/16\",\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"InternetGateway\": {\n            \"Type\": \"AWS::EC2::InternetGateway\",\n            \"Properties\": {\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"VPCGatewayAttachment\": {\n            \"Type\": \"AWS::EC2::VPCGatewayAttachment\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"InternetGatewayId\": {\n                    \"Ref\": \"InternetGateway\"\n                }\n            }\n        },\n        \"SecurityGroup\": {\n            \"Type\": \"AWS::EC2::SecurityGroup\",\n            \"Properties\": {\n                \"GroupDescription\": \"demo\",\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ],\n                \"SecurityGroupIngress\": [\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"CidrIp\": \"10.1.0.0/16\",\n                        \"FromPort\": \"22\",\n                        \"ToPort\": \"22\"\n                    },\n                    {\n                        \"IpProtocol\": \"tcp\",\n                        \"CidrIp\": \"xxx.xxx.xxx.xxx/32\",\n                        \"FromPort\": \"22\",\n                        \"ToPort\": \"22\"\n                    }\n                ]\n            }\n        },\n        \"LogsLogGroupCloudTrail\": {\n            \"Type\": \"AWS::Logs::LogGroup\",\n            \"Properties\": {\n                \"RetentionInDays\": 7\n            }\n        },\n        \"Route53HostedZoneInternal\": {\n            \"Type\": \"AWS::Route53::HostedZone\",\n            \"Properties\": {\n                \"HostedZoneConfig\": {\n                    \"Comment\": \"Internal DNS\"\n                },\n                \"Name\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \".local\"\n                        ]\n                    ]\n                },\n                \"VPCs\": [\n                    {\n                        \"VPCId\": {\n                            \"Ref\": \"VPC\"\n                        },\n                        \"VPCRegion\": \"ap-northeast-1\"\n                    }\n                ]\n            }\n        },\n        \"DHCPOptions\": {\n            \"Type\": \"AWS::EC2::DHCPOptions\",\n            \"Properties\": {\n                \"DomainName\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            \"ap-northeast-1.compute.internal \",\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \".local\"\n                        ]\n                    ]\n                },\n                \"DomainNameServers\": [\n                    \"AmazonProvidedDNS\"\n                ],\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": {\n                            \"Ref\": \"AccountCodeName\"\n                        }\n                    }\n                ]\n            }\n        },\n        \"VPCDHCPOptionsAssociation\": {\n            \"Type\": \"AWS::EC2::VPCDHCPOptionsAssociation\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"DhcpOptionsId\": {\n                    \"Ref\": \"DHCPOptions\"\n                }\n            }\n        },\n        \"SNSTopicCrit\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"crit\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"SNSTopicWarn\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"warn\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"SNSTopicInfo\": {\n            \"Type\": \"AWS::SNS::Topic\",\n            \"Properties\": {\n                \"Subscription\": [\n                    {\n                        \"Endpoint\": \"xxx@xxx.xx\",\n                        \"Protocol\": \"email\"\n                    }\n                ],\n                \"TopicName\": {\n                    \"Fn::Join\": [\n                        \"-\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"info\"\n                        ]\n                    ]\n                },\n                \"DisplayName\": {\n                    \"Ref\": \"AccountCodeName\"\n                }\n            }\n        },\n        \"S3BucketCloudTrail\": {\n            \"DeletionPolicy\": \"Retain\",\n            \"Type\": \"AWS::S3::Bucket\",\n            \"Properties\": {\n                \"BucketName\": {\n                    \"Fn::Join\": [\n                        \"\",\n                        [\n                            {\n                                \"Ref\": \"AccountCodeName\"\n                            },\n                            \"-cloudtrail-logs\"\n                        ]\n                    ]\n                }\n            }\n        },\n        \"S3BucketPolicyCloudTrail\": {\n            \"Type\": \"AWS::S3::BucketPolicy\",\n            \"Properties\": {\n                \"Bucket\": {\n                    \"Ref\": \"S3BucketCloudTrail\"\n                },\n                \"PolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Sid\": \"AWSCloudTrailAclCheck\",\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"cloudtrail.amazonaws.com\"\n                            },\n                            \"Action\": \"s3:GetBucketAcl\",\n                            \"Resource\": {\n                                \"Fn::Join\": [\n                                    \"\",\n                                    [\n                                        \"arn:aws:s3:::\",\n                                        {\n                                            \"Ref\": \"S3BucketCloudTrail\"\n                                        }\n                                    ]\n                                ]\n                            }\n                        },\n                        {\n                            \"Sid\": \"AWSCloudTrailWrite\",\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"cloudtrail.amazonaws.com\"\n                            },\n                            \"Action\": \"s3:PutObject\",\n                            \"Resource\": {\n                                \"Fn::Join\": [\n                                    \"\",\n                                    [\n                                        \"arn:aws:s3:::\",\n                                        {\n                                            \"Ref\": \"S3BucketCloudTrail\"\n                                        },\n                                        \"/AWSLogs/\",\n                                        {\n                                            \"Ref\": \"AWS::AccountId\"\n                                        },\n                                        \"/*\"\n                                    ]\n                                ]\n                            },\n                            \"Condition\": {\n                                \"StringEquals\": {\n                                    \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n                                }\n                            }\n                        }\n                    ]\n                }\n            }\n        },\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": [\n                                    \"cloudtrail.amazonaws.com\"\n                                ]\n                            },\n                            \"Action\": [\n                                \"sts:AssumeRole\"\n                            ]\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"CloudTrail_CloudWatchLogs\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"CloudTrail_CloudWatchLogs\",\n                        \"PolicyDocument\": {\n                            \"Version\": \"2012-10-17\",\n                            \"Statement\": [\n                                {\n                                    \"Effect\": \"Allow\",\n                                    \"Action\": [\n                                        \"logs:CreateLogStream\",\n                                        \"logs:PutLogEvents\"\n                                    ],\n                                    \"Resource\": [\n                                        {\n                                            \"Fn::GetAtt\": [\n                                                \"LogsLogGroupCloudTrail\",\n                                                \"Arn\"\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": [\n                                    \"ec2.amazonaws.com\"\n                                ]\n                            },\n                            \"Action\": [\n                                \"sts:AssumeRole\"\n                            ]\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"EC2_CloudWatchLogs\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"EC2_CloudWatchLogs\",\n                        \"PolicyDocument\": {\n                            \"Version\": \"2012-10-17\",\n                            \"Statement\": [\n                                {\n                                    \"Effect\": \"Allow\",\n                                    \"Action\": [\n                                        \"logs:CreateLogGroup\",\n                                        \"logs:CreateLogStream\",\n                                        \"logs:PutLogEvents\",\n                                        \"logs:DescribeLogStreams\"\n                                    ],\n                                    \"Resource\": [\n                                        \"arn:aws:logs:*:*:*\"\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n            \"Properties\": {\n                \"Path\": \"/\",\n                \"Roles\": [\n                    {\n                        \"Ref\": \"IAMRoleEC2CloudWatchLogs\"\n                    }\n                ]\n            }\n        },\n        \"CloudTrail\": {\n            \"Type\": \"AWS::CloudTrail::Trail\",\n            \"Properties\": {\n                \"CloudWatchLogsLogGroupArn\": {\n                    \"Fn::GetAtt\": [\n                        \"LogsLogGroupCloudTrail\",\n                        \"Arn\"\n                    ]\n                },\n                \"CloudWatchLogsRoleArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMRoleCloudTrailCloudWatchLogs\",\n                        \"Arn\"\n                    ]\n                },\n                \"IncludeGlobalServiceEvents\": true,\n                \"IsLogging\": true,\n                \"IsMultiRegionTrail\": true,\n                \"S3BucketName\": {\n                    \"Ref\": \"S3BucketCloudTrail\"\n                }\n            }\n        },\n        \"IAMRoleOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2008-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"ec2.amazonaws.com\"\n                            },\n                            \"Action\": \"sts:AssumeRole\"\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"OpsWorks_EC2\"\n            }\n        },\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Type\": \"AWS::IAM::InstanceProfile\",\n            \"Properties\": {\n                \"Path\": \"/\",\n                \"Roles\": [\n                    {\n                        \"Ref\": \"IAMRoleOpsWorksEC2\"\n                    }\n                ]\n            }\n        },\n        \"IAMRoleOpsWorksService\": {\n            \"Type\": \"AWS::IAM::Role\",\n            \"Properties\": {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2008-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Effect\": \"Allow\",\n                            \"Principal\": {\n                                \"Service\": \"opsworks.amazonaws.com\"\n                            },\n                            \"Action\": \"sts:AssumeRole\"\n                        }\n                    ]\n                },\n                \"Path\": \"/\",\n                \"RoleName\": \"OpsWorks_Service\",\n                \"Policies\": [\n                    {\n                        \"PolicyName\": \"OpsWorks_Service\",\n                        \"PolicyDocument\": {\n                            \"Statement\": [\n                                {\n                                    \"Action\": [\n                                        \"ec2:*\",\n                                        \"iam:PassRole\",\n                                        \"cloudwatch:GetMetricStatistics\",\n                                        \"cloudwatch:DescribeAlarms\",\n                                        \"ecs:*\",\n                                        \"elasticloadbalancing:*\",\n                                        \"rds:*\"\n                                    ],\n                                    \"Effect\": \"Allow\",\n                                    \"Resource\": [\n                                        \"*\"\n                                    ]\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        },\n        \"RouteTable\": {\n            \"Type\": \"AWS::EC2::RouteTable\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"Route\": {\n            \"Type\": \"AWS::EC2::Route\",\n            \"Properties\": {\n                \"RouteTableId\": {\n                    \"Ref\": \"RouteTable\"\n                },\n                \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                \"GatewayId\": {\n                    \"Ref\": \"InternetGateway\"\n                }\n            }\n        },\n        \"Subnet\": {\n            \"Type\": \"AWS::EC2::Subnet\",\n            \"Properties\": {\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"AvailabilityZone\": \"ap-northeast-1a\",\n                \"CidrBlock\": \"10.1.0.0/24\",\n                \"Tags\": [\n                    {\n                        \"Key\": \"Name\",\n                        \"Value\": \"demo\"\n                    }\n                ]\n            }\n        },\n        \"SubnetRouteTableAssociation\": {\n            \"Type\": \"AWS::EC2::SubnetRouteTableAssociation\",\n            \"Properties\": {\n                \"SubnetId\": {\n                    \"Ref\": \"Subnet\"\n                },\n                \"RouteTableId\": {\n                    \"Ref\": \"RouteTable\"\n                }\n            }\n        },\n        \"OpsWorksStack\": {\n            \"Type\": \"AWS::OpsWorks::Stack\",\n            \"Properties\": {\n                \"Name\": \"ami\",\n                \"ConfigurationManager\": {\n                    \"Name\": \"Chef\",\n                    \"Version\": \"12\"\n                },\n                \"UseCustomCookbooks\": \"true\",\n                \"CustomCookbooksSource\": {\n                    \"Type\": \"git\",\n                    \"Url\": \"git@github.com:tonishy/awsec2-settings.git\",\n                    \"Revision\": \"master\",\n                    \"SshKey\": {\n                        \"Fn::Join\": [\n                            \"\\n\",\n                            {\n                                \"Ref\": \"GitSSHKey\"\n                            }\n                        ]\n                    }\n                },\n                \"VpcId\": {\n                    \"Ref\": \"VPC\"\n                },\n                \"DefaultSubnetId\": {\n                    \"Ref\": \"Subnet\"\n                },\n                \"DefaultInstanceProfileArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMInstanceProfileOpsWorksEC2\",\n                        \"Arn\"\n                    ]\n                },\n                \"ServiceRoleArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMRoleOpsWorksService\",\n                        \"Arn\"\n                    ]\n                },\n                \"DefaultOs\": \"Amazon Linux 2016.03\",\n                \"DefaultRootDeviceType\": \"ebs\",\n                \"DefaultSshKeyName\": \"aws-tonishy\",\n                \"HostnameTheme\": \"Layer_Dependent\",\n                \"UseOpsworksSecurityGroups\": \"false\"\n            }\n        },\n        \"OpsWorksLayer\": {\n            \"Type\": \"AWS::OpsWorks::Layer\",\n            \"Properties\": {\n                \"Type\": \"custom\",\n                \"Name\": \"demo\",\n                \"Shortname\": \"demo\",\n                \"StackId\": {\n                    \"Ref\": \"OpsWorksStack\"\n                },\n                \"EnableAutoHealing\": \"true\",\n                \"CustomRecipes\": {\n                    \"Setup\": [\n                        \"bashrc::default\",\n                        \"basic-package-install::default\",\n                        \"cloudwatchlogs-install::default\",\n                        \"disable-ipv6::default\",\n                        \"etc_logrotateconf::default\",\n                        \"etc_profile-history_prompt::default\",\n                        \"etc_ssh_sshdconfig-security::default\",\n                        \"etc_sysconfig_ntpd::default\",\n                        \"etc_yumconf-keepcache::default\",\n                        \"iptables_off::default\",\n                        \"lang::default\",\n                        \"monit-basicsetting::default\",\n                        \"monit-install::default\",\n                        \"postfix::default\",\n                        \"rsyslog::default\",\n                        \"sysstat::default\",\n                        \"system-scripts::default\",\n                        \"timezone::default\"\n                    ]\n                },\n                \"AutoAssignPublicIps\": \"true\",\n                \"AutoAssignElasticIps\": \"false\",\n                \"CustomSecurityGroupIds\": [\n                    {\"Ref\": \"SecurityGroup\"}\n                ],\n                \"CustomInstanceProfileArn\": {\n                    \"Fn::GetAtt\": [\n                        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\",\n                        \"Arn\"\n                    ]\n                }\n            }\n        },\n        \"OpsWorksInstance\" : {\n          \"Type\": \"AWS::OpsWorks::Instance\",\n          \"Properties\": {\n            \"StackId\" : {\"Ref\": \"OpsWorksStack\"},\n            \"LayerIds\" :  [ {\"Ref\": \"OpsWorksLayer\"}],\n            \"InstanceType\" : \"t2.micro\"\n          }\n        }\n    },\n    \"Outputs\": {\n        \"VPC\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"VPC\"\n            }\n        },\n        \"InternetGateway\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"InternetGateway\"\n            }\n        },\n        \"VPCGatewayAttachment\": {\n            \"Value\": {\n                \"Ref\": \"VPCGatewayAttachment\"\n            }\n        },\n        \"SecurityGroup\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Ref\": \"SecurityGroup\"\n            }\n        },\n        \"LogsLogGroupCloudTrail\": {\n            \"Description\": \"Name:demo\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"LogsLogGroupCloudTrail\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"Route53HostedZoneInternal\": {\n            \"Description\": \"Internal DNS\",\n            \"Value\": {\n                \"Ref\": \"Route53HostedZoneInternal\"\n            }\n        },\n        \"VPCDHCPOptionsAssociation\": {\n            \"Value\": {\n                \"Ref\": \"VPCDHCPOptionsAssociation\"\n            }\n        },\n        \"SNSTopicCrit\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicCrit\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"SNSTopicWarn\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicWarn\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"SNSTopicInfo\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"SNSTopicInfo\",\n                    \"TopicName\"\n                ]\n            }\n        },\n        \"S3BucketCloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"S3BucketCloudTrail\"\n            }\n        },\n        \"S3BucketPolicyCloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"S3BucketPolicyCloudTrail\"\n            }\n        },\n        \"IAMRoleCloudTrailCloudWatchLogs\": {\n            \"Value\": {\n                \"Ref\": \"IAMRoleCloudTrailCloudWatchLogs\"\n            }\n        },\n        \"IAMRoleEC2CloudWatchLogs\": {\n            \"Description\": \"Name:template\",\n            \"Value\": {\n                \"Ref\": \"IAMRoleEC2CloudWatchLogs\"\n            }\n        },\n        \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\": {\n            \"Description\": \"Name:template\",\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMInstanceProfileIAMRoleEC2CloudWatchLogs\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"CloudTrail\": {\n            \"Value\": {\n                \"Ref\": \"CloudTrail\"\n            }\n        },\n        \"IAMRoleOpsWorksEC2\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMRoleOpsWorksEC2\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"IAMInstanceProfileOpsWorksEC2\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMInstanceProfileOpsWorksEC2\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"IAMRoleOpsWorksService\": {\n            \"Value\": {\n                \"Fn::GetAtt\": [\n                    \"IAMRoleOpsWorksService\",\n                    \"Arn\"\n                ]\n            }\n        },\n        \"RouteTable\": {\n            \"Description\": \"public\",\n            \"Value\": {\n                \"Ref\": \"RouteTable\"\n            }\n        },\n        \"Route\": {\n            \"Value\": {\n                \"Ref\": \"Route\"\n            }\n        },\n        \"Subnet\": {\n            \"Value\": {\n                \"Ref\": \"Subnet\"\n            }\n        },\n        \"SubnetRouteTableAssociation\": {\n            \"Value\": {\n                \"Ref\": \"SubnetRouteTableAssociation\"\n            }\n        },\n        \"OpsWorksStack\": {\n            \"Description\": \"Name: ami\",\n            \"Value\": {\n                \"Ref\": \"OpsWorksStack\"\n            }\n        },\n        \"OpsWorksLayer\": {\n            \"Description\": \"Name:ami\",\n            \"Value\": {\n                \"Ref\": \"OpsWorksLayer\"\n            }\n        },\n        \"OpsWorksInstance\" : {\n          \"Description\" : \"Name:ami\",\n          \"Value\" :  { \"Ref\" : \"OpsWorksInstance\" }\n        }\n    }\n}\n```\n"}