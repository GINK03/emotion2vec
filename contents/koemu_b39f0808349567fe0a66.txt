{"context": " More than 1 year has passed since last update.nf_conntrack_max \u3092\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u3046\u307e\u304f\u5909\u66f4\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u3069\u3046\u305e\u3002\n\n\u72b6\u6cc1\n\n\n/etc/modprobe.d/nf_conntrack.conf (\u4ee5\u4e0b\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb)(nf_conntrack.conf\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u4efb\u610f)\u306b\u8a2d\u5b9a\u3057\u305f options nf_conntrack hashsize=[\u8a2d\u5b9a\u5024] \u304c\u3001iptables \u518d\u8d77\u52d5\u6642\u306b\u53cd\u6620\u3067\u304d\u306a\u3044\u3002\n\u3053\u306e\u3068\u304d\u3001 iptables \u306e\u307b\u304b\u306b ip6tables \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\n\n\n\u539f\u56e0\n\n\u8aac\u660e\n\n iptables \u3068 ip6tables \u306e\u4e21\u65b9\u3092\u5b9f\u884c\u4e2d\u306e\u6642\u306b\u3069\u3061\u3089\u304b\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\u304c\u53cd\u6620\u3067\u304d\u306a\u3044\u3002\n\n\niptables \u3068 ip6tables \u304c\u3069\u3061\u3089\u304b\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u304d\u3001nf_conntrack \u30e2\u30b8\u30e5\u30fc\u30eb(\u4ee5\u4e0b\u3001\u30e2\u30b8\u30e5\u30fc\u30eb)\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\u6642\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\niptables, ip6tables \u505c\u6b62\u6642\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30a2\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n\u3057\u304b\u3057\u3001iptables, ip6tables \u3069\u3061\u3089\u304b\u304c\u5f15\u304d\u7d9a\u304d\u5b9f\u884c\u4e2d\u306e\u6642\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30a2\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u306a\u3044\u3002iptables, ip6tables \u3069\u3061\u3089\u3082\u304c nf_conntrack \u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3042\u308b\u3002\n\n\n\n\n\u518d\u73fe\n\n\u30e2\u30b8\u30e5\u30fc\u30eb \u30ed\u30fc\u30c9\u72b6\u6cc1\u306e\u78ba\u8a8d\n[root@hb-agent-test ~]# lsmod | grep conntrack\nnf_conntrack_ipv4       9506  2 \nnf_defrag_ipv4          1483  1 nf_conntrack_ipv4\nnf_conntrack_ipv6       8337  2 \nnf_defrag_ipv6         27236  1 nf_conntrack_ipv6\nnf_conntrack           80390  3 nf_conntrack_ipv4,nf_conntrack_ipv6,xt_state\nipv6                  334932  31 nf_conntrack_ipv6,nf_defrag_ipv6,ip6t_REJECT\n[root@test ~]# service iptables stop\niptables: \u30c1\u30a7\u30a4\u30f3\u3092\u30dd\u30ea\u30b7\u30fc ACCEPT \u3078\u8a2d\u5b9a\u4e2dfilter         [  OK  ]\niptables: \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u3092\u6d88\u53bb\u4e2d:                  [  OK  ]\niptables: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u53d6\u308a\u5916\u3057\u4e2d:                          [  OK  ]\n[root@test ~]# lsmod | grep conntrack\nnf_conntrack_ipv6       8337  2 \nnf_defrag_ipv6         27236  1 nf_conntrack_ipv6\nnf_conntrack           80390  2 nf_conntrack_ipv6,xt_state\nipv6                  334932  31 nf_conntrack_ipv6,nf_defrag_ipv6,ip6t_REJECT\n[root@test ~]# service ip6tables stop\nip6tables: \u30c1\u30a7\u30a4\u30f3\u3092\u30dd\u30ea\u30b7\u30fc ACCEPT \u306b\u8a2d\u5b9a\u4e2d: filter      [  OK  ]\nip6tables: \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u3092\u6d88\u53bb\u4e2d:                 [  OK  ]\nip6tables: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u53d6\u308a\u5916\u3057\u4e2d:                         [  OK  ]\n[root@test ~]# lsmod | grep conntrack\n[root@test ~]#\n\n\n\u5bfe\u7b56\n\n/etc/sysctl.conf \u306b \u3082 \u540c\u3058\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u3066\u8aad\u307f\u8fbc\u3080\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u8a18\u8ff0\u3092\u884c\u3044\u3064\u3064\u3001/etc/sysctl.conf\u306b\u3082\u8a18\u8ff0\u3002\u3053\u308c\u3060\u3068\u5373\u53cd\u6620\u53ef\u80fd\u3002\u8a2d\u5b9a\u5024\u30928\u500d\u3059\u308b1\u306e\u3092\u304a\u5fd8\u308c\u306a\u304f\u3002\n# echo \"net.nf_conntrack_max = [\u8a2d\u5b9a\u5024 * 8]\" >> /etc/sysctl.conf\n# sysctl -p\n\n\n\u5168\u3066\u505c\u6b62\u3057\u3066\u5168\u3066\u8d77\u52d5\u3057\u76f4\u3059\niptables, ip6tables \u3092\u5168\u3066\u505c\u6b62\u306e\u4e0a\u3067\u518d\u8d77\u52d5\u3059\u308b\u3002\u3053\u308c\u3060\u3068\u3001/etc/sysctl.conf\u306b\u306f\u624b\u3092\u5165\u308c\u305a\u3068\u3082\u5024\u306e\u53cd\u6620\u304c\u53ef\u80fd\u3002\n# service ip6tables stop\n# service iptables restart\n# service ip6tables start\n\n\nip6tables \u3092\u52d5\u304b\u3055\u306a\u3044\nIPv6 \u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u306e\u306a\u3089\u3042\u308a\u3002\n\n\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\n\u30c6\u30b9\u30c8\u6a5f\u3084\u958b\u767a\u6a5f\u306a\u3069\u3001\u30de\u30b7\u30f3\u518d\u8d77\u52d5\u304c\u8a31\u3055\u308c\u308b\u74b0\u5883\u30fb\u72b6\u6cc1\u306e\u5834\u5408\u306f\u3069\u3046\u305e\u3002\n\n\u5099\u8003\n\n\nnf_conntrack_max \u306e\u4e0a\u9650\u5024\u5909\u66f4\u306f\u3001/etc/sysctl.conf\u3088\u308a\u3082/etc/modprobe.d/nf_conntrack.conf\u306b\u8a18\u8f09\u3059\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u30442\u3002\nRHEL/CentOS 5\u7cfb\u3060\u3068\u3001nf_conntrack\u306fip_conntrack\u3068\u5909\u6570\u540d\u304c\u9055\u30463\u306e\u3067\u6ce8\u610f\u3002\n\n\n\u53c2\u8003\u8cc7\u6599\n\n\n\n\nnetfilter/iptables FAQ: Problems at runtime: ip_conntrack: maximum limit of XXX entries exceeded\u00a0\u21a9\n\n\nnetfilter\u30e2\u30b8\u30e5\u30fc\u30eb | \u30c4\u30c1\u30ce\u30b3\u30d6\u30ed\u30b0\u00a0\u21a9\n\n\n\u3042\u306a\u305f\u306e\u5927\u91cf\u914d\u4fe1\u30b5\u30fc\u30d0\u3001ip_conntrack\u6ea2\u308c\u3066\u3044\u307e\u305b\u3093\u304b\uff1f | \u30d6\u30ed\u30b0 | \u682a\u5f0f\u4f1a\u793e\u30a4\u30fc\u30fb\u30a8\u30fc\u30b8\u30a7\u30f3\u30b7\u30fc\u00a0\u21a9\n\n\n\n`nf_conntrack_max` \u3092\u5909\u66f4\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u3046\u307e\u304f\u5909\u66f4\u3067\u304d\u306a\u3044\u5834\u5408\u306b\u3069\u3046\u305e\u3002\n\n## \u72b6\u6cc1\n\n- `/etc/modprobe.d/nf_conntrack.conf` (\u4ee5\u4e0b\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb)(`nf_conntrack.conf`\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u4efb\u610f)\u306b\u8a2d\u5b9a\u3057\u305f `options nf_conntrack hashsize=[\u8a2d\u5b9a\u5024]` \u304c\u3001iptables \u518d\u8d77\u52d5\u6642\u306b\u53cd\u6620\u3067\u304d\u306a\u3044\u3002\n- \u3053\u306e\u3068\u304d\u3001 iptables \u306e\u307b\u304b\u306b ip6tables \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3002\n\n## \u539f\u56e0\n\n### \u8aac\u660e\n\n-  iptables \u3068 ip6tables \u306e\u4e21\u65b9\u3092\u5b9f\u884c\u4e2d\u306e\u6642\u306b\u3069\u3061\u3089\u304b\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u5024\u304c\u53cd\u6620\u3067\u304d\u306a\u3044\u3002\n  - iptables \u3068 ip6tables \u304c\u3069\u3061\u3089\u304b\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u304d\u3001nf_conntrack \u30e2\u30b8\u30e5\u30fc\u30eb(\u4ee5\u4e0b\u3001\u30e2\u30b8\u30e5\u30fc\u30eb)\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n  - \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30ed\u30fc\u30c9\u6642\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\n  - iptables, ip6tables \u505c\u6b62\u6642\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30a2\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\n  - \u3057\u304b\u3057\u3001iptables, ip6tables \u3069\u3061\u3089\u304b\u304c\u5f15\u304d\u7d9a\u304d\u5b9f\u884c\u4e2d\u306e\u6642\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30a2\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u306a\u3044\u3002iptables, ip6tables \u3069\u3061\u3089\u3082\u304c nf_conntrack \u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3042\u308b\u3002\n\n### \u518d\u73fe\n\n#### \u30e2\u30b8\u30e5\u30fc\u30eb \u30ed\u30fc\u30c9\u72b6\u6cc1\u306e\u78ba\u8a8d\n\n```text\n[root@hb-agent-test ~]# lsmod | grep conntrack\nnf_conntrack_ipv4       9506  2 \nnf_defrag_ipv4          1483  1 nf_conntrack_ipv4\nnf_conntrack_ipv6       8337  2 \nnf_defrag_ipv6         27236  1 nf_conntrack_ipv6\nnf_conntrack           80390  3 nf_conntrack_ipv4,nf_conntrack_ipv6,xt_state\nipv6                  334932  31 nf_conntrack_ipv6,nf_defrag_ipv6,ip6t_REJECT\n[root@test ~]# service iptables stop\niptables: \u30c1\u30a7\u30a4\u30f3\u3092\u30dd\u30ea\u30b7\u30fc ACCEPT \u3078\u8a2d\u5b9a\u4e2dfilter         [  OK  ]\niptables: \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u3092\u6d88\u53bb\u4e2d:                  [  OK  ]\niptables: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u53d6\u308a\u5916\u3057\u4e2d:                          [  OK  ]\n[root@test ~]# lsmod | grep conntrack\nnf_conntrack_ipv6       8337  2 \nnf_defrag_ipv6         27236  1 nf_conntrack_ipv6\nnf_conntrack           80390  2 nf_conntrack_ipv6,xt_state\nipv6                  334932  31 nf_conntrack_ipv6,nf_defrag_ipv6,ip6t_REJECT\n[root@test ~]# service ip6tables stop\nip6tables: \u30c1\u30a7\u30a4\u30f3\u3092\u30dd\u30ea\u30b7\u30fc ACCEPT \u306b\u8a2d\u5b9a\u4e2d: filter      [  OK  ]\nip6tables: \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u3092\u6d88\u53bb\u4e2d:                 [  OK  ]\nip6tables: \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u53d6\u308a\u5916\u3057\u4e2d:                         [  OK  ]\n[root@test ~]# lsmod | grep conntrack\n[root@test ~]#\n```\n\n## \u5bfe\u7b56\n\n### `/etc/sysctl.conf` \u306b **\u3082** \u540c\u3058\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u3066\u8aad\u307f\u8fbc\u3080\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u8a18\u8ff0\u3092\u884c\u3044\u3064\u3064\u3001`/etc/sysctl.conf`\u306b\u3082\u8a18\u8ff0\u3002\u3053\u308c\u3060\u3068\u5373\u53cd\u6620\u53ef\u80fd\u3002\u8a2d\u5b9a\u5024\u30928\u500d\u3059\u308b[^nf]\u306e\u3092\u304a\u5fd8\u308c\u306a\u304f\u3002\n\n```\n# echo \"net.nf_conntrack_max = [\u8a2d\u5b9a\u5024 * 8]\" >> /etc/sysctl.conf\n# sysctl -p\n```\n\n### \u5168\u3066\u505c\u6b62\u3057\u3066\u5168\u3066\u8d77\u52d5\u3057\u76f4\u3059\n\niptables, ip6tables \u3092\u5168\u3066\u505c\u6b62\u306e\u4e0a\u3067\u518d\u8d77\u52d5\u3059\u308b\u3002\u3053\u308c\u3060\u3068\u3001`/etc/sysctl.conf`\u306b\u306f\u624b\u3092\u5165\u308c\u305a\u3068\u3082\u5024\u306e\u53cd\u6620\u304c\u53ef\u80fd\u3002\n\n```\n# service ip6tables stop\n# service iptables restart\n# service ip6tables start\n```\n\n### ip6tables \u3092\u52d5\u304b\u3055\u306a\u3044\n\nIPv6 \u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u306e\u306a\u3089\u3042\u308a\u3002\n\n### \u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\n\n\u30c6\u30b9\u30c8\u6a5f\u3084\u958b\u767a\u6a5f\u306a\u3069\u3001\u30de\u30b7\u30f3\u518d\u8d77\u52d5\u304c\u8a31\u3055\u308c\u308b\u74b0\u5883\u30fb\u72b6\u6cc1\u306e\u5834\u5408\u306f\u3069\u3046\u305e\u3002\n\n\n## \u5099\u8003\n\n- `nf_conntrack_max` \u306e\u4e0a\u9650\u5024\u5909\u66f4\u306f\u3001`/etc/sysctl.conf`\u3088\u308a\u3082`/etc/modprobe.d/nf_conntrack.conf`\u306b\u8a18\u8f09\u3059\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044[^dmm]\u3002\n- RHEL/CentOS 5\u7cfb\u3060\u3068\u3001`nf_conntrack`\u306f`ip_conntrack`\u3068\u5909\u6570\u540d\u304c\u9055\u3046[^ea]\u306e\u3067\u6ce8\u610f\u3002\n\n## \u53c2\u8003\u8cc7\u6599\n\n[^nf]: [netfilter/iptables FAQ: Problems at runtime: ip_conntrack: maximum limit of XXX entries exceeded](http://www.netfilter.org/documentation/FAQ/netfilter-faq-3.html#ss3.7)\n\n[^dmm]: [netfilter\u30e2\u30b8\u30e5\u30fc\u30eb | \u30c4\u30c1\u30ce\u30b3\u30d6\u30ed\u30b0](http://tsuchinoko.dmmlabs.com/?p=1016)\n[^ea]: [\u3042\u306a\u305f\u306e\u5927\u91cf\u914d\u4fe1\u30b5\u30fc\u30d0\u3001ip_conntrack\u6ea2\u308c\u3066\u3044\u307e\u305b\u3093\u304b\uff1f | \u30d6\u30ed\u30b0 | \u682a\u5f0f\u4f1a\u793e\u30a4\u30fc\u30fb\u30a8\u30fc\u30b8\u30a7\u30f3\u30b7\u30fc](http://www.e-agency.co.jp/column/20121225.html)\n", "tags": ["iptables", "CentOS6"]}