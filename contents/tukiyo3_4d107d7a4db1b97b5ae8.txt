{"context": " More than 1 year has passed since last update.\n\n\u53c2\u8003\n\ndocker-compose \u3067 Rails \u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b - Qiita\n\n\n\u624b\u9806\n\n./app : rails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n\n\n\u6e96\u5099\u65b9\u6cd5\u306e\u4f8b\nmkdir app && cd app\nrails new .\nbundle install\n\n\n\n./Dockerfile : rails\u7528Dockerfile\n./docker-compose.yml : postgres\u3068rails\u306e\u9023\u643a\n\n\nDockerfile\nFROM rails\n\nRUN \\\n  unlink /etc/localtime ;\\\n  ln -s /usr/share/zoneinfo/Japan /etc/localtime ;\\\n  sed -i -e 's@http://archive@http://jp.archive@' /etc/apt/sources.list ;\\\n  apt-get update -qq ;\\\n  apt-get install -y -qq locales ;\\\n  locale-gen ja_JP.UTF-8 ;\\\n  apt-get clean\n#----------------------------------------------------\nWORKDIR /tmp\nCOPY ./app/Gemfile Gemfile\nCOPY ./app/Gemfile.lock Gemfile.lock\nRUN bundle install\n\nADD ./app /app\nWORKDIR /app\n\nVOLUME /app\nEXPOSE 3000\n\n\n\n\nCOPY \u3068 ADD \u304c\u91cd\u8981\u3002\n\n\ndocker-compose.yml\ndb:\n  image: postgres\n  expose:\n    - \"5432\"\nweb:\n  build: .\n  command: bundle exec rails s -p 3000 -b '0.0.0.0'\n  volumes:\n    - ./app:/app\n  ports:\n    - \"3000:3000\"\n  links:\n    - db\n\n\n\n\n\u8d77\u52d5\ndocker-compose build\ndocker-compose up\n\n\n\n\u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u304c\u3067\u308b\u5834\u5408\n\nweb_1 | => Booting WEBrick\nweb_1 | => Rails 4.2.4 application starting in development on http://0.0.0.0:3000\nweb_1 | => Run rails server -h for more startup options\nweb_1 | => Ctrl-C to shutdown server\nweb_1 | A server is already running. Check /app/tmp/pids/server.pid.\nweb_1 | Exiting\nrails4_web_1 exited with code 1\n\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u3066\u3044\u308b\u306e\u306b app/tmp/pids/server.pid \u304c\u6b8b\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u539f\u56e0\u3002\n\nrm -f app/tmp/pids/server.pid\n\n\nindex.html\u3092\u7de8\u96c6\u3057\u3066\u307f\u308b\n\n\napp/public/index.html\nhello\n\n\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\n\n\u73fe\u5728\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9a\u7fa9\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n$ docker-compose run web rake routes\nYou don't have any routes defined!\n\nPlease add some routes in config/routes.rb.\n\nFor more information about routes, see the Rails guide: http://guides.rubyonrails.org/routing.html.\n\n\n\nconfig/routes.rb\n Rails.application.routes.draw do\n+    resources :products do\n+      member do\n+        get 'short'\n+        post 'toggle'\n+      end\n+ \n+      collection do\n+        get 'sold'\n+      end\n+    end\n end\n\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ docker-compose run web rake routes\n        Prefix Verb   URI Pattern                    Controller#Action\n short_product GET    /products/:id/short(.:format)  products#short\ntoggle_product POST   /products/:id/toggle(.:format) products#toggle\n sold_products GET    /products/sold(.:format)       products#sold\n      products GET    /products(.:format)            products#index\n               POST   /products(.:format)            products#create\n   new_product GET    /products/new(.:format)        products#new\n  edit_product GET    /products/:id/edit(.:format)   products#edit\n       product GET    /products/:id(.:format)        products#show\n               PATCH  /products/:id(.:format)        products#update\n               PUT    /products/:id(.:format)        products#update\n               DELETE /products/:id(.:format)        products#destroy\n\n\n\n\n\u5c0f\u5b66\u751f\u3067\u3082\u308f\u304b\u308bRuby on Rails\u5165\u9580\u306e\u30e1\u30e2 - Qiita\u3092\u5b9f\u8df5\ndocker-compose run web \\\nrails g controller users index show\n\n\n\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose up\n\n\n\n\nhttp://localhost:3000/users/show \u306b\u30a2\u30af\u30bb\u30b9\u3057\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\n\nsqlite3\u304b\u3089postgresql\u306b\u5909\u66f4\n\n\u53c2\u8003:docker-compose - Docker Compose - \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8\u30fb\u30ac\u30a4\u30c9\uff1aCompose \u3068 Rails - Qiita\n\n\n\nGemfile\n+ gem 'pg'\n\n\n\nconfig/database.yml\ndefault: &default\n  adapter: postgresql\n  encoding: unicode\n  pool: 5\n  username: postgres\n  password:\n  host: db\n\ndevelopment:\n  <<: *default\n  database: sample_app_development\n\ntest:\n  <<: *default\n  database: sample_app_test\n\nproduction:\n  <<: *default\n  database: sample_app_production\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose run web rake db:create\ndocker-compose up\n\n\n\nDB\u306e\u4f5c\u6210\u306e\u305f\u3081\u521d\u56de\u306e\u307fdocker-compose run web rake db:create\u304c\u5fc5\u8981\u3002\n\n\nmodel\u306e\u4f5c\u6210\n\nuser.{name,username,location,about}\u30ab\u30e9\u30e0\u4f5c\u6210\ndocker-compose run web \\\nrails g model user name:string username:string location:string about:text\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose run web rake db:migrate\ndocker-compose up\n\n\n\n\u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165\n\ndb/seeds.rb\n@user = User.new\n@user.name = 'Ryo Suzuki'\n@user.username = 'ryooopan'\n@user.location = 'Kanagawa, Japan'\n@user.about = 'Hello, I am Ryo. I am from database!'\n@user.save\n\n@user = User.new\n@user.name = 'Shohei Aoki'\n@user.username = 'moyahima'\n@user.location = 'Tottori, Japan'\n@user.about = 'Nice to meet you. I am from database!'\n@user.save\n\n\n\n\u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165\ndocker-compose run web \\\nrake db:seed\n\n\n\nconfig/routes.rb\nRails.application.routes.draw do\n  get \"users/index\"\n  get 'users/show'\n+ get \"users/show/:username\" => \"users#show\"\n\n\ncd app\nmkdir -p app/views/users\nmkdir app/controllers\n\n\napp/views/users/show.html.erb\n<h1><%= @user[:name] %></h1>\n<p><%= @user[:username] %></p>\n<ul>\n  <li>Location : <%= @user[:location] %></li>\n  <li>About    : <%= @user[:about] %></li>\n</ul>\n\n\n\napp/controllers/users_controller.rb\nclass UsersController < ApplicationController\n  def index\n  end\n\n  def show\n    @user = User.find_by(:username => params[:username])\n  end\nend\n\n\n\n\nhttp://localhost:3000/users/show/ryooopan \u306b\u30a2\u30af\u30bb\u30b9\u3057\u4ee5\u4e0b\u8868\u793a\u3092\u78ba\u8a8d\n\n\n## \u53c2\u8003\n\n* [docker-compose \u3067 Rails \u306e\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b - Qiita](http://qiita.com/skyriser/items/2cf98b747ed6577cc5ee)\n\n## \u624b\u9806\n\n* ./app : rails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n\n```bash:\u6e96\u5099\u65b9\u6cd5\u306e\u4f8b\nmkdir app && cd app\nrails new .\nbundle install\n```\n\n* ./Dockerfile : rails\u7528Dockerfile\n* ./docker-compose.yml : postgres\u3068rails\u306e\u9023\u643a\n\n```bash:Dockerfile\nFROM rails\n\nRUN \\\n  unlink /etc/localtime ;\\\n  ln -s /usr/share/zoneinfo/Japan /etc/localtime ;\\\n  sed -i -e 's@http://archive@http://jp.archive@' /etc/apt/sources.list ;\\\n  apt-get update -qq ;\\\n  apt-get install -y -qq locales ;\\\n  locale-gen ja_JP.UTF-8 ;\\\n  apt-get clean\n#----------------------------------------------------\nWORKDIR /tmp\nCOPY ./app/Gemfile Gemfile\nCOPY ./app/Gemfile.lock Gemfile.lock\nRUN bundle install\n\nADD ./app /app\nWORKDIR /app\n\nVOLUME /app\nEXPOSE 3000\n```\n\n* `COPY` \u3068 `ADD` \u304c\u91cd\u8981\u3002\n\n```docker-compose.yml\ndb:\n  image: postgres\n  expose:\n    - \"5432\"\nweb:\n  build: .\n  command: bundle exec rails s -p 3000 -b '0.0.0.0'\n  volumes:\n    - ./app:/app\n  ports:\n    - \"3000:3000\"\n  links:\n    - db\n```\n\n----\n\n```bash:\u8d77\u52d5\ndocker-compose build\ndocker-compose up\n```\n\n\n## \u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u304c\u3067\u308b\u5834\u5408\n\n> web_1 | => Booting WEBrick\n> web_1 | => Rails 4.2.4 application starting in development on http://0.0.0.0:3000\n> web_1 | => Run `rails server -h` for more startup options\n> web_1 | => Ctrl-C to shutdown server\n> web_1 | A server is already running. Check /app/tmp/pids/server.pid.\n> web_1 | Exiting\n> rails4_web_1 exited with code 1\n\n* \u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u3066\u3044\u308b\u306e\u306b app/tmp/pids/server.pid \u304c\u6b8b\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u539f\u56e0\u3002\n\n```bash:\nrm -f app/tmp/pids/server.pid\n```\n\n## index.html\u3092\u7de8\u96c6\u3057\u3066\u307f\u308b\n\n![r1.png](https://qiita-image-store.s3.amazonaws.com/0/25728/b44401bb-c2eb-a1e8-055c-72b23b25709b.png)\n\n```bash:app/public/index.html\nhello\n```\n\n![r2.png](https://qiita-image-store.s3.amazonaws.com/0/25728/9314ca5a-4c2d-a087-9f63-8106cb934b3c.png)\n\n## \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\n\n```bash:\u73fe\u5728\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9a\u7fa9\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n$ docker-compose run web rake routes\nYou don't have any routes defined!\n\nPlease add some routes in config/routes.rb.\n\nFor more information about routes, see the Rails guide: http://guides.rubyonrails.org/routing.html.\n```\n\n```diff:config/routes.rb\n Rails.application.routes.draw do\n+    resources :products do\n+      member do\n+        get 'short'\n+        post 'toggle'\n+      end\n+ \n+      collection do\n+        get 'sold'\n+      end\n+    end\n end\n```\n\n```bash:\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ docker-compose run web rake routes\n        Prefix Verb   URI Pattern                    Controller#Action\n short_product GET    /products/:id/short(.:format)  products#short\ntoggle_product POST   /products/:id/toggle(.:format) products#toggle\n sold_products GET    /products/sold(.:format)       products#sold\n      products GET    /products(.:format)            products#index\n               POST   /products(.:format)            products#create\n   new_product GET    /products/new(.:format)        products#new\n  edit_product GET    /products/:id/edit(.:format)   products#edit\n       product GET    /products/:id(.:format)        products#show\n               PATCH  /products/:id(.:format)        products#update\n               PUT    /products/:id(.:format)        products#update\n               DELETE /products/:id(.:format)        products#destroy\n```\n\n----\n\n## [\u5c0f\u5b66\u751f\u3067\u3082\u308f\u304b\u308bRuby on Rails\u5165\u9580\u306e\u30e1\u30e2 - Qiita](http://qiita.com/tukiyo3/items/6fb9294bfb85e8a49861)\u3092\u5b9f\u8df5\n\n```bash:\ndocker-compose run web \\\nrails g controller users index show\n```\n\n```bash:\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose up\n```\n\n* http://localhost:3000/users/show \u306b\u30a2\u30af\u30bb\u30b9\u3057\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n![r3.png](https://qiita-image-store.s3.amazonaws.com/0/25728/51e6c075-7259-782f-5014-cf6e5a10a545.png)\n\n### sqlite3\u304b\u3089postgresql\u306b\u5909\u66f4\n\n* \u53c2\u8003:[docker-compose - Docker Compose - \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8\u30fb\u30ac\u30a4\u30c9\uff1aCompose \u3068 Rails - Qiita](http://qiita.com/zembutsu/items/5cc40fb4643dbc8448b6)\n\n```diff:Gemfile\n+ gem 'pg'\n```\n\n```yaml:config/database.yml\ndefault: &default\n  adapter: postgresql\n  encoding: unicode\n  pool: 5\n  username: postgres\n  password:\n  host: db\n\ndevelopment:\n  <<: *default\n  database: sample_app_development\n\ntest:\n  <<: *default\n  database: sample_app_test\n\nproduction:\n  <<: *default\n  database: sample_app_production\n```\n\n```bash:\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose run web rake db:create\ndocker-compose up\n```\n\n* DB\u306e\u4f5c\u6210\u306e\u305f\u3081\u521d\u56de\u306e\u307f`docker-compose run web rake db:create`\u304c\u5fc5\u8981\u3002\n\n### model\u306e\u4f5c\u6210\n\n```bash:user.{name,username,location,about}\u30ab\u30e9\u30e0\u4f5c\u6210\ndocker-compose run web \\\nrails g model user name:string username:string location:string about:text\n```\n\n```bash:\u30b3\u30f3\u30c6\u30ca\u518d\u4f5c\u6210\ndocker-compose build\ndocker-compose run web rake db:migrate\ndocker-compose up\n```\n\n### \u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165\n\n```rb:db/seeds.rb\n@user = User.new\n@user.name = 'Ryo Suzuki'\n@user.username = 'ryooopan'\n@user.location = 'Kanagawa, Japan'\n@user.about = 'Hello, I am Ryo. I am from database!'\n@user.save\n\n@user = User.new\n@user.name = 'Shohei Aoki'\n@user.username = 'moyahima'\n@user.location = 'Tottori, Japan'\n@user.about = 'Nice to meet you. I am from database!'\n@user.save\n```\n\n```bash:\u521d\u671f\u30c7\u30fc\u30bf\u306e\u6295\u5165\ndocker-compose run web \\\nrake db:seed\n```\n\n```diff:config/routes.rb\nRails.application.routes.draw do\n  get \"users/index\"\n  get 'users/show'\n+ get \"users/show/:username\" => \"users#show\"\n```\n\n```bash:\ncd app\nmkdir -p app/views/users\nmkdir app/controllers\n```\n\n```html+erb:app/views/users/show.html.erb\n<h1><%= @user[:name] %></h1>\n<p><%= @user[:username] %></p>\n<ul>\n  <li>Location : <%= @user[:location] %></li>\n  <li>About    : <%= @user[:about] %></li>\n</ul>\n```\n\n```rb:app/controllers/users_controller.rb\nclass UsersController < ApplicationController\n  def index\n  end\n\n  def show\n    @user = User.find_by(:username => params[:username])\n  end\nend\n```\n\n* http://localhost:3000/users/show/ryooopan \u306b\u30a2\u30af\u30bb\u30b9\u3057\u4ee5\u4e0b\u8868\u793a\u3092\u78ba\u8a8d\n\n![r4.png](https://qiita-image-store.s3.amazonaws.com/0/25728/f5324dd6-49dc-5253-239c-0c8f60966870.png)\n", "tags": ["docker-compose", "Rails"]}