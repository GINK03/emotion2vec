{"tags": ["Ruby", "AWS", "EC2", "tokyocabinet", "roma"], "context": " More than 1 year has passed since last update.AWS\u306e\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308bROMA\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7c73\u56fd\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u79fb\u8a2d\u3057\u305f\u8a71\n\n\u6761\u4ef6\n\nAWS EC2\n \n\n\n\nModel\nm3.large\n\n\nMemory\n7.5GB\n\n\nStorage\n32GB\n\n\nOS\nCentOS 6.5\n\n\nAsia pacific(Tokyo) region\nROMA server\n3 server\n\n\nGladiator server\n1 server\n\n\nUS standard region\nROMA server\n3 server\n\n\n\n\nROMA\n \n\n\n\nROMA version\nv1.2.0\n\n\nRuby version\nv2.1.6\n\n\nStorage Type\nTokyo Cabinet(v1.4.48)\n\n\ninstance/server\n1\n\n\nRedundancy\n2\n\n\nGladiator version\nv1.2.0\n\n\n\n\nTest Data\n \n\n\n\nRecord counts\n6,000,000 (records)\n\n\nValue size\n1024 (bytes)\n\n\nTotal Data size\n3.3(GB)\n\n\n\n\n\u6d41\u308c\n\n1. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3064\u304f\u3063\u3066\u30fb\u30fb\u30fb\n\n\n2. \u7c73\u56fd\u30ea\u30fc\u30b8\u30e7\u30f3\u304b\u3089instance\u3092join\u3057\u3066\u30fb\u30fb\u30fb\n\n\n3. \u56fd\u3092\u307e\u305f\u3044\u3060\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u51fa\u6765\u305f\u3089\u30fb\u30fb\u30fb\n\n\n4. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u65b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3057\u3066\u3044\u304f\n\n\n5. \u5b8c\u4e86\uff01\n\n\n\u624b\u9806\n\n1. snapshot\u3068\u308b(\u4e07\u304c\u4e00\u306e\u305f\u3081\u306b)\n$ cpdb #{port}\n\n2. \u7c73\u56fd\u30ea\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8ffd\u52a0\n$ bin/romad   #{host}   -p   #{port}   -j   #{Japan ROMA instance} \n\n\nBefore adding US instances\nAfter adding US instances!\n\n\n\n\n\n\n\n\n\n\n3. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5916\u3057\u3066\u3044\u304f\n\u5358\u7d14\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3059\u3068\u5197\u9577\u5ea6\u304c\u843d\u3061\u3066\u3057\u307e\u3046\u306e\u3067\u3001release\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u62c5\u5f53\u3057\u3066\u3044\u308bvnodes\u3092\u89e3\u653e\u3057\u3066\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3059\n> release\n> shutdown_self\n\nrelease\u3068shutdown_self(rbalse)\u306fGUI\u4e0a\u304b\u3089\u3082\u53ef\u80fd\u3067\u3059  \n\n\nRelese process was ongoing\nAfter removing Japan instances\nRouting History List\n\n\n\n\n\n\n\n\n\u7d50\u679c\n\nNO ERROR\n\n\u30a8\u30e9\u30fc\u30ed\u30b0\u3067\u306a\u304b\u3063\u305f\nAWS monitoring\u306e\u65b9\u3067\u3082\u7279\u306b\u304a\u304b\u3057\u306a\u3068\u3053\u306a\u304b\u3063\u305f\n\n\nNO DATA LOST\n\nshort_vnodes\u3082lost_vnodes\u3082\u767a\u751f\u3057\u306a\u304b\u3063\u305f\n\n\n(\u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3082\u30c7\u30fc\u30bf\u30ed\u30b9\u30c8\u3082\u767a\u751f\u3057\u306a\u304b\u3063\u305f)\n\n\n\u5e38\u306b\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u3092\u30d5\u30ed\u30f3\u30c8\u304b\u3089\u884c\u3063\u3066\u3044\u305f\u3051\u3069\u305d\u3061\u3089\u3082\u554f\u984c\u306a\u304f\u884c\u3048\u305f(\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u3092\u4f7f\u7528)\n\n\nhttps://github.com/roma/roma/blob/master/lib/roma/tools/consistency_test.rb\n\n\n\n\nNO High CPU rate\n\nCPU rate\u306e\u5927\u90e8\u5206\u306f15%\u4ee5\u4e0b\u3060\u3063\u305f\nMAX\u3067\u308223%\u3060\u3063\u305f\n\n\nAWS monitoring Glaph\n\nCPU use ratio\n\n\n\nJapan\n\nUS\n\n\n\n\n\nI/O Input\n\n\nJapan\n\nUS\n\n\n\nI/O Output\n\n\nJapan\n\nUS\n\n\n\nClient & Gladiator\n\u4eca\u56de\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068Gladiator\u306f\u79fb\u8a2d\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308b\u307e\u307e\u3067\u3059\u304c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3082Gladiator\u3082ROMA\u30af\u30e9\u30b9\u30bf\u30fc\u306erouting\u60c5\u5831\u3092\u5b9a\u671f\u7684\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u66f4\u65b0\u3059\u308b\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7279\u306b\u30a2\u30af\u30bb\u30b9\u5148\u306e\u5909\u66f4\u3084\u518d\u8d77\u52d5\u7b49\u3057\u306a\u304f\u3066\u3082\u305d\u306e\u307e\u307e\u4f7f\u3044\u7d9a\u3051\u308b\u3053\u3068\u304c\u51fa\u304d\u307e\u3059\n\n\n\u53c2\u7167URL\nROMA Blog: http://roma-kvs.org/blogs/blog-entry-14.html\nAWS\u306e\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308bROMA\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7c73\u56fd\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u79fb\u8a2d\u3057\u305f\u8a71\n\n# \u6761\u4ef6\n## AWS EC2\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/606a7071-ca45-3791-ed72-a23dae030de6.png' width='200px' />  \n\n<table>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td>Model</td>\n\t\t\t<td colspan=\"2\">m3.large</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Memory</td>\n\t\t\t<td colspan=\"2\">7.5GB</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Storage</td>\n\t\t\t<td colspan=\"2\">32GB</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>OS</td>\n\t\t\t<td colspan=\"2\">CentOS 6.5</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td rowspan=\"2\">Asia pacific(Tokyo) region</td>\n\t\t\t<td>ROMA server</td>\n\t\t\t<td>3 server</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Gladiator server</td>\n\t\t\t<td>1 server</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>US standard region</td>\n\t\t\t<td>ROMA server</td>\n\t\t\t<td>3 server</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n## ROMA\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/1fdf2b86-322c-f87e-7fc7-9117124ad619.png' width='100px' />  \n\n<table>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td>ROMA version</td>\n\t\t\t<td>v1.2.0</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Ruby version</td>\n\t\t\t<td>v2.1.6</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Storage Type</td>\n\t\t\t<td>Tokyo Cabinet(v1.4.48)</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>instance/server</td>\n\t\t\t<td>1</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Redundancy</td>\n\t\t\t<td>2</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Gladiator version</td>\n\t\t\t<td>v1.2.0</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n## Test Data\n![tokyocabinet-logo.png](https://qiita-image-store.s3.amazonaws.com/0/103558/038f94d1-3aad-91a4-08af-cac46bfa31ab.png)  \n\n<table>\n\t<tbody>\n\t\t<tr>\n\t\t\t<td>Record counts</td>\n\t\t\t<td>6,000,000 (records)</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Value size</td>\n\t\t\t<td>1024 (bytes)</td>\n\t\t</tr>\n\t\t<tr>\n\t\t\t<td>Total Data size</td>\n\t\t\t<td>3.3(GB)</td>\n\t\t</tr>\n\t</tbody>\n</table>\n\n# \u6d41\u308c\n## 1. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3064\u304f\u3063\u3066\u30fb\u30fb\u30fb\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/2c009c23-717c-8f69-ab74-f8777a5ca982.jpeg' width='400px'/>\n\n## 2. \u7c73\u56fd\u30ea\u30fc\u30b8\u30e7\u30f3\u304b\u3089instance\u3092join\u3057\u3066\u30fb\u30fb\u30fb\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/a95d6901-2fc2-368e-6eb1-258e972830c7.jpeg' width='400px'/>\n\n## 3. \u56fd\u3092\u307e\u305f\u3044\u3060\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u51fa\u6765\u305f\u3089\u30fb\u30fb\u30fb\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/cb574af1-758c-056d-d9dd-bdfb0957ba66.jpeg' width='400px'/>\n\n## 4. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u65b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3057\u3066\u3044\u304f\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/0094f10d-0706-8474-5de7-cb7644b9aeaf.jpeg' width='400px'/>\n\n## 5. \u5b8c\u4e86\uff01\n<img src='https://qiita-image-store.s3.amazonaws.com/0/103558/42d95bd4-3d2f-fec7-215c-9e4609ef468b.jpeg' width='400px'/>\n\n# \u624b\u9806\n## 1. snapshot\u3068\u308b(\u4e07\u304c\u4e00\u306e\u305f\u3081\u306b)\n`$ cpdb #{port}`\n\n## 2. \u7c73\u56fd\u30ea\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8ffd\u52a0\n`$ bin/romad   #{host}   -p   #{port}   -j   #{Japan ROMA instance}`  \n\n<table>\n<thead>\n<td>Before adding US instances</td>\n<td>After adding US instances!\n</td>\n</thead>\n<tbody>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/b4e8fee5-c562-f08f-76c2-38f0f793f0e9.png' width='500px'/></td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/3ae1ce9f-72ef-88f0-6c09-051f5aa1e5de.png' width='500px'/>\n</td>\n</tbody>\n</table>\n\n## 3. \u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5916\u3057\u3066\u3044\u304f\n\u5358\u7d14\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3059\u3068\u5197\u9577\u5ea6\u304c\u843d\u3061\u3066\u3057\u307e\u3046\u306e\u3067\u3001`release`\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u62c5\u5f53\u3057\u3066\u3044\u308bvnodes\u3092\u89e3\u653e\u3057\u3066\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u843d\u3068\u3059\n\n```rb\n> release\n> shutdown_self\n```\nrelease\u3068shutdown_self(rbalse)\u306fGUI\u4e0a\u304b\u3089\u3082\u53ef\u80fd\u3067\u3059  \n\n<table>\n<thead>\n<td>Relese process was ongoing</td>\n<td>After removing Japan instances</td>\n<td>Routing History List</td>\n</thead>\n<tbody>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/ca8712c9-82a8-3e03-4791-7ef33e1a18cb.png' width='500px'/></td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/f642cff6-bb0e-ab03-d06b-4b7da6079a15.png' width='500px'/></td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/915861d2-dc74-22d9-5d05-168b6ba23d29.png' width='500px'/></td>\n</tbody>\n</table>\n\n# \u7d50\u679c\n## NO ERROR\n- \u30a8\u30e9\u30fc\u30ed\u30b0\u3067\u306a\u304b\u3063\u305f\n- AWS monitoring\u306e\u65b9\u3067\u3082\u7279\u306b\u304a\u304b\u3057\u306a\u3068\u3053\u306a\u304b\u3063\u305f\n\n## NO DATA LOST\n- short_vnodes\u3082lost_vnodes\u3082\u767a\u751f\u3057\u306a\u304b\u3063\u305f\n  - (\u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3082\u30c7\u30fc\u30bf\u30ed\u30b9\u30c8\u3082\u767a\u751f\u3057\u306a\u304b\u3063\u305f)\n- \u5e38\u306b\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u3092\u30d5\u30ed\u30f3\u30c8\u304b\u3089\u884c\u3063\u3066\u3044\u305f\u3051\u3069\u305d\u3061\u3089\u3082\u554f\u984c\u306a\u304f\u884c\u3048\u305f(\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u3092\u4f7f\u7528)\n  - https://github.com/roma/roma/blob/master/lib/roma/tools/consistency_test.rb\n\n## NO High CPU rate\n- CPU rate\u306e\u5927\u90e8\u5206\u306f15%\u4ee5\u4e0b\u3060\u3063\u305f\n- MAX\u3067\u308223%\u3060\u3063\u305f\n\n## AWS monitoring Glaph\n- CPU use ratio  \n\n<table>\n<td>Japan</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/f2fddab5-5a9b-d932-017b-fb29f48bdf6d.png' width='400px' /></td>\n<td>US</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/40ebfeeb-18b2-e470-bc54-c90cbd1c7d29.png' width='400px' />\n</td>\n</table>\n\n- I/O Input\n\n<table>\n<td>Japan</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/a2b15bcd-d81c-40c9-5e83-620d38e2357a.png' width='400px' /></td>\n<td>US</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/1f66b2b3-7d10-18cd-fc90-149e3ae409f7.png' width='400px' /></td>\n</table>\n\n- I/O Output\n\n<table>\n<td>Japan</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/985ea1b6-5ec0-4c21-4033-36e66d47d355.png' width='400px' /></td>\n<td>US</td>\n<td><img src='https://qiita-image-store.s3.amazonaws.com/0/103558/015ad321-12fb-1486-08fb-3e7867d32f36.png' width='400px' /></td>\n</table>\n\n# Client & Gladiator\n\u4eca\u56de\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068Gladiator\u306f\u79fb\u8a2d\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308b\u307e\u307e\u3067\u3059\u304c\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3082Gladiator\u3082ROMA\u30af\u30e9\u30b9\u30bf\u30fc\u306erouting\u60c5\u5831\u3092\u5b9a\u671f\u7684\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u66f4\u65b0\u3059\u308b\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7279\u306b\u30a2\u30af\u30bb\u30b9\u5148\u306e\u5909\u66f4\u3084\u518d\u8d77\u52d5\u7b49\u3057\u306a\u304f\u3066\u3082\u305d\u306e\u307e\u307e\u4f7f\u3044\u7d9a\u3051\u308b\u3053\u3068\u304c\u51fa\u304d\u307e\u3059\n![aws_overview6.jpg](https://qiita-image-store.s3.amazonaws.com/0/103558/ab40b958-7050-b69c-fb8a-64ecd8da9b16.jpeg)\n\n# \u53c2\u7167URL\nROMA Blog: http://roma-kvs.org/blogs/blog-entry-14.html\n"}