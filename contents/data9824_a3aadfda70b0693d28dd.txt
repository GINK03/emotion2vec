{"context": " More than 1 year has passed since last update.PRML 8.4.1\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001N\u500b\u306e\u30ce\u30fc\u30c9\u3092\u6301\u3061\u305d\u308c\u305e\u308c\u306e\u30ce\u30fc\u30c9\u304cK\u500b\u306e\u72b6\u614b\u3092\u53d6\u308b\u3088\u3046\u306a\u30de\u30eb\u30b3\u30d5\u9023\u9396\u306b\u3064\u3044\u3066\u3001\u5404\u30ce\u30fc\u30c9xn\u306e\u5468\u8fba\u5206\u5e03p(xn)\u3092\u63a8\u8ad6\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u7d20\u6734\u306b\u5f0f8.50\u306e\u901a\u308a\u3001x\u304c\u53d6\u308a\u5f97\u308b\u72b6\u614b\u5168\u3066\u306e\u5834\u5408\u306b\u3064\u3044\u3066\u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u3066\u3001\u305d\u308c\u3089\u306e\u5408\u8a08\u306b\u3088\u308a\u5468\u8fba\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\u5168\u3066\u306e\u5834\u5408\u306b\u3064\u3044\u3066\u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u308b\u306e\u3067\u3001\u8a08\u7b97\u91cf\u306fO(K^N)\u3068\u306a\u308a\u307e\u3059\u3002\n\u4e00\u65b9\u3001\u5f0f8.52\u306e\u901a\u308a\u30dd\u30c6\u30f3\u30b7\u30e3\u30eb\u306e\u548c\u7a4d\u8a08\u7b97\u3092\u3001\u9023\u9396\u306e\u524d\u65b9\u304a\u3088\u3073\u5f8c\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001O(N*K^2)\u306e\u8a08\u7b97\u91cf\u3067\u540c\u3058\u7d50\u679c\u304c\u5f97\u3089\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u4e0e\u3048\u308b\u30de\u30eb\u30b3\u30d5\u9023\u9396\u306f\u3001\u4ee5\u4e0b\u306e\u6761\u4ef6\u4ed8\u304d\u5206\u5e03\u306e\u7a4d\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u308b\u30d9\u30a4\u30b8\u30a2\u30f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u3001\u5f0f8.45\u306b\u5f93\u3063\u3066\u7b49\u4fa1\u306a\u30de\u30eb\u30b3\u30d5\u78ba\u7387\u5834\u306b\u5909\u63db\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\n\nx1\np(x1)\n\n\n\n\n0\n0.1\n\n\n1\n0.1\n\n\n2\n0.8\n\n\n\n\n\n\nx(n-1)\nxn\np(xn\uff5cx(n-1))\n\n\n\n\n0\n0\n0.8\n\n\n0\n1\n0.1\n\n\n0\n2\n0.1\n\n\n1\n0\n0.1\n\n\n1\n1\n0.8\n\n\n1\n2\n0.1\n\n\n2\n0\n0.1\n\n\n2\n1\n0.1\n\n\n2\n2\n0.8\n\n\n\n\u307e\u305f\u30ce\u30fc\u30c9x4\u306b\u50241\u3092\u89b3\u6e2c\u3057\u305f\u3068\u304d\u306e\u5468\u8fba\u5206\u5e03\u3082\u6c42\u3081\u307e\u3059\u3002\n\nframe()\nset.seed(0)\npar(mfcol=c(2, 2))\npar(mar=c(2, 2, 1, 0))\npar(mgp=c(1, 0, 0))\nN <- 7\nK <- 3\npotential1 <- function(n, x1, x2) {\n    # p(x1)\n    if (n == 1) {\n        p <- ifelse(x1 == 2, 0.8, 0.1)\n    } else {\n        p <- 1\n    }\n    # p(xn|xn-1)\n    p <- p * ifelse(x1 == x2, 0.8, 0.1)\n    p\n}\npotential2 <- function(n, x1, x2) {\n    # p(x1)\n    if (n == 1) {\n        p <- ifelse(x1 == 2, 0.8, 0.1)\n    } else {\n        p <- 1\n    }\n    # p(xn|xn-1)\n    p <- p * ifelse(x1 == x2, 0.8, 0.1)\n    # x4\u306b1\u3092\u89b3\u6e2c\n    OBSERVED <- 1\n    if (n == 4) {\n        p <- p * ifelse(x1 == OBSERVED, 1, 0)\n    } else if (n + 1 == 4) {\n        p <- p * ifelse(x2 == OBSERVED, 1, 0)\n    }\n    p\n}\n\ndoplot.joint <- function(potential) {\n    # \u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u308b\n    d <- data.frame()\n    for (i in 0:(K^N - 1)) {  # O(K^N)\n        total.potential <- 1\n        xs <- c()\n        xs <- c(xs, (i) %% K)\n        for (n in 1:(N-1)) {\n            xn1 <- (i %/% K ^ (n - 1)) %% K\n            xn2 <- (i %/% K ^ n) %% K\n            xs <- c(xs, xn2)\n            psi <- potential(n, xn1, xn2)\n            total.potential <- total.potential * psi\n        }\n        d <- rbind(d, c(xs, total.potential))\n    }\n    names(d) <- c(paste0(\"x\", 1:N), \"p\")\n    cat(\"p(x)\\n\");print(rbind(head(d),tail(d)))\n\n    # \u540c\u6642\u5206\u5e03\u306e\u548c\u306b\u3088\u308a\u5468\u8fba\u5206\u5e03\u3092\u6c42\u3081\u308b\n    ps <- matrix(nrow=N, ncol=K)\n    rownames(ps) <- 1:N\n    colnames(ps) <- 0:(K-1)\n    z <- sum(d$p)\n    for (n in 1:N) {\n        for (xn in 0:(K-1)) {\n            ps[n, xn + 1] <- sum(d[d[, n] == xn, ]$p) / z\n        }\n    }\n    cat(\"p(xn)\\n\");print(ps)\n    barplot(t(ps), legend=0:(K-1), xlab=\"xn\", ylab=\"p(xn)\")\n    title(\"sum of joint\")\n}\n\ndoplot.message <- function(potential) {\n    # \u524d\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n    mualpha <- matrix(nrow=N, ncol=K)\n    colnames(mualpha) <- 0:(K-1)\n    mualpha[1, ] <- rep(1, K)\n    for (n in 2:N) {  # O(N*K^2)\n        mu <- c()\n        for (x2 in 0:(K-1)) {  # O(K^2)\n            mu <- c(mu, sum(potential(n - 1, 0:(K-1), x2) * mualpha[n - 1, ]))\n        }\n        mualpha[n, ] <- mu\n    }\n    cat(\"mualpha\\n\");print(mualpha)\n\n    # \u5f8c\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n    mubeta <- matrix(nrow=N, ncol=K)\n    colnames(mubeta) <- 0:(K-1)\n    mubeta[N, ] <- rep(1, K)\n    for (n in (N-1):1) {  # O(N*K^2)\n        mu <- c()\n        for (x1 in 0:(K-1)) {  # O(K^2)\n            mu <- c(mu, sum(potential(n, x1, 0:(K-1)) * mubeta[n + 1, ]))\n        }\n        mubeta[n, ] <- mu\n    }\n    cat(\"mubeta\\n\");print(mubeta)\n\n    # \u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u57fa\u3065\u304f\u5468\u8fba\u5206\u5e03\u306e\u8a08\u7b97\n    ps <- matrix(nrow=N, ncol=K)\n    rownames(ps) <- 1:N\n    colnames(ps) <- 0:(K-1)\n    for (n in 1:N) {\n        p <- mualpha[n, ] * mubeta[n, ]\n        z <- sum(p)\n        ps[n, ] <- p / z\n    }\n    cat(\"p(xn)\\n\");print(ps)\n    barplot(t(ps), legend=0:(K-1), xlab=\"xn\", ylab=\"p(xn)\")\n    title(\"message passing\")\n}\n\ndoplot.joint(potential1)\ndoplot.message(potential1)\ndoplot.joint(potential2)\ndoplot.message(potential2)\n\nPRML 8.4.1\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001N\u500b\u306e\u30ce\u30fc\u30c9\u3092\u6301\u3061\u305d\u308c\u305e\u308c\u306e\u30ce\u30fc\u30c9\u304cK\u500b\u306e\u72b6\u614b\u3092\u53d6\u308b\u3088\u3046\u306a\u30de\u30eb\u30b3\u30d5\u9023\u9396\u306b\u3064\u3044\u3066\u3001\u5404\u30ce\u30fc\u30c9xn\u306e\u5468\u8fba\u5206\u5e03p(xn)\u3092\u63a8\u8ad6\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u7d20\u6734\u306b\u5f0f8.50\u306e\u901a\u308a\u3001x\u304c\u53d6\u308a\u5f97\u308b\u72b6\u614b\u5168\u3066\u306e\u5834\u5408\u306b\u3064\u3044\u3066\u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u3066\u3001\u305d\u308c\u3089\u306e\u5408\u8a08\u306b\u3088\u308a\u5468\u8fba\u5206\u5e03\u3092\u6c42\u3081\u307e\u3059\u3002\u5168\u3066\u306e\u5834\u5408\u306b\u3064\u3044\u3066\u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u308b\u306e\u3067\u3001\u8a08\u7b97\u91cf\u306fO(K^N)\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u4e00\u65b9\u3001\u5f0f8.52\u306e\u901a\u308a\u30dd\u30c6\u30f3\u30b7\u30e3\u30eb\u306e\u548c\u7a4d\u8a08\u7b97\u3092\u3001\u9023\u9396\u306e\u524d\u65b9\u304a\u3088\u3073\u5f8c\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001O(N*K^2)\u306e\u8a08\u7b97\u91cf\u3067\u540c\u3058\u7d50\u679c\u304c\u5f97\u3089\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4e0e\u3048\u308b\u30de\u30eb\u30b3\u30d5\u9023\u9396\u306f\u3001\u4ee5\u4e0b\u306e\u6761\u4ef6\u4ed8\u304d\u5206\u5e03\u306e\u7a4d\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u308b\u30d9\u30a4\u30b8\u30a2\u30f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u3001\u5f0f8.45\u306b\u5f93\u3063\u3066\u7b49\u4fa1\u306a\u30de\u30eb\u30b3\u30d5\u78ba\u7387\u5834\u306b\u5909\u63db\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n|x1|p(x1)|\n|--:|--:|\n|0|0.1|\n|1|0.1|\n|2|0.8|\n\n|x(n-1)|xn|p(xn\uff5cx(n-1))|\n|--:|--:|--:|\n|0\t|0\t|0.8|\n|0\t|1\t|0.1|\n|0\t|2\t|0.1|\n|1\t|0\t|0.1|\n|1\t|1\t|0.8|\n|1\t|2\t|0.1|\n|2\t|0\t|0.1|\n|2\t|1\t|0.1|\n|2\t|2\t|0.8|\n\n\u307e\u305f\u30ce\u30fc\u30c9x4\u306b\u50241\u3092\u89b3\u6e2c\u3057\u305f\u3068\u304d\u306e\u5468\u8fba\u5206\u5e03\u3082\u6c42\u3081\u307e\u3059\u3002\n\n![](https://dl.dropbox.com/sh/cwfemibvr7gk4cy/CANWK6Khny/18.MarkovChainExactInference.png)\n\n```r\nframe()\nset.seed(0)\npar(mfcol=c(2, 2))\npar(mar=c(2, 2, 1, 0))\npar(mgp=c(1, 0, 0))\nN <- 7\nK <- 3\npotential1 <- function(n, x1, x2) {\n\t# p(x1)\n\tif (n == 1) {\n\t\tp <- ifelse(x1 == 2, 0.8, 0.1)\n\t} else {\n\t\tp <- 1\n\t}\n\t# p(xn|xn-1)\n\tp <- p * ifelse(x1 == x2, 0.8, 0.1)\n\tp\n}\npotential2 <- function(n, x1, x2) {\n\t# p(x1)\n\tif (n == 1) {\n\t\tp <- ifelse(x1 == 2, 0.8, 0.1)\n\t} else {\n\t\tp <- 1\n\t}\n\t# p(xn|xn-1)\n\tp <- p * ifelse(x1 == x2, 0.8, 0.1)\n\t# x4\u306b1\u3092\u89b3\u6e2c\n\tOBSERVED <- 1\n\tif (n == 4) {\n\t\tp <- p * ifelse(x1 == OBSERVED, 1, 0)\n\t} else if (n + 1 == 4) {\n\t\tp <- p * ifelse(x2 == OBSERVED, 1, 0)\n\t}\n\tp\n}\n\ndoplot.joint <- function(potential) {\n\t# \u540c\u6642\u5206\u5e03\u3092\u6c42\u3081\u308b\n\td <- data.frame()\n\tfor (i in 0:(K^N - 1)) {  # O(K^N)\n\t\ttotal.potential <- 1\n\t\txs <- c()\n\t\txs <- c(xs, (i) %% K)\n\t\tfor (n in 1:(N-1)) {\n\t\t\txn1 <- (i %/% K ^ (n - 1)) %% K\n\t\t\txn2 <- (i %/% K ^ n) %% K\n\t\t\txs <- c(xs, xn2)\n\t\t\tpsi <- potential(n, xn1, xn2)\n\t\t\ttotal.potential <- total.potential * psi\n\t\t}\n\t\td <- rbind(d, c(xs, total.potential))\n\t}\n\tnames(d) <- c(paste0(\"x\", 1:N), \"p\")\n\tcat(\"p(x)\\n\");print(rbind(head(d),tail(d)))\n\n\t# \u540c\u6642\u5206\u5e03\u306e\u548c\u306b\u3088\u308a\u5468\u8fba\u5206\u5e03\u3092\u6c42\u3081\u308b\n\tps <- matrix(nrow=N, ncol=K)\n\trownames(ps) <- 1:N\n\tcolnames(ps) <- 0:(K-1)\n\tz <- sum(d$p)\n\tfor (n in 1:N) {\n\t\tfor (xn in 0:(K-1)) {\n\t\t\tps[n, xn + 1] <- sum(d[d[, n] == xn, ]$p) / z\n\t\t}\n\t}\n\tcat(\"p(xn)\\n\");print(ps)\n\tbarplot(t(ps), legend=0:(K-1), xlab=\"xn\", ylab=\"p(xn)\")\n\ttitle(\"sum of joint\")\n}\n\ndoplot.message <- function(potential) {\n\t# \u524d\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n\tmualpha <- matrix(nrow=N, ncol=K)\n\tcolnames(mualpha) <- 0:(K-1)\n\tmualpha[1, ] <- rep(1, K)\n\tfor (n in 2:N) {  # O(N*K^2)\n\t\tmu <- c()\n\t\tfor (x2 in 0:(K-1)) {  # O(K^2)\n\t\t\tmu <- c(mu, sum(potential(n - 1, 0:(K-1), x2) * mualpha[n - 1, ]))\n\t\t}\n\t\tmualpha[n, ] <- mu\n\t}\n\tcat(\"mualpha\\n\");print(mualpha)\n\n\t# \u5f8c\u65b9\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\n\tmubeta <- matrix(nrow=N, ncol=K)\n\tcolnames(mubeta) <- 0:(K-1)\n\tmubeta[N, ] <- rep(1, K)\n\tfor (n in (N-1):1) {  # O(N*K^2)\n\t\tmu <- c()\n\t\tfor (x1 in 0:(K-1)) {  # O(K^2)\n\t\t\tmu <- c(mu, sum(potential(n, x1, 0:(K-1)) * mubeta[n + 1, ]))\n\t\t}\n\t\tmubeta[n, ] <- mu\n\t}\n\tcat(\"mubeta\\n\");print(mubeta)\n\n\t# \u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u57fa\u3065\u304f\u5468\u8fba\u5206\u5e03\u306e\u8a08\u7b97\n\tps <- matrix(nrow=N, ncol=K)\n\trownames(ps) <- 1:N\n\tcolnames(ps) <- 0:(K-1)\n\tfor (n in 1:N) {\n\t\tp <- mualpha[n, ] * mubeta[n, ]\n\t\tz <- sum(p)\n\t\tps[n, ] <- p / z\n\t}\n\tcat(\"p(xn)\\n\");print(ps)\n\tbarplot(t(ps), legend=0:(K-1), xlab=\"xn\", ylab=\"p(xn)\")\n\ttitle(\"message passing\")\n}\n\ndoplot.joint(potential1)\ndoplot.message(potential1)\ndoplot.joint(potential2)\ndoplot.message(potential2)\n```\n", "tags": ["R", "PRML"]}