{"tags": ["linebot", "MicrosoftTranslator"], "context": "\u5f15\u7d9a\u304d\u81ea\u5206\u306b\u4f7f\u3048\u308bLINEBot\u30b7\u30ea\u30fc\u30ba\u3092\u3072\u305f\u3059\u3089\u7814\u7a76\u4e2d\u3002\n\u6d77\u5916\u8f38\u5165\u3067\u30b5\u30dd\u30fc\u30c8\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u7ffb\u8a33\u3067\u304d\u308bLINEBot\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\n\n\u7ffb\u8a33\u30e9\u30a4\u30d6\u30e9\u30ea\nGoogle Cloud Translation API\u306f\u6709\u6599\u306e\u3088\u3046\u306a\u306e\u3067\u3001Microsoft Translator API\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n200\u767e\u4e07\u6587\u5b57/\u6708\u307e\u3067\u306f\u7121\u6599\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u3060\u3001Microsoft\u3042\u308a\u304c\u3068\u3046\u3002\n\u767b\u9332\u65b9\u6cd5\u306a\u3069\u306f\u3053\u306e\u8a18\u4e8b\u304c\u8a73\u3057\u3044\u3002\n\n\n\n\nMicrosoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u308b - Qiita\n\n\n\n Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u308b - Qiita... \n\n\n\n\n\n\n\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3053\u306e\u8a18\u4e8b\u3092\u307b\u307c\u771f\u4f3c\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\n\n\n\n\nMicrosoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u305f - Qiita\n\n\n\n Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u305f - Qiita... \n\n\n\n\n\n\n\n\u65e5\u672c\u8a9e\u304c\u6df7\u3058\u3063\u3066\u3044\u308c\u3070\u5165\u529b\u306f\u65e5\u672c\u8a9e\u3068\u5224\u5b9a\u3057\u82f1\u8a9e\u306b\u7ffb\u8a33\u3001\u305d\u308c\u4ee5\u5916\u306f\u9006\u3068\u3057\u305f\u3002\n\ncallback.php\n<?php\n\nrequire_once('./LINEBotTiny.php');\n\n$channelAccessToken = 'YOUR_ACCESS_TOKEN';\n$channelSecret = 'YOUR_SECRET';\n\n$client = new LINEBotTiny($channelAccessToken, $channelSecret);\n\nforeach ($client->parseEvents() as $event) {\n    switch ($event['type']) {\n        case 'message':\n            $message = $event['message'];\n\n            switch ($message['type']) {\n                case 'text':\n\n                    $client->replyMessage(array(\n                        'replyToken' => $event['replyToken'],\n                        'messages' => array(\n                            array(\n                                'type' => 'text',\n                                'text' => translation($message['text'])\n                            )\n                        )\n                    ));\n\n                    break;\n                default:\n                    error_log(\"Unsupporeted message type: \" . $message['type']);\n                    break;\n            }\n            break;\n        default:\n            error_log(\"Unsupporeted event type: \" . $event['type']);\n            break;\n    }\n};\n\nfunction translation($text) {\n  $client_id = \"YOUR_ID\";\n  $client_secret = \"YOUR_SECRET\";\n  $access_token = getAccessToken($client_id, $client_secret)->access_token;\n\n  $text = mb_convert_kana($text, 'KVas');\n\n  $from = '';\n  $to = '';\n  if (preg_match('/[\u3041-\u3093\u30a1-\u30f6\u30fc\u4e00-\u9fa0\u3001\u3002]/u',$text)) {\n    $from = 'ja';\n    $to = 'en';\n  }\n  else{\n    $from = 'en';\n    $to = 'ja';\n  }\n\n\n  return tranlator($access_token, array(\n          'text' => $text,\n              'to' => $to,\n              'from' => $from));\n\n}\n\n\n  function getAccessToken($client_id, $client_secret, $grant_type = \"client_credentials\", $scope = \"http://api.microsofttranslator.com\"){\n      $ch = curl_init();\n      curl_setopt_array($ch, array(\n          CURLOPT_URL => \"https://datamarket.accesscontrol.windows.net/v2/OAuth2-13/\",\n          CURLOPT_SSL_VERIFYPEER => false,\n          CURLOPT_RETURNTRANSFER => true,\n          CURLOPT_POST => true,\n          CURLOPT_POSTFIELDS => http_build_query(array(\n              \"grant_type\" => $grant_type,\n              \"scope\" => $scope,\n              \"client_id\" => $client_id,\n              \"client_secret\" => $client_secret\n              ))\n          ));\n      return json_decode(curl_exec($ch));\n  }\n\n  function tranlator($access_token, $params){\n      $ch = curl_init();\n      curl_setopt_array($ch, array(\n          CURLOPT_URL => \"https://api.microsofttranslator.com/v2/Http.svc/Translate?\".http_build_query($params),\n          CURLOPT_SSL_VERIFYPEER => false,\n          CURLOPT_RETURNTRANSFER => true,\n          CURLOPT_HEADER => true,\n          CURLOPT_HTTPHEADER => array(\n              \"Authorization: Bearer \". $access_token),\n          ));\n      preg_match('/>(.+?)<\\/string>/',curl_exec($ch), $m);\n      return $m[1];\n  }\n\n\n\n\u52d5\u4f5c\n\u7cbe\u5ea6\u3084\u901f\u5ea6\u306f\u5168\u304f\u554f\u984c\u306a\u3057\u3060\u3002\u3053\u308c\u306f\u304b\u306a\u308a\u4f7f\u3048\u305d\u3046\u306a\u4e88\u611f\u3002\n\n\uff08\u8ffd\u8a18\uff09\n\u3061\u3087\u3046\u3069\u3053\u306e\u8a18\u4e8b\u3092\u898b\u3066\u3001 \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u306b\u5bfe\u5fdc\u3057\u3066\u307f\u305f\u3002\n\n\n\n\nMicrosoft Translate API \u3092\u7528\u3044\u305f Slack \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5 - Qiita\n\n\n\n Microsoft Translate API \u3092\u7528\u3044\u305f Slack \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5 - Qiita... \n\n\n\n\n\n\n\n\u5f15\u7d9a\u304d\u81ea\u5206\u306b\u4f7f\u3048\u308bLINEBot\u30b7\u30ea\u30fc\u30ba\u3092\u3072\u305f\u3059\u3089\u7814\u7a76\u4e2d\u3002\n\u6d77\u5916\u8f38\u5165\u3067\u30b5\u30dd\u30fc\u30c8\u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u7ffb\u8a33\u3067\u304d\u308bLINEBot\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\n\n# \u7ffb\u8a33\u30e9\u30a4\u30d6\u30e9\u30ea\nGoogle Cloud Translation API\u306f\u6709\u6599\u306e\u3088\u3046\u306a\u306e\u3067\u3001Microsoft Translator API\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n200\u767e\u4e07\u6587\u5b57/\u6708\u307e\u3067\u306f\u7121\u6599\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u3060\u3001Microsoft\u3042\u308a\u304c\u3068\u3046\u3002\n\n\u767b\u9332\u65b9\u6cd5\u306a\u3069\u306f\u3053\u306e\u8a18\u4e8b\u304c\u8a73\u3057\u3044\u3002\n<TABLE ALIGN=CENTER><TR><TD WIDTH=400px>\n <A HREF=\"http://qiita.com/kemayako/items/21fe36005e6e729aff77\" TARGET=\"_blank\"><STRONG>Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u308b - Qiita</STRONG></A>\n <A HREF=\"http://b.hatena.ne.jp/entry/http://qiita.com/kemayako/items/21fe36005e6e729aff77\" TARGET=\"_blank\">\n <IMG BORDER=\"0\" SRC=\"http://b.hatena.ne.jp/entry/image/http://qiita.com/kemayako/items/21fe36005e6e729aff77\" BORDER=\"0\" ALT=\"\" /></a>\n <BR>\n Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u308b - Qiita... \n </TD>\n <TD WIDTH=150px>\n <IMG STYLE=\"float:left;margin-right:.5em;\" SRC=\"http://capture.heartrails.com/120x120/cool?http://qiita.com/kemayako/items/21fe36005e6e729aff77\" ALT=\"\" WIDTH=\"120\" HEIGHT=\"120\" />\n </TD></TR>\n</TABLE>\n\n# \u30d7\u30ed\u30b0\u30e9\u30e0\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3053\u306e\u8a18\u4e8b\u3092\u307b\u307c\u771f\u4f3c\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\n<TABLE ALIGN=CENTER><TR><TD WIDTH=400px>\n <A HREF=\"http://qiita.com/lm0x/items/707ea4051b92bf839a1a\" TARGET=\"_blank\"><STRONG>Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u305f - Qiita</STRONG></A>\n <A HREF=\"http://b.hatena.ne.jp/entry/http://qiita.com/lm0x/items/707ea4051b92bf839a1a\" TARGET=\"_blank\">\n <IMG BORDER=\"0\" SRC=\"http://b.hatena.ne.jp/entry/image/http://qiita.com/lm0x/items/707ea4051b92bf839a1a\" BORDER=\"0\" ALT=\"\" /></a>\n <BR>\n Microsoft Translator API\u3092\u4f7f\u3063\u3066\u307f\u305f - Qiita... \n </TD>\n <TD WIDTH=150px>\n <IMG STYLE=\"float:left;margin-right:.5em;\" SRC=\"http://capture.heartrails.com/120x120/cool?http://qiita.com/lm0x/items/707ea4051b92bf839a1a\" ALT=\"\" WIDTH=\"120\" HEIGHT=\"120\" />\n </TD></TR>\n</TABLE>\n\n\u65e5\u672c\u8a9e\u304c\u6df7\u3058\u3063\u3066\u3044\u308c\u3070\u5165\u529b\u306f\u65e5\u672c\u8a9e\u3068\u5224\u5b9a\u3057\u82f1\u8a9e\u306b\u7ffb\u8a33\u3001\u305d\u308c\u4ee5\u5916\u306f\u9006\u3068\u3057\u305f\u3002\n\n```php:callback.php\n<?php\n\nrequire_once('./LINEBotTiny.php');\n\n$channelAccessToken = 'YOUR_ACCESS_TOKEN';\n$channelSecret = 'YOUR_SECRET';\n\n$client = new LINEBotTiny($channelAccessToken, $channelSecret);\n\nforeach ($client->parseEvents() as $event) {\n    switch ($event['type']) {\n        case 'message':\n            $message = $event['message'];\n\n            switch ($message['type']) {\n                case 'text':\n\n                    $client->replyMessage(array(\n                        'replyToken' => $event['replyToken'],\n                        'messages' => array(\n                            array(\n                                'type' => 'text',\n                                'text' => translation($message['text'])\n                            )\n                        )\n                    ));\n\n                    break;\n                default:\n                    error_log(\"Unsupporeted message type: \" . $message['type']);\n                    break;\n            }\n            break;\n        default:\n            error_log(\"Unsupporeted event type: \" . $event['type']);\n            break;\n    }\n};\n\nfunction translation($text) {\n  $client_id = \"YOUR_ID\";\n  $client_secret = \"YOUR_SECRET\";\n  $access_token = getAccessToken($client_id, $client_secret)->access_token;\n\n  $text = mb_convert_kana($text, 'KVas');\n\n  $from = '';\n  $to = '';\n  if (preg_match('/[\u3041-\u3093\u30a1-\u30f6\u30fc\u4e00-\u9fa0\u3001\u3002]/u',$text)) {\n    $from = 'ja';\n    $to = 'en';\n  }\n  else{\n    $from = 'en';\n    $to = 'ja';\n  }\n\n\n  return tranlator($access_token, array(\n          'text' => $text,\n              'to' => $to,\n              'from' => $from));\n\n}\n\n\n  function getAccessToken($client_id, $client_secret, $grant_type = \"client_credentials\", $scope = \"http://api.microsofttranslator.com\"){\n      $ch = curl_init();\n      curl_setopt_array($ch, array(\n          CURLOPT_URL => \"https://datamarket.accesscontrol.windows.net/v2/OAuth2-13/\",\n          CURLOPT_SSL_VERIFYPEER => false,\n          CURLOPT_RETURNTRANSFER => true,\n          CURLOPT_POST => true,\n          CURLOPT_POSTFIELDS => http_build_query(array(\n              \"grant_type\" => $grant_type,\n              \"scope\" => $scope,\n              \"client_id\" => $client_id,\n              \"client_secret\" => $client_secret\n              ))\n          ));\n      return json_decode(curl_exec($ch));\n  }\n\n  function tranlator($access_token, $params){\n      $ch = curl_init();\n      curl_setopt_array($ch, array(\n          CURLOPT_URL => \"https://api.microsofttranslator.com/v2/Http.svc/Translate?\".http_build_query($params),\n          CURLOPT_SSL_VERIFYPEER => false,\n          CURLOPT_RETURNTRANSFER => true,\n          CURLOPT_HEADER => true,\n          CURLOPT_HTTPHEADER => array(\n              \"Authorization: Bearer \". $access_token),\n          ));\n      preg_match('/>(.+?)<\\/string>/',curl_exec($ch), $m);\n      return $m[1];\n  }\n```\n\n# \u52d5\u4f5c\n\u7cbe\u5ea6\u3084\u901f\u5ea6\u306f\u5168\u304f\u554f\u984c\u306a\u3057\u3060\u3002\u3053\u308c\u306f\u304b\u306a\u308a\u4f7f\u3048\u305d\u3046\u306a\u4e88\u611f\u3002\n![cap.PNG](https://qiita-image-store.s3.amazonaws.com/0/120983/99ce28e7-c43a-2bd2-5ac0-1fa72cdafb96.png)\n\n\n\uff08\u8ffd\u8a18\uff09\n\u3061\u3087\u3046\u3069\u3053\u306e\u8a18\u4e8b\u3092\u898b\u3066\u3001 \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u306b\u5bfe\u5fdc\u3057\u3066\u307f\u305f\u3002\n<TABLE ALIGN=CENTER><TR><TD WIDTH=400px>\n <A HREF=\"http://qiita.com/sosuke/items/03617730cfbdd4187e2a\" TARGET=\"_blank\"><STRONG>Microsoft Translate API \u3092\u7528\u3044\u305f Slack \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5 - Qiita</STRONG></A>\n <A HREF=\"http://b.hatena.ne.jp/entry/http://qiita.com/sosuke/items/03617730cfbdd4187e2a\" TARGET=\"_blank\">\n <IMG BORDER=\"0\" SRC=\"http://b.hatena.ne.jp/entry/image/http://qiita.com/sosuke/items/03617730cfbdd4187e2a\" BORDER=\"0\" ALT=\"\" /></a>\n <BR>\n Microsoft Translate API \u3092\u7528\u3044\u305f Slack \u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u7ffb\u8a33\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5 - Qiita... \n </TD>\n <TD WIDTH=150px>\n <IMG STYLE=\"float:left;margin-right:.5em;\" SRC=\"http://capture.heartrails.com/120x120/cool?http://qiita.com/sosuke/items/03617730cfbdd4187e2a\" ALT=\"\" WIDTH=\"120\" HEIGHT=\"120\" />\n </TD></TR>\n</TABLE>\n"}