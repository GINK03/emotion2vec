{"context": "\n\n\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002 \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\nOpsWorks\u3067Custom Cookbooks\u3092\u4f7f\u3046\u969b\u306f\u3084\u3084\u7656\u304c\u3042\u308b\u305f\u3081\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u8272\u3005\u8a66\u3057\u305f\u304f\u306a\u308a\u307e\u3059\u306e\u3067\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n\n\u30ab\u30b9\u30bf\u30e0\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u66f4\u65b0\u3057\u305f\u3044\n\nShell\n$ cd /opt/aws/opsworks/current/site-cookbooks\n$ git pull origin master\n\n\n\nec2-**\u306a\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u3044\namazon linux\u306a\u3089/opt/aws\u306bamitools/apitools\u5165\u3063\u3066\u304a\u308a\u3001\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u4f7f\u3044\u307e\u3057\u3087\u3046\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a29\u9650\u306f\u30ec\u30a4\u30e4\u8a2d\u5b9aiam role\u306b\u57fa\u3065\u304d\u307e\u3059\u3002\n\nchef-shell\u3067\u4f5c\u696d\u3057\u305f\u3044\n/opt/aws/opsworks/current\u3067\u4f5c\u696d\u3059\u308c\u3070\u3001\u666e\u901a\u306eChef\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u64cd\u4f5c\u51fa\u6765\u307e\u3059\u3002\n\n11.4 \u306e\u5834\u5408\n\nShell\n$ cd /opt/aws/opsworks/current\n$ bundle exec chef-shell -s -c conf/solo.rb \nloading configuration: conf/solo.rb\nSession type: solo\nLoading.......done.\n\nThis is the chef-shell.\n Chef Version: 11.4.4\n http://www.opscode.com/chef\n http://wiki.opscode.com/display/chef/Home\n\nrun `help' for help, `exit' or ^D to quit.\n\nOhai2u ec2-user@single1.localdomain!\nchef > Chef::VERSION \n => \"11.4.4\" \n\n\n\n11.10 \u306e\u5834\u5408\n\nShell\n$ cd /opt/aws/opsworks/current\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -v\nChef: 11.10.4\n\n$ sudo -i\n# /opt/aws/opsworks/current/bin/chef-shell -j /var/lib/aws/opsworks/chef/2016-08-26-14-10-03-01.json\n\n### \u2191json\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u52d5\u7684\u306a\u306e\u3067\u9069\u5f53\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n\n\n\n\u30b9\u30bf\u30c3\u30af\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u305f\u3044\nopsworks-agent-cli \u304c\u4fbf\u5229\u3067\u3059\u3002\n\nShell\n# opsworks-agent-cli get_json\n{\n  \"opsworks_rubygems\": {\n    \"version\": \"1.8.24\"\n  },\n  \"deploy\": {\n  },\n  \"ssh_users\": {\n  },\n\n-- snip --\n\n\n\nopsworks-agent\u3092\u505c\u6b62\u3057\u305f\u3044\nmonit\u914d\u4e0b\u306b\u3044\u308b\u306e\u3067\u4efb\u610f\u3067\u505c\u6b62\u3067\u304d\u307e\u3059\u3002\n\nShell\n$ monit stop opsworks-agent\n$ monit summary\nThe Monit daemon 5.2.5 uptime: 29m \n\nProcess 'opsworks-agent'            not monitored\nProcess 'opsworks-agent-master-running' running\nFile 'opsworks-agent-statistic-daemons-log' accessible\nFile 'opsworks-agent-process-command-daemons-log' accessible\nFile 'opsworks-agent-keep-alive-daemons-log' accessible\nSystem 'system_single1.localdomain' running\n\n\n\nOhai\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3057\u305f\u3044\n/opt/aws/opsworks/current/plugins\u306b\u8ffd\u52a0\u3059\u308b\u3068OK\u3067\u3059\u3002\n\n\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u305f\u30a2\u30d7\u30ea\u306e\u5834\u6240\n/srv/www/\u4ee5\u4e0b\u306b\u30a2\u30d7\u30ea\u540d\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30ed\u30b0\u304c\u898b\u305f\u3044\n/var/lib/aws/opsworks/chef/\u306bChefRun\u6642\u306e\u30ed\u30b0\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\nChefRun\u306b\u4f7f\u308f\u308c\u305fJson\u304c\u78ba\u8a8d\u3057\u305f\u3044\n/var/lib/aws/opsworks/chef/\u306bChefRun\u6642\u306b\u4f7f\u308f\u308c\u305fJSON\u304c\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3001\u30ed\u30b0\u3068\u5bfe\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u3002\njson\u304c\u3042\u308b\u306e\u3067\u3053\u306e\u69d8\u306b\u30ea\u30c8\u30e9\u30a4\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Chef 11.4 \u306a\u3089\u3001\n\nShell\n$ bundle exec chef-solo -c conf/solo.rb -j /var/lib/aws/opsworks/chef/2013-08-09-04-24-42-01.json\n\n\n11.10 \u306a\u3089\u3001\n\nShell\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -j /var/lib/aws/opsworks/chef/2013-08-09-04-24-42-01.json\n\n\n\n\u518d\u53d6\u5f97\u3057\u305f\u3044\nopsworks-agent-cli get_json \u3067\u8868\u793a\u3067\u304d\u308b\u306e\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308c\u3070chef-solo\u306b\u6e21\u3059Json\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30a4\u30d9\u30f3\u30c8\u3092\u624b\u52d5\u3067\u5b9f\u884c\u3057\u305f\u3044\nopsworks-agent-cli run_command \nconfigure\u3092\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\nShell\n$ opsworks-agent-cli run_command configure\n[2013-08-09 05:13:15] INFO [opsworks-agent (5946)] About to re-run 'configure' from 2013-08-09T04:24:42\nWaiting for process 5950\nStarting Chef Client, version 11.4.4\n\n-- snip --\n\n\n\n\u66f4\u65b0\u3057\u305f\u30ab\u30b9\u30bf\u30e0\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3057\u305f\u3044\nChefSolo\u3092\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Chef 11.4 \u306a\u3089\u3001\n\nShell\n$ bundle exec chef-solo -c conf/solo.rb -o 'my_pkgs::memcached'\nStarting Chef Client, version 11.4.4\n[2013-08-09T05:15:00+00:00] INFO: *** Chef 11.4.4 ***\n[2013-08-09T05:15:03+00:00] DEBUG: Building node object for single1.localdomain\n[2013-08-09T05:15:03+00:00] DEBUG: Extracting run list from JSON attributes provided on command line\n[2013-08-09T05:15:03+00:00] DEBUG: Applying attributes from json file\n[2013-08-09T05:15:03+00:00] DEBUG: Platform is amazon version 2013.03\n[2013-08-09T05:15:03+00:00] WARN: Run List override has been provided.\n[2013-08-09T05:15:03+00:00] WARN: Original Run List: []\n[2013-08-09T05:15:03+00:00] WARN: Overridden Run List: [recipe[my_pkgs::memcached]]\n-- snip --\n\n\n11.10 \u306a\u3089\u3001\n\nShell\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -o 'my_pkgs::memcached'\n\n\n\nchef-apply\u3057\u305f\u3044\n\u305d\u306e\u307e\u307e\u3067\u3059\u3002\n\nShell\n# echo \"package 'nginx'\" | bundle exec chef-apply -s\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\n  * package[nginx] action install\n    - install version 1.4.2-1.el6.ngx of package nginx\n\n\nChef\u30d0\u30fc\u30b8\u30e7\u30f3\u304c11.4.4\u306a\u306e\u3067\u3001why_run\u306b\u306f\u30b3\u30c4\u304c\u8981\u308a\u307e\u3059\u3002\n\nShell\n$ echo \"Chef::Config[:why_run] = true ; package 'nginx'\" | bundle exec chef-apply -s\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\n  * package[nginx] action install\n    - Would install version 1.4.2-1.el6.ngx of package nginx\n\n\n\n\u4ed6\u306b\u3082\u5f79\u306b\u7acb\u3061\u305d\u3046\u306a\u3053\u3068\u3092\u601d\u3044\u3064\u3044\u305f\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n<!-- too_old -->\n> **\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002** \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\nOpsWorks\u3067Custom Cookbooks\u3092\u4f7f\u3046\u969b\u306f\u3084\u3084\u7656\u304c\u3042\u308b\u305f\u3081\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u8272\u3005\u8a66\u3057\u305f\u304f\u306a\u308a\u307e\u3059\u306e\u3067\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n\n\n## \u30ab\u30b9\u30bf\u30e0\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u66f4\u65b0\u3057\u305f\u3044\n\n```shell:Shell\n$ cd /opt/aws/opsworks/current/site-cookbooks\n$ git pull origin master\n```\n\n## ec2-**\u306a\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u305f\u3044\n\namazon linux\u306a\u3089`/opt/aws`\u306b`amitools/apitools`\u5165\u3063\u3066\u304a\u308a\u3001\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u4f7f\u3044\u307e\u3057\u3087\u3046\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a29\u9650\u306f\u30ec\u30a4\u30e4\u8a2d\u5b9a`iam role`\u306b\u57fa\u3065\u304d\u307e\u3059\u3002\n\n\n## chef-shell\u3067\u4f5c\u696d\u3057\u305f\u3044\n\n`/opt/aws/opsworks/current`\u3067\u4f5c\u696d\u3059\u308c\u3070\u3001\u666e\u901a\u306eChef\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u64cd\u4f5c\u51fa\u6765\u307e\u3059\u3002\n\n### 11.4 \u306e\u5834\u5408\n\n```shell:Shell\n$ cd /opt/aws/opsworks/current\n$ bundle exec chef-shell -s -c conf/solo.rb \nloading configuration: conf/solo.rb\nSession type: solo\nLoading.......done.\n\nThis is the chef-shell.\n Chef Version: 11.4.4\n http://www.opscode.com/chef\n http://wiki.opscode.com/display/chef/Home\n\nrun `help' for help, `exit' or ^D to quit.\n\nOhai2u ec2-user@single1.localdomain!\nchef > Chef::VERSION \n => \"11.4.4\" \n```\n\n### 11.10 \u306e\u5834\u5408\n\n```shell:Shell\n$ cd /opt/aws/opsworks/current\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -v\nChef: 11.10.4\n\n$ sudo -i\n# /opt/aws/opsworks/current/bin/chef-shell -j /var/lib/aws/opsworks/chef/2016-08-26-14-10-03-01.json\n\n### \u2191json\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u52d5\u7684\u306a\u306e\u3067\u9069\u5f53\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n```\n\n## \u30b9\u30bf\u30c3\u30af\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u305f\u3044\n\n`opsworks-agent-cli` \u304c\u4fbf\u5229\u3067\u3059\u3002\n\n```shell:Shell\n# opsworks-agent-cli get_json\n{\n  \"opsworks_rubygems\": {\n    \"version\": \"1.8.24\"\n  },\n  \"deploy\": {\n  },\n  \"ssh_users\": {\n  },\n\n-- snip --\n```\n\n## opsworks-agent\u3092\u505c\u6b62\u3057\u305f\u3044\n\nmonit\u914d\u4e0b\u306b\u3044\u308b\u306e\u3067\u4efb\u610f\u3067\u505c\u6b62\u3067\u304d\u307e\u3059\u3002\n\n```shell:Shell\n$ monit stop opsworks-agent\n$ monit summary\nThe Monit daemon 5.2.5 uptime: 29m \n\nProcess 'opsworks-agent'            not monitored\nProcess 'opsworks-agent-master-running' running\nFile 'opsworks-agent-statistic-daemons-log' accessible\nFile 'opsworks-agent-process-command-daemons-log' accessible\nFile 'opsworks-agent-keep-alive-daemons-log' accessible\nSystem 'system_single1.localdomain' running\n```\n\n## Ohai\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3057\u305f\u3044\n\n`/opt/aws/opsworks/current/plugins`\u306b\u8ffd\u52a0\u3059\u308b\u3068OK\u3067\u3059\u3002\n\n## \u30c7\u30d7\u30ed\u30a4\u3055\u308c\u305f\u30a2\u30d7\u30ea\u306e\u5834\u6240\n\n`/srv/www/`\u4ee5\u4e0b\u306b\u30a2\u30d7\u30ea\u540d\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n## \u30ed\u30b0\u304c\u898b\u305f\u3044\n\n`/var/lib/aws/opsworks/chef/`\u306bChefRun\u6642\u306e\u30ed\u30b0\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\n## ChefRun\u306b\u4f7f\u308f\u308c\u305fJson\u304c\u78ba\u8a8d\u3057\u305f\u3044\n\n`/var/lib/aws/opsworks/chef/`\u306bChefRun\u6642\u306b\u4f7f\u308f\u308c\u305fJSON\u304c\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3001\u30ed\u30b0\u3068\u5bfe\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u3002\n\njson\u304c\u3042\u308b\u306e\u3067\u3053\u306e\u69d8\u306b\u30ea\u30c8\u30e9\u30a4\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Chef 11.4 \u306a\u3089\u3001\n\n```shell:Shell\n$ bundle exec chef-solo -c conf/solo.rb -j /var/lib/aws/opsworks/chef/2013-08-09-04-24-42-01.json\n```\n\n11.10 \u306a\u3089\u3001\n\n```shell:Shell\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -j /var/lib/aws/opsworks/chef/2013-08-09-04-24-42-01.json\n```\n\n\n### \u518d\u53d6\u5f97\u3057\u305f\u3044\n\n`opsworks-agent-cli get_json` \u3067\u8868\u793a\u3067\u304d\u308b\u306e\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308c\u3070`chef-solo`\u306b\u6e21\u3059Json\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n## \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30a4\u30d9\u30f3\u30c8\u3092\u624b\u52d5\u3067\u5b9f\u884c\u3057\u305f\u3044\n\n`opsworks-agent-cli run_command` \n\nconfigure\u3092\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\n```shell:Shell\n$ opsworks-agent-cli run_command configure\n[2013-08-09 05:13:15] INFO [opsworks-agent (5946)] About to re-run 'configure' from 2013-08-09T04:24:42\nWaiting for process 5950\nStarting Chef Client, version 11.4.4\n\n-- snip --\n```\n\n## \u66f4\u65b0\u3057\u305f\u30ab\u30b9\u30bf\u30e0\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3057\u305f\u3044\n\nChefSolo\u3092\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Chef 11.4 \u306a\u3089\u3001\n\n```shell:Shell\n$ bundle exec chef-solo -c conf/solo.rb -o 'my_pkgs::memcached'\nStarting Chef Client, version 11.4.4\n[2013-08-09T05:15:00+00:00] INFO: *** Chef 11.4.4 ***\n[2013-08-09T05:15:03+00:00] DEBUG: Building node object for single1.localdomain\n[2013-08-09T05:15:03+00:00] DEBUG: Extracting run list from JSON attributes provided on command line\n[2013-08-09T05:15:03+00:00] DEBUG: Applying attributes from json file\n[2013-08-09T05:15:03+00:00] DEBUG: Platform is amazon version 2013.03\n[2013-08-09T05:15:03+00:00] WARN: Run List override has been provided.\n[2013-08-09T05:15:03+00:00] WARN: Original Run List: []\n[2013-08-09T05:15:03+00:00] WARN: Overridden Run List: [recipe[my_pkgs::memcached]]\n-- snip --\n```\n\n11.10 \u306a\u3089\u3001\n\n```shell:Shell\n$ /opt/aws/opsworks/current/bin/chef-client -c /var/lib/aws/opsworks/client.rb -o 'my_pkgs::memcached'\n```\n\n##  chef-apply\u3057\u305f\u3044\n\n\u305d\u306e\u307e\u307e\u3067\u3059\u3002\n\n```shell:Shell\n# echo \"package 'nginx'\" | bundle exec chef-apply -s\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\n  * package[nginx] action install\n    - install version 1.4.2-1.el6.ngx of package nginx\n```\n\nChef\u30d0\u30fc\u30b8\u30e7\u30f3\u304c`11.4.4`\u306a\u306e\u3067\u3001why_run\u306b\u306f\u30b3\u30c4\u304c\u8981\u308a\u307e\u3059\u3002\n\n```shell:Shell\n$ echo \"Chef::Config[:why_run] = true ; package 'nginx'\" | bundle exec chef-apply -s\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\n  * package[nginx] action install\n    - Would install version 1.4.2-1.el6.ngx of package nginx\n```\n\n----\n\n\u4ed6\u306b\u3082\u5f79\u306b\u7acb\u3061\u305d\u3046\u306a\u3053\u3068\u3092\u601d\u3044\u3064\u3044\u305f\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n", "tags": ["chef11.10", "AWS", "opsworks"]}