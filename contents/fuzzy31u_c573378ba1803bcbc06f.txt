{"tags": ["fabric", "vagrant"], "context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\nVM\u306fCentOS6.4\u3092Vagrant\u3067\u69cb\u7bc9\u6e08\u307f\u3002\nHost\u306fOSX\u3002\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nhttps://gist.github.com/fuzzy31u/117a6e00f93423aeca10\n\u3053\u308c\u306fshell\u30b9\u30af\u30ea\u30d7\u30c8\u306eprovision\u3002\n# TODO manually!\n\u3068\u304b\u66f8\u3044\u3066\u3042\u308b\u306e\u3092\u81ea\u52d5\u5316\u3057\u305f\u304b\u3063\u305f\u3067\u3059\u3002\n\u5168\u4f53\u7684\u306b\u306fhttp\u30b5\u30fc\u30d0\u8d77\u52d5\u3057\u305f\u308aMySQL, Python\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092rpm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u30bd\u30fc\u30b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u3059\u308b\u3088\u3046\u306a\u624b\u7d9a\u304d\u3002\n\n\u3084\u3063\u305f\u3053\u3068\n\nFabric\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb@\u30db\u30b9\u30c8OS\n$ sudo pip install fabric\n\nFabric provisioner\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb@\u30db\u30b9\u30c8OS\n$ vagrant plugin install vagrant-fabric\n\nprovisioning\u7528Python\u30b9\u30af\u30ea\u30d7\u30c8\u4f5c\u6210\n\nprovision.py\n# -*- coding: utf-8 -*-\n\nfrom fabric.api import run, sudo, cd\nfrom fabric.contrib.files import sed, append, contains\n\ndef execute():\n    update_yum()\n    install()\n    change_network_config()\n    config_httpd()\n    link_www_dir()\n    epel()\n    remi()\n    mysql55()\n    python3()\n\ndef update_yum():\n    sudo('yum update -y')\n\ndef install():\n    sudo('yum -y install httpd')\n    sudo('yum -y install emacs')\n    sudo('yum -y install wget')\n\ndef change_network_config():\n    sudo('service iptables stop')\n    sudo('chkconfig iptables off')\n\ndef config_httpd():\n    sudo ('service httpd start')\n    sudo('chkconfig httpd on')\n\ndef link_www_dir():\n    sudo('ln -fs /vagrant /var/www/html')\n\ndef epel():\n    run('wget https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm')\n    sudo('/bin/rpm -Uvh epel-release-6-8.noarch.rpm')\n    sed('/etc/yum.repos.d/epel.repo', before='enabled=1', after='enabled=0', use_sudo=True)\n\ndef remi():\n    run('wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm')\n    sudo('rpm -Uvh remi-release-6.rpm')\n\ndef mysql55():\n    sudo('yum install -y --enablerepo=remi mysql-server')\n    if not contains('/etc/my.cnf', 'character_set_server=utf8'):\n        append('/etc/my.cnf', \n               '\\ncharacter_set_server=utf8\\ndefault-storage-engine=InnoDB\\ninnodb_file_per_table\\n[mysql]\\ndefault-character-set=utf8\\n[mysqldump]\\ndefault-character-set=utf',\n           use_sudo=True)\n    sudo('service mysqld start')\n    sudo('chkconfig mysqld on')\n\ndef python3():\n    run('wget https://www.python.org/ftp/python/3.4.0/Python-3.4.0.tgz')\n    run('tar xzvf Python-3.4.0.tgz')\n    with cd('Python-3.4.0'):\n        run('./configure --enable-shared --with-threads')\n        run('make')\n        sudo('make install')\n        sudo('cp -p libpython3.4m.so libpython3.4m.so.1.0 /usr/lib')\n        sudo('/sbin/ldconfig')\n        run('source ~/.bash_profile')\n        run('python3 --version')\n\n\n\u30d5\u30a1\u30a4\u30eb\u66f8\u304d\u63db\u3048\u306fput\u3067\u7f6e\u304d\u63db\u3048\u306a\u304f\u3066\u3082sed\u3068\u304bappend\u304c\u4f7f\u3048\u308b\u3088\u3046\n\nVagrantFile\u7de8\u96c6\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"centos64\"\n\n  config.vm.provision :fabric do |fabric|\n    fabric.fabfile_path = \"./provision.py\"\n    fabric.tasks = [\"execute\"]\n  end\nend\n\n\n\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u9069\u7528\u3057\u3064\u3064up\nvagrant up --provision\n\n## \u524d\u63d0\nVM\u306fCentOS6.4\u3092Vagrant\u3067\u69cb\u7bc9\u6e08\u307f\u3002\nHost\u306fOSX\u3002\n\n## \u3084\u308a\u305f\u3044\u3053\u3068\n\nhttps://gist.github.com/fuzzy31u/117a6e00f93423aeca10\n\n\u3053\u308c\u306fshell\u30b9\u30af\u30ea\u30d7\u30c8\u306eprovision\u3002\n\\# TODO manually!\n\u3068\u304b\u66f8\u3044\u3066\u3042\u308b\u306e\u3092\u81ea\u52d5\u5316\u3057\u305f\u304b\u3063\u305f\u3067\u3059\u3002\n\n\u5168\u4f53\u7684\u306b\u306fhttp\u30b5\u30fc\u30d0\u8d77\u52d5\u3057\u305f\u308aMySQL, Python\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092rpm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u30bd\u30fc\u30b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u3059\u308b\u3088\u3046\u306a\u624b\u7d9a\u304d\u3002\n\n## \u3084\u3063\u305f\u3053\u3068\n\n### Fabric\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb@\u30db\u30b9\u30c8OS\n` $ sudo pip install fabric `\n\n### Fabric provisioner\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb@\u30db\u30b9\u30c8OS\n` $ vagrant plugin install vagrant-fabric `\n\n### provisioning\u7528Python\u30b9\u30af\u30ea\u30d7\u30c8\u4f5c\u6210\n```python:provision.py\n# -*- coding: utf-8 -*-\n \nfrom fabric.api import run, sudo, cd\nfrom fabric.contrib.files import sed, append, contains\n \ndef execute():\n    update_yum()\n    install()\n    change_network_config()\n    config_httpd()\n    link_www_dir()\n    epel()\n    remi()\n    mysql55()\n    python3()\n \ndef update_yum():\n    sudo('yum update -y')\n \ndef install():\n    sudo('yum -y install httpd')\n    sudo('yum -y install emacs')\n    sudo('yum -y install wget')\n \ndef change_network_config():\n    sudo('service iptables stop')\n    sudo('chkconfig iptables off')\n \ndef config_httpd():\n    sudo ('service httpd start')\n    sudo('chkconfig httpd on')\n \ndef link_www_dir():\n    sudo('ln -fs /vagrant /var/www/html')\n    \ndef epel():\n    run('wget https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm')\n    sudo('/bin/rpm -Uvh epel-release-6-8.noarch.rpm')\n    sed('/etc/yum.repos.d/epel.repo', before='enabled=1', after='enabled=0', use_sudo=True)\n \ndef remi():\n    run('wget http://rpms.famillecollet.com/enterprise/remi-release-6.rpm')\n    sudo('rpm -Uvh remi-release-6.rpm')\n \ndef mysql55():\n    sudo('yum install -y --enablerepo=remi mysql-server')\n    if not contains('/etc/my.cnf', 'character_set_server=utf8'):\n        append('/etc/my.cnf', \n               '\\ncharacter_set_server=utf8\\ndefault-storage-engine=InnoDB\\ninnodb_file_per_table\\n[mysql]\\ndefault-character-set=utf8\\n[mysqldump]\\ndefault-character-set=utf',\n           use_sudo=True)\n    sudo('service mysqld start')\n    sudo('chkconfig mysqld on')\n \ndef python3():\n    run('wget https://www.python.org/ftp/python/3.4.0/Python-3.4.0.tgz')\n    run('tar xzvf Python-3.4.0.tgz')\n    with cd('Python-3.4.0'):\n        run('./configure --enable-shared --with-threads')\n        run('make')\n        sudo('make install')\n        sudo('cp -p libpython3.4m.so libpython3.4m.so.1.0 /usr/lib')\n        sudo('/sbin/ldconfig')\n        run('source ~/.bash_profile')\n        run('python3 --version')\n```\n\u30d5\u30a1\u30a4\u30eb\u66f8\u304d\u63db\u3048\u306fput\u3067\u7f6e\u304d\u63db\u3048\u306a\u304f\u3066\u3082sed\u3068\u304bappend\u304c\u4f7f\u3048\u308b\u3088\u3046\n\n### VagrantFile\u7de8\u96c6\n```\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n \nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"centos64\"\n \n  config.vm.provision :fabric do |fabric|\n    fabric.fabfile_path = \"./provision.py\"\n    fabric.tasks = [\"execute\"]\n  end\nend\n```\n\n### \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u9069\u7528\u3057\u3064\u3064up\nvagrant up --provision\n"}