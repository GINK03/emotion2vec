{"context": " More than 1 year has passed since last update.\n\n\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\n\nOpenLDAP\u306bsudo\u7528\u30b9\u30ad\u30fc\u30de\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\ncp -a /usr/share/doc/sudo-1.8.6p3/schema.OpenLDAP /etc/openldap/schema/sudo.schema\n\ninclude /etc/openldap/schema/sudo.schema \u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8ffd\u8a18\u3059\u308b\n\n/etc/openldap/slapd.conf\ninclude /etc/openldap/schema/corba.schema\ninclude /etc/openldap/schema/core.schema\ninclude /etc/openldap/schema/cosine.schema\ninclude /etc/openldap/schema/duaconf.schema\ninclude /etc/openldap/schema/dyngroup.schema\ninclude /etc/openldap/schema/inetorgperson.schema\ninclude /etc/openldap/schema/java.schema\ninclude /etc/openldap/schema/misc.schema\ninclude /etc/openldap/schema/nis.schema\ninclude /etc/openldap/schema/openldap.schema\ninclude /etc/openldap/schema/ppolicy.schema\ninclude /etc/openldap/schema/collective.schema\ninclude /etc/openldap/schema/openssh.schema\ninclude /etc/openldap/schema/sudo.schema\n\n# \u63a5\u7d9a\u30d7\u30ed\u30c8\u30b3\u30eb\nallow bind_v2\n\n# \u7ba1\u7406\u30d5\u30a1\u30a4\u30eb\npidfile     /var/run/openldap/slapd.pid\nargsfile    /var/run/openldap/slapd.args\n\n# TLS\u8a2d\u5b9a\n#TLSCACertificatePath  /etc/openldap/ssl/cacert.pem\n#TLSCertificateFile    /etc/openldap/ssl/server.crt\n#TLSCertificateKeyFile /etc/openldap/ssl/server.key\n\n# userPassword\u306b\u95a2\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\naccess to attrs=userPassword\n    by self write\n    by dn=\"cn=Manager,dc=example,dc=com\" write\n    by anonymous auth\n    by * none\n\n# \u305d\u306e\u4ed6\u306e\u5c5e\u6027\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\naccess to *\n    by self write\n    by dn=\"cn=Manager,dc=example,dc=com\" write\n    by * read\n\n# monitor\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\ndatabase monitor\naccess to *\n    by dn.exact=\"cn=Manager,dc=example,dc=com\" read\n    by * none\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\ndatabase    bdb\nsuffix      \"dc=example,dc=com\"\ncheckpoint  1024 15\nrootdn      \"cn=Manager,dc=example,dc=com\"\nrootpw      {SSHA}fCkF7qPmO1cnQsPun1fixcrhCNP+Kerd\ndirectory   /var/lib/ldap\n\n# index\u306e\u8a2d\u5b9a\nindex objectClass                       eq,pres\nindex ou,cn,mail,surname,givenname      eq,pres,sub\nindex uidNumber,gidNumber,loginShell    eq,pres\nindex uid,memberUid                     eq,pres,sub\nindex nisMapName,nisMapEntry            eq,pres,sub\n\n\n\nOpenLDAP \u8a2d\u5b9a\u53cd\u6620\n/etc/init.d/slapd stop\nrm -rf /etc/openldap/slapd.d/*\nsudo -u ldap slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d\n/etc/init.d/slapd start\n\n\nsudo\u30b0\u30eb\u30fc\u30d7\u767b\u9332\u7528LDIF\u4f5c\u6210\n\n/etc/openldap/ldif/sudo.ldif\n# sudo\u30b0\u30eb\u30fc\u30d7\ndn: ou=SUDOers,dc=example,dc=com\nobjectClass: organizationalUnit\nou: SUDOers\n\n# sudo defaults\ndn: cn=defaults,ou=SUDOers,dc=example,dc=com\nobjectclass: top\nobjectclass: sudoRole\ncn: defaults\nsudoOption: !root_sudo\nsudoOption: !lecture\nsudoOption: log_host\nsudoOption: log_year\nsudoOption: syslog=local3\nsudoOption: logfile=/var/log/sudo.log\nsudoOption: ignore_dot\nsudoOption: ignore_local_sudoers\nsudoOption: timestamp_timeout=0\n\n# %wheel\ndn: cn=%wheel,ou=SUDOers,dc=example,dc=com\nobjectClass: top\nobjectClass: sudoRole\ncn: %wheel\nsudoUser: %wheel\nsudoHost: ALL\nsudoCommand: ALL\n\n# wheel\u30b0\u30eb\u30fc\u30d7\ndn: cn=wheel,ou=Group,dc=example,dc=com\nobjectClass: posixGroup\nobjectClass: top\ngidNumber: 9999\ncn: wheel\nmemberUid: takahiko.takeda\nmemberUid: shinya.yokoyama\nmemberUid: osamu.inoue\n\n\n\nsudo\u30b0\u30eb\u30fc\u30d7\u3092OpenLDAP\u306b\u767b\u9332\nldapadd -x -D \"cn=Manager,dc=example.com\" -W -f /etc/openldap/ldif/sudo.ldif\n\n\n\u30b5\u30fc\u30d0\u30fc\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\n\nsudo\u8a2d\u5b9a\n\n/etc/sudo-ldap.conf\nuri ldap://192.168.0.10/\nsudoers_base ou=SUDOers,dc=example,dc=com\nbind_timelimit 120\nhost 192.168.0.10\nbase dc=example,dc=com\n\n\n\nPAM\u8a2d\u5b9a\nauth            required        pam_wheel.so use_uid \u306e\u30b3\u30e1\u30f3\u30c8\u3092\u6d88\u3057\u3001\u6709\u52b9\u5316\u3059\u308b\n\n/etc/pam.d/su\n#%PAM-1.0\nauth            sufficient      pam_rootok.so\n# Uncomment the following line to implicitly trust users in the \"wheel\" group.\n#auth           sufficient      pam_wheel.so trust use_uid\n# Uncomment the following line to require a user to be in the \"wheel\" group.\nauth            required        pam_wheel.so use_uid\nauth            include         system-auth\naccount         sufficient      pam_succeed_if.so uid = 0 use_uid quiet\naccount         include         system-auth\npassword        include         system-auth\nsession         include         system-auth\nsession         optional        pam_xauth.so\n\n\n\nnsswitch\u8a2d\u5b9a\nsudo\u4f7f\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u8aad\u307f\u8fbc\u307f\u9806\u3092ldap files\u306e\u9806\u306b\u3059\u308b\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3059\u308b\n\n/etc/nsswitch.conf\nsudoers: ldap files\n\n\n\n\u518d\u8d77\u52d5\n\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3059\u308b\u305f\u3081\u3001\u518d\u8d77\u52d5\u3059\u308b\nreboot\n\n\n\u78ba\u8a8d\nroot\u306e\u5168\u6a29\u9650\u3092\u6301\u3064\u30e6\u30fc\u30b6\u30fc\u3068root\u6a29\u9650\u3092\u6301\u305f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3001\u305d\u308c\u305e\u308c\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u8a66\u3057\u3066\u307f\u308b\n## \u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\n\n### OpenLDAP\u306bsudo\u7528\u30b9\u30ad\u30fc\u30de\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\n```shell-session\ncp -a /usr/share/doc/sudo-1.8.6p3/schema.OpenLDAP /etc/openldap/schema/sudo.schema\n```\n\n`include /etc/openldap/schema/sudo.schema` \u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8ffd\u8a18\u3059\u308b\n\n```text:/etc/openldap/slapd.conf\ninclude /etc/openldap/schema/corba.schema\ninclude /etc/openldap/schema/core.schema\ninclude /etc/openldap/schema/cosine.schema\ninclude /etc/openldap/schema/duaconf.schema\ninclude /etc/openldap/schema/dyngroup.schema\ninclude /etc/openldap/schema/inetorgperson.schema\ninclude /etc/openldap/schema/java.schema\ninclude /etc/openldap/schema/misc.schema\ninclude /etc/openldap/schema/nis.schema\ninclude /etc/openldap/schema/openldap.schema\ninclude /etc/openldap/schema/ppolicy.schema\ninclude /etc/openldap/schema/collective.schema\ninclude /etc/openldap/schema/openssh.schema\ninclude /etc/openldap/schema/sudo.schema\n\n# \u63a5\u7d9a\u30d7\u30ed\u30c8\u30b3\u30eb\nallow bind_v2\n\n# \u7ba1\u7406\u30d5\u30a1\u30a4\u30eb\npidfile     /var/run/openldap/slapd.pid\nargsfile    /var/run/openldap/slapd.args\n\n# TLS\u8a2d\u5b9a\n#TLSCACertificatePath  /etc/openldap/ssl/cacert.pem\n#TLSCertificateFile    /etc/openldap/ssl/server.crt\n#TLSCertificateKeyFile /etc/openldap/ssl/server.key\n\n# userPassword\u306b\u95a2\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\naccess to attrs=userPassword\n    by self write\n    by dn=\"cn=Manager,dc=example,dc=com\" write\n    by anonymous auth\n    by * none\n\n# \u305d\u306e\u4ed6\u306e\u5c5e\u6027\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\naccess to *\n    by self write\n    by dn=\"cn=Manager,dc=example,dc=com\" write\n    by * read\n\n# monitor\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\ndatabase monitor\naccess to *\n    by dn.exact=\"cn=Manager,dc=example,dc=com\" read\n    by * none\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\ndatabase    bdb\nsuffix      \"dc=example,dc=com\"\ncheckpoint  1024 15\nrootdn      \"cn=Manager,dc=example,dc=com\"\nrootpw      {SSHA}fCkF7qPmO1cnQsPun1fixcrhCNP+Kerd\ndirectory   /var/lib/ldap\n\n# index\u306e\u8a2d\u5b9a\nindex objectClass                       eq,pres\nindex ou,cn,mail,surname,givenname      eq,pres,sub\nindex uidNumber,gidNumber,loginShell    eq,pres\nindex uid,memberUid                     eq,pres,sub\nindex nisMapName,nisMapEntry            eq,pres,sub\n```\n\n### OpenLDAP \u8a2d\u5b9a\u53cd\u6620\n```shell-session\n/etc/init.d/slapd stop\nrm -rf /etc/openldap/slapd.d/*\nsudo -u ldap slaptest -f /etc/openldap/slapd.conf -F /etc/openldap/slapd.d\n/etc/init.d/slapd start\n```\n\n### sudo\u30b0\u30eb\u30fc\u30d7\u767b\u9332\u7528LDIF\u4f5c\u6210\n```text:/etc/openldap/ldif/sudo.ldif\n# sudo\u30b0\u30eb\u30fc\u30d7\ndn: ou=SUDOers,dc=example,dc=com\nobjectClass: organizationalUnit\nou: SUDOers\n\n# sudo defaults\ndn: cn=defaults,ou=SUDOers,dc=example,dc=com\nobjectclass: top\nobjectclass: sudoRole\ncn: defaults\nsudoOption: !root_sudo\nsudoOption: !lecture\nsudoOption: log_host\nsudoOption: log_year\nsudoOption: syslog=local3\nsudoOption: logfile=/var/log/sudo.log\nsudoOption: ignore_dot\nsudoOption: ignore_local_sudoers\nsudoOption: timestamp_timeout=0\n\n# %wheel\ndn: cn=%wheel,ou=SUDOers,dc=example,dc=com\nobjectClass: top\nobjectClass: sudoRole\ncn: %wheel\nsudoUser: %wheel\nsudoHost: ALL\nsudoCommand: ALL\n\n# wheel\u30b0\u30eb\u30fc\u30d7\ndn: cn=wheel,ou=Group,dc=example,dc=com\nobjectClass: posixGroup\nobjectClass: top\ngidNumber: 9999\ncn: wheel\nmemberUid: takahiko.takeda\nmemberUid: shinya.yokoyama\nmemberUid: osamu.inoue\n```\n\n### sudo\u30b0\u30eb\u30fc\u30d7\u3092OpenLDAP\u306b\u767b\u9332\n```shell-session\nldapadd -x -D \"cn=Manager,dc=example.com\" -W -f /etc/openldap/ldif/sudo.ldif\n```\n\n## \u30b5\u30fc\u30d0\u30fc\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\n\n### sudo\u8a2d\u5b9a\n```text:/etc/sudo-ldap.conf\nuri ldap://192.168.0.10/\nsudoers_base ou=SUDOers,dc=example,dc=com\nbind_timelimit 120\nhost 192.168.0.10\nbase dc=example,dc=com\n```\n\n### PAM\u8a2d\u5b9a\n`auth            required        pam_wheel.so use_uid` \u306e\u30b3\u30e1\u30f3\u30c8\u3092\u6d88\u3057\u3001\u6709\u52b9\u5316\u3059\u308b\n\n```text:/etc/pam.d/su\n#%PAM-1.0\nauth            sufficient      pam_rootok.so\n# Uncomment the following line to implicitly trust users in the \"wheel\" group.\n#auth           sufficient      pam_wheel.so trust use_uid\n# Uncomment the following line to require a user to be in the \"wheel\" group.\nauth            required        pam_wheel.so use_uid\nauth            include         system-auth\naccount         sufficient      pam_succeed_if.so uid = 0 use_uid quiet\naccount         include         system-auth\npassword        include         system-auth\nsession         include         system-auth\nsession         optional        pam_xauth.so\n```\n\n### nsswitch\u8a2d\u5b9a\nsudo\u4f7f\u7528\u30e6\u30fc\u30b6\u30fc\u306e\u8aad\u307f\u8fbc\u307f\u9806\u3092`ldap` `files`\u306e\u9806\u306b\u3059\u308b\n\u4e0b\u8a18\u3092\u8ffd\u8a18\u3059\u308b\n\n```text:/etc/nsswitch.conf\nsudoers: ldap files\n```\n\n### \u518d\u8d77\u52d5\n\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3059\u308b\u305f\u3081\u3001\u518d\u8d77\u52d5\u3059\u308b\n\n```shell-session\nreboot\n```\n\n### \u78ba\u8a8d\nroot\u306e\u5168\u6a29\u9650\u3092\u6301\u3064\u30e6\u30fc\u30b6\u30fc\u3068root\u6a29\u9650\u3092\u6301\u305f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3001\u305d\u308c\u305e\u308c\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u8a66\u3057\u3066\u307f\u308b\n", "tags": ["CentOS6.5", "openldap2.4.23-34", "openssl1.0.1e-16", "OpenSSH5.3p1-94"]}