{"context": "CoreData\u3067SQL\u767a\u884c\u56de\u6570\u3092\u6e1b\u3089\u3057\u305f\u3044\u306a\u3068\u601d\u3044\u3001relationshipKeyPathsForPrefetching \u3068\u3044\u3046\u3063\u307d\u3044\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b58\u5728\u306b\u6c17\u3065\u304f\u3082\u3001SQL\u767a\u884c\u56de\u6570\u306e\u524a\u6e1b\u306b\u306f\u5f79\u7acb\u305f\u306a\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\u3060\u3051\u6b8b\u3057\u3066\u5e30\u308a\u307e\u3059\u3002\n\n\u6319\u52d5\u3092\u89b3\u5bdf\nBook \u3068 Author \u30e2\u30c7\u30eb\u3092\u4f8b\u306b\u3001relationshipKeyPathsForPrefetching \u306e\u6709\u7121\u306b\u3088\u308b\u6319\u52d5\u3092\u89b3\u5bdf\u3059\u308b\u3002\n\nswift|ViewController.swift\nimport UIKit\nimport CoreData\n\nclass ViewController: UIViewController {\n\n    let container = (UIApplication.shared.delegate as! AppDelegate).persistentContainer\n\n    @IBAction func selectEntities(_ sender: AnyObject) {\n        container.performBackgroundTask { (context) in\n            print(\"select all\")\n            let req = NSFetchRequest<Book>(entityName: \"Book\");\n\n            //XXX\n            req.relationshipKeyPathsForPrefetching = [\"author\"]\n\n            let books = try! context.fetch(req)\n            books.forEach({ (book) in\n                print(book)\n                print(book.author?.name)\n            })\n        }\n    }\n\n    @IBAction func createEntieies() {\n        container.performBackgroundTask { (context) in\n            let author = Author(context: context)\n            author.name = \"kentaro\"\n            let book = Book(context: context)\n            book.title = \"test title\"\n            book.author = author\n            try! context.save()\n            print(\"created\")\n        }\n    }\n\n    @IBAction func clearEntities() {\n        container.performBackgroundTask { (context) in\n            let books = try! context.fetch(Book.fetchRequest()) as [Book]\n            books.forEach({ (book) in\n                context.delete(book)\n            })\n            let authors = try! context.fetch(Author.fetchRequest()) as [Author]\n            authors.forEach({ (author) in\n                context.delete(author)\n            })\n            try! context.save()\n            print(\"cleared\")\n        }\n    }\n}\n\n\n\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u306a\u3057\u306e\u5834\u5408\u306f\u3001Book\u3092\u53d6\u5f97\u3059\u308b\u6bb5\u968e\u3067\u306fZBOOK\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308bselect\u304c\u8d70\u308b\u306e\u307f\u3067\u3001book.author.name \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u77ac\u9593\u306bZAUTHOR\u30c6\u30fc\u30d6\u30eb\u306bselect\u304c\u8d70\u308b\u3002\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u306a\u3057\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZTITLE, t0.ZAUTHOR FROM ZBOOK t0 \nCoreData: annotation: sql connection fetch time: 0.0002s\nCoreData: annotation: total fetch execution time: 0.0006s for 1 rows.\n\n<coredata_sample.Book: 0x6180000a86a0> (entity: Book; id: 0xd000000000100000 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Book/p4> ; data: <fault>)\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZNAME, t0.ZBOOK FROM ZAUTHOR t0 WHERE  t0.Z_PK = ? \nCoreData: annotation: sql connection fetch time: 0.0001s\nCoreData: annotation: total fetch execution time: 0.0002s for 1 rows.\nCoreData: annotation: fault fulfilled from database for : 0xd000000000100002 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Author/p4>\n\nOptional(\"kentaro\")\n\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u3042\u308a\u306e\u5834\u5408\u306f\u3001Book\u3092\u53d6\u5f97\u3059\u308b\u6bb5\u968e\u3067\u3001ZBOOK\u30c6\u30fc\u30d6\u30eb\u3068ZAUTHOR\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066select\u304c\u4e00\u6c17\u306b\u8d70\u308a\u3001book.author.name \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b\u306f\u30af\u30a8\u30ea\u306f\u767a\u884c\u3055\u308c\u306a\u3044\u3002\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u3042\u308a\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZTITLE, t0.ZAUTHOR FROM ZBOOK t0 \nCoreData: annotation: sql connection fetch time: 0.0001s\nCoreData: annotation: Bound intarray _Z_intarray0\nCoreData: annotation: Bound intarray values.\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZNAME, t0.ZBOOK FROM ZAUTHOR t0 WHERE  t0.ZBOOK IN (SELECT * FROM _Z_intarray0)  \nCoreData: annotation: sql connection fetch time: 0.0004s\nCoreData: annotation: total fetch execution time: 0.0005s for 1 rows.\nCoreData: annotation: Prefetching with key 'author'.  Got 1 rows.\nCoreData: annotation: total fetch execution time: 0.0018s for 1 rows.\n\n<coredata_sample.Book: 0x6080000b7640> (entity: Book; id: 0xd000000000100000 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Book/p4> ; data: <fault>)\nOptional(\"kentaro\")\n\n\u3066\u3063\u304d\u308aZBOOK\u3068ZAUTHOR\u3092join\u3057\u305f\u30af\u30a8\u30ea\u3092\u4e00\u767a\u3060\u3051\u767a\u884c\u3057\u3066\u304f\u308c\u308b\u306e\u304b\u306a\u30fc\u3068\u601d\u3063\u305f\u3051\u3069\u3001\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u304b\u3063\u305f\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30af\u30a8\u30ea\u56de\u6570\u306e\u524a\u6e1b\u306b\u306f\u306a\u3089\u306a\u3044\u3002\n\u30af\u30a8\u30ea\u56de\u6570\u306e\u524a\u6e1b\u306fIN\u53e5\u3067\u9811\u5f35\u308b\u306e\u304c\u3044\u3044\u304b\u306a\u30fc\u3002\nRealm\u3068\u304b\u3060\u3068\u3069\u3046\u306a\u3093\u3067\u3057\u3087\u3046\u3002\n\n\u5225\u4ef6\n\u4e45\u3057\u3076\u308a\u306b\u751f\u306eCoreData\u89e6\u3063\u305f\u3051\u3069\n - NSPersistentContainer\u304c\u5c0e\u5165\u3055\u308c\u305f(iOS10\u304b\u3089)\n - NSFetchRequest\u304cgenerics\u306b\u5bfe\u5fdc\u3057\u3066\u308b\n\u3042\u305f\u308a\u306e\u5909\u66f4\u304c\u5165\u3063\u3066\u3066\u3001MagicalRecord\u3068\u304b\u305d\u308d\u305d\u308d\u5352\u696d\u3057\u3066\u3082\u3044\u3044\u304b\u306a\u30fc\u3068\u601d\u3063\u305f\u3002\nCoreData\u3067SQL\u767a\u884c\u56de\u6570\u3092\u6e1b\u3089\u3057\u305f\u3044\u306a\u3068\u601d\u3044\u3001relationshipKeyPathsForPrefetching \u3068\u3044\u3046\u3063\u307d\u3044\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b58\u5728\u306b\u6c17\u3065\u304f\u3082\u3001SQL\u767a\u884c\u56de\u6570\u306e\u524a\u6e1b\u306b\u306f\u5f79\u7acb\u305f\u306a\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\u3060\u3051\u6b8b\u3057\u3066\u5e30\u308a\u307e\u3059\u3002\n\n# \u6319\u52d5\u3092\u89b3\u5bdf\n\nBook \u3068 Author \u30e2\u30c7\u30eb\u3092\u4f8b\u306b\u3001relationshipKeyPathsForPrefetching \u306e\u6709\u7121\u306b\u3088\u308b\u6319\u52d5\u3092\u89b3\u5bdf\u3059\u308b\u3002\n\n```swift|ViewController.swift\nimport UIKit\nimport CoreData\n\nclass ViewController: UIViewController {\n\n    let container = (UIApplication.shared.delegate as! AppDelegate).persistentContainer\n    \n    @IBAction func selectEntities(_ sender: AnyObject) {\n        container.performBackgroundTask { (context) in\n            print(\"select all\")\n            let req = NSFetchRequest<Book>(entityName: \"Book\");\n\n            //XXX\n            req.relationshipKeyPathsForPrefetching = [\"author\"]\n\n            let books = try! context.fetch(req)\n            books.forEach({ (book) in\n                print(book)\n                print(book.author?.name)\n            })\n        }\n    }\n    \n    @IBAction func createEntieies() {\n        container.performBackgroundTask { (context) in\n            let author = Author(context: context)\n            author.name = \"kentaro\"\n            let book = Book(context: context)\n            book.title = \"test title\"\n            book.author = author\n            try! context.save()\n            print(\"created\")\n        }\n    }\n    \n    @IBAction func clearEntities() {\n        container.performBackgroundTask { (context) in\n            let books = try! context.fetch(Book.fetchRequest()) as [Book]\n            books.forEach({ (book) in\n                context.delete(book)\n            })\n            let authors = try! context.fetch(Author.fetchRequest()) as [Author]\n            authors.forEach({ (author) in\n                context.delete(author)\n            })\n            try! context.save()\n            print(\"cleared\")\n        }\n    }\n}\n\n```\n\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u306a\u3057\u306e\u5834\u5408\u306f\u3001Book\u3092\u53d6\u5f97\u3059\u308b\u6bb5\u968e\u3067\u306fZBOOK\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308bselect\u304c\u8d70\u308b\u306e\u307f\u3067\u3001book.author.name \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u77ac\u9593\u306bZAUTHOR\u30c6\u30fc\u30d6\u30eb\u306bselect\u304c\u8d70\u308b\u3002\n\n```\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u306a\u3057\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZTITLE, t0.ZAUTHOR FROM ZBOOK t0 \nCoreData: annotation: sql connection fetch time: 0.0002s\nCoreData: annotation: total fetch execution time: 0.0006s for 1 rows.\n\n<coredata_sample.Book: 0x6180000a86a0> (entity: Book; id: 0xd000000000100000 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Book/p4> ; data: <fault>)\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZNAME, t0.ZBOOK FROM ZAUTHOR t0 WHERE  t0.Z_PK = ? \nCoreData: annotation: sql connection fetch time: 0.0001s\nCoreData: annotation: total fetch execution time: 0.0002s for 1 rows.\nCoreData: annotation: fault fulfilled from database for : 0xd000000000100002 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Author/p4>\n\nOptional(\"kentaro\")\n```\n\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u3042\u308a\u306e\u5834\u5408\u306f\u3001Book\u3092\u53d6\u5f97\u3059\u308b\u6bb5\u968e\u3067\u3001ZBOOK\u30c6\u30fc\u30d6\u30eb\u3068ZAUTHOR\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066select\u304c\u4e00\u6c17\u306b\u8d70\u308a\u3001book.author.name \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b\u306f\u30af\u30a8\u30ea\u306f\u767a\u884c\u3055\u308c\u306a\u3044\u3002\n\n```\n\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u3042\u308a\n\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZTITLE, t0.ZAUTHOR FROM ZBOOK t0 \nCoreData: annotation: sql connection fetch time: 0.0001s\nCoreData: annotation: Bound intarray _Z_intarray0\nCoreData: annotation: Bound intarray values.\nCoreData: sql: SELECT 0, t0.Z_PK, t0.Z_OPT, t0.ZNAME, t0.ZBOOK FROM ZAUTHOR t0 WHERE  t0.ZBOOK IN (SELECT * FROM _Z_intarray0)  \nCoreData: annotation: sql connection fetch time: 0.0004s\nCoreData: annotation: total fetch execution time: 0.0005s for 1 rows.\nCoreData: annotation: Prefetching with key 'author'.  Got 1 rows.\nCoreData: annotation: total fetch execution time: 0.0018s for 1 rows.\n\n<coredata_sample.Book: 0x6080000b7640> (entity: Book; id: 0xd000000000100000 <x-coredata://3D6FA5D4-7E41-414F-AF67-B30C5480B9BC/Book/p4> ; data: <fault>)\nOptional(\"kentaro\")\n```\n\n\u3066\u3063\u304d\u308aZBOOK\u3068ZAUTHOR\u3092join\u3057\u305f\u30af\u30a8\u30ea\u3092\u4e00\u767a\u3060\u3051\u767a\u884c\u3057\u3066\u304f\u308c\u308b\u306e\u304b\u306a\u30fc\u3068\u601d\u3063\u305f\u3051\u3069\u3001\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u304b\u3063\u305f\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30af\u30a8\u30ea\u56de\u6570\u306e\u524a\u6e1b\u306b\u306f\u306a\u3089\u306a\u3044\u3002\n\n\u30af\u30a8\u30ea\u56de\u6570\u306e\u524a\u6e1b\u306fIN\u53e5\u3067\u9811\u5f35\u308b\u306e\u304c\u3044\u3044\u304b\u306a\u30fc\u3002\n\nRealm\u3068\u304b\u3060\u3068\u3069\u3046\u306a\u3093\u3067\u3057\u3087\u3046\u3002\n\n# \u5225\u4ef6\n\u4e45\u3057\u3076\u308a\u306b\u751f\u306eCoreData\u89e6\u3063\u305f\u3051\u3069\n - `NSPersistentContainer`\u304c\u5c0e\u5165\u3055\u308c\u305f(iOS10\u304b\u3089)\n - `NSFetchRequest`\u304cgenerics\u306b\u5bfe\u5fdc\u3057\u3066\u308b\n\n\u3042\u305f\u308a\u306e\u5909\u66f4\u304c\u5165\u3063\u3066\u3066\u3001`MagicalRecord`\u3068\u304b\u305d\u308d\u305d\u308d\u5352\u696d\u3057\u3066\u3082\u3044\u3044\u304b\u306a\u30fc\u3068\u601d\u3063\u305f\u3002\n", "tags": ["iOS", "CoreData"]}