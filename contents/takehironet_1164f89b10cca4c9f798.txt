{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\n\n\u6211\u304c\u5bb6\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u306e\u304a\u8a71\u3067\u3059\u3002\u696d\u52d9\u7528\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\nFreeBSD 10\u3067\u69cb\u7bc9\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u79c1\u306fFreeBSD\u306b\u4e0d\u6163\u308c\u3067\u3059\u3002\n\u30eb\u30fc\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u305d\u306e\u3082\u306e\u3082ZFS\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30d7\u30fc\u30eb\u306fRAID-Z2\u3067\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n\nZFS\u306e\u69cb\u6210\u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\nzpool scrub zroot \u3092\u5b9f\u884c\u3057\u305f\u3089\u3072\u3069\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u3001repaired\u306a\u3093\u3066\u8868\u793a\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u30ac\u30fc\u30f3\ndmesg \u3057\u3066\u307f\u305f\u7d50\u679c\u3001ATA\u306eDRDY ERR\u304c\u5927\u91cf\u306b\u51fa\u3066\u3044\u308b\u72b6\u6cc1\u3002(\uff89\u2200`)\uff71\uff81\uff6c\uff70\n...snip...\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Retrying command\n(ada0:ahcich2:0:0:0): READ_FPDMA_QUEUED. ACB: 60 10 38 06 40 40 00 00 00 00 00 00\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Retrying command\n(ada0:ahcich2:0:0:0): READ_FPDMA_QUEUED. ACB: 60 10 38 06 40 40 00 00 00 00 00 00\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Error 5, Retries exhausted\n\n\u4ed6\u306e\u30c7\u30a3\u30b9\u30af\u306f\u5927\u4e08\u592b\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001ada0\u6545\u969c\u3068\u3057\u3066\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u4e8b\u524d\u8abf\u67fb\n\u554f\u984c\u306e\u3042\u3063\u305fada0\u306e\u60c5\u5831\u3092\u8abf\u3079\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30b7\u30ea\u30a2\u30eb\u30ca\u30f3\u30d0\u30fc\nfreebsd# camcontrol identify ada0\npass0: <WDC WD20EZRX-00D8PB0 80.00A80> ATA-9 SATA 3.x device\npass0: 300.000MB/s transfers (SATA 2.x, UDMA6, PIO 8192bytes)\n\nprotocol              ATA/ATAPI-9 SATA 3.x\ndevice model          WDC WD20EZRX-00D8PB0\nfirmware revision     80.00A80\nserial number         WD-WCC4M2770577\nWWN                   50014ee2b4ca1811\ncylinders             16383\nheads                 16\nsectors/track         63\nsector size           logical 512, physical 4096, offset 0\nLBA supported         268435455 sectors\nLBA48 supported       3907029168 sectors\nPIO supported         PIO4\nDMA supported         WDMA2 UDMA6\nmedia RPM             5400\n...snip...\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u60c5\u5831\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  freebsd-boot  (512K)\n        1064     4194304     2  freebsd-swap  (2.0G)\n     4195368  3902833760     3  freebsd-zfs  (1.8T)\n  3907029128           7        - free -  (3.5K)\n\n\u5143\u3005\u306e\u30c7\u30a3\u30b9\u30af\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u69cb\u6210\u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u304c\u3001\u4ed6\u306e3\u53f0\u3082\u540c\u3058\u69cb\u6210\u306a\u306e\u3067\u7279\u306b\u3053\u3060\u308f\u308a\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u6b21\u306e\u4f5c\u696d\u306fZFS\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e rawuuid \u3092\u8abf\u67fb\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3059\u3002ada0p3\u304cZFS\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306a\u306e\u306f\u5148\u306e\u30b3\u30de\u30f3\u30c9\u3067\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3053\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nfreebsd# gpart list ada0\nGeom name: ada0\nmodified: false\nstate: OK\nfwheads: 16\nfwsectors: 63\nlast: 3907029134\nfirst: 34\nentries: 128\nscheme: GPT\nProviders:\n...snip...\n3. Name: ada0p3\n   Mediasize: 1998250885120 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r1w1e2\n   rawuuid: edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n   rawtype: 516e7cba-6ecf-11d6-8ff8-00022d09712b\n   label: zfs0\n   length: 1998250885120\n   offset: 2148028416\n   type: freebsd-zfs\n   index: 3\n   end: 3907029127\n   start: 4195368\nConsumers:\n1. Name: ada0\n   Mediasize: 2000398934016 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r2w2e5\n\nedea0237-d1fa-11e3-9ad5-bc5ff4fc4f55 \u3067\u3059\u306d\u3002\n\nZFS\u306e\u69cb\u6210\u30c7\u30a3\u30b9\u30af\u60c5\u5831\n\u5197\u9577\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4e00\u5fdc\u898b\u3066\u304a\u304d\u307e\u3059\u3002\nfreebsd# zdb\nzroot:\n    version: 5000\n    name: 'zroot'\n    state: 0\n    txg: 35377\n    pool_guid: 8898421204376808293\n    hostid: 4266313884\n    hostname: 'freebsd'\n    vdev_children: 1\n    vdev_tree:\n        type: 'root'\n        id: 0\n        guid: 8898421204376808293\n        children[0]:\n            type: 'raidz'\n            id: 0\n            guid: 3251282675639060840\n            nparity: 2\n            metaslab_array: 33\n            metaslab_shift: 35\n            ashift: 12\n            asize: 7992984469504\n            is_log: 0\n            create_txg: 4\n            children[0]:\n                type: 'disk'\n                id: 0\n                guid: 12425838491564392765\n                path: '/dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 123\n                create_txg: 4\n            children[1]:\n                type: 'disk'\n                id: 1\n                guid: 11970705104448422009\n                path: '/dev/gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 122\n                create_txg: 4\n            children[2]:\n                type: 'disk'\n                id: 2\n                guid: 3324830681772726295\n                path: '/dev/gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 121\n                create_txg: 4\n            children[3]:\n                type: 'disk'\n                id: 3\n                guid: 11650913671101100370\n                path: '/dev/gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 229\n                create_txg: 4\n    features_for_read:\n\n\nzpool\u306e\u72b6\u614b\n\u30d7\u30fc\u30eb\u3068\u3057\u3066\u306f\u7570\u5e38\u3042\u308a\u307e\u305b\u3093\u30022\u56de\u76ee\u306escrub\u306b\u6050\u308d\u3057\u304f\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u306e\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u307e\u3057\u305f\u3002\n\u76ee\u7684\u306e\u30c7\u30a3\u30b9\u30af\u306f\u4e00\u756a\u4e0a\u3067\u3059\u306d\u3002\nfreebsd# zpool status\n  pool: zroot\n state: ONLINE\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           ONLINE       0     0     0\n          raidz2-0                                      ONLINE       0     0     0\n            gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n\n\n\u30e1\u30e2\u3059\u308b\n\u60c5\u5831\u3092\u6574\u7406\u3057\u3066\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u554f\u984c\u304c\u3042\u308b\u30c7\u30a3\u30b9\u30af\u306f ada0\n\nada0 \u306e\u30e2\u30c7\u30eb\u30ca\u30f3\u30d0\u30fc\u306f WD20EZRX (Western Digital\u793e\u306eWD Green\u30b7\u30ea\u30fc\u30ba 2TB \u30ad\u30e3\u30c3\u30b7\u30e564MB)\nada0 \u306e\u30b7\u30ea\u30a2\u30eb\u30ca\u30f3\u30d0\u30fc\u306f WD-WCC4M2770577\n\nZFS\u306e\u30d7\u30fc\u30eb zroot \u3067\u306f gpart list ada0 \u306e\u7d50\u679c\u3088\u308a gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55 \u304c\u8a72\u5f53\n\n\n\u30c7\u30a3\u30b9\u30af\u4ea4\u63db\n\n\u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30ec\u30a4\u304b\u3089\u5916\u3059\n\u5f53\u8a72\u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30ec\u30a4\u304b\u3089\u5916\u3057\u3066\u304a\u304d\u307e\u3059(OFFLINE\u306b\u3059\u308b)\u3002\nfreebsd# zpool offline zroot gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices has been taken offline by the administrator.\n        Sufficient replicas exist for the pool to continue functioning in a\n        degraded state.\naction: Online the device using 'zpool online' or replace the device with\n        'zpool replace'.\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           DEGRADED     0     0     0\n          raidz2-0                                      DEGRADED     0     0     0\n            12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n\n\n\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u30c7\u30a3\u30b9\u30af\u4ea4\u63db\n\u9593\u9055\u3048\u3066\u30c7\u30a3\u30b9\u30af\u3092\u53d6\u308a\u5916\u3057\u3066\u3057\u307e\u3046\u4e8b\u6545\u3092\u907f\u3051\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u4e00\u65e6\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\u3057\u307e\u3059\u3002\n\u4eca\u56de\u7528\u610f\u3057\u305f\u30c7\u30a3\u30b9\u30af\u306f WD20EFRX (Western Digital\u793e WD Red\u30b7\u30ea\u30fc\u30ba)\u3002\u30e8\u30c9\u30d0\u30b7\u30ab\u30e1\u30e9\u306712,000\u5186\u3067\u3057\u305f\u3002\u9577\u6301\u3061\u3057\u3066\u304f\u308c\u307e\u3059\u3088\u3046\u306b...\n\u3061\u306a\u307f\u306b\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u306e Power_On_Hours SMART\u5024\u306f2126\u300288.58\u65e5\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306e\u30793\u30f6\u6708\u304f\u3089\u3044\u3057\u304b\u50cd\u3044\u3066\u304f\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4ed6\u306e3\u53f0\u3082\u307e\u3068\u3081\u3066\u8cfc\u5165\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3082\u3057\u304b\u3057\u305f\u3089\u3058\u304d\u306b\u30c0\u30e1\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u3092RAID-Z2\u306b\u7d44\u307f\u8fbc\u3080\n\n\u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u306bGPT\u3092\u4f5c\u6210\n\u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u306fada0\u3067\u8a8d\u8b58\u3057\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\ngpart show ada0 \u3057\u3066\u3001GPT\u304c\u4f5c\u3089\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u6b63\u89e3\u3068\u3044\u3046\u3053\u3068\u3067\u3002\n\u554f\u984c\u306a\u3051\u308c\u3070ada0\u306bGPT\u3092\u4f5c\u308a\u307e\u3059\u3002\nfreebsd# gpart show ada0\ngpart: No such geom: ada0.\nfreebsd# gpart create -s gpt ada0\nada0 created\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34  3907029101        - free -  (1.8T)\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3092\u30d0\u30b7\u30d0\u30b7\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u4ea4\u63db\u524d\u306b\u8abf\u3079\u305f\u3082\u306e\u304b\u3001\u4ed6\u306e\u30c7\u30a3\u30b9\u30af\u306e\u69cb\u6210\u3092\u30d1\u30af\u308a\u307e\u3059\u3002\n\u4eca\u56de\u3084\u308a\u5fd8\u308c\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067GPT\u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3059(-l \u30e9\u30d9\u30eb\u540d)\u3002\nfreebsd# gpart add -i 1 -t freebsd-boot -b 40 -s 1024 ada0\nada0p1 added\nfreebsd# gpart add -i 2 -t freebsd-swap -b 1064 -s 4194304 ada0\nada0p2 added\nfreebsd# gpart add -i 3 -t freebsd-zfs -b 4195368 -s 3902833760 ada0\nada0p3 added\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  freebsd-boot  (512K)\n        1064     4194304     2  freebsd-swap  (2.0G)\n     4195368  3902833760     3  freebsd-zfs  (1.8T)\n  3907029128           7        - free -  (3.5K)\n\n\n\u7d44\u307f\u8fbc\u307f\n\u4eca\u4f5c\u3063\u305ffreebsd-zfs\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306erawuuid(GPTID)\u3092\u8abf\u3079\u307e\u3059\u3002\nfreebsd# gpart list ada0\nGeom name: ada0\nmodified: false\nstate: OK\nfwheads: 16\nfwsectors: 63\nlast: 3907029134\nfirst: 34\nentries: 128\nscheme: GPT\nProviders:\n1. Name: ada0p1\n...snip...\n3. Name: ada0p3\n   Mediasize: 1998250885120 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r0w0e0\n   rawuuid: 12357f00-73da-11e4-9e4c-bc5ff4fc4f55\n   rawtype: 516e7cba-6ecf-11d6-8ff8-00022d09712b\n   label: (null)\n   length: 1998250885120\n   offset: 2148028416\n   type: freebsd-zfs\n   index: 3\n   end: 3907029127\n   start: 4195368\n...snip...\n\n12357f00-73da-11e4-9e4c-bc5ff4fc4f55 \u304c\u65b0\u3057\u3044GPTID\u3068\u306a\u308a\u307e\u3059\u3002\n\u7f6e\u304d\u63db\u3048\u5bfe\u8c61\u306e\u90e8\u5206\u306e(ZFS\u306e)GUID\u3092\u8abf\u3079\u307e\u3059\u3002\nzpool status \u3067OFFLINE\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u306e\u540d\u524d\u3067\u3059\u3002\u53e4\u3044GPTID(was gptid/xxxx)\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306bzdb\u30b3\u30de\u30f3\u30c9\u3092\u8d70\u3089\u305b\u305f\u6642\u306b\u3082\u51fa\u3066\u304d\u307e\u3059\u3002\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices has been taken offline by the administrator.\n        Sufficient replicas exist for the pool to continue functioning in a\n        degraded state.\naction: Online the device using 'zpool online' or replace the device with\n        'zpool replace'.\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           DEGRADED     0     0     0\n          raidz2-0                                      DEGRADED     0     0     0\n            12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n\nGUID\u306f12425838491564392765\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n12425838491564392765 \u3092 gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55 \u3067\u7f6e\u304d\u63db\u3048\u308c\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u3002\nfreebsd# zpool replace zroot 12425838491564392765 gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55\nMake sure to wait until resilver is done before rebooting.\n\nIf you boot from pool 'zroot', you may need to update\nboot code on newly attached disk 'gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55'.\n\nAssuming you use GPT partitioning and 'da0' is your new boot disk\nyou may use the following command:\n\n        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0\n\n\u89aa\u5207\u306a\u6848\u5185\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u518d\u540c\u671f\u304c\u7d42\u308f\u308b\u307e\u3067\u306f\u518d\u8d77\u52d5\u3057\u306a\u3044\u3067\u306d\nzroot\u30d7\u30fc\u30eb\u304b\u3089\u8d77\u52d5\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u65b0\u3057\u304f\u3064\u3051\u305f\u30c7\u30a3\u30b9\u30af\u306e\u3076\u30fc\u3068\u30b3\u30fc\u30c9\u3082\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\nGPT\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u51fa\u6765\u308b\u3088\u3002\u305f\u3060da0\u306f\u8aad\u307f\u66ff\u3048\u3066\u306d: gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0\n\n\nzpool status \u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001resilvering\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u518d\u69cb\u7bc9\u304c\u59cb\u307e\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices is currently being resilvered.  The pool will\n        continue to function, possibly in a degraded state.\naction: Wait for the resilver to complete.\n  scan: resilver in progress since Mon Nov 24 22:09:54 2014\n        9.68G scanned out of 3.24T at 160M/s, 5h53m to go\n        2.33G resilvered, 0.29% done\nconfig:\n\n        NAME                                              STATE     READ WRITE CKSUM\n        zroot                                             DEGRADED     0     0     0\n          raidz2-0                                        DEGRADED     0     0     0\n            replacing-0                                   OFFLINE      0     0     0\n              12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n              gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55  ONLINE       0     0     0  (resilvering)\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55    ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55    ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55    ONLINE       0     0     0\n\nerrors: No known data errors\n\n\u518d\u69cb\u7bc9\u4e2d\u3067\u3082\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\u53ef\u80fd\u3067\u3059\u3002\n\n\u30d6\u30fc\u30c8\u30ec\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u8fbc\u307f\n\u5148\u307b\u3069\u306e\u6307\u793a\u3069\u304a\u308a\u3001\u30d6\u30fc\u30c8\u30b3\u30fc\u30c9\u3092\u66f4\u65b0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nfreebsd# gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 /dev/ada0\nbootcode written to ada0\n\n\n\u30e9\u30d9\u30eb\u4ed8\u3051\n\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u5fd8\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u4eca\u306e\u3046\u3061\u306b\u3084\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u30e9\u30d9\u30eb\u306e\u547d\u540d\u306b\u3064\u3044\u3066\u306f\u4ed6\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u3082\u306e\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\ngpart show -l ada1\u306a\u3069\u3068\u3059\u308b\u3068\u30e9\u30d9\u30eb\u304c\u898b\u3048\u307e\u3059\u3002\nfreebsd# gpart modify -i 1 -l gptboot0 ada0\nada0p1 modified\nfreebsd# gpart modify -i 2 -l swap0 ada0\nada0p2 modified\nfreebsd# gpart modify -i 3 -l zfs0 ada0\nada0p3 modified\nfreebsd# gpart show -l ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  gptboot0  (512K)\n        1064     4194304     2  swap0  (2.0G)\n     4195368  3902833760     3  zfs0  (1.8T)\n  3907029128           7        - free -  (3.5K)\n\n\u4eca\u56de\u306e\u3088\u3046\u306b\u3042\u3068\u304b\u3089\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u305f\u5834\u5408\u306f/dev/gpt/\u4ee5\u4e0b\u306b\u73fe\u308c\u306a\u3044(\u66f4\u65b0\u3055\u308c\u306a\u3044)\u305f\u3081\u3001\u5f8c\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u540c\u671f\u5f8c\u306e\u72b6\u614b\u78ba\u8a8d\nfreebsd# zpool status zroot\n  pool: zroot\n state: ONLINE\n  scan: resilvered 805G in 2h50m with 0 errors on Tue Nov 25 01:00:29 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           ONLINE       0     0     0\n          raidz2-0                                      ONLINE       0     0     0\n            gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n\n\u7d42\u308f\u308a\uff01\n\u3068\u3001\u3053\u3053\u3067\u4e00\u5ea6\u518d\u8d77\u52d5\u3057\u3066\u3001\u5148\u307b\u3069\u306e\u30e9\u30d9\u30eb\u3092\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n/etc/fstab\u306b\u30b9\u30ef\u30c3\u30d7\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30e9\u30d9\u30eb\u3067\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u6bce\u56de\u7de8\u96c6\u3059\u308b\u306e\u3082\u30a2\u30ec\u306a\u306e\u3067...\n\n\u96d1\u611f\nLinux\u306emdraid\u3068\u6bd4\u3079\u308b\u3068\u5c11\u3057\u624b\u6570\u306f\u591a\u3044\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u3092\u5165\u308c\u308b\u306e\u304c\u697d\u3067\u3059\u306d\u3002\n\u518d\u540c\u671f\u81ea\u4f53\u3082\u4f7f\u3063\u3066\u3044\u308b\u5206\u3060\u3051\u306a\u306e\u3067\u65e9\u304f\u6e08\u307f\u307e\u3057\u305f\u3002\nFreeBSD\u3084ZFS\u3092\u3088\u304f\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6bce\u5ea6\u30c9\u30ad\u30c9\u30ad\u3057\u307e\u3059\u306d\u3002\n\u3068\u3053\u308d\u3067\u3001mdraid\u3060\u3068\u5168\u57df\u691c\u67fb\u307f\u305f\u3044\u306a\u3053\u3068\u3067\u304d\u307e\u3059\u3051\u3069\u3001ZFS\u306f\u3069\u3046\u3084\u308b\u3093\u3067\u3057\u3087\u3046\u304b\u3002\nscrub\u3063\u3066\u3001\u30c7\u30fc\u30bf\u3042\u308b\u3068\u3053\u308d\u3057\u304b\u898b\u3066\u304f\u308c\u307e\u305b\u3093\u3057...\n# \u524d\u63d0\n\n* \u6211\u304c\u5bb6\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30fc\u30d0\u306e\u304a\u8a71\u3067\u3059\u3002\u696d\u52d9\u7528\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n* FreeBSD 10\u3067\u69cb\u7bc9\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u79c1\u306fFreeBSD\u306b\u4e0d\u6163\u308c\u3067\u3059\u3002\n* \u30eb\u30fc\u30c8\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u305d\u306e\u3082\u306e\u3082ZFS\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n* \u30d7\u30fc\u30eb\u306fRAID-Z2\u3067\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n# ZFS\u306e\u69cb\u6210\u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\n\n`zpool scrub zroot` \u3092\u5b9f\u884c\u3057\u305f\u3089\u3072\u3069\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u3001repaired\u306a\u3093\u3066\u8868\u793a\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u30ac\u30fc\u30f3\n\n`dmesg` \u3057\u3066\u307f\u305f\u7d50\u679c\u3001ATA\u306eDRDY ERR\u304c\u5927\u91cf\u306b\u51fa\u3066\u3044\u308b\u72b6\u6cc1\u3002(\uff89\u2200`)\uff71\uff81\uff6c\uff70\n\n```\n...snip...\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Retrying command\n(ada0:ahcich2:0:0:0): READ_FPDMA_QUEUED. ACB: 60 10 38 06 40 40 00 00 00 00 00 00\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Retrying command\n(ada0:ahcich2:0:0:0): READ_FPDMA_QUEUED. ACB: 60 10 38 06 40 40 00 00 00 00 00 00\n(ada0:ahcich2:0:0:0): CAM status: ATA Status Error\n(ada0:ahcich2:0:0:0): ATA status: 41 (DRDY ERR), error: 40 (UNC )\n(ada0:ahcich2:0:0:0): RES: 41 40 38 06 40 40 00 00 00 00 00\n(ada0:ahcich2:0:0:0): Error 5, Retries exhausted\n```\n\n\u4ed6\u306e\u30c7\u30a3\u30b9\u30af\u306f\u5927\u4e08\u592b\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001ada0\u6545\u969c\u3068\u3057\u3066\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n# \u4e8b\u524d\u8abf\u67fb\n\n\u554f\u984c\u306e\u3042\u3063\u305fada0\u306e\u60c5\u5831\u3092\u8abf\u3079\u3066\u304a\u304d\u307e\u3059\u3002\n\n## \u30b7\u30ea\u30a2\u30eb\u30ca\u30f3\u30d0\u30fc\n\n```\nfreebsd# camcontrol identify ada0\npass0: <WDC WD20EZRX-00D8PB0 80.00A80> ATA-9 SATA 3.x device\npass0: 300.000MB/s transfers (SATA 2.x, UDMA6, PIO 8192bytes)\n\nprotocol              ATA/ATAPI-9 SATA 3.x\ndevice model          WDC WD20EZRX-00D8PB0\nfirmware revision     80.00A80\nserial number         WD-WCC4M2770577\nWWN                   50014ee2b4ca1811\ncylinders             16383\nheads                 16\nsectors/track         63\nsector size           logical 512, physical 4096, offset 0\nLBA supported         268435455 sectors\nLBA48 supported       3907029168 sectors\nPIO supported         PIO4\nDMA supported         WDMA2 UDMA6\nmedia RPM             5400\n...snip...\n```\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u60c5\u5831\n\n```\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  freebsd-boot  (512K)\n        1064     4194304     2  freebsd-swap  (2.0G)\n     4195368  3902833760     3  freebsd-zfs  (1.8T)\n  3907029128           7        - free -  (3.5K)\n```\n\n\u5143\u3005\u306e\u30c7\u30a3\u30b9\u30af\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u69cb\u6210\u3092\u53c2\u7167\u3057\u307e\u3057\u305f\u304c\u3001\u4ed6\u306e3\u53f0\u3082\u540c\u3058\u69cb\u6210\u306a\u306e\u3067\u7279\u306b\u3053\u3060\u308f\u308a\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u6b21\u306e\u4f5c\u696d\u306fZFS\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e `rawuuid` \u3092\u8abf\u67fb\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3059\u3002ada0p3\u304cZFS\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306a\u306e\u306f\u5148\u306e\u30b3\u30de\u30f3\u30c9\u3067\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3053\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\nfreebsd# gpart list ada0\nGeom name: ada0\nmodified: false\nstate: OK\nfwheads: 16\nfwsectors: 63\nlast: 3907029134\nfirst: 34\nentries: 128\nscheme: GPT\nProviders:\n...snip...\n3. Name: ada0p3\n   Mediasize: 1998250885120 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r1w1e2\n   rawuuid: edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n   rawtype: 516e7cba-6ecf-11d6-8ff8-00022d09712b\n   label: zfs0\n   length: 1998250885120\n   offset: 2148028416\n   type: freebsd-zfs\n   index: 3\n   end: 3907029127\n   start: 4195368\nConsumers:\n1. Name: ada0\n   Mediasize: 2000398934016 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r2w2e5\n```\n\n`edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55` \u3067\u3059\u306d\u3002\n\n## ZFS\u306e\u69cb\u6210\u30c7\u30a3\u30b9\u30af\u60c5\u5831\n\n\u5197\u9577\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4e00\u5fdc\u898b\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\nfreebsd# zdb\nzroot:\n    version: 5000\n    name: 'zroot'\n    state: 0\n    txg: 35377\n    pool_guid: 8898421204376808293\n    hostid: 4266313884\n    hostname: 'freebsd'\n    vdev_children: 1\n    vdev_tree:\n        type: 'root'\n        id: 0\n        guid: 8898421204376808293\n        children[0]:\n            type: 'raidz'\n            id: 0\n            guid: 3251282675639060840\n            nparity: 2\n            metaslab_array: 33\n            metaslab_shift: 35\n            ashift: 12\n            asize: 7992984469504\n            is_log: 0\n            create_txg: 4\n            children[0]:\n                type: 'disk'\n                id: 0\n                guid: 12425838491564392765\n                path: '/dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 123\n                create_txg: 4\n            children[1]:\n                type: 'disk'\n                id: 1\n                guid: 11970705104448422009\n                path: '/dev/gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 122\n                create_txg: 4\n            children[2]:\n                type: 'disk'\n                id: 2\n                guid: 3324830681772726295\n                path: '/dev/gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 121\n                create_txg: 4\n            children[3]:\n                type: 'disk'\n                id: 3\n                guid: 11650913671101100370\n                path: '/dev/gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55'\n                phys_path: '/dev/gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55'\n                whole_disk: 1\n                DTL: 229\n                create_txg: 4\n    features_for_read:\n```\n\n## zpool\u306e\u72b6\u614b\n\n\u30d7\u30fc\u30eb\u3068\u3057\u3066\u306f\u7570\u5e38\u3042\u308a\u307e\u305b\u3093\u30022\u56de\u76ee\u306escrub\u306b\u6050\u308d\u3057\u304f\u6642\u9593\u304c\u304b\u304b\u3063\u305f\u306e\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u307e\u3057\u305f\u3002\n\n\u76ee\u7684\u306e\u30c7\u30a3\u30b9\u30af\u306f\u4e00\u756a\u4e0a\u3067\u3059\u306d\u3002\n\n```\nfreebsd# zpool status\n  pool: zroot\n state: ONLINE\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           ONLINE       0     0     0\n          raidz2-0                                      ONLINE       0     0     0\n            gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n```\n\n## \u30e1\u30e2\u3059\u308b\n\n\u60c5\u5831\u3092\u6574\u7406\u3057\u3066\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n* \u554f\u984c\u304c\u3042\u308b\u30c7\u30a3\u30b9\u30af\u306f `ada0`\n* ada0 \u306e\u30e2\u30c7\u30eb\u30ca\u30f3\u30d0\u30fc\u306f `WD20EZRX` (Western Digital\u793e\u306eWD Green\u30b7\u30ea\u30fc\u30ba 2TB \u30ad\u30e3\u30c3\u30b7\u30e564MB)\n* ada0 \u306e\u30b7\u30ea\u30a2\u30eb\u30ca\u30f3\u30d0\u30fc\u306f `WD-WCC4M2770577`\n* ZFS\u306e\u30d7\u30fc\u30eb `zroot` \u3067\u306f `gpart list ada0` \u306e\u7d50\u679c\u3088\u308a `gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55` \u304c\u8a72\u5f53\n\n# \u30c7\u30a3\u30b9\u30af\u4ea4\u63db\n\n## \u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30ec\u30a4\u304b\u3089\u5916\u3059\n\n\u5f53\u8a72\u30c7\u30a3\u30b9\u30af\u3092\u30a2\u30ec\u30a4\u304b\u3089\u5916\u3057\u3066\u304a\u304d\u307e\u3059(OFFLINE\u306b\u3059\u308b)\u3002\n\n```\nfreebsd# zpool offline zroot gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices has been taken offline by the administrator.\n        Sufficient replicas exist for the pool to continue functioning in a\n        degraded state.\naction: Online the device using 'zpool online' or replace the device with\n        'zpool replace'.\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           DEGRADED     0     0     0\n          raidz2-0                                      DEGRADED     0     0     0\n            12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n```\n\n## \u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u30c7\u30a3\u30b9\u30af\u4ea4\u63db\n\n\u9593\u9055\u3048\u3066\u30c7\u30a3\u30b9\u30af\u3092\u53d6\u308a\u5916\u3057\u3066\u3057\u307e\u3046\u4e8b\u6545\u3092\u907f\u3051\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u4e00\u65e6\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u7528\u610f\u3057\u305f\u30c7\u30a3\u30b9\u30af\u306f WD20EFRX (Western Digital\u793e WD Red\u30b7\u30ea\u30fc\u30ba)\u3002\u30e8\u30c9\u30d0\u30b7\u30ab\u30e1\u30e9\u306712,000\u5186\u3067\u3057\u305f\u3002\u9577\u6301\u3061\u3057\u3066\u304f\u308c\u307e\u3059\u3088\u3046\u306b...\n\n\u3061\u306a\u307f\u306b\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u306e `Power_On_Hours` SMART\u5024\u306f2126\u300288.58\u65e5\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306e\u30793\u30f6\u6708\u304f\u3089\u3044\u3057\u304b\u50cd\u3044\u3066\u304f\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4ed6\u306e3\u53f0\u3082\u307e\u3068\u3081\u3066\u8cfc\u5165\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3082\u3057\u304b\u3057\u305f\u3089\u3058\u304d\u306b\u30c0\u30e1\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# \u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u3092RAID-Z2\u306b\u7d44\u307f\u8fbc\u3080\n\n## \u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u306bGPT\u3092\u4f5c\u6210\n\n\u65b0\u3057\u3044\u30c7\u30a3\u30b9\u30af\u306fada0\u3067\u8a8d\u8b58\u3057\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n`gpart show ada0` \u3057\u3066\u3001GPT\u304c\u4f5c\u3089\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u6b63\u89e3\u3068\u3044\u3046\u3053\u3068\u3067\u3002\n\n\u554f\u984c\u306a\u3051\u308c\u3070ada0\u306bGPT\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\nfreebsd# gpart show ada0\ngpart: No such geom: ada0.\nfreebsd# gpart create -s gpt ada0\nada0 created\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34  3907029101        - free -  (1.8T)\n```\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u3092\u30d0\u30b7\u30d0\u30b7\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u4ea4\u63db\u524d\u306b\u8abf\u3079\u305f\u3082\u306e\u304b\u3001\u4ed6\u306e\u30c7\u30a3\u30b9\u30af\u306e\u69cb\u6210\u3092\u30d1\u30af\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u3084\u308a\u5fd8\u308c\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067GPT\u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u304a\u304f\u3068\u826f\u3044\u3067\u3059(`-l \u30e9\u30d9\u30eb\u540d`)\u3002\n\n```\nfreebsd# gpart add -i 1 -t freebsd-boot -b 40 -s 1024 ada0\nada0p1 added\nfreebsd# gpart add -i 2 -t freebsd-swap -b 1064 -s 4194304 ada0\nada0p2 added\nfreebsd# gpart add -i 3 -t freebsd-zfs -b 4195368 -s 3902833760 ada0\nada0p3 added\nfreebsd# gpart show ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  freebsd-boot  (512K)\n        1064     4194304     2  freebsd-swap  (2.0G)\n     4195368  3902833760     3  freebsd-zfs  (1.8T)\n  3907029128           7        - free -  (3.5K)\n```\n\n## \u7d44\u307f\u8fbc\u307f\n\n\u4eca\u4f5c\u3063\u305ffreebsd-zfs\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306erawuuid(GPTID)\u3092\u8abf\u3079\u307e\u3059\u3002\n\n```\nfreebsd# gpart list ada0\nGeom name: ada0\nmodified: false\nstate: OK\nfwheads: 16\nfwsectors: 63\nlast: 3907029134\nfirst: 34\nentries: 128\nscheme: GPT\nProviders:\n1. Name: ada0p1\n...snip...\n3. Name: ada0p3\n   Mediasize: 1998250885120 (1.8T)\n   Sectorsize: 512\n   Stripesize: 4096\n   Stripeoffset: 0\n   Mode: r0w0e0\n   rawuuid: 12357f00-73da-11e4-9e4c-bc5ff4fc4f55\n   rawtype: 516e7cba-6ecf-11d6-8ff8-00022d09712b\n   label: (null)\n   length: 1998250885120\n   offset: 2148028416\n   type: freebsd-zfs\n   index: 3\n   end: 3907029127\n   start: 4195368\n...snip...\n```\n\n`12357f00-73da-11e4-9e4c-bc5ff4fc4f55` \u304c\u65b0\u3057\u3044GPTID\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u7f6e\u304d\u63db\u3048\u5bfe\u8c61\u306e\u90e8\u5206\u306e(ZFS\u306e)GUID\u3092\u8abf\u3079\u307e\u3059\u3002\n`zpool status` \u3067OFFLINE\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u306e\u540d\u524d\u3067\u3059\u3002\u53e4\u3044GPTID(was gptid/xxxx)\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306b`zdb`\u30b3\u30de\u30f3\u30c9\u3092\u8d70\u3089\u305b\u305f\u6642\u306b\u3082\u51fa\u3066\u304d\u307e\u3059\u3002\n\n```\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices has been taken offline by the administrator.\n        Sufficient replicas exist for the pool to continue functioning in a\n        degraded state.\naction: Online the device using 'zpool online' or replace the device with\n        'zpool replace'.\n  scan: scrub canceled on Sun Nov 23 15:57:15 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           DEGRADED     0     0     0\n          raidz2-0                                      DEGRADED     0     0     0\n            12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n```\n\nGUID\u306f`12425838491564392765`\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n`12425838491564392765` \u3092 `gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55` \u3067\u7f6e\u304d\u63db\u3048\u308c\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n```\nfreebsd# zpool replace zroot 12425838491564392765 gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55\nMake sure to wait until resilver is done before rebooting.\n\nIf you boot from pool 'zroot', you may need to update\nboot code on newly attached disk 'gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55'.\n\nAssuming you use GPT partitioning and 'da0' is your new boot disk\nyou may use the following command:\n\n        gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0\n```\n\n\u89aa\u5207\u306a\u6848\u5185\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n* \u518d\u540c\u671f\u304c\u7d42\u308f\u308b\u307e\u3067\u306f\u518d\u8d77\u52d5\u3057\u306a\u3044\u3067\u306d\n* zroot\u30d7\u30fc\u30eb\u304b\u3089\u8d77\u52d5\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u65b0\u3057\u304f\u3064\u3051\u305f\u30c7\u30a3\u30b9\u30af\u306e\u3076\u30fc\u3068\u30b3\u30fc\u30c9\u3082\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\n* GPT\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u51fa\u6765\u308b\u3088\u3002\u305f\u3060`da0`\u306f\u8aad\u307f\u66ff\u3048\u3066\u306d: `gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 da0`\n\n`zpool status` \u3067\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001`resilvering`\u306b\u306a\u3063\u3066\u304a\u308a\u3001\u518d\u69cb\u7bc9\u304c\u59cb\u307e\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\nfreebsd# zpool status\n  pool: zroot\n state: DEGRADED\nstatus: One or more devices is currently being resilvered.  The pool will\n        continue to function, possibly in a degraded state.\naction: Wait for the resilver to complete.\n  scan: resilver in progress since Mon Nov 24 22:09:54 2014\n        9.68G scanned out of 3.24T at 160M/s, 5h53m to go\n        2.33G resilvered, 0.29% done\nconfig:\n\n        NAME                                              STATE     READ WRITE CKSUM\n        zroot                                             DEGRADED     0     0     0\n          raidz2-0                                        DEGRADED     0     0     0\n            replacing-0                                   OFFLINE      0     0     0\n              12425838491564392765                        OFFLINE      0     0     0  was /dev/gptid/edea0237-d1fa-11e3-9ad5-bc5ff4fc4f55\n              gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55  ONLINE       0     0     0  (resilvering)\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55    ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55    ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55    ONLINE       0     0     0\n\nerrors: No known data errors\n```\n\n\u518d\u69cb\u7bc9\u4e2d\u3067\u3082\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\u53ef\u80fd\u3067\u3059\u3002\n\n## \u30d6\u30fc\u30c8\u30ec\u30b3\u30fc\u30c9\u306e\u66f8\u304d\u8fbc\u307f\n\n\u5148\u307b\u3069\u306e\u6307\u793a\u3069\u304a\u308a\u3001\u30d6\u30fc\u30c8\u30b3\u30fc\u30c9\u3092\u66f4\u65b0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\nfreebsd# gpart bootcode -b /boot/pmbr -p /boot/gptzfsboot -i 1 /dev/ada0\nbootcode written to ada0\n```\n\n## \u30e9\u30d9\u30eb\u4ed8\u3051\n\n\u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u5fd8\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u4eca\u306e\u3046\u3061\u306b\u3084\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u30e9\u30d9\u30eb\u306e\u547d\u540d\u306b\u3064\u3044\u3066\u306f\u4ed6\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u3082\u306e\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n`gpart show -l ada1`\u306a\u3069\u3068\u3059\u308b\u3068\u30e9\u30d9\u30eb\u304c\u898b\u3048\u307e\u3059\u3002\n\n```\nfreebsd# gpart modify -i 1 -l gptboot0 ada0\nada0p1 modified\nfreebsd# gpart modify -i 2 -l swap0 ada0\nada0p2 modified\nfreebsd# gpart modify -i 3 -l zfs0 ada0\nada0p3 modified\nfreebsd# gpart show -l ada0\n=>        34  3907029101  ada0  GPT  (1.8T)\n          34           6        - free -  (3.0K)\n          40        1024     1  gptboot0  (512K)\n        1064     4194304     2  swap0  (2.0G)\n     4195368  3902833760     3  zfs0  (1.8T)\n  3907029128           7        - free -  (3.5K)\n```\n\n\u4eca\u56de\u306e\u3088\u3046\u306b\u3042\u3068\u304b\u3089\u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u305f\u5834\u5408\u306f`/dev/gpt/`\u4ee5\u4e0b\u306b\u73fe\u308c\u306a\u3044(\u66f4\u65b0\u3055\u308c\u306a\u3044)\u305f\u3081\u3001\u5f8c\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n## \u540c\u671f\u5f8c\u306e\u72b6\u614b\u78ba\u8a8d\n\n```\nfreebsd# zpool status zroot\n  pool: zroot\n state: ONLINE\n  scan: resilvered 805G in 2h50m with 0 errors on Tue Nov 25 01:00:29 2014\nconfig:\n\n        NAME                                            STATE     READ WRITE CKSUM\n        zroot                                           ONLINE       0     0     0\n          raidz2-0                                      ONLINE       0     0     0\n            gptid/12357f00-73da-11e4-9e4c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/917210e6-d1df-11e3-ad9c-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/2622a6c7-d179-11e3-a601-bc5ff4fc4f55  ONLINE       0     0     0\n            gptid/c62cbbc8-d131-11e3-b779-bc5ff4fc4f55  ONLINE       0     0     0\n\nerrors: No known data errors\n```\n\n\u7d42\u308f\u308a\uff01\n\n\u3068\u3001\u3053\u3053\u3067\u4e00\u5ea6\u518d\u8d77\u52d5\u3057\u3066\u3001\u5148\u307b\u3069\u306e\u30e9\u30d9\u30eb\u3092\u6709\u52b9\u5316\u3057\u307e\u3059\u3002\n`/etc/fstab`\u306b\u30b9\u30ef\u30c3\u30d7\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30e9\u30d9\u30eb\u3067\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u6bce\u56de\u7de8\u96c6\u3059\u308b\u306e\u3082\u30a2\u30ec\u306a\u306e\u3067...\n\n# \u96d1\u611f\n\nLinux\u306emdraid\u3068\u6bd4\u3079\u308b\u3068\u5c11\u3057\u624b\u6570\u306f\u591a\u3044\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u3092\u5165\u308c\u308b\u306e\u304c\u697d\u3067\u3059\u306d\u3002\n\u518d\u540c\u671f\u81ea\u4f53\u3082\u4f7f\u3063\u3066\u3044\u308b\u5206\u3060\u3051\u306a\u306e\u3067\u65e9\u304f\u6e08\u307f\u307e\u3057\u305f\u3002\n\nFreeBSD\u3084ZFS\u3092\u3088\u304f\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6bce\u5ea6\u30c9\u30ad\u30c9\u30ad\u3057\u307e\u3059\u306d\u3002\n\n\u3068\u3053\u308d\u3067\u3001mdraid\u3060\u3068\u5168\u57df\u691c\u67fb\u307f\u305f\u3044\u306a\u3053\u3068\u3067\u304d\u307e\u3059\u3051\u3069\u3001ZFS\u306f\u3069\u3046\u3084\u308b\u3093\u3067\u3057\u3087\u3046\u304b\u3002\nscrub\u3063\u3066\u3001\u30c7\u30fc\u30bf\u3042\u308b\u3068\u3053\u308d\u3057\u304b\u898b\u3066\u304f\u308c\u307e\u305b\u3093\u3057...\n", "tags": ["FreeBSD10", "ZFS"]}