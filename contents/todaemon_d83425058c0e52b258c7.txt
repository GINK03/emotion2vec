{"tags": ["Linux", "clamav", "SELinux"], "context": " More than 1 year has passed since last update.\u524d\u56de\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u4eca\u56de\u306f\u30a6\u30a4\u30eb\u30b9\u691c\u77e5\u51e6\u7406\u3092\u30c7\u30fc\u30e2\u30f3\u5316\u3059\u308b\u306e\u3068\u3001\u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\u3059\u308b\u3068\u3053\u308d\u3092\u307e\u3068\u3081\u307e\u3059\u306d\u3002\n\n1. \u30a6\u30a4\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u306e\u30c7\u30fc\u30e2\u30f3\u5316\n\u30c7\u30fc\u30e2\u30f3\u5316\u306b\u306fclamd\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n# yum install clamd\nLoaded plugins: fastestmirror, security\nLoading mirror speeds from cached hostfile\n * epel: ftp.kddilabs.jp\nSetting up Install Process\nResolving Dependencies\n--> Running transaction check\n---> Package clamd.x86_64 0:0.98.1-1.el6 will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n\n==============================================================================================================\n Package                 Arch                     Version                        Repository              Size\n==============================================================================================================\nInstalling:\n clamd                   x86_64                   0.98.1-1.el6                   epel                   150 k\n\nTransaction Summary\n==============================================================================================================\nInstall       1 Package(s)\n\nTotal download size: 150 k\nInstalled size: 563 k\nIs this ok [y/N]: y\nDownloading Packages:\nclamd-0.98.1-1.el6.x86_64.rpm                                                          | 150 kB     00:00\nRunning rpm_check_debug\nRunning Transaction Test\nTransaction Test Succeeded\nRunning Transaction\n  Installing : clamd-0.98.1-1.el6.x86_64                                                                  1/1\n  Verifying  : clamd-0.98.1-1.el6.x86_64                                                                  1/1\n\nInstalled:\n  clamd.x86_64 0:0.98.1-1.el6\n\nComplete!\n#\n\n\u30b5\u30af\u30c3\u3068\u30a4\u30f3\u30b9\u30c8\u3067\u304d\u307e\u3057\u305f\u3002\nclamd\u306f\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001service\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3057\u3087\u3046\u3002\u307e\u305fchkconfig\u3067\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# /sbin/service clamd start\nStarting Clam AntiVirus Daemon:                            [  OK  ]\n# chkconfig clamd on\n\n\u30a6\u30a4\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u306fclamdscan\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\n# clamdscan /bin/\n/bin/loadkeys: lstat() failed: Permission denied. ERROR\n/bin/umount: lstat() failed: Permission denied. ERROR\n/bin/ping: lstat() failed: Permission denied. ERROR\n/bin/dmesg: lstat() failed: Permission denied. ERROR\n/bin/rpm: lstat() failed: Permission denied. ERROR\n/bin/ping6: lstat() failed: Permission denied. ERROR\n/bin/login: lstat() failed: Permission denied. ERROR\n/bin/hostname: lstat() failed: Permission denied. ERROR\n/bin/tracepath6: lstat() failed: Permission denied. ERROR\n/bin/tracepath: lstat() failed: Permission denied. ERROR\n/bin/traceroute: lstat() failed: Permission denied. ERROR\n/bin/dbus-daemon: lstat() failed: Permission denied. ERROR\n/bin/alsaunmute: lstat() failed: Permission denied. ERROR\n/bin/plymouth: lstat() failed: Permission denied. ERROR\n/bin/mount: lstat() failed: Permission denied. ERROR\n/bin/su: lstat() failed: Permission denied. ERROR\n\n----------- SCAN SUMMARY -----------\nInfected files: 0\nTotal errors: 16\nTime: 0.034 sec (0 m 0 s)\n#\n\n(\uff9f\u0434\uff9f)\uff01\u304a\u3063\u3068\u3001\u6a29\u9650\u306e\u554f\u984c\u304c\u767a\u751f\u3067\u3059\u3002\n\u4eca\u56de\u3001clamd\u306fclam\u30e6\u30fc\u30b6\u3067\u8d77\u52d5\u3057\u3066\u304a\u308a\u3001\u3055\u3089\u306bSELinux\u3082Enforcing\u306b\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n/etc/clamd.conf \u3092\u5909\u66f4\u3057\u3066clamd\u3092root\u30e6\u30fc\u30b6\u3067\u8d77\u52d5\u3057\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u30d0\u30e9\u30f3\u30b9\u52a0\u6e1b\u3067clam\u30e6\u30fc\u30b6\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304d\u3001\u30b7\u30b9\u30c6\u30e0\u7cfb\u306e\u30d5\u30a1\u30a4\u30eb\u3082\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3082\u3089\u3046\u3088\u3046\u5909\u66f4\u3057\u307e\u3059\u3002\n/var/log/audit/audit.log\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001clamd\u306e\u30a2\u30af\u30bb\u30b9\u304cdenied\u3055\u308c\u3066\u3044\u308b\u30ed\u30b0\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092audit2allow\u306b\u98df\u308f\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n# grep denied /var/log/audit/audit.log | grep clam | audit2allow\n\n#============= antivirus_t ==============\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t NetworkManager_var_lib_t:dir getattr;\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t abrt_dump_oops_exec_t:file getattr;\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t acct_exec_t:file getattr;\n\uff5e\u7701\u7565\uff5e\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t xdm_tmp_t:dir getattr;\n\n\u3059\u308b\u3068\u591a\u6570\u306e\u30eb\u30fc\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u304c\u3001\u3088\u304f\u3088\u304f\u898b\u308b\u3068antivirus_can_scan_system\u3068\u3044\u3046Boolean\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3044\u3051\u305d\u3046\u306a\u96f0\u56f2\u6c17\u3067\u3059\u306d\u3002\n\u5ff5\u306e\u305f\u3081sesearch\u3067antivirus_can_scan_system\u3092on\u306b\u3057\u305f\u6642\u306e\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\u3057\u3068\u304d\u307e\u3059\u3002\n# sesearch -b antivirus_can_scan_system -AC\nFound 9 semantic av rules:\nDT allow antivirus_domain device_node : chr_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain device_node : blk_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : dir { ioctl read getattr lock search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : sock_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : fifo_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain device_t : dir { getattr search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : file { ioctl read getattr lock open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : dir { ioctl read getattr lock search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : lnk_file { read getattr } ; [ antivirus_can_scan_system ]\n#\n\n\u3067\u306fBoolean\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# setsebool -P antivirus_can_scan_system on\n\n\u5909\u66f4\u3067\u304d\u305f\u306e\u3067\u518d\u5ea6/bin\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u307f\u307e\u3059\u3002\n]# clamdscan /bin/\n/bin: OK\n\n----------- SCAN SUMMARY -----------\nInfected files: 0\nTime: 0.051 sec (0 m 0 s)\n#\n\n\u6210\u529f\u3067\u3059\u3002\n\u4eca\u56de\u3001clam\u30e6\u30fc\u30b6\u3067\u306eclamd\u8d77\u52d5\u3068SELinux\u304cEnforcing\u3068\u3044\u3046\u72b6\u614b\u3067\u52d5\u4f5c\u3055\u305b\u3066\u307e\u3059\u3002\nDAC\u306b\u3088\u308b\u5236\u5fa1\u3067\u306f\u3001\u4f8b\u3048\u3070root\u306e\u307f\u95b2\u89a7\u53ef\u80fd\u306a/root\u3084\u30ed\u30b0\u3068\u304b\u306f\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u305b\u3093\u3057\u3001\u307e\u305fMAC\u306b\u3088\u308b\u5236\u5fa1\u3067\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u3059\u304c\u3001ClamAV\u3068SELinux\u53cc\u65b9\u3067\u5b88\u5099\u3059\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u3067\u3001\u3053\u308c\u3067\u3088\u3057\u3068\u3057\u307e\u3057\u305f\u3002\n\u307e\u3042\u6c17\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u6642\u306f\u3001root\u30e6\u30fc\u30b6\u306b\u3066clamscan\u3092\u624b\u52d5\u3067\u5b9f\u884c\u3055\u305b\u307e\u3057\u3087\u3046\u3002\n\n2. \u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\nfreshclam\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u898b\u308b\u3068\u3001-d\u30aa\u30d7\u30b7\u30e7\u30f3\u3068-c\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u81ea\u52d5\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n# man freshclam\nfreshclam(1)                    Clam AntiVirus                    freshclam(1)\n\nNAME\n       freshclam - update virus databases\n\nSYNOPSIS\n       freshclam [options]\n\nDESCRIPTION\n       freshclam is a virus database update tool for ClamAV.\n\nOPTIONS\n       Freshclam  reads its configuration from freshclam.conf. The settings can be overwritten with\n       command line options.\n\n\uff5e\u7701\u7565\uff5e\n       -d, --daemon\n              Run in a daemon mode. This option requires --checks.  -p FILE, --pid=FILE Write  dae-\n              mon\u2019s pid to FILE.\n\n       --no-dns\n              This option forces old non-DNS verification method (without a TTL delay).\n\n       -c #n, --checks=#n\n              Check #n times per day for a new database. #n must be between 1 and 50.\n\uff5e\u5f8c\u7565\uff5e\n\n1\u65e51\u56de\u306e\u983b\u5ea6\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3088\u3046\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n# freshclam -d -c 1\n# ps -ef | grep fresh\nclam     17534     1 64 09:28 ?        00:00:02 freshclam -d -c 1\nroot     17536 17327  0 09:28 pts/0    00:00:00 grep fresh\n#\n\n\u307e\u305fOS\u518d\u8d77\u52d5\u6642\u306b\u3082freshclam\u304c\u8d77\u52d5\u3059\u308b\u3088\u3046 /etc/rc.local \u3078\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u3066\u307e\u3059\u3002\n\n/etc/rc.local\n/usr/bin/freshclam -d -c 1\n\n\n\u3042\u3068\u9806\u756a\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3059\u304c\u3001freshclam\u3067\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3057\u305f\u3089\u3001clamd\u306b\u305d\u308c\u3092RELOAD\u3057\u3066\u3082\u3089\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u9023\u643a\u304c\u5fc5\u8981\u3067\u3059\u3002\nfreshclam.conf \u306b\u305d\u306e\u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3042\u308b\u306e\u3067\u3001clamd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n/etc/freshclam.conf\n# Send the RELOAD command to clamd.\n# Default: no\nNotifyClamd /etc/clamd.conf\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u306e\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n# killall freshclam && freshclam -d -c1\n\n\u203b\u5f8c\u3067\u6c17\u4ed8\u3044\u305f\u306e\u3067\u3059\u304c\u3001/etc/cron.daily/freshclam\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30011\u65e51\u56de\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306a\u3089cron\u306b\u4efb\u305b\u3061\u3083\u3046\u306e\u304c\u3044\u3044\u3067\u3059\u306d\u3002\u306a\u306e\u3067rc.local\u306e\u81ea\u52d5\u8d77\u52d5\u3082\u4e0d\u8981\u3067\u3059\u3002\n\n3. \u6d3b\u7528\n\u3068\u308a\u3042\u3048\u305a\u5165\u308c\u3066\u307f\u305f\u3068\u3044\u3046\u624b\u9806\u306a\u306e\u3067\u3001\u904b\u7528\u3081\u3044\u305f\u3053\u3068\u306f\u8003\u3048\u3066\u306a\u3044\u306e\u3067\u3059\u304c\u3001clamd\u3067\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30e1\u30fc\u30eb\u306e\u30a6\u30a4\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u3057\u305f\u308a\u3001\u5916\u90e8\u304b\u3089STREAM\u3067\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066\u30a6\u30a4\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3082\u3089\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u306d\u3002\nClamAV\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u304c\u3057\u3063\u304b\u308a\u3057\u3066\u3044\u308b\u306e\u3067\u3001clamd\u3084clamd.conf\u306eman\u3092\u898b\u3066\u4f7f\u3048\u305d\u3046\u306a\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u63a2\u3063\u3066\u307f\u307e\u3059\u3002\n\u3067\u306f\u3067\u306f\u3002\n[\u524d\u56de](http://qiita.com/todaemon/items/8616a89d9fc9c408c081)\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u4eca\u56de\u306f\u30a6\u30a4\u30eb\u30b9\u691c\u77e5\u51e6\u7406\u3092\u30c7\u30fc\u30e2\u30f3\u5316\u3059\u308b\u306e\u3068\u3001\u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\u3059\u308b\u3068\u3053\u308d\u3092\u307e\u3068\u3081\u307e\u3059\u306d\u3002\n\n## 1. \u30a6\u30a4\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u51e6\u7406\u306e\u30c7\u30fc\u30e2\u30f3\u5316\n\u30c7\u30fc\u30e2\u30f3\u5316\u306b\u306fclamd\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5fc5\u8981\u3067\u3059\u3002yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```shell-session\n# yum install clamd\nLoaded plugins: fastestmirror, security\nLoading mirror speeds from cached hostfile\n * epel: ftp.kddilabs.jp\nSetting up Install Process\nResolving Dependencies\n--> Running transaction check\n---> Package clamd.x86_64 0:0.98.1-1.el6 will be installed\n--> Finished Dependency Resolution\n\nDependencies Resolved\n\n==============================================================================================================\n Package                 Arch                     Version                        Repository              Size\n==============================================================================================================\nInstalling:\n clamd                   x86_64                   0.98.1-1.el6                   epel                   150 k\n\nTransaction Summary\n==============================================================================================================\nInstall       1 Package(s)\n\nTotal download size: 150 k\nInstalled size: 563 k\nIs this ok [y/N]: y\nDownloading Packages:\nclamd-0.98.1-1.el6.x86_64.rpm                                                          | 150 kB     00:00\nRunning rpm_check_debug\nRunning Transaction Test\nTransaction Test Succeeded\nRunning Transaction\n  Installing : clamd-0.98.1-1.el6.x86_64                                                                  1/1\n  Verifying  : clamd-0.98.1-1.el6.x86_64                                                                  1/1\n\nInstalled:\n  clamd.x86_64 0:0.98.1-1.el6\n\nComplete!\n#\n```\n\n\u30b5\u30af\u30c3\u3068\u30a4\u30f3\u30b9\u30c8\u3067\u304d\u307e\u3057\u305f\u3002\n\nclamd\u306f\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001service\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3057\u3087\u3046\u3002\u307e\u305fchkconfig\u3067\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\n# /sbin/service clamd start\nStarting Clam AntiVirus Daemon:                            [  OK  ]\n# chkconfig clamd on\n```\n\n\u30a6\u30a4\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u306fclamdscan\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```shell-session\n# clamdscan /bin/\n/bin/loadkeys: lstat() failed: Permission denied. ERROR\n/bin/umount: lstat() failed: Permission denied. ERROR\n/bin/ping: lstat() failed: Permission denied. ERROR\n/bin/dmesg: lstat() failed: Permission denied. ERROR\n/bin/rpm: lstat() failed: Permission denied. ERROR\n/bin/ping6: lstat() failed: Permission denied. ERROR\n/bin/login: lstat() failed: Permission denied. ERROR\n/bin/hostname: lstat() failed: Permission denied. ERROR\n/bin/tracepath6: lstat() failed: Permission denied. ERROR\n/bin/tracepath: lstat() failed: Permission denied. ERROR\n/bin/traceroute: lstat() failed: Permission denied. ERROR\n/bin/dbus-daemon: lstat() failed: Permission denied. ERROR\n/bin/alsaunmute: lstat() failed: Permission denied. ERROR\n/bin/plymouth: lstat() failed: Permission denied. ERROR\n/bin/mount: lstat() failed: Permission denied. ERROR\n/bin/su: lstat() failed: Permission denied. ERROR\n\n----------- SCAN SUMMARY -----------\nInfected files: 0\nTotal errors: 16\nTime: 0.034 sec (0 m 0 s)\n#\n```\n\n(\uff9f\u0434\uff9f)\uff01\u304a\u3063\u3068\u3001\u6a29\u9650\u306e\u554f\u984c\u304c\u767a\u751f\u3067\u3059\u3002\n\u4eca\u56de\u3001clamd\u306fclam\u30e6\u30fc\u30b6\u3067\u8d77\u52d5\u3057\u3066\u304a\u308a\u3001\u3055\u3089\u306bSELinux\u3082Enforcing\u306b\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n/etc/clamd.conf \u3092\u5909\u66f4\u3057\u3066clamd\u3092root\u30e6\u30fc\u30b6\u3067\u8d77\u52d5\u3057\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u30d0\u30e9\u30f3\u30b9\u52a0\u6e1b\u3067clam\u30e6\u30fc\u30b6\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304d\u3001\u30b7\u30b9\u30c6\u30e0\u7cfb\u306e\u30d5\u30a1\u30a4\u30eb\u3082\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3082\u3089\u3046\u3088\u3046\u5909\u66f4\u3057\u307e\u3059\u3002\n\n/var/log/audit/audit.log\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001clamd\u306e\u30a2\u30af\u30bb\u30b9\u304cdenied\u3055\u308c\u3066\u3044\u308b\u30ed\u30b0\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092audit2allow\u306b\u98df\u308f\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```shell-session\n# grep denied /var/log/audit/audit.log | grep clam | audit2allow\n\n#============= antivirus_t ==============\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t NetworkManager_var_lib_t:dir getattr;\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t abrt_dump_oops_exec_t:file getattr;\n\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t acct_exec_t:file getattr;\n\uff5e\u7701\u7565\uff5e\n#!!!! This avc can be allowed using the boolean 'antivirus_can_scan_system'\nallow antivirus_t xdm_tmp_t:dir getattr;\n```\n\n\u3059\u308b\u3068\u591a\u6570\u306e\u30eb\u30fc\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u304c\u3001\u3088\u304f\u3088\u304f\u898b\u308b\u3068antivirus_can_scan_system\u3068\u3044\u3046Boolean\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3044\u3051\u305d\u3046\u306a\u96f0\u56f2\u6c17\u3067\u3059\u306d\u3002\n\n\u5ff5\u306e\u305f\u3081sesearch\u3067antivirus_can_scan_system\u3092on\u306b\u3057\u305f\u6642\u306e\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\u3057\u3068\u304d\u307e\u3059\u3002\n\n```shell-session\n# sesearch -b antivirus_can_scan_system -AC\nFound 9 semantic av rules:\nDT allow antivirus_domain device_node : chr_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain device_node : blk_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : dir { ioctl read getattr lock search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : sock_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain file_type : fifo_file getattr ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain device_t : dir { getattr search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : file { ioctl read getattr lock open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : dir { ioctl read getattr lock search open } ; [ antivirus_can_scan_system ]\nDT allow antivirus_domain non_security_file_type : lnk_file { read getattr } ; [ antivirus_can_scan_system ]\n#\n```\n\n\u3067\u306fBoolean\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```shell-session\n# setsebool -P antivirus_can_scan_system on\n```\n\n\u5909\u66f4\u3067\u304d\u305f\u306e\u3067\u518d\u5ea6/bin\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\n]# clamdscan /bin/\n/bin: OK\n\n----------- SCAN SUMMARY -----------\nInfected files: 0\nTime: 0.051 sec (0 m 0 s)\n#\n```\n\n\u6210\u529f\u3067\u3059\u3002\n\u4eca\u56de\u3001clam\u30e6\u30fc\u30b6\u3067\u306eclamd\u8d77\u52d5\u3068SELinux\u304cEnforcing\u3068\u3044\u3046\u72b6\u614b\u3067\u52d5\u4f5c\u3055\u305b\u3066\u307e\u3059\u3002\nDAC\u306b\u3088\u308b\u5236\u5fa1\u3067\u306f\u3001\u4f8b\u3048\u3070root\u306e\u307f\u95b2\u89a7\u53ef\u80fd\u306a/root\u3084\u30ed\u30b0\u3068\u304b\u306f\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u305b\u3093\u3057\u3001\u307e\u305fMAC\u306b\u3088\u308b\u5236\u5fa1\u3067\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u3059\u304c\u3001ClamAV\u3068SELinux\u53cc\u65b9\u3067\u5b88\u5099\u3059\u308b\u3068\u3044\u3046\u8003\u3048\u65b9\u3067\u3001\u3053\u308c\u3067\u3088\u3057\u3068\u3057\u307e\u3057\u305f\u3002\n\n\u307e\u3042\u6c17\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u6642\u306f\u3001root\u30e6\u30fc\u30b6\u306b\u3066clamscan\u3092\u624b\u52d5\u3067\u5b9f\u884c\u3055\u305b\u307e\u3057\u3087\u3046\u3002\n\n\n## 2. \u30a6\u30a4\u30eb\u30b9\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\nfreshclam\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u898b\u308b\u3068\u3001-d\u30aa\u30d7\u30b7\u30e7\u30f3\u3068-c\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u81ea\u52d5\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n```shell-session\n# man freshclam\nfreshclam(1)                    Clam AntiVirus                    freshclam(1)\n\nNAME\n       freshclam - update virus databases\n\nSYNOPSIS\n       freshclam [options]\n\nDESCRIPTION\n       freshclam is a virus database update tool for ClamAV.\n\nOPTIONS\n       Freshclam  reads its configuration from freshclam.conf. The settings can be overwritten with\n       command line options.\n\n\uff5e\u7701\u7565\uff5e\n       -d, --daemon\n              Run in a daemon mode. This option requires --checks.  -p FILE, --pid=FILE Write  dae-\n              mon\u2019s pid to FILE.\n\n       --no-dns\n              This option forces old non-DNS verification method (without a TTL delay).\n\n       -c #n, --checks=#n\n              Check #n times per day for a new database. #n must be between 1 and 50.\n\uff5e\u5f8c\u7565\uff5e\n```\n\n1\u65e51\u56de\u306e\u983b\u5ea6\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3088\u3046\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\n```shell-session\n# freshclam -d -c 1\n# ps -ef | grep fresh\nclam     17534     1 64 09:28 ?        00:00:02 freshclam -d -c 1\nroot     17536 17327  0 09:28 pts/0    00:00:00 grep fresh\n#\n```\n\n\u307e\u305fOS\u518d\u8d77\u52d5\u6642\u306b\u3082freshclam\u304c\u8d77\u52d5\u3059\u308b\u3088\u3046 /etc/rc.local \u3078\u4e0b\u8a18\u3092\u8ffd\u8a18\u3057\u3066\u307e\u3059\u3002\n\n```/etc/rc.local\n/usr/bin/freshclam -d -c 1\n```\n\n\u3042\u3068\u9806\u756a\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3059\u304c\u3001freshclam\u3067\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3057\u305f\u3089\u3001clamd\u306b\u305d\u308c\u3092RELOAD\u3057\u3066\u3082\u3089\u3046\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u9023\u643a\u304c\u5fc5\u8981\u3067\u3059\u3002\nfreshclam.conf \u306b\u305d\u306e\u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u3042\u308b\u306e\u3067\u3001clamd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u5909\u66f4\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```/etc/freshclam.conf\n# Send the RELOAD command to clamd.\n# Default: no\nNotifyClamd /etc/clamd.conf\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u306e\u3067\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\n# killall freshclam && freshclam -d -c1\n```\n\n\u203b\u5f8c\u3067\u6c17\u4ed8\u3044\u305f\u306e\u3067\u3059\u304c\u3001/etc/cron.daily/freshclam\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30011\u65e51\u56de\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306a\u3089cron\u306b\u4efb\u305b\u3061\u3083\u3046\u306e\u304c\u3044\u3044\u3067\u3059\u306d\u3002\u306a\u306e\u3067rc.local\u306e\u81ea\u52d5\u8d77\u52d5\u3082\u4e0d\u8981\u3067\u3059\u3002\n\n## 3. \u6d3b\u7528\n\u3068\u308a\u3042\u3048\u305a\u5165\u308c\u3066\u307f\u305f\u3068\u3044\u3046\u624b\u9806\u306a\u306e\u3067\u3001\u904b\u7528\u3081\u3044\u305f\u3053\u3068\u306f\u8003\u3048\u3066\u306a\u3044\u306e\u3067\u3059\u304c\u3001clamd\u3067\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30e1\u30fc\u30eb\u306e\u30a6\u30a4\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3092\u3057\u305f\u308a\u3001\u5916\u90e8\u304b\u3089STREAM\u3067\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3066\u30a6\u30a4\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3082\u3089\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\nClamAV\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u304c\u3057\u3063\u304b\u308a\u3057\u3066\u3044\u308b\u306e\u3067\u3001clamd\u3084clamd.conf\u306eman\u3092\u898b\u3066\u4f7f\u3048\u305d\u3046\u306a\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u63a2\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u3067\u306f\u3067\u306f\u3002\n"}