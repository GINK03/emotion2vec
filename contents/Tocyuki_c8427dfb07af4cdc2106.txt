{"tags": ["CentOS", "mdadm", "RAID", "Linux"], "context": "\n\n\u74b0\u5883\n\n\nHDD:500GB * 4\nCentOS7.1\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306bmdadm\u3067RAID10\u69cb\u7bc9\n\n\n\u306a\u306b\u304c\u8d77\u304d\u305f\u306e\uff1f\n\n\nCentOS7\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u8d77\u52d5\u3057\u305f\u3089\u306a\u305c\u304b\u3053\u3093\u306a\u72b6\u614b\n\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n\nsdb\u306eHDD\u304c\u8a8d\u8b58\u3057\u3066\u3044\u306a\u3044\uff01\uff1f\n\n\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u3092\u78ba\u8a8d\n\n[root@localhost ~]# cat /var/log/messages | grep sdb\nMar 23 12:04:20 localhost kernel: md/raid10:md124: Disk failure on sdb1, disabling device.#012md/raid10:md124: Operation continuing on 3 devices.\nMar 23 12:04:20 localhost kernel: md/raid10:md126: Disk failure on sdb3, disabling device.#012md/raid10:md126: Operation continuing on 3 devices.\nMar 23 12:04:20 localhost kernel: md/raid10:md127: Disk failure on sdb5, disabling device.#012md/raid10:md127: Operation continuing on 3 devices.\n\n\u306a\u3093\u304bFail\u3057\u3066\u308b\uff01\uff1f\n\n\u7269\u7406\u7684\u306a\u72b6\u6cc1\u3092\u78ba\u8a8d\n\n[root@localhost ~]# smartctl -a /dev/sdb\n---\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   200   200   051    Pre-fail  Always       -       1\n  3 Spin_Up_Time            0x0003   177   174   021    Pre-fail  Always       -       6150\n  4 Start_Stop_Count        0x0032   100   100   000    Old_age   Always       -       267\n  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000e   200   200   051    Old_age   Always       -       0\n  9 Power_On_Hours          0x0032   037   037   000    Old_age   Always       -       46253\n 10 Spin_Retry_Count        0x0012   100   100   051    Old_age   Always       -       0\n 11 Calibration_Retry_Count 0x0012   100   100   051    Old_age   Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       261\n192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       274\n193 Load_Cycle_Count        0x0032   200   200   000    Old_age   Always       -       289\n194 Temperature_Celsius     0x0022   108   096   000    Old_age   Always       -       42\n196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0012   200   200   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   200   200   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       1\n200 Multi_Zone_Error_Rate   0x0008   200   197   051    Old_age   Offline      -       0\n---\n\n\u7269\u7406\u7684\u306b\u306f\u5927\u4e08\u592b\u305d\u3046\uff1f\n\n\u3068\u308a\u3042\u3048\u305a\u304f\u3063\u3064\u3051\u76f4\u3057\u3066\u307f\u305f\n\n[root@localhost ~]# mdadm -a /dev/md124 /dev/sdb1\nmdadm: re-added /dev/sdb1\n\n\u78ba\u8a8d\u3057\u3066\u307f\u308b\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd127 : active raid10 sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n\nunused devices: <none>\n\n\u306a\u3093\u304b\u5927\u4e08\u592b\u305d\u3046\u306a\u306e\u3067\u4ed6\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3082\u304f\u3063\u3064\u3051\u3066\u307f\u308b\n[root@localhost ~]# mdadm -a /dev/md125 /dev/sdb2\nmdadm: re-added /dev/sdb2\n[root@localhost ~]# mdadm -a /dev/md126 /dev/sdb3\nmdadm: re-added /dev/sdb3\n[root@localhost ~]# mdadm -a /dev/md127 /dev/sdb5\nmdadm: added /dev/sdb5\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      [=================>...]  recovery = 87.1% (11635712/13351936) finish=0.1min speed=207966K/sec\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n        resync=DELAYED\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n        resync=DELAYED\n\nunused devices: <none>\n\n\u5f85\u3064\u3053\u3068\u6570\u5206\u30fb\u30fb\u30fb\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n\nunused devices: <none>\n\n\u76f4\u3063\u305f\uff0d\uff01\n\n\u5ff5\u306e\u305f\u3081\u30c1\u30a7\u30c3\u30af\u3057\u3066\u307f\u308b\n\n[root@localhost ~]# echo check > /sys/block/md124/md/sync_action\n\n\u9032\u6357\u72b6\u6cc1\u306e\u78ba\u8a8d\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      [=>...................]  check =  9.6% (91577856/945133568) finish=142.0min speed=100136K/sec\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n\nunused devices: <none>\n\n\u3048\u3089\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u305d\u3046\u30fb\u30fb\u30fb\u30fb\n\u3067\u3082\u3068\u308a\u3042\u3048\u305a\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\uff01\n\uff082016/04/12\u8ffd\u8a18\uff09\n\u5168\u7136\u5927\u4e08\u592b\u3058\u3083\u306a\u304f\u3066\u3053\u306e\u5f8c\u666e\u901a\u306bHDD\u58ca\u308c\u3066\u4ea4\u63db\u3057\u307e\u3057\u305f\u7b11\n\u3053\u3061\u3089\u306b\u5f8c\u65e5\u8ac7\u8a18\u4e8b\u3092\u63b2\u8f09\u3057\u307e\u3057\u305f\u3002\n\n\u53c2\u8003\u60c5\u5831\n\n\u3046\u307e\u3044\u307c\u3046\u3076\u308d\u3050\n# **\u74b0\u5883**\n- HDD:500GB * 4\n- CentOS7.1\n- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306bmdadm\u3067RAID10\u69cb\u7bc9\n\n# **\u306a\u306b\u304c\u8d77\u304d\u305f\u306e\uff1f**\n## **CentOS7\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u8d77\u52d5\u3057\u305f\u3089\u306a\u305c\u304b\u3053\u3093\u306a\u72b6\u614b**\n\n```shell-session\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n```\n\nsdb\u306eHDD\u304c\u8a8d\u8b58\u3057\u3066\u3044\u306a\u3044\uff01\uff1f\n\n## **\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u3092\u78ba\u8a8d**\n\n```shell-session\n[root@localhost ~]# cat /var/log/messages | grep sdb\nMar 23 12:04:20 localhost kernel: md/raid10:md124: Disk failure on sdb1, disabling device.#012md/raid10:md124: Operation continuing on 3 devices.\nMar 23 12:04:20 localhost kernel: md/raid10:md126: Disk failure on sdb3, disabling device.#012md/raid10:md126: Operation continuing on 3 devices.\nMar 23 12:04:20 localhost kernel: md/raid10:md127: Disk failure on sdb5, disabling device.#012md/raid10:md127: Operation continuing on 3 devices.\n```\n\n\u306a\u3093\u304bFail\u3057\u3066\u308b\uff01\uff1f\n\n## **\u7269\u7406\u7684\u306a\u72b6\u6cc1\u3092\u78ba\u8a8d**\n\n```shell-session\n[root@localhost ~]# smartctl -a /dev/sdb\n---\nVendor Specific SMART Attributes with Thresholds:\nID# ATTRIBUTE_NAME          FLAG     VALUE WORST THRESH TYPE      UPDATED  WHEN_FAILED RAW_VALUE\n  1 Raw_Read_Error_Rate     0x000f   200   200   051    Pre-fail  Always       -       1\n  3 Spin_Up_Time            0x0003   177   174   021    Pre-fail  Always       -       6150\n  4 Start_Stop_Count        0x0032   100   100   000    Old_age   Always       -       267\n  5 Reallocated_Sector_Ct   0x0033   200   200   140    Pre-fail  Always       -       0\n  7 Seek_Error_Rate         0x000e   200   200   051    Old_age   Always       -       0\n  9 Power_On_Hours          0x0032   037   037   000    Old_age   Always       -       46253\n 10 Spin_Retry_Count        0x0012   100   100   051    Old_age   Always       -       0\n 11 Calibration_Retry_Count 0x0012   100   100   051    Old_age   Always       -       0\n 12 Power_Cycle_Count       0x0032   100   100   000    Old_age   Always       -       261\n192 Power-Off_Retract_Count 0x0032   200   200   000    Old_age   Always       -       274\n193 Load_Cycle_Count        0x0032   200   200   000    Old_age   Always       -       289\n194 Temperature_Celsius     0x0022   108   096   000    Old_age   Always       -       42\n196 Reallocated_Event_Count 0x0032   200   200   000    Old_age   Always       -       0\n197 Current_Pending_Sector  0x0012   200   200   000    Old_age   Always       -       0\n198 Offline_Uncorrectable   0x0010   200   200   000    Old_age   Offline      -       0\n199 UDMA_CRC_Error_Count    0x003e   200   200   000    Old_age   Always       -       1\n200 Multi_Zone_Error_Rate   0x0008   200   197   051    Old_age   Offline      -       0\n---\n```\n\n\u7269\u7406\u7684\u306b\u306f\u5927\u4e08\u592b\u305d\u3046\uff1f\n\n## **\u3068\u308a\u3042\u3048\u305a\u304f\u3063\u3064\u3051\u76f4\u3057\u3066\u307f\u305f**\n\n```shell-session\n[root@localhost ~]# mdadm -a /dev/md124 /dev/sdb1\nmdadm: re-added /dev/sdb1\n```\n\n\u78ba\u8a8d\u3057\u3066\u307f\u308b\n\n```shell-session\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd127 : active raid10 sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n\nunused devices: <none>\n```\n\n\u306a\u3093\u304b\u5927\u4e08\u592b\u305d\u3046\u306a\u306e\u3067\u4ed6\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3082\u304f\u3063\u3064\u3051\u3066\u307f\u308b\n\n```shell-session\n[root@localhost ~]# mdadm -a /dev/md125 /dev/sdb2\nmdadm: re-added /dev/sdb2\n[root@localhost ~]# mdadm -a /dev/md126 /dev/sdb3\nmdadm: re-added /dev/sdb3\n[root@localhost ~]# mdadm -a /dev/md127 /dev/sdb5\nmdadm: added /dev/sdb5\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n      [=================>...]  recovery = 87.1% (11635712/13351936) finish=0.1min speed=207966K/sec\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/3] [U_UU]\n        resync=DELAYED\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/3] [U_UU]\n        resync=DELAYED\n\nunused devices: <none>\n```\n\n\u5f85\u3064\u3053\u3068\u6570\u5206\u30fb\u30fb\u30fb\n\n```shell-session\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 1/1 pages [4KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n\nunused devices: <none>\n```\n\n\u76f4\u3063\u305f\uff0d\uff01\n\n## **\u5ff5\u306e\u305f\u3081\u30c1\u30a7\u30c3\u30af\u3057\u3066\u307f\u308b**\n\n```shell-session\n[root@localhost ~]# echo check > /sys/block/md124/md/sync_action\n```\n\n\u9032\u6357\u72b6\u6cc1\u306e\u78ba\u8a8d\n\n```shell-session\n[root@localhost ~]# cat /proc/mdstat\nPersonalities : [raid10]\nmd124 : active raid10 sdb1[1] sdd1[3] sdc1[2] sda1[0]\n      945133568 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      [=>...................]  check =  9.6% (91577856/945133568) finish=142.0min speed=100136K/sec\n      bitmap: 0/8 pages [0KB], 65536KB chunk\n\nmd125 : active raid10 sdb2[1] sdd2[3] sdc2[2] sda2[0]\n      26703872 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd126 : active raid10 sdb3[1] sdd3[3] sdc3[2] sda3[0]\n      513024 blocks super 1.0 512K chunks 2 near-copies [4/4] [UUUU]\n      bitmap: 0/1 pages [0KB], 65536KB chunk\n\nmd127 : active raid10 sdb5[4] sdd5[3] sdc5[2] sda5[0]\n      4136960 blocks super 1.2 512K chunks 2 near-copies [4/4] [UUUU]\n\nunused devices: <none>\n```\n\n\u3048\u3089\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u305d\u3046\u30fb\u30fb\u30fb\u30fb\n\u3067\u3082\u3068\u308a\u3042\u3048\u305a\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\uff01\n\n\uff082016/04/12\u8ffd\u8a18\uff09\n\u5168\u7136\u5927\u4e08\u592b\u3058\u3083\u306a\u304f\u3066\u3053\u306e\u5f8c\u666e\u901a\u306bHDD\u58ca\u308c\u3066\u4ea4\u63db\u3057\u307e\u3057\u305f\u7b11\n[\u3053\u3061\u3089](http://qiita.com/Tocyuki/items/3ee43e242418d10065a7)\u306b\u5f8c\u65e5\u8ac7\u8a18\u4e8b\u3092\u63b2\u8f09\u3057\u307e\u3057\u305f\u3002\n\n\n\n# **\u53c2\u8003\u60c5\u5831**\n[\u3046\u307e\u3044\u307c\u3046\u3076\u308d\u3050](http://hogem.hatenablog.com/entry/20120318/1332089149)\n"}