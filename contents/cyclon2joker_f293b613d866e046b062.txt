{"context": "\u30fb\u76ee\u7684\n\u30b9\u30de\u30d5\u30a9\u304b\u3089\u5916\u90e8\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066ESP8266\u306b\u7e4b\u3052\u3066\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u70ba\u306e\u4e88\u5099\u5b9f\u9a13\u3002\n\u52a0\u3048\u3066\u8868\u793a\u3059\u308bHTML\u3092SPIFFS\u306b\u3066\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53d6\u3063\u3066\u8868\u793a\u3055\u305b\u3066\u307f\u308b\u3002\n\u30fb\u6e96\u5099\n1.\n\u3068\u308a\u3042\u3048\u305a\u3001AP/Web\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u3066\u30b9\u30de\u30d5\u30a9\u304b\u3089\u307f\u308c\u308b\u304b\u3069\u30fc\u304b\u3092\u30c6\u30b9\u30c8\u3002\n\u4ee5\u4e0b\u3001\u66f8\u304d\u8fbc\u3080\u30bd\u30fc\u30b9\u3002\n#include <ESP8266WiFi.h>\n#include <ESP8266WebServer.h>\n\nstatic const char *ssid = \"gkgk\";\nstatic const char *pwd = \"12341234\";\n\nESP8266WebServer server(1234); \nIPAddress ip( 192, 168, 128, 21); \nIPAddress subnet( 255, 255, 255, 0 ); \n\nvoid handleRoot() {\n    Serial.println(\"receive req: /\");\n    server.send(200, \"text/html\", \"<h1>Welcome GKGK</h1>\");\n}\n\nvoid setup() { \n  Serial.begin(9600);\n  WiFi.mode(WIFI_AP); \n  WiFi.softAPConfig(ip, ip, subnet); \n  WiFi.softAP(ssid, pwd); \n  server.on(\"/\", handleRoot); \n  server.begin();\n  Serial.println(\"ap setup...\"); \n} \nvoid loop() { \n  server.handleClient(); \n}\n\nAP\nSSID:gkgk\npwd:12341234\nWebServer\n192.168.128.21:1234/\n\u3068\u3057\u305f\u3002\n\u30d3\u30eb\u30c9\u3057\u3066\u66f8\u304d\u8fbc\u3093\u3067\u5b9f\u884c\u3002\niphone\u3067esp8266\u306bwifi\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3002\n\n\u7e4b\u304c\u3063\u305f\u3002\nchrome\u3067\u898b\u3066\u307f\u308b\u3002\nhttp://192.168.128.21:1234\n\nAruduino\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u3082\u78ba\u8a8d\u3002\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u4fe1\u3057\u3066\u30b7\u30ea\u30a2\u30eb\u306b\u51fa\u529b\u3057\u3066\u3044\u308b\u3002\n\u306a\u3093\u3068\u3044\u3046\u624b\u8efd\u3055\u3002\u3002\u3002\n2.\nSPIFFS\u3067\u5185\u90e8\u30d5\u30e9\u30c3\u30b7\u30e5\uff1f\u306b\u66f8\u3044\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u8aad\u3081\u308b\u3088\u3046\u306b\u74b0\u5883\u3092\u4f5c\u308b\u3002\n[1]\n\u4e0b\u8a18\u306e\u30da\u30fc\u30b8\u306b\u98db\u3073\u3001\nhttps://github.com/esp8266/arduino-esp8266fs-plugin\nDownload the tool archive from releases page\n\u306e\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001zip\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\u3002\n[2]\n\u89e3\u51cd\u3057\u305f\u3082\u306e\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7f6e\u304f\u3002\n[Aruduino\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d5\u30a9\u30eb\u30c0]/Arduino/tools/ESP8266FS/tool/esp8266fs.jar\n\n[3]\nIDE\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u518d\u8d77\u52d5\u3002\nIDE\u306e\u30c4\u30fc\u30eb\u306b\u3001\u300cESP8266 Sketch Data Upload\u300d\u304c\u51fa\u3066\u3044\u308c\u3070OK\u3002\n3.\n\u30ea\u30bd\u30fc\u30b9\u306e\u6e96\u5099\n[1]\n\u30b9\u30b1\u30c3\u30c1\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u3001data\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\n[2]\nindex\u30da\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30d5\u30a1\u30a4\u30eb\u3067\u7528\u610f\u3002\n\u4ee5\u4e0b\u30bd\u30fc\u30b9\u3002\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"utf-8\">\n    <title>GKGK TEST</title>\n  </head>\n  <body>\n    <h1>Welcome...</h1>\n    <h2>GKGK Test Resource HTML...</h2><br/>\n    <form name=\"g_form\" method=\"post\" action=\"/\">\n        <img src=\"${img}\" onclick=\"forms['g_form'].submit();\"/><br/>\n        <input type=\"hidden\" name=\"FLAG\" value=\"${flag}\" />\n        <input type=\"submit\" value=\"${submit_msg}\"/>\n    </form>\n  </body>\n</html>\n\n\n\u30b5\u30d6\u30df\u30c3\u30c8\u30dc\u30bf\u30f3\u3082\u3057\u304f\u306f\u3001\u753b\u50cf\u3092\u62bc\u3057\u305f\u3089\u8868\u793a\u304c\u5207\u308a\u66ff\u308f\u308b\u611f\u3058\u3002\n[3]\ndata\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3001\u8868\u793a\u3055\u305b\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u914d\u7f6e\u3002\n\n\u8868\u793a\u3055\u305b\u308bindex\u30da\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3001\u305d\u306eHTML\u5185\u306b\u8868\u793a\u3059\u308b\n\u753b\u50cf\u3092\u7528\u610f\u3057\u305f\u3002\n[4]\nIDE\u306e\u30c4\u30fc\u30eb->ESP8266 Sketch Data Upload\u3092\u30af\u30ea\u30c3\u30af\u3002\nESP8266\u3078\u306e\u66f8\u304d\u8fbc\u307f\u304c\u59cb\u307e\u308b\u3002\n\n4.\nAruduino\u5074\u306e\u5b9f\u88c5\u3002\n#include <ESP8266WiFi.h>\n#include <ESP8266WebServer.h>\n#include <FS.h>\n\nstatic const char *ssid = \"gkgk\";\nstatic const char *pwd = \"12341234\";\n\nESP8266WebServer server(1234); \nIPAddress ip( 192, 168, 128, 21); \nIPAddress subnet( 255, 255, 255, 0 );\n\nString strIndexHtml;\nboolean flagGod;\n\n// index\u30da\u30fc\u30b8\nvoid handleRoot() {\n\n    Serial.println(\"receive req: /\");\n    // Post\u306e\u5834\u5408\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089\u30d5\u30e9\u30b0\u3092\u8a2d\u5b9a\n    if (server.method() == HTTP_POST) {\n      String s = server.arg(\"FLAG\");\n      if (s == \"1\") {\n        flagGod = true;\n      } else {\n        flagGod = false;\n      }\n    }\n    // \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306eindex\u30da\u30fc\u30b8\u6587\u5b57\u5217\u3092\u30d5\u30e9\u30b0\u306b\u3088\u3063\u3066\u8a2d\u5b9a\n    String msg = \"\";\n    if (!flagGod) {\n      msg = \"\u30c1\u30a7\u30f3\u30b8\u30fb\u3077\u3089\u3044\u3079\u30fc\u3068\u30e2\u30fc\u30c9\uff01\";\n    } else {\n       msg = \"\u30c1\u30a7\u30f3\u30b8\u30fb\u30d3\u30b8\u30cd\u30b9\u30e2\u30fc\u30c9\uff01\";\n    }\n    String arg1 = \"${submit_msg}\";\n    String tmpl = \"\" + strIndexHtml;\n    tmpl.replace(arg1, msg);\n    tmpl.replace(\"${flag}\", flagGod ? \"0\" : \"1\");\n    tmpl.replace(\"${img}\", flagGod ? \"/img2.gif\" : \"/img1.gif\");\n    Serial.println(tmpl);\n\n    // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3059\n    server.send(200, \"text/html\", tmpl);\n\n}\n\n// /img1.gif\u30cf\u30f3\u30c9\u30e9\nvoid handleImg1() {\n    Serial.println(\"receive req: /img1.gif\");\n    // \u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3092\u304b\u3048\u3059\u3002\n    SPIFFS.begin();\n    File hogeFile = SPIFFS.open(\"/god_on.gif\", \"r\");\n    // \u30d0\u30a4\u30ca\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8fd4\u3059\u306a\u3089\u3053\u3093\u306a\u611f\u3058\u3002\n    server.streamFile(hogeFile, \"image/gif\");\n    hogeFile.close();\n}\n// /img2.gif\u30cf\u30f3\u30c9\u30e9\nvoid handleImg2() {\n    Serial.println(\"receive req: /img2.gif\");\n\n    // \u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3092\u304b\u3048\u3059\u3002\n     SPIFFS.begin();\n    File hogeFile = SPIFFS.open(\"/god_off.gif\", \"r\");\n    // \u30d0\u30a4\u30ca\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8fd4\u3059\u306a\u3089\u3053\u3093\u306a\u611f\u3058\u3002\n    server.streamFile(hogeFile, \"image/gif\");\n    hogeFile.close();\n}\n\n// \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\nString loadTextFile(String path) {\n  String txt = \"\";\n  String line = \"\";\n  char c;\n  File hogeFile = SPIFFS.open(path, \"r\");\n    strIndexHtml = \"\";\n  if (hogeFile) {\n    Serial.println(\"file open success...\");\n\n    while (hogeFile.available()) {\n      // \uff11\u6587\u5b57\u8aad\u307f\u8fbc\u307f\n      c = hogeFile.read();\n      // \u6539\u884c\u306e\u5834\u5408\n      if (c == '\\n' || c == '\\r') {\n        // \u884c\u6587\u5b57\u5217\u306e\u9577\u3055\u304c\uff11\u4ee5\u4e0a\u306e\u5834\u5408\n        if (line.length() > 0) {\n          txt = txt + line + \"\\n\";\n          //Serial.println(line);\n        }\n        // \u6539\u884c\u6587\u5b57\u304c\u6765\u305f\u306e\u3067\u884c\u6587\u5b57\u5217\u3092\u30af\u30ea\u30a2\n        line = \"\";\n      } else {\n        // \u6539\u884c\u6587\u5b57\u3067\u306a\u3051\u308c\u3070\u884c\u6587\u5b57\u5217\u306b\u8aad\u307f\u8fbc\u3093\u30601\u6587\u5b57\u3092\u8ffd\u52a0\n        line = line + String(c);       \n      }\n    }\n    if (line.length() > 0) {\n      txt = txt + line;\n    }\n\n    hogeFile.close();\n  } else {\n    Serial.println(\"file open failed...\");\n  }\n  Serial.println(path + \" is loaded...\");\n\n  return txt;\n\n}\n\n\n// \u30ea\u30bd\u30fc\u30b9\u8aad\u307f\u8fbc\u307f\nvoid loadHtmlResource() {\n\n  String line = \"\";\n  char c;\n\n  SPIFFS.begin();\n//  Dir dir = SPIFFS.openDir(\"/\");\n//  while (dir.next()) {\n//    Serial.print(dir.fileName());\n//    File f = dir.openFile(\"r\");\n//    Serial.println(String(\" \") + f.size());\n//  }\n\n  strIndexHtml = loadTextFile(\"/index.html\");\n}\n\n\n\nvoid setup() { \n  flagGod = false;\n  Serial.begin(9600);\n  WiFi.mode(WIFI_AP); \n  WiFi.softAPConfig(ip, ip, subnet); \n  WiFi.softAP(ssid, pwd); \n\n  // \u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n  server.on(\"/\", handleRoot); \n  server.on(\"/img1.gif\", handleImg1); \n  server.on(\"/img2.gif\", handleImg2); \n\n  server.begin();\n  Serial.println(\"ap setup...\"); \n  loadHtmlResource();\n  Serial.println(strIndexHtml);\n  Serial.println(\"load complete...\");\n} \nvoid loop() { \n  server.handleClient(); \n}\n\n\u30d5\u30e9\u30b0\u3067\u753b\u50cf\u3092\u5207\u308a\u66ff\u3048\u308b\u611f\u3058\u306e\u51e6\u7406\u306b\u3057\u3066\u3044\u308b\u3002\n\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u3068\u304b\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u7121\u8996\u3002\u3002\u3002\n\u51e6\u7406\u306e\u5207\u308a\u66ff\u3048\u306b\u3088\u308b\u30a2\u30af\u30b7\u30e7\u30f3\u3092L\u30c1\u30ab\u3067\u3057\u3066\u3082\u826f\u304b\u3063\u305f\u304c\u3001\n\u753b\u50cf\u306e\u3088\u30fc\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u3069\u3046\u6271\u3046\u304b\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u3057\u305f\u3002\n\u30fb\u5b9f\u884c\u78ba\u8a8d\n\u524d\u8ff0\u306e\u30bd\u30fc\u30b9\u3092\u30d3\u30eb\u30c9\u3057\u3066ESP8266\u4e0a\u306b\u30ed\u30fc\u30c9\u3057\u3001\u5b9f\u884c\u3002\niphone\u3067\u63a5\u7d9a\u3057\u3066\u3001\u753b\u9762\u3092\u898b\u308b\u3002\n\n\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3060\u3082\u306e\u3092\u8868\u793a\u51fa\u6765\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\u65e5\u672c\u8a9e\u3082\u4f55\u3082\u6c17\u306b\u305b\u305a\u51fa\u308b\u3093\u3060\u306a\u3041\u3002\u3002\u3002\n\u3067\u3001\u30d3\u30b8\u30cd\u30b9\u30e2\u30fc\u30c9\u306b\u3059\u308b\u70ba\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3002\n\nPOST\u306e\u51e6\u7406\u3082\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3002\n\u518d\u5ea6\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u5143\u306e\u753b\u9762\u304c\u51fa\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u7121\u4e8b\u623b\u308bw\n\u30fbTODO\n\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u611f\u3058\u306b\u3059\u308b\u306e\u306f\u3069\u30fc\u3057\u305f\u826f\u3044\u304b\u8abf\u3079\u308b\u3002\n\uff08\u305d\u3082\u305d\u3082\u3001Arduino\u7684\u306b\u306f\u3069\u30fc\u306a\u3093\u3060\u308d\u3046\u3002\u3002\u3002\uff09\nBasic\u8a8d\u8a3c\u3068\u304b\u3067\u304d\u308b\u3063\u307d\u3044\u306e\u3067\u3001\u8abf\u3079\u3066\u304a\u304f\u3002\n\n\u30fb\u76ee\u7684\n\u30b9\u30de\u30d5\u30a9\u304b\u3089\u5916\u90e8\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066ESP8266\u306b\u7e4b\u3052\u3066\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u70ba\u306e\u4e88\u5099\u5b9f\u9a13\u3002\n\u52a0\u3048\u3066\u8868\u793a\u3059\u308bHTML\u3092SPIFFS\u306b\u3066\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u53d6\u3063\u3066\u8868\u793a\u3055\u305b\u3066\u307f\u308b\u3002\n\n\u30fb\u6e96\u5099\n\n1.\n\u3068\u308a\u3042\u3048\u305a\u3001AP/Web\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u3066\u30b9\u30de\u30d5\u30a9\u304b\u3089\u307f\u308c\u308b\u304b\u3069\u30fc\u304b\u3092\u30c6\u30b9\u30c8\u3002\n\n\u4ee5\u4e0b\u3001\u66f8\u304d\u8fbc\u3080\u30bd\u30fc\u30b9\u3002\n\n```\n#include <ESP8266WiFi.h>\n#include <ESP8266WebServer.h>\n\nstatic const char *ssid = \"gkgk\";\nstatic const char *pwd = \"12341234\";\n\nESP8266WebServer server(1234); \nIPAddress ip( 192, 168, 128, 21); \nIPAddress subnet( 255, 255, 255, 0 ); \n\nvoid handleRoot() {\n    Serial.println(\"receive req: /\");\n    server.send(200, \"text/html\", \"<h1>Welcome GKGK</h1>\");\n}\n\nvoid setup() { \n  Serial.begin(9600);\n  WiFi.mode(WIFI_AP); \n  WiFi.softAPConfig(ip, ip, subnet); \n  WiFi.softAP(ssid, pwd); \n  server.on(\"/\", handleRoot); \n  server.begin();\n  Serial.println(\"ap setup...\"); \n} \nvoid loop() { \n  server.handleClient(); \n}\n```\n\nAP\nSSID:gkgk\npwd:12341234\n\nWebServer\n192.168.128.21:1234/\n\n\u3068\u3057\u305f\u3002\n\n\u30d3\u30eb\u30c9\u3057\u3066\u66f8\u304d\u8fbc\u3093\u3067\u5b9f\u884c\u3002\n\niphone\u3067esp8266\u306bwifi\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3002\n\n![ap_cap.png](https://qiita-image-store.s3.amazonaws.com/0/38889/5620e508-67c7-f899-67f7-3c21b14f6238.png \"ap_cap.png\")\n\n\n\u7e4b\u304c\u3063\u305f\u3002\n\nchrome\u3067\u898b\u3066\u307f\u308b\u3002\nhttp://192.168.128.21:1234\n\n![cap_1.png](https://qiita-image-store.s3.amazonaws.com/0/38889/c98de3fd-8388-a958-48bc-db07050bcbbb.png \"cap_1.png\")\n\nAruduino\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u3082\u78ba\u8a8d\u3002\n![cap_2.png](https://qiita-image-store.s3.amazonaws.com/0/38889/18905bba-d0ed-979f-fd1e-79b18e67be74.png \"cap_2.png\")\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u4fe1\u3057\u3066\u30b7\u30ea\u30a2\u30eb\u306b\u51fa\u529b\u3057\u3066\u3044\u308b\u3002\n\u306a\u3093\u3068\u3044\u3046\u624b\u8efd\u3055\u3002\u3002\u3002\n\n\n2.\nSPIFFS\u3067\u5185\u90e8\u30d5\u30e9\u30c3\u30b7\u30e5\uff1f\u306b\u66f8\u3044\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u8aad\u3081\u308b\u3088\u3046\u306b\u74b0\u5883\u3092\u4f5c\u308b\u3002\n[1]\n\u4e0b\u8a18\u306e\u30da\u30fc\u30b8\u306b\u98db\u3073\u3001\nhttps://github.com/esp8266/arduino-esp8266fs-plugin\n\nDownload the tool archive from releases page\n\u306e\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001zip\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\u3002\n\n[2]\n\u89e3\u51cd\u3057\u305f\u3082\u306e\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7f6e\u304f\u3002\n\n```\n[Aruduino\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30d5\u30a9\u30eb\u30c0]/Arduino/tools/ESP8266FS/tool/esp8266fs.jar\n```\n\n[3]\nIDE\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u518d\u8d77\u52d5\u3002\nIDE\u306e\u30c4\u30fc\u30eb\u306b\u3001\u300cESP8266 Sketch Data Upload\u300d\u304c\u51fa\u3066\u3044\u308c\u3070OK\u3002\n\n\n3.\n\u30ea\u30bd\u30fc\u30b9\u306e\u6e96\u5099\n[1]\n\u30b9\u30b1\u30c3\u30c1\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u3001data\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n![ap_cap_5.png](https://qiita-image-store.s3.amazonaws.com/0/38889/ebc84362-5af4-26b9-7d4d-e7cb3a40d791.png \"ap_cap_5.png\")\n\n[2]\nindex\u30da\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30d5\u30a1\u30a4\u30eb\u3067\u7528\u610f\u3002\n\u4ee5\u4e0b\u30bd\u30fc\u30b9\u3002\n\n```\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"utf-8\">\n    <title>GKGK TEST</title>\n  </head>\n  <body>\n    <h1>Welcome...</h1>\n    <h2>GKGK Test Resource HTML...</h2><br/>\n    <form name=\"g_form\" method=\"post\" action=\"/\">\n\t    <img src=\"${img}\" onclick=\"forms['g_form'].submit();\"/><br/>\n\t    <input type=\"hidden\" name=\"FLAG\" value=\"${flag}\" />\n    \t<input type=\"submit\" value=\"${submit_msg}\"/>\n    </form>\n  </body>\n</html>\n\n```\n\u30b5\u30d6\u30df\u30c3\u30c8\u30dc\u30bf\u30f3\u3082\u3057\u304f\u306f\u3001\u753b\u50cf\u3092\u62bc\u3057\u305f\u3089\u8868\u793a\u304c\u5207\u308a\u66ff\u308f\u308b\u611f\u3058\u3002\n\n\n[3]\ndata\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3001\u8868\u793a\u3055\u305b\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u914d\u7f6e\u3002\n![ap_cap_6.png](https://qiita-image-store.s3.amazonaws.com/0/38889/baedc6b7-4636-2e4d-a2f3-144fe647f88b.png \"ap_cap_6.png\")\n\n\u8868\u793a\u3055\u305b\u308bindex\u30da\u30fc\u30b8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3001\u305d\u306eHTML\u5185\u306b\u8868\u793a\u3059\u308b\n\u753b\u50cf\u3092\u7528\u610f\u3057\u305f\u3002\n\n[4]\nIDE\u306e\u30c4\u30fc\u30eb->ESP8266 Sketch Data Upload\u3092\u30af\u30ea\u30c3\u30af\u3002\nESP8266\u3078\u306e\u66f8\u304d\u8fbc\u307f\u304c\u59cb\u307e\u308b\u3002\n![ap_cap_7.png](https://qiita-image-store.s3.amazonaws.com/0/38889/a44e3a2a-2f2d-ab4f-714e-02863cbda776.png \"ap_cap_7.png\")\n\n\n4.\nAruduino\u5074\u306e\u5b9f\u88c5\u3002\n\n```\n#include <ESP8266WiFi.h>\n#include <ESP8266WebServer.h>\n#include <FS.h>\n\nstatic const char *ssid = \"gkgk\";\nstatic const char *pwd = \"12341234\";\n\nESP8266WebServer server(1234); \nIPAddress ip( 192, 168, 128, 21); \nIPAddress subnet( 255, 255, 255, 0 );\n\nString strIndexHtml;\nboolean flagGod;\n\n// index\u30da\u30fc\u30b8\nvoid handleRoot() {\n\n    Serial.println(\"receive req: /\");\n    // Post\u306e\u5834\u5408\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089\u30d5\u30e9\u30b0\u3092\u8a2d\u5b9a\n    if (server.method() == HTTP_POST) {\n      String s = server.arg(\"FLAG\");\n      if (s == \"1\") {\n        flagGod = true;\n      } else {\n        flagGod = false;\n      }\n    }\n    // \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306eindex\u30da\u30fc\u30b8\u6587\u5b57\u5217\u3092\u30d5\u30e9\u30b0\u306b\u3088\u3063\u3066\u8a2d\u5b9a\n    String msg = \"\";\n    if (!flagGod) {\n      msg = \"\u30c1\u30a7\u30f3\u30b8\u30fb\u3077\u3089\u3044\u3079\u30fc\u3068\u30e2\u30fc\u30c9\uff01\";\n    } else {\n       msg = \"\u30c1\u30a7\u30f3\u30b8\u30fb\u30d3\u30b8\u30cd\u30b9\u30e2\u30fc\u30c9\uff01\";\n    }\n    String arg1 = \"${submit_msg}\";\n    String tmpl = \"\" + strIndexHtml;\n    tmpl.replace(arg1, msg);\n    tmpl.replace(\"${flag}\", flagGod ? \"0\" : \"1\");\n    tmpl.replace(\"${img}\", flagGod ? \"/img2.gif\" : \"/img1.gif\");\n\tSerial.println(tmpl);\n\n\t// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3059\n    server.send(200, \"text/html\", tmpl);\n\n}\n\n// /img1.gif\u30cf\u30f3\u30c9\u30e9\nvoid handleImg1() {\n    Serial.println(\"receive req: /img1.gif\");\n    // \u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3092\u304b\u3048\u3059\u3002\n  \tSPIFFS.begin();\n    File hogeFile = SPIFFS.open(\"/god_on.gif\", \"r\");\n    // \u30d0\u30a4\u30ca\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8fd4\u3059\u306a\u3089\u3053\u3093\u306a\u611f\u3058\u3002\n    server.streamFile(hogeFile, \"image/gif\");\n    hogeFile.close();\n}\n// /img2.gif\u30cf\u30f3\u30c9\u30e9\nvoid handleImg2() {\n    Serial.println(\"receive req: /img2.gif\");\n    \n    // \u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u753b\u50cf\u3092\u304b\u3048\u3059\u3002\n\t SPIFFS.begin();\n    File hogeFile = SPIFFS.open(\"/god_off.gif\", \"r\");\n    // \u30d0\u30a4\u30ca\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8fd4\u3059\u306a\u3089\u3053\u3093\u306a\u611f\u3058\u3002\n    server.streamFile(hogeFile, \"image/gif\");\n    hogeFile.close();\n}\n\n// \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307f\nString loadTextFile(String path) {\n  String txt = \"\";\n  String line = \"\";\n  char c;\n  File hogeFile = SPIFFS.open(path, \"r\");\n    strIndexHtml = \"\";\n  if (hogeFile) {\n    Serial.println(\"file open success...\");\n\n    while (hogeFile.available()) {\n      // \uff11\u6587\u5b57\u8aad\u307f\u8fbc\u307f\n      c = hogeFile.read();\n      // \u6539\u884c\u306e\u5834\u5408\n      if (c == '\\n' || c == '\\r') {\n        // \u884c\u6587\u5b57\u5217\u306e\u9577\u3055\u304c\uff11\u4ee5\u4e0a\u306e\u5834\u5408\n        if (line.length() > 0) {\n          txt = txt + line + \"\\n\";\n          //Serial.println(line);\n        }\n        // \u6539\u884c\u6587\u5b57\u304c\u6765\u305f\u306e\u3067\u884c\u6587\u5b57\u5217\u3092\u30af\u30ea\u30a2\n        line = \"\";\n      } else {\n        // \u6539\u884c\u6587\u5b57\u3067\u306a\u3051\u308c\u3070\u884c\u6587\u5b57\u5217\u306b\u8aad\u307f\u8fbc\u3093\u30601\u6587\u5b57\u3092\u8ffd\u52a0\n        line = line + String(c);       \n      }\n    }\n    if (line.length() > 0) {\n      txt = txt + line;\n    }\n    \n    hogeFile.close();\n  } else {\n    Serial.println(\"file open failed...\");\n  }\n  Serial.println(path + \" is loaded...\");\n\n  return txt;\n  \n}\n\n\n// \u30ea\u30bd\u30fc\u30b9\u8aad\u307f\u8fbc\u307f\nvoid loadHtmlResource() {\n\n  String line = \"\";\n  char c;\n\n  SPIFFS.begin();\n//  Dir dir = SPIFFS.openDir(\"/\");\n//  while (dir.next()) {\n//    Serial.print(dir.fileName());\n//    File f = dir.openFile(\"r\");\n//    Serial.println(String(\" \") + f.size());\n//  }\n\n  strIndexHtml = loadTextFile(\"/index.html\");\n}\n\n\n\nvoid setup() { \n  flagGod = false;\n  Serial.begin(9600);\n  WiFi.mode(WIFI_AP); \n  WiFi.softAPConfig(ip, ip, subnet); \n  WiFi.softAP(ssid, pwd); \n  \n  // \u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n  server.on(\"/\", handleRoot); \n  server.on(\"/img1.gif\", handleImg1); \n  server.on(\"/img2.gif\", handleImg2); \n\n  server.begin();\n  Serial.println(\"ap setup...\"); \n  loadHtmlResource();\n  Serial.println(strIndexHtml);\n  Serial.println(\"load complete...\");\n} \nvoid loop() { \n  server.handleClient(); \n}\n```\n\n\u30d5\u30e9\u30b0\u3067\u753b\u50cf\u3092\u5207\u308a\u66ff\u3048\u308b\u611f\u3058\u306e\u51e6\u7406\u306b\u3057\u3066\u3044\u308b\u3002\n\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u3068\u304b\u306f\u3001\u3068\u308a\u3042\u3048\u305a\u3001\u7121\u8996\u3002\u3002\u3002\n\u51e6\u7406\u306e\u5207\u308a\u66ff\u3048\u306b\u3088\u308b\u30a2\u30af\u30b7\u30e7\u30f3\u3092L\u30c1\u30ab\u3067\u3057\u3066\u3082\u826f\u304b\u3063\u305f\u304c\u3001\n\u753b\u50cf\u306e\u3088\u30fc\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u3069\u3046\u6271\u3046\u304b\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u3057\u305f\u3002\n\n\n\n\u30fb\u5b9f\u884c\u78ba\u8a8d\n\n\u524d\u8ff0\u306e\u30bd\u30fc\u30b9\u3092\u30d3\u30eb\u30c9\u3057\u3066ESP8266\u4e0a\u306b\u30ed\u30fc\u30c9\u3057\u3001\u5b9f\u884c\u3002\n\niphone\u3067\u63a5\u7d9a\u3057\u3066\u3001\u753b\u9762\u3092\u898b\u308b\u3002\n![pg_1.png](https://qiita-image-store.s3.amazonaws.com/0/38889/5f6ae172-342c-332a-29dc-da2555d3167f.png \"pg_1.png\")\n\n\u30ea\u30bd\u30fc\u30b9\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3060\u3082\u306e\u3092\u8868\u793a\u51fa\u6765\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\u65e5\u672c\u8a9e\u3082\u4f55\u3082\u6c17\u306b\u305b\u305a\u51fa\u308b\u3093\u3060\u306a\u3041\u3002\u3002\u3002\n\u3067\u3001\u30d3\u30b8\u30cd\u30b9\u30e2\u30fc\u30c9\u306b\u3059\u308b\u70ba\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3002\n![pg_2.png](https://qiita-image-store.s3.amazonaws.com/0/38889/126b89f2-2b6a-97bf-aeee-0d5b44173d26.png \"pg_2.png\")\n\nPOST\u306e\u51e6\u7406\u3082\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3002\n\u518d\u5ea6\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u5143\u306e\u753b\u9762\u304c\u51fa\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n![pg_3.png](https://qiita-image-store.s3.amazonaws.com/0/38889/44e34d86-3500-e9e6-9c71-a5478e85432e.png \"pg_3.png\")\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30e2\u30fc\u30c9\u306b\u7121\u4e8b\u623b\u308bw\n\n\n\n\u30fbTODO\n\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u611f\u3058\u306b\u3059\u308b\u306e\u306f\u3069\u30fc\u3057\u305f\u826f\u3044\u304b\u8abf\u3079\u308b\u3002\n\uff08\u305d\u3082\u305d\u3082\u3001Arduino\u7684\u306b\u306f\u3069\u30fc\u306a\u3093\u3060\u308d\u3046\u3002\u3002\u3002\uff09\n\nBasic\u8a8d\u8a3c\u3068\u304b\u3067\u304d\u308b\u3063\u307d\u3044\u306e\u3067\u3001\u8abf\u3079\u3066\u304a\u304f\u3002\n\n\n", "tags": ["ESP8266"]}