{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u4eca\u65e5(2015/12/16)\u304b\u3089\u51ac\u4f11\u307f\u3068\u3044\u3046\u65b9\u3082\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b?\n\u51ac\u4f11\u307f\u306e\u9593 serverless \u3092\u89e6\u308a\u305f\u3044\uff01\u3072\u307e\u3060\u3072\u307e\u3060\uff01\uff01\uff01\uff01\n\u3068\u3044\u3046\u65b9\u306f \u30b7\u30ba\u30aa\u30ab\u30a2\u30d7\u30ea\u30b3\u30f3\u30c6\u30b9\u30c8 \u306b\u53c2\u52a0\u3057\u3066\u307f\u3066\u306f\n\u3044\u304b\u304c\u3067\u3057\u3087\u3046\u304b?\n\u53c2\u52a0\u7533\u3057\u8fbc\u307f\u3092\u3059\u308b\u3060\u3051\u3067 $50\u5206\u306e\u30af\u30fc\u30dd\u30f3 \u304c\u8cb0\u3048\u307e\u3059\u3088\uff01\n\u4eca\u56de\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u3053\u306e\u30b7\u30ba\u30aa\u30ab\u30a2\u30d7\u30ea\u30b3\u30f3\u30c6\u30b9\u30c8\u306e\u51fa\u54c1\u4f5c\u54c1\u3067\u3059\u3002\n\u306a\u304a\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u4ee5\u4e0b\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002(PR\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059)\nhttps://github.com/kengos/is_it_phishing\n\n\u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3092\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\n\u3058\u3076\u3093\u9280\u884c \u3067\u306f 12/21 \u306b\u3053\u3093\u306a\u6ce8\u610f\u559a\u8d77\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u4e0d\u5be9\u306a\u30e1\u30fc\u30eb\u306e\u30ea\u30f3\u30af\u5148\u306b\u306f\u7d76\u5bfe\u306b\u30a2\u30af\u30bb\u30b9\u3057\u306a\u3044\u3088\u3046\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\u4e07\u304c\u4e00\u3001\u4e0d\u5be9\u306a\u30e1\u30fc\u30eb\u306e\u30ea\u30f3\u30af\u5148\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u507d\u30b5\u30a4\u30c8\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u78ba\u8a8d\u756a\u53f7\u8868\u306e\u6570\u5b57\u306e\u5165\u529b\u3092\u6c42\u3081\u3089\u308c\u3066\u3082\u7d76\u5bfe\u306b\u5165\u529b\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\nhttp://www.jibunbank.co.jp/announcement/2015/1221_01.html\n\n\u305d\u3093\u306a\u3053\u3068\u8a00\u308f\u308c\u3066\u3082\u3001\u81ea\u5206\u81ea\u8eab\u306e\u6ce8\u610f\u3060\u3051\u3060\u3068\u9650\u754c\u304c\u3042\u308a\u307e\u3059\u3088\u306d\u3002\n\u3069\u3046\u305b\u306a\u3089\u6a5f\u68b0\u7684\u306b\u30d6\u30ed\u30c3\u30af\u3067\u304d\u308b\u4ed5\u7d44\u307f\u3092\u7528\u610f\u3057\u305f\u3044\u306a\u3068\u8003\u3048\u307e\u3057\u305f\u3002\n\n\u3069\u3046\u3084\u3063\u3066\u30d6\u30ed\u30c3\u30af\u3059\u308b\u306e\u304b?\n(\u65e5\u672c\u3092\u5bfe\u8c61\u3068\u3057\u305f)\u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u65b9\u6cd5\u304c\u826f\u3055\u305d\u3046\u3060\u306a\u3068\u8003\u3048\u307e\u3057\u305f\u3002\n\nwhois \u306e\u767b\u9332\u60c5\u5831\u4e2d\u306b CN, TW\u306a\u3069\u304c\u542b\u307e\u308c\u3066\u3044\u308b\nwhois \u306e\u767b\u9332\u60c5\u5831\u306e \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c \u30d5\u30ea\u30fc\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3060\ngoogle \u306b \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3055\u308c\u3066\u3044\u306a\u3044(\u9055\u6cd5\u30b5\u30a4\u30c8\u306a\u306e\u3067\u5f53\u7136)\n\u4e2d\u56fd\u306e\u7121\u6599\u306e\u30a2\u30af\u30bb\u30b9\u89e3\u6790\u30c4\u30fc\u30eb\u304c\u4ed5\u8fbc\u307e\u308c\u3066\u3044\u308b(51.la)\n\u6587\u7ae0\u4e2d\u306e\u65e5\u672c\u8a9e\u304c\u602a\u3057\u3044\n\n\u4eca\u56de\u306f\u300c\u6587\u7ae0\u4e2d\u306e\u65e5\u672c\u8a9e\u304c\u602a\u3057\u3044\u300d\u4ee5\u5916\u3092\u7d44\u307f\u8fbc\u3093\u3060\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n(\u3081\u3093\u3069\u304f\u3055\u3044 + \u30b5\u30f3\u30d7\u30eb\u63a2\u3059\u306e\u304c\u5927\u5909)\n\u307e\u305f\u3001DNS\u6c5a\u67d3\u306a\u3069\u3067\u306e\u88ab\u5bb3\u3082\u3042\u308b\u3088\u3046\u306a\u306e\u3067\u3001\n\u5225\u74b0\u5883\u304b\u3089\u6b63\u5f15\u304d\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u304c\u540c\u4e00\u304b\u3069\u3046\u304b\u306e\n\u30c1\u30a7\u30c3\u30af\u3082\u542b\u3081\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\u3068\u306a\u308a\u307e\u3059\n\n\n\u6280\u8853\u7684\u306a\u304a\u8a71\n\nChromeExtension\u306e\u4ed5\u7d44\u307f\n\n\ncontent/main.js\nbackground/main.js\n\n\ncontent/main.js\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cHTML\u3092\u8aad\u307f\u8fbc\u3080\u3068\u4ee5\u4e0b\u304c\u5b9f\u884c\u3055\u308c, background/main.js \u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\ncontent/main.js\nchrome.runtime.sendMessage({\n  location: window.location,\n  // scripts \u306b\u306f HTML\u4e2d\u306escript\u30bf\u30b0, iframe\u30bf\u30b0\u306e src\u5c5e\u6027\u306e\u4e2d\u8eab\u304c\u5165\u3063\u3066\u3044\u308b\n  scripts: scripts.concat(iframes)\n});\n\n\n\nbackground/main.js\nbackground/main.js \u306f content/main.js\u304c\u9001\u3063\u3066\u304f\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5f85\u3061\u53d7\u3051\u3066\u3044\u307e\u3059\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\n1. ScoreBoard \u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u5bfe\u3057\u3066\u9001\u4fe1\u3055\u308c\u3066\u304d\u305f request\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u307e\u3059\n2. ScoreBoard \u306e\u7d50\u679c\u3092\u8a08\u7b97\u3057\u307e\u3059(\u975e\u540c\u671f)\n3. ScoreBoard \u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b chrome.tabs.sendMessage \u3067\u9001\u4fe1\u3057\u3066\u304d\u305f\u30bf\u30d6(sender.tab.id)\u306b\u5bfe\u3057\u3066\u7d50\u679c\u3092\u8fd4\u3057\u307e\u3059\n\nbackground/main.js\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {\n  var board = new ScoreBoard(request);\n  board.calculate();\n  var timer = setInterval(function() {\n    if(board.complete()) {\n      clearInterval(timer);\n      chrome.tabs.sendMessage(sender.tab.id, {request: request, sender: sender, score: board.getScore(), messages: board.getMessages()});\n    }\n  }, 100);\n});\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306eHTML\u66f8\u304d\u63db\u3048\ncontent/main.js \u306f\u4ee5\u4e0b\u3067background/main.js \u304c\u9001\u4fe1\u3057\u3066\u304f\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5f85\u3061\u53d7\u3051\u3066\u3044\u307e\u3059\n\ncontent/main.js\nchrome.runtime.onMessage.addListener(function(response, sender, sendResponse) {\n  console.log(response);\n  if (response.score < 80) {\n    return;\n  }\n\n  replaceDocument();\n  // Document\u66f8\u304d\u63db\u3048\n  var ulTag = document.querySelector('#phishing-injection-messages');\n\n  response.messages.forEach(function(message) {\n    var liTag = document.createElement('li');\n    liTag.innerHTML = message;\n    ulTag.appendChild(liTag);\n  });\n});\n\n\nresponse \u306f\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002(\u3053\u308c\u306f\u5b9f\u969b\u306e\u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3067\u5f97\u3089\u308c\u305f\u7d50\u679c\u3067\u3059)\n{\n  score: 80,\n  messages: [\n    \"js.users.51.la \u306e javascript/iframe \u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u307e\u3059\u3002\",\n    \"Google\u306e\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\"\n  ]\n}\n\nscore\u304c 80\u4ee5\u4e0a\u306e\u5834\u5408\u306f\u30a4\u30ab\u306e\u753b\u50cf\u306e\u3088\u3046\u306b messages\u306e\u4e2d\u8eab\u3068\u3068\u3082\u306b\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002\n(\u65e2\u5b58\u306eHTML\u306f\u5168\u3066\u975e\u8868\u793a\u306b\u3057\u3066\u3044\u307e\u3059)\n\n\nscript, iframe \u306e src=xxxx \u306b\u5bfe\u3057\u3066\u884c\u3046\u51e6\u7406\n\u3053\u306e\u51e6\u7406\u3067\u306f \u8a72\u5f53\u30da\u30fc\u30b8\u4e2d\u306b\u542b\u307e\u308c\u3066\u3044\u308b script src=xxxx, iframe src=xxxx \u306e\u3059\u3079\u3066\u306e\u5024\u3092\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089\u9001\u4fe1\u3057\u3066\u3082\u3089\u3044\u3001\u305d\u308c\u3089\u3092\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u65b9\u5f0f\u3067\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u88c5\u7b87\u6240: background/hostname_validator.js\n\u53d7\u3051\u53d6\u3063\u305f src/iframe \u4e2d\u306e src \u306e\u914d\u5217\u304c hostnames \u3067\u3059\nRegExp\u3092\u4f7f\u7528\u3057\u3066\u3001test\u3092\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u306b\u542b\u307e\u308c\u3066\u3044\u305f\u5834\u5408\u306f\u8a72\u5f53\u306e hostname \u3092 this.errorHosts\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\nthis.buildResult() \u3067 \u30b9\u30b3\u30a2 \u3068 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u8868\u793a\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u3066\u3044\u307e\u3059\nvalidate: function(hostnames) {\n  var reg = new RegExp(HostnameValidator.ERROR_HOSTS.join('|'));\n  this.errorHosts = [].filter.call((hostnames || []), function(hostname) {\n    return reg.test(hostname);\n  });\n  this.buildResult();\n  return this.errorHosts.length == 0;\n}\n\n\nwhois \u51e6\u7406\nAWS API Gateway\u3068\u306e\u901a\u4fe1\u304c\u767a\u751f\u3059\u308b\u90e8\u5206\u3067\u3059\n\nChromeExtension\u5074\u306e\u51e6\u7406\n\u5b9f\u88c5\u7b87\u6240: background/whois_validator.js\nAjax\u3092\u5229\u7528\u3057\u3066 APIGataway\u3068\u901a\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\u3002\nAPIGataway\u5074\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5143\u306b \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u9001\u4fe1\u3059\u308b\u30b9\u30b3\u30a2, \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u307e\u3059\n\nwhois_validator.js\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: WhoisValidator.API_END_POINT,\n    data: {'hostname': hostname},\n    dataType: 'json'\n  }).done(function(json) {\n    self.setCache(hostname, json);\n    self.response = json;\n  }).fail(function(json) {\n    self.response = null;\n  }).always(function() {\n    self.buildResult();\n  });\n}\n\n\n\nAWS APIGateway, AWS lambda \u5074\u306e\u51e6\u7406\nAPIGateway/lambda: dns/whois\n\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af: dns/lib/whois.js\n\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066 node-whois, change-case \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\nevent.hostname \u306b /dns/whois?hostname=xxxx \u306e xxxx\u306e\u90e8\u5206\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u306e\u5024\u3092 whois.lookup \u3067\u691c\u7d22\u3057\u3066\u3044\u307e\u3059\n\u3053\u306e\u7d50\u679c\u306f\u901a\u5e38\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u884c\u3046 whois \u3068\u540c\u69d8\u306e\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3001\u9069\u5f53\u306b\u6574\u5f62\u3057\u3066json\u5f62\u5f0f\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3057\u307e\u3059\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u969b\u306b\u306f return cb(null, {}) \u3068\u3059\u308c\u3070\u826f\u3044\u3089\u3057\u304f\u3001\n{}\u306e\u7b87\u6240\u306b\u8fd4\u3057\u305f\u3044\u4efb\u610f\u306ejson\u6587\u5b57\u5217\u3092\u3044\u308c\u308b\u3060\u3051\u3067\u3057\u305f\nmodule.exports.respond = function(event, cb) {\n  if(event.hostname === '') {\n    return cb(new Error(\"hostname is required\"), null);\n  }\n\n  whois.lookup(event.hostname, function(err, whoisText) {\n    if (err) {\n      return cb(err, null);\n    }\n    var response = {};\n\n    if(event.hostname.match(/\\.jp$/)) {\n      response['type'] = 0;\n      response['text'] = whoisText;\n    } else {\n      var lines = whoisText.split(/\\r\\n|\\r|\\n/).filter(function(line, index) {\n        return String(line).trim().match(': ');\n      });\n      lines.forEach(function(line) {\n        var parts = line.split(\": \");\n        var key = changeCase.camelCase(parts[0]);\n        response[key] = parts[1];\n      });\n    }\n\n    return cb(null, response);\n  });\n\n};\n\n\nDNS\u6b63\u5f15\u304d \u51e6\u7406\n\nChromeExtension\u5074\u306e\u51e6\u7406\n\u5b9f\u88c5\u7b87\u6240: background/ip_validator.js\nAjax\u3092\u5229\u7528\u3057\u3066 APIGataway\u3068\u901a\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\u3002\nAPIGataway\u5074\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5143\u306b \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u9001\u4fe1\u3059\u308b\u30b9\u30b3\u30a2, \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u307e\u3059\n\nip_validator.js\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: IpValidator.API_END_POINT,\n    data: {'hostname': hostname},\n    dataType: 'json'\n  }).done(function(json) {\n    self.setCache(hostname, json);\n    self.response = json;\n  }).fail(function(json) {\n    self.response = null;\n  }).always(function() {\n    self.buildResult(hostname);\n  });\n}\n\n\n\nAPIGateway, lambda\u5074\u306e\u51e6\u7406\nAPIGateway\u306e\u51e6\u7406\u5b9f\u88c5\u7b87\u6240: whois/ip\nlambda(\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af): dns/lib/ip.js\nnode\u306e\u6a19\u6e96\u6a5f\u80fd\u3067 hostname => ipaddress\u5909\u63db\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\nip.js\nvar dns = require('dns');\n\nmodule.exports.respond = function(event, cb) {\n  if(event.hostname === '') {\n    return cb(new Error(\"hostname is required\"), null);\n  }\n\n  dns.resolve(event.hostname, function (err, addresses) {\n    if (err) {\n      return cb(err, null);\n    }\n\n    return cb(null, addresses);\n  });\n};\n\n\n\u547c\u3073\u51fa\u3059\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 18\nConnection: keep-alive\nDate: Sun, 27 Dec 2015 03:52:56 GMT\nx-amzn-RequestId: 506bf61b-ac4d-11e5-95e3-63eadd8da545\nX-Cache: Miss from cloudfront\nVia: 1.1 61d0a31bb18a85e2e5a9c2cc54beb3e5.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: BKLP2gP0ls54Y8Rcw7xZ3mMu216AfErzrxc7_v-0XUYC9PZJkvqqiw==\n\n[\"216.58.220.195\"]\n\ncb(new Error('hostname is requires'), null)\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u306a\u308a\u307e\u3059\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 213\nConnection: keep-alive\nDate: Sun, 27 Dec 2015 03:54:16 GMT\nx-amzn-RequestId: 7fc898b0-ac4d-11e5-b91c-ab7dacc15141\nX-Cache: Miss from cloudfront\nVia: 1.1 65fe4947494affb6443dd314059f54c8.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: a-4so43Jp1j9iIuDoSUma1mScWIvgGDWKEGgwh4v6Fn03NtFoDLk-w==\n\n{\"errorMessage\":\"hostname is required\",\"errorType\":\"Error\",\"stackTrace\":[\"Object.module.exports.respond (/var/task/modules/dns/lib/ip.js:5:15)\",\"module.exports.handler (/var/task/modules/dns/ip/handler.js:19:7)\"]}\n\n\nGoogle\u3078\u306e\u691c\u7d22\u30ea\u30af\u30a8\u30b9\u30c8\nlambda\u5074\u3067\u51e6\u7406\u3092\u66f8\u3053\u3046\u304b\u306a\u3068\u3082\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8IP\u3092\u5206\u6563\u3057\u305f\u307b\u3046\u304c\u3088\u3055\u6c17\u3060\u3063\u305f\u306e\u3067\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\nbackground/google_validator.js\n(Deprecated\u306a)GoogleSearchApi\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\n\u691c\u7d22\u30af\u30a8\u30ea\u3092 site:hostname \u3068\u3059\u308b\u3053\u3068\u3067 \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u8abf\u3079\u3066\u3044\u307e\u3059\n\ngoogle_validator.js#lookup\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: 'http://ajax.googleapis.com/ajax/services/search/web?v=1.0&q=site:' + hostname,\n    dataType : \"json\"\n  }).done(function(response){\n    self.setCache(hostname, response);\n    self.response = response;\n  }).fail(function(response){\n    self.response = null;\n  }).always(function() {\n    self.buildResult();\n  });\n}\n\n\n\nAWS serverless(APIGateway/Lambda) \u306b\u3064\u3044\u3066\n\nServeless\u306e\u30c7\u30d7\u30ed\u30a4\nserveless function deploy: Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\nserveless endpoint deploy: APIGateway\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\ndeploy\u3059\u308bfunction, endopoint\u3092\u9078\u629e\u3057 Deploy\u3092\u9078\u629e\u3059\u308b\u3068Deploy\u3067\u304d\u307e\u3059\n\u306a\u304a\u3001-a\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3079\u3066\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u3067\u304d -s [stage\u540d]\u3067\u6307\u5b9a\u3057\u305fstage\u306efunction/endpoint\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u51fa\u6765\u307e\u3059\n(\u4eca\u56de\u306fdevelopment stage\u306e\u307f\u3057\u304b\u7528\u610f\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u805e\u304b\u308c\u3066\u3044\u307e\u305b\u3093)\n\n\nAWS\u306e\u6599\u91d1\u306f?\n\u958b\u767a\u6642\u70b9\u3067\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6570\u3067\u3057\u305f\n\n\nserverless\u3092\u4f7f\u3063\u305f\u969b\u306bAWS\u4e0a\u3067\u78ba\u8a8d\u3059\u308b\u30b3\u30f3\u30bd\u30fc\u30eb\u306f?\n\nCloud Formation: serverless\u306e\u69cb\u6210\u7ba1\u7406\nAWS Lambda: APIGateway\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u90e1\nAPI Gateway: \u5916\u90e8\u3068\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\nS3: \u5b9f\u614b\u30d5\u30a1\u30a4\u30eb\nCloudWatch: AWS Lambda\u306e\u30ed\u30b0\u306a\u3069\u306f\u3053\u3053\u304b\u3089\nBilling\nIAM\n\n\nS3\nserverless.[region].[app\u540d]/Serverless/[app\u540d]/[stage] \u4ee5\u4e0b\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\nlambdas\u4ee5\u4e0b\u306b\u306fLambda\u306eFunction\u304cRevision\u3054\u3068\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\n\nAWS Lambda\nFunction\u3054\u3068\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\n\u5404Function\u306e\u4e2d\u8eab\u306fRevision\u7ba1\u7406\u3055\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\n\nAWS APIGateway\n\n\nCloudWatch\n\n\u4ee5\u4e0b\u306f cb(new Error('hostname is required'), null) \u306e\u969b\u306e\u30ed\u30b0\u3067\u3059\n\n\nserverless \u3067\u30cf\u30de\u3063\u305f\u3053\u3068\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u3082\u3089\u3044\u65b9\n\u5404\u3005\u306eAPI\u306f\u6b21\u306e\u3088\u3046\u306b\u53d7\u3051\u53d6\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\nwhois: /dns/whois?hostname=xxxx\nDNS\u6b63\u5f15\u304d: /dns/ip?hostname=xxxx\nhostname=xxxx \u306e\u8a2d\u5b9a\u3092\u3069\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u306b\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\u7d50\u8ad6\u7684\u306b\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u5165\u308c\u3066deploy\u3059\u308b\u3060\u3051\u3067\u3057\u305f\u3002\n\ns-function.json\n\"requestParameters\": {\n  \"integration.request.querystring.integrationQueryParam\": \"method.request.querystring.hostname\"\n},\n\"requestTemplates\": {\n  \"application/json\": \"{\\\"hostname\\\":\\\"$input.params('hostname')\\\"}\"\n},\n\n\n\nevent.json\n{\n  \"whois\": {\n    \"hostname\": \"$input.params('hostname')\"\n  }\n}\n\n\n\n\u6700\u5f8c\u306b(Help me!)\n\u25ef whois \u306b\u3064\u3044\u3066 .com\u306a\u3069\u306f\u3046\u307e\u304f\u53d6\u308c\u308b\u306e\u3067\u3059\u304c\u53d6\u308c\u306a\u3044\u3082\u306e\u3082\u591a\u304f\u56f0\u3063\u3066\u3044\u307e\u3059\n\u4e88\u7b97\u7684\u306a\u90fd\u5408\u3067\u516c\u958bAPI\u7b49\u306f\u4f7f\u3044\u305f\u304f\u306a\u3044\u306e\u3067\u306a\u306b\u304b\u3044\u3044\u65b9\u6cd5\u3092\u77e5\u3063\u3066\u3044\u308b\u65b9\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\u25ef\u6587\u66f8\u5185\u306e\u602a\u3057\u3044\u65e5\u672c\u8a9e\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u307f\u305f\u3044\u3067\u3059\u3002\u8a73\u3057\u3044\u4eba(ry\n\u304b\u306a\u308a\u96d1\u306a\u4f5c\u308a\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059($5\u6255\u3044\u307e\u3057\u305f...)\nhttps://chrome.google.com/webstore/detail/%E3%83%95%E3%82%A3%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B%E3%83%84%E3%83%BC%E3%83%AB%E4%BB%AE/mhkdeobnhdhcgeklilgplkadcblehdja?hl=ja\n## \u306f\u3058\u3081\u306b\n\n\u4eca\u65e5(2015/12/16)\u304b\u3089\u51ac\u4f11\u307f\u3068\u3044\u3046\u65b9\u3082\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b?\n\n\u51ac\u4f11\u307f\u306e\u9593 serverless \u3092\u89e6\u308a\u305f\u3044\uff01\u3072\u307e\u3060\u3072\u307e\u3060\uff01\uff01\uff01\uff01\n\u3068\u3044\u3046\u65b9\u306f [\u30b7\u30ba\u30aa\u30ab\u30a2\u30d7\u30ea\u30b3\u30f3\u30c6\u30b9\u30c8](https://shizuoka-app-awards.jp/) \u306b\u53c2\u52a0\u3057\u3066\u307f\u3066\u306f\n\u3044\u304b\u304c\u3067\u3057\u3087\u3046\u304b?\n\n\u53c2\u52a0\u7533\u3057\u8fbc\u307f\u3092\u3059\u308b\u3060\u3051\u3067 **$50\u5206\u306e\u30af\u30fc\u30dd\u30f3** \u304c\u8cb0\u3048\u307e\u3059\u3088\uff01\n\n\u4eca\u56de\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u3053\u306e[\u30b7\u30ba\u30aa\u30ab\u30a2\u30d7\u30ea\u30b3\u30f3\u30c6\u30b9\u30c8](https://shizuoka-app-awards.jp/)\u306e\u51fa\u54c1\u4f5c\u54c1\u3067\u3059\u3002\n\n\u306a\u304a\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u4ee5\u4e0b\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002(PR\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059)\nhttps://github.com/kengos/is_it_phishing\n\n## \u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3092\u30d6\u30ed\u30c3\u30af\u3057\u305f\u3044\n\n\u3058\u3076\u3093\u9280\u884c \u3067\u306f 12/21 \u306b\u3053\u3093\u306a\u6ce8\u610f\u559a\u8d77\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\n>\u4e0d\u5be9\u306a\u30e1\u30fc\u30eb\u306e\u30ea\u30f3\u30af\u5148\u306b\u306f\u7d76\u5bfe\u306b\u30a2\u30af\u30bb\u30b9\u3057\u306a\u3044\u3088\u3046\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\u4e07\u304c\u4e00\u3001\u4e0d\u5be9\u306a\u30e1\u30fc\u30eb\u306e\u30ea\u30f3\u30af\u5148\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u507d\u30b5\u30a4\u30c8\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u3084\u78ba\u8a8d\u756a\u53f7\u8868\u306e\u6570\u5b57\u306e\u5165\u529b\u3092\u6c42\u3081\u3089\u308c\u3066\u3082\u7d76\u5bfe\u306b\u5165\u529b\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n>http://www.jibunbank.co.jp/announcement/2015/1221_01.html\n\n\u305d\u3093\u306a\u3053\u3068\u8a00\u308f\u308c\u3066\u3082\u3001\u81ea\u5206\u81ea\u8eab\u306e\u6ce8\u610f\u3060\u3051\u3060\u3068\u9650\u754c\u304c\u3042\u308a\u307e\u3059\u3088\u306d\u3002\n\n\u3069\u3046\u305b\u306a\u3089\u6a5f\u68b0\u7684\u306b\u30d6\u30ed\u30c3\u30af\u3067\u304d\u308b\u4ed5\u7d44\u307f\u3092\u7528\u610f\u3057\u305f\u3044\u306a\u3068\u8003\u3048\u307e\u3057\u305f\u3002\n\n## \u3069\u3046\u3084\u3063\u3066\u30d6\u30ed\u30c3\u30af\u3059\u308b\u306e\u304b?\n\n(\u65e5\u672c\u3092\u5bfe\u8c61\u3068\u3057\u305f)\u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3092\u30d6\u30ed\u30c3\u30af\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u65b9\u6cd5\u304c\u826f\u3055\u305d\u3046\u3060\u306a\u3068\u8003\u3048\u307e\u3057\u305f\u3002\n\n* whois \u306e\u767b\u9332\u60c5\u5831\u4e2d\u306b CN, TW\u306a\u3069\u304c\u542b\u307e\u308c\u3066\u3044\u308b\n* whois \u306e\u767b\u9332\u60c5\u5831\u306e \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c \u30d5\u30ea\u30fc\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3060\n* google \u306b \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3055\u308c\u3066\u3044\u306a\u3044(\u9055\u6cd5\u30b5\u30a4\u30c8\u306a\u306e\u3067\u5f53\u7136)\n* \u4e2d\u56fd\u306e\u7121\u6599\u306e\u30a2\u30af\u30bb\u30b9\u89e3\u6790\u30c4\u30fc\u30eb\u304c\u4ed5\u8fbc\u307e\u308c\u3066\u3044\u308b(51.la)\n* \u6587\u7ae0\u4e2d\u306e\u65e5\u672c\u8a9e\u304c\u602a\u3057\u3044\n\n\u4eca\u56de\u306f\u300c\u6587\u7ae0\u4e2d\u306e\u65e5\u672c\u8a9e\u304c\u602a\u3057\u3044\u300d\u4ee5\u5916\u3092\u7d44\u307f\u8fbc\u3093\u3060\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n(\u3081\u3093\u3069\u304f\u3055\u3044 + \u30b5\u30f3\u30d7\u30eb\u63a2\u3059\u306e\u304c\u5927\u5909)\n\n\u307e\u305f\u3001DNS\u6c5a\u67d3\u306a\u3069\u3067\u306e\u88ab\u5bb3\u3082\u3042\u308b\u3088\u3046\u306a\u306e\u3067\u3001\n\u5225\u74b0\u5883\u304b\u3089\u6b63\u5f15\u304d\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u304c\u540c\u4e00\u304b\u3069\u3046\u304b\u306e\n\u30c1\u30a7\u30c3\u30af\u3082\u542b\u3081\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\u3068\u306a\u308a\u307e\u3059\n\n![qiita_1.png](https://qiita-image-store.s3.amazonaws.com/0/14258/e6a25496-b760-e165-8e18-e4822a8e545c.png)\n\n# \u6280\u8853\u7684\u306a\u304a\u8a71\n\n## ChromeExtension\u306e\u4ed5\u7d44\u307f\n\n![qiita_2.png](https://qiita-image-store.s3.amazonaws.com/0/14258/b86b83e2-1193-a985-e067-096fb305eb65.png)\n\n* [content/main.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/content/main.js)\n* [background/main.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/background/main.js)\n\n### content/main.js\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cHTML\u3092\u8aad\u307f\u8fbc\u3080\u3068\u4ee5\u4e0b\u304c\u5b9f\u884c\u3055\u308c, background/main.js \u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n```js:content/main.js\nchrome.runtime.sendMessage({\n  location: window.location,\n  // scripts \u306b\u306f HTML\u4e2d\u306escript\u30bf\u30b0, iframe\u30bf\u30b0\u306e src\u5c5e\u6027\u306e\u4e2d\u8eab\u304c\u5165\u3063\u3066\u3044\u308b\n  scripts: scripts.concat(iframes)\n});\n```\n\n### background/main.js\n\nbackground/main.js \u306f content/main.js\u304c\u9001\u3063\u3066\u304f\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5f85\u3061\u53d7\u3051\u3066\u3044\u307e\u3059\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3068\n1. ScoreBoard \u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u5bfe\u3057\u3066\u9001\u4fe1\u3055\u308c\u3066\u304d\u305f `request`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u307e\u3059\n2. ScoreBoard \u306e\u7d50\u679c\u3092\u8a08\u7b97\u3057\u307e\u3059(\u975e\u540c\u671f)\n3. ScoreBoard \u304c\u5b8c\u4e86\u3057\u305f\u5834\u5408\u306b `chrome.tabs.sendMessage` \u3067\u9001\u4fe1\u3057\u3066\u304d\u305f\u30bf\u30d6(`sender.tab.id`)\u306b\u5bfe\u3057\u3066\u7d50\u679c\u3092\u8fd4\u3057\u307e\u3059\n\n```js:background/main.js\nchrome.runtime.onMessage.addListener(function(request, sender, sendResponse) {\n  var board = new ScoreBoard(request);\n  board.calculate();\n  var timer = setInterval(function() {\n    if(board.complete()) {\n      clearInterval(timer);\n      chrome.tabs.sendMessage(sender.tab.id, {request: request, sender: sender, score: board.getScore(), messages: board.getMessages()});\n    }\n  }, 100);\n});\n```\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306eHTML\u66f8\u304d\u63db\u3048\n\ncontent/main.js \u306f\u4ee5\u4e0b\u3067background/main.js \u304c\u9001\u4fe1\u3057\u3066\u304f\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5f85\u3061\u53d7\u3051\u3066\u3044\u307e\u3059\n\n```js:content/main.js\nchrome.runtime.onMessage.addListener(function(response, sender, sendResponse) {\n  console.log(response);\n  if (response.score < 80) {\n    return;\n  }\n\n  replaceDocument();\n  // Document\u66f8\u304d\u63db\u3048\n  var ulTag = document.querySelector('#phishing-injection-messages');\n\n  response.messages.forEach(function(message) {\n    var liTag = document.createElement('li');\n    liTag.innerHTML = message;\n    ulTag.appendChild(liTag);\n  });\n});\n```\n\n`response` \u306f\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002(\u3053\u308c\u306f\u5b9f\u969b\u306e\u30d5\u30a3\u30c3\u30b7\u30f3\u30b0\u30b5\u30a4\u30c8\u3067\u5f97\u3089\u308c\u305f\u7d50\u679c\u3067\u3059)\n\n```js\n{\n  score: 80,\n  messages: [\n    \"js.users.51.la \u306e javascript/iframe \u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u307e\u3059\u3002\",\n    \"Google\u306e\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\"\n  ]\n}\n```\n\n`score`\u304c 80\u4ee5\u4e0a\u306e\u5834\u5408\u306f\u30a4\u30ab\u306e\u753b\u50cf\u306e\u3088\u3046\u306b messages\u306e\u4e2d\u8eab\u3068\u3068\u3082\u306b\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002\n(\u65e2\u5b58\u306eHTML\u306f\u5168\u3066\u975e\u8868\u793a\u306b\u3057\u3066\u3044\u307e\u3059)\n\n<img width=\"837\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-26 21.30.24.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/bfa9d838-8b6c-e7f1-174e-b007b0f7bbab.png\">\n\n## script, iframe \u306e `src=xxxx` \u306b\u5bfe\u3057\u3066\u884c\u3046\u51e6\u7406\n\n\u3053\u306e\u51e6\u7406\u3067\u306f \u8a72\u5f53\u30da\u30fc\u30b8\u4e2d\u306b\u542b\u307e\u308c\u3066\u3044\u308b `script src=xxxx`, `iframe src=xxxx` \u306e\u3059\u3079\u3066\u306e\u5024\u3092\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089\u9001\u4fe1\u3057\u3066\u3082\u3089\u3044\u3001\u305d\u308c\u3089\u3092\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u65b9\u5f0f\u3067\u5224\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u5b9f\u88c5\u7b87\u6240: [background/hostname_validator.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/background/hostname_validator.js)\n\n\u53d7\u3051\u53d6\u3063\u305f src/iframe \u4e2d\u306e src \u306e\u914d\u5217\u304c `hostnames` \u3067\u3059\n\nRegExp\u3092\u4f7f\u7528\u3057\u3066\u3001`test`\u3092\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8\u306b\u542b\u307e\u308c\u3066\u3044\u305f\u5834\u5408\u306f\u8a72\u5f53\u306e hostname \u3092 `this.errorHosts`\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\n\n`this.buildResult()` \u3067 \u30b9\u30b3\u30a2 \u3068 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u8868\u793a\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u3066\u3044\u307e\u3059\n\n```js\nvalidate: function(hostnames) {\n  var reg = new RegExp(HostnameValidator.ERROR_HOSTS.join('|'));\n  this.errorHosts = [].filter.call((hostnames || []), function(hostname) {\n    return reg.test(hostname);\n  });\n  this.buildResult();\n  return this.errorHosts.length == 0;\n}\n```\n\n## whois \u51e6\u7406\n\nAWS API Gateway\u3068\u306e\u901a\u4fe1\u304c\u767a\u751f\u3059\u308b\u90e8\u5206\u3067\u3059\n\n### ChromeExtension\u5074\u306e\u51e6\u7406\n\n\u5b9f\u88c5\u7b87\u6240: [background/whois_validator.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/background/whois_validator.js)\n\nAjax\u3092\u5229\u7528\u3057\u3066 APIGataway\u3068\u901a\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\u3002\nAPIGataway\u5074\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5143\u306b \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u9001\u4fe1\u3059\u308b\u30b9\u30b3\u30a2, \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u307e\u3059\n\n```js:whois_validator.js\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: WhoisValidator.API_END_POINT,\n    data: {'hostname': hostname},\n    dataType: 'json'\n  }).done(function(json) {\n    self.setCache(hostname, json);\n    self.response = json;\n  }).fail(function(json) {\n    self.response = null;\n  }).always(function() {\n    self.buildResult();\n  });\n}\n```\n\n### AWS APIGateway, AWS lambda \u5074\u306e\u51e6\u7406\n\nAPIGateway/lambda: [dns/whois](https://github.com/kengos/is_it_phishing/tree/master/phishing-app/back/modules/dns/whois)\n\n\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af: [dns/lib/whois.js](https://github.com/kengos/is_it_phishing/blob/master/phishing-app/back/modules/dns/lib/whois.js)\n\n\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066 `node-whois`, `change-case` \u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\n\n`event.hostname` \u306b `/dns/whois?hostname=xxxx` \u306e `xxxx`\u306e\u90e8\u5206\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u306e\u5024\u3092 `whois.lookup` \u3067\u691c\u7d22\u3057\u3066\u3044\u307e\u3059\n\n\u3053\u306e\u7d50\u679c\u306f\u901a\u5e38\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u884c\u3046 `whois` \u3068\u540c\u69d8\u306e\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u306e\u3067\u3001\u9069\u5f53\u306b\u6574\u5f62\u3057\u3066json\u5f62\u5f0f\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3057\u307e\u3059\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u3059\u969b\u306b\u306f `return cb(null, {})` \u3068\u3059\u308c\u3070\u826f\u3044\u3089\u3057\u304f\u3001\n`{}`\u306e\u7b87\u6240\u306b\u8fd4\u3057\u305f\u3044\u4efb\u610f\u306ejson\u6587\u5b57\u5217\u3092\u3044\u308c\u308b\u3060\u3051\u3067\u3057\u305f\n\n```js\nmodule.exports.respond = function(event, cb) {\n  if(event.hostname === '') {\n    return cb(new Error(\"hostname is required\"), null);\n  }\n\n  whois.lookup(event.hostname, function(err, whoisText) {\n    if (err) {\n      return cb(err, null);\n    }\n    var response = {};\n\n    if(event.hostname.match(/\\.jp$/)) {\n      response['type'] = 0;\n      response['text'] = whoisText;\n    } else {\n      var lines = whoisText.split(/\\r\\n|\\r|\\n/).filter(function(line, index) {\n        return String(line).trim().match(': ');\n      });\n      lines.forEach(function(line) {\n        var parts = line.split(\": \");\n        var key = changeCase.camelCase(parts[0]);\n        response[key] = parts[1];\n      });\n    }\n\n    return cb(null, response);\n  });\n\n};\n```\n\n## DNS\u6b63\u5f15\u304d \u51e6\u7406\n\n### ChromeExtension\u5074\u306e\u51e6\u7406\n\n\u5b9f\u88c5\u7b87\u6240: [background/ip_validator.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/background/ip_validator.js)\n\nAjax\u3092\u5229\u7528\u3057\u3066 APIGataway\u3068\u901a\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\u3002\nAPIGataway\u5074\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5143\u306b \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u9001\u4fe1\u3059\u308b\u30b9\u30b3\u30a2, \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u751f\u6210\u3057\u307e\u3059\n\n```js:ip_validator.js\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: IpValidator.API_END_POINT,\n    data: {'hostname': hostname},\n    dataType: 'json'\n  }).done(function(json) {\n    self.setCache(hostname, json);\n    self.response = json;\n  }).fail(function(json) {\n    self.response = null;\n  }).always(function() {\n    self.buildResult(hostname);\n  });\n}\n```\n\n### APIGateway, lambda\u5074\u306e\u51e6\u7406\n\nAPIGateway\u306e\u51e6\u7406\u5b9f\u88c5\u7b87\u6240: [whois/ip](https://github.com/kengos/is_it_phishing/tree/master/phishing-app/back/modules/dns/ip)\n\nlambda(\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af): [dns/lib/ip.js](https://github.com/kengos/is_it_phishing/blob/master/phishing-app/back/modules/dns/lib/ip.js)\n\nnode\u306e\u6a19\u6e96\u6a5f\u80fd\u3067 hostname => ipaddress\u5909\u63db\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\n```js:ip.js\nvar dns = require('dns');\n\nmodule.exports.respond = function(event, cb) {\n  if(event.hostname === '') {\n    return cb(new Error(\"hostname is required\"), null);\n  }\n\n  dns.resolve(event.hostname, function (err, addresses) {\n    if (err) {\n      return cb(err, null);\n    }\n\n    return cb(null, addresses);\n  });\n};\n```\n\n\u547c\u3073\u51fa\u3059\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\n\n```shell-session\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 18\nConnection: keep-alive\nDate: Sun, 27 Dec 2015 03:52:56 GMT\nx-amzn-RequestId: 506bf61b-ac4d-11e5-95e3-63eadd8da545\nX-Cache: Miss from cloudfront\nVia: 1.1 61d0a31bb18a85e2e5a9c2cc54beb3e5.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: BKLP2gP0ls54Y8Rcw7xZ3mMu216AfErzrxc7_v-0XUYC9PZJkvqqiw==\n\n[\"216.58.220.195\"]\n```\n\n`cb(new Error('hostname is requires'), null)`\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u306a\u308a\u307e\u3059\n\n```shell-session\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 213\nConnection: keep-alive\nDate: Sun, 27 Dec 2015 03:54:16 GMT\nx-amzn-RequestId: 7fc898b0-ac4d-11e5-b91c-ab7dacc15141\nX-Cache: Miss from cloudfront\nVia: 1.1 65fe4947494affb6443dd314059f54c8.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: a-4so43Jp1j9iIuDoSUma1mScWIvgGDWKEGgwh4v6Fn03NtFoDLk-w==\n\n{\"errorMessage\":\"hostname is required\",\"errorType\":\"Error\",\"stackTrace\":[\"Object.module.exports.respond (/var/task/modules/dns/lib/ip.js:5:15)\",\"module.exports.handler (/var/task/modules/dns/ip/handler.js:19:7)\"]}\n```\n\n## Google\u3078\u306e\u691c\u7d22\u30ea\u30af\u30a8\u30b9\u30c8\n\nlambda\u5074\u3067\u51e6\u7406\u3092\u66f8\u3053\u3046\u304b\u306a\u3068\u3082\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8IP\u3092\u5206\u6563\u3057\u305f\u307b\u3046\u304c\u3088\u3055\u6c17\u3060\u3063\u305f\u306e\u3067\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u3092\u3057\u3066\u3044\u307e\u3059\n\n[background/google_validator.js](https://github.com/kengos/is_it_phishing/blob/master/chrome_addon/app/background/google_validator.js)\n\n(Deprecated\u306a)GoogleSearchApi\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\n\n\u691c\u7d22\u30af\u30a8\u30ea\u3092 `site:hostname` \u3068\u3059\u308b\u3053\u3068\u3067 \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u8abf\u3079\u3066\u3044\u307e\u3059\n\n```js:google_validator.js#lookup\n// hostname = window.location.hostname\nlookup: function(hostname) {\n  var self = this;\n  $.ajax({\n    type: 'GET',\n    url: 'http://ajax.googleapis.com/ajax/services/search/web?v=1.0&q=site:' + hostname,\n    dataType : \"json\"\n  }).done(function(response){\n    self.setCache(hostname, response);\n    self.response = response;\n  }).fail(function(response){\n    self.response = null;\n  }).always(function() {\n    self.buildResult();\n  });\n}\n```\n\n## AWS serverless(APIGateway/Lambda) \u306b\u3064\u3044\u3066\n\n### Serveless\u306e\u30c7\u30d7\u30ed\u30a4\n\n`serveless function deploy`: Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\n`serveless endpoint deploy`: APIGateway\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u884c\u3044\u307e\u3059\n\ndeploy\u3059\u308bfunction, endopoint\u3092\u9078\u629e\u3057 `Deploy`\u3092\u9078\u629e\u3059\u308b\u3068Deploy\u3067\u304d\u307e\u3059\n\n\u306a\u304a\u3001`-a`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3079\u3066\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u3067\u304d `-s [stage\u540d]`\u3067\u6307\u5b9a\u3057\u305fstage\u306efunction/endpoint\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u51fa\u6765\u307e\u3059\n\n(\u4eca\u56de\u306fdevelopment stage\u306e\u307f\u3057\u304b\u7528\u610f\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u805e\u304b\u308c\u3066\u3044\u307e\u305b\u3093)\n\n![s.gif](https://qiita-image-store.s3.amazonaws.com/0/14258/1f78d87e-0638-0ffc-2895-56ebeab76711.gif)\n\n### AWS\u306e\u6599\u91d1\u306f?\n\n\u958b\u767a\u6642\u70b9\u3067\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6570\u3067\u3057\u305f\n\n<img width=\"426\" alt=\"aws_1.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/fe9cf01f-54e8-7b3f-5b46-49f4f2289569.png\">\n\n### serverless\u3092\u4f7f\u3063\u305f\u969b\u306bAWS\u4e0a\u3067\u78ba\u8a8d\u3059\u308b\u30b3\u30f3\u30bd\u30fc\u30eb\u306f?\n\n* Cloud Formation: serverless\u306e\u69cb\u6210\u7ba1\u7406\n* AWS Lambda: APIGateway\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u90e1\n* API Gateway: \u5916\u90e8\u3068\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n* S3: \u5b9f\u614b\u30d5\u30a1\u30a4\u30eb\n* CloudWatch: AWS Lambda\u306e\u30ed\u30b0\u306a\u3069\u306f\u3053\u3053\u304b\u3089\n* Billing\n* IAM\n\n### S3\n\nserverless.[region].[app\u540d]/Serverless/[app\u540d]/[stage] \u4ee5\u4e0b\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\n<img width=\"496\" alt=\"aws_2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/114d9e71-1d71-460e-7bfa-45dbc657b1b7.png\">\n\nlambdas\u4ee5\u4e0b\u306b\u306fLambda\u306eFunction\u304cRevision\u3054\u3068\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\n<img width=\"219\" alt=\"aws_s3.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/fef38482-1d7b-ccba-a4fc-0cca90347411.png\">\n\n### AWS Lambda\n\nFunction\u3054\u3068\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\n\n<img width=\"796\" alt=\"aws_3.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/fcebd593-d88d-0f98-d2ea-eb372586bcdd.png\">\n\n\u5404Function\u306e\u4e2d\u8eab\u306fRevision\u7ba1\u7406\u3055\u308c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\n<img width=\"1416\" alt=\"aws_4.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/06e7de35-fc3c-e080-94dc-f76dd6700201.png\">\n\n### AWS APIGateway\n\n<img width=\"712\" alt=\"aws_6.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/99999552-2212-dad3-8edc-0409dab630b9.png\">\n\n### CloudWatch\n\n<img width=\"370\" alt=\"aws_5.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/2804b2a5-b080-bdb7-04e2-1fddd6b483f2.png\">\n\n\u4ee5\u4e0b\u306f `cb(new Error('hostname is required'), null)` \u306e\u969b\u306e\u30ed\u30b0\u3067\u3059\n\n<img width=\"1100\" alt=\"aws_7.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14258/d16bfbdc-d176-bbcb-4689-eed43408adeb.png\">\n\n### serverless \u3067\u30cf\u30de\u3063\u305f\u3053\u3068\n\n#### \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u3082\u3089\u3044\u65b9\n\n\u5404\u3005\u306eAPI\u306f\u6b21\u306e\u3088\u3046\u306b\u53d7\u3051\u53d6\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nwhois: `/dns/whois?hostname=xxxx`\nDNS\u6b63\u5f15\u304d: `/dns/ip?hostname=xxxx`\n\n`hostname=xxxx` \u306e\u8a2d\u5b9a\u3092\u3069\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u306b\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\n\u7d50\u8ad6\u7684\u306b\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u5165\u308c\u3066deploy\u3059\u308b\u3060\u3051\u3067\u3057\u305f\u3002\n\n```json:s-function.json\n\"requestParameters\": {\n  \"integration.request.querystring.integrationQueryParam\": \"method.request.querystring.hostname\"\n},\n\"requestTemplates\": {\n  \"application/json\": \"{\\\"hostname\\\":\\\"$input.params('hostname')\\\"}\"\n},\n```\n\n```json:event.json\n{\n  \"whois\": {\n    \"hostname\": \"$input.params('hostname')\"\n  }\n}\n```\n\n## \u6700\u5f8c\u306b(Help me!)\n\n\u25ef whois \u306b\u3064\u3044\u3066 .com\u306a\u3069\u306f\u3046\u307e\u304f\u53d6\u308c\u308b\u306e\u3067\u3059\u304c\u53d6\u308c\u306a\u3044\u3082\u306e\u3082\u591a\u304f\u56f0\u3063\u3066\u3044\u307e\u3059\n\u4e88\u7b97\u7684\u306a\u90fd\u5408\u3067\u516c\u958bAPI\u7b49\u306f\u4f7f\u3044\u305f\u304f\u306a\u3044\u306e\u3067\u306a\u306b\u304b\u3044\u3044\u65b9\u6cd5\u3092\u77e5\u3063\u3066\u3044\u308b\u65b9\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\u25ef\u6587\u66f8\u5185\u306e\u602a\u3057\u3044\u65e5\u672c\u8a9e\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u307f\u305f\u3044\u3067\u3059\u3002\u8a73\u3057\u3044\u4eba(ry\n\n\n\u304b\u306a\u308a\u96d1\u306a\u4f5c\u308a\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059($5\u6255\u3044\u307e\u3057\u305f...)\n\nhttps://chrome.google.com/webstore/detail/%E3%83%95%E3%82%A3%E3%83%83%E3%82%B7%E3%83%B3%E3%82%B0%E3%82%B5%E3%82%A4%E3%83%88%E3%82%92%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B%E3%83%84%E3%83%BC%E3%83%AB%E4%BB%AE/mhkdeobnhdhcgeklilgplkadcblehdja?hl=ja\n", "tags": ["lambda", "APIGateway", "serverless", "chrome-extension", "JavaScript"]}