{"context": "\n\ndocker\u3067rails\u74b0\u5883\u69cb\u7bc9\nrails5 + mysql\u306e\u958b\u767a\u74b0\u5883\u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u3001docker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\ndocker-machine\u3067\u4f5c\u696d\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3082\u306e\u3059\u3054\u304f\u30cf\u30de\u3063\u305f\u306e\u3067\u305d\u306e\u4f5c\u696d\u8a18\u9332\u3082\u3002\n\n\u4f5c\u696d\u74b0\u5883\nrails\u3068mysql\u306f\u305d\u308c\u305e\u308c\u72ec\u7acb\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u3067docker-compose\u3067\u307e\u3068\u3081\u307e\u3059\u3002\n\u307e\u305f\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306fmac\u306a\u306e\u3067docker-machine\u3067docker\u306e\u74b0\u5883\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\ndocker-machine v0.7.0\ndocker v1.11.0\ndocker-compose v1.7.0\n\n\nrails\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n\n\u65b9\u91dd\n\n\u30db\u30b9\u30c8\u5074\u306bruby\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u304f\u3066\u3082\u958b\u767a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\nrails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a9\u30eb\u30c0\u81ea\u4f53\u306f\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u81ea\u4f53\u306f\u30db\u30b9\u30c8\u74b0\u5883\u3067\u884c\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\n\nrails\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210\n\nruby 2.3.0\nrails5 beta3\n\n\u306e\u74b0\u5883\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nDockerfile\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n   % tree\n   .\n   \u251c\u2500\u2500 app               # rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n   \u2514\u2500\u2500 docker            # docker\u306e\u95a2\u9023\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u251c\u2500\u2500 bin            #   docker-compose\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u251c\u2500\u2500 db             #   mysql\u7528\u306edocker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u2514\u2500\u2500 web            #   rails\u7528\u306edocker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n\u4ee5\u4e0b\u4f5c\u696d\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4e0a\u8a18\u306e.\u306e\u4f4d\u7f6e\u3067\u884c\u3044\u307e\u3059\u3002\n\nmysql\u7528\u306edocker\u30d5\u30a1\u30a4\u30eb docker/db/Dockerfile\n\n\n\u4eca\u56de\u306frails\u5074\u306e\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u304c\u30e1\u30a4\u30f3\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u306f\u3057\u307e\u305b\u3093\u3002\n\ndocker/db/Dockerfile\n  FROM mysql:5.7\n\n\n\nrails\u7528\u306edocker\u30d5\u30a1\u30a4\u30eb docker/web/Dockerfile\n\n\n\u8d77\u52d5\u6642\u306bapp\u30d5\u30a9\u30eb\u30c0\u3092\u30de\u30a6\u30f3\u30c8\u51fa\u6765\u308b\u3088\u3046\u306bweb\u30b3\u30f3\u30c6\u30ca\u306e/var/myapp\u3092VOLUME\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ndocker/web/Dockerfile\n  FROM ruby:2.3\n\n  ############################################################\n  # ruby setting bundler\u3060\u3051\u306fglobal\u306b\u5165\u308c\u3066\u304a\u304f\n  RUN gem install bundler\n\n  #####################################################\n  # misc settings\n  RUN usermod -u 1000 www-data\n  RUN \\cp -fp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\n  VOLUME /var/myapp\n  WORKDIR /var/myapp\n\n  EXPOSE 3000\n\n  CMD [\"bash\"]\n\n\n\n\ndocker-compose\u7528\u30d5\u30a1\u30a4\u30eb\ndocker-compose.yml\u306f\u4e2d\u3067\u74b0\u5883\u5909\u6570\u304c\u5c55\u958b\u51fa\u6765\u308b\u306e\u3067\u3001\u5404Docker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30d1\u30b9\u3092\u74b0\u5883\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u305f\u3081\u306bdocker-compose\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e9\u30c3\u30d1\u30fc\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u3063\u3066docker-compose\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\ndocker/bin/run-docker-compose.sh\n\n\ndocker/bin/run-docker-compose.sh\n  #!/bin/sh\n\n  SCRIPT_DIR=$(cd $(dirname $0) && pwd)\n\n  export DB_DOCKERFILE_DIR=${SCRIPT_DIR}/../db\n  export WEB_DOCKERFILE_DIR=${SCRIPT_DIR}/../web\n  export WEB_APP_ROOT_DIR=${SCRIPT_DIR}/../../app\n\n  export MYSQL_DATABASE=mydb\n  export MYSQL_USER=dbuser\n  export MYSQL_PASSWORD=dbuser_pass\n  export MYSQL_ROOT_PASSWORD=root\n\n  YML_FILE=$SCRIPT_DIR/docker-compose.yml\n\n  docker-compose -f $YML_FILE $*\n\n\n\ndocker/bin/docker-compose.sh\n\nweb\u304b\u3089db\u3092\u53c2\u7167\u51fa\u6765\u308b\u3088\u3046\u306blinks\u306e\u8a2d\u5b9a\u3068\u30db\u30b9\u30c8\u5074\u306erails\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306evolumes\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ndocker/bin/docker-compose.sh\n  db:\n    container_name: db\n    build: ${DB_DOCKERFILE_DIR}\n    ports:\n      - \"3306:3306\"\n    environment:\n      MYSQL_DATABASE: ${MYSQL_DATABASE}\n      MYSQL_USER: ${MYSQL_USER}\n      MYSQL_PASSWORD: ${MYSQL_PASSWORD}\n      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n\n  web:\n    container_name: web\n    build: ${WEB_DOCKERFILE_DIR}\n    ports:\n      - \"3000:3000\"\n    links:\n      - db:db\n    volumes:\n      - ${WEB_APP_ROOT_DIR}:/var/myapp\n    environment:\n      DATABASE_NAME: ${MYSQL_DATABASE}\n      DATABASE_USER: ${MYSQL_USER}\n      DATABASE_PASS: ${MYSQL_PASSWORD}\n      DATABASE_HOST: db\n    command: sh -c \"bundle install --path=vendor/bundle && rm tmp/pids/server.pid; bin/rails s -b 0.0.0.0\"\n\n\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n\n\ndocker build & rials\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n\u3053\u308c\u3067\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001docker-compose build\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\u3057\u307e\u3059\u3002\n docker/bin/run-docker-compose.sh build\n\n\u6b21\u306bweb\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066\u3044\u308bruby\u3067rails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002\n docker run --rm -it -v $(pwd)/app:/var/myapp bin_web bash  #docker-compose\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3068bin_${yaml\u306e\u5b9a\u7fa9\u540d}\u306b\u306a\u308a\u307e\u3059\u3002\n\n # \u4ee5\u964d\u3053\u306e\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u306e\u7d42\u308f\u308a\u307e\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e\u4f5c\u696d\n\n # Gemfile\u521d\u671f\u5316\n bundle init\n\n # \u3053\u306e\u8a18\u4e8b\u3092\u4f5c\u6210\u4e2d\u306e\u6700\u65b0\u306e5.0.0.beta3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n echo \"gem 'rails', '5.0.0.beta3'\" >> Gemfile\n\n # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30ed\u30fc\u30ab\u30eb\u306brails5\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n bundle install --path=vendor/bundle\n\n # rails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n # \u3068\u308a\u3042\u3048\u305a\u96db\u5f62\u306eGemfile\u3092\u4f5c\u308a\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3042\u3068\u3067\u3053\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u5168\u90e8\u524a\u9664\u3057\u307e\u3059\u3002\n bundle exec rails new sample_app --skip-bundle\n #\u3067\u304d\u305fGemfile\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n mv sample_app/Gemfile .\n #sample_app\u306f\u3082\u3046\u3044\u3089\u306a\u3044\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\n rm -rf sample_app\n\n # \u6b21\u306brails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u304c\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u306f\u30db\u30b9\u30c8\u306e\u65b9\u304c\u3084\u308a\u3084\u3059\u3044\u306e\u3067\u4e00\u65e6\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u51fa\u307e\u3059\u3002\n exit\n\n\n\nGemfile\u8a2d\u5b9a\n\u30db\u30b9\u30c8\u5074\u3067Gemfile\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fsqlite\u306e\u66ff\u308f\u308a\u306bmysql2\u306b\u5909\u3048\u305f\u306e\u3068therubyracer\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u305f\u3060\u3051\u3067\u5f8c\u306f\u5168\u90e8rails new\u304c\u4f5c\u6210\u3057\u3066\u304f\u308c\u305f\u307e\u307e\u3067\u3059\u3002\n source 'https://rubygems.org'\n\n # Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\n gem 'rails', '>= 5.0.0.beta3', '< 5.1'\n # Use sqlite3 as the database for Active Record\n gem 'mysql2'\n # Use Puma as the app server\n gem 'puma'\n # Use SCSS for stylesheets\n gem 'sass-rails', '~> 5.0'\n # Use Uglifier as compressor for JavaScript assets\n gem 'uglifier', '>= 1.3.0'\n # Use CoffeeScript for .coffee assets and views\n gem 'coffee-rails', '~> 4.1.0'\n # See https://github.com/rails/execjs#readme for more supported runtimes\n gem 'therubyracer', platforms: :ruby\n\n # Use jquery as the JavaScript library\n gem 'jquery-rails'\n # Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks\n gem 'turbolinks', '~> 5.x'\n # Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\n gem 'jbuilder', '~> 2.0'\n # Use Redis adapter to run Action Cable in production\n # gem 'redis', '~> 3.0'\n # Use ActiveModel has_secure_password\n # gem 'bcrypt', '~> 3.1.7'\n\n # Use Capistrano for deployment\n # gem 'capistrano-rails', group: :development\n\n group :development, :test do\n   # Call 'byebug' anywhere in the code to stop execution and get a debugger console\n   gem 'byebug'\n end\n\n group :development do\n   # Access an IRB console on exception pages or by using <%= console %> in views\n   gem 'web-console', '~> 3.0'\n   gem 'listen', '~> 3.0.5'\n   # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\n   gem 'spring'\n   gem 'spring-watcher-listen', '~> 2.0.0'\n end\n\n # Windows does not include zoneinfo files, so bundle the tzinfo-data gem\n gem 'tzinfo-data', platforms: [:mingw, :mswin, :x64_mingw, :jruby]\n\n\n\n\u518d\u5ea6\u30b3\u30f3\u30c6\u30ca\u3067bundle install\u3057\u3066rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n docker run --rm -it -v $(pwd)/app:/var/myapp bin_web bash\n\n # \u4ee5\u964d\u3053\u306e\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u306e\u7d42\u308f\u308a\u307e\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e\u4f5c\u696d\n # dbms\u306fmysql\u306b\u3059\u308b\u3002\n bundle install && bundle exec rails new . -d mysql\n\n\u3053\u306e\u3068\u304dOverwrite /var/myapp/Gemfile? (enter \"h\" for help) [Ynaqdh]\u3068\u3001Gemfile\u3092\u4e0a\u66f8\u304d\u3059\u308b\u304b\u3068\u805e\u3044\u3066\u304d\u307e\u3059\u304c\u3001\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305f\u306e\u3067n\u306b\u3057\u307e\u3057\u305f\u3002\n\n\ndatabase\u8a2d\u5b9a\n\u30db\u30b9\u30c8\u306b\u623b\u3063\u3066 docker-compose\u3067link\u3059\u308bmysql\u306b\u5bfe\u3057\u3066\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n database.yml\u306frails\u304c\u30ed\u30fc\u30c9\u3059\u308b\u524d\u306berb\u3067\u51e6\u7406\u3059\u308b\u306e\u3067\u4efb\u610f\u306eerb\u306e\u5f0f\u304c\u4f7f\u3048\u308b\u305f\u3081\u3001\u305d\u3053\u3067\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u6e21\u3057\u3066\u3044\u308b\u74b0\u5883\u5909\u6570\u304b\u3089\u63a5\u7d9a\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\napp/config/database.yml\n <%\n database_host = ENV['DATABASE_HOST'] || 'localhost'\n database_port= ENV['DATABASE_PORT'] || 3306\n %>\n default: &default\n   adapter: mysql2\n   encoding: utf8\n   pool: 5\n   username: <%= ENV['DATABASE_USER'] %>\n   password: <%= ENV['DATABASE_PASS'] %>\n   port: <%= database_port %>\n   host: <%= database_host %>\n\n development:\n   <<: *default\n   database: <%= ENV['DATABASE_NAME'] %>\n\n # test\u3068production\u306f\u7701\u7565\n\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n \u3053\u308c\u3067\u8a2d\u5b9a\u304c\u3067\u304d\u305f\u306e\u3067\u3001docker-compose\u3067up\u3057\u307e\u3059\u3002(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u3059\u308b\u306a\u3089up -d)\n docker/bin/run-docker-compose.sh up\n\n\n\ndb\u3068web\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u305f\u5f8c\u3001docker-machine ip\u3067\u78ba\u8a8d\u3057\u305fip\u306e3000\u756aport\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066rails\u306ewelcome\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u4e00\u65e6\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\n\ngit \u767b\u9332\n\u3053\u3053\u307e\u3067\u3067git\u3067\u7ba1\u7406\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067git init\u3057\u305f\u3044\u3067\u3059\u304c\u3001app/vendor\u4ee5\u4e0b\u3068app/tmp\u4ee5\u4e0b\u306fgit\u306b\u5165\u308c\u305f\u304f\u306a\u3044\u306e\u3067\u3001.gitignore\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\napp/.gitignore\n  app/tmp/*\n  app/vendor/*  \n\n\u3067\u3001git\u306b\u767b\u9332\u3057\u307e\u3059\u3002\n  git init\n  git add -A\n  git commit -m \"initial commit\"\n\n\n\u56f0\u3063\u305f\u70b9\n\u4e0a\u8a18\u307e\u3067\u3067\u4e00\u65e6rails\u306e\u8d77\u52d5\u307e\u3067\u3044\u3063\u305f\u3093\u3067\u3059\u304c\u3001\u3053\u3053\u304b\u3089\u3044\u3056\u958b\u767a\u3057\u3088\u3046\u3068\u3057\u305f\u3089\u3044\u308d\u3044\u308d\u554f\u984c\u304c\u3042\u3063\u3066\u3001\u4e3b\u306bdocker-machine(\u3068\u3044\u3046\u304bvirtual box\u306a\u3069\u306eshared folder\u3067\u30bd\u30fc\u30b9\u3092\u30db\u30b9\u30c8\u3068\u5171\u6709\u3059\u308b\u304c\u3086\u3048\u306e)\u554f\u984c\u3060\u3063\u305f\u306e\u3067\u7d50\u69cb\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\n\u30ea\u30ed\u30fc\u30c9\u3055\u308c\u306a\u3044\u554f\u984c\n\u3053\u308c\u3067\u74b0\u5883\u304c\u3067\u304d\u305f\u306e\u3067\u9069\u5f53\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\ndocker exec -it web bash\u3067\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\n   # hello \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u4f5c\u6210\n   bundle exec bin/rails g controller hello\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3068\u30d3\u30e5\u30fc\u3092\u4f5c\u6210\napp/controllers/hello_controller.rb\n   class HelloController < ApplicationController\n     def hello\n       @msg = \"world\"\n     end\n   end\n\napp/views/hello.html.erb\n   Hello, <%= @msg %>\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30821\u3064\u8ffd\u52a0\u3057\u307e\u3059\u3002app/config/routes.rb \n   Rails.application.routes.draw do\n    # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\n\n    # Serve websocket cable requests in-process\n    # mount ActionCable.server => '/cable'\n    get 'hello' => 'hello#hello'\n  end\n\n\u4e00\u5fdcdocker/bin/run-docker-compose.sh down; docker/bin/run-docker-compose.sh up\u3067\u30af\u30ea\u30fc\u30f3\u306a\u72b6\u614b\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067http://$(docker-machine's ip)/hello\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n\u304d\u3061\u3093\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u6b21\u306b\u3001app/controller/hello_controller.rb\u3092\u7de8\u96c6\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8(world\u306e\u90e8\u5206)\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\n  class HelloController < ApplicationController\n    def hello\n      @msg = \"docker\"\n    end\n  end\n\n\u3053\u308c\u3067hello, world\u304b\u3089hello, docker\u306b\u306a\u308b\u306f\u305a\u3067\u3059\u3001\u304creload\u3057\u3066\u3082hello, world\u306e\u307e\u307e\u3067\u3059\u3002\n\u3067\u3001\u3044\u308d\u3044\u308d\u7d06\u4f59\u66f2\u6298\u3057\u3066\u305f\u3069\u308a\u3064\u3044\u305f\u306e\u304c\u3001\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u3066\u3044\u308b\u306e\u306fapp/config/environments/development.rb\u306efile_watcher\u306e\u90e8\u5206\u3002\n\u305d\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5185\u3067config.file_watcher = ActiveSupport::EventedFileUpdateChecker\u306b\u3088\u3063\u3066\u691c\u77e5\u3057\u3066\u3044\u308b\n\u305f\u3060\u3001\u305d\u306e\u691c\u77e5\u65b9\u6cd5\u304c\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u3066\u691c\u77e5\u3057\u3066\u3044\u308b\u304cdocker-machine\u306e\u5171\u6709\u30d5\u30a1\u30a4\u30eb\u306b\u95a2\u3057\u3066\u306f\u305d\u306e\u5909\u66f4\u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u306a\u3044\u3002\n\uff08\u3053\u308c\u306fdocker-machine\u306e\u554f\u984c\u3067\u306a\u304f\u3001\u5171\u6709\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30db\u30b9\u30c8\u5074\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u65b9\u5f0f\u3067\u306f\u4ed5\u69d8\u3068\u3057\u3066\u3069\u3046\u3057\u3088\u3046\u3082\u306a\u3044\u305d\u3046\u3067\u3059\u3002)\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306a\u3093\u3068\u304b\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u5f62\u5f0f\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u76e3\u8996\u3059\u308b\u65b9\u6cd5\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3057\u305f\u3002\n  \u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001\u6614\u306f\u305d\u306e\u65b9\u5f0f\u3060\u3063\u305f\u3088\u3046\u3067\u305d\u306e\u65b9\u5f0f\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u3068\u81ea\u52d5\u3067\u30ea\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3057\u305f\u3002\u3002\n\napp/config/environments/developments.rb\u3067\u3001\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308bconfig.file_watcher\u3092\u4e0b\u8a18\u306e\u3082\u306e\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002\n\n  config.file_watcher = ActiveSupport::FileUpdateChecker  \n\n\u5909\u66f4\u5f8c\u3001docker/bin/run-docker-compose.sh down; docker/bin/run-docker-compose.sh up\u3067\u30af\u30ea\u30fc\u30f3\u306a\u72b6\u614b\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n  \u3067\u3001app/controller/hello_controller.rb\u3092\u518d\u5ea6\u7de8\u96c6\u3057\u3066\u307f\u307e\u3059\u3002\n  class HelloController < ApplicationController\n    def hello\n      @msg = \"docker docker docker\"\n    end\n  end\n\n\u3067\u3082\u3084\u3063\u3071\u308a\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002\n\u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001docker-machine\u3067virtual box\u3092\u30c9\u30e9\u30a4\u30d0\u306b\u3057\u3066\u666e\u901a\u306b\u4f5c\u6210\u3059\u308b\u3068\u3001\u30db\u30b9\u30c8\u5074\u3068\u6642\u523b\u304c\u5fae\u5999\u306b\u305a\u308c\u308b\u3068\u306e\u3053\u3068\u3002\n  \u305d\u306e\u305a\u308c\u305f\u6642\u9593\u306e\u305b\u3044\u3067\u30db\u30b9\u30c8\u306e\u6642\u523b\u306e\u65b9\u304c\u672a\u6765\u6642\u9593\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u4e0a\u3067\u8a2d\u5b9a\u3057\u305fActiveSupport::FileUpdateChecker\u304c\u30ea\u30ed\u30fc\u30c9\u3057\u306a\u3044\u3001\u3068\u3044\u3046\u51e6\u7406\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n./bundle/ruby/2.3.0/gems/activesupport-5.0.0.beta3/lib/active_support/file_update_checker.rb\n    # This method returns the maximum mtime of the files in +paths+, or +nil+\n    # if the array is empty.\n    #\n    # Files with a mtime in the future are ignored. Such abnormal situation\n    # can happen for example if the user changes the clock by hand. It is\n    # healthy to consider this edge case because with mtimes in the future\n    # reloading is not triggered.\n    def max_mtime(paths)\n      time_now = Time.now\n      paths.map {|path| File.mtime(path)}.reject {|mtime| time_now < mtime}.max\n    end\n\n\n\u3000\u3000\u3000\u3053\u3053\u3067\u3059\u306d\u3002\u6700\u5927\u306e\u66f4\u65b0\u6642\u523b\u3092\u53d6\u5f97\u3059\u308b\u3093\u3067\u3059\u304c\u3001\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u66f4\u65b0\u6642\u9593\u304c\u672a\u6765\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u306fabnormal\u306a\u306e\u3067\u7121\u8996\u3059\u308b\u300d\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6700\u521d\u3053\u306e\u51e6\u7406\u3092\u77e5\u3089\u305a\u306b\u3001\u300c\u672a\u6765\u65e5\u4ed8\u306a\u3093\u3060\u304b\u3089\u7d76\u5bfe\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u3068\u307f\u306a\u3055\u308c\u308b\u3060\u308d\u3046\u300d\u3068\u601d\u3044\u8fbc\u3093\u3067\u3044\u305f\u306e\u3067\u76f8\u5f53\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u3084\u3063\u3071\u308a\u30bd\u30fc\u30b9\u3092\u8aad\u3080\u306e\u306f\u5927\u4e8b\u3067\u3059\u306d\u3002\n\u4eca\u56de\u50d5\u304c\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f6\u5206\u3050\u3089\u3044\u30db\u30b9\u30c8\u3068docker-machine\u3067\u6642\u523b\u304c\u305a\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u305d\u306e\u5834\u5408docker-machine\u306e\u30c9\u30e9\u30a4\u30d0\u304cvirtual box\u306e\u5834\u5408\u306fdocker-machine ssh\u3067docmer-machine\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u4e0a\u3067\n  sudo VBoxControl guestproperty set \"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\" 5000\n\n\u3067\u3001docker-machine\u306e\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u308bvirtual\u3000box\u306e\u6642\u523b\u3068\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u6642\u523b\u306e\u30ba\u30ec\u3092\u6291\u3048\u308b\uff08\u3053\u3053\u3067\u306f5\u79d2(=5000))\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\n\u30b3\u30b3\u306b\u305f\u3069\u308a\u7740\u304f\u307e\u3067\u3060\u3044\u3076\u6642\u9593\u30ed\u30b9\u3057\u307e\u3057\u305f\u3002\u3002\n\nweb-console\u306e\u30a8\u30e9\u30fc\u554f\u984c\n\u3053\u308c\u3067\u884c\u3051\u308b\u304b\u3082\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3044\u3056\u8868\u793a\u3059\u308b\u3068web-console\u306e\u30a8\u30e9\u30fc\u3002\u3002\u3002\n\u3053\u308c\u306f\u3001docker-machine\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\uff08mac)\u3068\u5b9f\u969b\u306b\u30a2\u30d7\u30ea\u304c\u3042\u308b\u30db\u30b9\u30c8(docker-machine)\u304c\u9055\u3046\u305b\u3044\u3067\u3057\u305f\u3002\n\u3069\u3053\u304b\u3089\u3067\u3082web-console\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u89e3\u6c7a\napp/config/environments/development.rb\n  config.web_console.whitelisted_ips = %w( 0.0.0.0/0 ::/0 )\n\n\n\u307e\u3068\u3081\n\u4ee5\u4e0a\u306e\u8003\u616e\u3092\u3044\u308c\u305f\u3082\u306e\u3092https://github.com/pocari/rails5-docker-sample/tree/ver01-rails-on-docker-setup\u306b\u3042\u3052\u307e\u3057\u305f\u3002\n## docker\u3067rails\u74b0\u5883\u69cb\u7bc9\n\n`rails5` + `mysql`\u306e\u958b\u767a\u74b0\u5883\u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u3001docker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\n`docker-machine`\u3067\u4f5c\u696d\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3082\u306e\u3059\u3054\u304f\u30cf\u30de\u3063\u305f\u306e\u3067\u305d\u306e\u4f5c\u696d\u8a18\u9332\u3082\u3002\n\n### \u4f5c\u696d\u74b0\u5883\n`rails`\u3068`mysql`\u306f\u305d\u308c\u305e\u308c\u72ec\u7acb\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u3067`docker-compose`\u3067\u307e\u3068\u3081\u307e\u3059\u3002\n\u307e\u305f\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306fmac\u306a\u306e\u3067`docker-machine`\u3067`docker`\u306e\u74b0\u5883\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n- docker-machine v0.7.0\n- docker v1.11.0\n- docker-compose v1.7.0\n\n### rails\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n#### \u65b9\u91dd\n\n  - \u30db\u30b9\u30c8\u5074\u306b`ruby`\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u304f\u3066\u3082\u958b\u767a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n  - rails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a9\u30eb\u30c0\u81ea\u4f53\u306f\u30dc\u30ea\u30e5\u30fc\u30e0\u3067\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u81ea\u4f53\u306f\u30db\u30b9\u30c8\u74b0\u5883\u3067\u884c\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\n#### rails\u30b3\u30f3\u30c6\u30ca\u306e\u69cb\u6210\n\n  - ruby 2.3.0\n  - rails5 beta3\n\n  \u306e\u74b0\u5883\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n##### Dockerfile\n  - \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n  \n  ```sh\n   % tree\n   .\n   \u251c\u2500\u2500 app               # rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n   \u2514\u2500\u2500 docker            # docker\u306e\u95a2\u9023\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u251c\u2500\u2500 bin            #   docker-compose\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u251c\u2500\u2500 db             #   mysql\u7528\u306edocker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n       \u2514\u2500\u2500 web            #   rails\u7528\u306edocker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n  ```\n\n  \u4ee5\u4e0b\u4f5c\u696d\u306e\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4e0a\u8a18\u306e`.`\u306e\u4f4d\u7f6e\u3067\u884c\u3044\u307e\u3059\u3002\n\n  - mysql\u7528\u306edocker\u30d5\u30a1\u30a4\u30eb `docker/db/Dockerfile`\n\n  \u4eca\u56de\u306frails\u5074\u306e\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u304c\u30e1\u30a4\u30f3\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u306f\u3057\u307e\u305b\u3093\u3002\n\n  ```sh:docker/db/Dockerfile\n  FROM mysql:5.7\n  ```\n\n  - rails\u7528\u306edocker\u30d5\u30a1\u30a4\u30eb `docker/web/Dockerfile`\n\n  \u8d77\u52d5\u6642\u306b`app`\u30d5\u30a9\u30eb\u30c0\u3092\u30de\u30a6\u30f3\u30c8\u51fa\u6765\u308b\u3088\u3046\u306bweb\u30b3\u30f3\u30c6\u30ca\u306e`/var/myapp`\u3092`VOLUME`\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n  ```docker:docker/web/Dockerfile\n  FROM ruby:2.3\n\n  ############################################################\n  # ruby setting bundler\u3060\u3051\u306fglobal\u306b\u5165\u308c\u3066\u304a\u304f\n  RUN gem install bundler\n\n  #####################################################\n  # misc settings\n  RUN usermod -u 1000 www-data\n  RUN \\cp -fp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\n  VOLUME /var/myapp\n  WORKDIR /var/myapp\n  \n  EXPOSE 3000\n\n  CMD [\"bash\"]\n  ```\n\n  - `docker-compose`\u7528\u30d5\u30a1\u30a4\u30eb\n\n    `docker-compose.yml`\u306f\u4e2d\u3067\u74b0\u5883\u5909\u6570\u304c\u5c55\u958b\u51fa\u6765\u308b\u306e\u3067\u3001\u5404Docker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30d1\u30b9\u3092\u74b0\u5883\u5909\u6570\u3067\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u305f\u3081\u306b`docker-compose`\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e9\u30c3\u30d1\u30fc\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u3063\u3066`docker-compose`\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n    - `docker/bin/run-docker-compose.sh`\n\n      ```sh:docker/bin/run-docker-compose.sh\n      #!/bin/sh\n\n      SCRIPT_DIR=$(cd $(dirname $0) && pwd)\n\n      export DB_DOCKERFILE_DIR=${SCRIPT_DIR}/../db\n      export WEB_DOCKERFILE_DIR=${SCRIPT_DIR}/../web\n      export WEB_APP_ROOT_DIR=${SCRIPT_DIR}/../../app\n\n      export MYSQL_DATABASE=mydb\n      export MYSQL_USER=dbuser\n      export MYSQL_PASSWORD=dbuser_pass\n      export MYSQL_ROOT_PASSWORD=root\n\n      YML_FILE=$SCRIPT_DIR/docker-compose.yml\n\n      docker-compose -f $YML_FILE $*\n      ```\n\n    - `docker/bin/docker-compose.sh`\n\n      `web`\u304b\u3089`db`\u3092\u53c2\u7167\u51fa\u6765\u308b\u3088\u3046\u306b`links`\u306e\u8a2d\u5b9a\u3068\u30db\u30b9\u30c8\u5074\u306e`rails`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306e`volumes`\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n      ```docker:docker/bin/docker-compose.sh\n      db:\n        container_name: db\n        build: ${DB_DOCKERFILE_DIR}\n        ports:\n          - \"3306:3306\"\n        environment:\n          MYSQL_DATABASE: ${MYSQL_DATABASE}\n          MYSQL_USER: ${MYSQL_USER}\n          MYSQL_PASSWORD: ${MYSQL_PASSWORD}\n          MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD}\n      \n      web:\n        container_name: web\n        build: ${WEB_DOCKERFILE_DIR}\n        ports:\n          - \"3000:3000\"\n        links:\n          - db:db\n        volumes:\n          - ${WEB_APP_ROOT_DIR}:/var/myapp\n        environment:\n          DATABASE_NAME: ${MYSQL_DATABASE}\n          DATABASE_USER: ${MYSQL_USER}\n          DATABASE_PASS: ${MYSQL_PASSWORD}\n          DATABASE_HOST: db\n        command: sh -c \"bundle install --path=vendor/bundle && rm tmp/pids/server.pid; bin/rails s -b 0.0.0.0\"\n      ```\n\n##### \u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n\n   - `docker build` & `rials`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n\n     \u3053\u308c\u3067\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001`docker-compose build`\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n     ```sh\n     docker/bin/run-docker-compose.sh build\n     ```  \n\n     \u6b21\u306bweb\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066\u3044\u308b`ruby`\u3067`rails`\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002\n\n     ```sh\n     docker run --rm -it -v $(pwd)/app:/var/myapp bin_web bash  #docker-compose\u3067\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3068bin_${yaml\u306e\u5b9a\u7fa9\u540d}\u306b\u306a\u308a\u307e\u3059\u3002\n\n     # \u4ee5\u964d\u3053\u306e\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u306e\u7d42\u308f\u308a\u307e\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e\u4f5c\u696d\n\n     # Gemfile\u521d\u671f\u5316\n     bundle init\n\n     # \u3053\u306e\u8a18\u4e8b\u3092\u4f5c\u6210\u4e2d\u306e\u6700\u65b0\u306e5.0.0.beta3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n     echo \"gem 'rails', '5.0.0.beta3'\" >> Gemfile\n\n     # \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30ed\u30fc\u30ab\u30eb\u306brails5\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n     bundle install --path=vendor/bundle\n\n     # rails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n     # \u3068\u308a\u3042\u3048\u305a\u96db\u5f62\u306eGemfile\u3092\u4f5c\u308a\u305f\u3044\u3060\u3051\u306a\u306e\u3067\u3042\u3068\u3067\u3053\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u5168\u90e8\u524a\u9664\u3057\u307e\u3059\u3002\n     bundle exec rails new sample_app --skip-bundle\n     #\u3067\u304d\u305fGemfile\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n     mv sample_app/Gemfile .\n     #sample_app\u306f\u3082\u3046\u3044\u3089\u306a\u3044\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\n     rm -rf sample_app\n\n     # \u6b21\u306brails\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u304c\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u306f\u30db\u30b9\u30c8\u306e\u65b9\u304c\u3084\u308a\u3084\u3059\u3044\u306e\u3067\u4e00\u65e6\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u51fa\u307e\u3059\u3002\n     exit\n     ```\n\n   - Gemfile\u8a2d\u5b9a\n      \n     \u30db\u30b9\u30c8\u5074\u3067Gemfile\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f`sqlite`\u306e\u66ff\u308f\u308a\u306b`mysql2`\u306b\u5909\u3048\u305f\u306e\u3068`therubyracer`\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u305f\u3060\u3051\u3067\u5f8c\u306f\u5168\u90e8`rails new`\u304c\u4f5c\u6210\u3057\u3066\u304f\u308c\u305f\u307e\u307e\u3067\u3059\u3002\n     \n     ```ruby\n     source 'https://rubygems.org'\n     \n     \n     # Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\n     gem 'rails', '>= 5.0.0.beta3', '< 5.1'\n     # Use sqlite3 as the database for Active Record\n     gem 'mysql2'\n     # Use Puma as the app server\n     gem 'puma'\n     # Use SCSS for stylesheets\n     gem 'sass-rails', '~> 5.0'\n     # Use Uglifier as compressor for JavaScript assets\n     gem 'uglifier', '>= 1.3.0'\n     # Use CoffeeScript for .coffee assets and views\n     gem 'coffee-rails', '~> 4.1.0'\n     # See https://github.com/rails/execjs#readme for more supported runtimes\n     gem 'therubyracer', platforms: :ruby\n     \n     # Use jquery as the JavaScript library\n     gem 'jquery-rails'\n     # Turbolinks makes navigating your web application faster. Read more: https://github.com/turbolinks/turbolinks\n     gem 'turbolinks', '~> 5.x'\n     # Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\n     gem 'jbuilder', '~> 2.0'\n     # Use Redis adapter to run Action Cable in production\n     # gem 'redis', '~> 3.0'\n     # Use ActiveModel has_secure_password\n     # gem 'bcrypt', '~> 3.1.7'\n     \n     # Use Capistrano for deployment\n     # gem 'capistrano-rails', group: :development\n     \n     group :development, :test do\n       # Call 'byebug' anywhere in the code to stop execution and get a debugger console\n       gem 'byebug'\n     end\n     \n     group :development do\n       # Access an IRB console on exception pages or by using <%= console %> in views\n       gem 'web-console', '~> 3.0'\n       gem 'listen', '~> 3.0.5'\n       # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\n       gem 'spring'\n       gem 'spring-watcher-listen', '~> 2.0.0'\n     end\n     \n     # Windows does not include zoneinfo files, so bundle the tzinfo-data gem\n     gem 'tzinfo-data', platforms: [:mingw, :mswin, :x64_mingw, :jruby]\n     ```\n     \n   - \u518d\u5ea6\u30b3\u30f3\u30c6\u30ca\u3067`bundle install`\u3057\u3066`rails`\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n\n     ```sh\n     docker run --rm -it -v $(pwd)/app:/var/myapp bin_web bash\n\n     # \u4ee5\u964d\u3053\u306e\u30b3\u30fc\u30c9\u30d6\u30ed\u30c3\u30af\u306e\u7d42\u308f\u308a\u307e\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u306e\u4f5c\u696d\n     # dbms\u306fmysql\u306b\u3059\u308b\u3002\n     bundle install && bundle exec rails new . -d mysql\n     ```\n\n     \u3053\u306e\u3068\u304d`Overwrite /var/myapp/Gemfile? (enter \"h\" for help) [Ynaqdh]`\u3068\u3001Gemfile\u3092\u4e0a\u66f8\u304d\u3059\u308b\u304b\u3068\u805e\u3044\u3066\u304d\u307e\u3059\u304c\u3001\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305f\u306e\u3067`n`\u306b\u3057\u307e\u3057\u305f\u3002\n\n   - database\u8a2d\u5b9a\n\n     \u30db\u30b9\u30c8\u306b\u623b\u3063\u3066 `docker-compose`\u3067link\u3059\u308b`mysql`\u306b\u5bfe\u3057\u3066\u306e\u63a5\u7d9a\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n     database.yml\u306f`rails`\u304c\u30ed\u30fc\u30c9\u3059\u308b\u524d\u306b`erb`\u3067\u51e6\u7406\u3059\u308b\u306e\u3067\u4efb\u610f\u306e`erb`\u306e\u5f0f\u304c\u4f7f\u3048\u308b\u305f\u3081\u3001\u305d\u3053\u3067\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u6e21\u3057\u3066\u3044\u308b\u74b0\u5883\u5909\u6570\u304b\u3089\u63a5\u7d9a\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n     ```app/config/database.yml\n     <%\n     database_host = ENV['DATABASE_HOST'] || 'localhost'\n     database_port= ENV['DATABASE_PORT'] || 3306\n     %>\n     default: &default\n       adapter: mysql2\n       encoding: utf8\n       pool: 5\n       username: <%= ENV['DATABASE_USER'] %>\n       password: <%= ENV['DATABASE_PASS'] %>\n       port: <%= database_port %>\n       host: <%= database_host %>\n\n     development:\n       <<: *default\n       database: <%= ENV['DATABASE_NAME'] %>\n\n     # test\u3068production\u306f\u7701\u7565\n     ```\n\n   - \u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n     \u3053\u308c\u3067\u8a2d\u5b9a\u304c\u3067\u304d\u305f\u306e\u3067\u3001`docker-compose`\u3067`up`\u3057\u307e\u3059\u3002(\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u3059\u308b\u306a\u3089`up -d`)\n\n     ```\n     docker/bin/run-docker-compose.sh up\n     ```\n\n   `db`\u3068`web`\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u305f\u5f8c\u3001`docker-machine ip`\u3067\u78ba\u8a8d\u3057\u305fip\u306e3000\u756aport\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066rails\u306ewelcome\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u4e00\u65e6\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-20 0.04.10.png](https://qiita-image-store.s3.amazonaws.com/0/34692/8def393b-59f4-206f-bc4d-28e0eba53922.png)\n\n\n\n### git \u767b\u9332\n  \u3053\u3053\u307e\u3067\u3067`git`\u3067\u7ba1\u7406\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067`git init`\u3057\u305f\u3044\u3067\u3059\u304c\u3001`app/vendor`\u4ee5\u4e0b\u3068`app/tmp`\u4ee5\u4e0b\u306fgit\u306b\u5165\u308c\u305f\u304f\u306a\u3044\u306e\u3067\u3001`.gitignore`\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n  \n  app/.gitignore\n  \n  ```\n  app/tmp/*\n  app/vendor/*  \n  ```\n  \n  \u3067\u3001`git`\u306b\u767b\u9332\u3057\u307e\u3059\u3002\n  \n  ```\n  git init\n  git add -A\n  git commit -m \"initial commit\"\n  ```\n  \n### \u56f0\u3063\u305f\u70b9\n\n  \u4e0a\u8a18\u307e\u3067\u3067\u4e00\u65e6rails\u306e\u8d77\u52d5\u307e\u3067\u3044\u3063\u305f\u3093\u3067\u3059\u304c\u3001\u3053\u3053\u304b\u3089\u3044\u3056\u958b\u767a\u3057\u3088\u3046\u3068\u3057\u305f\u3089\u3044\u308d\u3044\u308d\u554f\u984c\u304c\u3042\u3063\u3066\u3001\u4e3b\u306b`docker-machine`(\u3068\u3044\u3046\u304b`virtual box`\u306a\u3069\u306e`shared folder`\u3067\u30bd\u30fc\u30b9\u3092\u30db\u30b9\u30c8\u3068\u5171\u6709\u3059\u308b\u304c\u3086\u3048\u306e)\u554f\u984c\u3060\u3063\u305f\u306e\u3067\u7d50\u69cb\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\n\n#### \u30ea\u30ed\u30fc\u30c9\u3055\u308c\u306a\u3044\u554f\u984c\n\n   \u3053\u308c\u3067\u74b0\u5883\u304c\u3067\u304d\u305f\u306e\u3067\u9069\u5f53\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n   `docker exec -it web bash`\u3067\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\n   \n   ```rb\n   # hello \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u4f5c\u6210\n   bundle exec bin/rails g controller hello\n   ```\n  \n   \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3068\u30d3\u30e5\u30fc\u3092\u4f5c\u6210\n\n   app/controllers/hello_controller.rb\n      \n   ```rb\n   class HelloController < ApplicationController\n     def hello\n       @msg = \"world\"\n     end\n   end\n   ```\n   \n   app/views/hello.html.erb\n   \n   ```\n   Hello, <%= @msg %>\n   ```\n   \n   \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30821\u3064\u8ffd\u52a0\u3057\u307e\u3059\u3002`app/config/routes.rb` \n\n   ```rb\n   Rails.application.routes.draw do\n    # For details on the DSL available within this file, see http://guides.rubyonrails.org/routing.html\n \n    # Serve websocket cable requests in-process\n    # mount ActionCable.server => '/cable'\n    get 'hello' => 'hello#hello'\n  end\n  ```\n  \n  \u4e00\u5fdc`docker/bin/run-docker-compose.sh down; docker/bin/run-docker-compose.sh up`\u3067\u30af\u30ea\u30fc\u30f3\u306a\u72b6\u614b\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n  \n  \u3053\u308c\u3067`http://$(docker-machine's ip)/hello`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n  <img width=\"344\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-20 0.34.53.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/34692/9ebe08f1-80fd-dc3a-d97a-dcc723769d38.png\">\n\n  \u304d\u3061\u3093\u3068\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n  \n  \u6b21\u306b\u3001`app/controller/hello_controller.rb`\u3092\u7de8\u96c6\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8(`world`\u306e\u90e8\u5206)\u3092\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\n  \n  ```\n  class HelloController < ApplicationController\n    def hello\n      @msg = \"docker\"\n    end\n  end\n  ```\n  \n  \u3053\u308c\u3067`hello, world`\u304b\u3089`hello, docker`\u306b\u306a\u308b\u306f\u305a\u3067\u3059\u3001\u304creload\u3057\u3066\u3082`hello, world`\u306e\u307e\u307e\u3067\u3059\u3002\n  \n  \u3067\u3001\u3044\u308d\u3044\u308d\u7d06\u4f59\u66f2\u6298\u3057\u3066\u305f\u3069\u308a\u3064\u3044\u305f\u306e\u304c\u3001\n  \n  - \u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u3066\u3044\u308b\u306e\u306f`app/config/environments/development.rb`\u306e`file_watcher`\u306e\u90e8\u5206\u3002\n  - \u305d\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5185\u3067`config.file_watcher = ActiveSupport::EventedFileUpdateChecker`\u306b\u3088\u3063\u3066\u691c\u77e5\u3057\u3066\u3044\u308b\n  - \u305f\u3060\u3001\u305d\u306e\u691c\u77e5\u65b9\u6cd5\u304c\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u3066\u691c\u77e5\u3057\u3066\u3044\u308b\u304c`docker-machine`\u306e\u5171\u6709\u30d5\u30a1\u30a4\u30eb\u306b\u95a2\u3057\u3066\u306f\u305d\u306e\u5909\u66f4\u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u306a\u3044\u3002\n    \uff08\u3053\u308c\u306f`docker-machine`\u306e\u554f\u984c\u3067\u306a\u304f\u3001\u5171\u6709\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30db\u30b9\u30c8\u5074\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u65b9\u5f0f\u3067\u306f\u4ed5\u69d8\u3068\u3057\u3066\u3069\u3046\u3057\u3088\u3046\u3082\u306a\u3044\u305d\u3046\u3067\u3059\u3002)\n    \n  \u3068\u3044\u3046\u3053\u3068\u3067\u3001\u306a\u3093\u3068\u304b\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u5f62\u5f0f\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u76e3\u8996\u3059\u308b\u65b9\u6cd5\u304c\u5fc5\u8981\u306a\u3088\u3046\u3067\u3057\u305f\u3002\n  \u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001\u6614\u306f\u305d\u306e\u65b9\u5f0f\u3060\u3063\u305f\u3088\u3046\u3067\u305d\u306e\u65b9\u5f0f\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u3068\u81ea\u52d5\u3067\u30ea\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3057\u305f\u3002\u3002\n  \n  - app/config/environments/developments.rb\u3067\u3001\u65e2\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b`config.file_watcher`\u3092\u4e0b\u8a18\u306e\u3082\u306e\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002\n  \n  ```\n  config.file_watcher = ActiveSupport::FileUpdateChecker  \n  ```\n  \n  \u5909\u66f4\u5f8c\u3001`docker/bin/run-docker-compose.sh down; docker/bin/run-docker-compose.sh up`\u3067\u30af\u30ea\u30fc\u30f3\u306a\u72b6\u614b\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n  \u3067\u3001`app/controller/hello_controller.rb`\u3092\u518d\u5ea6\u7de8\u96c6\u3057\u3066\u307f\u307e\u3059\u3002\n  \n  ```rb\n  class HelloController < ApplicationController\n    def hello\n      @msg = \"docker docker docker\"\n    end\n  end\n  ```\n  \n  \u3067\u3082\u3084\u3063\u3071\u308a\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002\n  \n  \u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u307f\u308b\u3068\u3001`docker-machine`\u3067`virtual box`\u3092\u30c9\u30e9\u30a4\u30d0\u306b\u3057\u3066\u666e\u901a\u306b\u4f5c\u6210\u3059\u308b\u3068\u3001\u30db\u30b9\u30c8\u5074\u3068\u6642\u523b\u304c\u5fae\u5999\u306b\u305a\u308c\u308b\u3068\u306e\u3053\u3068\u3002\n  \u305d\u306e\u305a\u308c\u305f\u6642\u9593\u306e\u305b\u3044\u3067\u30db\u30b9\u30c8\u306e\u6642\u523b\u306e\u65b9\u304c\u672a\u6765\u6642\u9593\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u4e0a\u3067\u8a2d\u5b9a\u3057\u305f`ActiveSupport::FileUpdateChecker`\u304c\u30ea\u30ed\u30fc\u30c9\u3057\u306a\u3044\u3001\u3068\u3044\u3046\u51e6\u7406\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n  \n```rb:./bundle/ruby/2.3.0/gems/activesupport-5.0.0.beta3/lib/active_support/file_update_checker.rb\n    # This method returns the maximum mtime of the files in +paths+, or +nil+\n    # if the array is empty.\n    #\n    # Files with a mtime in the future are ignored. Such abnormal situation\n    # can happen for example if the user changes the clock by hand. It is\n    # healthy to consider this edge case because with mtimes in the future\n    # reloading is not triggered.\n    def max_mtime(paths)\n      time_now = Time.now\n      paths.map {|path| File.mtime(path)}.reject {|mtime| time_now < mtime}.max\n    end\n```\n  \n\u3000\u3000\u3000\u3053\u3053\u3067\u3059\u306d\u3002\u6700\u5927\u306e\u66f4\u65b0\u6642\u523b\u3092\u53d6\u5f97\u3059\u308b\u3093\u3067\u3059\u304c\u3001\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u66f4\u65b0\u6642\u9593\u304c\u672a\u6765\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u306f`abnormal`\u306a\u306e\u3067\u7121\u8996\u3059\u308b\u300d\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6700\u521d\u3053\u306e\u51e6\u7406\u3092\u77e5\u3089\u305a\u306b\u3001\u300c\u672a\u6765\u65e5\u4ed8\u306a\u3093\u3060\u304b\u3089\u7d76\u5bfe\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u3068\u307f\u306a\u3055\u308c\u308b\u3060\u308d\u3046\u300d\u3068\u601d\u3044\u8fbc\u3093\u3067\u3044\u305f\u306e\u3067\u76f8\u5f53\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u3084\u3063\u3071\u308a\u30bd\u30fc\u30b9\u3092\u8aad\u3080\u306e\u306f\u5927\u4e8b\u3067\u3059\u306d\u3002\n\n  \u4eca\u56de\u50d5\u304c\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f6\u5206\u3050\u3089\u3044\u30db\u30b9\u30c8\u3068`docker-machine`\u3067\u6642\u523b\u304c\u305a\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u305d\u306e\u5834\u5408`docker-machine`\u306e\u30c9\u30e9\u30a4\u30d0\u304c`virtual box`\u306e\u5834\u5408\u306f`docker-machine ssh`\u3067`docmer-machine`\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u4e0a\u3067\n  \n  ```\n  sudo VBoxControl guestproperty set \"/VirtualBox/GuestAdd/VBoxService/--timesync-set-threshold\" 5000\n  ```\n  \n  \u3067\u3001`docker-machine`\u306e\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u308b`virtual\u3000box`\u306e\u6642\u523b\u3068\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u6642\u523b\u306e\u30ba\u30ec\u3092\u6291\u3048\u308b\uff08\u3053\u3053\u3067\u306f5\u79d2(=5000))\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\n  \n  \u30b3\u30b3\u306b\u305f\u3069\u308a\u7740\u304f\u307e\u3067\u3060\u3044\u3076\u6642\u9593\u30ed\u30b9\u3057\u307e\u3057\u305f\u3002\u3002\n  \n#### `web-console`\u306e\u30a8\u30e9\u30fc\u554f\u984c\n\n  \u3053\u308c\u3067\u884c\u3051\u308b\u304b\u3082\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3044\u3056\u8868\u793a\u3059\u308b\u3068`web-console`\u306e\u30a8\u30e9\u30fc\u3002\u3002\u3002\n  \n  \u3053\u308c\u306f\u3001`docker-machine`\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\uff08mac)\u3068\u5b9f\u969b\u306b\u30a2\u30d7\u30ea\u304c\u3042\u308b\u30db\u30b9\u30c8(docker-machine)\u304c\u9055\u3046\u305b\u3044\u3067\u3057\u305f\u3002\n  \n  \u3069\u3053\u304b\u3089\u3067\u3082`web-console`\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u89e3\u6c7a\n  \n  `app/config/environments/development.rb`\n\n  ```\n  config.web_console.whitelisted_ips = %w( 0.0.0.0/0 ::/0 )\n  ```\n       \n#### \u307e\u3068\u3081\n\n   \u4ee5\u4e0a\u306e\u8003\u616e\u3092\u3044\u308c\u305f\u3082\u306e\u3092https://github.com/pocari/rails5-docker-sample/tree/ver01-rails-on-docker-setup\u306b\u3042\u3052\u307e\u3057\u305f\u3002\n   \n   \n", "tags": ["docker", "Rails5", "Ruby", "Rails"]}