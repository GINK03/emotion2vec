{"tags": ["Node.js", "JavaScript", "Koa"], "context": " More than 1 year has passed since last update.\n\nGenerator\u3068this\nGenerator\u304cnode.js\u3067\u306fharmony\u30aa\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u3067\u3059\u304c\u30d0\u30fc\u30b8\u30e7\u30f311\u304b\u3089\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\ngeneretor\u306e\u8aac\u660e\u306f\u5404\u6240\u3067\u884c\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u3001\u4eca\u56de\u306fthis\u3068\u306e\u95a2\u4fc2\u3092\u8abf\u67fb\u3057\u307e\u3057\u305f\u3002\n\n\u8abf\u67fb\nthis\u306e\u675f\u7e1b\u306fbind,call,apply\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3055\u3089\u306b\u4eca\u56de\u306fkoa\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u304a\u4e16\u8a71\u306b\u306a\u308bco\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u3069\u306e\u3088\u3046\u306b\u306a\u308b\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\u30b3\u30fc\u30c9\u306fnode --harmony this.js\u3067\u5b9f\u884c\u3057\u307e\u3059 \n\nthis.js\n\n// \u675f\u7e1b\u5bfe\u8c61\nvar self = {x: 1};\n\n// \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\n// yield\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001next\u3092\u4e00\u56de\u5b9f\u65bd\u3057\u305f\u3060\u3051\u3067\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u610f\u5473\u306a\u3044\u3082\u306e\u3067\u3059\u304c\u3001\n// this\u306e\u8abf\u67fb\u3060\u3051\u306a\u306e\u3067\u610f\u5473\u306a\u304f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\u306b\u3057\u3066\u3044\u307e\u3059\nvar generator = function * () {\n    'use strict';\n    if (this === global) console.log('this === global');\n    else if (this === self) console.log('this === self');\n    else if (this === void 0) console.log('this === undefined');\n    else console.log('this === ???');\n};\n\nvar co = require('co');\nvar gn, g;\n\nconsole.log('(1)');\ng = generator();\ng.next(); // this === undefined\n\nconsole.log('(2)');\ngn = generator.bind(self);\ng = gn();\ng.next(); // this === self\n\nconsole.log('(3)');\ng = generator.call(self);\ng.next(); // this === self\n\nconsole.log('(4)');\ng = generator.apply(self);\ng.next(); // this === self\n\nconsole.log('(5)');\ng = generator();\n// g.next.call(self);  // \u4f8b\u5916\u767a\u751f\n// g.next.apply(self);  // \u4f8b\u5916\u767a\u751f\n\nconsole.log('(6)');\nco(generator)(); // this === global\n\nconsole.log('(7)');\ngn = generator.bind(self);\n// co(gn)(); // \u4f8b\u5916\u767a\u751f\n\nconsole.log('(8)');\nco(generator).bind(self)(); // this === self\n\nconsole.log('(9)');\nco(generator).call(self);  // this === self\n\nconsole.log('(10)');\nco(generator).apply(self);  // this === self\n\n\n\n\n\n\u307e\u3068\u3081\nkoa\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3088\u3063\u3066\u306fthis\u306e\u675f\u7e1b\u3092\u5f37\u8981\u3059\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u8a66\u9a13\u7684\u306b\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u3068\u601d\u3063\u3066\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u9762\u767d\u3044\u3053\u3068\u304c\u767a\u898b\u3067\u304d\u307e\u3057\u305f\n5\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u4e00\u5ea6\u4f5c\u6210\u3055\u308c\u305f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fb\u30a4\u30c6\u30ec\u30fc\u30bf\u306ethis\u3092\u9014\u4e2d\u3067\u5909\u66f4\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\n6\u306e\u3088\u3046\u306bco\u3092\u666e\u901a\u306b\u4f7f\u7528\u3059\u308b\u3068use strict\u306b\u3082\u95a2\u308f\u3089\u305aglobal\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u70b9\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n7\u3067\u306fbind\u3055\u308c\u305f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\u306f\u666e\u901a\u306e\u95a2\u6570\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067co\u306e\u5f15\u6570\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\n\n# Generator\u3068this\n\n\nGenerator\u304cnode.js\u3067\u306fharmony\u30aa\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u3067\u3059\u304c\u30d0\u30fc\u30b8\u30e7\u30f311\u304b\u3089\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\ngeneretor\u306e\u8aac\u660e\u306f\u5404\u6240\u3067\u884c\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u3001\u4eca\u56de\u306fthis\u3068\u306e\u95a2\u4fc2\u3092\u8abf\u67fb\u3057\u307e\u3057\u305f\u3002\n\n# \u8abf\u67fb\n\nthis\u306e\u675f\u7e1b\u306fbind,call,apply\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3055\u3089\u306b\u4eca\u56de\u306fkoa\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u304a\u4e16\u8a71\u306b\u306a\u308bco\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u3069\u306e\u3088\u3046\u306b\u306a\u308b\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n\u30b3\u30fc\u30c9\u306f`node --harmony this.js`\u3067\u5b9f\u884c\u3057\u307e\u3059 \n\n```javascript:this.js\n\n// \u675f\u7e1b\u5bfe\u8c61\nvar self = {x: 1};\n\n// \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\n// yield\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001next\u3092\u4e00\u56de\u5b9f\u65bd\u3057\u305f\u3060\u3051\u3067\u51e6\u7406\u304c\u5b8c\u4e86\u3059\u308b\u610f\u5473\u306a\u3044\u3082\u306e\u3067\u3059\u304c\u3001\n// this\u306e\u8abf\u67fb\u3060\u3051\u306a\u306e\u3067\u610f\u5473\u306a\u304f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\u306b\u3057\u3066\u3044\u307e\u3059\nvar generator = function * () {\n\t'use strict';\n\tif (this === global) console.log('this === global');\n\telse if (this === self) console.log('this === self');\n\telse if (this === void 0) console.log('this === undefined');\n\telse console.log('this === ???');\n};\n\nvar co = require('co');\nvar gn, g;\n\nconsole.log('(1)');\ng = generator();\ng.next(); // this === undefined\n\nconsole.log('(2)');\ngn = generator.bind(self);\ng = gn();\ng.next(); // this === self\n\nconsole.log('(3)');\ng = generator.call(self);\ng.next(); // this === self\n\nconsole.log('(4)');\ng = generator.apply(self);\ng.next(); // this === self\n\nconsole.log('(5)');\ng = generator();\n// g.next.call(self);  // \u4f8b\u5916\u767a\u751f\n// g.next.apply(self);  // \u4f8b\u5916\u767a\u751f\n\nconsole.log('(6)');\nco(generator)(); // this === global\n\nconsole.log('(7)');\ngn = generator.bind(self);\n// co(gn)(); // \u4f8b\u5916\u767a\u751f\n\nconsole.log('(8)');\nco(generator).bind(self)(); // this === self\n\nconsole.log('(9)');\nco(generator).call(self);  // this === self\n\nconsole.log('(10)');\nco(generator).apply(self);  // this === self\n\n\n```\n\n\n#\u307e\u3068\u3081\n\nkoa\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3088\u3063\u3066\u306fthis\u306e\u675f\u7e1b\u3092\u5f37\u8981\u3059\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u8a66\u9a13\u7684\u306b\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u3068\u601d\u3063\u3066\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u9762\u767d\u3044\u3053\u3068\u304c\u767a\u898b\u3067\u304d\u307e\u3057\u305f\n\n5\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u4e00\u5ea6\u4f5c\u6210\u3055\u308c\u305f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fb\u30a4\u30c6\u30ec\u30fc\u30bf\u306ethis\u3092\u9014\u4e2d\u3067\u5909\u66f4\u3059\u308b\u4e8b\u306f\u3067\u304d\u307e\u305b\u3093\n\n6\u306e\u3088\u3046\u306bco\u3092\u666e\u901a\u306b\u4f7f\u7528\u3059\u308b\u3068`use strict`\u306b\u3082\u95a2\u308f\u3089\u305aglobal\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u70b9\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n7\u3067\u306fbind\u3055\u308c\u305f\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u95a2\u6570\u306f\u666e\u901a\u306e\u95a2\u6570\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067co\u306e\u5f15\u6570\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\n\n"}