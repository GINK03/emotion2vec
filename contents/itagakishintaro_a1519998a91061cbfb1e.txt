{"tags": ["Express", "Node.js", "MongoDB"], "context": "\n\nNode.js\n1.http://nodejs.org \u304b\u3089Node.js\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n2.\u30de\u30cb\u30e5\u30a2\u30eb\nhttps://nodejs.org/api/\n\nExpress\n\n\u52d5\u304b\u3059\nhttp://expressjs.com/en/starter/generator.html\n\u306b\u5f93\u3046\u3002\u4ee5\u4e0b\u3001\u7c21\u5358\u306a\u624b\u9806\u3002\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ npm install express-generator -g\n\n2.Express application generator\u5b9f\u884c\n$ express restapi; cd restapi; npm install\n\n3.\u52d5\u304b\u3059\nMac\n$ DEBUG=restapi:* npm start\n\nWindows\n> set DEBUG=restapi:* & npm start\n\n4.\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3059\u308b\nhttp://localhost:3000\n5.\u30de\u30cb\u30e5\u30a2\u30eb\nhttp://expressjs.com/4x/api.html\n\n\u5909\u66f4\u3057\u305f\u3068\u304d\u306b\u30aa\u30fc\u30c8\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3088\u3046\u306bnode-dev\u3092\u3044\u308c\u308b\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ npm install -g node-dev\n\n2.\u52d5\u304b\u3059\n$ node-dev bin/www\n\n\nMongoDB\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4ee5\u4e0b\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nhttp://www.mongodb.org/\nmac\u306e\u5834\u5408\u306fbrew\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3044\u3044\u304b\u3082\u3002\nbrew install mongodb\n\nbrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3001\u6b21\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u308b\u306e\u3067\u3001ln\u3068launchctl\u30b3\u30de\u30f3\u30c9\u3092\u3046\u3064\u3002\n\uff08\u307e\u305f\u306f\u3001mongod\u30b3\u30de\u30f3\u30c9\uff09\nTo have launchd start mongodb at login:\n    ln -sfv /usr/local/opt/mongodb/*.plist ~/Library/LaunchAgents\nThen to load mongodb now:\n    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist\nOr, if you don't want/need launchctl, you can just run:\n    mongod --config /usr/local/etc/mongod.conf\n\n\n\u30b3\u30de\u30f3\u30c9\u64cd\u4f5c\n1.\u8d77\u52d5\nmongo\n\n2.\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u64cd\u4f5c\uff08\u8a73\u7d30\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3067\u78ba\u8a8d\uff09\nhttps://docs.mongodb.org/manual/core/crud-introduction/\n\n\n\n\u30b3\u30de\u30f3\u30c9\n\u8aac\u660e\n\n\n\n\nshow dbs\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e00\u89a7\u8868\u793a\n\n\nuse [db_name]\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5207\u308a\u66ff\u3048\u3002\u306a\u3044\u3068\u304d\u306f\u6700\u521d\u306e\u633f\u5165\u6642\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n\ndb\n\u73fe\u5728\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8868\u793a\n\n\nhelp\n\u30d8\u30eb\u30d7\n\n\ndb.getCollectionNames()\n\u3059\u3079\u3066\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30ea\u30b9\u30c8\u8868\u793a\n\n\ndb.[collection_name]\n\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n\n\ndb.[collection_name].insert({key:value})\n\u633f\u5165\n\n\ndb.[collection_name].find()\n\u691c\u7d22\uff08SELECT\uff09\n\n\ndb.[collection_name].find({key:value})\n\u6761\u4ef6\u691c\u7d22\n\n\ndb.[collection_name].update({key:value1}, {key:value2})\nkey\u304cvalu1\u306e\u30c7\u30fc\u30bf\u3092value2\u306b\u66f4\u65b0\n\n\ndb.[collection_name].update({key1:value1}, {$set:{key2:value2}})\nkey\u304cvalue1\u306e\u30c7\u30fc\u30bf\u3092value2\u306b\u66f4\u65b0\uff08\u306a\u3044\u3068\u304d\u306f\u8ffd\u52a0\uff09\n\n\ndb.[collection_name].remove({key:value})\n\u6761\u4ef6\u524a\u9664\n\n\n\n3.\u7d42\u4e86\nexit\n\n\nNode+Express\u304b\u3089\u63a5\u7d9a\n\nMongoDB Driver\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install --save mongodb\n\n2.\u30de\u30cb\u30e5\u30a2\u30eb\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u60c5\u5831\u306f\u65b0\u65e7\u6df7\u3056\u3063\u3066\u308b\u306e\u3067\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u306f\u6ce8\u610f\u3002\nhttp://mongodb.github.io/node-mongodb-native/2.1/api/\n\nmongodb\u64cd\u4f5c\u7528\u306emongo.js\u3092\u8ffd\u52a0\n\u3053\u3053\u306e\u66f8\u304d\u65b9\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u4f9d\u5b58\u3059\u308b\u90e8\u5206\u304c\u591a\u304f\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u306f\u65b0\u65e7\u306e\u60c5\u5831\u304c\u6df7\u3058\u3063\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3002\n\u3053\u3053\u3067\u306f\u30012.1\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6e96\u62e0\u3057\u3066\u66f8\u3044\u3066\u3044\u308b\u3002\nhttp://mongodb.github.io/node-mongodb-native/2.1/api\n\nmongo.js\n/**\n * node-mongodb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n * http://mongodb.github.io/node-mongodb-native/2.1/\n */\nvar db;\nvar MongoClient = require('mongodb').MongoClient;\nvar assert = require('assert');\n\n// Connection URL\nvar url = 'mongodb://localhost:27017/Sakepedia';\n\n// Use connect method to connect to the Server\nMongoClient.connect(url, function(err, mongodb) {\n  assert.equal(null, err);\n  console.log(\"Connected correctly to server\");\n  db = mongodb;\n});\n\nvar collection = function( name ) {\n  return db.collection( name );\n}\n\nmodule.exports = collection;\n\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n1.app.js\u3092\u5909\u66f4\n\napp.js\n(\u524d\u7565)\n\n// var routes = require('./routes/index');\n// var users = require('./routes/users');\nvar restapi = require( './routes/restapi' );\n\n(\u4e2d\u7565)\n\n// app.use('/', routes);\n// app.use('/users', users);\napp.use( '/api', restapi );\n\n(\u5f8c\u7565)\n\n\n2.restapi.js\u306e\u8ffd\u52a0\n\nroutes.js\u3092\u30b7\u30f3\u30d7\u30eb\u306b\u3057\u305f\u3044\u306e\u3067\u3001var collection = require( '../mongo' );\u90e8\u5206\u3067MongoDB\u7528\u30d5\u30a1\u30a4\u30eb\u306f\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3044\u308b\nCross Origin\u5236\u7d04\u306e\u305f\u3081\u306brouter.all\u3067\u3059\u3079\u3066\u306e\u30e1\u30bd\u30c3\u30c9\u306bheader\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\uff08\u3082\u3061\u308d\u3093\u4ed6\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u4f7f\u308f\u305b\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u4e0d\u8981\uff09\n\u30d1\u30b9\u306e:id\u90e8\u5206\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3068\u3057\u3066request.params.id\u306e\u3088\u3046\u306b\u6271\u3048\u308b\nid\u3092\u6271\u3046\u305f\u3081\u306b\u3001var ObjectID = require('mongodb').ObjectID;\u90e8\u5206\u3067ObjectID\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n\n\nroutes/restaip.js\nvar express = require( 'express' );\nvar router = express.Router();\nvar ObjectID = require('mongodb').ObjectID;\n// MongoDB\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\nvar collection = require( '../mongo' );\nvar COL = 'restapi';\n\n// For Cross Origin\nrouter.all( '/*', function ( req, res, next ) {\n    res.contentType( 'json' );\n    res.header( 'Access-Control-Allow-Origin', '*' );\n    next();\n} );\n\n// GET find\nrouter.get( '/', function ( req, res ) {\n  collection(COL).find().toArray(function(err, docs){\n    res.send(docs);\n  })\n} );\n\n// GET find :id\nrouter.get( '/:id', function ( req, res ) {\n  collection(COL).findOne( { _id: new ObjectID( req.params.id ) }, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\n\n// POST insert data\nrouter.post( '/', function ( req, res ) {\n  collection(COL).insertOne( req.body ).then(function(r) {\n    res.send( r );\n  });\n} );\n\n// PUT update data\nrouter.put( '/:id', function ( req, res ) {\n  collection(COL).findOneAndUpdate( { _id: new ObjectID( req.params.id ) }, req.body, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\n// DELETE remove data\nrouter.delete( '/:id', function ( req, res ) {\n  collection(COL).findOneAndDelete( { _id: new ObjectID( req.params.id ) }, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\nmodule.exports = router;\n\n\n3.\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u4e0d\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3002\n$ rm routes/index.js; rm routes/users.js; rm views/*\n\n\n\u78ba\u8a8d\n$ curl http://localhost:3000/api -X POST -d \"name=name1\"\n$ curl http://localhost:3000/api -X POST -d \"name=name2\"\n$ curl http://localhost:3000/api\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx -X PUT -d \"name=update\"\n$ curl http://localhost:3000/api\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx -X DELETE\n$ curl http://localhost:3000/api\n\n\n\u3053\u308c\u307e\u3067\u306e\u5185\u5bb9\u3092git\u306bcommit\n.gitignore\u4f5c\u6210\uff08gitignore\u3067\u4f5c\u308b\u3068\u3088\u3044\uff09\u3002\n\n# Created by https://www.gitignore.io/api/node\n\n### Node ###\n# Logs\nlogs\n*.log\nnpm-debug.log*\n\n# Runtime data\npids\n*.pid\n*.seed\n\n# Directory for instrumented libs generated by jscoverage/JSCover\nlib-cov\n\n# Coverage directory used by tools like istanbul\ncoverage\n\n# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)\n.grunt\n\n# node-waf configuration\n.lock-wscript\n\n# Compiled binary addons (http://nodejs.org/api/addons.html)\nbuild/Release\n\n# Dependency directory\n# https://docs.npmjs.com/misc/faq#should-i-check-my-node-modules-folder-into-git\nnode_modules\n\n# Optional npm cache directory\n.npm\n\n# Optional REPL history\n.node_repl_history\n\ngit\u306bcommit\n$ git init\n$ git add .\n$ git commit -m \"first commit\"\n\n\nHeroku\u3078\u30c7\u30d7\u30ed\u30a4\nhttps://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction\n\u306b\u5f93\u3046\u3002\u4ee5\u4e0b\u3001\u7c21\u5358\u306a\u624b\u9806\u3002\n1.Heroku\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\u3068Heroku Toolbelt\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u7565\n2.Heroku\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\nita-restapi\u90e8\u5206\uff08\u540d\u524d\uff09\u306f\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\u3002\n$ heroku login\n$ heroku create ita-restapi\n\n\u30a2\u30d7\u30ea\u306eURL\u3068Git\u306eURL\u304c\u8868\u793a\u3055\u308c\u308b\u3002\nhttps://ita-restapi.herokuapp.com/ | https://git.heroku.com/ita-restapi.git\n\n3.Procfile\u4f5c\u6210\nweb: DEBUG=restapi:* npm start\n\n4.mongolab\u306e\u4f5c\u6210\nhttps://devcenter.heroku.com/articles/mongolab\n$ heroku addons:create mongolab --app ita-restapi\n$ heroku config --app ita-restapi | grep MONGOLAB_URI\n\nmongolal\u306eURI\u304c\u8868\u793a\u3055\u308c\u308b\nMONGOLAB_URI: mongodb://heroku_xxxxxxxx:yyyyyyyyyyyyyyyyyyyyyyyyyy@zzzzzzzz.mongolab.com:37185/heroku_xxxxxxxx\n\n5.mongo.js\u306eurl\u3092\u5909\u66f4\u3059\u308b\nHeroku\u7528\u306b\u30d6\u30e9\u30f3\u30c1\u3092\u304d\u308b\u3002\n$ git checkout -b heroku\n\nmongo.js\u3092\u5909\u66f4\u3059\u308b\u3002\n\nmongo.js\n(\u524d\u7565)\n// Connection URL\n//var url = 'mongodb://localhost:27017/restapi';\nvar url = 'mongodb://heroku_xxxxxxxx:yyyyyyyyyyyyyyyyyyyyyyyyyy@zzzzzzzz.mongolab.com:37185/heroku_xxxxxxxx';\n(\u5f8c\u7565)\n\n\n\u30b3\u30df\u30c3\u30c8\n$ git add .\n$ git commit -m \"Change mongodb url for heroku\"\n\n6.Heroku\u306b\u30c7\u30d7\u30ed\u30a4\n$ git remote add heroku https://git.heroku.com/ita-restapi.git\n$ git push heroku heroku:master\n\n\n\u5b8c\u6210\u54c1(master)\nhttps://github.com/itagakishintaro/restapi\n\n# Node.js\n\n1.http://nodejs.org \u304b\u3089Node.js\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n2.\u30de\u30cb\u30e5\u30a2\u30eb\nhttps://nodejs.org/api/\n\n# Express\n\n## \u52d5\u304b\u3059\n\nhttp://expressjs.com/en/starter/generator.html\n\n\u306b\u5f93\u3046\u3002\u4ee5\u4e0b\u3001\u7c21\u5358\u306a\u624b\u9806\u3002\n\n\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ npm install express-generator -g\n```\n\n2.Express application generator\u5b9f\u884c\n\n\n```\n$ express restapi; cd restapi; npm install\n```\n\n3.\u52d5\u304b\u3059\n\nMac\n\n```\n$ DEBUG=restapi:* npm start\n```\n\nWindows\n\n```\n> set DEBUG=restapi:* & npm start\n```\n\n4.\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\u3059\u308b\nhttp://localhost:3000\n\n5.\u30de\u30cb\u30e5\u30a2\u30eb\nhttp://expressjs.com/4x/api.html\n\n## \u5909\u66f4\u3057\u305f\u3068\u304d\u306b\u30aa\u30fc\u30c8\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3088\u3046\u306bnode-dev\u3092\u3044\u308c\u308b\n\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ npm install -g node-dev\n```\n\n2.\u52d5\u304b\u3059\n\n```\n$ node-dev bin/www\n```\n\n# MongoDB\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4ee5\u4e0b\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nhttp://www.mongodb.org/\n\nmac\u306e\u5834\u5408\u306fbrew\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3044\u3044\u304b\u3082\u3002\n\n```\nbrew install mongodb\n```\n\nbrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3001\u6b21\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u308b\u306e\u3067\u3001ln\u3068launchctl\u30b3\u30de\u30f3\u30c9\u3092\u3046\u3064\u3002\n\uff08\u307e\u305f\u306f\u3001mongod\u30b3\u30de\u30f3\u30c9\uff09\n\n```\nTo have launchd start mongodb at login:\n    ln -sfv /usr/local/opt/mongodb/*.plist ~/Library/LaunchAgents\nThen to load mongodb now:\n    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.mongodb.plist\nOr, if you don't want/need launchctl, you can just run:\n    mongod --config /usr/local/etc/mongod.conf\n```\n\n## \u30b3\u30de\u30f3\u30c9\u64cd\u4f5c\n\n1.\u8d77\u52d5\n\n```\nmongo\n```\n\n2.\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u64cd\u4f5c\uff08\u8a73\u7d30\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3067\u78ba\u8a8d\uff09\n\nhttps://docs.mongodb.org/manual/core/crud-introduction/\n\n\n\u30b3\u30de\u30f3\u30c9|\u8aac\u660e\n---|---\nshow dbs|\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e00\u89a7\u8868\u793a\nuse [db_name]|\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5207\u308a\u66ff\u3048\u3002\u306a\u3044\u3068\u304d\u306f\u6700\u521d\u306e\u633f\u5165\u6642\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002\ndb|\u73fe\u5728\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8868\u793a\nhelp|\u30d8\u30eb\u30d7\ndb.getCollectionNames()|\u3059\u3079\u3066\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30ea\u30b9\u30c8\u8868\u793a\ndb.[collection_name]|\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\ndb.[collection_name].insert({key:value})|\u633f\u5165\ndb.[collection_name].find()|\u691c\u7d22\uff08SELECT\uff09\ndb.[collection_name].find({key:value})|\u6761\u4ef6\u691c\u7d22\ndb.[collection_name].update({key:value1}, {key:value2})|key\u304cvalu1\u306e\u30c7\u30fc\u30bf\u3092value2\u306b\u66f4\u65b0\ndb.[collection_name].update({key1:value1}, {$set:{key2:value2}})|key\u304cvalue1\u306e\u30c7\u30fc\u30bf\u3092value2\u306b\u66f4\u65b0\uff08\u306a\u3044\u3068\u304d\u306f\u8ffd\u52a0\uff09\ndb.[collection_name].remove({key:value})|\u6761\u4ef6\u524a\u9664\n\n3.\u7d42\u4e86\n\n```\nexit\n```\n\n## Node+Express\u304b\u3089\u63a5\u7d9a\n\n### MongoDB Driver\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n1.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nnpm install --save mongodb\n```\n\n2.\u30de\u30cb\u30e5\u30a2\u30eb\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u60c5\u5831\u306f\u65b0\u65e7\u6df7\u3056\u3063\u3066\u308b\u306e\u3067\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u306f\u6ce8\u610f\u3002\n\nhttp://mongodb.github.io/node-mongodb-native/2.1/api/\n\n## mongodb\u64cd\u4f5c\u7528\u306emongo.js\u3092\u8ffd\u52a0\n\n\u3053\u3053\u306e\u66f8\u304d\u65b9\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u4f9d\u5b58\u3059\u308b\u90e8\u5206\u304c\u591a\u304f\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u306f\u65b0\u65e7\u306e\u60c5\u5831\u304c\u6df7\u3058\u3063\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3002\n\u3053\u3053\u3067\u306f\u30012.1\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6e96\u62e0\u3057\u3066\u66f8\u3044\u3066\u3044\u308b\u3002\nhttp://mongodb.github.io/node-mongodb-native/2.1/api\n\n```mongo.js\n/**\n * node-mongodb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n * http://mongodb.github.io/node-mongodb-native/2.1/\n */\nvar db;\nvar MongoClient = require('mongodb').MongoClient;\nvar assert = require('assert');\n\n// Connection URL\nvar url = 'mongodb://localhost:27017/Sakepedia';\n\n// Use connect method to connect to the Server\nMongoClient.connect(url, function(err, mongodb) {\n  assert.equal(null, err);\n  console.log(\"Connected correctly to server\");\n  db = mongodb;\n});\n\nvar collection = function( name ) {\n  return db.collection( name );\n}\n\nmodule.exports = collection;\n```\n\n# \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n\n1.app.js\u3092\u5909\u66f4\n \n```app.js\n(\u524d\u7565)\n\n// var routes = require('./routes/index');\n// var users = require('./routes/users');\nvar restapi = require( './routes/restapi' );\n\n(\u4e2d\u7565)\n\n// app.use('/', routes);\n// app.use('/users', users);\napp.use( '/api', restapi );\n\n(\u5f8c\u7565)\n```\n\n2.restapi.js\u306e\u8ffd\u52a0\n\n* routes.js\u3092\u30b7\u30f3\u30d7\u30eb\u306b\u3057\u305f\u3044\u306e\u3067\u3001`var collection = require( '../mongo' );`\u90e8\u5206\u3067MongoDB\u7528\u30d5\u30a1\u30a4\u30eb\u306f\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u3066\u3044\u308b\n* Cross Origin\u5236\u7d04\u306e\u305f\u3081\u306b`router.all`\u3067\u3059\u3079\u3066\u306e\u30e1\u30bd\u30c3\u30c9\u306bheader\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\uff08\u3082\u3061\u308d\u3093\u4ed6\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u4f7f\u308f\u305b\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u4e0d\u8981\uff09\n* \u30d1\u30b9\u306e`:id`\u90e8\u5206\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3068\u3057\u3066`request.params.id`\u306e\u3088\u3046\u306b\u6271\u3048\u308b\n* id\u3092\u6271\u3046\u305f\u3081\u306b\u3001`var ObjectID = require('mongodb').ObjectID;`\u90e8\u5206\u3067ObjectID\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n\n```routes/restaip.js\nvar express = require( 'express' );\nvar router = express.Router();\nvar ObjectID = require('mongodb').ObjectID;\n// MongoDB\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\nvar collection = require( '../mongo' );\nvar COL = 'restapi';\n\n// For Cross Origin\nrouter.all( '/*', function ( req, res, next ) {\n    res.contentType( 'json' );\n    res.header( 'Access-Control-Allow-Origin', '*' );\n    next();\n} );\n\n// GET find\nrouter.get( '/', function ( req, res ) {\n  collection(COL).find().toArray(function(err, docs){\n    res.send(docs);\n  })\n} );\n\n// GET find :id\nrouter.get( '/:id', function ( req, res ) {\n  collection(COL).findOne( { _id: new ObjectID( req.params.id ) }, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\n\n// POST insert data\nrouter.post( '/', function ( req, res ) {\n  collection(COL).insertOne( req.body ).then(function(r) {\n    res.send( r );\n  });\n} );\n\n// PUT update data\nrouter.put( '/:id', function ( req, res ) {\n  collection(COL).findOneAndUpdate( { _id: new ObjectID( req.params.id ) }, req.body, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\n// DELETE remove data\nrouter.delete( '/:id', function ( req, res ) {\n  collection(COL).findOneAndDelete( { _id: new ObjectID( req.params.id ) }, {}, function(err, r){\n    res.send( r );\n  } );\n} );\n\nmodule.exports = router;\n```\n\n3.\u81ea\u52d5\u751f\u6210\u3055\u308c\u305f\u4e0d\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3002\n\n```\n$ rm routes/index.js; rm routes/users.js; rm views/*\n```\n\n# \u78ba\u8a8d\n\n```\n$ curl http://localhost:3000/api -X POST -d \"name=name1\"\n$ curl http://localhost:3000/api -X POST -d \"name=name2\"\n$ curl http://localhost:3000/api\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx -X PUT -d \"name=update\"\n$ curl http://localhost:3000/api\n$ curl http://localhost:3000/api/xxxxxxxxxxxxxxxxxxxxxxxx -X DELETE\n$ curl http://localhost:3000/api\n```\n\n# \u3053\u308c\u307e\u3067\u306e\u5185\u5bb9\u3092git\u306bcommit\n\n.gitignore\u4f5c\u6210\uff08[gitignore](http://www.gitignore.io)\u3067\u4f5c\u308b\u3068\u3088\u3044\uff09\u3002\n\n```.gitignore\n\n# Created by https://www.gitignore.io/api/node\n\n### Node ###\n# Logs\nlogs\n*.log\nnpm-debug.log*\n\n# Runtime data\npids\n*.pid\n*.seed\n\n# Directory for instrumented libs generated by jscoverage/JSCover\nlib-cov\n\n# Coverage directory used by tools like istanbul\ncoverage\n\n# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)\n.grunt\n\n# node-waf configuration\n.lock-wscript\n\n# Compiled binary addons (http://nodejs.org/api/addons.html)\nbuild/Release\n\n# Dependency directory\n# https://docs.npmjs.com/misc/faq#should-i-check-my-node-modules-folder-into-git\nnode_modules\n\n# Optional npm cache directory\n.npm\n\n# Optional REPL history\n.node_repl_history\n```\n\ngit\u306bcommit\n\n```\n$ git init\n$ git add .\n$ git commit -m \"first commit\"\n```\n\n# Heroku\u3078\u30c7\u30d7\u30ed\u30a4\n\nhttps://devcenter.heroku.com/articles/getting-started-with-nodejs#introduction\n\n\u306b\u5f93\u3046\u3002\u4ee5\u4e0b\u3001\u7c21\u5358\u306a\u624b\u9806\u3002\n\n1.Heroku\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\u3068Heroku Toolbelt\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u7565\n\n2.Heroku\u306b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n\n`ita-restapi`\u90e8\u5206\uff08\u540d\u524d\uff09\u306f\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n```\n$ heroku login\n$ heroku create ita-restapi\n```\n\n\u30a2\u30d7\u30ea\u306eURL\u3068Git\u306eURL\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n```\nhttps://ita-restapi.herokuapp.com/ | https://git.heroku.com/ita-restapi.git\n```\n\n3.Procfile\u4f5c\u6210\n\n```Procfile\nweb: DEBUG=restapi:* npm start\n```\n\n4.mongolab\u306e\u4f5c\u6210\n\nhttps://devcenter.heroku.com/articles/mongolab\n\n```\n$ heroku addons:create mongolab --app ita-restapi\n$ heroku config --app ita-restapi | grep MONGOLAB_URI\n```\n\nmongolal\u306eURI\u304c\u8868\u793a\u3055\u308c\u308b\n\n```\nMONGOLAB_URI: mongodb://heroku_xxxxxxxx:yyyyyyyyyyyyyyyyyyyyyyyyyy@zzzzzzzz.mongolab.com:37185/heroku_xxxxxxxx\n```\n\n5.mongo.js\u306eurl\u3092\u5909\u66f4\u3059\u308b\n\nHeroku\u7528\u306b\u30d6\u30e9\u30f3\u30c1\u3092\u304d\u308b\u3002\n\n```\n$ git checkout -b heroku\n```\n\nmongo.js\u3092\u5909\u66f4\u3059\u308b\u3002\n\n```mongo.js\n(\u524d\u7565)\n// Connection URL\n//var url = 'mongodb://localhost:27017/restapi';\nvar url = 'mongodb://heroku_xxxxxxxx:yyyyyyyyyyyyyyyyyyyyyyyyyy@zzzzzzzz.mongolab.com:37185/heroku_xxxxxxxx';\n(\u5f8c\u7565)\n```\n\n\u30b3\u30df\u30c3\u30c8\n\n```\n$ git add .\n$ git commit -m \"Change mongodb url for heroku\"\n```\n\n6.Heroku\u306b\u30c7\u30d7\u30ed\u30a4\n\n```\n$ git remote add heroku https://git.heroku.com/ita-restapi.git\n$ git push heroku heroku:master\n```\n\n# \u5b8c\u6210\u54c1(master)\n\nhttps://github.com/itagakishintaro/restapi\n"}