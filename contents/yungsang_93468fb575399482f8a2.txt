{"tags": ["docker", "boot2docker", "vagrant"], "context": " More than 1 year has passed since last update.docker - nsinit \u304c\u4e0a\u624b\u304f\u884c\u304b\u306a\u304f\u3066\u56f0\u3063\u3066\u3044\u305f\u3089 nsenter \u304c\u3042\u307e\u308a\u306b\u3082\u3042\u3063\u3055\u308a\u3060\u3063\u305f\u4ef6 - Qiita\n\u306f\u3001\u304b\u306a\u308a\u6065\u305a\u304b\u3057\u3044\u30a8\u30f3\u30c8\u30ea\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u6628\u65e5\u306e\u6210\u679c\u3092\u307e\u3068\u3081\u3066\u6d3b\u304b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\nyungsang/boot2docker \u306b nsenter \u3092\u6a19\u6e96\u642d\u8f09\n\nnsenter \u3092\u7c21\u5358\u306b\u4f7f\u3046\u70ba\u306e\u30b9\u30af\u30ea\u30d7\u30c8 docker-enter \u3082\u4ed8\u5c5e\n\n\u4ee5\u4e0b\u304c\u304a\u8a66\u3057\u3059\u308b\u70ba\u306e Vagrantfile \u306b\u306a\u308a\u307e\u3059\u3002\n\nVagrantfile\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"yungsang/boot2docker\"\n\n  config.vm.box_version = \">= 1.0.3\"\n\n  config.vm.provision :docker do |d|\n    d.pull_images \"yungsang/busybox\"\n    d.run \"simple-echo\",\n      image: \"yungsang/busybox\",\n      args: \"-p 8080:8080\",\n      cmd: \"nc -p 8080 -l -l -e echo hello world!\"\n  end\n\n  config.vm.network :forwarded_port, guest: 8080, host: 8080\nend\n\n\n\u4e0a\u8a18\u306e Vagrantfile \u3092\u4fdd\u5b58\u3057\u3066\u3001boot2docker \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ vagrant up\n$ export DOCKER_HOST=\"tcp://localhost:2375\"\n$ docker ps -l\nCONTAINER ID        IMAGE                     COMMAND                CREATED             STATUS              PORTS                    NAMES\n5680c4535af4        yungsang/busybox:latest   nc -p 8080 -l -l -e    21 seconds ago      Up 18 seconds       0.0.0.0:8080->8080/tcp   simple-echo\n$ nc localhost\nhello world!\n\nhello world! \u3092\u30a8\u30b3\u30fc\u3059\u308b\u3060\u3051\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\nboot2docker \u306b ssh \u3057\u3066\u3001docker-enter \u3092\u4f7f\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u307e\u3059\u3002\n$ vagrant ssh\n                        ##        .\n                  ## ## ##       ==\n               ## ## ## ##      ===\n           /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n      ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n           \\______ o          __/\n             \\    \\        __/\n              \\____\\______/\n _                 _   ____     _            _\n| |__   ___   ___ | |_|___ \\ __| | ___   ___| | _____ _ __\n| '_ \\ / _ \\ / _ \\| __| __) / _` |/ _ \\ / __| |/ / _ \\ '__|\n| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   <  __/ |\n|_.__/ \\___/ \\___/ \\__|_____\\__,_|\\___/ \\___|_|\\_\\___|_|\nboot2docker: 1.0.1\n             nfs+nsenter : abe1fc0 - Thu Jun 26 05:52:00 UTC 2014\ndocker@boot2docker:~$ docker-enter\nUsage: docker-enter <container id/name> [{command:-/bin/sh} [argments...]]\ndocker@boot2docker:~$ docker-enter $(docker ps -l -q)\nnsenter --target 958 --mount --uts --ipc --net --pid --\n# ps\nPID   USER     COMMAND\n    1 root     nc -p 8080 -l -l -e echo hello world!\n   11 root     sh\n   12 root     ps\n# exit\ndocker@boot2docker:~$ exit\n$ \n\n\n\u3061\u306a\u307f\u306b\nvagrant ssh -c \u3092\u4f7f\u3048\u3070\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u304b\u3089\u3082\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u3061\u3083\u3044\u307e\u3059\uff01\n$ vagrant ssh -c 'docker-enter $(docker ps -l -q)'\nnsenter --target 958 --mount --uts --ipc --net --pid --\n# ps\nPID   USER     COMMAND\n    1 root     nc -p 8080 -l -l -e echo hello world!\n    9 root     sh\n   10 root     ps\n# exit\n$ \n\n[docker - nsinit \u304c\u4e0a\u624b\u304f\u884c\u304b\u306a\u304f\u3066\u56f0\u3063\u3066\u3044\u305f\u3089 nsenter \u304c\u3042\u307e\u308a\u306b\u3082\u3042\u3063\u3055\u308a\u3060\u3063\u305f\u4ef6 - Qiita](http://qiita.com/yungsang/items/915f7c2ae6ccb239d5ee)\n\u306f\u3001\u304b\u306a\u308a\u6065\u305a\u304b\u3057\u3044\u30a8\u30f3\u30c8\u30ea\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u6628\u65e5\u306e\u6210\u679c\u3092\u307e\u3068\u3081\u3066\u6d3b\u304b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n- `yungsang/boot2docker` \u306b `nsenter` \u3092\u6a19\u6e96\u642d\u8f09\n- `nsenter` \u3092\u7c21\u5358\u306b\u4f7f\u3046\u70ba\u306e\u30b9\u30af\u30ea\u30d7\u30c8 `docker-enter` \u3082\u4ed8\u5c5e\n\n\u4ee5\u4e0b\u304c\u304a\u8a66\u3057\u3059\u308b\u70ba\u306e `Vagrantfile` \u306b\u306a\u308a\u307e\u3059\u3002\n\n```ruby:Vagrantfile\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"yungsang/boot2docker\"\n\n  config.vm.box_version = \">= 1.0.3\"\n\n  config.vm.provision :docker do |d|\n    d.pull_images \"yungsang/busybox\"\n    d.run \"simple-echo\",\n      image: \"yungsang/busybox\",\n      args: \"-p 8080:8080\",\n      cmd: \"nc -p 8080 -l -l -e echo hello world!\"\n  end\n\n  config.vm.network :forwarded_port, guest: 8080, host: 8080\nend\n```\n\n\u4e0a\u8a18\u306e `Vagrantfile` \u3092\u4fdd\u5b58\u3057\u3066\u3001`boot2docker` \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ vagrant up\n$ export DOCKER_HOST=\"tcp://localhost:2375\"\n$ docker ps -l\nCONTAINER ID        IMAGE                     COMMAND                CREATED             STATUS              PORTS                    NAMES\n5680c4535af4        yungsang/busybox:latest   nc -p 8080 -l -l -e    21 seconds ago      Up 18 seconds       0.0.0.0:8080->8080/tcp   simple-echo\n$ nc localhost\nhello world!\n```\n\n`hello world!` \u3092\u30a8\u30b3\u30fc\u3059\u308b\u3060\u3051\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n\n`boot2docker` \u306b ssh \u3057\u3066\u3001`docker-enter` \u3092\u4f7f\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ vagrant ssh\n                        ##        .\n                  ## ## ##       ==\n               ## ## ## ##      ===\n           /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n      ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n           \\______ o          __/\n             \\    \\        __/\n              \\____\\______/\n _                 _   ____     _            _\n| |__   ___   ___ | |_|___ \\ __| | ___   ___| | _____ _ __\n| '_ \\ / _ \\ / _ \\| __| __) / _` |/ _ \\ / __| |/ / _ \\ '__|\n| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   <  __/ |\n|_.__/ \\___/ \\___/ \\__|_____\\__,_|\\___/ \\___|_|\\_\\___|_|\nboot2docker: 1.0.1\n             nfs+nsenter : abe1fc0 - Thu Jun 26 05:52:00 UTC 2014\ndocker@boot2docker:~$ docker-enter\nUsage: docker-enter <container id/name> [{command:-/bin/sh} [argments...]]\ndocker@boot2docker:~$ docker-enter $(docker ps -l -q)\nnsenter --target 958 --mount --uts --ipc --net --pid --\n# ps\nPID   USER     COMMAND\n    1 root     nc -p 8080 -l -l -e echo hello world!\n   11 root     sh\n   12 root     ps\n# exit\ndocker@boot2docker:~$ exit\n$ \n```\n\n### \u3061\u306a\u307f\u306b\n`vagrant ssh -c` \u3092\u4f7f\u3048\u3070\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u304b\u3089\u3082\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u3061\u3083\u3044\u307e\u3059\uff01\n\n```bash\n$ vagrant ssh -c 'docker-enter $(docker ps -l -q)'\nnsenter --target 958 --mount --uts --ipc --net --pid --\n# ps\nPID   USER     COMMAND\n    1 root     nc -p 8080 -l -l -e echo hello world!\n    9 root     sh\n   10 root     ps\n# exit\n$ \n```\n"}