{"tags": ["Linux", "ARM", "DeviceTree"], "context": "\n\n\u306f\u3058\u3081\u306b\n\u4ed5\u4e8b\u3067 Device Tree \u3092\u89e6\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u60c5\u5831\u3092\u307e\u3068\u3081\u308b\u3002\nWeb\u4e0a\u3067\u65e5\u672c\u8a9e\u60c5\u5831\u306f\u307b\u307c\u306a\u304b\u3063\u305f\u305f\u3081\u5f8c\u304b\u3089\u898b\u8fd4\u3059\u7528\u3002\u968f\u6642\u8ffd\u8a18\u4e88\u5b9a\u3002\n\u5c11\u306a\u304f\u3068\u3082Linux kernel 2.6.38\u4ee5\u964d\u5c0e\u5165\u306e\u305f\u3081\u3001\u73fe\u72b6\u306e\u30aa\u30e9\u30a4\u30ea\u30fc\u306e\u66f8\u7c4d\u306b\u3082\u8a18\u8f09\u306f\u306a\u304b\u3063\u305f\u3002\n\u304a\u305d\u3089\u304f\u3044\u308d\u3044\u308d\u3068\u9593\u9055\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u7b49\u3092\u6b63\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n2016/6/1 \u8ffd\u8a18: devicetree.org \u304c\u30ea\u30cb\u30e5\u30fc\u30a2\u30eb\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u30ea\u30f3\u30af\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\nSpecifications \u2013 Devicetree\n => Device Tree Specification Release X.X \u306e\u30ea\u30f3\u30af\u5148\u306ePDF\u3092\u53c2\u7167\nDevice Tree - eLinux.org\nDevice Tree Usage - eLinux.org\nDevice Tree Reference - eLinux.org\nlinux/Documentation/devicetree at master \u00b7 torvalds/linux\n\"Device Tree for Dummies\", ELC 2014 by Thomas Petazzoni (PDF)\n\nDevice Tree \u3068\u306f\nARM Linux \u5411\u3051\u306b\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u3053\u3068\u3002\nDevice Tree\u306e\u4ed5\u7d44\u307f\u81ea\u4f53\u306f1994\u5e74\u306b\u6a19\u6e96\u5316\u3055\u308c\u305fOpen Firmware\u3068\u3044\u3046\u3082\u306e\u3092\u5143\u306b\u3057\u3066\u3044\u308b\u3002\n\u30c7\u30d0\u30a4\u30b9\u306e\u30d9\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u3084\u3001\u30af\u30ed\u30c3\u30af\u3001\u5272\u308a\u8fbc\u307f\u756a\u53f7\u3068\u3044\u3063\u305f\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u56fa\u6709\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30ab\u30fc\u30cd\u30eb\u304b\u3089\u5206\u96e2\u3057\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u518d\u5229\u7528\u6027\u3092\u9ad8\u3081\u308b\u3053\u3068\u304c\u76ee\u7684\u306e\u6a5f\u80fd\u3089\u3057\u3044\u3002\nDevice Tree Souce \u306b\u8a18\u8f09\u3057\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u4f7f\u7528\u3059\u308b\u3002\nDevice Tree\u306e\u4ed5\u7d44\u307f\u306f\u3001Linux \u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u306e\u304b\u306a\u308a\u306e\u5272\u5408\u3092\u5360\u3081\u308b\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u80a5\u5927\u5316\u3092\u9632\u3050\u305f\u3081\u306b\u5c0e\u5165\u3055\u308c\u305f\u3002\n2.6.38 \u4ee5\u524d\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u306fARM\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u4f9d\u5b58\u6027\u3092\u8a18\u8ff0\u3059\u308b\u7d71\u4e00\u7684\u306a\u6c7a\u307e\u308a\u304c\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u5404\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3054\u3068\u306b\u305d\u308c\u305e\u308c\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305f\u3002\nLinux \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u3057\u3066\u306f Device Tree \u975e\u5bfe\u5fdc\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u30d1\u30c3\u30c1\u53d7\u3051\u4ed8\u3051\u306f\u3057\u306a\u3044\u6c7a\u307e\u308a\u306b\u306a\u3063\u305f\u6a21\u69d8\u3002\n\u305d\u306e\u305f\u3081\u3001ARM Linux\u3092\u4f7f\u7528\u3059\u308b\u958b\u767a\u8005\u306f\u907f\u3051\u3066\u306f\u901a\u308c\u306a\u3044\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\nLinux \u3067\u306e Device Tree \u6a19\u6e96\u5316\u306e\u7d4c\u7def\nkernel 2.6.38\u306e\u6642\u306b\u3001Linus\u6c0f\u304c\u80a5\u5927\u3059\u308bARM\u30b3\u30fc\u30c9\u306b\u6fc0\u6012\u3057\u305f\u306e\u304c\u767a\u7aef\u3068\u306e\u3053\u3068\u3002\nFrom: Linus Torvalds <torvalds <at> linux-foundation.org>\nSubject: Re: [GIT PULL] omap changes for v2.6.39 merge window\nNewsgroups: gmane.linux.kernel, gmane.linux.ports.arm.kernel, gmane.linux.ports.arm.omap\nDate: 2011-03-30 19:21:32 GMT (4 years, 31 weeks, 2 days, 17 hours and 24 minutes ago)\n\n(\u4e2d\u7565)\n\nTHAT is an example of something that is totally and utterly screwed\nup. Those kinds of random board-level detail files abound in the ARM\ntree. They should either be in a per-board file, or (much better) the\nARM people should have standardized this ten f*cking years ago, and\nput it in a bootloader or something that just initializes the crap so\nthat the kernel doesn't have to have random tables like that at all.\n\nARM right now i a nightmare, and most of it is because ARM hardware\nmanufacturers are morons. But the way the ARM tree is then laid out\nhas made that even more painful, and the decision to put all the crazy\nboard details in the kernel tables instead of trying to have a\nper-board boot loader that fills in the details is just crazy.\n\nLook at the dirstat for arch/ in just the current merge window\n(cut-off at 5% just to not get too much):\n\n[torvalds <at> i5 linux]$ git diff -C --dirstat=5 --cumulative v2.6.38.. arch\n  14.0% arch/arm/mach-omap2/\n   5.8% arch/arm/plat-mxc/include/mach/\n   6.3% arch/arm/plat-mxc/\n  57.1% arch/arm/\n   5.4% arch/m68k/\n   9.6% arch/unicore32/\n   6.9% arch/x86/\n 100.0% arch/\n\nalmost *SIXTY* percent of all arch updates were to ARM code. And\nthat's despite the fact that one of those architectures (unicore32) is\na totally new architecture, and despite m68k having gone through a\nfirst-level unification of nommu and mmu code!\n\nAnd was this just a fluke? No. Doing the same for 2.3.37..38 gives\n58.3% for arch/arm (and in that release we had a blackfin unification\neffort, otherwise arm would have been an even bigger percentage).\n\nThat's ridiculous. It's entirely due to the whole f*cked-up arm ecosystem.\n\n(\u5f8c\u7565)\n\n\u5f15\u7528: http://article.gmane.org/gmane.linux.kernel/1120436\n \u5f15\u7528: LKML: Linus Torvalds: Re: [GIT PULL] omap changes for v2.6.39 merge window\n\u4e0a\u8a18\u306e\u8b70\u8ad6\u306e\u6d41\u308c\u306f\u4ee5\u4e0b\u306e\u30b9\u30ec\u30c3\u30c9\u53c2\u7167\u3002\nhttp://thread.gmane.org/gmane.linux.kernel/1114495/focus=112007\n=> 2016/12/20\u8ffd\u8a18: thread.gmane.org/gmane.linux.kernel \u306earchive\u304c\u306a\u305c\u304b\u6d88\u3048\u3066\u3066\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u30fb\u30fb\u30fb\u3002\n\n\u7528\u8a9e\n\nDTS : Device Tree Source\nDevice Tree\u306e\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3002\u5c02\u7528\u306e\u5f62\u5f0f\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\u62e1\u5f35\u5b50\u306f *.dts \u3068 *.dtsi \u306e2\u7a2e\u985e\n*.dts \u306f\u30dc\u30fc\u30c9\u56fa\u6709\u306e\u5b9a\u7fa9\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3002\n*.dtsi\u306f\u901a\u5e38SoC(System on Chip)\u56fa\u6709\u306e\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001*.dts/*.dtsi\u304b\u3089C\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u3088\u308ainclude\u3055\u308c\u308b\u3002\n\nDTB : Device Tree Blob\nDevice Tree Source\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3002\n\nDTC : Device Tree Compiler\nDevice Tree Source\u3092\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u3002\n\u6a5f\u80fd\u3068\u3057\u3066\u3001*.dtb -> *.dts\u3078\u306e\u9006\u30a2\u30bb\u30f3\u30d6\u30eb\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3002\n\ndts \u306e\u914d\u7f6e\u5834\u6240\n\nlinux-4.2.5 \u306e\u5834\u5408\nThe Linux Kernel Archives \u304b\u3089\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n\u203b\u5c55\u958b\u5f8c\u306f691MB\u7a0b\u5ea6\u3042\u308b\u306e\u3067\u6ce8\u610f\nwget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.2.5.tar.xz\ntar Jxvf linux-4.2.5.tar.xz\n\nDevice Tree Source(.dts/.dtsi)\u306e\u307b\u3068\u3093\u3069\u306f\u4ee5\u4e0b\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3002\n/arch/arm/boot/dts/\n\n\nDevice Tree Source \u306e\u6587\u6cd5\u306b\u3064\u3044\u3066\n\u6587\u6cd5\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nSpecifications \u2013 Devicetree\n => Device Tree Specification Release X.X \u306e\u30ea\u30f3\u30af\u5148\u306ePDF\u3092\u53c2\u7167\n\ndtb\u3092\u5b9f\u969b\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u6ce8\u610f\ndtb \u306e\u8aad\u307f\u51fa\u3057\u306f\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u304c\u884c\u3046\u3002zImage\u3068\u306f\u5225\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u306e\u5165\u308c\u66ff\u3048\u3067\u826f\u3044\u304b\u3001dd\u30b3\u30de\u30f3\u30c9\u3067\u66f8\u304d\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308b\u304b\u306f\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\n\u30ab\u30fc\u30cd\u30eb\u30c9\u30e9\u30a4\u30d0\u5185\u304b\u3089DeviceTree\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u65b9\u6cd5\n\nmodule_platform_driver \u30de\u30af\u30ed\u3092\u4f7f\u7528\n\u4f7f\u7528\u4f8b\n\nlinux-4.2.5/drivers/media/platform/fsl-viu.c#L1664-1693\n/*\n * Initialization and module stuff\n */\nstatic const struct of_device_id mpc512x_viu_of_match[] = { \n    { \n        .compatible = \"fsl,mpc5121-viu\", // \u203bcompatible\u3092\u6307\u5b9a\n    },\n    {},\n};\nMODULE_DEVICE_TABLE(of, mpc512x_viu_of_match);\n\nstatic struct platform_driver viu_of_platform_driver = { \n    .probe = viu_of_probe,\n    .remove = viu_of_remove,\n#ifdef CONFIG_PM\n    .suspend = viu_suspend,\n    .resume = viu_resume,\n#endif\n    .driver = { \n        .name = DRV_NAME,\n        .of_match_table = mpc512x_viu_of_match, // \u203bof_match_table \u306b\u683c\u7d0d\n    },\n};\n\nmodule_platform_driver(viu_of_platform_driver);\n\nMODULE_DESCRIPTION(\"Freescale Video-In(VIU)\");\nMODULE_AUTHOR(\"Hongjun Chen\");\nMODULE_LICENSE(\"GPL\");\nMODULE_VERSION(VIU_VERSION);\n\n\n\u3053\u306e\u5f8c\u306eprobe\u306b\u8a2d\u5b9a\u3057\u305f\u95a2\u6570\u306b\u3066DeviceTree\u306enode\u3092\u53d6\u5f97\u3067\u304d\u308b\n\nlinux-4.2.5/drivers/media/platform/fsl-viu.c#L1483-1497\nstatic int viu_of_probe(struct platform_device *op)\n{\n    struct viu_dev *viu_dev;\n    struct video_device *vdev;\n    struct resource r;\n    struct viu_reg __iomem *viu_regs;\n    struct i2c_adapter *ad;\n    int ret, viu_irq;\n    struct clk *clk;\n\n    ret = of_address_to_resource(op->dev.of_node, 0, &r); // \u203bop->dev.of_node\u3067 struct device_node \u3092\u53d6\u5f97\n    if (ret) { \n        dev_err(&op->dev, \"Can't parse device node resource\\n\");\n        return -ENODEV;\n    } \n...\n\n\n\nof_find_compatible_node() \u3092\u4f7f\u7528\nof_find_compatible_node()\u3092\u4f7f\u7528\u3057\u3066\u3082node\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n\u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\n\n/proc/device-tree \u3092\u53c2\u7167\u3059\u308b\nARM Linux\u306e\u5834\u5408\u306f\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f /proc \u4ee5\u4e0b\u3067DeviceTree\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n/proc/device-tree\n\n\u5024\u306fhexdump\u3067\u78ba\u8a8d\u3067\u304d\u308b\n# hexdump -C '/proc/device-tree/#size-cells'\n00000000  00 00 00 01                                       |....|\n00000004\n# hexdump -C '/proc/device-tree/axi@0/compatible'\n00000000  78 6c 6e 78 2c 70 73 37  2d 61 78 69 2d 69 6e 74  |xlnx,ps7-axi-int|\n00000010  65 72 63 6f 6e 6e 65 63  74 2d 31 2e 30 30 2e 61  |erconnect-1.00.a|\n00000020  00 73 69 6d 70 6c 65 2d  62 75 73 00              |.simple-bus.|\n0000002c\n\n\n\u30ab\u30fc\u30cd\u30eb\u3067\u3069\u306e\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u304c\u4f7f\u7528\u4e2d\u304b\u3092\u5224\u5225\u3059\u308b\n/proc/device-tree/compatible \u3092\u78ba\u8a8d\u3059\u308c\u3070 compatible \u306e\u8a18\u8f09\u6587\u5b57\u5217\u304c\u78ba\u8a8d\u3067\u304d\u308b\u305f\u3081\u3001dts\u306e\u63a8\u6e2c\u306f\u3067\u304d\u308b\u3002\n\n/proc/device-tree/compatible\u3092\u78ba\u8a8d\u3059\u308b\n$ strings /proc/device-tree/compatible\nfsl,imx6dl-sabreauto\nfsl,imx6dl\n\n\n\n.dtb \u3092 .dts \u306b\u623b\u3059\nUbuntu\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\napt-get install device-tree-compiler\n\n\u9006\u30a2\u30bb\u30f3\u30d6\u30eb\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53ef\u80fd\u3002\ndtc -I dtb -O dts -o ${hoge}.dts ${hoge}.dtb\n\n\n\u30a8\u30c7\u30a3\u30bf\u95a2\u9023\n\nVim\u306eSyntax\u5bfe\u5fdc\nv7.3.684 (6 Oct 2012) \u4ee5\u964d\u3067 dts.vim \u306b\u5bfe\u5fdc\u6e08\u307f\nhttps://github.com/vim/vim/commit/0c5fa7d740bafefbf0b2ea48a2a660901d7d4f10\n\n\u53c2\u8003\u66f8\u7c4d\nInterface2014\u5e7410\u6708\u53f7\u300111\u6708\u53f7\u306b\u7279\u96c6\u3055\u308c\u3066\u3044\u308b\u3002\u305f\u3060\u3057\u6982\u8981\u7a0b\u5ea6\u3002\nLinux 3.2 \u306b\u5bfe\u5fdc\u3057\u305fO'Reilly\u306e\u66f8\u7c4d\u304c\u51fa\u308b\u3089\u3057\u3044\uff08\u5ef6\u671f\u3057\u30662017\u5e7411\u6708\u4e88\u5b9a\uff09\u304b\u3089\u89e3\u8aac\u304c\u4e57\u308b\u53ef\u80fd\u6027\u306f\u3042\u308a\u307e\u3059\u3002\nLinux Device Drivers, 4th Edition\u00a0-\u00a0O'Reilly Media\n=> 2016/10/13\u8ffd\u8a18: \u4f55\u6545\u304b\u5546\u54c1\u30da\u30fc\u30b8\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u308b\u30fb\u30fb\u30fb\n\n\u53c2\u8003\n\nWiki\nelinux.org - Device_Tree\nSpecifications \u2013 Devicetree\nDevice Tree presentations papers articles\n\n\u767a\u8868\u8cc7\u6599\n\"Device Tree for Dummies\", ELC 2014 by Thomas Petazzoni (PDF)\nelinux.org - Solving Device Tree Issues (PDF)\nExperiences_With_Device_Tree_Support_Development_For_ARM-Based_SOC (PDF)\n\n\u8a18\u4e8b\uff08\u30d6\u30ed\u30b0, Qiita, StackOverFlow\u7b49\uff09\n\u3068\u3042\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u5099\u5fd8log - Device Tree \u5165\u9580\n\u3068\u3042\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u5099\u5fd8log - Device Tree \u30a2\u30af\u30bb\u30b9\u95a2\u6570\u307e\u3068\u3081 (Linux Kernel) \nQiita - \u30e1\u30e2\uff1aDevice tree blob (.dtb)\u3092Device tree source (.dts)\u306b\u623b\u3059\nA Tutorial on the Device Tree (Zynq) -- Part I | xillybus.com\nlinux - how to program device tree file(.dts)? - Stack Overflow\n# \u306f\u3058\u3081\u306b\n\u4ed5\u4e8b\u3067 Device Tree \u3092\u89e6\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u60c5\u5831\u3092\u307e\u3068\u3081\u308b\u3002\nWeb\u4e0a\u3067\u65e5\u672c\u8a9e\u60c5\u5831\u306f\u307b\u307c\u306a\u304b\u3063\u305f\u305f\u3081\u5f8c\u304b\u3089\u898b\u8fd4\u3059\u7528\u3002\u968f\u6642\u8ffd\u8a18\u4e88\u5b9a\u3002\n\u5c11\u306a\u304f\u3068\u3082Linux kernel 2.6.38\u4ee5\u964d\u5c0e\u5165\u306e\u305f\u3081\u3001\u73fe\u72b6\u306e\u30aa\u30e9\u30a4\u30ea\u30fc\u306e\u66f8\u7c4d\u306b\u3082\u8a18\u8f09\u306f\u306a\u304b\u3063\u305f\u3002\n\u304a\u305d\u3089\u304f\u3044\u308d\u3044\u308d\u3068\u9593\u9055\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u7b49\u3092\u6b63\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n2016/6/1 \u8ffd\u8a18: devicetree.org \u304c\u30ea\u30cb\u30e5\u30fc\u30a2\u30eb\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u30ea\u30f3\u30af\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\n[Specifications \u2013 Devicetree](http://www.devicetree.org/specifications/)\n => Device Tree Specification Release X.X \u306e\u30ea\u30f3\u30af\u5148\u306ePDF\u3092\u53c2\u7167\n[Device Tree - eLinux.org](http://elinux.org/Device_Tree)\n[Device Tree Usage - eLinux.org](http://elinux.org/Device_Tree_Usage)\n[Device Tree Reference - eLinux.org](http://elinux.org/Device_Tree_Reference)\n[linux/Documentation/devicetree at master \u00b7 torvalds/linux](https://github.com/torvalds/linux/tree/master/Documentation/devicetree)\n[\"Device Tree for Dummies\", ELC 2014 by Thomas Petazzoni (PDF)](http://elinux.org/images/f/f9/Petazzoni-device-tree-dummies_0.pdf)\n\n# Device Tree \u3068\u306f\nARM Linux \u5411\u3051\u306b\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u305f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u3053\u3068\u3002\nDevice Tree\u306e\u4ed5\u7d44\u307f\u81ea\u4f53\u306f1994\u5e74\u306b\u6a19\u6e96\u5316\u3055\u308c\u305fOpen Firmware\u3068\u3044\u3046\u3082\u306e\u3092\u5143\u306b\u3057\u3066\u3044\u308b\u3002\n\u30c7\u30d0\u30a4\u30b9\u306e\u30d9\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u3084\u3001\u30af\u30ed\u30c3\u30af\u3001\u5272\u308a\u8fbc\u307f\u756a\u53f7\u3068\u3044\u3063\u305f\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u56fa\u6709\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30ab\u30fc\u30cd\u30eb\u304b\u3089\u5206\u96e2\u3057\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u518d\u5229\u7528\u6027\u3092\u9ad8\u3081\u308b\u3053\u3068\u304c\u76ee\u7684\u306e\u6a5f\u80fd\u3089\u3057\u3044\u3002\n\nDevice Tree Souce \u306b\u8a18\u8f09\u3057\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u4f7f\u7528\u3059\u308b\u3002\nDevice Tree\u306e\u4ed5\u7d44\u307f\u306f\u3001Linux \u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u306e\u304b\u306a\u308a\u306e\u5272\u5408\u3092\u5360\u3081\u308b\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u80a5\u5927\u5316\u3092\u9632\u3050\u305f\u3081\u306b\u5c0e\u5165\u3055\u308c\u305f\u3002\n2.6.38 \u4ee5\u524d\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u306fARM\u306e\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u4f9d\u5b58\u6027\u3092\u8a18\u8ff0\u3059\u308b\u7d71\u4e00\u7684\u306a\u6c7a\u307e\u308a\u304c\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u5404\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3054\u3068\u306b\u305d\u308c\u305e\u308c\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305f\u3002\n\nLinux \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3068\u3057\u3066\u306f Device Tree \u975e\u5bfe\u5fdc\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306e\u30d1\u30c3\u30c1\u53d7\u3051\u4ed8\u3051\u306f\u3057\u306a\u3044\u6c7a\u307e\u308a\u306b\u306a\u3063\u305f\u6a21\u69d8\u3002\n\u305d\u306e\u305f\u3081\u3001ARM Linux\u3092\u4f7f\u7528\u3059\u308b\u958b\u767a\u8005\u306f\u907f\u3051\u3066\u306f\u901a\u308c\u306a\u3044\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n# Linux \u3067\u306e Device Tree \u6a19\u6e96\u5316\u306e\u7d4c\u7def\nkernel 2.6.38\u306e\u6642\u306b\u3001Linus\u6c0f\u304c\u80a5\u5927\u3059\u308bARM\u30b3\u30fc\u30c9\u306b\u6fc0\u6012\u3057\u305f\u306e\u304c\u767a\u7aef\u3068\u306e\u3053\u3068\u3002\n\n```\nFrom: Linus Torvalds <torvalds <at> linux-foundation.org>\nSubject: Re: [GIT PULL] omap changes for v2.6.39 merge window\nNewsgroups: gmane.linux.kernel, gmane.linux.ports.arm.kernel, gmane.linux.ports.arm.omap\nDate: 2011-03-30 19:21:32 GMT (4 years, 31 weeks, 2 days, 17 hours and 24 minutes ago)\n\n(\u4e2d\u7565)\n\nTHAT is an example of something that is totally and utterly screwed\nup. Those kinds of random board-level detail files abound in the ARM\ntree. They should either be in a per-board file, or (much better) the\nARM people should have standardized this ten f*cking years ago, and\nput it in a bootloader or something that just initializes the crap so\nthat the kernel doesn't have to have random tables like that at all.\n\nARM right now i a nightmare, and most of it is because ARM hardware\nmanufacturers are morons. But the way the ARM tree is then laid out\nhas made that even more painful, and the decision to put all the crazy\nboard details in the kernel tables instead of trying to have a\nper-board boot loader that fills in the details is just crazy.\n\nLook at the dirstat for arch/ in just the current merge window\n(cut-off at 5% just to not get too much):\n\n[torvalds <at> i5 linux]$ git diff -C --dirstat=5 --cumulative v2.6.38.. arch\n  14.0% arch/arm/mach-omap2/\n   5.8% arch/arm/plat-mxc/include/mach/\n   6.3% arch/arm/plat-mxc/\n  57.1% arch/arm/\n   5.4% arch/m68k/\n   9.6% arch/unicore32/\n   6.9% arch/x86/\n 100.0% arch/\n\nalmost *SIXTY* percent of all arch updates were to ARM code. And\nthat's despite the fact that one of those architectures (unicore32) is\na totally new architecture, and despite m68k having gone through a\nfirst-level unification of nommu and mmu code!\n\nAnd was this just a fluke? No. Doing the same for 2.3.37..38 gives\n58.3% for arch/arm (and in that release we had a blackfin unification\neffort, otherwise arm would have been an even bigger percentage).\n\nThat's ridiculous. It's entirely due to the whole f*cked-up arm ecosystem.\n\n(\u5f8c\u7565)\n```\n \u5f15\u7528: ~~http://article.gmane.org/gmane.linux.kernel/1120436~~\n \u5f15\u7528: [LKML: Linus Torvalds: Re: [GIT PULL] omap changes for v2.6.39 merge window](https://lkml.org/lkml/2011/3/30/379)\n\n\u4e0a\u8a18\u306e\u8b70\u8ad6\u306e\u6d41\u308c\u306f\u4ee5\u4e0b\u306e\u30b9\u30ec\u30c3\u30c9\u53c2\u7167\u3002\n~~http://thread.gmane.org/gmane.linux.kernel/1114495/focus=112007~~\n=> 2016/12/20\u8ffd\u8a18: `thread.gmane.org/gmane.linux.kernel` \u306earchive\u304c\u306a\u305c\u304b\u6d88\u3048\u3066\u3066\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u30fb\u30fb\u30fb\u3002\n\n# \u7528\u8a9e\n## DTS : Device Tree Source\nDevice Tree\u306e\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3002\u5c02\u7528\u306e\u5f62\u5f0f\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\u62e1\u5f35\u5b50\u306f `*.dts` \u3068 `*.dtsi` \u306e2\u7a2e\u985e\n\n`*.dts` \u306f\u30dc\u30fc\u30c9\u56fa\u6709\u306e\u5b9a\u7fa9\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3002\n`*.dtsi`\u306f\u901a\u5e38SoC(System on Chip)\u56fa\u6709\u306e\u60c5\u5831\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001`*.dts/*.dtsi`\u304b\u3089C\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u306b\u3088\u308ainclude\u3055\u308c\u308b\u3002\n\n## DTB : Device Tree Blob\nDevice Tree Source\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3002\n\n## DTC : Device Tree Compiler\nDevice Tree Source\u3092\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u3002\n\u6a5f\u80fd\u3068\u3057\u3066\u3001*.dtb -> *.dts\u3078\u306e\u9006\u30a2\u30bb\u30f3\u30d6\u30eb\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3002\n\n# dts \u306e\u914d\u7f6e\u5834\u6240\n## `linux-4.2.5` \u306e\u5834\u5408\n\n[The Linux Kernel Archives](https://www.kernel.org/) \u304b\u3089\u30ab\u30fc\u30cd\u30eb\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n\u203b\u5c55\u958b\u5f8c\u306f691MB\u7a0b\u5ea6\u3042\u308b\u306e\u3067\u6ce8\u610f\n\n```\nwget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.2.5.tar.xz\ntar Jxvf linux-4.2.5.tar.xz\n```\n\nDevice Tree Source(.dts/.dtsi)\u306e\u307b\u3068\u3093\u3069\u306f\u4ee5\u4e0b\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3002\n\n```\n/arch/arm/boot/dts/\n```\n\n# Device Tree Source \u306e\u6587\u6cd5\u306b\u3064\u3044\u3066\n\u6587\u6cd5\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n[Specifications \u2013 Devicetree](http://www.devicetree.org/specifications/)\n => Device Tree Specification Release X.X \u306e\u30ea\u30f3\u30af\u5148\u306ePDF\u3092\u53c2\u7167\n\n# dtb\u3092\u5b9f\u969b\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306e\u6ce8\u610f\n\ndtb \u306e\u8aad\u307f\u51fa\u3057\u306f\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u304c\u884c\u3046\u3002zImage\u3068\u306f\u5225\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u306e\u5165\u308c\u66ff\u3048\u3067\u826f\u3044\u304b\u3001`dd`\u30b3\u30de\u30f3\u30c9\u3067\u66f8\u304d\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308b\u304b\u306f\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\n# \u30ab\u30fc\u30cd\u30eb\u30c9\u30e9\u30a4\u30d0\u5185\u304b\u3089DeviceTree\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u65b9\u6cd5\n## `module_platform_driver` \u30de\u30af\u30ed\u3092\u4f7f\u7528\n\n\u4f7f\u7528\u4f8b\n\n```c:linux-4.2.5/drivers/media/platform/fsl-viu.c#L1664-1693\n/*\n * Initialization and module stuff\n */\nstatic const struct of_device_id mpc512x_viu_of_match[] = { \n    { \n        .compatible = \"fsl,mpc5121-viu\", // \u203bcompatible\u3092\u6307\u5b9a\n    },\n    {},\n};\nMODULE_DEVICE_TABLE(of, mpc512x_viu_of_match);\n                                                                                                                                                                                                             \nstatic struct platform_driver viu_of_platform_driver = { \n    .probe = viu_of_probe,\n    .remove = viu_of_remove,\n#ifdef CONFIG_PM\n    .suspend = viu_suspend,\n    .resume = viu_resume,\n#endif\n    .driver = { \n        .name = DRV_NAME,\n        .of_match_table = mpc512x_viu_of_match, // \u203bof_match_table \u306b\u683c\u7d0d\n    },\n};\n\nmodule_platform_driver(viu_of_platform_driver);\n\nMODULE_DESCRIPTION(\"Freescale Video-In(VIU)\");\nMODULE_AUTHOR(\"Hongjun Chen\");\nMODULE_LICENSE(\"GPL\");\nMODULE_VERSION(VIU_VERSION);\n```\n\n\u3053\u306e\u5f8c\u306eprobe\u306b\u8a2d\u5b9a\u3057\u305f\u95a2\u6570\u306b\u3066DeviceTree\u306enode\u3092\u53d6\u5f97\u3067\u304d\u308b\n\n```c:linux-4.2.5/drivers/media/platform/fsl-viu.c#L1483-1497\nstatic int viu_of_probe(struct platform_device *op)\n{\n    struct viu_dev *viu_dev;\n    struct video_device *vdev;\n    struct resource r;\n    struct viu_reg __iomem *viu_regs;\n    struct i2c_adapter *ad;\n    int ret, viu_irq;\n    struct clk *clk;\n\n    ret = of_address_to_resource(op->dev.of_node, 0, &r); // \u203bop->dev.of_node\u3067 struct device_node \u3092\u53d6\u5f97\n    if (ret) { \n        dev_err(&op->dev, \"Can't parse device node resource\\n\");\n        return -ENODEV;\n    } \n...\n```\n\n## `of_find_compatible_node()` \u3092\u4f7f\u7528\n\n`of_find_compatible_node()`\u3092\u4f7f\u7528\u3057\u3066\u3082node\u304c\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n# \u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\n## `/proc/device-tree` \u3092\u53c2\u7167\u3059\u308b\nARM Linux\u306e\u5834\u5408\u306f\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f `/proc` \u4ee5\u4e0b\u3067DeviceTree\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n```\n/proc/device-tree\n```\n\n\u5024\u306f`hexdump`\u3067\u78ba\u8a8d\u3067\u304d\u308b\n\n```\n# hexdump -C '/proc/device-tree/#size-cells'\n00000000  00 00 00 01                                       |....|\n00000004\n# hexdump -C '/proc/device-tree/axi@0/compatible'\n00000000  78 6c 6e 78 2c 70 73 37  2d 61 78 69 2d 69 6e 74  |xlnx,ps7-axi-int|\n00000010  65 72 63 6f 6e 6e 65 63  74 2d 31 2e 30 30 2e 61  |erconnect-1.00.a|\n00000020  00 73 69 6d 70 6c 65 2d  62 75 73 00              |.simple-bus.|\n0000002c\n```\n\n## \u30ab\u30fc\u30cd\u30eb\u3067\u3069\u306e\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u304c\u4f7f\u7528\u4e2d\u304b\u3092\u5224\u5225\u3059\u308b\n`/proc/device-tree/compatible` \u3092\u78ba\u8a8d\u3059\u308c\u3070 `compatible` \u306e\u8a18\u8f09\u6587\u5b57\u5217\u304c\u78ba\u8a8d\u3067\u304d\u308b\u305f\u3081\u3001dts\u306e\u63a8\u6e2c\u306f\u3067\u304d\u308b\u3002\n\n```bash:/proc/device-tree/compatible\u3092\u78ba\u8a8d\u3059\u308b\n$ strings /proc/device-tree/compatible\nfsl,imx6dl-sabreauto\nfsl,imx6dl\n```\n## `.dtb` \u3092 `.dts` \u306b\u623b\u3059\n\nUbuntu\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\n```bash\napt-get install device-tree-compiler\n```\n\n\u9006\u30a2\u30bb\u30f3\u30d6\u30eb\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53ef\u80fd\u3002\n\n```bash\ndtc -I dtb -O dts -o ${hoge}.dts ${hoge}.dtb\n```\n\n# \u30a8\u30c7\u30a3\u30bf\u95a2\u9023\n## Vim\u306eSyntax\u5bfe\u5fdc\nv7.3.684 (6 Oct 2012) \u4ee5\u964d\u3067 `dts.vim` \u306b\u5bfe\u5fdc\u6e08\u307f\nhttps://github.com/vim/vim/commit/0c5fa7d740bafefbf0b2ea48a2a660901d7d4f10\n\n# \u53c2\u8003\u66f8\u7c4d\nInterface2014\u5e7410\u6708\u53f7\u300111\u6708\u53f7\u306b\u7279\u96c6\u3055\u308c\u3066\u3044\u308b\u3002\u305f\u3060\u3057\u6982\u8981\u7a0b\u5ea6\u3002\n\nLinux 3.2 \u306b\u5bfe\u5fdc\u3057\u305fO'Reilly\u306e\u66f8\u7c4d\u304c\u51fa\u308b\u3089\u3057\u3044\uff08\u5ef6\u671f\u3057\u30662017\u5e7411\u6708\u4e88\u5b9a\uff09\u304b\u3089\u89e3\u8aac\u304c\u4e57\u308b\u53ef\u80fd\u6027\u306f\u3042\u308a\u307e\u3059\u3002\n[Linux Device Drivers, 4th Edition\u00a0-\u00a0O'Reilly Media](http://shop.oreilly.com/product/0636920030867.do)\n=> 2016/10/13\u8ffd\u8a18: \u4f55\u6545\u304b\u5546\u54c1\u30da\u30fc\u30b8\u304c\u524a\u9664\u3055\u308c\u3066\u3044\u308b\u30fb\u30fb\u30fb\n\n# \u53c2\u8003\n## Wiki\n[elinux.org - Device_Tree](http://elinux.org/Device_Tree)\n[Specifications \u2013 Devicetree](http://www.devicetree.org/specifications/)\n[Device Tree presentations papers articles](http://elinux.org/Device_Tree_presentations_papers_articles)\n\n## \u767a\u8868\u8cc7\u6599\n[\"Device Tree for Dummies\", ELC 2014 by Thomas Petazzoni (PDF)](http://elinux.org/images/f/f9/Petazzoni-device-tree-dummies_0.pdf)\n[elinux.org - Solving Device Tree Issues (PDF)](http://events.linuxfoundation.org/sites/events/files/slides/dt_debugging.pdf)\n[Experiences_With_Device_Tree_Support_Development_For_ARM-Based_SOC (PDF)](http://elinux.org/images/4/48/Experiences_With_Device_Tree_Support_Development_For_ARM-Based_SOC%27s.pdf)\n\n## \u8a18\u4e8b\uff08\u30d6\u30ed\u30b0, Qiita, StackOverFlow\u7b49\uff09\n[\u3068\u3042\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u5099\u5fd8log - Device Tree \u5165\u9580](http://masahir0y.blogspot.jp/2014/05/device-tree.html)\n[\u3068\u3042\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u5099\u5fd8log - Device Tree \u30a2\u30af\u30bb\u30b9\u95a2\u6570\u307e\u3068\u3081 (Linux Kernel) ](http://masahir0y.blogspot.jp/2014/05/device-tree_28.html)\n[Qiita - \u30e1\u30e2\uff1aDevice tree blob (.dtb)\u3092Device tree source (.dts)\u306b\u623b\u3059](http://qiita.com/spicemanjp/items/5054e536442248aad87c)\n[A Tutorial on the Device Tree (Zynq) -- Part I | xillybus.com](http://xillybus.com/tutorials/device-tree-zynq-1)\n[linux - how to program device tree file(.dts)? - Stack Overflow](http://stackoverflow.com/questions/17488320/how-to-program-device-tree-file-dts)\n"}