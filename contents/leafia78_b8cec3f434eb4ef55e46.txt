{"context": "\u30a4\u30f3\u30b9\u30bf\u306eapi\u4f7f\u3046\u3068\u304daccesstoken\u53d6\u308b\u306e\u3081\u3093\u3069\u304f\u3055\u304b\u3063\u305f\u306e\u3067Username\u3068Password\u3067\u8a8d\u8a3c\u901a\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u30ed\u30b0\u30a4\u30f3api\u3068\u753b\u50cf\u6295\u7a3fapi\u306f\u975e\u516c\u958b\u306e\u3082\u306e\u306a\u306e\u3067\u3044\u3064\u52d5\u304b\u306a\u304f\u306a\u308b\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u3002\n\nmain.php\n<?php\n\n$username = \"\"; \n$password = \"\";\n$cookies_file = 'cookies.txt';\n$post_img = \"testimg.jpg\";\n$caption = \"test upload By my program . #PHP\";\n\n/*-------------------\n      sign-in\n---------------------*/\n\n$login_url = \"https://instagram.com/api/v1/accounts/login/\";\n\n$guid = make_Guid();\n\n$device_id = 'android-'.$guid;\n\n$header = make_header(\"{'username':'{$username}','password':'{$password}','guid':'{$guid}','device_id':'{$device_id}','Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'}\");\n\n\n$res = json_decode(request($login_url,$header,false,true));\nvar_dump($res);\n\n/*-------------------\n     post img\n---------------------*/\n$upload_url = \"https://instagram.com/api/v1/media/upload/\";\n$parm = array('photo' => \"@\".$post_img ,\"device_timestamp\" => time());\n\n$res = json_decode(request($upload_url,$parm,true,true));\n$media_id = $res->media_id;\n\n\n$configure_url = \"https://instagram.com/api/v1/media/configure/\";\n$device_timestamp = time();\n\n$header = make_header(\"{'guid':'{$guid}','device_id':'{$device_id}','device_timestamp':'{$device_timestamp}','media_id':'{$media_id}','caption':'{$caption}','source_type':'5','filter_type':'0','extra':'{}','Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'}\");\n\n\nvar_dump($res = json_decode(request($configure_url,$header,true,true)));\necho $res->media->id;\n\n\n\nfunction request($url,$post_data,$cookies,$post){\n\n    $agent = \"Instagram 4.0.0 Android (10/3.3.3; 240; 480x320; samsung; GT-I9220; GT-I9220; smdkc210; en_US)\";\n\n\n    $ch = curl_init();\n\n    curl_setopt($ch, CURLOPT_URL, $url);\n    curl_setopt($ch, CURLOPT_USERAGENT, $agent);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);\n    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);\n    if($post){\n        curl_setopt($ch, CURLOPT_POST, true);\n        curl_setopt($ch, CURLOPT_POSTFIELDS, $post_data);\n    }\n\n    if($cookies) {\n        curl_setopt($ch, CURLOPT_COOKIEFILE, 'cookies.txt');            \n    } else {\n        curl_setopt($ch, CURLOPT_COOKIEJAR, 'cookies.txt');\n    }\n\n    return curl_exec($ch);\n}   \n\nfunction make_Guid() {\n    return sprintf('%04x%04x-%04x-%04x-%04x-%04x%04x%04x', \n            mt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(17388, 78787), \n            mt_rand(34534, 69899), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000)\n          );\n\n}\nfunction make_header($req){\n    $req = str_replace(\"'\",'\"',$req);\n    $sig = hash_hmac('sha256', $req, 'b4a23f5e39b5929e0666ac5de94c89d1618a2916', false);\n    return 'ig_sig_key_version=4&signed_body='.$sig.'.'.str_replace(\"+\",\"%20\",str_replace(\"-\",\"%2D\",urlencode($req)));\n}\n\n\nprivateAPI\u3063\u3066\u97ff\u304d\u304c\u3044\u3044\u3088\u306d\u3002\n\u30a4\u30f3\u30b9\u30bf\u306eapi\u4f7f\u3046\u3068\u304daccesstoken\u53d6\u308b\u306e\u3081\u3093\u3069\u304f\u3055\u304b\u3063\u305f\u306e\u3067Username\u3068Password\u3067\u8a8d\u8a3c\u901a\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u30ed\u30b0\u30a4\u30f3api\u3068\u753b\u50cf\u6295\u7a3fapi\u306f\u975e\u516c\u958b\u306e\u3082\u306e\u306a\u306e\u3067\u3044\u3064\u52d5\u304b\u306a\u304f\u306a\u308b\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u3002\n\n```php:main.php\n<?php\n\n$username = \"\"; \n$password = \"\";\n$cookies_file = 'cookies.txt';\n$post_img = \"testimg.jpg\";\n$caption = \"test upload By my program . #PHP\";\n\n/*-------------------\n\t  sign-in\n---------------------*/\n\n$login_url = \"https://instagram.com/api/v1/accounts/login/\";\n\n$guid = make_Guid();\n\n$device_id = 'android-'.$guid;\n\n$header = make_header(\"{'username':'{$username}','password':'{$password}','guid':'{$guid}','device_id':'{$device_id}','Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'}\");\n\n\n$res = json_decode(request($login_url,$header,false,true));\nvar_dump($res);\n\n/*-------------------\n\t post img\n---------------------*/\n$upload_url = \"https://instagram.com/api/v1/media/upload/\";\n$parm = array('photo' => \"@\".$post_img ,\"device_timestamp\" => time());\n\n$res = json_decode(request($upload_url,$parm,true,true));\n$media_id = $res->media_id;\n\n\n$configure_url = \"https://instagram.com/api/v1/media/configure/\";\n$device_timestamp = time();\n\n$header = make_header(\"{'guid':'{$guid}','device_id':'{$device_id}','device_timestamp':'{$device_timestamp}','media_id':'{$media_id}','caption':'{$caption}','source_type':'5','filter_type':'0','extra':'{}','Content-Type':'application/x-www-form-urlencoded; charset=UTF-8'}\");\n\n\nvar_dump($res = json_decode(request($configure_url,$header,true,true)));\necho $res->media->id;\n\n\n\nfunction request($url,$post_data,$cookies,$post){\n\n\t$agent = \"Instagram 4.0.0 Android (10/3.3.3; 240; 480x320; samsung; GT-I9220; GT-I9220; smdkc210; en_US)\";\n\n\n\t$ch = curl_init();\n\n\tcurl_setopt($ch, CURLOPT_URL, $url);\n\tcurl_setopt($ch, CURLOPT_USERAGENT, $agent);\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\tcurl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);\n\tcurl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);\n\tcurl_setopt($ch, CURLOPT_SSL_VERIFYHOST, false);\n\tif($post){\n\t\tcurl_setopt($ch, CURLOPT_POST, true);\n\t\tcurl_setopt($ch, CURLOPT_POSTFIELDS, $post_data);\n\t}\n\t\n\tif($cookies) {\n\t\tcurl_setopt($ch, CURLOPT_COOKIEFILE, 'cookies.txt');\t\t\t\n\t} else {\n\t\tcurl_setopt($ch, CURLOPT_COOKIEJAR, 'cookies.txt');\n\t}\n\n\treturn curl_exec($ch);\n}\t\n\nfunction make_Guid() {\n    return sprintf('%04x%04x-%04x-%04x-%04x-%04x%04x%04x', \n\t\t\tmt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(17388, 78787), \n            mt_rand(34534, 69899), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000), \n            mt_rand(0, 30000)\n          );\n\n}\nfunction make_header($req){\n\t$req = str_replace(\"'\",'\"',$req);\n\t$sig = hash_hmac('sha256', $req, 'b4a23f5e39b5929e0666ac5de94c89d1618a2916', false);\n\treturn 'ig_sig_key_version=4&signed_body='.$sig.'.'.str_replace(\"+\",\"%20\",str_replace(\"-\",\"%2D\",urlencode($req)));\n}\n```\n\nprivateAPI\u3063\u3066\u97ff\u304d\u304c\u3044\u3044\u3088\u306d\u3002\n", "tags": ["PHP", "Instagram"]}