{"tags": ["nginx", "Ubuntu", "Ruby", "Rails", "unicorn"], "context": " More than 1 year has passed since last update.\nUbuntu 13.04\nNginx 1.5.4\nRuby 2.0.0p247\nRuby on Rails 4.0.0\n\n\n\u6700\u65b0\u306eNginx\u3092\u5165\u308c\u308b\ncd ~\nNginx\u306e\u9375\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u8ffd\u52a0\u3059\u308b\nwget http://nginx.org/keys/nginx_signing.key\nsudo apt-key add nginx_signing.key\n/etc/apt/sources.list\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3059\u308b\n    deb http://nginx.org/packages/mainline/ubuntu/ raring nginx\n    deb-src http://nginx.org/packages/mainline/ubuntu/ raring nginx\napt-get\u3092\u66f4\u65b0\nsudo apt-get update\nNginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install nginx\n\u3064\u3044\u3067\u306bGit\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install git\n\nrbenv\u3092\u5165\u308c\u308b\ncd ~\ngit clone git://github.com/sstephenson/rbenv.git .rbenv\ngit clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build\n~/.bash_profile\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3059\u308b\nexport PATH=\"$HOME/.rbenv/bin:$PATH\"\neval \"$(rbenv init -)\"\n\nsource ~/.bash_profile\u3067\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\n\nRuby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\nrbenv install --list\n\u4eca\u56de\u306f2.0.0-p247\u3068\u3044\u3046\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\nrbenv install 2.0.0-p247\nrbenv rehash\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u8a2d\u5b9a\nrbenv global 2.0.0-p247\n\nRails\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngem install rails\nrbenv rehash\n\n\u3064\u3044\u3067\u306bMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get install mysql-server\n\nNginx\u306e\u8a2d\u5b9a\n/etc/nginx/conf.d/\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\nsudo vim /etc/nginx/conf.d/test.conf\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u4f8b\uff09\n    upstream test {\n            server unix:/tmp/test.sock;\n    }\n\n    server {\n            listen          80;\n            server_name     test.jp;\n            access_log      /var/www/test/logs/access.log;\n            error_log       /var/www/test/logs/error.log;\n\n            location / {\n                    proxy_pass http://test;\n            }\n\n\n            location = /robots.txt  { access_log off; log_not_found off; }\n            location = /favicon.ico { access_log off; log_not_found off; }\n\n    }\n\nNginx\u306e\u518d\u8d77\u52d5\nservice nginx restart\n\n\u4f5c\u3063\u305fRails\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\nGemfile\u306bUnicorn\u3067\u5fc5\u8981\u306a\u3082\u306e\u3092\u8ffd\u52a0\u3059\u308b\n    gem 'unicorn'\n    gem 'execjs'\n    gem 'therubyracer'\n\u305d\u3057\u3066\nbundle install\nRails\u306econfig\u30d5\u30a9\u30eb\u30c0\u306bUnicorn\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\nvim config/unicorn.rb\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u4f8b\uff09\u3000\u6700\u4f4e\u9650\u306a\u3082\u306e\u3057\u304b\u66f8\u3044\u3066\u3042\u308a\u307e\u305b\u3093\u3002\u3002\u3002\n    listen '/tmp/test.sock'\n    pid '/tmp/test.pid'\n\u6700\u5f8c\u306bUnicorn\u3092\u8d77\u52d5\nunicorn_rails -c config/unicorn.rb -E production -D\nUnicorn\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306b\u306f\nps -ef | grep unicorn | grep -v grep\nUnicorn\u3092\u3068\u3081\u308b\u306b\u306f\nkill -QUIT \u3010\u30d7\u30ed\u30bb\u30b9ID\u3011\n\n- Ubuntu 13.04\n- Nginx 1.5.4\n- Ruby 2.0.0p247\n- Ruby on Rails 4.0.0\n\n## \u6700\u65b0\u306eNginx\u3092\u5165\u308c\u308b\n`cd ~`\nNginx\u306e\u9375\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u8ffd\u52a0\u3059\u308b\n`wget http://nginx.org/keys/nginx_signing.key`\n`sudo apt-key add nginx_signing.key`\n\n`/etc/apt/sources.list`\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3059\u308b\n\tdeb http://nginx.org/packages/mainline/ubuntu/ raring nginx\n\tdeb-src http://nginx.org/packages/mainline/ubuntu/ raring nginx\n\napt-get\u3092\u66f4\u65b0\n`sudo apt-get update`\n\nNginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`sudo apt-get install nginx`\n\n\u3064\u3044\u3067\u306bGit\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`sudo apt-get install git`\n\n## rbenv\u3092\u5165\u308c\u308b\n`cd ~`\n`git clone git://github.com/sstephenson/rbenv.git .rbenv`\n`git clone https://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build`\n\n`~/.bash_profile`\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3059\u308b\n\n```\nexport PATH=\"$HOME/.rbenv/bin:$PATH\"\neval \"$(rbenv init -)\"\n```\n\n`source ~/.bash_profile`\u3067\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\n\n### Ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n`rbenv install --list`\n\u4eca\u56de\u306f2.0.0-p247\u3068\u3044\u3046\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n`rbenv install 2.0.0-p247`\n`rbenv rehash`\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u8a2d\u5b9a\n`rbenv global 2.0.0-p247`\n\n### Rails\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`gem install rails`\n`rbenv rehash`\n\n### \u3064\u3044\u3067\u306bMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`sudo apt-get install mysql-server`\n\n## Nginx\u306e\u8a2d\u5b9a\n`/etc/nginx/conf.d/`\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n`sudo vim /etc/nginx/conf.d/test.conf`\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u4f8b\uff09\n\n        upstream test {\n                server unix:/tmp/test.sock;\n        }\n\n        server {\n                listen          80;\n                server_name     test.jp;\n                access_log      /var/www/test/logs/access.log;\n                error_log       /var/www/test/logs/error.log;\n\n                location / {\n                        proxy_pass http://test;\n                }\n\n\n                location = /robots.txt  { access_log off; log_not_found off; }\n                location = /favicon.ico { access_log off; log_not_found off; }\n\n        }\nNginx\u306e\u518d\u8d77\u52d5\n`service nginx restart`\n\n## \u4f5c\u3063\u305fRails\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\nGemfile\u306bUnicorn\u3067\u5fc5\u8981\u306a\u3082\u306e\u3092\u8ffd\u52a0\u3059\u308b\n    gem 'unicorn'\n    gem 'execjs'\n    gem 'therubyracer'\n\n\u305d\u3057\u3066\n`bundle install`\n\nRails\u306econfig\u30d5\u30a9\u30eb\u30c0\u306bUnicorn\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n`vim config/unicorn.rb`\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08\u4f8b\uff09\u3000\u6700\u4f4e\u9650\u306a\u3082\u306e\u3057\u304b\u66f8\u3044\u3066\u3042\u308a\u307e\u305b\u3093\u3002\u3002\u3002\n    listen '/tmp/test.sock'\n    pid '/tmp/test.pid'\n\n\u6700\u5f8c\u306bUnicorn\u3092\u8d77\u52d5\n`unicorn_rails -c config/unicorn.rb -E production -D`\n\nUnicorn\u304c\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306b\u306f\n`ps -ef | grep unicorn | grep -v grep`\n\nUnicorn\u3092\u3068\u3081\u308b\u306b\u306f\n`kill -QUIT \u3010\u30d7\u30ed\u30bb\u30b9ID\u3011`\n"}