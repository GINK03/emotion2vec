{"context": " More than 1 year has passed since last update.\u672c\u8a18\u4e8b\u3067\u306f\u3001Kaggle\u306eCriteo Display Advertising Challenge\u306bTreasure Data\u3068Hivemall\u3092\u4f7f\u3063\u3066baseline\u306e\u7d50\u679c\u3092\u63d0\u51fa\u307e\u3067\u306e\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u672c\u8a18\u4e8b\u306fTreasure Data Advent Calendar 2015\u306e12/8\u306e\u6295\u7a3f\u306b\u306a\u308a\u307e\u3059\u3002\n\nCriteo Display Advertising Challenge\u306b\u3064\u3044\u3066\nCriteo Display Advertising Challenge\u306f\u5e83\u544a\u306e\u30af\u30ea\u30c3\u30af\u7387\u3092\u63a8\u5b9a\u3059\u308b\u30bf\u30b9\u30af\u3067\u3059\u3002\u8a13\u7df4\u4e8b\u4f8b\u6570\u306f45 million\u3067\u30b5\u30a4\u30ba\u304c11GB\u3068\u6a5f\u68b0\u5b66\u7fd2\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u3057\u3066\u306f\u5927\u304d\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3067\u3059\u3002\u8aac\u660e\u5909\u6570\u306f\u300113\u306e\u91cf\u7684\u5909\u6570\u306826\u306e\u8cea\u7684\u5909\u6570\u304b\u3089\u306a\u308a\u307e\u3059\u3002\n\u8a55\u4fa1\u624b\u6cd5\u306fLog loss\u306a\u306e\u3067\u3001\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306b\u3088\u308b\u4e88\u6e2c\u304c\u6709\u52b9\u3067\u3059\u3002\n\nBeat the Benchmark\nMLWave\u306e\u4eba\u304cVowpal Wabbit\u306e\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u4f7f\u3063\u305f\u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u30b9\u30b3\u30a2\u306e\u51fa\u3057\u65b9\u3092\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3067\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/MLWave/kaggle-criteo\nPublic leader board\u30670.48427\u3001Private leader board\u30670.48396\u7a0b\u5ea6\u304c\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u306e\u3088\u3046\u3067\u3059\u3002\u4eca\u56de\u306fHivemall\u306e\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30 on TD\u3092\u4f7f\u3063\u3066\u540c\u7b49\u306e\u7cbe\u5ea6\u3092\u51fa\u3059\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3078\u306e\u30c7\u30fc\u30bf\u6295\u5165\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9criteo\u3092\u4f5c\u6210\ntd db:create criteo\n\n# \u8a13\u7df4\u30c7\u30fc\u30bf\u306bID\u3092\u632f\u308a\u307e\u3059\u300210000000\u304b\u3089\u59cb\u307e\u308b\u6570\u5b57\u304cID\u306b\u306a\u308a\u307e\u3059\u3002\nawk '{IFS=\"\\t\"; OFS=\"\\t\"} {print 10000000+NR-1,$0}' train.txt > train2.txt\n\n# \u8a13\u7df4\u4e8b\u4f8b\u3092train_raw\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\u3059\u308b\ntd import:auto --format tsv \\\n--error-records-handling abort \\\n--columns rowid,label,i1,i2,i3,i4,i5,i6,i7,i8,i9,i10,i11,i12,i13,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26 \\\n--column-types long,int,int,int,int,int,int,int,int,int,int,int,int,int,int,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string \\\n--time-value `date +%s` --auto-create criteo.train_raw train2.txt\n\n# \u30c6\u30b9\u30c8\u4e8b\u4f8b\u306bID\u3092\u632f\u308a\u307e\u3059\u300260000000\u304b\u3089\u59cb\u307e\u308b\u6570\u5b57\u304cID\u306b\u306a\u308a\u307e\u3059\u3002\nawk '{IFS=\"\\t\"; OFS=\"\\t\"} {print 60000000+NR-1,$0}' test.txt > test2.txt\n\n# \u30c6\u30b9\u30c8\u4e8b\u4f8b\u3092test_raw\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\u3059\u308b\ntd import:auto --format tsv \\\n--error-records-handling abort \\\n--columns rowid,i1,i2,i3,i4,i5,i6,i7,i8,i9,i10,i11,i12,i13,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26 \\\n--column-types long,int,int,int,int,int,int,int,int,int,int,int,int,int,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string \\\n--time-value `date +%s` --auto-create criteo.test_raw test2.txt\n\n\nFeature Engineering\n\n\u30c7\u30fc\u30bf\u306e\u6b63\u898f\u5316\u306e\u305f\u3081\u306e\u7d71\u8a08\u5024\u306e\u7b97\u51fa\n\u91cf\u7684\u5909\u6570\u306b\u3064\u3044\u3066\u3001Min-Max\u6b63\u898f\u5316\u3092\u4f7f\u3063\u305frescaling\u3092\u884c\u3046\u305f\u3081\u306b\u3001i1-i13\u306b\u3064\u3044\u3066min/max\u5024\u3092\u7b97\u51fa\u3057\u307e\u30591\u3002\n\u4eca\u56de\u306f\u8a13\u7df4\u30c7\u30fc\u30bf\u3068\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u5168\u4f53\u306emin/max\u5024\u3092\u4f7f\u3044\u307e\u30592\u3002\ntd query -w --type presto -d criteo \"\nselect\n  min(min1) as min1, max(max1) as max1,\n  min(min2) as min2, max(max2) as max2,\n  min(min3) as min3, max(max3) as max3,\n  min(min4) as min4, max(max4) as max4,\n  min(min5) as min5, max(max5) as max5,\n  min(min6) as min6, max(max6) as max6,\n  min(min7) as min7, max(max7) as max7,\n  min(min8) as min8, max(max8) as max8,\n  min(min9) as min9, max(max9) as max9,\n  min(min10) as min10, max(max10) as max10,\n  min(min11) as min11, max(max11) as max11,\n  min(min12) as min12, max(max12) as max12,\n  min(min13) as min13, max(max13) as max13\nfrom (\n  select\n    min(i1) as min1, max(i1) as max1,\n    min(i2) as min2, max(i2) as max2,\n    min(i3) as min3, max(i3) as max3,\n    min(i4) as min4, max(i4) as max4,\n    min(i5) as min5, max(i5) as max5,\n    min(i6) as min6, max(i6) as max6,\n    min(i7) as min7, max(i7) as max7,\n    min(i8) as min8, max(i8) as max8,\n    min(i9) as min9, max(i9) as max9,\n    min(i10) as min10, max(i10) as max10,\n    min(i11) as min11, max(i11) as max11,\n    min(i12) as min12, max(i12) as max12,\n    min(i13) as min13, max(i13) as max13\n  from\n    train_raw\n  union all\n  select\n    min(i1) as min1, max(i1) as max1,\n    min(i2) as min2, max(i2) as max2,\n    min(i3) as min3, max(i3) as max3,\n    min(i4) as min4, max(i4) as max4,\n    min(i5) as min5, max(i5) as max5,\n    min(i6) as min6, max(i6) as max6,\n    min(i7) as min7, max(i7) as max7,\n    min(i8) as min8, max(i8) as max8,\n    min(i9) as min9, max(i9) as max9,\n    min(i10) as min10, max(i10) as max10,\n    min(i11) as min11, max(i11) as max11,\n    min(i12) as min12, max(i12) as max12,\n    min(i13) as min13, max(i13) as max13\n  from\n    test_raw\n) t\n\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| min1 | max1 | min2 | max2   | min3 | max3  | min4 | max4 | min5 | max5     | min6 | max6   | min7 | max7  | min8 | max8 | min9 | max9  | min10 | max10 | min11 | max11 | min12 | max12 | min13 | max13 |\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| 0    | 5775 | -3   | 257675 | 0    | 65535 | 0    | 969  | 0    | 23159456 | 0    | 431037 | 0    | 56311 | 0    | 6184 | 0    | 29019 | 0     | 11    | 0     | 231   | 0     | 4008  | 0     | 7393  |\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n\n\nFeature Scaling\n\u307e\u305a\u3001Hivemall\u306e\u8a13\u7df4\u7528\u306e\u30c6\u30fc\u30d6\u30ebtrain\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nquantitative_features\u95a2\u6570\u306f\u91cf\u7684\u5909\u6570\u3092\u4f5c\u308bUDF\u3001categorical_features\u95a2\u6570\u306f\u8cea\u7684\u5909\u6570\u3092\u4f5c\u308bUDF\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u91cf\u7684\u5909\u6570\u306b\u3064\u3044\u3066rescale\u95a2\u6570\u3067min-max\u6b63\u898f\u5316\u3092\u884c\u3044\u307e\u3059\u3002array('bias')\u306f\u7dda\u5f62\u56de\u5e30\u306e\u5207\u7247\u3092\u4ed8\u4e0e\u3059\u308b\u3082\u306e\u3067\u3059\u3002\ntd table:create criteo train\n\ntd query -w --type hive -d criteo \"\nINSERT OVERWRITE TABLE train\nselect\n  rowid, \n  concat_array(\n    array('bias'),\n    quantitative_features(\n      array('i1','i2','i3','i4','i5','i6','i7','i8','i9','i10','i11','i12','i13'),\n      rescale(i1, 0, 5775),\n      rescale(i2, -3, 257675),\n      rescale(i3, 0, 65535),\n      rescale(i4, 0, 969),\n      rescale(i5, 0, 23159456),\n      rescale(i6, 0, 431037),\n      rescale(i7, 0, 56311),\n      rescale(i8, 0, 6184),\n      rescale(i9, 0, 29019),\n      rescale(i10, 0, 11),\n      rescale(i11, 0, 231),\n      rescale(i12, 0, 4008),\n      rescale(i13, 0, 7393)\n    ),\n    categorical_features(\n      array('c1','c2','c3','c4','c5','c6','c7','c8','c9','c10','c11','c12','c13','c14','c15','c16','c17','c18','c19','c20','c21','c22','c23','c24','c25','c26'),\n      c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26\n    )\n  ) as features,\n  label\nfrom \n  train_raw\n\"\n\n\u4e0a\u306e\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3068train\u30c6\u30fc\u30d6\u30eb\u306f\u6b21\u306e\u3088\u3046\u306a\u5f62\u3068\u306a\u308a\u307e\u30593\u3002\ntd query -w --type presto -d criteo \"\nselect rowid, features, label from train limit 5\n\"\n\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n| rowid    | features                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | label |\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n| 38141107 | [\"bias\",\"i2:1.552325011289213E-5\",\"i5:2.522943541407585E-4\",\"i6:6.495961861219257E-5\",\"i7:3.551703775883652E-5\",\"i8:6.468305364251137E-4\",\"i9:4.8244252684526145E-4\",\"i11:0.008658008649945259\",\"i13:4.057892656419426E-4\",\"c1#241546e0\",\"c2#ae46a29d\",\"c3#c56edf2f\",\"c4#f922efad\",\"c5#4cf72387\",\"c6#fe6b92e5\",\"c7#6362d73a\",\"c8#0b153874\",\"c9#a73ee510\",\"c10#4b28ae0c\",\"c11#ba0f9e8a\",\"c12#66a76a26\",\"c13#4e4dd817\",\"c14#1adce6ef\",\"c15#8ff4b403\",\"c16#01adbab4\",\"c17#e5ba7672\",\"c18#26b3c7a7\",\"c21#21c9516a\",\"c22#ad3062eb\",\"c23#bcdee96c\",\"c24#b34f3128\"]                                                                                                                 | 1     |\n| 38141108 | [\"bias\",\"i1:1.7316016601398587E-4\",\"i2:3.609155537560582E-4\",\"i4:0.0020639835856854916\",\"i5:8.981212886283174E-6\",\"i6:6.959959137020633E-6\",\"i7:3.551703775883652E-5\",\"i8:6.468305364251137E-4\",\"i9:3.4460180904716253E-4\",\"i10:0.09090909361839294\",\"i11:0.008658008649945259\",\"i13:2.7052618679590523E-4\",\"c1#05db9164\",\"c2#09e68b86\",\"c3#1637edfd\",\"c4#b0ed6de7\",\"c5#25c83c98\",\"c7#90cedade\",\"c8#985e3fcb\",\"c9#a73ee510\",\"c10#2e834f9a\",\"c11#c17b047a\",\"c12#0e52e7ba\",\"c13#2e7b87f1\",\"c14#64c94865\",\"c15#91126f30\",\"c16#7804892a\",\"c17#07c540c4\",\"c18#5aed7436\",\"c19#d9aa05dc\",\"c20#5840adea\",\"c21#92791411\",\"c23#32c7478e\",\"c24#1793a828\",\"c25#e8b83407\",\"c26#fa3124de\"] | 1     |\n| 38141109 | [\"bias\",\"i2:2.4837200180627406E-4\",\"i3:3.051804378628731E-5\",\"i4:0.02270381897687912\",\"i5:1.611004990991205E-4\",\"i6:1.9023889035452157E-4\",\"i7:2.663777850102633E-4\",\"i8:0.004204398486763239\",\"i9:0.015920603647828102\",\"i11:0.05627705529332161\",\"i13:0.002975787967443466\",\"c1#05db9164\",\"c2#8084ee93\",\"c3#02cf9876\",\"c4#c18be181\",\"c5#4cf72387\",\"c6#13718bbd\",\"c7#5e64ce5f\",\"c8#0b153874\",\"c9#a73ee510\",\"c10#9de7c14e\",\"c11#8b94178b\",\"c12#8fe001f4\",\"c13#025225f2\",\"c14#b28479f6\",\"c15#b2ff8c6b\",\"c16#36103458\",\"c17#e5ba7672\",\"c18#52e44668\",\"c21#e587c466\",\"c23#32c7478e\",\"c24#3b183c5c\"]                                                                             | 0     |\n| 38141110 | [\"bias\",\"i2:1.1642437129921746E-5\",\"i3:7.019150070846081E-4\",\"i4:0.0010319917928427458\",\"i5:0.002615907695144415\",\"i8:4.8512290231883526E-4\",\"i9:3.446017944952473E-5\",\"i13:4.057892656419426E-4\",\"c1#68fd1e64\",\"c2#287130e0\",\"c3#257f29b7\",\"c4#89526cd2\",\"c5#0942e0a7\",\"c6#fbad5c96\",\"c7#9115f277\",\"c8#f504a6f4\",\"c9#7cc72ec2\",\"c10#5612701e\",\"c11#1d125cbb\",\"c12#921c8174\",\"c13#7f9db67d\",\"c14#1adce6ef\",\"c15#310d155b\",\"c16#7cccf7ff\",\"c17#e5ba7672\",\"c18#891589e7\",\"c19#9653bb65\",\"c20#a458ea53\",\"c21#af4ea70d\",\"c22#ad3062eb\",\"c23#3a171ecb\",\"c24#17b5e269\",\"c25#e8b83407\",\"c26#98aebbef\"]                                                                              | 0     |\n| 38141111 | [\"bias\",\"i2:7.916857721284032E-4\",\"i3:3.051804378628731E-5\",\"i4:0.0010319917928427458\",\"i5:2.1792393818031996E-4\",\"i6:1.4383916277438402E-4\",\"i7:1.775851887941826E-5\",\"i8:3.2341526821255684E-4\",\"i9:0.0011027257423847914\",\"i11:0.0043290043249726295\",\"i13:1.3526309339795262E-4\",\"c1#68fd1e64\",\"c2#2c8c5f5d\",\"c3#13cd0697\",\"c4#352cefe6\",\"c5#25c83c98\",\"c6#fe6b92e5\",\"c7#aa0d873c\",\"c8#c8ddd494\",\"c9#a73ee510\",\"c10#3b08e48b\",\"c11#6a447eb3\",\"c12#c3cdaf85\",\"c13#9dfda2b9\",\"c14#1adce6ef\",\"c15#5edc1a28\",\"c16#08514295\",\"c17#d4bb7bd8\",\"c18#f5f4ae5b\",\"c21#6387fda4\",\"c23#3a171ecb\",\"c24#d36c7dbf\"]                                                                      | 0     |\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n\n\n\u540c\u69d8\u306b\u30c6\u30b9\u30c8\u7528\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ntd table:create criteo test\n\ntd query -w --type hive -d criteo \"\nINSERT OVERWRITE TABLE test\nselect\n  rowid, \n  concat_array(\n    array('bias'),\n    quantitative_features(\n      array('i1','i2','i3','i4','i5','i6','i7','i8','i9','i10','i11','i12','i13'),\n      rescale(i1, 0, 5775),\n      rescale(i2, -3, 257675),\n      rescale(i3, 0, 65535),\n      rescale(i4, 0, 969),\n      rescale(i5, 0, 23159456),\n      rescale(i6, 0, 431037),\n      rescale(i7, 0, 56311),\n      rescale(i8, 0, 6184),\n      rescale(i9, 0, 29019),\n      rescale(i10, 0, 11),\n      rescale(i11, 0, 231),\n      rescale(i12, 0, 4008),\n      rescale(i13, 0, 7393)\n    ),\n    categorical_features(\n      array('c1','c2','c3','c4','c5','c6','c7','c8','c9','c10','c11','c12','c13','c14','c15','c16','c17','c18','c19','c20','c21','c22','c23','c24','c25','c26'),\n      c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26\n    )\n  ) as features\nfrom\n  test_raw\n\"\n\n\n\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306b\u3088\u308b\u5b66\u7fd2\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\nlogress_model\u30c6\u30fc\u30d6\u30eb\u306b\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u4f7f\u3063\u305f\u5b66\u7fd2\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\nWITH\u53e5\u306etrain_x3\u3067\u306f\u3001\u7e70\u308a\u8fd4\u3057\u5b66\u7fd2\u3092\u6a21\u64ec\u3059\u308b\u305f\u3081\u306b\u3001amplify\u95a2\u6570\u3067\u8a13\u7df4\u4e8b\u4f8b\u30923\u500d\u306b\u5897\u5e45\u3057\u305f\u4e0a\u3067CLUSTER BY rand(1)\u3067\u30b7\u30e3\u30c3\u30d5\u30eb\u3057\u3066\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u5b66\u7fd2\u306e\u5165\u529b\u3068\u3057\u3066\u3044\u307e\u3059\u3002\ntd table:create criteo logress_model\ntd query -w -x --type hive -d criteo \"\nWITH train_x3 as (\n  select\n    features, label\n  from (\n    select \n      amplify(3, features, label) as (features, label)\n    from \n      train\n  ) t\n  CLUSTER BY rand(1)\n)\nINSERT OVERWRITE TABLE logress_model \nselect\n  feature,\n  avg(weight) as weight\nfrom (\n  select \n    logress(features, label) as (feature, weight)\n  from\n    train_x3\n) t\ngroup by feature;\n\"\n\n\n\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u4e88\u6e2c\u30e2\u30c7\u30eb\u3092\u5229\u7528\u3057\u3066\u30af\u30ea\u30c3\u30af\u78ba\u7387\u3092\u4e88\u6e2c\ntd query -w --type hive -d criteo -f csv --column-header -o logress_predict.csv \"\nWITH test_exploded as (\nselect \n  rowid,\n  extract_feature(fv) as feature,\n  extract_weight(fv) as value\nfrom\n  test t1 LATERAL VIEW explode(features) t2 as fv\n)\nselect\n  t.rowid as Id,\n  sigmoid(sum(m.weight * t.value)) as Predicted\nfrom \n  test_exploded t\n  LEFT OUTER JOIN logress_model m ON (t.feature = m.feature)\ngroup by\n  t.rowid\n\"\n\n\nKaggle\u3078\u306esubmit\nlogress_predict.csv\u3092kaggle\u306bsubmit\u3057\u307e\u3059\u3068\u3001Beseline\u3088\u308a\u3061\u3087\u3063\u3068\u826f\u3044\u30b9\u30b3\u30a2\u304c\u51fa\u307e\u3057\u305f\u3002\n\n\n\n\nPublic Leader board\nPrivate Leader board\n\n\n\n\nBaseline(VW)\n0.48427\n0.48396\n\n\nHivemall\n0.48253\n0.48229\n\n\n\n\n\u3055\u3044\u3054\u306b\n\u4eca\u56de\u306f\u57fa\u672c\u7684\u306a\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3067CTR prediction\u3092\u884c\u3046\u4f8b\u3092\u51fa\u3057\u307e\u3057\u305f\u3002\nv0.4\u306e\u65b0\u6a5f\u80fd\u306eFactorization Machines\u306e\u8a18\u4e8b\u3092\u66f8\u3053\u3046\u3068\u601d\u3063\u3066\u307e\u3057\u305f\u304c\u3001Factorization Machines\u3067\u306f\u306a\u305c\u304b\u7cbe\u5ea6\u304c\u3044\u307e\u3044\u3061\u3067\u3057\u305f\u306e\u3067\u3001\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306bfallback\u3057\u307e\u3057\u305f...orz\n\u30b3\u30f3\u30da\u306eforum\u3084\u3092\u307f\u308b\u3068feature pairing\u304c\u6709\u52b9\u306a\u3088\u30464\u306a\u306e\u3067\u3001\u7cbe\u5ea6\u3092\u4e0a\u3052\u308b\u305f\u3081\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3068\u3057\u3066\u306f\u9ad8\u6b21\u7279\u5fb4\u91cf\u3092\u4f5c\u3063\u3066\u307f\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002Hivemall\u3067feature pairing\u3092\u884c\u3046\u4f8b\u306f\u3053\u3053\u3092\u53c2\u8003\u306b\u3069\u3046\u305e\u3002\n\n\n\n\n\u3053\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3060\u3068zscore\u3092\u4f7f\u3063\u305f\u65b9\u304c\u7cbe\u5ea6\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4eca\u56de\u306f\u8a66\u3057\u3066\u307e\u305b\u3093\u3002\u00a0\u21a9\n\n\ni3\u306e-3\u3063\u3066\u7570\u5e38\u5024\u3067\u3057\u3087\u3046\u304b\uff08?)\u7cbe\u5ea6\u3092\u3042\u3052\u308b\u305f\u3081\u306b\u306f\u9664\u5916\u3059\u308b\u306a\u3069\u306e\u5bfe\u5fdc\u3082\u8981\u691c\u8a0e\u3067\u3059\u3002\u30b3\u30f3\u30da\u306eforum\u306e\u8b70\u8ad6\u3092\u63a2\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u00a0\u21a9\n\n\nHivemall\u306e\u7279\u5fb4\u91cf\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3064\u3044\u3066\u306f\u3001LibSVM\u3084Vowpal Wabbit\u306b\u6e96\u3058\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f\u3053\u306e\u30da\u30fc\u30b8\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\u00a0\u21a9\n\n\nhttps://github.com/swapniel99/criteo \u8a13\u7df4\u4e8b\u4f8b\u6570\u304c\u305d\u308c\u306a\u308a\u306b\u3042\u308b\u306e\u3067\u3001\u52fe\u914d\u306e\u6700\u9069\u5316\u306eadaXXX\u306f\u3044\u3046\u307b\u3069\u52b9\u304b\u306a\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u304c\u8a66\u3057\u3066\u3044\u307e\u305b\u3093\u3002Hivemall\u306b\u3082adagrad+logistic loss\u306f\u4f7f\u3048\u307e\u3059\u3002\u00a0\u21a9\n\n\n\n\u672c\u8a18\u4e8b\u3067\u306f\u3001Kaggle\u306e[Criteo Display Advertising Challenge](https://www.kaggle.com/c/criteo-display-ad-challenge)\u306bTreasure Data\u3068[Hivemall](https://github.com/myui/hivemall/)\u3092\u4f7f\u3063\u3066baseline\u306e\u7d50\u679c\u3092\u63d0\u51fa\u307e\u3067\u306e\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u672c\u8a18\u4e8b\u306f[Treasure Data Advent Calendar 2015](http://qiita.com/advent-calendar/2015/td)\u306e12/8\u306e\u6295\u7a3f\u306b\u306a\u308a\u307e\u3059\u3002\n\n# Criteo Display Advertising Challenge\u306b\u3064\u3044\u3066\n\nCriteo Display Advertising Challenge\u306f\u5e83\u544a\u306e\u30af\u30ea\u30c3\u30af\u7387\u3092\u63a8\u5b9a\u3059\u308b\u30bf\u30b9\u30af\u3067\u3059\u3002\u8a13\u7df4\u4e8b\u4f8b\u6570\u306f45 million\u3067\u30b5\u30a4\u30ba\u304c11GB\u3068\u6a5f\u68b0\u5b66\u7fd2\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u3057\u3066\u306f\u5927\u304d\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3067\u3059\u3002\u8aac\u660e\u5909\u6570\u306f\u300113\u306e\u91cf\u7684\u5909\u6570\u306826\u306e\u8cea\u7684\u5909\u6570\u304b\u3089\u306a\u308a\u307e\u3059\u3002\n\n\u8a55\u4fa1\u624b\u6cd5\u306f[Log loss](https://www.kaggle.com/wiki/LogarithmicLoss)\u306a\u306e\u3067\u3001\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306b\u3088\u308b\u4e88\u6e2c\u304c\u6709\u52b9\u3067\u3059\u3002\n\n# Beat the Benchmark\n\nMLWave\u306e\u4eba\u304c[Vowpal Wabbit](https://github.com/JohnLangford/vowpal_wabbit)\u306e\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u4f7f\u3063\u305f\u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u30b9\u30b3\u30a2\u306e\u51fa\u3057\u65b9\u3092\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3067\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/MLWave/kaggle-criteo\n\n[Public leader board](https://www.kaggle.com/c/criteo-display-ad-challenge/leaderboard/public)\u30670.48427\u3001[Private leader board](https://www.kaggle.com/c/criteo-display-ad-challenge/leaderboard/private)\u30670.48396\u7a0b\u5ea6\u304c\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u306e\u3088\u3046\u3067\u3059\u3002\u4eca\u56de\u306fHivemall\u306e\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30 on TD\u3092\u4f7f\u3063\u3066\u540c\u7b49\u306e\u7cbe\u5ea6\u3092\u51fa\u3059\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n# \u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3078\u306e\u30c7\u30fc\u30bf\u6295\u5165\n\n```sh \n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9criteo\u3092\u4f5c\u6210\ntd db:create criteo\n\n# \u8a13\u7df4\u30c7\u30fc\u30bf\u306bID\u3092\u632f\u308a\u307e\u3059\u300210000000\u304b\u3089\u59cb\u307e\u308b\u6570\u5b57\u304cID\u306b\u306a\u308a\u307e\u3059\u3002\nawk '{IFS=\"\\t\"; OFS=\"\\t\"} {print 10000000+NR-1,$0}' train.txt > train2.txt\n\n# \u8a13\u7df4\u4e8b\u4f8b\u3092train_raw\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\u3059\u308b\ntd import:auto --format tsv \\\n--error-records-handling abort \\\n--columns rowid,label,i1,i2,i3,i4,i5,i6,i7,i8,i9,i10,i11,i12,i13,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26 \\\n--column-types long,int,int,int,int,int,int,int,int,int,int,int,int,int,int,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string \\\n--time-value `date +%s` --auto-create criteo.train_raw train2.txt\n\n# \u30c6\u30b9\u30c8\u4e8b\u4f8b\u306bID\u3092\u632f\u308a\u307e\u3059\u300260000000\u304b\u3089\u59cb\u307e\u308b\u6570\u5b57\u304cID\u306b\u306a\u308a\u307e\u3059\u3002\nawk '{IFS=\"\\t\"; OFS=\"\\t\"} {print 60000000+NR-1,$0}' test.txt > test2.txt\n\n# \u30c6\u30b9\u30c8\u4e8b\u4f8b\u3092test_raw\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\u3059\u308b\ntd import:auto --format tsv \\\n--error-records-handling abort \\\n--columns rowid,i1,i2,i3,i4,i5,i6,i7,i8,i9,i10,i11,i12,i13,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26 \\\n--column-types long,int,int,int,int,int,int,int,int,int,int,int,int,int,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string,string \\\n--time-value `date +%s` --auto-create criteo.test_raw test2.txt\n```\n\n# Feature Engineering\n\n## \u30c7\u30fc\u30bf\u306e\u6b63\u898f\u5316\u306e\u305f\u3081\u306e\u7d71\u8a08\u5024\u306e\u7b97\u51fa\n\n\u91cf\u7684\u5909\u6570\u306b\u3064\u3044\u3066\u3001[Min-Max\u6b63\u898f\u5316](https://en.wikipedia.org/wiki/Feature_scaling#Rescaling)\u3092\u4f7f\u3063\u305frescaling\u3092\u884c\u3046\u305f\u3081\u306b\u3001i1-i13\u306b\u3064\u3044\u3066min/max\u5024\u3092\u7b97\u51fa\u3057\u307e\u3059[^1]\u3002\n\n[^1]: \u3053\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3060\u3068[zscore](https://github.com/myui/hivemall/wiki/Feature-scaling#feature-scaling-by-zscore)\u3092\u4f7f\u3063\u305f\u65b9\u304c\u7cbe\u5ea6\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4eca\u56de\u306f\u8a66\u3057\u3066\u307e\u305b\u3093\u3002\n\n\u4eca\u56de\u306f\u8a13\u7df4\u30c7\u30fc\u30bf\u3068\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u5168\u4f53\u306emin/max\u5024\u3092\u4f7f\u3044\u307e\u3059[^3]\u3002\n\n[^3]: i3\u306e-3\u3063\u3066\u7570\u5e38\u5024\u3067\u3057\u3087\u3046\u304b\uff08?)\u7cbe\u5ea6\u3092\u3042\u3052\u308b\u305f\u3081\u306b\u306f\u9664\u5916\u3059\u308b\u306a\u3069\u306e\u5bfe\u5fdc\u3082\u8981\u691c\u8a0e\u3067\u3059\u3002\u30b3\u30f3\u30da\u306eforum\u306e\u8b70\u8ad6\u3092\u63a2\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```sql\ntd query -w --type presto -d criteo \"\nselect\n  min(min1) as min1, max(max1) as max1,\n  min(min2) as min2, max(max2) as max2,\n  min(min3) as min3, max(max3) as max3,\n  min(min4) as min4, max(max4) as max4,\n  min(min5) as min5, max(max5) as max5,\n  min(min6) as min6, max(max6) as max6,\n  min(min7) as min7, max(max7) as max7,\n  min(min8) as min8, max(max8) as max8,\n  min(min9) as min9, max(max9) as max9,\n  min(min10) as min10, max(max10) as max10,\n  min(min11) as min11, max(max11) as max11,\n  min(min12) as min12, max(max12) as max12,\n  min(min13) as min13, max(max13) as max13\nfrom (\n  select\n    min(i1) as min1, max(i1) as max1,\n    min(i2) as min2, max(i2) as max2,\n    min(i3) as min3, max(i3) as max3,\n    min(i4) as min4, max(i4) as max4,\n    min(i5) as min5, max(i5) as max5,\n    min(i6) as min6, max(i6) as max6,\n    min(i7) as min7, max(i7) as max7,\n    min(i8) as min8, max(i8) as max8,\n    min(i9) as min9, max(i9) as max9,\n    min(i10) as min10, max(i10) as max10,\n    min(i11) as min11, max(i11) as max11,\n    min(i12) as min12, max(i12) as max12,\n    min(i13) as min13, max(i13) as max13\n  from\n    train_raw\n  union all\n  select\n    min(i1) as min1, max(i1) as max1,\n    min(i2) as min2, max(i2) as max2,\n    min(i3) as min3, max(i3) as max3,\n    min(i4) as min4, max(i4) as max4,\n    min(i5) as min5, max(i5) as max5,\n    min(i6) as min6, max(i6) as max6,\n    min(i7) as min7, max(i7) as max7,\n    min(i8) as min8, max(i8) as max8,\n    min(i9) as min9, max(i9) as max9,\n    min(i10) as min10, max(i10) as max10,\n    min(i11) as min11, max(i11) as max11,\n    min(i12) as min12, max(i12) as max12,\n    min(i13) as min13, max(i13) as max13\n  from\n    test_raw\n) t\n\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| min1 | max1 | min2 | max2   | min3 | max3  | min4 | max4 | min5 | max5     | min6 | max6   | min7 | max7  | min8 | max8 | min9 | max9  | min10 | max10 | min11 | max11 | min12 | max12 | min13 | max13 |\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n| 0    | 5775 | -3   | 257675 | 0    | 65535 | 0    | 969  | 0    | 23159456 | 0    | 431037 | 0    | 56311 | 0    | 6184 | 0    | 29019 | 0     | 11    | 0     | 231   | 0     | 4008  | 0     | 7393  |\n+------+------+------+--------+------+-------+------+------+------+----------+------+--------+------+-------+------+------+------+-------+-------+-------+-------+-------+-------+-------+-------+-------+\n```\n\n## Feature Scaling\n\n\u307e\u305a\u3001Hivemall\u306e\u8a13\u7df4\u7528\u306e\u30c6\u30fc\u30d6\u30eb`train`\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n`quantitative_features`\u95a2\u6570\u306f\u91cf\u7684\u5909\u6570\u3092\u4f5c\u308bUDF\u3001`categorical_features`\u95a2\u6570\u306f\u8cea\u7684\u5909\u6570\u3092\u4f5c\u308bUDF\u3067\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u3001\u91cf\u7684\u5909\u6570\u306b\u3064\u3044\u3066`rescale`\u95a2\u6570\u3067min-max\u6b63\u898f\u5316\u3092\u884c\u3044\u307e\u3059\u3002array('bias')\u306f[\u7dda\u5f62\u56de\u5e30\u306e\u5207\u7247](https://github.com/myui/hivemall/wiki/Using-explicit-addBias()-for-a-better-prediction)\u3092\u4ed8\u4e0e\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\n```sql\ntd table:create criteo train\n\ntd query -w --type hive -d criteo \"\nINSERT OVERWRITE TABLE train\nselect\n  rowid, \n  concat_array(\n    array('bias'),\n    quantitative_features(\n      array('i1','i2','i3','i4','i5','i6','i7','i8','i9','i10','i11','i12','i13'),\n      rescale(i1, 0, 5775),\n      rescale(i2, -3, 257675),\n      rescale(i3, 0, 65535),\n      rescale(i4, 0, 969),\n      rescale(i5, 0, 23159456),\n      rescale(i6, 0, 431037),\n      rescale(i7, 0, 56311),\n      rescale(i8, 0, 6184),\n      rescale(i9, 0, 29019),\n      rescale(i10, 0, 11),\n      rescale(i11, 0, 231),\n      rescale(i12, 0, 4008),\n      rescale(i13, 0, 7393)\n    ),\n    categorical_features(\n      array('c1','c2','c3','c4','c5','c6','c7','c8','c9','c10','c11','c12','c13','c14','c15','c16','c17','c18','c19','c20','c21','c22','c23','c24','c25','c26'),\n      c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26\n    )\n  ) as features,\n  label\nfrom \n  train_raw\n\"\n```\n\n\u4e0a\u306e\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3068`train`\u30c6\u30fc\u30d6\u30eb\u306f\u6b21\u306e\u3088\u3046\u306a\u5f62\u3068\u306a\u308a\u307e\u3059[^2]\u3002\n\n[^2]: Hivemall\u306e\u7279\u5fb4\u91cf\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3064\u3044\u3066\u306f\u3001LibSVM\u3084Vowpal Wabbit\u306b\u6e96\u3058\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f[\u3053\u306e\u30da\u30fc\u30b8](https://github.com/myui/hivemall/wiki/Input-Format-for-classification-and-regression)\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n```sql\ntd query -w --type presto -d criteo \"\nselect rowid, features, label from train limit 5\n\"\n\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n| rowid    | features                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | label |\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n| 38141107 | [\"bias\",\"i2:1.552325011289213E-5\",\"i5:2.522943541407585E-4\",\"i6:6.495961861219257E-5\",\"i7:3.551703775883652E-5\",\"i8:6.468305364251137E-4\",\"i9:4.8244252684526145E-4\",\"i11:0.008658008649945259\",\"i13:4.057892656419426E-4\",\"c1#241546e0\",\"c2#ae46a29d\",\"c3#c56edf2f\",\"c4#f922efad\",\"c5#4cf72387\",\"c6#fe6b92e5\",\"c7#6362d73a\",\"c8#0b153874\",\"c9#a73ee510\",\"c10#4b28ae0c\",\"c11#ba0f9e8a\",\"c12#66a76a26\",\"c13#4e4dd817\",\"c14#1adce6ef\",\"c15#8ff4b403\",\"c16#01adbab4\",\"c17#e5ba7672\",\"c18#26b3c7a7\",\"c21#21c9516a\",\"c22#ad3062eb\",\"c23#bcdee96c\",\"c24#b34f3128\"]                                                                                                                 | 1     |\n| 38141108 | [\"bias\",\"i1:1.7316016601398587E-4\",\"i2:3.609155537560582E-4\",\"i4:0.0020639835856854916\",\"i5:8.981212886283174E-6\",\"i6:6.959959137020633E-6\",\"i7:3.551703775883652E-5\",\"i8:6.468305364251137E-4\",\"i9:3.4460180904716253E-4\",\"i10:0.09090909361839294\",\"i11:0.008658008649945259\",\"i13:2.7052618679590523E-4\",\"c1#05db9164\",\"c2#09e68b86\",\"c3#1637edfd\",\"c4#b0ed6de7\",\"c5#25c83c98\",\"c7#90cedade\",\"c8#985e3fcb\",\"c9#a73ee510\",\"c10#2e834f9a\",\"c11#c17b047a\",\"c12#0e52e7ba\",\"c13#2e7b87f1\",\"c14#64c94865\",\"c15#91126f30\",\"c16#7804892a\",\"c17#07c540c4\",\"c18#5aed7436\",\"c19#d9aa05dc\",\"c20#5840adea\",\"c21#92791411\",\"c23#32c7478e\",\"c24#1793a828\",\"c25#e8b83407\",\"c26#fa3124de\"] | 1     |\n| 38141109 | [\"bias\",\"i2:2.4837200180627406E-4\",\"i3:3.051804378628731E-5\",\"i4:0.02270381897687912\",\"i5:1.611004990991205E-4\",\"i6:1.9023889035452157E-4\",\"i7:2.663777850102633E-4\",\"i8:0.004204398486763239\",\"i9:0.015920603647828102\",\"i11:0.05627705529332161\",\"i13:0.002975787967443466\",\"c1#05db9164\",\"c2#8084ee93\",\"c3#02cf9876\",\"c4#c18be181\",\"c5#4cf72387\",\"c6#13718bbd\",\"c7#5e64ce5f\",\"c8#0b153874\",\"c9#a73ee510\",\"c10#9de7c14e\",\"c11#8b94178b\",\"c12#8fe001f4\",\"c13#025225f2\",\"c14#b28479f6\",\"c15#b2ff8c6b\",\"c16#36103458\",\"c17#e5ba7672\",\"c18#52e44668\",\"c21#e587c466\",\"c23#32c7478e\",\"c24#3b183c5c\"]                                                                             | 0     |\n| 38141110 | [\"bias\",\"i2:1.1642437129921746E-5\",\"i3:7.019150070846081E-4\",\"i4:0.0010319917928427458\",\"i5:0.002615907695144415\",\"i8:4.8512290231883526E-4\",\"i9:3.446017944952473E-5\",\"i13:4.057892656419426E-4\",\"c1#68fd1e64\",\"c2#287130e0\",\"c3#257f29b7\",\"c4#89526cd2\",\"c5#0942e0a7\",\"c6#fbad5c96\",\"c7#9115f277\",\"c8#f504a6f4\",\"c9#7cc72ec2\",\"c10#5612701e\",\"c11#1d125cbb\",\"c12#921c8174\",\"c13#7f9db67d\",\"c14#1adce6ef\",\"c15#310d155b\",\"c16#7cccf7ff\",\"c17#e5ba7672\",\"c18#891589e7\",\"c19#9653bb65\",\"c20#a458ea53\",\"c21#af4ea70d\",\"c22#ad3062eb\",\"c23#3a171ecb\",\"c24#17b5e269\",\"c25#e8b83407\",\"c26#98aebbef\"]                                                                              | 0     |\n| 38141111 | [\"bias\",\"i2:7.916857721284032E-4\",\"i3:3.051804378628731E-5\",\"i4:0.0010319917928427458\",\"i5:2.1792393818031996E-4\",\"i6:1.4383916277438402E-4\",\"i7:1.775851887941826E-5\",\"i8:3.2341526821255684E-4\",\"i9:0.0011027257423847914\",\"i11:0.0043290043249726295\",\"i13:1.3526309339795262E-4\",\"c1#68fd1e64\",\"c2#2c8c5f5d\",\"c3#13cd0697\",\"c4#352cefe6\",\"c5#25c83c98\",\"c6#fe6b92e5\",\"c7#aa0d873c\",\"c8#c8ddd494\",\"c9#a73ee510\",\"c10#3b08e48b\",\"c11#6a447eb3\",\"c12#c3cdaf85\",\"c13#9dfda2b9\",\"c14#1adce6ef\",\"c15#5edc1a28\",\"c16#08514295\",\"c17#d4bb7bd8\",\"c18#f5f4ae5b\",\"c21#6387fda4\",\"c23#3a171ecb\",\"c24#d36c7dbf\"]                                                                      | 0     |\n+----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+\n\n```\n\n\u540c\u69d8\u306b\u30c6\u30b9\u30c8\u7528\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sql\ntd table:create criteo test\n\ntd query -w --type hive -d criteo \"\nINSERT OVERWRITE TABLE test\nselect\n  rowid, \n  concat_array(\n    array('bias'),\n    quantitative_features(\n      array('i1','i2','i3','i4','i5','i6','i7','i8','i9','i10','i11','i12','i13'),\n      rescale(i1, 0, 5775),\n      rescale(i2, -3, 257675),\n      rescale(i3, 0, 65535),\n      rescale(i4, 0, 969),\n      rescale(i5, 0, 23159456),\n      rescale(i6, 0, 431037),\n      rescale(i7, 0, 56311),\n      rescale(i8, 0, 6184),\n      rescale(i9, 0, 29019),\n      rescale(i10, 0, 11),\n      rescale(i11, 0, 231),\n      rescale(i12, 0, 4008),\n      rescale(i13, 0, 7393)\n    ),\n    categorical_features(\n      array('c1','c2','c3','c4','c5','c6','c7','c8','c9','c10','c11','c12','c13','c14','c15','c16','c17','c18','c19','c20','c21','c22','c23','c24','c25','c26'),\n      c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11,c12,c13,c14,c15,c16,c17,c18,c19,c20,c21,c22,c23,c24,c25,c26\n    )\n  ) as features\nfrom\n  test_raw\n\"\n```\n\n# \u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306b\u3088\u308b\u5b66\u7fd2\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\n\n`logress_model`\u30c6\u30fc\u30d6\u30eb\u306b\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u4f7f\u3063\u305f\u5b66\u7fd2\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\nWITH\u53e5\u306e`train_x3`\u3067\u306f\u3001\u7e70\u308a\u8fd4\u3057\u5b66\u7fd2\u3092\u6a21\u64ec\u3059\u308b\u305f\u3081\u306b\u3001amplify\u95a2\u6570\u3067\u8a13\u7df4\u4e8b\u4f8b\u30923\u500d\u306b\u5897\u5e45\u3057\u305f\u4e0a\u3067`CLUSTER BY rand(1)`\u3067\u30b7\u30e3\u30c3\u30d5\u30eb\u3057\u3066\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u5b66\u7fd2\u306e\u5165\u529b\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n```sql\ntd table:create criteo logress_model\ntd query -w -x --type hive -d criteo \"\nWITH train_x3 as (\n  select\n    features, label\n  from (\n    select \n      amplify(3, features, label) as (features, label)\n    from \n      train\n  ) t\n  CLUSTER BY rand(1)\n)\nINSERT OVERWRITE TABLE logress_model \nselect\n  feature,\n  avg(weight) as weight\nfrom (\n  select \n    logress(features, label) as (feature, weight)\n  from\n    train_x3\n) t\ngroup by feature;\n\"\n```\n\n# \u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306e\u4e88\u6e2c\u30e2\u30c7\u30eb\u3092\u5229\u7528\u3057\u3066\u30af\u30ea\u30c3\u30af\u78ba\u7387\u3092\u4e88\u6e2c\n\n```sql\ntd query -w --type hive -d criteo -f csv --column-header -o logress_predict.csv \"\nWITH test_exploded as (\nselect \n  rowid,\n  extract_feature(fv) as feature,\n  extract_weight(fv) as value\nfrom\n  test t1 LATERAL VIEW explode(features) t2 as fv\n)\nselect\n  t.rowid as Id,\n  sigmoid(sum(m.weight * t.value)) as Predicted\nfrom \n  test_exploded t\n  LEFT OUTER JOIN logress_model m ON (t.feature = m.feature)\ngroup by\n  t.rowid\n\"\n```\n\n# Kaggle\u3078\u306esubmit\n\n`logress_predict.csv`\u3092kaggle\u306bsubmit\u3057\u307e\u3059\u3068\u3001Beseline\u3088\u308a\u3061\u3087\u3063\u3068\u826f\u3044\u30b9\u30b3\u30a2\u304c\u51fa\u307e\u3057\u305f\u3002\n\n|  |Public Leader board  |Private Leader board   |\n|---|---|---|\n|Baseline(VW)  |0.48427  |0.48396  |\n|Hivemall  |0.48253  |0.48229  |\n\n# \u3055\u3044\u3054\u306b\n\n\u4eca\u56de\u306f\u57fa\u672c\u7684\u306a\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3067CTR prediction\u3092\u884c\u3046\u4f8b\u3092\u51fa\u3057\u307e\u3057\u305f\u3002\n\nv0.4\u306e\u65b0\u6a5f\u80fd\u306eFactorization Machines\u306e\u8a18\u4e8b\u3092\u66f8\u3053\u3046\u3068\u601d\u3063\u3066\u307e\u3057\u305f\u304c\u3001Factorization Machines\u3067\u306f\u306a\u305c\u304b\u7cbe\u5ea6\u304c\u3044\u307e\u3044\u3061\u3067\u3057\u305f\u306e\u3067\u3001\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u306bfallback\u3057\u307e\u3057\u305f...orz\n\n\u30b3\u30f3\u30da\u306eforum\u3084\u3092\u307f\u308b\u3068feature pairing\u304c\u6709\u52b9\u306a\u3088\u3046[^4]\u306a\u306e\u3067\u3001\u7cbe\u5ea6\u3092\u4e0a\u3052\u308b\u305f\u3081\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3068\u3057\u3066\u306f\u9ad8\u6b21\u7279\u5fb4\u91cf\u3092\u4f5c\u3063\u3066\u307f\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002Hivemall\u3067feature pairing\u3092\u884c\u3046\u4f8b\u306f[\u3053\u3053](https://github.com/myui/hivemall/wiki/Polynomial-Features)\u3092\u53c2\u8003\u306b\u3069\u3046\u305e\u3002\n\n[^4]: https://github.com/swapniel99/criteo \u8a13\u7df4\u4e8b\u4f8b\u6570\u304c\u305d\u308c\u306a\u308a\u306b\u3042\u308b\u306e\u3067\u3001\u52fe\u914d\u306e\u6700\u9069\u5316\u306eadaXXX\u306f\u3044\u3046\u307b\u3069\u52b9\u304b\u306a\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u304c\u8a66\u3057\u3066\u3044\u307e\u305b\u3093\u3002Hivemall\u306b\u3082[adagrad+logistic loss](https://github.com/myui/hivemall/wiki/news20-binary-classification-AdaGradRDA-AdaGrad-AdaDelta)\u306f\u4f7f\u3048\u307e\u3059\u3002\n", "tags": ["hadoop,", "\u6a5f\u68b0\u5b66\u7fd2,", "hive,", "TreasureData,", "Kaggle"]}