{"context": " More than 1 year has passed since last update.\n\n\u8ffd\u8a18 (2016/01/11)\n\u73fe\u5728\u306e mruby \u306e master \u306e\u6319\u52d5\u304c\u3053\u3053\u3067\u66f8\u3044\u3066\u3044\u308b\u5bfe\u7b56\u304c\u5fc5\u8981\u306a\u3044\u3088\u3046\u306a\u52d5\u4f5c\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\n\u3053\u306e\u8a18\u4e8b\u306b\u66f8\u3044\u3066\u3042\u308b\u69d8\u306a\u3053\u3068\u3092\u3059\u308b\u5fc5\u8981\u306f\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u672c\u6587\nmruby \u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\ndef g\n  raise \"test\"\nend\n\ndef f\n  begin\n    g\n  rescue => e\n    raise e\n  end\nend\n\nbegin\n  f\nrescue => e\n  puts \"e.backtrace\"\n  puts \"#{e.backtrace.map{|v| \"  \" + v}.join(\"\\n\")}\"\nend\n\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\ne.backtrace\n  exception_default.rb:18\n\n\nbacktrace \u3092\u51fa\u529b\u3059\u308b\u3068\u3053\u308d\u306e rescue \u7bc0\u306e\u4e2d\u3092\u6307\u3057\u793a\u3057\u3066\u3044\u307e\u3059\u3002\nruby\u3060\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\ne.backtrace\n  exception_default.rb:3:in `g'\n  exception_default.rb:8:in `f'\n  exception_default.rb:15:in `<main>'\n\n\u4ee5\u4e0b\u3092\u898b\u308b\u3068\u73fe\u72b6\u306e mruby \u306e\u6319\u52d5\u306e\u3088\u3046\u3067\u3059\u3002\nhttps://github.com/mruby/mruby/issues/1661\nhttp://qiita.com/seanchas_t/items/ca293f9dd4454cd6cb6d\n\u30c7\u30d0\u30c3\u30b0\u6642\u306a\u3069\u306f ruby \u306e\u6319\u52d5\u306e\u307b\u3046\u304c\n\u4f8b\u5916\u304c\u8d77\u3053\u3063\u305f\u5834\u6240\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\nmruby\u672c\u4f53\u306f\u66f8\u304d\u63db\u3048\u305a\u306bruby\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\n\u51fa\u6765\u308b\u65b9\u6cd5\u3092\u8003\u3048\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\nmruby \u3067\u306e backtrace \u304c ruby \u3068\u540c\u3058\u3088\u3046\u306a\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\nclass Exception\n\n  alias_method :old_initialize, :initialize \n  alias_method :old_backtrace, :backtrace \n\n  @@initializing = false\n  @@current_backtrace = nil\n\n  def initialize(*args)\n    old_initialize(*args)\n\n    unless @@initializing\n      # not thread safe\n      @@initializing = true\n      begin\n        raise \"\"\n      rescue => e\n        @stored_backtrace = e.backtrace[2..-1]\n      end\n      @@initializing = false\n    else\n\n    end\n  end\n\n  def backtrace\n    if @stored_backtrace\n      @stored_backtrace\n    else\n      self.old_backtrace\n    end\n  end\nend\n\n\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u306e\u5148\u982d\u306b\u3053\u306e\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3059\u308b\u3068\u3001mruby\u3067\u306e\u51fa\u529b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\ne.backtrace\n  exception_better_backtrace.rb:37:in Object.g\n  exception_better_backtrace.rb:42:in Object.f\n  exception_better_backtrace.rb:49\n\n\u30b3\u30fc\u30c9\u53ca\u3073\u78ba\u8a8d\u7528\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u304a\u3044\u3066\u3042\u308a\u307e\u3059\u3002\nhttps://github.com/dycoon/mruby_better_backtrace_snipet\n\n\u8ffd\u8a18 (2015/11/29)\nmrbgems \u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nhttps://github.com/dycoon/mruby-ruby-like-backtrace\n## \u8ffd\u8a18 (2016/01/11)\n\n\u73fe\u5728\u306e [mruby](https://github.com/mruby/mruby) \u306e master \u306e\u6319\u52d5\u304c\u3053\u3053\u3067\u66f8\u3044\u3066\u3044\u308b\u5bfe\u7b56\u304c\u5fc5\u8981\u306a\u3044\u3088\u3046\u306a\u52d5\u4f5c\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\n\u3053\u306e\u8a18\u4e8b\u306b\u66f8\u3044\u3066\u3042\u308b\u69d8\u306a\u3053\u3068\u3092\u3059\u308b\u5fc5\u8981\u306f\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u672c\u6587\n\nmruby \u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\n\n```ruby\ndef g\n  raise \"test\"\nend\n\ndef f\n  begin\n    g\n  rescue => e\n    raise e\n  end\nend\n\nbegin\n  f\nrescue => e\n  puts \"e.backtrace\"\n  puts \"#{e.backtrace.map{|v| \"  \" + v}.join(\"\\n\")}\"\nend\n\n\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```\ne.backtrace\n  exception_default.rb:18\n\n```\n\nbacktrace \u3092\u51fa\u529b\u3059\u308b\u3068\u3053\u308d\u306e rescue \u7bc0\u306e\u4e2d\u3092\u6307\u3057\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\nruby\u3060\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```\ne.backtrace\n  exception_default.rb:3:in `g'\n  exception_default.rb:8:in `f'\n  exception_default.rb:15:in `<main>'\n```\n\n\u4ee5\u4e0b\u3092\u898b\u308b\u3068\u73fe\u72b6\u306e mruby \u306e\u6319\u52d5\u306e\u3088\u3046\u3067\u3059\u3002\n\nhttps://github.com/mruby/mruby/issues/1661\nhttp://qiita.com/seanchas_t/items/ca293f9dd4454cd6cb6d\n\n\u30c7\u30d0\u30c3\u30b0\u6642\u306a\u3069\u306f ruby \u306e\u6319\u52d5\u306e\u307b\u3046\u304c\n\u4f8b\u5916\u304c\u8d77\u3053\u3063\u305f\u5834\u6240\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u306e\u3067\nmruby\u672c\u4f53\u306f\u66f8\u304d\u63db\u3048\u305a\u306bruby\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\n\u51fa\u6765\u308b\u65b9\u6cd5\u3092\u8003\u3048\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\nmruby \u3067\u306e backtrace \u304c ruby \u3068\u540c\u3058\u3088\u3046\u306a\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\n\n```ruby\nclass Exception\n   \n  alias_method :old_initialize, :initialize \n  alias_method :old_backtrace, :backtrace \n  \n  @@initializing = false\n  @@current_backtrace = nil\n  \n  def initialize(*args)\n    old_initialize(*args)\n    \n    unless @@initializing\n      # not thread safe\n      @@initializing = true\n      begin\n        raise \"\"\n      rescue => e\n        @stored_backtrace = e.backtrace[2..-1]\n      end\n      @@initializing = false\n    else\n      \n    end\n  end\n  \n  def backtrace\n    if @stored_backtrace\n      @stored_backtrace\n    else\n      self.old_backtrace\n    end\n  end\nend\n```\n\n\n\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u306e\u5148\u982d\u306b\u3053\u306e\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3059\u308b\u3068\u3001mruby\u3067\u306e\u51fa\u529b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\ne.backtrace\n  exception_better_backtrace.rb:37:in Object.g\n  exception_better_backtrace.rb:42:in Object.f\n  exception_better_backtrace.rb:49\n```\n\n\u30b3\u30fc\u30c9\u53ca\u3073\u78ba\u8a8d\u7528\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u304a\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\nhttps://github.com/dycoon/mruby_better_backtrace_snipet\n\n## \u8ffd\u8a18 (2015/11/29)\n\nmrbgems \u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nhttps://github.com/dycoon/mruby-ruby-like-backtrace\n", "tags": ["mruby"]}