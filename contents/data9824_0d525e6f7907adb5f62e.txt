{"context": " More than 1 year has passed since last update.PRML 8.3.3\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u30ce\u30a4\u30ba\u3092\u542b\u3080\u89b3\u6e2c\u753b\u50cf\u3092y\u3001\u672a\u77e5\u306e\u5143\u306e\u753b\u50cf\u3092x\u3068\u3059\u308b\u30de\u30eb\u30b3\u30d5\u78ba\u7387\u5834\u306b\u304a\u3044\u3066\u3001\u53cd\u5fa9\u6761\u4ef6\u4ed8\u304d\u30e2\u30fc\u30c9(ICM)\u306b\u3088\u3063\u3066\u3001y\u304c\u4e0e\u3048\u3089\u308c\u305f\u3068\u304dp(x|y)\u3092\u6975\u5927\u5316\u3059\u308bx\u3092\u6c42\u3081\u307e\u3059\u3002\u56f38.30\u3068\u540c\u69d8\u306b\u3001\u5143\u306e\u753b\u50cf\u3001\u30ce\u30a4\u30ba\u3092\u542b\u3080\u753b\u50cf\u3001ICM\u306b\u3088\u3063\u3066\u5fa9\u5143\u3055\u308c\u305f\u753b\u50cf\u3068\u30d4\u30af\u30bb\u30eb\u306e\u5fa9\u5143\u7387\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\nlibrary(biOps)\nframe()\nset.seed(0)\npar(mfcol=c(2, 3))\npar(mar=c(0, 0, 1, 0))\ndata(logo)\nsource <- imagedata(logo[,,3])\nNI <- nrow(source)\nNJ <- ncol(source)\ns <- ifelse(source < 128, -1, 1)\nplot(imagedata((s + 1) / 2 * 255))\ntitle(\"source\", cex.main=1.0)\n\n# add noise\ny <- s * ((runif(length(s)) > 0.1) * 2 - 1)\nplot(imagedata((y + 1) / 2 * 255))\ntitle(\"y\", cex.main=1.0)\n\ndoplot <- function(beta, eta, h) {\n    x <- y\n    repeat {\n        energyDiff <- 0\n        for (i in (1:NI)) {\n            for (j in (1:NJ)) {\n                energy <- function(xx) {\n                    result <- h * xx\n                    if (i > 1) {\n                        result <- result - beta * xx * x[i - 1,j]\n                    }\n                    if (i < NI) {\n                        result <- result - beta * xx * x[i + 1,j]\n                    }\n                    if (j > 1) {\n                        result <- result - beta * xx * x[i,j - 1]\n                    }\n                    if (j < NJ) {\n                        result <- result - beta * xx * x[i,j + 1]\n                    }\n                    result <- result - eta * xx * y[i,j]\n                    result\n                }\n                values <- c(x[i,j], x[i,j] * -1)\n                energies <- energy(values)\n                minEnergyIndex <- which(energies == min(energies))\n                x[i,j] <- values[minEnergyIndex]\n                energyDiff <- energyDiff + energies[minEnergyIndex] - energies[1]\n            }\n        }\n        cat(\"difference of total energy\");print(energyDiff)\n        if (energyDiff == 0) {\n            break\n        }\n    }\n    restored = round(sum(s == x) / length(x) * 100, 1)\n    plot(imagedata((x + 1) / 2 * 255))\n    title(paste0(\"x (beta=\", beta, \" eta=\", eta, \" h=\", h, \") \", restored, \"%\"), cex.main=1.0)\n}\n\ndoplot(1.0, 2.1, 0)\ndoplot(1.0, 2.1, 1.5)\ndoplot(1.0, 2.1, -1.5)\ndoplot(5.0, 2.1, -1.5)\n\nPRML 8.3.3\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u30ce\u30a4\u30ba\u3092\u542b\u3080\u89b3\u6e2c\u753b\u50cf\u3092y\u3001\u672a\u77e5\u306e\u5143\u306e\u753b\u50cf\u3092x\u3068\u3059\u308b\u30de\u30eb\u30b3\u30d5\u78ba\u7387\u5834\u306b\u304a\u3044\u3066\u3001\u53cd\u5fa9\u6761\u4ef6\u4ed8\u304d\u30e2\u30fc\u30c9(ICM)\u306b\u3088\u3063\u3066\u3001y\u304c\u4e0e\u3048\u3089\u308c\u305f\u3068\u304dp(x|y)\u3092\u6975\u5927\u5316\u3059\u308bx\u3092\u6c42\u3081\u307e\u3059\u3002\u56f38.30\u3068\u540c\u69d8\u306b\u3001\u5143\u306e\u753b\u50cf\u3001\u30ce\u30a4\u30ba\u3092\u542b\u3080\u753b\u50cf\u3001ICM\u306b\u3088\u3063\u3066\u5fa9\u5143\u3055\u308c\u305f\u753b\u50cf\u3068\u30d4\u30af\u30bb\u30eb\u306e\u5fa9\u5143\u7387\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n![](https://dl.dropbox.com/sh/cwfemibvr7gk4cy/kblOcNuhPm/16.IteratedConditionalModes.png)\n\n```r\nlibrary(biOps)\nframe()\nset.seed(0)\npar(mfcol=c(2, 3))\npar(mar=c(0, 0, 1, 0))\ndata(logo)\nsource <- imagedata(logo[,,3])\nNI <- nrow(source)\nNJ <- ncol(source)\ns <- ifelse(source < 128, -1, 1)\nplot(imagedata((s + 1) / 2 * 255))\ntitle(\"source\", cex.main=1.0)\n\n# add noise\ny <- s * ((runif(length(s)) > 0.1) * 2 - 1)\nplot(imagedata((y + 1) / 2 * 255))\ntitle(\"y\", cex.main=1.0)\n\ndoplot <- function(beta, eta, h) {\n\tx <- y\n\trepeat {\n\t\tenergyDiff <- 0\n\t\tfor (i in (1:NI)) {\n\t\t\tfor (j in (1:NJ)) {\n\t\t\t\tenergy <- function(xx) {\n\t\t\t\t\tresult <- h * xx\n\t\t\t\t\tif (i > 1) {\n\t\t\t\t\t\tresult <- result - beta * xx * x[i - 1,j]\n\t\t\t\t\t}\n\t\t\t\t\tif (i < NI) {\n\t\t\t\t\t\tresult <- result - beta * xx * x[i + 1,j]\n\t\t\t\t\t}\n\t\t\t\t\tif (j > 1) {\n\t\t\t\t\t\tresult <- result - beta * xx * x[i,j - 1]\n\t\t\t\t\t}\n\t\t\t\t\tif (j < NJ) {\n\t\t\t\t\t\tresult <- result - beta * xx * x[i,j + 1]\n\t\t\t\t\t}\n\t\t\t\t\tresult <- result - eta * xx * y[i,j]\n\t\t\t\t\tresult\n\t\t\t\t}\n\t\t\t\tvalues <- c(x[i,j], x[i,j] * -1)\n\t\t\t\tenergies <- energy(values)\n\t\t\t\tminEnergyIndex <- which(energies == min(energies))\n\t\t\t\tx[i,j] <- values[minEnergyIndex]\n\t\t\t\tenergyDiff <- energyDiff + energies[minEnergyIndex] - energies[1]\n\t\t\t}\n\t\t}\n\t\tcat(\"difference of total energy\");print(energyDiff)\n\t\tif (energyDiff == 0) {\n\t\t\tbreak\n\t\t}\n\t}\n\trestored = round(sum(s == x) / length(x) * 100, 1)\n\tplot(imagedata((x + 1) / 2 * 255))\n\ttitle(paste0(\"x (beta=\", beta, \" eta=\", eta, \" h=\", h, \") \", restored, \"%\"), cex.main=1.0)\n}\n\ndoplot(1.0, 2.1, 0)\ndoplot(1.0, 2.1, 1.5)\ndoplot(1.0, 2.1, -1.5)\ndoplot(5.0, 2.1, -1.5)\n```\n", "tags": ["R", "PRML"]}