{"context": "Laravel Passport \u306e CreateFreshApiToken \u3068\u3044\u3046\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u4f7f\u3046\u3068\u3001OAuth2 \u3067 API \u3092\u516c\u958b\u3057\u3064\u3064\u3001\u81ea\u30b5\u30a4\u30c8\u3067\u3082\u540c\u3058 API \u3067\u30a2\u30d7\u30ea\u304c\u4f5c\u308c\u307e\u3059\u304c\u3001MultiAuth \u3067\u306e\u4f7f\u3044\u65b9\u3092\u9593\u9055\u3048\u308b\u3068\u6b7b\u306b\u305d\u3046\u306a\u306e\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\u554f\u984c\u70b9\nConsuming Your API With JavaScript \u306b\u306f web \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3059\u308b\u5f62\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u3092\u305d\u306e\u307e\u307e MultiAuth \u3067\u3084\u308b\u3068\u305f\u3076\u3093\u6b7b\u306b\u307e\u3059\u3002\n\nTypically, if you want to consume your API from your JavaScript application, you would need to manually send an access token to the application and pass it with each request to your application. However, Passport includes a middleware that can handle this for you. All you need to do is add the  CreateFreshApiToken middleware to your web middleware group:\n\nKernel.php\n'web' => [\n    // Other middleware...\n    \\Laravel\\Passport\\Http\\Middleware\\CreateFreshApiToken::class,\n],\n\n\n\n\n\u3084\u3079\u3081\u306e\u30d5\u30ed\u30fc\n\n\u5f15\u6570\u306b\u306a\u306b\u3082\u6307\u5b9a\u305b\u305a CreateFreshApiToken \u3092\u8a2d\u5b9a\u3002\n\u9069\u5f53\u306a\u30ac\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u305f auth \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u901a\u308b\u3002\n\u8a8d\u8a3c\u304c\u6210\u529f\u3059\u308b\u3068 shouldUse \u304c\u547c\u3070\u308c config('auth.defaults.guard') \u304c 2.\u306e\u30ac\u30fc\u30c9\u306b\u4e0a\u66f8\u304d\u3055\u308c\u308b\u3002 #1 #2\n$request->user(null) \u304c\u547c\u3070\u308c\u308b\u3002(\u5f15\u6570\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u305f\u3081 $guard == null \u3068\u306a\u3063\u3066\u3044\u308b) #\n\u3044\u308d\u3044\u308d\u3042\u3063\u3066\nAuthManager.php \u306e guard \u306b 4. \u306e null \u304c\u6e21\u308b\u3002 #\n$name = $name ?: $this->getDefaultDriver() \u3067 $name == config('auth.defaults.guard') == 2.\u306e\u30ac\u30fc\u30c9 \u3068\u306a\u308b\u3002 #\n\u30ac\u30fc\u30c9\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u306e\u3067 2. \u3067\u4f7f\u3063\u305f SesisonGuard \u304c\u518d\u5229\u7528\u3055\u308c\u308b\u3002 #\nSessionGuard \u3067\u306f\u30ed\u30b0\u30a4\u30f3\u306b\u6210\u529f\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u306e\u3067 2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u304c CreateFreshApiToken \u307e\u3067\u623b\u3063\u3066\u304f\u308b\u3002 #1 #2\n2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e ID \u304c JWT \u306b\u7d44\u307f\u8fbc\u307e\u308c\u3001\u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c cookie \u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b #1 #2\nauth\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3001driver \u304c passport \u306e\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u305f API \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fcID \u304c\u8a8d\u8a3c\u306b\u4f7f\u308f\u308c\u308b\u3002 #1 #2\n\n\u3053\u3053\u3067\u30012.\u306e\u30ac\u30fc\u30c9\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u3068\u3001Passport\u8a8d\u8a3c\u3092\u884c\u3046 11.\u306e\u30ac\u30fc\u30c9\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u304c\u9055\u3046\u5834\u5408\u3001\u6b7b\u3067\u3059\u3002\n\n\u5bfe\u7b56\ncookie \u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b JWT \u306b\u30ac\u30fc\u30c9\u540d\u3001\u578b\u60c5\u5831\u3001\u30e2\u30c7\u30eb\u540d\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u8f09\u3063\u3066\u306a\u3044\u306e\u3067\u3001CreateFreshApiToken \u304c\u5229\u7528\u3067\u304d\u308b\u30ac\u30fc\u30c9\u306f\u4e00\u7a2e\u985e\u306b\u9650\u5b9a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067 MutliAuth \u74b0\u5883\u3067 CreateFreshApiToken \u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u305d\u306e\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u307b\u304b\u306a\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u8ffd\u8a18(2016/11/24)\n\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3082\u7d50\u5c40 Passport \u3092\u5229\u7528\u3059\u308b\u5225\u306e\u30ac\u30fc\u30c9\u3092\u901a\u3063\u3066\u3057\u307e\u3046\u3068(\u4e0a\u306e\u30d5\u30ed\u30fc\u3067\u3044\u3046\u306811.)\u6b7b\u306a\u306e\u3067\u3001\u73fe\u72b6 MultiAuth \u74b0\u5883\u3067 CreateFreshApiToken \u3092\u5229\u7528\u3059\u308b\u306e\u306f\u7121\u7406\u30b2\u30fc\u306a\u6c17\u304c\u3057\u3066\u304d\u307e\u3057\u305f\u3002\u3002\u3002\n\n\u305d\u3082\u305d\u3082\u8ad6\n\u3053\u308c\u3063\u3066\u958b\u767a\u7528\u306b\u4f7f\u3046\u3082\u306e\u3067\u306f\u306a\u304b\u308d\u3046\u304b...\nLaravel Passport \u306e CreateFreshApiToken \u3068\u3044\u3046\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u4f7f\u3046\u3068\u3001OAuth2 \u3067 API \u3092\u516c\u958b\u3057\u3064\u3064\u3001\u81ea\u30b5\u30a4\u30c8\u3067\u3082\u540c\u3058 API \u3067\u30a2\u30d7\u30ea\u304c\u4f5c\u308c\u307e\u3059\u304c\u3001MultiAuth \u3067\u306e\u4f7f\u3044\u65b9\u3092\u9593\u9055\u3048\u308b\u3068\u6b7b\u306b\u305d\u3046\u306a\u306e\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\n# \u554f\u984c\u70b9\n[Consuming Your API With JavaScript](https://laravel.com/docs/5.3/passport#consuming-your-api-with-javascript) \u306b\u306f `web` \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3059\u308b\u5f62\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u3092\u305d\u306e\u307e\u307e MultiAuth \u3067\u3084\u308b\u3068\u305f\u3076\u3093\u6b7b\u306b\u307e\u3059\u3002\n>\nTypically, if you want to consume your API from your JavaScript application, you would need to manually send an access token to the application and pass it with each request to your application. However, Passport includes a middleware that can handle this for you. All you need to do is add the  CreateFreshApiToken middleware to your web middleware group:\n>\n```php:Kernel.php\n'web' => [\n    // Other middleware...\n    \\Laravel\\Passport\\Http\\Middleware\\CreateFreshApiToken::class,\n],\n```\n\n## \u3084\u3079\u3081\u306e\u30d5\u30ed\u30fc\n1. \u5f15\u6570\u306b\u306a\u306b\u3082\u6307\u5b9a\u305b\u305a `CreateFreshApiToken` \u3092\u8a2d\u5b9a\u3002\n2. \u9069\u5f53\u306a\u30ac\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u305f `auth` \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u901a\u308b\u3002\n3. \u8a8d\u8a3c\u304c\u6210\u529f\u3059\u308b\u3068 `shouldUse` \u304c\u547c\u3070\u308c `config('auth.defaults.guard')` \u304c 2.\u306e\u30ac\u30fc\u30c9\u306b\u4e0a\u66f8\u304d\u3055\u308c\u308b\u3002 [#1](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/Middleware/Authenticate.php#L62) [#2](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/AuthManager.php#L198)\n\n4. `$request->user(null)` \u304c\u547c\u3070\u308c\u308b\u3002(\u5f15\u6570\u3092\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u305f\u3081 `$guard == null` \u3068\u306a\u3063\u3066\u3044\u308b) [#](https://github.com/laravel/passport/blob/1.0/src/Http/Middleware/CreateFreshApiToken.php#L53)\n\n5. \u3044\u308d\u3044\u308d\u3042\u3063\u3066\n6. `AuthManager.php` \u306e `guard` \u306b 4. \u306e `null` \u304c\u6e21\u308b\u3002 [#](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/AuthManager.php#L64)\n\n7. `$name = $name ?: $this->getDefaultDriver()` \u3067 `$name == config('auth.defaults.guard') == 2.\u306e\u30ac\u30fc\u30c9` \u3068\u306a\u308b\u3002 [#](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/AuthManager.php#L66)\n8. \u30ac\u30fc\u30c9\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u306e\u3067 2. \u3067\u4f7f\u3063\u305f `SesisonGuard` \u304c\u518d\u5229\u7528\u3055\u308c\u308b\u3002 [#](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/AuthManager.php#L68-L70)\n9. `SessionGuard` \u3067\u306f\u30ed\u30b0\u30a4\u30f3\u306b\u6210\u529f\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u306e\u3067 2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u304c `CreateFreshApiToken` \u307e\u3067\u623b\u3063\u3066\u304f\u308b\u3002 [#1](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/SessionGuard.php#L120-L122) [#2](https://github.com/laravel/framework/blob/5.3/src/Illuminate/Auth/SessionGuard.php#L152)\n10. 2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e ID \u304c JWT \u306b\u7d44\u307f\u8fbc\u307e\u308c\u3001\u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c cookie \u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b [#1](https://github.com/laravel/passport/blob/1.0/src/Http/Middleware/CreateFreshApiToken.php#L52-L54) [#2](https://github.com/laravel/passport/blob/1.0/src/ApiTokenCookieFactory.php#L72-L79)\n11. auth\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3001`driver` \u304c `passport` \u306e\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u305f API \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n12. 2.\u3067\u8a8d\u8a3c\u3057\u305f\u30e6\u30fc\u30b6\u30fcID \u304c\u8a8d\u8a3c\u306b\u4f7f\u308f\u308c\u308b\u3002 [#1](https://github.com/laravel/passport/blob/1.0/src/Guards/TokenGuard.php#L159) [#2](https://github.com/laravel/passport/blob/1.0/src/Guards/TokenGuard.php#L175)\n\n\u3053\u3053\u3067\u30012.\u306e\u30ac\u30fc\u30c9\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u3068\u3001Passport\u8a8d\u8a3c\u3092\u884c\u3046 11.\u306e\u30ac\u30fc\u30c9\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u304c\u9055\u3046\u5834\u5408\u3001\u6b7b\u3067\u3059\u3002\n\n# \u5bfe\u7b56\ncookie \u306b\u66f8\u304d\u8fbc\u307e\u308c\u308b JWT \u306b\u30ac\u30fc\u30c9\u540d\u3001\u578b\u60c5\u5831\u3001\u30e2\u30c7\u30eb\u540d\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u8f09\u3063\u3066\u306a\u3044\u306e\u3067\u3001CreateFreshApiToken \u304c\u5229\u7528\u3067\u304d\u308b\u30ac\u30fc\u30c9\u306f\u4e00\u7a2e\u985e\u306b\u9650\u5b9a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067 MutliAuth \u74b0\u5883\u3067 CreateFreshApiToken \u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u305d\u306e\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u307b\u304b\u306a\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\n**\u8ffd\u8a18(2016/11/24)**\n\u30ac\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3082\u7d50\u5c40 Passport \u3092\u5229\u7528\u3059\u308b\u5225\u306e\u30ac\u30fc\u30c9\u3092\u901a\u3063\u3066\u3057\u307e\u3046\u3068(\u4e0a\u306e\u30d5\u30ed\u30fc\u3067\u3044\u3046\u306811.)\u6b7b\u306a\u306e\u3067\u3001\u73fe\u72b6 MultiAuth \u74b0\u5883\u3067 CreateFreshApiToken \u3092\u5229\u7528\u3059\u308b\u306e\u306f\u7121\u7406\u30b2\u30fc\u306a\u6c17\u304c\u3057\u3066\u304d\u307e\u3057\u305f\u3002\u3002\u3002\n\n# \u305d\u3082\u305d\u3082\u8ad6\n\u3053\u308c\u3063\u3066\u958b\u767a\u7528\u306b\u4f7f\u3046\u3082\u306e\u3067\u306f\u306a\u304b\u308d\u3046\u304b...\n", "tags": ["laravel", "Passport"]}