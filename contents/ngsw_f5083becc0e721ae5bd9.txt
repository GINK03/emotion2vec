{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\n\nVagrant 1.7.4\n\n\nCentOS Linux release 7.1.1503 (Core)\ngetenforce => Disabled\nsshd \u306f 10.10.10.10/24 \u306b\u3066LISTEN\nfirewalld \u306f\u6709\u52b9\n\u4ee5\u4e0b\u304c\u6709\u52b9\u306a\u72b6\u614b(\u3044\u308f\u3086\u308b\u300c\u30c7\u30d5\u30a9\u30eb\u30c8\u300d)\n\n\nzone \u306f public (firewall-cmd --get-active-zones)\n/usr/lib/firewalld/services/ssh.xml \n/usr/lib/firewalld/services/dhcpv6-client.xml\n\u4e0a\u8a18\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u691c\u8a3c\u5185\u5bb9\u3067\u4e0a\u66f8\u304d\u3055\u308c\u308b\u8a8d\u8b58\n\n\n\n\n\n\n\u8af8\u6ce8\u610f\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u306b\u5f93\u3044\u691c\u8a3c\u3092\u9032\u3081\u307e\u3059\u3068 vagrant destroy \u3092\u4f59\u5100\u306a\u304f\u3055\u308c\u307e\u3059 (\u305d\u308c\u4ee5\u5916\u306e\u56de\u907f\u65b9\u6cd5\u3092\u77e5\u3089\u306a\u3044)\u3002\n\u3082\u3061\u308d\u3093\u5b9f\u6a5f\u691c\u8a3c\u306e\u5834\u5408\u306b\u306f\u7aef\u672b\u63a5\u7d9a\u304c\u306a\u3044\u3068\u7acb\u3061\u3044\u304b\u306a\u304f\u306a\u308a\u307e\u3059\u3002\nKVM\u30b2\u30b9\u30c8\u6a5f\u3067\u691c\u8a3c\u3059\u308b\u3068\u30db\u30b9\u30c8\u6a5f\u304b\u3089\u306e virsh console ${geust} \u304c\u3042\u308b\u306e\u3067\u6c17\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n\u691c\u8a3c\u5185\u5bb9\n\nDirect Options\u306epriority\u5024\u304c\u4e00\u81f4\u3059\u308b\u5834\u5408\u306e\u8a55\u4fa1\u9806\u306e\u78ba\u8a8d\n\n\n/etc/firewalld/direct.xml \u3092\u624b\u52d5\u3067\u4f5c\u6210\u3057\u305f\n\npriority\u5024\u306f\u3059\u3079\u3066 1 \u3067\u3042\u308b\n\n\n/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>\n</direct>\n\n\n\nfirewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n\n\u3053\u306e\u5834\u5408\u306f firewall-cmd --reload \u3067\u3082\u3088\u3044\n\n\ncommand(root)\n# systemctl restart firewalld.service\n\n\n\n\u8a2d\u5b9a\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n\u3053\u306e\u72b6\u614b\u3067\u306fSSH\u63a5\u7d9a\u306f\u5207\u65ad\u3055\u308c\u306a\u3044\n\n\nfirewall-cmd\n\ncommand(root)\n# firewall-cmd --direct --get-all-rules\nipv4 filter INPUT 1 -i lo -j ACCEPT\nipv4 filter INPUT 1 -s 10.10.10.0/24 -j ACCEPT\nipv4 filter INPUT 1 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES INPUT]  : '\nipv4 filter INPUT 1 -j DROP\nipv4 filter OUTPUT 1 -o lo -j ACCEPT\nipv4 filter OUTPUT 1 -d 10.10.10.0/24 -j ACCEPT\nipv4 filter OUTPUT 1 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '\nipv4 filter OUTPUT 1 -j DROP\n\n\n\niptables\n\ncommand(root)\n# iptables -nL INPUT_direct\nChain INPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  10.10.10.0/24        0.0.0.0/0\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES INPUT]  : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\n\n\ncommand(root)\n# iptables -nL OUTPUT_direct\nChain OUTPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            10.10.10.0/24\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES OUTPUT] : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\n\n\n/etc/firewalld/direct.xml \u3092\u624b\u52d5\u4fee\u6b63\u3057DROP\u884c\u3068ACCEPT\u884c\u3092\u5165\u308c\u66ff\u3048\u308b\n\n/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n</direct>\n\n\n\nfirewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n\n\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3068SSH\u63a5\u7d9a\u304c\u9014\u7d76\u3048\u308b\n -j DROP \u304c\u52b9\u3044\u3066\u3044\u308b\n\u3053\u306e\u5834\u5408\u3082 firewall-cmd --reload \u3067\u3082\u554f\u984c\u306a\u3044\n\n\n\u304c direct.xml \u306e\u624b\u52d5\u66f8\u304d\u63db\u3048/\u7279\u306b\u884c\u524a\u9664\u3084\u5165\u308c\u66ff\u3048\u306b\u95a2\u3057\u3066\u306f\u518d\u8d77\u52d5\u304c\u3088\u3044\u3068\u601d\u3046(\u4e0d\u8981\u306a\u8a2d\u5b9a\u304c\u6b8b\u308a\u7d9a\u3051\u308b)\n\n\n\u5b9f\u6a5f\u78ba\u8a8d/virsh console ${guest}\u304c\u53ef\u80fd\u306a\u65b9\u306f\u4ee5\u4e0b\u3082\u884c\u3046\u3068\u3057\u3063\u304f\u308a\u304f\u308b\u3084\u3082\u3057\u308c\u307e\u305b\u3093(vagrant\u3067\u78ba\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f)\n\n\n/var/log/messages\u306eDROP\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\nfirewall-cmd --direct --get-all-rules \u3092\u78ba\u8a8d\u3059\u308b\niptables -nL {IN,OUT}PUT_direct \u3092\u78ba\u8a8d\u3059\u308b\n\n\n\n\ncommand(root)\n# systemctl restart firewalld.service\n\n\n\n\u7d50\u8ad61\n\n/etc/firewalld/direct.xml \u306f\u540c\u4e00priority\u306e\u5834\u5408\u3001\u5148\u982d\u884c\u304b\u3089\u9806\u306b\u8a55\u4fa1\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n\nVagrant\u3092\u518d\u69cb\u7bc9\u3059\u308b\n\n\u3057\u3066\u304f\u3060\u3055\u3044\n\n\ncommand(client-{PC,Mac})\nvagrant destroy\nvagrant up\n\n\n\n/etc/firewalld/direct.xml \u624b\u52d5\u4f5c\u6210\u3057\u305f(\u305f\u3060\u3057 DROP\u884c\u306epriority\u5024\u30922 \u3068\u3057\u305f)\n\n/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n</direct>\n\n\n\nfirewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n\n\u3053\u306e\u5834\u5408\u3082 firewall-cmd --reload \u3067\u3082\u3088\u3044\npriority\u5024\u306e\u66f8\u304d\u63db\u3048\u306b\u3088\u308aSSH\u63a5\u7d9a\u304c\u9014\u7d76\u3048\u306a\u3044\n\n\ncommand(root)\n# systemctl restart firewalld.service\n\n\n\n\u8a2d\u5b9a\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\nfirewall-cmd\n\ncommand(root)\n# firewall-cmd --direct --get-all-rules\nipv4 filter INPUT 1 -i lo -j ACCEPT\nipv4 filter INPUT 2 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES INPUT]  : '\nipv4 filter INPUT 2 -j DROP\nipv4 filter INPUT 1 -s 10.10.10.0/24 -j ACCEPT\nipv4 filter OUTPUT 1 -o lo -j ACCEPT\nipv4 filter OUTPUT 2 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '\nipv4 filter OUTPUT 2 -j DROP\nipv4 filter OUTPUT 1 -d 10.10.10.0/24 -j ACCEPT\n\n\n\niptables\n\ncommand(root)\n# iptables -nL INPUT_direct\nChain INPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  10.10.10.0/24        0.0.0.0/0\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES INPUT]  : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\n\n\ncommand(root)\n# iptables -nL OUTPUT_direct\nChain OUTPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            10.10.10.0/24\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES OUTPUT] : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n\n\n\n\u7d50\u8ad62\n\n/etc/firewalld/direct.xml \u306fpriority\u5024\u3069\u304a\u308a\u306b\u6319\u52d5\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n\n\u307e\u3068\u3081\n\nDirect Options\u5229\u7528\u6642\u306b\u306fpriority\u5024\u306f\u91cd\u8981\n\u7a3c\u50cd\u5f53\u521d\u306f\u5b9f\u7e3e\u306e\u3042\u308biptables\u66f8\u304d\u63db\u3048\u3067\u540c\u4e00priority\u5024\u3067\u3082\u554f\u984c\u306f\u306a\u304f\u7a3c\u50cd\u3057\u305d\u3046\u3060\u304c\u3001\u5f8c\u306e\u4fee\u6b63\u3067\u969c\u5bb3\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308b\n\n\n\u500b\u4eba\u7684\u306a\u4eca\u5f8c\u306e\u8ab2\u984c\n\nfirewalld \u3092\u4f7f\u3063\u3066\u3044\u304d\u305f\u3044\ndirect.xml \u3092priority\u5024\u5225\u306b\u5225\u30d5\u30a1\u30a4\u30eb\u3067\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u304c\u306a\u3044\u304b\u6a21\u7d22\u3057\u305f\u3044\n\n\n\u305f\u3060\u3057\u30d0\u30c3\u30c9\u30ce\u30a6\u30cf\u30a6\u306a\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u3044\u3046\u61f8\u5ff5\u304c\u3042\u308b\n\u5b9f\u9a13\u7684/\u6709\u7528\u306a\u60c5\u5831\u304c\u3042\u308c\u3070 @ngsw \u307e\u3067\u304a\u77e5\u3089\u305b\u3044\u305f\u3060\u3051\u308b\u3068\u5e78\u3044\u306b\u5b58\u3058\u307e\u3059\n\n\n\n# \u524d\u63d0\n* Vagrant 1.7.4\n  * CentOS Linux release 7.1.1503 (Core)\n  * getenforce => Disabled\n  * sshd \u306f 10.10.10.10/24 \u306b\u3066LISTEN\n  * firewalld \u306f\u6709\u52b9\n    * \u4ee5\u4e0b\u304c\u6709\u52b9\u306a\u72b6\u614b(\u3044\u308f\u3086\u308b\u300c\u30c7\u30d5\u30a9\u30eb\u30c8\u300d)\n      * zone \u306f public (firewall-cmd --get-active-zones)\n      * /usr/lib/firewalld/services/ssh.xml \n      * /usr/lib/firewalld/services/dhcpv6-client.xml\n      * \u4e0a\u8a18\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u691c\u8a3c\u5185\u5bb9\u3067\u4e0a\u66f8\u304d\u3055\u308c\u308b\u8a8d\u8b58\n\n# \u8af8\u6ce8\u610f\n* \u4ee5\u4e0b\u306e\u624b\u9806\u306b\u5f93\u3044\u691c\u8a3c\u3092\u9032\u3081\u307e\u3059\u3068 **vagrant destroy \u3092\u4f59\u5100\u306a\u304f\u3055\u308c\u307e\u3059** (\u305d\u308c\u4ee5\u5916\u306e\u56de\u907f\u65b9\u6cd5\u3092\u77e5\u3089\u306a\u3044)\u3002\n* \u3082\u3061\u308d\u3093\u5b9f\u6a5f\u691c\u8a3c\u306e\u5834\u5408\u306b\u306f\u7aef\u672b\u63a5\u7d9a\u304c\u306a\u3044\u3068\u7acb\u3061\u3044\u304b\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n* KVM\u30b2\u30b9\u30c8\u6a5f\u3067\u691c\u8a3c\u3059\u308b\u3068\u30db\u30b9\u30c8\u6a5f\u304b\u3089\u306e virsh console ${geust} \u304c\u3042\u308b\u306e\u3067\u6c17\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# \u691c\u8a3c\u5185\u5bb9\n* Direct Options\u306epriority\u5024\u304c\u4e00\u81f4\u3059\u308b\u5834\u5408\u306e\u8a55\u4fa1\u9806\u306e\u78ba\u8a8d\n\n# /etc/firewalld/direct.xml \u3092\u624b\u52d5\u3067\u4f5c\u6210\u3057\u305f\n* priority\u5024\u306f\u3059\u3079\u3066 1 \u3067\u3042\u308b\n\n```xml:/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>\n</direct>\n```\n\n# firewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n* \u3053\u306e\u5834\u5408\u306f firewall-cmd --reload \u3067\u3082\u3088\u3044\n\n```bash:command(root)\n# systemctl restart firewalld.service\n```\n\n# \u8a2d\u5b9a\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n* \u3053\u306e\u72b6\u614b\u3067\u306fSSH\u63a5\u7d9a\u306f\u5207\u65ad\u3055\u308c\u306a\u3044\n\n## firewall-cmd\n```bash:command(root)\n# firewall-cmd --direct --get-all-rules\nipv4 filter INPUT 1 -i lo -j ACCEPT\nipv4 filter INPUT 1 -s 10.10.10.0/24 -j ACCEPT\nipv4 filter INPUT 1 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES INPUT]  : '\nipv4 filter INPUT 1 -j DROP\nipv4 filter OUTPUT 1 -o lo -j ACCEPT\nipv4 filter OUTPUT 1 -d 10.10.10.0/24 -j ACCEPT\nipv4 filter OUTPUT 1 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '\nipv4 filter OUTPUT 1 -j DROP\n```\n## iptables\n```bash:command(root)\n# iptables -nL INPUT_direct\nChain INPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  10.10.10.0/24        0.0.0.0/0\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES INPUT]  : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n```\n\n```bash:command(root)\n# iptables -nL OUTPUT_direct\nChain OUTPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            10.10.10.0/24\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES OUTPUT] : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n```\n\n# /etc/firewalld/direct.xml \u3092\u624b\u52d5\u4fee\u6b63\u3057DROP\u884c\u3068ACCEPT\u884c\u3092\u5165\u308c\u66ff\u3048\u308b\n\n```xml:/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n</direct>\n```\n\n# firewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n* \u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3068SSH\u63a5\u7d9a\u304c\u9014\u7d76\u3048\u308b\n* <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule> \u304c\u52b9\u3044\u3066\u3044\u308b\n* \u3053\u306e\u5834\u5408\u3082 firewall-cmd --reload \u3067\u3082\u554f\u984c\u306a\u3044\n  * \u304c direct.xml \u306e\u624b\u52d5\u66f8\u304d\u63db\u3048/\u7279\u306b\u884c\u524a\u9664\u3084\u5165\u308c\u66ff\u3048\u306b\u95a2\u3057\u3066\u306f\u518d\u8d77\u52d5\u304c\u3088\u3044\u3068\u601d\u3046(\u4e0d\u8981\u306a\u8a2d\u5b9a\u304c\u6b8b\u308a\u7d9a\u3051\u308b)\n* \u5b9f\u6a5f\u78ba\u8a8d/virsh console ${guest}\u304c\u53ef\u80fd\u306a\u65b9\u306f\u4ee5\u4e0b\u3082\u884c\u3046\u3068\u3057\u3063\u304f\u308a\u304f\u308b\u3084\u3082\u3057\u308c\u307e\u305b\u3093(vagrant\u3067\u78ba\u8a8d\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f)\n  * /var/log/messages\u306eDROP\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\n  * firewall-cmd --direct --get-all-rules \u3092\u78ba\u8a8d\u3059\u308b\n  * iptables -nL {IN,OUT}PUT_direct \u3092\u78ba\u8a8d\u3059\u308b\n  \n\n```bash:command(root)\n# systemctl restart firewalld.service\n```\n\n# \u7d50\u8ad61\n* /etc/firewalld/direct.xml \u306f\u540c\u4e00priority\u306e\u5834\u5408\u3001\u5148\u982d\u884c\u304b\u3089\u9806\u306b\u8a55\u4fa1\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n# Vagrant\u3092\u518d\u69cb\u7bc9\u3059\u308b\n* \u3057\u3066\u304f\u3060\u3055\u3044\n\n```c:command(client-{PC,Mac})\nvagrant destroy\nvagrant up\n```\n\n# /etc/firewalld/direct.xml \u624b\u52d5\u4f5c\u6210\u3057\u305f(\u305f\u3060\u3057 **DROP\u884c\u306epriority\u5024\u30922** \u3068\u3057\u305f)\n\n```xml:/etc/firewalld/direct.xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<direct>\n  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -i lo -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -o lo -j ACCEPT</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='INPUT'> -m limit --limit 1/sec -j LOG --log-prefix  '[IPTABLES INPUT]  : '</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='INPUT'> -j DROP</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='OUTPUT'> -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '</rule>\n  <rule priority='2' table='filter' ipv='ipv4' chain='OUTPUT'> -j DROP</rule>  <rule priority='1' table='filter' ipv='ipv4' chain='INPUT'>  -s 10.10.10.0/24 -j ACCEPT</rule>\n  <rule priority='1' table='filter' ipv='ipv4' chain='OUTPUT'> -d 10.10.10.0/24 -j ACCEPT</rule>\n</direct>\n```\n\n# firewalld \u3092\u518d\u8d77\u52d5\u3059\u308b\n* \u3053\u306e\u5834\u5408\u3082 firewall-cmd --reload \u3067\u3082\u3088\u3044\n* priority\u5024\u306e\u66f8\u304d\u63db\u3048\u306b\u3088\u308aSSH\u63a5\u7d9a\u304c\u9014\u7d76\u3048\u306a\u3044\n\n```bash:command(root)\n# systemctl restart firewalld.service\n```\n\n# \u8a2d\u5b9a\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n## firewall-cmd\n```bash:command(root)\n# firewall-cmd --direct --get-all-rules\nipv4 filter INPUT 1 -i lo -j ACCEPT\nipv4 filter INPUT 2 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES INPUT]  : '\nipv4 filter INPUT 2 -j DROP\nipv4 filter INPUT 1 -s 10.10.10.0/24 -j ACCEPT\nipv4 filter OUTPUT 1 -o lo -j ACCEPT\nipv4 filter OUTPUT 2 -m limit --limit 1/sec -j LOG --log-prefix '[IPTABLES OUTPUT] : '\nipv4 filter OUTPUT 2 -j DROP\nipv4 filter OUTPUT 1 -d 10.10.10.0/24 -j ACCEPT\n```\n## iptables\n```bash:command(root)\n# iptables -nL INPUT_direct\nChain INPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  10.10.10.0/24        0.0.0.0/0\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES INPUT]  : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n```\n\n```bash:command(root)\n# iptables -nL OUTPUT_direct\nChain OUTPUT_direct (1 references)\ntarget     prot opt source               destination\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\nACCEPT     all  --  0.0.0.0/0            10.10.10.0/24\nLOG        all  --  0.0.0.0/0            0.0.0.0/0            limit: avg 1/sec burst 5 LOG flags 0 level 4 prefix \"[IPTABLES OUTPUT] : \"\nDROP       all  --  0.0.0.0/0            0.0.0.0/0\n```\n\n# \u7d50\u8ad62\n* /etc/firewalld/direct.xml \u306fpriority\u5024\u3069\u304a\u308a\u306b\u6319\u52d5\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n# \u307e\u3068\u3081\n* Direct Options\u5229\u7528\u6642\u306b\u306fpriority\u5024\u306f\u91cd\u8981\n* \u7a3c\u50cd\u5f53\u521d\u306f\u5b9f\u7e3e\u306e\u3042\u308biptables\u66f8\u304d\u63db\u3048\u3067\u540c\u4e00priority\u5024\u3067\u3082\u554f\u984c\u306f\u306a\u304f\u7a3c\u50cd\u3057\u305d\u3046\u3060\u304c\u3001\u5f8c\u306e\u4fee\u6b63\u3067\u969c\u5bb3\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308b\n\n# \u500b\u4eba\u7684\u306a\u4eca\u5f8c\u306e\u8ab2\u984c\n* firewalld \u3092\u4f7f\u3063\u3066\u3044\u304d\u305f\u3044\n* direct.xml \u3092priority\u5024\u5225\u306b\u5225\u30d5\u30a1\u30a4\u30eb\u3067\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u304c\u306a\u3044\u304b\u6a21\u7d22\u3057\u305f\u3044\n  * \u305f\u3060\u3057\u30d0\u30c3\u30c9\u30ce\u30a6\u30cf\u30a6\u306a\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u3044\u3046\u61f8\u5ff5\u304c\u3042\u308b\n  * \u5b9f\u9a13\u7684/\u6709\u7528\u306a\u60c5\u5831\u304c\u3042\u308c\u3070 @ngsw \u307e\u3067\u304a\u77e5\u3089\u305b\u3044\u305f\u3060\u3051\u308b\u3068\u5e78\u3044\u306b\u5b58\u3058\u307e\u3059\n", "tags": ["firewalld"]}