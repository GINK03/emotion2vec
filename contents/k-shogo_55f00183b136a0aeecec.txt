{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u524d\u56de\u3001\"CoreDataQuery\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\"\u3067\u306f\u3001CoreDataQuery\u3092\u7528\u3044\u3066\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u3067\u306f\u306a\u304f\u3001\u30a2\u30d7\u30ea\u4e0a\u3067\u4e00\u89a7\u3001\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u524a\u9664\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u6e96\u5099\n\u30a2\u30d7\u30ea\u306e\u57fa\u672c\u306f\u524d\u56de\u306e\u3082\u306e\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30d5\u30a9\u30fc\u30e0\u753b\u9762\u3082\u3042\u308b\u305f\u3081\u3001\u753b\u9762\u69cb\u7bc9\u3092\u7c21\u6613\u306b\u3059\u308b\u305f\u3081\u306bformotion\u3068\u3001ProMotion\u3068formotion\u3092\u7d44\u307f\u5408\u308f\u305b\u308bProMotion-formotion\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\nProMotion-formotion\u3092\u4f7f\u3046\u5834\u5408\u3001\u73fe\u5728\u306fProMotion, formotion\u3068\u3082\u306bgit\u306b\u3042\u308b\u30b3\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nGemfile\n\nsource 'https://rubygems.org'\n\ngem 'ProMotion', git: 'https://github.com/clearsightstudio/ProMotion.git'\ngem 'formotion', git: 'https://github.com/clayallsopp/formotion.git'\ngem 'ProMotion-formotion'\ngem 'cdq'\n\nbundle install\u304a\u3088\u3073cdq init\u3092\u6e08\u307e\u305b\u3001\nbundle install --path vendor/bundle\nbundle exec cdq init\n\n\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3068\u30e2\u30c7\u30eb\u4f5c\u6210\u3082\u884c\u3044\u307e\u3059\u3002\n\nschemas/0001_initial.rb\n\nschema \"0001 initial\" do\n\n  entity \"Item\" do\n    string :body\n  end\n\nend\n\n\napp/models/item.rb\n\nclass Item < CDQManagedObject\n\nend\n\napp_delegate.rb\u306f\u524d\u56de\u3068\u5909\u308f\u308a\u3042\u308a\u307e\u305b\u3093\u3002\n\napp/app_delegate.rb\n\nclass AppDelegate < PM::Delegate\n  include CDQ\n  def on_load(app, options)\n    cdq.setup\n    open ItemsScreen.new(nav_bar: true)\n  end\nend\n\n\n\u753b\u9762\u4f5c\u6210\n\u30e1\u30a4\u30f3\u306e\u753b\u9762\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\napp/screens/items_screen.rb\n\nclass ItemsScreen < PM::TableScreen\n  title \"Items\"\n\n  def load_item\n    PM::logger.debug \"load_item\"\n    @items = [\n      {\n        cells: Item.map do |item|\n          {\n            title:         item.body,\n            action:        :tapped_item,\n            arguments:     item,\n            editing_style: :delete\n          }\n        end\n      }\n    ]\n    update_table_data\n  end\n\n  def on_load\n    set_nav_bar_button :right, title: \"Add\", action: :open_item_form_screen\n  end\n\n  def open_item_form_screen\n    open ItemFormScreen.new(nav_bar: true), modal: true\n  end\n\n  def on_appear\n    load_item\n  end\n\n  def table_data\n    @items ||= []\n  end\n\n  def tapped_item(item)\n    open ItemFormScreen.new(item: item, nav_bar: true)\n  end\n\n  def on_cell_deleted(cell)\n    cell[:arguments].destroy\n    cdq.save\n  end\nend\n\n\napp/screens/item_form_screen.rb\n\nclass ItemFormScreen < PM::FormotionScreen\n  title \"Item\"\n\n  attr_accessor :item\n\n  def on_load\n    nav_bar_title = item.nil? ? 'Save': 'Update'\n    set_nav_bar_button :right, title: nav_bar_title, action: :save_item\n    set_nav_bar_button :left,  title: 'Cancel',      action: :cancel\n  end\n\n  def save_item\n    if item.nil?\n      Item.create(form.render)\n    else\n      item.body = form.render[:body]\n    end\n    cdq.save\n    close\n  end\n\n  def cancel\n    close\n  end\n\n  def table_data\n    value = item.nil? ? \"\" : item.body\n    {\n      sections: [\n        {\n          title: \"Item\",\n          rows: [\n            {\n              title:       \"Body\",\n              key:         :body,\n              type:        :string,\n              placeholder: \"text here\",\n              value:       value\n            }\n          ]\n        }\n      ]\n    }\n\n  end\n\nend\n\n\u3053\u308c\u3067\u3001\u4e00\u89a7\u3001\u4f5c\u6210\u3001\u66f4\u65b0\u3001\u524a\u9664\u304c\u30a2\u30d7\u30ea\u5185\u3067\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u4e00\u89a7\u753b\u9762\u3067\u30b9\u30ef\u30a4\u30d7\u3059\u308b\u3068\u524a\u9664\u30ea\u30f3\u30af\u304c\u51fa\u73fe\u3057\u3001\u201dAdd\"\u30dc\u30bf\u30f3\u3067\u65b0\u898f\u4f5c\u6210\u753b\u9762\u306b\u3001\n\u305d\u3057\u3066\u5404\u9805\u76ee\u306e\u30bf\u30c3\u30d7\u3067\u7de8\u96c6\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059 \u3002\n\n# \u306f\u3058\u3081\u306b\n\n\u524d\u56de\u3001\"[CoreDataQuery\u3067\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b](http://k-shogo.github.io/article/2014/04/09/rubymotion-core-data-query/)\"\u3067\u306f\u3001CoreDataQuery\u3092\u7528\u3044\u3066\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u3067\u306f\u306a\u304f\u3001\u30a2\u30d7\u30ea\u4e0a\u3067\u4e00\u89a7\u3001\u4fdd\u5b58\u3001\u66f4\u65b0\u3001\u524a\u9664\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\n### \u6e96\u5099\n\n\u30a2\u30d7\u30ea\u306e\u57fa\u672c\u306f[\u524d\u56de](http://k-shogo.github.io/article/2014/04/09/rubymotion-core-data-query/)\u306e\u3082\u306e\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30d5\u30a9\u30fc\u30e0\u753b\u9762\u3082\u3042\u308b\u305f\u3081\u3001\u753b\u9762\u69cb\u7bc9\u3092\u7c21\u6613\u306b\u3059\u308b\u305f\u3081\u306b[formotion](https://github.com/clayallsopp/formotion)\u3068\u3001[ProMotion](https://github.com/clearsightstudio/ProMotion)\u3068formotion\u3092\u7d44\u307f\u5408\u308f\u305b\u308b[ProMotion-formotion](https://github.com/rheoli/ProMotion-formotion)\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\nProMotion-formotion\u3092\u4f7f\u3046\u5834\u5408\u3001\u73fe\u5728\u306fProMotion, formotion\u3068\u3082\u306bgit\u306b\u3042\u308b\u30b3\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## `Gemfile`\n\n```ruby\nsource 'https://rubygems.org'\n\ngem 'ProMotion', git: 'https://github.com/clearsightstudio/ProMotion.git'\ngem 'formotion', git: 'https://github.com/clayallsopp/formotion.git'\ngem 'ProMotion-formotion'\ngem 'cdq'\n```\n\n`bundle install`\u304a\u3088\u3073`cdq init`\u3092\u6e08\u307e\u305b\u3001\n\n```\nbundle install --path vendor/bundle\nbundle exec cdq init\n```\n\n\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u3068\u30e2\u30c7\u30eb\u4f5c\u6210\u3082\u884c\u3044\u307e\u3059\u3002\n\n## `schemas/0001_initial.rb`\n\n```ruby\nschema \"0001 initial\" do\n\n  entity \"Item\" do\n    string :body\n  end\n\nend\n```\n\n## `app/models/item.rb`\n\n```ruby\nclass Item < CDQManagedObject\n\nend\n```\n\n`app_delegate.rb`\u306f\u524d\u56de\u3068\u5909\u308f\u308a\u3042\u308a\u307e\u305b\u3093\u3002\n\n## `app/app_delegate.rb`\n\n```ruby\nclass AppDelegate < PM::Delegate\n  include CDQ\n  def on_load(app, options)\n    cdq.setup\n    open ItemsScreen.new(nav_bar: true)\n  end\nend\n```\n\n# \u753b\u9762\u4f5c\u6210\n\n\u30e1\u30a4\u30f3\u306e\u753b\u9762\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n## `app/screens/items_screen.rb`\n\n```ruby\nclass ItemsScreen < PM::TableScreen\n  title \"Items\"\n\n  def load_item\n    PM::logger.debug \"load_item\"\n    @items = [\n      {\n        cells: Item.map do |item|\n          {\n            title:         item.body,\n            action:        :tapped_item,\n            arguments:     item,\n            editing_style: :delete\n          }\n        end\n      }\n    ]\n    update_table_data\n  end\n\n  def on_load\n    set_nav_bar_button :right, title: \"Add\", action: :open_item_form_screen\n  end\n\n  def open_item_form_screen\n    open ItemFormScreen.new(nav_bar: true), modal: true\n  end\n\n  def on_appear\n    load_item\n  end\n\n  def table_data\n    @items ||= []\n  end\n\n  def tapped_item(item)\n    open ItemFormScreen.new(item: item, nav_bar: true)\n  end\n\n  def on_cell_deleted(cell)\n    cell[:arguments].destroy\n    cdq.save\n  end\nend\n```\n\n## `app/screens/item_form_screen.rb`\n\n```ruby\nclass ItemFormScreen < PM::FormotionScreen\n  title \"Item\"\n\n  attr_accessor :item\n\n  def on_load\n    nav_bar_title = item.nil? ? 'Save': 'Update'\n    set_nav_bar_button :right, title: nav_bar_title, action: :save_item\n    set_nav_bar_button :left,  title: 'Cancel',      action: :cancel\n  end\n\n  def save_item\n    if item.nil?\n      Item.create(form.render)\n    else\n      item.body = form.render[:body]\n    end\n    cdq.save\n    close\n  end\n\n  def cancel\n    close\n  end\n\n  def table_data\n    value = item.nil? ? \"\" : item.body\n    {\n      sections: [\n        {\n          title: \"Item\",\n          rows: [\n            {\n              title:       \"Body\",\n              key:         :body,\n              type:        :string,\n              placeholder: \"text here\",\n              value:       value\n            }\n          ]\n        }\n      ]\n    }\n\n  end\n\nend\n```\n\n\u3053\u308c\u3067\u3001\u4e00\u89a7\u3001\u4f5c\u6210\u3001\u66f4\u65b0\u3001\u524a\u9664\u304c\u30a2\u30d7\u30ea\u5185\u3067\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002  \n\u4e00\u89a7\u753b\u9762\u3067\u30b9\u30ef\u30a4\u30d7\u3059\u308b\u3068\u524a\u9664\u30ea\u30f3\u30af\u304c\u51fa\u73fe\u3057\u3001\u201dAdd\"\u30dc\u30bf\u30f3\u3067\u65b0\u898f\u4f5c\u6210\u753b\u9762\u306b\u3001\n\u305d\u3057\u3066\u5404\u9805\u76ee\u306e\u30bf\u30c3\u30d7\u3067\u7de8\u96c6\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059 \u3002\n\n![screen](http://k-shogo.github.io/images/2014-04-10-rubymotion-cdq-crud/screen.png)", "tags": ["RubyMotion", "CoreData"]}