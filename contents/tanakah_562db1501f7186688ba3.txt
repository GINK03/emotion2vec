{"context": "Direct2D\u306e\u4f7f\u3044\u65b9\u3092\u7fd2\u5f97\u4e2d\u3067\u3059\u3002\nWin32API\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u3001\u7e2e\u5c0f\u3057\u3066\u8cbc\u308a\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\nStretchBlt()\u3092\u4f7f\u3046\u306e\u3067\u3059\u304cDirect2D\u3092\u4f7f\u3063\u3066\u307f\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u7aef\u6298\u3063\u3066\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u304b\u3057\u3089\u3093\uff1f\nWin32API\u306e\u5834\u5408\n    HBITMAP hbmp=nullptr;\n    unsigned char *image_buffer=nullptr;\n    hbmp=CreateDIBSection(NULL, pbi, DIB_RGB_COLORS, (void **)(&image_buffer), NULL, 0);\n\n\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u30d0\u30c3\u30d5\u30a1\u3092\u30e1\u30e2\u30ea\u306b\u78ba\u4fdd\u3057\u3066\u3001\u305d\u3053\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304d\u3001\n    HDC hdc=GetDC(hwnd);\n    HDC hmemdc=CreateCompatibleDC(hdc);\n    HBITMAP holdbmp=(HBITMAP)SelectObject(hmemdc, hbmp);\n    SetStretchBltMode(hdc, COLORONCOLOR);\n    StretchBlt(hdc,    dx, dy, dw, dh,\n               hmemdc, sx, sy, sw, sh,\n               SRCCOPY);\n    SelectObject(hmemdc, holdbmp);\n    DeleteObject(hmemdc);\n    ReleaseDC(hwnd, hdc);\n\n\u3067window(\u306eDC)\u3092\u6307\u5b9a\u3057\u3066\u3001\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3002\nDirect2D\u306e\u5834\u5408\u306f\n    D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED, &m_pDirect2dFactory);\n    props=D2D1::RenderTargetProperties();\n    hwnd_props=D2D1::HwndRenderTargetProperties(hwnd, D2D1::SizeU(w, h));\n    m_pDirect2dFactory->CreateHwndRenderTarget(props, hwnd_props, &m_pHWNDRenderTarget);\n\n\u3067\u5bfe\u8c61\u3068\u306a\u308bwindow\u3092\u307e\u305a\u6307\u5b9a\u3057\u306a\u3044\u3068\u59cb\u307e\u3089\u306a\u3044\u3002\n\u8ffd\u8a18:) DC\u3092rendertarget\u306b\u3059\u308b\u65b9\u6cd5\u3082\u3042\u3063\u305f...\n    unsigned char *image_buffer=(unsigned char *)malloc(sx*4*sy);\n\n    ID2D1Bitmap *d2dbmp=nullptr;\n    D2D1_PIXEL_FORMAT pixelFormat=D2D1::PixelFormat(DXGI_FORMAT_B8G8R8A8_UNORM,\n                                                    D2D1_ALPHA_MODE_PREMULTIPLIED);\n    m_pHWNDRenderTarget->CreateBitmap(D2D1::SizeU(sx, sy),\n                                      image_buffer, sx*4,\n                                      D2D1::BitmapProperties(pixelFormat), &d2dbmp);\n\n\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u30d0\u30c3\u30d5\u30a1\u3092\u81ea\u524d\u3067\u78ba\u4fdd\u3057\u3066\u95a2\u9023\u4ed8\u3051\u3001\u305d\u3053\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304d\u3001\n    if((m_pHWNDRenderTarget!=nullptr)&&\n       (!(m_pHWNDRenderTarget->CheckWindowState() & D2D1_WINDOW_STATE_OCCLUDED))){\n      m_pHWNDRenderTarget->BeginDraw();\n      if(d2dbmp!=nullptr){\n        D2D1_RECT_F dstRect=D2D1::RectF((float)dx, (float)dy, (float)dw, (float)dh);\n        D2D1_RECT_F srcRect=D2D1::RectF((float)sx, (float)sy, (float)sw, (float)sh);\n        float opacity=1.0;\n        m_pHWNDRenderTarget->DrawBitmap(d2dbmp,\n                                        dstRect,\n                                        opacity,\n                                        D2D1_BITMAP_INTERPOLATION_MODE_LINEAR, \n                                        srcRect);\n      }\n      hr=m_pHWNDRenderTarget->EndDraw();\n    }\n\n\u3067\u8cbc\u308a\u4ed8\u3051\u3001\u3067\u3057\u3087\u3046\u304b\uff1f\nDirect2D\u3060\u306824bitBGR\u306e\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u8cbc\u308a\u4ed8\u3051\u308c\u306a\u3044\u306e\u304c\u9762\u5012\u3067\u3059\u306d\u3002\nDirect2D\u306e\u4f7f\u3044\u65b9\u3092\u7fd2\u5f97\u4e2d\u3067\u3059\u3002\n\nWin32API\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u3001\u7e2e\u5c0f\u3057\u3066\u8cbc\u308a\u4ed8\u3051\u305f\u3044\u5834\u5408\u306b\nStretchBlt()\u3092\u4f7f\u3046\u306e\u3067\u3059\u304cDirect2D\u3092\u4f7f\u3063\u3066\u307f\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u7aef\u6298\u3063\u3066\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u304b\u3057\u3089\u3093\uff1f\n\nWin32API\u306e\u5834\u5408\n\n```\n    HBITMAP hbmp=nullptr;\n    unsigned char *image_buffer=nullptr;\n    hbmp=CreateDIBSection(NULL, pbi, DIB_RGB_COLORS, (void **)(&image_buffer), NULL, 0);\n```\n\n\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u30d0\u30c3\u30d5\u30a1\u3092\u30e1\u30e2\u30ea\u306b\u78ba\u4fdd\u3057\u3066\u3001\u305d\u3053\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304d\u3001\n\n```\n    HDC hdc=GetDC(hwnd);\n    HDC hmemdc=CreateCompatibleDC(hdc);\n    HBITMAP holdbmp=(HBITMAP)SelectObject(hmemdc, hbmp);\n    SetStretchBltMode(hdc, COLORONCOLOR);\n    StretchBlt(hdc,    dx, dy, dw, dh,\n               hmemdc, sx, sy, sw, sh,\n               SRCCOPY);\n    SelectObject(hmemdc, holdbmp);\n    DeleteObject(hmemdc);\n    ReleaseDC(hwnd, hdc);\n```\n\n\u3067window(\u306eDC)\u3092\u6307\u5b9a\u3057\u3066\u3001\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u8cbc\u308a\u4ed8\u3051\u3002\n\nDirect2D\u306e\u5834\u5408\u306f\n\n```\n    D2D1CreateFactory(D2D1_FACTORY_TYPE_SINGLE_THREADED, &m_pDirect2dFactory);\n    props=D2D1::RenderTargetProperties();\n    hwnd_props=D2D1::HwndRenderTargetProperties(hwnd, D2D1::SizeU(w, h));\n    m_pDirect2dFactory->CreateHwndRenderTarget(props, hwnd_props, &m_pHWNDRenderTarget);\n```\n\n\u3067\u5bfe\u8c61\u3068\u306a\u308bwindow\u3092\u307e\u305a\u6307\u5b9a\u3057\u306a\u3044\u3068\u59cb\u307e\u3089\u306a\u3044\u3002\n\u8ffd\u8a18:) DC\u3092rendertarget\u306b\u3059\u308b\u65b9\u6cd5\u3082\u3042\u3063\u305f...\n\n```\n    unsigned char *image_buffer=(unsigned char *)malloc(sx*4*sy);\n\n    ID2D1Bitmap *d2dbmp=nullptr;\n    D2D1_PIXEL_FORMAT pixelFormat=D2D1::PixelFormat(DXGI_FORMAT_B8G8R8A8_UNORM,\n                                                    D2D1_ALPHA_MODE_PREMULTIPLIED);\n    m_pHWNDRenderTarget->CreateBitmap(D2D1::SizeU(sx, sy),\n                                      image_buffer, sx*4,\n                                      D2D1::BitmapProperties(pixelFormat), &d2dbmp);\n```\n\u3067\u753b\u50cf\u30c7\u30fc\u30bf\u30d0\u30c3\u30d5\u30a1\u3092\u81ea\u524d\u3067\u78ba\u4fdd\u3057\u3066\u95a2\u9023\u4ed8\u3051\u3001\u305d\u3053\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304d\u3001\n\n```\n    if((m_pHWNDRenderTarget!=nullptr)&&\n       (!(m_pHWNDRenderTarget->CheckWindowState() & D2D1_WINDOW_STATE_OCCLUDED))){\n      m_pHWNDRenderTarget->BeginDraw();\n      if(d2dbmp!=nullptr){\n        D2D1_RECT_F dstRect=D2D1::RectF((float)dx, (float)dy, (float)dw, (float)dh);\n        D2D1_RECT_F srcRect=D2D1::RectF((float)sx, (float)sy, (float)sw, (float)sh);\n        float opacity=1.0;\n        m_pHWNDRenderTarget->DrawBitmap(d2dbmp,\n                                        dstRect,\n                                        opacity,\n                                        D2D1_BITMAP_INTERPOLATION_MODE_LINEAR, \n                                        srcRect);\n      }\n      hr=m_pHWNDRenderTarget->EndDraw();\n    }\n```\n\u3067\u8cbc\u308a\u4ed8\u3051\u3001\u3067\u3057\u3087\u3046\u304b\uff1f\n\nDirect2D\u3060\u306824bitBGR\u306e\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u305d\u306e\u307e\u307e\u8cbc\u308a\u4ed8\u3051\u308c\u306a\u3044\u306e\u304c\u9762\u5012\u3067\u3059\u306d\u3002\n", "tags": ["Win32API"]}