{"tags": ["VirtualHost", "SSL", "Apache", "openssl"], "context": " More than 1 year has passed since last update.\n\n\u25a0\u74b0\u5883\n\nServer version: Apache/2.2.15 (Unix)\nOpenSSL 1.0.1e-fips 11 Feb 2013\nVirtualHost\n\n\nhogehoge.com <=\u3053\u3053\u306bSSL\u8a3c\u660e\u66f8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n\nwww.hogehoge.com <= \u30c8\u30c3\u30d7\u30c9\u30e1\u30a4\u30f3\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\nwatashi.hogehoge.com\nfestival.hogehoge.com\n\n\n\n\nSSl\u8a3c\u660e\u66f8\u306e\u8cfc\u5165\u5148\n\n\nKING SSL => https://www.kingssl.com/\n\n\n\n\n\n\u25a0\u53c2\u8003\u624b\u9806\n\nhttps://www.kingssl.com/ssl_support/technical/csr_support/csr_8.html\nhttps://www.kingssl.com/ssl_support/technical/inst_support/inst_6.html\n\n\nvhost.conf\nNameVirtualHost *:80\nNameVirtualHost *:443\n\n#main\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/public\n        ServerName hogehoge.com\n        ServerAlias www.hogehoge.com\n\n        RewriteEngine on\n        RewriteCond %{HTTP_HOST} ^(www\\.hogehoge\\.com)(:80)? [NC]\n        RewriteRule ^/(.*) http://hogehoge.com/$1 [R=301,L]\n\n        ErrorLog /var/log/httpd/hogehoge.com/error_log\n        CustomLog /var/log/httpd/hogehoge.com/access_log combined\n\n            <Directory \"/var/www/html/public\">\n                AllowOverride All\n            </Directory>\n    </VirtualHost>\n\n#main-ssl\n    <VirtualHost *:443>\n        DocumentRoot /var/www/html/public\n        ServerName hogehoge.com:443\n        ServerAlias www.hogehoge.com\n\n       ErrorLog /var/log/httpd/hogehoge.combinedom/error_log\n        CustomLog /var/log/httpd/hogehoge.com/access_log combined\n\n        RewriteEngine on\n        RewriteCond %{HTTP_HOST} ^(www\\.hogehoge\\.com) [NC]\n        RewriteRule ^/(.*) https://hogehoge.com/$1 [R=301,L]\n\n        SSLEngine on\n        SSLCertificateChainFile /etc/httpd/conf/ssl.crt/intermediate_hogehoge.com.2016.cer\n        SSLCertificateFile /etc/httpd/conf/ssl.crt/hogehoge.com.2016.crt\n        SSLCertificateKeyFile /etc/httpd/conf/ssl.key/ssl.hogehoge.com.key\n\n            <Directory \"/var/www/html/public\">\n               AllowOverride All\n            </Directory>\n\n         SetEnvIf User-Agent \".*MSIE.*\" \\\n               nokeepalive ssl-unclean-shutdown \\\n               downgrade-1.0 force-response-1.0\n    </VirtualHost>\n\n\n#sub-festival\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/fest\n        ServerName festival.hogehoge.com\n\n        ErrorLog /var/log/httpd/festival.hogehoge.com/error_log\n        CustomLog /var/log/httpd/festival.hogehoge.com/access_log combined\n\n           <Directory \"/var/www/html/fest\">\n                AllowOverride All\n            </Directory>\n\n    </VirtualHost>\n\n#sub-watashi\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/watashi\n        ServerName watashi.hogehoge.com\n\n        ErrorLog /var/log/httpd/watashi/error_log\n        CustomLog /var/log/httpd/watashi/access_log combined\n\n          <Directory \"/var/www/html/watashi\">\n                AllowOverride All\n          </Directory>\n\n    </VirtualHost>\n\n\n\u4ee5\u4e0a\n\n\u25a0\u30c8\u30c3\u30d7\u30c9\u30e1\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b.htaccess\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u8a2d\u5b9a\nhttp://~\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u3001https://~\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n.htaccess\n# BEGIN WordPress\n<IfModule mod_rewrite.c>\nRewriteEngine On\nRewriteBase /var/www/html/public\nRewriteRule ^index\\.php$ - [L]\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteRule . /index.php [L]\n\n#---\u3053\u3053\u304b\u3089---\n#http to https \nRewriteCond %{HTTPS} off\nRewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R,L]\n#---\u3053\u3053\u307e\u3067---\n</IfModule>\n# END WordPress\n\n\n\n\u25a0\u304a\u307e\u3051\n\u6700\u521d\u306f\u8a2d\u5b9a\u306e\u8aa4\u308a\u306e\u305f\u3081\u304b\u3001httpd \u306e\u8d77\u52d5\u304c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u304a\u305d\u3089\u304f\u3001\u8a2d\u5b9a\u306e\u9014\u4e2d\u3067\u30df\u30b9\u3092\u72af\u3057\u3066\u3044\u305f\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001CSR\u306e\u518d\u4f5c\u6210\u3001\u8a3c\u660e\u66f8\u306e\u518d\u767a\u884c\u304b\u3089\u3084\u308a\u76f4\u3057\u3066\u7121\u4e8b\u30af\u30ea\u30a2\u3002\n\nerrorlog\n[warn] RSA server certificate is a CA certificate (BasicConstraints: CA == TRUE !?)\n[warn] RSA server certificate CommonName (CN) `AlphaSSL CA - SHA256 - G2' does NOT match server name!?\n[error] Unable to configure RSA server private key\n[error] SSL Library Error: 185073780 error:0B080074:x509 certificate routines:X509_check_private_key:key values mismatch\n[error] Server should be SSL-aware but has no certificate configured [Hint: SSLCertificateFile] ((null):0)\n[warn] Init: (tk2-229-24426.vs.sakura.ne.jp:443) You configured HTTP(80) on the standard HTTPS(443) port!\n\n\n### \u25a0\u74b0\u5883\n - Server version: Apache/2.2.15 (Unix)\n - OpenSSL 1.0.1e-fips 11 Feb 2013\n - VirtualHost\n    - hogehoge.com <=\u3053\u3053\u306bSSL\u8a3c\u660e\u66f8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n        - www.hogehoge.com <= \u30c8\u30c3\u30d7\u30c9\u30e1\u30a4\u30f3\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n        - watashi.hogehoge.com\n        - festival.hogehoge.com\n - SSl\u8a3c\u660e\u66f8\u306e\u8cfc\u5165\u5148\n    - KING SSL => https://www.kingssl.com/\n\n### \u25a0\u53c2\u8003\u624b\u9806\n - https://www.kingssl.com/ssl_support/technical/csr_support/csr_8.html\n - https://www.kingssl.com/ssl_support/technical/inst_support/inst_6.html\n\n\n\n```lang:vhost.conf\nNameVirtualHost *:80\nNameVirtualHost *:443\n\n#main\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/public\n        ServerName hogehoge.com\n        ServerAlias www.hogehoge.com\n\n        RewriteEngine on\n        RewriteCond %{HTTP_HOST} ^(www\\.hogehoge\\.com)(:80)? [NC]\n        RewriteRule ^/(.*) http://hogehoge.com/$1 [R=301,L]\n\n        ErrorLog /var/log/httpd/hogehoge.com/error_log\n        CustomLog /var/log/httpd/hogehoge.com/access_log combined\n\n            <Directory \"/var/www/html/public\">\n                AllowOverride All\n            </Directory>\n    </VirtualHost>\n\n#main-ssl\n    <VirtualHost *:443>\n        DocumentRoot /var/www/html/public\n        ServerName hogehoge.com:443\n        ServerAlias www.hogehoge.com\n\n       ErrorLog /var/log/httpd/hogehoge.combinedom/error_log\n        CustomLog /var/log/httpd/hogehoge.com/access_log combined\n\n        RewriteEngine on\n        RewriteCond %{HTTP_HOST} ^(www\\.hogehoge\\.com) [NC]\n        RewriteRule ^/(.*) https://hogehoge.com/$1 [R=301,L]\n\n        SSLEngine on\n        SSLCertificateChainFile /etc/httpd/conf/ssl.crt/intermediate_hogehoge.com.2016.cer\n        SSLCertificateFile /etc/httpd/conf/ssl.crt/hogehoge.com.2016.crt\n        SSLCertificateKeyFile /etc/httpd/conf/ssl.key/ssl.hogehoge.com.key\n\n            <Directory \"/var/www/html/public\">\n               AllowOverride All\n            </Directory>\n\n         SetEnvIf User-Agent \".*MSIE.*\" \\\n               nokeepalive ssl-unclean-shutdown \\\n               downgrade-1.0 force-response-1.0\n    </VirtualHost>\n\n\n#sub-festival\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/fest\n        ServerName festival.hogehoge.com\n\n        ErrorLog /var/log/httpd/festival.hogehoge.com/error_log\n        CustomLog /var/log/httpd/festival.hogehoge.com/access_log combined\n\n           <Directory \"/var/www/html/fest\">\n                AllowOverride All\n            </Directory>\n\n    </VirtualHost>\n\n#sub-watashi\n    <VirtualHost *:80>\n        DocumentRoot /var/www/html/watashi\n        ServerName watashi.hogehoge.com\n\n        ErrorLog /var/log/httpd/watashi/error_log\n        CustomLog /var/log/httpd/watashi/access_log combined\n\n          <Directory \"/var/www/html/watashi\">\n                AllowOverride All\n          </Directory>\n\n    </VirtualHost>\n```\n\u4ee5\u4e0a\n\n\n## \u25a0\u30c8\u30c3\u30d7\u30c9\u30e1\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b.htaccess\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u8a2d\u5b9a\nhttp://~\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u3001https://~\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n```lang:.htaccess\n# BEGIN WordPress\n<IfModule mod_rewrite.c>\nRewriteEngine On\nRewriteBase /var/www/html/public\nRewriteRule ^index\\.php$ - [L]\nRewriteCond %{REQUEST_FILENAME} !-f\nRewriteCond %{REQUEST_FILENAME} !-d\nRewriteRule . /index.php [L]\n\n#---\u3053\u3053\u304b\u3089---\n#http to https \nRewriteCond %{HTTPS} off\nRewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R,L]\n#---\u3053\u3053\u307e\u3067---\n</IfModule>\n# END WordPress\n```\n\n\n### \u25a0\u304a\u307e\u3051\n\u6700\u521d\u306f\u8a2d\u5b9a\u306e\u8aa4\u308a\u306e\u305f\u3081\u304b\u3001httpd \u306e\u8d77\u52d5\u304c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u304a\u305d\u3089\u304f\u3001\u8a2d\u5b9a\u306e\u9014\u4e2d\u3067\u30df\u30b9\u3092\u72af\u3057\u3066\u3044\u305f\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001CSR\u306e\u518d\u4f5c\u6210\u3001\u8a3c\u660e\u66f8\u306e\u518d\u767a\u884c\u304b\u3089\u3084\u308a\u76f4\u3057\u3066\u7121\u4e8b\u30af\u30ea\u30a2\u3002\n\n```lang:errorlog\n[warn] RSA server certificate is a CA certificate (BasicConstraints: CA == TRUE !?)\n[warn] RSA server certificate CommonName (CN) `AlphaSSL CA - SHA256 - G2' does NOT match server name!?\n[error] Unable to configure RSA server private key\n[error] SSL Library Error: 185073780 error:0B080074:x509 certificate routines:X509_check_private_key:key values mismatch\n[error] Server should be SSL-aware but has no certificate configured [Hint: SSLCertificateFile] ((null):0)\n[warn] Init: (tk2-229-24426.vs.sakura.ne.jp:443) You configured HTTP(80) on the standard HTTPS(443) port!\n```\n\n\n"}