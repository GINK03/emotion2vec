{"context": " More than 1 year has passed since last update.endpoints-proto-datastore\u306f\u3001Google Cloud Endpoints\u306e\u5b9a\u7fa9\u3092\u7701\u7565\u3067\u304d\u308b\u3001\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\nancestor\u306e\u6307\u5b9a\u65b9\u6cd5\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306ePATH\u304b\u3089ancestor\u3092\u6307\u5b9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n  @MyModel.query_method(query_fields=('parent',),\n                        path='mymodels/{parent}', name='mymodel.list')\n  def MyModelList(self, query):\n    return query\n\n\u3057\u304b\u3057\u3053\u306e\u30b3\u30fc\u30c9\u306f\u3001\u305d\u3082\u305d\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cancestor\u3068\u3057\u3066\u6709\u52b9\u306a\u5024\u3092\u77e5\u308a\u5f97\u306a\u3044\u30b1\u30fc\u30b9\u3067\u306f\u3001\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\u307e\u305f\u3001ancestor\u306fQuery\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001Query\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306efilter\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u6307\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\n\u3088\u3063\u3066\u3001EndpointsModel.query_method\u304c\u8fd4\u3059query\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u64cd\u4f5c\u3057\u3066\u3082\u3001ancestor\u3092\u6307\u5b9a\u3059\u308b\u51e6\u7406\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u4f8b\u3048\u3070\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306eGoogle OAuth2.0\u8a8d\u8a3c\u306b\u57fa\u3044\u3066ancestor\u5024\u304c\u6c7a\u5b9a\u3059\u308b\u5834\u5408\u3001\u3064\u304e\u306e\u3088\u3046\u306bModel\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067_EndpointsQueryInfo\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e_GetAncestor\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u3001\u3046\u307e\u304f\u52d5\u304d\u307e\u3059\u3002\ndef get_ancestor_key_by_oauth(_self=None):\n  user = endpoints.get_current_user()\n  if user is None:\n    raise endpoints.UnauthorizedException('Unauthorized')\n  ancestor_key = get_ancestor_key(user.id())\n  if ancestor_key is None:\n    raise endpoints.UnauthorizedException('Unauthorized')\n  return ancestor_key\n\n\nclass MyModel(EndpointsModel):\n\n  @classmethod\n  def new(cls):\n    ancestor_key = get_ancestor_key_by_oauth()\n    return cls(parent=ancestor_key)\n\n  def __init__(self, *args, **kwargs):\n    super(self.__class__, self).__init__(*args, **kwargs)\n    self._endpoints_query_info._GetAncestor = get_ancestor_key_by_oauth\n\n  @MyModel.query_method(\n    query_fields=('limit', 'pageToken'),\n    user_required=True,\n    auth_level=endpoints.AUTH_LEVEL.REQUIRED,\n  )\n  def MyModelList(self, query):\n    return query\n\n\n[endpoints-proto-datastore](https://github.com/GoogleCloudPlatform/endpoints-proto-datastore)\u306f\u3001[Google Cloud Endpoints](https://cloud.google.com/appengine/docs/python/endpoints)\u306e\u5b9a\u7fa9\u3092\u7701\u7565\u3067\u304d\u308b\u3001\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\n## ancestor\u306e\u6307\u5b9a\u65b9\u6cd5\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306ePATH\u304b\u3089`ancestor`\u3092\u6307\u5b9a\u3059\u308b[\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](http://endpoints-proto-datastore.appspot.com/examples/keys_with_ancestors.html)\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```python\n  @MyModel.query_method(query_fields=('parent',),\n                        path='mymodels/{parent}', name='mymodel.list')\n  def MyModelList(self, query):\n    return query\n```\n\n\u3057\u304b\u3057\u3053\u306e\u30b3\u30fc\u30c9\u306f\u3001\u305d\u3082\u305d\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c`ancestor`\u3068\u3057\u3066\u6709\u52b9\u306a\u5024\u3092\u77e5\u308a\u5f97\u306a\u3044\u30b1\u30fc\u30b9\u3067\u306f\u3001\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u307e\u305f\u3001`ancestor`\u306f`Query`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001`Query`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e`filter`\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u6307\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\n\u3088\u3063\u3066\u3001`EndpointsModel.query_method`\u304c\u8fd4\u3059`query`\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u64cd\u4f5c\u3057\u3066\u3082\u3001`ancestor`\u3092\u6307\u5b9a\u3059\u308b\u51e6\u7406\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u4f8b\u3048\u3070\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306eGoogle OAuth2.0\u8a8d\u8a3c\u306b\u57fa\u3044\u3066`ancestor`\u5024\u304c\u6c7a\u5b9a\u3059\u308b\u5834\u5408\u3001\u3064\u304e\u306e\u3088\u3046\u306b`Model`\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067`_EndpointsQueryInfo`\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e`_GetAncestor`\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u3001\u3046\u307e\u304f\u52d5\u304d\u307e\u3059\u3002\n\n```python\ndef get_ancestor_key_by_oauth(_self=None):\n  user = endpoints.get_current_user()\n  if user is None:\n    raise endpoints.UnauthorizedException('Unauthorized')\n  ancestor_key = get_ancestor_key(user.id())\n  if ancestor_key is None:\n    raise endpoints.UnauthorizedException('Unauthorized')\n  return ancestor_key\n\n\nclass MyModel(EndpointsModel):\n\n  @classmethod\n  def new(cls):\n    ancestor_key = get_ancestor_key_by_oauth()\n    return cls(parent=ancestor_key)\n\n  def __init__(self, *args, **kwargs):\n    super(self.__class__, self).__init__(*args, **kwargs)\n    self._endpoints_query_info._GetAncestor = get_ancestor_key_by_oauth\n```\n```python\n  @MyModel.query_method(\n    query_fields=('limit', 'pageToken'),\n    user_required=True,\n    auth_level=endpoints.AUTH_LEVEL.REQUIRED,\n  )\n  def MyModelList(self, query):\n    return query\n```\n", "tags": ["Python", "GAE", "GoogleCloudEndpoints"]}