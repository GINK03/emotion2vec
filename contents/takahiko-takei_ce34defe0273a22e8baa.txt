{"context": "\n\n\u524d\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(4) MariaDB\u3068PHP\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nLet'sEncrypt\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u6240\u306f\u3069\u3053\u3067\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306f\u7fd2\u6163\u7684\u306a\u610f\u5473\u3067/usr/local/\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\ncd /usr/local/\ngit clone https://github.com/letsencrypt/letsencrypt\n\nletsencrypt-auto\u3092\u5b9f\u884c\u3057\u3001\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f--help\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5fc5\u305a\u8a18\u8ff0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3002\n\ncd /usr/local/letsencrypt\n./letsencrypt-auto --help\n\n--help all\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3068\u8a73\u7d30\u306a\u30d8\u30eb\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002(\u3082\u3061\u308d\u3093\u82f1\u8a9e\u8868\u8a18)\n./letsencrypt-auto --help all\n\n\n\nNginx\u306bACME\u30d7\u30ed\u30c8\u30b3\u30eb\u901a\u4fe1\u7528\u306e\u30c0\u30df\u30fc\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\nACME\u30d7\u30ed\u30c8\u30b3\u30eb\u901a\u4fe1\u304c\u3042\u3063\u305f\u5834\u5408\u306b404\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3068\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5c02\u7528\u306e\u30c0\u30df\u30fc\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u30c0\u30df\u30fc\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u5f8c\u3001Nginx\u306e\u8a2d\u5b9a\u306b\u5c02\u7528\u306elocation\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u52a0\u3048\u307e\u3059\u3002\n\nmkdir -p /letsencrypt-dummy-webroot\nvi /etc/nginx/conf.d/default.conf\n\n\n/etc/nginx/conf.d/default.conf\n  server {\n      listen      80;\n      server_name example.com www.example.com;\n      :\n+     location ^~ /.well-known/ {\n+          root /letsencrypt-dummy-webroot;\n+     }\n\n      location / {\n      :\n  }\n\n\n\n\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5b9f\u884c\u3057\u3066\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n--webroot\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7528\u3044\u3066\u3001HTTP\u30b5\u30fc\u30d0\u3092\u52d5\u4f5c\u3055\u305b\u305f\u307e\u307eACME\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u901a\u4fe1\u3092\u884c\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001-d\u30aa\u30d7\u30b7\u30e7\u30f3MY_DOMAIN\u306e\u90e8\u5206\u306b\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u305f\u3044\u30c9\u30e1\u30a4\u30f3\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n-d\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u8907\u6570\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306b\u5bfe\u5fdc\u3057\u305f\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3067\u304d\u307e\u3059\u3002(\u4f8b: example.com\u3068www.example.com\u306a\u3069)\n--agree-tos\u30aa\u30d7\u30b7\u30e7\u30f3\u3067Let's Encrypt\u306e\u5229\u7528\u898f\u7d04\u306b\u540c\u610f\u3057\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u4e8b\u524d\u306b\u5229\u7528\u898f\u7d04\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n./letsencrypt-auto certonly --webroot \\\n-w /letsencrypt-dummy-webroot \\\n-d example.com \\\n-d www.example.com \\\n-m info@example.com \\\n--agree-tos\n\n\n\u5b9f\u884c\u7d50\u679c\nChecking for new version...\nRequesting root privileges to run letsencrypt...\n   /root/.local/share/letsencrypt/bin/letsencrypt certonly --webroot -w /letsencrypt-dummy-webroot -d example.com -d www.example.com -m info@example.com --agree-tos\n/root/.local/share/letsencrypt/lib/python2.6/site-packages/cryptography/__init__.py:26: DeprecationWarning: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. A future version of cryptography will drop support for Python 2.6\n  DeprecationWarning\nVersion: 1.1-20080819\nVersion: 1.1-20080819\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/example.com/fullchain.pem. Your cert will\n   expire on 2016-07-23. To obtain a new version of the certificate in\n   the future, simply run Let's Encrypt again.\n - If you like Let's Encrypt, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n\n\n\n\n\u3053\u306e\u5b9f\u884c\u7d50\u679c\u3067\u306fPython2.6\u306eWarning\u304c\u51fa\u3066\u3044\u307e\u3059\u304c\u8a3c\u660e\u66f8\u306e\u767a\u884c\u306b\u306f\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u6b63\u5f0f\u7248\u3067\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u305f\u3060Warning\u306e\u5185\u5bb9\u898b\u308b\u9650\u308a\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u65b9\u304c\u3088\u3044\u611f\u3058\u3067\u3059\u3002\n\u524d\u56de\u3067anyenv\u3092\u5165\u308c\u3066\u3042\u308b\u306e\u3067\u3001pyenv\u3067Python2.7\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n\u767a\u884c\u3057\u305f\u8a3c\u660e\u66f8\u3067Nginx\u306eSSL+HTTP/2\u8a2d\u5b9a\nNginx\u306eSSL+HTTP/2\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n80\u756a(http)\u3067\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u969b\u306bhttps\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308bserver\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u6ce8\u610f\u70b9\nSSLv1.0\u301cv3.0\u306f\u3059\u3079\u3066\u6df1\u523b\u306a\u8106\u5f31\u6027\u304c\u3042\u308b\u305f\u3081\u4f7f\u7528\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\nvi /etc/nginx/conf.d/default.conf\n\n\n/etc/nginx/conf.d/default.conf\n  server {\n      listen      80;\n      server_name example.com www.example;\n+     return      301 https://$host$request_uri;\n+ }\n+ server {\n+     listen      443 ssl http2;\n+     server_name example.com www.example;\n      :\n+     ssl                 on;\n+     ssl_certificate     /etc/letsencrypt/live/example.com/fullchain.pem;\n+     ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\n+ \n+     ssl_session_cache   shared:SSL:3m;\n+     ssl_buffer_size     8k;\n+     ssl_session_timeout 10m;\n+ \n+     ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n+     ssl_ciphers         AESGCM:HIGH:!aNULL:!MD5;\n+     ssl_prefer_server_ciphers on;\n      :\n      location / {\n          proxy_set_header Host               $host;\n          proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Proto  https;\n          proxy_set_header X-Forwarded-Host   $host;\n          proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n\n          proxy_pass http://127.0.0.1:8080;\n-         proxy_redirect off;\n+         proxy_redirect http:// https://;\n          :\n  }\n\n\n\nApache\u306eSSL\u8a2d\u5b9a\nNginx\u304b\u3089\u53d7\u3051\u53d6\u3063\u305fSSL\u30ea\u30af\u30a8\u30b9\u30c8\u3092Apache\u3067\u6b63\u3057\u304f\u8a8d\u8b58\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nvi /etc/httpd/conf/httpd.conf\n\n\n/etc/httpd/conf/httpd.conf\n  :\n  <VirtualHost 127.0.0.1:8080>\n      :\n      RPAF_SetHostName On\n+     RPAF_SetHTTPS On\n      RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n      :\n  </VirtualHost>\n  :\n\n\n\u3053\u308c\u3067phpinfo()\u306a\u3069\u3067HTTPS\u304con\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u51fa\u6765\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\nSSL\u306f\u305f\u3060\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u3044\nSSL\u306f\u305f\u3060\u5c0e\u5165\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5ea6\u306e\u5411\u4e0a\u306a\u3069\u306e\u8a2d\u5b9a\u3082\u8272\u3005\u884c\u3044\u5f37\u56fa\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c9\u30e1\u30a4\u30f3\u3067\u306eSSL\u306e\u8a55\u4fa1\u306fQualys SSL Test\u3067\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fSSL\u5c0e\u5165\u306e\u307f\u306e\u89e3\u8aac\u306e\u305f\u3081\u5272\u611b\u3057\u307e\u3059\u304c\u3001\u51fa\u6765\u308b\u3060\u3051A+\u306b\u8fd1\u3044\u8a55\u4fa1\u3092\u5f97\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u4ed6\u306e\u65b9\u306e\u8a18\u4e8b\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308b\u304b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\u53c2\u8003: Let's Encrypt\u306eSSL\u8a3c\u660e\u66f8\u3067\u3001Qualys SSLTest\u3067A+\u8a55\u4fa1\u3092\u7372\u5f97\u3059\u308b\u306b\u306f\n\n\n\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3068Nginx\u306e\u518d\u8d77\u52d5\u3092cron\u306b\u767b\u9332\u3059\u308b\n\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3068Nginx\u306e\u518d\u8d77\u52d5\u3092\u5b9a\u671f\u7684\u306b\u884c\u3046cron\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u6bce\u67081\u65e5\u306e\u671d5\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\ncrontab -u root -e\n\n\ncrontab\n+ 00 05 01 * * /usr/local/letsencrypt/letsencrypt-auto renew --force-renew && /sbin/service nginx restart\n\n\n\n\u6b21\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(6) Nginx\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u74b0\u5883\u3067\u306eGitLab\u306e\u5c0e\u5165\n## \u524d\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(4) MariaDB\u3068PHP\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7](http://qiita.com/takahiko-takei/items/bcbfc8195188a3bce6d7)\n\n\n## Let'sEncrypt\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u6240\u306f\u3069\u3053\u3067\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306f\u7fd2\u6163\u7684\u306a\u610f\u5473\u3067`/usr/local/`\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `cd /usr/local/`\n> `git clone https://github.com/letsencrypt/letsencrypt`\n\n`letsencrypt-auto`\u3092\u5b9f\u884c\u3057\u3001\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f`--help`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092**\u5fc5\u305a**\u8a18\u8ff0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3002\n\n> `cd /usr/local/letsencrypt`\n> `./letsencrypt-auto --help`\n> > `--help all`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b\u3068\u8a73\u7d30\u306a\u30d8\u30eb\u30d7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002(\u3082\u3061\u308d\u3093\u82f1\u8a9e\u8868\u8a18)\n> > `./letsencrypt-auto --help all`\n\n\n## Nginx\u306bACME\u30d7\u30ed\u30c8\u30b3\u30eb\u901a\u4fe1\u7528\u306e\u30c0\u30df\u30fc\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\n\nACME\u30d7\u30ed\u30c8\u30b3\u30eb\u901a\u4fe1\u304c\u3042\u3063\u305f\u5834\u5408\u306b404\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3068\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5c02\u7528\u306e\u30c0\u30df\u30fc\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u30c0\u30df\u30fc\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u5f8c\u3001`Nginx`\u306e\u8a2d\u5b9a\u306b\u5c02\u7528\u306e`location`\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u52a0\u3048\u307e\u3059\u3002\n\n> `mkdir -p /letsencrypt-dummy-webroot`\n> `vi /etc/nginx/conf.d/default.conf`\n\n```diff:/etc/nginx/conf.d/default.conf\n  server {\n      listen      80;\n      server_name example.com www.example.com;\n      :\n+     location ^~ /.well-known/ {\n+          root /letsencrypt-dummy-webroot;\n+     }\n\n      location / {\n      :\n  }\n```\n\n\n## \u8a3c\u660e\u66f8\u306e\u53d6\u5f97\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5b9f\u884c\u3057\u3066\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n`--webroot`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u7528\u3044\u3066\u3001HTTP\u30b5\u30fc\u30d0\u3092\u52d5\u4f5c\u3055\u305b\u305f\u307e\u307eACME\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u901a\u4fe1\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u307e\u305f\u3001`-d`\u30aa\u30d7\u30b7\u30e7\u30f3`MY_DOMAIN`\u306e\u90e8\u5206\u306b\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u305f\u3044\u30c9\u30e1\u30a4\u30f3\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n`-d`\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u8907\u6570\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306b\u5bfe\u5fdc\u3057\u305f\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3067\u304d\u307e\u3059\u3002(\u4f8b: example.com\u3068www.example.com\u306a\u3069)\n\n`--agree-tos`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067Let's Encrypt\u306e\u5229\u7528\u898f\u7d04\u306b\u540c\u610f\u3057\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u4e8b\u524d\u306b[\u5229\u7528\u898f\u7d04](https://letsencrypt.org/repository/)\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n> `./letsencrypt-auto certonly --webroot \\`\n> `-w /letsencrypt-dummy-webroot \\`\n> `-d example.com \\`\n> `-d www.example.com \\`\n> `-m info@example.com \\`\n> `--agree-tos`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nChecking for new version...\nRequesting root privileges to run letsencrypt...\n   /root/.local/share/letsencrypt/bin/letsencrypt certonly --webroot -w /letsencrypt-dummy-webroot -d example.com -d www.example.com -m info@example.com --agree-tos\n/root/.local/share/letsencrypt/lib/python2.6/site-packages/cryptography/__init__.py:26: DeprecationWarning: Python 2.6 is no longer supported by the Python core team, please upgrade your Python. A future version of cryptography will drop support for Python 2.6\n  DeprecationWarning\nVersion: 1.1-20080819\nVersion: 1.1-20080819\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/example.com/fullchain.pem. Your cert will\n   expire on 2016-07-23. To obtain a new version of the certificate in\n   the future, simply run Let's Encrypt again.\n - If you like Let's Encrypt, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n\n```\n\n> \u3053\u306e\u5b9f\u884c\u7d50\u679c\u3067\u306f`Python2.6`\u306eWarning\u304c\u51fa\u3066\u3044\u307e\u3059\u304c\u8a3c\u660e\u66f8\u306e\u767a\u884c\u306b\u306f\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n> \u6b63\u5f0f\u7248\u3067\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\u305f\u3060Warning\u306e\u5185\u5bb9\u898b\u308b\u9650\u308a\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u65b9\u304c\u3088\u3044\u611f\u3058\u3067\u3059\u3002\n> \u524d\u56de\u3067`anyenv`\u3092\u5165\u308c\u3066\u3042\u308b\u306e\u3067\u3001`pyenv`\u3067`Python2.7`\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n## \u767a\u884c\u3057\u305f\u8a3c\u660e\u66f8\u3067Nginx\u306eSSL+HTTP/2\u8a2d\u5b9a\n\n`Nginx`\u306e`SSL`+`HTTP/2`\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n`80\u756a(http)`\u3067\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u969b\u306b`https`\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b`server`\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3082\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n**\u6ce8\u610f\u70b9**\nSSLv1.0\u301cv3.0\u306f\u3059\u3079\u3066\u6df1\u523b\u306a\u8106\u5f31\u6027\u304c\u3042\u308b\u305f\u3081\u4f7f\u7528\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n> `vi /etc/nginx/conf.d/default.conf`\n\n```diff:/etc/nginx/conf.d/default.conf\n  server {\n      listen      80;\n      server_name example.com www.example;\n+     return      301 https://$host$request_uri;\n+ }\n+ server {\n+     listen      443 ssl http2;\n+     server_name example.com www.example;\n      :\n+     ssl                 on;\n+     ssl_certificate     /etc/letsencrypt/live/example.com/fullchain.pem;\n+     ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;\n+ \n+     ssl_session_cache   shared:SSL:3m;\n+     ssl_buffer_size     8k;\n+     ssl_session_timeout 10m;\n+ \n+     ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;\n+     ssl_ciphers         AESGCM:HIGH:!aNULL:!MD5;\n+     ssl_prefer_server_ciphers on;\n      :\n      location / {\n          proxy_set_header Host               $host;\n          proxy_set_header X-Real-IP          $remote_addr;\n+         proxy_set_header X-Forwarded-Proto  https;\n          proxy_set_header X-Forwarded-Host   $host;\n          proxy_set_header X-Forwarded-For    $proxy_add_x_forwarded_for;\n\n          proxy_pass http://127.0.0.1:8080;\n-         proxy_redirect off;\n+         proxy_redirect http:// https://;\n          :\n  }\n```\n\n\n## Apache\u306eSSL\u8a2d\u5b9a\n\n`Nginx`\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f`SSL`\u30ea\u30af\u30a8\u30b9\u30c8\u3092`Apache`\u3067\u6b63\u3057\u304f\u8a8d\u8b58\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n> `vi /etc/httpd/conf/httpd.conf`\n\n```diff:/etc/httpd/conf/httpd.conf\n  :\n  <VirtualHost 127.0.0.1:8080>\n      :\n      RPAF_SetHostName On\n+     RPAF_SetHTTPS On\n      RPAF_ProxyIPs 127.0.0.1 10.0.0.1\n      :\n  </VirtualHost>\n  :\n```\n\n\u3053\u308c\u3067`phpinfo()`\u306a\u3069\u3067`HTTPS`\u304c`on`\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u51fa\u6765\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\n\n## SSL\u306f\u305f\u3060\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u3044\n\nSSL\u306f\u305f\u3060\u5c0e\u5165\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5f37\u5ea6\u306e\u5411\u4e0a\u306a\u3069\u306e\u8a2d\u5b9a\u3082\u8272\u3005\u884c\u3044\u5f37\u56fa\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c9\u30e1\u30a4\u30f3\u3067\u306eSSL\u306e\u8a55\u4fa1\u306f[Qualys SSL Test](https://www.ssllabs.com/ssltest/analyze.html)\u3067\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fSSL\u5c0e\u5165\u306e\u307f\u306e\u89e3\u8aac\u306e\u305f\u3081\u5272\u611b\u3057\u307e\u3059\u304c\u3001\u51fa\u6765\u308b\u3060\u3051A+\u306b\u8fd1\u3044\u8a55\u4fa1\u3092\u5f97\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n> \u4ed6\u306e\u65b9\u306e\u8a18\u4e8b\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308b\u304b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n> \u53c2\u8003: [Let's Encrypt\u306eSSL\u8a3c\u660e\u66f8\u3067\u3001Qualys SSLTest\u3067A+\u8a55\u4fa1\u3092\u7372\u5f97\u3059\u308b\u306b\u306f](http://qiita.com/dseg/items/bab80f6f14349fcd9c22)\n\n\n## \u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3068Nginx\u306e\u518d\u8d77\u52d5\u3092cron\u306b\u767b\u9332\u3059\u308b\n\n\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3068Nginx\u306e\u518d\u8d77\u52d5\u3092\u5b9a\u671f\u7684\u306b\u884c\u3046`cron`\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u6bce\u67081\u65e5\u306e\u671d5\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n> `crontab -u root -e`\n\n```diff:crontab\n+ 00 05 01 * * /usr/local/letsencrypt/letsencrypt-auto renew --force-renew && /sbin/service nginx restart\n```\n\n\n## \u6b21\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(6) Nginx\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u74b0\u5883\u3067\u306eGitLab\u306e\u5c0e\u5165](http://qiita.com/takahiko-takei/items/16dd7a2845ec7f6b0be7)\n", "tags": ["\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9", "\u3055\u304f\u3089\u306eVPS", "CentOS6.x", "letsencrypt", "http2"]}