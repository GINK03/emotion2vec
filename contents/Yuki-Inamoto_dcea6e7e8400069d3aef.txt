{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u306f\u3001CentOS7\u3067DRBD9\u306e\u74b0\u5883\u69cb\u7bc9\u306e\u7d9a\u304d\u3067\u3001\u69cb\u7bc9\u3057\u305f\u74b0\u5883\u3067DRBD9\u306e\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8a66\u3059\u8a18\u4e8b\u3067\u3059\u3002\n\n\u53c2\u8003\n\nDRBD9\u7279\u96c6\nThe DRBD User\u2019s Guide\nDRBD Source\n\n\nDRBD Client\n\n\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044DRBD\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044DRBD\u30ce\u30fc\u30c9\u3092DRBD Client\u3068\u547c\u3076\n\u4e0a\u3067\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306bdrbd9-04\u3001drbd9-05\u3092DRBD Client\u3068\u3057\u3066\u8ffd\u52a0\u3059\u308b\ndrbd9-04\u306eip\u30a2\u30c9\u30ec\u30b9\u306f10.255.10.14\ndrbd9-05\u306eip\u30a2\u30c9\u30ec\u30b9\u306f10.255.10.15\n\n\n\u6ce8\u610f\ndrbdmanage\u3092\u4f7f\u3063\u305f\u3001DRBD Client\u306e\u5229\u7528\u65b9\u6cd5\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u306f\u57f7\u7b46\u6642(2015/9/30\u73fe\u5728)\u8f09\u3063\u3066\u3044\u306a\u3044(\u3067\u304d\u308b\u3068\u306f\u66f8\u3044\u3066\u3044\u308b)\u306e\u3067\u3001\u516c\u5f0f\u3067Client\u306e\u4f5c\u308a\u65b9\u304c\u51fa\u3066\u304d\u305f\u3089\u305d\u3061\u3089\u306e\u65b9\u3092\u53c2\u8003\u306b\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\ndrbd9-04\u3001drbd9-05\u306fdrbdmanage\u306b\u3088\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30c7\u30d7\u30ed\u30a4\u306e\u30dd\u30fc\u30c8\u306e\u89e3\u653e\u307e\u3067\u7d42\u308f\u3063\u3066\u3044\u308b\n\n\n\u30af\u30e9\u30b9\u30bf\u306b\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u6301\u305f\u306a\u3044\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\n\naddnode \u306b -s \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u3057\u306e\u30ce\u30fc\u30c9\u304c\u8ffd\u52a0\u53ef\u80fd\n\ndrbd9-04\u4ee5\u5916\u306e\u3069\u308c\u304b1\u53f0\u3067\u5b9f\u884c\n# drbdmanage add-node drbd9-04 10.255.10.14 -s\n    Operation completed successfull\n    Operation completed successfully\n    Host key verification failed.\n\n    Join command for node drbd9-05:\n    drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 {SecretKey}\n\ndrbd9-04\u3067\u5b9f\u884c\n# drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 {SecretKey}\n\ndrbd9-05\u3067\u3082\u540c\u69d8\u306b\u884c\u3046\n\n\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044\u30ce\u30fc\u30c9\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\ndrbd9-04\u3067\u5b9f\u884c\n# drbdmanage add-volume client 5GB --deploy 3\n# drbdmanage n\n        +------------------------------------------------------------------------------+\n       | Name     | Pool Size | Pool Free |                              |      State |\n       +------------------------------------------------------------------------------+\n       | drbd9-01 |     16380 |      8740 |                              |         ok |\n       | drbd9-02 |     16380 |      8740 |                              |         ok |\n       | drbd9-03 |     16380 |      8740 |                              |         ok |\n       | drbd9-04 |   unknown |   unknown |                              | no storage |\n       | drbd9-05 |   unknown |   unknown |                              | no storage |\n       +------------------------------------------------------------------------------+\n\n# drbdmanage r\n        +------------------------------------------------------------------------------+\n        | Name    |                                                            | State |\n        +------------------------------------------------------------------------------+\n        | backups |                                                            |    ok |\n        | client  |                                                            |    ok |\n        +------------------------------------------------------------------------------+\n\n\n\u6ce8\u610f\n\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044\u30ce\u30fc\u30c9\u304b\u3089volume\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001default\u3067\u958b\u3051\u3089\u308c\u308bvolume\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u304c7000\u756a\u304b\u3089\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u306a\u306e\u3067\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u65b0\u305f\u306b7000\u756a\u304b\u30897100\u756a\u304f\u3089\u3044\u307e\u3067\u306e\u30dd\u30fc\u30c8\u3092\u958b\u3051\u3066\u304a\u304f\u3002\n\n\ndrbdmanage\u306e\u30d0\u30fc\u30b8\u30e7\u30f30.50\u304b\u3089\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u5272\u308a\u5f53\u3066\u306e\u6709\u7121\u306b\u95a2\u4fc2\u306a\u304f\u30dd\u30fc\u30c8\u756a\u53f77000\u756a\u304b\u3089\u958b\u3051\u3089\u308c\u307e\u3059\n    # firewall-cmd --add-port=7000-7100/tcp --zone=public --permanent\n    # firewall-cmd --reload\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u306bDRBD client\u3068\u3057\u3066\u5272\u308a\u5f53\u3066\n\n\u4f5c\u6210\u3057\u305fclient\u30dc\u30ea\u30e5\u30fc\u30e0\u306bdrbd9-04\u3001drbd9-05\u306f\u5272\u308a\u5f53\u3066\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5272\u308a\u5f53\u3066\u308b\n\nassign\u3059\u308b\u3068\u304d\u306b\u3001client\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001DRBD Client\u3068\u3057\u3066\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n# drbdmanage assign client drbd9-04 --client\n# drbdmanage assign client drbd9-05 --client\n\n\n\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4f5c\u6210\u3068\u30de\u30a6\u30f3\u30c8\n\nMinor\u306e\u756a\u53f7\u306fclient\u5074\u304b\u3089\u4f5c\u6210\u3059\u308b\u3068\u3001100\u304b\u3089\u6607\u9806\u306b\u306a\u308b\n\ndrbd9-04\u3067\u5b9f\u884c\n# drbdmanage list-volumes --groupby Size --show Port\n    +------------------------------------------------------------------------------+\n    | Name    | Vol ID | Size | Minor | Port |                             | State |\n    +------------------------------------------------------------------------------+\n    | backups |      0 | 2861 |    10 | 7700 |                             |    ok |\n    | client  |      0 | 4768 |   100 | 7000 |                             |    ok |\n    +------------------------------------------------------------------------------+\n# mke2fs -j /dev/drbd100\n# mkdir -p /mnt/drbd/client\n# drbdsetup status\n    .drbdctrl role:Secondary\n      disk:UpToDate\n      drbd9-01 role:Secondary\n        peer-disk:UpToDate\n      drbd9-03 role:Secondary\n        peer-disk:UpToDate\n      drbd9-04 role:Secondary\n        peer-disk:UpToDate\n      drbd9-05 role:Secondary\n        peer-disk:UpToDate\n\n    backups role:Secondary\n      disk:UpToDate\n      drbd9-01 role:Primary\n        peer-disk:UpToDate\n      drbd9-03 role:Secondary\n        peer-disk:UpToDate\n\n    client role:Secondary\n      disk:UpToDate\n      drbd9-01 role:Secondary\n        peer-disk:UpToDate\n      drbd9-03 role:Secondary\n        peer-disk:UpToDate\n      drbd9-04 role:Secondary\n        peer-disk:Diskless\n      drbd9-05 role:Secondary\n        peer-disk:Diskless\n# mount /dev/drbd100 /mnt/drbd/client\n\n\n\n\n\u30c7\u30fc\u30bf\u306e\u518d\u914d\u7f6e\n\nDRBD9\u3067\u306f\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u4fdd\u969c\u3059\u308b\u305f\u3081\u306e\u3001\u30c7\u30fc\u30bf\u518d\u914d\u7f6e\u6a5f\u80fd\u304c\u3042\u308b\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u3001drbd9-01,02,03\u306e\u30ce\u30fc\u30c9\u304c\u3042\u308adrbd client\u3068\u3057\u3066drbd9-05\u304c\u3042\u308b\u3002\n\u3059\u3067\u306b\u3001drbd9-01,02,03\u306b\u306f\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u3053\u3053\u3067\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u306f\u6307\u5b9a\u304c\u306a\u3044\u9650\u308adrbd9-05\u3067\u884c\u3046\u3002\n# drbdmanage list-volumes --groupby Size --show Port\n    +------------------------------------------------------------------------------+\n    | Name    | Vol ID | Size | Minor | Port |                             | State |\n    +------------------------------------------------------------------------------+\n    | db      |      0 | 3814 |   102 | 7002 |                             |    ok |\n    | backups |      0 | 4768 |   100 | 7000 |                             |    ok |\n    | app     |      0 | 6675 |   101 | 7001 |                             |    ok |\n    +------------------------------------------------------------------------------+\n# drbdmanage list-assignments\n    +------------------------------------------------------------------------------+\n    | Node     | Resource | Vol ID |                                       | State |\n    +------------------------------------------------------------------------------+\n    | drbd9-01 | backups  |      * |                                       |    ok |\n    | drbd9-01 | db       |      * |                                       |    ok |\n    | drbd9-02 | app      |      * |                                       |    ok |\n    | drbd9-02 | backups  |      * |                                       |    ok |\n    | drbd9-02 | db       |      * |                                       |    ok |\n    | drbd9-03 | app      |      * |                                       |    ok |\n    | drbd9-03 | backups  |      * |                                       |    ok |\n    +------------------------------------------------------------------------------+\n\n\nlist-assignments\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306b\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u304b\u4e00\u89a7\u8868\u793a\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3042\u308b\u3002\nlist-assignments\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u7701\u7565\u8868\u8a18a\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u30ea\u30bd\u30fc\u30b9\u306f\u4e0a\u8868\u306e\u3088\u3046\u306b\u5272\u308a\u5f53\u3066\u3055\u308c\u3066\u3044\u308b\n# drbdmanage n\n    +------------------------------------------------------------------------------+\n    | Name     | Pool Size | Pool Free |                              |      State |\n    +------------------------------------------------------------------------------+\n    | drbd9-01 |     16380 |      7788 |                              |         ok |\n    | drbd9-02 |     16380 |      1108 |                              |         ok |\n    | drbd9-03 |     16380 |      4924 |                              |         ok |\n    | drbd9-05 |   unknown |   unknown |                              | no storage |\n    +------------------------------------------------------------------------------+\n\n\n\n\u3053\u3053\u306bdrbd9-04\u3068\u3044\u3046\u30ce\u30fc\u30c9\u3092\u65b0\u305f\u306b\u30af\u30e9\u30b9\u30bf\u3078\u8ffd\u52a0\u3059\u308b\n# drbdmanage add-node drbd9-04 10.255.10.14\n\n\n\ndrbd9-04\u3067\n# drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 SecretKey\n\n\n\napp\u3068backups\u306e\u30ea\u30bd\u30fc\u30b9\u3092drbd9-04\u3078\u79fb\u52d5\u3055\u305b\u308b\n# drbdmanage n\n    +------------------------------------------------------------------------------+\n    | Name     | Pool Size | Pool Free |                              |      State |\n    +------------------------------------------------------------------------------+\n    | drbd9-01 |     16380 |      7788 |                              |         ok |\n    | drbd9-02 |     16380 |      1108 |                              |         ok |\n    | drbd9-03 |     16380 |      4924 |                              |         ok |\n    | drbd9-04 |     16380 |     16376 |                              |         ok |\n    | drbd9-05 |   unknown |   unknown |                              | no storage |\n    +------------------------------------------------------------------------------+\n# drbdmanage assign-resource backups drbd9-04\n# drbdmanage assign-resource app drbd9-04\n# drbdmanage deploy backups 3\n# drbdmanage deploy app 2\n# drbdmanage n\n    +------------------------------------------------------------------------------+\n    | Name     | Pool Size | Pool Free |                              |      State |\n    +------------------------------------------------------------------------------+\n    | drbd9-01 |     16380 |      7788 |                              |         ok |\n    | drbd9-02 |     16380 |      7788 |                              |         ok |\n    | drbd9-03 |     16380 |      9696 |                              |         ok |\n    | drbd9-04 |     16380 |      4924 |                              |         ok |\n    | drbd9-05 |   unknown |   unknown |                              | no storage |\n    +------------------------------------------------------------------------------+\n# drbdmanage a\n    +------------------------------------------------------------------------------+\n    | Node     | Resource | Vol ID |                                       | State |\n    +------------------------------------------------------------------------------+\n    | drbd9-01 | backups  |      * |                                       |    ok |\n    | drbd9-01 | db       |      * |                                       |    ok |\n    | drbd9-02 | backups  |      * |                                       |    ok |\n    | drbd9-02 | db       |      * |                                       |    ok |\n    | drbd9-03 | app      |      * |                                       |    ok |\n    | drbd9-04 | app      |      * |                                       |    ok |\n    | drbd9-04 | backups  |      * |                                       |    ok |\n    +------------------------------------------------------------------------------+\n\n\ndrbdmanage\u3092\u7528\u3044\u3066\u3001\u660e\u793a\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u52d5\u304b\u3059\u65b9\u6cd5(drbd9-01\u306ebackup\u3092drbd9-04\u306b\u52d5\u304b\u3059\u307f\u305f\u3044\u306a)\u306f\u7121\u3044?\n\n\u4eca\u306e\u3068\u3053\u308d\u3001\u65b0\u3057\u304fassign\u3057\u305f\u30ce\u30fc\u30c9\u304c\u512a\u5148\u7684\u306bdeploy\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3060\u3002\n\n\u7a7a\u304d\u30b9\u30c8\u30ec\u30fc\u30b8\u91cf\u3092\u8003\u616e\u3057\u3066\u884c\u3063\u3066\u3044\u308b\u306e\u3067\u306f\u306a\u3044?\n\u4e0a\u8a18\u306e\u72b6\u614b\u304b\u3089\u3001db\u30dc\u30ea\u30e5\u30fc\u30e0\u3082drbd9-04\u3078assign\u3057\u305f\u5f8cdeploy\u3057\u305f\u3068\u3053\u308d\u300104\u3078db\u304c\u79fb\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\n\n\n\n\u7d42\u308f\u308a\u306b\n\u307e\u3060\u3001drbdmanage\u3092\u4f7f\u3063\u305f\u3001DRBD client\u3001\u30c7\u30fc\u30bf\u306e\u518d\u914d\u7f6e\u306e\u516c\u5f0f\u306a\u624b\u9806\u304c\u793a\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u3068\u306a\u304f\u65b0\u6a5f\u80fd\u306e\u5229\u7528\u65b9\u6cd5\u304c\u308f\u304b\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u306f\u3001[CentOS7\u3067DRBD9\u306e\u74b0\u5883\u69cb\u7bc9](http://qiita.com/Yuki-Inamoto/items/ce65468abba10bce58f0)\u306e\u7d9a\u304d\u3067\u3001\u69cb\u7bc9\u3057\u305f\u74b0\u5883\u3067DRBD9\u306e\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8a66\u3059\u8a18\u4e8b\u3067\u3059\u3002\n\n# \u53c2\u8003\n\n* [DRBD9\u7279\u96c6](https://blog.3ware.co.jp/2015/04/drbd9%E7%89%B9%E9%9B%86%E3%81%AB%E3%81%82%E3%81%9F%E3%81%A3%E3%81%A6/#more-400)\n* [The DRBD User\u2019s Guide](http://drbd.linbit.com/users-guide-9.0/drbd-users-guide.html)\n* [DRBD Source](http://oss.linbit.com/drbd/)\n\n\n# DRBD Client\n\n* \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044DRBD\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n* \u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044DRBD\u30ce\u30fc\u30c9\u3092DRBD Client\u3068\u547c\u3076\n* \u4e0a\u3067\u4f5c\u6210\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306bdrbd9-04\u3001drbd9-05\u3092DRBD Client\u3068\u3057\u3066\u8ffd\u52a0\u3059\u308b\n* drbd9-04\u306eip\u30a2\u30c9\u30ec\u30b9\u306f10.255.10.14\n* drbd9-05\u306eip\u30a2\u30c9\u30ec\u30b9\u306f10.255.10.15\n\n## \u6ce8\u610f\ndrbdmanage\u3092\u4f7f\u3063\u305f\u3001DRBD Client\u306e\u5229\u7528\u65b9\u6cd5\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u306f\u57f7\u7b46\u6642(2015/9/30\u73fe\u5728)\u8f09\u3063\u3066\u3044\u306a\u3044(\u3067\u304d\u308b\u3068\u306f\u66f8\u3044\u3066\u3044\u308b)\u306e\u3067\u3001\u516c\u5f0f\u3067Client\u306e\u4f5c\u308a\u65b9\u304c\u51fa\u3066\u304d\u305f\u3089\u305d\u3061\u3089\u306e\u65b9\u3092\u53c2\u8003\u306b\u3057\u305f\u65b9\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## \u524d\u63d0\u6761\u4ef6\n* drbd9-04\u3001drbd9-05\u306fdrbdmanage\u306b\u3088\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30c7\u30d7\u30ed\u30a4\u306e\u30dd\u30fc\u30c8\u306e\u89e3\u653e\u307e\u3067\u7d42\u308f\u3063\u3066\u3044\u308b\n\n## \u30af\u30e9\u30b9\u30bf\u306b\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u6301\u305f\u306a\u3044\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\n\n* addnode \u306b -s \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u306a\u3057\u306e\u30ce\u30fc\u30c9\u304c\u8ffd\u52a0\u53ef\u80fd\n\ndrbd9-04\u4ee5\u5916\u306e\u3069\u308c\u304b1\u53f0\u3067\u5b9f\u884c\n\n    # drbdmanage add-node drbd9-04 10.255.10.14 -s\n        Operation completed successfull\n        Operation completed successfully\n        Host key verification failed.\n\n        Join command for node drbd9-05:\n        drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 {SecretKey}\n\ndrbd9-04\u3067\u5b9f\u884c\n\n    # drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 {SecretKey}\n\n\ndrbd9-05\u3067\u3082\u540c\u69d8\u306b\u884c\u3046\n\n## \u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044\u30ce\u30fc\u30c9\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\n\ndrbd9-04\u3067\u5b9f\u884c\n\n    # drbdmanage add-volume client 5GB --deploy 3\n    # drbdmanage n\n            +------------------------------------------------------------------------------+\n           | Name     | Pool Size | Pool Free |                              |      State |\n           +------------------------------------------------------------------------------+\n           | drbd9-01 |     16380 |      8740 |                              |         ok |\n           | drbd9-02 |     16380 |      8740 |                              |         ok |\n           | drbd9-03 |     16380 |      8740 |                              |         ok |\n           | drbd9-04 |   unknown |   unknown |                              | no storage |\n           | drbd9-05 |   unknown |   unknown |                              | no storage |\n           +------------------------------------------------------------------------------+\n\n    # drbdmanage r\n            +------------------------------------------------------------------------------+\n            | Name    |                                                            | State |\n            +------------------------------------------------------------------------------+\n            | backups |                                                            |    ok |\n            | client  |                                                            |    ok |\n            +------------------------------------------------------------------------------+\n\n* \u6ce8\u610f\n~~\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u306a\u3044\u30ce\u30fc\u30c9\u304b\u3089volume\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001default\u3067\u958b\u3051\u3089\u308c\u308bvolume\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u304c7000\u756a\u304b\u3089\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3002\u306a\u306e\u3067\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u3067\u65b0\u305f\u306b7000\u756a\u304b\u30897100\u756a\u304f\u3089\u3044\u307e\u3067\u306e\u30dd\u30fc\u30c8\u3092\u958b\u3051\u3066\u304a\u304f\u3002~~\n\ndrbdmanage\u306e\u30d0\u30fc\u30b8\u30e7\u30f30.50\u304b\u3089\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u5272\u308a\u5f53\u3066\u306e\u6709\u7121\u306b\u95a2\u4fc2\u306a\u304f\u30dd\u30fc\u30c8\u756a\u53f77000\u756a\u304b\u3089\u958b\u3051\u3089\u308c\u307e\u3059\n\n        # firewall-cmd --add-port=7000-7100/tcp --zone=public --permanent\n        # firewall-cmd --reload\n\n## \u30dc\u30ea\u30e5\u30fc\u30e0\u306bDRBD client\u3068\u3057\u3066\u5272\u308a\u5f53\u3066\n* \u4f5c\u6210\u3057\u305fclient\u30dc\u30ea\u30e5\u30fc\u30e0\u306bdrbd9-04\u3001drbd9-05\u306f\u5272\u308a\u5f53\u3066\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5272\u308a\u5f53\u3066\u308b\n* assign\u3059\u308b\u3068\u304d\u306b\u3001client\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001DRBD Client\u3068\u3057\u3066\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\n\n        # drbdmanage assign client drbd9-04 --client\n        # drbdmanage assign client drbd9-05 --client\n\n## \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4f5c\u6210\u3068\u30de\u30a6\u30f3\u30c8\n* Minor\u306e\u756a\u53f7\u306fclient\u5074\u304b\u3089\u4f5c\u6210\u3059\u308b\u3068\u3001100\u304b\u3089\u6607\u9806\u306b\u306a\u308b\n\n* drbd9-04\u3067\u5b9f\u884c\n\n        # drbdmanage list-volumes --groupby Size --show Port\n            +------------------------------------------------------------------------------+\n            | Name    | Vol ID | Size | Minor | Port |                             | State |\n            +------------------------------------------------------------------------------+\n            | backups |      0 | 2861 |    10 | 7700 |                             |    ok |\n            | client  |      0 | 4768 |   100 | 7000 |                             |    ok |\n            +------------------------------------------------------------------------------+\n        # mke2fs -j /dev/drbd100\n        # mkdir -p /mnt/drbd/client\n        # drbdsetup status\n            .drbdctrl role:Secondary\n              disk:UpToDate\n              drbd9-01 role:Secondary\n                peer-disk:UpToDate\n              drbd9-03 role:Secondary\n                peer-disk:UpToDate\n              drbd9-04 role:Secondary\n                peer-disk:UpToDate\n              drbd9-05 role:Secondary\n                peer-disk:UpToDate\n\n            backups role:Secondary\n              disk:UpToDate\n              drbd9-01 role:Primary\n                peer-disk:UpToDate\n              drbd9-03 role:Secondary\n                peer-disk:UpToDate\n\n            client role:Secondary\n              disk:UpToDate\n              drbd9-01 role:Secondary\n                peer-disk:UpToDate\n              drbd9-03 role:Secondary\n                peer-disk:UpToDate\n              drbd9-04 role:Secondary\n                peer-disk:Diskless\n              drbd9-05 role:Secondary\n                peer-disk:Diskless\n        # mount /dev/drbd100 /mnt/drbd/client\n\n# \u30c7\u30fc\u30bf\u306e\u518d\u914d\u7f6e\n* DRBD9\u3067\u306f\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u4fdd\u969c\u3059\u308b\u305f\u3081\u306e\u3001\u30c7\u30fc\u30bf\u518d\u914d\u7f6e\u6a5f\u80fd\u304c\u3042\u308b\n* \u4eca\u56de\u306e\u4f8b\u3067\u306f\u3001drbd9-01,02,03\u306e\u30ce\u30fc\u30c9\u304c\u3042\u308adrbd client\u3068\u3057\u3066drbd9-05\u304c\u3042\u308b\u3002\n* \u3059\u3067\u306b\u3001drbd9-01,02,03\u306b\u306f\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n* \u3053\u3053\u3067\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u306f\u6307\u5b9a\u304c\u306a\u3044\u9650\u308adrbd9-05\u3067\u884c\u3046\u3002\n\n        # drbdmanage list-volumes --groupby Size --show Port\n            +------------------------------------------------------------------------------+\n            | Name    | Vol ID | Size | Minor | Port |                             | State |\n            +------------------------------------------------------------------------------+\n            | db      |      0 | 3814 |   102 | 7002 |                             |    ok |\n            | backups |      0 | 4768 |   100 | 7000 |                             |    ok |\n            | app     |      0 | 6675 |   101 | 7001 |                             |    ok |\n            +------------------------------------------------------------------------------+\n        # drbdmanage list-assignments\n            +------------------------------------------------------------------------------+\n            | Node     | Resource | Vol ID |                                       | State |\n            +------------------------------------------------------------------------------+\n            | drbd9-01 | backups  |      * |                                       |    ok |\n            | drbd9-01 | db       |      * |                                       |    ok |\n            | drbd9-02 | app      |      * |                                       |    ok |\n            | drbd9-02 | backups  |      * |                                       |    ok |\n            | drbd9-02 | db       |      * |                                       |    ok |\n            | drbd9-03 | app      |      * |                                       |    ok |\n            | drbd9-03 | backups  |      * |                                       |    ok |\n            +------------------------------------------------------------------------------+\n\n- list-assignments\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u5404\u30ce\u30fc\u30c9\u306b\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u304b\u4e00\u89a7\u8868\u793a\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3042\u308b\u3002\n- list-assignments\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3001\u7701\u7565\u8868\u8a18a\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n* \u30ea\u30bd\u30fc\u30b9\u306f\u4e0a\u8868\u306e\u3088\u3046\u306b\u5272\u308a\u5f53\u3066\u3055\u308c\u3066\u3044\u308b\n\n        # drbdmanage n\n            +------------------------------------------------------------------------------+\n            | Name     | Pool Size | Pool Free |                              |      State |\n            +------------------------------------------------------------------------------+\n            | drbd9-01 |     16380 |      7788 |                              |         ok |\n            | drbd9-02 |     16380 |      1108 |                              |         ok |\n            | drbd9-03 |     16380 |      4924 |                              |         ok |\n            | drbd9-05 |   unknown |   unknown |                              | no storage |\n            +------------------------------------------------------------------------------+\n\n* \u3053\u3053\u306bdrbd9-04\u3068\u3044\u3046\u30ce\u30fc\u30c9\u3092\u65b0\u305f\u306b\u30af\u30e9\u30b9\u30bf\u3078\u8ffd\u52a0\u3059\u308b\n\n        # drbdmanage add-node drbd9-04 10.255.10.14\n\n* drbd9-04\u3067\n\n        # drbdmanage join -p 6999 10.255.10.14 3 drbd9-01 10.255.10.11 0 SecretKey\n\n* app\u3068backups\u306e\u30ea\u30bd\u30fc\u30b9\u3092drbd9-04\u3078\u79fb\u52d5\u3055\u305b\u308b\n\n        # drbdmanage n\n            +------------------------------------------------------------------------------+\n            | Name     | Pool Size | Pool Free |                              |      State |\n            +------------------------------------------------------------------------------+\n            | drbd9-01 |     16380 |      7788 |                              |         ok |\n            | drbd9-02 |     16380 |      1108 |                              |         ok |\n            | drbd9-03 |     16380 |      4924 |                              |         ok |\n            | drbd9-04 |     16380 |     16376 |                              |         ok |\n            | drbd9-05 |   unknown |   unknown |                              | no storage |\n            +------------------------------------------------------------------------------+\n        # drbdmanage assign-resource backups drbd9-04\n        # drbdmanage assign-resource app drbd9-04\n        # drbdmanage deploy backups 3\n        # drbdmanage deploy app 2\n        # drbdmanage n\n            +------------------------------------------------------------------------------+\n            | Name     | Pool Size | Pool Free |                              |      State |\n            +------------------------------------------------------------------------------+\n            | drbd9-01 |     16380 |      7788 |                              |         ok |\n            | drbd9-02 |     16380 |      7788 |                              |         ok |\n            | drbd9-03 |     16380 |      9696 |                              |         ok |\n            | drbd9-04 |     16380 |      4924 |                              |         ok |\n            | drbd9-05 |   unknown |   unknown |                              | no storage |\n            +------------------------------------------------------------------------------+\n        # drbdmanage a\n            +------------------------------------------------------------------------------+\n            | Node     | Resource | Vol ID |                                       | State |\n            +------------------------------------------------------------------------------+\n            | drbd9-01 | backups  |      * |                                       |    ok |\n            | drbd9-01 | db       |      * |                                       |    ok |\n            | drbd9-02 | backups  |      * |                                       |    ok |\n            | drbd9-02 | db       |      * |                                       |    ok |\n            | drbd9-03 | app      |      * |                                       |    ok |\n            | drbd9-04 | app      |      * |                                       |    ok |\n            | drbd9-04 | backups  |      * |                                       |    ok |\n            +------------------------------------------------------------------------------+\n\n* drbdmanage\u3092\u7528\u3044\u3066\u3001\u660e\u793a\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u52d5\u304b\u3059\u65b9\u6cd5(drbd9-01\u306ebackup\u3092drbd9-04\u306b\u52d5\u304b\u3059\u307f\u305f\u3044\u306a)\u306f\u7121\u3044?\n* \u4eca\u306e\u3068\u3053\u308d\u3001\u65b0\u3057\u304fassign\u3057\u305f\u30ce\u30fc\u30c9\u304c\u512a\u5148\u7684\u306bdeploy\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3060\u3002\n  - \u7a7a\u304d\u30b9\u30c8\u30ec\u30fc\u30b8\u91cf\u3092\u8003\u616e\u3057\u3066\u884c\u3063\u3066\u3044\u308b\u306e\u3067\u306f\u306a\u3044?\n  - \u4e0a\u8a18\u306e\u72b6\u614b\u304b\u3089\u3001db\u30dc\u30ea\u30e5\u30fc\u30e0\u3082drbd9-04\u3078assign\u3057\u305f\u5f8cdeploy\u3057\u305f\u3068\u3053\u308d\u300104\u3078db\u304c\u79fb\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\n# \u7d42\u308f\u308a\u306b\n\u307e\u3060\u3001drbdmanage\u3092\u4f7f\u3063\u305f\u3001DRBD client\u3001\u30c7\u30fc\u30bf\u306e\u518d\u914d\u7f6e\u306e\u516c\u5f0f\u306a\u624b\u9806\u304c\u793a\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u3068\u306a\u304f\u65b0\u6a5f\u80fd\u306e\u5229\u7528\u65b9\u6cd5\u304c\u308f\u304b\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\n", "tags": ["drbd", "drbd9", "centos7", "drbdmanage"]}