{"context": " More than 1 year has passed since last update.rake db:migrate \u3057\u3066\u3001\u691c\u8a3c\u306e\u305f\u3081\u306b rake db:rollback \u3057\u305f\u3068\u3053\u308d\u30a8\u30e9\u30fc\u3067\u6012\u3089\u308c\u305f\u306e\u3067\u30b7\u30a7\u30a2\n\n\u74b0\u5883\n\nRuby : ruby 2.2.3p173\nRails : Rails 4.2.1\n\n\n\u72b6\u6cc1\n\u65e2\u5b58\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306bUNIQUE\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u5909\u66f4\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a migration \u3092\u66f8\u3044\u305f\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def change\n    remove_index :companies, :url\n    add_index    :companies, :url, unique: true\n  end\nend\n\nmigrate \u5b9f\u884c\u3002\u3002\u3002\n$ rake db:migrate\n\n== 20160124130800 AddUniquenessToCompanies: migrating ===================\n-- remove_index(:companies, :url)\n   -> 0.0142s\n-- add_index(:companies, :url, {:unique=>true})\n   -> 0.1733s\n== 20160124130800 AddUniquenessToMyModel: migrated (0.1876s) ==========\n\nrollback \u306e\u78ba\u8a8d\u3092\u3063\u3068\u3001\u3001\u3001\n$ rake db:rollback\n\n== 20160124130800 AddUniquenessToMyModel: reverting ===================\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\n\n\nremove_index is only reversible if given a :column option.\n\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:157:in `invert_remove_index'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:66:in `inverse_of'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:50:in `record'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:83:in `remove_index'\n\n\uff01\uff01\uff01\nremove_index is only reversible if given a :column option.\n\nremove_index \u306f :column \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u623b\u305b\u308b\u3088\n\n\u3068\u8a00\u308f\u308c\u3066\u308b\n\n\u56de\u907f\u7b56\n\n1. \u6307\u6458\u901a\u308a\u306b column \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def change\n    remove_index :companies, column: :url\n    add_index    :companies, :url, unique: true\n  end\nend\n\n\u203b\u8907\u6570\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306f column: [:hoge, :piyo] \u3068\u914d\u5217\u306b\u3059\u308b\n\n2. change \u3067\u306f\u306a\u304f up, down \u306b\u3059\u308b\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def up\n    remove_index :companies, :url\n    add_index    :companies, :url, unique: true\n  end\n\n  def down\n    remove_index :companies, :url\n    add_index    :companies, :url\n  end\nend\n\n\n\u6240\u611f\n\nmigration \u4f5c\u3063\u305f\u3089\u3001 rake db:migrate \u3060\u3051\u3067\u306a\u304f\u3001 rake db:rollback \u3082\u691c\u8a3c\u3057\u3088\u3046\u3002\n\n`rake db:migrate` \u3057\u3066\u3001\u691c\u8a3c\u306e\u305f\u3081\u306b `rake db:rollback` \u3057\u305f\u3068\u3053\u308d\u30a8\u30e9\u30fc\u3067\u6012\u3089\u308c\u305f\u306e\u3067\u30b7\u30a7\u30a2\n\n## \u74b0\u5883\n\n- Ruby : ruby 2.2.3p173\n- Rails : Rails 4.2.1\n\n\n## \u72b6\u6cc1\n\n\u65e2\u5b58\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306bUNIQUE\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u5909\u66f4\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a migration \u3092\u66f8\u3044\u305f\n\n```rb\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def change\n    remove_index :companies, :url\n    add_index    :companies, :url, unique: true\n  end\nend\n```\n\nmigrate \u5b9f\u884c\u3002\u3002\u3002\n\n```shell-session\n$ rake db:migrate\n\n== 20160124130800 AddUniquenessToCompanies: migrating ===================\n-- remove_index(:companies, :url)\n   -> 0.0142s\n-- add_index(:companies, :url, {:unique=>true})\n   -> 0.1733s\n== 20160124130800 AddUniquenessToMyModel: migrated (0.1876s) ==========\n```\n\nrollback \u306e\u78ba\u8a8d\u3092\u3063\u3068\u3001\u3001\u3001\n\n```shell-session\n$ rake db:rollback\n\n== 20160124130800 AddUniquenessToMyModel: reverting ===================\nrake aborted!\nStandardError: An error has occurred, all later migrations canceled:\n\n\n\nremove_index is only reversible if given a :column option.\n\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:157:in `invert_remove_index'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:66:in `inverse_of'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:50:in `record'\n/Users/kawakubox/Workspace/my-rails-project/vendor/bundle/ruby/2.2.0/gems/activerecord-4.2.1/lib/active_record/migration/command_recorder.rb:83:in `remove_index'\n```\n\n\uff01\uff01\uff01\n\nremove_index is only reversible if given a :column option.\n\n> remove_index \u306f `:column` \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u623b\u305b\u308b\u3088\n\n\u3068\u8a00\u308f\u308c\u3066\u308b\n\n## \u56de\u907f\u7b56\n\n### 1. \u6307\u6458\u901a\u308a\u306b `column` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\n\n```rb\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def change\n    remove_index :companies, column: :url\n    add_index    :companies, :url, unique: true\n  end\nend\n```\n\n\u203b\u8907\u6570\u30ab\u30e9\u30e0\u306e\u5834\u5408\u306f column: [:hoge, :piyo] \u3068\u914d\u5217\u306b\u3059\u308b\n\n### 2. `change` \u3067\u306f\u306a\u304f `up`, `down` \u306b\u3059\u308b\n\n```rb\nclass AddUniquenessToCompanies < ActiveRecord::Migration\n  def up\n    remove_index :companies, :url\n    add_index    :companies, :url, unique: true\n  end\n\n  def down\n    remove_index :companies, :url\n    add_index    :companies, :url\n  end\nend\n```\n\n### \u6240\u611f\n\n- migration \u4f5c\u3063\u305f\u3089\u3001 `rake db:migrate` \u3060\u3051\u3067\u306a\u304f\u3001 `rake db:rollback` \u3082\u691c\u8a3c\u3057\u3088\u3046\u3002\n", "tags": ["Rails", "migration"]}