{"tags": ["afnetworking", "iOS", "NSNotification", "XCTest", "Xcode"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u30e1\u30e2\u3068\u3057\u3066\u8a18\u9332\u3002\n\n\u30c6\u30b9\u30c8\u3059\u308b\u30af\u30e9\u30b9\u306bNSNotification\u3092\u901a\u77e5\u3059\u308b\u6e96\u5099\u3092\u3059\u308b\nHTTPRequest.h\n#import <Foundation/Foundation.h>\n\n/*\n HTTPRequestFinishedNotification\n \u901a\u4fe1\u7d42\u4e86\u6642\u306b\u767a\u884c\u3055\u308c\u308b\u901a\u77e5\u540d\n*/\nextern NSString *const HTTPRequestFinishedNotification;\n\n@interface HTTPRequest : NSObject\n\n- (void)load:(void (^)(id result))completionHandler failureHandler:(void (^)(NSError *error))failureHandler;\n\n@end\n\nHTTPRequest.m\n#import \"HTTPRequest.h\"\n#import <AFNetworking.h>\n\nNSString *const HTTPRequestFinishedNotification = @\"HTTPRequestFinishedNotification\";\n\n@implementation HTTPRequest\n\n- (void)load:(void (^)(id result))completionHandler failureHandler:(void (^)(NSError *error))failureHandler\n{\n    self.completionHandler = completionHandler;\n    self.failureHandler = failureHandler;\n    self.path = @\"http://wwww.hogehoge.com/test.xml\";\n\n    AFHTTPRequestOperationManager *manager = [[AppManager sharedManager] HTTPRequestOperationManager];\n    manager.responseSerializer = [AFXMLParserResponseSerializer serializer];\n    manager.responseSerializer.acceptableContentTypes = [NSSet setWithObjects:@\"application/xml\", @\"text/xml\", nil];\n    [manager GET:self.path parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) {\n        NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];\n        [nc postNotificationName:HTTPRequestFinishedNotification  object:nil];\n        self.completionHandler(responseObject);\n    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {\n        NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];\n        [nc postNotificationName:HTTPRequestFinishedNotification  object:nil];\n        self.failureHandler(error);\n    }];\n\n}\n\n@end\n\n\n\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u3067NSNotification\u306e\u901a\u77e5\u3092\u53d7\u3051\u53d6\u3063\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\nSampleTest.m\n- (void)testHTTPRequest\n{\n    HTTPRequest *request = [[HTTPRequest alloc] init];\n\n    XCTestExpectation *exp = [self expectationForNotification:HTTPRequestFinishedNotification\n                                                       object:nil\n                                                      handler:^BOOL(NSNotification * __nonnull notification)\n                              {\n                                  NSLog(@\"%s, notification %@\", __func__, notification);\n                                  [exp fulfill];\n                                  return true;\n                              }];\n\n    [request load:^(id result) {\n        XCTAssertNotNil(result);\n    } failureHandler:^(NSError *error) {\n        XCTFail();\n    }];\n\n    [self waitForExpectationsWithTimeout:3 handler:nil];\n}\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u5b9f\u88c5\u3059\u308c\u3070NSNotification\u3092\u5229\u7528\u3057\u3066\u3001\u901a\u4fe1\u306e\u5b8c\u4e86\u901a\u77e5\u3092\u53d7\u3051\u3066\u304b\u3089\u3001\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\uff08\u3068\u3044\u3046\u7406\u89e3\u3067\u3042\u3063\u3066\u308b\uff1f\uff09\n\u975e\u540c\u671f\u901a\u4fe1\u306e\u30c6\u30b9\u30c8\u3063\u3066\u3084\u3084\u3053\u3057\u3044\u3002\n\n\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u30e1\u30e2\u3068\u3057\u3066\u8a18\u9332\u3002\n\n##\u30c6\u30b9\u30c8\u3059\u308b\u30af\u30e9\u30b9\u306bNSNotification\u3092\u901a\u77e5\u3059\u308b\u6e96\u5099\u3092\u3059\u308b\n\n**HTTPRequest.h**\n\n```\n#import <Foundation/Foundation.h>\n\n/*\n HTTPRequestFinishedNotification\n \u901a\u4fe1\u7d42\u4e86\u6642\u306b\u767a\u884c\u3055\u308c\u308b\u901a\u77e5\u540d\n*/\nextern NSString *const HTTPRequestFinishedNotification;\n\n@interface HTTPRequest : NSObject\n\n- (void)load:(void (^)(id result))completionHandler failureHandler:(void (^)(NSError *error))failureHandler;\n\n@end\n```\n\n**HTTPRequest.m**\n\n```\n#import \"HTTPRequest.h\"\n#import <AFNetworking.h>\n\nNSString *const HTTPRequestFinishedNotification = @\"HTTPRequestFinishedNotification\";\n\n@implementation HTTPRequest\n\n- (void)load:(void (^)(id result))completionHandler failureHandler:(void (^)(NSError *error))failureHandler\n{\n    self.completionHandler = completionHandler;\n    self.failureHandler = failureHandler;\n    self.path = @\"http://wwww.hogehoge.com/test.xml\";\n    \n    AFHTTPRequestOperationManager *manager = [[AppManager sharedManager] HTTPRequestOperationManager];\n    manager.responseSerializer = [AFXMLParserResponseSerializer serializer];\n    manager.responseSerializer.acceptableContentTypes = [NSSet setWithObjects:@\"application/xml\", @\"text/xml\", nil];\n    [manager GET:self.path parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) {\n        NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];\n        [nc postNotificationName:HTTPRequestFinishedNotification  object:nil];\n        self.completionHandler(responseObject);\n    } failure:^(AFHTTPRequestOperation *operation, NSError *error) {\n        NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];\n        [nc postNotificationName:HTTPRequestFinishedNotification  object:nil];\n        self.failureHandler(error);\n    }];\n\n}\n\n@end\n```\n\n##\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u3067NSNotification\u306e\u901a\u77e5\u3092\u53d7\u3051\u53d6\u3063\u3066\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\n**SampleTest.m**\n\n```\n- (void)testHTTPRequest\n{\n    HTTPRequest *request = [[HTTPRequest alloc] init];\n\n    XCTestExpectation *exp = [self expectationForNotification:HTTPRequestFinishedNotification\n                                                       object:nil\n                                                      handler:^BOOL(NSNotification * __nonnull notification)\n                              {\n                                  NSLog(@\"%s, notification %@\", __func__, notification);\n                                  [exp fulfill];\n                                  return true;\n                              }];\n    \n    [request load:^(id result) {\n        XCTAssertNotNil(result);\n    } failureHandler:^(NSError *error) {\n        XCTFail();\n    }];\n\n    [self waitForExpectationsWithTimeout:3 handler:nil];\n}\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u5b9f\u88c5\u3059\u308c\u3070NSNotification\u3092\u5229\u7528\u3057\u3066\u3001\u901a\u4fe1\u306e\u5b8c\u4e86\u901a\u77e5\u3092\u53d7\u3051\u3066\u304b\u3089\u3001\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\uff08\u3068\u3044\u3046\u7406\u89e3\u3067\u3042\u3063\u3066\u308b\uff1f\uff09\n\n\u975e\u540c\u671f\u901a\u4fe1\u306e\u30c6\u30b9\u30c8\u3063\u3066\u3084\u3084\u3053\u3057\u3044\u3002\n"}