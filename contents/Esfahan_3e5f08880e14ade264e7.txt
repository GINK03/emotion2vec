{"context": "\n\n\u6982\u8981\nsinatra\u3067\u3001web\u30a2\u30af\u30bb\u30b9\u3001Rake\u3001Rspec\u5b9f\u884c\u6642\u306b\u4f7f\u3046\u74b0\u5883\u5909\u6570(environment)\u3092\u3001\n\u305d\u308c\u305e\u308c\u3069\u3046\u3084\u3063\u3066\u30bb\u30c3\u30c8\u3059\u308c\u3070\u3088\u3044\u304b\u306e\u30e1\u30e2\u3002\n\n\u74b0\u5883\n\nruby 2.2.3p173\nsinatra-1.4.7\nApache\nPassenger\n\n\nweb\u30a2\u30af\u30bb\u30b9\nApache\u306econf\u3067\u3001RACK_ENV\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nhttpd.conf\nSetEnv RACK_ENV development\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u3066\u4f7f\u3046\u3002\n(**snip**)\n\nset :environment, ENV['RACK_ENV'].to_sym || :development\n\nActiveRecord::Base.configurations = YAML.load(ERB.new(File.read(\"db/database.yml\")).result)\nActiveRecord::Base.establish_connection(settings.environment)\n\n(**snip**)\n\n\nRake tasks\ntask\u30d5\u30a1\u30a4\u30eb\nnamespace :sample do\n  task :environment do\n    puts Sinatra::Application.environment\n  end\n\n  task :task1 => :environment do\n  end\nend\n\nrake\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5f15\u6570\u306b\u74b0\u5883\u5909\u6570\u3092\u6e21\u3059\u3002\n\u4ed6\u306e\u65b9\u6cd5\u306a\u3044\u306e\u304b\u306a\uff1f\n$ RAILS_ENV=production bundle exec rake sample:task1\n\n\nRSpec\nspec_helper.rb\u306e\u5148\u982d\u306b\u3001ENV['RACK_ENV'] = 'test'\u3068\u5b9a\u7fa9\u3059\u308b\u3002\n\u4f59\u308a\u304b\u3063\u3053\u3088\u304f\u306a\u3044\u304c\u3001\u8272\u3005\u3068\u8abf\u3079\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u3053\u3046\u3084\u3063\u3066\u308b\u4eba\u304c\u591a\u3044\u3063\u307d\u3044\u3002\n\u3053\u308c\u3067\u3001web\u306e\u30c6\u30b9\u30c8\u6642\u3082\u3001rake task\u306e\u30c6\u30b9\u30c8\u6642\u3082\u3001\u74b0\u5883\u5909\u6570\u306btest\u304c\u30bb\u30c3\u30c8\u3055\u308c\u305f\u3002\n\nspec/spec_helper.rb\nENV['RACK_ENV'] = 'test'\n\n(**snip**)\n\nActiveRecord::Base.configurations = YAML.load(ERB.new(File.read(\"db/database.yml\")).result)\nActiveRecord::Base.establish_connection(:test)\n\n(**snip**)\n\n\n\u307e\u3060\u3059\u3063\u304d\u308a\u3057\u306a\u3044\u90e8\u5206\u3082\u3042\u308a\u307e\u3059\u304c\n\u4ee5\u4e0a\n[\u53c2\u8003]\nhttps://shoyan.github.io/blog/2016/05/02/what-is-rack-env-and-unicorn-and-sinatra/\n## \u6982\u8981\nsinatra\u3067\u3001web\u30a2\u30af\u30bb\u30b9\u3001Rake\u3001Rspec\u5b9f\u884c\u6642\u306b\u4f7f\u3046\u74b0\u5883\u5909\u6570(environment)\u3092\u3001\n\u305d\u308c\u305e\u308c\u3069\u3046\u3084\u3063\u3066\u30bb\u30c3\u30c8\u3059\u308c\u3070\u3088\u3044\u304b\u306e\u30e1\u30e2\u3002\n\n## \u74b0\u5883\n- ruby 2.2.3p173\n- sinatra-1.4.7\n- Apache\n- Passenger\n\n\n## web\u30a2\u30af\u30bb\u30b9\nApache\u306econf\u3067\u3001RACK_ENV\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```httpd.conf\nSetEnv RACK_ENV development\n```\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u3066\u4f7f\u3046\u3002\n\n```\n(**snip**)\n\nset :environment, ENV['RACK_ENV'].to_sym || :development\n\nActiveRecord::Base.configurations = YAML.load(ERB.new(File.read(\"db/database.yml\")).result)\nActiveRecord::Base.establish_connection(settings.environment)\n\n(**snip**)\n```\n\n## Rake tasks\n\ntask\u30d5\u30a1\u30a4\u30eb\n\n```\nnamespace :sample do\n  task :environment do\n    puts Sinatra::Application.environment\n  end\n\n  task :task1 => :environment do\n  end\nend\n```\n\nrake\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5f15\u6570\u306b\u74b0\u5883\u5909\u6570\u3092\u6e21\u3059\u3002\n\u4ed6\u306e\u65b9\u6cd5\u306a\u3044\u306e\u304b\u306a\uff1f\n\n```\n$ RAILS_ENV=production bundle exec rake sample:task1\n```\n\n## RSpec\n\nspec_helper.rb\u306e\u5148\u982d\u306b\u3001`ENV['RACK_ENV'] = 'test'`\u3068\u5b9a\u7fa9\u3059\u308b\u3002\n\u4f59\u308a\u304b\u3063\u3053\u3088\u304f\u306a\u3044\u304c\u3001\u8272\u3005\u3068\u8abf\u3079\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u3053\u3046\u3084\u3063\u3066\u308b\u4eba\u304c\u591a\u3044\u3063\u307d\u3044\u3002\n\u3053\u308c\u3067\u3001web\u306e\u30c6\u30b9\u30c8\u6642\u3082\u3001rake task\u306e\u30c6\u30b9\u30c8\u6642\u3082\u3001\u74b0\u5883\u5909\u6570\u306b`test`\u304c\u30bb\u30c3\u30c8\u3055\u308c\u305f\u3002\n\n```lang:spec/spec_helper.rb\nENV['RACK_ENV'] = 'test'\n\n(**snip**)\n\nActiveRecord::Base.configurations = YAML.load(ERB.new(File.read(\"db/database.yml\")).result)\nActiveRecord::Base.establish_connection(:test)\n\n(**snip**)\n```\n\n\u307e\u3060\u3059\u3063\u304d\u308a\u3057\u306a\u3044\u90e8\u5206\u3082\u3042\u308a\u307e\u3059\u304c\n\u4ee5\u4e0a\n\n[\u53c2\u8003]\nhttps://shoyan.github.io/blog/2016/05/02/what-is-rack-env-and-unicorn-and-sinatra/\n", "tags": ["RubyOnRails", "Ruby", "Sinatra", "rake"]}