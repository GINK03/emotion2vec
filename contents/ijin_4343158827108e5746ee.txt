{"context": " More than 1 year has passed since last update.\n\n\u8ab2\u984c\nHashiCorp\u306eTerraform\u3067\u306fInfrastructure as a Code\u3092\u5bb9\u6613\u306b\u8a18\u8ff0\u3067\u304d\u308b\u304c\u3001\u5404\u7a2eprovider\u3067\u306f\u307e\u3060\u672a\u5b9f\u88c5\u306e\u30e2\u30ce\u304c\u591a\u3044\u3002\n\u4f8b\u3048\u3070\u3001Redshift (2015/11/27\u73fe\u5728)\nhttps://github.com/hashicorp/terraform/pull/3862\n\n\u89e3\u6c7a\u6cd5\n\u3057\u304b\u3057\u3001Terraform v0.6.7\u3067\u306f\u6700\u8fd1CloudFormation\u306eprovider\u306b\u5bfe\u5fdc\u3057\u305f\u70ba\u3001CloudFormation template\u3092\u57cb\u3081\u8fbc\u3093\u3067\u6a5f\u80fd\u3092\u88dc\u5b8c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\uff01\uff08\u3064\u3044\u3053\u306e\u9593\u307e\u3067\u306fHEAD\u306b\u3057\u304b\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u306e\u3067\u3001go\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3051\u3069\uff09\n\nTF files\n\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\nvpc.tf\n# VPC\nresource \"aws_vpc\" \"test\" {\n    cidr_block = \"172.7.0.0/16\"\n    enable_dns_hostnames = true\n\n    tags {\n        Name = \"test\"\n    }\n}\n\n# subnets\nresource \"aws_subnet\" \"test-1a\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    cidr_block = \"172.7.0.0/20\"\n    availability_zone = \"ap-northeast-1a\"\n    map_public_ip_on_launch = true\n\n    tags {\n        Name = \"1a\"\n    }\n}\n\nresource \"aws_subnet\" \"test-1c\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    cidr_block = \"172.7.16.0/20\"\n    availability_zone = \"ap-northeast-1c\"\n    map_public_ip_on_launch = true\n\n    tags {\n        Name = \"1c\"\n    }\n}\n\n\n\nsecurity-group.tf\nresource \"aws_security_group\" \"test-redshift\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    name = \"test-redshift\"\n    description = \"redshift SG (test)\"\n    tags {\n      Name = \"redshift\"\n    }\n\n    ingress {\n        from_port = 5439\n        to_port = 5439\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n\n    egress {\n        from_port = 0\n        to_port = 0\n        protocol = \"-1\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n\n\n\nredshift.tf\nresource \"aws_cloudformation_stack\" \"redshift\" {\n    name = \"redshift\"\n    template_body = <<STACK\n{\n  \"AWSTemplateFormatVersion\": \"2010-09-09\",\n  \"Parameters\" : {\n    \"DatabaseName\" : {\n      \"Description\" : \"The name of the first database to be created when the cluster is created\",\n      \"Type\" : \"String\",\n      \"Default\" : \"mydwh\",\n      \"AllowedPattern\" : \"([a-z]|[0-9])+\"\n    },\n    \"ClusterType\" : {\n      \"Description\" : \"The type of cluster\",\n      \"Type\" : \"String\",\n      \"Default\" : \"multi-node\",\n      \"AllowedValues\" : [ \"single-node\", \"multi-node\" ]\n    },\n    \"NumberOfNodes\" : {\n      \"Description\" : \"The number of compute nodes in the cluster. For multi-node clusters, the NumberOfNodes parameter must be greater than 1\",\n      \"Type\" : \"Number\",\n      \"Default\" : \"2\"\n    },\n    \"NodeType\" : {\n      \"Description\" : \"The type of node to be provisioned\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dc1.large\",\n      \"AllowedValues\" : [ \"dc1.large\", \"dc1.8xlarge\", \"ds2.large\", \"ds2.8xlarge\" ]\n    },\n    \"MasterUsername\" : {\n      \"Description\" : \"The user name that is associated with the master user account for the cluster that is being created\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dbuser\",\n      \"AllowedPattern\" : \"([a-z])([a-z]|[0-9])*\"\n    },\n    \"MasterUserPassword\" :  {\n      \"Description\" : \"The password that is associated with the master user account for the cluster that is being created.\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dbpassword\",\n      \"NoEcho\" : \"true\"\n    },\n    \"PortNumber\" : {\n      \"Description\" : \"The port number on which the cluster accepts incoming connections.\",\n      \"Type\" : \"Number\",\n      \"Default\" : \"5439\"\n    },\n    \"VpcId\" : {\n      \"Description\" : \"The VPC ID to launch the cluster\",\n      \"Type\" : \"AWS::EC2::VPC::Id\",\n      \"Default\" : \"${aws_vpc.test.id}\"\n    },\n    \"SecurityGroupId\" : {\n      \"Description\" : \"The Security Group ID(s) to launch the cluster\",\n      \"Type\" : \"List<AWS::EC2::SecurityGroup::Id>\",\n      \"Default\" : \"${aws_security_group.test-redshift.id}\"\n    },\n    \"Subnets\" : {\n      \"Description\" : \"The Subnet ID(s) to include in the subnet group\",\n      \"Type\" : \"List<AWS::EC2::Subnet::Id>\",\n      \"Default\" : \"${aws_subnet.test-1a.id},${aws_subnet.test-1c.id}\"\n    }\n  },\n  \"Conditions\" : {\n    \"IsMultiNodeCluster\" : {\n      \"Fn::Equals\" : [{ \"Ref\" : \"ClusterType\" }, \"multi-node\" ]\n    }\n  },\n  \"Resources\" : {\n    \"RedshiftCluster\" : {\n      \"Type\" : \"AWS::Redshift::Cluster\",\n      \"Properties\" : {\n        \"ClusterType\" : { \"Ref\" : \"ClusterType\" },\n        \"NumberOfNodes\" : { \"Fn::If\" : [ \"IsMultiNodeCluster\",  { \"Ref\" : \"NumberOfNodes\" }, { \"Ref\" : \"AWS::NoValue\" }]},\n        \"NodeType\" : { \"Ref\" : \"NodeType\" },\n        \"DBName\" : { \"Ref\" : \"DatabaseName\" },\n        \"MasterUsername\" : { \"Ref\" : \"MasterUsername\" },\n        \"MasterUserPassword\" : { \"Ref\" : \"MasterUserPassword\" },\n        \"ClusterParameterGroupName\" : { \"Ref\" : \"RedshiftClusterParameterGroup\" },\n        \"VpcSecurityGroupIds\" : { \"Ref\" : \"SecurityGroupId\" },\n        \"ClusterSubnetGroupName\" : { \"Ref\" : \"RedshiftClusterSubnetGroup\" },\n        \"PubliclyAccessible\" : \"true\",\n        \"Port\" : { \"Ref\" : \"PortNumber\" }\n      }\n    },\n    \"RedshiftClusterParameterGroup\" : {\n      \"Type\" : \"AWS::Redshift::ClusterParameterGroup\",\n      \"Properties\" : {\n        \"Description\" : \"Cluster parameter group\",\n        \"ParameterGroupFamily\" : \"redshift-1.0\",\n        \"Parameters\" : [{\n          \"ParameterName\" : \"enable_user_activity_logging\",\n          \"ParameterValue\" : \"true\"\n        }]\n      }\n    },\n    \"RedshiftClusterSubnetGroup\" : {\n      \"Type\" : \"AWS::Redshift::ClusterSubnetGroup\",\n      \"Properties\" : {\n        \"Description\" : \"Cluster subnet group\",\n        \"SubnetIds\" : { \"Ref\" : \"Subnets\" }\n      }\n    }\n  },\n  \"Outputs\" : {\n    \"ClusterEndpoint\" : {\n      \"Description\" : \"Cluster endpoint\",\n      \"Value\" : { \"Fn::Join\" : [ \":\", [ { \"Fn::GetAtt\" : [ \"RedshiftCluster\", \"Endpoint.Address\" ] }, { \"Fn::GetAtt\" : [ \"RedshiftCluster\", \"Endpoint.Port\" ] } ] ] }\n    },\n    \"ClusterName\" : {\n      \"Description\" : \"Name of cluster\",\n      \"Value\" : { \"Ref\" : \"RedshiftCluster\" }\n    },\n    \"ParameterGroupName\" : {\n      \"Description\" : \"Name of parameter group\",\n      \"Value\" : { \"Ref\" : \"RedshiftClusterParameterGroup\" }\n    }\n  }\n}\nSTACK\n\n\nTerraform\u3067\u4f5c\u6210\u3055\u308c\u305fvariable\u304c\u305d\u306e\u307e\u307e\u57cb\u3081\u8fbc\u3081\u308b\u306e\u304c\u7d20\u6674\u3089\u3057\u3044\u3002\n\n\u6a5f\u80fd\u5b9f\u88c5\u306e\u512a\u5148\u9806\u4f4d\u4ed8\u3051\n\u3061\u306a\u307f\u306b\u6b32\u3057\u3044\u6a5f\u80fd\u306f\u4ee5\u4e0b\u306espreadsheet\u306b\u81ea\u5206\u306egithub id\u3092\u4ed8\u3051\u8db3\u3057\u3066\u6295\u7968\u3059\u308b\u4e8b\u306b\u3088\u3063\u3066\u3001\u512a\u5148\u9806\u4f4d\u3092\u6c7a\u3081\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\nhttps://docs.google.com/spreadsheets/d/1yJKjLaTmkWcUS3T8TLwvXC6EBwNSpuQbIq0Y7OnMXhw/edit#gid=1149664272&vpid=A1\n## \u8ab2\u984c\n\nHashiCorp\u306e[Terraform](https://www.terraform.io)\u3067\u306fInfrastructure as a Code\u3092\u5bb9\u6613\u306b\u8a18\u8ff0\u3067\u304d\u308b\u304c\u3001\u5404\u7a2eprovider\u3067\u306f\u307e\u3060\u672a\u5b9f\u88c5\u306e\u30e2\u30ce\u304c\u591a\u3044\u3002\n\n\u4f8b\u3048\u3070\u3001Redshift (2015/11/27\u73fe\u5728)\nhttps://github.com/hashicorp/terraform/pull/3862\n\n## \u89e3\u6c7a\u6cd5\n\n\u3057\u304b\u3057\u3001Terraform v0.6.7\u3067\u306f\u6700\u8fd1CloudFormation\u306eprovider\u306b[\u5bfe\u5fdc\u3057\u305f](https://github.com/hashicorp/terraform/pull/2636)\u70ba\u3001CloudFormation template\u3092\u57cb\u3081\u8fbc\u3093\u3067\u6a5f\u80fd\u3092\u88dc\u5b8c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\uff01\uff08\u3064\u3044\u3053\u306e\u9593\u307e\u3067\u306fHEAD\u306b\u3057\u304b\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u306e\u3067\u3001go\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3051\u3069\uff09\n\n# TF files\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\n```rb:vpc.tf\n# VPC\nresource \"aws_vpc\" \"test\" {\n    cidr_block = \"172.7.0.0/16\"\n    enable_dns_hostnames = true\n\n    tags {\n        Name = \"test\"\n    }\n}\n\n# subnets\nresource \"aws_subnet\" \"test-1a\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    cidr_block = \"172.7.0.0/20\"\n    availability_zone = \"ap-northeast-1a\"\n    map_public_ip_on_launch = true\n\n    tags {\n        Name = \"1a\"\n    }\n}\n\nresource \"aws_subnet\" \"test-1c\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    cidr_block = \"172.7.16.0/20\"\n    availability_zone = \"ap-northeast-1c\"\n    map_public_ip_on_launch = true\n\n    tags {\n        Name = \"1c\"\n    }\n}\n```\n\n```rb:security-group.tf\nresource \"aws_security_group\" \"test-redshift\" {\n    vpc_id = \"${aws_vpc.test.id}\"\n    name = \"test-redshift\"\n    description = \"redshift SG (test)\"\n    tags {\n      Name = \"redshift\"\n    }\n\n    ingress {\n        from_port = 5439\n        to_port = 5439\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n\n    egress {\n        from_port = 0\n        to_port = 0\n        protocol = \"-1\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n```\n\n```rb:redshift.tf\nresource \"aws_cloudformation_stack\" \"redshift\" {\n    name = \"redshift\"\n    template_body = <<STACK\n{\n  \"AWSTemplateFormatVersion\": \"2010-09-09\",\n  \"Parameters\" : {\n    \"DatabaseName\" : {\n      \"Description\" : \"The name of the first database to be created when the cluster is created\",\n      \"Type\" : \"String\",\n      \"Default\" : \"mydwh\",\n      \"AllowedPattern\" : \"([a-z]|[0-9])+\"\n    },\n    \"ClusterType\" : {\n      \"Description\" : \"The type of cluster\",\n      \"Type\" : \"String\",\n      \"Default\" : \"multi-node\",\n      \"AllowedValues\" : [ \"single-node\", \"multi-node\" ]\n    },\n    \"NumberOfNodes\" : {\n      \"Description\" : \"The number of compute nodes in the cluster. For multi-node clusters, the NumberOfNodes parameter must be greater than 1\",\n      \"Type\" : \"Number\",\n      \"Default\" : \"2\"\n    },\n    \"NodeType\" : {\n      \"Description\" : \"The type of node to be provisioned\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dc1.large\",\n      \"AllowedValues\" : [ \"dc1.large\", \"dc1.8xlarge\", \"ds2.large\", \"ds2.8xlarge\" ]\n    },\n    \"MasterUsername\" : {\n      \"Description\" : \"The user name that is associated with the master user account for the cluster that is being created\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dbuser\",\n      \"AllowedPattern\" : \"([a-z])([a-z]|[0-9])*\"\n    },\n    \"MasterUserPassword\" :  {\n      \"Description\" : \"The password that is associated with the master user account for the cluster that is being created.\",\n      \"Type\" : \"String\",\n      \"Default\" : \"dbpassword\",\n      \"NoEcho\" : \"true\"\n    },\n    \"PortNumber\" : {\n      \"Description\" : \"The port number on which the cluster accepts incoming connections.\",\n      \"Type\" : \"Number\",\n      \"Default\" : \"5439\"\n    },\n    \"VpcId\" : {\n      \"Description\" : \"The VPC ID to launch the cluster\",\n      \"Type\" : \"AWS::EC2::VPC::Id\",\n      \"Default\" : \"${aws_vpc.test.id}\"\n    },\n    \"SecurityGroupId\" : {\n      \"Description\" : \"The Security Group ID(s) to launch the cluster\",\n      \"Type\" : \"List<AWS::EC2::SecurityGroup::Id>\",\n      \"Default\" : \"${aws_security_group.test-redshift.id}\"\n    },\n    \"Subnets\" : {\n      \"Description\" : \"The Subnet ID(s) to include in the subnet group\",\n      \"Type\" : \"List<AWS::EC2::Subnet::Id>\",\n      \"Default\" : \"${aws_subnet.test-1a.id},${aws_subnet.test-1c.id}\"\n    }\n  },\n  \"Conditions\" : {\n    \"IsMultiNodeCluster\" : {\n      \"Fn::Equals\" : [{ \"Ref\" : \"ClusterType\" }, \"multi-node\" ]\n    }\n  },\n  \"Resources\" : {\n    \"RedshiftCluster\" : {\n      \"Type\" : \"AWS::Redshift::Cluster\",\n      \"Properties\" : {\n        \"ClusterType\" : { \"Ref\" : \"ClusterType\" },\n        \"NumberOfNodes\" : { \"Fn::If\" : [ \"IsMultiNodeCluster\",  { \"Ref\" : \"NumberOfNodes\" }, { \"Ref\" : \"AWS::NoValue\" }]},\n        \"NodeType\" : { \"Ref\" : \"NodeType\" },\n        \"DBName\" : { \"Ref\" : \"DatabaseName\" },\n        \"MasterUsername\" : { \"Ref\" : \"MasterUsername\" },\n        \"MasterUserPassword\" : { \"Ref\" : \"MasterUserPassword\" },\n        \"ClusterParameterGroupName\" : { \"Ref\" : \"RedshiftClusterParameterGroup\" },\n        \"VpcSecurityGroupIds\" : { \"Ref\" : \"SecurityGroupId\" },\n        \"ClusterSubnetGroupName\" : { \"Ref\" : \"RedshiftClusterSubnetGroup\" },\n        \"PubliclyAccessible\" : \"true\",\n        \"Port\" : { \"Ref\" : \"PortNumber\" }\n      }\n    },\n    \"RedshiftClusterParameterGroup\" : {\n      \"Type\" : \"AWS::Redshift::ClusterParameterGroup\",\n      \"Properties\" : {\n        \"Description\" : \"Cluster parameter group\",\n        \"ParameterGroupFamily\" : \"redshift-1.0\",\n        \"Parameters\" : [{\n          \"ParameterName\" : \"enable_user_activity_logging\",\n          \"ParameterValue\" : \"true\"\n        }]\n      }\n    },\n    \"RedshiftClusterSubnetGroup\" : {\n      \"Type\" : \"AWS::Redshift::ClusterSubnetGroup\",\n      \"Properties\" : {\n        \"Description\" : \"Cluster subnet group\",\n        \"SubnetIds\" : { \"Ref\" : \"Subnets\" }\n      }\n    }\n  },\n  \"Outputs\" : {\n    \"ClusterEndpoint\" : {\n      \"Description\" : \"Cluster endpoint\",\n      \"Value\" : { \"Fn::Join\" : [ \":\", [ { \"Fn::GetAtt\" : [ \"RedshiftCluster\", \"Endpoint.Address\" ] }, { \"Fn::GetAtt\" : [ \"RedshiftCluster\", \"Endpoint.Port\" ] } ] ] }\n    },\n    \"ClusterName\" : {\n      \"Description\" : \"Name of cluster\",\n      \"Value\" : { \"Ref\" : \"RedshiftCluster\" }\n    },\n    \"ParameterGroupName\" : {\n      \"Description\" : \"Name of parameter group\",\n      \"Value\" : { \"Ref\" : \"RedshiftClusterParameterGroup\" }\n    }\n  }\n}\nSTACK\n```\n\nTerraform\u3067\u4f5c\u6210\u3055\u308c\u305fvariable\u304c\u305d\u306e\u307e\u307e\u57cb\u3081\u8fbc\u3081\u308b\u306e\u304c\u7d20\u6674\u3089\u3057\u3044\u3002\n\n## \u6a5f\u80fd\u5b9f\u88c5\u306e\u512a\u5148\u9806\u4f4d\u4ed8\u3051\n\n\u3061\u306a\u307f\u306b\u6b32\u3057\u3044\u6a5f\u80fd\u306f\u4ee5\u4e0b\u306espreadsheet\u306b\u81ea\u5206\u306egithub id\u3092\u4ed8\u3051\u8db3\u3057\u3066\u6295\u7968\u3059\u308b\u4e8b\u306b\u3088\u3063\u3066\u3001\u512a\u5148\u9806\u4f4d\u3092[\u6c7a\u3081\u3066\u3044\u308b](https://github.com/hashicorp/terraform/issues/28)\u3068\u306e\u3053\u3068\u3002\n\nhttps://docs.google.com/spreadsheets/d/1yJKjLaTmkWcUS3T8TLwvXC6EBwNSpuQbIq0Y7OnMXhw/edit#gid=1149664272&vpid=A1\n", "tags": ["AWS", "Terraform", "CloudFormation", "Hashicorp", "redshift"]}