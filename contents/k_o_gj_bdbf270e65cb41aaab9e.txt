{"tags": ["laravel", "PHP", "Eloquent", "laravel4"], "context": " More than 1 year has passed since last update.Laravel4\u3067Eloquent\u3092\u4f7f\u7528\u3057\u3066\u3044\u305f\u3089\u30c7\u30fc\u30bf\u306e\u633f\u5165\u3067\u30cf\u30de\u3063\u305f\u306e\u3067\u30e1\u30e2\u3063\u3066\u304a\u304f\nhttp://laravel4.kore1server.com/docs/queries\nhttp://laravel4.kore1server.com/docs/eloquent\nhttp://stackoverflow.com/questions/17461383/how-can-i-update-data-with-eloquent-without-id-in-laravel-4\n\ncomposite key\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n:~/laravel_test$ php artisan migrate:make create_hogefuga_table\nCreated Migration: 2014_09_24_212126_create_hogefuga_table\nGenerating optimized class loader\nCompiling common classes\nCompiling views\n\n\ncreate_hogefuga_table.php\n    \u30fb\u30fb\u30fb\n    public function up()\n    {\n        //\n        Schema::create('hogefuga',function($table)\n        {\n            $table->integer('hoge');\n            $table->integer('fuga');\n            $table->integer('bar');\n            $table->timestamps();\n            $table->primary(array('hoge','fuga'));\n        });\n    }\n\n    public function down()\n    {\n        //\n        Schema::drop('hogefuga');\n    }\n\n\n| hogefuga | CREATE TABLE `hogefuga` (\n  `hoge` int(11) NOT NULL,\n  `fuga` int(11) NOT NULL,\n  `bar` int(11) NOT NULL,\n  `created_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',\n  `updated_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',\n  PRIMARY KEY (`hoge`,`fuga`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci |\n\n\n\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\nEloquent\u3067\u306f\u4e3b\u30ad\u30fc\u304cid\u3067\u306a\u3044\u5834\u5408\u306f\u4e0a\u66f8\u304d\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306barray\u3092\u5165\u308c\u3066\u304a\u304f\n\nHogefuga.php\nclass Hogefuga extends Eloquent{\n\n      protected $table = 'hogefuga';\n      protected $primaryKey = array('hoge','fuga');\n\n      public function get_by_pkey($hoge,$fuga)\n      {\n    $hogefuga_rec = $this->where('hoge','=',$hoge)->where('fuga','=',$fuga)->get();\n    return $hogefuga_rec;\n      }\n\n      public function insert_data($hoge,$fuga,$bar)\n      {\n    $this->hoge = $hoge;\n    $this->fuga = $fuga;\n    $this->bar = $bar;\n    $this->save();\n      }\n\n}\n\n\n\nRoute\u306e\u4f5c\u6210\nRoute::get('hogefuga_insert/{hoge}/{fuga}/{bar}','Hogefugabar@insert_call');\nRoute::get('hogefuga_look/{hoge}/{fuga}','Hogefugabar@rec_dump');\n\n\nController\u306e\u4f5c\u6210\n\nHogefugabar.php\nclass Hogefugabar extends BaseController{\n\n      public function insert_call($hoge,$fuga,$bar)\n      {\n    $HogefugaModel = new Hogefuga;\n    $HogefugaModel->insert_data($hoge,$fuga,$bar);\n\n    return 'inserted!';\n      }\n\n      public function rec_dump($hoge,$fuga)\n      {\n    $HogefugaModel = new Hogefuga;\n    $recs = $HogefugaModel->get_by_pkey($hoge,$fuga);\n\n    return $recs[0]->hoge;\n      }\n\n}\n\n\n\n\u30ec\u30b3\u30fc\u30c9\u3092\u5165\u308c\u3066\u307f\u308b\nlaravel.dev:8080/hogefuga_insert/10/3/3\n\u3068\u304bURL\u6307\u5b9a\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3057\u3088\u3046\u3068\u3059\u308b\u3068\nsomething went wrong\u3068\u6012\u3089\u308c\u308b\u3002\n\u3057\u304b\u3057DB\u3092\u76f4\u63a5\u898b\u3066\u307f\u308b\u3068\u30ec\u30b3\u30fc\u30c9\u306f\u633f\u5165\u3055\u308c\u3066\u3044\u308b\nlaravel.dev:8080/hogefuga_look/10/3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306f\u51fa\u6765\u308b\napp/storage/logs/laravel.log\u3092\u898b\u3066\u307f\u308b\u3068\n... production.ERROR: exception 'ErrorException' with message 'PDO::lastInsertId() expects parameter ...\n\n\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u8a00\u308f\u308c\u3066\u3044\u308b\u3002\nEloquent\u304ccomposite key\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u8d77\u3053\u308b\u3088\u3046\u3060\u3002\n\u30c6\u30fc\u30d6\u30eb\u306e\u4e3b\u30ad\u30fc\u304c\u5358\u4e00\u3067\u306a\u3044\u3068\u4eca\u306e\u3068\u3053\u308d\u306f$this->save()\u3068\u304b\u3084\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3060\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u30af\u30a8\u30ea\u30fc\u30d3\u30eb\u30c0\u30fc\u3092\u4f7f\u7528\u3057\u3066\u30ec\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3059\u308b\u3088\u3046\u306b\u3059\u308b\n\nHogefuga.php\n      public function insert_data($hoge,$fuga,$bar)\n      {\n    $data = array('hoge'=>$hoge,'fuga'=>$fuga,'bar'=>$bar);\n    DB::table($this->table)->insert($data);\n      }\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u3048\u3066\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u4eca\u5ea6\u306f\u30a8\u30e9\u30fc\u304c\u7121\u304f\u30c7\u30fc\u30bf\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u305f\nLaravel4\u3067Eloquent\u3092\u4f7f\u7528\u3057\u3066\u3044\u305f\u3089\u30c7\u30fc\u30bf\u306e\u633f\u5165\u3067\u30cf\u30de\u3063\u305f\u306e\u3067\u30e1\u30e2\u3063\u3066\u304a\u304f\nhttp://laravel4.kore1server.com/docs/queries\nhttp://laravel4.kore1server.com/docs/eloquent\nhttp://stackoverflow.com/questions/17461383/how-can-i-update-data-with-eloquent-without-id-in-laravel-4\n\n#composite key\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n```\n:~/laravel_test$ php artisan migrate:make create_hogefuga_table\nCreated Migration: 2014_09_24_212126_create_hogefuga_table\nGenerating optimized class loader\nCompiling common classes\nCompiling views\n```\n\n```create_hogefuga_table.php\n\t\u30fb\u30fb\u30fb\n\tpublic function up()\n\t{\n\t\t//\n\t\tSchema::create('hogefuga',function($table)\n\t\t{\n\t\t\t$table->integer('hoge');\n\t\t\t$table->integer('fuga');\n\t\t\t$table->integer('bar');\n\t\t\t$table->timestamps();\n\t\t\t$table->primary(array('hoge','fuga'));\n\t\t});\n\t}\n\n\tpublic function down()\n\t{\n\t\t//\n\t\tSchema::drop('hogefuga');\n\t}\n```\n\n```\n| hogefuga | CREATE TABLE `hogefuga` (\n  `hoge` int(11) NOT NULL,\n  `fuga` int(11) NOT NULL,\n  `bar` int(11) NOT NULL,\n  `created_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',\n  `updated_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',\n  PRIMARY KEY (`hoge`,`fuga`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci |\n```\n\n#\u30e2\u30c7\u30eb\u306e\u4f5c\u6210\nEloquent\u3067\u306f\u4e3b\u30ad\u30fc\u304cid\u3067\u306a\u3044\u5834\u5408\u306f\u4e0a\u66f8\u304d\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306barray\u3092\u5165\u308c\u3066\u304a\u304f\n\n```Hogefuga.php\nclass Hogefuga extends Eloquent{\n      \n      protected $table = 'hogefuga';\n      protected $primaryKey = array('hoge','fuga');\n\n      public function get_by_pkey($hoge,$fuga)\n      {\n\t$hogefuga_rec = $this->where('hoge','=',$hoge)->where('fuga','=',$fuga)->get();\n\treturn $hogefuga_rec;\n      }\n\n      public function insert_data($hoge,$fuga,$bar)\n      {\n\t$this->hoge = $hoge;\n\t$this->fuga = $fuga;\n\t$this->bar = $bar;\n\t$this->save();\n      }\n\n}\n```\n\n#Route\u306e\u4f5c\u6210\n\n```\nRoute::get('hogefuga_insert/{hoge}/{fuga}/{bar}','Hogefugabar@insert_call');\nRoute::get('hogefuga_look/{hoge}/{fuga}','Hogefugabar@rec_dump');\n```\n\n#Controller\u306e\u4f5c\u6210\n\n```Hogefugabar.php\nclass Hogefugabar extends BaseController{\n\n      public function insert_call($hoge,$fuga,$bar)\n      {\n\t$HogefugaModel = new Hogefuga;\n\t$HogefugaModel->insert_data($hoge,$fuga,$bar);\n\n\treturn 'inserted!';\n      }\n\n      public function rec_dump($hoge,$fuga)\n      {\n\t$HogefugaModel = new Hogefuga;\n\t$recs = $HogefugaModel->get_by_pkey($hoge,$fuga);\n\n\treturn $recs[0]->hoge;\n      }\n\n}\n```\n\n#\u30ec\u30b3\u30fc\u30c9\u3092\u5165\u308c\u3066\u307f\u308b\nlaravel.dev:8080/hogefuga_insert/10/3/3\n\u3068\u304bURL\u6307\u5b9a\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u306b\u30ec\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3057\u3088\u3046\u3068\u3059\u308b\u3068\nsomething went wrong\u3068\u6012\u3089\u308c\u308b\u3002\n\u3057\u304b\u3057DB\u3092\u76f4\u63a5\u898b\u3066\u307f\u308b\u3068\u30ec\u30b3\u30fc\u30c9\u306f\u633f\u5165\u3055\u308c\u3066\u3044\u308b\nlaravel.dev:8080/hogefuga_look/10/3\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306f\u51fa\u6765\u308b\n\napp/storage/logs/laravel.log\u3092\u898b\u3066\u307f\u308b\u3068\n\n```\n... production.ERROR: exception 'ErrorException' with message 'PDO::lastInsertId() expects parameter ...\n```\n\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u8a00\u308f\u308c\u3066\u3044\u308b\u3002\nEloquent\u304ccomposite key\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u8d77\u3053\u308b\u3088\u3046\u3060\u3002\n\u30c6\u30fc\u30d6\u30eb\u306e\u4e3b\u30ad\u30fc\u304c\u5358\u4e00\u3067\u306a\u3044\u3068\u4eca\u306e\u3068\u3053\u308d\u306f$this->save()\u3068\u304b\u3084\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u3060\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u30af\u30a8\u30ea\u30fc\u30d3\u30eb\u30c0\u30fc\u3092\u4f7f\u7528\u3057\u3066\u30ec\u30b3\u30fc\u30c9\u3092\u633f\u5165\u3059\u308b\u3088\u3046\u306b\u3059\u308b\n\n```Hogefuga.php\n      public function insert_data($hoge,$fuga,$bar)\n      {\n\t$data = array('hoge'=>$hoge,'fuga'=>$fuga,'bar'=>$bar);\n\tDB::table($this->table)->insert($data);\n      }\n```\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u3048\u3066\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u4eca\u5ea6\u306f\u30a8\u30e9\u30fc\u304c\u7121\u304f\u30c7\u30fc\u30bf\u3092\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u305f\n"}