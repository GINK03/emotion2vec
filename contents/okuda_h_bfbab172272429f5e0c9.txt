{"context": " More than 1 year has passed since last update.\n\nSpark\u4e0a\u3067\u5b9f\u884c\u3055\u308c\u308bmahout\nspark\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3001mllib\u3068\u547c\u3070\u308c\u308b\u6a5f\u68b0\u5b66\u7fd2\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u304c\u3001mahout\u3082spark\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\u305f\u3060\u3057\u3001mahout\u30b5\u30a4\u30c8\u306b\u3082\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\n\nPlease keep in mind that this code is still in a very early experimental stage\n\n\u307e\u3060\u5b9f\u9a13\u6bb5\u968e\u306e\u3088\u3046\u3067\u3059\u306e\u3067\u611f\u3058\u3060\u3051\u3067\u3082\u3064\u304b\u3081\u305f\u3089\u3068\u601d\u3044\u307e\u3059\u3002\n\u4eca\u56de\u3001Playing with Mahout's Spark Shell\u3092\u53c2\u8003\u306bspark-shell\u4e0a\u3067\u306emahout\u306e\u5b9f\u884c\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\nInstall\n\n\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3082\u306e\noracle JDK 7\u4ee5\u4e0a\nmaven 3.2.x\u4ee5\u4e0a\nsubversion\n\nApache spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306fcdh5\u306eApache spark\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bspark\u30d0\u30fc\u30b8\u30e7\u30f3\u306f0.9.x\u3067\u3059\u3002\n(1.0.x\u3067\u305f\u3081\u3057\u305f\u3068\u3053\u308d\u3001\u30b5\u30f3\u30d7\u30eb\u306e\u5b9f\u884c\u6642\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002)\n// CDH5\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\n$ sudo wget http://archive.cloudera.com/cdh5/one-click-install/redhat/6/x86_64/cloudera-cdh-5-0.x86_64.rpm\n$ sudo yum --nogpgcheck localinstall cloudera-cdh-5-0.x86_64.rpm\n\n// spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install spark-core spark-master spark-worker spark-python\n\ninstall\u304c\u5b8c\u4e86\u3057\u305f\u3089spark\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n$ sudo service spark-master start\n$ sudo service spark-worker start\n\nhttp://<hostname>:18080\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\nmahout\u306e\u30d3\u30eb\u30c9\n\u6700\u65b0\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092svn\u3092\u5229\u7528\u3057\u3066\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u3001\u30d3\u30eb\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059.\nmahout\u306f\u3001\u4efb\u610f\u306e\u5834\u6240\u3067\u69cb\u3044\u307e\u305b\u3093\u3002\n\ncd ~/\nsvn co https://svn.apache.org/repos/asf/mahout/trunk/ mahout\ncd mahout/\nmvn -DskipTests clean install\n\n\nmahout shell\u306e\u8d77\u52d5\n\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n//\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u305fmahout\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5834\u6240\n$ export MAHOUT_HOME=/home/<user>/mahout\n// \"spark://\"\u304b\u3089\u59cb\u307e\u308bmaster url\n$ export MASTER=spark://ip-xxx-xxx-xxx-xxx.ap-northeast-1.compute.internal:7077\n// apache spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea \n$ export SPARK_HOME=/usr/lib/spark\n\nshell\u306e\u5b9f\u884c\n\ncd $MAHOUT_HOME\nbin/mahout spark-shell\n\n\nMAHOUT_LOCAL is not set; adding HADOOP_CONF_DIR to classpath.\n14/06/17 11:29:35 INFO spark.HttpServer: Starting HTTP Server\n14/06/17 11:29:35 INFO server.Server: jetty-7.x.y-SNAPSHOT\n14/06/17 11:29:35 INFO server.AbstractConnector: Started SocketConnector@0.0.0.0:50964\n...\nType :help for more information.\nmahout>\n\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\u305b\u305a\u3001mahout\u30b7\u30a7\u30eb\u304c\u8d77\u52d5\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n\u56de\u5e30\u5206\u6790\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\nPlaying with Mahout's Spark Shell\u306eexample\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u306eexample\u306f\u3001dataset about cereals\u306b\u7a40\u985e\u306b\u3064\u3044\u3066\u306e\u30c7\u30fc\u30bf\u306e\u4e00\u90e8\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nDRM (\u7dda\u5f62\u4ee3\u6570\u51e6\u7406)\u7528\u306e\u95a2\u6570\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\ndrmParallelize\u3068\u547c\u3070\u308c\u308b\u95a2\u6570\u306b\u6e21\u3059\u3053\u3068\u3067\u5206\u6563\u51e6\u7406\u3092\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\nmahout > val drmData = drmParallelize(dense(\n  (2, 2, 10.5, 10, 29.509541),  // Apple Cinnamon Cheerios\n  (1, 2, 12,   12, 18.042851),  // Cap'n'Crunch\n  (1, 1, 12,   13, 22.736446),  // Cocoa Puffs\n  (2, 1, 11,   13, 32.207582),  // Froot Loops\n  (1, 2, 12,   11, 21.871292),  // Honey Graham Ohs\n  (2, 1, 16,   8,  36.187559),  // Wheaties Honey Gold\n  (6, 2, 17,   1,  50.764999),  // Cheerios\n  (3, 2, 13,   7,  40.400208),  // Clusters\n  (3, 3, 13,   4,  45.811716)), // Great Grains Pecan\n  numPartitions = 2);\ndrmData: org.apache.mahout.sparkbindings.drm.CheckpointedDrm[Int] = org.apache.mahout.sparkbindings.drm.CheckpointedDrmBase@2bc41091\n.\n.\nmahout> val drmX = drmData(::, 0 until 4)\ndrmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553\n.\n.\nmahout> val y = drmData.collect(::, 4)\ny: org.apache.mahout.math.Vector = {0:29.509541,1:18.042851,2:22.736446,3:32.207582,4:21.871292,5:36.187559,6:50.764999,7:40.400208,8:45.811716}\n.\n.\nmahout> val drmXtX = drmX.t %*% drmX                                                                                                            \ndrmXtX: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = OpAB(OpAt(org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553),org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553)\n.\n.\nmahout> val drmXval drmXty = drmX.t %*% y                                                                                                               \ndrmXty: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = OpAx(OpAt(org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553),{0:29.509541,1:18.042851,2:22.736446,3:32.207582,4:21.871292,5:36.187559,6:50.764999,7:40.400208,8:45.811716})\n.\n.\nmahout> val XtX = drmXtX.collect\nXtX: org.apache.mahout.math.Matrix = \n{\n  0  => {0:69.0,1:40.0,2:291.0,3:137.0}\n  1  => {0:40.0,1:32.0,2:207.0,3:128.0}\n  2  => {0:291.0,1:207.0,2:1546.25,3:968.0}\n  3  => {0:137.0,1:128.0,2:968.0,3:833.0}\n}\n.\n.\nmahout> val Xty = drmXty.collect(::, 0)\nXty: org.apache.mahout.math.Vector = {0:821.6857190000001,1:549.744517,2:3978.7015894999995,3:2272.779989}\n.\n.\nmahout> val beta = solve(XtX, Xty)\nbeta: org.apache.mahout.math.Vector = {0:5.247349465378446,1:2.750794578467531,2:1.1527813010791554,3:0.10312017617608908}\n.\n.\nmahout> val yFitted = (drmX %*% beta).collect(::, 0)\nyFitted: org.apache.mahout.math.Vector = {0:29.131693510783975,1:25.819756349376444,2:23.172081947084997,3:27.266650111384287,4:25.716636173200357,5:32.514955735899626,6:56.68608824372747,7:36.95163570033205,8:39.393069750271316}\n.\n.\nmahout> (y - yFitted).norm(2)\nres1: Double = 14.200396723606845\n.\n.\nmahout> def ols(drmX: DrmLike[Int], y: Vector) = {\n     |   val XtX = (drmX.t %*% drmX).collect\n     |   val Xty = (drmX.t %*% y).collect(::, 0)\n     |   solve(XtX, Xty)\n     | }\nols: (drmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int], y: org.apache.mahout.math.Vector)org.apache.mahout.math.Vector\n.\n.\nmahout> def goodnessOfFit(drmX: DrmLike[Int], beta: Vector, y: Vector) = {                                                                      \n     |   val fittedY = (drmX %*% beta).collect(::, 0)\n     |   (y - fittedY).norm(2)\n     | }\ngoodnessOfFit: (drmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int], beta: org.apache.mahout.math.Vector, y: org.apache.mahout.math.Vector)Double\n.\n.\nmahout> val drmXwithBiasColumn = drmX.mapBlock(ncol = drmX.ncol + 1) {\n     |   case(keys, block) =>\n     |     val blockWithBiasColumn = block.like(block.nrow, block.ncol + 1)\n     |     blockWithBiasColumn(::, 0 until block.ncol) := block\n     |     blockWithBiasColumn(::, block.ncol) := 1\n     |     keys -> blockWithBiasColumn\n     | }\ndrmXwithBiasColumn: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@19170713\n.\n.\nmahout> val betaWithBiasTerm = ols(drmXwithBiasColumn, y)\nbetaWithBiasTerm: org.apache.mahout.math.Vector = {0:-1.3362653883272289,1:-13.15770132067483,2:-4.152654199020216,3:-5.679908094232256,4:163.1793268784127}\n.\n.\nmahout> 14/06/17 12:35:09 INFO scheduler.TaskSchedulerImpl: Remove TaskSet 23.0 from pool \n.\n.\nmahout> goodnessOfFit(drmXwithBiasColumn, betaWithBiasTerm, y)\nres2: Double = 7.623280714561956\n\n\u6700\u5f8c\u3001 7.62... \u3068\u3044\u3046\u6570\u5b57\u304c\u3067\u307e\u3057\u305f\u3002\n\u3053\u306e\u6570\u5024\u304c\uff10\u306b\u8fd1\u3051\u308c\u3070\u8fd1\u3044\u307b\u3069\u5206\u6790\u306e\u7d50\u679c\uff08\u7dda\u306e\u5f62\uff1f\uff09\u304c\u826f\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\n\u611f\u60f3\n\nR\u8a00\u8a9e\u306b\u8fd1\u3044\u611f\u899a\u3067\u5f0f\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u3060\u304c\u3001SparkR\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u304c\u3042\u308b\u306e\u3067\u3001\u3069\u3061\u3089\u304c\u89e3\u6790\u306a\u3069\u306b\u5411\u3044\u3066\u3044\u308b\u306e\u304b\u6c17\u306b\u306a\u308b\nmahout\u306e\u3053\u3068\u3082\u52c9\u5f37\u3057\u306a\u3044\u3068\u30fb\u30fb\u30fb\u3002\n\n\n# Spark\u4e0a\u3067\u5b9f\u884c\u3055\u308c\u308bmahout\nspark\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3001mllib\u3068\u547c\u3070\u308c\u308b\u6a5f\u68b0\u5b66\u7fd2\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u304c\u3001mahout\u3082spark\u306b\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\u305f\u3060\u3057\u3001mahout\u30b5\u30a4\u30c8\u306b\u3082\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\n> Please keep in mind that this code is still in a very early experimental stage\n\n\u307e\u3060\u5b9f\u9a13\u6bb5\u968e\u306e\u3088\u3046\u3067\u3059\u306e\u3067\u611f\u3058\u3060\u3051\u3067\u3082\u3064\u304b\u3081\u305f\u3089\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u3001[Playing with Mahout's Spark Shell](http://mahout.apache.org/users/sparkbindings/play-with-shell.html)\u3092\u53c2\u8003\u306bspark-shell\u4e0a\u3067\u306emahout\u306e\u5b9f\u884c\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n# Install\n\n## \u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u3082\u306e\noracle JDK 7\u4ee5\u4e0a\nmaven 3.2.x\u4ee5\u4e0a\nsubversion\n\n## Apache spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306fcdh5\u306eApache spark\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bspark\u30d0\u30fc\u30b8\u30e7\u30f3\u306f0.9.x\u3067\u3059\u3002\n(1.0.x\u3067\u305f\u3081\u3057\u305f\u3068\u3053\u308d\u3001\u30b5\u30f3\u30d7\u30eb\u306e\u5b9f\u884c\u6642\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002)\n\n```\n// CDH5\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\n$ sudo wget http://archive.cloudera.com/cdh5/one-click-install/redhat/6/x86_64/cloudera-cdh-5-0.x86_64.rpm\n$ sudo yum --nogpgcheck localinstall cloudera-cdh-5-0.x86_64.rpm\n\n// spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install spark-core spark-master spark-worker spark-python\n```\ninstall\u304c\u5b8c\u4e86\u3057\u305f\u3089spark\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n```\n$ sudo service spark-master start\n$ sudo service spark-worker start\n```\n`http://<hostname>:18080`\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n![spark1.JPG](https://qiita-image-store.s3.amazonaws.com/0/36221/bceeb04d-16eb-34a5-c89c-7b08680e6f5a.jpeg)\n\n## mahout\u306e\u30d3\u30eb\u30c9\n\u6700\u65b0\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092svn\u3092\u5229\u7528\u3057\u3066\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u3001\u30d3\u30eb\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059.\nmahout\u306f\u3001\u4efb\u610f\u306e\u5834\u6240\u3067\u69cb\u3044\u307e\u305b\u3093\u3002\n```\ncd ~/\nsvn co https://svn.apache.org/repos/asf/mahout/trunk/ mahout\ncd mahout/\nmvn -DskipTests clean install\n```\n## mahout shell\u306e\u8d77\u52d5\n\n\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n```\n//\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u305fmahout\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5834\u6240\n$ export MAHOUT_HOME=/home/<user>/mahout\n// \"spark://\"\u304b\u3089\u59cb\u307e\u308bmaster url\n$ export MASTER=spark://ip-xxx-xxx-xxx-xxx.ap-northeast-1.compute.internal:7077\n// apache spark\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea \n$ export SPARK_HOME=/usr/lib/spark\n```\n\nshell\u306e\u5b9f\u884c\n```\ncd $MAHOUT_HOME\nbin/mahout spark-shell\n```\n```\nMAHOUT_LOCAL is not set; adding HADOOP_CONF_DIR to classpath.\n14/06/17 11:29:35 INFO spark.HttpServer: Starting HTTP Server\n14/06/17 11:29:35 INFO server.Server: jetty-7.x.y-SNAPSHOT\n14/06/17 11:29:35 INFO server.AbstractConnector: Started SocketConnector@0.0.0.0:50964\n...\nType :help for more information.\nmahout>\n```\n\u30a8\u30e9\u30fc\u304c\u767a\u751f\u305b\u305a\u3001mahout\u30b7\u30a7\u30eb\u304c\u8d77\u52d5\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n## \u56de\u5e30\u5206\u6790\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n[Playing with Mahout's Spark Shell](http://mahout.apache.org/users/sparkbindings/play-with-shell.html)\u306eexample\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u306eexample\u306f\u3001[dataset about cereals](http://lib.stat.cmu.edu/DASL/Datafiles/Cereals.html)\u306b\u7a40\u985e\u306b\u3064\u3044\u3066\u306e\u30c7\u30fc\u30bf\u306e\u4e00\u90e8\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nDRM (\u7dda\u5f62\u4ee3\u6570\u51e6\u7406)\u7528\u306e\u95a2\u6570\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\ndrmParallelize\u3068\u547c\u3070\u308c\u308b\u95a2\u6570\u306b\u6e21\u3059\u3053\u3068\u3067\u5206\u6563\u51e6\u7406\u3092\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n```\nmahout > val drmData = drmParallelize(dense(\n  (2, 2, 10.5, 10, 29.509541),  // Apple Cinnamon Cheerios\n  (1, 2, 12,   12, 18.042851),  // Cap'n'Crunch\n  (1, 1, 12,   13, 22.736446),  // Cocoa Puffs\n  (2, 1, 11,   13, 32.207582),  // Froot Loops\n  (1, 2, 12,   11, 21.871292),  // Honey Graham Ohs\n  (2, 1, 16,   8,  36.187559),  // Wheaties Honey Gold\n  (6, 2, 17,   1,  50.764999),  // Cheerios\n  (3, 2, 13,   7,  40.400208),  // Clusters\n  (3, 3, 13,   4,  45.811716)), // Great Grains Pecan\n  numPartitions = 2);\ndrmData: org.apache.mahout.sparkbindings.drm.CheckpointedDrm[Int] = org.apache.mahout.sparkbindings.drm.CheckpointedDrmBase@2bc41091\n.\n.\nmahout> val drmX = drmData(::, 0 until 4)\ndrmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553\n.\n.\nmahout> val y = drmData.collect(::, 4)\ny: org.apache.mahout.math.Vector = {0:29.509541,1:18.042851,2:22.736446,3:32.207582,4:21.871292,5:36.187559,6:50.764999,7:40.400208,8:45.811716}\n.\n.\nmahout> val drmXtX = drmX.t %*% drmX                                                                                                            \ndrmXtX: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = OpAB(OpAt(org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553),org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553)\n.\n.\nmahout> val drmXval drmXty = drmX.t %*% y                                                                                                               \ndrmXty: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = OpAx(OpAt(org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@3605a553),{0:29.509541,1:18.042851,2:22.736446,3:32.207582,4:21.871292,5:36.187559,6:50.764999,7:40.400208,8:45.811716})\n.\n.\nmahout> val XtX = drmXtX.collect\nXtX: org.apache.mahout.math.Matrix = \n{\n  0  => {0:69.0,1:40.0,2:291.0,3:137.0}\n  1  => {0:40.0,1:32.0,2:207.0,3:128.0}\n  2  => {0:291.0,1:207.0,2:1546.25,3:968.0}\n  3  => {0:137.0,1:128.0,2:968.0,3:833.0}\n}\n.\n.\nmahout> val Xty = drmXty.collect(::, 0)\nXty: org.apache.mahout.math.Vector = {0:821.6857190000001,1:549.744517,2:3978.7015894999995,3:2272.779989}\n.\n.\nmahout> val beta = solve(XtX, Xty)\nbeta: org.apache.mahout.math.Vector = {0:5.247349465378446,1:2.750794578467531,2:1.1527813010791554,3:0.10312017617608908}\n.\n.\nmahout> val yFitted = (drmX %*% beta).collect(::, 0)\nyFitted: org.apache.mahout.math.Vector = {0:29.131693510783975,1:25.819756349376444,2:23.172081947084997,3:27.266650111384287,4:25.716636173200357,5:32.514955735899626,6:56.68608824372747,7:36.95163570033205,8:39.393069750271316}\n.\n.\nmahout> (y - yFitted).norm(2)\nres1: Double = 14.200396723606845\n.\n.\nmahout> def ols(drmX: DrmLike[Int], y: Vector) = {\n     |   val XtX = (drmX.t %*% drmX).collect\n     |   val Xty = (drmX.t %*% y).collect(::, 0)\n     |   solve(XtX, Xty)\n     | }\nols: (drmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int], y: org.apache.mahout.math.Vector)org.apache.mahout.math.Vector\n.\n.\nmahout> def goodnessOfFit(drmX: DrmLike[Int], beta: Vector, y: Vector) = {                                                                      \n     |   val fittedY = (drmX %*% beta).collect(::, 0)\n     |   (y - fittedY).norm(2)\n     | }\ngoodnessOfFit: (drmX: org.apache.mahout.sparkbindings.drm.DrmLike[Int], beta: org.apache.mahout.math.Vector, y: org.apache.mahout.math.Vector)Double\n.\n.\nmahout> val drmXwithBiasColumn = drmX.mapBlock(ncol = drmX.ncol + 1) {\n     |   case(keys, block) =>\n     |     val blockWithBiasColumn = block.like(block.nrow, block.ncol + 1)\n     |     blockWithBiasColumn(::, 0 until block.ncol) := block\n     |     blockWithBiasColumn(::, block.ncol) := 1\n     |     keys -> blockWithBiasColumn\n     | }\ndrmXwithBiasColumn: org.apache.mahout.sparkbindings.drm.DrmLike[Int] = org.apache.mahout.sparkbindings.drm.plan.OpMapBlock@19170713\n.\n.\nmahout> val betaWithBiasTerm = ols(drmXwithBiasColumn, y)\nbetaWithBiasTerm: org.apache.mahout.math.Vector = {0:-1.3362653883272289,1:-13.15770132067483,2:-4.152654199020216,3:-5.679908094232256,4:163.1793268784127}\n.\n.\nmahout> 14/06/17 12:35:09 INFO scheduler.TaskSchedulerImpl: Remove TaskSet 23.0 from pool \n.\n.\nmahout> goodnessOfFit(drmXwithBiasColumn, betaWithBiasTerm, y)\nres2: Double = 7.623280714561956\n```\n\u6700\u5f8c\u3001 7.62... \u3068\u3044\u3046\u6570\u5b57\u304c\u3067\u307e\u3057\u305f\u3002\n\u3053\u306e\u6570\u5024\u304c\uff10\u306b\u8fd1\u3051\u308c\u3070\u8fd1\u3044\u307b\u3069\u5206\u6790\u306e\u7d50\u679c\uff08\u7dda\u306e\u5f62\uff1f\uff09\u304c\u826f\u3044\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\n## \u611f\u60f3\n* R\u8a00\u8a9e\u306b\u8fd1\u3044\u611f\u899a\u3067\u5f0f\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u3060\u304c\u3001[SparkR](http://amplab-extras.github.io/SparkR-pkg/)\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u304c\u3042\u308b\u306e\u3067\u3001\u3069\u3061\u3089\u304c\u89e3\u6790\u306a\u3069\u306b\u5411\u3044\u3066\u3044\u308b\u306e\u304b\u6c17\u306b\u306a\u308b\n* mahout\u306e\u3053\u3068\u3082\u52c9\u5f37\u3057\u306a\u3044\u3068\u30fb\u30fb\u30fb\u3002\n", "tags": ["Spark", "mahout", "\u6a5f\u68b0\u5b66\u7fd2"]}