{"context": "\n\nSEIL\u3068\u306f\n\u300cSEIL\uff08\u30b6\u30a4\u30eb\uff09\u300d\u306f\u3001IIJ\u304cISP\u306e\u30ce\u30a6\u30cf\u30a6\u3092\u7d50\u96c6\u3057\u3066\u958b\u767a\u3057\u305f\u9ad8\u6a5f\u80fd\u30eb\u30fc\u30bf\u3067\u3059\u3002\nSEIL/x86\u306f\u306a\u3093\u304b800\u5186\u3067\u8cb7\u3048\u308b\n\u3068\u308a\u3042\u3048\u305a\u4f55\u3082\u8003\u3048\u305a\u306bVM\u306b\u7a81\u3063\u8fbc\u3081\u3070\u52d5\u304f\u30eb\u30fc\u30bf\u3002\nIPv6\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u308b\u3057\u3001BGP,OSPF,RIP\u3068\u4e00\u901a\u308a\u52d5\u304f\u3002\n\u305d\u3093\u306a\u30eb\u30fc\u30bf\u3067\u3059\u304c EBGP-multihop\u306b\u5bfe\u5fdc\u3057\u3066\u307e\u305b\u3093\u3002\n\u3067\u3001SEIL\u306e\u9593\u306bFirewall\u304c\u3044\u308b\u3088\u3046\u306a\u74b0\u5883\u3067\u306a\u3093\u3068\u304b\u305d\u308c\u3063\u307d\u304f\u52d5\u304b\u3057\u305f\u3044\u306a\u3068\u89e6\u3063\u3066\u307f\u305f\u8a18\u9332\u3002\n\n\u74b0\u5883\n\n\u5229\u7528\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\n\nVirtualBox 5.1.6\nVagrant 1.8.6\nSEIL/x86 5.32vagrant box\n\nDebian8(Firewall\u4ee3\u308f\u308a)\n\n\u4f7f\u7528\u3057\u305f\u30c7\u30fc\u30bf\u306fgithub\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\nTopology\nseil1  ----  fw(debian) --- seil2\n\n\u5b9f\u9a13\u74b0\u5883\n\ncase-1 \u4f55\u3082\u8003\u3048\u305a\u306bEBGP\u3067peering\u3057\u3066\u307f\u308b\n\n\u8a2d\u5b9a\nseil-1\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 192.168.57.100 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\n\nseill-2\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 192.168.56.100 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\n\n\n\u7d50\u679c\nttl=254\nseil-1# ping 192.168.57.100\nPING 192.168.57.100 (192.168.57.100): 56 data bytes\n64 bytes from 192.168.57.100: icmp_seq=0 ttl=254 time=3.089 ms\n\nBGP peer\u304c\u5f35\u308c\u3066\u306a\u3044\u3002\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 192.168.57.100, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 0.0.0.0\n  BGP state = Active\n  Last read 00:57:57, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  0          0\n    Notifications:          0          0\n    Updates:                0          0\n    Keepalives:             0          0\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                  0          0\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  0 accepted prefixes\n\n  Connections established 0; dropped 0\n  Last reset never\nNext connect timer due in 40 seconds\n\n\nipsec\u3067tunnel\u3057\u3066\u307f\u308b\u3002(ipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u4f5c\u3089\u305a)\n\n\u8a2d\u5b9a\nseil-1\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 192.168.57.100 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.57.100\" \"test\"\nike peer add PEERtest address 192.168.57.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel 192.168.56.100 192.168.57.100 ike SAPtest esp enable\nipsec security-policy add SPtest security-association SAtest src 192.168.56.100 dst 192.168.57.100\n\nseil-2\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 192.168.56.100 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.56.100\" \"test\"\nike peer add PEERtest address 192.168.56.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel 192.168.57.100 192.168.56.100 ike SAPtest esp enable\nipsec security-policy add SPtest security-association SAtest src 192.168.57.100 dst 192.168.56.100\n\n\n\u7d50\u679c\nttl=255\nseil-1# ping 192.168.57.100\nPING 192.168.57.100 (192.168.57.100): 56 data bytes\n64 bytes from 192.168.57.100: icmp_seq=0 ttl=255 time=2.308 ms\n\nBGP peer \u306f\u5f35\u308c\u3066\u3044\u308b\u3051\u308c\u3069\u3001\u7d4c\u8def\u60c5\u5831\u304c\u3082\u3089\u3048\u3066\u306a\u3044\u3002\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 192.168.57.100, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 10.0.0.2\n  BGP state = Established, up for 00:00:43\n  Last read 00:00:42, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Neighbor capabilities:\n    4 Byte AS: advertised and received\n    Route refresh: advertised and received(old & new)\n    Address family IPv4 Unicast: advertised and received\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  1          0\n    Notifications:          0          0\n    Updates:                1          1\n    Keepalives:             2          1\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                  4          2\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  0 accepted prefixes\n\n  Connections established 1; dropped 0\n  Last reset never\nLocal host: 192.168.56.100, Local port: 179\nForeign host: 192.168.57.100, Foreign port: 65534\nNexthop: 192.168.56.100\n\n\nipsec\u3067tunnel\u3057\u3066\u307f\u308b\u3002(ipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u4f5c\u6210)\n\n\u8a2d\u5b9a\nseil-1\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 10.3.0.2 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\ninterface ipsec0 tunnel 192.168.56.100 192.168.57.100\nint ipsec0 address 10.3.0.1/30 remote 10.3.0.2\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.57.100\" \"test\"\nike peer add PEERtest address 192.168.57.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable tunnel-interface enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel-interface ipsec0 ike SAPtest esp enable\n\nseil-2\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 10.3.0.1 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\ninterface ipsec0 tunnel 192.168.57.100 192.168.56.100\ninterface ipsec0 addr 10.3.0.2/30 remote 10.3.0.1\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.56.100\" \"test\"\nike peer add PEERtest address 192.168.56.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable tunnel-interface enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel-interface ipsec0 ike SAPtest esp enable\n\n\n\u7d50\u679c\nttl=255\nseil-1# ping 10.3.0.2\nPING 10.3.0.2 (10.3.0.2): 56 data bytes\n64 bytes from 10.3.0.2: icmp_seq=0 ttl=255 time=3.632 ms\n\n\u7d4c\u8def\u60c5\u5831\u304c\u3082\u3089\u3048\u3066\u3044\u308b\u3051\u308c\u3069\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 10.3.0.2, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 10.0.0.2\n  BGP state = Established, up for 00:15:10\n  Last read 00:00:10, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Neighbor capabilities:\n    4 Byte AS: advertised and received\n    Route refresh: advertised and received(old & new)\n    Address family IPv4 Unicast: advertised and received\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  1          0\n    Notifications:          0          0\n    Updates:                1          1\n    Keepalives:            17         16\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                 19         17\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  1 accepted prefixes\n\n  Connections established 1; dropped 0\n  Last reset never\nLocal host: 10.3.0.1, Local port: 179\nForeign host: 10.3.0.2, Foreign port: 65533\nNexthop: 10.3.0.1\n\n\u5f53\u7136\u3001next-hop\u306fipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u7d4c\u7531\u3002\nseil-1# sh statu route dyna bgp\nBGP table version is 0, local router ID is 10.0.0.1\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 10.1.0.0/24      0.0.0.0                  0         32768 i\n*> 10.2.0.0/24      10.3.0.2                 0             0 65502 i\n\nTotal number of prefixes 2\n\nseil-1# sh statu route\nFlags: C - Connected, M - Miscellaneous, B - BGP, O - OSPF, R - RIP, S - Static\n       * - System route, ! - inconsistent\n\nDestination        Gateway            Interface Flags  Dist.\n10.0.2.0/24        lan0               lan0      C*        0\n10.1.0.0/24        lan2               lan2      C*        0\n10.2.0.0/24        10.3.0.2           ipsec0    B*       20\n10.3.0.0/30        ipsec0             ipsec0    C*        0\n10.3.0.1/32        127.0.0.1          loopback  M*        0\n127.0.0.0/8        loopback           loopback  C*        0\n192.168.56.0/24    lan1               lan1      C*        0\n192.168.57.100/32  192.168.56.110     lan1      S*        1\n224.0.0.0/4        127.0.0.1          loopback  M*        -\n\n\u3053\u308c\u3067\u306f\u5916\u306b\u3042\u308bFirewall\u3067\u5236\u5fa1\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5185\u5074\u306bFirewall\u304c\u5fc5\u8981\u3002\n\n\u7d50\u8ad6\n\u7121\u7406\u3067\u3057\u305f\u3002\nBGP peering \u3057\u305f\u5148\u306b\u3042\u308b\u30bb\u30b0\u30e1\u30f3\u30c8\u304c\u5206\u304b\u3063\u3066\u3044\u308c\u3070\u3001\nSEIL\u306efilter\u8a2d\u5b9a\u3067next-hop\u3092\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u306e\u3067\u4f55\u3068\u304b\u306a\u3089\u306a\u304f\u306f\u306a\u3044\u304b\u306a\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\u3002\n\u3044\u3063\u305d\u3001\u5185\u5074\u3067\u4f7f\u3046\u4e88\u5b9a\u306e\u306a\u3044\u30a2\u30c9\u30ec\u30b9\u5168\u3066\u306enext-hop\u3092\u66f8\u304d\u63db\u3048\u3066\u3057\u307e\u3048\u3070\u3088\u3044\u304b\u3002\n\u5185\u5074\u304b\u3089SEIL/x86\u306b\u305f\u3069\u308a\u7740\u304f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u5148\u306b\u884c\u304f\u3079\u304d\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3067\u3057\u3087\u3046\u304b\u3089\u3002\n# [SEIL](https://www.seil.jp/)\u3068\u306f\n\u300cSEIL\uff08\u30b6\u30a4\u30eb\uff09\u300d\u306f\u3001IIJ\u304cISP\u306e\u30ce\u30a6\u30cf\u30a6\u3092\u7d50\u96c6\u3057\u3066\u958b\u767a\u3057\u305f\u9ad8\u6a5f\u80fd\u30eb\u30fc\u30bf\u3067\u3059\u3002\n\nSEIL/x86\u306f\u306a\u3093\u304b[800\u5186](https://la-it.jp/supply/item_list/seilx86.html)\u3067\u8cb7\u3048\u308b\n\u3068\u308a\u3042\u3048\u305a\u4f55\u3082\u8003\u3048\u305a\u306bVM\u306b\u7a81\u3063\u8fbc\u3081\u3070\u52d5\u304f\u30eb\u30fc\u30bf\u3002\nIPv6\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u308b\u3057\u3001BGP,OSPF,RIP\u3068\u4e00\u901a\u308a\u52d5\u304f\u3002\n\n\u305d\u3093\u306a\u30eb\u30fc\u30bf\u3067\u3059\u304c EBGP-multihop\u306b\u5bfe\u5fdc\u3057\u3066\u307e\u305b\u3093\u3002\n\u3067\u3001SEIL\u306e\u9593\u306bFirewall\u304c\u3044\u308b\u3088\u3046\u306a\u74b0\u5883\u3067\u306a\u3093\u3068\u304b\u305d\u308c\u3063\u307d\u304f\u52d5\u304b\u3057\u305f\u3044\u306a\u3068\u89e6\u3063\u3066\u307f\u305f\u8a18\u9332\u3002\n\n# \u74b0\u5883\n## \u5229\u7528\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\n* VirtualBox 5.1.6\n* Vagrant 1.8.6\n* SEIL/x86 5.32[vagrant box](https://www.seil.jp/support/release/download_vm.html)\n* Debian8(Firewall\u4ee3\u308f\u308a)\n\n\u4f7f\u7528\u3057\u305f\u30c7\u30fc\u30bf\u306f[github](https://github.com/paihu/seil-ebgptest)\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n## Topology\nseil1  ----  fw(debian) --- seil2\n\n# \u5b9f\u9a13\u74b0\u5883\n## case-1 \u4f55\u3082\u8003\u3048\u305a\u306bEBGP\u3067peering\u3057\u3066\u307f\u308b\n### \u8a2d\u5b9a\nseil-1\n\n```\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 192.168.57.100 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\n```\n\nseill-2\n\n```\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 192.168.56.100 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\n```\n\n### \u7d50\u679c\n\nttl=254\n\n```\nseil-1# ping 192.168.57.100\nPING 192.168.57.100 (192.168.57.100): 56 data bytes\n64 bytes from 192.168.57.100: icmp_seq=0 ttl=254 time=3.089 ms\n```\n\nBGP peer\u304c\u5f35\u308c\u3066\u306a\u3044\u3002\n\n```\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 192.168.57.100, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 0.0.0.0\n  BGP state = Active\n  Last read 00:57:57, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  0          0\n    Notifications:          0          0\n    Updates:                0          0\n    Keepalives:             0          0\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                  0          0\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  0 accepted prefixes\n\n  Connections established 0; dropped 0\n  Last reset never\nNext connect timer due in 40 seconds\n```\n\n## ipsec\u3067tunnel\u3057\u3066\u307f\u308b\u3002(ipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u4f5c\u3089\u305a)\n### \u8a2d\u5b9a\nseil-1\n\n```\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 192.168.57.100 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.57.100\" \"test\"\nike peer add PEERtest address 192.168.57.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel 192.168.56.100 192.168.57.100 ike SAPtest esp enable\nipsec security-policy add SPtest security-association SAtest src 192.168.56.100 dst 192.168.57.100\n```\n\nseil-2\n\n```\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 192.168.56.100 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.56.100\" \"test\"\nike peer add PEERtest address 192.168.56.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel 192.168.57.100 192.168.56.100 ike SAPtest esp enable\nipsec security-policy add SPtest security-association SAtest src 192.168.57.100 dst 192.168.56.100\n```\n\n### \u7d50\u679c\nttl=255\n\n```\nseil-1# ping 192.168.57.100\nPING 192.168.57.100 (192.168.57.100): 56 data bytes\n64 bytes from 192.168.57.100: icmp_seq=0 ttl=255 time=2.308 ms\n```\n\nBGP peer \u306f\u5f35\u308c\u3066\u3044\u308b\u3051\u308c\u3069\u3001\u7d4c\u8def\u60c5\u5831\u304c\u3082\u3089\u3048\u3066\u306a\u3044\u3002\n\n```\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 192.168.57.100, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 10.0.0.2\n  BGP state = Established, up for 00:00:43\n  Last read 00:00:42, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Neighbor capabilities:\n    4 Byte AS: advertised and received\n    Route refresh: advertised and received(old & new)\n    Address family IPv4 Unicast: advertised and received\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  1          0\n    Notifications:          0          0\n    Updates:                1          1\n    Keepalives:             2          1\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                  4          2\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  0 accepted prefixes\n\n  Connections established 1; dropped 0\n  Last reset never\nLocal host: 192.168.56.100, Local port: 179\nForeign host: 192.168.57.100, Foreign port: 65534\nNexthop: 192.168.56.100\n```\n\n## ipsec\u3067tunnel\u3057\u3066\u307f\u308b\u3002(ipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u4f5c\u6210)\n### \u8a2d\u5b9a\nseil-1\n\n```\nhostname seil-1\ninterface lan1 add 192.168.56.100/24\ninterface lan2 add 10.1.0.1/24\nroute dyna bgp my-as 65501\nroute dyna bgp router 10.0.0.1\nroute dyna bgp nei add 10.3.0.2 remote 65502\nroute dyna bgp network add 10.1.0.0/24\nroute dyna bgp en\nroute add 192.168.57.100 192.168.56.110\ninterface ipsec0 tunnel 192.168.56.100 192.168.57.100\nint ipsec0 address 10.3.0.1/30 remote 10.3.0.2\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.57.100\" \"test\"\nike peer add PEERtest address 192.168.57.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable tunnel-interface enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel-interface ipsec0 ike SAPtest esp enable\n```\n\nseil-2\n\n```\nhostname seil-2\ninterface lan1 add 192.168.57.100/24\ninterface lan2 add 10.2.0.1/24\nroute dyna bgp my-as 65502\nroute dyna bgp router 10.0.0.2\nroute dyna bgp nei add 10.3.0.1 remote 65501\nroute dyna bgp network add 10.2.0.0/24\nroute dyna bgp en\nroute add 192.168.56.100 192.168.57.110\ninterface ipsec0 tunnel 192.168.57.100 192.168.56.100\ninterface ipsec0 addr 10.3.0.2/30 remote 10.3.0.1\nike proposal add IKEPtest encryption aes256 hash sha256 authentication preshared-key dh-group modp1024 lifetime-of-time 12h\nipsec security-association proposal add SAPtest pfs-group modp1024 authentication-algorithm hmac-sha256 encryption-algorithm aes256 lifetime-of-time 6h\nike preshared-key add \"192.168.56.100\" \"test\"\nike peer add PEERtest address 192.168.56.100 exchange-mode main proposals IKEPtest my-identifier address peers-identifier address initial-contact enable tunnel-interface enable\nike auto-initiation enable\nipsec security-association add SAtest tunnel-interface ipsec0 ike SAPtest esp enable\n```\n\n\n### \u7d50\u679c\nttl=255\n\n```\nseil-1# ping 10.3.0.2\nPING 10.3.0.2 (10.3.0.2): 56 data bytes\n64 bytes from 10.3.0.2: icmp_seq=0 ttl=255 time=3.632 ms\n```\n\n\u7d4c\u8def\u60c5\u5831\u304c\u3082\u3089\u3048\u3066\u3044\u308b\u3051\u308c\u3069\n\n```\nseil-1# sh statu route dyna bgp nei\nBGP neighbor is 10.3.0.2, remote AS 65502, local AS 65501, external link\n  BGP version 4, remote router ID 10.0.0.2\n  BGP state = Established, up for 00:15:10\n  Last read 00:00:10, hold time is 180, keepalive interval is 60 seconds\n  Configured hold time is 180, keepalive interval is 60 seconds\n  Neighbor capabilities:\n    4 Byte AS: advertised and received\n    Route refresh: advertised and received(old & new)\n    Address family IPv4 Unicast: advertised and received\n  Message statistics:\n    Inq depth is 0\n    Outq depth is 0\n                         Sent       Rcvd\n    Opens:                  1          0\n    Notifications:          0          0\n    Updates:                1          1\n    Keepalives:            17         16\n    Route Refresh:          0          0\n    Capability:             0          0\n    Total:                 19         17\n  Minimum time between advertisement runs is 30 seconds\n\n For address family: IPv4 Unicast\n  Community attribute sent to this neighbor(both)\n  1 accepted prefixes\n\n  Connections established 1; dropped 0\n  Last reset never\nLocal host: 10.3.0.1, Local port: 179\nForeign host: 10.3.0.2, Foreign port: 65533\nNexthop: 10.3.0.1\n```\n\n\u5f53\u7136\u3001next-hop\u306fipsec\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u7d4c\u7531\u3002\n\n```\nseil-1# sh statu route dyna bgp\nBGP table version is 0, local router ID is 10.0.0.1\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 10.1.0.0/24      0.0.0.0                  0         32768 i\n*> 10.2.0.0/24      10.3.0.2                 0             0 65502 i\n\nTotal number of prefixes 2\n```\n\n```\nseil-1# sh statu route\nFlags: C - Connected, M - Miscellaneous, B - BGP, O - OSPF, R - RIP, S - Static\n       * - System route, ! - inconsistent\n\nDestination        Gateway            Interface Flags  Dist.\n10.0.2.0/24        lan0               lan0      C*        0\n10.1.0.0/24        lan2               lan2      C*        0\n10.2.0.0/24        10.3.0.2           ipsec0    B*       20\n10.3.0.0/30        ipsec0             ipsec0    C*        0\n10.3.0.1/32        127.0.0.1          loopback  M*        0\n127.0.0.0/8        loopback           loopback  C*        0\n192.168.56.0/24    lan1               lan1      C*        0\n192.168.57.100/32  192.168.56.110     lan1      S*        1\n224.0.0.0/4        127.0.0.1          loopback  M*        -\n```\n\n\u3053\u308c\u3067\u306f\u5916\u306b\u3042\u308bFirewall\u3067\u5236\u5fa1\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5185\u5074\u306bFirewall\u304c\u5fc5\u8981\u3002\n\n# \u7d50\u8ad6\n\u7121\u7406\u3067\u3057\u305f\u3002\nBGP peering \u3057\u305f\u5148\u306b\u3042\u308b\u30bb\u30b0\u30e1\u30f3\u30c8\u304c\u5206\u304b\u3063\u3066\u3044\u308c\u3070\u3001\nSEIL\u306efilter\u8a2d\u5b9a\u3067next-hop\u3092\u66f8\u304d\u63db\u3048\u3089\u308c\u308b\u306e\u3067\u4f55\u3068\u304b\u306a\u3089\u306a\u304f\u306f\u306a\u3044\u304b\u306a\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u3059\u3002\n\u3044\u3063\u305d\u3001\u5185\u5074\u3067\u4f7f\u3046\u4e88\u5b9a\u306e\u306a\u3044\u30a2\u30c9\u30ec\u30b9\u5168\u3066\u306enext-hop\u3092\u66f8\u304d\u63db\u3048\u3066\u3057\u307e\u3048\u3070\u3088\u3044\u304b\u3002\n\u5185\u5074\u304b\u3089SEIL/x86\u306b\u305f\u3069\u308a\u7740\u304f\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u5148\u306b\u884c\u304f\u3079\u304d\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3067\u3057\u3087\u3046\u304b\u3089\u3002\n", "tags": ["Network", "Seil"]}