{"context": " More than 1 year has passed since last update.\u6b63\u3057\u304f\u306fDQL\u304c\u30ed\u30b0\u306b\u51fa\u308b\u306e\u3060\u3051\u3069\u3001\u3042\u3063\u305f\u65b9\u304c\u8abf\u67fb\u3068\u304b\u3057\u6613\u3044\u306e\u3067\u30ed\u30b0\u306b\u66f8\u304d\u51fa\u3057\u3066\u307f\u305f\u3002\nFuelPHP+Doctrine2\u306e\u69cb\u6210\u306f\nhttp://qiita.com/gyhino@github/items/188d207d26f608269b3a\n\u3092\u5f15\u304d\u7d9a\u304d\u4f7f\u3046\u3002\n\n\u8981\u4ef6\n\n\u30ed\u30b0\u306bSQL(DQL)\u304c\u51fa\u529b\u3055\u308c\u308b\n\u30ed\u30b0\u306b\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u308b\n\n\nDoctrine2\u3067SQL\u3092\u30ed\u30b0\u306b\u51fa\u3059\u305f\u3081\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\uff1f\nDoctrine2\u306b\u306fSQLLogger\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u305d\u308c\u3092\u4f7f\u3046\u3053\u3068\u3067\u7c21\u5358\u306bSQL\u3092\u51fa\u529b\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3002\nSQLLogger\u306fInterface\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u81ea\u5206\u3067\u597d\u304d\u306b\u5b9f\u88c5\u3059\u308b\u3002\nhttps://github.com/doctrine/dbal/blob/master/lib/Doctrine/DBAL/Logging/SQLLogger.php\n\nFuelPHP\u306e\u30ed\u30b0\u306bSQL\u3092\u51fa\u3059\u305f\u3081\u306b\u6539\u4fee\u3092\u3059\u308b\n\u4eca\u56deDoctrine2\u3092\u6271\u3046\u306e\u306b\u5229\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3082SQLLogger\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://github.com/aspendigital/fuel-doctrine2/blob/master/classes/Fuel/Doctrine/Logger.php\n\u30e9\u30a4\u30d6\u30e9\u30ea\u5185\u3067profiling\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u3053\u308c\u3092\u4f7f\u3046\u69d8\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\u3057\u304b\u3057\u3001\u3053\u306eSQLLogger\u306e\u5b9f\u88c5\u306f\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306bSQL\u3068\u5b9f\u884c\u6642\u9593\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3060\u3051\u3067\u3001\u30ed\u30b0\u306b\u306f\u66f8\u304d\u51fa\u3055\u308c\u306a\u3044\u3002\n\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u62e1\u5f35\u3059\u308b\u5f62\u3067\u9032\u3081\u308b\u3002\n\nFuel\\Doctrine\\Logger\u306e\u62e1\u5f35\nSQL\u3068\u51e6\u7406\u6642\u9593\u3092\u30ed\u30b0\u306b\u51fa\u3059\u306b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u62e1\u5f35\u3092\u3059\u308b\u3002\n\nfuel/app/classes/doctrine/SQLLogger.php\n<?php\n\nnamespace Sample\\Doctrine;\n\nclass SQLLogger extends \\Fuel\\Doctrine\\Logger\n{\n    protected $startTime;\n    protected $lastSql;\n\n    public function startQuery($sql, array $params = null, array $types = null)\n    {\n        parent::startQuery($sql, $params, $types);\n\n        $this->startTime = microtime(true);\n        $this->lastSql = $sql;\n    }\n\n    public function stopQuery()\n    {\n        parent::stopQuery();\n\n        \\Log::info(json_encode(array(\n            'sql' => $this->lastSql,\n            'elapsedTime' => sprintf('%.10f', (microtime(true) - $this->startTime)), \n        )));\n    }\n}\n\n\n\nnamespace\u3092Autoloader\u306b\u8a2d\u5b9a\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\u4eca\u5f8c\u306e\u3053\u3068\u3092\u8003\u3048\u3001PSR-0\u6e96\u62e0\u3067\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3002\n\nfuel/app/bootstrap.php\n<?php\n\n//...\n\n// SQLLogger\u304c\u5c5e\u3059\u308b\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3092FuelPHP\u306eAutoloader\u306b\u8ffd\u52a0\nAutoloader::add_namespace('Sample\\Doctrine', APPPATH.'classes'.DIRECTORY_SEPARATOR.'doctrine'.DIRECTORY_SEPARATOR, true);\n\nAutoloader::add_classes(array(\n));\n\n// Register the autoloader\nAutoloader::register();\n\n//...\n\n\n\n\n\u62e1\u5f35\u3057\u305fSQLLogger\u3092Doctrine2\u306b\u6e21\u3059\u8a2d\u5b9a\u3092\u3059\u308b\n\u62e1\u5f35\u3057\u305f\u3068\u3053\u308d\u3067\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u4f7f\u308f\u308c\u306a\u3044\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\nfuel/app/config/db.php\n<?php\n\nreturn array(\n    'doctrine2' => array(\n        'proxy_dir' => APPPATH.'classes'.DIRECTORY_SEPARATOR.'proxy',\n        'proxy_namespace' => 'Proxy',\n        'metadata_path' => APPPATH.'classes'.DIRECTORY_SEPARATOR.'entity',\n        'init_callback' => function($manager, $connection)\n        {\n            // Doctrine\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u6642\u306e\u4e00\u756a\u6700\u5f8c\u306b\u547c\u3070\u308c\u308b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\n            $manager\n                ->getConnection()\n                ->getConfiguration()\n                ->setSQLLogger(new Sample\\Doctrine\\SQLLogger($connection));\n        },\n    ),\n    //...\n);\n\n\n\u203bprofiling\u304c\u7121\u52b9\u306e\u6642\u306f\u8003\u616e\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u304a\u305d\u3089\u304f\u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\n\n\u304a\u3057\u307e\u3044\n\u304a\u3057\u307e\u3044\u3002\n\n\u6b63\u3057\u304f\u306fDQL\u304c\u30ed\u30b0\u306b\u51fa\u308b\u306e\u3060\u3051\u3069\u3001\u3042\u3063\u305f\u65b9\u304c\u8abf\u67fb\u3068\u304b\u3057\u6613\u3044\u306e\u3067\u30ed\u30b0\u306b\u66f8\u304d\u51fa\u3057\u3066\u307f\u305f\u3002\n\nFuelPHP+Doctrine2\u306e\u69cb\u6210\u306f\nhttp://qiita.com/gyhino@github/items/188d207d26f608269b3a\n\u3092\u5f15\u304d\u7d9a\u304d\u4f7f\u3046\u3002\n\n## \u8981\u4ef6\n\n* \u30ed\u30b0\u306bSQL(DQL)\u304c\u51fa\u529b\u3055\u308c\u308b\n* \u30ed\u30b0\u306b\u30af\u30a8\u30ea\u306e\u5b9f\u884c\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u308b\n\n## Doctrine2\u3067SQL\u3092\u30ed\u30b0\u306b\u51fa\u3059\u305f\u3081\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\uff1f\n\nDoctrine2\u306b\u306f`SQLLogger`\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u305d\u308c\u3092\u4f7f\u3046\u3053\u3068\u3067\u7c21\u5358\u306bSQL\u3092\u51fa\u529b\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3002\n`SQLLogger`\u306fInterface\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u81ea\u5206\u3067\u597d\u304d\u306b\u5b9f\u88c5\u3059\u308b\u3002\nhttps://github.com/doctrine/dbal/blob/master/lib/Doctrine/DBAL/Logging/SQLLogger.php\n\n## FuelPHP\u306e\u30ed\u30b0\u306bSQL\u3092\u51fa\u3059\u305f\u3081\u306b\u6539\u4fee\u3092\u3059\u308b\n\n\u4eca\u56deDoctrine2\u3092\u6271\u3046\u306e\u306b\u5229\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3082`SQLLogger`\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://github.com/aspendigital/fuel-doctrine2/blob/master/classes/Fuel/Doctrine/Logger.php\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u5185\u3067`profiling`\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u3053\u308c\u3092\u4f7f\u3046\u69d8\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\u3057\u304b\u3057\u3001\u3053\u306e`SQLLogger`\u306e\u5b9f\u88c5\u306f\u30d7\u30ed\u30d5\u30a1\u30a4\u30e9\u306bSQL\u3068\u5b9f\u884c\u6642\u9593\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3060\u3051\u3067\u3001\u30ed\u30b0\u306b\u306f\u66f8\u304d\u51fa\u3055\u308c\u306a\u3044\u3002\n\n\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u62e1\u5f35\u3059\u308b\u5f62\u3067\u9032\u3081\u308b\u3002\n\n### Fuel\\Doctrine\\Logger\u306e\u62e1\u5f35\n\nSQL\u3068\u51e6\u7406\u6642\u9593\u3092\u30ed\u30b0\u306b\u51fa\u3059\u306b\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u62e1\u5f35\u3092\u3059\u308b\u3002\n\n```php:fuel/app/classes/doctrine/SQLLogger.php\n<?php\n\nnamespace Sample\\Doctrine;\n\nclass SQLLogger extends \\Fuel\\Doctrine\\Logger\n{\n\tprotected $startTime;\n\tprotected $lastSql;\n\n\tpublic function startQuery($sql, array $params = null, array $types = null)\n\t{\n\t\tparent::startQuery($sql, $params, $types);\n\n\t\t$this->startTime = microtime(true);\n\t\t$this->lastSql = $sql;\n\t}\n\n\tpublic function stopQuery()\n\t{\n\t\tparent::stopQuery();\n\t\t\n\t\t\\Log::info(json_encode(array(\n\t\t\t'sql' => $this->lastSql,\n\t\t\t'elapsedTime' => sprintf('%.10f', (microtime(true) - $this->startTime)), \n\t\t)));\n\t}\n}\n```\n\n### namespace\u3092Autoloader\u306b\u8a2d\u5b9a\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\n\u4eca\u5f8c\u306e\u3053\u3068\u3092\u8003\u3048\u3001PSR-0\u6e96\u62e0\u3067\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3059\u308b\u3002\n\n```php:fuel/app/bootstrap.php\n<?php\n\n//...\n\n// SQLLogger\u304c\u5c5e\u3059\u308b\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3092FuelPHP\u306eAutoloader\u306b\u8ffd\u52a0\nAutoloader::add_namespace('Sample\\Doctrine', APPPATH.'classes'.DIRECTORY_SEPARATOR.'doctrine'.DIRECTORY_SEPARATOR, true);\n\nAutoloader::add_classes(array(\n));\n\n// Register the autoloader\nAutoloader::register();\n\n//...\n\n```\n\n### \u62e1\u5f35\u3057\u305fSQLLogger\u3092Doctrine2\u306b\u6e21\u3059\u8a2d\u5b9a\u3092\u3059\u308b\n\n\u62e1\u5f35\u3057\u305f\u3068\u3053\u308d\u3067\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u4f7f\u308f\u308c\u306a\u3044\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n```php:fuel/app/config/db.php\n<?php\n\nreturn array(\n\t'doctrine2' => array(\n\t\t'proxy_dir' => APPPATH.'classes'.DIRECTORY_SEPARATOR.'proxy',\n\t\t'proxy_namespace' => 'Proxy',\n\t\t'metadata_path' => APPPATH.'classes'.DIRECTORY_SEPARATOR.'entity',\n\t\t'init_callback' => function($manager, $connection)\n\t\t{\n\t\t\t// Doctrine\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u6642\u306e\u4e00\u756a\u6700\u5f8c\u306b\u547c\u3070\u308c\u308b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\n\t\t\t$manager\n\t\t\t\t->getConnection()\n\t\t\t\t->getConfiguration()\n\t\t\t\t->setSQLLogger(new Sample\\Doctrine\\SQLLogger($connection));\n\t\t},\n\t),\n\t//...\n);\n```\n\n\u203b`profiling`\u304c\u7121\u52b9\u306e\u6642\u306f\u8003\u616e\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u304a\u305d\u3089\u304f\u6b63\u3057\u304f\u52d5\u304b\u306a\u3044\n\n## \u304a\u3057\u307e\u3044\n\n\u304a\u3057\u307e\u3044\u3002\n", "tags": ["PHP", "Doctrine2", "FuelPHP"]}