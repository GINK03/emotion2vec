{"context": "\n\n\u76ee\u7684\nNode-RED\u3068WatsonAPI\u3092\u4f7f\u3044\u305f\u3044\uff01\u3068\u3044\u3046\u308f\u3051\u3067\u3001Bluemix\u306eNode-RED\u3067Text to Speech\u30ce\u30fc\u30c9\u3092\u4f7f\u3044\u3001\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\uff08\u82f1\u8a9e\uff09\u3092\u8aad\u307f\u4e0a\u3052\u308b\u3068\u3044\u3046\u3082\u306e\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nAPI\u7d4c\u7531\u3067\u547c\u3073\u51fa\u3059\u65b9\u6cd5\u3067\u306f\u306a\u304f\u3001\u3042\u3048\u3066TTS\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u74b0\u5883\n\nBluemix\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067Text-to-Speech\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u8ffd\u52a0\u3057\u3001Node-RED\u30b5\u30fc\u30d0\u306b\u30d0\u30a4\u30f3\u30c9\u3057\u307e\u3059\u3002\n\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u306f\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3002\n\n\n\u753b\u9762\n\n\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u4e0a\u90e8\u306b\u30aa\u30fc\u30c7\u30a3\u30aa\u30bf\u30b0\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n<audio controls id=\"audio\"></audio>\n\u753b\u9762\u4e0b\u90e8\u306e\"What do you want to say?\"\u3068\u66f8\u3044\u3066\u3042\u308b\u30dc\u30c3\u30af\u30b9\u306b\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3001Send\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u3092TTS\u3067\u97f3\u58f0\u30c7\u30fc\u30bf\uff08wav\uff09\u306b\u5909\u63db\u3057\u3001\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u4e0a\u90e8\u306e\u30aa\u30fc\u30c7\u30a3\u30aa\u3067\u518d\u751f\u3059\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\u5b9f\u88c5\n\ntext to speech\u30ce\u30fc\u30c9\u306e\u547c\u3073\u51fa\u3057\u306fWebSocket\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nwebsocket\u306b\u306f\u3001\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u3092msg.payload\u306b\u8a2d\u5b9a\u3057\u3066\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n    var payload = {\n      message: message.value,\n      user: user.value,\n      ts: (new Date()).getTime(),\n      payload: message.value\n    };\n\ntext to speech\u3067\u5909\u63db\u3055\u308c\u305f\u97f3\u58f0\u30c7\u30fc\u30bf\u306f\u3001\u623b\u308a\u5024\u306epayload.speech.data\u306b\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf(wav)\u3068\u3057\u3066\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\"speech\": { \"type\":\"Buffer\", \"data\":[82, 73, ...]}\n\n\u3053\u306e\u307e\u307e\u3067\u306faudio.src\u306b\u8a2d\u5b9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001Blob\u306b\u5909\u63db\u3057\u3066createObjectURL(blob)\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nfunction playTTS(payload){\n    var wavString = payload.speech.data;\n    // console.log(wavString);\n    var len = wavString.length;\n    // console.log(len);\n    var buf = new ArrayBuffer(len);\n    // console.log(buf);\n    var view = new Uint8Array(buf);\n    for (var i = 0; i < len; i++) {\n      view[i] = wavString[i] & 0xff;\n    }\n    console.log(view);\n    var blob = new Blob([view], {type: \"audio/wav\"});\n    var URL = window.URL || window.webkitURL\n    var blobUrl = URL.createObjectURL(blob);\n    // console.log(blobUrl);\n    var audio = document.getElementById('audio');\n    audio.src = blobUrl;\n    audio.load();\n    audio.preload = 'auto';\n    audio.play();\n  }\n\n\u3053\u306e\u3042\u305f\u308a\u306e\u5b9f\u88c5\u65b9\u6cd5\u3092\u8abf\u3079\u3066\u3044\u305f\u3068\u3053\u308d\u3001view\u306b\u5024\u3092\u7a81\u3063\u8fbc\u3093\u3067\u3044\u308b\u3068\u3053\u308d\u3067\nwavString.charCodeAt(i) & 0xff\n\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306fwavString\u304cString\u3067\u306f\u306a\u304fArray\u3060\u3063\u305f\u305f\u3081\nwavString[i] & 0xff \u3068\u3057\u3066\u3044\u307e\u3059\u3002\ncharCodeAt(i) & 0xff\u3068\u3044\u3046\u306e\u3092\u306a\u305c\u3084\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u304b\u3068\u3044\u3046\u306e\u306f\u3001\u3053\u3061\u3089\u306e\u8aac\u660e\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3002\n\n\u307e\u3068\u3081\n\nTTS\u30ce\u30fc\u30c9\u304b\u3089\u306e\u623b\u308a\u5024\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092audio\u3067\u51fa\u529b\u3055\u305b\u308b\u65b9\u6cd5\u3092\u8abf\u3079\u308b\u306e\u306b\u624b\u9593\u53d6\u308a\u307e\u3057\u305f\u3002\nBluemix Node-RED\u306eTTS\u30ce\u30fc\u30c9\u306f\u65e5\u672c\u8a9e\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001API\u7d4c\u7531\u3067\u547c\u3073\u51fa\u3057\u305f\u307b\u3046\u304c\u3044\u308d\u3044\u308d\u4f7f\u3048\u305d\u3046\u3067\u3059\u306d\u3002Language Translation\u3067\u7ffb\u8a33\u3057\u305f\u6587\u3092\u518d\u751f\u3057\u3066\u307f\u308b\u306e\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nMacbook\u306eSafari\u3067\u306f\u518d\u751f\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002Chrome\u3067\u306f\u518d\u751f\u3067\u304d\u307e\u3057\u305f\u3002\u89e3\u6790\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u306d\u3002\n\n\n\u30b3\u30fc\u30c9\n[{\"id\":\"68a12744.975ed8\",\"type\":\"websocket-listener\",\"z\":\"52dbf05.fad241\",\"path\":\"/ws/english\",\"wholemsg\":\"true\"},{\"id\":\"804b9d82.96fcd\",\"type\":\"http in\",\"z\":\"800bc702.676838\",\"name\":\"\",\"url\":\"/speech\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":236,\"y\":349,\"wires\":[[\"2cbc3872.627ae\"]]},{\"id\":\"2cbc3872.627ae\",\"type\":\"template\",\"z\":\"800bc702.676838\",\"name\":\"html\",\"field\":\"\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"mustache\",\"template\":\"<head>\\n  <meta name=\\\"viewport\\\" content=\\\"width=320, initial-scale=1\\\">\\n  <title>speech!</title>\\n</head>\\n\\n<body>\\n  <div id=\\\"wrapper\\\">\\n    <div id=\\\"chat_box\\\" class=\\\"content\\\">\\n            <p><audio controls id=\\\"audio\\\"></audio></p>\\n    </div>\\n\\n    <div id=\\\"footer\\\">\\n      <div class=\\\"content\\\">\\n        <input type=\\\"text\\\" id=\\\"user\\\" placeholder=\\\"Who are you?\\\" />\\n        <input type=\\\"text\\\" id=\\\"message\\\" placeholder=\\\"What do you want to say?\\\" />\\n        <input type=\\\"button\\\" id=\\\"send_btn\\\" value=\\\"Send\\\" onclick=\\\"sendMessage()\\\">\\n      </div>\\n    </div>\\n  </div>\\n</body>\\n\\n<script type=\\\"text/javascript\\\">\\n  var wsUri = \\\"ws://{{req.headers.host}}/ws/english\\\";\\n  var ws = new WebSocket(wsUri);\\n\\n  function createSystemMessage(message) {\\n    var message = document.createTextNode(message);\\n\\n    var messageBox = document.createElement('p');\\n    messageBox.className = 'system';\\n\\n    messageBox.appendChild(message);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.appendChild(messageBox);\\n  }\\n\\n  function createUserMessage(user, message) {\\n    var user = document.createTextNode(user + ': ');\\n\\n    var userBox = document.createElement('span');\\n    userBox.className = 'username';\\n    userBox.appendChild(user);\\n\\n    var message = document.createTextNode(message);\\n\\n    var messageBox = document.createElement('p');\\n    messageBox.appendChild(userBox);\\n    messageBox.appendChild(message);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.appendChild(messageBox);\\n  }\\n\\n  function playTTS(payload){\\n    var wavString = payload.speech.data;\\n    // console.log(wavString);\\n    var len = wavString.length;\\n    // console.log(len);\\n    var buf = new ArrayBuffer(len);\\n    // console.log(buf);\\n    var view = new Uint8Array(buf);\\n    for (var i = 0; i < len; i++) {\\n      view[i] = wavString[i] & 0xff;\\n    }\\n    console.log(view);\\n    var blob = new Blob([view], {type: \\\"audio/wav\\\"});\\n    var URL = window.URL || window.webkitURL\\n    var blobUrl = URL.createObjectURL(blob);\\n    // console.log(blobUrl);\\n    var audio = document.getElementById('audio');\\n    audio.src = blobUrl;\\n    audio.load();\\n    audio.preload = 'auto';\\n    audio.play();\\n  }\\n\\n  ws.onopen = function(ev) {\\n    createSystemMessage('[Connected]');\\n  };\\n\\n  ws.onclose = function(ev) {\\n    createSystemMessage('[Disconnected]');\\n  }\\n\\n  ws.onmessage = function(ev) {\\n    var payload = JSON.parse(ev.data);\\n    createUserMessage(payload.user, payload.message);\\n    playTTS(payload);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.scrollTop = chat.scrollHeight;\\n  }\\n\\n  function sendMessage() {\\n    var user = document.getElementById('user');\\n    var message = document.getElementById('message');\\n\\n    var payload = {\\n      message: message.value,\\n      user: user.value,\\n      ts: (new Date()).getTime(),\\n      payload: message.value\\n    };\\n\\n    ws.send(JSON.stringify(payload));\\n    message.value = \\\"\\\";\\n  };\\n</script>\\n\\n<style type=\\\"text/css\\\">\\n  * {\\n    font-family: \\\"Palatino Linotype\\\", \\\"Book Antiqua\\\", Palatino, serif;\\n    font-style: italic;\\n    font-size: 24px;\\n  }\\n\\n  html, body, #wrapper {\\n    margin: 0;\\n    padding: 0;\\n    height: 100%;\\n  }\\n\\n  #wrapper {\\n    background-color: #ecf0f1;\\n  }\\n\\n  #chat_box {\\n    box-sizing: border-box;\\n    height: 100%;\\n    overflow: auto;\\n    padding-bottom: 50px;\\n  }\\n\\n  #footer {\\n    box-sizing: border-box;\\n    position: fixed;\\n    bottom: 0;\\n    height: 50px;\\n    width: 100%;\\n    background-color: #2980b9;\\n  }\\n\\n  #footer .content {\\n    padding-top: 4px;\\n    position: relative;\\n  }\\n\\n  #user { width: 20%; }\\n  #message { width: 68%; }\\n  #send_btn {\\n    width: 10%;\\n    position: absolute;\\n    right: 0;\\n    bottom: 0;\\n    margin: 0;\\n  }\\n\\n  .content {\\n    width: 70%;\\n    margin: 0 auto;\\n  }\\n\\n  input[type=\\\"text\\\"],\\n  input[type=\\\"button\\\"] {\\n    border: 0;\\n    color: #fff;\\n  }\\n\\n  input[type=\\\"text\\\"] {\\n    background-color: #146EA8;\\n    padding: 3px 10px;\\n  }\\n\\n  input[type=\\\"button\\\"] {\\n    background-color: #f39c12;\\n    border-right: 2px solid #e67e22;\\n    border-bottom: 2px solid #e67e22;\\n    min-width: 70px;\\n    display: inline-block;\\n  }\\n\\n  input[type=\\\"button\\\"]:hover {\\n    background-color: #e67e22;\\n    border-right: 2px solid #f39c12;\\n    border-bottom: 2px solid #f39c12;\\n    cursor: pointer;\\n  }\\n\\n  .system,\\n  .username {\\n    color: #aaa;\\n    font-style: italic;\\n    font-family: monospace;\\n    font-size: 16px;\\n  }\\n\\n  @media(max-width: 1000px) {\\n    .content { width: 90%; }\\n  }\\n\\n  @media(max-width: 780px) {\\n    #footer { height: 91px; }\\n    #chat_box { padding-bottom: 91px; }\\n\\n    #user { width: 100%; }\\n    #message { width: 80%; }\\n  }\\n\\n  @media(max-width: 400px) {\\n    #footer { height: 135px; }\\n    #chat_box { padding-bottom: 135px; }\\n\\n    #message { width: 100%; }\\n    #send_btn {\\n      position: relative;\\n      margin-top: 3px;\\n      width: 100%;\\n    }\\n  }\\n</style>\\n\",\"x\":425,\"y\":348,\"wires\":[[\"73d2e2e0.a0d35c\"]]},{\"id\":\"73d2e2e0.a0d35c\",\"type\":\"http response\",\"z\":\"800bc702.676838\",\"name\":\"\",\"x\":607,\"y\":348,\"wires\":[]},{\"id\":\"9852e538.cee01\",\"type\":\"websocket in\",\"z\":\"800bc702.676838\",\"name\":\"\",\"server\":\"68a12744.975ed8\",\"client\":\"\",\"x\":187,\"y\":257,\"wires\":[[\"600df703.08308\"]]},{\"id\":\"600df703.08308\",\"type\":\"function\",\"z\":\"800bc702.676838\",\"name\":\"\",\"func\":\"delete msg._session;\\n//msg.payload = msg.message;\\nreturn msg;\\n\\n\",\"outputs\":1,\"noerr\":0,\"x\":351,\"y\":257,\"wires\":[[\"b8226832.18236\"]]},{\"id\":\"8a76e158.d0166\",\"type\":\"websocket out\",\"z\":\"800bc702.676838\",\"name\":\"\",\"server\":\"68a12744.975ed8\",\"client\":\"\",\"x\":737,\"y\":258,\"wires\":[]},{\"id\":\"b8226832.18236\",\"type\":\"watson-text-to-speech\",\"z\":\"800bc702.676838\",\"name\":\"\",\"lang\":\"english\",\"voice\":\"en-US_MichaelVoice\",\"format\":\"audio/wav\",\"x\":532,\"y\":258,\"wires\":[[\"8a76e158.d0166\",\"b7ce263.5b52858\"]]},{\"id\":\"b7ce263.5b52858\",\"type\":\"debug\",\"z\":\"800bc702.676838\",\"name\":\"\",\"active\":false,\"console\":\"false\",\"complete\":\"true\",\"x\":731,\"y\":204,\"wires\":[]}]\n\n\n\n\n# \u76ee\u7684\nNode-RED\u3068WatsonAPI\u3092\u4f7f\u3044\u305f\u3044\uff01\u3068\u3044\u3046\u308f\u3051\u3067\u3001Bluemix\u306eNode-RED\u3067Text to Speech\u30ce\u30fc\u30c9\u3092\u4f7f\u3044\u3001\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\uff08\u82f1\u8a9e\uff09\u3092\u8aad\u307f\u4e0a\u3052\u308b\u3068\u3044\u3046\u3082\u306e\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nAPI\u7d4c\u7531\u3067\u547c\u3073\u51fa\u3059\u65b9\u6cd5\u3067\u306f\u306a\u304f\u3001\u3042\u3048\u3066TTS\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n# \u74b0\u5883\n* Bluemix\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067Text-to-Speech\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u8ffd\u52a0\u3057\u3001Node-RED\u30b5\u30fc\u30d0\u306b\u30d0\u30a4\u30f3\u30c9\u3057\u307e\u3059\u3002\n* \u30d9\u30fc\u30b9\u3068\u306a\u308b\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u306f[\u3053\u3061\u3089](https://www.ibm.com/developerworks/jp/cloud/library/cl-rtchat-app/)\u3092\u53c2\u8003\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3002\n\n# \u753b\u9762\n![\u30c1\u30e3\u30c3\u30c8\u753b\u9762](https://qiita-image-store.s3.amazonaws.com/0/113316/b0fadfc3-abab-0ecc-e388-d4d1b6bf1136.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-03-24 22.16.09.png\")\n\n\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u4e0a\u90e8\u306b\u30aa\u30fc\u30c7\u30a3\u30aa\u30bf\u30b0\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n`<audio controls id=\"audio\"></audio>`\n\n\u753b\u9762\u4e0b\u90e8\u306e\"What do you want to say?\"\u3068\u66f8\u3044\u3066\u3042\u308b\u30dc\u30c3\u30af\u30b9\u306b\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3001Send\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u3092TTS\u3067\u97f3\u58f0\u30c7\u30fc\u30bf\uff08wav\uff09\u306b\u5909\u63db\u3057\u3001\u30c1\u30e3\u30c3\u30c8\u753b\u9762\u4e0a\u90e8\u306e\u30aa\u30fc\u30c7\u30a3\u30aa\u3067\u518d\u751f\u3059\u308b\u3088\u3046\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n# \u5b9f\u88c5\n![Kobito.DnxvJB.png](https://qiita-image-store.s3.amazonaws.com/0/113316/2ee9c355-d9e2-c13c-625e-fea94f5ed893.png \"Kobito.DnxvJB.png\")\n\ntext to speech\u30ce\u30fc\u30c9\u306e\u547c\u3073\u51fa\u3057\u306fWebSocket\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nwebsocket\u306b\u306f\u3001\u5165\u529b\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u3092msg.payload\u306b\u8a2d\u5b9a\u3057\u3066\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n    var payload = {\n      message: message.value,\n      user: user.value,\n      ts: (new Date()).getTime(),\n      payload: message.value\n    };\n```\n\n\ntext to speech\u3067\u5909\u63db\u3055\u308c\u305f\u97f3\u58f0\u30c7\u30fc\u30bf\u306f\u3001\u623b\u308a\u5024\u306epayload.speech.data\u306b\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf(wav)\u3068\u3057\u3066\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\n\"speech\": { \"type\":\"Buffer\", \"data\":[82, 73, ...]}\n```\n\n\u3053\u306e\u307e\u307e\u3067\u306faudio.src\u306b\u8a2d\u5b9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001Blob\u306b\u5909\u63db\u3057\u3066createObjectURL(blob)\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\nfunction playTTS(payload){\n    var wavString = payload.speech.data;\n    // console.log(wavString);\n    var len = wavString.length;\n    // console.log(len);\n    var buf = new ArrayBuffer(len);\n    // console.log(buf);\n    var view = new Uint8Array(buf);\n    for (var i = 0; i < len; i++) {\n      view[i] = wavString[i] & 0xff;\n    }\n    console.log(view);\n    var blob = new Blob([view], {type: \"audio/wav\"});\n    var URL = window.URL || window.webkitURL\n    var blobUrl = URL.createObjectURL(blob);\n    // console.log(blobUrl);\n    var audio = document.getElementById('audio');\n    audio.src = blobUrl;\n    audio.load();\n    audio.preload = 'auto';\n    audio.play();\n  }\n```\n\n\u3053\u306e\u3042\u305f\u308a\u306e\u5b9f\u88c5\u65b9\u6cd5\u3092\u8abf\u3079\u3066\u3044\u305f\u3068\u3053\u308d\u3001view\u306b\u5024\u3092\u7a81\u3063\u8fbc\u3093\u3067\u3044\u308b\u3068\u3053\u308d\u3067\nwavString.charCodeAt(i) & 0xff\n\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306fwavString\u304cString\u3067\u306f\u306a\u304fArray\u3060\u3063\u305f\u305f\u3081\nwavString[i] & 0xff \u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\ncharCodeAt(i) & 0xff\u3068\u3044\u3046\u306e\u3092\u306a\u305c\u3084\u3089\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u304b\u3068\u3044\u3046\u306e\u306f\u3001[\u3053\u3061\u3089](https://javascript.g.hatena.ne.jp/edvakf/20100607/1275931930)\u306e\u8aac\u660e\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3002\n\n# \u307e\u3068\u3081\n* TTS\u30ce\u30fc\u30c9\u304b\u3089\u306e\u623b\u308a\u5024\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092audio\u3067\u51fa\u529b\u3055\u305b\u308b\u65b9\u6cd5\u3092\u8abf\u3079\u308b\u306e\u306b\u624b\u9593\u53d6\u308a\u307e\u3057\u305f\u3002\n* Bluemix Node-RED\u306eTTS\u30ce\u30fc\u30c9\u306f\u65e5\u672c\u8a9e\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001API\u7d4c\u7531\u3067\u547c\u3073\u51fa\u3057\u305f\u307b\u3046\u304c\u3044\u308d\u3044\u308d\u4f7f\u3048\u305d\u3046\u3067\u3059\u306d\u3002Language Translation\u3067\u7ffb\u8a33\u3057\u305f\u6587\u3092\u518d\u751f\u3057\u3066\u307f\u308b\u306e\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n* Macbook\u306eSafari\u3067\u306f\u518d\u751f\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002Chrome\u3067\u306f\u518d\u751f\u3067\u304d\u307e\u3057\u305f\u3002\u89e3\u6790\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u306d\u3002\n\n\n# \u30b3\u30fc\u30c9\n```\n[{\"id\":\"68a12744.975ed8\",\"type\":\"websocket-listener\",\"z\":\"52dbf05.fad241\",\"path\":\"/ws/english\",\"wholemsg\":\"true\"},{\"id\":\"804b9d82.96fcd\",\"type\":\"http in\",\"z\":\"800bc702.676838\",\"name\":\"\",\"url\":\"/speech\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":236,\"y\":349,\"wires\":[[\"2cbc3872.627ae\"]]},{\"id\":\"2cbc3872.627ae\",\"type\":\"template\",\"z\":\"800bc702.676838\",\"name\":\"html\",\"field\":\"\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"mustache\",\"template\":\"<head>\\n  <meta name=\\\"viewport\\\" content=\\\"width=320, initial-scale=1\\\">\\n  <title>speech!</title>\\n</head>\\n\\n<body>\\n  <div id=\\\"wrapper\\\">\\n    <div id=\\\"chat_box\\\" class=\\\"content\\\">\\n            <p><audio controls id=\\\"audio\\\"></audio></p>\\n    </div>\\n\\n    <div id=\\\"footer\\\">\\n      <div class=\\\"content\\\">\\n        <input type=\\\"text\\\" id=\\\"user\\\" placeholder=\\\"Who are you?\\\" />\\n        <input type=\\\"text\\\" id=\\\"message\\\" placeholder=\\\"What do you want to say?\\\" />\\n        <input type=\\\"button\\\" id=\\\"send_btn\\\" value=\\\"Send\\\" onclick=\\\"sendMessage()\\\">\\n      </div>\\n    </div>\\n  </div>\\n</body>\\n\\n<script type=\\\"text/javascript\\\">\\n  var wsUri = \\\"ws://{{req.headers.host}}/ws/english\\\";\\n  var ws = new WebSocket(wsUri);\\n\\n  function createSystemMessage(message) {\\n    var message = document.createTextNode(message);\\n\\n    var messageBox = document.createElement('p');\\n    messageBox.className = 'system';\\n\\n    messageBox.appendChild(message);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.appendChild(messageBox);\\n  }\\n\\n  function createUserMessage(user, message) {\\n    var user = document.createTextNode(user + ': ');\\n\\n    var userBox = document.createElement('span');\\n    userBox.className = 'username';\\n    userBox.appendChild(user);\\n\\n    var message = document.createTextNode(message);\\n\\n    var messageBox = document.createElement('p');\\n    messageBox.appendChild(userBox);\\n    messageBox.appendChild(message);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.appendChild(messageBox);\\n  }\\n\\n  function playTTS(payload){\\n    var wavString = payload.speech.data;\\n    // console.log(wavString);\\n    var len = wavString.length;\\n    // console.log(len);\\n    var buf = new ArrayBuffer(len);\\n    // console.log(buf);\\n    var view = new Uint8Array(buf);\\n    for (var i = 0; i < len; i++) {\\n      view[i] = wavString[i] & 0xff;\\n    }\\n    console.log(view);\\n    var blob = new Blob([view], {type: \\\"audio/wav\\\"});\\n    var URL = window.URL || window.webkitURL\\n    var blobUrl = URL.createObjectURL(blob);\\n    // console.log(blobUrl);\\n    var audio = document.getElementById('audio');\\n    audio.src = blobUrl;\\n    audio.load();\\n    audio.preload = 'auto';\\n    audio.play();\\n  }\\n\\n  ws.onopen = function(ev) {\\n    createSystemMessage('[Connected]');\\n  };\\n\\n  ws.onclose = function(ev) {\\n    createSystemMessage('[Disconnected]');\\n  }\\n\\n  ws.onmessage = function(ev) {\\n    var payload = JSON.parse(ev.data);\\n    createUserMessage(payload.user, payload.message);\\n    playTTS(payload);\\n\\n    var chat = document.getElementById('chat_box');\\n    chat.scrollTop = chat.scrollHeight;\\n  }\\n\\n  function sendMessage() {\\n    var user = document.getElementById('user');\\n    var message = document.getElementById('message');\\n\\n    var payload = {\\n      message: message.value,\\n      user: user.value,\\n      ts: (new Date()).getTime(),\\n      payload: message.value\\n    };\\n\\n    ws.send(JSON.stringify(payload));\\n    message.value = \\\"\\\";\\n  };\\n</script>\\n\\n<style type=\\\"text/css\\\">\\n  * {\\n    font-family: \\\"Palatino Linotype\\\", \\\"Book Antiqua\\\", Palatino, serif;\\n    font-style: italic;\\n    font-size: 24px;\\n  }\\n\\n  html, body, #wrapper {\\n    margin: 0;\\n    padding: 0;\\n    height: 100%;\\n  }\\n\\n  #wrapper {\\n    background-color: #ecf0f1;\\n  }\\n\\n  #chat_box {\\n    box-sizing: border-box;\\n    height: 100%;\\n    overflow: auto;\\n    padding-bottom: 50px;\\n  }\\n\\n  #footer {\\n    box-sizing: border-box;\\n    position: fixed;\\n    bottom: 0;\\n    height: 50px;\\n    width: 100%;\\n    background-color: #2980b9;\\n  }\\n\\n  #footer .content {\\n    padding-top: 4px;\\n    position: relative;\\n  }\\n\\n  #user { width: 20%; }\\n  #message { width: 68%; }\\n  #send_btn {\\n    width: 10%;\\n    position: absolute;\\n    right: 0;\\n    bottom: 0;\\n    margin: 0;\\n  }\\n\\n  .content {\\n    width: 70%;\\n    margin: 0 auto;\\n  }\\n\\n  input[type=\\\"text\\\"],\\n  input[type=\\\"button\\\"] {\\n    border: 0;\\n    color: #fff;\\n  }\\n\\n  input[type=\\\"text\\\"] {\\n    background-color: #146EA8;\\n    padding: 3px 10px;\\n  }\\n\\n  input[type=\\\"button\\\"] {\\n    background-color: #f39c12;\\n    border-right: 2px solid #e67e22;\\n    border-bottom: 2px solid #e67e22;\\n    min-width: 70px;\\n    display: inline-block;\\n  }\\n\\n  input[type=\\\"button\\\"]:hover {\\n    background-color: #e67e22;\\n    border-right: 2px solid #f39c12;\\n    border-bottom: 2px solid #f39c12;\\n    cursor: pointer;\\n  }\\n\\n  .system,\\n  .username {\\n    color: #aaa;\\n    font-style: italic;\\n    font-family: monospace;\\n    font-size: 16px;\\n  }\\n\\n  @media(max-width: 1000px) {\\n    .content { width: 90%; }\\n  }\\n\\n  @media(max-width: 780px) {\\n    #footer { height: 91px; }\\n    #chat_box { padding-bottom: 91px; }\\n\\n    #user { width: 100%; }\\n    #message { width: 80%; }\\n  }\\n\\n  @media(max-width: 400px) {\\n    #footer { height: 135px; }\\n    #chat_box { padding-bottom: 135px; }\\n\\n    #message { width: 100%; }\\n    #send_btn {\\n      position: relative;\\n      margin-top: 3px;\\n      width: 100%;\\n    }\\n  }\\n</style>\\n\",\"x\":425,\"y\":348,\"wires\":[[\"73d2e2e0.a0d35c\"]]},{\"id\":\"73d2e2e0.a0d35c\",\"type\":\"http response\",\"z\":\"800bc702.676838\",\"name\":\"\",\"x\":607,\"y\":348,\"wires\":[]},{\"id\":\"9852e538.cee01\",\"type\":\"websocket in\",\"z\":\"800bc702.676838\",\"name\":\"\",\"server\":\"68a12744.975ed8\",\"client\":\"\",\"x\":187,\"y\":257,\"wires\":[[\"600df703.08308\"]]},{\"id\":\"600df703.08308\",\"type\":\"function\",\"z\":\"800bc702.676838\",\"name\":\"\",\"func\":\"delete msg._session;\\n//msg.payload = msg.message;\\nreturn msg;\\n\\n\",\"outputs\":1,\"noerr\":0,\"x\":351,\"y\":257,\"wires\":[[\"b8226832.18236\"]]},{\"id\":\"8a76e158.d0166\",\"type\":\"websocket out\",\"z\":\"800bc702.676838\",\"name\":\"\",\"server\":\"68a12744.975ed8\",\"client\":\"\",\"x\":737,\"y\":258,\"wires\":[]},{\"id\":\"b8226832.18236\",\"type\":\"watson-text-to-speech\",\"z\":\"800bc702.676838\",\"name\":\"\",\"lang\":\"english\",\"voice\":\"en-US_MichaelVoice\",\"format\":\"audio/wav\",\"x\":532,\"y\":258,\"wires\":[[\"8a76e158.d0166\",\"b7ce263.5b52858\"]]},{\"id\":\"b7ce263.5b52858\",\"type\":\"debug\",\"z\":\"800bc702.676838\",\"name\":\"\",\"active\":false,\"console\":\"false\",\"complete\":\"true\",\"x\":731,\"y\":204,\"wires\":[]}]\n```\n", "tags": ["node-red", "Bluemix", "Watson"]}