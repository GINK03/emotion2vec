{"context": "SQL Server \u306e Express \u30a8\u30c7\u30a3\u30b7\u30e7\u30f3\u3067\u306f\u30c8\u30ec\u30fc\u30b9\u7528\u306e\u30c4\u30fc\u30eb\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\u3067\u3082\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u767a\u884c\u3057\u3066\u3044\u308bSQL\u3092\u8abf\u3079\u305f\u3044\u3068\u304b\u3001\u306a\u3093\u3060\u304bLock\u3057\u3066\u3044\u308b\u3063\u307d\u3044\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3051\u3069\u3002\u3002\u306a\u3093\u3066\u6642\u306b\u3069\u3046\u3057\u3066\u3082\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u8abf\u3079\u305f\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u3002\u3088\u306d\nT-SQL\u3060\u3051\u3067 SQL Trace \u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u307e\u3067\u3061\u3083\u3093\u3068\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u624b\u9806\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u8a71\u3092\u5206\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u7279\u5b9a\u306e\u30e6\u30fc\u30b6\u304c\u767a\u884c\u3057\u305fSQL\u306e\u307f\u3092\u5bfe\u8c61\u306b\u53d6\u5f97\u3059\u308b\u624b\u9806\u306b\u3057\u3068\u304d\u307e\u3059\n\n\u30c8\u30ec\u30fc\u30b9\u8a2d\u5b9a\n\u201dTEST_USER\u201d\u3068\u3044\u3046\u540d\u524d\u306e\u30e6\u30fc\u30b6\u306e\u307f\u3092\u5bfe\u8c61\n\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f C:\\TEMP\\trc.trc \u3068\u3057\u3066\u4fdd\u5b58\u3057\u307e\u3059\nUSE [master]\nGO\n\nDECLARE @rc int\nDECLARE @TraceID int\nDECLARE @maxfilesize bigint\nDECLARE @file nvarchar(4000)\nset @maxfilesize = 100\nset @file = N'C:\\TEMP\\trc'\n\nEXEC @rc = sp_trace_create @TraceID output, 0, @file, @maxfilesize, NULL\nif (@rc != 0) goto error\n\nDECLARE @on bit\nset @on = 1\n\n--\u30c8\u30ec\u30fc\u30b9\u5bfe\u8c61\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\n--RPC:Completed \u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9 \u30a4\u30d9\u30f3\u30c8\u306e\u7a2e\u985e = 10\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,   1, @on  -- TextData -- \u30ea\u30e2\u30fc\u30c8 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3 \u30b3\u30fc\u30eb\u306e\u30c6\u30ad\u30b9\u30c8\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  13, @on  -- Duration -- \u30a4\u30d9\u30f3\u30c8\u306b\u304b\u304b\u3063\u305f\u6642\u9593 (\u30de\u30a4\u30af\u30ed\u79d2)\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  14, @on  -- StartTime -- \u30a4\u30d9\u30f3\u30c8\u306e\u958b\u59cb\u6642\u523b (\u53d6\u5f97\u3067\u304d\u305f\u5834\u5408)\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  15, @on  -- EndTime -- \u30ea\u30e2\u30fc\u30c8 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3 \u30b3\u30fc\u30eb\u306e\u7d42\u4e86\u6642\u523b\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  31, @on  -- Error -- \u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u756a\u53f7\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  34, @on  -- ObjectName -- \u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u540d\u524d\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  51, @on  -- EventSequence -- \u8981\u6c42\u5185\u306e\u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  66, @on  -- GroupID -- SQL \u30c8\u30ec\u30fc\u30b9 \u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u305f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9 \u30b0\u30eb\u30fc\u30d7\u306e ID\u3002\n\n--SQL:BatchCompleted \u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9\u306e\u30c7\u30fc\u30bf\u5217  \u30a4\u30d9\u30f3\u30c8\u306e\u7a2e\u985e = 12\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,   1, @on  -- TextData -- \u30d0\u30c3\u30c1\u306e\u30c6\u30ad\u30b9\u30c8\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  13, @on  -- Duration -- \u30a4\u30d9\u30f3\u30c8\u306b\u304b\u304b\u3063\u305f\u6642\u9593 (\u30de\u30a4\u30af\u30ed\u79d2)\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  14, @on  -- StartTime -- \u30a4\u30d9\u30f3\u30c8\u306e\u958b\u59cb\u6642\u523b (\u53d6\u5f97\u3067\u304d\u305f\u5834\u5408)\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  15, @on  -- EndTime -- \u30a4\u30d9\u30f3\u30c8\u304c\u7d42\u4e86\u3057\u305f\u6642\u523b\u3002SQL:BatchStarting \u3084 SP:Starting \u306a\u3069\u306e\u958b\u59cb\u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u306e\u5217\u306b\u5024\u304c\u683c\u7d0d\u3055\u308c\u307e\u305b\u3093\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  31, @on  -- Error -- \u30a4\u30d9\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u756a\u53f7\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  51, @on  -- EventSequence -- \u8981\u6c42\u5185\u306e\u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  66, @on  -- GroupID -- SQL \u30c8\u30ec\u30fc\u30b9 \u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u305f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9 \u30b0\u30eb\u30fc\u30d7\u306e ID\u3002\n\n--\u30d5\u30a3\u30eb\u30bf\n--  sp_trace_setfilter \n--       [ @traceid = ] \n--     , [ @columnid = ] \n--     , [ @logical_operator = ] 0:AND  1:OR\n--     , [ @comparison_operator = ] 0:=  1:<>  2:>  3:<  4:>=  5:<=  6:LIKE  7:NOT LIKE\n--     , [ @value = ] value\n--\n-- \u30e6\u30fc\u30b6\u306e\u9650\u5b9a : LoginName ::  0(AND) 11(LoginName) 0(=) N'TEST_USER'\nEXEC sp_trace_setfilter @TraceID, 11, 0, 0, N'TEST_USER'\n\n-- \u30e6\u30fc\u30b6\u64cd\u4f5c\u306e\u307f\u306e\u6307\u5b9a \uff1a IsSystem  :: 0(AND) 60(IsSystem) 0(=) 0\nEXEC sp_trace_setfilter @TraceID, 60, 0, 0, 0\n\n-- \u4e0d\u8981\u5206\u306e\u524a\u9664 \uff1a Text  :: 0(AND)  1(Text) 7(Not Like) N'SET %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'SET %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%EXEC sp_MShelpcolumns %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%exec sp_unprepare%'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%exec sp_executesql%'\n\n-- \u30c8\u30ec\u30fc\u30b9\u958b\u59cb\nEXEC sp_trace_setstatus @TraceID, 1\n\nselect TraceID=@TraceID\ngoto finish\n\nerror: \nselect ErrorCode=@rc\n\nfinish:\ngo\n\n\n\n\nTraceID\n\n\n\n\n2\n\n\n\n\u3046\u307e\u304f\u5b9f\u884c\u3067\u304d\u305f\u3089\u30c8\u30ec\u30fc\u30b9ID\u304c\u8868\u793a\u3055\u308c\u307e\u3059\n\u3053\u3053\u3067\u306f\u3001ID\u306f\uff12\u756a\u304c\u63a1\u756a\u3055\u308c\u305f\u3088\u3046\u3067\u3059\n\n\u30c8\u30ec\u30fc\u30b9\u72b6\u6cc1\u306e\u78ba\u8a8d\nSELECT *  \n  FROM ::fn_trace_getinfo(default)  \n\n\n\n\ntraceid\nproperty\nvalue\n\n\n\n\n1\n1\n2\n\n\n1\n2\nc:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\Log\\log_48.trc\n\n\n1\n3\n20\n\n\n1\n4\nNULL\n\n\n1\n5\n1\n\n\n2\n1\n0\n\n\n2\n2\nC:\\TEMP\\trc.trc\n\n\n2\n3\n100\n\n\n2\n4\nNULL\n\n\n2\n5\n1\n\n\n\n\u30c8\u30ec\u30fc\u30b9ID \uff11 \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u52d5\u3044\u3066\u3044\u305f\u3088\u3046\u3067\u3059\n\u30c8\u30ec\u30fc\u30b9ID \uff12 \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\uff15 \u304c \u201d\uff11\u201d\u306a\u306e\u3067\u3001\u5b9f\u884c\u4e2d\u3067\u3059\nhttps://msdn.microsoft.com/ja-jp/library/ms173875.aspx\n\n\u30e6\u30fc\u30b6\u4f5c\u696d\n\u304d\u3061\u3093\u3068\u30c8\u30ec\u30fc\u30b9\u53d6\u308c\u3066\u3044\u308b\u304b\u3001SQL\u3092\u767a\u884c\u3057\u3066\u307f\u307e\u3059\n\n\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\nUSE [TEST_DB]\nGO\nCREATE TABLE TEST_TBL\n(\n  ID   INT       NOT NULL  IDENTITY(1, 1),\n  TXT  NCHAR(10)     NULL\n) ON [PRIMARY]\n\n\n\u30c7\u30fc\u30bf\u6295\u5165\uff08INSERT)\nINSERT INTO TEST_TBL (TXT) VALUES (N'TEST1')\n\n\n\u8868\u793a\uff08SELECT)\nSELECT *  FROM TEST_TBL\n\n\n\u30c8\u30ec\u30fc\u30b9\u8868\u793a\n\u3068\u308a\u3042\u3048\u305a\u3001\u6700\u4f4e\u9650\u3060\u3051SELECT\u3057\u307e\u3059\n\u4ed6\u306b\u3082\u3044\u308d\u3093\u306a\u60c5\u5831\u3042\u308b\u306e\u3067\u3001SELECT \uff0a \u3067\u898b\u3066\u307f\u308b\u3068\u3088\u3044\u304b\u3082\nSELECT SPID, EventClass, StartTime, EndTime, Duration, TextData\n  FROM ::fn_trace_gettable ( N'C:\\TEMP\\trc.trc' , 0 )  \n\n\n\n\nSPID\nEventClass\nStartTime\nEndTime\nDuration\nTextData\n\n\n\n\nNULL\n65528\nNULL\nNULL\nNULL\nNULL\n\n\nNULL\n65534\n2016-12-13 11:13:18.690\nNULL\nNULL\nNULL\n\n\n60\n12\n2016-12-13 11:13:26.497\n2016-12-13 11:13:26.497\n244\nUSE [TEST_DB]\n\n\n60\n12\n2016-12-13 11:13:26.497\n2016-12-13 11:13:26.503\n8345\nCREATE TABLE TEST_TBL  (    ID   INT       NOT NULL  IDENTITY(1, 1),    TXT  NCHAR(10)     NULL  ) ON [PRIMARY]\n\n\n60\n12\n2016-12-13 11:13:29.970\n2016-12-13 11:13:29.973\n2792\nINSERT INTO TEST_TBL (TXT) VALUES (N'TEST1')\n\n\n60\n12\n2016-12-13 11:13:32.583\n2016-12-13 11:13:32.583\n769\nSELECT *    FROM TEST_TBL\n\n\n\n\u767a\u884c\u3057\u305fSQL\u304c\u304d\u3061\u3093\u3068\u53d6\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30c8\u30ec\u30fc\u30b9\u306f\u30b7\u30b9\u30c6\u30e0\u306b\u4ed8\u52a0\u3092\u304b\u3051\u7d9a\u3051\u308b\u305f\u3081\u3001\u5fc5\u8981\u304c\u306a\u304f\u306a\u3063\u305f\u3089\u3061\u3083\u3093\u3068\u505c\u6b62\u3057\u3066\u524a\u9664\u3057\u3066\u304a\u304f\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\n\u30c8\u30ec\u30fc\u30b9\u505c\u6b62\uff06\u524a\u9664\n\u5b9f\u884c\u306b\u306f\u30c8\u30ec\u30fc\u30b9ID\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u767a\u884c\u6642\u306e\u3084\u3064\u3092\u899a\u3048\u3066\u304a\u304f\u304b\u3001\u78ba\u8a8d\u3057\u3066\u304b\u3089\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n---\u505c\u6b62\nEXEC sp_trace_setstatus 2, 0   -- 2 \u304c\u30c8\u30ec\u30fc\u30b9ID\u3000\u3001\u30000 \u306f\u505c\u6b62\u547d\u4ee4\n\n---\u524a\u9664\nEXEC sp_trace_setstatus 2, 2   -- \u6700\u521d\u306e 2 \u304c\u30c8\u30ec\u30fc\u30b9ID\u3000\u3001\u30002 \u306f\u524a\u9664\u547d\u4ee4\n\n\u4eca\u56de\u306f\u30a4\u30d9\u30f3\u30c8ID\uff11\uff10(RPC:Completed)\u3068\uff11\uff12(SQL:BatchCompleted)\u3092\u53d6\u308a\u307e\u3057\u305f\u304c\u3001\u30c8\u30ec\u30fc\u30b9\u3057\u305f\u3044\u30a4\u30d9\u30f3\u30c8\uff08\u30ed\u30c3\u30af\u30a4\u30d9\u30f3\u30c8\u306a\u3069\u306a\u3069\uff09\u306b\u3064\u3044\u3066\u306fMicrosoft\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u7167\n\u5fc5\u8981\u306a\u3084\u3064\u3092\u898b\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3067\u3059\u3002\nhttps://msdn.microsoft.com/ja-jp/library/ms175481(v=sql.105).aspx\n\u307e\u305f\u3001\u30c8\u30ec\u30fc\u30b9\u3067\u4e0d\u8981\u306a\u30c7\u30fc\u30bf\u304c\u3044\u3063\u3071\u3044\u51fa\u3066\u304d\u3061\u3083\u3063\u305f\u308a\u3059\u308b\u3068\u898b\u308b\u306e\u3082\u3046\u3093\u3056\u308a\u3057\u3061\u3083\u3046\u306e\u3067\u3001\u3046\u307e\u304f\u30d5\u30a3\u30eb\u30bf\u3092\u8a2d\u5b9a\u3057\u3066\uff08sp_trace_setfilter\uff09\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u63a2\u3057\u3084\u3059\u304f\u3057\u3068\u304f\u306e\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nSQL Server \u306e Express \u30a8\u30c7\u30a3\u30b7\u30e7\u30f3\u3067\u306f\u30c8\u30ec\u30fc\u30b9\u7528\u306e\u30c4\u30fc\u30eb\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\u3067\u3082\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u767a\u884c\u3057\u3066\u3044\u308bSQL\u3092\u8abf\u3079\u305f\u3044\u3068\u304b\u3001\u306a\u3093\u3060\u304bLock\u3057\u3066\u3044\u308b\u3063\u307d\u3044\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3051\u3069\u3002\u3002\u306a\u3093\u3066\u6642\u306b\u3069\u3046\u3057\u3066\u3082\u30c8\u30ec\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u8abf\u3079\u305f\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u3002\u3088\u306d\n\nT-SQL\u3060\u3051\u3067 SQL Trace \u3057\u3066\u4fdd\u5b58\u3057\u305f\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u307e\u3067\u3061\u3083\u3093\u3068\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306e\u624b\u9806\u3067\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u8a71\u3092\u5206\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u7279\u5b9a\u306e\u30e6\u30fc\u30b6\u304c\u767a\u884c\u3057\u305fSQL\u306e\u307f\u3092\u5bfe\u8c61\u306b\u53d6\u5f97\u3059\u308b\u624b\u9806\u306b\u3057\u3068\u304d\u307e\u3059\n\n#\u30c8\u30ec\u30fc\u30b9\u8a2d\u5b9a\n\n\u201dTEST_USER\u201d\u3068\u3044\u3046\u540d\u524d\u306e\u30e6\u30fc\u30b6\u306e\u307f\u3092\u5bfe\u8c61\n\u30c8\u30ec\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u306f C:\\TEMP\\trc.trc \u3068\u3057\u3066\u4fdd\u5b58\u3057\u307e\u3059\n\n```SQL:\nUSE [master]\nGO\n\nDECLARE @rc int\nDECLARE @TraceID int\nDECLARE @maxfilesize bigint\nDECLARE @file nvarchar(4000)\nset @maxfilesize = 100\nset @file = N'C:\\TEMP\\trc'\n\nEXEC @rc = sp_trace_create @TraceID output, 0, @file, @maxfilesize, NULL\nif (@rc != 0) goto error\n\nDECLARE @on bit\nset @on = 1\n\n--\u30c8\u30ec\u30fc\u30b9\u5bfe\u8c61\u30a4\u30d9\u30f3\u30c8\u3092\u8a2d\u5b9a\n--RPC:Completed \u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9 \u30a4\u30d9\u30f3\u30c8\u306e\u7a2e\u985e = 10\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,   1, @on  -- TextData -- \u30ea\u30e2\u30fc\u30c8 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3 \u30b3\u30fc\u30eb\u306e\u30c6\u30ad\u30b9\u30c8\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  13, @on  -- Duration -- \u30a4\u30d9\u30f3\u30c8\u306b\u304b\u304b\u3063\u305f\u6642\u9593 (\u30de\u30a4\u30af\u30ed\u79d2)\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  14, @on  -- StartTime -- \u30a4\u30d9\u30f3\u30c8\u306e\u958b\u59cb\u6642\u523b (\u53d6\u5f97\u3067\u304d\u305f\u5834\u5408)\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  15, @on  -- EndTime -- \u30ea\u30e2\u30fc\u30c8 \u30d7\u30ed\u30b7\u30fc\u30b8\u30e3 \u30b3\u30fc\u30eb\u306e\u7d42\u4e86\u6642\u523b\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  31, @on  -- Error -- \u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u756a\u53f7\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  34, @on  -- ObjectName -- \u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u540d\u524d\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  51, @on  -- EventSequence -- \u8981\u6c42\u5185\u306e\u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3002\nEXEC  sp_trace_setevent  @TraceID,  10,  66, @on  -- GroupID -- SQL \u30c8\u30ec\u30fc\u30b9 \u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u305f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9 \u30b0\u30eb\u30fc\u30d7\u306e ID\u3002\n\n--SQL:BatchCompleted \u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9\u306e\u30c7\u30fc\u30bf\u5217  \u30a4\u30d9\u30f3\u30c8\u306e\u7a2e\u985e = 12\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,   1, @on  -- TextData -- \u30d0\u30c3\u30c1\u306e\u30c6\u30ad\u30b9\u30c8\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  13, @on  -- Duration -- \u30a4\u30d9\u30f3\u30c8\u306b\u304b\u304b\u3063\u305f\u6642\u9593 (\u30de\u30a4\u30af\u30ed\u79d2)\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  14, @on  -- StartTime -- \u30a4\u30d9\u30f3\u30c8\u306e\u958b\u59cb\u6642\u523b (\u53d6\u5f97\u3067\u304d\u305f\u5834\u5408)\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  15, @on  -- EndTime -- \u30a4\u30d9\u30f3\u30c8\u304c\u7d42\u4e86\u3057\u305f\u6642\u523b\u3002SQL:BatchStarting \u3084 SP:Starting \u306a\u3069\u306e\u958b\u59cb\u30a4\u30d9\u30f3\u30c8 \u30af\u30e9\u30b9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u306e\u5217\u306b\u5024\u304c\u683c\u7d0d\u3055\u308c\u307e\u305b\u3093\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  31, @on  -- Error -- \u30a4\u30d9\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u756a\u53f7\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  51, @on  -- EventSequence -- \u8981\u6c42\u5185\u306e\u7279\u5b9a\u306e\u30a4\u30d9\u30f3\u30c8\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3002\nEXEC  sp_trace_setevent  @TraceID,  12,  66, @on  -- GroupID -- SQL \u30c8\u30ec\u30fc\u30b9 \u30a4\u30d9\u30f3\u30c8\u304c\u767a\u751f\u3057\u305f\u30ef\u30fc\u30af\u30ed\u30fc\u30c9 \u30b0\u30eb\u30fc\u30d7\u306e ID\u3002\n\n--\u30d5\u30a3\u30eb\u30bf\n--  sp_trace_setfilter \n--       [ @traceid = ] \n--     , [ @columnid = ] \n--     , [ @logical_operator = ] 0:AND  1:OR\n--     , [ @comparison_operator = ] 0:=  1:<>  2:>  3:<  4:>=  5:<=  6:LIKE  7:NOT LIKE\n--     , [ @value = ] value\n--\n-- \u30e6\u30fc\u30b6\u306e\u9650\u5b9a : LoginName ::  0(AND) 11(LoginName) 0(=) N'TEST_USER'\nEXEC sp_trace_setfilter @TraceID, 11, 0, 0, N'TEST_USER'\n\n-- \u30e6\u30fc\u30b6\u64cd\u4f5c\u306e\u307f\u306e\u6307\u5b9a \uff1a IsSystem  :: 0(AND) 60(IsSystem) 0(=) 0\nEXEC sp_trace_setfilter @TraceID, 60, 0, 0, 0\n\n-- \u4e0d\u8981\u5206\u306e\u524a\u9664 \uff1a Text  :: 0(AND)  1(Text) 7(Not Like) N'SET %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'SET %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%EXEC sp_MShelpcolumns %'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%exec sp_unprepare%'\nEXEC sp_trace_setfilter @TraceID,  1, 0, 7, N'%exec sp_executesql%'\n\n-- \u30c8\u30ec\u30fc\u30b9\u958b\u59cb\nEXEC sp_trace_setstatus @TraceID, 1\n\nselect TraceID=@TraceID\ngoto finish\n\nerror: \nselect ErrorCode=@rc\n\nfinish:\ngo\n```\n\n|TraceID |\n|:-:|\n|2 |\n\n\n\u3046\u307e\u304f\u5b9f\u884c\u3067\u304d\u305f\u3089\u30c8\u30ec\u30fc\u30b9ID\u304c\u8868\u793a\u3055\u308c\u307e\u3059\n\u3053\u3053\u3067\u306f\u3001ID\u306f\uff12\u756a\u304c\u63a1\u756a\u3055\u308c\u305f\u3088\u3046\u3067\u3059\n\n#\u30c8\u30ec\u30fc\u30b9\u72b6\u6cc1\u306e\u78ba\u8a8d\n\n```SQL:\nSELECT *  \n  FROM ::fn_trace_getinfo(default)  \n```\n\ntraceid|property|value|\n|:-:|:-:|:--------------------------------------------------------------------------:|\n1|1|2                                                                                |\n1|2|c:\\Program Files\\Microsoft SQL Server\\MSSQL10_50.MSSQLSERVER\\MSSQL\\Log\\log_48.trc|\n1|3|20                                                                               |\n1|4|NULL                                                                             |\n1|5|1                                                                                |\n2|1|0                                                                                |\n2|2|C:\\TEMP\\trc.trc                                                                  |\n2|3|100                                                                              |\n2|4|NULL                                                                             |\n2|5|1                                                                                |\n\n\n\u30c8\u30ec\u30fc\u30b9ID \uff11 \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u52d5\u3044\u3066\u3044\u305f\u3088\u3046\u3067\u3059\n\u30c8\u30ec\u30fc\u30b9ID \uff12 \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\uff15 \u304c \u201d\uff11\u201d\u306a\u306e\u3067\u3001\u5b9f\u884c\u4e2d\u3067\u3059\n[https://msdn.microsoft.com/ja-jp/library/ms173875.aspx](https://msdn.microsoft.com/ja-jp/library/ms173875.aspx)\n\n\n\n#\u30e6\u30fc\u30b6\u4f5c\u696d\n\u304d\u3061\u3093\u3068\u30c8\u30ec\u30fc\u30b9\u53d6\u308c\u3066\u3044\u308b\u304b\u3001SQL\u3092\u767a\u884c\u3057\u3066\u307f\u307e\u3059\n\n\n###\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n```SQL:\nUSE [TEST_DB]\nGO\nCREATE TABLE TEST_TBL\n(\n  ID   INT       NOT NULL  IDENTITY(1, 1),\n  TXT  NCHAR(10)     NULL\n) ON [PRIMARY]\n```\n\n###\u30c7\u30fc\u30bf\u6295\u5165\uff08INSERT)\n\n```SQL:\nINSERT INTO TEST_TBL (TXT) VALUES (N'TEST1')\n```\n\n###\u8868\u793a\uff08SELECT)\n\n```SQL:\nSELECT *  FROM TEST_TBL\n```\n\n\n# \u30c8\u30ec\u30fc\u30b9\u8868\u793a\n\u3068\u308a\u3042\u3048\u305a\u3001\u6700\u4f4e\u9650\u3060\u3051SELECT\u3057\u307e\u3059\n\u4ed6\u306b\u3082\u3044\u308d\u3093\u306a\u60c5\u5831\u3042\u308b\u306e\u3067\u3001SELECT \uff0a \u3067\u898b\u3066\u307f\u308b\u3068\u3088\u3044\u304b\u3082\n\n```SQL:\nSELECT SPID, EventClass, StartTime, EndTime, Duration, TextData\n  FROM ::fn_trace_gettable ( N'C:\\TEMP\\trc.trc' , 0 )  \n```\n\n\n|SPID|EventClass|StartTime|EndTime|Duration|TextData|\n|:-:|:-:|:-:|:-:|:-:|:-:|\n|NULL|65528|NULL|NULL|NULL|NULL|\n|NULL|65534|2016-12-13 11:13:18.690|NULL|NULL|NULL|\n|60|12|2016-12-13 11:13:26.497|2016-12-13 11:13:26.497|244|USE [TEST_DB]  |\n|60|12|2016-12-13 11:13:26.497|2016-12-13 11:13:26.503|8345|CREATE TABLE TEST_TBL  (    ID   INT       NOT NULL  IDENTITY(1, 1),    TXT  NCHAR(10)     NULL  ) ON [PRIMARY]  |\n|60|12|2016-12-13 11:13:29.970|2016-12-13 11:13:29.973|2792|INSERT INTO TEST_TBL (TXT) VALUES (N'TEST1')  |\n|60|12|2016-12-13 11:13:32.583|2016-12-13 11:13:32.583|769|SELECT *    FROM TEST_TBL  |\n\n\n\n\u767a\u884c\u3057\u305fSQL\u304c\u304d\u3061\u3093\u3068\u53d6\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30c8\u30ec\u30fc\u30b9\u306f\u30b7\u30b9\u30c6\u30e0\u306b\u4ed8\u52a0\u3092\u304b\u3051\u7d9a\u3051\u308b\u305f\u3081\u3001\u5fc5\u8981\u304c\u306a\u304f\u306a\u3063\u305f\u3089\u3061\u3083\u3093\u3068\u505c\u6b62\u3057\u3066\u524a\u9664\u3057\u3066\u304a\u304f\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\n#\u30c8\u30ec\u30fc\u30b9\u505c\u6b62\uff06\u524a\u9664\n\n\u5b9f\u884c\u306b\u306f\u30c8\u30ec\u30fc\u30b9ID\u304c\u5fc5\u8981\u306a\u306e\u3067\u3001\u767a\u884c\u6642\u306e\u3084\u3064\u3092\u899a\u3048\u3066\u304a\u304f\u304b\u3001\u78ba\u8a8d\u3057\u3066\u304b\u3089\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n\n```SQL:\n---\u505c\u6b62\nEXEC sp_trace_setstatus 2, 0   -- 2 \u304c\u30c8\u30ec\u30fc\u30b9ID\u3000\u3001\u30000 \u306f\u505c\u6b62\u547d\u4ee4\n\n---\u524a\u9664\nEXEC sp_trace_setstatus 2, 2   -- \u6700\u521d\u306e 2 \u304c\u30c8\u30ec\u30fc\u30b9ID\u3000\u3001\u30002 \u306f\u524a\u9664\u547d\u4ee4\n```\n\n\n\n\u4eca\u56de\u306f\u30a4\u30d9\u30f3\u30c8ID\uff11\uff10(RPC:Completed)\u3068\uff11\uff12(SQL:BatchCompleted)\u3092\u53d6\u308a\u307e\u3057\u305f\u304c\u3001\u30c8\u30ec\u30fc\u30b9\u3057\u305f\u3044\u30a4\u30d9\u30f3\u30c8\uff08\u30ed\u30c3\u30af\u30a4\u30d9\u30f3\u30c8\u306a\u3069\u306a\u3069\uff09\u306b\u3064\u3044\u3066\u306fMicrosoft\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u7167\n\u5fc5\u8981\u306a\u3084\u3064\u3092\u898b\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3067\u3059\u3002\n[https://msdn.microsoft.com/ja-jp/library/ms175481(v=sql.105).aspx](https://msdn.microsoft.com/ja-jp/library/ms175481(v=sql.105).aspx)\n\n\u307e\u305f\u3001\u30c8\u30ec\u30fc\u30b9\u3067\u4e0d\u8981\u306a\u30c7\u30fc\u30bf\u304c\u3044\u3063\u3071\u3044\u51fa\u3066\u304d\u3061\u3083\u3063\u305f\u308a\u3059\u308b\u3068\u898b\u308b\u306e\u3082\u3046\u3093\u3056\u308a\u3057\u3061\u3083\u3046\u306e\u3067\u3001\u3046\u307e\u304f\u30d5\u30a3\u30eb\u30bf\u3092\u8a2d\u5b9a\u3057\u3066\uff08sp_trace_setfilter\uff09\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u63a2\u3057\u3084\u3059\u304f\u3057\u3068\u304f\u306e\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n", "tags": ["Trace", "SQLServer", "Transact-SQL"]}