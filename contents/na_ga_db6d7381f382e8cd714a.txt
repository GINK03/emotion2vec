{"context": " More than 1 year has passed since last update.\n\nVector Clocks\n\u5927\u96d1\u628a\u306a\u610f\u8a33\u3001\u8a33\u3057\u306b\u304f\u3044\u7b87\u6240\u306f\u82f1\u6587\u306e\u307e\u307e\u8ee2\u8f09\u3057\u307e\u3059\u3002\nhttp://docs.basho.com/riak/1.3.2/references/appendices/concepts/Vector-Clocks/\n\nOverview\n\u3069\u306e\u30ce\u30fc\u30c9\u3067\u3082\u3042\u3089\u3086\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u5404\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304c\u53c2\u52a0\u3059\u308b\u5fc5\u8981\u3068\u3059\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306f\u3001values \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6700\u65b0\u304b\u3092\u305f\u3069\u308b\u65b9\u6cd5\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u306f Vector Clock \u304c\u5f79\u5272\u3092\u6301\u3061\u307e\u3059\u3002\n\u65b0\u3057\u3044 value \u304c Riak \u306b\u683c\u7d0d\u3055\u308c\u308b\u3068\u3001\u305d\u306e\u6700\u521d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u7acb\u3057\u3066 Vector Clock \u3067\u30bf\u30b0\u4ed8\u3051\u3055\u308c\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u66f4\u65b0\u6642\u306b\u304a\u3044\u3066\u306f\u3001\u4e0b\u8a18\u306b\u8a18\u8f09\u3059\u308b\u6761\u4ef6\u3067 object \u306e 2 \u3064\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6bd4\u8f03\u3057\u3066\u3001Vector Clock \u3092\u62e1\u5f35\u3057\u307e\u3059\u3002\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u4ed6\u65b9\u306e\u76f4\u63a5\u306e\u5b50\u5b6b\u3067\u3042\u308b\u304b\u3069\u3046\u304b\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5171\u901a\u306e\u89aa\u306e\u5b50\u5b6b\u3067\u3042\u308b\u304b\u3069\u3046\u304b\nWhether the objects are unrelated in recent heritage.\n\n\u3053\u306e\u8b58\u5225\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001Riak \u306f\u540c\u671f\u3057\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u7684\u306b\u4fee\u5fa9\u3059\u308b\u304b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u65b9\u6cd5\u3067\u4fee\u6b63\u3055\u305b\u308b\u6a5f\u4f1a\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\nSiblings\nRiak \u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b Object \u306e\u6b63\u898f\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u89e3\u6c7a\u3067\u304d\u306a\u3044\u3068\u304d\u306b Siblings \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002bucket's properties \u4e0a\u306e \"allow_mult\" \u306b \"true \" \u3092\u8a2d\u5b9a\u3057\u305f\u5834\u5408\u306f\u3001\u4e0b\u8a18\u306b\u8a18\u8f09\u3059\u308b 3 \u3064\u306e\u30b7\u30ca\u30ea\u30aa\u306b\u3088\u3063\u3066\u5358\u4e00\u306e Object \u306b siblings \u3092\u751f\u6210\u3059\u308b\u3067\u3057\u3087\u3046\u3002\n\n\u540c\u6642\u66f8\u304d\u8fbc\u307f: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u540c\u6642\u306b\u751f\u3058\u305f 2 \u3064\u306e\u66f8\u304d\u8fbc\u307f\u304c\u540c\u3058 Vector Clock \u3092\u6301\u3063\u3066\u3044\u308b\u3068\u3001Riak \u306f\u683c\u7d0d\u3059\u308b Object \u3092\u6c7a\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u305a\u3001Object \u306b 2 \u3064\u306e sibling \u3092\u4e0e\u3048\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001\u540c\u3058\u30ce\u30fc\u30c9\u3042\u308b\u3044\u306f\u7570\u306a\u308b\u30ce\u30fc\u30c9\u3067\u767a\u751f\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u53e4\u3044 VectorClock: \u3044\u304f\u3064\u304b\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53e4\u3044 Vector Clock \u3092\u4f7f\u7528\u3057\u3066\u66f8\u304d\u8fbc\u3080\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u304d\u8fbc\u3080\u524d\u306b\u5bfe\u8c61 object \u306e\u6700\u65b0 Vector Clock \u3092\u8aad\u307f\u8fbc\u3080\u30b7\u30ca\u30ea\u30aa\u3067\u3059\u3002\u8aad\u307f\u8fbc\u307f\u66f8\u304d\u8fbc\u307f\u30b5\u30a4\u30af\u30eb\u306e\u9593\u306b\u7570\u306a\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u304d\u8fbc\u3080\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u306e\u72b6\u6cc1\u304c\u751f\u3058\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u53e4\u3044 Vector Clock \u3067\u66f8\u304d\u8fbc\u3080\u3053\u3068\u306b\u3088\u3063\u3066 sibling \u304c\u751f\u6210\u3055\u308c\u308b\u3067\u3057\u3087\u3046\u3002\u3082\u3057\u53e4\u3044 Vector Clock \u3067\u66f8\u304d\u8fbc\u307f\u3092\u7fd2\u6163\u7684\u306b\u884c\u306a\u3046\u3068\u3001\u7d76\u3048\u305a sibling \u3092\u751f\u6210\u3059\u308b\u3067\u3057\u3087\u3046\u3002\nMissing Vector Clock: \u5b58\u5728\u3057\u3066\u3044\u308b Object \u306b Vector Clock \u3092\u6307\u5b9a\u305b\u305a\u306b\u66f8\u304d\u8fbc\u3080\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f \"curl\" \u306e\u3088\u3046\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u3066 \"X-Riak-Vclock\" \u30d8\u30c3\u30c0\u30fc\u3092\u6307\u5b9a\u3059\u308b\u306e\u3092\u5fd8\u308c\u305f\u5834\u5408\u306b\u767a\u751f\u3057\u307e\u3059\u3002\n\nRiak uses siblings because it is impossible to order events with respect to time in a distributed system, this means they must be ordered causally. \"allow_mult\" \u304c true \u306e\u5834\u5408\u306f\u3001Riak \u306f\u767a\u751f\u3057\u305f conflict \u3092\u89e3\u6c7a\u3057\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u767a\u751f\u3057\u305f sibling \u304b\u3089 1 \u3064\u306e\u9078\u629e\u3059\u308b\u304b\u3001\u9055\u3046 Object \u306b\u7f6e\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n# allow_mult \u3092 true \u306b\u8a2d\u5b9a\u3057\u305f bucket \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"props\":{\"allow_mult\":true}}' http://127.0.0.1:8098/riak/kitchen\n> PUT /riak/kitchen HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 29\n>\n< HTTP/1.1 204 No Content\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Date: Thu, 04 Jul 2013 09:44:11 GMT\n< Content-Type: application/json\n< Content-Length: 0\n<\n\n# object \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -X POST -H \"Content-Type: application/json\" -d '{\"dishes\":11}' http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> POST /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 13\n>\n< HTTP/1.1 200 OK\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRMY+VgfGA52m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Link: </riak/kitchen>; rel=\"up\"\n< Last-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n< ETag: \"6FTuzD45wjEgvNOpKMlT8w\"\n< Date: Thu, 04 Jul 2013 09:44:33 GMT\n< Content-Type: application/json\n< Content-Length: 13\n<\n* Connection #0 to host 127.0.0.1 left intact\n* Closing connection #0\n{\"dishes\":11}\n\n# Vector Clock \u3092\u6307\u5b9a\u305b\u305a\u306b object \u3092\u66f4\u65b0\u3059\u308b\u3053\u3068\u3067 sibling  \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"dishes\":9}' http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> PUT /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 12\n>\n< HTTP/1.1 300 Multiple Choices\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Last-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n< ETag: \"5nhfALuggOCcAHlLH60m6B\"\n< Date: Thu, 04 Jul 2013 09:44:48 GMT\n< Content-Type: multipart/mixed; boundary=EJcMmbfshYJ04SJH7YVgfdjE2h9\n< Content-Length: 412\n<\n\n--EJcMmbfshYJ04SJH7YVgfdjE2h9\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 3gMc93QhPKRSRtuLwcGeBz\nLast-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n\n{\"dishes\":9}\n--EJcMmbfshYJ04SJH7YVgfdjE2h9\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 6FTuzD45wjEgvNOpKMlT8w\nLast-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n\n{\"dishes\":11}\n--EJcMmbfshYJ04SJH7YVgfdjE2h9--\n\n\nV-Tag\n\u3053\u306e\u30dd\u30a4\u30f3\u30c8\u306f\u8907\u6570\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308b\u3053\u3068\u3067\u3059\u3002sibling \u3092\u6301\u3063\u3066\u3044\u308b Object \u3092\u53d6\u5f97\u3059\u308b\u3068\u30012 \u3064\u306e\u9078\u629e\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002sibling \u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u3053\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u306f\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u540c\u3058\u3067\u3059\u304c\u51fa\u529b\u5185\u5bb9\u306f\u7570\u306a\u308b\u306f\u305a\u3067\u3059\u3002\n# \u5168\u3066\u306e siblings \u306e vtag \u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink\nSiblings:\n3gMc93QhPKRSRtuLwcGeBz\n6FTuzD45wjEgvNOpKMlT8w\n\n\u8907\u6570\u306e values \u3092\u6301\u3063\u305f Object \u3092\u8aad\u307f\u8fbc\u3080\u3068\u3001\"300 Multiple Choices\" \u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3001\u5168\u3066\u306e sibling \u306e \"vtag\" \u30ea\u30b9\u30c8\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\"vtag\" \u306f Object \u306e 1 \u3064\u306e sibling \u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Object \u306e URL \u306b \"vtag\" \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u3051\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u6307\u5b9a\u3057\u305f sibling \u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n# vtag=6FTuzD45wjEgvNOpKMlT8w \u306e sibling \u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink?vtag=6FTuzD45wjEgvNOpKMlT8w\n{\"dishes\":9}\n\n\"multipart/mixed\" \u30d8\u30c3\u30c0\u30fc\u3092 Accept \u3059\u308b\u3068\u3001\u5168\u3066\u306e siblings \u3092 1 \u56de\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n# \u5168\u3066\u306e siblings \u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink -H \"Accept: multipart/mixed\"\n\n--7id5AcJe2ChS6GptGQ2G6x59PcW\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 3gMc93QhPKRSRtuLwcGeBz\nLast-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n\n{\"dishes\":9}\n--7id5AcJe2ChS6GptGQ2G6x59PcW\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 6FTuzD45wjEgvNOpKMlT8w\nLast-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n\n{\"dishes\":11}\n--7id5AcJe2ChS6GptGQ2G6x59PcW--\n\n\nConflict Resolution\n\"allow_mult\" \u3092 true \u306b\u3059\u308b\u3068\u3001conflict \u304c\u751f\u3058\u305f\u5834\u5408\u306b\u6b63\u3057\u3044 value \u3092\u6c7a\u3081\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001\u81ea\u52d5\u7684\u306b\u4fee\u5fa9\u3059\u308b\u304b\u3001\u30e6\u30fc\u30b6\u30fc\u306b conflict \u3057\u305f Object \u3092\u63d0\u793a\u3057\u307e\u3059\u3002Riak \u3067\u9069\u5207\u306a value \u306b\u66f4\u65b0\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u6700\u65b0\u306e Vector Clock \u304c\u5fc5\u8981\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\"{'dishes':11}\" \u304c\u6b63\u3057\u3044 value \u3060\u3068\u4eee\u5b9a\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u66f4\u65b0\u3057\u307e\u3059\u3002\n# \u6700\u65b0\u306e Vector Clock \u306e\u305f\u3081\u306b Object \u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\n$ curl -v http://127.0.0.1:8098/riak/kitchen/sink\n> GET /riak/kitchen/sink HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n>\n< HTTP/1.1 300 Multiple Choices\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n< Vary: Accept, Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Last-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n< ETag: \"5nhfALuggOCcAHlLH60m6B\"\n< Date: Thu, 04 Jul 2013 11:21:55 GMT\n< Content-Type: text/plain\n< Content-Length: 56\n<\nSiblings:\n3gMc93QhPKRSRtuLwcGeBz\n6FTuzD45wjEgvNOpKMlT8w\n\n# Vector Clock \u3092\u6307\u5b9a\u3057\u3066\u6b63\u3057\u3044 value \u306b\u66f4\u65b0\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"dishes\":11}' -H \"X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\" http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> PUT /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n> Content-Length: 13\n>\n< HTTP/1.1 200 OK\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymROY+VoeK652m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Link: </riak/kitchen>; rel=\"up\"\n< Last-Modified: Thu, 04 Jul 2013 11:24:40 GMT\n< ETag: \"2FSsoEDUHPt67UbcjnNwBr\"\n< Date: Thu, 04 Jul 2013 11:24:40 GMT\n< Content-Type: application/json\n< Content-Length: 13\n<\n{\"dishes\":11}\n\n\nConcurrent conflict resolution\nconflicts \u3092\u81ea\u52d5\u7684\u306b\u89e3\u6c7a\u3057\u3088\u3046\u3068\u3057\u305f\u3089\u30012 \u3064\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u540c\u6642\u306b\u89e3\u6c7a\u3059\u308b\u3053\u3068\u3067\u65b0\u3057\u3044 conflicts \u3092\u751f\u6210\u3057\u3066\u7d42\u308f\u308b\u53ef\u80fd\u6027\u306b\u6ce8\u610f\u3059\u308b\u3079\u304d\u3067\u3059\u3002To avoid a pathological divergence you should be sure to limit the number of reconciliations and fail once that limit has been exceeded. \n\nSibling Explosion\nSibling explosion occurs when an object rapidly collects siblings without being reconciled. \u3053\u308c\u306f\u7121\u6570\u306e\u554f\u984c\u3092\u3082\u305f\u3089\u3057\u307e\u3059\u3002Having an enormous object in your node can cause reads of that object to crash the entire node. Other issues are increased cluster latency as the object is replicated and out of memory errors.\n\nVector Clock Explosion\nsibling explosion \u306e\u4ed6\u306b\u3082\u3001\u77ed\u3044\u671f\u9593\u3067 1 \u3064\u306e Object \u306b\u5bfe\u3057\u3066\u5927\u91cf\u306e\u66f4\u65b0\u3092\u884c\u306a\u3046\u3068\u3001Vector Clock \u306f\u904e\u5ea6\u306b\u5927\u304d\u304f\u6210\u9577\u3057\u307e\u3059\u30021 \u3064\u306e Object \u306b\u5bfe\u3057\u3066\u5927\u91cf\u306b\u66f4\u65b0\u3092\u884c\u306a\u3046\u3053\u3068\u306f\u63a8\u5968\u3067\u304d\u307e\u305b\u3093\u3002Vector Clock \u304c\u904e\u5ea6\u306b\u5927\u304d\u304f\u6210\u9577\u3059\u308b\u306e\u3092\u9632\u3050\u305f\u3081\u306b\u3001Vector Clock \u306e\u5207\u308a\u8fbc\u307f\u30ec\u30d9\u30eb\u3092\u8abf\u6574\u3067\u304d\u307e\u3059\u3002\n\nHow does last_write_wins affect resolution?\n\"allow_mult\" \u3092 \"false\" \u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3068 \"last_write_wins\" \u3092 \"true\" \u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u540c\u3058\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u305d\u3053\u306b\u306f\u5fae\u5999\u306a\u9055\u3044\u304c\u3042\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u4e21\u65b9\u306e\u8a2d\u5b9a\u306f 1 \u3064\u306e value \u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u623b\u3059\u3068\u3057\u3066\u3082\u3001\"allow_mult=false\" \u306f\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b Vector Clock \u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001\"last_write_wins=true\" \u306f\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u308b\u305f\u3081\u306b timestamp \u3092\u8aad\u3080\u3060\u3051\u3067\u3059\u3002\u30b7\u30b9\u30c6\u30e0\u5185\u90e8\u3067\u306f\u3001\"allow_mult=false\" \u306f\u540c\u6642\u66f8\u304d\u8fbc\u307f\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u306b\u3088\u3063\u3066 siblings \u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u8a31\u3057\u307e\u3059\u304c\u3001\"last_write_wins=true\" \u306f\u5f8c\u306e timestamp \u3092\u6301\u3063\u3066\u3044\u308b value \u3067\u4e0a\u66f8\u304d\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\u3042\u306a\u305f\u304c sibling \u306e\u4f5c\u6210\u3092\u597d\u307e\u306a\u3044\u5834\u5408\u306f\u3001\"allow_mult=false\" \u304c\u3042\u306a\u305f\u306b\u6700\u65b0\u306e value \u3092\u53d6\u5f97\u3055\u305b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u6642\u3082\u512a\u96c5\u306b\u51e6\u7406\u3092\u884c\u306a\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u983b\u7e41\u306b keys \u304c\u518d\u66f8\u304d\u8fbc\u307f\u3055\u308c\u308b\u5834\u5408\u3084\u3001\u65b0\u3057\u3044 value \u304c\u53e4\u3044 value \u3068\u4f9d\u5b58\u3057\u3066\u3044\u306a\u3044\u30b1\u30fc\u30b9\u306b\u304a\u3044\u3066\u306f\u3001\"last_write_wins=true\" \u306f\u3088\u308a\u826f\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3042\u305f\u306a\u304c \"last_write_wins=true\" \u3092\u4f7f\u3044\u305f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u30b1\u30fc\u30b9\u306f\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u3084\u3001\u66f4\u65b0\u304c\u306a\u304f\u633f\u5165\u306e\u307f\u3092\u884c\u306a\u3046\u5834\u5408\u3067\u3059\u3002\n\u6ce8\u610f: bucket \u306e properties \u306b \"allow_mult=true\" \u3068 \"last_write_wins=true\" \u3092\u4f75\u7528\u3059\u308b\u3053\u3068\u306f\u3001\u672a\u5b9a\u7fa9\u306a\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u306e\u3067\u4f7f\u7528\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\nVector Clock Pruning\nRiak \u306f bucket \u3054\u3068\u306b\u8a2d\u5b9a\u3067\u304d\u308b 4 \u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u57fa\u3065\u3044\u3066\u3001\u904e\u5ea6\u306a\u6210\u9577\u3092\u9632\u3050\u305f\u3081\u306b Vector Clock \u306e\u5207\u308a\u8a70\u3081\u3092\u5b9a\u671f\u7684\u306b\u884c\u306a\u3044\u307e\u3059\u3002\n\nsmall_vclock\nbig_vclock\nyoung_vclock\nold_vclock\n\n\"small_vclock\" \u3068 \"big_vclock\" \u30d1\u30e9\u30e1\u30fc\u30bf\u306f Vector Clock \u30ea\u30b9\u30c8\u306e\u9577\u3055\u306b\u8a00\u53ca\u3057\u307e\u3059\u3002\u3082\u3057\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"small_vclock\" \u3088\u308a\u5c0f\u3055\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u305b\u3093\u3002\u3082\u3057\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"big_clock\" \u3088\u308a\u5927\u304d\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u3059\u3002\n\"young_vclock\" \u3068 \"old_vclock\" \u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5404 Vector Clock \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b timestamp \u306b\u8a00\u53ca\u3057\u307e\u3059\u3002\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"small_vclock\" \u3068 \"big_vclock\" \u306e\u9593\u306b\u3042\u308b\u5834\u5408\u306b timestamp \u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002timestamp \u304c \"young_vclock\" \u3088\u308a\u82e5\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u305b\u3093\u3002timestamp \u304c \"old_vclock\" \u3088\u308a\u53e4\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u3059\u3002\n\n\nClient vs Vnode Vector Clocks\nRiak 1.0 \u3088\u308a\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001\u5168\u3066\u306e PUT \u30ea\u30af\u30a8\u30b9\u30c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u3068\u3068\u3082\u306b\u6295\u7a3f\u3055\u308c\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3067\u3057\u305f\u3002The jobs of coordinating a put request and incrementing the associated vector clock were handled by the vnode which received the request. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u304c\u6295\u7a3f\u3055\u308c\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001Vector Clock \u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u3002This resulted in potentially unbounded vector clock growth with poorly-behaved clients.\nRiak 1.0 \u306e\u6642\u70b9\u3067\u3001Vector Clock \u306f vnodes \u304c\u5185\u90e8\u306e\u30ab\u30a6\u30f3\u30bf\u30fc\u3068\u8b58\u5225\u5b50\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u76f4\u63a5\u7ba1\u7406\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f Vector Clock \u306e\u6210\u9577\u3092\u6291\u5236\u3055\u305b\u307e\u3059\u304c\u3001\u66f8\u304d\u8fbc\u307f\u306b\u82e5\u5e72\u306e\u9045\u5ef6\u3092\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\nMore Information\nVector Clock \u306b\u95a2\u3059\u308b\u60c5\u5831:\n\nVector Clocks on Wikipedia\nWhy Vector Clocks are Easy\nWhy Vector Clocks are Hard\nThe vector clocks used in Riak are based on the work of Leslie Lamport.\n\n\nEnd\n\u57fa\u672c\u7684\u306b\u306f Vector Clock \u3092\u4f7f\u7528\u3057\u305f\u65b9\u304c\u826f\u3044\u3051\u3069\u3001\u30ed\u30b0\u3092\u683c\u7d0d\u3059\u308b\u3060\u3051\u306e\u7528\u9014\u3060\u3063\u305f\u3089 \"last_write_wins=true\" \u3067\u9ad8\u901f\u5316\u3092\u306f\u304b\u308b\u3063\u3066\u306e\u3082\u826f\u3044\u306d\u3002\n\n# Vector Clocks\n\n\u5927\u96d1\u628a\u306a\u610f\u8a33\u3001\u8a33\u3057\u306b\u304f\u3044\u7b87\u6240\u306f\u82f1\u6587\u306e\u307e\u307e\u8ee2\u8f09\u3057\u307e\u3059\u3002\nhttp://docs.basho.com/riak/1.3.2/references/appendices/concepts/Vector-Clocks/\n\n## Overview\n\n\u3069\u306e\u30ce\u30fc\u30c9\u3067\u3082\u3042\u3089\u3086\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u5165\u308c\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u5404\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304c\u53c2\u52a0\u3059\u308b\u5fc5\u8981\u3068\u3059\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306f\u3001values \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6700\u65b0\u304b\u3092\u305f\u3069\u308b\u65b9\u6cd5\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u306f Vector Clock \u304c\u5f79\u5272\u3092\u6301\u3061\u307e\u3059\u3002\n\n\u65b0\u3057\u3044 value \u304c Riak \u306b\u683c\u7d0d\u3055\u308c\u308b\u3068\u3001\u305d\u306e\u6700\u521d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u7acb\u3057\u3066 Vector Clock \u3067\u30bf\u30b0\u4ed8\u3051\u3055\u308c\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u66f4\u65b0\u6642\u306b\u304a\u3044\u3066\u306f\u3001\u4e0b\u8a18\u306b\u8a18\u8f09\u3059\u308b\u6761\u4ef6\u3067 object \u306e 2 \u3064\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6bd4\u8f03\u3057\u3066\u3001Vector Clock \u3092\u62e1\u5f35\u3057\u307e\u3059\u3002\n\n* \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u4ed6\u65b9\u306e\u76f4\u63a5\u306e\u5b50\u5b6b\u3067\u3042\u308b\u304b\u3069\u3046\u304b\n* \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5171\u901a\u306e\u89aa\u306e\u5b50\u5b6b\u3067\u3042\u308b\u304b\u3069\u3046\u304b\n* Whether the objects are unrelated in recent heritage.\n\n\u3053\u306e\u8b58\u5225\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001Riak \u306f\u540c\u671f\u3057\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u7684\u306b\u4fee\u5fa9\u3059\u308b\u304b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u65b9\u6cd5\u3067\u4fee\u6b63\u3055\u305b\u308b\u6a5f\u4f1a\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\n## Siblings\n\nRiak \u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b Object \u306e\u6b63\u898f\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u89e3\u6c7a\u3067\u304d\u306a\u3044\u3068\u304d\u306b Siblings \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002bucket's properties \u4e0a\u306e \"allow_mult\" \u306b \"true \" \u3092\u8a2d\u5b9a\u3057\u305f\u5834\u5408\u306f\u3001\u4e0b\u8a18\u306b\u8a18\u8f09\u3059\u308b 3 \u3064\u306e\u30b7\u30ca\u30ea\u30aa\u306b\u3088\u3063\u3066\u5358\u4e00\u306e Object \u306b siblings \u3092\u751f\u6210\u3059\u308b\u3067\u3057\u3087\u3046\u3002\n\n1. **\u540c\u6642\u66f8\u304d\u8fbc\u307f:** \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u540c\u6642\u306b\u751f\u3058\u305f 2 \u3064\u306e\u66f8\u304d\u8fbc\u307f\u304c\u540c\u3058 Vector Clock \u3092\u6301\u3063\u3066\u3044\u308b\u3068\u3001Riak \u306f\u683c\u7d0d\u3059\u308b Object \u3092\u6c7a\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u305a\u3001Object \u306b 2 \u3064\u306e sibling \u3092\u4e0e\u3048\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001\u540c\u3058\u30ce\u30fc\u30c9\u3042\u308b\u3044\u306f\u7570\u306a\u308b\u30ce\u30fc\u30c9\u3067\u767a\u751f\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n2. **\u53e4\u3044 VectorClock:** \u3044\u304f\u3064\u304b\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u53e4\u3044 Vector Clock \u3092\u4f7f\u7528\u3057\u3066\u66f8\u304d\u8fbc\u3080\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u304d\u8fbc\u3080\u524d\u306b\u5bfe\u8c61 object \u306e\u6700\u65b0 Vector Clock \u3092\u8aad\u307f\u8fbc\u3080\u30b7\u30ca\u30ea\u30aa\u3067\u3059\u3002\u8aad\u307f\u8fbc\u307f\u66f8\u304d\u8fbc\u307f\u30b5\u30a4\u30af\u30eb\u306e\u9593\u306b\u7570\u306a\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u304d\u8fbc\u3080\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u306e\u72b6\u6cc1\u304c\u751f\u3058\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u53e4\u3044 Vector Clock \u3067\u66f8\u304d\u8fbc\u3080\u3053\u3068\u306b\u3088\u3063\u3066 sibling \u304c\u751f\u6210\u3055\u308c\u308b\u3067\u3057\u3087\u3046\u3002\u3082\u3057\u53e4\u3044 Vector Clock \u3067\u66f8\u304d\u8fbc\u307f\u3092\u7fd2\u6163\u7684\u306b\u884c\u306a\u3046\u3068\u3001\u7d76\u3048\u305a sibling \u3092\u751f\u6210\u3059\u308b\u3067\u3057\u3087\u3046\u3002\n\n3. **Missing Vector Clock:** \u5b58\u5728\u3057\u3066\u3044\u308b Object \u306b Vector Clock \u3092\u6307\u5b9a\u305b\u305a\u306b\u66f8\u304d\u8fbc\u3080\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f \"curl\" \u306e\u3088\u3046\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u7528\u3057\u3066 \"X-Riak-Vclock\" \u30d8\u30c3\u30c0\u30fc\u3092\u6307\u5b9a\u3059\u308b\u306e\u3092\u5fd8\u308c\u305f\u5834\u5408\u306b\u767a\u751f\u3057\u307e\u3059\u3002\n\nRiak uses siblings because it is impossible to order events with respect to time in a distributed system, this means they must be ordered causally. \"allow_mult\" \u304c true \u306e\u5834\u5408\u306f\u3001Riak \u306f\u767a\u751f\u3057\u305f conflict \u3092\u89e3\u6c7a\u3057\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u767a\u751f\u3057\u305f sibling \u304b\u3089 1 \u3064\u306e\u9078\u629e\u3059\u308b\u304b\u3001\u9055\u3046 Object \u306b\u7f6e\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\n# allow_mult \u3092 true \u306b\u8a2d\u5b9a\u3057\u305f bucket \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"props\":{\"allow_mult\":true}}' http://127.0.0.1:8098/riak/kitchen\n> PUT /riak/kitchen HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 29\n>\n< HTTP/1.1 204 No Content\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Date: Thu, 04 Jul 2013 09:44:11 GMT\n< Content-Type: application/json\n< Content-Length: 0\n<\n\n# object \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -X POST -H \"Content-Type: application/json\" -d '{\"dishes\":11}' http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> POST /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 13\n>\n< HTTP/1.1 200 OK\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRMY+VgfGA52m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Link: </riak/kitchen>; rel=\"up\"\n< Last-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n< ETag: \"6FTuzD45wjEgvNOpKMlT8w\"\n< Date: Thu, 04 Jul 2013 09:44:33 GMT\n< Content-Type: application/json\n< Content-Length: 13\n<\n* Connection #0 to host 127.0.0.1 left intact\n* Closing connection #0\n{\"dishes\":11}\n\n# Vector Clock \u3092\u6307\u5b9a\u305b\u305a\u306b object \u3092\u66f4\u65b0\u3059\u308b\u3053\u3068\u3067 sibling  \u3092\u4f5c\u6210\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"dishes\":9}' http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> PUT /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> Content-Length: 12\n>\n< HTTP/1.1 300 Multiple Choices\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Last-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n< ETag: \"5nhfALuggOCcAHlLH60m6B\"\n< Date: Thu, 04 Jul 2013 09:44:48 GMT\n< Content-Type: multipart/mixed; boundary=EJcMmbfshYJ04SJH7YVgfdjE2h9\n< Content-Length: 412\n<\n\n--EJcMmbfshYJ04SJH7YVgfdjE2h9\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 3gMc93QhPKRSRtuLwcGeBz\nLast-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n\n{\"dishes\":9}\n--EJcMmbfshYJ04SJH7YVgfdjE2h9\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 6FTuzD45wjEgvNOpKMlT8w\nLast-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n\n{\"dishes\":11}\n--EJcMmbfshYJ04SJH7YVgfdjE2h9--\n```\n\n### V-Tag\n\n\u3053\u306e\u30dd\u30a4\u30f3\u30c8\u306f\u8907\u6570\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u308b\u3053\u3068\u3067\u3059\u3002sibling \u3092\u6301\u3063\u3066\u3044\u308b Object \u3092\u53d6\u5f97\u3059\u308b\u3068\u30012 \u3064\u306e\u9078\u629e\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002sibling \u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u3053\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u306f\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u540c\u3058\u3067\u3059\u304c\u51fa\u529b\u5185\u5bb9\u306f\u7570\u306a\u308b\u306f\u305a\u3067\u3059\u3002\n\n```\n# \u5168\u3066\u306e siblings \u306e vtag \u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink\nSiblings:\n3gMc93QhPKRSRtuLwcGeBz\n6FTuzD45wjEgvNOpKMlT8w\n```\n\n\u8907\u6570\u306e values \u3092\u6301\u3063\u305f Object \u3092\u8aad\u307f\u8fbc\u3080\u3068\u3001\"300 Multiple Choices\" \u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3001\u5168\u3066\u306e sibling \u306e \"vtag\" \u30ea\u30b9\u30c8\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\"vtag\" \u306f Object \u306e 1 \u3064\u306e sibling \u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Object \u306e URL \u306b \"vtag\" \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u3051\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u6307\u5b9a\u3057\u305f sibling \u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```\n# vtag=6FTuzD45wjEgvNOpKMlT8w \u306e sibling \u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink?vtag=6FTuzD45wjEgvNOpKMlT8w\n{\"dishes\":9}\n```\n\n\"multipart/mixed\" \u30d8\u30c3\u30c0\u30fc\u3092 Accept \u3059\u308b\u3068\u3001\u5168\u3066\u306e siblings \u3092 1 \u56de\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```\n# \u5168\u3066\u306e siblings \u3092\u53d6\u5f97\u3059\u308b\n$ curl http://127.0.0.1:8098/riak/kitchen/sink -H \"Accept: multipart/mixed\"\n\n--7id5AcJe2ChS6GptGQ2G6x59PcW\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 3gMc93QhPKRSRtuLwcGeBz\nLast-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n\n{\"dishes\":9}\n--7id5AcJe2ChS6GptGQ2G6x59PcW\nContent-Type: application/json\nLink: </riak/kitchen>; rel=\"up\"\nEtag: 6FTuzD45wjEgvNOpKMlT8w\nLast-Modified: Thu, 04 Jul 2013 09:44:33 GMT\n\n{\"dishes\":11}\n--7id5AcJe2ChS6GptGQ2G6x59PcW--\n```\n\n### Conflict Resolution\n\n\"allow_mult\" \u3092 true \u306b\u3059\u308b\u3068\u3001conflict \u304c\u751f\u3058\u305f\u5834\u5408\u306b\u6b63\u3057\u3044 value \u3092\u6c7a\u3081\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001\u81ea\u52d5\u7684\u306b\u4fee\u5fa9\u3059\u308b\u304b\u3001\u30e6\u30fc\u30b6\u30fc\u306b conflict \u3057\u305f Object \u3092\u63d0\u793a\u3057\u307e\u3059\u3002Riak \u3067\u9069\u5207\u306a value \u306b\u66f4\u65b0\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u6700\u65b0\u306e Vector Clock \u304c\u5fc5\u8981\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\"{'dishes':11}\" \u304c\u6b63\u3057\u3044 value \u3060\u3068\u4eee\u5b9a\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n```\n# \u6700\u65b0\u306e Vector Clock \u306e\u305f\u3081\u306b Object \u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\n$ curl -v http://127.0.0.1:8098/riak/kitchen/sink\n> GET /riak/kitchen/sink HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n>\n< HTTP/1.1 300 Multiple Choices\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n< Vary: Accept, Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Last-Modified: Thu, 04 Jul 2013 09:44:48 GMT\n< ETag: \"5nhfALuggOCcAHlLH60m6B\"\n< Date: Thu, 04 Jul 2013 11:21:55 GMT\n< Content-Type: text/plain\n< Content-Length: 56\n<\nSiblings:\n3gMc93QhPKRSRtuLwcGeBz\n6FTuzD45wjEgvNOpKMlT8w\n\n# Vector Clock \u3092\u6307\u5b9a\u3057\u3066\u6b63\u3057\u3044 value \u306b\u66f4\u65b0\u3057\u307e\u3059\n$ curl -v -XPUT -H \"Content-Type: application/json\" -d '{\"dishes\":11}' -H \"X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\" http://127.0.0.1:8098/riak/kitchen/sink?returnbody=true\n> PUT /riak/kitchen/sink?returnbody=true HTTP/1.1\n> User-Agent: curl/7.19.7 (x86_64-redhat-linux-gnu) libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18 libssh2/1.4.2\n> Host: 127.0.0.1:8098\n> Accept: */*\n> Content-Type: application/json\n> X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymRKY+VQeCA52m+LAA=\n> Content-Length: 13\n>\n< HTTP/1.1 200 OK\n< X-Riak-Vclock: a85hYGBgzGDKBVIc1ze/yQg8qH40gymROY+VoeK652m+LAA=\n< Vary: Accept-Encoding\n< Server: MochiWeb/1.1 WebMachine/1.10.0 (never breaks eye contact)\n< Link: </riak/kitchen>; rel=\"up\"\n< Last-Modified: Thu, 04 Jul 2013 11:24:40 GMT\n< ETag: \"2FSsoEDUHPt67UbcjnNwBr\"\n< Date: Thu, 04 Jul 2013 11:24:40 GMT\n< Content-Type: application/json\n< Content-Length: 13\n<\n{\"dishes\":11}\n```\n\n#### Concurrent conflict resolution\n\nconflicts \u3092\u81ea\u52d5\u7684\u306b\u89e3\u6c7a\u3057\u3088\u3046\u3068\u3057\u305f\u3089\u30012 \u3064\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u540c\u6642\u306b\u89e3\u6c7a\u3059\u308b\u3053\u3068\u3067\u65b0\u3057\u3044 conflicts \u3092\u751f\u6210\u3057\u3066\u7d42\u308f\u308b\u53ef\u80fd\u6027\u306b\u6ce8\u610f\u3059\u308b\u3079\u304d\u3067\u3059\u3002To avoid a pathological divergence you should be sure to limit the number of reconciliations and fail once that limit has been exceeded. \n\n### Sibling Explosion\n\nSibling explosion occurs when an object rapidly collects siblings without being reconciled. \u3053\u308c\u306f\u7121\u6570\u306e\u554f\u984c\u3092\u3082\u305f\u3089\u3057\u307e\u3059\u3002Having an enormous object in your node can cause reads of that object to crash the entire node. Other issues are increased cluster latency as the object is replicated and out of memory errors.\n\n### Vector Clock Explosion\n\nsibling explosion \u306e\u4ed6\u306b\u3082\u3001\u77ed\u3044\u671f\u9593\u3067 1 \u3064\u306e Object \u306b\u5bfe\u3057\u3066\u5927\u91cf\u306e\u66f4\u65b0\u3092\u884c\u306a\u3046\u3068\u3001Vector Clock \u306f\u904e\u5ea6\u306b\u5927\u304d\u304f\u6210\u9577\u3057\u307e\u3059\u30021 \u3064\u306e Object \u306b\u5bfe\u3057\u3066\u5927\u91cf\u306b\u66f4\u65b0\u3092\u884c\u306a\u3046\u3053\u3068\u306f\u63a8\u5968\u3067\u304d\u307e\u305b\u3093\u3002Vector Clock \u304c\u904e\u5ea6\u306b\u5927\u304d\u304f\u6210\u9577\u3059\u308b\u306e\u3092\u9632\u3050\u305f\u3081\u306b\u3001Vector Clock \u306e\u5207\u308a\u8fbc\u307f\u30ec\u30d9\u30eb\u3092\u8abf\u6574\u3067\u304d\u307e\u3059\u3002\n\n### How does last_write_wins affect resolution?\n\n\"allow_mult\" \u3092 \"false\" \u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3068 \"last_write_wins\" \u3092 \"true\" \u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u540c\u3058\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u305d\u3053\u306b\u306f\u5fae\u5999\u306a\u9055\u3044\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u305f\u3068\u3048\u4e21\u65b9\u306e\u8a2d\u5b9a\u306f 1 \u3064\u306e value \u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u623b\u3059\u3068\u3057\u3066\u3082\u3001\"allow_mult=false\" \u306f\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b Vector Clock \u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001\"last_write_wins=true\" \u306f\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u308b\u305f\u3081\u306b timestamp \u3092\u8aad\u3080\u3060\u3051\u3067\u3059\u3002\u30b7\u30b9\u30c6\u30e0\u5185\u90e8\u3067\u306f\u3001\"allow_mult=false\" \u306f\u540c\u6642\u66f8\u304d\u8fbc\u307f\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u306b\u3088\u3063\u3066 siblings \u304c\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u8a31\u3057\u307e\u3059\u304c\u3001\"last_write_wins=true\" \u306f\u5f8c\u306e timestamp \u3092\u6301\u3063\u3066\u3044\u308b value \u3067\u4e0a\u66f8\u304d\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n\u3042\u306a\u305f\u304c sibling \u306e\u4f5c\u6210\u3092\u597d\u307e\u306a\u3044\u5834\u5408\u306f\u3001\"allow_mult=false\" \u304c\u3042\u306a\u305f\u306b\u6700\u65b0\u306e value \u3092\u53d6\u5f97\u3055\u305b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u6642\u3082\u512a\u96c5\u306b\u51e6\u7406\u3092\u884c\u306a\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u983b\u7e41\u306b keys \u304c\u518d\u66f8\u304d\u8fbc\u307f\u3055\u308c\u308b\u5834\u5408\u3084\u3001\u65b0\u3057\u3044 value \u304c\u53e4\u3044 value \u3068\u4f9d\u5b58\u3057\u3066\u3044\u306a\u3044\u30b1\u30fc\u30b9\u306b\u304a\u3044\u3066\u306f\u3001\"last_write_wins=true\" \u306f\u3088\u308a\u826f\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3042\u305f\u306a\u304c \"last_write_wins=true\" \u3092\u4f7f\u3044\u305f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u30b1\u30fc\u30b9\u306f\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u3084\u3001\u66f4\u65b0\u304c\u306a\u304f\u633f\u5165\u306e\u307f\u3092\u884c\u306a\u3046\u5834\u5408\u3067\u3059\u3002\n\n\u6ce8\u610f: bucket \u306e properties \u306b \"allow_mult=true\" \u3068 \"last_write_wins=true\" \u3092\u4f75\u7528\u3059\u308b\u3053\u3068\u306f\u3001\u672a\u5b9a\u7fa9\u306a\u632f\u308b\u821e\u3044\u3092\u3059\u308b\u306e\u3067\u4f7f\u7528\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n## Vector Clock Pruning\n\nRiak \u306f bucket \u3054\u3068\u306b\u8a2d\u5b9a\u3067\u304d\u308b 4 \u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u57fa\u3065\u3044\u3066\u3001\u904e\u5ea6\u306a\u6210\u9577\u3092\u9632\u3050\u305f\u3081\u306b Vector Clock \u306e\u5207\u308a\u8a70\u3081\u3092\u5b9a\u671f\u7684\u306b\u884c\u306a\u3044\u307e\u3059\u3002\n\n* small_vclock\n* big_vclock\n* young_vclock\n* old_vclock\n\n\"small_vclock\" \u3068 \"big_vclock\" \u30d1\u30e9\u30e1\u30fc\u30bf\u306f Vector Clock \u30ea\u30b9\u30c8\u306e\u9577\u3055\u306b\u8a00\u53ca\u3057\u307e\u3059\u3002\u3082\u3057\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"small_vclock\" \u3088\u308a\u5c0f\u3055\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u305b\u3093\u3002\u3082\u3057\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"big_clock\" \u3088\u308a\u5927\u304d\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u3059\u3002\n\n\"young_vclock\" \u3068 \"old_vclock\" \u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5404 Vector Clock \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b timestamp \u306b\u8a00\u53ca\u3057\u307e\u3059\u3002\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c \"small_vclock\" \u3068 \"big_vclock\" \u306e\u9593\u306b\u3042\u308b\u5834\u5408\u306b timestamp \u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002timestamp \u304c \"young_vclock\" \u3088\u308a\u82e5\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u305b\u3093\u3002timestamp \u304c \"old_vclock\" \u3088\u308a\u53e4\u3044\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u3089\u308c\u307e\u3059\u3002\n\n![](http://docs.basho.com/shared/1.3.2/images/vclock-pruning.png?1372785985)\n\n## Client vs Vnode Vector Clocks\n\nRiak 1.0 \u3088\u308a\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001\u5168\u3066\u306e PUT \u30ea\u30af\u30a8\u30b9\u30c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u3068\u3068\u3082\u306b\u6295\u7a3f\u3055\u308c\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3067\u3057\u305f\u3002The jobs of coordinating a put request and incrementing the associated vector clock were handled by the vnode which received the request. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u304c\u6295\u7a3f\u3055\u308c\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001Vector Clock \u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 ID \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u3002This resulted in potentially unbounded vector clock growth with poorly-behaved clients.\n\nRiak 1.0 \u306e\u6642\u70b9\u3067\u3001Vector Clock \u306f vnodes \u304c\u5185\u90e8\u306e\u30ab\u30a6\u30f3\u30bf\u30fc\u3068\u8b58\u5225\u5b50\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u76f4\u63a5\u7ba1\u7406\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f Vector Clock \u306e\u6210\u9577\u3092\u6291\u5236\u3055\u305b\u307e\u3059\u304c\u3001\u66f8\u304d\u8fbc\u307f\u306b\u82e5\u5e72\u306e\u9045\u5ef6\u3092\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\n## More Information\n\nVector Clock \u306b\u95a2\u3059\u308b\u60c5\u5831:\n\n* [Vector Clocks on Wikipedia](http://en.wikipedia.org/wiki/Vector_clock)\n* [Why Vector Clocks are Easy](http://blog.basho.com/2010/01/29/why-vector-clocks-are-easy/)\n* [Why Vector Clocks are Hard](http://blog.basho.com/2010/04/05/why-vector-clocks-are-hard/)\n* The vector clocks used in Riak are based on the [work of Leslie Lamport](http://portal.acm.org/citation.cfm?id=359563).\n\n## End\n\n\u57fa\u672c\u7684\u306b\u306f Vector Clock \u3092\u4f7f\u7528\u3057\u305f\u65b9\u304c\u826f\u3044\u3051\u3069\u3001\u30ed\u30b0\u3092\u683c\u7d0d\u3059\u308b\u3060\u3051\u306e\u7528\u9014\u3060\u3063\u305f\u3089 \"last_write_wins=true\" \u3067\u9ad8\u901f\u5316\u3092\u306f\u304b\u308b\u3063\u3066\u306e\u3082\u826f\u3044\u306d\u3002", "tags": ["riak"]}