{"tags": ["Java", "Ruby", "DesignPatterns", "\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3"], "context": "\n\n\u6982\u8981\n\u300cRuby\u306b\u3088\u308b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u300d\u3092\u8aad\u3093\u3067\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u52c9\u5f37\u4e2d\u3002\nJava\u3092\u3084\u3063\u3066\u3044\u305f\u4eba\u9593\u3068\u3057\u3066\u306e\u76ee\u7dda\u3067\u60c5\u5831\u3092\u6574\u7406\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4eca\u307e\u3067\u306b\u6574\u7406\u3057\u305f\u3082\u306e\nTemplate Method Pattern\nStrategy Pattern\nObserver Pattern\nComposite Pattern\nCommand Pattern\n\nProxy Pattern\n\n\n\u5b9f\u30af\u30e9\u30b9\uff08RealSubjet\uff09\u3092\u5185\u90e8\u306b\u6301\u3061\u3001\u5b9f\u30af\u30e9\u30b9\u3068\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3063\u305f\u30af\u30e9\u30b9\uff08Proxy\uff09\u3092\u4f5c\u6210\u3059\u308b\n\u57fa\u672c\u7684\u306b\u51e6\u7406\u306f\u5185\u90e8\u306b\u6301\u3063\u3066\u3044\u308b\u5b9f\u30af\u30e9\u30b9\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u79fb\u8b72\u3059\u308b\u304c\u3001Proxy \u5074\u3067\u4ed8\u52a0\u7684\u306a\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\n\u672c\u8cea\u7684\u306a\u51e6\u7406\u306f RealSubject \u5074\u306b\u3001\u4ed8\u52a0\u7684\u306a\u51e6\u7406\u306f Proxy \u5074\u306b\u3001\u3068\u3044\u3046\u3088\u3046\u306b\u8cac\u52d9\u306e\u5206\u96e2\u3092\u884c\u3046\nClient \u5074\u306f Subject \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3059\u308b\u3053\u3068\u3067\u3001Proxy \u3092\u901a\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308b\n\n\n\u57fa\u672c\u5f62\n\nJava \u306e\u5834\u5408\n\nSubject.java\npublic interface Subject {\n  public void doSomething();\n}\n\n\n\nRealSubject.java\npublic class RealSubject implements Subject {\n  public void doSomething() {\n    System.out.println(\"RealSubject#doSomething is called.\");\n  }\n}\n\n\n\nProxy.java\npublic class Proxy implements Subject {\n  private Subject subject;\n\n  public Proxy(Subject subject) {\n    this.subject = subject;\n  }\n\n  public void doSomething() {\n    subject.doSomething();\n  }\n}\n\n\n\n\u5b9f\u884c\npublic class Main {\n  public static void main(String[] args) {\n    Subject subject = new Proxy(new RealSubject()); // Proxy \u3082 Subject \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u306e\u3067\n    subject.doSomething();                              // \u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u6642\u306b Proxy \u3092\u901a\u3057\u3066\u3044\u308b\u306e\u304b\u3069\u3046\u304b\u610f\u8b58\u3057\u306a\u304f\u3066\u6e08\u3080\n  }\n}\n\n\n\nRuby \u306e\u5834\u5408\ninterface \u306f\u5b58\u5728\u3057\u306a\u3044\u306e\u3067 Subject \u3092\u30af\u30e9\u30b9\u3068\u3057\u3066\u5b9a\u7fa9\u3059\u308b\u4ee5\u5916\u306fJava\u3068\u540c\u69d8\u306e\u66f8\u304d\u65b9\u3002\n\nSubject\nclass Subject\n  def do_something\n    puts \"Subject.do_something is called.\"\n  end\nend\n\n\n\nProxy\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def do_something\n    @subject.do_something\n  end\nend\n\n\n\n\u5b9f\u884c\nsubject = Proxy.new(Subject.new)\nsubject.do_something\n\n\n\n\u9069\u7528\u4f8b\n\nProtection Proxy\n\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u51e6\u7406\u3092 Subject \u30af\u30e9\u30b9\u304b\u3089\u72ec\u7acb\u3055\u305b\u3066 Proxy \u306b\u5b9a\u7fa9\u3002\n\u6a29\u9650\u3092\u6301\u305f\u306a\u3044\u30e6\u30fc\u30b6\u306e\u64cd\u4f5c\u3092\u5236\u9650\u3059\u308b\u3001\u3068\u3044\u3046\u3088\u3046\u306a\u5834\u5408\u3092\u8003\u3048\u308b\u3002\n\nProtectionProxy\nclass ProtectionProxy\n  def initialize(subject, user)\n    @subject = subject\n    @user = user\n  end\n\n  def do_something\n    check_auth\n    @subject.do_something\n  end\n\n  # \u5358\u7d14\u306b\u6587\u5b57\u5217\u6bd4\u8f03\u3057\u3066\u307e\u3059\u304c\u3001DB\u304b\u3089\u6a29\u9650\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u8a8d\u8a3c\u3059\u308b\u3001\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u60f3\u5b9a\n  def check_auth\n    raise \"NOT AUTHORIZED!!!\" if @user != 'admin' \n  end\nend\n\n\n\nRemote Proxy\n\u63a5\u7d9a\u30fb\u901a\u4fe1\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092 Subject \u30af\u30e9\u30b9\u304b\u3089\u72ec\u7acb\u3055\u305b\u3066 Proxy \u306b\u5b9a\u7fa9\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306b\u5225\u30de\u30b7\u30f3\u3067\u51e6\u7406\u3092\u884c\u3046\u3088\u3046\u306a\u5834\u5408\u3002\n\nRemoteProxy\nclass RemoteProxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def do_something\n    # \u3053\u3053\u3067\u63a5\u7d9a\u51e6\u7406\u306a\u3069\u3092\u5b9f\u65bd\u3057\u3001\n    @subject.do_something # \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306b\u30e1\u30bd\u30c3\u30c9\u5b9f\u884c\n  end\nend\n\n\n\nVirtual Proxy\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5927\u304d\u3044\uff08\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3068\u304b\uff1f\uff09\u5834\u5408\u3001\u3059\u3050\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u305b\u305a\u3001\u5fc5\u8981\u306b\u306a\u3063\u305f\u6642\u70b9\u3067\u521d\u671f\u5316\u3092\u884c\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n\nVirtualProxy\nclass VirtualProxy\n  def do_something\n    s = subject\n    s.do_something\n  end\n\n  def subject\n    # \u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\uff08@subject = nil\uff09\u306a\u3089\u3070\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\n    @subject || Subject.new\n  end\nend\n\n\nSubject.new \u3092 Proxy \u30af\u30e9\u30b9\u5185\u306b\u66f8\u304f\u306e\u3067\u306f\u306a\u304f\u3001\u30d6\u30ed\u30c3\u30af\u3068\u3057\u3066\u6e21\u3059\u3088\u3046\u306b\u3059\u308c\u3070 Subject \u30af\u30e9\u30b9\u306b\u4f9d\u5b58\u3057\u306a\u3044 Proxy \u30af\u30e9\u30b9\u306b\u3067\u304d\u308b\u3002\n\nVirtualProxy\uff08\u6539\u826f\u7248\uff09\nclass VirtualProxy\n  def initialize(&create_block)\n    @create_block = create_block\n  end\n\n  def do_something\n    s = subject\n    s.do_something\n  end\n\n  def subject\n    @create_block.call\n  end\nend\n\n\n# \u5b9f\u884c\u6642\u306f\u6b21\u306e\u3088\u3046\u306b\nsubject = VirtualProxy.new { Subject.new }\nsubject.do_something\n\n# \u3053\u306e\u5834\u5408\u306f VirtualProxy \u30af\u30e9\u30b9\u304c Subject \u30af\u30e9\u30b9\u306b\u4f9d\u5b58\u3057\u306a\u3044\u306e\u3067\n# \u521d\u671f\u5316\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3067\u6e21\u305b\u3070\u3069\u3093\u306a\u30af\u30e9\u30b9\u3067\u3082\u9045\u5ef6\u521d\u671f\u5316\u304c\u53ef\u80fd\u306b\u306a\u308b\nsubject = VirtualProxy.new { Hoge.new }\n\n\n\n\u3088\u308a Ruby \u3089\u3057\u304f\uff08method_missing \u3092\u4f7f\u3046\uff09\n\u57fa\u672c\u7684\u306a\u3064\u304f\u308a\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u3092 Ruby \u3089\u3057\u3044\u3084\u308a\u65b9\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def method001\n    @subject.method001\n  end\n\n  def method002\n    @subject.method002\n  end\n\n  def method003\n    @subject.method003\n  end\nend\n\nRuby \u3067\u306f\u3042\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u305f\u3068\u304d\uff08\u3088\u308a\u6b63\u78ba\u306b\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u305f\u3068\u304d\uff09\u3001\u6982\u306d\u6b21\u306e\u3088\u3046\u306a\u9806\u5e8f\u3067\u5b9f\u884c\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u63a2\u7d22\u3055\u308c\u307e\u3059\u3002\n\n\u305d\u306e\u30af\u30e9\u30b9\u306b\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\n\u306a\u3051\u308c\u3070\u30af\u30e9\u30b9\u306e\u7d99\u627f\u95a2\u4fc2\u3092\u8fbf\u3063\u3066\u3044\u304d\u3001\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u308c\u3092\u5b9f\u884c\n\u57fa\u5e95\u30af\u30e9\u30b9\uff08BasicObject ?\uff09\u307e\u3067\u8fbf\u3063\u3066\u3082\u898b\u3064\u304b\u3089\u306a\u3051\u308c\u3070\u518d\u3073\u5b50\u30af\u30e9\u30b9\u304b\u3089 method_missing \u30e1\u30bd\u30c3\u30c9\u3092\u63a2\u7d22\n\n\u2026\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u3068\u540c\u3058\u3053\u3068\u304c\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def method_missing(name, *args) # \u5f15\u6570\u306f(\u30e1\u30bd\u30c3\u30c9\u540d\u30b7\u30f3\u30dc\u30eb, \u5f15\u6570\u30ea\u30b9\u30c8)\n    @subject.send(name, *args)\n  end\nend\n\n\u3053\u308c\u3092\u5148\u307b\u3069\u306e ProtectionProxy \u306b\u9069\u7528\u3059\u308b\u3068\n\u6b21\u306e\u3088\u3046\u306b\u3001do_something \u304c\u73fe\u308c\u306a\u3044\u5f62\u3067\u30af\u30e9\u30b9\u304c\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002\n\nProtectionProxy\uff08\u6539\u826f\u7248\uff09\nclass ProtectionProxy\n  def initialize(subject, user)\n    @subject = subject\n    @user = user\n  end\n\n  def method_missing(name, *args)\n    check_auth\n    @subject.send(name, *args)\n  end\n\n  def check_auth\n    raise \"NOT AUTHORIZED!!!\" if @user != 'admin' \n  end\nend\n\n\n\u3053\u3046\u3057\u3066\u304a\u3051\u3070 Subject \u30af\u30e9\u30b9\u306b\u3069\u308c\u3060\u3051\u30e1\u30bd\u30c3\u30c9\u304c\u5897\u3048\u3088\u3046\u304c Proxy \u5074\u306b\u5f71\u97ff\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u3055\u3089\u306b\u3001\u3053\u306e ProtectionProxy \u30af\u30e9\u30b9\u306f Subject \u30af\u30e9\u30b9\u3068\u306f\u5b8c\u5168\u306b\u72ec\u7acb\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3069\u306e\u3088\u3046\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b String \u306b\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u3053\u3068\u3082\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\nstr = ProtectionProxy.new('This string is protected!', 'John Doe')\nstr.upcase # \u4f8b\u5916\u767a\u751f\uff08NOT AUTHORIZED!!! (RuntimeError)\uff09\n\n\nmethod_missing \u3092\u4f7f\u3046\u5834\u5408\u306e\u6ce8\u610f\n\n\u6697\u9ed9\u7684\u306b\u7d99\u627f\u3055\u308c\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\uff08to_s \u306a\u3069\uff09\u306f @subject \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u3089\u308c\u305a\u306b\u89aa\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\uff08to_s \u306a\u3089\u3070 Object#to_s \uff09\u304c\u5b9f\u884c\u3055\u308c\u3066\u3057\u307e\u3046\u5b9f\u884c\u3055\u308c\u3066\u3057\u307e\u3046\n\u30e1\u30bd\u30c3\u30c9\u3092\u63a2\u7d22\u3059\u308b\u5206\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u308b\n\u30b3\u30fc\u30c9\u306e\u53ef\u8aad\u6027\u304c\u843d\u3061\u308b\n\n\n\u3064\u3044\u3067\u306b Java \u306e\u5834\u5408\njava.lang.reflect.Proxy \u3092\u4f7f\u3048\u3070\u52d5\u7684\u306b Proxy \u3092\u4f5c\u6210\u3057\u3066\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nMain.java\nimport java.lang.reflect.Proxy;\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\n\nclass LoggingHandler implements InvocationHandler {\n  private Object subject;\n\n  public LoggingHandler(Object subject) {\n    this.subject = subject;\n  }\n\n  @Override\n  public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    System.out.println(\"LOG: \" + method.getName() + \" is called.\");\n    return method.invoke(subject, args); // \u3053\u3053\u3067 RealSubject \u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\n  }\n}\n\npublic class Main {\n  public static void main(String[] args) {\n    Subject subject = (Subject) Proxy.newProxyInstance(Subject.class.getClassLoader(),\n                                                       new Class<?>[] { Subject.class },\n                                                       new LoggingHandler(new RealSubject()));\n    subject.doSomething();\n  }\n}\n\n\n\n\u53c2\u8003\nOlsen, R. 2007. Design Patterns in Ruby\n# \u6982\u8981\n\u300cRuby\u306b\u3088\u308b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u300d\u3092\u8aad\u3093\u3067\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u52c9\u5f37\u4e2d\u3002\nJava\u3092\u3084\u3063\u3066\u3044\u305f\u4eba\u9593\u3068\u3057\u3066\u306e\u76ee\u7dda\u3067\u60c5\u5831\u3092\u6574\u7406\u3057\u3066\u307f\u307e\u3059\u3002\n\n#### \u4eca\u307e\u3067\u306b\u6574\u7406\u3057\u305f\u3082\u306e\n[Template Method Pattern](http://qiita.com/ksugimori/items/34e766e9bff4cfa62591)\n[Strategy Pattern](http://qiita.com/ksugimori/items/f8773909ded7585c5d61)\n[Observer Pattern](http://qiita.com/ksugimori/items/cff3501f6ac50120b4db)\n[Composite Pattern](http://qiita.com/ksugimori/items/ca00f23ad64779ae3f9a)\n[Command Pattern](http://qiita.com/ksugimori/items/f97cd3d8e8675ab3d1ae)\n\n# Proxy Pattern\n\n![png.png](https://qiita-image-store.s3.amazonaws.com/0/86330/5ba8bbb4-59f1-c3fb-abcd-b51c8258de3e.png)\n\n- \u5b9f\u30af\u30e9\u30b9\uff08RealSubjet\uff09\u3092\u5185\u90e8\u306b\u6301\u3061\u3001\u5b9f\u30af\u30e9\u30b9\u3068\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3063\u305f\u30af\u30e9\u30b9\uff08Proxy\uff09\u3092\u4f5c\u6210\u3059\u308b\n- \u57fa\u672c\u7684\u306b\u51e6\u7406\u306f\u5185\u90e8\u306b\u6301\u3063\u3066\u3044\u308b\u5b9f\u30af\u30e9\u30b9\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u79fb\u8b72\u3059\u308b\u304c\u3001Proxy \u5074\u3067\u4ed8\u52a0\u7684\u306a\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\n- \u672c\u8cea\u7684\u306a\u51e6\u7406\u306f RealSubject \u5074\u306b\u3001\u4ed8\u52a0\u7684\u306a\u51e6\u7406\u306f Proxy \u5074\u306b\u3001\u3068\u3044\u3046\u3088\u3046\u306b\u8cac\u52d9\u306e\u5206\u96e2\u3092\u884c\u3046\n- Client \u5074\u306f Subject \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5bfe\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3059\u308b\u3053\u3068\u3067\u3001Proxy \u3092\u901a\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u610f\u8b58\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308b\n\n# \u57fa\u672c\u5f62\n## Java \u306e\u5834\u5408\n\n```java:Subject.java\npublic interface Subject {\n  public void doSomething();\n}\n```\n\n```java:RealSubject.java\npublic class RealSubject implements Subject {\n  public void doSomething() {\n    System.out.println(\"RealSubject#doSomething is called.\");\n  }\n}\n```\n\n```java:Proxy.java\npublic class Proxy implements Subject {\n  private Subject subject;\n\n  public Proxy(Subject subject) {\n    this.subject = subject;\n  }\n\n  public void doSomething() {\n    subject.doSomething();\n  }\n}\n```\n\n```java:\u5b9f\u884c\npublic class Main {\n  public static void main(String[] args) {\n    Subject subject = new Proxy(new RealSubject()); // Proxy \u3082 Subject \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u306e\u3067\n    subject.doSomething();                              // \u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u6642\u306b Proxy \u3092\u901a\u3057\u3066\u3044\u308b\u306e\u304b\u3069\u3046\u304b\u610f\u8b58\u3057\u306a\u304f\u3066\u6e08\u3080\n  }\n}\n```\n\n## Ruby \u306e\u5834\u5408\n\n`interface` \u306f\u5b58\u5728\u3057\u306a\u3044\u306e\u3067 `Subject` \u3092\u30af\u30e9\u30b9\u3068\u3057\u3066\u5b9a\u7fa9\u3059\u308b\u4ee5\u5916\u306fJava\u3068\u540c\u69d8\u306e\u66f8\u304d\u65b9\u3002\n\n```rb:Subject\nclass Subject\n  def do_something\n    puts \"Subject.do_something is called.\"\n  end\nend\n```\n\n```rb:Proxy\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def do_something\n    @subject.do_something\n  end\nend\n```\n\n```rb:\u5b9f\u884c\nsubject = Proxy.new(Subject.new)\nsubject.do_something\n```\n\n\n# \u9069\u7528\u4f8b\n## Protection Proxy\n\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u51e6\u7406\u3092 Subject \u30af\u30e9\u30b9\u304b\u3089\u72ec\u7acb\u3055\u305b\u3066 Proxy \u306b\u5b9a\u7fa9\u3002\n\u6a29\u9650\u3092\u6301\u305f\u306a\u3044\u30e6\u30fc\u30b6\u306e\u64cd\u4f5c\u3092\u5236\u9650\u3059\u308b\u3001\u3068\u3044\u3046\u3088\u3046\u306a\u5834\u5408\u3092\u8003\u3048\u308b\u3002\n\n```rb:ProtectionProxy\nclass ProtectionProxy\n  def initialize(subject, user)\n    @subject = subject\n    @user = user\n  end\n\n  def do_something\n    check_auth\n    @subject.do_something\n  end\n\n  # \u5358\u7d14\u306b\u6587\u5b57\u5217\u6bd4\u8f03\u3057\u3066\u307e\u3059\u304c\u3001DB\u304b\u3089\u6a29\u9650\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u8a8d\u8a3c\u3059\u308b\u3001\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u60f3\u5b9a\n  def check_auth\n    raise \"NOT AUTHORIZED!!!\" if @user != 'admin' \n  end\nend\n```\n\n## Remote Proxy\n\u63a5\u7d9a\u30fb\u901a\u4fe1\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092 Subject \u30af\u30e9\u30b9\u304b\u3089\u72ec\u7acb\u3055\u305b\u3066 Proxy \u306b\u5b9a\u7fa9\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306b\u5225\u30de\u30b7\u30f3\u3067\u51e6\u7406\u3092\u884c\u3046\u3088\u3046\u306a\u5834\u5408\u3002\n\n```rb:RemoteProxy\nclass RemoteProxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def do_something\n    # \u3053\u3053\u3067\u63a5\u7d9a\u51e6\u7406\u306a\u3069\u3092\u5b9f\u65bd\u3057\u3001\n    @subject.do_something # \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306b\u30e1\u30bd\u30c3\u30c9\u5b9f\u884c\n  end\nend\n```\n\n## Virtual Proxy\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5927\u304d\u3044\uff08\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3068\u304b\uff1f\uff09\u5834\u5408\u3001\u3059\u3050\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u305b\u305a\u3001\u5fc5\u8981\u306b\u306a\u3063\u305f\u6642\u70b9\u3067\u521d\u671f\u5316\u3092\u884c\u3046\u3088\u3046\u306b\u3059\u308b\u3002\n\n```rb:VirtualProxy\nclass VirtualProxy\n  def do_something\n    s = subject\n    s.do_something\n  end\n\n  def subject\n    # \u521d\u671f\u5316\u3055\u308c\u3066\u3044\u306a\u3044\uff08@subject = nil\uff09\u306a\u3089\u3070\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\n    @subject || Subject.new\n  end\nend\n```\n\n`Subject.new` \u3092 Proxy \u30af\u30e9\u30b9\u5185\u306b\u66f8\u304f\u306e\u3067\u306f\u306a\u304f\u3001\u30d6\u30ed\u30c3\u30af\u3068\u3057\u3066\u6e21\u3059\u3088\u3046\u306b\u3059\u308c\u3070 Subject \u30af\u30e9\u30b9\u306b\u4f9d\u5b58\u3057\u306a\u3044 Proxy \u30af\u30e9\u30b9\u306b\u3067\u304d\u308b\u3002\n\n```rb:VirtualProxy\uff08\u6539\u826f\u7248\uff09\nclass VirtualProxy\n  def initialize(&create_block)\n    @create_block = create_block\n  end\n\n  def do_something\n    s = subject\n    s.do_something\n  end\n\n  def subject\n    @create_block.call\n  end\nend\n\n\n# \u5b9f\u884c\u6642\u306f\u6b21\u306e\u3088\u3046\u306b\nsubject = VirtualProxy.new { Subject.new }\nsubject.do_something\n\n# \u3053\u306e\u5834\u5408\u306f VirtualProxy \u30af\u30e9\u30b9\u304c Subject \u30af\u30e9\u30b9\u306b\u4f9d\u5b58\u3057\u306a\u3044\u306e\u3067\n# \u521d\u671f\u5316\u51e6\u7406\u3092\u30d6\u30ed\u30c3\u30af\u3067\u6e21\u305b\u3070\u3069\u3093\u306a\u30af\u30e9\u30b9\u3067\u3082\u9045\u5ef6\u521d\u671f\u5316\u304c\u53ef\u80fd\u306b\u306a\u308b\nsubject = VirtualProxy.new { Hoge.new }\n```\n\n\n# \u3088\u308a Ruby \u3089\u3057\u304f\uff08method_missing \u3092\u4f7f\u3046\uff09\n\n\u57fa\u672c\u7684\u306a\u3064\u304f\u308a\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u3092 Ruby \u3089\u3057\u3044\u3084\u308a\u65b9\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\n\n```rb\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def method001\n    @subject.method001\n  end\n\n  def method002\n    @subject.method002\n  end\n\n  def method003\n    @subject.method003\n  end\nend\n```\n\nRuby \u3067\u306f\u3042\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u305f\u3068\u304d\uff08\u3088\u308a\u6b63\u78ba\u306b\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u305f\u3068\u304d\uff09\u3001\u6982\u306d\u6b21\u306e\u3088\u3046\u306a\u9806\u5e8f\u3067\u5b9f\u884c\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u63a2\u7d22\u3055\u308c\u307e\u3059\u3002\n\n1. \u305d\u306e\u30af\u30e9\u30b9\u306b\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\n2. \u306a\u3051\u308c\u3070\u30af\u30e9\u30b9\u306e\u7d99\u627f\u95a2\u4fc2\u3092\u8fbf\u3063\u3066\u3044\u304d\u3001\u30e1\u30bd\u30c3\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u308c\u3092\u5b9f\u884c\n3. \u57fa\u5e95\u30af\u30e9\u30b9\uff08BasicObject ?\uff09\u307e\u3067\u8fbf\u3063\u3066\u3082\u898b\u3064\u304b\u3089\u306a\u3051\u308c\u3070\u518d\u3073\u5b50\u30af\u30e9\u30b9\u304b\u3089 method_missing \u30e1\u30bd\u30c3\u30c9\u3092\u63a2\u7d22\n\n\u2026\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u3068\u540c\u3058\u3053\u3068\u304c\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002\n\n```rb\nclass Proxy\n  def initialize(subject)\n    @subject = subject\n  end\n\n  def method_missing(name, *args) # \u5f15\u6570\u306f(\u30e1\u30bd\u30c3\u30c9\u540d\u30b7\u30f3\u30dc\u30eb, \u5f15\u6570\u30ea\u30b9\u30c8)\n    @subject.send(name, *args)\n  end\nend\n```\n\n\u3053\u308c\u3092\u5148\u307b\u3069\u306e ProtectionProxy \u306b\u9069\u7528\u3059\u308b\u3068\n\u6b21\u306e\u3088\u3046\u306b\u3001`do_something` \u304c\u73fe\u308c\u306a\u3044\u5f62\u3067\u30af\u30e9\u30b9\u304c\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002\n\n```rb:ProtectionProxy\uff08\u6539\u826f\u7248\uff09\nclass ProtectionProxy\n  def initialize(subject, user)\n    @subject = subject\n    @user = user\n  end\n\n  def method_missing(name, *args)\n    check_auth\n    @subject.send(name, *args)\n  end\n\n  def check_auth\n    raise \"NOT AUTHORIZED!!!\" if @user != 'admin' \n  end\nend\n```\n\n\u3053\u3046\u3057\u3066\u304a\u3051\u3070 Subject \u30af\u30e9\u30b9\u306b\u3069\u308c\u3060\u3051\u30e1\u30bd\u30c3\u30c9\u304c\u5897\u3048\u3088\u3046\u304c Proxy \u5074\u306b\u5f71\u97ff\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u3055\u3089\u306b\u3001\u3053\u306e ProtectionProxy \u30af\u30e9\u30b9\u306f Subject \u30af\u30e9\u30b9\u3068\u306f\u5b8c\u5168\u306b\u72ec\u7acb\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3069\u306e\u3088\u3046\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b String \u306b\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3092\u884c\u3046\u3053\u3068\u3082\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n```rb\nstr = ProtectionProxy.new('This string is protected!', 'John Doe')\nstr.upcase # \u4f8b\u5916\u767a\u751f\uff08NOT AUTHORIZED!!! (RuntimeError)\uff09\n```\n\n### method_missing \u3092\u4f7f\u3046\u5834\u5408\u306e\u6ce8\u610f\n\n- \u6697\u9ed9\u7684\u306b\u7d99\u627f\u3055\u308c\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\uff08to_s \u306a\u3069\uff09\u306f `@subject` \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u3089\u308c\u305a\u306b\u89aa\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\uff08to_s \u306a\u3089\u3070 Object#to_s \uff09\u304c\u5b9f\u884c\u3055\u308c\u3066\u3057\u307e\u3046\u5b9f\u884c\u3055\u308c\u3066\u3057\u307e\u3046\n- \u30e1\u30bd\u30c3\u30c9\u3092\u63a2\u7d22\u3059\u308b\u5206\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u308b\n- \u30b3\u30fc\u30c9\u306e\u53ef\u8aad\u6027\u304c\u843d\u3061\u308b\n\n### \u3064\u3044\u3067\u306b Java \u306e\u5834\u5408\n[java.lang.reflect.Proxy](https://docs.oracle.com/javase/jp/8/docs/api/java/lang/reflect/Proxy.html) \u3092\u4f7f\u3048\u3070\u52d5\u7684\u306b Proxy \u3092\u4f5c\u6210\u3057\u3066\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```java:Main.java\nimport java.lang.reflect.Proxy;\nimport java.lang.reflect.InvocationHandler;\nimport java.lang.reflect.Method;\n\nclass LoggingHandler implements InvocationHandler {\n  private Object subject;\n\n  public LoggingHandler(Object subject) {\n    this.subject = subject;\n  }\n\n  @Override\n  public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    System.out.println(\"LOG: \" + method.getName() + \" is called.\");\n    return method.invoke(subject, args); // \u3053\u3053\u3067 RealSubject \u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u884c\n  }\n}\n\npublic class Main {\n  public static void main(String[] args) {\n    Subject subject = (Subject) Proxy.newProxyInstance(Subject.class.getClassLoader(),\n                                                       new Class<?>[] { Subject.class },\n                                                       new LoggingHandler(new RealSubject()));\n    subject.doSomething();\n  }\n}\n```\n\n\n# \u53c2\u8003\nOlsen, R. 2007. [*Design Patterns in Ruby*](https://www.amazon.co.jp/dp/B004YW6M6G/ref=cm_sw_r_tw_dp_JODHxb1S34F51)\n"}