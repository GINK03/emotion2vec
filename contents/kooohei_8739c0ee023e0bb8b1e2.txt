{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n2015\u5e74\u306ere:Invent\u3067\u300cAWS WAF\u300d\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\nAWS WAF\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u3001IP address\u3001SQL injection\u3001String matching\u306b\u95a2\u3059\u308b\u30a2\u30af\u30bb\u30b9\u306e\u5236\u5fa1\u304c\u3067\u304d\u307e\u3059\u3002\n\u305f\u3060\u3001\u3053\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u306b\u306fCloudFront\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001ELB\u3084EC2\u306bWAF\u3092\u5c0e\u5165\u3059\u308b\u5834\u5408\u306fCloudFront\u3092\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u65e2\u306b\u4f5c\u6210\u6e08\u307f\u306e\u300cwaf-test-acl\u300d\u306bSQL injection\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\u300cAWS WAF\u300d\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002- IP addresses\u7de8\n\u300cAWS WAF\u300d\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002- String matching\u7de8\n\n1.\u8a2d\u5b9a\n\u307e\u305a\u3001SQL injection\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300cCreate condition\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300cName\u300d\u306b\u306f\u4efb\u610f\u306e\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001Filter settings\u306e\u300cPart of the request to filter on\u300d\u3067\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044Web\u8981\u6c42\u3001\u300cTransformation\u300d\u3067AWS WAF\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u524d\u306b\u884c\u3046\u5909\u63db\u65b9\u5f0f\u3092\u6307\u5b9a\u3057\u3001OK\u3067\u3042\u308c\u3070\u300cAdd another filter\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u6761\u4ef6\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nFilters in this SQL injection match condition\u3078\u306e\u8ffd\u52a0\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncondition\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u6b21\u306b\u300cRules\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\nRules\u8a2d\u5b9a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u300cCreate rule\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u30eb\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u5148\u307b\u3069Conditions\u306eSQL injection\u3067\u4f5c\u6210\u3057\u305f\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u3001\u5b8c\u4e86\u3057\u305f\u3089\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30eb\u30fc\u30eb\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u305f\u3089\u300cWeb ACLs\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u5bfe\u8c61\u306eACL\u540d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30bf\u30d6\u300cRules\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u300cEdit web ACL\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300cRules\u300d\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u3067\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30eb\u30fc\u30eb\u3092\u9078\u629e\u3057\u3001\u300cAdd rule to web ACL\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4e0b\u306e\u201dIf a request matches all the conditions in a rule, take the corresponding action\u201d\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\u305d\u3046\u3057\u305f\u3089\u4eca\u56de\u306f\u30d6\u30ed\u30c3\u30af\u3092\u3057\u305f\u3044\u305f\u3081\u300cBlock\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u300cUpdate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u30eb\u30fc\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\u300cRequests\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30ea\u30af\u30a8\u30b9\u30c8\u30ed\u30b0\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n2.\u52d5\u4f5c\u78ba\u8a8d\n\u307e\u305a\u306f\u73fe\u72b6\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\n\n\u6b21\u306bsqlmap\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u518d\u5ea6\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\"sql-injection-rule\"\u306b\u3088\u3063\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u300cBlock\u300d\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3055\u3089\u306b\u4eca\u56de\u306fUser-Agent\u306b\u5bfe\u3057\u3066\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001Request headers\u306eUser-Agent\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3069\u3046\u3044\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9632\u3044\u3060\u304b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\n\n\u4ee5\u4e0a\u3067\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n## \u306f\u3058\u3081\u306b\n2015\u5e74\u306ere:Invent\u3067\u300cAWS WAF\u300d\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\n\nAWS WAF\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u3001IP address\u3001SQL injection\u3001String matching\u306b\u95a2\u3059\u308b\u30a2\u30af\u30bb\u30b9\u306e\u5236\u5fa1\u304c\u3067\u304d\u307e\u3059\u3002\n\u305f\u3060\u3001\u3053\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u306b\u306fCloudFront\u7d4c\u7531\u3067\u306e\u30a2\u30af\u30bb\u30b9\u306b\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001ELB\u3084EC2\u306bWAF\u3092\u5c0e\u5165\u3059\u308b\u5834\u5408\u306fCloudFront\u3092\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u65e2\u306b\u4f5c\u6210\u6e08\u307f\u306e\u300cwaf-test-acl\u300d\u306bSQL injection\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n[\u300cAWS WAF\u300d\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002- IP addresses\u7de8](http://qiita.com/kooohei/items/5250f8c35d0b310dd467)\n[\u300cAWS WAF\u300d\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002- String matching\u7de8](http://qiita.com/kooohei/items/18b908a38a98528550e5)\n\n## 1.\u8a2d\u5b9a\n\u307e\u305a\u3001SQL injection\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120401.png](https://qiita-image-store.s3.amazonaws.com/0/82090/3c0e488c-ab1e-ed97-73ef-5f8b66a183ef.png)\n\n\u300cCreate condition\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120402.png](https://qiita-image-store.s3.amazonaws.com/0/82090/a8744128-6c9f-e323-dc85-8ca16f70d176.png)\n\n\u300cName\u300d\u306b\u306f\u4efb\u610f\u306e\u30b3\u30f3\u30c7\u30a3\u30b7\u30e7\u30f3\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001Filter settings\u306e\u300cPart of the request to filter on\u300d\u3067\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044Web\u8981\u6c42\u3001\u300cTransformation\u300d\u3067AWS WAF\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u524d\u306b\u884c\u3046\u5909\u63db\u65b9\u5f0f\u3092\u6307\u5b9a\u3057\u3001OK\u3067\u3042\u308c\u3070\u300cAdd another filter\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u6761\u4ef6\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120403.png](https://qiita-image-store.s3.amazonaws.com/0/82090/31948ec2-c58c-a4d7-0b26-19504d9f84dd.png)\n\nFilters in this SQL injection match condition\u3078\u306e\u8ffd\u52a0\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120404.png](https://qiita-image-store.s3.amazonaws.com/0/82090/54e80d2d-720f-349a-96a5-04f6a25697ca.png)\n\ncondition\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u6b21\u306b\u300cRules\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120405.png](https://qiita-image-store.s3.amazonaws.com/0/82090/e91e32cb-55dd-1018-0b0a-838d546e070c.png)\n\nRules\u8a2d\u5b9a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u305f\u3089\u300cCreate rule\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u30eb\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120406.png](https://qiita-image-store.s3.amazonaws.com/0/82090/2c386f4c-78bb-07ae-377c-dd1112e035f6.png)\n\n\u5148\u307b\u3069Conditions\u306eSQL injection\u3067\u4f5c\u6210\u3057\u305f\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u3001\u5b8c\u4e86\u3057\u305f\u3089\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120407.png](https://qiita-image-store.s3.amazonaws.com/0/82090/4e5abd0b-ec03-3f5b-8b8c-72fc924cb72e.png)\n\n\u30eb\u30fc\u30eb\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u305f\u3089\u300cWeb ACLs\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120408.png](https://qiita-image-store.s3.amazonaws.com/0/82090/f8f07011-cc24-5d48-9b06-b47db0383cee.png)\n\n\u4eca\u56de\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u5bfe\u8c61\u306eACL\u540d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120409.png](https://qiita-image-store.s3.amazonaws.com/0/82090/8340e1bf-1517-1eac-f827-0d4435bbedb5.png)\n\n\u30bf\u30d6\u300cRules\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u300cEdit web ACL\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120410-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/a4139ba3-e738-78b4-3ac2-3fca43ebe0a1.png)\n\n\u300cRules\u300d\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u3067\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30eb\u30fc\u30eb\u3092\u9078\u629e\u3057\u3001\u300cAdd rule to web ACL\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4e0b\u306e\u201dIf a request matches all the conditions in a rule, take the corresponding action\u201d\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\u305d\u3046\u3057\u305f\u3089\u4eca\u56de\u306f\u30d6\u30ed\u30c3\u30af\u3092\u3057\u305f\u3044\u305f\u3081\u300cBlock\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u300cUpdate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120411.png](https://qiita-image-store.s3.amazonaws.com/0/82090/32de316d-d008-4001-a91c-527d05e48b79.png)\n\n\u30eb\u30fc\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\u300cRequests\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30ea\u30af\u30a8\u30b9\u30c8\u30ed\u30b0\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120412-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/14c360d3-19cc-0783-51aa-c583b61cc2f6.png)\n\n\n## 2.\u52d5\u4f5c\u78ba\u8a8d\n\u307e\u305a\u306f\u73fe\u72b6\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\n![aws-waf_sql-injection_2015120414.png](https://qiita-image-store.s3.amazonaws.com/0/82090/4fa2ba96-395b-c49d-6a48-694f3e98cbcc.png)\n\n\u6b21\u306bsqlmap\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120419-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/2edf7173-9eef-ea55-316f-d33268c8ff1e.png)\n\n\u305d\u308c\u3067\u306f\u518d\u5ea6\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120415-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/3e5b73ce-86ff-f935-760e-1f1a4f8f48ed.png)\n\n\u5148\u307b\u3069\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\"sql-injection-rule\"\u306b\u3088\u3063\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u300cBlock\u300d\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3055\u3089\u306b\u4eca\u56de\u306fUser-Agent\u306b\u5bfe\u3057\u3066\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001Request headers\u306eUser-Agent\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3069\u3046\u3044\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9632\u3044\u3060\u304b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n![aws-waf_sql-injection_2015120416-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/9c7297be-2382-0036-f87a-96050f749dfe.png)\n\n![aws-waf_sql-injection_2015120417-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/68bfd374-a6d0-6bfc-930b-9fbcb01c201a.png)\n\n![aws-waf_sql-injection_2015120418-1.png](https://qiita-image-store.s3.amazonaws.com/0/82090/14cd9731-1cd5-6e62-a8cf-17551086c621.png)\n\n\n\u4ee5\u4e0a\u3067\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n", "tags": ["AWS", "waf", "CloudFront"]}