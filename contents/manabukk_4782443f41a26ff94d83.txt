{"context": " More than 1 year has passed since last update.\u524d\u56de\n\nCoffee script \u53c2\u8003\nCoffeeScript \u8a00\u8a9e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\u57fa\u672c\u64cd\u4f5c\u9006\u5f15\u304d\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\uff08CoffeeScript\uff09\n\nBacklog API\n\u671d\u306b\u671f\u9650\u304c\u8feb\u3063\u3066\u3044\u308b\u8ab2\u984c\u3092\u901a\u77e5\u3055\u305b\u305f\u3044\nBacklog API \u3068\u306f\n\u3053\u3053\u3092\u53c2\u7167\u3057\u306a\u304c\u3089\n\u3067\u304d\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\n\nbacklog2.coffee\n\n# Description:#   Backlog to Slack## Commands:#   None\n\ncron = require('cron').CronJob\n\nbacklogUrl = '****'\napiKey = '****'\nusername = '***'\n\nmodule.exports = (robot) ->\n    new cron \"0 0 9,15 * * *\", () =>\n        console.log \"BacklogAPI 2 start...\"\n\n        now_raw = new Date\n        console.log \"#{now_raw}\"\n        now = \"#{now_raw.getFullYear()}#{now_raw.getMonth()+1}#{now_raw.getDate()}\"\n        console.log now\n\n        # API\u30a2\u30af\u30bb\u30b9\n        robot.http(\"#{backlogUrl}api/v2/issues?apiKey=#{apiKey}\")\n        .get() (err, res, body) ->\n\n            # console.log body\n\n            for feed in JSON.parse body\n                if feed.dueDate is null\n                    continue\n\n                due = \"#{feed.dueDate[0..3]}#{feed.dueDate[5..6]}#{feed.dueDate[8..9]}\"\n\n                if now > due and feed.status.id > 2 # \u904e\u53bb\u306e\u8ab2\u984c\u3067\u51e6\u7406\u6e08\u307f\u306e\u3082\u306e\u306f\u8868\u793a\u3057\u306a\u3044\u3002\u3000status id 1:\u672a\u51e6\u7406 2:\u51e6\u7406\u4e2d 3:\u51e6\u7406\u6e08\u307f 4:\u5b8c\u4e86\n                    continue\n                if feed.assignee.name isnt username # \u81ea\u5206\u306e\u8ab2\u984c\u4ee5\u5916\u306f\u30b9\u30eb\u30fc\n                    continue\n                if parseInt(due,10) - parseInt(now,10) > 14 #\uff12\u9031\u9593\u3088\u308a\u5148\u306e\u8ab2\u984c\u306f\u8868\u793a\u3057\u306a\u3044\n                    continue\n                console.log due\n                console.log feed.issueKey\n                console.log feed.assignee.name\n                console.log \"due : #{feed.dueDate}\"\n                console.log \"*\"\n\n                # \u6295\u7a3f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6574\u5f62\n                url = \"#{backlogUrl}view/#{feed.issueKey}\"\n                message = \"[#{feed.issueKey}] #{feed.summary} #{url}\"\n\n                # Slack \u306b\u6295\u7a3f\n                robot.send {room: '#backlog'}, message\n                # console.log message\n\n    , null, true, \"Asia/Tokyo\"\n\n\n\n[\u524d\u56de](http://qiita.com/manabukk/private/206b4d5c897163e43f65)\n\n#Coffee script \u53c2\u8003\n[CoffeeScript \u8a00\u8a9e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](http://memo.sappari.org/coffeescript/coffeescript-langref)\n[\u57fa\u672c\u64cd\u4f5c\u9006\u5f15\u304d\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\uff08CoffeeScript\uff09](http://kyu-mu.net/coffeescript/revref/)\n\n#Backlog API\n\u671d\u306b\u671f\u9650\u304c\u8feb\u3063\u3066\u3044\u308b\u8ab2\u984c\u3092\u901a\u77e5\u3055\u305b\u305f\u3044\n\n[Backlog API \u3068\u306f](http://developer.nulab-inc.com/ja/docs/backlog)\n\n\u3053\u3053\u3092\u53c2\u7167\u3057\u306a\u304c\u3089\n\n\u3067\u304d\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\n\n```coffeescript:backlog2.coffee\n\n# Description:#   Backlog to Slack## Commands:#   None\n\ncron = require('cron').CronJob\n\nbacklogUrl = '****'\napiKey = '****'\nusername = '***'\n\nmodule.exports = (robot) ->\n    new cron \"0 0 9,15 * * *\", () =>\n        console.log \"BacklogAPI 2 start...\"\n\n        now_raw = new Date\n        console.log \"#{now_raw}\"\n        now = \"#{now_raw.getFullYear()}#{now_raw.getMonth()+1}#{now_raw.getDate()}\"\n        console.log now\n\n        # API\u30a2\u30af\u30bb\u30b9\n        robot.http(\"#{backlogUrl}api/v2/issues?apiKey=#{apiKey}\")\n        .get() (err, res, body) ->\n\n            # console.log body\n\n            for feed in JSON.parse body\n                if feed.dueDate is null\n                    continue\n\n                due = \"#{feed.dueDate[0..3]}#{feed.dueDate[5..6]}#{feed.dueDate[8..9]}\"\n\n                if now > due and feed.status.id > 2 # \u904e\u53bb\u306e\u8ab2\u984c\u3067\u51e6\u7406\u6e08\u307f\u306e\u3082\u306e\u306f\u8868\u793a\u3057\u306a\u3044\u3002\u3000status id 1:\u672a\u51e6\u7406 2:\u51e6\u7406\u4e2d 3:\u51e6\u7406\u6e08\u307f 4:\u5b8c\u4e86\n                    continue\n                if feed.assignee.name isnt username # \u81ea\u5206\u306e\u8ab2\u984c\u4ee5\u5916\u306f\u30b9\u30eb\u30fc\n                    continue\n                if parseInt(due,10) - parseInt(now,10) > 14 #\uff12\u9031\u9593\u3088\u308a\u5148\u306e\u8ab2\u984c\u306f\u8868\u793a\u3057\u306a\u3044\n                    continue\n                console.log due\n                console.log feed.issueKey\n                console.log feed.assignee.name\n                console.log \"due : #{feed.dueDate}\"\n                console.log \"*\"\n\n                # \u6295\u7a3f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u6574\u5f62\n                url = \"#{backlogUrl}view/#{feed.issueKey}\"\n                message = \"[#{feed.issueKey}] #{feed.summary} #{url}\"\n\n                # Slack \u306b\u6295\u7a3f\n                robot.send {room: '#backlog'}, message\n                # console.log message\n\n    , null, true, \"Asia/Tokyo\"\n\n```\n\n", "tags": ["Hubot"]}