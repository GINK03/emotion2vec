{"tags": ["Sqlplus", "Excel", "HTML", "Format"], "context": "\n\nSQLPlus\n\nSqlplus\u3088\u308aHTML\uff08\u7591\u4f3cExcel\uff09\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u51fa\u529b\u65b9\u6cd5\n\nWindows\u7cfb\u306eSqlplus\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u751f\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u958b\u304f\u6642\u3001Excel\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u7121\u8996\u3057\u3066\u3044\u3044\u3002\n\nsqlplus\nSET LINESIZE 1000 PAGES 50000\nSET TRIMSPOOL ON\nSET MARKUP HTML ON SPOOL ON ENTMAP ON PREFORMAT OFF -\nHEAD \" -\n <STYLE type='text/css'> -\n  body {font:10pt 'Meiryo UI',Helvetica,sans-serif; color:black; background:White;} -\n  p {   font:10pt 'Meiryo UI',Helvetica,sans-serif; color:black; background:White;} -\n  table,tr{font:10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:Black; background:#f7f7e7; -\n        padding:0px 0px 0px 0px; margin:0px 0px 0px 0px; white-space:nowrap;} -\n  th {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:#336699; background:#cccc99; mso-text-control:shrinktofit; padding:0px 0px 0px 0px;} -\n  td {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; mso-text-control:shrinktofit; mso-number-format:'\\@'; padding:0px 0px 0px 0px;} -\n  span {  font:10pt 'Meiryo UI'; color:black; background-color:White;} -\n  h1 {  font:16pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,Geneva,sans-serif; color:#336699; background-color:White; -\n        border-bottom:1px solid #cccc99; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;} -\n  h2 {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,Geneva,sans-serif; color:#336699; background-color:White; -\n        margin-top:4pt; margin-bottom:0pt;} a {font:9pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:#663300; -\n        background:#ffffff; margin-top:0pt; margin-bottom:0pt; vertical-align:top;} -\n </STYLE>-\n\" -\nBODY \"TEXT='black'\" -\nTABLE \"WIDTH='90%' BORDER='1' cellspacing='0' cellpadding='1'\"\n\nSET NULL (nil)\nALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'; \nALTER SESSION SET NLS_TIMESTAMP_FORMAT='YYYY-MM-DD HH24:MI:SS.FF'; \nALTER SESSION SET NLS_TIMESTAMP_FORMAT='YYYY-MM-DD HH24:MI:SS,FF';\n\nVARIABLE KEY_NO_1 VARCHAR2(10)\nVARIABLE KEY_NO_2 VARCHAR2(10)\nVARIABLE KEY_NO_3 VARCHAR2(10)\n\nEXECUTE :KEY_NO_1 := 1\nEXECUTE :KEY_NO_2 := 2\nEXECUTE :KEY_NO_3 := 0\n\n------------------------------------------------------------\n@setColumns.SQL\n------------------------------------------------------------\n-- \u3053\u3053\u304b\u3089\uff1a\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u8a2d\u5b9a START\n------------------------------------------------------------\nVARIABLE BASEPATH VARCHAR2(50)\nEXECUTE :BASEPATH := 'LOCAL'\n\nSET VERIFY OFF\nSET TIMING OFF\nSET HEADING ON\n\nCOLUMN baseworkpath NEW_VALUE base_path NOPRINT\nSELECT :BASEPATH baseworkpath FROM DUAL;\n\n------------------------------------------------------------\n-- createWorkPath.bat\n------------------------------------------------------------\n-- @if (1==1) /*\n-- @ECHO OFF\n-- \n-- ECHO  %1\n-- \n-- CScript //Nologo //E:JScript \"%~f0\" %1\n-- \n-- EXIT /B 0\n-- \n-- rem */\n-- \n-- @end\n-- \n-- getYYYYMMDD = function() {\n--     var dd = new Date();\n--     var yy = dd.getYear();\n--     var mm = dd.getMonth() + 1;\n--     var dd = dd.getDate();\n--     if (yy < 2000) { yy += 1900; }\n--     if (mm < 10) { mm = \"0\" + mm; }\n--     if (dd < 10) { dd = \"0\" + dd; }\n--     \n--     return ( \"\" + yy ) + ( \"\" + mm ) + ( \"\" + dd ) ;\n-- }\n-- \n-- captureWorkFolder = function(argc, argv) {\n--   var FSO = new ActiveXObject(\"Scripting.FileSystemObject\");\n--   \n--   var workBasePath = argv(0);\n--   \n--   if ( !FSO.FolderExists(workBasePath) ) {\n--     FSO.CreateFolder(workBasePath);\n--   }\n--   \n--   var workPath = workBasePath + \"\\\\\" + getYYYYMMDD();\n--   \n--   if ( !FSO.FolderExists(workPath) ) {\n--     FSO.CreateFolder(workPath);\n--   }\n--   \n--   FSO = null;\n-- }\n-- \n-- captureWorkFolder(WScript.arguments.length, WScript.arguments)\n------------------------------------------------------------\n\nHOST createWorkPath.bat &base_path.\n\nVARIABLE w_RESULT_FILE VARCHAR2(420)\nDECLARE\n    w_DBDAY   NUMBER := 0; -- 220;\n    w_PATH    VARCHAR2(200) := '.\\' || :BASEPATH || '\\'  ||TO_CHAR(SYSDATE - w_DBDAY, 'YYYYMMDD') ;\n    w_TIME    VARCHAR2( 20) := TO_CHAR(SYSDATE - w_DBDAY, 'YYMMDD_HH24MISS');\n    w_PREFIX  VARCHAR2(200) := 'PREFIX_';\n    w_NOS     VARCHAR2(200) := :KEY_NO_3 || '_' || :KEY_NO_1 || '_' || :KEY_NO_2;\nBEGIN\n    :w_RESULT_FILE := w_PATH || '\\' || w_PREFIX || w_TIME || '_' || w_NOS || '.xls';\nEND;\n/\n\n--SET PAGESIZE 0\nCOLUMN runtime NEW_VALUE runtime_text NOPRINT\nSELECT :w_RESULT_FILE RUNTIME FROM DUAL;\n\nSET  SERVEROUTPUT ON SIZE UNLIMITED\n\nSET TRIMSPOOL ON\nSPOOL &runtime_text.\n\n------------------------------------------------------------\n-- \u3053\u3053\u307e\u3067\uff1a\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u8a2d\u5b9a START\n------------------------------------------------------------\n\n--------------------------------------------------------------------------------\n-- TBL_NAME1\n--------------------------------------------------------------------------------\n    SET MARKUP HTML ENTMAP OFF\n    PROMPT <BR><SPAN>\u3010\u30b5\u30d6\u30c6\u30fc\u30d6\u30eb TBL_NAME1\u3011</SPAN>\n    SET MARKUP HTML ENTMAP ON\n    SELECT * FROM TBL_NAME1  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO_3 = ME.KEY_NO_3 AND S.KEY_NO2 IN (:KEY_NO_1,:KEY_NO_2))\n    UNION\n    SELECT * FROM TBL_NAME1  ME  WHERE ME.KEY_NO_3 = :KEY_NO_3;\n\n\n\n    SET MARKUP HTML ENTMAP OFF\n    PROMPT <BR><SPAN>\u3010\u30e1\u30a4\u30f3\u30c6\u30fc\u30d6\u30eb TBL_NAME0\u3011</SPAN>\n    SET MARKUP HTML ENTMAP ON\n    SELECT * FROM TBL_NAME0  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO = ME.KEY_NO AND S.KEY_NO2 IN (:KEY_NO_1,:KEY_NO_2))\n    UNION\n    SELECT * FROM TBL_NAME0  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO = ME.KEY_NO AND S.KEY_NO_3 = :KEY_NO_3) ORDER BY 1, 2;\n\nSPOOL OFF\nSET MARKUP HTML OFF SPOOL OFF\nSET TERMOUT ON\n\nhost start &runtime_text.\n\nEXIT;\n\n\n\n#SQLPlus\n\n###Sqlplus\u3088\u308aHTML\uff08\u7591\u4f3cExcel\uff09\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u51fa\u529b\u65b9\u6cd5\n---\nWindows\u7cfb\u306eSqlplus\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u751f\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u958b\u304f\u6642\u3001Excel\u306f\u78ba\u8a8d\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u7121\u8996\u3057\u3066\u3044\u3044\u3002\n\n```sql:sqlplus\nSET LINESIZE 1000 PAGES 50000\nSET TRIMSPOOL ON\nSET MARKUP HTML ON SPOOL ON ENTMAP ON PREFORMAT OFF -\nHEAD \" -\n <STYLE type='text/css'> -\n  body {font:10pt 'Meiryo UI',Helvetica,sans-serif; color:black; background:White;} -\n  p {   font:10pt 'Meiryo UI',Helvetica,sans-serif; color:black; background:White;} -\n  table,tr{font:10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:Black; background:#f7f7e7; -\n        padding:0px 0px 0px 0px; margin:0px 0px 0px 0px; white-space:nowrap;} -\n  th {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:#336699; background:#cccc99; mso-text-control:shrinktofit; padding:0px 0px 0px 0px;} -\n  td {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; mso-text-control:shrinktofit; mso-number-format:'\\@'; padding:0px 0px 0px 0px;} -\n  span {  font:10pt 'Meiryo UI'; color:black; background-color:White;} -\n  h1 {  font:16pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,Geneva,sans-serif; color:#336699; background-color:White; -\n        border-bottom:1px solid #cccc99; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;} -\n  h2 {  font: 10pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,Geneva,sans-serif; color:#336699; background-color:White; -\n        margin-top:4pt; margin-bottom:0pt;} a {font:9pt '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af',Helvetica,sans-serif; color:#663300; -\n        background:#ffffff; margin-top:0pt; margin-bottom:0pt; vertical-align:top;} -\n </STYLE>-\n\" -\nBODY \"TEXT='black'\" -\nTABLE \"WIDTH='90%' BORDER='1' cellspacing='0' cellpadding='1'\"\n\nSET NULL (nil)\nALTER SESSION SET NLS_DATE_FORMAT='YYYY-MM-DD HH24:MI:SS'; \nALTER SESSION SET NLS_TIMESTAMP_FORMAT='YYYY-MM-DD HH24:MI:SS.FF'; \nALTER SESSION SET NLS_TIMESTAMP_FORMAT='YYYY-MM-DD HH24:MI:SS,FF';\n\nVARIABLE KEY_NO_1 VARCHAR2(10)\nVARIABLE KEY_NO_2 VARCHAR2(10)\nVARIABLE KEY_NO_3 VARCHAR2(10)\n\nEXECUTE :KEY_NO_1 := 1\nEXECUTE :KEY_NO_2 := 2\nEXECUTE :KEY_NO_3 := 0\n\n------------------------------------------------------------\n@setColumns.SQL\n------------------------------------------------------------\n-- \u3053\u3053\u304b\u3089\uff1a\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u8a2d\u5b9a START\n------------------------------------------------------------\nVARIABLE BASEPATH VARCHAR2(50)\nEXECUTE :BASEPATH := 'LOCAL'\n\nSET VERIFY OFF\nSET TIMING OFF\nSET HEADING ON\n\nCOLUMN baseworkpath NEW_VALUE base_path NOPRINT\nSELECT :BASEPATH baseworkpath FROM DUAL;\n\n------------------------------------------------------------\n-- createWorkPath.bat\n------------------------------------------------------------\n-- @if (1==1) /*\n-- @ECHO OFF\n-- \n-- ECHO  %1\n-- \n-- CScript //Nologo //E:JScript \"%~f0\" %1\n-- \n-- EXIT /B 0\n-- \n-- rem */\n-- \n-- @end\n-- \n-- getYYYYMMDD = function() {\n--     var dd = new Date();\n--     var yy = dd.getYear();\n--     var mm = dd.getMonth() + 1;\n--     var dd = dd.getDate();\n--     if (yy < 2000) { yy += 1900; }\n--     if (mm < 10) { mm = \"0\" + mm; }\n--     if (dd < 10) { dd = \"0\" + dd; }\n--     \n--     return ( \"\" + yy ) + ( \"\" + mm ) + ( \"\" + dd ) ;\n-- }\n-- \n-- captureWorkFolder = function(argc, argv) {\n--   var FSO = new ActiveXObject(\"Scripting.FileSystemObject\");\n--   \n--   var workBasePath = argv(0);\n--   \n--   if ( !FSO.FolderExists(workBasePath) ) {\n--     FSO.CreateFolder(workBasePath);\n--   }\n--   \n--   var workPath = workBasePath + \"\\\\\" + getYYYYMMDD();\n--   \n--   if ( !FSO.FolderExists(workPath) ) {\n--     FSO.CreateFolder(workPath);\n--   }\n--   \n--   FSO = null;\n-- }\n-- \n-- captureWorkFolder(WScript.arguments.length, WScript.arguments)\n------------------------------------------------------------\n\nHOST createWorkPath.bat &base_path.\n\nVARIABLE w_RESULT_FILE VARCHAR2(420)\nDECLARE\n\tw_DBDAY   NUMBER := 0; -- 220;\n\tw_PATH    VARCHAR2(200) := '.\\' || :BASEPATH || '\\'  ||TO_CHAR(SYSDATE - w_DBDAY, 'YYYYMMDD') ;\n\tw_TIME    VARCHAR2( 20) := TO_CHAR(SYSDATE - w_DBDAY, 'YYMMDD_HH24MISS');\n\tw_PREFIX  VARCHAR2(200) := 'PREFIX_';\n\tw_NOS     VARCHAR2(200) := :KEY_NO_3 || '_' || :KEY_NO_1 || '_' || :KEY_NO_2;\nBEGIN\n\t:w_RESULT_FILE := w_PATH || '\\' || w_PREFIX || w_TIME || '_' || w_NOS || '.xls';\nEND;\n/\n\n--SET PAGESIZE 0\nCOLUMN runtime NEW_VALUE runtime_text NOPRINT\nSELECT :w_RESULT_FILE RUNTIME FROM DUAL;\n\nSET  SERVEROUTPUT ON SIZE UNLIMITED\n\nSET TRIMSPOOL ON\nSPOOL &runtime_text.\n\n------------------------------------------------------------\n-- \u3053\u3053\u307e\u3067\uff1a\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u8a2d\u5b9a START\n------------------------------------------------------------\n\n--------------------------------------------------------------------------------\n-- TBL_NAME1\n--------------------------------------------------------------------------------\n\tSET MARKUP HTML ENTMAP OFF\n\tPROMPT <BR><SPAN>\u3010\u30b5\u30d6\u30c6\u30fc\u30d6\u30eb TBL_NAME1\u3011</SPAN>\n\tSET MARKUP HTML ENTMAP ON\n\tSELECT * FROM TBL_NAME1  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO_3 = ME.KEY_NO_3 AND S.KEY_NO2 IN (:KEY_NO_1,:KEY_NO_2))\n\tUNION\n\tSELECT * FROM TBL_NAME1  ME  WHERE ME.KEY_NO_3 = :KEY_NO_3;\n\t\n\t\n\t\n\tSET MARKUP HTML ENTMAP OFF\n\tPROMPT <BR><SPAN>\u3010\u30e1\u30a4\u30f3\u30c6\u30fc\u30d6\u30eb TBL_NAME0\u3011</SPAN>\n\tSET MARKUP HTML ENTMAP ON\n\tSELECT * FROM TBL_NAME0  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO = ME.KEY_NO AND S.KEY_NO2 IN (:KEY_NO_1,:KEY_NO_2))\n\tUNION\n\tSELECT * FROM TBL_NAME0  ME  WHERE EXISTS (SELECT 1 FROM TBL_NAME2 S WHERE S.KEY_NO = ME.KEY_NO AND S.KEY_NO_3 = :KEY_NO_3) ORDER BY 1, 2;\n\t\nSPOOL OFF\nSET MARKUP HTML OFF SPOOL OFF\nSET TERMOUT ON\n\nhost start &runtime_text.\n\nEXIT;\n\n```\n"}