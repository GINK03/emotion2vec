{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nnginx\u306e\u30ed\u30b0\u3092rsyslog\u3067\u8ee2\u9001\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\nnginx1.7.1\u304b\u3089access_log\u53ca\u3073error_log\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u304csyslog\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\u3002\nCHANGES\n\nChanges with nginx 1.7.1                                         > 27 May 2014\n*) Feature: the \"error_log\" and \"access_log\" directives now > support\n   logging to syslog.\n\n\n\n\u74b0\u5883\n\nAmazon Linux AMI release 2014.03\nnginx 1.7.4\nrsyslog 5.8.10\n\n\nnginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo yum install gcc make pcre-devel zlib-devel openssl-devel\n\n$ wget http://nginx.org/download/nginx-1.7.4.tar.gz\n$ tar zxvf nginx-1.7.4.tar.gz\n$ cd nginx-1.7.4\n$ ./configure\n\n...(\u7701\u7565)...\n\nConfiguration summary\n+ using system PCRE library\n+ OpenSSL library is not used\n+ md5: using system crypto library\n+ sha1: using system crypto library\n+ using system zlib library\n\nnginx path prefix: \"/usr/local/nginx\"\nnginx binary file: \"/usr/local/nginx/sbin/nginx\"\nnginx configuration prefix: \"/usr/local/nginx/conf\"\nnginx configuration file: \"/usr/local/nginx/conf/nginx.conf\"\nnginx pid file: \"/usr/local/nginx/logs/nginx.pid\"\nnginx error log file: \"/usr/local/nginx/logs/error.log\"\nnginx http access log file: \"/usr/local/nginx/logs/access.log\"\nnginx http client request body temporary files: \"client_body_temp\"\nnginx http proxy temporary files: \"proxy_temp\"\nnginx http fastcgi temporary files: \"fastcgi_temp\"\nnginx http uwsgi temporary files: \"uwsgi_temp\"\nnginx http scgi temporary files: \"scgi_temp\"\n\n$ make\n$ sudo make install\n\n\nsyslog\u8ee2\u9001\u306e\u8a2d\u5b9a\nnginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092 local5 \u306e info \u30ec\u30d9\u30eb\u3067\u51fa\u529b\u3057\u307e\u3059\u3002\n\n/usr/local/nginx/conf/nginx.conf\nhttp {\n\n...(\u7701\u7565)...\n\nlog_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\naccess_log  syslog:server=127.0.0.1,facility=local5,severity=info  main;\n\n...(\u7701\u7565)...\n\n# Log anything (except mail) of level info or higher.\n# Don't log private authentication messages!\n#*.info;mail.none;authpriv.none;cron.none                /var/log/messages\n*.info;mail.none;authpriv.none;cron.none;local5.none                /var/log/messages\n\n}\n\n\nnginx\u306e\u30ed\u30b0\u304c/var/log/messages\u306b\u8a18\u9332\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u3001 \u300clocal5.none\u300d \u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nrsyslog\u306e\u53d7\u4fe1\u8a2d\u5b9a\nnginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092/var/log/nginx_access_log\u3078\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/rsyslog.conf\n#Provides UDP syslog reception\n$ModLoad imudp\n$UDPServerRun 514\n\n$AllowedSender UDP, 127.0.0.1\n\n\n\n/etc/rsyslog.d/nginx.conf\nlocal5.info    /var/log/nginx_access_log\n\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u3001rsyslog\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo /etc/init.d/rsyslog restart\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nnginx\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo /usr/local/nginx/sbin/nginx\n\nindex\u30da\u30fc\u30b8\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n$ curl -I http://127.0.0.1/\nHTTP/1.1 200 OK\nServer: nginx/1.7.4\nDate: Thu, 28 Aug 2014 14:58:27 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Thu, 28 Aug 2014 14:08:10 GMT\nConnection: keep-alive\nETag: \"53ff37ca-264\"\nAccept-Ranges: bytes\n\n-I\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3001\u30d8\u30c3\u30c0\u30fc\u306e\u307f\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u51fa\u529b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n/var/log/nginx_access_log\nAug 28 14:58:27 ip-10-250-0-21 nginx: 127.0.0.1 - - [28/Aug/2014:14:58:27 +0000] \"HEAD / HTTP/1.1\" 200 0 \"-\" \"curl/7.36.0\" \"-\"\n\n\n\n\u53c2\u8003\n\nnginx\u306e\u5909\u66f4\u5c65\u6b74\nBuilding nginx from Sources\nModule ngx_http_log_module\nimudp: UDP Syslog Input Module\nDirectives affecting Input Modules\n\n\n## \u306f\u3058\u3081\u306b\n\nnginx\u306e\u30ed\u30b0\u3092rsyslog\u3067\u8ee2\u9001\u3059\u308b\u65b9\u6cd5\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nnginx1.7.1\u304b\u3089access_log\u53ca\u3073error_log\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u304csyslog\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\u3002\n\n[CHANGES]\n(http://nginx.org/en/CHANGES)\n\n> Changes with nginx 1.7.1                                         > 27 May 2014\n>\n>     *) Feature: the \"error_log\" and \"access_log\" directives now > support\n>        logging to syslog.\n> \n\n\n## \u74b0\u5883\n\n* Amazon Linux AMI release 2014.03\n* nginx 1.7.4\n* rsyslog 5.8.10\n\n## nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```shell\n$ sudo yum install gcc make pcre-devel zlib-devel openssl-devel\n```\n\n```shell\n$ wget http://nginx.org/download/nginx-1.7.4.tar.gz\n$ tar zxvf nginx-1.7.4.tar.gz\n$ cd nginx-1.7.4\n$ ./configure\n\n...(\u7701\u7565)...\n\nConfiguration summary\n+ using system PCRE library\n+ OpenSSL library is not used\n+ md5: using system crypto library\n+ sha1: using system crypto library\n+ using system zlib library\n\nnginx path prefix: \"/usr/local/nginx\"\nnginx binary file: \"/usr/local/nginx/sbin/nginx\"\nnginx configuration prefix: \"/usr/local/nginx/conf\"\nnginx configuration file: \"/usr/local/nginx/conf/nginx.conf\"\nnginx pid file: \"/usr/local/nginx/logs/nginx.pid\"\nnginx error log file: \"/usr/local/nginx/logs/error.log\"\nnginx http access log file: \"/usr/local/nginx/logs/access.log\"\nnginx http client request body temporary files: \"client_body_temp\"\nnginx http proxy temporary files: \"proxy_temp\"\nnginx http fastcgi temporary files: \"fastcgi_temp\"\nnginx http uwsgi temporary files: \"uwsgi_temp\"\nnginx http scgi temporary files: \"scgi_temp\"\n\n$ make\n$ sudo make install\n```\n\n## syslog\u8ee2\u9001\u306e\u8a2d\u5b9a\n\nnginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092 **local5** \u306e **info** \u30ec\u30d9\u30eb\u3067\u51fa\u529b\u3057\u307e\u3059\u3002\n\n```conf:/usr/local/nginx/conf/nginx.conf\nhttp {\n\n...(\u7701\u7565)...\n\nlog_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                  '$status $body_bytes_sent \"$http_referer\" '\n                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\naccess_log  syslog:server=127.0.0.1,facility=local5,severity=info  main;\n\n...(\u7701\u7565)...\n\n# Log anything (except mail) of level info or higher.\n# Don't log private authentication messages!\n#*.info;mail.none;authpriv.none;cron.none                /var/log/messages\n*.info;mail.none;authpriv.none;cron.none;local5.none                /var/log/messages\n\n}\n```\n\n__nginx\u306e\u30ed\u30b0\u304c/var/log/messages\u306b\u8a18\u9332\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u3001__ **\u300clocal5.none\u300d** __\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002__\n\n## rsyslog\u306e\u53d7\u4fe1\u8a2d\u5b9a\n\nnginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092/var/log/nginx_access_log\u3078\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```conf:/etc/rsyslog.conf\n#Provides UDP syslog reception\n$ModLoad imudp\n$UDPServerRun 514\n\n$AllowedSender UDP, 127.0.0.1\n```\n\n```conf:/etc/rsyslog.d/nginx.conf\nlocal5.info    /var/log/nginx_access_log\n```\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u3001rsyslog\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell\n$ sudo /etc/init.d/rsyslog restart\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\nnginx\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell\n$ sudo /usr/local/nginx/sbin/nginx\n```\n\nindex\u30da\u30fc\u30b8\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n```shell\n$ curl -I http://127.0.0.1/\nHTTP/1.1 200 OK\nServer: nginx/1.7.4\nDate: Thu, 28 Aug 2014 14:58:27 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Thu, 28 Aug 2014 14:08:10 GMT\nConnection: keep-alive\nETag: \"53ff37ca-264\"\nAccept-Ranges: bytes\n```\n\n___-I\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3001\u30d8\u30c3\u30c0\u30fc\u306e\u307f\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002___\n\n\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u51fa\u529b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```log:/var/log/nginx_access_log\nAug 28 14:58:27 ip-10-250-0-21 nginx: 127.0.0.1 - - [28/Aug/2014:14:58:27 +0000] \"HEAD / HTTP/1.1\" 200 0 \"-\" \"curl/7.36.0\" \"-\"\n```\n\n## \u53c2\u8003\n\n* [nginx\u306e\u5909\u66f4\u5c65\u6b74]\n(http://nginx.org/en/CHANGES)\n\n* [Building nginx from Sources]\n(http://nginx.org/en/docs/configure.html)\n\n* [Module ngx_http_log_module]\n(http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log)\n\n* [imudp: UDP Syslog Input Module]\n(http://www.rsyslog.com/doc/v5-stable/configuration/modules/imudp.html)\n\n* [Directives affecting Input Modules]\n(http://www.rsyslog.com/doc/v5-stable/configuration/input_directives/rsconf1_allowedsender.html)\n", "tags": ["nginx", "rsyslog"]}