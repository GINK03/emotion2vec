{"context": "https://doc.ez.no/display/EZP/eZ+Publish+5+Field+Type+Tutorial\n\n\u30d0\u30f3\u30c9\u30eb\u306e\u30b9\u30b1\u30eb\u30c8\u30f3\u751f\u6210\nphp ezpublish/console generate:bundle \\\n--namespace=EzSystems/TweetFieldTypeBundle \\\n--bundle-name=EzSystemsTweetFieldTypeBundle \\\n--dir=src \\\n--format=yml\n\nDo you want to generate the whole directory structure [no]? no<enter>\n\n\n\u30d0\u30f3\u30c9\u30eb\u306e\u69cb\u9020\neZ\n\u2514\u2500\u2500 Publish\n   \u2514\u2500\u2500 FieldType\n       \u2514\u2500\u2500 Tweet\n           \u251c\u2500\u2500 Type.php\n           \u2514\u2500\u2500 Value.php\n\n\nType \u30af\u30e9\u30b9\nType \u306b\u306f\u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7\u306e\u30ed\u30b8\u30c3\u30af\u304c\u542b\u307e\u308c\u308b\uff1a\u30c7\u30fc\u30bf\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3001\u3055\u307e\u3056\u307e\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304b\u3089\u306e\u5909\u63db\u3001\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u8aac\u660e...\nType \u30af\u30e9\u30b9\u306f eZ\\Publish\\SPI\\FieldType\\FieldType \u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u307e\u305f\u3001eZ\\Publish\\Core\\FieldType\\FieldType \u62bd\u8c61\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\nValue \u30af\u30e9\u30b9\nValue \u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u30a2\u30a4\u30c6\u30e0\u5185\u306e\u30bf\u30a4\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8868\u3059\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b\u3002\u5404\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Type \u306e Value \u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\u3002\nValue \u30af\u30e9\u30b9\u306f eZ\\Publish\\SPI\\FieldType\\Value \u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u307e\u305f\u3001eZ\\Publish\\Core\\FieldType\\Value \u62bd\u8c61\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\nTweet\\Value \u30af\u30e9\u30b9\u306e\u5b9f\u88c5\nFieldType \u306e Value \u30af\u30e9\u30b9\u306f\u8a2d\u8a08\u4e0a\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3042\u308b\u3002\u30b9\u30c6\u30fc\u30c8\u30ec\u30b9\u3067\u3001\u3067\u304d\u308b\u3060\u3051\u8efd\u91cf\u3067\u3042\u308b\u3053\u3068\u3092\u610f\u56f3\u3057\u3066\u3044\u308b\u3002\u5f93\u3063\u3066\u3001Type \u30af\u30e9\u30b9\u306e\u8cac\u4efb\u3068\u3057\u3066\u3001\u3053\u306e\u30af\u30e9\u30b9\u306f\u3067\u304d\u308b\u3060\u3051\u30ed\u30b8\u30c3\u30af\u3092\u542b\u307e\u306a\u3044\u3088\u3046\u306b\u3057\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044\u3002\nValue \u306b\u306f\u5c11\u306a\u304f\u3068\u3082\u4ee5\u4e0b\u304c\u542b\u307e\u308c\u308b\uff1a\n\n\u30d1\u30d6\u30ea\u30c3\u30af\u30d7\u30ed\u30d1\u30c6\u30a3\u30fc\uff08\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\uff09\n\n__toString() \u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\uff08\u7d99\u627f\u3059\u308b Value \u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3067\u5fc5\u8981\uff09\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001FieldType\\Value \u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u4f7f\u7528\u3055\u308c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3/\u5024\u306e\u30da\u30a2\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u3053\u306e\u4f8b\u3067\u306f\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nTweet FieldType \u306f3\u3064\u306e\u3082\u306e\u3092\u4fdd\u5b58\u3059\u308b\uff1a\n\n\u30c4\u30a4\u30fc\u30c8\u306e URL\n\u30c4\u30a4\u30fc\u30c8\u306e\u30aa\u30fc\u30b5\u30fc\u306e URL\n\u672c\u6587\uff08HTML \u6587\u5b57\u5217\u3068\u3057\u3066\uff09\n\n\u3053\u3053\u3067\u306f\u683c\u7d0d\u3055\u308c\u308b\u5834\u6240\u306f\u8003\u616e\u3057\u306a\u3044\u3002FieldType \u3092 API \u3068\u3057\u3066\u516c\u958b\u3059\u308b\u3053\u3068\u306e\u307f\u3002\u4ee5\u4e0b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u7d42\u308f\u308b\uff1a\n\neZ/FieldType/Tweet/Value.php\n/**\n* Tweet URL on twitter.com (http://twitter.com/UserName/status/id).\n* @var string\n*/\npublic $url;\n\n\n/**\n* Author's tweet URL (http://twitter.com/UserName)\n* @var string\n*/\npublic $authorUrl;\n\n\n/**\n* The tweet's embed HTML\n* @var string\n*/\npublic $contents;\n\n\nFieldType\\Value \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u306b\u6b8b\u308b\u306e\u306f __toString\uff08\uff09 \u30e1\u30bd\u30c3\u30c9\u306e\u307f\u3002\u30c4\u30a4\u30fc\u30c8\u306e URL \u3092\u8fd4\u305d\u3046\u3002\n\neZ/FieldType/Tweet/Value.php\npublic function __toString()\n{\n   return $this->url;\n}\n\n\n\nTweet\\Type \u30af\u30e9\u30b9\u306e\u5b9f\u88c5\n\n\u8b58\u5225\u30e1\u30bd\u30c3\u30c9: getFieldTypeIdentifier()\n\n\u3053\u306e FieldType \u3092\u4e00\u610f\u306b\u8b58\u5225\u3059\u308b\u6587\u5b57\u5217 \uff08eZ Publish 4 \u306e DataTypeString\uff09 \u3092\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\n\neZ/FieldType/Tweet/Type\npublic function getFieldTypeIdentifier()\n{\n   return 'eztweet';\n}\n\n\n\nValue \u51e6\u7406\u30e1\u30bd\u30c3\u30c9: createValueFromInput() \u3068 checkValueStructure()\n\n\u4e21\u30e1\u30bd\u30c3\u30c9\u306f acceptValue() \u306e\u62bd\u8c61 FieldType \u5b9f\u88c5\u3067\u4f7f\u308f\u308c\u308b\u3002\u3053\u306e FieldType \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30e1\u30bd\u30c3\u30c9\u306f\u3055\u307e\u3056\u307e\u306a\u5165\u529b\u5024\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001type \u81ea\u8eab\u306e Value \u30af\u30e9\u30b9 (eZ\\FieldType\\Tweet\\Value) \u306b\u5909\u63db\u3059\u308b\u3002\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306e\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u5165\u529b\u5024\u304b\u3089\u4f5c\u6210\u3067\u304d\u305f Value \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3059\n\u3053\u306e\u5024\u3092\u5909\u66f4\u3057\u306a\u3044\u3067\u8fd4\u3059\u3002 API \u306f\u3053\u308c\u3092\u691c\u51fa\u3057\u3001\u5165\u529b\u5024\u304c\u53d7\u3051\u5165\u308c\u3089\u308c\u306a\u304b\u3063\u305f\u3053\u3068\u3092\u901a\u77e5\u3059\u308b\u3002\n\n\u3053\u306e type \u306b\u8a31\u5bb9\u3055\u308c\u308b\u5024\u306f\u30c4\u30a4\u30fc\u30c8\u306e URL \u306e\u307f\u3002\nprotected function createValueFromInput( $inputValue )\n{\n   if ( is_string( $inputValue ) )\n   {\n       $inputValue = new Value( array( 'url' => $inputValue ) );\n   }\n\n   return $inputValue;\n}\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001API \u3092\u4f7f\u7528\u3057\u3066\u5c5e\u6027\u306e\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u4fbf\u5229\u306a\u65b9\u6cd5\u3092\u63d0\u4f9b\u3059\u308b\u3002\u5358\u7d14\u306a\u3082\u306e\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u307e\u3067\u4f55\u3067\u3082\u3088\u3044\u3002\n\u6b21\u306b checkValueStructure\uff08\uff09 \u3092\u5b9f\u88c5\u3059\u308b\u3002\u3053\u308c\u306f Type \u306b\u4f9b\u7d66\u3055\u308c\u308b Value \u304c\u53d7\u3051\u5165\u308c\u3089\u308c\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u305f\u3081\u306b\u62bd\u8c61 FieldType \u306b\u3088\u3063\u3066\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\u3053\u3053\u3067\u306f Tweet\\Value::$url \u304c\u6587\u5b57\u5217\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\nprotected function checkValueStructure( BaseValue $value )\n{\n   if ( !is_string( $value->url ) )\n   {\n       throw new eZ\\Publish\\Core\\Base\\Exceptions\\InvalidArgumentType(\n           '$value->url',\n           'string',\n           $value->url\n       );\n   }\n}\n\npublic function getEmptyValue()\n{\n   return new Value;\n}\n\narray(\n   'StringLengthValidator' => array(\n       'minStringLength' => 0,\n       'maxStringLength' => 100\n   )\n);\n\narray(\n   \u2018TweetAuthorValidator\u2019 => array(\n       \u2018AuthorList\u2019 => array( \u2018johndoe\u2019, \u2018janedoe\u2019 )\n   )\n);\n\npublic function validateValidatorConfiguration( $validatorConfiguration )\n{\n   $validationErrors = array();\n\n   foreach ( $validatorConfiguration as $validatorIdentifier => $constraints )\n   {\n       // Report unknown validators\n       if ( !$validatorIdentifier != 'TweetAuthorValidator' )\n       {\n           $validationErrors[] = new ValidationError( \"Validator '$validatorIdentifier' is unknown\" );\n           continue;\n       }\n\n       // Validate arguments from TweetAuthorValidator\n       if ( !isset( $constraints['AuthorList'] ) || !is_array( $constraints['AuthorList'] ) )\n       {\n           $validationErrors[] = new ValidationError( \"Missing or invalid AuthorList argument\" );\n           continue;\n       }\n\n       foreach ( $constraints['AuthorList'] as $authorName )\n       {\n           if ( !preg_match( '/^[a-z0-9_]{1,15}$/i', $authorName ) )\n           {\n               $validationErrors[] = new ValidationError( \"Invalid twitter username\" );\n           }\n       }\n   }\n\n\n   return $validationErrors;\n}\n\npublic function validate( FieldDefinition $fieldDefinition, SPIValue $fieldValue )\n{\n    $errors = array();\n\n    if ( $this->isEmptyValue( $fieldValue ) )\n    {\n        return $errors;\n    }\n\n    // Tweet Url validation\n    if ( !preg_match( '#^https?://twitter.com/([^/]+)/status/[0-9]+$#', $fieldValue->url, $m ) )\n        $errors[] = new ValidationError( \"Invalid twitter status url %url%\", null, array( $fieldValue->url ) );\n\n    $validatorConfiguration = $fieldDefinition->getValidatorConfiguration();\n    if ( isset( $validatorConfiguration['TweetAuthorValidator'] ) )\n    {\n        if ( !in_array( $m[1], $validatorConfiguration['TweetAuthorValidator']['AuthorList'] ) )\n        {\n            $errors[] = new ValidationError(\n                \"Twitter user %user% is not in the approved author list\",\n                null,\n                array( $m[1] )\n            );\n        }\n    }\n\n    return $errors;\n}\n\npublic function getName( SPIValue $value )\n{\n   return preg_replace(\n       '#^https?://twitter\\.com/([^/]+)/status/([0-9]+)$#',\n       '$1-$2',\n       (string)$value->url );\n}\n\n\nprotected function getSortInfo( CoreValue $value )\n{\n   return $this->getName( $value );\n}\n\npublic function fromHash( $hash )\n{\n   if ( $hash === null )\n   {\n       return $this->getEmptyValue();\n   }\n   return new Value( $hash );\n}\n\npublic function toHash( SPIValue $value )\n{\n   if ( $this->isEmptyValue( $value ) )\n   {\n       return null;\n   }\n   return array(\n       'url' => $value->url\n   );\n}\n\n\nTweet\\Type\n/**\n * @param \\EzSystems\\TweetFieldTypeBundle\\eZ\\Publish\\FieldType\\Tweet\\Value $value\n * @return \\eZ\\Publish\\SPI\\Persistence\\Content\\FieldValue\n */\npublic function toPersistenceValue( SPIValue $value )\n{\n    if ( $value === null )\n    {\n        return new PersistenceValue(\n            array(\n                \"data\" => null,\n                \"externalData\" => null,\n                \"sortKey\" => null,\n            )\n        );\n    }\n    return new PersistenceValue(\n        array(\n            \"data\" => $this->toHash( $value ),\n            \"sortKey\" => $this->getSortInfo( $value ),\n        )\n    );\n}\n/**\n * @param \\eZ\\Publish\\SPI\\Persistence\\Content\\FieldValue $fieldValue\n * @return \\EzSystems\\TweetFieldTypeBundle\\eZ\\Publish\\FieldType\\Tweet\\Value\n */\npublic function fromPersistenceValue( PersistenceValue $fieldValue )\n{\n    if ( $fieldValue->data === null )\n    {\n        return $this->getEmptyValue();\n    }\n    return new Value( $fieldValue->data );\n}\n\n\n\neZ/Publish/FieldType/Tweet/Type.php\nuse EzSystems\\TweetFieldTypeBundle\\Twitter\\TwitterClientInterface;\n\nclass Type extends FieldType\n{\n    /** @var TwitterClientInterface */\n    protected $twitterClient;\n\n    public function __construct( TwitterClientInterface $twitterClient )\n    {\n        $this->twitterClient = $twitterClient;\n    }\n}\n\n\n\neZ/Publish/FieldType/Tweet/Type.php\n public function toPersistenceValue( SPIValue $value )\n{\n    // if ( $value === null )\n    // {...}\n\n\n    if ( $value->contents === null )\n    {\n        $value->contents = $this->twitterClient->getEmbed( $value->url );\n    }\n    return new PersistenceValue(\n    // array(...)\n}\n\n\nhttps://doc.ez.no/display/EZP/eZ+Publish+5+Field+Type+Tutorial\n## \u30d0\u30f3\u30c9\u30eb\u306e\u30b9\u30b1\u30eb\u30c8\u30f3\u751f\u6210\n```\nphp ezpublish/console generate:bundle \\\n--namespace=EzSystems/TweetFieldTypeBundle \\\n--bundle-name=EzSystemsTweetFieldTypeBundle \\\n--dir=src \\\n--format=yml\n```\n```\nDo you want to generate the whole directory structure [no]? no<enter>\n```\n\n## \u30d0\u30f3\u30c9\u30eb\u306e\u69cb\u9020\n```\neZ\n\u2514\u2500\u2500 Publish\n   \u2514\u2500\u2500 FieldType\n       \u2514\u2500\u2500 Tweet\n           \u251c\u2500\u2500 Type.php\n           \u2514\u2500\u2500 Value.php\n```\n### Type \u30af\u30e9\u30b9\nType \u306b\u306f\u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7\u306e\u30ed\u30b8\u30c3\u30af\u304c\u542b\u307e\u308c\u308b\uff1a\u30c7\u30fc\u30bf\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3001\u3055\u307e\u3056\u307e\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304b\u3089\u306e\u5909\u63db\u3001\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u8aac\u660e...\nType \u30af\u30e9\u30b9\u306f `eZ\\Publish\\SPI\\FieldType\\FieldType` \u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u307e\u305f\u3001`eZ\\Publish\\Core\\FieldType\\FieldType` \u62bd\u8c61\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\n### Value \u30af\u30e9\u30b9\nValue \u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u30a2\u30a4\u30c6\u30e0\u5185\u306e\u30bf\u30a4\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8868\u3059\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b\u3002\u5404\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Type \u306e Value \u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\u3002\nValue \u30af\u30e9\u30b9\u306f `eZ\\Publish\\SPI\\FieldType\\Value` \u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u307e\u305f\u3001`eZ\\Publish\\Core\\FieldType\\Value` \u62bd\u8c61\u30af\u30e9\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\n\n## Tweet\\Value \u30af\u30e9\u30b9\u306e\u5b9f\u88c5\n\nFieldType \u306e Value \u30af\u30e9\u30b9\u306f\u8a2d\u8a08\u4e0a\u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3042\u308b\u3002\u30b9\u30c6\u30fc\u30c8\u30ec\u30b9\u3067\u3001\u3067\u304d\u308b\u3060\u3051\u8efd\u91cf\u3067\u3042\u308b\u3053\u3068\u3092\u610f\u56f3\u3057\u3066\u3044\u308b\u3002\u5f93\u3063\u3066\u3001Type \u30af\u30e9\u30b9\u306e\u8cac\u4efb\u3068\u3057\u3066\u3001\u3053\u306e\u30af\u30e9\u30b9\u306f\u3067\u304d\u308b\u3060\u3051\u30ed\u30b8\u30c3\u30af\u3092\u542b\u307e\u306a\u3044\u3088\u3046\u306b\u3057\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044\u3002\n\nValue \u306b\u306f\u5c11\u306a\u304f\u3068\u3082\u4ee5\u4e0b\u304c\u542b\u307e\u308c\u308b\uff1a\n\n* \u30d1\u30d6\u30ea\u30c3\u30af\u30d7\u30ed\u30d1\u30c6\u30a3\u30fc\uff08\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\uff09\n* `__toString()` \u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\uff08\u7d99\u627f\u3059\u308b Value \u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3067\u5fc5\u8981\uff09\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001`FieldType\\Value` \u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u4f7f\u7528\u3055\u308c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3/\u5024\u306e\u30da\u30a2\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u3053\u306e\u4f8b\u3067\u306f\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nTweet FieldType \u306f3\u3064\u306e\u3082\u306e\u3092\u4fdd\u5b58\u3059\u308b\uff1a\n\n* \u30c4\u30a4\u30fc\u30c8\u306e URL\n* \u30c4\u30a4\u30fc\u30c8\u306e\u30aa\u30fc\u30b5\u30fc\u306e URL\n* \u672c\u6587\uff08HTML \u6587\u5b57\u5217\u3068\u3057\u3066\uff09\n\n\u3053\u3053\u3067\u306f\u683c\u7d0d\u3055\u308c\u308b\u5834\u6240\u306f\u8003\u616e\u3057\u306a\u3044\u3002FieldType \u3092 API \u3068\u3057\u3066\u516c\u958b\u3059\u308b\u3053\u3068\u306e\u307f\u3002\u4ee5\u4e0b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u7d42\u308f\u308b\uff1a\n\n```php:eZ/FieldType/Tweet/Value.php\n/**\n* Tweet URL on twitter.com (http://twitter.com/UserName/status/id).\n* @var string\n*/\npublic $url;\n \n  \n/**\n* Author's tweet URL (http://twitter.com/UserName)\n* @var string\n*/\npublic $authorUrl;\n \n  \n/**\n* The tweet's embed HTML\n* @var string\n*/\npublic $contents;\n```\n\n`FieldType\\Value` \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u306b\u6b8b\u308b\u306e\u306f `__toString\uff08\uff09` \u30e1\u30bd\u30c3\u30c9\u306e\u307f\u3002\u30c4\u30a4\u30fc\u30c8\u306e URL \u3092\u8fd4\u305d\u3046\u3002\n\n```php:eZ/FieldType/Tweet/Value.php\npublic function __toString()\n{\n   return $this->url;\n}\n```\n\n## Tweet\\Type \u30af\u30e9\u30b9\u306e\u5b9f\u88c5\n\n### \u8b58\u5225\u30e1\u30bd\u30c3\u30c9: `getFieldTypeIdentifier()`\n\u3053\u306e FieldType \u3092\u4e00\u610f\u306b\u8b58\u5225\u3059\u308b\u6587\u5b57\u5217 \uff08eZ Publish 4 \u306e DataTypeString\uff09 \u3092\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```php:eZ/FieldType/Tweet/Type\npublic function getFieldTypeIdentifier()\n{\n   return 'eztweet';\n}\n```\n\n### Value \u51e6\u7406\u30e1\u30bd\u30c3\u30c9: `createValueFromInput()` \u3068 `checkValueStructure()`\n\n\u4e21\u30e1\u30bd\u30c3\u30c9\u306f `acceptValue()` \u306e\u62bd\u8c61 FieldType \u5b9f\u88c5\u3067\u4f7f\u308f\u308c\u308b\u3002\u3053\u306e FieldType \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30e1\u30bd\u30c3\u30c9\u306f\u3055\u307e\u3056\u307e\u306a\u5165\u529b\u5024\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001type \u81ea\u8eab\u306e Value \u30af\u30e9\u30b9 (`eZ\\FieldType\\Tweet\\Value`) \u306b\u5909\u63db\u3059\u308b\u3002\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306e\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n* \u5165\u529b\u5024\u304b\u3089\u4f5c\u6210\u3067\u304d\u305f Value \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3059\n* \u3053\u306e\u5024\u3092\u5909\u66f4\u3057\u306a\u3044\u3067\u8fd4\u3059\u3002 API \u306f\u3053\u308c\u3092\u691c\u51fa\u3057\u3001\u5165\u529b\u5024\u304c\u53d7\u3051\u5165\u308c\u3089\u308c\u306a\u304b\u3063\u305f\u3053\u3068\u3092\u901a\u77e5\u3059\u308b\u3002\n\n\u3053\u306e type \u306b\u8a31\u5bb9\u3055\u308c\u308b\u5024\u306f\u30c4\u30a4\u30fc\u30c8\u306e URL \u306e\u307f\u3002\n\n```php\nprotected function createValueFromInput( $inputValue )\n{\n   if ( is_string( $inputValue ) )\n   {\n       $inputValue = new Value( array( 'url' => $inputValue ) );\n   }\n \n   return $inputValue;\n}\n```\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001API \u3092\u4f7f\u7528\u3057\u3066\u5c5e\u6027\u306e\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u4fbf\u5229\u306a\u65b9\u6cd5\u3092\u63d0\u4f9b\u3059\u308b\u3002\u5358\u7d14\u306a\u3082\u306e\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u307e\u3067\u4f55\u3067\u3082\u3088\u3044\u3002\n\n\u6b21\u306b `checkValueStructure\uff08\uff09` \u3092\u5b9f\u88c5\u3059\u308b\u3002\u3053\u308c\u306f Type \u306b\u4f9b\u7d66\u3055\u308c\u308b Value \u304c\u53d7\u3051\u5165\u308c\u3089\u308c\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u305f\u3081\u306b\u62bd\u8c61 FieldType \u306b\u3088\u3063\u3066\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\u3053\u3053\u3067\u306f `Tweet\\Value::$url` \u304c\u6587\u5b57\u5217\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```php\nprotected function checkValueStructure( BaseValue $value )\n{\n   if ( !is_string( $value->url ) )\n   {\n       throw new eZ\\Publish\\Core\\Base\\Exceptions\\InvalidArgumentType(\n           '$value->url',\n           'string',\n           $value->url\n       );\n   }\n}\n```\n```php\npublic function getEmptyValue()\n{\n   return new Value;\n}\n```\n```php\narray(\n   'StringLengthValidator' => array(\n       'minStringLength' => 0,\n       'maxStringLength' => 100\n   )\n);\n```\n```php\narray(\n   \u2018TweetAuthorValidator\u2019 => array(\n       \u2018AuthorList\u2019 => array( \u2018johndoe\u2019, \u2018janedoe\u2019 )\n   )\n);\n```\n```php\npublic function validateValidatorConfiguration( $validatorConfiguration )\n{\n   $validationErrors = array();\n \n   foreach ( $validatorConfiguration as $validatorIdentifier => $constraints )\n   {\n       // Report unknown validators\n       if ( !$validatorIdentifier != 'TweetAuthorValidator' )\n       {\n           $validationErrors[] = new ValidationError( \"Validator '$validatorIdentifier' is unknown\" );\n           continue;\n       }\n \n       // Validate arguments from TweetAuthorValidator\n       if ( !isset( $constraints['AuthorList'] ) || !is_array( $constraints['AuthorList'] ) )\n       {\n           $validationErrors[] = new ValidationError( \"Missing or invalid AuthorList argument\" );\n           continue;\n       }\n \n       foreach ( $constraints['AuthorList'] as $authorName )\n       {\n           if ( !preg_match( '/^[a-z0-9_]{1,15}$/i', $authorName ) )\n           {\n               $validationErrors[] = new ValidationError( \"Invalid twitter username\" );\n           }\n       }\n   }\n \n \n   return $validationErrors;\n}\n```\n```php\npublic function validate( FieldDefinition $fieldDefinition, SPIValue $fieldValue )\n{\n    $errors = array();\n \n    if ( $this->isEmptyValue( $fieldValue ) )\n    {\n        return $errors;\n    }\n \n    // Tweet Url validation\n    if ( !preg_match( '#^https?://twitter.com/([^/]+)/status/[0-9]+$#', $fieldValue->url, $m ) )\n        $errors[] = new ValidationError( \"Invalid twitter status url %url%\", null, array( $fieldValue->url ) );\n \n    $validatorConfiguration = $fieldDefinition->getValidatorConfiguration();\n    if ( isset( $validatorConfiguration['TweetAuthorValidator'] ) )\n    {\n        if ( !in_array( $m[1], $validatorConfiguration['TweetAuthorValidator']['AuthorList'] ) )\n        {\n            $errors[] = new ValidationError(\n                \"Twitter user %user% is not in the approved author list\",\n                null,\n                array( $m[1] )\n            );\n        }\n    }\n \n    return $errors;\n}\n```\n```php\npublic function getName( SPIValue $value )\n{\n   return preg_replace(\n       '#^https?://twitter\\.com/([^/]+)/status/([0-9]+)$#',\n       '$1-$2',\n       (string)$value->url );\n}\n \n \nprotected function getSortInfo( CoreValue $value )\n{\n   return $this->getName( $value );\n}\n```\n```php\npublic function fromHash( $hash )\n{\n   if ( $hash === null )\n   {\n       return $this->getEmptyValue();\n   }\n   return new Value( $hash );\n}\n \npublic function toHash( SPIValue $value )\n{\n   if ( $this->isEmptyValue( $value ) )\n   {\n       return null;\n   }\n   return array(\n       'url' => $value->url\n   );\n}\n```\n```php:Tweet\\Type\n/**\n * @param \\EzSystems\\TweetFieldTypeBundle\\eZ\\Publish\\FieldType\\Tweet\\Value $value\n * @return \\eZ\\Publish\\SPI\\Persistence\\Content\\FieldValue\n */\npublic function toPersistenceValue( SPIValue $value )\n{\n    if ( $value === null )\n    {\n        return new PersistenceValue(\n            array(\n                \"data\" => null,\n                \"externalData\" => null,\n                \"sortKey\" => null,\n            )\n        );\n    }\n    return new PersistenceValue(\n        array(\n            \"data\" => $this->toHash( $value ),\n            \"sortKey\" => $this->getSortInfo( $value ),\n        )\n    );\n}\n/**\n * @param \\eZ\\Publish\\SPI\\Persistence\\Content\\FieldValue $fieldValue\n * @return \\EzSystems\\TweetFieldTypeBundle\\eZ\\Publish\\FieldType\\Tweet\\Value\n */\npublic function fromPersistenceValue( PersistenceValue $fieldValue )\n{\n    if ( $fieldValue->data === null )\n    {\n        return $this->getEmptyValue();\n    }\n    return new Value( $fieldValue->data );\n}\n```\n```php:eZ/Publish/FieldType/Tweet/Type.php:\nuse EzSystems\\TweetFieldTypeBundle\\Twitter\\TwitterClientInterface;\n \nclass Type extends FieldType\n{\n    /** @var TwitterClientInterface */\n    protected $twitterClient;\n \n    public function __construct( TwitterClientInterface $twitterClient )\n    {\n        $this->twitterClient = $twitterClient;\n    }\n}\n```\n```php:eZ/Publish/FieldType/Tweet/Type.php\n public function toPersistenceValue( SPIValue $value )\n{\n    // if ( $value === null )\n    // {...}\n \n \n    if ( $value->contents === null )\n    {\n        $value->contents = $this->twitterClient->getEmbed( $value->url );\n    }\n    return new PersistenceValue(\n    // array(...)\n}\n```\n", "tags": ["eZPublish5.x"]}