{"context": "\n\nWhat\nSolutionStack: 64bit Amazon Linux 2016.03 v2.1.3 running Ruby 2.3 (Puma)\u306e\u5834\u5408\n\nWhere\nnginx\u7528\u306e\u8a2d\u5b9a\u306f\u30d5\u30a1\u30a4\u30eb\u306f/etc/nginx/conf.d/webapp_healthd.conf\u3060\u3051\u3069\u3001\u3053\u3044\u3064\u306fsymlink\u306a\u306e\u3067\u3001\u5b9f\u4f53\u306f/opt/elasticbeanstalk/support/conf/webapp_healthd.conf\n\nHow\n.ebextensions\u3092\u4f7f\u3046\n\n.ebextensions/nginx.config\ncommands:\n  01_nginx_status:\n    command: |\n      sed -i -e ':loop; N; $!b loop; ;s/r healthd;\\n\\n  location \\/ {/r healthd;\\n\\n  location  \\/nginx_status {\\n    stub_status on;\\n    access_log off;\\n    allow 127.0.0.1;\\n    deny all;\\n  }\\n\\n  location \\/ {/g' /opt/elasticbeanstalk/support/conf/webapp_healthd.conf\n\n\n\n\u3053\u308c\u304c\n\n/opt/elasticbeanstalk/support/conf/webapp_healthd.conf\n  access_log  /var/log/nginx/access.log  main;\n  access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;\n\n  location / {\n    proxy_pass http://my_app; # match the name of upstream directive which is defined above\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n\n\n\u3053\u3046\u306a\u308b\n\n/opt/elasticbeanstalk/support/conf/webapp_healthd.conf\n  access_log  /var/log/nginx/access.log  main;\n  access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;\n\n  location  /nginx_status \n    stub_status on;\n    access_log off;\n    allow 127.0.0.1;\n    deny all;\n  }\n\n  location / {\n    proxy_pass http://my_app; # match the name of upstream directive which is defined above\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n\n\u3042\u308b\u7a0b\u5ea6\u51aa\u7b49\u6027\u3092\u8003\u616e\u3057\u3066\u308b\u306e\u3067\u3001\u6bce\u56de\u5b9f\u884c\u3055\u308c\u3066\u3082\u554f\u984c\u306a\u3044\u3002\n# What\nSolutionStack: `64bit Amazon Linux 2016.03 v2.1.3 running Ruby 2.3 (Puma)`\u306e\u5834\u5408\n\n# Where\nnginx\u7528\u306e\u8a2d\u5b9a\u306f\u30d5\u30a1\u30a4\u30eb\u306f`/etc/nginx/conf.d/webapp_healthd.conf`\u3060\u3051\u3069\u3001\u3053\u3044\u3064\u306fsymlink\u306a\u306e\u3067\u3001\u5b9f\u4f53\u306f`/opt/elasticbeanstalk/support/conf/webapp_healthd.conf `\n\n# How\n\n`.ebextensions`\u3092\u4f7f\u3046\n\n```yaml:.ebextensions/nginx.config\ncommands:\n  01_nginx_status:\n    command: |\n      sed -i -e ':loop; N; $!b loop; ;s/r healthd;\\n\\n  location \\/ {/r healthd;\\n\\n  location  \\/nginx_status {\\n    stub_status on;\\n    access_log off;\\n    allow 127.0.0.1;\\n    deny all;\\n  }\\n\\n  location \\/ {/g' /opt/elasticbeanstalk/support/conf/webapp_healthd.conf\n\n```\n\n\u3053\u308c\u304c\n\n```nginx:/opt/elasticbeanstalk/support/conf/webapp_healthd.conf \n  access_log  /var/log/nginx/access.log  main;\n  access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;\n\n  location / {\n    proxy_pass http://my_app; # match the name of upstream directive which is defined above\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n\n```\n\n\u3053\u3046\u306a\u308b\n\n```nginx:/opt/elasticbeanstalk/support/conf/webapp_healthd.conf \n  access_log  /var/log/nginx/access.log  main;\n  access_log /var/log/nginx/healthd/application.log.$year-$month-$day-$hour healthd;\n\n  location  /nginx_status \n    stub_status on;\n    access_log off;\n    allow 127.0.0.1;\n    deny all;\n  }\n\n  location / {\n    proxy_pass http://my_app; # match the name of upstream directive which is defined above\n    proxy_set_header Host $host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  }\n```\n\n\u3042\u308b\u7a0b\u5ea6\u51aa\u7b49\u6027\u3092\u8003\u616e\u3057\u3066\u308b\u306e\u3067\u3001\u6bce\u56de\u5b9f\u884c\u3055\u308c\u3066\u3082\u554f\u984c\u306a\u3044\u3002\n", "tags": ["AWS", "ElasticBeanstalk", "nginx"]}