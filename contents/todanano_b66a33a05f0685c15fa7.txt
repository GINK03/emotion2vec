{"tags": ["C", "C\u8a00\u8a9e"], "context": " More than 1 year has passed since last update.\ntest.cpp\n\n#include <stdio.h>\n#include <arpa/inet.h>\n#include <errno.h>\n#include <string.h>\n\n#include <string>\n\nstd::string compress_ipv6( std::string ip ) {\n\n    if( ip.empty() ) {\n\n        return( \"\" );\n\n    }\n\n    unsigned char buf[sizeof(struct in6_addr)] = \"\";\n    int domain;\n    int s;\n    char str[INET6_ADDRSTRLEN] = \"\";\n\n    domain = AF_INET6;\n\n    s = inet_pton( domain, ip.c_str(), buf );\n\n    if( s <= 0 ) {\n\n        if( s == 0 ) {\n\n            fprintf( stderr, \"Not in presentation format. %s\\n\", ip.c_str() );\n            return( \"\" );\n\n        } else {\n\n            fprintf( stderr, \"inet_pton failed. %s\\n\", strerror( errno ) );\n            return( \"\" );\n\n        }\n\n    }\n\n    if( inet_ntop( domain, buf, str, INET6_ADDRSTRLEN ) == NULL ) {\n\n        fprintf( stderr, \"inet_ntop failed. %s\\n\", strerror( errno ) );\n        return( \"\" );\n\n    }\n\n    return( str );\n\n}\n\nint main( int argc, char **argv ) {\n\n    if( argc != 2 ) {\n\n        return( 1 );\n\n    }\n\n    std::string ret = compress_ipv6( argv[1] );\n\n    if( ! ret.empty() ) {\n\n        printf( \"%s\\n\", ret.c_str() );\n\n    }\n\n    return( 0 );\n\n}\n\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\n[todanano@localhost test]$ g++ -o test.o test.cpp\n\n\u5b9f\u884c\n[todanano@localhost test]$ ./test.o 2001:0db8:0020:0003:1000:0100:0020:0003\n2001:db8:20:3:1000:100:20:3\n[todanano@localhost test]$\n[todanano@localhost test]$ ./test.o aaaa\nNot in presentation format. aaaa\n[todanano@localhost test]$\n[todanano@localhost test]$\n\n\n```cpp:test.cpp\n\n#include <stdio.h>\n#include <arpa/inet.h>\n#include <errno.h>\n#include <string.h>\n\n#include <string>\n\nstd::string compress_ipv6( std::string ip ) {\n\t\n\tif( ip.empty() ) {\n\t\t\n\t\treturn( \"\" );\n\t\t\n\t}\n\t\n\tunsigned char buf[sizeof(struct in6_addr)] = \"\";\n\tint domain;\n\tint s;\n\tchar str[INET6_ADDRSTRLEN] = \"\";\n\n\tdomain = AF_INET6;\n\n\ts = inet_pton( domain, ip.c_str(), buf );\n\t\n\tif( s <= 0 ) {\n\t\t\n\t\tif( s == 0 ) {\n\t\t\t\n\t\t\tfprintf( stderr, \"Not in presentation format. %s\\n\", ip.c_str() );\n\t\t\treturn( \"\" );\n\t\t\t\n\t\t} else {\n\t\t\t\n\t\t\tfprintf( stderr, \"inet_pton failed. %s\\n\", strerror( errno ) );\n\t\t\treturn( \"\" );\n\t\t\t\n\t\t}\n\t\t\n\t}\n\t\n\tif( inet_ntop( domain, buf, str, INET6_ADDRSTRLEN ) == NULL ) {\n\t\t\n\t\tfprintf( stderr, \"inet_ntop failed. %s\\n\", strerror( errno ) );\n\t\treturn( \"\" );\n\t\t\n\t}\n\t\n\treturn( str );\n\t\n}\n\nint main( int argc, char **argv ) {\n\t\n\tif( argc != 2 ) {\n\t\t\n\t\treturn( 1 );\n\t\t\n\t}\n\t\n\tstd::string ret = compress_ipv6( argv[1] );\n\t\n\tif( ! ret.empty() ) {\n\t\t\n\t\tprintf( \"%s\\n\", ret.c_str() );\n\t\t\n\t}\n\t\n\treturn( 0 );\n\t\n}\n\n```\n\n<pre>\n\u30b3\u30f3\u30d1\u30a4\u30eb\n[todanano@localhost test]$ g++ -o test.o test.cpp\n\n\u5b9f\u884c\n[todanano@localhost test]$ ./test.o 2001:0db8:0020:0003:1000:0100:0020:0003\n2001:db8:20:3:1000:100:20:3\n[todanano@localhost test]$\n[todanano@localhost test]$ ./test.o aaaa\nNot in presentation format. aaaa\n[todanano@localhost test]$\n[todanano@localhost test]$\n</pre>\n"}