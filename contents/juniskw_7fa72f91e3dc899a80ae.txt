{"context": " More than 1 year has passed since last update.Javascript\u3067POST\u3057\u3088\u3046\u3068\u3059\u308b\u3068Django\u306eCSRF\u5bfe\u7b56\u306b\u5f15\u3063\u304b\u304b\u308a\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3060\u304c\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3061\u3083\u3093\u3068\u5bfe\u7b56\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\nhttp://docs.djangoproject.jp/en/latest/ref/contrib/csrf.html?highlight=csrf#ajax\n\u306a\u304a\u3001\u4f7f\u3044\u56de\u305b\u308b\u3088\u3046\u306b\u30b3\u30d4\u30da\u3057\u305f\u3082\u306e\u3092Github\u306b\u4e0a\u3052\u305f\u306e\u3067\u4f7f\u3044\u305f\u3044\u65b9\u306f\u3069\u3046\u305e\u3002\nhttps://github.com/juniskw/django_tools/blob/master/csrf_token_ajax.js\n\n\u4f8b\uff1aPOST\u3057\u305f\u6587\u5b57\u306b\u300c\uff01\uff01\uff01\u300d\u3092\u4ed8\u3051\u3066\u30a2\u30e9\u30fc\u30c8\u3059\u308b\u30a2\u30d7\u30ea\u3002\n\nsurprise.html\n<head>\n    <script type=\"text/javascript\" src=\"{{STATIC_URL}}js/jquery-1.11.0.min.js\"></script>\n    <script type=\"text/javascript\" src=\"https://raw.githubusercontent.com/juniskw/django_tools/master/csrf_token_ajax.js\"></script>\n</head>\n<body>\n    <h1>Let's Surprise!</h1>\n    <form id=\"surprise_fm\" action=\"surprise/\" method=\"post\">\n        <input id=\"your_txt\" type=\"text\" name=\"your_txt\">\n        <input id=\"surprise_btn\" type=\"submit\">\n    </form>\n</body>\n<script>\n$(document).ready(function() {\n    $('#surprise_fm').submit(function() {  // \u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3067AJAX\n        $.ajax({\n            'url':$('form#surprise_fm').attr('action'),\n            'type':'POST',\n            'data':{\n                'your_txt':$('#your_txt').val(),\n            },\n            'dataType':'json',\n            'success':function(response){  // \u901a\u4fe1\u304c\u6210\u529f\u3057\u305f\u3089\u52d5\u304f\u51e6\u7406\u3067\u3001\u5f15\u6570\u306b\u306f\u8fd4\u3063\u3066\u304d\u305f\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u5165\u308b\n                alert(response.your_surprise_txt);  // \u30ec\u30b9\u30dd\u30f3\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3066\u30a2\u30e9\u30fc\u30c8\n            },\n        });\n        return false;\n    });\n});\n</script>\n\n\nurls.py\n#...\nurl(r'^surprise/', 'views.for_ajax'),\n#...\n\n\nviews.py\ndef for_view(req):    # \u30d3\u30e5\u30fc\u3092\u8868\u793a\u3059\u308b\u95a2\u6570\n    return render(req,'surprise.html')\n\ndef for_ajax(req):    # AJAX\u306b\u7b54\u3048\u308b\u95a2\u6570\n    import json\n    from django.http import HttpResponse,Http404\n\n    if req.method == 'POST':\n        txt = req.POST['your_txt']  # POST\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\n        surprise_txt = txt + \"!!!\"  # \u52a0\u5de5\n\n        response = json.dumps({'your_surprise_txt':surprise_txt,})  # JSON\u5f62\u5f0f\u306b\u76f4\u3057\u3066\u30fb\u30fb\n\n        return HttpResponse(response,mimetype=\"text/javascript\")  # \u8fd4\u3059\u3002JSON\u306fjavascript\u6271\u3044\u306a\u306e\u304b\u30fb\u30fb\n\n    else:\n        raise Http404  # GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092404\u6271\u3044\u306b\u3057\u3066\u3044\u308b\u304c\u3001\u5b9f\u969b\u306f\u5225\u306b\u3057\u306a\u304f\u3066\u3082\u3044\u3044\u304b\u3082\n\n\u306a\u304a\u3001js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4e00\u90e8\u66f8\u304d\u5909\u3048\u308c\u3070\u666e\u901a\u306b csrf_token \u3092\u30d5\u30a9\u30fc\u30e0\u306b\u5165\u308c\u308b\u3060\u3051\u3067\u3082\u554f\u984c\u306a\u3044\u3002\n$.ajax({\n    // ...\n    'data':$('form#surprise_fm').serialize(),\n    // ...\n});\n\nserialize \u306f\u304a\u305d\u3089\u304fform\u5185\u306einput\u8981\u7d20\u3092\u5168\u3066 {name:value,...} \u306e\u5f62\u306b\u307e\u3068\u3081\u3066\u304f\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3060\u3068\u601d\u308f\u308c\u308b\u3002Django\u306e csrf_token \u306f\u30bf\u30cd\u3092\u660e\u304b\u305b\u3070 hidden\u30bf\u30a4\u30d7\u306einput\u8981\u7d20 \u307f\u305f\u3044\u306a\u306e\u3067\u3001\u3053\u306e\u65b9\u6cd5\u306a\u3089\u901a\u5e38\u306e\u30d5\u30a9\u30fc\u30e0\u51e6\u7406\u3068\u540c\u69d8\u306b\u6a5f\u80fd\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3060\u308d\u3046\u3002\nJavascript\u3067POST\u3057\u3088\u3046\u3068\u3059\u308b\u3068Django\u306eCSRF\u5bfe\u7b56\u306b\u5f15\u3063\u304b\u304b\u308a\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3060\u304c\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3061\u3083\u3093\u3068\u5bfe\u7b56\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\nhttp://docs.djangoproject.jp/en/latest/ref/contrib/csrf.html?highlight=csrf#ajax\n\n\u306a\u304a\u3001\u4f7f\u3044\u56de\u305b\u308b\u3088\u3046\u306b\u30b3\u30d4\u30da\u3057\u305f\u3082\u306e\u3092Github\u306b\u4e0a\u3052\u305f\u306e\u3067\u4f7f\u3044\u305f\u3044\u65b9\u306f\u3069\u3046\u305e\u3002\nhttps://github.com/juniskw/django_tools/blob/master/csrf_token_ajax.js\n\n### \u4f8b\uff1aPOST\u3057\u305f\u6587\u5b57\u306b\u300c\uff01\uff01\uff01\u300d\u3092\u4ed8\u3051\u3066\u30a2\u30e9\u30fc\u30c8\u3059\u308b\u30a2\u30d7\u30ea\u3002\n\n###### surprise.html\n\n```html+django\n<head>\n    <script type=\"text/javascript\" src=\"{{STATIC_URL}}js/jquery-1.11.0.min.js\"></script>\n    <script type=\"text/javascript\" src=\"https://raw.githubusercontent.com/juniskw/django_tools/master/csrf_token_ajax.js\"></script>\n</head>\n<body>\n\t<h1>Let's Surprise!</h1>\n\t<form id=\"surprise_fm\" action=\"surprise/\" method=\"post\">\n\t\t<input id=\"your_txt\" type=\"text\" name=\"your_txt\">\n\t\t<input id=\"surprise_btn\" type=\"submit\">\n\t</form>\n</body>\n<script>\n$(document).ready(function() {\n\t$('#surprise_fm').submit(function() {  // \u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3067AJAX\n\t\t$.ajax({\n\t\t\t'url':$('form#surprise_fm').attr('action'),\n\t\t\t'type':'POST',\n\t\t\t'data':{\n\t\t\t\t'your_txt':$('#your_txt').val(),\n\t\t\t},\n\t\t\t'dataType':'json',\n\t\t\t'success':function(response){  // \u901a\u4fe1\u304c\u6210\u529f\u3057\u305f\u3089\u52d5\u304f\u51e6\u7406\u3067\u3001\u5f15\u6570\u306b\u306f\u8fd4\u3063\u3066\u304d\u305f\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u5165\u308b\n\t\t\t\talert(response.your_surprise_txt);  // \u30ec\u30b9\u30dd\u30f3\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057\u3066\u30a2\u30e9\u30fc\u30c8\n\t\t\t},\n\t\t});\n\t\treturn false;\n\t});\n});\n</script>\n```\n###### urls.py\n\n```py\n#...\nurl(r'^surprise/', 'views.for_ajax'),\n#...\n```\n\n###### views.py\n\n```py\ndef for_view(req):    # \u30d3\u30e5\u30fc\u3092\u8868\u793a\u3059\u308b\u95a2\u6570\n\treturn render(req,'surprise.html')\n\ndef for_ajax(req):    # AJAX\u306b\u7b54\u3048\u308b\u95a2\u6570\n\timport json\n\tfrom django.http import HttpResponse,Http404\n\n\tif req.method == 'POST':\n\t\ttxt = req.POST['your_txt']  # POST\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\n\t\tsurprise_txt = txt + \"!!!\"  # \u52a0\u5de5\n\n\t\tresponse = json.dumps({'your_surprise_txt':surprise_txt,})  # JSON\u5f62\u5f0f\u306b\u76f4\u3057\u3066\u30fb\u30fb\n\n\t\treturn HttpResponse(response,mimetype=\"text/javascript\")  # \u8fd4\u3059\u3002JSON\u306fjavascript\u6271\u3044\u306a\u306e\u304b\u30fb\u30fb\n\t\n    else:\n\t\traise Http404  # GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092404\u6271\u3044\u306b\u3057\u3066\u3044\u308b\u304c\u3001\u5b9f\u969b\u306f\u5225\u306b\u3057\u306a\u304f\u3066\u3082\u3044\u3044\u304b\u3082\n```\n\n\u306a\u304a\u3001js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4e00\u90e8\u66f8\u304d\u5909\u3048\u308c\u3070\u666e\u901a\u306b **csrf_token** \u3092\u30d5\u30a9\u30fc\u30e0\u306b\u5165\u308c\u308b\u3060\u3051\u3067\u3082\u554f\u984c\u306a\u3044\u3002\n\n```js\n$.ajax({\n    // ...\n    'data':$('form#surprise_fm').serialize(),\n    // ...\n});\n```\n\n**serialize** \u306f\u304a\u305d\u3089\u304fform\u5185\u306einput\u8981\u7d20\u3092\u5168\u3066 **{name:value,...}** \u306e\u5f62\u306b\u307e\u3068\u3081\u3066\u304f\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3060\u3068\u601d\u308f\u308c\u308b\u3002Django\u306e **csrf_token** \u306f\u30bf\u30cd\u3092\u660e\u304b\u305b\u3070 **hidden\u30bf\u30a4\u30d7\u306einput\u8981\u7d20** \u307f\u305f\u3044\u306a\u306e\u3067\u3001\u3053\u306e\u65b9\u6cd5\u306a\u3089\u901a\u5e38\u306e\u30d5\u30a9\u30fc\u30e0\u51e6\u7406\u3068\u540c\u69d8\u306b\u6a5f\u80fd\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3060\u308d\u3046\u3002\n", "tags": ["Django", "Python", "JavaScript", "jQuery"]}