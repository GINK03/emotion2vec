{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nKubernetes \u306e\u5b66\u7fd2\u3092\u3059\u308b\u305f\u3081\u306b\u307e\u305a\u306f\u5b9f\u74b0\u5883\u304c\u307b\u3057\u304b\u3063\u305f\u306e\u3067\u3001AWS EC2 \u4e0a\u306b Kubernetes \u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3057\u3066\u307f\u305f\u3002\u4eca\u56de\u306f\u4f5c\u696d\u7528\u306eEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u305d\u3053\u304b\u3089 Kubernetes \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3057\u305f\u3002\n\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nKubernetes \u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nIAM Role \u306e\u4f5c\u6210\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u5f53\u3066\u308b Role \u3092\u4f5c\u6210\u3059\u308b\u3002Kubernetes \u306e \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001\u81ea\u52d5\u3067 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3001VPC\u3001S3\u30d0\u30b1\u30c3\u30c8\u306a\u3069\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u3001\u4e8b\u524d\u306b Role \u3092\u5272\u308a\u5f53\u3066\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u9762\u5012\u3067\u3042\u308c\u3070\u30d5\u30eb\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3064 Role \u3092\u4f5c\u308c\u3070\u3044\u3044\u304c\u3001\u6700\u4f4e\u9650\u4ee5\u4e0b\u306e\u3088\u3046\u306b EC2, S3, IAM \u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3064 Role \u3092\u4f5c\u6210\u3059\u308c\u3070\u3044\u3044\u3002\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"ec2:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"elasticloadbalancing:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"autoscaling:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:*\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\n\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3002 \u4f5c\u6210\u6642\u306b\u3001\u4e0a\u306e\u624b\u9806\u3067\u4f5c\u6210\u3057\u305f Role \u3092 IAM Role \u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u3002\n\n\u8d77\u52d5\u5f8c\u3001\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u3067\u63a5\u7d9a\u3059\u308b\u3002\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\u57fa\u672c\u7684\u306b\u306f\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 https://get.k8s.io \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u306a\u306e\u3060\u304c\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308b\u305f\u3081\u3001AZ\u540d\u3084S3\u306e\u30d0\u30b1\u30c3\u30c8\u540d\u306a\u3069\u3092\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n# \u30af\u30e9\u30a6\u30c9\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u540d\u306e\u6307\u5b9a(aws)\u3002 \u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001AWS \u3060\u3051\u3067\u306a\u304f\u3001\n# Google Cloud Engine(gce) \u3084 Microsoft Azure(azure)\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n# \u3053\u306e\u5909\u6570\u306e\u6307\u5b9a\u306f\u5fc5\u8981\u3002\nexport KUBERNETES_PROVIDER=aws  \n\n# \u4f7f\u7528\u3059\u308bAZ\u306e\u540d\u524d\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f us-west-2a \u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3002\n# \u306a\u304a\u3001\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u3053\u306eAZ\u540d\u304b\u3089\u5224\u65ad\u3055\u308c\u308b\u3002\nexport KUBE_AWS_ZONE=ap-northeast-1a\n\n# Master \u3068 Minon \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b5\u30a4\u30ba\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 t2.micro \u306b\u306f\u306a\u3063\u3066\u3044\u308b\u304c\n# \u5ff5\u306e\u305f\u3081\u8a2d\u5b9a\u3002\nexport MASTER_SIZE=t2.micro\nexport MINION_SIZE=t2.micro\n\n# Minion \u306e\u53f0\u6570(\u4f5c\u6210\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570)\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u30674\u53f0\u306a\u306e\u3067\u30012\u53f0\u306b\u3057\u3066\u304a\u3044\u305f\u3002\nexport NUM_MINIONS=2\n\n# S3 \u306e\u30d0\u30b1\u30c3\u30c8\u540d\u3002\u3059\u3067\u306b\u5b58\u5728\u3057\u308c\u3070\u305d\u308c\u304c\u4f7f\u308f\u308c\u3001\u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u4f5c\u6210\u3055\u308c\u308b\u3002\n# \u306a\u304a\u3001\u3053\u306e\u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u540d\u524d\u3092\u81ea\u52d5\u751f\u6210\u3057\u3066\u30d0\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304f\u308c\u308b\u3002\nexport AWS_S3_BUCKET=arturias-kube\n\n# S3 \u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3002\u30d0\u30b1\u30c3\u30c8\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u751f\u6210\u3055\u305b\u308b\u5834\u5408\u306b\u6307\u5b9a\u3059\u308b\u3002\nexport AWS_S3_REGION=ap-northeast-1\n\n<\u88dc\u8db3> \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f Master \u3084 Minion \u306f ubuntu \u306e AMI \u3092\u4f7f\u3063\u3066\u69cb\u7bc9\u3055\u308c\u308b\u3002AWS_IMAGE \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3067\u4f7f\u7528\u3059\u308b AMI \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u73fe\u5728\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u306e\u306f ubuntu \u3068 CoreOS \u3060\u3051\u3089\u3057\u3044\u306e\u3067\u3001\u305d\u308c\u4ee5\u5916\u306f\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u69cb\u7bc9\n\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001Kubernets \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\ncurl -sS https://get.k8s.io | bash\n\n\u3042\u3068\u306f\u81ea\u52d5\u7684\u306b\u9032\u3093\u3067\u3044\u304d\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u69cb\u7bc9\u3055\u308c\u308b\u3002Master \u3084 Minon \u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306e\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n$ curl -sS https://get.k8s.io | bash\nDownloading kubernetes release v0.19.3 to /home/ec2-user/kubernetes.tar.gz\n\n\u30fb\u30fb\u30fb(\u7565)\n\nKubernetes cluster is running.  The master is running at:\n\n  https://52.68.83.XX\n\nThe user name and password to use is located in /home/ec2-user/.kube/config.\n\n... calling validate-cluster\nFound 2 nodes.\n        NAME                                             LABELS                                                                  STATUS\n     1  ip-172-20-0-10.ap-northeast-1.compute.internal   kubernetes.io/hostname=ip-172-20-0-10.ap-northeast-1.compute.internal   Ready\n     2  ip-172-20-0-11.ap-northeast-1.compute.internal   kubernetes.io/hostname=ip-172-20-0-11.ap-northeast-1.compute.internal   Ready\n\n\u30fb\u30fb\u30fb(\u7565)\n\nDone, listing cluster services:\n\nKubernetes master is running at https://52.68.83.XX\nElasticsearch is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/elasticsearch-logging\nKibana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/kibana-logging\nKubeDNS is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/kube-dns\nGrafana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-grafana\n is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-heapster\ninfluxGrafana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-influxdb\n\nKubernetes binaries at /home/ec2-user/kubernetes/kubernetes/cluster/\nYou may want to add this directory to your PATH in $HOME/.profile\nInstallation successful!\n\nAWS \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u898b\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b(kubernetes-* \u304c\u81ea\u52d5\u3067\u4f5c\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9)\u3002\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f EC2 \u306e AutoScaling Group \u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u6a5f\u80fd\u306b\u3088\u308a\u3053\u308c\u3089\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n\u4ed6\u306b\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3088\u308a\u3001VPC\u3001S3\u30d0\u30b1\u30c3\u30c8\u3001IAM Role \u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3001Master \u306e\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e ~/.kube/config \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n$ curl -u admin:XXXXXXX -k https://52.68.83.XX\n{\n  \"paths\": [\n    \"/api\",\n    \"/api/v1\",\n    \"/api/v1beta3\",\n    \"/healthz\",\n    \"/healthz/ping\",\n    \"/logs/\",\n    \"/metrics\",\n    \"/static/\",\n    \"/swagger-ui/\",\n    \"/swaggerapi/\",\n    \"/ui/\",\n    \"/version\"\n  ]\n}\n\n$ curl -u admin:XXXXXXX -k https://52.68.83.XX/version\n{\n  \"major\": \"0\",\n  \"minor\": \"19\",\n  \"gitVersion\": \"v0.19.3\",\n  \"gitCommit\": \"3103c8ca0f24514bc39b6e2b7d909bbf46af8d11\",\n  \"gitTreeState\": \"clean\"\n}\n\nPod \u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3002Kubernetes \u30af\u30e9\u30b9\u30bf\u3092\u7ba1\u7406\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3042\u308b kubectl \u306f\u3001\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u5b9f\u884c\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b kubernetes/platforms/ \u914d\u4e0b\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002\n$ ./kubernetes/platforms/linux/amd64/kubectl get pods\nNAME                                                                   READY     REASON    RESTARTS   AGE\nelasticsearch-logging-v1-atfii                                         1/1       Running   0          35m\nelasticsearch-logging-v1-f3rge                                         1/1       Running   0          35m\nfluentd-elasticsearch-ip-172-20-0-10.ap-northeast-1.compute.internal   1/1       Running   0          31m\nfluentd-elasticsearch-ip-172-20-0-11.ap-northeast-1.compute.internal   1/1       Running   0          31m\nkibana-logging-v1-4ije5                                                1/1       Running   0          35m\nkube-apiserver-ip-172-20-0-9                                           0/1       Pending   0          11m\nkube-controller-manager-ip-172-20-0-9                                  0/1       Pending   0          11m\nkube-dns-v3-7rw1g                                                      3/3       Running   1          35m\nkube-scheduler-ip-172-20-0-9                                           0/1       Pending   0          11m\nmonitoring-heapster-v3-uz6oy                                           1/1       Running   1          35m\nmonitoring-influx-grafana-v1-7agvr                                     2/2       Running   0          35m\n\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u524a\u9664\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001AWS \u306e AutoScaling Group \u3084 VPC \u306a\u3069\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u624b\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3084\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3059\u308b\u306e\u306f\u9762\u5012\u3002\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b Kubernetes \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u308b cluster/kube-down.sh \u3092\u4f7f\u3046\u306e\u304c\u7c21\u5358\u3002\n$ export KUBERNETES_PROVIDER=aws\n$ export KUBE_AWS_ZONE=ap-northeast-1a\n$ kubernetes/cluster/kube-down.sh\nBringing down cluster using provider: aws\nDeleting auto-scaling group: kubernetes-minion-group\nDeleting auto-scaling launch configuration: kubernetes-minion-group\nDeleting instances in VPC: vpc-97e249f2\n(\u4e2d\u7565)\nDeleting security group: sg-f1700f94\nDeleting security group: sg-f2700f97\nDone\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\nGetting started on AWS EC2\n\n\u4fee\u6b63\u5c65\u6b74\n2015/8/11 \u300c\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u524a\u9664\u300d\u3092\u8ffd\u8a18\n# \u6982\u8981\nKubernetes \u306e\u5b66\u7fd2\u3092\u3059\u308b\u305f\u3081\u306b\u307e\u305a\u306f\u5b9f\u74b0\u5883\u304c\u307b\u3057\u304b\u3063\u305f\u306e\u3067\u3001AWS EC2 \u4e0a\u306b Kubernetes \u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3057\u3066\u307f\u305f\u3002\u4eca\u56de\u306f\u4f5c\u696d\u7528\u306eEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u305d\u3053\u304b\u3089 Kubernetes \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3057\u305f\u3002\n\n# \u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nKubernetes \u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n## IAM Role \u306e\u4f5c\u6210\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u5f53\u3066\u308b Role \u3092\u4f5c\u6210\u3059\u308b\u3002Kubernetes \u306e [\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8](https://get.k8s.io)\u306f\u3001\u81ea\u52d5\u3067 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3001VPC\u3001S3\u30d0\u30b1\u30c3\u30c8\u306a\u3069\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u3001\u4e8b\u524d\u306b Role \u3092\u5272\u308a\u5f53\u3066\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u9762\u5012\u3067\u3042\u308c\u3070\u30d5\u30eb\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3064 Role \u3092\u4f5c\u308c\u3070\u3044\u3044\u304c\u3001\u6700\u4f4e\u9650\u4ee5\u4e0b\u306e\u3088\u3046\u306b EC2, S3, IAM \u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u6301\u3064 Role \u3092\u4f5c\u6210\u3059\u308c\u3070\u3044\u3044\u3002\n\n```js\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"ec2:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"elasticloadbalancing:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"autoscaling:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:*\",\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"iam:*\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n![iam_role.PNG](https://qiita-image-store.s3.amazonaws.com/0/79316/63e91536-015e-67a7-4211-3944981f9f68.png)\n\n\n## \u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3002 \u4f5c\u6210\u6642\u306b\u3001\u4e0a\u306e\u624b\u9806\u3067\u4f5c\u6210\u3057\u305f Role \u3092 IAM Role \u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u3002\n![assign_role.PNG](https://qiita-image-store.s3.amazonaws.com/0/79316/e7627aa9-05cc-0305-9ca9-7bc2b5909f27.png)\n\n\u8d77\u52d5\u5f8c\u3001\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bSSH\u3067\u63a5\u7d9a\u3059\u308b\u3002\n\n# \u30af\u30e9\u30b9\u30bf\u30fc\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n## \u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\u57fa\u672c\u7684\u306b\u306f\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 https://get.k8s.io \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u306a\u306e\u3060\u304c\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u308b\u305f\u3081\u3001AZ\u540d\u3084S3\u306e\u30d0\u30b1\u30c3\u30c8\u540d\u306a\u3069\u3092\u74b0\u5883\u5909\u6570\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n\n```bash\n# \u30af\u30e9\u30a6\u30c9\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u540d\u306e\u6307\u5b9a(aws)\u3002 \u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001AWS \u3060\u3051\u3067\u306a\u304f\u3001\n# Google Cloud Engine(gce) \u3084 Microsoft Azure(azure)\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\n# \u3053\u306e\u5909\u6570\u306e\u6307\u5b9a\u306f\u5fc5\u8981\u3002\nexport KUBERNETES_PROVIDER=aws  \n\n# \u4f7f\u7528\u3059\u308bAZ\u306e\u540d\u524d\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f us-west-2a \u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3002\n# \u306a\u304a\u3001\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u3053\u306eAZ\u540d\u304b\u3089\u5224\u65ad\u3055\u308c\u308b\u3002\nexport KUBE_AWS_ZONE=ap-northeast-1a\n\n# Master \u3068 Minon \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b5\u30a4\u30ba\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 t2.micro \u306b\u306f\u306a\u3063\u3066\u3044\u308b\u304c\n# \u5ff5\u306e\u305f\u3081\u8a2d\u5b9a\u3002\nexport MASTER_SIZE=t2.micro\nexport MINION_SIZE=t2.micro\n\n# Minion \u306e\u53f0\u6570(\u4f5c\u6210\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570)\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u30674\u53f0\u306a\u306e\u3067\u30012\u53f0\u306b\u3057\u3066\u304a\u3044\u305f\u3002\nexport NUM_MINIONS=2\n\n# S3 \u306e\u30d0\u30b1\u30c3\u30c8\u540d\u3002\u3059\u3067\u306b\u5b58\u5728\u3057\u308c\u3070\u305d\u308c\u304c\u4f7f\u308f\u308c\u3001\u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u4f5c\u6210\u3055\u308c\u308b\u3002\n# \u306a\u304a\u3001\u3053\u306e\u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u540d\u524d\u3092\u81ea\u52d5\u751f\u6210\u3057\u3066\u30d0\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304f\u308c\u308b\u3002\nexport AWS_S3_BUCKET=arturias-kube\n\n# S3 \u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3002\u30d0\u30b1\u30c3\u30c8\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u751f\u6210\u3055\u305b\u308b\u5834\u5408\u306b\u6307\u5b9a\u3059\u308b\u3002\nexport AWS_S3_REGION=ap-northeast-1\n```\n\n<\u88dc\u8db3> \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f Master \u3084 Minion \u306f ubuntu \u306e AMI \u3092\u4f7f\u3063\u3066\u69cb\u7bc9\u3055\u308c\u308b\u3002AWS_IMAGE \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3067\u4f7f\u7528\u3059\u308b AMI \u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u73fe\u5728\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\u306e\u306f ubuntu \u3068 CoreOS \u3060\u3051\u3089\u3057\u3044\u306e\u3067\u3001\u305d\u308c\u4ee5\u5916\u306f\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n    \n\n## \u30af\u30e9\u30b9\u30bf\u30fc\u306e\u69cb\u7bc9\n\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001Kubernets \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```bash\ncurl -sS https://get.k8s.io | bash\n```\n\n\u3042\u3068\u306f\u81ea\u52d5\u7684\u306b\u9032\u3093\u3067\u3044\u304d\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u304c\u69cb\u7bc9\u3055\u308c\u308b\u3002Master \u3084 Minon \u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306e\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```bash\n$ curl -sS https://get.k8s.io | bash\nDownloading kubernetes release v0.19.3 to /home/ec2-user/kubernetes.tar.gz\n\n\u30fb\u30fb\u30fb(\u7565)\n\nKubernetes cluster is running.  The master is running at:\n\n  https://52.68.83.XX\n\nThe user name and password to use is located in /home/ec2-user/.kube/config.\n\n... calling validate-cluster\nFound 2 nodes.\n        NAME                                             LABELS                                                                  STATUS\n     1  ip-172-20-0-10.ap-northeast-1.compute.internal   kubernetes.io/hostname=ip-172-20-0-10.ap-northeast-1.compute.internal   Ready\n     2  ip-172-20-0-11.ap-northeast-1.compute.internal   kubernetes.io/hostname=ip-172-20-0-11.ap-northeast-1.compute.internal   Ready\n\n\u30fb\u30fb\u30fb(\u7565)\n\nDone, listing cluster services:\n\nKubernetes master is running at https://52.68.83.XX\nElasticsearch is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/elasticsearch-logging\nKibana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/kibana-logging\nKubeDNS is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/kube-dns\nGrafana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-grafana\n is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-heapster\ninfluxGrafana is running at https://52.68.83.XX/api/v1beta3/proxy/namespaces/default/services/monitoring-influxdb\n\nKubernetes binaries at /home/ec2-user/kubernetes/kubernetes/cluster/\nYou may want to add this directory to your PATH in $HOME/.profile\nInstallation successful!\n```\n\nAWS \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u898b\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b(kubernetes-* \u304c\u81ea\u52d5\u3067\u4f5c\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9)\u3002\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f EC2 \u306e AutoScaling Group \u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u6a5f\u80fd\u306b\u3088\u308a\u3053\u308c\u3089\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n![kube-nodes-ec2.PNG](https://qiita-image-store.s3.amazonaws.com/0/79316/991e3334-715a-b254-7cb7-66de5179ff58.png)\n\n\u4ed6\u306b\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3088\u308a\u3001VPC\u3001S3\u30d0\u30b1\u30c3\u30c8\u3001IAM Role \u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\n\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3001Master \u306e\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e ~/.kube/config \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n```bash\n$ curl -u admin:XXXXXXX -k https://52.68.83.XX\n{\n  \"paths\": [\n    \"/api\",\n    \"/api/v1\",\n    \"/api/v1beta3\",\n    \"/healthz\",\n    \"/healthz/ping\",\n    \"/logs/\",\n    \"/metrics\",\n    \"/static/\",\n    \"/swagger-ui/\",\n    \"/swaggerapi/\",\n    \"/ui/\",\n    \"/version\"\n  ]\n}\n\n$ curl -u admin:XXXXXXX -k https://52.68.83.XX/version\n{\n  \"major\": \"0\",\n  \"minor\": \"19\",\n  \"gitVersion\": \"v0.19.3\",\n  \"gitCommit\": \"3103c8ca0f24514bc39b6e2b7d909bbf46af8d11\",\n  \"gitTreeState\": \"clean\"\n}\n```\n\nPod \u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3002Kubernetes \u30af\u30e9\u30b9\u30bf\u3092\u7ba1\u7406\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3042\u308b kubectl \u306f\u3001\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u5b9f\u884c\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b kubernetes/platforms/ \u914d\u4e0b\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002\n\n```bash\n$ ./kubernetes/platforms/linux/amd64/kubectl get pods\nNAME                                                                   READY     REASON    RESTARTS   AGE\nelasticsearch-logging-v1-atfii                                         1/1       Running   0          35m\nelasticsearch-logging-v1-f3rge                                         1/1       Running   0          35m\nfluentd-elasticsearch-ip-172-20-0-10.ap-northeast-1.compute.internal   1/1       Running   0          31m\nfluentd-elasticsearch-ip-172-20-0-11.ap-northeast-1.compute.internal   1/1       Running   0          31m\nkibana-logging-v1-4ije5                                                1/1       Running   0          35m\nkube-apiserver-ip-172-20-0-9                                           0/1       Pending   0          11m\nkube-controller-manager-ip-172-20-0-9                                  0/1       Pending   0          11m\nkube-dns-v3-7rw1g                                                      3/3       Running   1          35m\nkube-scheduler-ip-172-20-0-9                                           0/1       Pending   0          11m\nmonitoring-heapster-v3-uz6oy                                           1/1       Running   1          35m\nmonitoring-influx-grafana-v1-7agvr                                     2/2       Running   0          35m\n```\n\n# \u30af\u30e9\u30b9\u30bf\u30fc\u306e\u524a\u9664\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3001AWS \u306e AutoScaling Group \u3084 VPC \u306a\u3069\u69d8\u3005\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u624b\u52d5\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3084\u5404\u7a2e\u30ea\u30bd\u30fc\u30b9\u3092\u524a\u9664\u3059\u308b\u306e\u306f\u9762\u5012\u3002\u4f5c\u696d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b Kubernetes \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u308b cluster/kube-down.sh \u3092\u4f7f\u3046\u306e\u304c\u7c21\u5358\u3002\n\n```bash\n$ export KUBERNETES_PROVIDER=aws\n$ export KUBE_AWS_ZONE=ap-northeast-1a\n$ kubernetes/cluster/kube-down.sh\nBringing down cluster using provider: aws\nDeleting auto-scaling group: kubernetes-minion-group\nDeleting auto-scaling launch configuration: kubernetes-minion-group\nDeleting instances in VPC: vpc-97e249f2\n(\u4e2d\u7565)\nDeleting security group: sg-f1700f94\nDeleting security group: sg-f2700f97\nDone\n```\n\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\n[Getting started on AWS EC2](https://github.com/GoogleCloudPlatform/kubernetes/blob/master/docs/getting-started-guides/aws.md)\n\n# \u4fee\u6b63\u5c65\u6b74\n2015/8/11 \u300c\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u524a\u9664\u300d\u3092\u8ffd\u8a18\n\n\n\n\n\n\n", "tags": ["AWS", "kubernetes", "docker"]}