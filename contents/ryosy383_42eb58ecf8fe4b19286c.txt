{"context": " More than 1 year has passed since last update.\n\nKandan\u3092\u5c0e\u5165\u3059\u308b\n\u69cb\u7bc9\u74b0\u5883\u306fUbuntu14.04\u3067\u3059\u3002\n\nNode.js\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -L git.io/nodebrew | perl - setup\n$ echo 'export PATH=$HOME/.nodebrew/current/bin:$PATH' >> ~/.bashrc\n$ source ~/.bashrc\n$ nodebrew install latest\n$ nodebrew use v0.11.13\n$ node -v\nv0.11.13\n\n\nRuby\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -sSL https://get.rvm.io | bash\n$ source /home/(\u30e6\u30fc\u30b6\u540d)/.rvm/scripts/rvm\n$ rvm install 2.0.0-p481\n$ rvm use 2.0.0-p481\nruby 2.0.0p481 (2014-05-08 revision 45883) [x86_64-linux]\n\n\nPostgreSQL\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install postgresql postgresql-contrib libpq-dev\n\n\n\u30e6\u30fc\u30b6\u30fc\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n\n$ sudo su - postgres\n$ psql\npostgres=# create user \"kandan\" with password 'kandan';\npostgres~# ALTER ROLE kandan WITH CREATEDB;\n\n\u4eee\u306b\u300ckandan\u300d\u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nRails\u7528\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u306e\u8a2d\u5b9a\n\n$ sudo vim /etc/postgresql/9.3/main/pg_hba.conf\n\n\n\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nlocal   all             kandan                                md5\n\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n\n$ sudo service postgresql restart\n\n\nKandan\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nGitHub\u304b\u3089\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\n\n$ git clone https://github.com/kandanapp/kandan.git\n$ git checkout v1.2\n\n\nKandan\u306b\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u30fbGem\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo apt-get install libxml2-dev libxslt-dev # nokogiri\u306b\u5fc5\u8981\n$ gem install bundler\n$ cd kandan\n$ bundle install --path vendor/bundle\n\n\n\u30a2\u30bb\u30c3\u30c4\u30d7\u30ea\u30b3\u30f3\u30d1\u30a4\u30eb\n\n\u300cconfig/enviroments/production.rb\u300d\u306e\u4ee5\u4e0b\u3092true\u306b\u3059\u308b\nconfig.serve_static_assets = true\n\n$ bundle exec rake assets:precompile RAILS_ENV=production\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\n\nconfig/database.yml\u306e\u8a2d\u5b9a\n\n\u4ee5\u4e0b\u3092\u52a0\u3048\u307e\u3059\u3002\nproduction:\n  adapter: postgresql\n  encoding: unicode\n  database: kandan_production\n  pool: 5\n  username: kandan\n  password: kandan\n\n\nDB\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n\n$ bundle exec rake db:create db:migrate kandan:bootstrap RAILS_ENV=production\n\n\nNginx\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\n\nNginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n$ cat /etc/nginx/sites-available/default\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server ipv6only=on;\n\n    root /usr/share/nginx/html;\n    index index.html index.htm;\n\n    # Make site accessible from http://localhost/\n    server_name localhost;\n\n    location / {\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_redirect off;\n\n        if (!-f $request_filename) {\n            proxy_pass http://localhost:3000;\n            break;\n        }\n    }\n}\n\n\nNginx\u306e\u518d\u8d77\u52d5\n\n$ sudo service nginx restart\n\n\nKandan\u306e\u8d77\u52d5\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3055\u305b\u3066\u3001localhost\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\u3068\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n$ cd kandan\n$ bundle exec thin start -e production\n\n\n\n\u4ee5\u4e0b\u306eUsername\u3068Password\u3067\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\n\nUsername: Admin\nPassword: kandanappadmin\n\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u753b\u9762\n\n\n\n\nHubot\u3092\u5c0e\u5165\u3059\u308b\n\nHubot\u306e\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u3068\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u53d6\u5f97\u3092\u884c\u3046\n\n$ bundle exec rake kandan:boot_hubot RAILS_ENV=production\nCreating hubot user...\n\n$ bundle exec rake kandan:hubot_access_key  RAILS_ENV=production\nYour hubot access key is xxxxxxxx\n\n\nHubot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n$ wget https://github.com/github/hubot/archive/v2.4.7.zip\n$ unzip v2.4.7.zip\n$ cd hubot-2.4.7\n$ npm install\n$ make package\n\n\nKandan\u3068\u306e\u9023\u643a\n\ncd hubot\n$ git clone https://github.com/kandanapp/hubot-kandan.git node_modules/hubot-kandan\n$ npm install faye\n$ npm install ntwitter\n\n\nhubot-scripts.json\u304b\u3089 \"redis-brain.coffee\" \u3092\u53d6\u308a\u9664\u304f\n\nhubot/hubot-scripts.json\n- [\"redis-brain.coffee\", \"tweet.coffee\", \"shipit.coffee\"]\n+ [\"tweet.coffee\", \"shipit.coffee\"]\n\n\nhubot-kandan\u306epackage.json\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u66f8\u304d\u63db\u3048\u308b\n\nhubot/node_modules/hubot-kandan/package.json\u3092\u7de8\u96c6\n- \"version\":     \"1.0\",\n+ \"version\":     \"1.0.0\",\n\n\n~/.bashrc\u306b\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\n\n# Host\u540d\nexport HUBOT_KANDAN_HOST=localhost\n# Port\u304c80\u4ee5\u5916\u306e\u5834\u5408\n#export HUBOT_KANDAN_PORT=3000\n# \u53d6\u5f97\u3057\u305f\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\nexport HUBOT_KANDAN_TOKEN=xxxxxxxxxxxxx\n# info\u4ee5\u5916\u306e\u5834\u5408\nexport HUBOT_LOG_LEVEL=debug\n\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\n\n$ source ~/.bashrc\n\n\n\u30a2\u30c0\u30d7\u30bf\u3092\u6307\u5b9a\u3057\u3066Hubot\u3092\u8d77\u52d5\n\n$ ./bin/hubot -a kandan\n\n\nHubot\u52d5\u4f5c\u78ba\u8a8d\n\n\n@hubot shipit\u3068\u6253\u3063\u3066POST\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\nHubot\u304c\u30ea\u30b9\u306e\u753b\u50cf\u3092\u51fa\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\n## Kandan\u3092\u5c0e\u5165\u3059\u308b\n\n\u69cb\u7bc9\u74b0\u5883\u306fUbuntu14.04\u3067\u3059\u3002\n\n### Node.js\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ curl -L git.io/nodebrew | perl - setup\n$ echo 'export PATH=$HOME/.nodebrew/current/bin:$PATH' >> ~/.bashrc\n$ source ~/.bashrc\n$ nodebrew install latest\n$ nodebrew use v0.11.13\n$ node -v\nv0.11.13\n```\n\n\n### Ruby\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ curl -sSL https://get.rvm.io | bash\n$ source /home/(\u30e6\u30fc\u30b6\u540d)/.rvm/scripts/rvm\n$ rvm install 2.0.0-p481\n$ rvm use 2.0.0-p481\nruby 2.0.0p481 (2014-05-08 revision 45883) [x86_64-linux]\n```\n\n### PostgreSQL\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo apt-get install postgresql postgresql-contrib libpq-dev\n```\n\n* \u30e6\u30fc\u30b6\u30fc\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n\n```\n$ sudo su - postgres\n$ psql\npostgres=# create user \"kandan\" with password 'kandan';\npostgres~# ALTER ROLE kandan WITH CREATEDB;\n```\n\n\u4eee\u306b\u300ckandan\u300d\u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n* Rails\u7528\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u306e\u8a2d\u5b9a\n\n```\n$ sudo vim /etc/postgresql/9.3/main/pg_hba.conf\n```\n\n* \u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\nlocal   all             kandan                                md5\n```\n\n* \u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\n\n```\n$ sudo service postgresql restart\n```\n\n### Kandan\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n* GitHub\u304b\u3089\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\n\n```\n$ git clone https://github.com/kandanapp/kandan.git\n$ git checkout v1.2\n```\n\n* Kandan\u306b\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u30fbGem\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo apt-get install libxml2-dev libxslt-dev # nokogiri\u306b\u5fc5\u8981\n$ gem install bundler\n$ cd kandan\n$ bundle install --path vendor/bundle\n```\n\n* \u30a2\u30bb\u30c3\u30c4\u30d7\u30ea\u30b3\u30f3\u30d1\u30a4\u30eb\n\n\u300cconfig/enviroments/production.rb\u300d\u306e\u4ee5\u4e0b\u3092true\u306b\u3059\u308b\n\n```\nconfig.serve_static_assets = true\n```\n\n\n```\n$ bundle exec rake assets:precompile RAILS_ENV=production\n```\n\n### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n* config/database.yml\u306e\u8a2d\u5b9a\n\n\u4ee5\u4e0b\u3092\u52a0\u3048\u307e\u3059\u3002\n\n```\nproduction:\n  adapter: postgresql\n  encoding: unicode\n  database: kandan_production\n  pool: 5\n  username: kandan\n  password: kandan\n```\n\n* DB\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\n\n```\n$ bundle exec rake db:create db:migrate kandan:bootstrap RAILS_ENV=production\n```\n\n### Nginx\u3067\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\n* Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n$ cat /etc/nginx/sites-available/default\nserver {\n\tlisten 80 default_server;\n\tlisten [::]:80 default_server ipv6only=on;\n\n\troot /usr/share/nginx/html;\n\tindex index.html index.htm;\n\n\t# Make site accessible from http://localhost/\n\tserver_name localhost;\n\n\tlocation / {\n\t\tproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\t\tproxy_set_header Host $http_host;\n\t\tproxy_redirect off;\n\n\t\tif (!-f $request_filename) {\n\t\t\tproxy_pass http://localhost:3000;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n```\n\n* Nginx\u306e\u518d\u8d77\u52d5\n\n```\n$ sudo service nginx restart\n```\n\n### Kandan\u306e\u8d77\u52d5\n\n* \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3055\u305b\u3066\u3001localhost\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\u3068\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n```\n$ cd kandan\n$ bundle exec thin start -e production\n```\n\n![kandalogin.png](https://qiita-image-store.s3.amazonaws.com/0/34365/a1b57c6e-afcc-784a-3b4e-61b8df852b96.png \"kandalogin.png\")\n\n\n* \u4ee5\u4e0b\u306eUsername\u3068Password\u3067\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\n\nUsername: Admin\nPassword: kandanappadmin\n\n* \u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u753b\u9762\n![login_after3.png](https://qiita-image-store.s3.amazonaws.com/0/34365/fb2faac6-200c-1dd9-6840-c850b1e41b49.png \"login_after3.png\")\n\n\n## Hubot\u3092\u5c0e\u5165\u3059\u308b\n\n* Hubot\u306e\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u3068\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u53d6\u5f97\u3092\u884c\u3046\n\n```\n$ bundle exec rake kandan:boot_hubot RAILS_ENV=production\nCreating hubot user...\n\n$ bundle exec rake kandan:hubot_access_key  RAILS_ENV=production\nYour hubot access key is xxxxxxxx\n```\n\n* Hubot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```\n$ wget https://github.com/github/hubot/archive/v2.4.7.zip\n$ unzip v2.4.7.zip\n$ cd hubot-2.4.7\n$ npm install\n$ make package\n```\n\n* Kandan\u3068\u306e\u9023\u643a\n\n```\ncd hubot\n$ git clone https://github.com/kandanapp/hubot-kandan.git node_modules/hubot-kandan\n$ npm install faye\n$ npm install ntwitter\n```\n\n* hubot-scripts.json\u304b\u3089 \"redis-brain.coffee\" \u3092\u53d6\u308a\u9664\u304f\n\nhubot/hubot-scripts.json\n\n```\n- [\"redis-brain.coffee\", \"tweet.coffee\", \"shipit.coffee\"]\n+ [\"tweet.coffee\", \"shipit.coffee\"]\n```\n\n* hubot-kandan\u306epackage.json\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u66f8\u304d\u63db\u3048\u308b\n\nhubot/node_modules/hubot-kandan/package.json\u3092\u7de8\u96c6\n\n``` \n- \"version\":     \"1.0\",\n+ \"version\":     \"1.0.0\",\n```\n\n* ~/.bashrc\u306b\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\n\n```\n# Host\u540d\nexport HUBOT_KANDAN_HOST=localhost\n# Port\u304c80\u4ee5\u5916\u306e\u5834\u5408\n#export HUBOT_KANDAN_PORT=3000\n# \u53d6\u5f97\u3057\u305f\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\nexport HUBOT_KANDAN_TOKEN=xxxxxxxxxxxxx\n# info\u4ee5\u5916\u306e\u5834\u5408\nexport HUBOT_LOG_LEVEL=debug\n```\n\n* \u8a2d\u5b9a\u3092\u53cd\u6620\n\n```\n$ source ~/.bashrc\n```\n\n* \u30a2\u30c0\u30d7\u30bf\u3092\u6307\u5b9a\u3057\u3066Hubot\u3092\u8d77\u52d5\n\n```\n$ ./bin/hubot -a kandan\n```\n\n### Hubot\u52d5\u4f5c\u78ba\u8a8d\n\n* @hubot shipit\u3068\u6253\u3063\u3066POST\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\nHubot\u304c\u30ea\u30b9\u306e\u753b\u50cf\u3092\u51fa\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\n![shipit.png](https://qiita-image-store.s3.amazonaws.com/0/34365/f6596cfb-78cb-e856-f3ac-df47954c98fd.png \"shipit.png\")\n\n\n", "tags": ["Hubot", "hipchat", "kandan", "Rails", "Ruby"]}