{"tags": ["redux", "reactjs"], "context": "Middleware\u4f7f\u3063\u3066\u307e\u3059\u304b\uff1f \u4ee5\u524d Redux\u306emiddleware\u3092\u7a4d\u6975\u7684\u306b\u4f7f\u3063\u3066\u3044\u304f \u3068\u3044\u3046\u8a18\u4e8b\u3067Middleware\u306e\u4f7f\u3044\u3069\u3053\u308d\u306b\u3064\u3044\u3066\u5177\u4f53\u7684\u306a\u5229\u7528\u4f8b\u3092\u6319\u3052\u307e\u3057\u305f\u3002\u672c\u7a3f\u3067\u306fMiddleware\u3092\u66f8\u304f\u4e0a\u3067\u5f79\u306b\u7acb\u3064\u3001\u3082\u3046\u3061\u3087\u3063\u3068\u6398\u308a\u4e0b\u3052\u305fTips\u3092\u7d39\u4ecb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nAction\u304cMiddleware\u3092\u901a\u308a\u629c\u3051\u308b\u9806\u756a\n\nmiddlewares.js\nexport const m1 = store => next => action => {\n  console.log('m1', action.type);\n  return next(action);\n};\n\nexport const m2 = store => next => action => {\n  console.log('m2', action.type);\n  return next(action);\n};\n\nexport const m3 = store => next => action => {\n  console.log('m3', action.type);\n  return next(action);\n};\n\n\n\nstore.js\nimport { createStore, applyMiddleware } from 'redux';\nimport reducer from './reducers';\nimport { m1, m2, m3 } from './middlewares';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(m1, m2, m3)\n);\n\n\n\u629c\u7c8b\u3067\u3059\u304c\u4e0a\u8a18\u306e\u69cb\u6210\u3067\u4f55\u304b\u9069\u5f53\u306aAction\u3001\u3053\u3053\u3067\u306f HOGE Action\u3092dispatch\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u51fa\u529b\u3092\u5f97\u307e\u3059\u3002\nm1 HOGE\nm2 HOGE\nm3 HOGE\n\n\u7d20\u76f4\u306b applyMiddleware \u3067\u6307\u5b9a\u3057\u305f\u9806\u756a\u306bAction\u304c\u901a\u308a\u629c\u3051\u3066\u3044\u307e\u3059\u3002\n\u5f37\u3044\u3066\u8a00\u3048\u3070Middleware\u306b\u3088\u3063\u3066\u306f\u3069\u3053\u306b\u7f6e\u304f\u304b\u304c\u5927\u4e8b\u306a\u3082\u306e\u304c\u3042\u308b\u306e\u3067\u305d\u3053\u306f\u6ce8\u610f\u3059\u3079\u304d\u3067\u3059\u3002\n\u4f8b\u3048\u3070 redux-logger \u306f README.md \u306b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c \u539f\u5247\u7684\u306b\u4e00\u756a\u6700\u5f8c \u306b\u7f6e\u304d\u307e\u3059\u3002\n\nstore.js\nimport logger from 'redux-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(your, awesome, middleware, logger())\n);\n\n\nredux-logger \u81ea\u4f53\u306f\u305f\u3060\u306e\u30ed\u30ac\u30fc\u306a\u306e\u3067\u3069\u3053\u306b\u7f6e\u3044\u3066\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u6700\u5f8c\u306b\u7f6e\u304f\u306e\u306f\u30ed\u30b0\u51fa\u529b\u3055\u308c\u308bAction\u3068\u5b9f\u969b\u306bStore\u306b\u9001\u308a\u8fbc\u307e\u308c\u308b(\u305d\u306e\u7d50\u679c\u3068\u3057\u3066State\u3092\u5909\u5316\u3055\u305b\u308b)Action\u306b\u98df\u3044\u9055\u3044\u304c\u51fa\u3066\u6df7\u4e71\u3059\u308b\u304b\u3089\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u308f\u3056\u3068\u9014\u4e2d\u306b redux-logger \u3092\u7f6e\u3044\u305fMiddleware\u69cb\u6210\u3092\u60f3\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\napplyMiddleware(m1, logger(), m2, m3)\n\n\u3053\u3053\u3067 m2 \u304c FOO Action\u3092\u6f70\u3057\u3066\u3001m3 \u304c\u5225\u306e BAR Action\u3092\u751f\u6210\u3059\u308b\u5834\u5408\u3001FOO Action\u3068 HELLO Action\u3092\u9001\u308a\u8fbc\u3080\u3068 redux-logger \u306e\u30ed\u30b0\u51fa\u529b\u306b\u306f FOO Action\u3068 HELLO Action\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u5b9f\u969b\u306bStore\u306b\u5230\u9054\u3059\u308bAction\u306f HELLO Action\u3068 BAR Action\u306b\u306a\u308a\u307e\u3059\u3002\n[M1] -> [Logger] -> [M2] -> [M3] -> [Store]\n\n[FOO] --------------> X\n[HELLO] ------------------------------->\n                            [BAR] ----->\n\n\u540c\u69d8\u306bMiddleware\u3092\u7f6e\u304f\u4f4d\u7f6e\u304c\u5927\u4e8b\u306a\u3082\u306e\u3068\u3057\u3066 redux-thunk \u304c\u3042\u308a\u307e\u3059\u3002redux-thunk \u306fAction\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4ee3\u308f\u308a\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092dispatch\u3059\u308b\u3068\u3001Store\u306e dispatch \u95a2\u6570\u3068\u72b6\u614b\u53d6\u5f97\u306e\u305f\u3081\u306e getState \u95a2\u6570\u3092\u6e21\u3055\u308c\u308b\u306e\u3067\u3042\u3068\u306f\u716e\u308b\u306a\u308a\u713c\u304f\u306a\u308a\u3057\u3066\u304f\u308c\u3001\u3068\u3044\u3046\u826f\u304f\u8a00\u3048\u3070 \u5f37\u529b\u306a\u3001\u60aa\u304f\u8a00\u3048\u3070 GOTO\u6587\u306e\u3088\u3046\u306a Middleware\u3067\u3059\u3002\u3053\u3061\u3089\u306f redux-logger \u3068\u9006\u3067 \u4e00\u756a\u6700\u521d\u306b\u7f6e\u304f \u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nstore.js\nimport thunk from 'redux-thunk';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(thunk, your, awesome, middleware)\n);\n\n\n\u7406\u7531\u306f\u5358\u7d14\u3067\u3001\u591a\u304f\u306eMiddleware\u306fAction\u3068\u3057\u3066\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3084\u3063\u3066\u6765\u308b\u3053\u3068\u306f\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3059\u3079\u3066\u306eMiddleware\u306b\u5148\u3093\u3058\u3066\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066Action\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5f97\u3066\u304b\u3089\u5f8c\u7d9a\u306eMiddleware\u306b\u6d41\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\n        [Thunk] -> [M1] -> [M2] -> [Store]\n\n[Func] --> X ----> [A1] -------------->\n\nredux-api-middleware \u3068\u304b\u3082\u540c\u3058\u3067\u6700\u521d\u306b\u7f6e\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \n\n\u3067\u306f redux-thunk \u3068 redux-api-middleware \u306f\u3069\u3063\u3061\u3092\u5148\u306b\u3059\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u304b\uff1f\n\u7b54\u3048\u306f \u57fa\u672c\u7684\u306b\u306f\u3069\u3063\u3061\u3067\u3082\u3044\u3044 \u3067\u3059\u3002redux-thunk \u306f redux-api-middlware \u306e CALL_API Action\u3092\u7121\u8996\u3057\u3066\u304f\u308c\u307e\u3059\u3057\u3001redux-api-middlware \u306f redux-thunk \u3067\u51e6\u7406\u3055\u308c\u308b\u95a2\u6570\u30aa\u30d6\u30a8\u30b8\u30a7\u30af\u30c8\u3092\u7121\u8996\u3059\u308b\u304b\u3089\u3067\u3059\u3002\nredux-api-middleware \u306e types \u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u3066 redux-thunk \u306b\u5b9f\u884c\u3055\u305b\u308b\u3088\u3046\u306a \u5909\u614b\u7684 \u7279\u6b8a\u306a\u3053\u3068\u3092\u3084\u308a\u305f\u304f\u3066\u3082\u3001\u73fe\u72b6\u3067\u306f redux-api-middleware \u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u306f\u3058\u304b\u308c\u308b\u306e\u3067\u3067\u304d\u307e\u305b\u3093\u3002\u6b8b\u5ff5\u3002\u3082\u3057\u5c06\u6765 types \u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089 redux-api-middleware \u3092\u5148\u306b\u7f6e\u304f \u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u9006\u306b\u3059\u308b\u3068\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5b9f\u884c\u3055\u308c\u305a\u306b\u5f8c\u7d9a\u306eMiddleware\u307e\u305f\u306fStore\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3053\u308c\u306f redux-api-middleware \u304cAPI\u547c\u3073\u51fa\u3057\u306e\u72b6\u6cc1\u3084\u7d50\u679c\u3092\u4f1d\u3048\u308bAction\u3092\u6295\u3052\u308b\u3068\u304d\u306b store.dispatch \u3092\u4f7f\u308f\u305a\u306b next \u3092\u4f7f\u3063\u3066\u3044\u308b \u3053\u3068\u306b\u8d77\u56e0\u3057\u307e\u3059\u3002\u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3053\u306e\u9055\u3044\u304c\u4f55\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u304b\u8003\u3048\u3066\u3044\u304d\u307e\u3059\u3002\n\nMiddleware\u304b\u3089Action\u3092\u6295\u3052\u308b\u65b9\u6cd5\u306f2\u3064\u3042\u308b\nMiddleware\u306f\u3060\u3044\u305f\u3044\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u66f8\u304d\u307e\u3059\u3002\n\nhoge.js\nexport const hoge = store => next => action => {\n  // ...\n};\n\n\nMiddleware\u306b\u3088\u3063\u3066\u306f\u4e00\u756a\u5916\u5074\u306e\u95a2\u6570\u3092arrow function\u3067\u306f\u306a\u304f\u666e\u901a\u306b\u95a2\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u305f\u308a\u3001\u5f15\u6570\u3092\u53d7\u3051\u53d6\u308b\u3068\u304d (store) \u306e\u4ee3\u308f\u308a\u306b ({ getState }) \u3068\u66f8\u3044\u3066Store\u306b\u5bfe\u3057\u3066\u306f\u72b6\u614b\u306e\u53d6\u5f97\u3057\u304b\u3057\u306a\u3044\u3088\uff01\u3068\u660e\u793a\u3059\u308b\u3082\u306e\u3082\u3042\u308a\u307e\u3059\u306d\u3002\n\u3055\u3066\u3001Middleware\u3067\u306f\u65b0\u3057\u304fAction\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066Store\u306bdispatch\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u305d\u306e\u65b9\u6cd5\u306f2\u3064\u3042\u308b\u3053\u3068\u306f\u3054\u5b58\u77e5\u3067\u3057\u3087\u3046\u304b\uff1f \u4f8b\u3048\u3070 FOO Action\u304c\u6765\u305f\u3089 BAR Action\u3092\u65b0\u3057\u304f\u4f5c\u3063\u3066\u6295\u3052\u308bMiddleware\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\nm1.js\nexport const m1 = store => next => action => {\n  if (action.type === 'FOO') {\n    next({ type: 'BAR' });\n  }\n  return next(action);\n};\n\n\n\u7279\u5225\u306a\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u308c\u3067\u306f\u3082\u30461\u3064\u306e\u65b9\u6cd5\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\nm2.js\nexport const m2 = store => next => action => {\n  if (action.type === 'FOO') {\n    store.dispatch({ type: 'BAR' });\n  }\n  return next(action);\n};\n\n\n\u3053\u306e\u3088\u3046\u306bStore\u306e dispatch \u95a2\u6570\u3092\u76f4\u63a5\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a00\u308f\u308c\u3066\u307f\u308b\u3068\u306a\u3093\u3066\u3053\u3068\u306f\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u30fb\u30fb\u30fb\u3002\n\n\u3067\u306f next \u3068 store.dispatch \u306e\u9055\u3044\u306f\u7570\u306a\u308b\u7d50\u679c\u3092\u751f\u307f\u51fa\u3059\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\nMiddleware\u304c1\u3064\u3060\u3051\u306e\u3068\u304d\u306b\u9650\u3063\u3066 NO \u3067\u3059\u304c\u3001 \u57fa\u672c\u7684\u306b\u306fYES \u306a\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u5177\u4f53\u7684\u306b\u3069\u3046\u3044\u3046\u9055\u3044\u304c\u3042\u308b\u306e\u304b\u8a73\u3057\u304f\u898b\u3066\u3044\u304d\u307e\u3059\u3002\u6b21\u306e\u30b3\u30fc\u30c9\u306f\u5192\u982d\u306e3\u3064\u306eMiddleware\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u30d9\u30fc\u30b9\u306b\u3001\u771f\u3093\u4e2d\u306e m2 \u306e\u4ee3\u308f\u308a\u306b next \u3092\u4f7f\u3046 m2a\u3001store.dispatch \u3092\u4f7f\u3046 m2b \u306b\u66f8\u304d\u63db\u3048\u307e\u3057\u305f\u3002\u52d5\u4f5c\u3068\u3057\u3066\u306f\u3069\u3061\u3089\u3082 FOO Action\u304c\u6765\u305f\u3089 BAR Action\u3092\u751f\u6210\u3057\u3066\u6295\u3052\u307e\u3059\u3002\n\nmiddlewares.js\nexport const m1 = store => next => action => {\n  console.log('m1', action.type);\n  return next(action);\n};\n\nexport const m2a = store => next => action => {\n  console.log('m2a', action.type);\n  if (action.type === 'FOO') {\n    next({ type: 'BAR' });\n  }\n  return next(action);\n};\n\nexport const m2b = store => next => action => {\n  console.log('m2b', action.type);\n  if (action.type === 'FOO') {\n    store.dispatch({ type: 'BAR' });\n  }\n  return next(action);\n};\n\nexport const m3 = store => next => action => {\n  console.log('m3', action.type);\n  return next(action);\n};\n\n\n\u4e0a\u8a18Middleware\u3092\u4f7f\u3063\u3066\u307e\u305a\u306f m2a \u3092\u4f7f\u3063\u305f\u5834\u5408\u3001applyMiddleware(m1, m2a, m3) \u306e\u51fa\u529b\u3092\u898b\u3066\u307f\u307e\u3059\u3002\nm1 FOO\nm2 FOO\nm3 BAR\nm3 FOO\n\n\u6b21\u306b m2b \u3092\u4f7f\u3063\u305f\u5834\u5408\u3001applyMiddleware(m1, m2b, m3) \u306e\u51fa\u529b\u3067\u3059\u3002\nm1 FOO\nm2 FOO\nm1 BAR\nm2 BAR\nm3 BAR\nm3 FOO\n\n\u3053\u308c\u3067\u9055\u3044\u306f\u660e\u3089\u304b\u3067\u3059\u306d\u3002 next\u306f\u5f8c\u7d9a\u306eMiddleware\u306e\u307f\u901a\u904e\u3059\u308b\u306e\u306b\u5bfe\u3057\u3001store.dispatch\u306fMiddleware\u30c1\u30a7\u30fc\u30f3\u306e\u6700\u521d\u304b\u3089\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002 \u3069\u3061\u3089\u3092\u4f7f\u3046\u3079\u304d\u304b\u306f\u4f55\u3092\u3057\u305f\u3044\u306e\u304b\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070 redux-thunk \u3067\u306f store.dispatch \u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u307e\u3059\u304c\u3001\u3082\u3057 next \u3092\u4f7f\u3048\u3066\u3057\u307e\u3046\u3068 redux-thunk \u3092Middleware\u30c1\u30a7\u30fc\u30f3\u306e\u3069\u3053\u306b\u7f6e\u3044\u305f\u304b\u306b\u3088\u3063\u3066\u9069\u7528\u3055\u308c\u308bMiddleware\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3044\u6df7\u4e71\u306e\u5143\u306b\u306a\u308a\u307e\u3059\u3002\u3055\u3089\u306b store.dispatch \u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u3063\u3066\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3055\u3089\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092dispatch\u3059\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3067\u3082\u518d\u5ea6 redux-thunk \u304c\u5b9f\u884c\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306b redux-thunk \u3067\u306f store.dispatch \u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u5f37\u3044\u7406\u7531\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e00\u65b9\u3067\u65b0\u3057\u3044Action\u3092\u6295\u3052\u308b\u306e\u306b\u7d76\u5bfe\u306b next \u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u72b6\u6cc1\u3068\u3044\u3046\u306e\u306f\u305d\u3093\u306a\u306b\u591a\u304f\u3042\u308a\u307e\u305b\u3093\u3002 \u3060\u304b\u3089\u3068\u3044\u3063\u3066\u5b89\u6613\u306bstore.dispatch\u3092\u4f7f\u3046\u306e\u306f\u5371\u967a\u3067\u3059\u3002\u6ce8\u610f\u3057\u3066\u4f5c\u3089\u306a\u3044\u3068Middleware\u304cAction\u3092dispatch\u3059\u308b\u3053\u3068\u3067\u518d\u5e30\u7684\u306bMiddleware\u81ea\u8eab\u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3057\u307e\u3046 \u7121\u9650\u30eb\u30fc\u30d7 \u306b\u9665\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f FOO Action\u306e\u3068\u304d\u306e\u307f BAR Action\u3092dispatch\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u6761\u4ef6\u3092\u306f\u305a\u3059\u3068\u5f53\u7136\u7121\u9650\u30eb\u30fc\u30d7\u306b\u306a\u308a\u307e\u3059\u3002redux-thunk \u3082\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308c\u3070\u554f\u7b54\u7121\u7528\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u6b21\u306e\u3088\u3046\u306a\u610f\u5730\u60aa\u306aAction\u3092\u6295\u3052\u308b\u3068 Uncaught RangeError: Maximum call stack size exceeded \u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\nconst recurring = dispatch => dispatch(recurring);\nthis.props.dispatch(recurring);\n\n\nMiddleware\u304b\u3089Action\u3092\u6295\u3052\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306f2\u3064\u3042\u308b\nMiddleware\u5185\u304b\u3089Action\u3092\u6295\u3052\u308b\u306e\u306b2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u304c\u3001\u307e\u3060\u5b89\u5fc3\u3067\u304d\u307e\u305b\u3093\u3002 \u3069\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6295\u3052\u308b\u306e\u304b \u306b\u3088\u3063\u3066\u7d50\u679c\u304c\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306eMiddleware\u304c\u3069\u306e\u3088\u3046\u306a\u6319\u52d5\u306b\u306a\u308b\u306e\u304b\u60f3\u50cf\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nfunction isTarget(action) {\n  return action.type === 'FOO';\n}\n\nexport const m1 = store => next => action => {\n  if (isTarget(action)) {\n    store.dispatch({ type: 'BAR1' });\n  }\n  const ret = next(action);\n  if (isTarget(action)) {\n    store.dispatch({ type: 'BAR2' });\n  }\n  return ret;\n};\n\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306eAction\u3092 next \u3067\u9001\u308a\u51fa\u3059 \u524d\u306b \u65b0\u3057\u3044Action\u3092dispatch\u3059\u308b\u306e\u304b\u3001 \u5f8c\u306b dispatch\u3059\u308b\u306e\u304b\u3067\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u3046\u307e\u304f\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u304c redux-logger \u3067\u3059\u3002redux-logger \u306fStore\u306bdispatch\u3055\u308c\u305fAction\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001dispatch\u524d\u5f8c\u306eState\u3082\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002Store\u306e getState \u95a2\u6570\u3092 next \u306e\u524d\u5f8c\u3067\u305d\u308c\u305e\u308c\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n3\u884c\u3067\u307e\u3068\u3081\u308b\u3068\u3001\n\n\napplyMiddleware \u3067\u6307\u5b9a\u3059\u308bMiddleware\u306e\u4f4d\u7f6e\u306b\u6c17\u3092\u3064\u3051\u308b\nAction\u3092\u6295\u3052\u308b\u65b9\u6cd5\u306f next \u3068 store.dispatch \u306e2\u3064\u304c\u3042\u308b\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306eAction\u3092 next \u3067\u547c\u3073\u51fa\u3059\u524d\u5f8c\u3067State\u304c\u5909\u5316\u3059\u308b\n\n\n\u304a\u307e\u3051\n\u8907\u96d1\u306aMiddleware\u30c1\u30a7\u30fc\u30f3\u3092\u7d44\u3093\u3067\u3044\u308b\u3068\u3069\u3053\u3067Action\u304c\u751f\u6210\u3055\u308c\u305f\u306e\u304b\u3001\u6539\u5909\u3055\u308c\u305f\u306e\u304b\u3001\u6f70\u3055\u308c\u305f\u306e\u304b\u308f\u304b\u3089\u306a\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059(\u6016\u3044)\u3002\u305d\u3093\u306a\u3068\u304d\u624b\u3063\u53d6\u308a\u65e9\u304fprint\u30c7\u30d0\u30c3\u30b0\u3059\u308b\u65b9\u6cd5\u306f redux-logger \u3092\u3072\u305f\u3059\u3089Middleware\u306e\u9593\u306b\u5dee\u3057\u8fbc\u307f\u307e\u3059\u3002\n\nstore.js\nimport logger from 'redux-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(logger(), your, logger(), awesome, logger(), middleware, logger())\n);\n\n\n\u3046\u308f\u3041\u3072\u3069\u3044\u30fb\u30fb\u30fb\u3002\u3051\u3069\u3001 \u60e8\u72b6 \u72b6\u6cc1\u306f\u4e00\u5fdc\u3064\u304b\u3081\u307e\u3059\u3002\u305f\u3060\u3053\u308c\u3082Middleware\u306e\u6570\u304c\u591a\u304f\u306a\u308b\u3068\u633f\u5165\u3059\u308b\u306e\u304c\u9762\u5012\u306b\u306a\u308b\u306e\u3067\u3001\u304a\u624b\u8efd\u306b\u3084\u308b\u306b\u306f redux-middleware-logger \u304c\u4fbf\u5229\u3067\u3059\u3002\u4f7f\u3044\u65b9\u306f\u7c21\u5358\u3067Middleware\u306e\u30ea\u30b9\u30c8\u3092\u6e21\u3057\u307e\u3059\u3002\n\nstore.js\nimport withLogger from 'redux-middleware-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(...withLogger(your, awesome, middleware))\n);\n\n\n\n\u3042\u307e\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u306d\u3002\u307f\u306a\u3055\u3093\u305d\u3093\u306a\u306b\u56f0\u3063\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u5b89\u5fc3\u3057\u307e\u3057\u305f\u3002\n\nMiddleware\u4f7f\u3063\u3066\u307e\u3059\u304b\uff1f \u4ee5\u524d [Redux\u306emiddleware\u3092\u7a4d\u6975\u7684\u306b\u4f7f\u3063\u3066\u3044\u304f](http://qiita.com/kuy/items/57c6007f3b8a9b267a8e) \u3068\u3044\u3046\u8a18\u4e8b\u3067Middleware\u306e\u4f7f\u3044\u3069\u3053\u308d\u306b\u3064\u3044\u3066\u5177\u4f53\u7684\u306a\u5229\u7528\u4f8b\u3092\u6319\u3052\u307e\u3057\u305f\u3002\u672c\u7a3f\u3067\u306fMiddleware\u3092\u66f8\u304f\u4e0a\u3067\u5f79\u306b\u7acb\u3064\u3001\u3082\u3046\u3061\u3087\u3063\u3068\u6398\u308a\u4e0b\u3052\u305fTips\u3092\u7d39\u4ecb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n## Action\u304cMiddleware\u3092\u901a\u308a\u629c\u3051\u308b\u9806\u756a\n\n```middlewares.js\nexport const m1 = store => next => action => {\n  console.log('m1', action.type);\n  return next(action);\n};\n\nexport const m2 = store => next => action => {\n  console.log('m2', action.type);\n  return next(action);\n};\n\nexport const m3 = store => next => action => {\n  console.log('m3', action.type);\n  return next(action);\n};\n```\n\n```store.js\nimport { createStore, applyMiddleware } from 'redux';\nimport reducer from './reducers';\nimport { m1, m2, m3 } from './middlewares';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(m1, m2, m3)\n);\n```\n\n\u629c\u7c8b\u3067\u3059\u304c\u4e0a\u8a18\u306e\u69cb\u6210\u3067\u4f55\u304b\u9069\u5f53\u306aAction\u3001\u3053\u3053\u3067\u306f `HOGE` Action\u3092dispatch\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u51fa\u529b\u3092\u5f97\u307e\u3059\u3002\n\n```\nm1 HOGE\nm2 HOGE\nm3 HOGE\n```\n\n\u7d20\u76f4\u306b `applyMiddleware` \u3067\u6307\u5b9a\u3057\u305f\u9806\u756a\u306bAction\u304c\u901a\u308a\u629c\u3051\u3066\u3044\u307e\u3059\u3002\n\u5f37\u3044\u3066\u8a00\u3048\u3070Middleware\u306b\u3088\u3063\u3066\u306f\u3069\u3053\u306b\u7f6e\u304f\u304b\u304c\u5927\u4e8b\u306a\u3082\u306e\u304c\u3042\u308b\u306e\u3067\u305d\u3053\u306f\u6ce8\u610f\u3059\u3079\u304d\u3067\u3059\u3002\n\n\u4f8b\u3048\u3070 [`redux-logger`](https://github.com/fcomb/redux-logger) \u306f [`README.md`](https://github.com/fcomb/redux-logger#usage) \u306b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c **\u539f\u5247\u7684\u306b\u4e00\u756a\u6700\u5f8c** \u306b\u7f6e\u304d\u307e\u3059\u3002\n\n```store.js\nimport logger from 'redux-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(your, awesome, middleware, logger())\n);\n```\n\n`redux-logger` \u81ea\u4f53\u306f\u305f\u3060\u306e\u30ed\u30ac\u30fc\u306a\u306e\u3067\u3069\u3053\u306b\u7f6e\u3044\u3066\u3082\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u6700\u5f8c\u306b\u7f6e\u304f\u306e\u306f\u30ed\u30b0\u51fa\u529b\u3055\u308c\u308bAction\u3068\u5b9f\u969b\u306bStore\u306b\u9001\u308a\u8fbc\u307e\u308c\u308b(\u305d\u306e\u7d50\u679c\u3068\u3057\u3066State\u3092\u5909\u5316\u3055\u305b\u308b)Action\u306b\u98df\u3044\u9055\u3044\u304c\u51fa\u3066\u6df7\u4e71\u3059\u308b\u304b\u3089\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u308f\u3056\u3068\u9014\u4e2d\u306b `redux-logger` \u3092\u7f6e\u3044\u305fMiddleware\u69cb\u6210\u3092\u60f3\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\napplyMiddleware(m1, logger(), m2, m3)\n```\n\n\u3053\u3053\u3067 `m2` \u304c `FOO` Action\u3092\u6f70\u3057\u3066\u3001`m3` \u304c\u5225\u306e `BAR` Action\u3092\u751f\u6210\u3059\u308b\u5834\u5408\u3001`FOO` Action\u3068 `HELLO` Action\u3092\u9001\u308a\u8fbc\u3080\u3068 `redux-logger` \u306e\u30ed\u30b0\u51fa\u529b\u306b\u306f `FOO` Action\u3068 `HELLO` Action\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u304c\u3001\u5b9f\u969b\u306bStore\u306b\u5230\u9054\u3059\u308bAction\u306f `HELLO` Action\u3068 `BAR` Action\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n[M1] -> [Logger] -> [M2] -> [M3] -> [Store]\n\n[FOO] --------------> X\n[HELLO] ------------------------------->\n                            [BAR] ----->\n```\n\n\u540c\u69d8\u306bMiddleware\u3092\u7f6e\u304f\u4f4d\u7f6e\u304c\u5927\u4e8b\u306a\u3082\u306e\u3068\u3057\u3066 [`redux-thunk`](https://github.com/gaearon/redux-thunk) \u304c\u3042\u308a\u307e\u3059\u3002`redux-thunk` \u306fAction\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4ee3\u308f\u308a\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092dispatch\u3059\u308b\u3068\u3001Store\u306e `dispatch` \u95a2\u6570\u3068\u72b6\u614b\u53d6\u5f97\u306e\u305f\u3081\u306e `getState` \u95a2\u6570\u3092\u6e21\u3055\u308c\u308b\u306e\u3067\u3042\u3068\u306f\u716e\u308b\u306a\u308a\u713c\u304f\u306a\u308a\u3057\u3066\u304f\u308c\u3001\u3068\u3044\u3046\u826f\u304f\u8a00\u3048\u3070 **\u5f37\u529b\u306a**\u3001\u60aa\u304f\u8a00\u3048\u3070 **GOTO\u6587\u306e\u3088\u3046\u306a** Middleware\u3067\u3059\u3002\u3053\u3061\u3089\u306f `redux-logger` \u3068\u9006\u3067 **\u4e00\u756a\u6700\u521d\u306b\u7f6e\u304f** \u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```store.js\nimport thunk from 'redux-thunk';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(thunk, your, awesome, middleware)\n);\n```\n\n\u7406\u7531\u306f\u5358\u7d14\u3067\u3001\u591a\u304f\u306eMiddleware\u306fAction\u3068\u3057\u3066\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3084\u3063\u3066\u6765\u308b\u3053\u3068\u306f\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3059\u3079\u3066\u306eMiddleware\u306b\u5148\u3093\u3058\u3066\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066Action\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5f97\u3066\u304b\u3089\u5f8c\u7d9a\u306eMiddleware\u306b\u6d41\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\n\n```\n        [Thunk] -> [M1] -> [M2] -> [Store]\n\n[Func] --> X ----> [A1] -------------->\n```\n\n[`redux-api-middleware`](https://github.com/agraboso/redux-api-middleware) \u3068\u304b\u3082\u540c\u3058\u3067\u6700\u521d\u306b\u7f6e\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \n\n### \u3067\u306f `redux-thunk` \u3068 `redux-api-middleware` \u306f\u3069\u3063\u3061\u3092\u5148\u306b\u3059\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u304b\uff1f\n\n\u7b54\u3048\u306f **\u57fa\u672c\u7684\u306b\u306f\u3069\u3063\u3061\u3067\u3082\u3044\u3044** \u3067\u3059\u3002`redux-thunk` \u306f `redux-api-middlware` \u306e `CALL_API` Action\u3092\u7121\u8996\u3057\u3066\u304f\u308c\u307e\u3059\u3057\u3001`redux-api-middlware` \u306f `redux-thunk` \u3067\u51e6\u7406\u3055\u308c\u308b\u95a2\u6570\u30aa\u30d6\u30a8\u30b8\u30a7\u30af\u30c8\u3092\u7121\u8996\u3059\u308b\u304b\u3089\u3067\u3059\u3002\n\n`redux-api-middleware` \u306e [`types`](https://github.com/agraboso/redux-api-middleware/blob/master/README.md#call_apitypes) \u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3057\u3066 `redux-thunk` \u306b\u5b9f\u884c\u3055\u305b\u308b\u3088\u3046\u306a ~~\u5909\u614b\u7684~~ \u7279\u6b8a\u306a\u3053\u3068\u3092\u3084\u308a\u305f\u304f\u3066\u3082\u3001\u73fe\u72b6\u3067\u306f `redux-api-middleware` \u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u306f\u3058\u304b\u308c\u308b\u306e\u3067\u3067\u304d\u307e\u305b\u3093\u3002\u6b8b\u5ff5\u3002\u3082\u3057\u5c06\u6765 `types` \u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u305b\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089 **`redux-api-middleware` \u3092\u5148\u306b\u7f6e\u304f** \u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u9006\u306b\u3059\u308b\u3068\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5b9f\u884c\u3055\u308c\u305a\u306b\u5f8c\u7d9a\u306eMiddleware\u307e\u305f\u306fStore\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3053\u308c\u306f `redux-api-middleware` \u304cAPI\u547c\u3073\u51fa\u3057\u306e\u72b6\u6cc1\u3084\u7d50\u679c\u3092\u4f1d\u3048\u308bAction\u3092\u6295\u3052\u308b\u3068\u304d\u306b **`store.dispatch` \u3092\u4f7f\u308f\u305a\u306b `next` \u3092\u4f7f\u3063\u3066\u3044\u308b** \u3053\u3068\u306b\u8d77\u56e0\u3057\u307e\u3059\u3002\u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3053\u306e\u9055\u3044\u304c\u4f55\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u304b\u8003\u3048\u3066\u3044\u304d\u307e\u3059\u3002\n\n## Middleware\u304b\u3089Action\u3092\u6295\u3052\u308b\u65b9\u6cd5\u306f2\u3064\u3042\u308b\n\nMiddleware\u306f\u3060\u3044\u305f\u3044\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u66f8\u304d\u307e\u3059\u3002\n\n```hoge.js\nexport const hoge = store => next => action => {\n  // ...\n};\n```\n\nMiddleware\u306b\u3088\u3063\u3066\u306f\u4e00\u756a\u5916\u5074\u306e\u95a2\u6570\u3092arrow function\u3067\u306f\u306a\u304f\u666e\u901a\u306b\u95a2\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u305f\u308a\u3001\u5f15\u6570\u3092\u53d7\u3051\u53d6\u308b\u3068\u304d `(store)` \u306e\u4ee3\u308f\u308a\u306b `({ getState })` \u3068\u66f8\u3044\u3066Store\u306b\u5bfe\u3057\u3066\u306f\u72b6\u614b\u306e\u53d6\u5f97\u3057\u304b\u3057\u306a\u3044\u3088\uff01\u3068\u660e\u793a\u3059\u308b\u3082\u306e\u3082\u3042\u308a\u307e\u3059\u306d\u3002\n\n\u3055\u3066\u3001Middleware\u3067\u306f\u65b0\u3057\u304fAction\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066Store\u306bdispatch\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u305d\u306e\u65b9\u6cd5\u306f2\u3064\u3042\u308b\u3053\u3068\u306f\u3054\u5b58\u77e5\u3067\u3057\u3087\u3046\u304b\uff1f \u4f8b\u3048\u3070 `FOO` Action\u304c\u6765\u305f\u3089 `BAR` Action\u3092\u65b0\u3057\u304f\u4f5c\u3063\u3066\u6295\u3052\u308bMiddleware\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n```m1.js\nexport const m1 = store => next => action => {\n  if (action.type === 'FOO') {\n    next({ type: 'BAR' });\n  }\n  return next(action);\n};\n```\n\n\u7279\u5225\u306a\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u308c\u3067\u306f\u3082\u30461\u3064\u306e\u65b9\u6cd5\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\n```m2.js\nexport const m2 = store => next => action => {\n  if (action.type === 'FOO') {\n    store.dispatch({ type: 'BAR' });\n  }\n  return next(action);\n};\n```\n\n\u3053\u306e\u3088\u3046\u306bStore\u306e `dispatch` \u95a2\u6570\u3092\u76f4\u63a5\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a00\u308f\u308c\u3066\u307f\u308b\u3068\u306a\u3093\u3066\u3053\u3068\u306f\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u30fb\u30fb\u30fb\u3002\n\n### \u3067\u306f `next` \u3068 `store.dispatch` \u306e\u9055\u3044\u306f\u7570\u306a\u308b\u7d50\u679c\u3092\u751f\u307f\u51fa\u3059\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\nMiddleware\u304c1\u3064\u3060\u3051\u306e\u3068\u304d\u306b\u9650\u3063\u3066 **NO** \u3067\u3059\u304c\u3001 **\u57fa\u672c\u7684\u306b\u306fYES** \u306a\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u5177\u4f53\u7684\u306b\u3069\u3046\u3044\u3046\u9055\u3044\u304c\u3042\u308b\u306e\u304b\u8a73\u3057\u304f\u898b\u3066\u3044\u304d\u307e\u3059\u3002\u6b21\u306e\u30b3\u30fc\u30c9\u306f\u5192\u982d\u306e3\u3064\u306eMiddleware\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u30d9\u30fc\u30b9\u306b\u3001\u771f\u3093\u4e2d\u306e `m2` \u306e\u4ee3\u308f\u308a\u306b `next` \u3092\u4f7f\u3046 `m2a`\u3001`store.dispatch` \u3092\u4f7f\u3046 `m2b` \u306b\u66f8\u304d\u63db\u3048\u307e\u3057\u305f\u3002\u52d5\u4f5c\u3068\u3057\u3066\u306f\u3069\u3061\u3089\u3082 `FOO` Action\u304c\u6765\u305f\u3089 `BAR` Action\u3092\u751f\u6210\u3057\u3066\u6295\u3052\u307e\u3059\u3002\n\n```middlewares.js\nexport const m1 = store => next => action => {\n  console.log('m1', action.type);\n  return next(action);\n};\n\nexport const m2a = store => next => action => {\n  console.log('m2a', action.type);\n  if (action.type === 'FOO') {\n    next({ type: 'BAR' });\n  }\n  return next(action);\n};\n\nexport const m2b = store => next => action => {\n  console.log('m2b', action.type);\n  if (action.type === 'FOO') {\n    store.dispatch({ type: 'BAR' });\n  }\n  return next(action);\n};\n\nexport const m3 = store => next => action => {\n  console.log('m3', action.type);\n  return next(action);\n};\n```\n\n\u4e0a\u8a18Middleware\u3092\u4f7f\u3063\u3066\u307e\u305a\u306f `m2a` \u3092\u4f7f\u3063\u305f\u5834\u5408\u3001`applyMiddleware(m1, m2a, m3)` \u306e\u51fa\u529b\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```\nm1 FOO\nm2 FOO\nm3 BAR\nm3 FOO\n```\n\n\u6b21\u306b `m2b` \u3092\u4f7f\u3063\u305f\u5834\u5408\u3001`applyMiddleware(m1, m2b, m3)` \u306e\u51fa\u529b\u3067\u3059\u3002\n\n```\nm1 FOO\nm2 FOO\nm1 BAR\nm2 BAR\nm3 BAR\nm3 FOO\n```\n\n\u3053\u308c\u3067\u9055\u3044\u306f\u660e\u3089\u304b\u3067\u3059\u306d\u3002 **`next`\u306f\u5f8c\u7d9a\u306eMiddleware\u306e\u307f\u901a\u904e\u3059\u308b\u306e\u306b\u5bfe\u3057\u3001`store.dispatch`\u306fMiddleware\u30c1\u30a7\u30fc\u30f3\u306e\u6700\u521d\u304b\u3089\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002** \u3069\u3061\u3089\u3092\u4f7f\u3046\u3079\u304d\u304b\u306f\u4f55\u3092\u3057\u305f\u3044\u306e\u304b\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070 `redux-thunk` \u3067\u306f `store.dispatch` \u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u307e\u3059\u304c\u3001\u3082\u3057 `next` \u3092\u4f7f\u3048\u3066\u3057\u307e\u3046\u3068 `redux-thunk` \u3092Middleware\u30c1\u30a7\u30fc\u30f3\u306e\u3069\u3053\u306b\u7f6e\u3044\u305f\u304b\u306b\u3088\u3063\u3066\u9069\u7528\u3055\u308c\u308bMiddleware\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3044\u6df7\u4e71\u306e\u5143\u306b\u306a\u308a\u307e\u3059\u3002\u3055\u3089\u306b `store.dispatch` \u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u3063\u3066\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3055\u3089\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092dispatch\u3059\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3067\u3082\u518d\u5ea6 `redux-thunk` \u304c\u5b9f\u884c\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306b `redux-thunk` \u3067\u306f `store.dispatch` \u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u5f37\u3044\u7406\u7531\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4e00\u65b9\u3067\u65b0\u3057\u3044Action\u3092\u6295\u3052\u308b\u306e\u306b\u7d76\u5bfe\u306b `next` \u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u72b6\u6cc1\u3068\u3044\u3046\u306e\u306f\u305d\u3093\u306a\u306b\u591a\u304f\u3042\u308a\u307e\u305b\u3093\u3002 **\u3060\u304b\u3089\u3068\u3044\u3063\u3066\u5b89\u6613\u306b`store.dispatch`\u3092\u4f7f\u3046\u306e\u306f\u5371\u967a\u3067\u3059\u3002**\u6ce8\u610f\u3057\u3066\u4f5c\u3089\u306a\u3044\u3068Middleware\u304cAction\u3092dispatch\u3059\u308b\u3053\u3068\u3067\u518d\u5e30\u7684\u306bMiddleware\u81ea\u8eab\u304c\u547c\u3073\u51fa\u3055\u308c\u3066\u3057\u307e\u3046 **\u7121\u9650\u30eb\u30fc\u30d7** \u306b\u9665\u308a\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f `FOO` Action\u306e\u3068\u304d\u306e\u307f `BAR` Action\u3092dispatch\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u6761\u4ef6\u3092\u306f\u305a\u3059\u3068\u5f53\u7136\u7121\u9650\u30eb\u30fc\u30d7\u306b\u306a\u308a\u307e\u3059\u3002`redux-thunk` \u3082\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308c\u3070\u554f\u7b54\u7121\u7528\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u6b21\u306e\u3088\u3046\u306a\u610f\u5730\u60aa\u306aAction\u3092\u6295\u3052\u308b\u3068 `Uncaught RangeError: Maximum call stack size exceeded` \u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\n```\nconst recurring = dispatch => dispatch(recurring);\nthis.props.dispatch(recurring);\n```\n\n## Middleware\u304b\u3089Action\u3092\u6295\u3052\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306f2\u3064\u3042\u308b\n\nMiddleware\u5185\u304b\u3089Action\u3092\u6295\u3052\u308b\u306e\u306b2\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308b\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u304c\u3001\u307e\u3060\u5b89\u5fc3\u3067\u304d\u307e\u305b\u3093\u3002 **\u3069\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u6295\u3052\u308b\u306e\u304b** \u306b\u3088\u3063\u3066\u7d50\u679c\u304c\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u3002\u4ee5\u4e0b\u306eMiddleware\u304c\u3069\u306e\u3088\u3046\u306a\u6319\u52d5\u306b\u306a\u308b\u306e\u304b\u60f3\u50cf\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nfunction isTarget(action) {\n  return action.type === 'FOO';\n}\n\nexport const m1 = store => next => action => {\n  if (isTarget(action)) {\n    store.dispatch({ type: 'BAR1' });\n  }\n  const ret = next(action);\n  if (isTarget(action)) {\n    store.dispatch({ type: 'BAR2' });\n  }\n  return ret;\n};\n```\n\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306eAction\u3092 `next` \u3067\u9001\u308a\u51fa\u3059 **\u524d\u306b** \u65b0\u3057\u3044Action\u3092dispatch\u3059\u308b\u306e\u304b\u3001 **\u5f8c\u306b** dispatch\u3059\u308b\u306e\u304b\u3067\u5909\u308f\u3063\u3066\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u3046\u307e\u304f\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u304c `redux-logger` \u3067\u3059\u3002`redux-logger` \u306fStore\u306bdispatch\u3055\u308c\u305fAction\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001dispatch\u524d\u5f8c\u306eState\u3082\u51fa\u529b\u3057\u3066\u304f\u308c\u307e\u3059\u3002Store\u306e `getState` \u95a2\u6570\u3092 `next` \u306e\u524d\u5f8c\u3067\u305d\u308c\u305e\u308c\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u307e\u3068\u3081\n\n3\u884c\u3067\u307e\u3068\u3081\u308b\u3068\u3001\n\n+ `applyMiddleware` \u3067\u6307\u5b9a\u3059\u308bMiddleware\u306e\u4f4d\u7f6e\u306b\u6c17\u3092\u3064\u3051\u308b\n+ Action\u3092\u6295\u3052\u308b\u65b9\u6cd5\u306f `next` \u3068 `store.dispatch` \u306e2\u3064\u304c\u3042\u308b\n+ \u30aa\u30ea\u30b8\u30ca\u30eb\u306eAction\u3092 `next` \u3067\u547c\u3073\u51fa\u3059\u524d\u5f8c\u3067State\u304c\u5909\u5316\u3059\u308b\n\n## \u304a\u307e\u3051\n\n\u8907\u96d1\u306aMiddleware\u30c1\u30a7\u30fc\u30f3\u3092\u7d44\u3093\u3067\u3044\u308b\u3068\u3069\u3053\u3067Action\u304c\u751f\u6210\u3055\u308c\u305f\u306e\u304b\u3001\u6539\u5909\u3055\u308c\u305f\u306e\u304b\u3001\u6f70\u3055\u308c\u305f\u306e\u304b\u308f\u304b\u3089\u306a\u304f\u306a\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059(\u6016\u3044)\u3002\u305d\u3093\u306a\u3068\u304d\u624b\u3063\u53d6\u308a\u65e9\u304fprint\u30c7\u30d0\u30c3\u30b0\u3059\u308b\u65b9\u6cd5\u306f `redux-logger` \u3092\u3072\u305f\u3059\u3089Middleware\u306e\u9593\u306b\u5dee\u3057\u8fbc\u307f\u307e\u3059\u3002\n\n```store.js\nimport logger from 'redux-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(logger(), your, logger(), awesome, logger(), middleware, logger())\n);\n```\n\n\u3046\u308f\u3041\u3072\u3069\u3044\u30fb\u30fb\u30fb\u3002\u3051\u3069\u3001 ~~\u60e8\u72b6~~ \u72b6\u6cc1\u306f\u4e00\u5fdc\u3064\u304b\u3081\u307e\u3059\u3002\u305f\u3060\u3053\u308c\u3082Middleware\u306e\u6570\u304c\u591a\u304f\u306a\u308b\u3068\u633f\u5165\u3059\u308b\u306e\u304c\u9762\u5012\u306b\u306a\u308b\u306e\u3067\u3001\u304a\u624b\u8efd\u306b\u3084\u308b\u306b\u306f [redux-middleware-logger](https://github.com/kuy/redux-middleware-logger) \u304c\u4fbf\u5229\u3067\u3059\u3002\u4f7f\u3044\u65b9\u306f\u7c21\u5358\u3067Middleware\u306e\u30ea\u30b9\u30c8\u3092\u6e21\u3057\u307e\u3059\u3002\n\n```store.js\nimport withLogger from 'redux-middleware-logger';\n\nexport default createStore(\n  reducer,\n  applyMiddleware(...withLogger(your, awesome, middleware))\n);\n```\n\n![Screen Shot 0028-03-21 at 02.51.26.png](https://qiita-image-store.s3.amazonaws.com/0/69860/6400963e-60a6-8969-644d-c767862b9f34.png)\n\n\n\u3042\u307e\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u306d\u3002\u307f\u306a\u3055\u3093\u305d\u3093\u306a\u306b\u56f0\u3063\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u5b89\u5fc3\u3057\u307e\u3057\u305f\u3002\n"}