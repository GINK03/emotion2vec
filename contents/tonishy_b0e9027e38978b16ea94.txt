{"tags": ["AWS", "opsworks", "chef", "chef-server", "opsworks-chef"], "context": "\n\n1. \u306f\u3058\u3081\u306b\n\n\nAWS OpsWorks for Chef Automate  \u30b5\u30fc\u30d3\u30b9\u304c\u3069\u3093\u306a\u3082\u306e\u306a\u306e\u304b\u3092\u8abf\u3079\u308b\u305f\u3081\u3001Getting Started \u3092\u3084\u3063\u3066\u307f\u305f\u3053\u3068\u3001\u305d\u306e\u6642\u306b\u8e93\u3044\u305f\u3053\u3068\u3084\u6c17\u306b\u306a\u308b\u70b9\u306a\u3069\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n\u3061\u306a\u307f\u306b\u3001AWS OpsWorks for Chef Automate \u30b5\u30fc\u30d3\u30b9\u306e\u5185\u5bb9\u3001\u6240\u611f\u306a\u3069\u306f\u5225\u306e\u6a5f\u4f1a\u306b\u307e\u3068\u3081\u308b\u3002\n\n\n2. AWS OpsWorks for Chef Automate \u5229\u7528\u6642\u306e\u6ce8\u610f\u70b9\n\n2.1 Create a Chef Server\n\n\nAWS OpsWorks for Chef Automate \u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u306b\u3042\u305f\u308a\u3001Chef\u30b5\u30fc\u30d0(EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9)\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n2016\u5e7412\u6708\u6642\u70b9\u3067\u306f\u3001Chef\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306f\u3001\u6b21\u306e\uff13\u30bf\u30a4\u30d7\u9078\u3079\u308b\u3002\nt2.medium\nm4.large\nm4.2xlarge\n\n\n\nChef\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066\n\nAn AWS OpsWorks for Chef Automate server runs on an Amazon Elastic Compute Cloud instance. \nThe instance is configured to run the newest version of Amazon Linux (2016.09), Chef Server 12.x, and the most current version of Chef Automate Server, version 0.6.x.\n\n\n\n\n2.2 Region Support for AWS OpsWorks for Chef Automate\n\n\n2016\u5e7412\u6708\u6642\u70b9\u3067\u306f\u3001\u6b21\u306e\uff13\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u3044\u305a\u308c\u304b\u306b Chef\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3059\u308b\u3002\nUS East (N. Virginia) Region\nUS West (Oregon) Region\nEU (Ireland) Region\n\n\n\n\n2.3 \u6599\u91d1\n\n\nAWS OpsWorks for Chef Automate \u3067\u306f\u3001Chef \u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u6570\u3068\u305d\u308c\u3089\u306e\u30ce\u30fc\u30c9\u306e\u5b9f\u884c\u6642\u9593\u306b\u57fa\u3065\u3044\u3066\u8ab2\u91d1\u3055\u308c\u307e\u3059\u3002\nChef \u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u57fa\u76e4\u3068\u306a\u308b Amazon Elastic Compute Cloud (Amazon EC2) \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u3082\u8ab2\u91d1\u3055\u308c\u307e\u3059\u3002\u524d\u6255\u3044\u6599\u91d1\u3084\u6700\u4f4e\u6599\u91d1\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\n3. \u4e8b\u524d\u6e96\u5099\n\n\n3.1 Get an AWS Account and Your AWS Credentials\n\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210 \u21d2 \u3059\u3067\u306b\u4f5c\u6210\u6e08\u307f\u306e\u3082\u306e\u3092\u4f7f\u3046\nIAM\u30e6\u30fc\u30b6\u4f5c\u6210\u3001Access Key & Secret Access Key \u21d2 \u4eca\u56de\u306f\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\n\n\n3.2 Set Up a VPC\n\n\nChef\u30b5\u30fc\u30d0\u7528 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e VPC \u3092\u7528\u610f\u3059\u308b\u3002\n\n\n\u3053\u306eVPC\u306f\u30012.2 \u306e\u3044\u305a\u308c\u304b\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u6b21\u306eVPC\u3092\u4f5c\u6210\u3057\u305f\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u3001\u300cDNS\u89e3\u6c7a\u300d\u3092\u300c\u306f\u3044\u300d\u306b\u3057\u3066\u304a\u304f\u3053\u3068\uff08DNS resolution should be enabled.\uff09\n\n\n\n\n\u4e0a\u8a18\u306eVPC\u5185\u306b\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7528\u610f\u3059\u308b\u3002\n\n\n\u4e0a\u8a18VPC\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3066\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3002\n\u6b21\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u3092\u4f5c\u6210\u3057\u305f(\u4e0a\u8a18\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u8ffd\u52a0\uff09\u3002\n\n\n\u4eca\u56de\u306f\u3001\u6b21\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u3001\u300c\u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30af IP\u300d\u3092\u300c\u306f\u3044\u300d\u306b\u3057\u3066\u304a\u304f\u3053\u3068(On the subnet, enable Auto-assign public IP.)\u3002\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3078\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\n\n\n\n\n\n\n3.3 Set Up an EC2 Key Pair (Optional)\n\n\n\u3053\u308c\u304b\u3089\u4f5c\u6210\u3059\u308bChef\u30b5\u30fc\u30d0\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078SSH\u63a5\u7d9a\u3059\u308b\u305f\u3081\u7528\u306eSSH key\u30da\u30a2\u3092\u7528\u610f\u3059\u308b\u3002Chef\u30b5\u30fc\u30d0\u3078SSH\u63a5\u7d9a\u51fa\u6765\u306a\u304f\u3066\u3082 Chef Automate \u30b5\u30fc\u30d3\u30b9\u306f\u5229\u7528\u3067\u304d\u308b\u304c\u3001\u5ff5\u306e\u305f\u3081\u3002\nSSH key\u30da\u30a2\u306f\u30ea\u30fc\u30b8\u30e7\u30f3\u8d85\u3048\u306f\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u4f8b\u3048\u3070\u3001\u3059\u3067\u306b\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u4f5c\u6210\u3057\u3066\u3044\u3066\u3082\u3001\u4ed6\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u305d\u306eSSH key\u30da\u30a2\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u3002\n\u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306bChef\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306bSSH key\u30da\u30a2\u3092\u4f5c\u6210\u3059\u308b\u3002\u3061\u306a\u307f\u306b\u3001\u7279\u306bChef\u30b5\u30fc\u30d0\u3078SSH\u63a5\u7d9a\u3057\u306a\u304f\u3066\u3082 \n\n\n3.4 Security Group\n\nAWS OpsWorks for Chef Automate \u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n\u3053\u308c\u306f\u3001\u4f5c\u696d\u7528PC(\u4eca\u56de\u306f\u79c1\u306e\u81ea\u5b85\u306eMacBookAir(macOS Sierra, \u30d0\u30fc\u30b8\u30e7\u30f310.12.1))\u304b\u3089Chef Automate\u3078 Chef\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u767b\u9332\u3084\u3001\u30ce\u30fc\u30c9\u767b\u9332\u306a\u3069\u3092\u884c\u3046\u969b\u306b\u5fc5\u8981\u306a\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u6b21\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u305f\u3002\u9001\u4fe1\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u306f\u3001\u79c1\u306e\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u306e\u3082\u306e\u3002\n\n\n\n\n4. Chef\u30b5\u30fc\u30d0\u4f5c\u6210\n\n\n\u624b\u9806\n\n\n1) AWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30b5\u30a4\u30f3\u30a4\u30f3\nhttps://console.aws.amazon.com/opsworks/\n2) \u30b5\u30fc\u30d3\u30b9OpsWorks \u21d2 Chef Automate servers\nhttps://console.aws.amazon.com/opsworks/chefautomate/home?region=us-east-1#/\n3) Create Chef Automate server\n\n\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u30d0\u30fc\u30b8\u30cb\u30a2(US East (N. Virginia))\u3092\u9078\u629e\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306f t2.medium \u3092\u9078\u629e\n\n\n4) Select an SSH key\n\n3.3 \u3067\u4f5c\u6210\u3057\u305f SSH key \u3092\u9078\u629e\n\n\n5) Configure advanced settings - Network and security\n\nVPC, Subnet \u306f\u30013.2 \u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u9078\u629e\nSecurity group \u306f\u30013.4 \u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u9078\u629e\nService role \u3068\u3001 Instance profile \u306f\u3001\u3069\u3061\u3089\u3082 Generate a new one \u3092\u9078\u629e\n\n\u3061\u306a\u307f\u306b\u3001Service role \u3084 Instance profile \u306e\u8a2d\u5b9a\u304c\u8aa4\u3063\u3066\u3044\u308b\u3068\u3001\u3042\u3068\u3067\u884c\u3046 berks upload \u306e\u969b\u306b\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n\nRidley::Errors::HTTPInternalServerError: {\"error\":[\"internal service error\"]} \n\n\n6) Configure advanced settings - System maintenance, Automated backup\n\n\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306e\u307e\u307e\u3067\n\n7) Review - \u8a2d\u5b9a\u78ba\u8a8d\n\n\n\n8) Launch - Chef\u30b5\u30fc\u30d0\u8d77\u52d5\u958b\u59cb\n\n\u5b8c\u4e86\u307e\u3067\u3001\u7d04\uff12\uff10\u5206\u30fb\u30fb\uff08\u5b9f\u969b\u306f\u3082\u3046\u5c11\u3057\u65e9\u3044\uff09\n\n\n9) credentials \u30d5\u30a1\u30a4\u30eb\u3068\u3001Starter kit \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u696d\u7528PC\u3078\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\n5. Chef Automate dashboard \u30da\u30fc\u30b8\u3078\u30ed\u30b0\u30a4\u30f3\n\n\nChef\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001Chef Automate dashboard\u3000\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\nChef Automate dashboard \u306e URL \u306f\u3001Server information \u306e\u9805\u76ee\u306b\u3042\u308b\u3002\nhttps://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io\n\n\n\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u60c5\u5831(Username/Password)\u306f\u3001\u5148\u307b\u3069\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f credentials \u30d5\u30a1\u30a4\u30eb\u306b\u3042\u308b\u3002\n\n\n6. Chef Automate \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\n\n\n6.1 \u4f5c\u696d\u7528PC\u306b ChefDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u79c1\u306e\u4f5c\u696d\u7528PC\u306f\u3001\u81ea\u5b85\u306eMacBookAir(macOS Sierra, \u30d0\u30fc\u30b8\u30e7\u30f310.12.1)\u306a\u306e\u3067\u3001\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\nMac OS X/macOS 10.12 \u21d2 chefdk-1.0.3-1.dmg\n\n\n\n\n6.2 Starter Kit \u3092\u914d\u5099\u3059\u308b\u4f8b\n\nStarter Kit(starter_kit.zip)\u3092\u3001\u4f5c\u696d\u7528PC\u306e ~/work \u306b\u7f6e\u304f\n\u4f5c\u696d\u7528PC\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\n\n$ unzip starter_kit.zip\nArchive:  starter_kit.zip\n   creating: test-chef-automate-y2angzfa3bcmkx6e/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/.chef/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/.chef/ca_certs/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/cookbooks/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/environments/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/roles/\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/ca_certs/opsworks-cm-ca-2016-root.pem\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/Berksfile\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/chefignore\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/cookbooks/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/environments/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/roles/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/knife.rb\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/private.pem\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/userdata.sh\n\n$ cd test-chef-automate-y2angzfa3bcmkx6e\n\n$ tree . -a\n.\n\u251c\u2500\u2500 .chef\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ca_certs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 opsworks-cm-ca-2016-root.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 knife.rb\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 private.pem\n\u251c\u2500\u2500 Berksfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 chefignore\n\u251c\u2500\u2500 cookbooks\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 environments\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 roles\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u2514\u2500\u2500 userdata.sh\n\n5 directories, 10 files\n\n\n6.3 Berkshelf\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30e2\u30fc\u30c8\u30bd\u30fc\u30b9\u304b\u3089\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\u3001Chef\u30b5\u30fc\u30d0\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\nBerksfile \u30d5\u30a1\u30a4\u30eb\u306b apache2 \u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\n\n$ cat Berksfile\nsource \"https://supermarket.chef.io\"\ncookbook \"chef-client\"\ncookbook \"apache2\"\n\n\n\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u53d6\u5f97\n\n$ berks vendor\nResolving cookbook dependencies...\nFetching cookbook index from https://supermarket.chef.io...\nUsing apache2 (3.2.2)\nUsing chef-client (7.0.3)\nUsing compat_resource (12.16.2)\nUsing cron (3.0.0)\nUsing logrotate (2.1.0)\nUsing ohai (4.2.3)\nUsing windows (2.1.1)\nVendoring apache2 (3.2.2) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/apache2\nVendoring chef-client (7.0.3) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/chef-client\nVendoring compat_resource (12.16.2) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/compat_resource\nVendoring cron (3.0.0) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/cron\nVendoring logrotate (2.1.0) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/logrotate\nVendoring ohai (4.2.3) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/ohai\nVendoring windows (2.1.1) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/windows\n\n[\u6ce8\u610f]\nWeb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u3001\u300cberks install\u300d\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3051\u3069\u3001\u300cberks vendor\u300d\u306b\u7f6e\u304d\u63db\u308f\u308a\u307e\u3057\u305f\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u3002starter_kit.zip\u306e\u4e2d\u306b\u3042\u308bREADME.md\u3067\u306f\u3001\u300cberks vendor\u300d\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092Chef\u30b5\u30fc\u30d0\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n$ SSL_CERT_FILE='.chef/ca_certs/opsworks-cm-ca-2016-root.pem' berks upload\nUploaded apache2 (3.2.2) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded chef-client (7.0.3) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded compat_resource (12.16.2) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded cron (3.0.0) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded logrotate (2.1.0) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded ohai (4.2.3) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded windows (2.1.1) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\n\n\n\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u78ba\u8a8d\n\n$ knife cookbook list\napache2           3.2.2\nchef-client       7.0.3\ncompat_resource   12.16.2\ncron              3.0.0\nlogrotate         2.1.0\nohai              4.2.3\nwindows           2.1.1\n\nChef Automate dashboard \u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001\"COOKBOOK CHANGES\"\u306e\u3068\u3053\u308d\u304c 7 \u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n7. Chef \u30b5\u30fc\u30d0\u306b \u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\n\n\n7.1 \u30ce\u30fc\u30c9\uff08EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff09\u3092\u4f5c\u6210\n\n\u4eca\u56de\u306f\u3001\u30c6\u30b9\u30c8\u7528\u3068\u3057\u3066\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u9069\u5f53\u306aVPC\u306b\u9069\u5f53\u306aEC2\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\nAMI: Amazon Linux AMI 2016.09.0 (HVM), SSD Volume Type - ami-0c11b26d\n\u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30af IP: \u6709\u52b9\u5316\n\u30bf\u30b0\u540d: chef-node-test\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \u79c1\u306e\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u304b\u3089\u306eSSH\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n\n\n[\u6ce8\u610f]\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308bOS\u306e\u4e00\u89a7\n\n\n\n7.2 Chef\u30b5\u30fc\u30d0\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3001 7.1 \u3067\u4f5c\u6210\u3057\u305f EC2 \u304b\u3089\u306e HTTPS \u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u308b\u3002\n\n7.3 node\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3001\u30af\u30c3\u30af\u30d6\u30c3\u30af\u9069\u7528\n\n\u4f5c\u696d\u7528PC\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\n\n$ knife bootstrap 54.199.172.154 -N chef-node-test -x ec2-user -i ~/.ssh/aws/*** --sudo --run-list \"recipe[chef-client],recipe[apache2]\"\n..\n54.199.172.154 Running handlers:\n54.199.172.154 Running handlers complete\n54.199.172.154 Chef Client finished, 90/113 resources updated in 20 seconds\n\n$ knife node show chef-node-test\nNode Name:   chef-node-test\nEnvironment: _default\nFQDN:\nIP:          54.199.172.154\nRun List:    recipe[chef-client], recipe[apache2]\nRoles:\nRecipes:     chef-client, chef-client::default, apache2, apache2::default, chef-client::service, chef-client::init_service, apache2::mpm_prefork, apache2::mod_status, apache2::mod_alias, apache2::mod_auth_basic, apache2::mod_authn_core, apache2::mod_authn_file, apache2::mod_authz_core, apache2::mod_authz_groupfile, apache2::mod_authz_host, apache2::mod_authz_user, apache2::mod_autoindex, apache2::mod_deflate, apache2::mod_dir, apache2::mod_env, apache2::mod_mime, apache2::mod_negotiation, apache2::mod_setenvif, apache2::mod_log_config, apache2::mod_logio, apache2::mod_unixd\nPlatform:    amazon 2016.09\nTags:\n\n#1. \u306f\u3058\u3081\u306b\n* [AWS OpsWorks for Chef Automate](https://aws.amazon.com/jp/opsworks/chefautomate/)  \u30b5\u30fc\u30d3\u30b9\u304c\u3069\u3093\u306a\u3082\u306e\u306a\u306e\u304b\u3092\u8abf\u3079\u308b\u305f\u3081\u3001[Getting Started](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm.html) \u3092\u3084\u3063\u3066\u307f\u305f\u3053\u3068\u3001\u305d\u306e\u6642\u306b\u8e93\u3044\u305f\u3053\u3068\u3084\u6c17\u306b\u306a\u308b\u70b9\u306a\u3069\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n* \u3061\u306a\u307f\u306b\u3001AWS OpsWorks for Chef Automate \u30b5\u30fc\u30d3\u30b9\u306e\u5185\u5bb9\u3001\u6240\u611f\u306a\u3069\u306f\u5225\u306e\u6a5f\u4f1a\u306b\u307e\u3068\u3081\u308b\u3002\n\n#2. AWS OpsWorks for Chef Automate \u5229\u7528\u6642\u306e\u6ce8\u610f\u70b9\n##2.1 [Create a Chef Server](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm-create.html)\n* AWS OpsWorks for Chef Automate \u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u306b\u3042\u305f\u308a\u3001Chef\u30b5\u30fc\u30d0(EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9)\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n* 2016\u5e7412\u6708\u6642\u70b9\u3067\u306f\u3001Chef\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306f\u3001\u6b21\u306e\uff13\u30bf\u30a4\u30d7\u9078\u3079\u308b\u3002\n<pre>\nt2.medium\nm4.large\nm4.2xlarge\n</pre>\n* [Chef\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/welcome_opscm.html)\n * An AWS OpsWorks for Chef Automate server runs on an Amazon Elastic Compute Cloud instance. \n * The instance is configured to run the newest version of Amazon Linux (2016.09), Chef Server 12.x, and the most current version of Chef Automate Server, version 0.6.x.\n\n##2.2 [Region Support for AWS OpsWorks for Chef Automate](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/welcome_opscm.html#opscm-region)\n* 2016\u5e7412\u6708\u6642\u70b9\u3067\u306f\u3001\u6b21\u306e\uff13\u3064\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u3044\u305a\u308c\u304b\u306b Chef\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3059\u308b\u3002\n<pre>\nUS East (N. Virginia) Region\nUS West (Oregon) Region\nEU (Ireland) Region\n</pre>\n\n\n##2.3 [\u6599\u91d1](https://aws.amazon.com/jp/opsworks/chefautomate/pricing/)\n* AWS OpsWorks for Chef Automate \u3067\u306f\u3001Chef \u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u6570\u3068\u305d\u308c\u3089\u306e\u30ce\u30fc\u30c9\u306e\u5b9f\u884c\u6642\u9593\u306b\u57fa\u3065\u3044\u3066\u8ab2\u91d1\u3055\u308c\u307e\u3059\u3002\n* Chef \u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u57fa\u76e4\u3068\u306a\u308b Amazon Elastic Compute Cloud (Amazon EC2) \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5bfe\u3057\u3066\u3082\u8ab2\u91d1\u3055\u308c\u307e\u3059\u3002\u524d\u6255\u3044\u6599\u91d1\u3084\u6700\u4f4e\u6599\u91d1\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n#3. [\u4e8b\u524d\u6e96\u5099](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm.html)\n##3.1 [Get an AWS Account and Your AWS Credentials](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm.html)\n* AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210 \u21d2 \u3059\u3067\u306b\u4f5c\u6210\u6e08\u307f\u306e\u3082\u306e\u3092\u4f7f\u3046\n* IAM\u30e6\u30fc\u30b6\u4f5c\u6210\u3001Access Key & Secret Access Key \u21d2 \u4eca\u56de\u306f\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\n\n##3.2 [Set Up a VPC](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm.html#set-up-vpc)\n* Chef\u30b5\u30fc\u30d0\u7528 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e VPC \u3092\u7528\u610f\u3059\u308b\u3002\n * \u3053\u306eVPC\u306f\u3001[2.2](#22-region-support-for-aws-opsworks-for-chef-automate) \u306e\u3044\u305a\u308c\u304b\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n * \u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u6b21\u306eVPC\u3092\u4f5c\u6210\u3057\u305f\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u3001\u300cDNS\u89e3\u6c7a\u300d\u3092\u300c\u306f\u3044\u300d\u306b\u3057\u3066\u304a\u304f\u3053\u3068\uff08DNS resolution should be enabled.\uff09\n![20161211-01.png](https://qiita-image-store.s3.amazonaws.com/0/148868/d939a5b1-b7fc-267d-9d28-c5a3af9ce4f0.png)\n* \u4e0a\u8a18\u306eVPC\u5185\u306b\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7528\u610f\u3059\u308b\u3002\n * \u4e0a\u8a18VPC\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3066\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3002\n * \u6b21\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u3092\u4f5c\u6210\u3057\u305f(\u4e0a\u8a18\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u8ffd\u52a0\uff09\u3002\n![20161211-02.png](https://qiita-image-store.s3.amazonaws.com/0/148868/9cbbfce7-948d-218f-460e-9330f3a87f27.png)\n * \u4eca\u56de\u306f\u3001\u6b21\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u3002\u30dd\u30a4\u30f3\u30c8\u306f\u3001\u300c\u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30af IP\u300d\u3092\u300c\u306f\u3044\u300d\u306b\u3057\u3066\u304a\u304f\u3053\u3068(On the subnet, enable Auto-assign public IP.)\u3002\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3078\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\n![20161211-03.png](https://qiita-image-store.s3.amazonaws.com/0/148868/1d21c4eb-0bf7-d7fe-9a49-448b609ef9c8.png)\n\n##3.3 [Set Up an EC2 Key Pair (Optional)](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm.html#d0e2840)\n* \u3053\u308c\u304b\u3089\u4f5c\u6210\u3059\u308bChef\u30b5\u30fc\u30d0\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078SSH\u63a5\u7d9a\u3059\u308b\u305f\u3081\u7528\u306eSSH key\u30da\u30a2\u3092\u7528\u610f\u3059\u308b\u3002Chef\u30b5\u30fc\u30d0\u3078SSH\u63a5\u7d9a\u51fa\u6765\u306a\u304f\u3066\u3082 Chef Automate \u30b5\u30fc\u30d3\u30b9\u306f\u5229\u7528\u3067\u304d\u308b\u304c\u3001\u5ff5\u306e\u305f\u3081\u3002\n* SSH key\u30da\u30a2\u306f\u30ea\u30fc\u30b8\u30e7\u30f3\u8d85\u3048\u306f\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u4f8b\u3048\u3070\u3001\u3059\u3067\u306b\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u4f5c\u6210\u3057\u3066\u3044\u3066\u3082\u3001\u4ed6\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u305d\u306eSSH key\u30da\u30a2\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u306a\u3044\u3002\n* \u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306bChef\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306bSSH key\u30da\u30a2\u3092\u4f5c\u6210\u3059\u308b\u3002\u3061\u306a\u307f\u306b\u3001\u7279\u306bChef\u30b5\u30fc\u30d0\u3078SSH\u63a5\u7d9a\u3057\u306a\u304f\u3066\u3082 \n\n##3.4 Security Group\n* AWS OpsWorks for Chef Automate \u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n* \u3053\u308c\u306f\u3001\u4f5c\u696d\u7528PC(\u4eca\u56de\u306f\u79c1\u306e\u81ea\u5b85\u306eMacBookAir(macOS Sierra, \u30d0\u30fc\u30b8\u30e7\u30f310.12.1))\u304b\u3089Chef Automate\u3078 Chef\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u767b\u9332\u3084\u3001\u30ce\u30fc\u30c9\u767b\u9332\u306a\u3069\u3092\u884c\u3046\u969b\u306b\u5fc5\u8981\u306a\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n* \u4eca\u56de\u306f\u3001\u30d0\u30fc\u30b8\u30cb\u30a2 \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u6b21\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u305f\u3002\u9001\u4fe1\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u306f\u3001\u79c1\u306e\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u306e\u3082\u306e\u3002\n![20161211-04.png](https://qiita-image-store.s3.amazonaws.com/0/148868/d9855b92-0001-9533-b2b8-5caeef9d72ac.png)\n\n#4. [Chef\u30b5\u30fc\u30d0\u4f5c\u6210](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/gettingstarted-opscm-create.html)\n* \u624b\u9806\n\n>1) AWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30b5\u30a4\u30f3\u30a4\u30f3\nhttps://console.aws.amazon.com/opsworks/\n\n>2) \u30b5\u30fc\u30d3\u30b9OpsWorks \u21d2 Chef Automate servers\nhttps://console.aws.amazon.com/opsworks/chefautomate/home?region=us-east-1#/\n\n>3) Create Chef Automate server\n>>\u30ea\u30fc\u30b8\u30e7\u30f3\u306f\u30d0\u30fc\u30b8\u30cb\u30a2(US East (N. Virginia))\u3092\u9078\u629e\n>>EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306f t2.medium \u3092\u9078\u629e\n>>\n![20161211-05.png](https://qiita-image-store.s3.amazonaws.com/0/148868/bdf39e1f-dfbf-0b67-5c7a-e0bd6f3e6146.png)\n\n>4) Select an SSH key\n>>[3.3](#33-set-up-an-ec2-key-pair-optional) \u3067\u4f5c\u6210\u3057\u305f SSH key \u3092\u9078\u629e\n>>\n![20161211-06.png](https://qiita-image-store.s3.amazonaws.com/0/148868/82540266-5d6e-5edb-5aac-1ec0851a3108.png)\n\n>5) Configure advanced settings - Network and security\n>>VPC, Subnet \u306f\u3001[3.2](#32-set-up-a-vpc) \u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u9078\u629e\n>>Security group \u306f\u3001[3.4](#34-security-group) \u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u9078\u629e\n>>Service role \u3068\u3001 Instance profile \u306f\u3001\u3069\u3061\u3089\u3082 Generate a new one \u3092\u9078\u629e\n>>\n![20161211-07.png](https://qiita-image-store.s3.amazonaws.com/0/148868/0a5028e7-77ab-fd99-c3ff-e6a8a8cf9531.png)\n>>\n>>\u3061\u306a\u307f\u306b\u3001Service role \u3084 Instance profile \u306e\u8a2d\u5b9a\u304c\u8aa4\u3063\u3066\u3044\u308b\u3068\u3001\u3042\u3068\u3067\u884c\u3046 berks upload \u306e\u969b\u306b\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n<pre>\nRidley::Errors::HTTPInternalServerError: {\"error\":[\"internal service error\"]} \n</pre>\n\n>6) Configure advanced settings - System maintenance, Automated backup\n>>\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306e\u307e\u307e\u3067\n\n>7) Review - \u8a2d\u5b9a\u78ba\u8a8d\n>>\n![20161211-08.png](https://qiita-image-store.s3.amazonaws.com/0/148868/906f97c4-a918-cda8-f444-96a25bd4b421.png)\n\n>8) Launch - Chef\u30b5\u30fc\u30d0\u8d77\u52d5\u958b\u59cb\n>>\u5b8c\u4e86\u307e\u3067\u3001\u7d04\uff12\uff10\u5206\u30fb\u30fb\uff08\u5b9f\u969b\u306f\u3082\u3046\u5c11\u3057\u65e9\u3044\uff09\n>>\n![20161211-09.png](https://qiita-image-store.s3.amazonaws.com/0/148868/91160eea-181e-1f0d-6989-c743c4262bec.png)\n\n>9) credentials \u30d5\u30a1\u30a4\u30eb\u3068\u3001Starter kit \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u696d\u7528PC\u3078\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\n#5. [Chef Automate dashboard \u30da\u30fc\u30b8\u3078\u30ed\u30b0\u30a4\u30f3](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/opscm-chef-dashboard.html)\n* Chef\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001Chef Automate dashboard\u3000\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n![20161211-10.png](https://qiita-image-store.s3.amazonaws.com/0/148868/808facc1-7442-e4ef-178d-f42592334dd3.png)\n* Chef Automate dashboard \u306e URL \u306f\u3001Server information \u306e\u9805\u76ee\u306b\u3042\u308b\u3002\n<pre>\nhttps://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io\n</pre>\n* \u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u60c5\u5831(Username/Password)\u306f\u3001\u5148\u307b\u3069\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f credentials \u30d5\u30a1\u30a4\u30eb\u306b\u3042\u308b\u3002\n\n\n#6. [Chef Automate \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/opscm-starterkit.html)\n##6.1 \u4f5c\u696d\u7528PC\u306b ChefDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n* \u79c1\u306e\u4f5c\u696d\u7528PC\u306f\u3001\u81ea\u5b85\u306eMacBookAir(macOS Sierra, \u30d0\u30fc\u30b8\u30e7\u30f310.12.1)\u306a\u306e\u3067\u3001\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\n<pre>\nMac OS X/macOS 10.12 \u21d2 chefdk-1.0.3-1.dmg\n\n##6.2 Starter Kit \u3092\u914d\u5099\u3059\u308b\u4f8b\n* Starter Kit(starter_kit.zip)\u3092\u3001\u4f5c\u696d\u7528PC\u306e ~/work \u306b\u7f6e\u304f\n* \u4f5c\u696d\u7528PC\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\n\n```\n$ unzip starter_kit.zip\nArchive:  starter_kit.zip\n   creating: test-chef-automate-y2angzfa3bcmkx6e/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/.chef/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/.chef/ca_certs/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/cookbooks/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/environments/\n   creating: test-chef-automate-y2angzfa3bcmkx6e/roles/\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/ca_certs/opsworks-cm-ca-2016-root.pem\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/Berksfile\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/chefignore\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/cookbooks/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/environments/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/roles/README.md\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/knife.rb\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/.chef/private.pem\n  inflating: test-chef-automate-y2angzfa3bcmkx6e/userdata.sh\n\n$ cd test-chef-automate-y2angzfa3bcmkx6e\n\n$ tree . -a\n.\n\u251c\u2500\u2500 .chef\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ca_certs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 opsworks-cm-ca-2016-root.pem\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 knife.rb\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 private.pem\n\u251c\u2500\u2500 Berksfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 chefignore\n\u251c\u2500\u2500 cookbooks\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 environments\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u251c\u2500\u2500 roles\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 README.md\n\u2514\u2500\u2500 userdata.sh\n\n5 directories, 10 files\n```\n\n##6.3 Berkshelf\u3092\u4f7f\u3063\u3066\u3001\u30ea\u30e2\u30fc\u30c8\u30bd\u30fc\u30b9\u304b\u3089\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b\u3001Chef\u30b5\u30fc\u30d0\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n* Berksfile \u30d5\u30a1\u30a4\u30eb\u306b apache2 \u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\n\n```\n$ cat Berksfile\nsource \"https://supermarket.chef.io\"\ncookbook \"chef-client\"\ncookbook \"apache2\"\n```\n\n* \u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092\u53d6\u5f97\n\n```\n$ berks vendor\nResolving cookbook dependencies...\nFetching cookbook index from https://supermarket.chef.io...\nUsing apache2 (3.2.2)\nUsing chef-client (7.0.3)\nUsing compat_resource (12.16.2)\nUsing cron (3.0.0)\nUsing logrotate (2.1.0)\nUsing ohai (4.2.3)\nUsing windows (2.1.1)\nVendoring apache2 (3.2.2) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/apache2\nVendoring chef-client (7.0.3) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/chef-client\nVendoring compat_resource (12.16.2) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/compat_resource\nVendoring cron (3.0.0) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/cron\nVendoring logrotate (2.1.0) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/logrotate\nVendoring ohai (4.2.3) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/ohai\nVendoring windows (2.1.1) to /Users/toru-nishimura/work/test-chef-automate-y2angzfa3bcmkx6e/berks-cookbooks/windows\n```\n[\u6ce8\u610f]\n*[Web\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/opscm-starterkit.html)\u3067\u306f\u3001\u300cberks install\u300d\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3051\u3069\u3001\u300cberks vendor\u300d\u306b\u7f6e\u304d\u63db\u308f\u308a\u307e\u3057\u305f\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u3002starter_kit.zip\u306e\u4e2d\u306b\u3042\u308bREADME.md\u3067\u306f\u3001\u300cberks vendor\u300d\u3068\u306a\u3063\u3066\u3044\u308b\u3002*\n\n* \u30af\u30c3\u30af\u30d6\u30c3\u30af\u3092Chef\u30b5\u30fc\u30d0\u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n```\n$ SSL_CERT_FILE='.chef/ca_certs/opsworks-cm-ca-2016-root.pem' berks upload\nUploaded apache2 (3.2.2) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded chef-client (7.0.3) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded compat_resource (12.16.2) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded cron (3.0.0) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded logrotate (2.1.0) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded ohai (4.2.3) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\nUploaded windows (2.1.1) to: 'https://test-chef-automate-y2angzfa3bcmkx6e.us-east-1.opsworks-cm.io:443/organizations/default'\n```\n\n* \u30af\u30c3\u30af\u30d6\u30c3\u30af\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u78ba\u8a8d\n\n```\n$ knife cookbook list\napache2           3.2.2\nchef-client       7.0.3\ncompat_resource   12.16.2\ncron              3.0.0\nlogrotate         2.1.0\nohai              4.2.3\nwindows           2.1.1\n```\nChef Automate dashboard \u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001\"COOKBOOK CHANGES\"\u306e\u3068\u3053\u308d\u304c 7 \u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n\n#7. [Chef \u30b5\u30fc\u30d0\u306b \u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b](http://docs.aws.amazon.com/ja_jp/opsworks/latest/userguide/opscm-addnodes.htmlt)\n##7.1 \u30ce\u30fc\u30c9\uff08EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff09\u3092\u4f5c\u6210\n* \u4eca\u56de\u306f\u3001\u30c6\u30b9\u30c8\u7528\u3068\u3057\u3066\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u9069\u5f53\u306aVPC\u306b\u9069\u5f53\u306aEC2\u3092\u4f5c\u6210\u3059\u308b\u3002\n * AMI: Amazon Linux AMI 2016.09.0 (HVM), SSD Volume Type - ami-0c11b26d\n * \u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30af IP: \u6709\u52b9\u5316\n * \u30bf\u30b0\u540d: chef-node-test\n * \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \u79c1\u306e\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u304b\u3089\u306eSSH\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n* [\u6ce8\u610f]*[\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308bOS\u306e\u4e00\u89a7](https://docs.chef.io/platforms.html)*\n\n##7.2 Chef\u30b5\u30fc\u30d0\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3001 7.1 \u3067\u4f5c\u6210\u3057\u305f EC2 \u304b\u3089\u306e HTTPS \u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u308b\u3002\n\n##7.3 node\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3001\u30af\u30c3\u30af\u30d6\u30c3\u30af\u9069\u7528\n* \u4f5c\u696d\u7528PC\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\n\n```\n$ knife bootstrap 54.199.172.154 -N chef-node-test -x ec2-user -i ~/.ssh/aws/*** --sudo --run-list \"recipe[chef-client],recipe[apache2]\"\n..\n54.199.172.154 Running handlers:\n54.199.172.154 Running handlers complete\n54.199.172.154 Chef Client finished, 90/113 resources updated in 20 seconds\n\n$ knife node show chef-node-test\nNode Name:   chef-node-test\nEnvironment: _default\nFQDN:\nIP:          54.199.172.154\nRun List:    recipe[chef-client], recipe[apache2]\nRoles:\nRecipes:     chef-client, chef-client::default, apache2, apache2::default, chef-client::service, chef-client::init_service, apache2::mpm_prefork, apache2::mod_status, apache2::mod_alias, apache2::mod_auth_basic, apache2::mod_authn_core, apache2::mod_authn_file, apache2::mod_authz_core, apache2::mod_authz_groupfile, apache2::mod_authz_host, apache2::mod_authz_user, apache2::mod_autoindex, apache2::mod_deflate, apache2::mod_dir, apache2::mod_env, apache2::mod_mime, apache2::mod_negotiation, apache2::mod_setenvif, apache2::mod_log_config, apache2::mod_logio, apache2::mod_unixd\nPlatform:    amazon 2016.09\nTags:\n```\n"}