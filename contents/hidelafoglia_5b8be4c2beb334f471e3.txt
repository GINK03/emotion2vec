{"tags": ["nginx", "phpenv", "php-fpm"], "context": " More than 1 year has passed since last update.\n\u57fa\u672c\u7684\u306b\"nginx + php-fpm \u306ePHP\u3092\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u3054\u3068\u306b\u30e6\u30fc\u30b6\u30fc\u6a29\u9650\u3067\u52d5\u304b\u3059 \"\u306e\u5199\u7d4c\n\n\nphp-fpm\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\nphpenv + php-build\u3060\u3068\u666e\u901a\u306b\u5165\u3063\u3066\u3044\u308b\u3063\u307d\u3044\n\nvagrant@10:~/projects$ /home/vagrant/.phpenv/versions/5.5.19/sbin/php-fpm  --help\n\nUsage: php-fpm [-n] [-e] [-h] [-i] [-m] [-v] [-t] [-p <prefix>] [-g <pid>] [-c <file>] [-d foo[=bar]] [-y <file>] [-D] [-F]\n  -c <path>|<file> Look for php.ini file in this directory\n  -n               No php.ini file will be used\n  -d foo[=bar]     Define INI entry foo with value 'bar'\n  -e               Generate extended information for debugger/profiler\n  -h               This help\n  -i               PHP information\n  -m               Show compiled in modules\n  -v               Version number\n  -p, --prefix <dir>\n                   Specify alternative prefix path to FastCGI process manager (default: /home/vagrant/.phpenv/versions/5.5.19).\n  -g, --pid <file>\n                   Specify the PID file location.\n  -y, --fpm-config <file>\n                   Specify alternative path to FastCGI process manager config file.\n  -t, --test       Test FPM configuration and exit\n  -D, --daemonize  force to run in background, and ignore daemonize option from config file\n  -F, --nodaemonize\n                   force to stay in foreground, and ignore daemonize option from config file\n  -R, --allow-to-run-as-root\n                   Allow pool to run as root (disabled by default)\n\n\n\nphp-fpm.conf\n\n\u8a2d\u5b9a\u30b3\u30d4\u30fc\n\nvagrant@10:~/projects/wordpress$ cp /home/vagrant/.phpenv/versions/5.5.19/etc/php-fpm.conf.default  /home/vagrant/.phpenv/versions/5.5.19/etc/php-fpm.conf\n\n\n\n\"wordpress\" \u30d7\u30fc\u30eb\u3092\u8ffd\u52a0\n\n[wordpress]\nlisten = /home/vagrant/projects/wordpress/run/php-fpm.sock\nlisten.mode = 0666\nuser = vagrant\ngroup = vagrant\npm = dynamic\npm.max_children = 5\npm.start_servers = 2\npm.min_spare_servers = 1\npm.max_spare_servers = 3\n\n\n\u8d77\u52d5\u3002sudo \u3067\u8d77\u52d5\u3059\u308b\u3068\u3001 user, group \u3067\u8d77\u52d5\u3057\u3066\u304f\u308c\u308b\n\nvagrant@10:~/projects/wordpress$ sudo $PHP_PATH/sbin/php-fpm \n\nvagrant@10:~/projects/wordpress$ sudo lsof -c php-fpm | grep php-fpm.sock\nphp-fpm 29637     root   10u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\nphp-fpm 29640  vagrant    0u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\nphp-fpm 29641  vagrant    0u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\n\n\n\nsupervisor \u3068\u304b\u3067\u8d77\u52d5\u8a2d\u5b9a\u3059\u308b\u3068\u3044\u3044\u3093\u3067\u3057\u3087\u3046\n\n\nnginx\n\n\u4eee\u60f3\u30db\u30b9\u30c8(wp.deb)\u8a2d\u5b9a\n\nvagrant@10:~/projects/wordpress$ cat nginx.conf \n\nupstream php-fpm-wordpress{\n  ip_hash;\n  server unix:/home/vagrant/projects/wordpress/run/php-fpm.sock;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n\n    server_name wp.deb;\n\n    root /home/vagrant/projects/wordpress/www;\n    index index.php index.html;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n\n    access_log /home/vagrant/projects/wordpress/logs/access.log;\n    error_log  /home/vagrant/projects/wordpress/logs/error.log debug;\n\n    location ~ \\.php$ {\n        fastcgi_pass  php-fpm-wordpress;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_buffer_size  128k;\n        fastcgi_buffers  256 16k;\n        fastcgi_busy_buffers_size  256k;\n        fastcgi_temp_file_write_size  256k;\n        include  fastcgi_params;\n    }\n}\n\n\nDebian way\n\nvagrant@10:~/projects/wordpress$ sudo ln -s `pwd`/nginx.conf /etc/nginx/sites-enabled/wp.deb\n\n\nnginx\u30ea\u30b9\u30bf\u30fc\u30c8\n\nvagrant@10:~/projects/wordpress$ sudo /etc/init.d/nginx restart\nRestarting nginx (via systemctl): nginx.service.\n\n\n\u30db\u30b9\u30c8\u304b\u3089\u30a2\u30af\u30bb\u30b9\nPeeko:hide$ curl -s http://wp.deb/info.php | grep php-fpm\n\n<tr><td class=\"e\">php-fpm </td><td class=\"v\">active </td></tr>\n\n\n- \u57fa\u672c\u7684\u306b&quot;[nginx + php-fpm \u306ePHP\u3092\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u3054\u3068\u306b\u30e6\u30fc\u30b6\u30fc\u6a29\u9650\u3067\u52d5\u304b\u3059](http://qiita.com/kijtra/items/022d3cde07046e396486) &quot;\u306e\u5199\u7d4c\n\n\n# php-fpm\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\n\n- phpenv + php-build\u3060\u3068\u666e\u901a\u306b\u5165\u3063\u3066\u3044\u308b\u3063\u307d\u3044\n\n```\nvagrant@10:~/projects$ /home/vagrant/.phpenv/versions/5.5.19/sbin/php-fpm  --help\n\nUsage: php-fpm [-n] [-e] [-h] [-i] [-m] [-v] [-t] [-p <prefix>] [-g <pid>] [-c <file>] [-d foo[=bar]] [-y <file>] [-D] [-F]\n  -c <path>|<file> Look for php.ini file in this directory\n  -n               No php.ini file will be used\n  -d foo[=bar]     Define INI entry foo with value 'bar'\n  -e               Generate extended information for debugger/profiler\n  -h               This help\n  -i               PHP information\n  -m               Show compiled in modules\n  -v               Version number\n  -p, --prefix <dir>\n                   Specify alternative prefix path to FastCGI process manager (default: /home/vagrant/.phpenv/versions/5.5.19).\n  -g, --pid <file>\n                   Specify the PID file location.\n  -y, --fpm-config <file>\n                   Specify alternative path to FastCGI process manager config file.\n  -t, --test       Test FPM configuration and exit\n  -D, --daemonize  force to run in background, and ignore daemonize option from config file\n  -F, --nodaemonize\n                   force to stay in foreground, and ignore daemonize option from config file\n  -R, --allow-to-run-as-root\n                   Allow pool to run as root (disabled by default)\n\n```\n\n# php-fpm.conf\n\n- \u8a2d\u5b9a\u30b3\u30d4\u30fc\n\n```\nvagrant@10:~/projects/wordpress$ cp /home/vagrant/.phpenv/versions/5.5.19/etc/php-fpm.conf.default  /home/vagrant/.phpenv/versions/5.5.19/etc/php-fpm.conf\n\n```\n\n- \"wordpress\" \u30d7\u30fc\u30eb\u3092\u8ffd\u52a0\n\n\n```\n[wordpress]\nlisten = /home/vagrant/projects/wordpress/run/php-fpm.sock\nlisten.mode = 0666\nuser = vagrant\ngroup = vagrant\npm = dynamic\npm.max_children = 5\npm.start_servers = 2\npm.min_spare_servers = 1\npm.max_spare_servers = 3\n```\n\n- \u8d77\u52d5\u3002sudo \u3067\u8d77\u52d5\u3059\u308b\u3068\u3001 user, group \u3067\u8d77\u52d5\u3057\u3066\u304f\u308c\u308b\n\n```\nvagrant@10:~/projects/wordpress$ sudo $PHP_PATH/sbin/php-fpm \n```\n\n```\nvagrant@10:~/projects/wordpress$ sudo lsof -c php-fpm | grep php-fpm.sock\nphp-fpm 29637     root   10u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\nphp-fpm 29640  vagrant    0u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\nphp-fpm 29641  vagrant    0u  unix 0xffff880079df8480      0t0  57962 /home/vagrant/projects/wordpress/run/php-fpm.sock\n\n```\n\n- supervisor \u3068\u304b\u3067\u8d77\u52d5\u8a2d\u5b9a\u3059\u308b\u3068\u3044\u3044\u3093\u3067\u3057\u3087\u3046\n\n# nginx\n\n- \u4eee\u60f3\u30db\u30b9\u30c8(wp.deb)\u8a2d\u5b9a\n\n```\nvagrant@10:~/projects/wordpress$ cat nginx.conf \n\nupstream php-fpm-wordpress{\n  ip_hash;\n  server unix:/home/vagrant/projects/wordpress/run/php-fpm.sock;\n}\n\nserver {\n    listen 80;\n    listen [::]:80;\n\n    server_name wp.deb;\n\n    root /home/vagrant/projects/wordpress/www;\n    index index.php index.html;\n\n    location / {\n        try_files $uri $uri/ =404;\n    }\n\n    access_log /home/vagrant/projects/wordpress/logs/access.log;\n    error_log  /home/vagrant/projects/wordpress/logs/error.log debug;\n\n    location ~ \\.php$ {\n        fastcgi_pass  php-fpm-wordpress;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        fastcgi_buffer_size  128k;\n        fastcgi_buffers  256 16k;\n        fastcgi_busy_buffers_size  256k;\n        fastcgi_temp_file_write_size  256k;\n        include  fastcgi_params;\n    }\n}\n```\n\n- Debian way\n\n```\nvagrant@10:~/projects/wordpress$ sudo ln -s `pwd`/nginx.conf /etc/nginx/sites-enabled/wp.deb\n```\n\n- nginx\u30ea\u30b9\u30bf\u30fc\u30c8\n\n```\nvagrant@10:~/projects/wordpress$ sudo /etc/init.d/nginx restart\nRestarting nginx (via systemctl): nginx.service.\n```\n\n\n# \u30db\u30b9\u30c8\u304b\u3089\u30a2\u30af\u30bb\u30b9\n\n```\nPeeko:hide$ curl -s http://wp.deb/info.php | grep php-fpm\n\n<tr><td class=\"e\">php-fpm </td><td class=\"v\">active </td></tr>\n```\n"}