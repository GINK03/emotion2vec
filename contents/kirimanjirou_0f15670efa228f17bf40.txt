{"tags": ["\u81ea\u5206\u7528\u30e1\u30e2"], "context": "\uff1c\uff1c\u904e\u53bb\u306e\u30d6\u30ed\u30b0\u3092\u81ea\u5206\u3067\u8aad\u3080\u7528\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\uff1e\uff1e\nIdP\uff65\uff65\uff65\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u63d0\u4f9b\u3059\u308b\u30ab\u30c3\u30c1\u30e7\u30a4\u30fc\u4eba\u306e\u3053\u3068\u3002\nRP\uff65\uff65\uff65\u81ea\u524d\u3067\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u3092\u3042\u304d\u3089\u3081\u305f\u8ce2\u660e\u306a\u611a\u6c11\u3002\n\u4eca\u56de\u306f\u624b\u5143\u306b\u3042\u308b\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u7fa4\u3067\u3053\u3044\u3064\u3089\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\u672c\u6765\u3067\u3042\u308c\u3070IdP\u5074\u306fgoogle\u3068\u304bfacebook\u3068\u304btwitter\u3068\u304b\u3092\u4f7f\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u554f\u984c\u3042\u308b\u307e\u3044\u3002\u4eca\u56de\u306f\u307e\u3041\u3001\u30bf\u30a4\u30c8\u30eb\u3069\u304a\u308aIdP\u5074\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b\u3001\u3068\u3044\u3046\u306e\u304c\u4e3b\u65e8\u306a\u306e\u3067\u3002\n\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u3044\u3048\u3070\u3001\u201dSAML\u201d\u304b\u201dOpenID\u201d\u306a\u306e\u3060\u304c\u3001\u6b21\u4e16\u4ee3\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u3042\u308bOpenID Connect\u306fOAuth2.0\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u8a8d\u8a3c\u9023\u643a\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3082\u306e\u3060\u3002\u5148\u306b\u4e2d\u8eab\u304c\u77e5\u308a\u305f\u3044\u4eba\u306f\u3069\u3046\u305e\u3053\u3061\u3089\u306e\u30ea\u30f3\u30af(OpenID\u30d5\u30a1\u30a6\u30f3\u30c7\u30fc\u30b7\u30e7\u30f3\u30fb\u30b8\u30e3\u30d1\u30f3\u6280\u8853\u4f7f\u7528\uff1a\u548c\u8a33)\u3078\u3002\u3068\u3063\u3066\u3082\u8aad\u307f\u3084\u3059\u3044\u3002\n\u69cb\u7bc9\u773a\u3081\u3066\u306a\u3093\u3068\u306a\u304f\u96f0\u56f2\u6c17\u304c\u308f\u304b\u308c\u3070\u3044\u3044\u3084\u3001\u3068\u3044\u3046\u4eba\u306f\u3069\u3046\u305e\u3053\u306e\u307e\u307e\u8aad\u307f\u9032\u3081\u3066\u304f\u308c\u3002\n\u30fbOpenAM\u306e\u5c0e\u5165\n\u65e9\u901f\u5c0e\u5165\u3067\u3042\u308b\u3002\u4ee5\u4e0b\u306f\u53c2\u8003\u306b\u3057\u305fURL\u3002\nOpenAM \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4e8b\u524d\u306btomcat\u306a\u3069\u306eWeb\u30b5\u30fc\u30d0\u3084Java\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u9808\u3068\u306a\u308b\u3002\u5272\u611b\u3002\nOpenAM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u81ea\u4f53\u306f\u3069\u3048\u3089\u304f\u7c21\u5358\u3067\u3001war\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3060\u3051\u3060\u3002\n\u4eca\u56de\u306f/opt\u914d\u4e0b\u306b\u3042\u3089\u304b\u3058\u3081openam\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\n\nmkdir /opt/openam\ntomcat\u8cc7\u6750\u3092\u30d6\u30c1\u3053\u3093\u3060\u3002\n\u3042\u3068\u306f\u3001\u6700\u65b0\u306eOpenAM\u8cc7\u6750\u3092forgerock.org\u304b\u3089\u5165\u624b\u3059\u308b\u3002\n\ncp -p cp -p OpenAM-12.0.0-SNAPSHOT_20140315.war /opt/openam/apache-tomcat-6.0.39/webapps/\n\u3053\u308c\u3060\u3051\u3002\nopenam\u306e\u8d77\u52d5\u306b\u306f\u3044\u304f\u3064\u304b\u6307\u5b9a\u304c\u3042\u308b\u306e\u3067\u3001openam\u306e\u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u306f\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u304d\u3061\u3093\u3068\u4f5c\u308d\u3046\u3002\u307e\u308b\u3071\u304f\u308a\u3067\u306f\u3042\u308b\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n\nvi /etc/init.d/openam\n\n!/bin/sh\n\nopenam\n\nchkconfig: 35 84 16\n\ndescription: Manage OpenAM SSO Server\nCATALINA_HOME=/opt/openam/apache-tomcat-6.0.39\nexport CATALINA_HOME\nJAVA_HOME=/usr/java/default/\nexport JAVA_HOME\nJAVA_OPTS=\"-Xmx1024m -XX:MaxPermSize=256m\"\nexport JAVA_OPTS\nCATALINA_OPTS=\"-Dcom.iplanet.am.cookie.c66Encode=true\"\nexport CATALINA_OPTS\ncase \"1\"instart)\"1\"instart)\"{1}\" in \nstart) \n\"{CATALINA_HOME}/bin/startup.sh\"\nexit ?;;stop)\"?;;stop)\"{?} \n;; \nstop) \n\"{CATALINA_HOME}/bin/shutdown.sh\"\nexit ?;;\u2217)echo\"Usage:?;;\u2217)echo\"Usage:{?} \n;; \n*) \necho \"Usage: 0 { start | stop }\"\nexit 1\n;;\nesac\nview rawopenam hosted with \u2764 by GitHub\n\u5fc5\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u74b0\u5883\u5909\u6570\u306a\u306e\u3067\u3001\u5fd8\u308c\u305a\u306b\u3002\nJAVA_OPTS=\u201d-Xmx1024m -XX:MaxPermSize=256m\u201d\nexport JAVA_OPTS\nCATALINA_OPTS=\u201d-Dcom.iplanet.am.cookie.c66Encode=true\u201d\nexport CATALINA_OPTS\n\u3082\u3046\u4e00\u70b9\u3001openam\u306e\u52d5\u7684\u8a2d\u5b9a\u306b\u3042\u305f\u308ahostname\u8a2d\u5b9a\u306f\u304d\u3061\u3093\u3068\u3084\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\nhostname test.kirimanjirou.com\n\u4eca\u56de\u306f\u4e0a\u8a18\u306e\u30c9\u30e1\u30a4\u30f3(\u7121\u767b\u9332\u306a\u306e\u3067\u52d5\u304b\u306a\u3044\u3068\u601d\u3046\u3088\u3059\u307e\u306c)\u3067\u30c8\u30e9\u30a4\u3002\u4e00\u5fdc\u9023\u643a\u3059\u308b\u30b5\u30fc\u30d0\u3084\u624b\u5143\u306eWindowsPC\u306ehosts\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u66f8\u3044\u3066\u304a\u3053\u3046\u3002\u3061\u306a\u307f\u306b\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3060\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9069\u5f53\u306ahostname\u304c\u3075\u3089\u308c\u3066\u3044\u308b\u304b\u3089\u3001\u5f8c\u3067\u56f0\u308b\u3002\n\u3053\u3053\u307e\u3067\u51fa\u6765\u305f\u3089\u8d77\u52d5\u3067\u3042\u308b\u3002\n\n/etc/init.d/openam start\nUsing CATALINA_BASE: /opt/openam/apache-tomcat-6.0.39\nUsing CATALINA_HOME: /opt/openam/apache-tomcat-6.0.39\nUsing CATALINA_TMPDIR: /opt/openam/apache-tomcat-6.0.39/temp\nUsing JRE_HOME: /usr/java/default/\nUsing CLASSPATH: /opt/openam/apache-tomcat-6.0.39/bin/bootstrap.jar\n\u30ab\u30d6\u3042\u304c\u308c\uff5e(\u30d1\u30af\u30ea)\ntomcat\u306e\u63a5\u7d9a\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3057\u305f\u308a\u3001apache\u304b\u3089\u6d41\u3059\u306a\u3069\u306e\u8a2d\u5b9a\u306f\u4eca\u56de\u306f\u30d1\u30b9\u3059\u308b\u3002\u65e9\u901fopenam\u306b\u63a5\u7d9a\u3057\u3066\u307f\u3088\u3046\u3002\nhttp://test.kirimanjirou.com:8080/openam/\n\u3053\u306e\u3068\u304d\u3001\u4eee\u306b\u30ed\u30fc\u30ab\u30ebPC\u306b\u69cb\u7bc9\u3057\u3066\u3044\u305f\u5834\u5408\u3067\u3082http://127.0.0.1/openam\u3001\u3068\u63a5\u7d9a\u3057\u306a\u3044\u3088\u3046\u306b\u3002\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3046\u30a2\u30af\u30bb\u30b9URL\u3067\u8a8d\u8a3c\u9023\u643a\u6642\u306e\u30d5\u30a9\u30ef\u30fc\u30c9URL\u304c\u6c7a\u5b9a\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3060\u3002\u5909\u3048\u3089\u308c\u308b\u306e\u304b\u3069\u3046\u304b\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u521d\u3081\u304b\u3089\u5229\u7528\u4e88\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u3057\u3088\u3046\u3002\u76f4IP\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3082\u63a8\u5968\u3055\u308c\u306a\u3044\u3002\nIdp_1.fw\n\u3046\u3080\u3001\u306a\u306b\u3084\u3089\u30b7\u30e3\u30ec\u30aa\u30c4\u306a\u30da\u30fc\u30b8\u304c\u51fa\u305f\u3088\u3046\u3060\u3002\u53f3\u5074\u306e\u8a2d\u5b9a\u30dc\u30bf\u30f3\u3067\u9032\u3093\u3067\u3044\u3053\u3046\u3002\nIdp_2.fw Idp_3.fwIdp_4.fwIdp_5.fwIdp_6.fwIdp_7.fwIdp_8.fw\n\u6700\u5f8c\u307e\u3067\u3044\u3063\u305f\u3089\u8a2d\u5b9a\u30dc\u30bf\u30f3\u3092\u62bc\u305d\u3046\u3002\u6700\u8fd1\u306f\u3053\u3046\u3084\u3063\u3066Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u306a\u3093\u3067\u3082\u521d\u671f\u8a2d\u5b9a\u304c\u3067\u304d\u308b\u306e\u3001\u4fbf\u5229\u3060\u3088\u306a\u3042\u3002\nIdp_9.fw\nIdp_10.fw\n\u4e0a\u306b\u66f8\u3044\u305f\u307f\u305f\u3044\u306bhostname\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3001\u3057\u3066\u3044\u308b\u3068\u5931\u6557\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u3002(\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u30a8\u30e9\u30fc\uff11 connection refused\u304c\u51fa\u3066\u3057\u307e\u3063\u305f\u3068\u304d\u306f\u30c6\u30b9\u30c8\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u3066\u3044\u308b)\n\u306a\u304a\u3001\u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057\u305f\u3044\u5834\u5408\u306f\u4e2d\u9014\u534a\u7aef\u306b\u51fa\u6765\u4e0a\u304c\u3063\u305fopenam\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u305d\u3046\u3002(\u307e\u3060\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u7701\u7565\u3057\u3066\u3088\u3044)\n\nrm -rf /root/openam\n\nrm -rf /opt/openam/apache-tomcat-6.0.39/webapps/openam\n\u305d\u3064\u306a\u304f\u3053\u306a\u305b\u3066\u3044\u308c\u3070\u3001\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u9032\u3081\u308b\u306f\u305a\u3067\u3042\u308b\u3002\nIdP_11.fw\n\u3061\u306a\u307f\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u30e6\u30fc\u30b6\u306famadmin\u3060\u3002\u521d\u671f\u8a2d\u5b9a\u4ee5\u964d\u66f8\u3044\u3066\u306d\u3048\u304b\u3089\u6c17\u3092\u3064\u3051\u308d\u3002\n\u30fbOpenAM\u306e\u8a2d\u5b9a\n\u30ed\u30b0\u30a4\u30f3\u307e\u3067\u306f\u3053\u306e\u5206\u91ce\u306e\u77e5\u8b58\u30bc\u30ed\u3067\u3082\u304b\u306a\u308a\u697d\u30c1\u30f3\u3060\u304c\u3001\u3053\u3053\u304b\u3089\u5148\u306f\u5c11\u3057\u96e3\u3057\u3044\u3002\u30ed\u30b0\u30a4\u30f3\u76f4\u5f8c\u304b\u3089\u5c0f\u96e3\u3057\u3044\u30e1\u30cb\u30e5\u30fc\u7fa4\u306e\u884c\u5217\u3067\u3042\u308b\u3002\nIdp_12.fw\n\u3048\u30fc\u306a\u3093\u3060\u3001\u3048\u30fc\u3048\u30fc\u3001\u306a\u3093\u3060\u3002OpenIDConnect\u306f\u3069\u3053\u3060\u3002\n\u307e\u305a\u306fOpenID Connect\u3092\u306f\u3058\u3081\u308b\u305f\u3081\u306bOAuth2.0\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306e\u521d\u671f\u8a2d\u5b9a\u304c\u3044\u308b\u3088\u3046\u3060\u3002\u753b\u9762\u4e2d\u592e\u306eOAuth2\u306e\u8a2d\u5b9a\u3092\u62bc\u3059\u3002\nIdp13.fw\n\u9069\u5f53\u306b\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u3092\u5ef6\u3070\u3057\u3066\u3001\u53f3\u4e0a\u306e\u4f5c\u6210\u3092Push\u3002\n\u30fbRP\u306e\u767b\u9332\nIdp14.fw\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300cOAuth2.0\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u300d\u2192\u4e0a\u5074\u306e\u6bb5\u3067\u300c\u65b0\u898f\u2026\u300d\nIdp_16.fwIdp_17.fw\nIdp_18.fwIdp_19.fw\n\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u60c5\u5831\u3092\u767b\u9332\u3057\u3066\u304a\u304f\u3002\u540d\u79f0\u3001\u8aac\u660e\u3001\u30b9\u30b3\u30fc\u30d7\u3042\u305f\u308a\u3002\n\u307e\u3060\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u306a\u3044\u306e\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u306f\u8ff7\u3046\u3068\u3053\u308d\u3060\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3042\u3068\u3067\u4f7f\u3046\u4e88\u5b9a\u306e\u201dhttp://kirimanjirou.com/sample/signup.php\u201d\u3053\u3093\u306a\u3093\u3067\u3044\u3044\u3084\u3002\u3061\u306a\u307f\u306b\u3001\u8907\u6570\u767b\u9332\u3067\u304d\u308b\u3002\n\u4eca\u56de\u306f\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u53d6\u308a\u305f\u3044\u306e\u3067\u3044\u304f\u3064\u304bprofile\u95a2\u9023\u306e\u30b9\u30b3\u30fc\u30d7\u3092\u5165\u308c\u308b\u3002\n\u3042\u3068ID Token Signed Response Algorithm:\u306e\u9805\u76ee\u304c\u30ab\u30e9\u30c3\u30b1\u30c4\u3060\u3068\u5f8c\u8ff0\u306eID Token\u304c\u52d5\u304b\u306a\u3044\u3002\u3053\u3053\u3067\u306fHS256\u3092\u5165\u308c\u3066\u304a\u304f\u3002\n\u4fdd\u5b58\u3092\u62bc\u305b\u3070\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u767b\u9332\u304c\u5b8c\u4e86\u3060\uff01\n\u306a\u304a\u3001OpenAM\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u306e\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u3088\u3046\u3060\u3002\n\u30fbWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30b0\u30a4\u30b0\u30a4\u6398\u3063\u3066\u3044\u304f\u3002\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u300d\u2192\u300cOAuth2.0\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u300d\u304b\u3089\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u65b0\u898f\u767b\u9332\n\u307e\u3041\u3053\u308c\u304c\u4e00\u756a\u7121\u96e3\u3067\u7c21\u5358\u3060\u3002\n\u30fb\u7528\u610f\u3055\u308c\u305f\u8b0e\u306e\u767b\u9332\u753b\u9762\u3092\u62bc\u3059\nhttp://test.kirimanjirou.com:8080/openam/oauth2/registerClient.jsp\nIdP_21.fw\n\u307e\u3041\u3053\u308c\u3092\u62e1\u5f35\u3057\u306a\u3055\u3044\u3088\u3068\u3044\u3046\u30b5\u30f3\u30d7\u30eb\u30b3\u30f3\u30c6\u30f3\u30c4\u3060\u308d\u3046\u306a\u3002\n\u30fbRegistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f7f\u3046\n\u3053\u3053\u307e\u3067\u306f\u3001\u4eca\u307e\u3067\u306eOAuth\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u624b\u7d9a\u304d\u3068\u4e00\u7dd2\u3060\u308d\u3046\u3002\nclient_id\u3068client_secret\u3060\u3051\u306e\u72b6\u614b\u304b\u3089\u767b\u9332\u3059\u308b\u624b\u7d9a\u304d\u3092\u5b9f\u88c5\u3057\u305f\u6a21\u69d8\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u65b9\u6cd5\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\u3069\u3046\u3084\u3089OpenID Connect\u3067\u4f7f\u3046Dynamic Client Registration\u3068\u3044\u3046\u3084\u3064\u3060\u306a\u3053\u308c\u306f\u3002\n\u3084\u3084\u3053\u3057\u3044\u306e\u3060\u304c\u3001\u4ee5\u4e0b\u306e\u9806\u756a\u3067\u767b\u9332\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u3060\u3002\n1.client_id\u3068client_secret\u3092amadin\u6a29\u9650\u3067\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u5165\u529b\u3059\u308b\u3002\n2.Registration\u64cd\u4f5c\u7528\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3063\u3066\u4e0a\u8a18\u306eregistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u30a2\u30d7\u30ea\u540d\u3084\u5229\u7528\u30b9\u30b3\u30fc\u30d7\u3001\u3082\u308d\u3082\u308d\u306e\u60c5\u5831\u3092\u767b\u9332\u3059\u308b\u3002\n\u30dd\u30a4\u30f3\u30c8\u306ftwitter\u3084facebook\u30a2\u30d7\u30ea\u307f\u305f\u3044\u306a\u753b\u9762\u624b\u7d9a\u304d\u3058\u3083\u306a\u304f\u3066\u3082\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u767a\u884c\u624b\u7d9a\u304d\u304c\u51fa\u6765\u308b\u3053\u3068\u304b\u3002\u3061\u306a\u307f\u306b\u8a73\u7d30\u306f\u3053\u3053\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3002\n\u30fb\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\nOpenAM\u306e\u5c0e\u5165\u6642\u306b\u3082\u3068\u3082\u3068\u30b7\u30b9\u30c6\u30e0\u3067\u5165\u308c\u3066\u305f\u30e6\u30fc\u30b6\u7ba1\u7406(LDAP\u3068\u304bActiveDirectory\u3068\u304b)\u3068\u9023\u52d5\u3055\u305b\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308b\u304c\u3001\u4eca\u56de\u306f\u52d5\u304b\u3057\u3066\u306a\u3044\u3002\u305d\u306e\u4ee3\u308f\u308a\u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u30e6\u30fc\u30b6\u201dmaniopenidconnect\u201d\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\nIdp_20.fw\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u5bfe\u8c61\u300d\u2192\u300c\u65b0\u898f\u2026\u300d\nIdP_22.fw\n\uff65open connect provider\u3068\u3057\u3066\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u3067\uff01\uff01\u3053\u3053\u307e\u3067\u7528\u610f\u3067\u304d\u308c\u3070\u3068\u308a\u3042\u3048\u305aIdP\u5074\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u51fa\u6765\u305f\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u65e9\u901f\u624b\u6253\u3061\u3067\u8a8d\u53ef\u306e\u753b\u9762\u3092\u51fa\u3057\u3066\u307f\u3088\u3046\u3002\n\u73fe\u72b6\u306famadmin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u30c6\u30b9\u30c8\u30e6\u30fc\u30b6\u306emanjiopenidconnect\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u767b\u9332\u3057\u305fkirimanjirou003\u3092\u4f7f\u3046\u3002\nhttp://test.kirimanjirou.com:8080/openam/oauth2/authorize?client_id=kirimanjirou003&response_type=token&scope=phone address openid profile\nIdp_15.fw\n\u30b7\u30e7\u30c3\u30dc\u30c3\u30fc\uff01\uff01\uff01\u3060\u304c\u52d5\u3044\u3066\u3044\u308b\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3082\u3046\u5c11\u3057\u52d5\u304b\u3057\u3066\u307f\u3088\u3046\u3002\n(\u3061\u306a\u307f\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u30a2\u30d7\u30ea\u306f\u306a\u3044\u304b\u3089\u3001\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30bf\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u30a8\u30e9\u30fc\u753b\u9762\u304b\u3089\u62fe\u3063\u3066\u3044\u308b\u3002\u304a\u8a31\u3057\u3042\u308c)\nRequest:\u9069\u5f53\u306a\u74b0\u5883\u304b\u3089\ncurl -H  \u201cAuthorization:  Bearer 2b3494ef-fc56-4ad4-ba9d-93ee9608a459\u201d http://test.kirimanjirou.com:8080/openam/oauth2/userinfo\n\n{\n\u201cphone\u201d:\u201d090********\u201d,\n\u201csub\u201d:\u201dmanjiopenidconnect\u201d,\n\u201cemail\u201d:\u201dkirimanjirou@gmail.com\u201d,\n\u201caddress\u201d:\u201dOta ward,Tokyo\u201d,\n\u201dname\u201d:\u201d\u9727\u534d\u6717\u201d,\n\u201cfamily_name\u201d:\u201d\u9727\u201d,\n\u201cgiven_name\u201d:\u201d\u534d\u6717\u201d\n}\n\u3042\u3042\u3001\u305d\u3046\u306d\u305d\u3046\u306d\u3002\u3042\u308c\u3067\u3082\u809d\u5fc3\u306eopenid\u304c\u306a\u304f\u306d\u30fc\u304b\u3053\u308c\u3002\n\u3061\u306a\u307f\u306b\u3001\u304d\u3061\u3093\u3068code flow\u306b\u306e\u3063\u3068\u3063\u305fID token\u306e\u53d6\u5f97\u3082\u51fa\u6765\u308b\u3088\u3046\u3060\u3002\n\u3067\u306f\u521d\u7269\u306eID token\u306f\u3069\u3046\u3060\u308d\u3046\u304b\u3002\n\nhttp://test.kirimanjirou.com:8080/openam/oauth2/authorize?client_id=kirimanjirou003&response_type=id_token\n\nid_token=eyAiYWxnIjogIkhTMjU2IiwgImN0eSI6ICJKV1QiLCAidHlwIjogImp3dCIgfQ.eyAidG9rZW5OYW1lIjogImlkX3Rva2VuIiwgImV4cCI6IDEzOTU0NDkzNTAsICJhenAiOiAia2lyaW1hbmppcm91MDAxIiwgInN1YiI6ICJhbWFkbWluIiwgInRva2VuVHlwZSI6ICJKV1RUb2tlbiIsICJub25jZSI6ICI1WU9WNDRHbzVhV1I1N1NFNDRHWDQ0R21TVVRsanFqamdhdmpnYXJqZ2FQamdhYmpnb2c9IiwgInJlYWxtIjogIi8iLCAiYXVkIjogWyAia2lyaW1hbmppcm91MDAxIiBdLCAiaXNzIjogImh0dHA6Ly90ZXN0LmtpcmltYW5qaXJvdS5jb206ODA4MC9vcGVuYW0iLCAiaWF0IjogMTM5NTQ0ODc1MCwgIm9wcyI6ICJBUUlDNXdNMkxZNFNmY3k3dC1UOElMV3pNejJ1aTdTbGo3ckhuUkFtTGhIeHIwOC4qQUFKVFNRQUNNREVBQWxOTEFCTTVNVEV4TXpRMU5qWXpORFV3TmpJd01qZzEqIiwgImF0aCI6IDEzOTU0NDg3NTAgfQ.Ky0X5Y4AY4Nj0gHgN4vjR2YSfZ5o7jLfx_5dKHQOdK8\nBASE64\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u3002\u624b\u52d5\u3067\u5b9f\u65bd\u3059\u308b\u969b\u306f\u3001\u30d4\u30ea\u30aa\u30c9\u3092\u8de8\u3044\u3067\uff13\u3064\u306b\u5206\u5272\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u306a\u3044\u3068\u3046\u307e\u304f\u5206\u5272\u3067\u304d\u3093\u305e\u3002\nJWT\u30d8\u30c3\u30c0\u30fc\uff1a\n{\n\u201calg\u201d: \u201cHS256\u201d,\n\u201ccty\u201d: \u201cJWT\u201d,\n\u201ctyp\u201d: \u201cjwt\u201d\n}\n\u4e2d\u8eab\uff1a\n{\n\u201ctokenName\u201d: \u201cid_token\u201d,\n\u201cexp\u201d: 1395449350,\n\u201cazp\u201d: \u201ckirimanjirou003\u201d,\n\u201csub\u201d: \u201cmanjiopenidconnect\u201d,\n\u201ctokenType\u201d:\u201dJWTToken\u201d,\n\u201cnonce\u201d:\u201d5YOV44Go5aWR57SE44GX44GmSUTljqjjgavjgarjgaPjgabjgog=\u201d,\n\u201crealm\u201d: \u201c/\u201d,\n\u201caud\u201d: [ \u201ckirimanjirou003\u201d ],\n\u201ciss\u201d: \u201chttp://test.kirimanjirou.com:8080/openam\u201d,\n\u201ciat\u201d: 1395448750,\n\u201cops\u201d: \u201cAQIC5wM2LY4Sfcy7t-T8ILWzMz2ui7Slj7rHnRAmLhHxr08.AAJTSQACMDEAAlNLABM5MTExMzQ1NjYzNDUwNjIwMjg1\u201d,\n\u201cath\u201d: 1395448750\n}\n\u7f72\u540d(\u672a\u30c7\u30b3\u30fc\u30c9)\uff1a\nXrh5ev4qec1gDqpuY7qB35og6OLCjyjiCKfFYXQ177A\n\u304a\u30fc\u51fa\u3066\u304d\u305f\u51fa\u3066\u304d\u305f\u3001id_token\u3067\u3042\u308b\u3002\u7d30\u304b\u3044\u9805\u76ee\u5185\u5bb9\u306e\u8aac\u660e\u306f\u7701\u7565\u3002\u307e\u305f\u3001\u53d6\u308c\u305f\u3082\u306e\u306e\u6b63\u5f53\u6027\u3092\u691c\u8a3c\u3059\u308b\u624b\u7d9a\u304d\u3082\u3042\u308b\u3093\u3060\u304c\u3053\u308c\u306f\u6b21\u56de\u3067\u3002\n\u3046\u30fc\u3093\u3001\u3068\u3053\u308d\u3067\u3001ops\u3063\u3066\u5c5e\u6027\u306f\u306a\u3093\u3060\u308d\u3046\u3001\u3053\u308c\u3060\u3051\u308f\u304b\u3089\u306a\u3044\u306a\u3002\n\u30fb\u751f\u6210\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3068\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u53d6\u308c\u308b\u60c5\u5831\n\u3053\u3053\u3067\u3044\u3063\u305f\u3093\u3001OpenAM\u3092\u8a2d\u5b9a\u3057\u305f\u3053\u3068\u3067\u4f55\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u304b\u3092\u78ba\u8a8d\u3057\u3088\u3046\u3002\n\u3068\u3044\u3046\u304b\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u306fRP\u767b\u9332\u306e\u524d\u306b\u8aac\u660e\u3057\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\u3060\u3063\u305f\u3093\u3060\u304c\u306a\u3001\u4f55\u3067\u304b\u3057\u3089\u3093\u304cOAuth\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4e00\u56de\u305f\u305f\u304b\u306a\u3044\u3068\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304c\u52d5\u304b\u306a\u304b\u3063\u305f\u3093\u3060\u3088\u2026\u3002\n\u8aac\u660e\u3092\u306f\u3057\u3087\u3063\u3066\u3057\u307e\u3063\u305f\u304c\u3001\u4e0a\u8a18\u306e\u624b\u9806\u3092\u8e0f\u3080\u3053\u3068\u3067\u4ee5\u4e0b\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30fb\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nhttp://test.kirimanjirou.com:8080/openam/.well-known/openid-configuration\nOpenID Connect\u3092\u63d0\u4f9b\u3059\u308bIdP\u306e\u60c5\u5831\u3092\u3053\u3053\u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3002\n\u30fb\u8a8d\u53ef\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/authorize\n\u3057\u3087\u3063\u3071\u306a\u306b\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3059\u30dd\u30a4\u30f3\u30c8\u3002OAuth2.0\u3068\u540c\u3058\u3060\u306d\u3002\n\u30fb\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/access_token\n\u30c8\u30fc\u30af\u30f3\u306e\u53d6\u5f97\u3001\u66f4\u65b0\u304c\u51fa\u6765\u3066\u308b\u306e\u306fOAuth2.0\u3068\u540c\u3058\u3060\u306d\u3002\u4e0a\u8ff0\u306e\u3068\u304a\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u7528\u306e\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u308b\u65b9\u5f0f\u3068\u304b\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u306e\u3060\u306d\u3002\n\u30fb\u30e6\u30fc\u30b6\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/userinfo\n\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3002\nid token\u306b\u542b\u307e\u308c\u306a\u3044\u8a73\u7d30\u60c5\u5831\u3092\u5165\u308c\u308b\u3063\u3066\u306e\u304c\u6a19\u6e96\u7684\u306a\u4f7f\u3044\u65b9\u306a\u306e\u304b\uff1f\u3053\u3053\u306fid token\u306e\u4e2d\u8eab\u3068\u9055\u3044\u304c\u308f\u304b\u3093\u306d\u30fc\u3093\u3060\u3051\u3069\u3001\u3063\u3066\u8cea\u554f\u304c\u3053\u306a\u3044\u3060\u306etech night\u3067\u3082\u3042\u3063\u305f\u3088\u306d\u3002\n\u30fbRegistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/register\n\u4e0a\u8ff0\u306e\u3001Dynamic Registration\u306e\u305f\u3081\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u3042\u308b\u3002\n\u30fb\u30ed\u30b0\u30a2\u30a6\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/endSession\n\u307e\u3060\u52d5\u304b\u3057\u3066\u306a\u3044\u306e\u3067\u30ce\u30fc\u30b3\u30e1\u30f3\u30c8\u3002\n\u30fb\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u8a8d\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/checkSession\n\u540c\u4e0a\u3002\n\u4ee5\u4e0b\u306f\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u8aad\u3081\u308b\u8a2d\u5b9a\u5185\u5bb9\u3002\u591a\u5c11\u3081\u3093\u3069\u3046\u3060\u304cOpenID Connect\u306e\u7406\u89e3\u306b\u306f\u91cd\u8981\u306a\u9805\u76ee\u306a\u3093\u3067\u3001\u8aad\u3093\u3067\u3044\u3053\u3046\u3002\nIdP_23.fw\n\u25a0response_types_supported\nid token\u306e\u53d6\u5f97\u30d5\u30ed\u30fc\u3001\u65b9\u5f0f\u306b\u3064\u3044\u3066\u4f55\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u304c\u8a18\u8ff0\u3055\u308c\u308b\u3002\n\u25a0version\n3.0\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3054\u3056\u3044\u3084\u3059\u3002\n\u25a0subject_types_supported\n\u5229\u7528\u53ef\u80fd\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7a2e\u5225\u3002\u306a\u305c\u304b\u30c7\u30d5\u30a9\u30eb\u30c8\u306fpublic\u306e\u307f\u306e\u3088\u3046\u3060\u3002\n\u25a0issuer\nIdP\u3092\u4e00\u610f\u306b\u8868\u3059URL\u3002\u5f8b\u5100\u306b\u8868\u793a\u3057\u3066\u304f\u308c\u305f\u3068\u3044\u3046\u3053\u3068\u3067\u3002\n\u25a0jwks_uri\n\u3053\u3053\u306e\u8a2d\u5b9a\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u306e\u304b\u3069\u3046\u304b\u306f\u307e\u3060\u308f\u304b\u3063\u3066\u3044\u306a\u3044\u3002\n\u25a0check_session_iframe\n\u30ed\u30b0\u30a4\u30f3\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3002\u3069\u3093\u306a\u3082\u3093\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u304b\u3057\u3089\u3002\n\u25a0claims_supported\n\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u5c5e\u6027\u3002\u3053\u3061\u3089\u3082OpenAM\u306e\u8a2d\u5b9a\u304b\u3089\u8ffd\u52a0\u3084\u524a\u9664\u304c\u3067\u304d\u308b\u3088\u3046\u3060\u3002\n\u25a0id_token_signing_alg_values_supported\n\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u7f72\u540d\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u63d0\u793a\u3002\n\u25a0userinfo_endpoint\n\u25a0registration_endpoint\n\u25a0token_endpoint\n\u25a0end_session_endpoint\n\u25a0authorization_endpoint\n\u4e0a\u3067\u7d39\u4ecb\u3057\u305f\u5404\u7a2e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u3042\u3066\u5148\u3092\u793a\u3059\u3002\n\u306a\u304a\u3001\u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u3044\u3058\u304f\u308b\u305f\u3081\u306eGUI\u306f\u4ee5\u4e0b\u304b\u3089\u305f\u3069\u308c\u308b\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300cOAUTH2\u30d7\u30ed\u30d0\u30a4\u30c0\u300d\n\u305d\u306e\u307b\u304b\u3001OpenAM\u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u305d\u308c\u306a\u308a\u306b\u8aad\u307f\u3084\u3059\u3044\u306e\u3067\u3001\u3053\u3061\u3089\u3082\u30aa\u30b9\u30b9\u30e1\u3067\u3042\u308b\u3002\u30ef\u30b7\u3082\u7d76\u8cdb\u7cbe\u8aad\u4e2d\u3002\n\u6c17\u306b\u306a\u308b\u3053\u3068\u306f\u305f\u304f\u3055\u3093\u3042\u308b\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u9023\u643a\u306f\u3067\u304d\u305d\u3046\u306a\u306e\u3067\u3001\u65e9\u901fclient\u5074\u306e\u5b9f\u88c5\u306b\u3044\u3063\u3066\u307f\u3088\u3046\u3002\n\u524d\u56de\u306e\u30a8\u30f3\u30c8\u30ea\u3067IdP\u306e\u7d44\u307f\u4e0a\u3052\u306b\u6210\u529f\u3057\u305f\u3002\u3067\u306f\u5b9f\u969b\u306b\u7d44\u307f\u4e0a\u3052\u305fIdP\u3068\u9023\u643a\u3059\u308b\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3002\n\u4eca\u56de\u306f\u300c\u3044\u3084\u3001\u305d\u3082\u305d\u3082OAuth\u304b\u3089\u3057\u3066\u3088\u304f\u308f\u304b\u3089\u306d\u3048\u3093\u3060\u3088\u306a\u3066\u3078\u307a\u308d\u300d\u3068\u3044\u3046\u65b9\u3092\u5bfe\u8c61\u306b\u3001OpenID Connect\u5bfe\u5fdc\u30b5\u30a4\u30c8\u3092\u4f5c\u3063\u3066\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u3068\u3053\u308d\u307e\u3067\u3092\u30d5\u30a9\u30ed\u30fc\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\u3082\u3046\u305d\u3093\u306a\u306e\u77e5\u3063\u3066\u308b\uff9c\uff72\u306a\u4eba\u306f\u4eca\u56de\u306e\u30a8\u30f3\u30c8\u30ea\u306f\u8aad\u307f\u98db\u3070\u3057\u3066\u304f\u308c\u3066\u3082\u69cb\u308f\u306a\u3044\u305e\u3002\n\u306a\u304a\u3001\u30ef\u30b7\u306e\u7cde\u30fc\u30b9\u306b\u3064\u304d\u3042\u3063\u3066\u3089\u308c\u308b\u304b\u3001\u3068\u3044\u3046\u4eba\u306fYConnect\u306a\u3069\u306e\u6574\u9813\u3055\u308c\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u304b\u3089\u5b9f\u88c5\u3092\u8ffd\u3046\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3060\u3088\u3002\u4eca\u56de\u306f\u30d5\u30ed\u30fc\u3092\u4e00\u901a\u308a\u8ffd\u3046\u306e\u304c\u76ee\u7684\u306a\u306e\u3067\u3001\u30d9\u30bf\u66f8\u304d\u3057\u3066\u3044\u308b\u3088\u3002\n\u5b9f\u969b\u306b\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306b\u7d44\u307f\u8fbc\u3093\u3067\u3044\u304f\u3001\u3068\u304b\u306f\u307e\u305f\u6b21\u56de\u306b\u30c8\u30e9\u30a4\u3067\u3042\u308b\u3002\n\u4ee5\u4e0b\u3001\u672c\u984c\u3002\n\u4f5c\u308b\u3082\u306e\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u4eca\u56de\u7528\u610f\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306a\u308b\u3002\n1.\u30ed\u30b0\u30a4\u30f3\u753b\u9762\n2.\u81ea\u4f5cIdP\u306b\u30d6\u30c3\u98db\u3070\u3059\n3.\u81ea\u4f5cIdP\u304b\u3089\u30d6\u30c3\u98db\u3070\u3055\u308c\u3066\u304d\u3066\u3001\u30c8\u30fc\u30af\u30f3\u3092\u3068\u308a\u306b\u3044\u304f\n4.\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n5.\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\n1.\u30ed\u30b0\u30a4\u30f3\u753b\u9762\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u306f\u306a\u3093\u3067\u3082\u3044\u3044\u3002\u3053\u3053\u306f\u597d\u307f\u3067\u4f5c\u308b\u304c\u3088\u3044\u3002\n\u3068\u306f\u3044\u3048\u624b\u629c\u304d\u306f\u305b\u305a\u3001\u30ef\u30b7\u306e\u30cf\u30a4\u30bb\u30f3\u30b9\u306a\u30c7\u30b6\u30a4\u30f3\u3067\u30ab\u30ab\u30c3\u3068\u5b9f\u88c5\u3057\u3066\u3044\u304f\u3002\nRP_2\nindex.html\n<!doctype html>\n\n\n\nManji Sample\n\n\n\u81ea\u524dIdP\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n\n\n\n\n\n\nview rawindex.html hosted with \u2764 by GitHub\n2.\u81ea\u4f5cIdP\u306b\u30d6\u30c3\u98db\u3070\u3059\n\u3053\u3053\u304b\u3089\u304c\u672c\u4e38\u3067\u3042\u308b\u3002 \u8a00\u3044\u5fd8\u308c\u305f\u304c\u4eca\u56de\u306f\u666e\u901a\u306eWeb\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u30b5\u30f3\u30d7\u30eb\u3067\u7d44\u3080\u306e\u3067\u3001 OpenID Connect\u306e\u201dcode\u30d5\u30ed\u30fc\u201d\u3068\u3044\u3046\u5974\u3092\u5229\u7528\u3059\u308b\u3002 \u30dd\u30a4\u30f3\u30c8\u306fID Token\u306e\u53d7\u3051\u6e21\u3057\u306b\u30d6\u30e9\u30a6\u30b6\u3092\u7d4c\u7531\u3055\u305b\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3060\u3002 \u30b5\u30a4\u30c8\u5074\u306e\u624b\u9593\u306f\u4e00\u500b\u5897\u3048\u308b\u304c\u3001\u30e6\u30fc\u30b6\u306e\u30d6\u30e9\u30a6\u30b6\u306bID Token\u304c\u6b8b\u308b\u5fc3\u914d\u304c\u306a\u3044\u3002\u30d6\u30e9\u30a6\u30b6\u3092\u7d4c\u7531\u3057\u3066\u304f\u308b\u306e\u306fID Token\u3068\u4e00\u56de\u30dd\u30c3\u30ad\u30ea\u306e\u5f15\u304d\u63db\u3048\u304c\u51fa\u6765\u308b\u201dcode\u201d\u3068\u3044\u3046\u3082\u306e\u3060\u3002 \u6d41\u308c\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308b\u3002\n\u30cf\u30a4\u30bb\u30f3\u30b9\u306a\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u62bc\u3059\n\u3053\u308c\u304b\u3089ID Token\u3092\u53d6\u308a\u306b\u884c\u304f\u305c\uff01\u3068\u3044\u3046\u6c17\u5408\u3092\u81ea\u4f5cIdP\u306b\u5c4a\u3051\u308b\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3002\n\u30e6\u30fc\u30b6\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30f3\u3002\u3053\u306a\u3044\u3060\u305f\u3066\u305fOpenAM\u306e\u753b\u9762\u3060\u306d\u3002\n\u30e6\u30fc\u30b6\u304c\u5929\u2191TENGA\u30a2\u30d7\u30ea\u3092\u8a31\u3059\u304b\u3069\u3046\u304b\u306e\u30b8\u30e3\u30c3\u30b8\u30e1\u30f3\u30c8\n\u8a31\u3055\u308c\u305f\u5834\u5408\u306f\u30e6\u30fc\u30b6\u304ccode\u3092\u3082\u3063\u3066\u623b\u3063\u3066\u304f\u308b\u3001\u304a\u304b\u3048\u308a\uff01(\u30d1\u30af\u30ea)\ncode\u3092\u3082\u3063\u3066ID Token\u3092\u3068\u308a\u306b\u3044\u304f\u3002\n\u53d6\u308c\u305f\u3089\u3001\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3053\u3068\u306b\u3057\u3066\u3057\u307e\u3046\u305e\n\u3042\u30fc\u9806\u756a\u3092\u66f8\u304f\u3060\u3051\u3067\u75b2\u308c\u305f\u306d\u3001index.html\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3063\u3071\u3044\u30e2\u30df\u30e2\u30df\u306b\u3044\u304d\u305f\u3044\u306d\u6298\u89d2\u306e\u9031\u672b\u3060\u3002\n\u4eca\u56de\u5b9f\u88c5\u3059\u308bcode\u30d5\u30ed\u30fc\u306e\u307b\u304b\u306b\u3001implicit\u30d5\u30ed\u30fc\u3068\u3044\u3046\u306e\u3082\u3042\u308b\u3002\u3053\u308c\u306fcode\u3067\u306f\u306a\u304f\u3066\u30e6\u30fc\u30b6\u304cID Token\u3092\u6301\u3063\u3066\u623b\u3063\u3066\u304f\u308b\u3082\u306e\u3060\u3068\u601d\u3048\u3070\u3088\u308d\u3057\u3044\u3002\ncode\u3092\u5f15\u304d\u63db\u3048\u306bID Token\u3092\u3068\u308b\u30d5\u30ed\u30fc\u304c\u5b9f\u88c5\u3057\u306b\u304f\u3044\u5834\u5408(\u30b5\u30a4\u30c8\u3058\u3083\u306a\u304f\u3066\u5358\u767a\u306e\u753b\u9762\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u304b)\u306b\u306f\u3053\u3063\u3061\u3092\u4f7f\u304a\u3046\u3002\n\u4e00\u65b9\u3001Android\u3084iOS\u306e\u30a2\u30d7\u30ea\u307f\u305f\u3044\u306b\u3001\u958b\u767a\u30b5\u30a4\u30c9\u304b\u3089\u96e2\u308c\u305f\u3068\u3053\u308d\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u914d\u5e03\u3059\u308b\u5834\u5408\u306fImplicit\u306e\u30d5\u30ed\u30fc\u3092\u4f7f\u304a\u3046\u3002 \u3053\u308c\u306f\u3001Implicit\u306e\u30d5\u30ed\u30fc\u306b\u306fRP\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u76f8\u5f53\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f7f\u308f\u305a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5024\u3092\u57cb\u3081\u308b\u5fc5\u8981\u304c\u306a\u3044\u305f\u3081\u3067\u3042\u308b\u3002\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u753b\u9762\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u57cb\u3081\u308b\u3068\u6f0f\u308c\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304b\u3089\u306a\u3002\u3068\u308a\u3042\u3048\u305a\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u304c\u7b2c3\u8005\u306b\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u304cRP\u30b5\u30a4\u30c9\u306e\u30e2\u30e9\u30eb\u3067\u3042\u308d\u3046\u3002(\u4eca\u56de\u306f\u30c0\u30c0\u6f0f\u308c\u3060\u3088\uff01)\n\u30d5\u30ed\u30fc\u306e\u9078\u629e\u306b\u3042\u305f\u308a\u3001\u3053\u3053\u306f\u9593\u9055\u3048\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\u3044\u304b\u3093\u8a71\u304c\u305d\u308c\u305f\u3002\u30b3\u30fc\u30c9\u3002\nlogin.php\n<?php\n//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308b\nsession_start();\n//IdP\u60c5\u5831\n$authorization_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/authorize\";\n//RP\u60c5\u5831\nclientid=\"kirimanjirou003\";clientid=\"kirimanjirou003\";client_id = \"kirimanjirou003\"; \nredirect_uri = \"https://kirimanjirou.com/sample/signup.php\";\n//state\u306e\u4f5c\u6210 \u7279\u5b9a\u6587\u5b57+\u65e5\u4ed8\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u306a32\u30b1\u30bf\u3092\u751f\u6210\nstate=substr((md5(\"manjistate\".date(\"YmdDHis\"))),0,32);state=substr((md5(\"manjistate\".date(\"YmdDHis\"))),0,32);state =  substr((md5(\"manjistate\" . date(\"YmdD His\"))), 0, 32); \nSESSION['state'] = state;//nonce\u306e\u4f5c\u6210\u4f5c\u308a\u65b9\u306fstate\u3068\u540c\u3058\u306b\u3057\u305fstate;//nonce\u306e\u4f5c\u6210\u4f5c\u308a\u65b9\u306fstate\u3068\u540c\u3058\u306b\u3057\u305fstate; \n//nonce\u306e\u4f5c\u6210 \u4f5c\u308a\u65b9\u306fstate\u3068\u540c\u3058\u306b\u3057\u305f \nnonce = substr((md5(\"manjinonce\" . date(\"YmdD His\"))), 0, 32);\n$SESSION['nonce'] = nonce;//\u540c\u610f\u753b\u9762\u306e\u8868\u793a\u65b9\u5f0f\u3092\u6307\u5b9a\u3059\u308bnonce;//\u540c\u610f\u753b\u9762\u306e\u8868\u793a\u65b9\u5f0f\u3092\u6307\u5b9a\u3059\u308bnonce; \n//\u540c\u610f\u753b\u9762\u306e\u8868\u793a\u65b9\u5f0f\u3092\u6307\u5b9a\u3059\u308b \ndisplay = \"page\";\n//\u81ea\u4f5cIdP\u5074\u306e\u518d\u8a8d\u8a3c\u6709\u7121\u306a\u3069\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u6307\u5b9a\u3067\u304d\u308b\nprompt=\"selectaccount\";//grant\u306e\u6307\u5b9a\u3092\u884c\u3046\u3002\u4eca\u56de\u306fcodeprompt=\"selectaccount\";//grant\u306e\u6307\u5b9a\u3092\u884c\u3046\u3002\u4eca\u56de\u306fcodeprompt = \"select_account\"; \n//grant\u306e\u6307\u5b9a\u3092\u884c\u3046\u3002\u4eca\u56de\u306fcode \nresponsetype = \"code\";\n//scope\u3092\u6307\u5b9a\u3059\u308b\nscope=array(\"phone\",\"email\",\"address\",\"openid\",//\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304c\u3042\u308c\u3070IDToken\u306f\u53d6\u308c\u308b\"profile\");//http\u30af\u30a8\u30ea\u306e\u4f5c\u6210scope=array(\"phone\",\"email\",\"address\",\"openid\",//\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304c\u3042\u308c\u3070IDToken\u306f\u53d6\u308c\u308b\"profile\");//http\u30af\u30a8\u30ea\u306e\u4f5c\u6210scope = array( \n        \"phone\", \n        \"email\", \n        \"address\", \n        \"openid\", //\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304c\u3042\u308c\u3070ID Token\u306f\u53d6\u308c\u308b \n        \"profile\" \n); \n//http\u30af\u30a8\u30ea\u306e\u4f5c\u6210 \nquery = httpbuild_query(array(\n        \"client_id\"=>clientid,\"redirecturi\"=>clientid,\"redirecturi\"=>client_id, \n        \"redirect_uri\"=> redirect_uri,\n        \"state\"=>state,\"nonce\"=>state,\"nonce\"=>state, \n        \"nonce\"=>nonce,\n        \"display\"=>display,\"prompt\"=>display,\"prompt\"=>display, \n        \"prompt\"=>prompt,\n        \"response_type\"=>responsetype,\"scope\"=>implode(\"\",responsetype,\"scope\"=>implode(\"\",response_type, \n        \"scope\"=>implode(\" \", scope ),\n));\n//\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5fdc\u7b54\u306e\u4f5c\u6210\nheader( \"Location: \" . authorizationendpoint.\"?\".authorizationendpoint.\"?\".authorization_endpoint . \"?\" . query );\nexit();\n?>\nview rawlogin.php hosted with \u2764 by GitHub\n\u3053\u3053\u306f\u30b7\u30f3\u30d7\u30eb\u3067\u3042\u308b\u3002OpenID Connect\u3067\u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30bf\u3092\u8abf\u3079\u3066\u304f\u307f\u4e0a\u3052\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3060\u3051\u3060\u3002\n\u307b\u3063\u3068\u3093\u3069\u304c\u30d1\u30e9\u30e1\u30bf\u306e\u30cf\u30e1\u8fbc\u307f\u3060\u3051\u3002\n3.\u81ea\u4f5cIdP\u304b\u3089\u30d6\u30c3\u98db\u3070\u3055\u308c\u3066\u304d\u3066\u3001\u30c8\u30fc\u30af\u30f3\u3092\u3068\u308a\u306b\u3044\u304f\n\u30bf\u30a4\u30c8\u30eb\u306f\u9577\u3044\u304c\u3001\u51e6\u7406\u306f\u610f\u5916\u306b\u697d\u30c1\u30f3\u30b3\u3067\u3042\u308b\u3002\u3068\u601d\u3044\u304d\u3084\u4e00\u90e8\u3046\u3054\u3044\u3066\u306d\u30fc\u3093\u3060\u304c\u3002\nsignup.php(\u524d\u534a)\n<?php\n//curl\u3092\u4f7f\u3046\u305e\nch=curlinit();//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308bsessionstart();ch=curlinit();//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308bsessionstart();ch = curl_init(); \n//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308b \nsession_start(); \nsession_state = $SESSION['state'];\nsessionnonce=sessionnonce=session_nonce = SESSION['nonce'];\n//IdP\u60c5\u5831\n$token_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/access_token\";\n$issue = \"http://test.kirimanjirou.com:8080/openam\";\n$userinfo_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/userinfo\";\n//RP\u60c5\u5831\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5165\u308c\u3066\u3082\u307e\u3041\u3044\u3044\u306e\u304b\u3082\u3060\u304c\u3053\u3053\u306f\u597d\u307f\u3067\u9759\u7684\u306b\u8a18\u8f09\u3059\u308b\u3053\u3068\u306b\u3057\u305f\nclientid=\"kirimanjirou003\";clientid=\"kirimanjirou003\";client_id = \"kirimanjirou003\"; \nclient_secret = \"kirimanjirou003\";\n$redirect_uri = \"https://kirimanjirou.com/sample/signup.php\";\n//\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30bf\n$reqcode = $GET['code'];\nreqstate=reqstate=req_state = GET['state'];\n//state\u306e\u691c\u8a3c \u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u5f15\u304d\u7d99\u3044\u3060state\u3068\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066\u304d\u305f\u30d1\u30e9\u30e1\u30bf\u306f\u540c\u3058\uff1f\nif ($sessionstate != reqstate)$NGMSG=\"stateisNG\";//code\u306f\u3061\u3083\u3093\u3068\u3064\u3044\u3066\u304d\u3066\u3044\u308b\u3088\u306d\uff1fif(reqstate)$NGMSG=\"stateisNG\";//code\u306f\u3061\u3083\u3093\u3068\u3064\u3044\u3066\u304d\u3066\u3044\u308b\u3088\u306d\uff1fif(req_state) { $NG_MSG = \"state is NG\"; } \n//code\u306f\u3061\u3083\u3093\u3068\u3064\u3044\u3066\u304d\u3066\u3044\u308b\u3088\u306d\uff1f \nif (reqcode == null) { $NG_MSG = \"code does not exsit\"; }\n//\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\n//Header\u4f5c\u6210: clientid,client_secret\u3092\":\"\u3067\u3064\u306a\u3044\u3067BASE64\u30a8\u30f3\u30b3\u30fc\u30c9\u3059\u308b\nclientcred=base64encode(client_cred = base64_encode( client_id . \":\" . clientsecret);client_secret); \nheaders = array(\n        \"Expect:\",\n        \"Authorization: Basic \" . clientcred);//\u30d1\u30e9\u30e1\u30bf\u8a2d\u5b9aclient_cred \n        ); \n//\u30d1\u30e9\u30e1\u30bf\u8a2d\u5b9a \npostdata = http_build_query(array(\n        \"grant_type\"=>\"authorization_code\", //\u56fa\u5b9a\n        \"redirect_uri\"=>redirecturi,\"code\"=>redirect_uri, \n        \"code\"=>req_code\n        ));\n//token_endpoint\u30ea\u30af\u30a8\u30b9\u30c8\u4f5c\u6210\ncurl_setopt( ch,CURLOPTURL,ch, CURLOPT_URL, token_endpoint );\ncurl_setopt( ch,CURLOPTHTTPHEADER,ch, CURLOPT_HTTPHEADER, headers );\ncurl_setopt( ch,CURLOPTPOST,1);curlsetopt(ch, CURLOPT_POST, 1 ); \ncurl_setopt( ch, CURLOPT_POSTFIELDS, postdata);curlsetopt(postdata ); \ncurl_setopt( ch, CURLOPT_RETURNTRANSFER, true );\n//\u5b9f\u884c\ntokenendpointresult=jsondecode(curlexec(token_endpoint_result = json_decode( curl_exec( ch ));\n//ID Token\u3092\u30f4\u30a7\u30ea\u30d5\u30a1\u30fc\u30a4\uff57\uff57\uff57\uff57\u3057\u3066\u3044\u304f\nidtoken=id_token = token_endpoint_result->id_token;\naccesstoken=access_token = token_endpoint_result->access_token;\n~~~~\nview rawsignup.php hosted with \u2764 by GitHub\n\u3053\u3053\u307e\u3067\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068ID Token\u304c\u53d6\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\u3084\u3063\u305f\u306d\uff01\n\u3053\u308c\u304b\u3089ID Token\u3092\u30f4\u30a7\u30ea\u30d5\u30a1\u30fc\u30a4\uff57\uff57\uff57\uff57\uff57\u3057\u3066\u3044\u304f\u306e\u3060\u3002\n\u3068\u3053\u308d\u304c\u3001\u3053\u3053\u3067\u30b3\u30b1\u3066\u3057\u3082\u3046\u305f\u3002Token\u7f72\u540d\u306e\u691c\u8a3c\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\nIdP\u306b\u3088\u3063\u3066\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3067\u7f72\u540d\u3059\u308b\u3082\u306e\u3082\u3042\u308b\u306e\u3060\u304c\u3001OpenAM\u3067\u306fID Token\u306e\u7f72\u540d\u30b7\u30b0\u30cd\u30c1\u30e3\u306eKey\u306b\u30b5\u30fc\u30d0\u306e\u9375\u60c5\u5831\u3092\u4f7f\u3046\u3088\u3046\u306b\u898b\u3048\u308b\u3002\u305d\u3053\u3067@ritou\u6c0f\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u516c\u958b\u9375\u3092\u4f7f\u3063\u3066\u30b7\u30b0\u30cd\u30c1\u30e3\u3092\u4f5c\u308b\u306e\u3060\u3001\u3068\u7406\u5c48\u307e\u3067\u306f\u308f\u304b\u3063\u3066\u8a66\u3057\u3066\u308b\u3093\u3060\u304c\u3069\u3046\u3082\u52d5\u304b\u306a\u3044\u3002\nOpenAM\u5074\u3067\u3069\u3046\u7f72\u540d\u3057\u3066\u3044\u308b\u306e\u304b\u308f\u304b\u308b\u307e\u3067\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u3063\u3061\u307e\u3046\u306a\u2026\u3053\u3053\u306f\u7d50\u69cb\u30ad\u30e2\u306e\u90e8\u5206\u3060\u3068\u601d\u3063\u3066\u305f\u3060\u3051\u306b\u3059\u3093\u306a\u308a\u3044\u304b\u306a\u3044\u306e\u306f\u5b9f\u306b\u6b8b\u5ff5\u3002\u3060\u304c\u3001\u3044\u3063\u305f\u3093\u30ae\u30d6\u30a2\u30c3\u30d7\u3068\u3055\u305b\u3066\u304f\u308c\u3001\u3059\u307e\u306a\u3044\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u6539\u3056\u3093\u306f\u3055\u308c\u3066\u3044\u306a\u3044\u4f53\u3067\u5404claims\u306e\u691c\u8a3c\u3092\u3057\u3066\u3044\u304f\u3002\nsignup.php(\u5f8c\u534a)\n<?php\n//\u3057\u304b\u305f\u306d\u3048\u304b\u3089\u624b\u3067\u3061\u304e\u308b\nlist(header,header, payload, tokensignature)=explode(\u2032.\u2032,token_signature) = explode('.', id_token);\n//BASE64\u30c7\u30b3\u30fc\u30c9\u3059\u308b\nheadercont=base64decode(strpad(strtr(header_cont = base64_decode(str_pad(strtr(header, '-', '+/'), strlen( header)header ) % 4, '=', STR_PAD_RIGHT)); \npayload_cont = base64_decode(str_pad(strtr($payload, '-', '+/'), strlen( payload)payload ) % 4, '=', STR_PAD_RIGHT)); \nheader_json = json_decode( headercont);header_cont ); \npayload_json = json_decode( payloadcont);//nonce\u306e\u691c\u8a3cif(payload_cont ); \n//nonce\u306e\u691c\u8a3c \nif ( session_nonce != payloadjson\u2212>nonce)$NGMSG=\"nonceisNG\";//issue\u306e\u691c\u8a3cif(payload_json->nonce ) { $NG_MSG = \"nonce is NG\"; } \n//issue\u306e\u691c\u8a3c \nif ( issue != payloadjson\u2212>iss)$NGMSG=\"issisNG\";//aud\u306e\u691c\u8a3cif(true==isarray(payload_json->iss ) { $NG_MSG = \"iss is NG\"; } \n//aud\u306e\u691c\u8a3c \nif (true == is_array( payload_json->aud ))\n{\n        if (true != in_array( clientid,client_id,payload_json->aud )) { NG_MSG\u00a0=\u00a0\"aud[]\u00a0is\u00a0NG\";\u00a0}\u00a0\n}else{\u00a0\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0if\u00a0(\u00a0$client_id\u00a0!=\u00a0$payload_json->aud\u00a0)\u00a0{\u00a0$NG_MSG\u00a0=\u00a0\u00a0\"aud\u00a0is\u00a0NG\";\u00a0}\u00a0\n}\u00a0\n//azp\u306e\u691c\u8a3c\u00a0\nif\u00a0(array(\"azp\",NG_MSG = \"aud[] is NG\"; } \n}else{ \n        if ( $client_id != $payload_json->aud ) { $NG_MSG =  \"aud is NG\"; } \n} \n//azp\u306e\u691c\u8a3c \nif (array(\"azp\",payload_cont))\n{\n        if (clientid!=client_id != payload_json->azp ) { NG_MSG\u00a0=\u00a0\"azp\u00a0is\u00a0NG\";\u00a0}\u00a0\n}\u00a0\nif\u00a0(NG_MSG = \"azp is NG\"; } \n} \nif ( NG_MSG == null)\n{\n        //userinfo_endpoint\u30ea\u30af\u30a8\u30b9\u30c8\u4f5c\u6210\n        //Header\u4f5c\u6210:\nch=curlinit();ch = curl_init(); \n        headers = array(\n                \"Expect:\",\n                \"Authorization: Basic \" . accesstoken);curlsetopt(access_token \n                ); \n        curl_setopt( ch, CURLOPT_URL, userinfoendpoint.\"?accesstoken=\".userinfo_endpoint . \"?access_token=\" . access_token );\n        curl_setopt( ch,CURLOPTHTTPHEADER,ch, CURLOPT_HTTPHEADER, headers );\n        curl_setopt( ch,CURLOPTRETURNTRANSFER,true);//\u5b9f\u884cch, CURLOPT_RETURNTRANSFER, true ); \n        //\u5b9f\u884c \n        userinfo_endpoint_result = json_decode( curl_exec( ch));//\u30e1\u30a4\u30f3\u30da\u30fc\u30b8\u3078\u306e\u60c5\u5831\u5f15\u7d99\u304ech )); \n        //\u30e1\u30a4\u30f3\u30da\u30fc\u30b8\u3078\u306e\u60c5\u5831\u5f15\u7d99\u304e \n        SESSION['id_token_encode'] = idtoken;id_token; \n        _SESSION['access_token'] = accesstoken;access_token; \n        _SESSION['id_token'] = payloadjson;payload_json; \n        _SESSION['userinfo'] = $userinfo_endpoint_result;\n        //\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5fdc\u7b54\u306e\u4f5c\u6210\n        header( \"Location: \" . \"https://kirimanjirou.com/sample/cont.php\" );\n        exit();\n}else{\nprint<<\n        \n\n\n        ERROR\n\n\n        $NGMSG\n\n\nEOF;\n}\n?>\nview rawsignup_2.php hosted with \u2764 by GitHub\nnonce\u306e\u691c\u8a3c\uff1a\n\u30ea\u30d7\u30ec\u30a4\u30a2\u30bf\u30c3\u30af\u9632\u6b62\u3067\u3042\u308b\u3002\u3053\u308c\u304c\u3046\u307e\u304f\u52d5\u3044\u3066\u3044\u308b\u3068\u5225\u30e6\u30fc\u30b6\u304cTokenEndpoint\u306bcode\u3092\u6295\u3052\u3064\u3051\u305f\u3068\u3057\u3066\u3082\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u305d\u308c\u3092\u691c\u77e5\u3067\u304d\u308b\u3002\u30e6\u30fc\u30b6\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u5024\u3068ID token\u306e\u4e2d\u8eab\u3092\u6bd4\u8f03\u3059\u308b\u3053\u3068\u3067\u6210\u7acb\u3059\u308b\u3093\u3060\u306d\u3002\nissue\u306e\u691c\u8a3c\uff1a\nID Toekn\u306eclaim\u306b\u542b\u307e\u308c\u308bIdP\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u30d9\u30fc\u30b9URL\u3092\u691c\u8a3c\u3059\u308b\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u30d9\u30bf\u66f8\u304d\u3057\u3066\u6bd4\u8f03\u3059\u308c\u3070OK\u3060\u308d\u3046\u3002OpenID\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u3042\u3089\u304b\u3058\u3081\u30c7\u30a3\u30b9\u30ab\u30d0\u3063\u305f\u308a\u3059\u308b\u5834\u5408\u306f\u3001\u305d\u308c\u3068\u6bd4\u8f03\u3057\u3088\u3046\u3002\naudience\u306e\u691c\u8a3c\uff1a\nID Toekn\u306eclaim\u306b\u542b\u307e\u308c\u308b\u5024\u3068\u81ea\u8eab\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u6bd4\u8f03\u3059\u308b\u3002@tkudos\u6c0f\u306eTumbler\u3067\u30b3\u30e1\u30f3\u30c8\u3044\u305f\u3060\u3044\u3066\u3044\u305f\u306e\u3067\u30cf\u30de\u3089\u305a\u306b\u3059\u3093\u3060\u306e\u3060\u304c\u3001OpenAM\u3067\u306faud claim\u306f\u3072\u3068\u3064\u3067\u3082\u914d\u5217\u3067\u8fd4\u3063\u3066\u6765\u308b\u3002aud\u3068azp\u306e\u6271\u3044\u306b\u3064\u3044\u3066\u306f\u8ff7\u3063\u305f\u304c\u4eca\u56de\u306f\u4e21\u65b9\u8a55\u4fa1\u3059\u308b\u3053\u3068\u306b\u3002azp\u3092\u3064\u3051\u3066\u3053\u306a\u3044IdP\u304c\u3044\u308b\u3053\u3068\u3084\u3084\u3001aud\u304c\u914d\u5217\u3058\u3083\u306a\u3044\u5834\u5408\u306f\u60f3\u5b9a\u3057\u3066\u304a\u304f\u3079\u304d\u3060\u308d\u3046\u3002\n\u6642\u523b\u306e\u691c\u8a3c\uff1a\n\u4eca\u56de\u306f\u7d44\u307f\u8fbc\u3093\u3067\u306a\u3044\u3002IdP\u306e\u793a\u3059\u767a\u884c\u65e5\u6642\u304c\u5927\u5e45\u306b\u73fe\u5728\u6642\u523b\u3068\u30ba\u30ec\u3066\u3044\u308b\u5834\u5408\u306f\u7121\u52b9\u3068\u3059\u308b\u3001\u306a\u3069\u3002\n\u6b63\u5e38\u306bID\u30c8\u30fc\u30af\u30f3\u304c\u691c\u8a3c\u3067\u304d\u305f\u306e\u3067\u3042\u308c\u3070\u3001\u53d6\u308c\u305f\u60c5\u5831\u3092\u30e6\u30fc\u30b6\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u3076\u3061\u8fbc\u3093\u3067\u3057\u307e\u304a\u3046\u3002\n\u3053\u3053\u3067\u306fUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3082\u547c\u3093\u3067\u3001\u30e6\u30fc\u30b6\u60c5\u5831\u3082\u53d6\u5f97\u3059\u308b\u3002\nUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3046\u306e\u3067\u3001\u307b\u3093\u3068\u3046\u306f\u30c8\u30fc\u30af\u30f3\u304c\u5207\u308c\u3066\u3044\u305f\u3089\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u3067\u518d\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3092\u5165\u308c\u3066\u3082\u3088\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306f\u3044\u3089\u306a\u3044\u3057\u3001\u30e0\u30e9\u30e0\u30e9\u3057\u3066\u304d\u305f\u306e\u3067\u4eca\u65e5\u306f\u30b5\u30dc\u308b\u3002\n4.ID Token\u3092\u691c\u8a3c\u3059\u308b\n\u30aa\u30b5\u30ec\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30fc\u30b8\u3092\u4f5c\u308a\u3001ID Token\u306esubject\u3068UserInfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u5185\u5bb9\u3092\u8d64\u88f8\u3005\u306b\u8868\u793a\u3059\u308b\u3002\nRP_1\nOh\u2026\ncont.php\n<?php\n//curl\u3092\u4f7f\u3046\u305e\nch=curlinit();//\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9adatedefaulttimezoneset(\u2032Asia/Tokyo\u2032);sessionstart();ch = curl_init(); \n//\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a \ndate_default_timezone_set('Asia/Tokyo'); \nsession_start(); \nid_token_encode = $SESSION['id_token_encode'];\nidtoken=id_token = SESSION['id_token'];\naccesstoken=access_token = SESSION['access_token'];\nuserinfo=userinfo = _SESSION['userinfo'];\nNGMSG=null;NG_MSG = null; \nCONTENT = null;\nif ( null == _SESSION\u00a0)\u00a0\n{_SESSION ) \n{ \nNG_MSG = <<\n\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u7121\u52b9\u3067\u3059\u3002\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\nEOF;\n}else{\n$logindate = date(\"Y-m-d h:i:s\",idtoken\u2212>iat);id_token->iat); \nCONTENT = <<<EOF\n\u30ed\u30b0\u30a4\u30f3\u30b5\u30fc\u30d3\u30b9: $idtoken->iss\n\u30ed\u30b0\u30a4\u30f3\u65e5\u6642: $login_date\n\n\n\n\n\n\n\n USERID\n$id_token->sub\n\n \u304a\u540d\u524d\n$userinfo->name\n\n TEL\n$userinfo->phone\n\n MAIL\n$userinfo->email\n\n ADDRESS\n$userinfo->address\n\n\n\n\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\n\nIDTOKEN: $idtoken_encode\nEOF;\n}\nprint<<\n        \n\n\n        TOP\n\n\n\u81ea\u524dIdP\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u304b\uff1f\nNGMSGNG_MSG \n        CONTENT\n\n\nEOF;\n?>\nview rawcont.php hosted with \u2764 by GitHub\n\u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30fc\u30b8\u3067\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u6709\u52b9\u306aID\u30c8\u30fc\u30af\u30f3\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u5fc5\u8981\u3067\u3042\u308c\u3070\u4f5c\u3063\u3066\u304d\u305fphp\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u8a8d\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3001\u4e8c\u91cd\u306b\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u308b\u3053\u3068\u3092\u30d1\u30b9\u3055\u305b\u3088\u3046\u3002\u8907\u6570\u306eIdP\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u88c5\u3092\u30b5\u30dc\u3089\u306a\u3044\u307b\u3046\u304c\u3044\u3044\u3068\u3044\u3046\u306e\u304c\u500b\u4eba\u7684\u306a\u610f\u898b\u3067\u3042\u308b\u3002IdP\u304c\u8907\u6570\u9078\u629e\u3067\u304d\u308b\u30b7\u30fc\u30f3\u3067\u306f\u304d\u3061\u3093\u3068\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3002\nIdP\u5074\u304c\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u3044\u305f\u3089RP\u5074\u3067\u3082\u2026\u3068\u3044\u3046\u30c1\u30a7\u30c3\u30af\u30bb\u30c3\u30b7\u30e7\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8a66\u3057\u305f\u304b\u3063\u305f\u304c\u3001OpenAM\u306b\u6295\u3052\u308b\u30d1\u30e9\u30e1\u30bf\u304c\u308f\u304b\u3093\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4fdd\u7559\u3002\n5.\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\n\u30ed\u30b0\u30a2\u30a6\u30c8\u30dc\u30bf\u30f3\u3067\u3042\u308b\u3002\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30b9\u30c8\u30ed\u30fc\u30a4\uff57\uff57\uff57\uff57\u3060\u3051\u3067\u3068\u308a\u3042\u3048\u305a\u3044\u3044\u3002 \u4eca\u5f8cOpenAM\u3068\u306e\u30b7\u30f3\u30b0\u30eb\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u7814\u7a76\u3057\u3066\u3044\u3053\u3046\u3002\n<?php\nsession_start();\nsession_destroy();\nprint<<\n        \n\n\n        TOP\n\n\n\u30ed\u30b0\u30a2\u30a6\u30c8\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\n\n\nEOF;\n?>\nview rawlogout.php hosted with \u2764 by GitHub\n\u304a\u307e\u3051\nOpenAM\u306e\u30ed\u30b0\u30a4\u30f3\u306b\u5229\u7528\u3057\u305f\u3064\u304f\u308a\u306f\u4ed6\u306eIdP\u3067\u3082\u52d5\u304f\u3093\u304b\uff1f\u3068\u3044\u3046\u3053\u3068\u3067google\u306eAPI\u3092\u8a66\u3057\u3066\u307f\u305f\u3002\nRP\u60c5\u5831\u3084IdP\u60c5\u5831\u3092\u30ab\u30ab\u30c3\u3068\u3044\u3058\u308c\u3070\u52d5\u304f\u306e\u304b\u3001\u3068\u3044\u3046\u307b\u3069\u7518\u304f\u306f\u306a\u304f\u3001\n\u30fbgoogle\u306fnonce\u3092\u6295\u3052\u308b\u3068\u6012\u308b\n\u30fbUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u306fAuthorization\u30d8\u30c3\u30c0\u3067\u306f\u306a\u304f\u30af\u30a8\u30ea\u3067\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u6e21\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\n\u306a\u3069\u3001\u7d30\u304b\u3044\u90e8\u5206\u306f\u3084\u3063\u3071\u308a\u9055\u3046\u3088\u3046\u3060\u3002\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306flogin\u3068signup\u306e\uff12\u3064\u306f\u500b\u5225\u306b\u5b9f\u88c5\u305b\u306b\u3083\u3042\u306a\u3089\u3093\u304b\u3063\u305f\u3002\n\u4ee5\u4e0a\u3067\u3042\u308b\u3002\n\u52d5\u304f\u3082\u306e\u306f\u4e00\u5fdc\u30b3\u30b3\u3078\u3002\n\u81ea\u4f5cIdP\u306f\u78ba\u8a8d\u3067\u304d\u306a\u3044\u3051\u3069google\u306e\u307b\u3046\u306f\u78ba\u8a8d\u3067\u304d\u308b\u3088\uff01\u3084\u3089\u306a\u304f\u3066\u3082\u3044\u3044\u3051\u3069\u3002\n\u3068\u308a\u3042\u3048\u305a\u3053\u3093\u306a\u611f\u3058\u3002\u4e00\u56de\u4f5c\u3063\u3066\u3057\u307e\u3048\u3070\u3044\u308d\u3093\u306aIdP\u3067\u4f7f\u3044\u307e\u308f\u305b\u308b\u3060\u308d\u3046\u3057\u3001\u6b63\u5e38\u30eb\u30fc\u30c8\u3060\u3051\u306a\u3089\u66f8\u304f\u91cf\u3082\u307b\u3068\u3093\u3069\u306a\u3044\u306d\u3002\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2013\n\uff1cOpenAM\u306e\u4eca\u5f8c\u306e\u30cd\u30bf\u3001\u60c5\u5831\u52df\u96c6\u4e2d\uff1e\n\u203b\u30b7\u30b0\u30cd\u30c1\u30e3\u306e\u691c\u8a3c\u3092\u3001\u3068\u308a\u3042\u3048\u305a\u512a\u5148\u5ea6\u9ad8\u3067\u8abf\u67fb\u3059\u308b\u3002\n\u203bdisplay\u306b\u306f\u5c11\u306a\u304f\u3068\u3082popup\u30d1\u30e9\u30e1\u30bf\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u3088\u3046\u3060\u3002wap\u3068touch\u306f\u8a66\u3057\u3066\u3044\u306a\u3044\u3002\n\u203bprompt\u306e\u52d5\u4f5c\u306f\u78ba\u8a8d\u3067\u304d\u306a\u304b\u3063\u305f\u3002login\u306b\u3057\u305f\u3068\u3053\u308d\u8a8d\u8a3c\u753b\u9762\u304c\u5fc5\u305a\u51fa\u308b\u3068\u3053\u307e\u3067\u306f\u78ba\u8a8d\u3057\u305f\u304c\u3001\u305d\u306e\u3042\u3068\u306bconsent_required\u306e\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u5148\u306b\u9032\u3081\u3093\u3002\n\u203bsession_check_endpoint\u306b\u306fOpenAM\u304b\u3089\u5171\u6709\u3059\u308b\u305f\u3081\u306e\u30bf\u30cd\u3092\u3082\u3089\u3063\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306f\u305a\u306a\u3093\u3060\u3051\u3069\u3001\u898b\u5f53\u305f\u3089\u306a\u3044\u3002id_token\u3092POST\u3059\u308b\u3068RFC\u306esession management\u306b\u8f09\u3063\u3066\u308bjsp\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u305d\u306e\u307e\u307e\u8fd4\u3063\u3066\u304f\u308b\u3001\u3088\u304f\u308f\u304b\u3089\u3093\u3002\n\u203blogout_endpoint\u306fid_token\u3092\u53d7\u3051\u53d6\u308b\u3088\u3046\u3060\u304c\u3001error_description: \u201cUnable to get SsoTokenManager\u201d\u3068\u51fa\u3066\u3057\u307e\u3044\u5148\u306b\u9032\u307e\u306a\u3044\u3002\n\uff1c\uff1c\u904e\u53bb\u306e\u30d6\u30ed\u30b0\u3092\u81ea\u5206\u3067\u8aad\u3080\u7528\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\uff1e\uff1e\n\nIdP\uff65\uff65\uff65\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u63d0\u4f9b\u3059\u308b\u30ab\u30c3\u30c1\u30e7\u30a4\u30fc\u4eba\u306e\u3053\u3068\u3002\nRP\uff65\uff65\uff65\u81ea\u524d\u3067\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u3092\u3042\u304d\u3089\u3081\u305f\u8ce2\u660e\u306a\u611a\u6c11\u3002\n\n\u4eca\u56de\u306f\u624b\u5143\u306b\u3042\u308b\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u7fa4\u3067\u3053\u3044\u3064\u3089\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\u672c\u6765\u3067\u3042\u308c\u3070IdP\u5074\u306fgoogle\u3068\u304bfacebook\u3068\u304btwitter\u3068\u304b\u3092\u4f7f\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u554f\u984c\u3042\u308b\u307e\u3044\u3002\u4eca\u56de\u306f\u307e\u3041\u3001\u30bf\u30a4\u30c8\u30eb\u3069\u304a\u308aIdP\u5074\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b\u3001\u3068\u3044\u3046\u306e\u304c\u4e3b\u65e8\u306a\u306e\u3067\u3002\n\n\u30d5\u30a7\u30c7\u30ec\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u3044\u3048\u3070\u3001\u201dSAML\u201d\u304b\u201dOpenID\u201d\u306a\u306e\u3060\u304c\u3001\u6b21\u4e16\u4ee3\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u3042\u308bOpenID Connect\u306fOAuth2.0\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u8a8d\u8a3c\u9023\u643a\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3082\u306e\u3060\u3002\u5148\u306b\u4e2d\u8eab\u304c\u77e5\u308a\u305f\u3044\u4eba\u306f\u3069\u3046\u305e\u3053\u3061\u3089\u306e\u30ea\u30f3\u30af(OpenID\u30d5\u30a1\u30a6\u30f3\u30c7\u30fc\u30b7\u30e7\u30f3\u30fb\u30b8\u30e3\u30d1\u30f3\u6280\u8853\u4f7f\u7528\uff1a\u548c\u8a33)\u3078\u3002\u3068\u3063\u3066\u3082\u8aad\u307f\u3084\u3059\u3044\u3002\n\u69cb\u7bc9\u773a\u3081\u3066\u306a\u3093\u3068\u306a\u304f\u96f0\u56f2\u6c17\u304c\u308f\u304b\u308c\u3070\u3044\u3044\u3084\u3001\u3068\u3044\u3046\u4eba\u306f\u3069\u3046\u305e\u3053\u306e\u307e\u307e\u8aad\u307f\u9032\u3081\u3066\u304f\u308c\u3002\n\n\u30fbOpenAM\u306e\u5c0e\u5165\n\n\u65e9\u901f\u5c0e\u5165\u3067\u3042\u308b\u3002\u4ee5\u4e0b\u306f\u53c2\u8003\u306b\u3057\u305fURL\u3002\nOpenAM \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4e8b\u524d\u306btomcat\u306a\u3069\u306eWeb\u30b5\u30fc\u30d0\u3084Java\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u9808\u3068\u306a\u308b\u3002\u5272\u611b\u3002\nOpenAM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u81ea\u4f53\u306f\u3069\u3048\u3089\u304f\u7c21\u5358\u3067\u3001war\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3060\u3051\u3060\u3002\n\u4eca\u56de\u306f/opt\u914d\u4e0b\u306b\u3042\u3089\u304b\u3058\u3081openam\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\n#mkdir /opt/openam\ntomcat\u8cc7\u6750\u3092\u30d6\u30c1\u3053\u3093\u3060\u3002\n\n\u3042\u3068\u306f\u3001\u6700\u65b0\u306eOpenAM\u8cc7\u6750\u3092forgerock.org\u304b\u3089\u5165\u624b\u3059\u308b\u3002\n#cp -p cp -p OpenAM-12.0.0-SNAPSHOT_20140315.war /opt/openam/apache-tomcat-6.0.39/webapps/\n\u3053\u308c\u3060\u3051\u3002\n\nopenam\u306e\u8d77\u52d5\u306b\u306f\u3044\u304f\u3064\u304b\u6307\u5b9a\u304c\u3042\u308b\u306e\u3067\u3001openam\u306e\u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u306f\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u304d\u3061\u3093\u3068\u4f5c\u308d\u3046\u3002\u307e\u308b\u3071\u304f\u308a\u3067\u306f\u3042\u308b\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n#vi /etc/init.d/openam\n#!/bin/sh\n#\n# openam\n#\n# chkconfig: 35 84 16\n# description: Manage OpenAM SSO Server\nCATALINA_HOME=/opt/openam/apache-tomcat-6.0.39\nexport CATALINA_HOME\n \nJAVA_HOME=/usr/java/default/\nexport JAVA_HOME\n \nJAVA_OPTS=\"-Xmx1024m -XX:MaxPermSize=256m\"\nexport JAVA_OPTS\n \nCATALINA_OPTS=\"-Dcom.iplanet.am.cookie.c66Encode=true\"\nexport CATALINA_OPTS\n \ncase \"${1}\" in\nstart)\n\"${CATALINA_HOME}/bin/startup.sh\"\nexit ${?}\n;;\nstop)\n\"${CATALINA_HOME}/bin/shutdown.sh\"\nexit ${?}\n;;\n*)\necho \"Usage: $0 { start | stop }\"\nexit 1\n;;\nesac\nview rawopenam hosted with \u2764 by GitHub\n\u5fc5\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u74b0\u5883\u5909\u6570\u306a\u306e\u3067\u3001\u5fd8\u308c\u305a\u306b\u3002\nJAVA_OPTS=\u201d-Xmx1024m -XX:MaxPermSize=256m\u201d\nexport JAVA_OPTS\n\nCATALINA_OPTS=\u201d-Dcom.iplanet.am.cookie.c66Encode=true\u201d\nexport CATALINA_OPTS\n\n\u3082\u3046\u4e00\u70b9\u3001openam\u306e\u52d5\u7684\u8a2d\u5b9a\u306b\u3042\u305f\u308ahostname\u8a2d\u5b9a\u306f\u304d\u3061\u3093\u3068\u3084\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n# hostname test.kirimanjirou.com\n\u4eca\u56de\u306f\u4e0a\u8a18\u306e\u30c9\u30e1\u30a4\u30f3(\u7121\u767b\u9332\u306a\u306e\u3067\u52d5\u304b\u306a\u3044\u3068\u601d\u3046\u3088\u3059\u307e\u306c)\u3067\u30c8\u30e9\u30a4\u3002\u4e00\u5fdc\u9023\u643a\u3059\u308b\u30b5\u30fc\u30d0\u3084\u624b\u5143\u306eWindowsPC\u306ehosts\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u66f8\u3044\u3066\u304a\u3053\u3046\u3002\u3061\u306a\u307f\u306b\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3060\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9069\u5f53\u306ahostname\u304c\u3075\u3089\u308c\u3066\u3044\u308b\u304b\u3089\u3001\u5f8c\u3067\u56f0\u308b\u3002\n\n\u3053\u3053\u307e\u3067\u51fa\u6765\u305f\u3089\u8d77\u52d5\u3067\u3042\u308b\u3002\n# /etc/init.d/openam start\n\nUsing CATALINA_BASE: /opt/openam/apache-tomcat-6.0.39\nUsing CATALINA_HOME: /opt/openam/apache-tomcat-6.0.39\nUsing CATALINA_TMPDIR: /opt/openam/apache-tomcat-6.0.39/temp\nUsing JRE_HOME: /usr/java/default/\nUsing CLASSPATH: /opt/openam/apache-tomcat-6.0.39/bin/bootstrap.jar\n\n\u30ab\u30d6\u3042\u304c\u308c\uff5e(\u30d1\u30af\u30ea)\n\ntomcat\u306e\u63a5\u7d9a\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3057\u305f\u308a\u3001apache\u304b\u3089\u6d41\u3059\u306a\u3069\u306e\u8a2d\u5b9a\u306f\u4eca\u56de\u306f\u30d1\u30b9\u3059\u308b\u3002\u65e9\u901fopenam\u306b\u63a5\u7d9a\u3057\u3066\u307f\u3088\u3046\u3002\nhttp://test.kirimanjirou.com:8080/openam/\n\n\u3053\u306e\u3068\u304d\u3001\u4eee\u306b\u30ed\u30fc\u30ab\u30ebPC\u306b\u69cb\u7bc9\u3057\u3066\u3044\u305f\u5834\u5408\u3067\u3082http://127.0.0.1/openam\u3001\u3068\u63a5\u7d9a\u3057\u306a\u3044\u3088\u3046\u306b\u3002\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3046\u30a2\u30af\u30bb\u30b9URL\u3067\u8a8d\u8a3c\u9023\u643a\u6642\u306e\u30d5\u30a9\u30ef\u30fc\u30c9URL\u304c\u6c7a\u5b9a\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3060\u3002\u5909\u3048\u3089\u308c\u308b\u306e\u304b\u3069\u3046\u304b\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u521d\u3081\u304b\u3089\u5229\u7528\u4e88\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u3057\u3088\u3046\u3002\u76f4IP\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3082\u63a8\u5968\u3055\u308c\u306a\u3044\u3002\n\nIdp_1.fw\n\u3046\u3080\u3001\u306a\u306b\u3084\u3089\u30b7\u30e3\u30ec\u30aa\u30c4\u306a\u30da\u30fc\u30b8\u304c\u51fa\u305f\u3088\u3046\u3060\u3002\u53f3\u5074\u306e\u8a2d\u5b9a\u30dc\u30bf\u30f3\u3067\u9032\u3093\u3067\u3044\u3053\u3046\u3002\n\nIdp_2.fw Idp_3.fwIdp_4.fwIdp_5.fwIdp_6.fwIdp_7.fwIdp_8.fw\n\n\u6700\u5f8c\u307e\u3067\u3044\u3063\u305f\u3089\u8a2d\u5b9a\u30dc\u30bf\u30f3\u3092\u62bc\u305d\u3046\u3002\u6700\u8fd1\u306f\u3053\u3046\u3084\u3063\u3066Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u306a\u3093\u3067\u3082\u521d\u671f\u8a2d\u5b9a\u304c\u3067\u304d\u308b\u306e\u3001\u4fbf\u5229\u3060\u3088\u306a\u3042\u3002\n\nIdp_9.fw\n\nIdp_10.fw\n\n\u4e0a\u306b\u66f8\u3044\u305f\u307f\u305f\u3044\u306bhostname\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3001\u3057\u3066\u3044\u308b\u3068\u5931\u6557\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u3002(\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u30a8\u30e9\u30fc\uff11 connection refused\u304c\u51fa\u3066\u3057\u307e\u3063\u305f\u3068\u304d\u306f\u30c6\u30b9\u30c8\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u3066\u3044\u308b)\n\u306a\u304a\u3001\u6700\u521d\u304b\u3089\u3084\u308a\u76f4\u3057\u305f\u3044\u5834\u5408\u306f\u4e2d\u9014\u534a\u7aef\u306b\u51fa\u6765\u4e0a\u304c\u3063\u305fopenam\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u305d\u3046\u3002(\u307e\u3060\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u7701\u7565\u3057\u3066\u3088\u3044)\n#rm -rf /root/openam\n#rm -rf /opt/openam/apache-tomcat-6.0.39/webapps/openam\n\n\u305d\u3064\u306a\u304f\u3053\u306a\u305b\u3066\u3044\u308c\u3070\u3001\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u9032\u3081\u308b\u306f\u305a\u3067\u3042\u308b\u3002\n\nIdP_11.fw\n\n\u3061\u306a\u307f\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u30e6\u30fc\u30b6\u306famadmin\u3060\u3002\u521d\u671f\u8a2d\u5b9a\u4ee5\u964d\u66f8\u3044\u3066\u306d\u3048\u304b\u3089\u6c17\u3092\u3064\u3051\u308d\u3002\n\n\u30fbOpenAM\u306e\u8a2d\u5b9a\n\u30ed\u30b0\u30a4\u30f3\u307e\u3067\u306f\u3053\u306e\u5206\u91ce\u306e\u77e5\u8b58\u30bc\u30ed\u3067\u3082\u304b\u306a\u308a\u697d\u30c1\u30f3\u3060\u304c\u3001\u3053\u3053\u304b\u3089\u5148\u306f\u5c11\u3057\u96e3\u3057\u3044\u3002\u30ed\u30b0\u30a4\u30f3\u76f4\u5f8c\u304b\u3089\u5c0f\u96e3\u3057\u3044\u30e1\u30cb\u30e5\u30fc\u7fa4\u306e\u884c\u5217\u3067\u3042\u308b\u3002\n\nIdp_12.fw\n\u3048\u30fc\u306a\u3093\u3060\u3001\u3048\u30fc\u3048\u30fc\u3001\u306a\u3093\u3060\u3002OpenIDConnect\u306f\u3069\u3053\u3060\u3002\n\u307e\u305a\u306fOpenID Connect\u3092\u306f\u3058\u3081\u308b\u305f\u3081\u306bOAuth2.0\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306e\u521d\u671f\u8a2d\u5b9a\u304c\u3044\u308b\u3088\u3046\u3060\u3002\u753b\u9762\u4e2d\u592e\u306eOAuth2\u306e\u8a2d\u5b9a\u3092\u62bc\u3059\u3002\n\nIdp13.fw\n\n\u9069\u5f53\u306b\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u3092\u5ef6\u3070\u3057\u3066\u3001\u53f3\u4e0a\u306e\u4f5c\u6210\u3092Push\u3002\n\n\u30fbRP\u306e\u767b\u9332\n\nIdp14.fw\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300cOAuth2.0\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u300d\u2192\u4e0a\u5074\u306e\u6bb5\u3067\u300c\u65b0\u898f\u2026\u300d\n\nIdp_16.fwIdp_17.fw\nIdp_18.fwIdp_19.fw\n\n\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u60c5\u5831\u3092\u767b\u9332\u3057\u3066\u304a\u304f\u3002\u540d\u79f0\u3001\u8aac\u660e\u3001\u30b9\u30b3\u30fc\u30d7\u3042\u305f\u308a\u3002\n\n\u307e\u3060\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u306a\u3044\u306e\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u306f\u8ff7\u3046\u3068\u3053\u308d\u3060\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3042\u3068\u3067\u4f7f\u3046\u4e88\u5b9a\u306e\u201dhttp://kirimanjirou.com/sample/signup.php\u201d\u3053\u3093\u306a\u3093\u3067\u3044\u3044\u3084\u3002\u3061\u306a\u307f\u306b\u3001\u8907\u6570\u767b\u9332\u3067\u304d\u308b\u3002\n\u4eca\u56de\u306f\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u53d6\u308a\u305f\u3044\u306e\u3067\u3044\u304f\u3064\u304bprofile\u95a2\u9023\u306e\u30b9\u30b3\u30fc\u30d7\u3092\u5165\u308c\u308b\u3002\n\u3042\u3068ID Token Signed Response Algorithm:\u306e\u9805\u76ee\u304c\u30ab\u30e9\u30c3\u30b1\u30c4\u3060\u3068\u5f8c\u8ff0\u306eID Token\u304c\u52d5\u304b\u306a\u3044\u3002\u3053\u3053\u3067\u306fHS256\u3092\u5165\u308c\u3066\u304a\u304f\u3002\n\u4fdd\u5b58\u3092\u62bc\u305b\u3070\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u767b\u9332\u304c\u5b8c\u4e86\u3060\uff01\n\n\u306a\u304a\u3001OpenAM\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u306e\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u3088\u3046\u3060\u3002\n\n\u30fbWeb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30b0\u30a4\u30b0\u30a4\u6398\u3063\u3066\u3044\u304f\u3002\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u300d\u2192\u300cOAuth2.0\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u300d\u304b\u3089\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u65b0\u898f\u767b\u9332\n\u307e\u3041\u3053\u308c\u304c\u4e00\u756a\u7121\u96e3\u3067\u7c21\u5358\u3060\u3002\n\n\u30fb\u7528\u610f\u3055\u308c\u305f\u8b0e\u306e\u767b\u9332\u753b\u9762\u3092\u62bc\u3059\nhttp://test.kirimanjirou.com:8080/openam/oauth2/registerClient.jsp\n\nIdP_21.fw\n\n\u307e\u3041\u3053\u308c\u3092\u62e1\u5f35\u3057\u306a\u3055\u3044\u3088\u3068\u3044\u3046\u30b5\u30f3\u30d7\u30eb\u30b3\u30f3\u30c6\u30f3\u30c4\u3060\u308d\u3046\u306a\u3002\n\n\u30fbRegistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f7f\u3046\n\n\u3053\u3053\u307e\u3067\u306f\u3001\u4eca\u307e\u3067\u306eOAuth\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u624b\u7d9a\u304d\u3068\u4e00\u7dd2\u3060\u308d\u3046\u3002\nclient_id\u3068client_secret\u3060\u3051\u306e\u72b6\u614b\u304b\u3089\u767b\u9332\u3059\u308b\u624b\u7d9a\u304d\u3092\u5b9f\u88c5\u3057\u305f\u6a21\u69d8\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u65b9\u6cd5\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\u3069\u3046\u3084\u3089OpenID Connect\u3067\u4f7f\u3046Dynamic Client Registration\u3068\u3044\u3046\u3084\u3064\u3060\u306a\u3053\u308c\u306f\u3002\n\n\u3084\u3084\u3053\u3057\u3044\u306e\u3060\u304c\u3001\u4ee5\u4e0b\u306e\u9806\u756a\u3067\u767b\u9332\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u3060\u3002\n1.client_id\u3068client_secret\u3092amadin\u6a29\u9650\u3067\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u5165\u529b\u3059\u308b\u3002\n2.Registration\u64cd\u4f5c\u7528\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3063\u3066\u4e0a\u8a18\u306eregistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u30a2\u30d7\u30ea\u540d\u3084\u5229\u7528\u30b9\u30b3\u30fc\u30d7\u3001\u3082\u308d\u3082\u308d\u306e\u60c5\u5831\u3092\u767b\u9332\u3059\u308b\u3002\n\u30dd\u30a4\u30f3\u30c8\u306ftwitter\u3084facebook\u30a2\u30d7\u30ea\u307f\u305f\u3044\u306a\u753b\u9762\u624b\u7d9a\u304d\u3058\u3083\u306a\u304f\u3066\u3082\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u767a\u884c\u624b\u7d9a\u304d\u304c\u51fa\u6765\u308b\u3053\u3068\u304b\u3002\u3061\u306a\u307f\u306b\u8a73\u7d30\u306f\u3053\u3053\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u30fb\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\nOpenAM\u306e\u5c0e\u5165\u6642\u306b\u3082\u3068\u3082\u3068\u30b7\u30b9\u30c6\u30e0\u3067\u5165\u308c\u3066\u305f\u30e6\u30fc\u30b6\u7ba1\u7406(LDAP\u3068\u304bActiveDirectory\u3068\u304b)\u3068\u9023\u52d5\u3055\u305b\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308b\u304c\u3001\u4eca\u56de\u306f\u52d5\u304b\u3057\u3066\u306a\u3044\u3002\u305d\u306e\u4ee3\u308f\u308a\u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u30e6\u30fc\u30b6\u201dmaniopenidconnect\u201d\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n\nIdp_20.fw\n\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u5bfe\u8c61\u300d\u2192\u300c\u65b0\u898f\u2026\u300d\n\nIdP_22.fw\n\n \n\n\uff65open connect provider\u3068\u3057\u3066\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u3067\uff01\uff01\u3053\u3053\u307e\u3067\u7528\u610f\u3067\u304d\u308c\u3070\u3068\u308a\u3042\u3048\u305aIdP\u5074\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u51fa\u6765\u305f\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u65e9\u901f\u624b\u6253\u3061\u3067\u8a8d\u53ef\u306e\u753b\u9762\u3092\u51fa\u3057\u3066\u307f\u3088\u3046\u3002\n\u73fe\u72b6\u306famadmin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u30c6\u30b9\u30c8\u30e6\u30fc\u30b6\u306emanjiopenidconnect\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u767b\u9332\u3057\u305fkirimanjirou003\u3092\u4f7f\u3046\u3002\n\nhttp://test.kirimanjirou.com:8080/openam/oauth2/authorize?client_id=kirimanjirou003&response_type=token&scope=phone address openid profile\n\nIdp_15.fw\n\n\u30b7\u30e7\u30c3\u30dc\u30c3\u30fc\uff01\uff01\uff01\u3060\u304c\u52d5\u3044\u3066\u3044\u308b\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3082\u3046\u5c11\u3057\u52d5\u304b\u3057\u3066\u307f\u3088\u3046\u3002\n(\u3061\u306a\u307f\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u30a2\u30d7\u30ea\u306f\u306a\u3044\u304b\u3089\u3001\u4ee5\u4e0b\u306e\u30d1\u30e9\u30e1\u30bf\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u30a8\u30e9\u30fc\u753b\u9762\u304b\u3089\u62fe\u3063\u3066\u3044\u308b\u3002\u304a\u8a31\u3057\u3042\u308c)\n\n<Request:\u9069\u5f53\u306a\u74b0\u5883\u304b\u3089>\ncurl -H  \u201cAuthorization:  Bearer 2b3494ef-fc56-4ad4-ba9d-93ee9608a459\u201d http://test.kirimanjirou.com:8080/openam/oauth2/userinfo\n\n<Response>\n{\n\u201cphone\u201d:\u201d090********\u201d,\n\u201csub\u201d:\u201dmanjiopenidconnect\u201d,\n\u201cemail\u201d:\u201dkirimanjirou@gmail.com\u201d,\n\u201caddress\u201d:\u201dOta ward,Tokyo\u201d,\n\u201dname\u201d:\u201d\u9727\u534d\u6717\u201d,\n\u201cfamily_name\u201d:\u201d\u9727\u201d,\n\u201cgiven_name\u201d:\u201d\u534d\u6717\u201d\n}\n\n\u3042\u3042\u3001\u305d\u3046\u306d\u305d\u3046\u306d\u3002\u3042\u308c\u3067\u3082\u809d\u5fc3\u306eopenid\u304c\u306a\u304f\u306d\u30fc\u304b\u3053\u308c\u3002\n\u3061\u306a\u307f\u306b\u3001\u304d\u3061\u3093\u3068code flow\u306b\u306e\u3063\u3068\u3063\u305fID token\u306e\u53d6\u5f97\u3082\u51fa\u6765\u308b\u3088\u3046\u3060\u3002\n\n\u3067\u306f\u521d\u7269\u306eID token\u306f\u3069\u3046\u3060\u308d\u3046\u304b\u3002\n<Request>\nhttp://test.kirimanjirou.com:8080/openam/oauth2/authorize?client_id=kirimanjirou003&response_type=id_token\n\n<Response\u306b\u4e57\u3063\u3066\u304d\u305fidtoken>\nid_token=eyAiYWxnIjogIkhTMjU2IiwgImN0eSI6ICJKV1QiLCAidHlwIjogImp3dCIgfQ.eyAidG9rZW5OYW1lIjogImlkX3Rva2VuIiwgImV4cCI6IDEzOTU0NDkzNTAsICJhenAiOiAia2lyaW1hbmppcm91MDAxIiwgInN1YiI6ICJhbWFkbWluIiwgInRva2VuVHlwZSI6ICJKV1RUb2tlbiIsICJub25jZSI6ICI1WU9WNDRHbzVhV1I1N1NFNDRHWDQ0R21TVVRsanFqamdhdmpnYXJqZ2FQamdhYmpnb2c9IiwgInJlYWxtIjogIi8iLCAiYXVkIjogWyAia2lyaW1hbmppcm91MDAxIiBdLCAiaXNzIjogImh0dHA6Ly90ZXN0LmtpcmltYW5qaXJvdS5jb206ODA4MC9vcGVuYW0iLCAiaWF0IjogMTM5NTQ0ODc1MCwgIm9wcyI6ICJBUUlDNXdNMkxZNFNmY3k3dC1UOElMV3pNejJ1aTdTbGo3ckhuUkFtTGhIeHIwOC4qQUFKVFNRQUNNREVBQWxOTEFCTTVNVEV4TXpRMU5qWXpORFV3TmpJd01qZzEqIiwgImF0aCI6IDEzOTU0NDg3NTAgfQ.Ky0X5Y4AY4Nj0gHgN4vjR2YSfZ5o7jLfx_5dKHQOdK8\n\nBASE64\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u3002\u624b\u52d5\u3067\u5b9f\u65bd\u3059\u308b\u969b\u306f\u3001\u30d4\u30ea\u30aa\u30c9\u3092\u8de8\u3044\u3067\uff13\u3064\u306b\u5206\u5272\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u306a\u3044\u3068\u3046\u307e\u304f\u5206\u5272\u3067\u304d\u3093\u305e\u3002\n\nJWT\u30d8\u30c3\u30c0\u30fc\uff1a\n{\n\u201calg\u201d: \u201cHS256\u201d,\n\u201ccty\u201d: \u201cJWT\u201d,\n\u201ctyp\u201d: \u201cjwt\u201d\n}\n\u4e2d\u8eab\uff1a\n{\n\u201ctokenName\u201d: \u201cid_token\u201d,\n\u201cexp\u201d: 1395449350,\n\u201cazp\u201d: \u201ckirimanjirou003\u201d,\n\u201csub\u201d: \u201cmanjiopenidconnect\u201d,\n\u201ctokenType\u201d:\u201dJWTToken\u201d,\n\u201cnonce\u201d:\u201d5YOV44Go5aWR57SE44GX44GmSUTljqjjgavjgarjgaPjgabjgog=\u201d,\n\u201crealm\u201d: \u201c/\u201d,\n\u201caud\u201d: [ \u201ckirimanjirou003\u201d ],\n\u201ciss\u201d: \u201chttp://test.kirimanjirou.com:8080/openam\u201d,\n\u201ciat\u201d: 1395448750,\n\u201cops\u201d: \u201cAQIC5wM2LY4Sfcy7t-T8ILWzMz2ui7Slj7rHnRAmLhHxr08.*AAJTSQACMDEAAlNLABM5MTExMzQ1NjYzNDUwNjIwMjg1*\u201d,\n\u201cath\u201d: 1395448750\n}\n\n\u7f72\u540d(\u672a\u30c7\u30b3\u30fc\u30c9)\uff1a\nXrh5ev4qec1gDqpuY7qB35og6OLCjyjiCKfFYXQ177A\n\u304a\u30fc\u51fa\u3066\u304d\u305f\u51fa\u3066\u304d\u305f\u3001id_token\u3067\u3042\u308b\u3002\u7d30\u304b\u3044\u9805\u76ee\u5185\u5bb9\u306e\u8aac\u660e\u306f\u7701\u7565\u3002\u307e\u305f\u3001\u53d6\u308c\u305f\u3082\u306e\u306e\u6b63\u5f53\u6027\u3092\u691c\u8a3c\u3059\u308b\u624b\u7d9a\u304d\u3082\u3042\u308b\u3093\u3060\u304c\u3053\u308c\u306f\u6b21\u56de\u3067\u3002\n\u3046\u30fc\u3093\u3001\u3068\u3053\u308d\u3067\u3001ops\u3063\u3066\u5c5e\u6027\u306f\u306a\u3093\u3060\u308d\u3046\u3001\u3053\u308c\u3060\u3051\u308f\u304b\u3089\u306a\u3044\u306a\u3002\n\n\u30fb\u751f\u6210\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3068\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u53d6\u308c\u308b\u60c5\u5831\n\n\u3053\u3053\u3067\u3044\u3063\u305f\u3093\u3001OpenAM\u3092\u8a2d\u5b9a\u3057\u305f\u3053\u3068\u3067\u4f55\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u304b\u3092\u78ba\u8a8d\u3057\u3088\u3046\u3002\n\u3068\u3044\u3046\u304b\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u306fRP\u767b\u9332\u306e\u524d\u306b\u8aac\u660e\u3057\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\u3060\u3063\u305f\u3093\u3060\u304c\u306a\u3001\u4f55\u3067\u304b\u3057\u3089\u3093\u304cOAuth\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4e00\u56de\u305f\u305f\u304b\u306a\u3044\u3068\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304c\u52d5\u304b\u306a\u304b\u3063\u305f\u3093\u3060\u3088\u2026\u3002\n\n\u8aac\u660e\u3092\u306f\u3057\u3087\u3063\u3066\u3057\u307e\u3063\u305f\u304c\u3001\u4e0a\u8a18\u306e\u624b\u9806\u3092\u8e0f\u3080\u3053\u3068\u3067\u4ee5\u4e0b\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u30fb\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nhttp://test.kirimanjirou.com:8080/openam/.well-known/openid-configuration\n\nOpenID Connect\u3092\u63d0\u4f9b\u3059\u308bIdP\u306e\u60c5\u5831\u3092\u3053\u3053\u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3002\n\n\u30fb\u8a8d\u53ef\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/authorize\n\u3057\u3087\u3063\u3071\u306a\u306b\u8a8d\u53ef\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3059\u30dd\u30a4\u30f3\u30c8\u3002OAuth2.0\u3068\u540c\u3058\u3060\u306d\u3002\n\n\u30fb\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/access_token\n\u30c8\u30fc\u30af\u30f3\u306e\u53d6\u5f97\u3001\u66f4\u65b0\u304c\u51fa\u6765\u3066\u308b\u306e\u306fOAuth2.0\u3068\u540c\u3058\u3060\u306d\u3002\u4e0a\u8ff0\u306e\u3068\u304a\u308a\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u767b\u9332\u7528\u306e\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u308b\u65b9\u5f0f\u3068\u304b\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u306e\u3060\u306d\u3002\n\n\u30fb\u30e6\u30fc\u30b6\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/userinfo\n\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304b\u3089\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3002\nid token\u306b\u542b\u307e\u308c\u306a\u3044\u8a73\u7d30\u60c5\u5831\u3092\u5165\u308c\u308b\u3063\u3066\u306e\u304c\u6a19\u6e96\u7684\u306a\u4f7f\u3044\u65b9\u306a\u306e\u304b\uff1f\u3053\u3053\u306fid token\u306e\u4e2d\u8eab\u3068\u9055\u3044\u304c\u308f\u304b\u3093\u306d\u30fc\u3093\u3060\u3051\u3069\u3001\u3063\u3066\u8cea\u554f\u304c\u3053\u306a\u3044\u3060\u306etech night\u3067\u3082\u3042\u3063\u305f\u3088\u306d\u3002\n\n\u30fbRegistration\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/register\n\u4e0a\u8ff0\u306e\u3001Dynamic Registration\u306e\u305f\u3081\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u3042\u308b\u3002\n\n\u30fb\u30ed\u30b0\u30a2\u30a6\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/endSession\n\u307e\u3060\u52d5\u304b\u3057\u3066\u306a\u3044\u306e\u3067\u30ce\u30fc\u30b3\u30e1\u30f3\u30c8\u3002\n\n\u30fb\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u8a8d\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3000/oauth2/connect/checkSession\n\u540c\u4e0a\u3002\n\n\u4ee5\u4e0b\u306f\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u8aad\u3081\u308b\u8a2d\u5b9a\u5185\u5bb9\u3002\u591a\u5c11\u3081\u3093\u3069\u3046\u3060\u304cOpenID Connect\u306e\u7406\u89e3\u306b\u306f\u91cd\u8981\u306a\u9805\u76ee\u306a\u3093\u3067\u3001\u8aad\u3093\u3067\u3044\u3053\u3046\u3002\n\nIdP_23.fw\n\n\u25a0response_types_supported\nid token\u306e\u53d6\u5f97\u30d5\u30ed\u30fc\u3001\u65b9\u5f0f\u306b\u3064\u3044\u3066\u4f55\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u304c\u8a18\u8ff0\u3055\u308c\u308b\u3002\n\n\u25a0version\n3.0\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3054\u3056\u3044\u3084\u3059\u3002\n\n\u25a0subject_types_supported\n\u5229\u7528\u53ef\u80fd\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7a2e\u5225\u3002\u306a\u305c\u304b\u30c7\u30d5\u30a9\u30eb\u30c8\u306fpublic\u306e\u307f\u306e\u3088\u3046\u3060\u3002\n\n\u25a0issuer\nIdP\u3092\u4e00\u610f\u306b\u8868\u3059URL\u3002\u5f8b\u5100\u306b\u8868\u793a\u3057\u3066\u304f\u308c\u305f\u3068\u3044\u3046\u3053\u3068\u3067\u3002\n\n\u25a0jwks_uri\n\u3053\u3053\u306e\u8a2d\u5b9a\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u306e\u304b\u3069\u3046\u304b\u306f\u307e\u3060\u308f\u304b\u3063\u3066\u3044\u306a\u3044\u3002\n\n\u25a0check_session_iframe\n\u30ed\u30b0\u30a4\u30f3\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3002\u3069\u3093\u306a\u3082\u3093\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u304b\u3057\u3089\u3002\n\n\u25a0claims_supported\n\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u5c5e\u6027\u3002\u3053\u3061\u3089\u3082OpenAM\u306e\u8a2d\u5b9a\u304b\u3089\u8ffd\u52a0\u3084\u524a\u9664\u304c\u3067\u304d\u308b\u3088\u3046\u3060\u3002\n\n\u25a0id_token_signing_alg_values_supported\n\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u7f72\u540d\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u63d0\u793a\u3002\n\n\u25a0userinfo_endpoint\n\u25a0registration_endpoint\n\u25a0token_endpoint\n\u25a0end_session_endpoint\n\u25a0authorization_endpoint\n\u4e0a\u3067\u7d39\u4ecb\u3057\u305f\u5404\u7a2e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u3042\u3066\u5148\u3092\u793a\u3059\u3002\n\n\u306a\u304a\u3001\u3053\u308c\u3089\u306e\u8a2d\u5b9a\u3092\u3044\u3058\u304f\u308b\u305f\u3081\u306eGUI\u306f\u4ee5\u4e0b\u304b\u3089\u305f\u3069\u308c\u308b\n\u300c\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u300d\u2192(\u6700\u4e0a\u4f4d\u306e\u30ec\u30eb\u30e0\u3092\u9078\u629e)\u2192\u300c\u30b5\u30fc\u30d3\u30b9\u300d\u2192\u300cOAUTH2\u30d7\u30ed\u30d0\u30a4\u30c0\u300d\n\u305d\u306e\u307b\u304b\u3001OpenAM\u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u305d\u308c\u306a\u308a\u306b\u8aad\u307f\u3084\u3059\u3044\u306e\u3067\u3001\u3053\u3061\u3089\u3082\u30aa\u30b9\u30b9\u30e1\u3067\u3042\u308b\u3002\u30ef\u30b7\u3082\u7d76\u8cdb\u7cbe\u8aad\u4e2d\u3002\n\n\u6c17\u306b\u306a\u308b\u3053\u3068\u306f\u305f\u304f\u3055\u3093\u3042\u308b\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u9023\u643a\u306f\u3067\u304d\u305d\u3046\u306a\u306e\u3067\u3001\u65e9\u901fclient\u5074\u306e\u5b9f\u88c5\u306b\u3044\u3063\u3066\u307f\u3088\u3046\u3002\n\n\u524d\u56de\u306e\u30a8\u30f3\u30c8\u30ea\u3067IdP\u306e\u7d44\u307f\u4e0a\u3052\u306b\u6210\u529f\u3057\u305f\u3002\u3067\u306f\u5b9f\u969b\u306b\u7d44\u307f\u4e0a\u3052\u305fIdP\u3068\u9023\u643a\u3059\u308b\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3002\n\n\u4eca\u56de\u306f\u300c\u3044\u3084\u3001\u305d\u3082\u305d\u3082OAuth\u304b\u3089\u3057\u3066\u3088\u304f\u308f\u304b\u3089\u306d\u3048\u3093\u3060\u3088\u306a\u3066\u3078\u307a\u308d\u300d\u3068\u3044\u3046\u65b9\u3092\u5bfe\u8c61\u306b\u3001OpenID Connect\u5bfe\u5fdc\u30b5\u30a4\u30c8\u3092\u4f5c\u3063\u3066\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u3068\u3053\u308d\u307e\u3067\u3092\u30d5\u30a9\u30ed\u30fc\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\u3082\u3046\u305d\u3093\u306a\u306e\u77e5\u3063\u3066\u308b\uff9c\uff72\u306a\u4eba\u306f\u4eca\u56de\u306e\u30a8\u30f3\u30c8\u30ea\u306f\u8aad\u307f\u98db\u3070\u3057\u3066\u304f\u308c\u3066\u3082\u69cb\u308f\u306a\u3044\u305e\u3002\n\u306a\u304a\u3001\u30ef\u30b7\u306e\u7cde\u30fc\u30b9\u306b\u3064\u304d\u3042\u3063\u3066\u3089\u308c\u308b\u304b\u3001\u3068\u3044\u3046\u4eba\u306fYConnect\u306a\u3069\u306e\u6574\u9813\u3055\u308c\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u304b\u3089\u5b9f\u88c5\u3092\u8ffd\u3046\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3060\u3088\u3002\u4eca\u56de\u306f\u30d5\u30ed\u30fc\u3092\u4e00\u901a\u308a\u8ffd\u3046\u306e\u304c\u76ee\u7684\u306a\u306e\u3067\u3001\u30d9\u30bf\u66f8\u304d\u3057\u3066\u3044\u308b\u3088\u3002\n\n\u5b9f\u969b\u306b\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306b\u7d44\u307f\u8fbc\u3093\u3067\u3044\u304f\u3001\u3068\u304b\u306f\u307e\u305f\u6b21\u56de\u306b\u30c8\u30e9\u30a4\u3067\u3042\u308b\u3002\n\u4ee5\u4e0b\u3001\u672c\u984c\u3002\n\n\u4f5c\u308b\u3082\u306e\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u4eca\u56de\u7528\u610f\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306a\u308b\u3002\n1.\u30ed\u30b0\u30a4\u30f3\u753b\u9762\n2.\u81ea\u4f5cIdP\u306b\u30d6\u30c3\u98db\u3070\u3059\n3.\u81ea\u4f5cIdP\u304b\u3089\u30d6\u30c3\u98db\u3070\u3055\u308c\u3066\u304d\u3066\u3001\u30c8\u30fc\u30af\u30f3\u3092\u3068\u308a\u306b\u3044\u304f\n4.\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n5.\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\n\n1.\u30ed\u30b0\u30a4\u30f3\u753b\u9762\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u306f\u306a\u3093\u3067\u3082\u3044\u3044\u3002\u3053\u3053\u306f\u597d\u307f\u3067\u4f5c\u308b\u304c\u3088\u3044\u3002\n\u3068\u306f\u3044\u3048\u624b\u629c\u304d\u306f\u305b\u305a\u3001\u30ef\u30b7\u306e\u30cf\u30a4\u30bb\u30f3\u30b9\u306a\u30c7\u30b6\u30a4\u30f3\u3067\u30ab\u30ab\u30c3\u3068\u5b9f\u88c5\u3057\u3066\u3044\u304f\u3002\nRP_2\n\nindex.html\n<!doctype html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>Manji Sample</title>\n</head>\n<body>\n<h1>\u81ea\u524dIdP\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b</h1>\n<p>\n<a href=\"login.php\">\n<img src=\"http://kirimanjirou.com/sample/login.png\" width=\"241\" height=\"28\" alt=\"\u81ea\u4f5cIdP\u306b\u30ed\u30b0\n\u30a4\u30f3\uff01\" border=\"0\">\n</a>\n</body>\n</html>\nview rawindex.html hosted with \u2764 by GitHub\n\n2.\u81ea\u4f5cIdP\u306b\u30d6\u30c3\u98db\u3070\u3059\n\u3053\u3053\u304b\u3089\u304c\u672c\u4e38\u3067\u3042\u308b\u3002 \u8a00\u3044\u5fd8\u308c\u305f\u304c\u4eca\u56de\u306f\u666e\u901a\u306eWeb\u30ed\u30b0\u30a4\u30f3\u30b7\u30b9\u30c6\u30e0\u3092\u30b5\u30f3\u30d7\u30eb\u3067\u7d44\u3080\u306e\u3067\u3001 OpenID Connect\u306e\u201dcode\u30d5\u30ed\u30fc\u201d\u3068\u3044\u3046\u5974\u3092\u5229\u7528\u3059\u308b\u3002 \u30dd\u30a4\u30f3\u30c8\u306fID Token\u306e\u53d7\u3051\u6e21\u3057\u306b\u30d6\u30e9\u30a6\u30b6\u3092\u7d4c\u7531\u3055\u305b\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3060\u3002 \u30b5\u30a4\u30c8\u5074\u306e\u624b\u9593\u306f\u4e00\u500b\u5897\u3048\u308b\u304c\u3001\u30e6\u30fc\u30b6\u306e\u30d6\u30e9\u30a6\u30b6\u306bID Token\u304c\u6b8b\u308b\u5fc3\u914d\u304c\u306a\u3044\u3002\u30d6\u30e9\u30a6\u30b6\u3092\u7d4c\u7531\u3057\u3066\u304f\u308b\u306e\u306fID Token\u3068\u4e00\u56de\u30dd\u30c3\u30ad\u30ea\u306e\u5f15\u304d\u63db\u3048\u304c\u51fa\u6765\u308b\u201dcode\u201d\u3068\u3044\u3046\u3082\u306e\u3060\u3002 \u6d41\u308c\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308b\u3002\n\u30cf\u30a4\u30bb\u30f3\u30b9\u306a\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u62bc\u3059\n\u3053\u308c\u304b\u3089ID Token\u3092\u53d6\u308a\u306b\u884c\u304f\u305c\uff01\u3068\u3044\u3046\u6c17\u5408\u3092\u81ea\u4f5cIdP\u306b\u5c4a\u3051\u308b\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3002\n\u30e6\u30fc\u30b6\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30f3\u3002\u3053\u306a\u3044\u3060\u305f\u3066\u305fOpenAM\u306e\u753b\u9762\u3060\u306d\u3002\n\u30e6\u30fc\u30b6\u304c\u5929\u2191TENGA\u30a2\u30d7\u30ea\u3092\u8a31\u3059\u304b\u3069\u3046\u304b\u306e\u30b8\u30e3\u30c3\u30b8\u30e1\u30f3\u30c8\n\u8a31\u3055\u308c\u305f\u5834\u5408\u306f\u30e6\u30fc\u30b6\u304ccode\u3092\u3082\u3063\u3066\u623b\u3063\u3066\u304f\u308b\u3001\u304a\u304b\u3048\u308a\uff01(\u30d1\u30af\u30ea)\ncode\u3092\u3082\u3063\u3066ID Token\u3092\u3068\u308a\u306b\u3044\u304f\u3002\n\u53d6\u308c\u305f\u3089\u3001\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3053\u3068\u306b\u3057\u3066\u3057\u307e\u3046\u305e\n\u3042\u30fc\u9806\u756a\u3092\u66f8\u304f\u3060\u3051\u3067\u75b2\u308c\u305f\u306d\u3001index.html\u3092\u4fdd\u5b58\u3057\u3066\u304a\u3063\u3071\u3044\u30e2\u30df\u30e2\u30df\u306b\u3044\u304d\u305f\u3044\u306d\u6298\u89d2\u306e\u9031\u672b\u3060\u3002\n\u4eca\u56de\u5b9f\u88c5\u3059\u308bcode\u30d5\u30ed\u30fc\u306e\u307b\u304b\u306b\u3001implicit\u30d5\u30ed\u30fc\u3068\u3044\u3046\u306e\u3082\u3042\u308b\u3002\u3053\u308c\u306fcode\u3067\u306f\u306a\u304f\u3066\u30e6\u30fc\u30b6\u304cID Token\u3092\u6301\u3063\u3066\u623b\u3063\u3066\u304f\u308b\u3082\u306e\u3060\u3068\u601d\u3048\u3070\u3088\u308d\u3057\u3044\u3002\ncode\u3092\u5f15\u304d\u63db\u3048\u306bID Token\u3092\u3068\u308b\u30d5\u30ed\u30fc\u304c\u5b9f\u88c5\u3057\u306b\u304f\u3044\u5834\u5408(\u30b5\u30a4\u30c8\u3058\u3083\u306a\u304f\u3066\u5358\u767a\u306e\u753b\u9762\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u304b)\u306b\u306f\u3053\u3063\u3061\u3092\u4f7f\u304a\u3046\u3002\n\u4e00\u65b9\u3001Android\u3084iOS\u306e\u30a2\u30d7\u30ea\u307f\u305f\u3044\u306b\u3001\u958b\u767a\u30b5\u30a4\u30c9\u304b\u3089\u96e2\u308c\u305f\u3068\u3053\u308d\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u914d\u5e03\u3059\u308b\u5834\u5408\u306fImplicit\u306e\u30d5\u30ed\u30fc\u3092\u4f7f\u304a\u3046\u3002 \u3053\u308c\u306f\u3001Implicit\u306e\u30d5\u30ed\u30fc\u306b\u306fRP\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u76f8\u5f53\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u4f7f\u308f\u305a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5024\u3092\u57cb\u3081\u308b\u5fc5\u8981\u304c\u306a\u3044\u305f\u3081\u3067\u3042\u308b\u3002\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3084\u753b\u9762\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u57cb\u3081\u308b\u3068\u6f0f\u308c\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304b\u3089\u306a\u3002\u3068\u308a\u3042\u3048\u305a\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u304c\u7b2c3\u8005\u306b\u898b\u3048\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u304cRP\u30b5\u30a4\u30c9\u306e\u30e2\u30e9\u30eb\u3067\u3042\u308d\u3046\u3002(\u4eca\u56de\u306f\u30c0\u30c0\u6f0f\u308c\u3060\u3088\uff01)\n\u30d5\u30ed\u30fc\u306e\u9078\u629e\u306b\u3042\u305f\u308a\u3001\u3053\u3053\u306f\u9593\u9055\u3048\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\u3044\u304b\u3093\u8a71\u304c\u305d\u308c\u305f\u3002\u30b3\u30fc\u30c9\u3002\n\nlogin.php\n<?php\n//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308b\nsession_start();\n//IdP\u60c5\u5831\n$authorization_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/authorize\";\n//RP\u60c5\u5831\n$client_id = \"kirimanjirou003\";\n$redirect_uri = \"https://kirimanjirou.com/sample/signup.php\";\n//state\u306e\u4f5c\u6210 \u7279\u5b9a\u6587\u5b57+\u65e5\u4ed8\u304b\u3089\u30e9\u30f3\u30c0\u30e0\u306a32\u30b1\u30bf\u3092\u751f\u6210\n$state =  substr((md5(\"manjistate\" . date(\"YmdD His\"))), 0, 32);\n$_SESSION['state'] = $state;\n//nonce\u306e\u4f5c\u6210 \u4f5c\u308a\u65b9\u306fstate\u3068\u540c\u3058\u306b\u3057\u305f\n$nonce = substr((md5(\"manjinonce\" . date(\"YmdD His\"))), 0, 32);\n$_SESSION['nonce'] = $nonce;\n//\u540c\u610f\u753b\u9762\u306e\u8868\u793a\u65b9\u5f0f\u3092\u6307\u5b9a\u3059\u308b\n$display = \"page\";\n//\u81ea\u4f5cIdP\u5074\u306e\u518d\u8a8d\u8a3c\u6709\u7121\u306a\u3069\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u6307\u5b9a\u3067\u304d\u308b\n$prompt = \"select_account\";\n//grant\u306e\u6307\u5b9a\u3092\u884c\u3046\u3002\u4eca\u56de\u306fcode\n$response_type = \"code\";\n//scope\u3092\u6307\u5b9a\u3059\u308b\n$scope = array(\n        \"phone\",\n        \"email\",\n        \"address\",\n        \"openid\", //\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304c\u3042\u308c\u3070ID Token\u306f\u53d6\u308c\u308b\n        \"profile\"\n);\n//http\u30af\u30a8\u30ea\u306e\u4f5c\u6210\n$query = http_build_query(array(\n        \"client_id\"=>$client_id,\n        \"redirect_uri\"=> $redirect_uri,\n        \"state\"=>$state,\n        \"nonce\"=>$nonce,\n        \"display\"=>$display,\n        \"prompt\"=>$prompt,\n        \"response_type\"=>$response_type,\n        \"scope\"=>implode(\" \", $scope ),\n));\n//\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5fdc\u7b54\u306e\u4f5c\u6210\nheader( \"Location: \" . $authorization_endpoint . \"?\" . $query );\nexit();\n?>\nview rawlogin.php hosted with \u2764 by GitHub\n\u3053\u3053\u306f\u30b7\u30f3\u30d7\u30eb\u3067\u3042\u308b\u3002OpenID Connect\u3067\u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30bf\u3092\u8abf\u3079\u3066\u304f\u307f\u4e0a\u3052\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u3060\u3051\u3060\u3002\n\u307b\u3063\u3068\u3093\u3069\u304c\u30d1\u30e9\u30e1\u30bf\u306e\u30cf\u30e1\u8fbc\u307f\u3060\u3051\u3002\n\n3.\u81ea\u4f5cIdP\u304b\u3089\u30d6\u30c3\u98db\u3070\u3055\u308c\u3066\u304d\u3066\u3001\u30c8\u30fc\u30af\u30f3\u3092\u3068\u308a\u306b\u3044\u304f\n\u30bf\u30a4\u30c8\u30eb\u306f\u9577\u3044\u304c\u3001\u51e6\u7406\u306f\u610f\u5916\u306b\u697d\u30c1\u30f3\u30b3\u3067\u3042\u308b\u3002\u3068\u601d\u3044\u304d\u3084\u4e00\u90e8\u3046\u3054\u3044\u3066\u306d\u30fc\u3093\u3060\u304c\u3002\n\nsignup.php(\u524d\u534a)\n<?php\n//curl\u3092\u4f7f\u3046\u305e\n$ch = curl_init();\n//\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30b5\u30fc\u30d0\u30bb\u30c3\u30b7\u30e7\u30f3\u3067state\u3068nonce\u3092\u7ba1\u7406\u3059\u308b\nsession_start();\n$session_state = $_SESSION['state'];\n$session_nonce = $_SESSION['nonce'];\n//IdP\u60c5\u5831\n$token_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/access_token\";\n$issue = \"http://test.kirimanjirou.com:8080/openam\";\n$userinfo_endpoint = \"http://test.kirimanjirou.com:8080/openam/oauth2/userinfo\";\n//RP\u60c5\u5831\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5165\u308c\u3066\u3082\u307e\u3041\u3044\u3044\u306e\u304b\u3082\u3060\u304c\u3053\u3053\u306f\u597d\u307f\u3067\u9759\u7684\u306b\u8a18\u8f09\u3059\u308b\u3053\u3068\u306b\u3057\u305f\n$client_id = \"kirimanjirou003\";\n$client_secret = \"kirimanjirou003\";\n$redirect_uri = \"https://kirimanjirou.com/sample/signup.php\";\n//\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30bf\n$req_code = $_GET['code'];\n$req_state = $_GET['state'];\n//state\u306e\u691c\u8a3c \u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u5f15\u304d\u7d99\u3044\u3060state\u3068\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066\u304d\u305f\u30d1\u30e9\u30e1\u30bf\u306f\u540c\u3058\uff1f\nif ($session_state != $req_state) { $NG_MSG = \"state is NG\"; }\n//code\u306f\u3061\u3083\u3093\u3068\u3064\u3044\u3066\u304d\u3066\u3044\u308b\u3088\u306d\uff1f\nif ($req_code == null) { $NG_MSG = \"code does not exsit\"; }\n//\u30c8\u30fc\u30af\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30ea\u30af\u30a8\u30b9\u30c8\n//Header\u4f5c\u6210: client_id,client_secret\u3092\":\"\u3067\u3064\u306a\u3044\u3067BASE64\u30a8\u30f3\u30b3\u30fc\u30c9\u3059\u308b\n$client_cred = base64_encode( $client_id . \":\" . $client_secret);\n$headers = array(\n        \"Expect:\",\n        \"Authorization: Basic \" . $client_cred\n        );\n//\u30d1\u30e9\u30e1\u30bf\u8a2d\u5b9a\n$postdata = http_build_query(array(\n        \"grant_type\"=>\"authorization_code\", //\u56fa\u5b9a\n        \"redirect_uri\"=>$redirect_uri,\n        \"code\"=>$req_code\n        ));\n//token_endpoint\u30ea\u30af\u30a8\u30b9\u30c8\u4f5c\u6210\ncurl_setopt( $ch, CURLOPT_URL, $token_endpoint );\ncurl_setopt( $ch, CURLOPT_HTTPHEADER, $headers );\ncurl_setopt( $ch, CURLOPT_POST, 1 );\ncurl_setopt( $ch, CURLOPT_POSTFIELDS, $postdata );\ncurl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );\n//\u5b9f\u884c\n$token_endpoint_result = json_decode( curl_exec( $ch ));\n//ID Token\u3092\u30f4\u30a7\u30ea\u30d5\u30a1\u30fc\u30a4\uff57\uff57\uff57\uff57\u3057\u3066\u3044\u304f\n$id_token = $token_endpoint_result->id_token;\n$access_token = $token_endpoint_result->access_token;\n~~~~\nview rawsignup.php hosted with \u2764 by GitHub\n\n\u3053\u3053\u307e\u3067\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068ID Token\u304c\u53d6\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\u3084\u3063\u305f\u306d\uff01\n\u3053\u308c\u304b\u3089ID Token\u3092\u30f4\u30a7\u30ea\u30d5\u30a1\u30fc\u30a4\uff57\uff57\uff57\uff57\uff57\u3057\u3066\u3044\u304f\u306e\u3060\u3002\n\u3068\u3053\u308d\u304c\u3001\u3053\u3053\u3067\u30b3\u30b1\u3066\u3057\u3082\u3046\u305f\u3002Token\u7f72\u540d\u306e\u691c\u8a3c\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\nIdP\u306b\u3088\u3063\u3066\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3067\u7f72\u540d\u3059\u308b\u3082\u306e\u3082\u3042\u308b\u306e\u3060\u304c\u3001OpenAM\u3067\u306fID Token\u306e\u7f72\u540d\u30b7\u30b0\u30cd\u30c1\u30e3\u306eKey\u306b\u30b5\u30fc\u30d0\u306e\u9375\u60c5\u5831\u3092\u4f7f\u3046\u3088\u3046\u306b\u898b\u3048\u308b\u3002\u305d\u3053\u3067@ritou\u6c0f\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u516c\u958b\u9375\u3092\u4f7f\u3063\u3066\u30b7\u30b0\u30cd\u30c1\u30e3\u3092\u4f5c\u308b\u306e\u3060\u3001\u3068\u7406\u5c48\u307e\u3067\u306f\u308f\u304b\u3063\u3066\u8a66\u3057\u3066\u308b\u3093\u3060\u304c\u3069\u3046\u3082\u52d5\u304b\u306a\u3044\u3002\nOpenAM\u5074\u3067\u3069\u3046\u7f72\u540d\u3057\u3066\u3044\u308b\u306e\u304b\u308f\u304b\u308b\u307e\u3067\u7d50\u69cb\u6642\u9593\u304c\u304b\u304b\u3063\u3061\u307e\u3046\u306a\u2026\u3053\u3053\u306f\u7d50\u69cb\u30ad\u30e2\u306e\u90e8\u5206\u3060\u3068\u601d\u3063\u3066\u305f\u3060\u3051\u306b\u3059\u3093\u306a\u308a\u3044\u304b\u306a\u3044\u306e\u306f\u5b9f\u306b\u6b8b\u5ff5\u3002\u3060\u304c\u3001\u3044\u3063\u305f\u3093\u30ae\u30d6\u30a2\u30c3\u30d7\u3068\u3055\u305b\u3066\u304f\u308c\u3001\u3059\u307e\u306a\u3044\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u6539\u3056\u3093\u306f\u3055\u308c\u3066\u3044\u306a\u3044\u4f53\u3067\u5404claims\u306e\u691c\u8a3c\u3092\u3057\u3066\u3044\u304f\u3002\nsignup.php(\u5f8c\u534a)\n<?php\n//\u3057\u304b\u305f\u306d\u3048\u304b\u3089\u624b\u3067\u3061\u304e\u308b\nlist($header, $payload, $token_signature) = explode('.', $id_token);\n//BASE64\u30c7\u30b3\u30fc\u30c9\u3059\u308b\n$header_cont = base64_decode(str_pad(strtr($header, '-_', '+/'), strlen( $header ) % 4, '=', STR_PAD_RIGHT));\n$payload_cont = base64_decode(str_pad(strtr($payload, '-_', '+/'), strlen( $payload ) % 4, '=', STR_PAD_RIGHT));\n$header_json = json_decode( $header_cont );\n$payload_json = json_decode( $payload_cont );\n//nonce\u306e\u691c\u8a3c\nif ( $session_nonce != $payload_json->nonce ) { $NG_MSG = \"nonce is NG\"; }\n//issue\u306e\u691c\u8a3c\nif ( $issue != $payload_json->iss ) { $NG_MSG = \"iss is NG\"; }\n//aud\u306e\u691c\u8a3c\nif (true == is_array( $payload_json->aud ))\n{\n        if (true != in_array( $client_id,$payload_json->aud )) { $NG_MSG = \"aud[] is NG\"; }\n}else{\n        if ( $client_id != $payload_json->aud ) { $NG_MSG =  \"aud is NG\"; }\n}\n//azp\u306e\u691c\u8a3c\nif (array(\"azp\",$payload_cont))\n{\n        if ($client_id != $payload_json->azp ) { $NG_MSG = \"azp is NG\"; }\n}\nif ( $NG_MSG == null)\n{\n        //userinfo_endpoint\u30ea\u30af\u30a8\u30b9\u30c8\u4f5c\u6210\n        //Header\u4f5c\u6210:\n        $ch = curl_init();\n        $headers = array(\n                \"Expect:\",\n                \"Authorization: Basic \" . $access_token\n                );\n        curl_setopt( $ch, CURLOPT_URL, $userinfo_endpoint . \"?access_token=\" . $access_token );\n        curl_setopt( $ch, CURLOPT_HTTPHEADER, $headers );\n        curl_setopt( $ch, CURLOPT_RETURNTRANSFER, true );\n        //\u5b9f\u884c\n        $userinfo_endpoint_result = json_decode( curl_exec( $ch ));\n        //\u30e1\u30a4\u30f3\u30da\u30fc\u30b8\u3078\u306e\u60c5\u5831\u5f15\u7d99\u304e\n        $_SESSION['id_token_encode'] = $id_token;\n        $_SESSION['access_token'] = $access_token;\n        $_SESSION['id_token'] = $payload_json;\n        $_SESSION['userinfo'] = $userinfo_endpoint_result;\n        //\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5fdc\u7b54\u306e\u4f5c\u6210\n        header( \"Location: \" . \"https://kirimanjirou.com/sample/cont.php\" );\n        exit();\n}else{\nprint<<<EOF\n        <html>\n        <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n        <title>ERROR</title>\n        </head>\n        <body>\n        $NG_MSG\n        </body>\n        </html>\nEOF;\n}\n?>\nview rawsignup_2.php hosted with \u2764 by GitHub\nnonce\u306e\u691c\u8a3c\uff1a\n\u30ea\u30d7\u30ec\u30a4\u30a2\u30bf\u30c3\u30af\u9632\u6b62\u3067\u3042\u308b\u3002\u3053\u308c\u304c\u3046\u307e\u304f\u52d5\u3044\u3066\u3044\u308b\u3068\u5225\u30e6\u30fc\u30b6\u304cTokenEndpoint\u306bcode\u3092\u6295\u3052\u3064\u3051\u305f\u3068\u3057\u3066\u3082\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u305d\u308c\u3092\u691c\u77e5\u3067\u304d\u308b\u3002\u30e6\u30fc\u30b6\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u5024\u3068ID token\u306e\u4e2d\u8eab\u3092\u6bd4\u8f03\u3059\u308b\u3053\u3068\u3067\u6210\u7acb\u3059\u308b\u3093\u3060\u306d\u3002\n\nissue\u306e\u691c\u8a3c\uff1a\nID Toekn\u306eclaim\u306b\u542b\u307e\u308c\u308bIdP\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u30d9\u30fc\u30b9URL\u3092\u691c\u8a3c\u3059\u308b\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u30d9\u30bf\u66f8\u304d\u3057\u3066\u6bd4\u8f03\u3059\u308c\u3070OK\u3060\u308d\u3046\u3002OpenID\u30d7\u30ed\u30d0\u30a4\u30c0\u60c5\u5831\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u3042\u3089\u304b\u3058\u3081\u30c7\u30a3\u30b9\u30ab\u30d0\u3063\u305f\u308a\u3059\u308b\u5834\u5408\u306f\u3001\u305d\u308c\u3068\u6bd4\u8f03\u3057\u3088\u3046\u3002\n\naudience\u306e\u691c\u8a3c\uff1a\nID Toekn\u306eclaim\u306b\u542b\u307e\u308c\u308b\u5024\u3068\u81ea\u8eab\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u6bd4\u8f03\u3059\u308b\u3002@tkudos\u6c0f\u306eTumbler\u3067\u30b3\u30e1\u30f3\u30c8\u3044\u305f\u3060\u3044\u3066\u3044\u305f\u306e\u3067\u30cf\u30de\u3089\u305a\u306b\u3059\u3093\u3060\u306e\u3060\u304c\u3001OpenAM\u3067\u306faud claim\u306f\u3072\u3068\u3064\u3067\u3082\u914d\u5217\u3067\u8fd4\u3063\u3066\u6765\u308b\u3002aud\u3068azp\u306e\u6271\u3044\u306b\u3064\u3044\u3066\u306f\u8ff7\u3063\u305f\u304c\u4eca\u56de\u306f\u4e21\u65b9\u8a55\u4fa1\u3059\u308b\u3053\u3068\u306b\u3002azp\u3092\u3064\u3051\u3066\u3053\u306a\u3044IdP\u304c\u3044\u308b\u3053\u3068\u3084\u3084\u3001aud\u304c\u914d\u5217\u3058\u3083\u306a\u3044\u5834\u5408\u306f\u60f3\u5b9a\u3057\u3066\u304a\u304f\u3079\u304d\u3060\u308d\u3046\u3002\n\n\u6642\u523b\u306e\u691c\u8a3c\uff1a\n\u4eca\u56de\u306f\u7d44\u307f\u8fbc\u3093\u3067\u306a\u3044\u3002IdP\u306e\u793a\u3059\u767a\u884c\u65e5\u6642\u304c\u5927\u5e45\u306b\u73fe\u5728\u6642\u523b\u3068\u30ba\u30ec\u3066\u3044\u308b\u5834\u5408\u306f\u7121\u52b9\u3068\u3059\u308b\u3001\u306a\u3069\u3002\n\n\u6b63\u5e38\u306bID\u30c8\u30fc\u30af\u30f3\u304c\u691c\u8a3c\u3067\u304d\u305f\u306e\u3067\u3042\u308c\u3070\u3001\u53d6\u308c\u305f\u60c5\u5831\u3092\u30e6\u30fc\u30b6\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u3076\u3061\u8fbc\u3093\u3067\u3057\u307e\u304a\u3046\u3002\n\u3053\u3053\u3067\u306fUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3082\u547c\u3093\u3067\u3001\u30e6\u30fc\u30b6\u60c5\u5831\u3082\u53d6\u5f97\u3059\u308b\u3002\nUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u3046\u306e\u3067\u3001\u307b\u3093\u3068\u3046\u306f\u30c8\u30fc\u30af\u30f3\u304c\u5207\u308c\u3066\u3044\u305f\u3089\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u3067\u518d\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3092\u5165\u308c\u3066\u3082\u3088\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306f\u3044\u3089\u306a\u3044\u3057\u3001\u30e0\u30e9\u30e0\u30e9\u3057\u3066\u304d\u305f\u306e\u3067\u4eca\u65e5\u306f\u30b5\u30dc\u308b\u3002\n\n4.ID Token\u3092\u691c\u8a3c\u3059\u308b\n\u30aa\u30b5\u30ec\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30fc\u30b8\u3092\u4f5c\u308a\u3001ID Token\u306esubject\u3068UserInfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u5185\u5bb9\u3092\u8d64\u88f8\u3005\u306b\u8868\u793a\u3059\u308b\u3002\nRP_1\nOh\u2026\ncont.php\n<?php\n//curl\u3092\u4f7f\u3046\u305e\n$ch = curl_init();\n//\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\ndate_default_timezone_set('Asia/Tokyo');\nsession_start();\n$id_token_encode = $_SESSION['id_token_encode'];\n$id_token = $_SESSION['id_token'];\n$access_token = $_SESSION['access_token'];\n$userinfo = $_SESSION['userinfo'];\n$NG_MSG = null;\n$CONTENT = null;\nif ( null == $_SESSION )\n{\n$NG_MSG = <<<EOF\n\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u7121\u52b9\u3067\u3059\u3002\n<a href = index.html>\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078</a>\nEOF;\n}else{\n$login_date = date(\"Y-m-d h:i:s\",$id_token->iat);\n$CONTENT = <<<EOF\n\u30ed\u30b0\u30a4\u30f3\u30b5\u30fc\u30d3\u30b9: $id_token->iss<br>\n\u30ed\u30b0\u30a4\u30f3\u65e5\u6642: $login_date\n<table border>\n<tr> <td>USERID</td><td>$id_token->sub</td>\n<tr> <td>\u304a\u540d\u524d</td><td>$userinfo->name</td>\n<tr> <td>TEL</td><td>$userinfo->phone</td>\n<tr> <td>MAIL</td><td>$userinfo->email</td>\n<tr> <td>ADDRESS</td><td>$userinfo->address</td>\n</table>\n<a href = \"logout.php\">\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b</a>\n<p>\nIDTOKEN: $id_token_encode\nEOF;\n}\nprint<<<EOF\n        <html>\n        <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n        <title>TOP</title>\n        </head>\n        <body>\n        <h1>\u81ea\u524dIdP\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u304b\uff1f</h1>\n        $NG_MSG\n        $CONTENT\n        </body>\n        </html>\nEOF;\n?>\nview rawcont.php hosted with \u2764 by GitHub\n\n\u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30fc\u30b8\u3067\u306f\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u6709\u52b9\u306aID\u30c8\u30fc\u30af\u30f3\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u5fc5\u8981\u3067\u3042\u308c\u3070\u4f5c\u3063\u3066\u304d\u305fphp\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u8a8d\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3001\u4e8c\u91cd\u306b\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u308b\u3053\u3068\u3092\u30d1\u30b9\u3055\u305b\u3088\u3046\u3002\u8907\u6570\u306eIdP\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u88c5\u3092\u30b5\u30dc\u3089\u306a\u3044\u307b\u3046\u304c\u3044\u3044\u3068\u3044\u3046\u306e\u304c\u500b\u4eba\u7684\u306a\u610f\u898b\u3067\u3042\u308b\u3002IdP\u304c\u8907\u6570\u9078\u629e\u3067\u304d\u308b\u30b7\u30fc\u30f3\u3067\u306f\u304d\u3061\u3093\u3068\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3002\nIdP\u5074\u304c\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u3044\u305f\u3089RP\u5074\u3067\u3082\u2026\u3068\u3044\u3046\u30c1\u30a7\u30c3\u30af\u30bb\u30c3\u30b7\u30e7\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8a66\u3057\u305f\u304b\u3063\u305f\u304c\u3001OpenAM\u306b\u6295\u3052\u308b\u30d1\u30e9\u30e1\u30bf\u304c\u308f\u304b\u3093\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4fdd\u7559\u3002\n5.\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\n\u30ed\u30b0\u30a2\u30a6\u30c8\u30dc\u30bf\u30f3\u3067\u3042\u308b\u3002\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30b9\u30c8\u30ed\u30fc\u30a4\uff57\uff57\uff57\uff57\u3060\u3051\u3067\u3068\u308a\u3042\u3048\u305a\u3044\u3044\u3002 \u4eca\u5f8cOpenAM\u3068\u306e\u30b7\u30f3\u30b0\u30eb\u30ed\u30b0\u30a2\u30a6\u30c8\u3092\u7814\u7a76\u3057\u3066\u3044\u3053\u3046\u3002\n<?php\nsession_start();\nsession_destroy();\nprint<<<EOF\n        <html>\n        <head>\n        <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n        <title>TOP</title>\n        </head>\n        <body>\n        <h1>\u30ed\u30b0\u30a2\u30a6\u30c8</h1>\n        <a href = index.html>\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078</a>\n        </body>\n        </html>\nEOF;\n?>\nview rawlogout.php hosted with \u2764 by GitHub\n\u304a\u307e\u3051\nOpenAM\u306e\u30ed\u30b0\u30a4\u30f3\u306b\u5229\u7528\u3057\u305f\u3064\u304f\u308a\u306f\u4ed6\u306eIdP\u3067\u3082\u52d5\u304f\u3093\u304b\uff1f\u3068\u3044\u3046\u3053\u3068\u3067google\u306eAPI\u3092\u8a66\u3057\u3066\u307f\u305f\u3002\nRP\u60c5\u5831\u3084IdP\u60c5\u5831\u3092\u30ab\u30ab\u30c3\u3068\u3044\u3058\u308c\u3070\u52d5\u304f\u306e\u304b\u3001\u3068\u3044\u3046\u307b\u3069\u7518\u304f\u306f\u306a\u304f\u3001\n\u30fbgoogle\u306fnonce\u3092\u6295\u3052\u308b\u3068\u6012\u308b\n\u30fbUserinfo\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u306fAuthorization\u30d8\u30c3\u30c0\u3067\u306f\u306a\u304f\u30af\u30a8\u30ea\u3067\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u6e21\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\n\u306a\u3069\u3001\u7d30\u304b\u3044\u90e8\u5206\u306f\u3084\u3063\u3071\u308a\u9055\u3046\u3088\u3046\u3060\u3002\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306flogin\u3068signup\u306e\uff12\u3064\u306f\u500b\u5225\u306b\u5b9f\u88c5\u305b\u306b\u3083\u3042\u306a\u3089\u3093\u304b\u3063\u305f\u3002\n\n\u4ee5\u4e0a\u3067\u3042\u308b\u3002\n\u52d5\u304f\u3082\u306e\u306f\u4e00\u5fdc\u30b3\u30b3\u3078\u3002\n\u81ea\u4f5cIdP\u306f\u78ba\u8a8d\u3067\u304d\u306a\u3044\u3051\u3069google\u306e\u307b\u3046\u306f\u78ba\u8a8d\u3067\u304d\u308b\u3088\uff01\u3084\u3089\u306a\u304f\u3066\u3082\u3044\u3044\u3051\u3069\u3002\n\u3068\u308a\u3042\u3048\u305a\u3053\u3093\u306a\u611f\u3058\u3002\u4e00\u56de\u4f5c\u3063\u3066\u3057\u307e\u3048\u3070\u3044\u308d\u3093\u306aIdP\u3067\u4f7f\u3044\u307e\u308f\u305b\u308b\u3060\u308d\u3046\u3057\u3001\u6b63\u5e38\u30eb\u30fc\u30c8\u3060\u3051\u306a\u3089\u66f8\u304f\u91cf\u3082\u307b\u3068\u3093\u3069\u306a\u3044\u306d\u3002\n\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2013\n\uff1cOpenAM\u306e\u4eca\u5f8c\u306e\u30cd\u30bf\u3001\u60c5\u5831\u52df\u96c6\u4e2d\uff1e\n\u203b\u30b7\u30b0\u30cd\u30c1\u30e3\u306e\u691c\u8a3c\u3092\u3001\u3068\u308a\u3042\u3048\u305a\u512a\u5148\u5ea6\u9ad8\u3067\u8abf\u67fb\u3059\u308b\u3002\n\u203bdisplay\u306b\u306f\u5c11\u306a\u304f\u3068\u3082popup\u30d1\u30e9\u30e1\u30bf\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u3088\u3046\u3060\u3002wap\u3068touch\u306f\u8a66\u3057\u3066\u3044\u306a\u3044\u3002\n\u203bprompt\u306e\u52d5\u4f5c\u306f\u78ba\u8a8d\u3067\u304d\u306a\u304b\u3063\u305f\u3002login\u306b\u3057\u305f\u3068\u3053\u308d\u8a8d\u8a3c\u753b\u9762\u304c\u5fc5\u305a\u51fa\u308b\u3068\u3053\u307e\u3067\u306f\u78ba\u8a8d\u3057\u305f\u304c\u3001\u305d\u306e\u3042\u3068\u306bconsent_required\u306e\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u5148\u306b\u9032\u3081\u3093\u3002\n\u203bsession_check_endpoint\u306b\u306fOpenAM\u304b\u3089\u5171\u6709\u3059\u308b\u305f\u3081\u306e\u30bf\u30cd\u3092\u3082\u3089\u3063\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306f\u305a\u306a\u3093\u3060\u3051\u3069\u3001\u898b\u5f53\u305f\u3089\u306a\u3044\u3002id_token\u3092POST\u3059\u308b\u3068RFC\u306esession management\u306b\u8f09\u3063\u3066\u308bjsp\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u305d\u306e\u307e\u307e\u8fd4\u3063\u3066\u304f\u308b\u3001\u3088\u304f\u308f\u304b\u3089\u3093\u3002\n\u203blogout_endpoint\u306fid_token\u3092\u53d7\u3051\u53d6\u308b\u3088\u3046\u3060\u304c\u3001error_description: \u201cUnable to get SsoTokenManager\u201d\u3068\u51fa\u3066\u3057\u307e\u3044\u5148\u306b\u9032\u307e\u306a\u3044\u3002\n"}