{"context": " More than 1 year has passed since last update.\n\nCoreOS\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u30003\u53f0 + Worker 3\u53f0\u69cb\u6210\n\n\u524d\u63d0\ncoreos\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9 3\u53f0\u69cb\u6210\n\u304c\u51fa\u6765\u3066\u3044\u308b\u3053\u3068\n\n\u76ee\u6307\u3059\u69cb\u6210\n\n\n\u30a2\u30c9\u30ec\u30c3\u30c3\u30b7\u30f3\u30b0\n\n\n\n\u74b0\u5883\nhostname\nIP\u30a2\u30c9\u30ec\u30b9\nmeta\n\n\n\n\nMacbookAir 4GB\nhostserver\nxxx.xxx.xxx.xxx\nrole=services,cabinet=one\n\n\nvirtualbox1\ncoreos-01\n192.168.0.10\nrole=services,cabinet=one\n\n\nvirtualbox2\ncoreos-02\n192.168.0.20\nrole=services,cabinet=one\n\n\nvirtualbox3\ncoreos-03\n192.168.0.30\nrole=services,cabinet=one\n\n\nvirtualbox4\ncoreos-04\n192.168.0.11\nrole=workers,cabinet=two\n\n\nvirtualbox5\ncoreos-05\n192.168.0.21\nrole=workers,cabinet=two\n\n\nvirtualbox6\ncoreos-06\n192.168.0.31\nrole=workers,cabinet=two\n\n\n\n\nwork\u306e3\u53f0\u3092\u65b0\u898f\u306b\u69cb\u7bc9\u3059\u308b\nMac + Virtualbox + CoreOS + etcd2 + fleet \u306e\u57fa\u672c\u8a2d\u5b9a(1)\u3067\u4f5c\u6210\u3057\u305fcoreos\u306e\u30a4\u30e1\u30fc\u30b8\u30923\u53f0\u5206\u30af\u30ed\u30fc\u30f3\u3092\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u203b\u30af\u30ed\u30fc\u30f3\u306e\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u56de\u8a18\u4e8b\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n\nworker\u306bcloud-config.yml\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\ncloud-config.yml\nvim cloud-config.yml\n\n#cloud-config\n\nhostname: coreos-04\n\nwrite_files:\n- path: /etc/environment\n  content: |\n    COREOS_PUBLIC_IPV4=192.168.0.11\n    COREOS_PRIVATE_IPV4=192.168.0.11\n\ncoreos:\n  update:\n    reboot-strategy: 'off'\n  etcd2:\n    proxy: on \n    name: coreos-04\n    heartbeat-interval: 1000\n    election-timeout: 5000\n    listen-client-urls: http://0.0.0.0:2379\n    initial-cluster: coreos-01=http://192.168.0.10:2380,coreos-02=http://192.168.0.20:2380,coreos-03=http://192.168.0.30:2380\n\n  fleet:\n    etcd_servers: http://127.0.0.1:2379\n    public-ip: 192.168.0.11\n    metadata: \"role=workers,cabinet=two\"\n  flannel:\n    interface: 192.168.0.11\n  units:\n  - name: etcd2.service\n    command: start\n  - name: fleet.service\n    command: start\n  - name: docker.service\n    command: start\n  - name: timezone.service\n    command: start\n    content: |\n      [Unit]\n      Description=timezone\n      [Service]\n      Type=oneshot\n      RemainAfterExit=yes\n      ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n  - name: 10-static.network\n    runtime: false\n    content: |\n      [Match]\n      Name=enp0s3\n\n      [Network]\n      Address=192.168.0.11/24\n      DNS=8.8.8.8\n      DNS=8.8.4.4\n\nssh_authorized_keys:\n- ssh-rsa \u203b\u3054\u81ea\u8eab\u306e\u516c\u958b\u9375\n\nusers:\n- name: coreuser\n  passwd: $1$VIyj3wZe$HVVOEAc/H6a6YZGKCBWSD/\n  groups:\n  - sudo\n  - docker\n  ssh-authorized-keys:\n  - ssh-rsa \u203b\u3054\u81ea\u8eab\u306e\u516c\u958b\u9375\n\n\n\n\n\u4e0a\u8a18\u3092\u300c\u30a2\u30c9\u30ec\u30c3\u30b7\u30f3\u30b0\u300d\u306b\u3042\u308bhostname\u3068IP\u30a2\u30c9\u30ec\u30b9\u3092\u5408\u308f\u305b\u307e\u3059\u3002\n\ncloud-config.yml\u306e\u8aad\u307f\u8fbc\u307f\u5b9f\u65bd\n\ncloud-init\n\nsudo coreos-cloudinit -from-file=./cloud-config.yml\nsudo cp -a cloud-config.yml /var/lib/coreos-install/user_data\nsudo reboot\n\n\n\n\u203bcloud-init\u30b3\u30de\u30f3\u30c9\u3067\u53cd\u6620\u3055\u308c\u306a\u3044\u90e8\u5206\u304c\u3042\u308b\u306e\u3067\u3001\u76f4\u63a5user_data\u3082\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\netcdctl cluster-health\u306e\u78ba\u8a8d\n\ncluster-health\netcdctl cluster-health\nmember 59d0611e956db7d1 is healthy: got healthy result from http://192.168.0.20:2379\nmember 6fb0d145a155e8ee is healthy: got healthy result from http://192.168.0.30:2379\nmember 7a0fb1a3031d4c79 is healthy: got healthy result from http://192.168.0.10:2379\n\n\n\u4e0a\u8a18\u306e\u901a\u308a\u3001\u30af\u30e9\u30b9\u30bf\u5316\u3055\u308c\u3066\u3044\u308bIP\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\nfleetctl\u306e\u78ba\u8a8d\n\nfleetctl\nssh core@192.168.0.10\n\nfleetctl list-machines --full\n5b1639bd3cc347cf8fac0b9f597369e3    192.168.0.10    cabinet=one,role=services\n6d28316711484f039eca4408627fdb0c    192.168.0.11    cabinet=two,role=workers\n\n\n\u30fb\u30fb\u30fb\u672c\u6765\u3067\u3042\u308c\u3070\u30af\u30e9\u30b9\u30bf\u53ca\u3073worker\u3082\u5168\u90e8\u51fa\u3066\u304f\u308b\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u3002\u3002\u3002\n\u8abf\u3079\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\nCoreOS \u5165\u9580\n\n\u307e\u305f etcd \u306e name \u5c5e\u6027\u306f\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\u3002\n\u7565\u3059\u308b\u3068\u30de\u30b7\u30f3ID\u304c\u4f7f\u308f\u308c\u308b\u3002\u30de\u30b7\u30f3ID\u306f /etc/machine_id \u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\u30de\u30b7\u30f3ID\u306f\u74b0\u5883\u3092\u4f5c\u6210\u3059\u308b\u3068\u56fa\u5b9a\u5316\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067qemu\u306eimg\u3084vm\u3092\u4f7f\u3044\u307e\u308f\u3059\u3068\u30de\u30b7\u30f3ID\u304c\u5909\u308f\u3089\u305a\u6b63\u3057\u304f\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3067\u304d\u306a\u3044\u306e\u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\u3002\nroot\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066 /etc/machine_id \u3092\u524a\u9664\u3057\u3001\u518d\u751f\u6210\u3055\u305b\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3082\u3042\u308b\u3002\n\n\u306a\u308b\u307b\u3069\u3002\u3002\u3002\n\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\n\nmachinid_rename\nssh 192.168.0.10\nsudo mv /etc/machine-id /etc/machine-id.bk\nsudo reboot\n#\u3053\u306e\u52d5\u4f5c\u3092\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u306b\n\n\n\n\u518d\u5ea6fleetctl \u306e\u8868\u793a\u78ba\u8a8d\n\nfleetctl\nfleetctl list-machines --full\nMACHINE                 IP      METADATA\n4fb30e282c004f1794df9e91e56b14fb    192.168.0.31    cabinet=two,role=workers\n5b1639bd3cc347cf8fac0b9f597369e3    192.168.0.10    cabinet=one,role=services\n6d28316711484f039eca4408627fdb0c    192.168.0.11    cabinet=two,role=workers\n703c849bcb924af5891ca5aae95e4e89    192.168.0.21    cabinet=two,role=workers\na6776a02935e4f01857364587836e338    192.168.0.20    cabinet=one,role=services\nfffe34c5dcfa4aabbb1ba684101e521e    192.168.0.30    cabinet=one,role=services\n\n\n\n6\u53f0\u5206\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n\u3053\u308c\u3067CoreOS+etcd2+fleet\u3092\u4f7f\u7528\u3057\u305f\u30af\u30e9\u30b9\u30bf\u5316\u306e\u69cb\u6210\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56devagarant\u3092\u5229\u7528\u3057\u306a\u304b\u3063\u305f\u3053\u3068\u306b\u3064\u3044\u3066\nhttps://github.com/coreos/coreos-vagrant\n\u306b\u3066\u65e2\u306bvagrant\u306ebox\u53ca\u3073\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u5f53\u65b9\u306b\u3066\u4ee5\u4e0b\u306e\u4e8b\u8c61\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n1.$num_instance\u30923\u3067\u5b9f\u884c\u3057\u3001coreos\u3092vagrant up\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u554f\u984c\u306a\u304f\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u6210\u3067UP\u3055\u308c\u308b\n2.\u30af\u30e9\u30b9\u30bf\u304c\u6b63\u5e38\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u306e\u691c\u8a3c\u3092\u3059\u308b\u305f\u3081\u306b\u3001vagrant halt **\u3067\u7279\u5b9a\u306e\u7aef\u672b\u3092\u843d\u3068\u3057\u3001vagrant up | vagrant resume\u3067\u8d77\u52d5\u3057\u3066\u3082\u3001IP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3046\u3002\u203buser_data\u304c\u4fdd\u6301\u3055\u308c\u306a\u3044\n3.user_data\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306bcloud-init/coreos-install\u3057\u3066\u3082\u3084\u306f\u308a\u63ee\u767a\u6027\u304c\u3042\u308a\u691c\u8a3c\u304c\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\n\u79c1\u306evagrant\u306e\u4f7f\u3044\u65b9\u304c\u307e\u305a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4e0a\u8a18\u306e\u4e8b\u8c61\u304c\u304a\u304d\u3066\u3057\u307e\u3063\u305f\u305f\u3081\u65ad\u5ff5\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\u203b\u305f\u3060\u3057\u3001vagrant\u3067\u5229\u7528\u3067\u304d\u308c\u3070cloud-config.yml\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u3092$public_ipv4\u306a\u3069\u5909\u6570\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u306e\u3067\u5927\u5909\u4fbf\u5229\u3067\u3059\u3002\n\nThis was intended but we should probably revise it if folks are depending on the old contents of /etc/environment. For EC2/OpenStack instances we moved the detection of $public_ipv4 and $private_ipv4 directly into coreos-cloudinit so that it would work gracefully with both EC2-style metadata services and config drive. The old /usr/share/oem/bin/coreos-setup-environment shipped with those images hung if no metadata service was available, breaking config drive based OpenStack systems.\n\n\n\u6b21\u56de\n\u672c\u69cb\u6210\u3092\u57fa\u790e\u69cb\u6210\u3068\u3057\u3066\u3001fleetctl\u3092\u4f7f\u3063\u305fUnit\u3001docker\u306e\u914d\u7f6e\u65b9\u6cd5\u3084failover\u306e\u5185\u5bb9\u306b\u89e6\u308c\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\nCoreOS\u5165\u9580\n# CoreOS\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u30003\u53f0 + Worker 3\u53f0\u69cb\u6210\n\n## \u524d\u63d0\n\n[coreos\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9 3\u53f0\u69cb\u6210](http://qiita.com/xshsaku/items/a5b57fafa0b41740bd7f)\n\u304c\u51fa\u6765\u3066\u3044\u308b\u3053\u3068\n\n## \u76ee\u6307\u3059\u69cb\u6210\n\n![cluster02.png](https://qiita-image-store.s3.amazonaws.com/0/93976/0f92f77b-5ac7-4629-4337-29b3a89f3e7a.png)\n\n## \u30a2\u30c9\u30ec\u30c3\u30c3\u30b7\u30f3\u30b0\n\n| \u74b0\u5883 | hostname | IP\u30a2\u30c9\u30ec\u30b9 |meta|\n|:-----------:|:------------:|:------------:|:------------|\n|MacbookAir 4GB|hostserver|xxx.xxx.xxx.xxx|role=services,cabinet=one|\n|virtualbox1|coreos-01|192.168.0.10|role=services,cabinet=one|\n|virtualbox2|coreos-02|192.168.0.20|role=services,cabinet=one|\n|virtualbox3|coreos-03|192.168.0.30|role=services,cabinet=one|\n|virtualbox4|coreos-04|192.168.0.11|role=workers,cabinet=two|\n|virtualbox5|coreos-05|192.168.0.21|role=workers,cabinet=two|\n|virtualbox6|coreos-06|192.168.0.31|role=workers,cabinet=two|\n\n\n## work\u306e3\u53f0\u3092\u65b0\u898f\u306b\u69cb\u7bc9\u3059\u308b\n\n[Mac + Virtualbox + CoreOS + etcd2 + fleet \u306e\u57fa\u672c\u8a2d\u5b9a(1)](http://qiita.com/xshsaku/items/5be3837c39bb8c9bd4e7)\u3067\u4f5c\u6210\u3057\u305fcoreos\u306e\u30a4\u30e1\u30fc\u30b8\u30923\u53f0\u5206\u30af\u30ed\u30fc\u30f3\u3092\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u203b\u30af\u30ed\u30fc\u30f3\u306e\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u56de\u8a18\u4e8b\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n\n## worker\u306bcloud-config.yml\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n```coreos:cloud-config.yml\nvim cloud-config.yml\n\n#cloud-config\n\nhostname: coreos-04\n\nwrite_files:\n- path: /etc/environment\n  content: |\n    COREOS_PUBLIC_IPV4=192.168.0.11\n    COREOS_PRIVATE_IPV4=192.168.0.11\n\ncoreos:\n  update:\n    reboot-strategy: 'off'\n  etcd2:\n    proxy: on \n    name: coreos-04\n    heartbeat-interval: 1000\n    election-timeout: 5000\n    listen-client-urls: http://0.0.0.0:2379\n    initial-cluster: coreos-01=http://192.168.0.10:2380,coreos-02=http://192.168.0.20:2380,coreos-03=http://192.168.0.30:2380\n\n  fleet:\n    etcd_servers: http://127.0.0.1:2379\n    public-ip: 192.168.0.11\n    metadata: \"role=workers,cabinet=two\"\n  flannel:\n    interface: 192.168.0.11\n  units:\n  - name: etcd2.service\n    command: start\n  - name: fleet.service\n    command: start\n  - name: docker.service\n    command: start\n  - name: timezone.service\n    command: start\n    content: |\n      [Unit]\n      Description=timezone\n      [Service]\n      Type=oneshot\n      RemainAfterExit=yes\n      ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n  - name: 10-static.network\n    runtime: false\n    content: |\n      [Match]\n      Name=enp0s3\n\n      [Network]\n      Address=192.168.0.11/24\n      DNS=8.8.8.8\n      DNS=8.8.4.4\n\nssh_authorized_keys:\n- ssh-rsa \u203b\u3054\u81ea\u8eab\u306e\u516c\u958b\u9375\n\nusers:\n- name: coreuser\n  passwd: $1$VIyj3wZe$HVVOEAc/H6a6YZGKCBWSD/\n  groups:\n  - sudo\n  - docker\n  ssh-authorized-keys:\n  - ssh-rsa \u203b\u3054\u81ea\u8eab\u306e\u516c\u958b\u9375\n\n```\n\n#### \u4e0a\u8a18\u3092\u300c\u30a2\u30c9\u30ec\u30c3\u30b7\u30f3\u30b0\b\u300d\u306b\u3042\u308bhostname\u3068IP\u30a2\u30c9\u30ec\u30b9\u3092\u5408\u308f\u305b\u307e\u3059\u3002\n\n## cloud-config.yml\u306e\u8aad\u307f\u8fbc\u307f\u5b9f\u65bd\n\n```coreos:cloud-init\n\nsudo coreos-cloudinit -from-file=./cloud-config.yml\nsudo cp -a cloud-config.yml /var/lib/coreos-install/user_data\nsudo reboot\n\n```\n\u203bcloud-init\u30b3\u30de\u30f3\u30c9\u3067\u53cd\u6620\u3055\u308c\u306a\u3044\u90e8\u5206\u304c\u3042\u308b\u306e\u3067\u3001\u76f4\u63a5user_data\u3082\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n\n## etcdctl cluster-health\u306e\u78ba\u8a8d\n\n```shell:cluster-health\netcdctl cluster-health\nmember 59d0611e956db7d1 is healthy: got healthy result from http://192.168.0.20:2379\nmember 6fb0d145a155e8ee is healthy: got healthy result from http://192.168.0.30:2379\nmember 7a0fb1a3031d4c79 is healthy: got healthy result from http://192.168.0.10:2379\n```\n\n\u4e0a\u8a18\u306e\u901a\u308a\u3001\u30af\u30e9\u30b9\u30bf\u5316\u3055\u308c\u3066\u3044\u308bIP\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n## fleetctl\u306e\u78ba\u8a8d\n\n```shell:fleetctl\nssh core@192.168.0.10\n\nfleetctl list-machines --full\n5b1639bd3cc347cf8fac0b9f597369e3\t192.168.0.10\tcabinet=one,role=services\n6d28316711484f039eca4408627fdb0c\t192.168.0.11\tcabinet=two,role=workers\n```\n\n\u30fb\u30fb\u30fb\u672c\u6765\u3067\u3042\u308c\u3070\u30af\u30e9\u30b9\u30bf\u53ca\u3073worker\u3082\u5168\u90e8\u51fa\u3066\u304f\u308b\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u3002\u3002\u3002\n\n\u8abf\u3079\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\n[CoreOS \u5165\u9580](http://qiita.com/mopemope/items/fa9424b094aae3eac580)\n\n> \u307e\u305f etcd \u306e name \u5c5e\u6027\u306f\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\u3002\n\u7565\u3059\u308b\u3068\u30de\u30b7\u30f3ID\u304c\u4f7f\u308f\u308c\u308b\u3002\u30de\u30b7\u30f3ID\u306f /etc/machine_id \u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\u30de\u30b7\u30f3ID\u306f\u74b0\u5883\u3092\u4f5c\u6210\u3059\u308b\u3068\u56fa\u5b9a\u5316\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067qemu\u306eimg\u3084vm\u3092\u4f7f\u3044\u307e\u308f\u3059\u3068\u30de\u30b7\u30f3ID\u304c\u5909\u308f\u3089\u305a\u6b63\u3057\u304f\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u3067\u304d\u306a\u3044\u306e\u3067\u6ce8\u610f\u3059\u308b\u3053\u3068\u3002\nroot\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066 /etc/machine_id \u3092\u524a\u9664\u3057\u3001\u518d\u751f\u6210\u3055\u305b\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3082\u3042\u308b\u3002\n\n\n\u306a\u308b\u307b\u3069\u3002\u3002\u3002\n\n\u3068\u3044\u3046\u3068\u3053\u308d\u3067\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\n\n```coreos:machinid_rename\nssh 192.168.0.10\nsudo mv /etc/machine-id /etc/machine-id.bk\nsudo reboot\n#\u3053\u306e\u52d5\u4f5c\u3092\u5168\u3066\u306e\u30b5\u30fc\u30d0\u30fc\u306b\n```\n\n## \u518d\u5ea6fleetctl \u306e\u8868\u793a\u78ba\u8a8d\n\n```coreos:fleetctl\nfleetctl list-machines --full\nMACHINE\t\t\t\t\tIP\t\tMETADATA\n4fb30e282c004f1794df9e91e56b14fb\t192.168.0.31\tcabinet=two,role=workers\n5b1639bd3cc347cf8fac0b9f597369e3\t192.168.0.10\tcabinet=one,role=services\n6d28316711484f039eca4408627fdb0c\t192.168.0.11\tcabinet=two,role=workers\n703c849bcb924af5891ca5aae95e4e89\t192.168.0.21\tcabinet=two,role=workers\na6776a02935e4f01857364587836e338\t192.168.0.20\tcabinet=one,role=services\nfffe34c5dcfa4aabbb1ba684101e521e\t192.168.0.30\tcabinet=one,role=services\n\n```\n6\u53f0\u5206\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n\n\u3053\u308c\u3067CoreOS+etcd2+fleet\u3092\u4f7f\u7528\u3057\u305f\u30af\u30e9\u30b9\u30bf\u5316\u306e\u69cb\u6210\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n### \u4eca\u56devagarant\u3092\u5229\u7528\u3057\u306a\u304b\u3063\u305f\u3053\u3068\u306b\u3064\u3044\u3066\n\nhttps://github.com/coreos/coreos-vagrant\n\n\u306b\u3066\u65e2\u306bvagrant\u306ebox\u53ca\u3073\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u5f53\u65b9\u306b\u3066\u4ee5\u4e0b\u306e\u4e8b\u8c61\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n1.$num_instance\u30923\u3067\u5b9f\u884c\u3057\u3001coreos\u3092vagrant up\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u554f\u984c\u306a\u304f\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u6210\u3067UP\u3055\u308c\u308b\n2.\u30af\u30e9\u30b9\u30bf\u304c\u6b63\u5e38\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u306e\u691c\u8a3c\u3092\u3059\u308b\u305f\u3081\u306b\u3001vagrant halt **\u3067\u7279\u5b9a\u306e\u7aef\u672b\u3092\u843d\u3068\u3057\u3001vagrant up | vagrant resume\u3067\u8d77\u52d5\u3057\u3066\u3082\u3001IP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3046\u3002\u203buser_data\u304c\u4fdd\u6301\u3055\u308c\u306a\u3044\n3.user_data\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306bcloud-init/coreos-install\u3057\u3066\u3082\u3084\u306f\u308a\u63ee\u767a\u6027\u304c\u3042\u308a\u691c\u8a3c\u304c\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\n\n\u79c1\u306evagrant\u306e\u4f7f\u3044\u65b9\u304c\u307e\u305a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4e0a\u8a18\u306e\u4e8b\u8c61\u304c\u304a\u304d\u3066\u3057\u307e\u3063\u305f\u305f\u3081\u65ad\u5ff5\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\u203b\u305f\u3060\u3057\u3001vagrant\u3067\u5229\u7528\u3067\u304d\u308c\u3070cloud-config.yml\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u3092$public_ipv4\u306a\u3069\u5909\u6570\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u306e\u3067\u5927\u5909\u4fbf\u5229\u3067\u3059\u3002\n\n> This was intended but we should probably revise it if folks are depending on the old contents of /etc/environment. For EC2/OpenStack instances we moved the detection of $public_ipv4 and $private_ipv4 directly into coreos-cloudinit so that it would work gracefully with both EC2-style metadata services and config drive. The old /usr/share/oem/bin/coreos-setup-environment shipped with those images hung if no metadata service was available, breaking config drive based OpenStack systems.\n\n## \u6b21\u56de\n\n\u672c\u69cb\u6210\u3092\u57fa\u790e\u69cb\u6210\u3068\u3057\u3066\u3001fleetctl\u3092\u4f7f\u3063\u305fUnit\u3001docker\u306e\u914d\u7f6e\u65b9\u6cd5\u3084failover\u306e\u5185\u5bb9\u306b\u89e6\u308c\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u53c2\u8003\n\n[CoreOS\u5165\u9580](http://qiita.com/mopemope/items/fa9424b094aae3eac580)\n\n\n", "tags": ["VirtualBox", "etcd2", "etcd", "fleet", "CoreOS"]}