{"context": " More than 1 year has passed since last update.\u3053\u3093\u306b\u3061\u306f\u3001\u3072\u308d\u304b\u305a\u3067\u3059\u3002\n2015\u5e7411\u670827\u65e5\u306bGithub\u306bDeep Security ~ AWS WAF\u9023\u643a\u30c4\u30fc\u30eb\u304c\u516c\u958b\u3055\u308c\u307e\u3057\u305f\u3002\n\u5f53\u521d\u3001\u306a\u304b\u306a\u304b\u3046\u307e\u304f\u884c\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u3046\u3084\u304f\u8a55\u4fa1\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067\u6f15\u304e\u7740\u3051\u305f\u306e\u3067\u4e00\u7b46\u66f8\u304d\u307e\u3059\u3002\n\n\u53c2\u8003\nGithub\u30ea\u30dd\u30b8\u30c8\u30ea deep-security/aws-waf\n\n\u6a5f\u80fd\u6982\u8981\nDeep Security\u4e0a\u306eIP\u30ea\u30b9\u30c8\u3092AWS WAF\u306econditions\u306b\u9023\u643a\u3055\u305b\u307e\u3059\u3002\n\u5b9f\u4f53\u306fpyhton\u3067\u66f8\u304b\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u7fa4\u3067\u3059\u3002\n\n\u52d5\u4f5c\u74b0\u5883\n\n\u30c4\u30fc\u30eb\u5b9f\u884c\u5074\nphthon 2.7\u7cfb\nboto3 1.3.1\nawscli 1.9.1\n\n\u305d\u306e\u4ed6\u7528\u610f\u3059\u308b\u3082\u306e\nDSaaS\nAWS WAF\n\n\u5de5\u7a0b\n\n\u52d5\u4f5c\u74b0\u5883\u306e\u7528\u610f\n\u30c4\u30fc\u30eb\u306e\u6e96\u5099\n\u5b9f\u884c\u3068\u8a55\u4fa1\n\n\n1. \u52d5\u4f5c\u74b0\u5883\u306e\u7528\u610f\n\u4eca\u56de\u306f\u3001 Amazon Linux AMI 2015.09.1 (HVM), SSD Volume Type - ami-383c1956 \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u8d77\u52d5\u306b\u5148\u7acb\u3063\u3066\u3001AWS WAF\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\u306e\u3042\u308bIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3001t2.nano\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\nPython\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\u30c4\u30fc\u30eb\u306f\u3001python 2.6\u7cfb\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u8a18\u8ff0\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n2.7\u7cfb\u306e\u74b0\u5883\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ python\nPython 2.7.10 (default, Aug 11 2015, 23:39:10)\n[GCC 4.8.3 20140911 (Red Hat 4.8.3-9)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n\nawscli\u3068boto3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ aws --version\naws-cli/1.9.1 Python/2.7.10 Linux/4.1.10-17.31.amzn1.x86_64 botocore/1.3.1\n\ngit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo yum -y install git\n\uff1a\n$ git --version\ngit version 2.4.3\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30af\u30ed\u30fc\u30f3\u3057\u307e\u3059\u3002\n$ git clone https://github.com/deep-security/aws-waf.git\nCloning into 'aws-waf'...\nremote: Counting objects: 205, done.\nremote: Total 205 (delta 0), reused 0 (delta 0), pack-reused 205\nReceiving objects: 100% (205/205), 604.94 KiB | 157.00 KiB/s, done.\nResolving deltas: 100% (42/42), done.\nChecking connectivity... done.\n\n\u3067\u304d\u307e\u3057\u305f\u306d\n$ ll\n\u5408\u8a08 4\ndrwxrwxr-x 4 ec2-user ec2-user 4096  2\u6708 10 10:08 aws-waf\n\n$ cd aws-waf/\n$ ll\n\u5408\u8a08 20\n-rw-rw-r-- 1 ec2-user ec2-user 1081  2\u6708 10 10:08 LICENSE\n-rw-rw-r-- 1 ec2-user ec2-user 4762  2\u6708 10 10:08 README.md\ndrwxrwxr-x 5 ec2-user ec2-user 4096  2\u6708 10 10:08 dsawswaf\n-rw-rw-r-- 1 ec2-user ec2-user   33  2\u6708 10 10:08 requirements.txt\n\n\u52d5\u4f5c\u53ef\u80fd\u306a\u30d0\u30fc\u30b8\u30e7\u30f3(a877db1)\u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002\n\u203b \u73fe\u5728\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n$ git checkout a877db1adb53b790f470065ed71df96f6ead82fb\nNote: checking out 'a877db1adb53b790f470065ed71df96f6ead82fb'.\n\nYou are in 'detached HEAD' state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b <new-branch-name>\n\nHEAD is now at a877db1... Fixed typo in boto3 version\n\n\u78ba\u8a8d\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n$ ll\n\u5408\u8a08 20\n-rw-rw-r-- 1 ec2-user ec2-user 1081  2\u6708 10 10:08 LICENSE\n-rw-rw-r-- 1 ec2-user ec2-user 4586  2\u6708 10 10:12 README.md \u2605\ndrwxrwxr-x 5 ec2-user ec2-user 4096  2\u6708 10 10:12 dsawswaf \u2605\n-rw-rw-r-- 1 ec2-user ec2-user   33  2\u6708 10 10:08 requirements.txt\n\nreadme.md\u306b\u3042\u308b\u901a\u308a\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo pip install -r requirements.txt\nYou are using pip version 6.1.1, however version 8.0.2 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\nCollecting netaddr>=0.7.18 (from -r requirements.txt (line 1))\n  Downloading netaddr-0.7.18-py2.py3-none-any.whl (1.5MB)\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 1.5MB 308kB/s\nCollecting boto3>=1.2.1 (from -r requirements.txt (line 2))\n  Downloading boto3-1.2.3-py2.py3-none-any.whl (108kB)\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 110kB 4.0MB/s\nRequirement already satisfied (use --upgrade to upgrade): jmespath<1.0.0,>=0.7.1 in /usr/lib/python2.7/dist-packages (from boto3>=1.2.1->-r requirements.txt (line 2))\nCollecting futures<4.0.0,>=2.2.0 (from boto3>=1.2.1->-r requirements.txt (line 2))\n  Downloading futures-3.0.4-py2-none-any.whl\nRequirement already satisfied (use --upgrade to upgrade): botocore<1.4.0,>=1.3.0 in /usr/lib/python2.7/dist-packages (from boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): python-dateutil<3.0.0,>=2.1 in /usr/lib/python2.7/dist-packages (from botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): docutils>=0.10 in /usr/lib/python2.7/dist-packages (from botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): six in /usr/lib/python2.7/dist-packages (from python-dateutil<3.0.0,>=2.1->botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nInstalling collected packages: netaddr, futures, boto3\nSuccessfully installed boto3-1.2.3 futures-3.0.4 netaddr-0.7.18\n\n\u52d5\u4f5c\u78ba\u8a8d\u3002\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n$ python ip_list_to_set.py -h\nusage: ip_list_to_set.py [-h] [-d IP_LIST] [-l] [-m DSM] -u USERNAME -p\n                         PASSWORD [-t TENANT] [--dryrun] [--verbose]\n:\n\n\n\n2. DSaaS\u306e\u6e96\u5099\n\u3053\u306e\u30c4\u30fc\u30eb\u306f\u3001\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u305f\u6642\u70b9\u3067\u306f\u3001DSaaS\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u3066\u3001\u30b5\u30fc\u30d0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fDSM\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nDSaaS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u7528\u610f\u3057\u3066\u3001API\u7528\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u8a2d\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\u307e\u305a\u3001\u5f79\u5272\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u3001\u5f79\u5272\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\nIP\u30ea\u30b9\u30c8\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u672c\u6765\u306f\u3001\u904b\u7528\u3067\u6210\u719f\u3057\u305fIP\u30ea\u30b9\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3053\u308d\u3067\u3059\u306d\u3002\n\n\n3. AWS WAF\u306e\u6e96\u5099\n\u7279\u306b\u3042\u308a\u307e\u305b\u3093\u304c\u3001conditions\u306e\u72b6\u6cc1\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n4. \u5b9f\u884c\u3068\u8a55\u4fa1\n\n4-1. \u307e\u305a\u306f\u5b9f\u884c\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u884c\u3057\u307e\u3057\u3087\u3046\u3002\n\u307e\u305a\u306f\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\u3067\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u306f\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30c6\u30ca\u30f3\u30c8\u540d\u306f\u3001DSaaS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4f5c\u6210\u3057\u305fIP\u30ea\u30b9\u30c8 myIP \u306eID\u304c 21 \u3067\u3042\u308b\u3053\u3068\u304c\u5224\u308a\u307e\u3059\u306d\u3002\n\u540c\u6642\u306b AWS WAF \u306econditions\u3000(IP Sets)\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n$ python ip_list_to_set.py -l -u webapi -p xxxxxxxx -t tenant_name\n\nAvailable Deep Security IP Lists\n================================\n1   Ignore Reconnaissance\n2   Network Broadcast\n3   Ingress Filters\n4   Domain Controller(s)\n5   Off Domain IPs\n6   Corporate Network IPs\n7   VPN Tunnel IPs\n21  myIP\n\nAvailable AWS WAF IP Sets\n=========================\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx    test3\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx    test2\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx    test\n\n\u3067\u306f\u3001IP\u30ea\u30b9\u30c8 myIP \u3092 AWS WAF \u306econditions\u3000(IP Sets)\u306b\u9023\u643a\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nIP\u30ea\u30b9\u30c8 myIP \u306eID 21 \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f --dryrun \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3068\u3001 Will request the creation of [myIP] \u3068\u51fa\u307e\u3059\u306d\u3002\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nWill request the creation of [myIP]\n\n--dryrun \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5916\u3059\u3068\u5b9f\u969b\u306b\u9023\u643a\u3055\u308c\u307e\u3059\u3002\nCreated IP Set [myIP] \u3068\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name\nConverted 1 IP List entries to 1 IP Set entries\nCreated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n\nAWS WAF\u306econditions\u3092\u898b\u308b\u3068\u3001 myIP \u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u5185\u5bb9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n4-2. \u8a55\u4fa1\n\n\u8ffd\u52a01\nIPList\u306b\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u3066\u3082\u3046\u4e00\u5ea6\u9023\u643a\u3057\u307e\u3059\u3002\n\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nConverted 2 IP List entries to 2 IP Set entries\nWill request the addition of 2 entries in IP Set xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\nWill update IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001 Converted 2 IP List entries to 2 IP Set entries \u3068\u51fa\u307e\u3059\u306d\u3002\n1\u3064\u8ffd\u52a0\u306a\u306e\u3067\u3059\u304c\u30012\u3064\u306eIP List entries\u3068\u8a00\u3063\u3066\u3044\u307e\u3059\u3002\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name\nConverted 2 IP List entries to 2 IP Set entries\nUpdated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n\n\u7d50\u679c\u306f\u3053\u3061\u3089\u3002\n\u8ffd\u52a0\u5206\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\u5909\u66f41\n\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f 115.xxx.xxx.xxx/32 \u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u6b21\u306f\u3061\u3087\u3063\u3068\u5909\u5316\u7403\u3067 Deep Security\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u304c\u3001AWS\u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u306a\u3044\u8868\u793a\u5f62\u5f0f\u306b\u3057\u3066\u307f\u307e\u3059\u3002\nDeep Security\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u8868\u793a\u5f62\u5f0f\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\n\u307e\u305a\u306f\u3001 115.xxx.xxx.xxx/32 \u3092 115.xxx.xxx.0/255.255.255.0 \u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u3002(\u8868\u793a\u304c\u540c\u3058\u3060\u3063\u305f\u306e\u3067)\n\u306a\u3093\u3068\u3001115.xxx.xxx.xxx/32 \u306f\u5909\u66f4\u3055\u308c\u305a\u306b\u305d\u306e\u307e\u307e\u6b8b\u308a\u3001115.xxx.xxx.0/24\u3068\u3057\u3066\u8ffd\u52a0\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002\n\u306a\u304b\u306a\u304b\u306b\u8ce2\u3044\u3067\u3059\u306d\u3002\n\n\n\u5909\u66f42\n\u6b21\u306f\u3001115.xxx.xxx.0/255.255.255.0 \u3092 123.xxx.xxx.0 - 123.xxx.xxx.255 \u306b\u3057\u307e\u3059\u3002\n\u671f\u5f85\u5024\u306f\u3001123.xxx.xxx.0/24 \u304c\u8ffd\u52a0\u3055\u308c\u308b \u3067\u3059\u3002\n\n$ python ip_list_to_set.py -d 21 -u webapi -p nPxwcrV3 -t securitypack_dev@cloudpack.jp --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nConverted 2 IP List entries to 1 IP Set entries\nWill request the addition of 1 entries in IP Set xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\nWill update IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n\n\u51fa\u529b\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u306d\u3002\nConverted 2 IP List entries to 1 IP Set entries\u3068\u51fa\u3066\u307e\u3059\u3002\n$ python ip_list_to_set.py -d 21 -u webapi -p nPxwcrV3 -t securitypack_dev@cloudpack.jp\nConverted 2 IP List entries to 1 IP Set entries\nUpdated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n\n123.xxx.xxx.0/24 \u306f\u8ffd\u52a0\u3055\u308c\u307e\u305b\u3093\u306d\u3002\n\u30ec\u30f3\u30b8\u8868\u8a18\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\n\u8ffd\u52a02\uff082016/2/12\u8ffd\u88dc\uff09\n\u3072\u3087\u3063\u3068\u3057\u305f\u3089\u3001CIDER\u3084\u30de\u30b9\u30af\u304c\u306a\u3044\u8868\u8a18\u304c\u554f\u984c\u304b\u3082\u3057\u308c\u306a\u3044\u306e\u3067\u3001\u5207\u308a\u5206\u3051\u307e\u3059\u3002\n123.xxx.xxx.0 \u3092\u8ffd\u52a0\u3057\u3066\u3001\u9023\u643a\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u7d50\u679c\u306f123.xxx.xxx.0/32\u3068CIDER\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\u306a\u304b\u306a\u304b\u306b\uff08\u7565\n\n\n\u8ffd\u52a03\uff082016/2/12\u8ffd\u88dc\uff09\n\u5b9f\u969b\u306b\u904b\u7528\u4e2d\u306eIP\u30ea\u30b9\u30c8\u306b\u306f\u3001\u30b3\u30e1\u30f3\u30c8\u304c\u591a\u6570\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u60f3\u5b9a\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001123.42.99.1/32 #hogehoge\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u304a\u3063\u3068\u3001\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u306d\u3002\n# \u304c\u4e0a\u624b\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u904b\u7528\u4e0a\u3001\u3061\u3087\u3063\u3068\u56f0\u308a\u307e\u3059\u306d\u3002\uff082016/3/4\u4fee\u6b63\u6e08\u307f\uff09\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nTraceback (most recent call last):\n  File \"ip_list_to_set.py\", line 385, in <module>\n    if __name__ == '__main__': main()\n  File \"ip_list_to_set.py\", line 381, in main\n    context.create_ip_set(ip_list)\n  File \"ip_list_to_set.py\", line 321, in create_ip_set\n    updates = self._convert_ds_addresses_to_waf(ds_list)\n  File \"ip_list_to_set.py\", line 274, in _convert_ds_addresses_to_waf\n    addresses = self._parse_ds_addresses(ds_list)\n  File \"ip_list_to_set.py\", line 239, in _parse_ds_addresses\n    if \"#\" in address: address = split('#').strip() # remove any comments\nNameError: global name 'split' is not defined\n\n\n\u307e\u3068\u3081\nDeep Security~AWS WAF\u9023\u643a\u30c4\u30fc\u30eb\u306e\u8a55\u4fa1\u3092\u307e\u3068\u3081\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3(a877db1)\u304c\u52d5\u4f5c\u53ef\u80fd\u306a\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\nDSaaS\u306eIP\u30ea\u30b9\u30c8\u3092\u6307\u5b9a\u3057\u3066\u3001AWS WAF\u306econditions(IP Lists)\u306b\u8ffd\u52a0\u3059\u308b\u6a5f\u80fd\n\u540c\u540d\u306econditions(IP Lists)\u304c\u306a\u3051\u308c\u3070\u4f5c\u6210\u3059\u308b\n\u540c\u540d\u306econditions(IP Lists)\u304c\u3042\u308c\u3070\u3001\u5dee\u5206\u3092\u8ffd\u52a0\u3059\u308b\u3002(\u524a\u9664\u3057\u306a\u3044)\nIP\u30ea\u30b9\u30c8\u3067\u30de\u30b9\u30af\u8868\u8a18\u3055\u308c\u308b\u3082\u306e\u306fCIDER\u5f62\u5f0f\u306b\u5909\u63db\u3055\u308c\u308b\u3002\nIP\u30ea\u30b9\u30c8\u3067\u30ec\u30f3\u30b8\u8868\u8a18\u3055\u308c\u308b\u3082\u306e\u306f\u767b\u9332\u3055\u308c\u306a\u3044\u3002\n\n\u30b3\u30e1\u30f3\u30c8#\u304c\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u306e\u3067\u3001IP\u30ea\u30b9\u30c8\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3057\u305f\u3082\u306e\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff082016/2/12\u8ffd\u52a0\uff09 \uff082016/3/4\u4fee\u6b63\u6e08\u307f\uff09\n\n\u4e0a\u8a18\u7279\u6027\u3092\u7406\u89e3\u3057\u3066\u3001\u6d3b\u7528\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n\u6d3b\u7528\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u3064\u3044\u3066\u306f\u3001\u5225\u9014\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nGithub\u306b\u767b\u9332\u3055\u308c\u305f\u30c4\u30fc\u30eb\u306a\u306e\u3067\u3001\u554f\u3044\u5408\u308f\u305b\u3084\u30d0\u30b0\u306e\u6307\u6458\u306fGithub\u306b\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\u958b\u767a\u8005\u3068\u76f4\u63a5\u3084\u308a\u53d6\u308a\u3067\u304d\u308b\u306e\u304c\u9b45\u529b\u3067\u3059\u306d\u3002\n\u4eca\u65e5\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n\n\u3053\u3093\u306b\u3061\u306f\u3001\u3072\u308d\u304b\u305a\u3067\u3059\u3002\n\n2015\u5e7411\u670827\u65e5\u306bGithub\u306bDeep Security ~ AWS WAF\u9023\u643a\u30c4\u30fc\u30eb\u304c\u516c\u958b\u3055\u308c\u307e\u3057\u305f\u3002\n\u5f53\u521d\u3001\u306a\u304b\u306a\u304b\u3046\u307e\u304f\u884c\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u3046\u3084\u304f\u8a55\u4fa1\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067\u6f15\u304e\u7740\u3051\u305f\u306e\u3067\u4e00\u7b46\u66f8\u304d\u307e\u3059\u3002\n\n#\u53c2\u8003\n[Github\u30ea\u30dd\u30b8\u30c8\u30ea deep-security/aws-waf](https://github.com/deep-security/aws-waf)\n\n#\u6a5f\u80fd\u6982\u8981\nDeep Security\u4e0a\u306eIP\u30ea\u30b9\u30c8\u3092AWS WAF\u306econditions\u306b\u9023\u643a\u3055\u305b\u307e\u3059\u3002\n\u5b9f\u4f53\u306fpyhton\u3067\u66f8\u304b\u308c\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u7fa4\u3067\u3059\u3002\n\n#\u52d5\u4f5c\u74b0\u5883\n##\u30c4\u30fc\u30eb\u5b9f\u884c\u5074\nphthon 2.7\u7cfb\nboto3 1.3.1\nawscli 1.9.1\n##\u305d\u306e\u4ed6\u7528\u610f\u3059\u308b\u3082\u306e\nDSaaS\nAWS WAF\n\n\n#\u5de5\u7a0b\n1. \u52d5\u4f5c\u74b0\u5883\u306e\u7528\u610f\n2. \u30c4\u30fc\u30eb\u306e\u6e96\u5099\n3. \u5b9f\u884c\u3068\u8a55\u4fa1\n\n#1. \u52d5\u4f5c\u74b0\u5883\u306e\u7528\u610f\n\u4eca\u56de\u306f\u3001 `Amazon Linux AMI 2015.09.1 (HVM), SSD Volume Type - ami-383c1956` \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\u8d77\u52d5\u306b\u5148\u7acb\u3063\u3066\u3001AWS WAF\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u6a29\u306e\u3042\u308bIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n![IAM_role.png](https://qiita-image-store.s3.amazonaws.com/0/46611/4c43370e-bdec-a767-65dc-8c18db8bf5cd.png \"IAM_role.png\")\n\n\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3001t2.nano\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nPython\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\u30c4\u30fc\u30eb\u306f\u3001python 2.6\u7cfb\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u8a18\u8ff0\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n2.7\u7cfb\u306e\u74b0\u5883\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ python\nPython 2.7.10 (default, Aug 11 2015, 23:39:10)\n[GCC 4.8.3 20140911 (Red Hat 4.8.3-9)] on linux2\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n```\nawscli\u3068boto3\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```\n$ aws --version\naws-cli/1.9.1 Python/2.7.10 Linux/4.1.10-17.31.amzn1.x86_64 botocore/1.3.1\n```\n\ngit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo yum -y install git\n\uff1a\n$ git --version\ngit version 2.4.3\n```\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30af\u30ed\u30fc\u30f3\u3057\u307e\u3059\u3002\n\n```\n$ git clone https://github.com/deep-security/aws-waf.git\nCloning into 'aws-waf'...\nremote: Counting objects: 205, done.\nremote: Total 205 (delta 0), reused 0 (delta 0), pack-reused 205\nReceiving objects: 100% (205/205), 604.94 KiB | 157.00 KiB/s, done.\nResolving deltas: 100% (42/42), done.\nChecking connectivity... done.\n```\n\n\u3067\u304d\u307e\u3057\u305f\u306d\n\n```\n$ ll\n\u5408\u8a08 4\ndrwxrwxr-x 4 ec2-user ec2-user 4096  2\u6708 10 10:08 aws-waf\n\n$ cd aws-waf/\n$ ll\n\u5408\u8a08 20\n-rw-rw-r-- 1 ec2-user ec2-user 1081  2\u6708 10 10:08 LICENSE\n-rw-rw-r-- 1 ec2-user ec2-user 4762  2\u6708 10 10:08 README.md\ndrwxrwxr-x 5 ec2-user ec2-user 4096  2\u6708 10 10:08 dsawswaf\n-rw-rw-r-- 1 ec2-user ec2-user   33  2\u6708 10 10:08 requirements.txt\n```\n\n\u52d5\u4f5c\u53ef\u80fd\u306a\u30d0\u30fc\u30b8\u30e7\u30f3(a877db1)\u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002\n\u203b \u73fe\u5728\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n```\n$ git checkout a877db1adb53b790f470065ed71df96f6ead82fb\nNote: checking out 'a877db1adb53b790f470065ed71df96f6ead82fb'.\n\nYou are in 'detached HEAD' state. You can look around, make experimental\nchanges and commit them, and you can discard any commits you make in this\nstate without impacting any branches by performing another checkout.\n\nIf you want to create a new branch to retain commits you create, you may\ndo so (now or later) by using -b with the checkout command again. Example:\n\n  git checkout -b <new-branch-name>\n\nHEAD is now at a877db1... Fixed typo in boto3 version\n```\n\n\u78ba\u8a8d\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\n```\n$ ll\n\u5408\u8a08 20\n-rw-rw-r-- 1 ec2-user ec2-user 1081  2\u6708 10 10:08 LICENSE\n-rw-rw-r-- 1 ec2-user ec2-user 4586  2\u6708 10 10:12 README.md \u2605\ndrwxrwxr-x 5 ec2-user ec2-user 4096  2\u6708 10 10:12 dsawswaf \u2605\n-rw-rw-r-- 1 ec2-user ec2-user   33  2\u6708 10 10:08 requirements.txt\n```\n\n[readme.md](https://github.com/deep-security/aws-waf)\u306b\u3042\u308b\u901a\u308a\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo pip install -r requirements.txt\nYou are using pip version 6.1.1, however version 8.0.2 is available.\nYou should consider upgrading via the 'pip install --upgrade pip' command.\nCollecting netaddr>=0.7.18 (from -r requirements.txt (line 1))\n  Downloading netaddr-0.7.18-py2.py3-none-any.whl (1.5MB)\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 1.5MB 308kB/s\nCollecting boto3>=1.2.1 (from -r requirements.txt (line 2))\n  Downloading boto3-1.2.3-py2.py3-none-any.whl (108kB)\n    100% |\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588| 110kB 4.0MB/s\nRequirement already satisfied (use --upgrade to upgrade): jmespath<1.0.0,>=0.7.1 in /usr/lib/python2.7/dist-packages (from boto3>=1.2.1->-r requirements.txt (line 2))\nCollecting futures<4.0.0,>=2.2.0 (from boto3>=1.2.1->-r requirements.txt (line 2))\n  Downloading futures-3.0.4-py2-none-any.whl\nRequirement already satisfied (use --upgrade to upgrade): botocore<1.4.0,>=1.3.0 in /usr/lib/python2.7/dist-packages (from boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): python-dateutil<3.0.0,>=2.1 in /usr/lib/python2.7/dist-packages (from botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): docutils>=0.10 in /usr/lib/python2.7/dist-packages (from botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nRequirement already satisfied (use --upgrade to upgrade): six in /usr/lib/python2.7/dist-packages (from python-dateutil<3.0.0,>=2.1->botocore<1.4.0,>=1.3.0->boto3>=1.2.1->-r requirements.txt (line 2))\nInstalling collected packages: netaddr, futures, boto3\nSuccessfully installed boto3-1.2.3 futures-3.0.4 netaddr-0.7.18\n```\n\n\u52d5\u4f5c\u78ba\u8a8d\u3002\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n\n```\n$ python ip_list_to_set.py -h\nusage: ip_list_to_set.py [-h] [-d IP_LIST] [-l] [-m DSM] -u USERNAME -p\n                         PASSWORD [-t TENANT] [--dryrun] [--verbose]\n:\n\n```\n\n#2. DSaaS\u306e\u6e96\u5099\n\u3053\u306e\u30c4\u30fc\u30eb\u306f\u3001\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u305f\u6642\u70b9\u3067\u306f\u3001DSaaS\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u3044\u3066\u3001\u30b5\u30fc\u30d0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fDSM\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\nDSaaS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u7528\u610f\u3057\u3066\u3001API\u7528\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u8a2d\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u307e\u305a\u3001\u5f79\u5272\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n![\u5f79\u5272.png](https://qiita-image-store.s3.amazonaws.com/0/46611/3cd6ac6e-1ddc-3672-1660-cfc213ddd6ee.png \"\u5f79\u5272.png\")\n\n\u6b21\u306b\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u3001\u5f79\u5272\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n![\u30e6\u30fc\u30b5\u3099.png](https://qiita-image-store.s3.amazonaws.com/0/46611/bb0ec20a-53b0-06ea-0990-344113650b57.png \"\u30e6\u30fc\u30b5\u3099.png\")\n\nIP\u30ea\u30b9\u30c8\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u672c\u6765\u306f\u3001\u904b\u7528\u3067\u6210\u719f\u3057\u305fIP\u30ea\u30b9\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3053\u308d\u3067\u3059\u306d\u3002\n![IPlist.png](https://qiita-image-store.s3.amazonaws.com/0/46611/e508d7cd-979f-840b-ae1d-05a5a993a532.png \"IPlist.png\")\n\n#3. AWS WAF\u306e\u6e96\u5099\n\u7279\u306b\u3042\u308a\u307e\u305b\u3093\u304c\u3001conditions\u306e\u72b6\u6cc1\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n![AWSWAF_condition_before.png](https://qiita-image-store.s3.amazonaws.com/0/46611/7790d5eb-538e-d5c6-b08a-356cb582e3d2.png \"AWSWAF_condition_before.png\")\n\n\n#4. \u5b9f\u884c\u3068\u8a55\u4fa1\n##4-1. \u307e\u305a\u306f\u5b9f\u884c\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u884c\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u307e\u305a\u306f\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\u3067\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u306f\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30c6\u30ca\u30f3\u30c8\u540d\u306f\u3001DSaaS\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3057\u305fIP\u30ea\u30b9\u30c8 `myIP` \u306eID\u304c `21` \u3067\u3042\u308b\u3053\u3068\u304c\u5224\u308a\u307e\u3059\u306d\u3002\n\u540c\u6642\u306b AWS WAF \u306econditions\u3000(IP Sets)\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n```\n$ python ip_list_to_set.py -l -u webapi -p xxxxxxxx -t tenant_name\n\nAvailable Deep Security IP Lists\n================================\n1\tIgnore Reconnaissance\n2\tNetwork Broadcast\n3\tIngress Filters\n4\tDomain Controller(s)\n5\tOff Domain IPs\n6\tCorporate Network IPs\n7\tVPN Tunnel IPs\n21\tmyIP\n\nAvailable AWS WAF IP Sets\n=========================\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\ttest3\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\ttest2\nxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\ttest\n```\n\n\u3067\u306f\u3001IP\u30ea\u30b9\u30c8 `myIP` \u3092 AWS WAF \u306econditions\u3000(IP Sets)\u306b\u9023\u643a\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nIP\u30ea\u30b9\u30c8 `myIP` \u306eID `21` \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f `--dryrun` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3068\u3001 `Will request the creation of [myIP]` \u3068\u51fa\u307e\u3059\u306d\u3002\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nWill request the creation of [myIP]\n```\n\n`--dryrun` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5916\u3059\u3068\u5b9f\u969b\u306b\u9023\u643a\u3055\u308c\u307e\u3059\u3002\n`Created IP Set [myIP]` \u3068\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name\nConverted 1 IP List entries to 1 IP Set entries\nCreated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n```\n\nAWS WAF\u306econditions\u3092\u898b\u308b\u3068\u3001 `myIP` \u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n![AWSWAF_condition_after.png](https://qiita-image-store.s3.amazonaws.com/0/46611/04dfd963-9efa-2a5b-1cc3-9e2a03b2e37f.png \"AWSWAF_condition_after.png\")\n\n\u5185\u5bb9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n![AWSWAF_result.png](https://qiita-image-store.s3.amazonaws.com/0/46611/8f254e51-cc4d-9f06-9fda-c3725753d02c.png \"AWSWAF_result.png\")\n\n\n##4-2. \u8a55\u4fa1\n###\u8ffd\u52a01\nIPList\u306b\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u3066\u3082\u3046\u4e00\u5ea6\u9023\u643a\u3057\u307e\u3059\u3002\n![myIP_2.png](https://qiita-image-store.s3.amazonaws.com/0/46611/03569b05-e88b-c094-3825-4e7ab313614c.png \"myIP_2.png\")\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nConverted 2 IP List entries to 2 IP Set entries\nWill request the addition of 2 entries in IP Set xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\nWill update IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n```\n\u5b9f\u884c\u3059\u308b\u3068\u3001 `Converted 2 IP List entries to 2 IP Set entries` \u3068\u51fa\u307e\u3059\u306d\u3002\n1\u3064\u8ffd\u52a0\u306a\u306e\u3067\u3059\u304c\u30012\u3064\u306eIP List entries\u3068\u8a00\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name\nConverted 2 IP List entries to 2 IP Set entries\nUpdated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n```\n\n\u7d50\u679c\u306f\u3053\u3061\u3089\u3002\n\u8ffd\u52a0\u5206\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n![AWSWAF_add.png](https://qiita-image-store.s3.amazonaws.com/0/46611/0dde8f4a-8450-7482-5e28-c72021a7b71b.png \"AWSWAF_add.png\")\n\n###\u5909\u66f41\n\u5148\u307b\u3069\u8ffd\u52a0\u3057\u305f `115.xxx.xxx.xxx/32` \u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u6b21\u306f\u3061\u3087\u3063\u3068\u5909\u5316\u7403\u3067 Deep Security\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u304c\u3001AWS\u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u306a\u3044\u8868\u793a\u5f62\u5f0f\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\nDeep Security\u3067\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u8868\u793a\u5f62\u5f0f\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n![myIP_support.png](https://qiita-image-store.s3.amazonaws.com/0/46611/bc192f1b-ffee-4849-18da-16c0fc4054a1.png \"myIP_support.png\")\n\n\u307e\u305a\u306f\u3001 `115.xxx.xxx.xxx/32` \u3092 `115.xxx.xxx.0/255.255.255.0` \u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n![myIP_try1.png](https://qiita-image-store.s3.amazonaws.com/0/46611/bda7758b-b8da-ac57-59b9-426679444744.png \"myIP_try1.png\")\n\n\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u3002(\u8868\u793a\u304c\u540c\u3058\u3060\u3063\u305f\u306e\u3067)\n\u306a\u3093\u3068\u3001`115.xxx.xxx.xxx/32` \u306f\u5909\u66f4\u3055\u308c\u305a\u306b\u305d\u306e\u307e\u307e\u6b8b\u308a\u3001`115.xxx.xxx.0/24`\u3068\u3057\u3066\u8ffd\u52a0\u767b\u9332\u3055\u308c\u307e\u3057\u305f\u3002\n\u306a\u304b\u306a\u304b\u306b\u8ce2\u3044\u3067\u3059\u306d\u3002\n![AWSWAF_try1_result.png](https://qiita-image-store.s3.amazonaws.com/0/46611/8b7097d8-727e-f8e0-3e5f-2e98a7cb949a.png \"AWSWAF_try1_result.png\")\n\n###\u5909\u66f42\n\u6b21\u306f\u3001`115.xxx.xxx.0/255.255.255.0` \u3092 `123.xxx.xxx.0 - 123.xxx.xxx.255` \u306b\u3057\u307e\u3059\u3002\n\u671f\u5f85\u5024\u306f\u3001`123.xxx.xxx.0/24 \u304c\u8ffd\u52a0\u3055\u308c\u308b` \u3067\u3059\u3002\n![myIP_try3.png](https://qiita-image-store.s3.amazonaws.com/0/46611/87441db2-f7e0-9934-a41c-e7b2bd696bdf.png \"myIP_try3.png\")\n\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p nPxwcrV3 -t securitypack_dev@cloudpack.jp --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nConverted 2 IP List entries to 1 IP Set entries\nWill request the addition of 1 entries in IP Set xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\nWill update IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n```\n\u51fa\u529b\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u306d\u3002\n`Converted 2 IP List entries to 1 IP Set entries`\u3068\u51fa\u3066\u307e\u3059\u3002\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p nPxwcrV3 -t securitypack_dev@cloudpack.jp\nConverted 2 IP List entries to 1 IP Set entries\nUpdated IP Set [myIP] with ID [xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx]\n```\n`123.xxx.xxx.0/24` \u306f\u8ffd\u52a0\u3055\u308c\u307e\u305b\u3093\u306d\u3002\n\u30ec\u30f3\u30b8\u8868\u8a18\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n![AWSWAF_try3_result.png](https://qiita-image-store.s3.amazonaws.com/0/46611/75cfdbb9-424e-34a4-914b-701a007026aa.png \"AWSWAF_try3_result.png\")\n\n###\u8ffd\u52a02\uff082016/2/12\u8ffd\u88dc\uff09\n\u3072\u3087\u3063\u3068\u3057\u305f\u3089\u3001CIDER\u3084\u30de\u30b9\u30af\u304c\u306a\u3044\u8868\u8a18\u304c\u554f\u984c\u304b\u3082\u3057\u308c\u306a\u3044\u306e\u3067\u3001\u5207\u308a\u5206\u3051\u307e\u3059\u3002\n`123.xxx.xxx.0` \u3092\u8ffd\u52a0\u3057\u3066\u3001\u9023\u643a\u3057\u3066\u307f\u307e\u3059\u3002\n![myIP_try5.png](https://qiita-image-store.s3.amazonaws.com/0/46611/7d5237a2-72d1-3523-1e15-c0f9a438ac13.png \"myIP_try5.png\")\n\n\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f\u7701\u7565\u3057\u307e\u3059\u304c\u3001\u7d50\u679c\u306f`123.xxx.xxx.0/32`\u3068CIDER\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\u306a\u304b\u306a\u304b\u306b\uff08\u7565\n![AWSWAF_result5.png](https://qiita-image-store.s3.amazonaws.com/0/46611/a71e19c9-65dc-7b50-8405-b1315f9d0dd8.png \"AWSWAF_result5.png\")\n\n###\u8ffd\u52a03\uff082016/2/12\u8ffd\u88dc\uff09\n\u5b9f\u969b\u306b\u904b\u7528\u4e2d\u306eIP\u30ea\u30b9\u30c8\u306b\u306f\u3001\u30b3\u30e1\u30f3\u30c8\u304c\u591a\u6570\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u60f3\u5b9a\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001`123.42.99.1/32 #hogehoge`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n![myIP_try4.png](https://qiita-image-store.s3.amazonaws.com/0/46611/c9cc3217-9e71-43dc-dfd9-4c529e854fa8.png \"myIP_try4.png\")\n\n<del>\u304a\u3063\u3068\u3001\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u306d\u3002\n`#` \u304c\u4e0a\u624b\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u904b\u7528\u4e0a\u3001\u3061\u3087\u3063\u3068\u56f0\u308a\u307e\u3059\u306d\u3002</del>\uff082016/3/4\u4fee\u6b63\u6e08\u307f\uff09\n\n```\n$ python ip_list_to_set.py -d 21 -u webapi -p xxxxxxxx -t tenant_name --dryrun\n***********************************************************************\n* DRY RUN ENABLED. NO CHANGES WILL BE MADE\n***********************************************************************\nTraceback (most recent call last):\n  File \"ip_list_to_set.py\", line 385, in <module>\n    if __name__ == '__main__': main()\n  File \"ip_list_to_set.py\", line 381, in main\n    context.create_ip_set(ip_list)\n  File \"ip_list_to_set.py\", line 321, in create_ip_set\n    updates = self._convert_ds_addresses_to_waf(ds_list)\n  File \"ip_list_to_set.py\", line 274, in _convert_ds_addresses_to_waf\n    addresses = self._parse_ds_addresses(ds_list)\n  File \"ip_list_to_set.py\", line 239, in _parse_ds_addresses\n    if \"#\" in address: address = split('#').strip() # remove any comments\nNameError: global name 'split' is not defined\n```\n\n##\u307e\u3068\u3081\nDeep Security~AWS WAF\u9023\u643a\u30c4\u30fc\u30eb\u306e\u8a55\u4fa1\u3092\u307e\u3068\u3081\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n- \u30d0\u30fc\u30b8\u30e7\u30f3(a877db1)\u304c\u52d5\u4f5c\u53ef\u80fd\u306a\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\n- DSaaS\u306eIP\u30ea\u30b9\u30c8\u3092\u6307\u5b9a\u3057\u3066\u3001AWS WAF\u306econditions(IP Lists)\u306b\u8ffd\u52a0\u3059\u308b\u6a5f\u80fd\n- \u540c\u540d\u306econditions(IP Lists)\u304c\u306a\u3051\u308c\u3070\u4f5c\u6210\u3059\u308b\n- \u540c\u540d\u306econditions(IP Lists)\u304c\u3042\u308c\u3070\u3001\u5dee\u5206\u3092`\u8ffd\u52a0`\u3059\u308b\u3002(\u524a\u9664\u3057\u306a\u3044)\n- IP\u30ea\u30b9\u30c8\u3067\u30de\u30b9\u30af\u8868\u8a18\u3055\u308c\u308b\u3082\u306e\u306fCIDER\u5f62\u5f0f\u306b\u5909\u63db\u3055\u308c\u308b\u3002\n- IP\u30ea\u30b9\u30c8\u3067\u30ec\u30f3\u30b8\u8868\u8a18\u3055\u308c\u308b\u3082\u306e\u306f\u767b\u9332\u3055\u308c\u306a\u3044\u3002\n- <del>\u30b3\u30e1\u30f3\u30c8`#`\u304c\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u306e\u3067\u3001IP\u30ea\u30b9\u30c8\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3057\u305f\u3082\u306e\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff082016/2/12\u8ffd\u52a0\uff09</del> \uff082016/3/4\u4fee\u6b63\u6e08\u307f\uff09\n\n\u4e0a\u8a18\u7279\u6027\u3092\u7406\u89e3\u3057\u3066\u3001\u6d3b\u7528\u3057\u305f\u3044\u3067\u3059\u306d\u3002\n\u6d3b\u7528\u306e\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\u306b\u3064\u3044\u3066\u306f\u3001\u5225\u9014\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nGithub\u306b\u767b\u9332\u3055\u308c\u305f\u30c4\u30fc\u30eb\u306a\u306e\u3067\u3001\u554f\u3044\u5408\u308f\u305b\u3084\u30d0\u30b0\u306e\u6307\u6458\u306fGithub\u306b\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\u958b\u767a\u8005\u3068\u76f4\u63a5\u3084\u308a\u53d6\u308a\u3067\u304d\u308b\u306e\u304c\u9b45\u529b\u3067\u3059\u306d\u3002\n\n\u4eca\u65e5\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n", "tags": ["AWS", "DeepSecurity", "AWSWAF"]}