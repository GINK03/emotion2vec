{"tags": ["AWS", "aws-cli", "Kinesis", "Firehose"], "context": "\n\n\u3053\u306e\u8a18\u4e8b\u306b\u3064\u3044\u3066\nJAWS-UG CLI\u5c02\u9580\u652f\u90e8 #73 Kinesis Firehose\u5165\u9580\u3067\u5b9f\u65bd\u3059\u308b\u30cf\u30f3\u30ba\u30aa\u30f3\u7528\u306e\u624b\u9806\u66f8\u3067\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u5fc5\u8981\u306a\u6a29\u9650\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nKinesis Firehose\u306e\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nS3\u306e\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nSTS\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nIAM\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nCloudWatch\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nCloudWatch Logs\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\u30aa\u30ec\u30b4\u30f3\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\uff08\u6771\u4eac\u30de\u30c0\u30fc\uff1f\uff09\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION=\"us-west-2\"\n\n\n\n0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************QSAA         iam-role\nsecret_key     ****************c1xY         iam-role\n    region                us-west-2              env    AWS_DEFAULT_REGION\n\n\n\n0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\naws-cli/1.11.24 Python/2.7.12 Linux/4.4.30-32.54.amzn1.x86_64 botocore/1.4.81\n\n\n\n0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n\n\n\n1. VPC\u306e\u4f5c\u6210\nKinesis Agent\u3092\u5c0e\u5165\u3059\u308b\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4f75\u305b\u3066\u3001\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306eApache Web Server\u306e\u30ed\u30b0\u3068\u3057\u307e\u3059\u3002\n\nVPC\u306eCIDR\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCIDR_BLOCK='10.0.0.0/16'\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_CIDR_BLOCK: \"${CIDR_BLOCK}\"\n\nETX\n\n\n\n\u7d50\u679c\n\n   VPC_CIDR_BLOCK: \"10.0.0.0/16\"\n\n\n\n\nVPC\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-vpc \\\n    --cidr-block ${CIDR_BLOCK}\n\n\n\n\u7d50\u679c\n{\n    \"Vpc\": {\n        \"VpcId\": \"vpc-********\",\n        \"InstanceTenancy\": \"default\",\n        \"Tags\": [],\n        \"State\": \"pending\",\n        \"DhcpOptionsId\": \"dopt-********\",\n        \"CidrBlock\": \"10.0.0.0/16\",\n        \"IsDefault\": false\n    }\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nVPC_ID=$(aws ec2 describe-vpcs \\\n    --query \"Vpcs[?CidrBlock==\\`${CIDR_BLOCK}\\`].VpcId\" \\\n    --output text) \\\n    && echo ${VPC_ID}\n\n\n\n\u7d50\u679c\nvpc-********\n\n\n\n\u4f5c\u6210\u3057\u305fVPC\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpcs --vpc-ids ${VPC_ID}\n\n\n\n\u7d50\u679c\n{\n    \"Vpcs\": [\n        {\n            \"VpcId\": \"vpc-********\",\n            \"InstanceTenancy\": \"default\",\n            \"State\": \"available\",\n            \"DhcpOptionsId\": \"dopt-********\",\n            \"CidrBlock\": \"10.0.0.0/16\",\n            \"IsDefault\": false\n        }\n    ]\n}\n\n\n\n2. Internet Gateway\u306e\u4f5c\u6210\u3001\u30a2\u30bf\u30c3\u30c1\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nIGW_ID=$(aws ec2 create-internet-gateway \\\n    --query InternetGateway.InternetGatewayId \\\n    --output text) \\\n    && echo ${IGW_ID}\n\n\n\n\u7d50\u679c\nigw-********\n\n\n\n\u4f5c\u6210\u3057\u305fInternet Gateway\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-internet-gateways \\\n    --internet-gateway-ids ${IGW_ID}\n\n\n\n\u7d50\u679c\n{\n    \"InternetGateways\": [\n        {\n            \"Tags\": [],\n            \"InternetGatewayId\": \"igw-********\",\n            \"Attachments\": []\n        }\n    ]\n}\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_ID: \"${VPC_ID}\"\n   IGW_ID: \"${IGW_ID}\"\n\nETX\n\n\n\n\u7d50\u679c\n\n   VPC_ID: \"vpc-********\"\n   IGW_ID: \"igw-********\"\n\n\n\n\nVPC\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u30a2\u30bf\u30c3\u30c1\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 attach-internet-gateway \\\n    --internet-gateway-id ${IGW_ID} \\\n    --vpc-id ${VPC_ID}\n\n\n\n\u7d50\u679c\n(\u8fd4\u5024\u306a\u3057)\n\n\n\n\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u7d50\u679c\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-internet-gateways \\\n    --internet-gateway-ids ${IGW_ID}\n\n\n\n\u7d50\u679c\n{\n    \"InternetGateways\": [\n        {\n            \"Tags\": [],\n            \"InternetGatewayId\": \"igw-********\",\n            \"Attachments\": [\n                {\n                    \"State\": \"available\",\n                    \"VpcId\": \"vpc-********\"\n                }\n            ]\n        }\n    ]\n}\n\n\n\n3. Subnet\u306e\u4f5c\u6210\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCIDR_BLOCK_SUBNET_A='10.0.0.0/24'\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_ID: \"${VPC_ID}\"\n   Subnet_CIDR_BLOCK_on_${AWS_DEFAULT_REGION}a: \"${CIDR_BLOCK_SUBNET_A}\"\n\nETX\n\n\n\n\u7d50\u679c\n\n   VPC_ID: \"vpc-********\"\n   Subnet_CIDR_BLOCK_on_ap-northeast-1a: \"10.0.0.0/24\"\n\n\n\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-subnet --vpc-id ${VPC_ID} \\\n    --cidr-block ${CIDR_BLOCK_SUBNET_A} \\\n    --availability-zone ${AWS_DEFAULT_REGION}a\n\n\n\n\u7d50\u679c\n{\n    \"Subnet\": {\n        \"VpcId\": \"vpc-********\",\n        \"AvailableIpAddressCount\": 251,\n        \"MapPublicIpOnLaunch\": false,\n        \"DefaultForAz\": false,\n        \"Ipv6CidrBlockAssociationSet\": [],\n        \"State\": \"pending\",\n        \"AvailabilityZone\": \"us-west-2a\",\n        \"SubnetId\": \"subnet-********\",\n        \"CidrBlock\": \"10.0.0.0/24\",\n        \"AssignIpv6AddressOnCreation\": false\n    }\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nSUBNET_A_ID=$(aws ec2 describe-subnets \\\n    --query \"Subnets[?CidrBlock==\\`${CIDR_BLOCK_SUBNET_A}\\`].SubnetId\" \\\n    --output text) \\\n    && echo ${SUBNET_A_ID}\n\n\n\n\u7d50\u679c\nsubnet-********\n\n\n\n\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-subnets \\\n    --subnet-ids ${SUBNET_A_ID}\n\n\n\n\u7d50\u679c\n{\n    \"Subnets\": [\n        {\n            \"VpcId\": \"vpc-********\",\n            \"CidrBlock\": \"10.0.0.0/24\",\n            \"MapPublicIpOnLaunch\": false,\n            \"DefaultForAz\": false,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"SubnetId\": \"subnet-********\",\n            \"AvailableIpAddressCount\": 251\n        }\n    ]\n}\n\n\n\n4. Route Table\u306e\u7de8\u96c6\n\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3057\u305fVPC\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30ebID\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nROUTE_TABLE_ID=$(aws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\'].RouteTableId \\\n    --output text) \\\n    && echo ${ROUTE_TABLE_ID}\n\n\n\n\u7d50\u679c\nrtb-********\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\']\n\n\n\n\u7d50\u679c\n[\n    {\n        \"Associations\": [\n            {\n                \"RouteTableAssociationId\": \"rtbassoc-********\",\n                \"Main\": true,\n                \"RouteTableId\": \"rtb-********\"\n            }\n        ],\n        \"RouteTableId\": \"rtb-********\",\n        \"VpcId\": \"vpc-********\",\n        \"PropagatingVgws\": [],\n        \"Tags\": [],\n        \"Routes\": [\n            {\n                \"GatewayId\": \"local\",\n                \"DestinationCidrBlock\": \"10.0.0.0/16\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRouteTable\"\n            }\n        ]\n    }\n]\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   RouteTable_ID: \"${ROUTE_TABLE_ID}\"\n   InternetGateat_ID: \"${IGW_ID}\"\n\nETX\n\n\n\n\u7d50\u679c\n\n   RouteTable_ID: \"rtb-********\"\n   InternetGateat_ID: \"igw-********\"\n\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30c8\u3092\u8ffd\u52a0\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-route \\\n    --route-table-id ${ROUTE_TABLE_ID} \\\n    --destination-cidr-block '0.0.0.0/0' \\\n    --gateway-id ${IGW_ID}\n\n\n\n\u7d50\u679c\n{\n    \"Return\": true\n}\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u8ffd\u52a0\u3057\u305f\u30eb\u30fc\u30c8\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\']\n\n\n\n\u7d50\u679c\n[\n    {\n        \"Associations\": [\n            {\n                \"RouteTableAssociationId\": \"rtbassoc-********\",\n                \"Main\": true,\n                \"RouteTableId\": \"rtb-********\"\n            }\n        ],\n        \"RouteTableId\": \"rtb-********\",\n        \"VpcId\": \"vpc-********\",\n        \"PropagatingVgws\": [],\n        \"Tags\": [],\n        \"Routes\": [\n            {\n                \"GatewayId\": \"local\",\n                \"DestinationCidrBlock\": \"10.0.0.0/16\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRouteTable\"\n            },\n            {\n                \"GatewayId\": \"igw-********\",\n                \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRoute\"\n            }\n        ]\n    }\n]\n\n\n\n5. Sucurity Group\u306e\u4f5c\u6210\u3001\u8a2d\u5b9a\n\u4f5c\u696d\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3001Web Server\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3059\u308b\u305f\u3081\u300180\u756a\u30dd\u30fc\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\nSecurity Group\u306e\u540d\u524d\u3092\u8a2d\u5b9a\uff08Amazon Linux\u7528\uff09\n\n\u30b3\u30de\u30f3\u30c9\nSG_GROUP_NAME='SSH-HTTP'\nSG_DESCRIPTION='JAWS-UG CLI at Co-Edo'\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   SG_GROUP_NAME: ${SG_GROUP_NAME}\n   SG_DESCRIPTION: ${SG_DESCRIPTION}\n   VPC_ID: ${VPC_ID}\n\nETX\n\n\n\n\u7d50\u679c\n\n   SG_GROUP_NAME: SSH-HTTP\n   SG_DESCRIPTION: JAWS-UG CLI at Co-Edo\n   VPC_ID: vpc-********\n\n\n\n\n\u30e6\u30fc\u30b6\u4f5c\u6210\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u8a2d\u5b9a\u3059\u308bSecurity Group\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-security-group \\\n    --group-name ${SG_GROUP_NAME} \\\n    --description \"${SG_DESCRIPTION}\" \\\n    --vpc-id ${VPC_ID}\n\n\n\n\u7d50\u679c\n{\n    \"GroupId\": \"sg-********\"\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nSG_ID=$(aws ec2 describe-security-groups \\\n    --query SecurityGroups[?GroupName==\\'${SG_GROUP_NAME}\\'].GroupId \\\n    --output text) \\\n    && echo ${SG_ID}\n\n\n\n\u7d50\u679c\nsg-********\n\n\n\n\u4f5c\u6210\u3057\u305fSecurity Group\u3092\u78ba\u8a8d\n\uff08\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u306e\u901a\u4fe1\u306e\u307f\u5168\u3066\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306e\u307f\u3001\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n    --group-ids ${SG_ID}\n\n\n\n\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [],\n            \"GroupName\": \"SSH-HTTP\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n\n\n\n\u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\nssh\u304a\u3088\u3073HTTP\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u63a5\u7d9a\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5236\u9650\u3057\u305f\u3044\u5834\u5408\u306b\u306f\u3001\u78ba\u8a8d\u541b\u306a\u3069\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://www.ugtop.com/spill.shtml\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n    --group-id ${SG_ID} \\\n    --protocol 'tcp' \\\n    --port 22 \\\n    --cidr 0.0.0.0/0\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n    --group-id ${SG_ID} \\\n    --protocol 'tcp' \\\n    --port 80 \\\n    --cidr 0.0.0.0/0\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\n\u8ffd\u52a0\u3055\u308c\u305f\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n    --group-ids ${SG_ID}\n\n\n\n\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"PrefixListIds\": [],\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 80,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"ToPort\": 80,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                },\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 22,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"ToPort\": 22,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                }\n            ],\n            \"GroupName\": \"SSH-HTTP\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n\n\n\n6. Key Pair\u306e\u4f5c\u6210\n\nKeyPair\u306e\u540d\u524d\u304a\u3088\u3073\u79d8\u5bc6\u9375\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nKEY_PAIR_NAME='Firehose'\nKEY_MATERIAL_FILE='firehose.pem'\n\n\n\n\u540c\u540d\u306eKey Pair\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n    --key-names ${KEY_PAIR_NAME}\n\n\n\n\u7d50\u679c\nAn error occurred (InvalidKeyPair.NotFound) when calling the DescribeKeyPairs operation: The key pair 'Firehose' does not exist\n\n\n\n\u540c\u540d\u306e\u79d8\u5bc6\u9375\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nls -al ~/.ssh | grep ${KEY_MATERIAL_FILE}\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   KEY_PAIR_NAME: ${KEY_PAIR_NAME}\n   KEY_MATERIAL_FILE: ${KEY_MATERIAL_FILE}\n\nETX\n\n\n\n\u7d50\u679c\n\n   KEY_PAIR_NAME: Firehose\n   KEY_MATERIAL_FILE: firehose.pem\n\n\n\n\nKeyPair\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-key-pair \\\n    --key-name ${KEY_PAIR_NAME} \\\n    --query KeyMaterial \\\n    --output text \\\n    > ~/.ssh/${KEY_MATERIAL_FILE} \\\n    && chmod 600 ~/.ssh/${KEY_MATERIAL_FILE}\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\nKey Pair\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n    --key-names ${KEY_PAIR_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"KeyPairs\": [\n        {\n            \"KeyName\": \"Firehose\",\n            \"KeyFingerprint\": \"**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**\"\n        }\n    ]\n}\n\n\n\n\u79d8\u5bc6\u9375\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat ~/.ssh/${KEY_MATERIAL_FILE}\n\n\n\n\u7d50\u679c\n-----BEGIN RSA PRIVATE KEY-----\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n-----END RSA PRIVATE KEY-----\n\n\n\n\u6a29\u9650\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nls -al ~/.ssh/${KEY_MATERIAL_FILE}\n\n\n\n\u7d50\u679c\n-rw------- 1 ec2-user ec2-user 1675 Dec 19 07:08 /home/ec2-user/.ssh/firehose.pem\n\n\n\n7. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067Kinesis Firehose\u306b\u95a2\u3059\u308b\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306e\u6a29\u9650\u3092EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3067\u304d\u308b\u305f\u3081\u3001aws-cli\u3092\u5229\u7528\u3059\u308b\u969b\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u76f4\u63a5\u6271\u3046\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\nIAM Role\u540d\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nROLE_NAME='firehose-agent-role'\n\n\n\n\u540c\u540d\u306e\u30ed\u30fc\u30eb\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role --role-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\nAn error occurred (NoSuchEntity) when calling the GetRole operation: Unknown\n\n\n\n\u4fe1\u983c\u95a2\u4fc2\u306e\u5b9a\u7fa9\n\n\u30b3\u30de\u30f3\u30c9\nTRUST_POLICY_FILE='Trust-Policy.json'\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${TRUST_POLICY_FILE}\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u8a3c\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${TRUST_POLICY_FILE}\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\nIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws iam create-role \\\n    --role-name ${ROLE_NAME} \\\n    --assume-role-policy-document file://${TRUST_POLICY_FILE}\n\n\n\n\u7d50\u679c\n{\n    \"Role\": {\n        \"AssumeRolePolicyDocument\": {\n            \"Version\": \"2012-10-17\",\n            \"Statement\": [\n                {\n                    \"Action\": \"sts:AssumeRole\",\n                    \"Principal\": {\n                        \"Service\": \"ec2.amazonaws.com\"\n                    },\n                    \"Effect\": \"Allow\",\n                    \"Sid\": \"\"\n                }\n            ]\n        },\n        \"RoleId\": \"A********************\",\n        \"CreateDate\": \"2016-04-02T12:33:09.681Z\",\n        \"RoleName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:role/firehose-agent-role\"\n    }\n}\n\n\n\nIAM\u30ed\u30fc\u30eb\u306bManaged Policy\u3092\u30a2\u30bf\u30c3\u30c1\n\u30c7\u30ea\u30d0\u30ea\u30fc\u30b9\u30c8\u30ea\u30fc\u30e0\u3078\u306e\u30c7\u30fc\u30bf\u3092\u6295\u7a3f\u3059\u308b\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\uff08\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u624b\u9806\u3092\u7701\u7565\u3059\u308b\u305f\u3081\u3001\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\uff09\n\n\u30b3\u30de\u30f3\u30c9\nKFH_POLICY_ARN='arn:aws:iam::aws:policy/AmazonKinesisFirehoseFullAccess'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws iam attach-role-policy \\\n    --role-name ${ROLE_NAME} \\\n    --policy-arn ${KFH_POLICY_ARN}\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\nIAM Role\u306b\u30dd\u30ea\u30b7\u30fc\u304c\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam list-attached-role-policies --role-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"AmazonKinesisFirehoseFullAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonKinesisFirehoseFullAccess\"\n        }\n    ]\n}\n\n\n\n\u540c\u540d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile --instance-profile-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\nAn error occurred (NoSuchEntity) when calling the GetInstanceProfile operation: Instance Profile firehose-agent-role cannot be found.\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws iam create-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [],\n        \"CreateDate\": \"2016-04-02T12:35:07.689Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [],\n        \"CreateDate\": \"2016-04-02T12:35:07Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306bIAM Role\u3092\u8ffd\u52a0\n\n\u30b3\u30de\u30f3\u30c9\naws iam add-role-to-instance-profile \\\n    --instance-profile-name ${ROLE_NAME} \\\n    --role-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306bIAM Role\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [\n            {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Action\": \"sts:AssumeRole\",\n                            \"Principal\": {\n                                \"Service\": \"ec2.amazonaws.com\"\n                            },\n                            \"Effect\": \"Allow\",\n                            \"Sid\": \"\"\n                        }\n                    ]\n                },\n                \"RoleId\": \"A********************\",\n                \"CreateDate\": \"2016-04-02T12:33:09Z\",\n                \"RoleName\": \"firehose-agent-role\",\n                \"Path\": \"/\",\n                \"Arn\": \"arn:aws:iam::************:role/firehose-agent-role\"\n            }\n        ],\n        \"CreateDate\": \"2016-04-02T12:35:07Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n\n\n\n8. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\nAmazon Linux\u306e\u6700\u65b0AMI\u306eImage ID\u3092\u78ba\u8a8d\nAmazon Linux\u306eAMI\u306e\u3046\u3061\u3001\u6700\u65b0\u306eAMI\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\uff082016\u5e7412\u67083\u65e5\u73fe\u5728\uff09\n\n\u30b3\u30de\u30f3\u30c9\nAMI_ID=ami-5ec1673e\n\n\n\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eID\u3092\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nAWS_ID=$(aws sts get-caller-identity \\\n    --query Account \\\n    --output text) \\\n    && echo ${AWS_ID}\n\n\n\n\u7d50\u679c\n************\n\n\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nPRIVATE_IP_ADDRESS=\"10.0.0.10\"\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   AWS_ID: ${AWS_ID}\n   AMI_ID: \"${AMI_ID}\"\n   KEY_PAIR_NAME: ${KEY_PAIR_NAME}\n   SecurityGroup_ID: \"${SG_ID}\"\n   Subnet_ID: \"${SUBNET_A_ID}\"\n   PRIVATE_IP_ADDRESS: ${PRIVATE_IP_ADDRESS}\n   Instance Profile ARN: arn:aws:iam::${AWS_ID}:instance-profile/${ROLE_NAME}\n\nETX\n\n\n\n\u7d50\u679c\n\n   AWS_ID: ************\n   AMI_ID: \"ami-5ec1673e\"\n   KEY_PAIR_NAME: Firehose\n   SecurityGroup_ID: \"sg-********\"\n   Subnet_ID: \"subnet-********\"\n   PRIVATE_IP_ADDRESS: 10.0.0.10\n   Instance Profile ARN: arn:aws:iam::************:instance-profile/firehose-agent-role\n\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 run-instances \\\n    --image-id ${AMI_ID} \\\n    --key-name ${KEY_PAIR_NAME} \\\n    --security-group-ids ${SG_ID} \\\n    --instance-type 't2.micro' \\\n    --subnet-id ${SUBNET_A_ID} \\\n    --associate-public-ip-address \\\n    --private-ip-address ${PRIVATE_IP_ADDRESS} \\\n    --iam-instance-profile Arn=arn:aws:iam::${AWS_ID}:instance-profile/${ROLE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"OwnerId\": \"************\",\n    \"ReservationId\": \"r-0b28c************\",\n    \"Groups\": [],\n    \"Instances\": [\n        {\n            \"Monitoring\": {\n                \"State\": \"disabled\"\n            },\n            \"PublicDnsName\": \"\",\n            \"RootDeviceType\": \"ebs\",\n            \"State\": {\n                \"Code\": 0,\n                \"Name\": \"pending\"\n            },\n            \"EbsOptimized\": false,\n            \"LaunchTime\": \"2016-12-19T07:20:08.000Z\",\n            \"PrivateIpAddress\": \"10.0.0.10\",\n            \"ProductCodes\": [],\n            \"VpcId\": \"vpc-********\",\n            \"StateTransitionReason\": \"\",\n            \"InstanceId\": \"i-0****************\",\n            \"ImageId\": \"ami-5ec1673e\",\n            \"PrivateDnsName\": \"ip-10-0-0-10.us-west-2.compute.internal\",\n            \"KeyName\": \"Firehose\",\n            \"SecurityGroups\": [\n                {\n                    \"GroupName\": \"SSH-HTTP\",\n                    \"GroupId\": \"sg-********\"\n                }\n            ],\n            \"ClientToken\": \"\",\n            \"SubnetId\": \"subnet-********\",\n            \"InstanceType\": \"t2.micro\",\n            \"NetworkInterfaces\": [\n                {\n                    \"Status\": \"in-use\",\n                    \"MacAddress\": \"02:5d:2f:3b:65:9f\",\n                    \"SourceDestCheck\": true,\n                    \"VpcId\": \"vpc-********\",\n                    \"Description\": \"\",\n                    \"NetworkInterfaceId\": \"eni-********\",\n                    \"PrivateIpAddresses\": [\n                        {\n                            \"Primary\": true,\n                            \"PrivateIpAddress\": \"10.0.0.10\"\n                        }\n                    ],\n                    \"Ipv6Addresses\": [],\n                    \"Attachment\": {\n                        \"Status\": \"attaching\",\n                        \"DeviceIndex\": 0,\n                        \"DeleteOnTermination\": true,\n                        \"AttachmentId\": \"eni-attach-********\",\n                        \"AttachTime\": \"2016-12-19T07:20:08.000Z\"\n                    },\n                    \"Groups\": [\n                        {\n                            \"GroupName\": \"SSH-HTTP\",\n                            \"GroupId\": \"sg-********\"\n                        }\n                    ],\n                    \"SubnetId\": \"subnet-********\",\n                    \"OwnerId\": \"************\",\n                    \"PrivateIpAddress\": \"10.0.0.10\"\n                }\n            ],\n            \"SourceDestCheck\": true,\n            \"Placement\": {\n                \"Tenancy\": \"default\",\n                \"GroupName\": \"\",\n                \"AvailabilityZone\": \"us-west-2a\"\n            },\n            \"Hypervisor\": \"xen\",\n            \"BlockDeviceMappings\": [],\n            \"Architecture\": \"x86_64\",\n            \"StateReason\": {\n                \"Message\": \"pending\",\n                \"Code\": \"pending\"\n            },\n            \"IamInstanceProfile\": {\n                \"Id\": \"A********************\",\n                \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n            },\n            \"RootDeviceName\": \"/dev/xvda\",\n            \"VirtualizationType\": \"hvm\",\n            \"AmiLaunchIndex\": 0\n        }\n    ]\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nINSTANCE_ID=$(aws ec2 describe-instances \\\n    --query \"Reservations[].Instances[?PrivateIpAddress==\\`${PRIVATE_IP_ADDRESS}\\`].InstanceId\" \\\n    --output text) \\\n    && echo ${INSTANCE_ID}\n\n\n\n\u7d50\u679c\ni-********\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-instances \\\n    --instance-ids ${INSTANCE_ID}\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"Reservations\": [\n        {\n            \"OwnerId\": \"************\",\n            \"ReservationId\": \"r-0****************\",\n            \"Groups\": [],\n            \"Instances\": [\n                {\n                    \"Monitoring\": {\n                        \"State\": \"disabled\"\n                    },\n                    \"PublicDnsName\": \"\",\n                    \"State\": {\n                        \"Code\": 16,\n                        \"Name\": \"running\"\n                    },\n                    \"EbsOptimized\": false,\n                    \"LaunchTime\": \"2016-04-02T13:07:20.000Z\",\n                    \"PublicIpAddress\": \"**.**.**.**\",\n                    \"PrivateIpAddress\": \"10.0.0.10\",\n                    \"ProductCodes\": [],\n                    \"VpcId\": \"vpc-********\",\n                    \"StateTransitionReason\": \"\",\n                    \"InstanceId\": \"i-0****************\",\n                    \"ImageId\": \"ami-f80e0596\",\n                    \"PrivateDnsName\": \"ip-10-0-0-10.ap-northeast-1.compute.internal\",\n                    \"KeyName\": \"Redshift\",\n                    \"SecurityGroups\": [\n                        {\n                            \"GroupName\": \"SSH\",\n                            \"GroupId\": \"sg-********\"\n                        }\n                    ],\n                    \"ClientToken\": \"\",\n                    \"SubnetId\": \"subnet-********\",\n                    \"InstanceType\": \"t2.micro\",\n                    \"NetworkInterfaces\": [\n                        {\n                            \"Status\": \"in-use\",\n                            \"MacAddress\": \"**:**:**:**:**:**\",\n                            \"SourceDestCheck\": true,\n                            \"VpcId\": \"vpc-********\",\n                            \"Description\": \"\",\n                            \"Association\": {\n                                \"PublicIp\": \"**.**.**.**\",\n                                \"PublicDnsName\": \"\",\n                                \"IpOwnerId\": \"amazon\"\n                            },\n                            \"NetworkInterfaceId\": \"eni-********\",\n                            \"PrivateIpAddresses\": [\n                                {\n                                    \"Association\": {\n                                        \"PublicIp\": \"**.**.**.**\",\n                                        \"PublicDnsName\": \"\",\n                                        \"IpOwnerId\": \"amazon\"\n                                    },\n                                    \"Primary\": true,\n                                    \"PrivateIpAddress\": \"10.0.0.10\"\n                                }\n                            ],\n                            \"Attachment\": {\n                                \"Status\": \"attached\",\n                                \"DeviceIndex\": 0,\n                                \"DeleteOnTermination\": true,\n                                \"AttachmentId\": \"eni-attach-********\",\n                                \"AttachTime\": \"2016-04-02T13:07:20.000Z\"\n                            },\n                            \"Groups\": [\n                                {\n                                    \"GroupName\": \"SSH\",\n                                    \"GroupId\": \"sg-********\"\n                                }\n                            ],\n                            \"SubnetId\": \"subnet-********\",\n                            \"OwnerId\": \"************\",\n                            \"PrivateIpAddress\": \"10.0.0.10\"\n                        }\n                    ],\n                    \"SourceDestCheck\": true,\n                    \"Placement\": {\n                        \"Tenancy\": \"default\",\n                        \"GroupName\": \"\",\n                        \"AvailabilityZone\": \"ap-northeast-1a\"\n                    },\n                    \"Hypervisor\": \"xen\",\n                    \"BlockDeviceMappings\": [\n                        {\n                            \"DeviceName\": \"/dev/xvda\",\n                            \"Ebs\": {\n                                \"Status\": \"attached\",\n                                \"DeleteOnTermination\": true,\n                                \"VolumeId\": \"vol-********\",\n                                \"AttachTime\": \"2016-04-02T13:07:20.000Z\"\n                            }\n                        }\n                    ],\n                    \"Architecture\": \"x86_64\",\n                    \"RootDeviceType\": \"ebs\",\n                    \"IamInstanceProfile\": {\n                        \"Id\": \"A********************\",\n                        \"Arn\": \"arn:aws:iam::************:instance-profile/redshift-role\"\n                    },\n                    \"RootDeviceName\": \"/dev/xvda\",\n                    \"VirtualizationType\": \"hvm\",\n                    \"AmiLaunchIndex\": 0\n                }\n            ]\n        }\n    ]\n}\n\n\n\n\u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nPUBLIC_IP_ADDRESS=$(aws ec2 describe-instances \\\n    --instance-ids ${INSTANCE_ID} \\\n    --query Reservations[0].Instances[0].PublicIpAddress \\\n    --output text) \\\n    && echo ${PUBLIC_IP_ADDRESS}\n\n\n\n\u7d50\u679c\n**.**.**.**\n\n\n\u4ee5\u4e0a\n# \u3053\u306e\u8a18\u4e8b\u306b\u3064\u3044\u3066\n\n[JAWS-UG CLI\u5c02\u9580\u652f\u90e8 #73 Kinesis Firehose\u5165\u9580](https://jawsug-cli.doorkeeper.jp/events/41915)\u3067\u5b9f\u65bd\u3059\u308b\u30cf\u30f3\u30ba\u30aa\u30f3\u7528\u306e\u624b\u9806\u66f8\u3067\u3059\u3002\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n## \u5fc5\u8981\u306a\u6a29\u9650\n\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- Kinesis Firehose\u306e\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- S3\u306e\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- STS\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- IAM\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- CloudWatch\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- CloudWatch Logs\u306e\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n# 0. \u6e96\u5099\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30aa\u30ec\u30b4\u30f3\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\uff08\u6771\u4eac\u30de\u30c0\u30fc\uff1f\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION=\"us-west-2\"\n```\n\n## 0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************QSAA         iam-role\nsecret_key     ****************c1xY         iam-role\n    region                us-west-2              env    AWS_DEFAULT_REGION\n```\n\n## 0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```text:\u7d50\u679c\naws-cli/1.11.24 Python/2.7.12 Linux/4.4.30-32.54.amzn1.x86_64 botocore/1.4.81\n```\n\n## 0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n```\n\n# 1. VPC\u306e\u4f5c\u6210\n\nKinesis Agent\u3092\u5c0e\u5165\u3059\u308b\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4f75\u305b\u3066\u3001\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306eApache Web Server\u306e\u30ed\u30b0\u3068\u3057\u307e\u3059\u3002\n\n## VPC\u306eCIDR\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nCIDR_BLOCK='10.0.0.0/16'\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_CIDR_BLOCK: \"${CIDR_BLOCK}\"\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   VPC_CIDR_BLOCK: \"10.0.0.0/16\"\n\n```\n\n## VPC\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 create-vpc \\\n    --cidr-block ${CIDR_BLOCK}\n```\n\n```text:\u7d50\u679c\n{\n    \"Vpc\": {\n        \"VpcId\": \"vpc-********\",\n        \"InstanceTenancy\": \"default\",\n        \"Tags\": [],\n        \"State\": \"pending\",\n        \"DhcpOptionsId\": \"dopt-********\",\n        \"CidrBlock\": \"10.0.0.0/16\",\n        \"IsDefault\": false\n    }\n}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nVPC_ID=$(aws ec2 describe-vpcs \\\n    --query \"Vpcs[?CidrBlock==\\`${CIDR_BLOCK}\\`].VpcId\" \\\n    --output text) \\\n    && echo ${VPC_ID}\n```\n\n```text:\u7d50\u679c\nvpc-********\n```\n\n## \u4f5c\u6210\u3057\u305fVPC\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpcs --vpc-ids ${VPC_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"Vpcs\": [\n        {\n            \"VpcId\": \"vpc-********\",\n            \"InstanceTenancy\": \"default\",\n            \"State\": \"available\",\n            \"DhcpOptionsId\": \"dopt-********\",\n            \"CidrBlock\": \"10.0.0.0/16\",\n            \"IsDefault\": false\n        }\n    ]\n}\n```\n\n# 2. Internet Gateway\u306e\u4f5c\u6210\u3001\u30a2\u30bf\u30c3\u30c1\n\n## \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\nIGW_ID=$(aws ec2 create-internet-gateway \\\n    --query InternetGateway.InternetGatewayId \\\n    --output text) \\\n    && echo ${IGW_ID}\n```\n\n```text:\u7d50\u679c\nigw-********\n```\n\n## \u4f5c\u6210\u3057\u305fInternet Gateway\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-internet-gateways \\\n    --internet-gateway-ids ${IGW_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"InternetGateways\": [\n        {\n            \"Tags\": [],\n            \"InternetGatewayId\": \"igw-********\",\n            \"Attachments\": []\n        }\n    ]\n}\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_ID: \"${VPC_ID}\"\n   IGW_ID: \"${IGW_ID}\"\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   VPC_ID: \"vpc-********\"\n   IGW_ID: \"igw-********\"\n\n```\n\n## VPC\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u30a2\u30bf\u30c3\u30c1\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 attach-internet-gateway \\\n    --internet-gateway-id ${IGW_ID} \\\n    --vpc-id ${VPC_ID}\n```\n\n```text:\u7d50\u679c\n(\u8fd4\u5024\u306a\u3057)\n```\n\n## \u30a2\u30bf\u30c3\u30c1\u3057\u305f\u7d50\u679c\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-internet-gateways \\\n    --internet-gateway-ids ${IGW_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"InternetGateways\": [\n        {\n            \"Tags\": [],\n            \"InternetGatewayId\": \"igw-********\",\n            \"Attachments\": [\n                {\n                    \"State\": \"available\",\n                    \"VpcId\": \"vpc-********\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n# 3. Subnet\u306e\u4f5c\u6210\n\n## \u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nCIDR_BLOCK_SUBNET_A='10.0.0.0/24'\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   VPC_ID: \"${VPC_ID}\"\n   Subnet_CIDR_BLOCK_on_${AWS_DEFAULT_REGION}a: \"${CIDR_BLOCK_SUBNET_A}\"\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   VPC_ID: \"vpc-********\"\n   Subnet_CIDR_BLOCK_on_ap-northeast-1a: \"10.0.0.0/24\"\n\n```\n\n## \u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 create-subnet --vpc-id ${VPC_ID} \\\n    --cidr-block ${CIDR_BLOCK_SUBNET_A} \\\n    --availability-zone ${AWS_DEFAULT_REGION}a\n```\n\n```json:\u7d50\u679c\n{\n    \"Subnet\": {\n        \"VpcId\": \"vpc-********\",\n        \"AvailableIpAddressCount\": 251,\n        \"MapPublicIpOnLaunch\": false,\n        \"DefaultForAz\": false,\n        \"Ipv6CidrBlockAssociationSet\": [],\n        \"State\": \"pending\",\n        \"AvailabilityZone\": \"us-west-2a\",\n        \"SubnetId\": \"subnet-********\",\n        \"CidrBlock\": \"10.0.0.0/24\",\n        \"AssignIpv6AddressOnCreation\": false\n    }\n}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSUBNET_A_ID=$(aws ec2 describe-subnets \\\n    --query \"Subnets[?CidrBlock==\\`${CIDR_BLOCK_SUBNET_A}\\`].SubnetId\" \\\n    --output text) \\\n    && echo ${SUBNET_A_ID}\n```\n\n```text:\u7d50\u679c\nsubnet-********\n```\n\n## \u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-subnets \\\n    --subnet-ids ${SUBNET_A_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"Subnets\": [\n        {\n            \"VpcId\": \"vpc-********\",\n            \"CidrBlock\": \"10.0.0.0/24\",\n            \"MapPublicIpOnLaunch\": false,\n            \"DefaultForAz\": false,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"SubnetId\": \"subnet-********\",\n            \"AvailableIpAddressCount\": 251\n        }\n    ]\n}\n```\n\n# 4. Route Table\u306e\u7de8\u96c6\n\n\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n## \u4f5c\u6210\u3057\u305fVPC\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30ebID\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\nROUTE_TABLE_ID=$(aws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\'].RouteTableId \\\n    --output text) \\\n    && echo ${ROUTE_TABLE_ID}\n```\n\n```text:\u7d50\u679c\nrtb-********\n```\n\n## \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\']\n```\n\n```json:\u7d50\u679c\n[\n    {\n        \"Associations\": [\n            {\n                \"RouteTableAssociationId\": \"rtbassoc-********\",\n                \"Main\": true,\n                \"RouteTableId\": \"rtb-********\"\n            }\n        ],\n        \"RouteTableId\": \"rtb-********\",\n        \"VpcId\": \"vpc-********\",\n        \"PropagatingVgws\": [],\n        \"Tags\": [],\n        \"Routes\": [\n            {\n                \"GatewayId\": \"local\",\n                \"DestinationCidrBlock\": \"10.0.0.0/16\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRouteTable\"\n            }\n        ]\n    }\n]\n```\n\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   RouteTable_ID: \"${ROUTE_TABLE_ID}\"\n   InternetGateat_ID: \"${IGW_ID}\"\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   RouteTable_ID: \"rtb-********\"\n   InternetGateat_ID: \"igw-********\"\n\n```\n\n## \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30c8\u3092\u8ffd\u52a0\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 create-route \\\n    --route-table-id ${ROUTE_TABLE_ID} \\\n    --destination-cidr-block '0.0.0.0/0' \\\n    --gateway-id ${IGW_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"Return\": true\n}\n```\n\n## \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u8ffd\u52a0\u3057\u305f\u30eb\u30fc\u30c8\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables \\\n    --query RouteTables[?VpcId==\\'${VPC_ID}\\']\n```\n\n```json:\u7d50\u679c\n[\n    {\n        \"Associations\": [\n            {\n                \"RouteTableAssociationId\": \"rtbassoc-********\",\n                \"Main\": true,\n                \"RouteTableId\": \"rtb-********\"\n            }\n        ],\n        \"RouteTableId\": \"rtb-********\",\n        \"VpcId\": \"vpc-********\",\n        \"PropagatingVgws\": [],\n        \"Tags\": [],\n        \"Routes\": [\n            {\n                \"GatewayId\": \"local\",\n                \"DestinationCidrBlock\": \"10.0.0.0/16\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRouteTable\"\n            },\n            {\n                \"GatewayId\": \"igw-********\",\n                \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                \"State\": \"active\",\n                \"Origin\": \"CreateRoute\"\n            }\n        ]\n    }\n]\n```\n\n# 5. Sucurity Group\u306e\u4f5c\u6210\u3001\u8a2d\u5b9a\n\n\u4f5c\u696d\u7528EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306eSecurity Group\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4eca\u56de\u3001Web Server\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3068\u3059\u308b\u305f\u3081\u300180\u756a\u30dd\u30fc\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n## Security Group\u306e\u540d\u524d\u3092\u8a2d\u5b9a\uff08Amazon Linux\u7528\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSG_GROUP_NAME='SSH-HTTP'\nSG_DESCRIPTION='JAWS-UG CLI at Co-Edo'\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   SG_GROUP_NAME: ${SG_GROUP_NAME}\n   SG_DESCRIPTION: ${SG_DESCRIPTION}\n   VPC_ID: ${VPC_ID}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   SG_GROUP_NAME: SSH-HTTP\n   SG_DESCRIPTION: JAWS-UG CLI at Co-Edo\n   VPC_ID: vpc-********\n\n```\n\n## \u30e6\u30fc\u30b6\u4f5c\u6210\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u8a2d\u5b9a\u3059\u308bSecurity Group\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 create-security-group \\\n    --group-name ${SG_GROUP_NAME} \\\n    --description \"${SG_DESCRIPTION}\" \\\n    --vpc-id ${VPC_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"GroupId\": \"sg-********\"\n}\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSG_ID=$(aws ec2 describe-security-groups \\\n    --query SecurityGroups[?GroupName==\\'${SG_GROUP_NAME}\\'].GroupId \\\n    --output text) \\\n    && echo ${SG_ID}\n```\n\n```text:\u7d50\u679c\nsg-********\n```\n\n\n## \u4f5c\u6210\u3057\u305fSecurity Group\u3092\u78ba\u8a8d\n\n\uff08\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u306e\u901a\u4fe1\u306e\u307f\u5168\u3066\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306e\u307f\u3001\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n    --group-ids ${SG_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"PrefixListIds\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [],\n            \"GroupName\": \"SSH-HTTP\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n```\n\n## \u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u306e\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\n\nssh\u304a\u3088\u3073HTTP\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n\u63a5\u7d9a\u5143\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5236\u9650\u3057\u305f\u3044\u5834\u5408\u306b\u306f\u3001\u78ba\u8a8d\u541b\u306a\u3069\u3067IP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://www.ugtop.com/spill.shtml\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n    --group-id ${SG_ID} \\\n    --protocol 'tcp' \\\n    --port 22 \\\n    --cidr 0.0.0.0/0\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n    --group-id ${SG_ID} \\\n    --protocol 'tcp' \\\n    --port 80 \\\n    --cidr 0.0.0.0/0\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n\n## \u8ffd\u52a0\u3055\u308c\u305f\u30eb\u30fc\u30eb\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n    --group-ids ${SG_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"SecurityGroups\": [\n        {\n            \"IpPermissionsEgress\": [\n                {\n                    \"IpProtocol\": \"-1\",\n                    \"PrefixListIds\": [],\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                }\n            ],\n            \"Description\": \"JAWS-UG CLI at Co-Edo\",\n            \"IpPermissions\": [\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 80,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"ToPort\": 80,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                },\n                {\n                    \"PrefixListIds\": [],\n                    \"FromPort\": 22,\n                    \"IpRanges\": [\n                        {\n                            \"CidrIp\": \"0.0.0.0/0\"\n                        }\n                    ],\n                    \"ToPort\": 22,\n                    \"IpProtocol\": \"tcp\",\n                    \"UserIdGroupPairs\": [],\n                    \"Ipv6Ranges\": []\n                }\n            ],\n            \"GroupName\": \"SSH-HTTP\",\n            \"VpcId\": \"vpc-********\",\n            \"OwnerId\": \"************\",\n            \"GroupId\": \"sg-********\"\n        }\n    ]\n}\n```\n\n\n# 6. Key Pair\u306e\u4f5c\u6210\n\n## KeyPair\u306e\u540d\u524d\u304a\u3088\u3073\u79d8\u5bc6\u9375\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8a2d\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nKEY_PAIR_NAME='Firehose'\nKEY_MATERIAL_FILE='firehose.pem'\n```\n\n## \u540c\u540d\u306eKey Pair\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n    --key-names ${KEY_PAIR_NAME}\n```\n\n```text:\u7d50\u679c\nAn error occurred (InvalidKeyPair.NotFound) when calling the DescribeKeyPairs operation: The key pair 'Firehose' does not exist\n```\n\n## \u540c\u540d\u306e\u79d8\u5bc6\u9375\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\nls -al ~/.ssh | grep ${KEY_MATERIAL_FILE}\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   KEY_PAIR_NAME: ${KEY_PAIR_NAME}\n   KEY_MATERIAL_FILE: ${KEY_MATERIAL_FILE}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   KEY_PAIR_NAME: Firehose\n   KEY_MATERIAL_FILE: firehose.pem\n\n```\n\n\n## KeyPair\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 create-key-pair \\\n    --key-name ${KEY_PAIR_NAME} \\\n    --query KeyMaterial \\\n    --output text \\\n    > ~/.ssh/${KEY_MATERIAL_FILE} \\\n    && chmod 600 ~/.ssh/${KEY_MATERIAL_FILE}\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## Key Pair\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n    --key-names ${KEY_PAIR_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyPairs\": [\n        {\n            \"KeyName\": \"Firehose\",\n            \"KeyFingerprint\": \"**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**:**\"\n        }\n    ]\n}\n```\n\n\n## \u79d8\u5bc6\u9375\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat ~/.ssh/${KEY_MATERIAL_FILE}\n```\n\n```text:\u7d50\u679c\n-----BEGIN RSA PRIVATE KEY-----\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n****************************************************************************\n-----END RSA PRIVATE KEY-----\n```\n\n## \u6a29\u9650\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\nls -al ~/.ssh/${KEY_MATERIAL_FILE}\n```\n\n```text:\u7d50\u679c\n-rw------- 1 ec2-user ec2-user 1675 Dec 19 07:08 /home/ec2-user/.ssh/firehose.pem\n```\n\n\n# 7. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067Kinesis Firehose\u306b\u95a2\u3059\u308b\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306e\u6a29\u9650\u3092EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u306b\u3088\u308a\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3084\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3067\u304d\u308b\u305f\u3081\u3001aws-cli\u3092\u5229\u7528\u3059\u308b\u969b\u306b\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u76f4\u63a5\u6271\u3046\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\n## IAM Role\u540d\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nROLE_NAME='firehose-agent-role'\n```\n\n## \u540c\u540d\u306e\u30ed\u30fc\u30eb\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam get-role --role-name ${ROLE_NAME}\n```\n\n```text:\u7d50\u679c\nAn error occurred (NoSuchEntity) when calling the GetRole operation: Unknown\n```\n\n## \u4fe1\u983c\u95a2\u4fc2\u306e\u5b9a\u7fa9\n\n```bash:\u30b3\u30de\u30f3\u30c9\nTRUST_POLICY_FILE='Trust-Policy.json'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${TRUST_POLICY_FILE}\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"ec2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n\n## JSON\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u8a3c\n\n```bash:\u30b3\u30de\u30f3\u30c9\njsonlint -q ${TRUST_POLICY_FILE}\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam create-role \\\n    --role-name ${ROLE_NAME} \\\n    --assume-role-policy-document file://${TRUST_POLICY_FILE}\n```\n\n```json:\u7d50\u679c\n{\n    \"Role\": {\n        \"AssumeRolePolicyDocument\": {\n            \"Version\": \"2012-10-17\",\n            \"Statement\": [\n                {\n                    \"Action\": \"sts:AssumeRole\",\n                    \"Principal\": {\n                        \"Service\": \"ec2.amazonaws.com\"\n                    },\n                    \"Effect\": \"Allow\",\n                    \"Sid\": \"\"\n                }\n            ]\n        },\n        \"RoleId\": \"A********************\",\n        \"CreateDate\": \"2016-04-02T12:33:09.681Z\",\n        \"RoleName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:role/firehose-agent-role\"\n    }\n}\n```\n\n## IAM\u30ed\u30fc\u30eb\u306bManaged Policy\u3092\u30a2\u30bf\u30c3\u30c1\n\n\u30c7\u30ea\u30d0\u30ea\u30fc\u30b9\u30c8\u30ea\u30fc\u30e0\u3078\u306e\u30c7\u30fc\u30bf\u3092\u6295\u7a3f\u3059\u308b\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\uff08\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u624b\u9806\u3092\u7701\u7565\u3059\u308b\u305f\u3081\u3001\u65e2\u5b58\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nKFH_POLICY_ARN='arn:aws:iam::aws:policy/AmazonKinesisFirehoseFullAccess'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam attach-role-policy \\\n    --role-name ${ROLE_NAME} \\\n    --policy-arn ${KFH_POLICY_ARN}\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## IAM Role\u306b\u30dd\u30ea\u30b7\u30fc\u304c\u30a2\u30bf\u30c3\u30c1\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam list-attached-role-policies --role-name ${ROLE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"AmazonKinesisFirehoseFullAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonKinesisFirehoseFullAccess\"\n        }\n    ]\n}\n```\n\n## \u540c\u540d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile --instance-profile-name ${ROLE_NAME}\n```\n\n```text:\u7d50\u679c\nAn error occurred (NoSuchEntity) when calling the GetInstanceProfile operation: Instance Profile firehose-agent-role cannot be found.\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam create-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [],\n        \"CreateDate\": \"2016-04-02T12:35:07.689Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [],\n        \"CreateDate\": \"2016-04-02T12:35:07Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306bIAM Role\u3092\u8ffd\u52a0\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam add-role-to-instance-profile \\\n    --instance-profile-name ${ROLE_NAME} \\\n    --role-name ${ROLE_NAME}\n```\n\n```text:\u7d50\u679c\n\uff08\u8fd4\u5024\u7121\u3057\uff09\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306bIAM Role\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam get-instance-profile \\\n    --instance-profile-name ${ROLE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"InstanceProfile\": {\n        \"InstanceProfileId\": \"A********************\",\n        \"Roles\": [\n            {\n                \"AssumeRolePolicyDocument\": {\n                    \"Version\": \"2012-10-17\",\n                    \"Statement\": [\n                        {\n                            \"Action\": \"sts:AssumeRole\",\n                            \"Principal\": {\n                                \"Service\": \"ec2.amazonaws.com\"\n                            },\n                            \"Effect\": \"Allow\",\n                            \"Sid\": \"\"\n                        }\n                    ]\n                },\n                \"RoleId\": \"A********************\",\n                \"CreateDate\": \"2016-04-02T12:33:09Z\",\n                \"RoleName\": \"firehose-agent-role\",\n                \"Path\": \"/\",\n                \"Arn\": \"arn:aws:iam::************:role/firehose-agent-role\"\n            }\n        ],\n        \"CreateDate\": \"2016-04-02T12:35:07Z\",\n        \"InstanceProfileName\": \"firehose-agent-role\",\n        \"Path\": \"/\",\n        \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n    }\n}\n```\n\n# 8. EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\n## Amazon Linux\u306e\u6700\u65b0AMI\u306eImage ID\u3092\u78ba\u8a8d\n\nAmazon Linux\u306eAMI\u306e\u3046\u3061\u3001\u6700\u65b0\u306eAMI\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\uff082016\u5e7412\u67083\u65e5\u73fe\u5728\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nAMI_ID=ami-5ec1673e\n```\n\n## AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306eID\u3092\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9\nAWS_ID=$(aws sts get-caller-identity \\\n    --query Account \\\n    --output text) \\\n    && echo ${AWS_ID}\n```\n\n```text:\u7d50\u679c\n************\n```\n\n## \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nPRIVATE_IP_ADDRESS=\"10.0.0.10\"\n```\n\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   AWS_ID: ${AWS_ID}\n   AMI_ID: \"${AMI_ID}\"\n   KEY_PAIR_NAME: ${KEY_PAIR_NAME}\n   SecurityGroup_ID: \"${SG_ID}\"\n   Subnet_ID: \"${SUBNET_A_ID}\"\n   PRIVATE_IP_ADDRESS: ${PRIVATE_IP_ADDRESS}\n   Instance Profile ARN: arn:aws:iam::${AWS_ID}:instance-profile/${ROLE_NAME}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n   AWS_ID: ************\n   AMI_ID: \"ami-5ec1673e\"\n   KEY_PAIR_NAME: Firehose\n   SecurityGroup_ID: \"sg-********\"\n   Subnet_ID: \"subnet-********\"\n   PRIVATE_IP_ADDRESS: 10.0.0.10\n   Instance Profile ARN: arn:aws:iam::************:instance-profile/firehose-agent-role\n\n```\n\n## EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 run-instances \\\n    --image-id ${AMI_ID} \\\n    --key-name ${KEY_PAIR_NAME} \\\n    --security-group-ids ${SG_ID} \\\n    --instance-type 't2.micro' \\\n    --subnet-id ${SUBNET_A_ID} \\\n    --associate-public-ip-address \\\n    --private-ip-address ${PRIVATE_IP_ADDRESS} \\\n    --iam-instance-profile Arn=arn:aws:iam::${AWS_ID}:instance-profile/${ROLE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"OwnerId\": \"************\",\n    \"ReservationId\": \"r-0b28c************\",\n    \"Groups\": [],\n    \"Instances\": [\n        {\n            \"Monitoring\": {\n                \"State\": \"disabled\"\n            },\n            \"PublicDnsName\": \"\",\n            \"RootDeviceType\": \"ebs\",\n            \"State\": {\n                \"Code\": 0,\n                \"Name\": \"pending\"\n            },\n            \"EbsOptimized\": false,\n            \"LaunchTime\": \"2016-12-19T07:20:08.000Z\",\n            \"PrivateIpAddress\": \"10.0.0.10\",\n            \"ProductCodes\": [],\n            \"VpcId\": \"vpc-********\",\n            \"StateTransitionReason\": \"\",\n            \"InstanceId\": \"i-0****************\",\n            \"ImageId\": \"ami-5ec1673e\",\n            \"PrivateDnsName\": \"ip-10-0-0-10.us-west-2.compute.internal\",\n            \"KeyName\": \"Firehose\",\n            \"SecurityGroups\": [\n                {\n                    \"GroupName\": \"SSH-HTTP\",\n                    \"GroupId\": \"sg-********\"\n                }\n            ],\n            \"ClientToken\": \"\",\n            \"SubnetId\": \"subnet-********\",\n            \"InstanceType\": \"t2.micro\",\n            \"NetworkInterfaces\": [\n                {\n                    \"Status\": \"in-use\",\n                    \"MacAddress\": \"02:5d:2f:3b:65:9f\",\n                    \"SourceDestCheck\": true,\n                    \"VpcId\": \"vpc-********\",\n                    \"Description\": \"\",\n                    \"NetworkInterfaceId\": \"eni-********\",\n                    \"PrivateIpAddresses\": [\n                        {\n                            \"Primary\": true,\n                            \"PrivateIpAddress\": \"10.0.0.10\"\n                        }\n                    ],\n                    \"Ipv6Addresses\": [],\n                    \"Attachment\": {\n                        \"Status\": \"attaching\",\n                        \"DeviceIndex\": 0,\n                        \"DeleteOnTermination\": true,\n                        \"AttachmentId\": \"eni-attach-********\",\n                        \"AttachTime\": \"2016-12-19T07:20:08.000Z\"\n                    },\n                    \"Groups\": [\n                        {\n                            \"GroupName\": \"SSH-HTTP\",\n                            \"GroupId\": \"sg-********\"\n                        }\n                    ],\n                    \"SubnetId\": \"subnet-********\",\n                    \"OwnerId\": \"************\",\n                    \"PrivateIpAddress\": \"10.0.0.10\"\n                }\n            ],\n            \"SourceDestCheck\": true,\n            \"Placement\": {\n                \"Tenancy\": \"default\",\n                \"GroupName\": \"\",\n                \"AvailabilityZone\": \"us-west-2a\"\n            },\n            \"Hypervisor\": \"xen\",\n            \"BlockDeviceMappings\": [],\n            \"Architecture\": \"x86_64\",\n            \"StateReason\": {\n                \"Message\": \"pending\",\n                \"Code\": \"pending\"\n            },\n            \"IamInstanceProfile\": {\n                \"Id\": \"A********************\",\n                \"Arn\": \"arn:aws:iam::************:instance-profile/firehose-agent-role\"\n            },\n            \"RootDeviceName\": \"/dev/xvda\",\n            \"VirtualizationType\": \"hvm\",\n            \"AmiLaunchIndex\": 0\n        }\n    ]\n}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nINSTANCE_ID=$(aws ec2 describe-instances \\\n    --query \"Reservations[].Instances[?PrivateIpAddress==\\`${PRIVATE_IP_ADDRESS}\\`].InstanceId\" \\\n    --output text) \\\n    && echo ${INSTANCE_ID}\n```\n\n```text:\u7d50\u679c\ni-********\n```\n\n## EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-instances \\\n    --instance-ids ${INSTANCE_ID}\n```\n\n```json:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"Reservations\": [\n        {\n            \"OwnerId\": \"************\",\n            \"ReservationId\": \"r-0****************\",\n            \"Groups\": [],\n            \"Instances\": [\n                {\n                    \"Monitoring\": {\n                        \"State\": \"disabled\"\n                    },\n                    \"PublicDnsName\": \"\",\n                    \"State\": {\n                        \"Code\": 16,\n                        \"Name\": \"running\"\n                    },\n                    \"EbsOptimized\": false,\n                    \"LaunchTime\": \"2016-04-02T13:07:20.000Z\",\n                    \"PublicIpAddress\": \"**.**.**.**\",\n                    \"PrivateIpAddress\": \"10.0.0.10\",\n                    \"ProductCodes\": [],\n                    \"VpcId\": \"vpc-********\",\n                    \"StateTransitionReason\": \"\",\n                    \"InstanceId\": \"i-0****************\",\n                    \"ImageId\": \"ami-f80e0596\",\n                    \"PrivateDnsName\": \"ip-10-0-0-10.ap-northeast-1.compute.internal\",\n                    \"KeyName\": \"Redshift\",\n                    \"SecurityGroups\": [\n                        {\n                            \"GroupName\": \"SSH\",\n                            \"GroupId\": \"sg-********\"\n                        }\n                    ],\n                    \"ClientToken\": \"\",\n                    \"SubnetId\": \"subnet-********\",\n                    \"InstanceType\": \"t2.micro\",\n                    \"NetworkInterfaces\": [\n                        {\n                            \"Status\": \"in-use\",\n                            \"MacAddress\": \"**:**:**:**:**:**\",\n                            \"SourceDestCheck\": true,\n                            \"VpcId\": \"vpc-********\",\n                            \"Description\": \"\",\n                            \"Association\": {\n                                \"PublicIp\": \"**.**.**.**\",\n                                \"PublicDnsName\": \"\",\n                                \"IpOwnerId\": \"amazon\"\n                            },\n                            \"NetworkInterfaceId\": \"eni-********\",\n                            \"PrivateIpAddresses\": [\n                                {\n                                    \"Association\": {\n                                        \"PublicIp\": \"**.**.**.**\",\n                                        \"PublicDnsName\": \"\",\n                                        \"IpOwnerId\": \"amazon\"\n                                    },\n                                    \"Primary\": true,\n                                    \"PrivateIpAddress\": \"10.0.0.10\"\n                                }\n                            ],\n                            \"Attachment\": {\n                                \"Status\": \"attached\",\n                                \"DeviceIndex\": 0,\n                                \"DeleteOnTermination\": true,\n                                \"AttachmentId\": \"eni-attach-********\",\n                                \"AttachTime\": \"2016-04-02T13:07:20.000Z\"\n                            },\n                            \"Groups\": [\n                                {\n                                    \"GroupName\": \"SSH\",\n                                    \"GroupId\": \"sg-********\"\n                                }\n                            ],\n                            \"SubnetId\": \"subnet-********\",\n                            \"OwnerId\": \"************\",\n                            \"PrivateIpAddress\": \"10.0.0.10\"\n                        }\n                    ],\n                    \"SourceDestCheck\": true,\n                    \"Placement\": {\n                        \"Tenancy\": \"default\",\n                        \"GroupName\": \"\",\n                        \"AvailabilityZone\": \"ap-northeast-1a\"\n                    },\n                    \"Hypervisor\": \"xen\",\n                    \"BlockDeviceMappings\": [\n                        {\n                            \"DeviceName\": \"/dev/xvda\",\n                            \"Ebs\": {\n                                \"Status\": \"attached\",\n                                \"DeleteOnTermination\": true,\n                                \"VolumeId\": \"vol-********\",\n                                \"AttachTime\": \"2016-04-02T13:07:20.000Z\"\n                            }\n                        }\n                    ],\n                    \"Architecture\": \"x86_64\",\n                    \"RootDeviceType\": \"ebs\",\n                    \"IamInstanceProfile\": {\n                        \"Id\": \"A********************\",\n                        \"Arn\": \"arn:aws:iam::************:instance-profile/redshift-role\"\n                    },\n                    \"RootDeviceName\": \"/dev/xvda\",\n                    \"VirtualizationType\": \"hvm\",\n                    \"AmiLaunchIndex\": 0\n                }\n            ]\n        }\n    ]\n}\n```\n\n## \u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\nPUBLIC_IP_ADDRESS=$(aws ec2 describe-instances \\\n    --instance-ids ${INSTANCE_ID} \\\n    --query Reservations[0].Instances[0].PublicIpAddress \\\n    --output text) \\\n    && echo ${PUBLIC_IP_ADDRESS}\n```\n\n```text:\u7d50\u679c\n**.**.**.**\n```\n\n\u4ee5\u4e0a\n"}