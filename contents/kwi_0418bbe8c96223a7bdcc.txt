{"context": "\n\nINSTALL\nINSTALL.Docker.md \u3092\u624b\u5f15\u304d\u306b\u3001Ubuntu 16.10 \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u305f\u3002192.168.0.40 \u304c CENTRAL_IP \u3067\u3001192.168.0.41, 192.168.0.42 \u3068\u3044\u3046 docker host \u3068\u3044\u3046\u69cb\u6210\u306b\u3059\u308b\u3002\novn-northd \u306f ovn-central package \u306b\u5165\u3063\u3066\u3044\u308b\u3002ovn-central package \u3092\u5165\u308c\u308b\u3068 ovn-northd \u3082\u8d77\u52d5\u3059\u308b\u3002systemd \u3067\u306e unit name \u306f ovn-central \u3060\u304c\u3001\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306f /var/log/openvswitch \u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\novn-controller \u306f ovn-host package \u306b\u5165\u3063\u3066\u3044\u308b\u3002ovn-host package \u3092\u5165\u308c\u308b\u3068 ovn-controller \u3082\u8d77\u52d5\u3059\u308b\u3002unit name \u306f ovn-host \u3060\u304c\u3001\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306f /var/log/openvswitch \u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5165\u308c\u308b\u3068 ovn-central \u306b\u7e4b\u304c\u3063\u3066\u3001\u521d\u671f\u30d5\u30ed\u30fc\u307e\u3067\u5165\u308b\u3002\novs-vsctl set Open_vSwitch . external_ids:ovn-remote=\"tcp:$CENTRAL_IP:6642\" \\\n  external_ids:ovn-nb=\"tcp:$CENTRAL_IP:6641\" \\\n  external_ids:ovn-encap-ip=$LOCAL_IP \\\n  external_ids:ovn-encap-type=\"$ENCAP_TYPE\"\n\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=1025.214s, table=0, n_packets=0, n_bytes=0, idle_age=1025, priority=100,in_port=1 actions=move:NXM_NX_TUN_ID[0..23]->OXM_OF_METADATA[0..23],move:NXM_NX_TUN_METADATA0[16..30]->NXM_NX_REG14[0..14],move:NXM_NX_TUN_METADATA0[0..15]->NXM_NX_REG15[0..15],resubmit(,33)\n cookie=0x0, duration=1025.215s, table=32, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=resubmit(,33)\n cookie=0x0, duration=1025.215s, table=34, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=load:0->NXM_NX_REG0[],load:0->NXM_NX_REG1[],load:0->NXM_NX_REG2[],load:0->NXM_NX_REG3[],load:0->NXM_NX_REG4[],load:0->NXM_NX_REG5[],load:0->NXM_NX_REG6[],load:0->NXM_NX_REG7[],load:0->NXM_NX_REG8[],load:0->NXM_NX_REG9[],resubmit(,48)\n cookie=0x0, duration=1025.215s, table=64, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=resubmit(,65)\n\novn-docker package \u3092\u5165\u308c\u308b\u3002systemd \u30d5\u30a1\u30a4\u30eb\u306f\u7121\u3044\u69d8\u5b50\u3002ovn-docker-overlay-driver \u3092\u8d77\u52d5\u3055\u305b\u308b\u3068\u3001/etc/docker/plugins/openvswitch.spec \u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u3002\u3053\u308c\u3067 docker \u304b\u3089 openvswitch \u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u308b\u6e96\u5099\u304c\u6574\u3046\u3002\novn-docker-overlay-driver --detach\n\ndocker \u3092\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3055\u305b\u308b\u305f\u3081\u306b consul package \u3092\u5165\u308c\u308b\u3002\u3044\u3064\u3082\u901a\u308a bootstrap-expect=3 \u3067 3 \u53f0\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3093\u3067\u307f\u305f\u30023 \u53f0\u305d\u308c\u305e\u308c\u3067 agent \u3092\u8d77\u52d5\u3055\u305b\u308b\u3002\nconsul agent -bind 192.168.0.40 -data-dir=/var/lib/consul/data -server -bootstrap-expect=3 | logger &\n## \u4e0b\u306f 192.168.0.40 \u3067\u5b9f\u884c\u3059\u308c\u3070\u4e8b\u8db3\u308a\u308b\u3002\nconsul join 192.168.0.41\nconsul join 192.168.0.42\n\ndocker.io package \u3092\u5165\u308c\u308b\u3002/etc/defaults/docker \u306b DOCKER_OPTS \u3092\u66f8\u3044\u3066\u518d\u8d77\u52d5\u3057\u3066\u304a\u304f\u3002\nDOCKER_OPTS=--cluster-store=consul://127.0.0.1:8500 --cluster-advertise=192.168.0.41:0\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n$ docker network create -d openvswitch --subnet=192.168.1.0/24 foo\nffbdc7c12ae8e885dcf87f12992e7c508de2b5073d071c9def78be56eba4cc21\n\n$ docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n9e8ac92d1448        bridge              bridge              local\nffbdc7c12ae8        foo                 openvswitch         global\n80421cffc1f0        host                host                local\n6219ee0ca5c9        none                null                local\n\nINSTALL.Docker.md \u306f :6640 \u3068\u66f8\u3044\u3066\u308b\u3051\u3069\u3001\u305f\u3076\u3093 typo \u3067\u3001:6641 \u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3002\novn-nbctl --db=tcp:192.168.0.40:6641 ls-list\n\n\n\u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\n2 \u53f0\u306e docker host \u3067\u305d\u308c\u305e\u308c 1 \u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u3055\u305b\u305f\u5f8c\u306e\u30d5\u30ed\u30fc\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u3063\u305f\u3002\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=5338.201s, table=0, n_packets=7, n_bytes=578, idle_age=4, priority=100,in_port=2 actions=move:NXM_NX_TUN_ID[0..23]->OXM_OF_METADATA[0..23],move:NXM_NX_TUN_METADATA0[16..30]->NXM_NX_REG14[0..14],move:NXM_NX_TUN_METADATA0[0..15]->NXM_NX_REG15[0..15],resubmit(,33)\n cookie=0x0, duration=41.260s, table=0, n_packets=8, n_bytes=648, idle_age=30, priority=100,in_port=4 actions=load:0x1->NXM_NX_REG13[],load:0x2->OXM_OF_METADATA[],load:0x1->NXM_NX_REG14[],resubmit(,16)\n cookie=0x0, duration=41.260s, table=16, n_packets=0, n_bytes=0, idle_age=41, priority=100,metadata=0x2,vlan_tci=0x1000/0x1000 actions=drop\n cookie=0x0, duration=41.260s, table=16, n_packets=0, n_bytes=0, idle_age=41, priority=100,metadata=0x2,dl_src=01:00:00:00:00:00/01:00:00:00:00:00 actions=drop\n cookie=0x0, duration=41.260s, table=16, n_packets=8, n_bytes=648, idle_age=30, priority=50,reg14=0x1,metadata=0x2 actions=resubmit(,17)\n cookie=0x0, duration=11.153s, table=16, n_packets=0, n_bytes=0, idle_age=11, priority=50,reg14=0x2,metadata=0x2 actions=resubmit(,17)\n cookie=0x0, duration=41.260s, table=17, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,18)\n cookie=0x0, duration=41.260s, table=18, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,19)\n cookie=0x0, duration=41.260s, table=19, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,20)\n cookie=0x0, duration=41.260s, table=20, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,21)\n cookie=0x0, duration=41.260s, table=21, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x1/0x1,metadata=0x2 actions=ct(table=22,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=21, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x1/0x1,metadata=0x2 actions=ct(table=22,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=21, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,22)\n cookie=0x0, duration=41.260s, table=22, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,23)\n cookie=0x0, duration=41.260s, table=23, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,24)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,25)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,25)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x4/0x4,metadata=0x2 actions=ct(table=25,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x4/0x4,metadata=0x2 actions=ct(table=25,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=24, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,25)\n cookie=0x0, duration=41.259s, table=25, n_packets=0, n_bytes=0, idle_age=41, priority=50,arp,metadata=0x2,arp_tpa=192.168.1.3,arp_op=1 actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:02:1b:5c:3e:66:87,load:0x2->NXM_OF_ARP_OP[],move:NXM_NX_ARP_SHA[]->NXM_NX_ARP_THA[],load:0x21b5c3e6687->NXM_NX_ARP_SHA[],move:NXM_OF_ARP_SPA[]->NXM_OF_ARP_TPA[],load:0xc0a80103->NXM_OF_ARP_SPA[],move:NXM_NX_REG14[]->NXM_NX_REG15[],load:0x1->NXM_NX_REG10[0],resubmit(,32)\n cookie=0x0, duration=10.820s, table=25, n_packets=0, n_bytes=0, idle_age=10, priority=50,arp,metadata=0x2,arp_tpa=192.168.1.4,arp_op=1 actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:02:3b:98:39:5c:70,load:0x2->NXM_OF_ARP_OP[],move:NXM_NX_ARP_SHA[]->NXM_NX_ARP_THA[],load:0x23b98395c70->NXM_NX_ARP_SHA[],move:NXM_OF_ARP_SPA[]->NXM_OF_ARP_TPA[],load:0xc0a80104->NXM_OF_ARP_SPA[],move:NXM_NX_REG14[]->NXM_NX_REG15[],load:0x1->NXM_NX_REG10[0],resubmit(,32)\n cookie=0x0, duration=41.260s, table=25, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,26)\n cookie=0x0, duration=41.260s, table=26, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,27)\n cookie=0x0, duration=41.260s, table=27, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,28)\n cookie=0x0, duration=41.260s, table=28, n_packets=8, n_bytes=648, idle_age=30, priority=100,metadata=0x2,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=load:0xffff->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=41.260s, table=28, n_packets=0, n_bytes=0, idle_age=41, priority=50,metadata=0x2,dl_dst=02:1b:5c:3e:66:87 actions=load:0x1->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=11.145s, table=28, n_packets=0, n_bytes=0, idle_age=11, priority=50,metadata=0x2,dl_dst=02:3b:98:39:5c:70 actions=load:0x2->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=150,reg10=0x2/0x2 actions=resubmit(,33)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=100,reg15=0xffff,metadata=0x2 actions=load:0x2->NXM_NX_TUN_ID[0..23],set_field:0xffff/0xffffffff->tun_metadata0,move:NXM_NX_REG14[0..14]->NXM_NX_TUN_METADATA0[16..30],output:2,resubmit(,33)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=100,reg15=0x2,metadata=0x2 actions=load:0x2->NXM_NX_TUN_ID[0..23],set_field:0x2/0xffffffff->tun_metadata0,move:NXM_NX_REG14[0..14]->NXM_NX_TUN_METADATA0[16..30],output:2\n cookie=0x0, duration=8822.393s, table=32, n_packets=16, n_bytes=1296, idle_age=30, priority=0 actions=resubmit(,33)\n cookie=0x0, duration=41.260s, table=33, n_packets=0, n_bytes=0, idle_age=41, priority=100,reg15=0x1,metadata=0x2 actions=load:0x1->NXM_NX_REG13[],resubmit(,34)\n cookie=0x0, duration=41.260s, table=33, n_packets=15, n_bytes=1226, idle_age=4, priority=100,reg15=0xffff,metadata=0x2 actions=load:0x1->NXM_NX_REG13[],load:0x1->NXM_NX_REG15[],resubmit(,34),load:0xffff->NXM_NX_REG15[]\n cookie=0x0, duration=41.260s, table=34, n_packets=8, n_bytes=648, idle_age=30, priority=100,reg10=0/0x1,reg14=0x1,reg15=0x1,metadata=0x2 actions=drop\n cookie=0x0, duration=8822.393s, table=34, n_packets=7, n_bytes=578, idle_age=4, priority=0 actions=load:0->NXM_NX_REG0[],load:0->NXM_NX_REG1[],load:0->NXM_NX_REG2[],load:0->NXM_NX_REG3[],load:0->NXM_NX_REG4[],load:0->NXM_NX_REG5[],load:0->NXM_NX_REG6[],load:0->NXM_NX_REG7[],load:0->NXM_NX_REG8[],load:0->NXM_NX_REG9[],resubmit(,48)\n cookie=0x0, duration=41.260s, table=48, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,49)\n cookie=0x0, duration=41.260s, table=49, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,50)\n cookie=0x0, duration=41.260s, table=50, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x1/0x1,metadata=0x2 actions=ct(table=51,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=50, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x1/0x1,metadata=0x2 actions=ct(table=51,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=50, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,51)\n cookie=0x0, duration=41.260s, table=51, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,52)\n cookie=0x0, duration=41.260s, table=52, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,53)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x4/0x4,metadata=0x2 actions=ct(table=54,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x4/0x4,metadata=0x2 actions=ct(table=54,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,54)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,54)\n cookie=0x0, duration=41.260s, table=53, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,54)\n cookie=0x0, duration=41.260s, table=54, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,55)\n cookie=0x0, duration=41.260s, table=55, n_packets=7, n_bytes=578, idle_age=4, priority=100,metadata=0x2,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=resubmit(,64)\n cookie=0x0, duration=41.260s, table=55, n_packets=0, n_bytes=0, idle_age=41, priority=50,reg15=0x1,metadata=0x2 actions=resubmit(,64)\n cookie=0x0, duration=11.153s, table=55, n_packets=0, n_bytes=0, idle_age=11, priority=50,reg15=0x2,metadata=0x2 actions=resubmit(,64)\n cookie=0x0, duration=41.260s, table=64, n_packets=0, n_bytes=0, idle_age=41, priority=100,reg10=0x1/0x1,reg15=0x1,metadata=0x2 actions=push:NXM_OF_IN_PORT[],load:0->NXM_OF_IN_PORT[],resubmit(,65),pop:NXM_OF_IN_PORT[]\n cookie=0x0, duration=8822.393s, table=64, n_packets=7, n_bytes=578, idle_age=4, priority=0 actions=resubmit(,65)\n cookie=0x0, duration=41.260s, table=65, n_packets=7, n_bytes=578, idle_age=4, priority=100,reg15=0x1,metadata=0x2 actions=output:4\n\n# INSTALL\n`INSTALL.Docker.md` \u3092\u624b\u5f15\u304d\u306b\u3001Ubuntu 16.10 \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u305f\u3002`192.168.0.40` \u304c `CENTRAL_IP` \u3067\u3001`192.168.0.41`, `192.168.0.42` \u3068\u3044\u3046 docker host \u3068\u3044\u3046\u69cb\u6210\u306b\u3059\u308b\u3002\n\n`ovn-northd` \u306f `ovn-central` package \u306b\u5165\u3063\u3066\u3044\u308b\u3002`ovn-central` package \u3092\u5165\u308c\u308b\u3068 `ovn-northd` \u3082\u8d77\u52d5\u3059\u308b\u3002`systemd` \u3067\u306e unit name \u306f `ovn-central` \u3060\u304c\u3001\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306f `/var/log/openvswitch` \u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n\n`ovn-controller` \u306f `ovn-host` package \u306b\u5165\u3063\u3066\u3044\u308b\u3002`ovn-host` package \u3092\u5165\u308c\u308b\u3068 `ovn-controller` \u3082\u8d77\u52d5\u3059\u308b\u3002unit name \u306f `ovn-host` \u3060\u304c\u3001\u610f\u5473\u306e\u3042\u308b\u30ed\u30b0\u306f `/var/log/openvswitch` \u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5165\u308c\u308b\u3068 `ovn-central` \u306b\u7e4b\u304c\u3063\u3066\u3001\u521d\u671f\u30d5\u30ed\u30fc\u307e\u3067\u5165\u308b\u3002\n\n```\novs-vsctl set Open_vSwitch . external_ids:ovn-remote=\"tcp:$CENTRAL_IP:6642\" \\\n  external_ids:ovn-nb=\"tcp:$CENTRAL_IP:6641\" \\\n  external_ids:ovn-encap-ip=$LOCAL_IP \\\n  external_ids:ovn-encap-type=\"$ENCAP_TYPE\"\n```\n\n```\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=1025.214s, table=0, n_packets=0, n_bytes=0, idle_age=1025, priority=100,in_port=1 actions=move:NXM_NX_TUN_ID[0..23]->OXM_OF_METADATA[0..23],move:NXM_NX_TUN_METADATA0[16..30]->NXM_NX_REG14[0..14],move:NXM_NX_TUN_METADATA0[0..15]->NXM_NX_REG15[0..15],resubmit(,33)\n cookie=0x0, duration=1025.215s, table=32, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=resubmit(,33)\n cookie=0x0, duration=1025.215s, table=34, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=load:0->NXM_NX_REG0[],load:0->NXM_NX_REG1[],load:0->NXM_NX_REG2[],load:0->NXM_NX_REG3[],load:0->NXM_NX_REG4[],load:0->NXM_NX_REG5[],load:0->NXM_NX_REG6[],load:0->NXM_NX_REG7[],load:0->NXM_NX_REG8[],load:0->NXM_NX_REG9[],resubmit(,48)\n cookie=0x0, duration=1025.215s, table=64, n_packets=0, n_bytes=0, idle_age=1025, priority=0 actions=resubmit(,65)\n```\n\n`ovn-docker` package \u3092\u5165\u308c\u308b\u3002systemd \u30d5\u30a1\u30a4\u30eb\u306f\u7121\u3044\u69d8\u5b50\u3002`ovn-docker-overlay-driver` \u3092\u8d77\u52d5\u3055\u305b\u308b\u3068\u3001`/etc/docker/plugins/openvswitch.spec` \u304c\u66f8\u304d\u8fbc\u307e\u308c\u308b\u3002\u3053\u308c\u3067 docker \u304b\u3089 `openvswitch` \u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u308b\u6e96\u5099\u304c\u6574\u3046\u3002\n\n```\novn-docker-overlay-driver --detach\n```\n\ndocker \u3092\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3055\u305b\u308b\u305f\u3081\u306b `consul` package \u3092\u5165\u308c\u308b\u3002\u3044\u3064\u3082\u901a\u308a `bootstrap-expect=3` \u3067 3 \u53f0\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7d44\u3093\u3067\u307f\u305f\u30023 \u53f0\u305d\u308c\u305e\u308c\u3067 agent \u3092\u8d77\u52d5\u3055\u305b\u308b\u3002\n\n```\nconsul agent -bind 192.168.0.40 -data-dir=/var/lib/consul/data -server -bootstrap-expect=3 | logger &\n## \u4e0b\u306f 192.168.0.40 \u3067\u5b9f\u884c\u3059\u308c\u3070\u4e8b\u8db3\u308a\u308b\u3002\nconsul join 192.168.0.41\nconsul join 192.168.0.42\n```\n\n`docker.io` package \u3092\u5165\u308c\u308b\u3002`/etc/defaults/docker` \u306b `DOCKER_OPTS` \u3092\u66f8\u3044\u3066\u518d\u8d77\u52d5\u3057\u3066\u304a\u304f\u3002\n\n```\nDOCKER_OPTS=--cluster-store=consul://127.0.0.1:8500 --cluster-advertise=192.168.0.41:0\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n```\n$ docker network create -d openvswitch --subnet=192.168.1.0/24 foo\nffbdc7c12ae8e885dcf87f12992e7c508de2b5073d071c9def78be56eba4cc21\n\n$ docker network ls\nNETWORK ID          NAME                DRIVER              SCOPE\n9e8ac92d1448        bridge              bridge              local\nffbdc7c12ae8        foo                 openvswitch         global\n80421cffc1f0        host                host                local\n6219ee0ca5c9        none                null                local\n```\n\n`INSTALL.Docker.md` \u306f `:6640` \u3068\u66f8\u3044\u3066\u308b\u3051\u3069\u3001\u305f\u3076\u3093 typo \u3067\u3001`:6641` \u306b\u554f\u3044\u5408\u308f\u305b\u308b\u3002\n\n```\novn-nbctl --db=tcp:192.168.0.40:6641 ls-list\n```\n\n# \u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\n\n2 \u53f0\u306e docker host \u3067\u305d\u308c\u305e\u308c 1 \u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u3055\u305b\u305f\u5f8c\u306e\u30d5\u30ed\u30fc\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u3063\u305f\u3002\n\n```\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=5338.201s, table=0, n_packets=7, n_bytes=578, idle_age=4, priority=100,in_port=2 actions=move:NXM_NX_TUN_ID[0..23]->OXM_OF_METADATA[0..23],move:NXM_NX_TUN_METADATA0[16..30]->NXM_NX_REG14[0..14],move:NXM_NX_TUN_METADATA0[0..15]->NXM_NX_REG15[0..15],resubmit(,33)\n cookie=0x0, duration=41.260s, table=0, n_packets=8, n_bytes=648, idle_age=30, priority=100,in_port=4 actions=load:0x1->NXM_NX_REG13[],load:0x2->OXM_OF_METADATA[],load:0x1->NXM_NX_REG14[],resubmit(,16)\n cookie=0x0, duration=41.260s, table=16, n_packets=0, n_bytes=0, idle_age=41, priority=100,metadata=0x2,vlan_tci=0x1000/0x1000 actions=drop\n cookie=0x0, duration=41.260s, table=16, n_packets=0, n_bytes=0, idle_age=41, priority=100,metadata=0x2,dl_src=01:00:00:00:00:00/01:00:00:00:00:00 actions=drop\n cookie=0x0, duration=41.260s, table=16, n_packets=8, n_bytes=648, idle_age=30, priority=50,reg14=0x1,metadata=0x2 actions=resubmit(,17)\n cookie=0x0, duration=11.153s, table=16, n_packets=0, n_bytes=0, idle_age=11, priority=50,reg14=0x2,metadata=0x2 actions=resubmit(,17)\n cookie=0x0, duration=41.260s, table=17, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,18)\n cookie=0x0, duration=41.260s, table=18, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,19)\n cookie=0x0, duration=41.260s, table=19, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,20)\n cookie=0x0, duration=41.260s, table=20, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,21)\n cookie=0x0, duration=41.260s, table=21, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x1/0x1,metadata=0x2 actions=ct(table=22,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=21, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x1/0x1,metadata=0x2 actions=ct(table=22,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=21, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,22)\n cookie=0x0, duration=41.260s, table=22, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,23)\n cookie=0x0, duration=41.260s, table=23, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,24)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,25)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,25)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x4/0x4,metadata=0x2 actions=ct(table=25,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=24, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x4/0x4,metadata=0x2 actions=ct(table=25,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=24, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,25)\n cookie=0x0, duration=41.259s, table=25, n_packets=0, n_bytes=0, idle_age=41, priority=50,arp,metadata=0x2,arp_tpa=192.168.1.3,arp_op=1 actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:02:1b:5c:3e:66:87,load:0x2->NXM_OF_ARP_OP[],move:NXM_NX_ARP_SHA[]->NXM_NX_ARP_THA[],load:0x21b5c3e6687->NXM_NX_ARP_SHA[],move:NXM_OF_ARP_SPA[]->NXM_OF_ARP_TPA[],load:0xc0a80103->NXM_OF_ARP_SPA[],move:NXM_NX_REG14[]->NXM_NX_REG15[],load:0x1->NXM_NX_REG10[0],resubmit(,32)\n cookie=0x0, duration=10.820s, table=25, n_packets=0, n_bytes=0, idle_age=10, priority=50,arp,metadata=0x2,arp_tpa=192.168.1.4,arp_op=1 actions=move:NXM_OF_ETH_SRC[]->NXM_OF_ETH_DST[],mod_dl_src:02:3b:98:39:5c:70,load:0x2->NXM_OF_ARP_OP[],move:NXM_NX_ARP_SHA[]->NXM_NX_ARP_THA[],load:0x23b98395c70->NXM_NX_ARP_SHA[],move:NXM_OF_ARP_SPA[]->NXM_OF_ARP_TPA[],load:0xc0a80104->NXM_OF_ARP_SPA[],move:NXM_NX_REG14[]->NXM_NX_REG15[],load:0x1->NXM_NX_REG10[0],resubmit(,32)\n cookie=0x0, duration=41.260s, table=25, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,26)\n cookie=0x0, duration=41.260s, table=26, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,27)\n cookie=0x0, duration=41.260s, table=27, n_packets=8, n_bytes=648, idle_age=30, priority=0,metadata=0x2 actions=resubmit(,28)\n cookie=0x0, duration=41.260s, table=28, n_packets=8, n_bytes=648, idle_age=30, priority=100,metadata=0x2,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=load:0xffff->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=41.260s, table=28, n_packets=0, n_bytes=0, idle_age=41, priority=50,metadata=0x2,dl_dst=02:1b:5c:3e:66:87 actions=load:0x1->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=11.145s, table=28, n_packets=0, n_bytes=0, idle_age=11, priority=50,metadata=0x2,dl_dst=02:3b:98:39:5c:70 actions=load:0x2->NXM_NX_REG15[],resubmit(,32)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=150,reg10=0x2/0x2 actions=resubmit(,33)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=100,reg15=0xffff,metadata=0x2 actions=load:0x2->NXM_NX_TUN_ID[0..23],set_field:0xffff/0xffffffff->tun_metadata0,move:NXM_NX_REG14[0..14]->NXM_NX_TUN_METADATA0[16..30],output:2,resubmit(,33)\n cookie=0x0, duration=10.821s, table=32, n_packets=0, n_bytes=0, idle_age=10, priority=100,reg15=0x2,metadata=0x2 actions=load:0x2->NXM_NX_TUN_ID[0..23],set_field:0x2/0xffffffff->tun_metadata0,move:NXM_NX_REG14[0..14]->NXM_NX_TUN_METADATA0[16..30],output:2\n cookie=0x0, duration=8822.393s, table=32, n_packets=16, n_bytes=1296, idle_age=30, priority=0 actions=resubmit(,33)\n cookie=0x0, duration=41.260s, table=33, n_packets=0, n_bytes=0, idle_age=41, priority=100,reg15=0x1,metadata=0x2 actions=load:0x1->NXM_NX_REG13[],resubmit(,34)\n cookie=0x0, duration=41.260s, table=33, n_packets=15, n_bytes=1226, idle_age=4, priority=100,reg15=0xffff,metadata=0x2 actions=load:0x1->NXM_NX_REG13[],load:0x1->NXM_NX_REG15[],resubmit(,34),load:0xffff->NXM_NX_REG15[]\n cookie=0x0, duration=41.260s, table=34, n_packets=8, n_bytes=648, idle_age=30, priority=100,reg10=0/0x1,reg14=0x1,reg15=0x1,metadata=0x2 actions=drop\n cookie=0x0, duration=8822.393s, table=34, n_packets=7, n_bytes=578, idle_age=4, priority=0 actions=load:0->NXM_NX_REG0[],load:0->NXM_NX_REG1[],load:0->NXM_NX_REG2[],load:0->NXM_NX_REG3[],load:0->NXM_NX_REG4[],load:0->NXM_NX_REG5[],load:0->NXM_NX_REG6[],load:0->NXM_NX_REG7[],load:0->NXM_NX_REG8[],load:0->NXM_NX_REG9[],resubmit(,48)\n cookie=0x0, duration=41.260s, table=48, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,49)\n cookie=0x0, duration=41.260s, table=49, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,50)\n cookie=0x0, duration=41.260s, table=50, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x1/0x1,metadata=0x2 actions=ct(table=51,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=50, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x1/0x1,metadata=0x2 actions=ct(table=51,zone=NXM_NX_REG13[0..15])\n cookie=0x0, duration=41.260s, table=50, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,51)\n cookie=0x0, duration=41.260s, table=51, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,52)\n cookie=0x0, duration=41.260s, table=52, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,53)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x4/0x4,metadata=0x2 actions=ct(table=54,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x4/0x4,metadata=0x2 actions=ct(table=54,zone=NXM_NX_REG13[0..15],nat)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ip,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,54)\n cookie=0x0, duration=41.260s, table=53, n_packets=0, n_bytes=0, idle_age=41, priority=100,ipv6,reg0=0x2/0x2,metadata=0x2 actions=ct(commit,zone=NXM_NX_REG13[0..15],exec(load:0->NXM_NX_CT_LABEL[0])),resubmit(,54)\n cookie=0x0, duration=41.260s, table=53, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,54)\n cookie=0x0, duration=41.260s, table=54, n_packets=7, n_bytes=578, idle_age=4, priority=0,metadata=0x2 actions=resubmit(,55)\n cookie=0x0, duration=41.260s, table=55, n_packets=7, n_bytes=578, idle_age=4, priority=100,metadata=0x2,dl_dst=01:00:00:00:00:00/01:00:00:00:00:00 actions=resubmit(,64)\n cookie=0x0, duration=41.260s, table=55, n_packets=0, n_bytes=0, idle_age=41, priority=50,reg15=0x1,metadata=0x2 actions=resubmit(,64)\n cookie=0x0, duration=11.153s, table=55, n_packets=0, n_bytes=0, idle_age=11, priority=50,reg15=0x2,metadata=0x2 actions=resubmit(,64)\n cookie=0x0, duration=41.260s, table=64, n_packets=0, n_bytes=0, idle_age=41, priority=100,reg10=0x1/0x1,reg15=0x1,metadata=0x2 actions=push:NXM_OF_IN_PORT[],load:0->NXM_OF_IN_PORT[],resubmit(,65),pop:NXM_OF_IN_PORT[]\n cookie=0x0, duration=8822.393s, table=64, n_packets=7, n_bytes=578, idle_age=4, priority=0 actions=resubmit(,65)\n cookie=0x0, duration=41.260s, table=65, n_packets=7, n_bytes=578, idle_age=4, priority=100,reg15=0x1,metadata=0x2 actions=output:4\n```\n", "tags": ["docker", "ovn", "OpenVSwitch", "Ubuntu"]}