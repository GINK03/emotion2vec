{"tags": ["vagrant", "macos", "Ansible"], "context": " More than 1 year has passed since last update.Ansible\u3092\u4f7f\u3044\u59cb\u3081\u3066\u304b\u3089\u3001\u5c11\u3057\u8003\u3048\u305f\u70b9\u306a\u3069\u3092\u30e1\u30e2\u3068\u3057\u3066\u6b8b\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u9069\u5b9c\u3001\u8ffd\u8a18\u3002\n\nBest Practices\u3067Role\u4f7f\u7528\u6642\u306etask, handler, vars\u306b\u95a2\u3057\u3066\n\nplaybook.yml\n- hosts: all\n  remote_user: root\n  vars:\n    admin_name: admin\n  tasks:\n    - name: Add a new user\n      user: name={{admin_name}} groups=\"wheel\" state=present\n\n\n\u3053\u306e\u3088\u3046\u306aansible\u306eplaybook\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002\u3053\u308c\u3092Best Practices\u306e\u69cb\u6210\u306b\u5f93\u3063\u3066\u3001Role\u4f7f\u7528\u6642\u306etask, handler, vars\u306b\u305d\u308c\u305e\u308c\u5206\u5272\u3059\u308b\u3002\nroles/common/tasks/main.yml\nroles/common/handlers/main.yml\nroles/common/vars/main.yml\n\n\u3053\u306e\u3088\u3046\u306a\u5834\u5408\u3001\u5404tasks, handlers, vars\u306bmain.yml\u304c\u5b58\u5728\u3059\u308c\u3070\u81ea\u52d5\u7684\u306b\u3053\u308c\u3089\u306e\u5185\u5bb9\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\n\u4ee5\u4e0b\u306f\u3001task\u3092roles/common/tasks/main.yml\u306b\u79fb\u3057\u305f\u5834\u5408\u3060\u304c\u3001\u3053\u308c\u3060\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n\nroles/common/tasks/main.yml\ntasks:\n    - name: Add a new user\n    user: name={{admin_name}} groups=\"wheel\" state=present\n\n\n\u767a\u751f\u3059\u308b\u30a8\u30e9\u30fc\nERROR: expecting dict; got: tasks, error in /your/tasks/path/main.yml\n\n\n\u89e3\u6c7a\n\nroles/common/tasks/main.yml\n- name: Add a new user\n  user: name={{admin_name}} groups=\"wheel\" state=present\n\n\nroles\u4ee5\u4e0b\u306e\u5404tasks, handlers, vars\u306emain.yml\u306frole\u3092\u4f7f\u7528\u6642\u306b\u81ea\u52d5\u7684\u306b\u8aad\u307f\u3053\u307e\u308c\u308b\u305f\u3081\u3001-tasks\u306a\u3069\u306e\u8a18\u8ff0\u306f\u4e0d\u8981\u306b\u306a\u308b\u3002vars, handlers\u306b\u95a2\u3057\u3066\u3082\u3001\u540c\u69d8\u3002\n\nBest Practices\u3067Role\u4f7f\u7528\u6642\u306egroup_vars/host_vars\u306e\u5909\u6570\u306e\u5229\u7528\u306b\u95a2\u3057\u3066\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001group_vars/all.yml\u306buser\u3068\u3044\u3046\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n\ngroup_vars/all.yml\nuser: hoge\n\n\n\u76f4\u63a5\u3001{{user}}\u3068\u3057\u3066\u3001\u5909\u6570\u306e\u5185\u5bb9\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n- name: Add a new user from group_vars:all\n  user: name={{user}} groups=\"wheel\" state=present\n\n\u4eca\u56de\u306f\u3001users\u3068\u3057\u3066\uff11\u30e6\u30fc\u30b6\u306b\u5404\u5909\u6570\u3092\u6301\u305f\u305b\u305f\u5834\u5408\u3092\u8003\u3048\u308b\u3002\n\ngroup_vars/all.yml\nusers:\n  - { name: hoge, password: \"fuga\", groups: \"wheel\" }\n\n\n\u3053\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30ea\u30b9\u30c8\u5909\u6570\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u5404\u5909\u6570\u306e\u5185\u5bb9\u3092\u53d6\u5f97\u53ef\u80fd\u3060\u3063\u305f\u3002\n- name: Add a new user from group_vars/all.yml\n  user: name={{item.name}} groups=\"wheel\" state=present\n  with_items: users\n\n\nAnsible\u3067\u5bfe\u8c61\u3092\u8907\u6570\u6307\u5b9a\u3092\u3057\u305f\u3044\u5834\u5408\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u4f5c\u6210\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u306b\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3059\u308b\n- hosts: localhost\n  task\n    - name: Add a new user\n      user: name=hoge groups=\"wheel,fuga\" state=present\n\n\u4f8b\u3048\u3070\u3001groups\u3067\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u3001,(\u30ab\u30f3\u30de)\u3092\u5229\u7528\u3002\n\u203b\u6ce8\u610f\uff1a ,(\u30ab\u30f3\u30de)\u306e\u524d\u306b\u30b9\u30da\u30fc\u30b9\u304c\u5165\u308b\u3068\u3001\u305d\u308c\u304c\u8a8d\u8b58\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\uff01\uff01\n\n\u901a\u5e38\u306froot\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3001\u7279\u5b9a\u306e\u30bf\u30b9\u30af\u306e\u307f\u6307\u5b9a\u306e\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u4f5c\u6210\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u306b\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3059\u308b\n- hosts: localhost\n  become: on\n  task\n    - name: Create test file\n      file: path=/home/hoge/test.txt state=touch mode=\"u=rw,g=r,o=r\"\n      become_user: hoge\n\n\u4f8b\u3048\u3070\u3001hoge\u30e6\u30fc\u30b6\u3067test.txt\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u3001\nbecome_user\u3067\u5b9f\u884c\u30e6\u30fc\u30b6\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\u306bSFTP\u3067\u306f\u306a\u304f\u3001ssh\u3092\u5229\u7528\u3059\u308b\n\nansible.cfg\n[defaults]\ntransport=ssh\n\n[ssh_connection]\nssh_args=\nscp_if_ssh=True\n\n\n\n\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u8a2d\u7f6e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u72b6\u6cc1\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u53ef\u80fd\nansible -i hosts -m setup\n\n\nAnsible\u3092\u4f7f\u3044\u59cb\u3081\u3066\u304b\u3089\u3001\u5c11\u3057\u8003\u3048\u305f\u70b9\u306a\u3069\u3092\u30e1\u30e2\u3068\u3057\u3066\u6b8b\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u9069\u5b9c\u3001\u8ffd\u8a18\u3002\n\n\n###[Best Practices](http://docs.ansible.com/ansible/playbooks_best_practices.html)\u3067Role\u4f7f\u7528\u6642\u306etask, handler, vars\u306b\u95a2\u3057\u3066\n\n\n```yaml:playbook.yml\n- hosts: all\n  remote_user: root\n  vars:\n\tadmin_name: admin\n  tasks:\n    - name: Add a new user\n      user: name={{admin_name}} groups=\"wheel\" state=present\n```\n\n\u3053\u306e\u3088\u3046\u306aansible\u306e`playbook`\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002\u3053\u308c\u3092[Best Practices](http://docs.ansible.com/ansible/playbooks_best_practices.html)\u306e\u69cb\u6210\u306b\u5f93\u3063\u3066\u3001Role\u4f7f\u7528\u6642\u306etask, handler, vars\u306b\u305d\u308c\u305e\u308c\u5206\u5272\u3059\u308b\u3002\n\n\n```\nroles/common/tasks/main.yml\nroles/common/handlers/main.yml\nroles/common/vars/main.yml\n```\n\u3053\u306e\u3088\u3046\u306a\u5834\u5408\u3001\u5404tasks, handlers, vars\u306bmain.yml\u304c\u5b58\u5728\u3059\u308c\u3070\u81ea\u52d5\u7684\u306b\u3053\u308c\u3089\u306e\u5185\u5bb9\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\n\n\n\u4ee5\u4e0b\u306f\u3001`task`\u3092`roles/common/tasks/main.yml`\u306b\u79fb\u3057\u305f\u5834\u5408\u3060\u304c\u3001\u3053\u308c\u3060\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n\n```yaml:roles/common/tasks/main.yml\ntasks:\n    - name: Add a new user\n    user: name={{admin_name}} groups=\"wheel\" state=present\n```\n\n\u767a\u751f\u3059\u308b\u30a8\u30e9\u30fc\n\n```\nERROR: expecting dict; got: tasks, error in /your/tasks/path/main.yml\n```\n\n#####\u89e3\u6c7a\n\n```yaml:roles/common/tasks/main.yml\n- name: Add a new user\n  user: name={{admin_name}} groups=\"wheel\" state=present\n```\n\nroles\u4ee5\u4e0b\u306e\u5404tasks, handlers, vars\u306emain.yml\u306frole\u3092\u4f7f\u7528\u6642\u306b\u81ea\u52d5\u7684\u306b\u8aad\u307f\u3053\u307e\u308c\u308b\u305f\u3081\u3001`-tasks`\u306a\u3069\u306e\u8a18\u8ff0\u306f\u4e0d\u8981\u306b\u306a\u308b\u3002vars, handlers\u306b\u95a2\u3057\u3066\u3082\u3001\u540c\u69d8\u3002\n\n###[Best Practices](http://docs.ansible.com/ansible/playbooks_best_practices.html)\u3067Role\u4f7f\u7528\u6642\u306egroup_vars/host_vars\u306e\u5909\u6570\u306e\u5229\u7528\u306b\u95a2\u3057\u3066\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001`group_vars/all.yml`\u306b`user`\u3068\u3044\u3046\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n\n```yaml:group_vars/all.yml\nuser: hoge\n```\n\n\u76f4\u63a5\u3001`{{user}}`\u3068\u3057\u3066\u3001\u5909\u6570\u306e\u5185\u5bb9\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```\n- name: Add a new user from group_vars:all\n  user: name={{user}} groups=\"wheel\" state=present\n```\n\n\u4eca\u56de\u306f\u3001`users`\u3068\u3057\u3066\uff11\u30e6\u30fc\u30b6\u306b\u5404\u5909\u6570\u3092\u6301\u305f\u305b\u305f\u5834\u5408\u3092\u8003\u3048\u308b\u3002\n\n```yaml:group_vars/all.yml\nusers:\n  - { name: hoge, password: \"fuga\", groups: \"wheel\" }\n```\n\n\u3053\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30ea\u30b9\u30c8\u5909\u6570\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u5404\u5909\u6570\u306e\u5185\u5bb9\u3092\u53d6\u5f97\u53ef\u80fd\u3060\u3063\u305f\u3002\n\n```\n- name: Add a new user from group_vars/all.yml\n  user: name={{item.name}} groups=\"wheel\" state=present\n  with_items: users\n```\n\n###Ansible\u3067\u5bfe\u8c61\u3092\u8907\u6570\u6307\u5b9a\u3092\u3057\u305f\u3044\u5834\u5408\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u4f5c\u6210\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u306b\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3059\u308b\n\n```\n- hosts: localhost\n  task\n    - name: Add a new user\n      user: name=hoge groups=\"wheel,fuga\" state=present\n```\n\n\u4f8b\u3048\u3070\u3001`groups`\u3067\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u3001`,(\u30ab\u30f3\u30de)`\u3092\u5229\u7528\u3002\n\u203b\u6ce8\u610f\uff1a `,(\u30ab\u30f3\u30de)`\u306e\u524d\u306b\u30b9\u30da\u30fc\u30b9\u304c\u5165\u308b\u3068\u3001\u305d\u308c\u304c\u8a8d\u8b58\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\uff01\uff01\n\n####\u901a\u5e38\u306froot\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3001\u7279\u5b9a\u306e\u30bf\u30b9\u30af\u306e\u307f\u6307\u5b9a\u306e\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u4f5c\u6210\u6642\u306b\u30b0\u30eb\u30fc\u30d7\u306b\u8907\u6570\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3059\u308b\n\n```\n- hosts: localhost\n  become: on\n  task\n    - name: Create test file\n      file: path=/home/hoge/test.txt state=touch mode=\"u=rw,g=r,o=r\"\n      become_user: hoge\n```\n\n\u4f8b\u3048\u3070\u3001hoge\u30e6\u30fc\u30b6\u3067test.txt\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u3001\n`become_user`\u3067\u5b9f\u884c\u30e6\u30fc\u30b6\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n###\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\u306bSFTP\u3067\u306f\u306a\u304f\u3001ssh\u3092\u5229\u7528\u3059\u308b\n\n```yaml:ansible.cfg\n[defaults]\ntransport=ssh\n\n[ssh_connection]\nssh_args=\nscp_if_ssh=True\n```\n\n###\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u8a2d\u7f6e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u72b6\u6cc1\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u53ef\u80fd\n\n```\nansible -i hosts -m setup\n```\n"}