{"context": " More than 1 year has passed since last update.\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u5f37\u529b\u306a Ruby \u3067\u306f\u3001\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3068\u3044\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56fa\u6709\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u305d\u306e\u5834\u3067\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nhoge = \"hoge\"\ndef hoge.piyo\n  \"piyo\"\nend\nhoge.piyo # => \"piyo\"\n\ndef hoge.piyo \u306e\u5185\u5074\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b9\u30b3\u30fc\u30d7\u306e\u305f\u3081\u3001\u5b9a\u7fa9\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3084\u30e1\u30bd\u30c3\u30c9\u306f\u53c2\u7167\u3067\u304d\u307e\u305b\u3093\u3002\nhoge = \"hoge\"\nmessage = \"piyo\"\ndef hoge.piyo\n  message\nend\nhoge.piyo # => NameError: undefined local variable or method `message' for \"fuga\":String\n\n\u306a\u3093\u3068\u304b\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3084\u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3057\u305f\u3044\u3067\u3059\u3002\n\n\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\nObject#define_singleton_method \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u5b9a\u7fa9\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3092\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u304b\u3089\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.define_singleton_method(:piyo) do\n  message\nend\nhoge.piyo # => \"piyo\"\n\nRuby \u306e\u30d6\u30ed\u30c3\u30af\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u3059\u3002define_singleton_method \u306b\u6e21\u3057\u305f\u30d6\u30ed\u30c3\u30af\u5185\u3067\u306f\u3001\u5b9a\u7fa9\u6642\u306e\u30b9\u30b3\u30fc\u30d7\u304c\u5f15\u304d\u7d99\u304c\u308c\u3066\u304a\u308a\u3001message \u3092\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\n\u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3059\u308b\n\u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3059\u308b\u5834\u5408\u3001\u540c\u3058\u3088\u3046\u306b define_singleton_method \u3092\u4f7f\u3046\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3002\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    obj.define_singleton_method(:piyo) do\n      message\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => NameError: undefined local variable or method `message' for \"hoge\":String\n\ndefine_singleton_method \u306b\u6e21\u3057\u305f\u30d6\u30ed\u30c3\u30af\u306f\u3001self \u304c define_singleton_method \u306e\u30ec\u30b7\u30fc\u30d0\u3059\u306a\u308f\u3061 hoge \u306e\u72b6\u614b\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001message \u306f hoge.message \u3068\u89e3\u91c8\u3055\u308c\u3001\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\u89e3\u6c7a\u65b9\u6cd5\u306f\u3044\u308d\u3044\u308d\u3042\u308a\u307e\u3059\u3002\n\na. self \u3092\u9000\u907f\u3059\u308b\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    self_orig = self\n    obj.define_singleton_method(:piyo) do\n      self_orig.message\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n\nself \u3092\u9069\u5f53\u306a\u5909\u6570\u306b\u907f\u3051\u3066\u304a\u3051\u3070\u3001\u5b9a\u7fa9\u6642\u306e self \u3092\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\nb. Method \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u56fa\u3081\u308b\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    message_method = method(:message)\n    obj.define_singleton_method(:piyo) do\n      message_method.call\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n\nMethod \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u30ec\u30b7\u30fc\u30d0\u304c self \u306b\u4f9d\u5b58\u3057\u306a\u3044\u306e\u3067\u3001\u3075\u3064\u3046\u306b\u547c\u3079\u307e\u3059\u3002\n\nc. \u5b9f\u884c\u7d50\u679c\u3092\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306b\u5165\u308c\u3066\u304a\u304f\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    message_value = message\n    obj.define_singleton_method(:piyo) do\n      message_value\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n\n\u4e00\u756a\u30e9\u30af\u306a\u65b9\u6cd5\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001message \u30e1\u30bd\u30c3\u30c9\u304c def_piyo \u5b9f\u884c\u6642\u306b\u547c\u3070\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u90fd\u5408\u304c\u60aa\u3044\u5834\u5408\u3082\u591a\u305d\u3046\u3002\n\u30d6\u30ed\u30c3\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u304d\u306b\u3001self \u304c\u7f6e\u304d\u63db\u3048\u3089\u308c\u308b \u3068\u3044\u3046\u8003\u3048\u65b9\u306f\u76f4\u611f\u7684\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u3068 ***_eval \u7cfb\u3067\u3082\u30cf\u30de\u308b\u3053\u3068\u304c\u5c11\u306a\u304f\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n(\u304a\u307e\u3051) \u7279\u7570\u30af\u30e9\u30b9\nObject#singleton_class \u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30af\u30e9\u30b9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u7279\u7570\u30af\u30e9\u30b9\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3092\u4fdd\u6709\u3059\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\nhoge = \"hoge\"\ndef hoge.piyo\n  \"piyo\"\nend\nhoge.singleton_class # => #<Class:#<String:xxx>>\nhoge.singleton_class.instance_methods - String.instance_methods # => [:piyo]\n\n\u4e0a\u4f8b\u3067\u306f\u3001hoge.singleton_class \u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066 piyo \u3092\u6301\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30af\u30e9\u30b9\u3067 def \u3084 define_method \u3059\u308b\u3053\u3068\u3067\u3001\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3092\u751f\u3084\u305b\u307e\u3059\u3002\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.singleton_class.class_eval do\n  define_method(:piyo) do\n    message\n  end\nend\nhoge.piyo # => \"piyo\"\n\n\u305f\u3060\u3057\u3001def \u3060\u3068\u30b9\u30b3\u30fc\u30d7\u304c\u5909\u308f\u308b\u306e\u3067\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.singleton_class.class_eval do\n  def piyo\n    message\n  end\nend\nhoge.piyo # => NameError: undefined local variable or method `message' for \"hoge\":String\n\n\u30af\u30e9\u30b9\u540d\u306f\u305f\u3060\u306e\u5b9a\u6570\u306a\u306e\u3067\u3001singleton_class \u3092\u5b9a\u6570\u306b\u4ee3\u5165\u3059\u308c\u3070 class \u5b9a\u7fa9\u6587\u3067\u3082\u30aa\u30fc\u30d7\u30f3\u3067\u304d\u307e\u3059\u3002class << object \u69cb\u6587\u3068\u540c\u3058\u610f\u5473\u306b\u306a\u308a\u307e\u3059\u3002\nhoge = \"hoge\"\nHogeSingletonClass = hoge.singleton_class\nclass HogeSingletonClass\n  def piyo\n    \"piyo\"\n  end\nend\nhoge.piyo # => \"piyo\"\n\n\n\u53c2\u8003\n\nA Closure Is Not Always A Closure In Ruby\nMetaprogramming in Ruby: It\u2019s All About the Self\n\n\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u5f37\u529b\u306a Ruby \u3067\u306f\u3001\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3068\u3044\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56fa\u6709\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u305d\u306e\u5834\u3067\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```rb\nhoge = \"hoge\"\ndef hoge.piyo\n  \"piyo\"\nend\nhoge.piyo # => \"piyo\"\n```\n\n`def hoge.piyo` \u306e\u5185\u5074\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b9\u30b3\u30fc\u30d7\u306e\u305f\u3081\u3001\u5b9a\u7fa9\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3084\u30e1\u30bd\u30c3\u30c9\u306f\u53c2\u7167\u3067\u304d\u307e\u305b\u3093\u3002\n\n```rb\nhoge = \"hoge\"\nmessage = \"piyo\"\ndef hoge.piyo\n  message\nend\nhoge.piyo # => NameError: undefined local variable or method `message' for \"fuga\":String\n```\n\n\u306a\u3093\u3068\u304b\u3057\u3066\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3084\u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3057\u305f\u3044\u3067\u3059\u3002\n\n# \u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\n\n[Object#define_singleton_method](http://apidock.com/ruby/Object/define_singleton_method) \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u5b9a\u7fa9\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u3092\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u304b\u3089\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```rb\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.define_singleton_method(:piyo) do\n  message\nend\nhoge.piyo # => \"piyo\"\n```\n\nRuby \u306e\u30d6\u30ed\u30c3\u30af\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u3059\u3002`define_singleton_method` \u306b\u6e21\u3057\u305f\u30d6\u30ed\u30c3\u30af\u5185\u3067\u306f\u3001\u5b9a\u7fa9\u6642\u306e\u30b9\u30b3\u30fc\u30d7\u304c\u5f15\u304d\u7d99\u304c\u308c\u3066\u304a\u308a\u3001`message` \u3092\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\n# \u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3059\u308b\n\n\u30e1\u30bd\u30c3\u30c9\u3092\u53c2\u7167\u3059\u308b\u5834\u5408\u3001\u540c\u3058\u3088\u3046\u306b `define_singleton_method` \u3092\u4f7f\u3046\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3002\n\n```rb\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    obj.define_singleton_method(:piyo) do\n      message\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => NameError: undefined local variable or method `message' for \"hoge\":String\n```\n\n`define_singleton_method` \u306b\u6e21\u3057\u305f\u30d6\u30ed\u30c3\u30af\u306f\u3001**`self` \u304c `define_singleton_method` \u306e\u30ec\u30b7\u30fc\u30d0\u3059\u306a\u308f\u3061 `hoge` \u306e\u72b6\u614b\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059**\u3002\n\u305d\u306e\u305f\u3081\u3001`message` \u306f `hoge.message` \u3068\u89e3\u91c8\u3055\u308c\u3001\u30a8\u30e9\u30fc\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u89e3\u6c7a\u65b9\u6cd5\u306f\u3044\u308d\u3044\u308d\u3042\u308a\u307e\u3059\u3002\n\n## a. self \u3092\u9000\u907f\u3059\u308b\n\n```rb\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    self_orig = self\n    obj.define_singleton_method(:piyo) do\n      self_orig.message\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n```\n\nself \u3092\u9069\u5f53\u306a\u5909\u6570\u306b\u907f\u3051\u3066\u304a\u3051\u3070\u3001\u5b9a\u7fa9\u6642\u306e self \u3092\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\n## b. Method \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u56fa\u3081\u308b\n\n```rb\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    message_method = method(:message)\n    obj.define_singleton_method(:piyo) do\n      message_method.call\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n```\n\nMethod \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u30ec\u30b7\u30fc\u30d0\u304c `self` \u306b\u4f9d\u5b58\u3057\u306a\u3044\u306e\u3067\u3001\u3075\u3064\u3046\u306b\u547c\u3079\u307e\u3059\u3002\n\n## c. \u5b9f\u884c\u7d50\u679c\u3092\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306b\u5165\u308c\u3066\u304a\u304f\n\n```rb\nclass Piyo\n  def message\n    \"piyo\"\n  end\n\n  def def_piyo(obj)\n    message_value = message\n    obj.define_singleton_method(:piyo) do\n      message_value\n    end\n  end\nend\n\nhoge = \"hoge\"\nPiyo.new.def_piyo(hoge)\nhoge.piyo # => \"piyo\"\n```\n\n\u4e00\u756a\u30e9\u30af\u306a\u65b9\u6cd5\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001`message` \u30e1\u30bd\u30c3\u30c9\u304c `def_piyo` \u5b9f\u884c\u6642\u306b\u547c\u3070\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u90fd\u5408\u304c\u60aa\u3044\u5834\u5408\u3082\u591a\u305d\u3046\u3002\n\n**\u30d6\u30ed\u30c3\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u3068\u304d\u306b\u3001`self` \u304c\u7f6e\u304d\u63db\u3048\u3089\u308c\u308b** \u3068\u3044\u3046\u8003\u3048\u65b9\u306f\u76f4\u611f\u7684\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u3068 ***_eval \u7cfb\u3067\u3082\u30cf\u30de\u308b\u3053\u3068\u304c\u5c11\u306a\u304f\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# (\u304a\u307e\u3051) \u7279\u7570\u30af\u30e9\u30b9\n\n[Object#singleton_class](http://apidock.com/ruby/Object/singleton_class) \u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30af\u30e9\u30b9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u7279\u7570\u30af\u30e9\u30b9\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3092\u4fdd\u6709\u3059\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\n```rb\nhoge = \"hoge\"\ndef hoge.piyo\n  \"piyo\"\nend\nhoge.singleton_class # => #<Class:#<String:xxx>>\nhoge.singleton_class.instance_methods - String.instance_methods # => [:piyo]\n```\n\n\u4e0a\u4f8b\u3067\u306f\u3001`hoge.singleton_class` \u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066 piyo \u3092\u6301\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7279\u7570\u30af\u30e9\u30b9\u3067 `def` \u3084 `define_method` \u3059\u308b\u3053\u3068\u3067\u3001\u7279\u7570\u30e1\u30bd\u30c3\u30c9\u3092\u751f\u3084\u305b\u307e\u3059\u3002\n\n```rb\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.singleton_class.class_eval do\n  define_method(:piyo) do\n    message\n  end\nend\nhoge.piyo # => \"piyo\"\n```\n\n\u305f\u3060\u3057\u3001`def` \u3060\u3068\u30b9\u30b3\u30fc\u30d7\u304c\u5909\u308f\u308b\u306e\u3067\u30ed\u30fc\u30ab\u30eb\u5909\u6570\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\n```rb\nhoge = \"hoge\"\nmessage = \"piyo\"\nhoge.singleton_class.class_eval do\n  def piyo\n    message\n  end\nend\nhoge.piyo # => NameError: undefined local variable or method `message' for \"hoge\":String\n```\n\n\u30af\u30e9\u30b9\u540d\u306f\u305f\u3060\u306e\u5b9a\u6570\u306a\u306e\u3067\u3001`singleton_class` \u3092\u5b9a\u6570\u306b\u4ee3\u5165\u3059\u308c\u3070 `class` \u5b9a\u7fa9\u6587\u3067\u3082\u30aa\u30fc\u30d7\u30f3\u3067\u304d\u307e\u3059\u3002`class << object` \u69cb\u6587\u3068\u540c\u3058\u610f\u5473\u306b\u306a\u308a\u307e\u3059\u3002\n\n```rb\nhoge = \"hoge\"\nHogeSingletonClass = hoge.singleton_class\nclass HogeSingletonClass\n  def piyo\n    \"piyo\"\n  end\nend\nhoge.piyo # => \"piyo\"\n```\n\n# \u53c2\u8003\n\n- [A Closure Is Not Always A Closure In Ruby](http://www.skorks.com/2013/03/a-closure-is-not-always-a-closure-in-ruby/)\n- [Metaprogramming in Ruby: It\u2019s All About the Self](http://yehudakatz.com/2009/11/15/metaprogramming-in-ruby-its-all-about-the-self/)\n", "tags": ["Ruby", "\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0"]}