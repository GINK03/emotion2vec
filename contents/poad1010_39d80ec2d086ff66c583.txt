{"context": " More than 1 year has passed since last update.jMockit\u306eDynamic partial mocking\u3092\u4f7f\u3063\u3066\u3044\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092EclEMMA\u3067\u52d5\u304b\u3059\u3068\u3001IllegalClassFormatException\u304c\u767a\u751f\u3059\u308b\u3002\n\u74b0\u5883\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\n\n\n\nF/W\u306a\u3069\nver\n\n\n\n\njMockit\n1.0\n\n\nEclEMMA\n2.2.0.201210261515\n\n\nTestNG\n6.8\n\n\nJava\nOracle JDK SE 7u15(JDK6\u3067\u3082\u540c\u69d8)\n\n\n\n\nTestTarget.java\npackage tv.dyndns.poad;\n\n/**\n * \u30c6\u30b9\u30c8\u5bfe\u8c61\n */\npublic class TestTarget {\n\n    public long targetMethod() {\n        long val = Singleton.StaticMethod();\n        System.out.println(val);\n        return val;\n    }\n}\n\n\n\nSingleton.java\n/**\n * \n */\npackage tv.dyndns.poad;\n\n/**\n * @author PoaD\n * \n */\npublic class Singleton {\n\n    public static long StaticMethod() {\n        return System.currentTimeMillis();\n    }\n\n}\n\n\n\nSample_test.java\npackage tv.dyndns.poad;\n\nimport junit.framework.Assert;\nimport mockit.NonStrictExpectations;\n\nimport org.testng.annotations.Test;\n\n/**\n * Test\u30af\u30e9\u30b9\n */\npublic class Sample_test {\n\n    private final TestTarget target = new TestTarget();\n\n    @Test\n    public void err() {\n\n        // IllegalClassFormatException\u304cthrow\u3055\u308c\u308b\n        new NonStrictExpectations(Singleton.class) {\n            {\n                Singleton.StaticMethod();\n                result = 0L;\n            }\n        };\n        Assert.assertEquals(target.targetMethod(), 0L);\n    }\n}\n\n\n\u30ed\u30b0\njava.lang.instrument.IllegalClassFormatException: Error while instrumenting class tv/dyndns/poad/Singleton.\n    at org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:91)\n    at sun.instrument.TransformerManager.transform(TransformerManager.java:188)\n    at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)\n    at sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)\n    at sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)\n    at mockit.internal.startup.Startup.redefineMethods(Startup.java:184)\n    at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:63)\n    at mockit.internal.expectations.mocking.DynamicPartialMocking.redefineTypes(DynamicPartialMocking.java:34)\n    at mockit.internal.expectations.RecordAndReplayExecution.applyDynamicPartialMocking(RecordAndReplayExecution.java:186)\n    at mockit.internal.expectations.RecordAndReplayExecution.(RecordAndReplayExecution.java:107)\n    at mockit.Expectations.(Expectations.java:190)\n    at mockit.NonStrictExpectations.(NonStrictExpectations.java:49)\n    at tv.dyndns.poad.Sample_test$1.(Sample_test.java:20)\n    at tv.dyndns.poad.Sample_test.err(Sample_test.java:20)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:601)\n    at org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:80)\n    at org.testng.internal.Invoker.invokeMethod(Invoker.java:714)\n    at org.testng.internal.Invoker.invokeTestMethod(Invoker.java:901)\n    at org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1231)\n    at org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:128)\n    at org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:111)\n    at org.testng.TestRunner.privateRun(TestRunner.java:767)\n    at org.testng.TestRunner.run(TestRunner.java:617)\n    at org.testng.SuiteRunner.runTest(SuiteRunner.java:334)\n    at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329)\n    at org.testng.SuiteRunner.privateRun(SuiteRunner.java:291)\n    at org.testng.SuiteRunner.run(SuiteRunner.java:240)\n    at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n    at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n    at org.testng.TestNG.runSuitesSequentially(TestNG.java:1203)\n    at org.testng.TestNG.runSuitesLocally(TestNG.java:1128)\n    at org.testng.TestNG.run(TestNG.java:1036)\n    at org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:111)\n    at org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:204)\n    at org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:175)\nCaused by: java.lang.IllegalStateException: Class tv/dyndns/poad/Singleton is already instrumented.\n    at org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.assertNotInstrumented(ClassInstrumenter.java:133)\n    at org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.visitField(ClassInstrumenter.java:81)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassVisitor.visitField(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:69)\n    at org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:82)\n    at org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:89)\n    ... 37 more\njava.lang.instrument.IllegalClassFormatException: Error while instrumenting class tv/dyndns/poad/Singleton.\n    at org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:91)\n    at sun.instrument.TransformerManager.transform(TransformerManager.java:188)\n    at sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)\n    at sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)\n    at sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)\n    at mockit.internal.startup.Startup.redefineMethods(Startup.java:184)\n    at mockit.internal.startup.Startup.redefineMethods(Startup.java:176)\n    at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:47)\n    at mockit.internal.RedefinitionEngine.restoreOriginalDefinition(RedefinitionEngine.java:81)\n    at mockit.internal.RedefinitionEngine.restoreDefinition(RedefinitionEngine.java:69)\n    at mockit.internal.state.MockFixture.restoreRedefinedClasses(MockFixture.java:209)\n    at mockit.internal.state.SavePoint.rollback(SavePoint.java:45)\n    at mockit.integration.internal.TestRunnerDecorator.concludeTestMethodExecution(TestRunnerDecorator.java:177)\n    at mockit.integration.testng.internal.TestNGRunnerDecorator.concludeTestExecutionWithNothingThrown(TestNGRunnerDecorator.java:212)\n    at mockit.integration.testng.internal.TestNGRunnerDecorator.afterInvocation(TestNGRunnerDecorator.java:171)\n    at org.testng.internal.invokers.InvokedMethodListenerInvoker$InvokeAfterInvocationWithoutContextStrategy.callMethod(InvokedMethodListenerInvoker.java:100)\n    at org.testng.internal.invokers.InvokedMethodListenerInvoker.invokeListener(InvokedMethodListenerInvoker.java:62)\n    at org.testng.internal.Invoker.runInvokedMethodListeners(Invoker.java:619)\n    at org.testng.internal.Invoker.invokeMethod(Invoker.java:777)\n    at org.testng.internal.Invoker.invokeTestMethod(Invoker.java:901)\n    at org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1231)\n    at org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:128)\n    at org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:111)\n    at org.testng.TestRunner.privateRun(TestRunner.java:767)\n    at org.testng.TestRunner.run(TestRunner.java:617)\n    at org.testng.SuiteRunner.runTest(SuiteRunner.java:334)\n    at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329)\n    at org.testng.SuiteRunner.privateRun(SuiteRunner.java:291)\n    at org.testng.SuiteRunner.run(SuiteRunner.java:240)\n    at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n    at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n    at org.testng.TestNG.runSuitesSequentially(TestNG.java:1203)\n    at org.testng.TestNG.runSuitesLocally(TestNG.java:1128)\n    at org.testng.TestNG.run(TestNG.java:1036)\n    at org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:111)\n    at org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:204)\n    at org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:175)\nCaused by: java.lang.IllegalStateException: Class tv/dyndns/poad/Singleton is already instrumented.\n    at org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.assertNotInstrumented(ClassInstrumenter.java:133)\n    at org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.visitField(ClassInstrumenter.java:81)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassVisitor.visitField(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n    at org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:69)\n    at org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:82)\n    at org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:89)\n    ... 36 more\n(\u4ee5\u4e0b\u7565)\njMockit\u306eDynamic partial mocking\u3092\u4f7f\u3063\u3066\u3044\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092EclEMMA\u3067\u52d5\u304b\u3059\u3068\u3001IllegalClassFormatException\u304c\u767a\u751f\u3059\u308b\u3002\n\n\u74b0\u5883\u306f\u3001\u4ee5\u4e0b\u306e\u3068\u304a\u308a\n\n| F/W\u306a\u3069 | ver |\n|:-------:|:---:|\n| jMockit | 1.0 |\n| EclEMMA | 2.2.0.201210261515 |\n| TestNG | 6.8 |\n| Java | Oracle JDK SE 7u15(JDK6\u3067\u3082\u540c\u69d8) |\n\n```java:TestTarget.java\npackage tv.dyndns.poad;\n\n/**\n * \u30c6\u30b9\u30c8\u5bfe\u8c61\n */\npublic class TestTarget {\n    \n    public long targetMethod() {\n        long val = Singleton.StaticMethod();\n        System.out.println(val);\n        return val;\n    }\n}\n```\n```java:Singleton.java\n/**\n * \n */\npackage tv.dyndns.poad;\n\n/**\n * @author PoaD\n * \n */\npublic class Singleton {\n    \n    public static long StaticMethod() {\n        return System.currentTimeMillis();\n    }\n    \n}\n```\n\n```java:Sample_test.java\npackage tv.dyndns.poad;\n\nimport junit.framework.Assert;\nimport mockit.NonStrictExpectations;\n\nimport org.testng.annotations.Test;\n\n/**\n * Test\u30af\u30e9\u30b9\n */\npublic class Sample_test {\n    \n    private final TestTarget target = new TestTarget();\n    \n    @Test\n    public void err() {\n        \n        // IllegalClassFormatException\u304cthrow\u3055\u308c\u308b\n        new NonStrictExpectations(Singleton.class) {\n            {\n                Singleton.StaticMethod();\n                result = 0L;\n            }\n        };\n        Assert.assertEquals(target.targetMethod(), 0L);\n    }\n}\n```\n\n\u30ed\u30b0\njava.lang.instrument.IllegalClassFormatException: Error while instrumenting class tv/dyndns/poad/Singleton.\n\tat org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:91)\n\tat sun.instrument.TransformerManager.transform(TransformerManager.java:188)\n\tat sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)\n\tat sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)\n\tat sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)\n\tat mockit.internal.startup.Startup.redefineMethods(Startup.java:184)\n\tat mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:63)\n\tat mockit.internal.expectations.mocking.DynamicPartialMocking.redefineTypes(DynamicPartialMocking.java:34)\n\tat mockit.internal.expectations.RecordAndReplayExecution.applyDynamicPartialMocking(RecordAndReplayExecution.java:186)\n\tat mockit.internal.expectations.RecordAndReplayExecution.<init>(RecordAndReplayExecution.java:107)\n\tat mockit.Expectations.<init>(Expectations.java:190)\n\tat mockit.NonStrictExpectations.<init>(NonStrictExpectations.java:49)\n\tat tv.dyndns.poad.Sample_test$1.<init>(Sample_test.java:20)\n\tat tv.dyndns.poad.Sample_test.err(Sample_test.java:20)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:80)\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:714)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:901)\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1231)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:128)\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:111)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:767)\n\tat org.testng.TestRunner.run(TestRunner.java:617)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:334)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:291)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:240)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1203)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1128)\n\tat org.testng.TestNG.run(TestNG.java:1036)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:111)\n\tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:204)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:175)\nCaused by: java.lang.IllegalStateException: Class tv/dyndns/poad/Singleton is already instrumented.\n\tat org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.assertNotInstrumented(ClassInstrumenter.java:133)\n\tat org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.visitField(ClassInstrumenter.java:81)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassVisitor.visitField(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:69)\n\tat org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:82)\n\tat org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:89)\n\t... 37 more\njava.lang.instrument.IllegalClassFormatException: Error while instrumenting class tv/dyndns/poad/Singleton.\n\tat org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:91)\n\tat sun.instrument.TransformerManager.transform(TransformerManager.java:188)\n\tat sun.instrument.InstrumentationImpl.transform(InstrumentationImpl.java:424)\n\tat sun.instrument.InstrumentationImpl.redefineClasses0(Native Method)\n\tat sun.instrument.InstrumentationImpl.redefineClasses(InstrumentationImpl.java:170)\n\tat mockit.internal.startup.Startup.redefineMethods(Startup.java:184)\n\tat mockit.internal.startup.Startup.redefineMethods(Startup.java:176)\n\tat mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:47)\n\tat mockit.internal.RedefinitionEngine.restoreOriginalDefinition(RedefinitionEngine.java:81)\n\tat mockit.internal.RedefinitionEngine.restoreDefinition(RedefinitionEngine.java:69)\n\tat mockit.internal.state.MockFixture.restoreRedefinedClasses(MockFixture.java:209)\n\tat mockit.internal.state.SavePoint.rollback(SavePoint.java:45)\n\tat mockit.integration.internal.TestRunnerDecorator.concludeTestMethodExecution(TestRunnerDecorator.java:177)\n\tat mockit.integration.testng.internal.TestNGRunnerDecorator.concludeTestExecutionWithNothingThrown(TestNGRunnerDecorator.java:212)\n\tat mockit.integration.testng.internal.TestNGRunnerDecorator.afterInvocation(TestNGRunnerDecorator.java:171)\n\tat org.testng.internal.invokers.InvokedMethodListenerInvoker$InvokeAfterInvocationWithoutContextStrategy.callMethod(InvokedMethodListenerInvoker.java:100)\n\tat org.testng.internal.invokers.InvokedMethodListenerInvoker.invokeListener(InvokedMethodListenerInvoker.java:62)\n\tat org.testng.internal.Invoker.runInvokedMethodListeners(Invoker.java:619)\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:777)\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:901)\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1231)\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:128)\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:111)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:767)\n\tat org.testng.TestRunner.run(TestRunner.java:617)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:334)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:329)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:291)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:240)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1203)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1128)\n\tat org.testng.TestNG.run(TestNG.java:1036)\n\tat org.testng.remote.RemoteTestNG.run(RemoteTestNG.java:111)\n\tat org.testng.remote.RemoteTestNG.initAndRun(RemoteTestNG.java:204)\n\tat org.testng.remote.RemoteTestNG.main(RemoteTestNG.java:175)\nCaused by: java.lang.IllegalStateException: Class tv/dyndns/poad/Singleton is already instrumented.\n\tat org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.assertNotInstrumented(ClassInstrumenter.java:133)\n\tat org.jacoco.agent.rt_kqcpih.core.internal.instr.ClassInstrumenter.visitField(ClassInstrumenter.java:81)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassVisitor.visitField(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.asm.ClassReader.accept(Unknown Source)\n\tat org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:69)\n\tat org.jacoco.agent.rt_kqcpih.core.instr.Instrumenter.instrument(Instrumenter.java:82)\n\tat org.jacoco.agent.rt_kqcpih.CoverageTransformer.transform(CoverageTransformer.java:89)\n\t... 36 more\n(\u4ee5\u4e0b\u7565)\n\n", "tags": ["Java", "jMockit1.0", "EclEMMA2.2.0.201210261515", "TestNG6.8"]}