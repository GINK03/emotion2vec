{"tags": ["ElasticBeanstalk", "bundler"], "context": " More than 1 year has passed since last update.\u4eca\u65e5eb\u306bdeploy\u3092\u5b9f\u65bd\u3057\u305f\u3068\u3053\u308d\u3001\u5927\u3057\u305f\u4fee\u6b63\u3067\u3082\u7121\u3044\u306e\u306bdeploy\u304c\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\ndeploy\u306b\u5931\u6557\u3059\u308b\u3068\u305d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fshutdown\u3055\u308c\u3066\u65b0\u305f\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cspawn\u3055\u308c\u308b\u305f\u3081\u539f\u56e0\u3092\u63a2\u308b\u306e\u306b\u4e00\u82e6\u52b4\u3057\u305f\u3002\n\u30ed\u30b0\u3092tail\u3067\u8ffd\u3063\u3066\u3044\u304f\u3068 /opt/elasticbeanstalk/hooks/appdeploy/pre/13_test_for_puma.sh \u3067\u56fa\u307e\u3063\u3066\u3044\u308b\u3002\n\u66f4\u306b\u8ffd\u3063\u3066\u3044\u304f\u3068 13_test_for_puma.sh \u304b\u3089\u547c\u3093\u3067\u3044\u308b /opt/elasticbeanstalk/support/scripts/check-for-gem.rb \u3067\u8a70\u307e\u3063\u3066\u3044\u305f\u3002\n#!/usr/bin/env /opt/rubies/ruby-current/bin/ruby\n#==============================================================================\n# Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n#\n# Licensed under the Amazon Software License (the \"License\"). You may not use\n# this file except in compliance with the License. A copy of the License is\n# located at\n#\n#       https://aws.amazon.com/asl/\n#\n# or in the \"license\" file accompanying this file. This file is distributed on\n# an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n# implied. See the License for the specific language governing permissions\n# and limitations under the License.\n#==============================================================================\nrequire 'bundler'\n\nDir.chdir '/var/app/ondeck'\ngroups = Bundler.definition.groups\n\nbegin\n    Bundler.definition.resolve_with_cache!\nrescue Bundler::GemNotFound\n    Bundler.definition(true).resolve_remotely!\nend\n\ngems = Bundler.definition.specs_for(groups).collect(&:name)\nexit 0 if gems.include? ARGV[0]\nexit 1\n\n\u3053\u3044\u3064\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001 Bundler.definition(true).resolve_remotely! \u3067\u56fa\u307e\u3063\u3066\u3044\u305f\u3002\nBundler.definition(true).resolve_remotely! \u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u3092\u8abf\u3079\u308c\u3066\u306f\u7121\u3044\u3051\u3069\u3001timeout\u3092\u5165\u308c\u3066\u56de\u907f\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f(\u3053\u306e\u5bfe\u5fdc\u3067\u5927\u4e08\u592b\u306a\u306e\u304b\u3088\u308adeploy\u304c\u901a\u308b\u3053\u3068\u3092\u512a\u5148)\u3002\n.ebextensions/xxx.config \u3067 check-for-gem.rb \u3092\u4e0a\u66f8\u304d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u5bfe\u5fdc\u3002\nfiles:\n  \"/opt/elasticbeanstalk/support/scripts/check-for-gem.rb\":\n    mode: \"000755\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      #!/usr/bin/env /opt/rubies/ruby-current/bin/ruby\n      require 'bundler'\n      require 'timeout'\n\n      Dir.chdir '/var/app/ondeck'\n      groups = Bundler.definition.groups\n\n      begin\n          Bundler.definition.resolve_with_cache!\n      rescue Bundler::GemNotFound\n          begin\n              timeout(5) do\n                  Bundler.definition(true).resolve_remotely!\n              end\n          rescue Timeout::Error\n              puts $!\n          end\n      end\n\n      gems = Bundler.definition.specs_for(groups).collect(&:name)\n      exit 0 if gems.include? ARGV[0]\n      exit 1\n\ndeploy\u306f\u901a\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u539f\u56e0\u7a76\u660e\u3057\u3066\u3001\u305d\u306e\u3046\u3061\u8ffd\u8a18\u3059\u308b\u3002\n\u4eca\u65e5eb\u306bdeploy\u3092\u5b9f\u65bd\u3057\u305f\u3068\u3053\u308d\u3001\u5927\u3057\u305f\u4fee\u6b63\u3067\u3082\u7121\u3044\u306e\u306bdeploy\u304c\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\ndeploy\u306b\u5931\u6557\u3059\u308b\u3068\u305d\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fshutdown\u3055\u308c\u3066\u65b0\u305f\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cspawn\u3055\u308c\u308b\u305f\u3081\u539f\u56e0\u3092\u63a2\u308b\u306e\u306b\u4e00\u82e6\u52b4\u3057\u305f\u3002\n\u30ed\u30b0\u3092tail\u3067\u8ffd\u3063\u3066\u3044\u304f\u3068 `/opt/elasticbeanstalk/hooks/appdeploy/pre/13_test_for_puma.sh` \u3067\u56fa\u307e\u3063\u3066\u3044\u308b\u3002\n\u66f4\u306b\u8ffd\u3063\u3066\u3044\u304f\u3068 `13_test_for_puma.sh` \u304b\u3089\u547c\u3093\u3067\u3044\u308b `/opt/elasticbeanstalk/support/scripts/check-for-gem.rb` \u3067\u8a70\u307e\u3063\u3066\u3044\u305f\u3002\n\n```rb\n#!/usr/bin/env /opt/rubies/ruby-current/bin/ruby\n#==============================================================================\n# Copyright 2014 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n#\n# Licensed under the Amazon Software License (the \"License\"). You may not use\n# this file except in compliance with the License. A copy of the License is\n# located at\n#\n#       https://aws.amazon.com/asl/\n#\n# or in the \"license\" file accompanying this file. This file is distributed on\n# an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, express or\n# implied. See the License for the specific language governing permissions\n# and limitations under the License.\n#==============================================================================\nrequire 'bundler'\n\nDir.chdir '/var/app/ondeck'\ngroups = Bundler.definition.groups\n\nbegin\n    Bundler.definition.resolve_with_cache!\nrescue Bundler::GemNotFound\n    Bundler.definition(true).resolve_remotely!\nend\n\ngems = Bundler.definition.specs_for(groups).collect(&:name)\nexit 0 if gems.include? ARGV[0]\nexit 1\n```\n\n\u3053\u3044\u3064\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001 `Bundler.definition(true).resolve_remotely!` \u3067\u56fa\u307e\u3063\u3066\u3044\u305f\u3002\n`Bundler.definition(true).resolve_remotely!` \u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u3092\u8abf\u3079\u308c\u3066\u306f\u7121\u3044\u3051\u3069\u3001timeout\u3092\u5165\u308c\u3066\u56de\u907f\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f(\u3053\u306e\u5bfe\u5fdc\u3067\u5927\u4e08\u592b\u306a\u306e\u304b\u3088\u308adeploy\u304c\u901a\u308b\u3053\u3068\u3092\u512a\u5148)\u3002\n\n`.ebextensions/xxx.config` \u3067 `check-for-gem.rb` \u3092\u4e0a\u66f8\u304d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u5bfe\u5fdc\u3002\n\n```yaml\nfiles:\n  \"/opt/elasticbeanstalk/support/scripts/check-for-gem.rb\":\n    mode: \"000755\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      #!/usr/bin/env /opt/rubies/ruby-current/bin/ruby\n      require 'bundler'\n      require 'timeout'\n\n      Dir.chdir '/var/app/ondeck'\n      groups = Bundler.definition.groups\n\n      begin\n          Bundler.definition.resolve_with_cache!\n      rescue Bundler::GemNotFound\n          begin\n              timeout(5) do\n                  Bundler.definition(true).resolve_remotely!\n              end\n          rescue Timeout::Error\n              puts $!\n          end\n      end\n\n      gems = Bundler.definition.specs_for(groups).collect(&:name)\n      exit 0 if gems.include? ARGV[0]\n      exit 1\n```\n\ndeploy\u306f\u901a\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u539f\u56e0\u7a76\u660e\u3057\u3066\u3001\u305d\u306e\u3046\u3061\u8ffd\u8a18\u3059\u308b\u3002\n"}