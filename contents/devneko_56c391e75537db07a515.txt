{"tags": ["MySQL", "\u30d9\u30f3\u30c1\u30de\u30fc\u30af"], "context": " More than 1 year has passed since last update.\u306a\u3093\u3068\u306a\u304f\u601d\u3044\u7acb\u3063\u3066\uff11\u5104\u30ec\u30b3\u30fc\u30c9\u306e\u30c6\u30fc\u30d6\u30eb\u3063\u3066\u3069\u308c\u304f\u3089\u3044\u91cd\u3044\u306e\u304b\u8abf\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u74b0\u5883\n\u30de\u30b7\u30f3\uff1a AWS EC2 c4.2xlarge(8vCPU, 32GB\u30e1\u30e2\u30ea)\nDB: MySQL5.6\n\u30c7\u30a3\u30b9\u30af: EBS 1000GB SSD 3000IOPS\nDB\u306f\u4e00\u5207\u8a2d\u5b9a\u306e\u5909\u66f4\u306a\u3057\u3002\n\u30c6\u30fc\u30d6\u30eb(\u30ed\u30b0\u30c7\u30fc\u30bf\u7684\u306a\u3082\u306e\u3092\u30a4\u30e1\u30fc\u30b8)\n CREATE TABLE `logs` (\n  `time` int(11) NOT NULL,\n  `arg1` int(11) NOT NULL,\n  `arg2` int(11) NOT NULL,\n  `arg3` varchar(255) NOT NULL,\n  `arg4` varchar(255) NOT NULL,\n  `arg5` varchar(255) NOT NULL,\n  KEY `idx_time` (`time`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1 \n\n\n\u5b9f\u884c\u7d50\u679c\n\nCOUNT(*)\n\nSQL\nmysql> select count(*) from logs;\n+-----------+\n| count(*)  |\n+-----------+\n| 100000000 |\n+-----------+\n1 row in set (32.96 sec)\n\n\n\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n02:59:XX PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n02:59:08 PM     all     10.26      0.00      3.25      0.00      0.00     86.48\n02:59:09 PM     all     10.89      0.00      2.50      0.00      0.00     86.61\n02:59:10 PM     all     10.50      0.00      3.00      0.00      0.00     86.50\n02:59:11 PM     all     10.39      0.00      3.00      0.00      0.00     86.61\n\n\nCOUNT(DISTINCT)\n\nSQL\nmysql> select count(distinct arg1) from logs;\n+----------------------+\n| count(distinct arg1) |\n+----------------------+\n|                  200 |\n+----------------------+\n1 row in set (1 min 21.48 sec)\n\n\n\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n03:03:XX PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n03:03:05 PM     all      6.80      0.00      1.39      6.05      0.13     85.64\n03:03:06 PM     all      6.57      0.00      1.39      5.94      0.00     86.09\n03:03:07 PM     all      7.18      0.00      1.13      6.05      0.00     85.64\n03:03:08 PM     all      7.59      0.00      0.76      5.94      0.00     85.71\n03:03:09 PM     all      6.49      0.00      0.89      6.11      0.00     86.51\n\uff5e (\u9014\u4e2d\u304b\u3089iowait\u304c\u843d\u3061\u7740\u3044\u3066CPU\u4f7f\u7528\u7387\u304c\u6319\u304c\u3063\u305f)\n03:04:03 PM     all     14.77      0.00      2.25      0.00      0.00     82.98\n03:04:04 PM     all     14.39      0.00      2.75      0.00      0.00     82.85\n03:04:05 PM     all     14.79      0.00      2.38      0.00      0.00     82.83\n03:04:06 PM     all     14.12      0.00      3.00      0.00      0.00     82.88\n03:04:07 PM     all     14.39      0.00      2.75      0.00      0.00     82.85\n03:04:08 PM     all     14.30      0.00      2.63      0.00      0.00     83.06\n\n\nGROUP BY\n\nSQL\nmysql> select arg1, count(*) from logs group by arg1;\n\uff08\u7d50\u679c\u7565\uff09\n200 rows in set (54.71 sec)\n\n\n\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n03:07:43 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n03:07:44 PM     all     14.91      0.00      1.63      0.00      0.00     83.46\n03:07:45 PM     all     14.62      0.00      2.00      0.00      0.00     83.38\n03:07:46 PM     all     14.02      0.00      2.50      0.00      0.00     83.48\n03:07:47 PM     all     14.27      0.00      2.25      0.00      0.00     83.48\n\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\n\nSQL\nselect COUNT(*) from logs where time between 1443622684 and 1443623684;\n+----------+\n| COUNT(*) |\n+----------+\n|   100100 |\n+----------+\n1 row in set (0.03 sec)\n\n\u3055\u3059\u304c\u306b1\u5104\u30ec\u30b3\u30fc\u30c9\u3067\u3082\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u8cbc\u3063\u3066\u308b\u3068\u65e9\u3044\u3067\u3059\u306d\u3002\n\u306a\u3093\u3068\u306a\u304f\u601d\u3044\u7acb\u3063\u3066\uff11\u5104\u30ec\u30b3\u30fc\u30c9\u306e\u30c6\u30fc\u30d6\u30eb\u3063\u3066\u3069\u308c\u304f\u3089\u3044\u91cd\u3044\u306e\u304b\u8abf\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n\n##\u74b0\u5883\n\u30de\u30b7\u30f3\uff1a AWS EC2 c4.2xlarge(8vCPU, 32GB\u30e1\u30e2\u30ea)\nDB: MySQL5.6\n\u30c7\u30a3\u30b9\u30af: EBS 1000GB SSD 3000IOPS\n\nDB\u306f\u4e00\u5207\u8a2d\u5b9a\u306e\u5909\u66f4\u306a\u3057\u3002\n\n\u30c6\u30fc\u30d6\u30eb(\u30ed\u30b0\u30c7\u30fc\u30bf\u7684\u306a\u3082\u306e\u3092\u30a4\u30e1\u30fc\u30b8)\n\n```sql                                                                                                      \n CREATE TABLE `logs` (\n  `time` int(11) NOT NULL,\n  `arg1` int(11) NOT NULL,\n  `arg2` int(11) NOT NULL,\n  `arg3` varchar(255) NOT NULL,\n  `arg4` varchar(255) NOT NULL,\n  `arg5` varchar(255) NOT NULL,\n  KEY `idx_time` (`time`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1 \n```\n\n##\u5b9f\u884c\u7d50\u679c\n\n###COUNT(*)\n\n####SQL\n```sql\nmysql> select count(*) from logs;\n+-----------+\n| count(*)  |\n+-----------+\n| 100000000 |\n+-----------+\n1 row in set (32.96 sec)\n```\n\n####\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n```bash\n02:59:XX PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n02:59:08 PM     all     10.26      0.00      3.25      0.00      0.00     86.48\n02:59:09 PM     all     10.89      0.00      2.50      0.00      0.00     86.61\n02:59:10 PM     all     10.50      0.00      3.00      0.00      0.00     86.50\n02:59:11 PM     all     10.39      0.00      3.00      0.00      0.00     86.61\n```\n\n###COUNT(DISTINCT)\n####SQL\n```sql\nmysql> select count(distinct arg1) from logs;\n+----------------------+\n| count(distinct arg1) |\n+----------------------+\n|                  200 |\n+----------------------+\n1 row in set (1 min 21.48 sec)\n```\n\n####\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n```bash\n03:03:XX PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n03:03:05 PM     all      6.80      0.00      1.39      6.05      0.13     85.64\n03:03:06 PM     all      6.57      0.00      1.39      5.94      0.00     86.09\n03:03:07 PM     all      7.18      0.00      1.13      6.05      0.00     85.64\n03:03:08 PM     all      7.59      0.00      0.76      5.94      0.00     85.71\n03:03:09 PM     all      6.49      0.00      0.89      6.11      0.00     86.51\n\uff5e (\u9014\u4e2d\u304b\u3089iowait\u304c\u843d\u3061\u7740\u3044\u3066CPU\u4f7f\u7528\u7387\u304c\u6319\u304c\u3063\u305f)\n03:04:03 PM     all     14.77      0.00      2.25      0.00      0.00     82.98\n03:04:04 PM     all     14.39      0.00      2.75      0.00      0.00     82.85\n03:04:05 PM     all     14.79      0.00      2.38      0.00      0.00     82.83\n03:04:06 PM     all     14.12      0.00      3.00      0.00      0.00     82.88\n03:04:07 PM     all     14.39      0.00      2.75      0.00      0.00     82.85\n03:04:08 PM     all     14.30      0.00      2.63      0.00      0.00     83.06\n```\n\n###GROUP BY\n\n####SQL\n```sql\nmysql> select arg1, count(*) from logs group by arg1;\n\uff08\u7d50\u679c\u7565\uff09\n200 rows in set (54.71 sec)\n```\n\n####\u5b9f\u884c\u4e2d\u306esar(\u4e00\u90e8)\n```bash\n03:07:43 PM     CPU     %user     %nice   %system   %iowait    %steal     %idle\n03:07:44 PM     all     14.91      0.00      1.63      0.00      0.00     83.46\n03:07:45 PM     all     14.62      0.00      2.00      0.00      0.00     83.38\n03:07:46 PM     all     14.02      0.00      2.50      0.00      0.00     83.48\n03:07:47 PM     all     14.27      0.00      2.25      0.00      0.00     83.48\n```\n\n###\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\n####SQL\n```sql\nselect COUNT(*) from logs where time between 1443622684 and 1443623684;\n+----------+\n| COUNT(*) |\n+----------+\n|   100100 |\n+----------+\n1 row in set (0.03 sec)\n```\n\u3055\u3059\u304c\u306b1\u5104\u30ec\u30b3\u30fc\u30c9\u3067\u3082\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u8cbc\u3063\u3066\u308b\u3068\u65e9\u3044\u3067\u3059\u306d\u3002\n"}