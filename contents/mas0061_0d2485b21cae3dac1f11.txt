{"context": " More than 1 year has passed since last update.WebSocket\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u6587\u5b57\u5217\u306e\u3084\u308a\u53d6\u308a\u304c\u3067\u304d\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3060\u3063\u305f\u306e\u3067\u3001Vert.x\u3092\u4f7f\u3063\u3066\u66f8\u3044\u3066\u307f\u305f\u3002\nGroovy\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306f\u3001Groovy\u304c\u597d\u304d\u306a\u306e\u3068\u3001\u30e9\u30af\u306b\u66f8\u304d\u305f\u304b\u3063\u305f\u306e\u3068\u3001\u3053\u308c\u3092\u767a\u5c55\u3055\u305b\u305f\u5148\u3067Java\u306eAPI\u3092\u547c\u3076\u5fc5\u8981\u304c\u3042\u3063\u305f\u304b\u3089\u3002\n\nGroovy\u3067\u66f8\u304fWebSocket\u30b5\u30fc\u30d0\u30fc\u5074\ndef wsMap = [:] as java.util.concurrent.ConcurrentHashMap\n\n// ws://localhost:8080/user_id \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082\u3089\u3046\u524d\u63d0\nvertx.createHttpServer().websocketHandler { ws ->\n  // URL\u304b\u3089\u30e6\u30fc\u30b6\u30fcID\u3092\u53d6\u5f97\n  def userId = ws.path.replaceAll(/^\\//, \"\") /// \u3053\u306e\u30b3\u30e1\u30f3\u30c8\u306fQiita\u3067\u306e\u89e3\u91c8\u304c\u304a\u304b\u3057\u304f\u306a\u308b\u306e\u3092\u9632\u3050\u305f\u3081\u2026\n  // \u30e6\u30fc\u30b6\u30fcID\u3068\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304d\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u4fdd\u6301\n  wsMap.put(userId, ws)\n\n  // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u9001\u4fe1\u3055\u308c\u3066\u304d\u305f\u6642\u306eHandler\n  ws.dataHandler { data ->\n    // \"\u9001\u4fe1\u5148\u30e6\u30fc\u30b6\u30fcID:\u30e1\u30c3\u30bb\u30fc\u30b8\" \u304c\u9001\u3089\u308c\u3066\u304f\u308b\u60f3\u5b9a\n    def (toId, msg) = data.toString().split(':')\n\n    if (wsMap.containsKey(toId)) {\n      // \u9001\u308a\u5148\u304c\u5b58\u5728\u3059\u308c\u3070\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\n      vertx.eventBus.send(wsMap[toId].textHandlerID, msg)\n    } else {\n      // \u9001\u308a\u5148\u304c\u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u9001\u308a\u4e3b\u306b\u8fd4\u3059\n      ws.writeTextFrame(\"sender don't find\")\n    }\n  }\n\n  // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u5207\u65ad\u3055\u308c\u305f\u6642\u306eHanlder\n  ws.closeHandler {\n    wsMap.remove(ws.textHandlerID)\n    println \"close : ${ws.textHandlerID}\"\n  }\n}.listen(8080, \"0.0.0.0\")  // \u30a2\u30c9\u30ec\u30b9\u3092localhost\u306b\u3059\u308b\u3068\u5916\u304b\u3089\u7e4b\u304c\u3089\u306a\u304f\u306a\u308b\n\n\nHTML + JavaScript\u3067\u66f8\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n<!DOCTYPE html>\n<html>\n<head>\n    <title>WebSocket trial</title>\n    <meta charset=\"UTF-8\">\n    <script src=\"http://code.jquery.com/jquery-1.11.1.min.js\"></script>\n</head>\n<body>\n    <input type=\"text\" id=\"user_id\">\n    <button id=\"openButton\">\u63a5\u7d9a</button>\n    <input type=\"text\" id=\"send_id\">\n    <input type=\"text\" id=\"message\">\n    <button id=\"sendButton\">\u9001\u4fe1</button>\n    <button id=\"closeButton\">\u5207\u65ad</button>\n    <div id=\"out_message\"></div>\n</body>\n<script>\n  var socket;\n\n  $(\"#openButton\").on('click', function() {\n    socket = new WebSocket(\"ws://localhost:8080/\" + $(\"#user_id\").val());\n\n    socket.onopen = function(event) {\n      console.log(\"Web Socket opened\");\n    };\n\n    socket.onmessage = function(event) {\n      console.log(\"Received data from websocket: \" + event.data);\n      $(\"#out_message\").html(\"Received data from websocket: \" + event.data);\n    }\n\n    socket.onclose = function(event) {\n      console.log(\"Web Socket closed\");\n    };\n  });\n\n  $(\"#sendButton\").on(\"click\", function(event) {\n    var user_id = $(\"#send_id\").val();\n    var message = $(\"#message\").val();\n    socket.send(user_id + \":\" + message);\n  });\n\n  $(\"#closeButton\").on(\"click\", function(event){\n    console.log(\"close button click\");\n    socket.close(1000, \"Close button clicked.\");\n  });\n</script>\n</html>\n\n\n\u53c2\u8003URL\nVert.x Groovy manual\nVert.x \u3067 WebSocket - \u306a\u3093\u3068\u306a\u304f\u306a Developer \u306e\u30e1\u30e2\nWebSocket\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u6587\u5b57\u5217\u306e\u3084\u308a\u53d6\u308a\u304c\u3067\u304d\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3060\u3063\u305f\u306e\u3067\u3001Vert.x\u3092\u4f7f\u3063\u3066\u66f8\u3044\u3066\u307f\u305f\u3002\n\nGroovy\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306f\u3001Groovy\u304c\u597d\u304d\u306a\u306e\u3068\u3001\u30e9\u30af\u306b\u66f8\u304d\u305f\u304b\u3063\u305f\u306e\u3068\u3001\u3053\u308c\u3092\u767a\u5c55\u3055\u305b\u305f\u5148\u3067Java\u306eAPI\u3092\u547c\u3076\u5fc5\u8981\u304c\u3042\u3063\u305f\u304b\u3089\u3002\n\n## Groovy\u3067\u66f8\u304fWebSocket\u30b5\u30fc\u30d0\u30fc\u5074\n```groovy\ndef wsMap = [:] as java.util.concurrent.ConcurrentHashMap\n\n// ws://localhost:8080/user_id \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082\u3089\u3046\u524d\u63d0\nvertx.createHttpServer().websocketHandler { ws ->\n  // URL\u304b\u3089\u30e6\u30fc\u30b6\u30fcID\u3092\u53d6\u5f97\n  def userId = ws.path.replaceAll(/^\\//, \"\") /// \u3053\u306e\u30b3\u30e1\u30f3\u30c8\u306fQiita\u3067\u306e\u89e3\u91c8\u304c\u304a\u304b\u3057\u304f\u306a\u308b\u306e\u3092\u9632\u3050\u305f\u3081\u2026\n  // \u30e6\u30fc\u30b6\u30fcID\u3068\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304d\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u4fdd\u6301\n  wsMap.put(userId, ws)\n\n  // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u9001\u4fe1\u3055\u308c\u3066\u304d\u305f\u6642\u306eHandler\n  ws.dataHandler { data ->\n    // \"\u9001\u4fe1\u5148\u30e6\u30fc\u30b6\u30fcID:\u30e1\u30c3\u30bb\u30fc\u30b8\" \u304c\u9001\u3089\u308c\u3066\u304f\u308b\u60f3\u5b9a\n    def (toId, msg) = data.toString().split(':')\n\n    if (wsMap.containsKey(toId)) {\n      // \u9001\u308a\u5148\u304c\u5b58\u5728\u3059\u308c\u3070\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\n      vertx.eventBus.send(wsMap[toId].textHandlerID, msg)\n    } else {\n      // \u9001\u308a\u5148\u304c\u5b58\u5728\u3057\u306a\u3051\u308c\u3070\u9001\u308a\u4e3b\u306b\u8fd4\u3059\n      ws.writeTextFrame(\"sender don't find\")\n    }\n  }\n\n  // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u5207\u65ad\u3055\u308c\u305f\u6642\u306eHanlder\n  ws.closeHandler {\n    wsMap.remove(ws.textHandlerID)\n    println \"close : ${ws.textHandlerID}\"\n  }\n}.listen(8080, \"0.0.0.0\")  // \u30a2\u30c9\u30ec\u30b9\u3092localhost\u306b\u3059\u308b\u3068\u5916\u304b\u3089\u7e4b\u304c\u3089\u306a\u304f\u306a\u308b\n```\n\n## HTML + JavaScript\u3067\u66f8\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n```html\n<!DOCTYPE html>\n<html>\n<head>\n\t<title>WebSocket trial</title>\n\t<meta charset=\"UTF-8\">\n\t<script src=\"http://code.jquery.com/jquery-1.11.1.min.js\"></script>\n</head>\n<body>\n\t<input type=\"text\" id=\"user_id\">\n\t<button id=\"openButton\">\u63a5\u7d9a</button>\n\t<input type=\"text\" id=\"send_id\">\n\t<input type=\"text\" id=\"message\">\n\t<button id=\"sendButton\">\u9001\u4fe1</button>\n\t<button id=\"closeButton\">\u5207\u65ad</button>\n\t<div id=\"out_message\"></div>\n</body>\n<script>\n  var socket;\n\n  $(\"#openButton\").on('click', function() {\n    socket = new WebSocket(\"ws://localhost:8080/\" + $(\"#user_id\").val());\n\n    socket.onopen = function(event) {\n      console.log(\"Web Socket opened\");\n    };\n\n    socket.onmessage = function(event) {\n      console.log(\"Received data from websocket: \" + event.data);\n      $(\"#out_message\").html(\"Received data from websocket: \" + event.data);\n    }\n\n    socket.onclose = function(event) {\n      console.log(\"Web Socket closed\");\n    };\n  });\n\n  $(\"#sendButton\").on(\"click\", function(event) {\n    var user_id = $(\"#send_id\").val();\n    var message = $(\"#message\").val();\n    socket.send(user_id + \":\" + message);\n  });\n\n  $(\"#closeButton\").on(\"click\", function(event){\n    console.log(\"close button click\");\n    socket.close(1000, \"Close button clicked.\");\n  });\n</script>\n</html>\n```\n\n## \u53c2\u8003URL\n[Vert.x Groovy manual](http://vertx.io/core_manual_groovy.html#websockets)\n[Vert.x \u3067 WebSocket - \u306a\u3093\u3068\u306a\u304f\u306a Developer \u306e\u30e1\u30e2](http://fits.hatenablog.com/entry/20130114/1358132572)\n", "tags": ["Vert.x", "Groovy"]}