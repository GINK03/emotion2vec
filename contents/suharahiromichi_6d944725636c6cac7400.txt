{"context": " More than 1 year has passed since last update.\n\nProlog\u306b\u3088\u308b\u3001\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306e\u578b\u691c\u67fb\u3068\u578b\u63a8\u8ad6\u306b\u3064\u3044\u3066\n\u672c\u30da\u30fc\u30b8\u306e\u5185\u5bb9\u306f\u3001\u52a0\u7b46\u8a02\u6b63\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n\u4ee5\u4e0b\u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306b\u5168\u79f0\u578b\u3092\u8ffd\u52a0\u3057\u305fSystem F\u306eProlog\u306b\u3088\u308b\u578b\u691c\u67fb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3001\nhttp://qiita.com/suharahiromichi/items/9adc16a40ecb1bc36825\n2014/05/02 @suharahiromichi\n\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306e\u578b\u691c\u67fb\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092Prolog\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\u305d\u306e\u3046\u3048\u3067\u3001\u540c\u3058\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u300cProlog\u306e\u53cc\u65b9\u5411\u6027\u300d\u306b\u3088\u3063\u3066\u3001\u578b\u63a8\u8ad6\u3082\u3067\u304d\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\u3053\u306e\u6587\u7ae0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\nhttps://github.com/suharahiromichi/prolog/blob/master/tapl/tapl_stlc_qiita.swi\n\u4f7f\u3044\u65b9\u306e\u4f8b\uff1a\n% swipl.\n?- ['tapl_stlc_qitta.swi'].\n?- go24.\n\nProlog\u51e6\u7406\u7cfb\u306fSWI-Prolog (5.10.4)\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u3044\u308b\u3002GNU Prolog\u3067\u306f\u672a\u78ba\u8a8d\u3067\u3042\u308b\u3002\n\u7701\u7565\u6642\u89e3\u91c8\uff08\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\uff09\u306e\u3068\u304a\u308a Occurs Check \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f off \u306e\u307e\u307e\u3068\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u9014\u4e2d\u306e1\u7b87\u6240\u306b\u304a\u3044\u3066\u3001unify_with_occurs_check\u8ff0\u8a9e\u3067\u3001Occurs Check \u4ed8\u304d\u306e\u4e00\u81f4\u5224\u5b9a\u300c=\u300d\u3092\u304a\u3053\u306a\u3046\u3002\u3053\u306e\u3053\u3068\u306f\u5f8c\u8ff0\u3059\u308b\u3002\n\n\u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5\u306b\u3064\u3044\u3066\n\u578b\u691c\u67fb\u306b\u306fde Bruijn Index (\u6ce81) \u3092\u4f7f\u7528\u3059\u308b\u304c\u3001\u308f\u304b\u308a\u3084\u3059\u3055\u304b\u3089\u3001\u4e00\u822c\u7684\u306a\u30e9\u30e0\u30c0\u5f0f\u3092de Bruijn Index\u306b\u5909\u63db\u3057\u3066\u4f7f\u3046\u3002\n\u307e\u305f\u3001\u3069\u3061\u3089\u306e\u5834\u5408\u3082\u3001Prolog\u3067\u6271\u3048\u308b\u524d\u7f6e\u8a18\u6cd5 f(x,g(y,z)) \u306e\u5f62\u5f0f\u3092\u4f7f\u7528\u3059\u308b\u3002\nde Bruijn Index \u306b\u5909\u63db\u3059\u308b\u30b3\u30fc\u30c9\u306f\u5f8c\u534a\u306b\u793a\u3059\u3002\n\n\u8a18\u6cd5\u306e\u4e00\u89a7\n  \u03bbx.y     tm_abs(x, y)       \u578b\u6ce8\u91c8\u306e\u306a\u3044\u03bb\u62bd\u8c61\n  \u03bbx:T.y   tm_abs(x:T, y)     \u578b\u6ce8\u91c8\u306e\u3042\u308b\u03bb\u62bd\u8c61 (\u300c:\u300d\u306f\u4e2d\u7f6e\u8a18\u6cd5)\n  f x      tm_app(f, x)       \u9069\u7528\n  x        tm_var(x)          \u5909\u6570\u306e\u53c2\u7167\n  t1->t2   t1->t2             \u95a2\u6570\u578b (\u4e2d\u7f6e\u8a18\u6cd5)\n  Bool     ty_bool            \u578b\u5b9a\u6570\n  True     tm_true            \u5b9a\u6570\n  False    tm_false           \u5b9a\u6570\n\n\n\u5909\u63db\u306e\u4f8b\n\n\u4e00\u822c\u7684\u306a\u8a18\u6cd5\n  \u03bba:Bool. \u03bb:b:Bool->Bool. b (b a)\n\n\n\u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5\ntm_abs(a:ty_Bool,\n  tm_abs(b:ty_Bool->ty_Bool,\n    tm_app(tm_var(b),\n           tm_app(tm_var(b), tm_var(a)))))\n\n\n\u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5(de Bruijn Index)\ntm_abs(ty_Bool,\n  tm_abs(ty_Bool->ty_Bool,\n    tm_app(tm_var(0),\n           tm_app(tm_var(0), tm_var(1)))))\n\n\u578b\u306e\u6ce8\u91c8\u3067\u4f7f\u3046\u300c:\u300d\u3068\u3001\u305d\u306e\u306a\u304b\u3067\u306e\u95a2\u6570\u578b\u3092\u793a\u3059\u300c->\u300d\u306f\u3001\u300c,\u300d\u3088\u308a\u512a\u5148\u5ea6\u304c\u9ad8\u3044\u3082\u306e\u3068\u3059\u308b\u3002\n\n:- op(600, xfx, :).                         % \u4f8b\u3001x : T\n:- op(500, xfy, ->).                        % \u4f8b\u3001Tx->Ty\n\n\n\n\n\u578b\u691c\u67fb\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\n\ntypeof\ntypeof/2\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u3092\u4ee5\u4e0b\u306b\u793a\u3059\u3002\u5f0f\u306fde Bruijn Index\u3067\u4e0e\u3048\u308b\u3002\u5f15\u6570\u306e\u524d\u306e\u300c+\u300d\u306f\u5165\u529b\u3001\u300c-\u300d\u306f\u51fa\u529b\u3001\u300c?\u300d\u306f\u305d\u306e\u3069\u3061\u3089\u306b\u3082\u306a\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\u3064\u307e\u308a\u3001\u7b2c2\u5f15\u6570\u306e\u300c\u578b\u300d\u306f\u3001\u5165\u529b\u3067\u3082\u51fa\u529b\u3067\u3082\u3088\u304f\u3001\u5165\u529b\u306a\u3089\u578b\u691c\u67fb\u3001\u51fa\u529b\u306a\u3089\u578b\u63a8\u8ad6\u306e\u610f\u5473\u306b\u306a\u308b\u3002\u300cProlog\u306e\u53cc\u65b9\u5411\u6027\u300d\u304c\u5229\u7528\u3067\u304d\u308b\u4f8b\u3067\u3042\u308b\u3002\ntypeof(+\u5f0f, ?\u578b)\n\n\ntypeof(E, T) :-\n        typeof([], E, T).\n\n\n\n\u7b2c2\u5f15\u6570\u306e\u300c\u578b\u300d\u306f\u3001\u5165\u529b\u3067\u3082\u51fa\u529b\u3067\u3082\u3088\u3044\u3002\u305f\u3068\u3048\u3070\u6b63\u3057\u3044\u578b\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u3001\u7d50\u679c\u306f\u300c\u6210\u529f\u300d\u306b\u306a\u308b\uff08\u578b\u691c\u67fb\uff09\u3002\u9593\u9055\u3063\u305f\u578b\u3092\u6307\u5b9a\u3057\u305f\u3089\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\u7b2c1\u5f15\u6570\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f0f\u304c\u3082\u3068\u3082\u3068\u578b\u4ed8\u3051\u3067\u304d\u306a\u3051\u308c\u3070\u3001\u3053\u306e\u3068\u304d\u3082\u3001\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\n?- typeof(tm_true, ty_Bool).\n\n\u307e\u305f\u3001\u5909\u6570\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u3001\u305d\u306e\u5909\u6570\u306b\u6b63\u3057\u3044\u578b\u304c\u8a2d\u5b9a\u3055\u308c\u308b\uff08\u578b\u63a8\u8ad6\uff09\u3002\n?- typeof(tm_true, T).\n\nT = ty_Bool.\n\n\u7b2c1\u5f15\u6570\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f0f\u304c\u578b\u4ed8\u3051\u3067\u304d\u306a\u3051\u308c\u3070\u3001\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\ntypeof/3\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u3092\u4ee5\u4e0b\u306b\u793a\u3059\u3002\ntypeof(+\u6587\u8108, +\u5f0f, ?\u578b)\n\n\u578b\u691c\u67fb\u3092\u304a\u3053\u306a\u3046typeof/3\u306f\u3001TAPL(\u53c2\u8003\u6587\u732e1.)\u306e10.3\u7bc0 \u578b\u691c\u67fb \u3092\u305d\u306e\u307e\u307e\u79fb\u3057\u305f\u3060\u3051\u3067\u3042\u308b\u3002\u305f\u3060\u3057\u3001tm_abs\u306b\u578b\u6ce8\u91c8\uff08\u578b\u4fee\u98fe\uff09\u306e\u306a\u3044\u5834\u5408\u3082\u8a31\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30e9\u30e0\u30c0\u5909\u6570\u306e\u578b\u3092\u65b0\u3057\u3044\uff08\u672a\u675f\u7e1b\u306e\uff09Prolog\u306e\u5909\u6570\u3067\u8868\u3057\u6587\u8108\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002 \u3053\u306e\u5909\u6570\u306ftypeof\u306e\u5b9f\u884c\u306b\u3068\u3082\u306a\u3063\u3066\u3001\u675f\u7e1b\u3055\u308c\u308b\uff08\u578b\u304c\u6c7a\u307e\u308b\uff09\u3053\u3068\u304c\u671f\u5f85\u3055\u308c\u308b\u3002\u3082\u3057\u3001\u578b\u304c\u6c7a\u307e\u3089\u306a\u3044\u306a\u3089\u3001\u672a\u675f\u7e1b\u306eProlog\u5909\u6570\u306e\u307e\u307e\u51fa\u529b\u3055\u308c\u308b\u3002\n\u3053\u306e\u65b9\u6cd5\u306b\u3088\u308c\u3070\u3001\u5168\u79f0\u578b\u306e\u578b\u5909\u6570\u3092Prolog\u306e\u5909\u6570\u3067\u8868\u3059\u3053\u3068\u3067\u3001System F\u306e\u578b\u691c\u67fb\u3084\u578b\u63a8\u8ad6\u306b\u62e1\u5f35\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u307e\u305f\u3001\u3082\u3068\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3042\u308b\u30a8\u30e9\u30fc\u6642\u306e\u51e6\u7406\u306f\u304a\u3053\u306a\u308f\u305a\u3001\u7d50\u679c\u3068\u3057\u3066\u5b9f\u884c\u304c\u300c\u5931\u6557\u300d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\ntypeof(CTX, tm_var(I), T) :-\n        getTypeFromContext(CTX, I, T).\ntypeof(CTX, tm_abs(TyT1, Tm2), TyT1 -> TyT2) :- % \u578b\u6ce8\u91c8\u306e\u3042\u308b\u5834\u5408\n        typeof([TyT1|CTX], Tm2, TyT2).\ntypeof(CTX, tm_abs(Tm2), TyT1 -> TyT2) :-   % \u578b\u6ce8\u91c8\u306e\u306a\u3044\u5834\u5408\n        typeof([TyT1|CTX], Tm2, TyT2).\ntypeof(CTX, tm_app(Tm1, Tm2), Ty12) :-\n        typeof(CTX, Tm1, Ty11 -> Ty12),\n        typeof(CTX, Tm2, Ty11).\ntypeof(CTX, tm_true, ty_Bool).        \ntypeof(CTX, tm_false, ty_Bool).\ntypeof(CTX, tm_if(T1, T2, T3), TyT2) :-\n        typeof(CTX, T1, ty_Bool),\n        typeof(CTX, T2, TyT12),\n        typeof(CTX, T3, TyT12).\n\n\n\n\ngetTypeFromContext\ngetTypeFromContext\u306f\u3001\u5909\u6570\u306e\u578b\u3092\u6587\u8108(context)\u304b\u3089\u53d6\u308a\u51fa\u3059\u3053\u3068\u3092\u304a\u3053\u306a\u3046\u3002\nde Bruijn Index\u306e\u5834\u5408\u306f\u3001Index\u306e\u5024\u306b\u3088\u3063\u3066\u4e00\u610f\u306b\u6c7a\u307e\u308b\u305f\u3081\u3001\uff08\u306a\u306b\u3082\u8003\u3048\u305a\u306b\uff09nth0\u8ff0\u8a9e\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nnth0(I, CTX, TB)\u306f\u3001\u30ea\u30b9\u30c8CTX\u306eI\u756a\u3081\uff080\u304b\u3089\u6570\u3048\u308b\uff09\u3092TB\u306b\u8fd4\u3059\u3082\u306e\u3067\u3001\u6c7a\u5b9a\u7684\u306b\u52d5\u4f5c\u3059\u308b\uff08\u6ce82)\u3002\nOccurs Check\u304c\u5fc5\u8981\u306b\u306a\u308b\u7406\u7531\u306b\u3064\u3066\u3066\u306f\u3001\u300c\u03bbx.x x\u300d\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\ngetTypeFromContext(CTX, I, TA) :-\n        nth0(I, CTX, TB),                   % (*1)\n        unify_with_occurs_check(TA, TB).    % Occurs Check \u306e\u3082\u3068\u3067\u3001TA=TB\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\n\n\n\u30c6\u30b9\u30c8\n\ntest(Tm, Ty) :-\n        dbi(Tm, Dm), write(Dm), nl,\n        rbi(Dm, Tm2), write(Tm2), nl, !,\n        typeof(Dm, Ty),\n        write(Ty).\n\n\n\n\n\u5b9f\u884c\u4f8b\n\n\u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u4f8b\n\u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u3053\u3068\u3067\u6709\u540d\u306a\u4f8b\u3001\u300c\u03bbx.x x\u300d \u3067\u3042\u308b\u3002\n\ngo23 :-\n        test(tm_abs(x,\n                    tm_app(tm_var(x), tm_var(x))),\n             _).\n\n\n\n\u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u306e\u304c\u6b63\u3057\u3044\u306e\u3067\u3001\u3053\u308c\u306f\u300c\u5931\u6557\u300d\u3067\u7d42\u4e86\u3059\u308b\u3002\n\u3057\u304b\u3057\u3001getTypeFromContext\u306eOccurs Check\u3092\u5916\u3059(unify_with_occurs_check(TA, TB)\u3092 TA = TB\u306b\u66f8\u304d\u63db\u3048\u308b)\u3068\u9593\u9055\u3063\u305f\u578b\u3092\u8fd4\u3059\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u306e\u7406\u7531\u306b\u3088\u308b\u3002\n\u03bbx.x x \u306e\u672c\u4f53 (x x) \u306e\u5168\u4f53\u306e\u578b\u3092T1\u3001\u4e8c\u756a\u76ee\u306ex\u306e\u578b\u3092Tx\u3068\u3059\u308b\u3002\u3059\u308b\u3068\u3001\u4e00\u756a\u76ee\u306ex\u306e\u578b\u306fTx->T1\u306b\u306a\u308b\u304c\u3001\u3053\u308c\u3082Tx\u3067\u3042\u308b\u306f\u305a\u3060\u304b\u3089\u3001Tx = Tx->T1 \u306b\u306a\u308b\u3002\u3064\u307e\u308a\u3001x\u306e\u578b\u306f Tx \u304b\u3064 Tx->T1 \u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u3053\u308c\u306f\u578b\u3068\u3057\u3066\u304a\u304b\u3057\u3044\u3002\n\u3057\u304b\u3057\u306a\u304c\u3089\u3001Prolog\u3067\uff08\u5b9f\u884c\u901f\u5ea6\u3092\u512a\u5148\u3057\u3066\u3001\u7701\u7565\u6642\u89e3\u91c8\u306e\u307e\u307e\uff09Occurs Check\u3092\u884c\u308f \u306a\u3044 \u3068\u3001\u3053\u308c\u3092\u300c\u304a\u304b\u3057\u3044\u300d\u3068\u5224\u65ad\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u304a\u304b\u3057\u3044\u307e\u307e\u3001\u03bbx.x x \u306e\u578b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u5947\u5999\u306a\u7d50\u679c\u3092\u8fd4\u3059\u3002\n(Tx->T1)->T1\u3001\u305f\u3060\u3057 Tx=Tx->T1\nOccurs Check \u3092\u304a\u3053\u306a\u3046\u3068\u3001Tx = Tx->T1 \u306f\u300c\u304a\u304b\u3057\u3044\u300d\u3068\u5224\u65ad\u3055\u308c\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\u7d50\u679c\u3068\u3057\u3066typeof\u5168\u4f53\u304c\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\n\n\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u57fa\u790e\uff08\u6587\u732e2.) \u306e\u30b5\u30f3\u30d7\u30eb\n\u3053\u308c\u306f\u578b\u4ed8\u3051\u3067\u304d\u308b\u4f8b\u3067\u3042\u308b\u3002\n\ngo24 :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        Ty = ty_Bool -> (ty_Bool -> ty_Bool) -> ty_Bool,\n        test(Tm, Ty).                       % \u578b\u691c\u67fb\n\ngo24(Ty) :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        test(Tm, Ty).                       % \u578b\u63a8\u8ad6\n\n\n\n\u524d\u306e\u4f8b\u3067\u3001\u578b\u6ce8\u91c8\u304c\u306a\u3044\u5834\u5408\u3002\u5f0f\u306f\u76f4\u63a5de Bruijn Index \u3067\u4e0e\u3048\u3066\u3044\u308b\u3002\n\ngo241 :-\n        Tm = tm_abs(ty_Bool, tm_abs(tm_app(tm_var(0 ),\n                                           tm_app(tm_var(0 ),\n                                                  tm_var(1))))),\n        Ty = ty_Bool -> (ty_Bool -> ty_Bool) -> ty_Bool,\n        typeof(Tm, Ty).                     % \u578b\u691c\u67fb\n\ngo241(Ty) :-\n        Tm = tm_abs(ty_Bool, tm_abs(tm_app(tm_var(0 ),\n                                           tm_app(tm_var(0 ),\n                                                  tm_var(1))))),\n        typeof(Tm, Ty).                     % \u578b\u63a8\u8ad6\n\n\n\n\nde Bruijn Index \u5909\u63db\n\u4ee5\u4e0b\u3067\u306f\u3001\u901a\u5e38\u306e\u30e9\u30e0\u30c0\u5f0f\u304b\u3089de Bruijn Index\u306b\u5909\u63db\u3059\u308b\u51e6\u7406\u3001\u304a\u3088\u3073\u3001\u9006\u5909\u63db\u3059\u308b\u51e6\u7406\u306b\u3064\u3044\u3066\u8aac\u660e\u3059\u308b\u3002\n\n\u6b63\u5909\u63db\n\ndbi(Exp, Dbi) :-\n        empty_assoc(Env),\n        dbi(Exp, Env, 0, _, Dbi).           % (*1)\n\n\ndbi/4\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\ndbi(+\u30e9\u30e0\u30c0\u5f0f, +\u74b0\u5883, +\u81ea\u7531\u5909\u6570\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff0c\n    -\u81ea\u7531\u5909\u6570\u306e\u66f4\u65b0\u3055\u308c\u305f\u30a4\u30f3\u30c7\u30af\u30b9\uff0c -\u5909\u63db\u5f8c\u306e\u5f0f)\n\n\ndbi(tm_abs(X:T, M), Env, F, F2, tm_abs(T, D)) :-\n        atom(X), !,\n        map_assoc(inc, Env, Env1),\n        put_assoc(X, Env1, 0, Env2),        % (*1)\n        assoc_to_values(Env2, L),\n        max_list(L, F1),\n        dbi(M, Env2, F1, F2, D).\ndbi(tm_abs(X, M), Env, F, F2, tm_abs(D)) :- !,\n        dbi(tm_abs(X:T, M), Env, F, F2, tm_abs(T, D)).\ndbi(tm_var(X), Env, F, F, tm_var(N)) :-\n        atom(X),\n        get_assoc(X, Env, N), !.\n%% \u672c\u5f53\u306e\u81ea\u7531\u5909\u6570\u306f\u3001\u51fa\u73fe\u306e\u9806\u756a\u306bindex\u3092\u66f4\u65b0\u3059\u308b\u3002\n%% \u305f\u3060\u3057\u3001\u540c\u3058\u5909\u6570\u540d\u304c\u51fa\u73fe\u3057\u3066\u3082\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u3002\ndbi(tm_var(_), _, F, F1, tm_var(F1)) :- !,\n        F1 is F + 1.\n\ndbi(Tm, Env, F, F2, Tm2) :-\n        Tm =.. [Func|Tms], !,\n        dbi_list(Tms, Env, F, F2, Tm2s),\n        Tm2 =.. [Func|Tm2s].\n\ndbi_list([Tm|Tms], Env, F, F2, [Tm2|Tm2s]) :-\n        dbi(Tm, Env, F, F1, Tm2),\n        dbi_list(Tms, Env, F1, F2, Tm2s).\ndbi_list([], _, F, F, []).\n\ninc(N, N1) :-\n        N1 is N + 1.\n\n\n\n\n\u9006\u5909\u63db\n\nrbi(Exp, Dbi) :-\n        rbi(Exp, 0, Dbi).                   % (*1)\n\nrbi(tm_abs(T, M), I, tm_abs(X:T, M2)) :- !,\n        I1 is I + 1,\n        atom_concat(x, I1, X),\n        rbi(M, I1, M2).\nrbi(tm_abs(M), I, tm_abs(X, M2)) :- !,\n        rbi(tm_abs(_, M), I, tm_abs(X, M2)).\nrbi(tm_var(N), I, tm_var(X)) :-\n        integer(N),\n        N =< I, !,                          % bound\n        N1 is I - N + 1,\n        atom_concat(x, N1, X).\nrbi(tm_var(N), I, tm_var(X)) :- !,\n        atom_concat(x, N, X).               % free\nrbi(Tm, I, Tm2) :-\n        Tm =.. [Func|Tms], !,\n        rbi_list(Tms, I, Tm2s),\n        Tm2 =.. [Func|Tm2s].\n\nrbi_list([Tm|Tms], I, [Tm2|Tm2s]) :-\n        rbi(Tm, I, Tm2),\n        rbi_list(Tms, I, Tm2s).\nrbi_list([], _, []).\n\n\n\n\n\u30c6\u30b9\u30c8\n\ntest2(Tm) :-\n        write(Tm), nl,\n        dbi(Tm, Dm), write(Dm), nl,\n        rbi(Dm, Tm2), write(Tm2).\n\n\n\n\nsample \u30b3\u30fc\u30c9\n\nTAPL \u6f14\u7fd26.1.1\n\ngo11 :-                                     % C0\n        test2(tm_abs(s:_, tm_abs(z:_, tm_var(z)))).\ngo12 :-                                     % C2\n        test2(tm_abs(s:_, tm_abs(z:_,\n                                tm_app(tm_var(s), tm_app(tm_var(s), tm_var(z)))))).\ngo13 :-                                     % plus\n        test2(tm_abs(m,\n                     tm_abs(n,\n                            tm_abs(s,\n                                   tm_abs(z,\n                                          tm_app(tm_var(m),\n                                                 tm_app(tm_var(s),\n                                                        tm_app(tm_app(tm_var(n), tm_var(s)),\n                                                               tm_var(z))))))))).\n\n\n\n\n\u578b\u6ce8\u91c8\u306e\u3042\u308b\u5834\u5408\n\ngo14 :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        test2(Tm).\n\n\n\n\n\u81ea\u7531\u5909\u6570\u306e\u3042\u308b\u5834\u5408\n\ngo15 :-\n        test2(tm_app(tm_abs(s:_, tm_abs(z:_, tm_var(z))),\n                     tm_var(x))).\n\n\n\n\n\u88dc\u8db3\u8aac\u660e\n\n\u6ce81\n\u672c\u8cc7\u6599\u3067\u306f de Bruijn Index \u30920\u304b\u3089\u4f7f\u7528\u3059\u308b\u3002\n1\u304b\u3089\u306b\u3059\u308b\u5834\u5408\u306f\u3001\u300c(*1)\u300d\u306e\u7b87\u6240\u306e\u300c0\u300d\u3092\u300c1\u300d\u306b\u5909\u66f4\u3059\u308b\u3002\n\n\u6ce82\nde Bruijn Index\u3067\u306f\u306a\u3044\u4e00\u822c\u306e\u30e9\u30e0\u30c0\u5f0f\u306e\u5834\u5408\u306f\u3001\u6587\u8108\u3092\u300c\u5909\u6570\u540d\uff1a\u578b\u300d\u306e\u30ea\u30b9\u30c8\u3067\u4fdd\u6301\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u5909\u6570X\u306e\u578bTB\u3092member\u8ff0\u8a9e\u3092\u4f7f\u3063\u3066\u3067\u898b\u3064\u3051\u308b\u3053\u3068\u306b\u306a\u308b\u3002member(X:TB, CTX)\u3002\u4e00\u822c\u306e\u30e9\u30e0\u30c0\u5f0f\u306e\u5834\u5408\u306f\u3001\u540c\u3058\u540d\u524d\u306e\u5909\u6570\u304c\u5b58\u5728\u3057\u30b9\u30b3\u30fc\u30d7\u306b\u3088\u3063\u3066\u306e\u610f\u5473\u304c\u7570\u306a\u308b\u3002\u3053\u306e\u3068\u304d\u3001member\u306f\u8907\u6570\u89e3\u3092\u6c42\u3081\u3066\u3057\u307e\u3046\u3002\u3057\u304b\u3057\u3001\u305d\u306e\u5834\u5408\u3067\u3082\u5fc5\u305a\u4e00\u756a\u5916\u5074\u306e\u3001\u3064\u307e\u308a\u6700\u521d\u306b\u898b\u3064\u3051\u305f\u3082\u306e\u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\nmember\u8ff0\u8a9e\u306e\u975e\u6c7a\u5b9a\u6027\u3092\u6bba\u3059\u305f\u3081\u306bcut\u30aa\u30da\u30ec\u30fc\u30bf\u5165\u308c\u308b\u3002\n\n\u8ab2\u984c\n\n\u7dcf\u79f0\u578b(generics)\u3078\u306e\u62e1\u5f35\uff1acopy_term\u3092\u4f7f\u3046\uff1f\nSystem F \u3078\u306e\u62e1\u5f35\uff1a\n\n\n\u53c2\u8003\u6587\u732e\n\nBenjamin C. Pierce\u3001\u4f4f\u4e95 \u76e3\u8a33\u300c\u578b\u30b7\u30b9\u30c6\u30e0\u5165\u9580 \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u3068\u578b\u306e\u7406\u8ad6\u300d\u30aa\u30fc\u30e0\u793e\nBenjamin C. Pierce\u4ed6\u3001\u6885\u6751\u4ed6\u8a33\u300c\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u306e\u57fa\u790e\u300d\u3001http://proofcafe.org/sf/\n\nSWI-Prolog\u3001http://www.swi-prolog.org/\n\nGNU Prolog\u3001http://www.gprolog.org/\n\n\n\n\nProlog\u306b\u3088\u308b\u3001\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306e\u578b\u691c\u67fb\u3068\u578b\u63a8\u8ad6\u306b\u3064\u3044\u3066\n========\n\n**\u672c\u30da\u30fc\u30b8\u306e\u5185\u5bb9\u306f\u3001\u52a0\u7b46\u8a02\u6b63\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002**\n\n\u4ee5\u4e0b\u3082\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306b\u5168\u79f0\u578b\u3092\u8ffd\u52a0\u3057\u305fSystem F\u306eProlog\u306b\u3088\u308b\u578b\u691c\u67fb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3001\nhttp://qiita.com/suharahiromichi/items/9adc16a40ecb1bc36825\n\n2014/05/02 @suharahiromichi\n\n\u5358\u7d14\u578b\u4ed8\u304d\u30e9\u30e0\u30c0\u5f0f\u306e\u578b\u691c\u67fb\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092Prolog\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\u305d\u306e\u3046\u3048\u3067\u3001\u540c\u3058\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u300cProlog\u306e\u53cc\u65b9\u5411\u6027\u300d\u306b\u3088\u3063\u3066\u3001\u578b\u63a8\u8ad6\u3082\u3067\u304d\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\n\u3053\u306e\u6587\u7ae0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\n\nhttps://github.com/suharahiromichi/prolog/blob/master/tapl/tapl_stlc_qiita.swi  \n\u4f7f\u3044\u65b9\u306e\u4f8b\uff1a\n\n```\n% swipl.\n?- ['tapl_stlc_qitta.swi'].\n?- go24.\n```\n\nProlog\u51e6\u7406\u7cfb\u306fSWI-Prolog (5.10.4)\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u3044\u308b\u3002GNU Prolog\u3067\u306f\u672a\u78ba\u8a8d\u3067\u3042\u308b\u3002\n\u7701\u7565\u6642\u89e3\u91c8\uff08\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\uff09\u306e\u3068\u304a\u308a Occurs Check \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f off \u306e\u307e\u307e\u3068\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u9014\u4e2d\u306e1\u7b87\u6240\u306b\u304a\u3044\u3066\u3001unify_with_occurs_check\u8ff0\u8a9e\u3067\u3001Occurs Check \u4ed8\u304d\u306e\u4e00\u81f4\u5224\u5b9a\u300c=\u300d\u3092\u304a\u3053\u306a\u3046\u3002\u3053\u306e\u3053\u3068\u306f\u5f8c\u8ff0\u3059\u308b\u3002\n\n\n# \u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5\u306b\u3064\u3044\u3066\n\u578b\u691c\u67fb\u306b\u306fde Bruijn Index (\u6ce81) \u3092\u4f7f\u7528\u3059\u308b\u304c\u3001\u308f\u304b\u308a\u3084\u3059\u3055\u304b\u3089\u3001\u4e00\u822c\u7684\u306a\u30e9\u30e0\u30c0\u5f0f\u3092de Bruijn Index\u306b\u5909\u63db\u3057\u3066\u4f7f\u3046\u3002\n\u307e\u305f\u3001\u3069\u3061\u3089\u306e\u5834\u5408\u3082\u3001Prolog\u3067\u6271\u3048\u308b\u524d\u7f6e\u8a18\u6cd5 f(x,g(y,z)) \u306e\u5f62\u5f0f\u3092\u4f7f\u7528\u3059\u308b\u3002\nde Bruijn Index \u306b\u5909\u63db\u3059\u308b\u30b3\u30fc\u30c9\u306f\u5f8c\u534a\u306b\u793a\u3059\u3002\n\n\n## \u8a18\u6cd5\u306e\u4e00\u89a7\n\n```\n  \u03bbx.y     tm_abs(x, y)       \u578b\u6ce8\u91c8\u306e\u306a\u3044\u03bb\u62bd\u8c61\n  \u03bbx:T.y   tm_abs(x:T, y)     \u578b\u6ce8\u91c8\u306e\u3042\u308b\u03bb\u62bd\u8c61 (\u300c:\u300d\u306f\u4e2d\u7f6e\u8a18\u6cd5)\n  f x      tm_app(f, x)       \u9069\u7528\n  x        tm_var(x)          \u5909\u6570\u306e\u53c2\u7167\n  t1->t2   t1->t2             \u95a2\u6570\u578b (\u4e2d\u7f6e\u8a18\u6cd5)\n  Bool     ty_bool            \u578b\u5b9a\u6570\n  True     tm_true            \u5b9a\u6570\n  False    tm_false           \u5b9a\u6570\n```\n\n## \u5909\u63db\u306e\u4f8b\n\n### \u4e00\u822c\u7684\u306a\u8a18\u6cd5\n\n```\n  \u03bba:Bool. \u03bb:b:Bool->Bool. b (b a)\n```\n\n### \u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5\n\n```\ntm_abs(a:ty_Bool,\n  tm_abs(b:ty_Bool->ty_Bool,\n    tm_app(tm_var(b),\n           tm_app(tm_var(b), tm_var(a)))))\n```\n\n### \u3053\u3053\u3067\u4f7f\u3046\u8a18\u6cd5(de Bruijn Index)\n\n```\ntm_abs(ty_Bool,\n  tm_abs(ty_Bool->ty_Bool,\n    tm_app(tm_var(0),\n           tm_app(tm_var(0), tm_var(1)))))\n```\n\n\n\u578b\u306e\u6ce8\u91c8\u3067\u4f7f\u3046\u300c:\u300d\u3068\u3001\u305d\u306e\u306a\u304b\u3067\u306e\u95a2\u6570\u578b\u3092\u793a\u3059\u300c->\u300d\u306f\u3001\u300c,\u300d\u3088\u308a\u512a\u5148\u5ea6\u304c\u9ad8\u3044\u3082\u306e\u3068\u3059\u308b\u3002\n\n\n\n```\n\n:- op(600, xfx, :).                         % \u4f8b\u3001x : T\n:- op(500, xfy, ->).                        % \u4f8b\u3001Tx->Ty\n\n\n```\n\n# \u578b\u691c\u67fb\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\n\n## typeof\n\ntypeof/2\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u3092\u4ee5\u4e0b\u306b\u793a\u3059\u3002\u5f0f\u306fde Bruijn Index\u3067\u4e0e\u3048\u308b\u3002\u5f15\u6570\u306e\u524d\u306e\u300c+\u300d\u306f\u5165\u529b\u3001\u300c-\u300d\u306f\u51fa\u529b\u3001\u300c?\u300d\u306f\u305d\u306e\u3069\u3061\u3089\u306b\u3082\u306a\u308b\u3053\u3068\u3092\u793a\u3059\u3002\n\u3064\u307e\u308a\u3001\u7b2c2\u5f15\u6570\u306e\u300c\u578b\u300d\u306f\u3001\u5165\u529b\u3067\u3082\u51fa\u529b\u3067\u3082\u3088\u304f\u3001\u5165\u529b\u306a\u3089\u578b\u691c\u67fb\u3001\u51fa\u529b\u306a\u3089\u578b\u63a8\u8ad6\u306e\u610f\u5473\u306b\u306a\u308b\u3002\u300cProlog\u306e\u53cc\u65b9\u5411\u6027\u300d\u304c\u5229\u7528\u3067\u304d\u308b\u4f8b\u3067\u3042\u308b\u3002\n\n```\ntypeof(+\u5f0f, ?\u578b)\n```                                                             \n\n\n\n```\n\ntypeof(E, T) :-\n        typeof([], E, T).\n\n\n```\n\u7b2c2\u5f15\u6570\u306e\u300c\u578b\u300d\u306f\u3001\u5165\u529b\u3067\u3082\u51fa\u529b\u3067\u3082\u3088\u3044\u3002\u305f\u3068\u3048\u3070\u6b63\u3057\u3044\u578b\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u3001\u7d50\u679c\u306f\u300c\u6210\u529f\u300d\u306b\u306a\u308b\uff08\u578b\u691c\u67fb\uff09\u3002\u9593\u9055\u3063\u305f\u578b\u3092\u6307\u5b9a\u3057\u305f\u3089\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\u7b2c1\u5f15\u6570\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f0f\u304c\u3082\u3068\u3082\u3068\u578b\u4ed8\u3051\u3067\u304d\u306a\u3051\u308c\u3070\u3001\u3053\u306e\u3068\u304d\u3082\u3001\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\n\n```\n?- typeof(tm_true, ty_Bool).\n```  \n\u307e\u305f\u3001\u5909\u6570\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u3001\u305d\u306e\u5909\u6570\u306b\u6b63\u3057\u3044\u578b\u304c\u8a2d\u5b9a\u3055\u308c\u308b\uff08\u578b\u63a8\u8ad6\uff09\u3002\n\n```\n?- typeof(tm_true, T).\n\nT = ty_Bool.\n```  \n\u7b2c1\u5f15\u6570\u306b\u4e0e\u3048\u3089\u308c\u305f\u5f0f\u304c\u578b\u4ed8\u3051\u3067\u304d\u306a\u3051\u308c\u3070\u3001\u7d50\u679c\u306f\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\n\n\ntypeof/3\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u3092\u4ee5\u4e0b\u306b\u793a\u3059\u3002\n\n```\ntypeof(+\u6587\u8108, +\u5f0f, ?\u578b)\n```\n\u578b\u691c\u67fb\u3092\u304a\u3053\u306a\u3046typeof/3\u306f\u3001TAPL(\u53c2\u8003\u6587\u732e1.)\u306e10.3\u7bc0 **\u578b\u691c\u67fb** \u3092\u305d\u306e\u307e\u307e\u79fb\u3057\u305f\u3060\u3051\u3067\u3042\u308b\u3002\u305f\u3060\u3057\u3001tm_abs\u306b\u578b\u6ce8\u91c8\uff08\u578b\u4fee\u98fe\uff09\u306e\u306a\u3044\u5834\u5408\u3082\u8a31\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30e9\u30e0\u30c0\u5909\u6570\u306e\u578b\u3092\u65b0\u3057\u3044\uff08\u672a\u675f\u7e1b\u306e\uff09Prolog\u306e\u5909\u6570\u3067\u8868\u3057\u6587\u8108\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002 \u3053\u306e\u5909\u6570\u306ftypeof\u306e\u5b9f\u884c\u306b\u3068\u3082\u306a\u3063\u3066\u3001\u675f\u7e1b\u3055\u308c\u308b\uff08\u578b\u304c\u6c7a\u307e\u308b\uff09\u3053\u3068\u304c\u671f\u5f85\u3055\u308c\u308b\u3002\u3082\u3057\u3001\u578b\u304c\u6c7a\u307e\u3089\u306a\u3044\u306a\u3089\u3001\u672a\u675f\u7e1b\u306eProlog\u5909\u6570\u306e\u307e\u307e\u51fa\u529b\u3055\u308c\u308b\u3002  \n\u3053\u306e\u65b9\u6cd5\u306b\u3088\u308c\u3070\u3001\u5168\u79f0\u578b\u306e\u578b\u5909\u6570\u3092Prolog\u306e\u5909\u6570\u3067\u8868\u3059\u3053\u3068\u3067\u3001System F\u306e\u578b\u691c\u67fb\u3084\u578b\u63a8\u8ad6\u306b\u62e1\u5f35\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u307e\u305f\u3001\u3082\u3068\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u3042\u308b\u30a8\u30e9\u30fc\u6642\u306e\u51e6\u7406\u306f\u304a\u3053\u306a\u308f\u305a\u3001\u7d50\u679c\u3068\u3057\u3066\u5b9f\u884c\u304c\u300c\u5931\u6557\u300d\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n\n\n```\n\ntypeof(CTX, tm_var(I), T) :-\n        getTypeFromContext(CTX, I, T).\ntypeof(CTX, tm_abs(TyT1, Tm2), TyT1 -> TyT2) :- % \u578b\u6ce8\u91c8\u306e\u3042\u308b\u5834\u5408\n        typeof([TyT1|CTX], Tm2, TyT2).\ntypeof(CTX, tm_abs(Tm2), TyT1 -> TyT2) :-   % \u578b\u6ce8\u91c8\u306e\u306a\u3044\u5834\u5408\n        typeof([TyT1|CTX], Tm2, TyT2).\ntypeof(CTX, tm_app(Tm1, Tm2), Ty12) :-\n        typeof(CTX, Tm1, Ty11 -> Ty12),\n        typeof(CTX, Tm2, Ty11).\ntypeof(CTX, tm_true, ty_Bool).        \ntypeof(CTX, tm_false, ty_Bool).\ntypeof(CTX, tm_if(T1, T2, T3), TyT2) :-\n        typeof(CTX, T1, ty_Bool),\n        typeof(CTX, T2, TyT12),\n        typeof(CTX, T3, TyT12).\n\n\n```\n\n## getTypeFromContext\n\ngetTypeFromContext\u306f\u3001\u5909\u6570\u306e\u578b\u3092\u6587\u8108(context)\u304b\u3089\u53d6\u308a\u51fa\u3059\u3053\u3068\u3092\u304a\u3053\u306a\u3046\u3002\nde Bruijn Index\u306e\u5834\u5408\u306f\u3001Index\u306e\u5024\u306b\u3088\u3063\u3066\u4e00\u610f\u306b\u6c7a\u307e\u308b\u305f\u3081\u3001\uff08\u306a\u306b\u3082\u8003\u3048\u305a\u306b\uff09nth0\u8ff0\u8a9e\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nnth0(I, CTX, TB)\u306f\u3001\u30ea\u30b9\u30c8CTX\u306eI\u756a\u3081\uff080\u304b\u3089\u6570\u3048\u308b\uff09\u3092TB\u306b\u8fd4\u3059\u3082\u306e\u3067\u3001\u6c7a\u5b9a\u7684\u306b\u52d5\u4f5c\u3059\u308b\uff08\u6ce82)\u3002\n\nOccurs Check\u304c\u5fc5\u8981\u306b\u306a\u308b\u7406\u7531\u306b\u3064\u3066\u3066\u306f\u3001\u300c\u03bbx.x x\u300d\u306e\u5b9f\u884c\u4f8b\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n\n\n```\n\ngetTypeFromContext(CTX, I, TA) :-\n        nth0(I, CTX, TB),                   % (*1)\n        unify_with_occurs_check(TA, TB).    % Occurs Check \u306e\u3082\u3068\u3067\u3001TA=TB\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\n```\n\n## \u30c6\u30b9\u30c8\n\n\n\n```\n\ntest(Tm, Ty) :-\n        dbi(Tm, Dm), write(Dm), nl,\n        rbi(Dm, Tm2), write(Tm2), nl, !,\n        typeof(Dm, Ty),\n        write(Ty).\n\n\n```\n\n## \u5b9f\u884c\u4f8b\n\n\n### \u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u4f8b\n\u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u3053\u3068\u3067\u6709\u540d\u306a\u4f8b\u3001\u300c\u03bbx.x x\u300d \u3067\u3042\u308b\u3002\n\n\n```\n\ngo23 :-\n        test(tm_abs(x,\n                    tm_app(tm_var(x), tm_var(x))),\n             _).\n\n\n```\n\u578b\u4ed8\u3051\u3067\u304d\u306a\u3044\u306e\u304c\u6b63\u3057\u3044\u306e\u3067\u3001\u3053\u308c\u306f\u300c\u5931\u6557\u300d\u3067\u7d42\u4e86\u3059\u308b\u3002\n\u3057\u304b\u3057\u3001getTypeFromContext\u306eOccurs Check\u3092\u5916\u3059(unify_with_occurs_check(TA, TB)\u3092 TA = TB\u306b\u66f8\u304d\u63db\u3048\u308b)\u3068\u9593\u9055\u3063\u305f\u578b\u3092\u8fd4\u3059\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u306e\u7406\u7531\u306b\u3088\u308b\u3002\n\u03bbx.x x \u306e\u672c\u4f53 (x x) \u306e\u5168\u4f53\u306e\u578b\u3092T1\u3001\u4e8c\u756a\u76ee\u306ex\u306e\u578b\u3092Tx\u3068\u3059\u308b\u3002\u3059\u308b\u3068\u3001\u4e00\u756a\u76ee\u306ex\u306e\u578b\u306fTx->T1\u306b\u306a\u308b\u304c\u3001\u3053\u308c\u3082Tx\u3067\u3042\u308b\u306f\u305a\u3060\u304b\u3089\u3001Tx = Tx->T1 \u306b\u306a\u308b\u3002\u3064\u307e\u308a\u3001x\u306e\u578b\u306f Tx \u304b\u3064 Tx->T1 \u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u3053\u308c\u306f\u578b\u3068\u3057\u3066\u304a\u304b\u3057\u3044\u3002\n\u3057\u304b\u3057\u306a\u304c\u3089\u3001Prolog\u3067\uff08\u5b9f\u884c\u901f\u5ea6\u3092\u512a\u5148\u3057\u3066\u3001\u7701\u7565\u6642\u89e3\u91c8\u306e\u307e\u307e\uff09Occurs Check\u3092\u884c\u308f **\u306a\u3044** \u3068\u3001\u3053\u308c\u3092\u300c\u304a\u304b\u3057\u3044\u300d\u3068\u5224\u65ad\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u304a\u304b\u3057\u3044\u307e\u307e\u3001\u03bbx.x x \u306e\u578b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u5947\u5999\u306a\u7d50\u679c\u3092\u8fd4\u3059\u3002\n\n  (Tx->T1)->T1\u3001\u305f\u3060\u3057 Tx=Tx->T1\n\nOccurs Check \u3092\u304a\u3053\u306a\u3046\u3068\u3001Tx = Tx->T1 \u306f\u300c\u304a\u304b\u3057\u3044\u300d\u3068\u5224\u65ad\u3055\u308c\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\u7d50\u679c\u3068\u3057\u3066typeof\u5168\u4f53\u304c\u300c\u5931\u6557\u300d\u306b\u306a\u308b\u3002\n\n\n### \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u57fa\u790e\uff08\u6587\u732e2.) \u306e\u30b5\u30f3\u30d7\u30eb\n\u3053\u308c\u306f\u578b\u4ed8\u3051\u3067\u304d\u308b\u4f8b\u3067\u3042\u308b\u3002\n\n\n```\n\ngo24 :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        Ty = ty_Bool -> (ty_Bool -> ty_Bool) -> ty_Bool,\n        test(Tm, Ty).                       % \u578b\u691c\u67fb\n\ngo24(Ty) :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        test(Tm, Ty).                       % \u578b\u63a8\u8ad6\n\n\n```\n\u524d\u306e\u4f8b\u3067\u3001\u578b\u6ce8\u91c8\u304c\u306a\u3044\u5834\u5408\u3002\u5f0f\u306f\u76f4\u63a5de Bruijn Index \u3067\u4e0e\u3048\u3066\u3044\u308b\u3002\n\n\n```\n\ngo241 :-\n        Tm = tm_abs(ty_Bool, tm_abs(tm_app(tm_var(0 ),\n                                           tm_app(tm_var(0 ),\n                                                  tm_var(1))))),\n        Ty = ty_Bool -> (ty_Bool -> ty_Bool) -> ty_Bool,\n        typeof(Tm, Ty).                     % \u578b\u691c\u67fb\n\ngo241(Ty) :-\n        Tm = tm_abs(ty_Bool, tm_abs(tm_app(tm_var(0 ),\n                                           tm_app(tm_var(0 ),\n                                                  tm_var(1))))),\n        typeof(Tm, Ty).                     % \u578b\u63a8\u8ad6\n\n\n```\n\n# de Bruijn Index \u5909\u63db\n\u4ee5\u4e0b\u3067\u306f\u3001\u901a\u5e38\u306e\u30e9\u30e0\u30c0\u5f0f\u304b\u3089de Bruijn Index\u306b\u5909\u63db\u3059\u308b\u51e6\u7406\u3001\u304a\u3088\u3073\u3001\u9006\u5909\u63db\u3059\u308b\u51e6\u7406\u306b\u3064\u3044\u3066\u8aac\u660e\u3059\u308b\u3002\n\n## \u6b63\u5909\u63db\n\n\n\n```\n\ndbi(Exp, Dbi) :-\n        empty_assoc(Env),\n        dbi(Exp, Env, 0, _, Dbi).           % (*1)\n\n```\n\ndbi/4\u8ff0\u8a9e\u306e\u5f15\u6570\u306e\u610f\u5473\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n\n```\ndbi(+\u30e9\u30e0\u30c0\u5f0f, +\u74b0\u5883, +\u81ea\u7531\u5909\u6570\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\uff0c\n    -\u81ea\u7531\u5909\u6570\u306e\u66f4\u65b0\u3055\u308c\u305f\u30a4\u30f3\u30c7\u30af\u30b9\uff0c -\u5909\u63db\u5f8c\u306e\u5f0f)\n```\n\n\n```\n\ndbi(tm_abs(X:T, M), Env, F, F2, tm_abs(T, D)) :-\n        atom(X), !,\n        map_assoc(inc, Env, Env1),\n        put_assoc(X, Env1, 0, Env2),        % (*1)\n        assoc_to_values(Env2, L),\n        max_list(L, F1),\n        dbi(M, Env2, F1, F2, D).\ndbi(tm_abs(X, M), Env, F, F2, tm_abs(D)) :- !,\n        dbi(tm_abs(X:T, M), Env, F, F2, tm_abs(T, D)).\ndbi(tm_var(X), Env, F, F, tm_var(N)) :-\n        atom(X),\n        get_assoc(X, Env, N), !.\n%% \u672c\u5f53\u306e\u81ea\u7531\u5909\u6570\u306f\u3001\u51fa\u73fe\u306e\u9806\u756a\u306bindex\u3092\u66f4\u65b0\u3059\u308b\u3002\n%% \u305f\u3060\u3057\u3001\u540c\u3058\u5909\u6570\u540d\u304c\u51fa\u73fe\u3057\u3066\u3082\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u3002\ndbi(tm_var(_), _, F, F1, tm_var(F1)) :- !,\n        F1 is F + 1.\n\ndbi(Tm, Env, F, F2, Tm2) :-\n        Tm =.. [Func|Tms], !,\n        dbi_list(Tms, Env, F, F2, Tm2s),\n        Tm2 =.. [Func|Tm2s].\n\ndbi_list([Tm|Tms], Env, F, F2, [Tm2|Tm2s]) :-\n        dbi(Tm, Env, F, F1, Tm2),\n        dbi_list(Tms, Env, F1, F2, Tm2s).\ndbi_list([], _, F, F, []).\n\ninc(N, N1) :-\n        N1 is N + 1.\n\n\n```\n\n## \u9006\u5909\u63db\n\n\n```\n\nrbi(Exp, Dbi) :-\n        rbi(Exp, 0, Dbi).                   % (*1)\n\nrbi(tm_abs(T, M), I, tm_abs(X:T, M2)) :- !,\n        I1 is I + 1,\n        atom_concat(x, I1, X),\n        rbi(M, I1, M2).\nrbi(tm_abs(M), I, tm_abs(X, M2)) :- !,\n        rbi(tm_abs(_, M), I, tm_abs(X, M2)).\nrbi(tm_var(N), I, tm_var(X)) :-\n        integer(N),\n        N =< I, !,                          % bound\n        N1 is I - N + 1,\n        atom_concat(x, N1, X).\nrbi(tm_var(N), I, tm_var(X)) :- !,\n        atom_concat(x, N, X).               % free\nrbi(Tm, I, Tm2) :-\n        Tm =.. [Func|Tms], !,\n        rbi_list(Tms, I, Tm2s),\n        Tm2 =.. [Func|Tm2s].\n\nrbi_list([Tm|Tms], I, [Tm2|Tm2s]) :-\n        rbi(Tm, I, Tm2),\n        rbi_list(Tms, I, Tm2s).\nrbi_list([], _, []).\n\n\n```\n\n## \u30c6\u30b9\u30c8\n\n\n```\n\ntest2(Tm) :-\n        write(Tm), nl,\n        dbi(Tm, Dm), write(Dm), nl,\n        rbi(Dm, Tm2), write(Tm2).\n\n\n```\n\n## sample \u30b3\u30fc\u30c9\n\n\n### TAPL \u6f14\u7fd26.1.1\n\n\n```\n\ngo11 :-                                     % C0\n        test2(tm_abs(s:_, tm_abs(z:_, tm_var(z)))).\ngo12 :-                                     % C2\n        test2(tm_abs(s:_, tm_abs(z:_,\n                                tm_app(tm_var(s), tm_app(tm_var(s), tm_var(z)))))).\ngo13 :-                                     % plus\n        test2(tm_abs(m,\n                     tm_abs(n,\n                            tm_abs(s,\n                                   tm_abs(z,\n                                          tm_app(tm_var(m),\n                                                 tm_app(tm_var(s),\n                                                        tm_app(tm_app(tm_var(n), tm_var(s)),\n                                                               tm_var(z))))))))).\n\n\n```\n\n### \u578b\u6ce8\u91c8\u306e\u3042\u308b\u5834\u5408\n\n\n```\n\ngo14 :-\n        Tm = tm_abs(a : ty_Bool,\n                    tm_abs(b : ty_Bool -> ty_Bool,\n                           tm_app(tm_var(b),\n                                  tm_app(tm_var(b), tm_var(a))))),\n        test2(Tm).\n\n\n```\n\n### \u81ea\u7531\u5909\u6570\u306e\u3042\u308b\u5834\u5408\n\n\n```\n\ngo15 :-\n        test2(tm_app(tm_abs(s:_, tm_abs(z:_, tm_var(z))),\n                     tm_var(x))).\n\n\n```\n\n# \u88dc\u8db3\u8aac\u660e\n\n## \u6ce81\n\u672c\u8cc7\u6599\u3067\u306f de Bruijn Index \u30920\u304b\u3089\u4f7f\u7528\u3059\u308b\u3002\n1\u304b\u3089\u306b\u3059\u308b\u5834\u5408\u306f\u3001\u300c(*1)\u300d\u306e\u7b87\u6240\u306e\u300c0\u300d\u3092\u300c1\u300d\u306b\u5909\u66f4\u3059\u308b\u3002\n\n## \u6ce82\n\nde Bruijn Index\u3067\u306f\u306a\u3044\u4e00\u822c\u306e\u30e9\u30e0\u30c0\u5f0f\u306e\u5834\u5408\u306f\u3001\u6587\u8108\u3092\u300c\u5909\u6570\u540d\uff1a\u578b\u300d\u306e\u30ea\u30b9\u30c8\u3067\u4fdd\u6301\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u5909\u6570X\u306e\u578bTB\u3092member\u8ff0\u8a9e\u3092\u4f7f\u3063\u3066\u3067\u898b\u3064\u3051\u308b\u3053\u3068\u306b\u306a\u308b\u3002member(X:TB, CTX)\u3002\u4e00\u822c\u306e\u30e9\u30e0\u30c0\u5f0f\u306e\u5834\u5408\u306f\u3001\u540c\u3058\u540d\u524d\u306e\u5909\u6570\u304c\u5b58\u5728\u3057\u30b9\u30b3\u30fc\u30d7\u306b\u3088\u3063\u3066\u306e\u610f\u5473\u304c\u7570\u306a\u308b\u3002\u3053\u306e\u3068\u304d\u3001member\u306f\u8907\u6570\u89e3\u3092\u6c42\u3081\u3066\u3057\u307e\u3046\u3002\u3057\u304b\u3057\u3001\u305d\u306e\u5834\u5408\u3067\u3082\u5fc5\u305a\u4e00\u756a\u5916\u5074\u306e\u3001\u3064\u307e\u308a\u6700\u521d\u306b\u898b\u3064\u3051\u305f\u3082\u306e\u3092\u4f7f\u308f\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\nmember\u8ff0\u8a9e\u306e\u975e\u6c7a\u5b9a\u6027\u3092\u6bba\u3059\u305f\u3081\u306bcut\u30aa\u30da\u30ec\u30fc\u30bf\u5165\u308c\u308b\u3002\n\n## \u8ab2\u984c\n\n1. \u7dcf\u79f0\u578b(generics)\u3078\u306e\u62e1\u5f35\uff1acopy_term\u3092\u4f7f\u3046\uff1f\n2. System F \u3078\u306e\u62e1\u5f35\uff1a\n\n\n# \u53c2\u8003\u6587\u732e\n\n1. Benjamin C. Pierce\u3001\u4f4f\u4e95 \u76e3\u8a33\u300c\u578b\u30b7\u30b9\u30c6\u30e0\u5165\u9580 \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u3068\u578b\u306e\u7406\u8ad6\u300d\u30aa\u30fc\u30e0\u793e\n2. Benjamin C. Pierce\u4ed6\u3001\u6885\u6751\u4ed6\u8a33\u300c\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u306e\u57fa\u790e\u300d\u3001http://proofcafe.org/sf/\n3. SWI-Prolog\u3001http://www.swi-prolog.org/\n4. GNU Prolog\u3001http://www.gprolog.org/\n\n\n```\n", "tags": ["Prolog", "TaPL", "SWI-Prolog"]}