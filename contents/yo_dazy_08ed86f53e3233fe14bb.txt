{"context": "\n\n\u306f\u3058\u3081\u306b\n\n\n\nJenkins\u304b\u3089Ansible\u3092\u5b9f\u884c\u3055\u305b\u307e\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fWindows\u3067\u3084\u308d\u3046\u304b\u306a\u30fb\u30fb\u30fb\u3068\n\u3010\u4f5c\u6210\u8005\u3088\u308a\u3011\n\u3000qiita\u521d\u6295\u7a3f\u3067\u3082\u3061\u308d\u3093MarkDown\u3082\u521d\u3081\u3066\uff01\u898b\u3065\u3089\u304b\u3063\u305f\u3089\u3054\u3081\u3093\u306a\u3055\u3044\n\uff5e\u3053\u306e\u30da\u30fc\u30b8\u3067\u3084\u308b\u3053\u3068\uff5e\n\u25a0AWS\u3067\u74b0\u5883\u69cb\u7bc9\uff08RHEL7X2,Win2k12std)\n\u25a0Ansible\u5c0e\u5165\n\u25a0Playbook\u4f5c\u6210\n\u25a0Ansible\u5b9f\u884c\uff08Linux->Linux)\n\u25a0Ansible\u5b9f\u884c\uff08Linux->Windows)\n\n\n\u25a0\u74b0\u5883\n\u25a1OS\uff1aRHEL7\n\u25a1SW:Ansible 2.2\n\u25a1SW:Jenkins 2.33\n\n\n\u25a0EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\u203bAnsible\u3084\u3089Jenkins\u3084\u3089\u3092\u5c0e\u5165\u3059\u308b\u30b5\u30fc\u30d0\u3092\u4f5c\u308a\u307e\u3059\n\n\n\n\u9805\u76ee\n\u8a2d\u5b9a\n\n\n\n\nAMI\nRed Hat Enterprise Linux 7.3 (HVM), SSD Volume Type\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\nT2.micro\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u30c7\u30d5\u30a9\u30eb\u30c8\n\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\n\u30c7\u30d5\u30a9\u30eb\u30c8\uff08\u4e00\u756a\u4e0a\uff09\n\n\n\u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u6709\u52b9\u5316\n\n\n\u30b9\u30c8\u30ec\u30fc\u30b8\n10GB\uff08\u30c7\u30d5\u30a9\u30eb\u30c8)\n\n\nName\nJenAnsi\n\n\n\n\n\u25a0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af(\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7)\n\n\n\n\u30bf\u30a4\u30d7\n\u30d7\u30ed\u30c8\u30b3\u30eb\n\u30dd\u30fc\u30c8\u7bc4\u56f2\n\u9001\u4fe1\u5143\n\u7406\u7531\n\n\n\n\nSSH\nTCP\n22\n\u30ab\u30b9\u30bf\u30e0\uff1a0.0.0.0/0\n\u30c7\u30d5\u30a9\u30eb\u30c8\n\n\n\u3059\u3079\u3066\u306eICMP\nICMP\n0-65536\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\nPING\n\n\nHTTP\nTCP\n80\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\nJenkins\u3067\u4f7f\u7528\n\n\nHTTPS\nTCP\n443\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\n\u5ff5\u306e\u305f\u3081\n\n\nWinRM-HTTP\nTCP\n5985\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\nAnsible->Win\n\n\nWinRM-HTTPS\nTCP\n5986\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\nAnsible->Win\n\n\n\u30ab\u30b9\u30bf\u30e0TCP\u30eb\u30fc\u30eb\nTCP\n8080\n\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0\nJenkins\u30dd\u30fc\u30c8\n\n\n\n\u5f8c\u306f\u307d\u3061\u3063\u3068\u30fb\u30fb\u30fb\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u51fa\u6765\u305f\u3089TeraTerm\u3067\u9375\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u30a4\u30f3\n\uff08\u9375\u306f\u81ea\u52d5\u7684\u306b\u3064\u304f\u3063\u3066\u304f\u308c\u307e\u3059\uff09\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u304d\u305f\u3089\u30fb\u30fb\u30fbroot\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n\n\n\u25a0root\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u8a2d\u5b9a\u3068\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u4ed8\u4e0e\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u5f53\u521d\u306froot\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002SSH\u306f\u3082\u3061\u308d\u3093\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3082\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\n\u307e\u305f\u3001\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u3082\u5909\u3048\u3066\u307f\u307e\u3059\u3002\u672c\u5f53\u306fPublicDNS\u3082\u5909\u66f4\u3055\u305b\u305f\u3044\u3093\u3060\u3051\u3069\u30fb\u30fb\u30fborz\n\nroot\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u4ed8\u4e0e\nssh\u3067root\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n\n[ec2-user@ip-XXX-XX-XX-XX ~]$\n[ec2-user@ip-XXX-XX-XX-XX ~]$ sudo passwd root\nNew password:\nRetype new password:\npasswd: all authentication tokens updated successfully.\n[ec2-user@ip-XXX-XX-XX-XX ~]$ su\nPassword:\n[ec2-user@ip-XXX-XX-XX-XX ~]# vi /etc/ssh/sshd_conf\n(def)#PermitRootLogin yes\n(edi)PermitRootLogin yes\n-------------------------------\n(def)PasswordAuthentication no\n(edi)PasswordAuthentication yes\n-------------------------------\n[ec2-user@ip-XXX-XX-XX-XX ~]# systemctl restart sshd\n[ec2-user@ip-XXX-XX-XX-XX ~]# \n\n\nLinux\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n\n\n/etc/hostname\n(def)ip-XXX-XX-XX-XX.us-west-2.compute.internal\n(edi)server1\n-------------------------------\n:wq\n\n\n\n/etc/hosts\n(def)127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n(edi)127.0.0.1   server1 localhost.localdomain localhost\n-------------------------------\n:wq\n\n\n\n/etc/sysconfig/network\n\u203b\u4ee5\u4e0b\u6700\u7d42\u884c\u306b\u8ffd\u52a0\n(add)NETWORKING_IPV6=no\n(add)HOSTNAME=server1\n-------------------------------\n:wq\n\n\n\n\n/etc/cloud/cloud.cfg\n\u203b\u4ee5\u4e0b\u6700\u7d42\u884c\u306b\u8ffd\u52a0\n(add)preserve_hostname: true\n-------------------------------\n:wq\n\n\n\n[ec2-user@ip-XXX-XX-XX-XX ~]# reboot\n\n\u5f8c\u306f\u3044\u3064\u3082\u3069\u304a\u308aTeraTerm\u3067\u30ed\u30b0\u30a4\u30f3\uff01\uff01\uff01\n\u518d\u30ed\u30b0\u30a4\u30f3\u5f8c\nLast login: Tue xxx xx hh:mm:ss yyyy from xxx-xxx-x-xxx.rev.home.ne.jp\n[root@server1 ~]#\n\n\nWindows\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n\n\nWindows\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n#Powershell\u8d77\u52d5\nPS C:\\Users\\Administrator> Rename-Computer <hostname> -Force -Restart\n(\u5373\u518d\u8d77\u52d5\u304c\u5165\u308b)\n\n\n\n\n\n\u25a0Ansible\u5c0e\u5165\nAnsible\u306f\u3044\u308d\u3044\u308d\u306a\u4f5c\u696d\u3092\u30b3\u30fc\u30c9\u3067\u66f8\u3044\u3066\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fAnsible\u306e\u30b5\u30fc\u30d0\u306fRHEL7\u3092\u4f7f\u3063\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fWindows 2012 Std\u3068RHEL7\u30671\u53f0\u306eAnsible\u304b\u30892\u53f0\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3084\u308d\u3046\u304b\u3068\u601d\u3044\u307e\u3059\n\n\n\nName\nserver1\nclient-lin\nclient-win\n\n\n\n\nOS\nRHEL7\nRHEL7\nWindows 2012 Std\n\n\n\u5f79\u5272\nAnsible,Jenkins\n\u8003\u3048\u4e2d\n\u8003\u3048\u4e2d\n\n\nS/W\nAnsible,Jenkins\n\u8003\u3048\u4e2d\n\u8003\u3048\u4e2d\n\n\n\n\n\nAnsible\u3092\u5c0e\u5165(2.2)\n\u203bAMI(RHEL7)\u306fAmazonLinux\u3068\u9055\u3063\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\uff61\uff61\uff61\n\u3000\u3000\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5c0e\u5165\u304b\u3089\u306f\u3058\u3081\u307e\u3059\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\n\n\nwget\uff1a\u3044\u308d\u3044\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u5fc5\u8981\nepel-release\uff1aAnsible\u306f\u3053\u306e\u4e2d\u306b\u5165\u3063\u3066\u3044\u307e\u3059\npywinrm\uff1aAnsible -> Windows \u306e\u305f\u3081\u306b\u5fc5\u8981\u3067\u3059\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u5c0e\u5165(wget,epel-release,ansible)\n\n\n\n[root@ip-XXX-XX-XX-XX ~]# yum -y install wget\n<\u4e2d\u7565>\nInstalled:\n  wget.x86_64 0:1.14-13.el7\n\nComplete!\n[root@ip-XXX-XX-XX-XX ~]# wget http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm\n<\u4e2d\u7565>\nYYYY-MM-DD HH:MM:SS (348 KB/s) - \u2018epel-release-7-8.noarch.rpm\u2019 saved [14612/14612]\n[root@ip-XXX-XX-XX-XX ~]#ls\nepel-release-7-8.noarch.rpm\n[root@ip-XXX-XX-XX-XX ~]# rpm -ivh epel-release-7-8.noarch.rpm\n<\u4e2d\u7565>\nUpdating / installing...\n   1:epel-release-7-8                 ################################# [100%]\n[root@ip-XXX-XX-XX-XX ~]# rpm -qa | grep epel\nepel-release-7-8.noarch\n[root@ip-XXX-XX-XX-XX ~]# yum -y install ansible\n<\u4e2d\u7565>\nComplete!\n[root@ip-XXX-XX-XX-XX ~]# ansible --version\nansible 2.2.0.0\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = Default w/o overrides\n\nAnsible\u5c0e\u5165\u5b8c\u4e86\uff01\uff01\uff01\n\n\u6b21\u306fWindows\u8ee2\u9001\u306e\u305f\u3081\u306e\u6e96\u5099\n\npywinrm\u3092\u5c0e\u5165\n\u3000\u203bYUM\u3060\u3068\u5931\u6557\u3057\u307e\u3059\n\n\u3010PIP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3011\n[root@server1 /]# yum -y install python-pip\n<\u4e2d\u7565>\ncomplete!\n[root@server1 /]# \n\u3010Pywinrm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3011\n[root@server1 /]# pip install pywinrm\n<\u4e2d\u7565>\nSuccessfully installed python-ntlm3-1.0.2 pywinrm-0.2.1 requests-2.12.1 requests-ntlm-0.3.0 xmltodict-0.10.2\n\n\u73fe\u6642\u70b9\u3067Ansible\u3092\u642d\u8f09\u3055\u305b\u305f\u30b5\u30fc\u30d0\u304c\u5b8c\u6210\uff01\n\u6b21\u306b\u3084\u308b\u3053\u3068\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u308a\u307e\u3059\uff01\n\u540c\u3058\u304fEC2\u3092\u4f5c\u3063\u3066\u3084\u308b\u306e\u3067\u5185\u5bb9\u7b49\u3005\u306f\u5272\u611b\uff01\uff01\n\n\n\u25a0Playbook\u4f5c\u6210\n\u30c6\u30b9\u30c8\u306a\u306e\u3067\u7c21\u5358\u306aPlaybook\u3092\u4f5c\u6210\n\u4f5c\u308a\u65b9\uff1a\n\u4e0b\u8a18\u306e\u69cb\u6210\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\nmkdir\u3068touch\u3068vi\nplaybook\n|__group_vars                // \u4f7f\u7528\u3059\u308b\u5909\u6570\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\n|   |__linu.yml              // \u30b0\u30eb\u30fc\u30d7[linu]\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\n|   |__wind.yml              // \u30b0\u30eb\u30fc\u30d7[wind]\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\n|__hosts                     // \u5b9f\u884c\u5bfe\u8c61\u3092\u8a18\u8f09\n|__library                   // \u81ea\u4f5c\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u683c\u7d0d\n|__roles                     // \u30ed\u30fc\u30eb\u683c\u7d0d\n|   |__linrole               // Linux\u7528\u30ed\u30fc\u30eb\uff08FileCopy\uff09\n|   |  |__file\n|   |       |__sample.yml\n|   |__|__tasks\n|   |       |__main.yml\n|   |__winrole               // Windows\u7528\u30ed\u30fc\u30eb\uff08FileCopy\uff09\n|      |__file\n|         |__sample.yml\n|      |__tasks\n|         |__main.yml\n|__sitelin.yml               // Linux\u7528role\u5b9f\u884cInventory\n|__sitewin.yml               // Windows\u7528role\u5b9f\u884cInventory\n\n\n/playbook/roles/linrole/tasks/main.yml\n---\n- name : For Linux\n  copy : src={{ SLFILE }} dest={{ DLPATH }}\n\n\n\n/playbook/group_vars/linu.yml\n---\nansible_ssh_user: root\nansible_password: <\u30d1\u30b9\u30ef\u30fc\u30c9>\nansible_ssh_port: 22\nansible_connection: ssh\nSLFILE: /playbook/roles/linrole/file/\nDLFILE: /tmp/\n\n\n\n/playbook/roles/winrole/tasks/main.yml\n---\n- name : For Windows\n  win_copy : src={{ SWFILE }} dest={{ DWPATH }}\n\n\n\n/playbook/group_vars/wind.yml\n---\nansible_ssh_user: administrator\nansible_password: <\u30d1\u30b9\u30ef\u30fc\u30c9>\nansible_ssh_port: 5986\nansible_connection: winrm\nSWFILE: /playbook/roles/winrole/file/\nDWFILE: C:\\temp\n\n\n\n/playbook/sitelin.yml\n- name: Linux Playbook\n  hosts: linu\n  become: yes\n  roles:\n    - linrole\n\n\n\n/playbook/sitewin.yml\n- name: Windows Playbook\n  hosts: wind\n  roles:\n    - winrole\n\n\n\n/playbook/sitelin.yml\n- name: Linux Playbook\n  hosts: linu\n  become: yes\n  roles:\n    - linrole\n\n\n\n/playbook/hosts\n[wind]\nec2-xx-xx-xx-xx.us-west-2.compute.amazonaws.com\n\u203b\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u3092\u5909\u66f4\u3057\u3066\u3082PublicDNS\u306b\u8a18\u8f09\u3055\u308c\u305f\u540d\u524d\u3058\u3083\u306a\u3044\u3068\u51fa\u6765\u306a\u3044\uff08\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u306fPublicDNS\u306e\u5909\u66f4\u306f\u3057\u3066\u3044\u306a\u3044\u304b\u3089\uff1f\uff09\n[linu]\nclient-lin\n\n\n\u25a0Ansible\u5b9f\u884c\u306e\u6761\u4ef6\u3092\u78ba\u8a8d\nServer\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u540d\u524d\u89e3\u6c7a\u3068\u6642\u523b\u540c\u671f\u3068\u901a\u4fe1\u30dd\u30fc\u30c8\u304c\u958b\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u6761\u4ef6\n(\u6642\u523b\u540c\u671f\u3068SSH\u306f\u3059\u3067\u306b\u8a2d\u5b9a\u6e08\u307f\u306e\u305f\u3081\u3053\u3053\u3067\u306f\u540d\u524d\u89e3\u6c7a\u3092\u78ba\u8a8d)\n\n\u540d\u524d\u89e3\u6c7a\n\n[root@server1 /]# ping client-lin\nPING client-lin (PublicDNS) 56(84) bytes of data.\n64 bytes from client-lin (PublicDNS): icmp_seq=1 ttl=63 time=0.477 ms\n\n[root@server1 /]# ping client-win\nPING client-win (PublicDNS) 56(84) bytes of data.\n64 bytes from client-win (PublicDNS): icmp_seq=1 ttl=63 time=0.477 ms\n\n\n\u25a0Playbook\u5b9f\u884c(Linux->Linux)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\n\u5b9f\u884c\u524d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u78ba\u8a8d\n[root@client-lin tmp]# ls\n[root@client-lin tmp]#\n\n\n\nAnsible\u306e\u5b9f\u884c\n[root@server1 /]# ansible-playbook -i /playbook/hosts /playbook/sitelin.yml\n\nPLAY [Linux Playbook] **********************************************************\n\nTASK [setup] *******************************************************************\nok: [client-lin]\n\nTASK [linrole : For Linux] *****************************************************\nchanged: [client-lin]\n\nPLAY RECAP *********************************************************************\nclient-lin                 : ok=2    changed=1    unreachable=0    failed=0\n\n[root@server1 /]#\n\n\n\n\u5b9f\u884c\u5f8c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u78ba\u8a8d\n[root@client-lin tmp]# ls\nsample.yml\n[root@client-lin tmp]#\n\n\n\n\u25a0Playbook\u5b9f\u884c(Linux->Windows)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\u203b\u3053\u306e\u307e\u307e\u3084\u308b\u3068\u5931\u6557\u3057\u307e\u3059\n\u7406\u7531\uff1a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u8a2d\u5b9a\u304c\u4f55\u3082\u3055\u308c\u3066\u3044\u306a\u3044\n\u5fc5\u8981\u306a\u8a2d\u5b9a\uff1a\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\n\u30fbPowershell\u3000\u6709\u52b9\u5316\n\u30fbWinRM\u8a2d\u5b9a\n\u3000\uff0dBasic\u8a8d\u8a3c\n\u3000\uff0dHTTPS\u30ea\u30b9\u30ca\u30fc\u8a8d\u8a3c\n\u307e\u305a\u306fPowershell\u3092\u7ba1\u7406\u8005\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u30d1\u30ef\u30fc\u30b7\u30a7\u30eb\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u4eca\u56de\u306fBypass\u306b\u5909\u66f4\u3057\u3066\u5168\u90e8\u8a31\u53ef\u306b\u3057\u307e\u3059\uff01\u4e00\u756a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7518\u3044\u3067\u3059\uff01\n\nPowershell\u6709\u52b9\u5316\nPS C:\\Users\\Administrator> Get-ExecutionPolicy\nRemoteSigned\nPS C:\\Users\\Administrator> Set-ExecutionPolicy bypass -force\nPS C:\\Users\\Administrator> Get-ExecutionPolicy\nbypass\nPS C:\\Users\\Administrator>\n\n\n\u6b21\u306bWinRM\u3068\u3044\u3046\u30ea\u30e2\u30fc\u30c8\u7ba1\u7406\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\nAnsible\u3067\u901a\u4fe1\u3059\u308b\u3068\u304d\u306fSSH\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3051\u3069\u5f53\u7136\u306a\u304c\u3089Windows\u306b\u306f\u3042\u308a\u307e\u305b\u3093\uff01\u305d\u306e\u305f\u3081Ansible\u304b\u3089Windows\u306b\u901a\u4fe1\u3092\u884c\u3046\u3068\u304d\u306fWinRM\u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u901a\u4fe1\u3092\u3057\u307e\u3059\uff08OpenSSH\u3092\u4f7f\u3063\u3066\u5f37\u5f15\u306b\u3084\u308b\u3063\u3066\u3053\u3068\u3082\u3068\u308a\u3042\u3048\u305a\u51fa\u6765\u307e\u3059\uff09\n\u5909\u66f4\u7b87\u6240\uff1aAllowUnencrypted = False -> True\n\u610f\u5473\uff1aLinux\u306eWinRM\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\n\u5909\u66f4\u7b87\u6240\uff1aAuth:Basic = False -> True\n\u610f\u5473\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u5e73\u6587\u8a31\u53ef\n\nWinRM\u8a2d\u5b9a\nPS C:\\Users\\Administrator> winrm set winrm/config/service/auth '@{Basic=\"true\"}'\nPS C:\\Users\\Administrator>winrm set winrm/config/service '@{AllowUnencrypted=\"true\"}'\nPS C:\\Users\\Administrator> winrm get winrm/config/service\nService\n    RootSDDL = O:NSG:BAD:P(A;;GA;;;BA)(A;;GR;;;IU)S:P(AU;FA;GA;;;WD)(AU;SA;GXGW;;;WD)\n    MaxConcurrentOperations = 4294967295\n    MaxConcurrentOperationsPerUser = 1500\n    EnumerationTimeoutms = 240000\n    MaxConnections = 300\n    MaxPacketRetrievalTimeSeconds = 120\n    AllowUnencrypted = true (Defalt:False)\n    Auth\n        Basic = true (Defalt:False)\n        Kerberos = true\n        Negotiate = true\n        Certificate = false\n        CredSSP = false\n        CbtHardeningLevel = Relaxed\n    DefaultPorts\n        HTTP = 5985\n        HTTPS = 5986\n    IPv4Filter = *\n    IPv6Filter = *\n    EnableCompatibilityHttpListener = false\n    EnableCompatibilityHttpsListener = false\n    CertificateThumbprint\n    AllowRemoteAccess = true\n\nPS C:\\Users\\Administrator>\n\n\n\n\u25a0Playbook\u518d\u5b9f\u884c(Linux->Windows)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\nAnsible\u306e\u5b9f\u884c(Windows)\n[root@server1 /]# ansible-playbook -i /playbook/hosts /playbook/sitewin.yml\n\nPLAY [Windows Playbook] ********************************************************\n\nTASK [setup] *******************************************************************\nok: [ec2-35-164-42-228.us-west-2.compute.amazonaws.com]\n\nTASK [winrole : For Windows] ***************************************************\nchanged: [ec2-35-164-42-228.us-west-2.compute.amazonaws.com]\n\nPLAY RECAP *********************************************************************\nec2-35-164-42-228.us-west-2.compute.amazonaws.com : ok=2    changed=1    unreachable=0    failed=0\n\n[root@server1 /]#\n\n\n\u6210\u529f\uff01\uff01\uff01\n\u9577\u3059\u304e\u305f\u304b\u3089\u3044\u3063\u305f\u3093\u304d\u308a\u307e\u3059\n\n\u307e\u3068\u3081\n\u4eca\u56de\u306fAWS\u306e\u4f5c\u6210\u3068Root\u30ed\u30b0\u30a4\u30f3\u3068HOSTNAME\u5909\u66f4\u3092\u3057\u307e\u3057\u305f\u3002Server\u306bAnsible\u3092\u5165\u308c\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u306fWindows\u3068Linux\u3067\u53cc\u65b9\u306bAnsible\u306e\u5b9f\u884c\u304c\u53ef\u80fd\u3067\u3042\u308b\u3053\u3068\u304c\u8a3c\u660e\u3067\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\u6b21\u56de\uff1aAnsible\u30b5\u30fc\u30d0\u306bJenkins\u3092\u5c0e\u5165\u3057Ansible\u5b9f\u884c\u30b8\u30e7\u30d6\u3092\u4f5c\u6210\nJenkins\u304b\u3089Ansible\u3092\u5b9f\u884c(2/2)\nhttp://qiita.com/yo_dazy/items/468524ca0ac11cdc2d41\n#####\u306f\u3058\u3081\u306b<br>\n***\n***\nJenkins\u304b\u3089Ansible\u3092\u5b9f\u884c\u3055\u305b\u307e\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fWindows\u3067\u3084\u308d\u3046\u304b\u306a\u30fb\u30fb\u30fb\u3068<br>\n\u3010\u4f5c\u6210\u8005\u3088\u308a\u3011\n\u3000qiita\u521d\u6295\u7a3f\u3067\u3082\u3061\u308d\u3093MarkDown\u3082\u521d\u3081\u3066\uff01\u898b\u3065\u3089\u304b\u3063\u305f\u3089\u3054\u3081\u3093\u306a\u3055\u3044\n\uff5e\u3053\u306e\u30da\u30fc\u30b8\u3067\u3084\u308b\u3053\u3068\uff5e\n\u25a0AWS\u3067\u74b0\u5883\u69cb\u7bc9\uff08RHEL7X2,Win2k12std)\n\u25a0Ansible\u5c0e\u5165\n\u25a0Playbook\u4f5c\u6210\n\u25a0Ansible\u5b9f\u884c\uff08Linux->Linux)\n\u25a0Ansible\u5b9f\u884c\uff08Linux->Windows)\n\n***\n#####\u25a0\u74b0\u5883\n\u25a1OS\uff1aRHEL7\n\u25a1SW:Ansible 2.2\n\u25a1SW:Jenkins 2.33\n***\n#####\u25a0EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\u203bAnsible\u3084\u3089Jenkins\u3084\u3089\u3092\u5c0e\u5165\u3059\u308b\u30b5\u30fc\u30d0\u3092\u4f5c\u308a\u307e\u3059\n\n|\u9805\u76ee|\u8a2d\u5b9a| \n|:-:|:-:|\n|AMI|Red Hat Enterprise Linux 7.3 (HVM), SSD Volume Type |   \n|\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7|T2.micro|\n|\u30cd\u30c3\u30c8\u30ef\u30fc\u30af|\u30c7\u30d5\u30a9\u30eb\u30c8|\n|\u30b5\u30d6\u30cd\u30c3\u30c8|\u30c7\u30d5\u30a9\u30eb\u30c8\uff08\u4e00\u756a\u4e0a\uff09|\n|\u81ea\u52d5\u5272\u308a\u5f53\u3066\u30d1\u30d6\u30ea\u30c3\u30afIP|\u6709\u52b9\u5316|\n|\u30b9\u30c8\u30ec\u30fc\u30b8|10GB\uff08\u30c7\u30d5\u30a9\u30eb\u30c8)|\n|Name|JenAnsi|\n\n#####\u25a0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af(\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7)\n\n\n|\u30bf\u30a4\u30d7|\u30d7\u30ed\u30c8\u30b3\u30eb|\u30dd\u30fc\u30c8\u7bc4\u56f2|\u9001\u4fe1\u5143|\u7406\u7531|\n|:-:|:-:|:-:|:-:|:-:||:-:|\n|SSH|TCP|22|\u30ab\u30b9\u30bf\u30e0\uff1a0.0.0.0/0|\u30c7\u30d5\u30a9\u30eb\u30c8|\n|\u3059\u3079\u3066\u306eICMP|ICMP|0-65536|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|PING|\n|HTTP|TCP|80|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|Jenkins\u3067\u4f7f\u7528|\n|HTTPS|TCP|443|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|\u5ff5\u306e\u305f\u3081|\n|WinRM-HTTP|TCP|5985|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|Ansible->Win|\n|WinRM-HTTPS|TCP|5986|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|Ansible->Win|\n|\u30ab\u30b9\u30bf\u30e0TCP\u30eb\u30fc\u30eb|TCP|8080|\u4efb\u610f\u306e\u5834\u6240\uff1a0.0.0.0/0|Jenkins\u30dd\u30fc\u30c8|\n\n\u5f8c\u306f\u307d\u3061\u3063\u3068\u30fb\u30fb\u30fb\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u51fa\u6765\u305f\u3089TeraTerm\u3067\u9375\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u30a4\u30f3\n\uff08\u9375\u306f\u81ea\u52d5\u7684\u306b\u3064\u304f\u3063\u3066\u304f\u308c\u307e\u3059\uff09\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u304d\u305f\u3089\u30fb\u30fb\u30fbroot\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n***\n#####\u25a0root\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u8a2d\u5b9a\u3068\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u4ed8\u4e0e\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u5f53\u521d\u306froot\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002SSH\u306f\u3082\u3061\u308d\u3093\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3082\u306a\u3044\u72b6\u614b\u3067\u3059\u3002\n\u307e\u305f\u3001\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u3082\u5909\u3048\u3066\u307f\u307e\u3059\u3002\u672c\u5f53\u306fPublicDNS\u3082\u5909\u66f4\u3055\u305b\u305f\u3044\u3093\u3060\u3051\u3069\u30fb\u30fb\u30fborz\n\n\n- root\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u4ed8\u4e0e\n- ssh\u3067root\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\n\n```\n[ec2-user@ip-XXX-XX-XX-XX ~]$\n[ec2-user@ip-XXX-XX-XX-XX ~]$ sudo passwd root\nNew password:\nRetype new password:\npasswd: all authentication tokens updated successfully.\n[ec2-user@ip-XXX-XX-XX-XX ~]$ su\nPassword:\n[ec2-user@ip-XXX-XX-XX-XX ~]# vi /etc/ssh/sshd_conf\n(def)#PermitRootLogin yes\n(edi)PermitRootLogin yes\n-------------------------------\n(def)PasswordAuthentication no\n(edi)PasswordAuthentication yes\n-------------------------------\n[ec2-user@ip-XXX-XX-XX-XX ~]# systemctl restart sshd\n[ec2-user@ip-XXX-XX-XX-XX ~]# \n```\n\n- Linux\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n\n```ruby:/etc/hostname\n(def)ip-XXX-XX-XX-XX.us-west-2.compute.internal\n(edi)server1\n-------------------------------\n:wq\n```\n\n```ruby:/etc/hosts\n(def)127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n(edi)127.0.0.1   server1 localhost.localdomain localhost\n-------------------------------\n:wq\n```\n```ruby:/etc/sysconfig/network\n\u203b\u4ee5\u4e0b\u6700\u7d42\u884c\u306b\u8ffd\u52a0\n(add)NETWORKING_IPV6=no\n(add)HOSTNAME=server1\n-------------------------------\n:wq\n\n```\n\n\n```ruby:/etc/cloud/cloud.cfg\n\u203b\u4ee5\u4e0b\u6700\u7d42\u884c\u306b\u8ffd\u52a0\n(add)preserve_hostname: true\n-------------------------------\n:wq\n\n```\n```\n[ec2-user@ip-XXX-XX-XX-XX ~]# reboot\n```\n\n\u5f8c\u306f\u3044\u3064\u3082\u3069\u304a\u308aTeraTerm\u3067\u30ed\u30b0\u30a4\u30f3\uff01\uff01\uff01\n\n```\n\u518d\u30ed\u30b0\u30a4\u30f3\u5f8c\nLast login: Tue xxx xx hh:mm:ss yyyy from xxx-xxx-x-xxx.rev.home.ne.jp\n[root@server1 ~]#\n```\n\n- Windows\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n\n```ruby:Windows\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u5909\u66f4\n#Powershell\u8d77\u52d5\nPS C:\\Users\\Administrator> Rename-Computer <hostname> -Force -Restart\n(\u5373\u518d\u8d77\u52d5\u304c\u5165\u308b)\n\n```\n***\n#####\u25a0Ansible\u5c0e\u5165\nAnsible\u306f\u3044\u308d\u3044\u308d\u306a\u4f5c\u696d\u3092\u30b3\u30fc\u30c9\u3067\u66f8\u3044\u3066\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fAnsible\u306e\u30b5\u30fc\u30d0\u306fRHEL7\u3092\u4f7f\u3063\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fWindows 2012 Std\u3068RHEL7\u30671\u53f0\u306eAnsible\u304b\u30892\u53f0\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3084\u308d\u3046\u304b\u3068\u601d\u3044\u307e\u3059\n\n| Name | server1 | client-lin | client-win |\n|:-:|:-:|:-:|:-:|\n| OS | RHEL7 | RHEL7 | Windows 2012 Std |\n| \u5f79\u5272 | Ansible,Jenkins | \u8003\u3048\u4e2d | \u8003\u3048\u4e2d |\n| S/W | Ansible,Jenkins | \u8003\u3048\u4e2d | \u8003\u3048\u4e2d |\n\n***\n- Ansible\u3092\u5c0e\u5165(2.2)<br>\n  \u203bAMI(RHEL7)\u306fAmazonLinux\u3068\u9055\u3063\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5165\u3063\u3066\u3044\u307e\u305b\u3093\uff61\uff61\uff61\n\u3000\u3000\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u5c0e\u5165\u304b\u3089\u306f\u3058\u3081\u307e\u3059<br>\n    - \u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\n        - wget\uff1a\u3044\u308d\u3044\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u5fc5\u8981\n        - epel-release\uff1aAnsible\u306f\u3053\u306e\u4e2d\u306b\u5165\u3063\u3066\u3044\u307e\u3059\n        - pywinrm\uff1aAnsible -> Windows \u306e\u305f\u3081\u306b\u5fc5\u8981\u3067\u3059\n    - \u30d1\u30c3\u30b1\u30fc\u30b8\u5c0e\u5165(wget,epel-release,ansible)\n\n```\n[root@ip-XXX-XX-XX-XX ~]# yum -y install wget\n<\u4e2d\u7565>\nInstalled:\n  wget.x86_64 0:1.14-13.el7\n\nComplete!\n[root@ip-XXX-XX-XX-XX ~]# wget http://dl.fedoraproject.org/pub/epel/7/x86_64/e/epel-release-7-8.noarch.rpm\n<\u4e2d\u7565>\nYYYY-MM-DD HH:MM:SS (348 KB/s) - \u2018epel-release-7-8.noarch.rpm\u2019 saved [14612/14612]\n[root@ip-XXX-XX-XX-XX ~]#ls\nepel-release-7-8.noarch.rpm\n[root@ip-XXX-XX-XX-XX ~]# rpm -ivh epel-release-7-8.noarch.rpm\n<\u4e2d\u7565>\nUpdating / installing...\n   1:epel-release-7-8                 ################################# [100%]\n[root@ip-XXX-XX-XX-XX ~]# rpm -qa | grep epel\nepel-release-7-8.noarch\n[root@ip-XXX-XX-XX-XX ~]# yum -y install ansible\n<\u4e2d\u7565>\nComplete!\n[root@ip-XXX-XX-XX-XX ~]# ansible --version\nansible 2.2.0.0\n  config file = /etc/ansible/ansible.cfg\n  configured module search path = Default w/o overrides\n\nAnsible\u5c0e\u5165\u5b8c\u4e86\uff01\uff01\uff01\n```\n\n\u6b21\u306fWindows\u8ee2\u9001\u306e\u305f\u3081\u306e\u6e96\u5099\n\n- pywinrm\u3092\u5c0e\u5165<br>\n\u3000\u203bYUM\u3060\u3068\u5931\u6557\u3057\u307e\u3059\n\n```\n\u3010PIP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3011\n[root@server1 /]# yum -y install python-pip\n<\u4e2d\u7565>\ncomplete!\n[root@server1 /]# \n\u3010Pywinrm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3011\n[root@server1 /]# pip install pywinrm\n<\u4e2d\u7565>\nSuccessfully installed python-ntlm3-1.0.2 pywinrm-0.2.1 requests-2.12.1 requests-ntlm-0.3.0 xmltodict-0.10.2\n```\n\n\u73fe\u6642\u70b9\u3067Ansible\u3092\u642d\u8f09\u3055\u305b\u305f\u30b5\u30fc\u30d0\u304c\u5b8c\u6210\uff01\n\u6b21\u306b\u3084\u308b\u3053\u3068\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u308a\u307e\u3059\uff01\n\u540c\u3058\u304fEC2\u3092\u4f5c\u3063\u3066\u3084\u308b\u306e\u3067\u5185\u5bb9\u7b49\u3005\u306f\u5272\u611b\uff01\uff01\n\n***\n\n#####\u25a0Playbook\u4f5c\u6210\n\n\u30c6\u30b9\u30c8\u306a\u306e\u3067\u7c21\u5358\u306aPlaybook\u3092\u4f5c\u6210\n\u4f5c\u308a\u65b9\uff1a\n\u4e0b\u8a18\u306e\u69cb\u6210\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\nmkdir\u3068touch\u3068vi\n\n```\nplaybook\n|__group_vars                // \u4f7f\u7528\u3059\u308b\u5909\u6570\u30d5\u30a1\u30a4\u30eb\u3092\u683c\u7d0d\n|   |__linu.yml              // \u30b0\u30eb\u30fc\u30d7[linu]\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\n|   |__wind.yml              // \u30b0\u30eb\u30fc\u30d7[wind]\u3067\u4f7f\u7528\u3059\u308b\u5909\u6570\n|__hosts                     // \u5b9f\u884c\u5bfe\u8c61\u3092\u8a18\u8f09\n|__library                   // \u81ea\u4f5c\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u683c\u7d0d\n|__roles                     // \u30ed\u30fc\u30eb\u683c\u7d0d\n|   |__linrole               // Linux\u7528\u30ed\u30fc\u30eb\uff08FileCopy\uff09\n|   |  |__file\n|   |       |__sample.yml\n|   |__|__tasks\n|   |       |__main.yml\n|   |__winrole               // Windows\u7528\u30ed\u30fc\u30eb\uff08FileCopy\uff09\n|      |__file\n|         |__sample.yml\n|      |__tasks\n|         |__main.yml\n|__sitelin.yml               // Linux\u7528role\u5b9f\u884cInventory\n|__sitewin.yml               // Windows\u7528role\u5b9f\u884cInventory\n```\n\n```ruby:/playbook/roles/linrole/tasks/main.yml\n---\n- name : For Linux\n  copy : src={{ SLFILE }} dest={{ DLPATH }}\n```\n\n```ruby:/playbook/group_vars/linu.yml\n---\nansible_ssh_user: root\nansible_password: <\u30d1\u30b9\u30ef\u30fc\u30c9>\nansible_ssh_port: 22\nansible_connection: ssh\nSLFILE: /playbook/roles/linrole/file/\nDLFILE: /tmp/\n```\n```ruby:/playbook/roles/winrole/tasks/main.yml\n---\n- name : For Windows\n  win_copy : src={{ SWFILE }} dest={{ DWPATH }}\n```\n\n```ruby:/playbook/group_vars/wind.yml\n---\nansible_ssh_user: administrator\nansible_password: <\u30d1\u30b9\u30ef\u30fc\u30c9>\nansible_ssh_port: 5986\nansible_connection: winrm\nSWFILE: /playbook/roles/winrole/file/\nDWFILE: C:\\temp\n```\n```ruby:/playbook/sitelin.yml\n- name: Linux Playbook\n  hosts: linu\n  become: yes\n  roles:\n    - linrole\n```\n```ruby:/playbook/sitewin.yml\n- name: Windows Playbook\n  hosts: wind\n  roles:\n    - winrole\n```\n```ruby:/playbook/sitelin.yml\n- name: Linux Playbook\n  hosts: linu\n  become: yes\n  roles:\n    - linrole\n```\n```ruby:/playbook/hosts\n[wind]\nec2-xx-xx-xx-xx.us-west-2.compute.amazonaws.com\n\u203b\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u3092\u5909\u66f4\u3057\u3066\u3082PublicDNS\u306b\u8a18\u8f09\u3055\u308c\u305f\u540d\u524d\u3058\u3083\u306a\u3044\u3068\u51fa\u6765\u306a\u3044\uff08\u30db\u30b9\u30c8\u30cd\u30fc\u30e0\u306fPublicDNS\u306e\u5909\u66f4\u306f\u3057\u3066\u3044\u306a\u3044\u304b\u3089\uff1f\uff09\n[linu]\nclient-lin\n```\n\n\n\u25a0Ansible\u5b9f\u884c\u306e\u6761\u4ef6\u3092\u78ba\u8a8d\nServer\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u540d\u524d\u89e3\u6c7a\u3068\u6642\u523b\u540c\u671f\u3068\u901a\u4fe1\u30dd\u30fc\u30c8\u304c\u958b\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u6761\u4ef6\n(\u6642\u523b\u540c\u671f\u3068SSH\u306f\u3059\u3067\u306b\u8a2d\u5b9a\u6e08\u307f\u306e\u305f\u3081\u3053\u3053\u3067\u306f\u540d\u524d\u89e3\u6c7a\u3092\u78ba\u8a8d)\n\n- \u540d\u524d\u89e3\u6c7a\n\n```\n[root@server1 /]# ping client-lin\nPING client-lin (PublicDNS) 56(84) bytes of data.\n64 bytes from client-lin (PublicDNS): icmp_seq=1 ttl=63 time=0.477 ms\n\n[root@server1 /]# ping client-win\nPING client-win (PublicDNS) 56(84) bytes of data.\n64 bytes from client-win (PublicDNS): icmp_seq=1 ttl=63 time=0.477 ms\n```\n\n#####\u25a0Playbook\u5b9f\u884c(Linux->Linux)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\n```ruby:\u5b9f\u884c\u524d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u78ba\u8a8d\n[root@client-lin tmp]# ls\n[root@client-lin tmp]#\n```\n\n```ruby:Ansible\u306e\u5b9f\u884c\n[root@server1 /]# ansible-playbook -i /playbook/hosts /playbook/sitelin.yml\n\nPLAY [Linux Playbook] **********************************************************\n\nTASK [setup] *******************************************************************\nok: [client-lin]\n\nTASK [linrole : For Linux] *****************************************************\nchanged: [client-lin]\n\nPLAY RECAP *********************************************************************\nclient-lin                 : ok=2    changed=1    unreachable=0    failed=0\n\n[root@server1 /]#\n```\n```ruby:\u5b9f\u884c\u5f8c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u78ba\u8a8d\n[root@client-lin tmp]# ls\nsample.yml\n[root@client-lin tmp]#\n```\n#####\u25a0Playbook\u5b9f\u884c(Linux->Windows)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\u203b\u3053\u306e\u307e\u307e\u3084\u308b\u3068\u5931\u6557\u3057\u307e\u3059\n\u7406\u7531\uff1a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u8a2d\u5b9a\u304c\u4f55\u3082\u3055\u308c\u3066\u3044\u306a\u3044\n\u5fc5\u8981\u306a\u8a2d\u5b9a\uff1a\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\n\u30fbPowershell\u3000\u6709\u52b9\u5316\n\u30fbWinRM\u8a2d\u5b9a\n\u3000\uff0dBasic\u8a8d\u8a3c\n\u3000\uff0dHTTPS\u30ea\u30b9\u30ca\u30fc\u8a8d\u8a3c\n\n\u307e\u305a\u306fPowershell\u3092\u7ba1\u7406\u8005\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u30d1\u30ef\u30fc\u30b7\u30a7\u30eb\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\u4eca\u56de\u306fBypass\u306b\u5909\u66f4\u3057\u3066\u5168\u90e8\u8a31\u53ef\u306b\u3057\u307e\u3059\uff01\u4e00\u756a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7518\u3044\u3067\u3059\uff01\n\n```ruby:Powershell\u6709\u52b9\u5316\nPS C:\\Users\\Administrator> Get-ExecutionPolicy\nRemoteSigned\nPS C:\\Users\\Administrator> Set-ExecutionPolicy bypass -force\nPS C:\\Users\\Administrator> Get-ExecutionPolicy\nbypass\nPS C:\\Users\\Administrator>\n```\n\u6b21\u306bWinRM\u3068\u3044\u3046\u30ea\u30e2\u30fc\u30c8\u7ba1\u7406\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\nAnsible\u3067\u901a\u4fe1\u3059\u308b\u3068\u304d\u306fSSH\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u3051\u3069\u5f53\u7136\u306a\u304c\u3089Windows\u306b\u306f\u3042\u308a\u307e\u305b\u3093\uff01\u305d\u306e\u305f\u3081Ansible\u304b\u3089Windows\u306b\u901a\u4fe1\u3092\u884c\u3046\u3068\u304d\u306fWinRM\u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u901a\u4fe1\u3092\u3057\u307e\u3059\uff08OpenSSH\u3092\u4f7f\u3063\u3066\u5f37\u5f15\u306b\u3084\u308b\u3063\u3066\u3053\u3068\u3082\u3068\u308a\u3042\u3048\u305a\u51fa\u6765\u307e\u3059\uff09\n\n\u5909\u66f4\u7b87\u6240\uff1aAllowUnencrypted = False -> True\n\u610f\u5473\uff1aLinux\u306eWinRM\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\n\u5909\u66f4\u7b87\u6240\uff1aAuth:Basic = False -> True\n\u610f\u5473\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u5e73\u6587\u8a31\u53ef\n\n```ruby:WinRM\u8a2d\u5b9a\nPS C:\\Users\\Administrator> winrm set winrm/config/service/auth '@{Basic=\"true\"}'\nPS C:\\Users\\Administrator>winrm set winrm/config/service '@{AllowUnencrypted=\"true\"}'\nPS C:\\Users\\Administrator> winrm get winrm/config/service\nService\n    RootSDDL = O:NSG:BAD:P(A;;GA;;;BA)(A;;GR;;;IU)S:P(AU;FA;GA;;;WD)(AU;SA;GXGW;;;WD)\n    MaxConcurrentOperations = 4294967295\n    MaxConcurrentOperationsPerUser = 1500\n    EnumerationTimeoutms = 240000\n    MaxConnections = 300\n    MaxPacketRetrievalTimeSeconds = 120\n    AllowUnencrypted = true (Defalt:False)\n    Auth\n        Basic = true (Defalt:False)\n        Kerberos = true\n        Negotiate = true\n        Certificate = false\n        CredSSP = false\n        CbtHardeningLevel = Relaxed\n    DefaultPorts\n        HTTP = 5985\n        HTTPS = 5986\n    IPv4Filter = *\n    IPv6Filter = *\n    EnableCompatibilityHttpListener = false\n    EnableCompatibilityHttpsListener = false\n    CertificateThumbprint\n    AllowRemoteAccess = true\n\nPS C:\\Users\\Administrator>\n```\n#####\u25a0Playbook\u518d\u5b9f\u884c(Linux->Windows)\n\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u51e6\u7406\u5185\u5bb9\uff1a\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\n```ruby:Ansible\u306e\u5b9f\u884c(Windows)\n[root@server1 /]# ansible-playbook -i /playbook/hosts /playbook/sitewin.yml\n\nPLAY [Windows Playbook] ********************************************************\n\nTASK [setup] *******************************************************************\nok: [ec2-35-164-42-228.us-west-2.compute.amazonaws.com]\n\nTASK [winrole : For Windows] ***************************************************\nchanged: [ec2-35-164-42-228.us-west-2.compute.amazonaws.com]\n\nPLAY RECAP *********************************************************************\nec2-35-164-42-228.us-west-2.compute.amazonaws.com : ok=2    changed=1    unreachable=0    failed=0\n\n[root@server1 /]#\n```\n\u6210\u529f\uff01\uff01\uff01\n\n\u9577\u3059\u304e\u305f\u304b\u3089\u3044\u3063\u305f\u3093\u304d\u308a\u307e\u3059\n***\n\u307e\u3068\u3081\n\u4eca\u56de\u306fAWS\u306e\u4f5c\u6210\u3068Root\u30ed\u30b0\u30a4\u30f3\u3068HOSTNAME\u5909\u66f4\u3092\u3057\u307e\u3057\u305f\u3002Server\u306bAnsible\u3092\u5165\u308c\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u306fWindows\u3068Linux\u3067\u53cc\u65b9\u306bAnsible\u306e\u5b9f\u884c\u304c\u53ef\u80fd\u3067\u3042\u308b\u3053\u3068\u304c\u8a3c\u660e\u3067\u304d\u305f\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\n\u6b21\u56de\uff1aAnsible\u30b5\u30fc\u30d0\u306bJenkins\u3092\u5c0e\u5165\u3057Ansible\u5b9f\u884c\u30b8\u30e7\u30d6\u3092\u4f5c\u6210\nJenkins\u304b\u3089Ansible\u3092\u5b9f\u884c(2/2)\nhttp://qiita.com/yo_dazy/items/468524ca0ac11cdc2d41\n", "tags": ["AWS", "RHEL7", "playbook", "Ansible", "Windows"]}