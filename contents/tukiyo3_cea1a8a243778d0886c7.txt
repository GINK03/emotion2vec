{"tags": ["selenium-webdriver", "Selenium", "Xvfb"], "context": "\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\napt-get install -y build-essential ruby-dev\napt-get install -y openbox imagemagick firefox\ngem install selenium-webdriver\ngem install mail\n\n\n\u8981\u70b9\n\ncapture.rb\nrequire 'selenium-webdriver'\n\ndriver = Selenium::WebDriver.for :firefox\ndriver.navigate.to 'http://google.co.jp'\ndriver.save_screenshot(\"img/google.png\")\ndriver.quit\n\n\n\n\u5b9f\u884c\nruby capture.rb\n\n\n\ncron\u3067\u307e\u308f\u3059\n\nselenium\u3067\u753b\u9762\u30ad\u30e3\u30d7\u30c1\u30e3\n\ncapture.rb\nrequire 'selenium-webdriver'\n\ndriver = Selenium::WebDriver.for :firefox\n\nhash = {\n  \"google\" => \"http://google.co.jp\",\n  \"yahoo\" => \"http://yahoo.co.jp\",\n}\nhash.each{|title, url|\n  driver.navigate.to url\n  driver.save_screenshot(\"img/\"+title+\".png\")\n}\n\ndriver.quit\n\n\n\n\u30e1\u30fc\u30eb\u9001\u4fe1\u51e6\u7406\n\nmailsend.rb\nrequire \"mail\"\n\nNOW=Time.now\n\nmail = Mail.new do\n  from    \"batch@myserver.co.jp\"\n  to      \"toaddr@myserver.co.jp\"\n  subject \"selenium \"+NOW.to_s\n  #body    File.read(\"body.txt\")\n  body    \"\"\nend\n\nDir.glob(\"/home/user1/bin/img/s-*.png\") do |img|\n  mail.add_file img\nend\n\nmail.delivery_method :smtp, {\n  address:   'localhost',\n  port:      587,\n  domain:    'myserver.co.jp',\n  enable_starttls_auto: false,\n}\n\nmail.deliver!\n\n\n\n\u30e1\u30a4\u30f3\u51e6\u7406\n\ncapture.sh\n#!/bin/sh\nexport DISPLAY=:1\n\nxvfb_start() {\n  pgrep Xvfb\n  if [ $? -eq 1 ];then\n    Xvfb $DISPLAY -screen 0 1280x1280x16 &\n    sleep 5\n    openbox &\n  fi\n}\n\nresize() {\n  convert -resize 640x -unsharp 2x1.4+0.5+0 -colors 65 -quality 75 -verbose \\\n     ${i} s-${i} 2>/dev/null\n}\n\n## xserver\nxvfb_start\n\n## selenium\nrm -f img/s-*.png\nruby capture.rb\n\n## resize\ncd img\nfor i in *.png\ndo\n  resize $i\ndone\ncd ..\n\n## mailsend\nruby capture-mailsend.rb\n\n\n\n\n\u4f7f\u3044\u65b9\n\n\ncapture.sh\u3092\u5b9f\u884c\u3059\u308c\u3070\u753b\u9762\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u3055\u308c\u308b\u3002\n\n\ncron\u306b\u767b\u9332\u65b9\u6cd5\n 4 12 * * * (cd ~/bin && sh capture.sh)\n\n\n\u307e\u305f\u3001cron\u3067DISPLAY=:1\u3092\u30bb\u30c3\u30c8\u3059\u308b\u306e\u3082\u4fbf\u5229\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:\napt-get install -y build-essential ruby-dev\napt-get install -y openbox imagemagick firefox\ngem install selenium-webdriver\ngem install mail\n```\n\n## \u8981\u70b9\n\n```rb:capture.rb\nrequire 'selenium-webdriver'\n\ndriver = Selenium::WebDriver.for :firefox\ndriver.navigate.to 'http://google.co.jp'\ndriver.save_screenshot(\"img/google.png\")\ndriver.quit\n```\n\n```bash:\u5b9f\u884c\nruby capture.rb\n```\n\n## cron\u3067\u307e\u308f\u3059\n\n\n### selenium\u3067\u753b\u9762\u30ad\u30e3\u30d7\u30c1\u30e3\n\n```rb:capture.rb\nrequire 'selenium-webdriver'\n\ndriver = Selenium::WebDriver.for :firefox\n\nhash = {\n  \"google\" => \"http://google.co.jp\",\n  \"yahoo\" => \"http://yahoo.co.jp\",\n}\nhash.each{|title, url|\n  driver.navigate.to url\n  driver.save_screenshot(\"img/\"+title+\".png\")\n}\n\ndriver.quit\n```\n\n\n### \u30e1\u30fc\u30eb\u9001\u4fe1\u51e6\u7406\n\n```rb:mailsend.rb\nrequire \"mail\"\n\nNOW=Time.now\n\nmail = Mail.new do\n  from    \"batch@myserver.co.jp\"\n  to      \"toaddr@myserver.co.jp\"\n  subject \"selenium \"+NOW.to_s\n  #body    File.read(\"body.txt\")\n  body    \"\"\nend\n\nDir.glob(\"/home/user1/bin/img/s-*.png\") do |img|\n  mail.add_file img\nend\n\nmail.delivery_method :smtp, {\n  address:   'localhost',\n  port:      587,\n  domain:    'myserver.co.jp',\n  enable_starttls_auto: false,\n}\n\nmail.deliver!\n```\n\n### \u30e1\u30a4\u30f3\u51e6\u7406\n\n```bash:capture.sh\n#!/bin/sh\nexport DISPLAY=:1\n\nxvfb_start() {\n  pgrep Xvfb\n  if [ $? -eq 1 ];then\n    Xvfb $DISPLAY -screen 0 1280x1280x16 &\n    sleep 5\n    openbox &\n  fi\n}\n\nresize() {\n  convert -resize 640x -unsharp 2x1.4+0.5+0 -colors 65 -quality 75 -verbose \\\n     ${i} s-${i} 2>/dev/null\n}\n\n## xserver\nxvfb_start\n\n## selenium\nrm -f img/s-*.png\nruby capture.rb\n\n## resize\ncd img\nfor i in *.png\ndo\n  resize $i\ndone\ncd ..\n\n## mailsend\nruby capture-mailsend.rb\n```\n\n----\n\n## \u4f7f\u3044\u65b9\n\n* `capture.sh`\u3092\u5b9f\u884c\u3059\u308c\u3070\u753b\u9762\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u3055\u308c\u308b\u3002\n\n```bash:cron\u306b\u767b\u9332\u65b9\u6cd5\n 4 12 * * * (cd ~/bin && sh capture.sh)\n```\n\n\u307e\u305f\u3001cron\u3067`DISPLAY=:1`\u3092\u30bb\u30c3\u30c8\u3059\u308b\u306e\u3082\u4fbf\u5229\n"}