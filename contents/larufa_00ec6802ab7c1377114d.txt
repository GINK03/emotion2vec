{"context": " More than 1 year has passed since last update.\n\n\u74b0\u5883\nVagrant (CentOS 6.5)\nLoadBalancer\u306eIP: 192.168.33.81 \u3068 \u30b0\u30ed\u30fc\u30d0\u30ebIP \nWebServer1\u306eIP: 192.168.33.82\nWebServer2\u306eIP: 192.168.33.83\n\u203b 192.168.33.80/24 \u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\nVagrant\u306e\u74b0\u5883\u306e\u69cb\u7bc9\n\u5b9f\u306f\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\uff08LVS\uff09\u3092\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\uff0c\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\uff0c\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\uff0e\nvagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059\n\n\u307e\u305a\u306fWebServer\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\n\nRails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\uff0cRuby\u3068Rails\u3092\u5165\u308c\u307e\u3057\u305f\uff0e\nrbenv\u3067Ruby2.1.3,Rails4.1.6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb on CentOS6.5 (Vagrant)\n\nRuby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n[root@vagrant-centos65 ~]$ ruby -v\nruby 2.1.3p242 (2014-09-19 revision 47630) [x86_64-linux]\n\n\nRails\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n[root@vagrant-centos65 ~]$ rails -v\nRails 4.1.6\n\n\nRails\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\uff0c\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3082\u4f5c\u6210\u3057\u307e\u3059\uff0e\n[root@vagrant-centos65 ~]$ cd ~\n[root@vagrant-centos65 ~]$ rails new testapp\n[root@vagrant-centos65 ~]$ rails g controller Tests index\n\n\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\uff0c\u30eb\u30fc\u30c8(http://localhost/) \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306b\u3001indexAction\u3092\u898b\u308b\u3088\u3046\u306b\u3059\u308b\n\n~/testapp/config/routes.rb\nRails.application.routes.draw do\n  root :to => 'tests#index'\n\n  # The priority is based upon order of creation: first created -> highest priority.\n  # See how all your routes lay out with \"rake routes\".\n\n  # You can have the root of your site routed with \"root\"\n\n        \uff1a\n        \uff1a\n\nend\n\n\n\nUnicorn\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u300cunicorn\u300d\u306e\u3068\u3053\u308d\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\n~/testapp/Gemfile\nsource 'https://rubygems.org'\n\n\n# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\ngem 'rails', '4.1.6'\n# Use sqlite3 as the database for Active Record\ngem 'sqlite3'\n# Use SCSS for stylesheets\ngem 'sass-rails', '~> 4.0.3'\n# Use Uglifier as compressor for JavaScript assets\ngem 'uglifier', '>= 1.3.0'\n# Use CoffeeScript for .js.coffee assets and views\ngem 'coffee-rails', '~> 4.0.0'\n# See https://github.com/sstephenson/execjs#readme for more supported runtimes\ngem 'therubyracer',  platforms: :ruby\n\n# Use jquery as the JavaScript library\ngem 'jquery-rails'\n# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks\ngem 'turbolinks'\n# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\ngem 'jbuilder', '~> 2.0'\n# bundle exec rake doc:rails generates the API under doc/api.\ngem 'sdoc', '~> 0.4.0',          group: :doc\n\n# Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\ngem 'spring',        group: :development\n\n# Use ActiveModel has_secure_password\n# gem 'bcrypt', '~> 3.1.7'\n\n# Use unicorn as the app server\ngem 'unicorn'\n\n# Use Capistrano for deployment\n# gem 'capistrano-rails', group: :development\n\n# Use debugger\n# gem 'debugger', group: [:development, :test]\n\n\n\u305d\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff0e\n[root@vagrant-centos65 ~]$ cd ~/testapp\n[root@vagrant-centos65 ~]$ bundle install\n\n\nUnicorn\u306e\u8a2d\u5b9a\n/root/testapp\u306eroot\u306f\u5404\u74b0\u5883\u306b\u3042\u3063\u305f\u3082\u306e\u306b\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\uff0e\n\n~/testapp/config/unicorn.rb\n# -*- coding: utf-8 -*-\nworker_processes 2\n\nlisten  '/tmp/unicorn.sock'\npid     '/tmp/unicorn.pid'\n\nlog = '/root/testapp/log/unicorn.log'\nstderr_path File.expand_path('log/unicorn.log', '/root/testapp/')\nstdout_path File.expand_path('log/unicorn.log', '/root/testapp/')\n\npreload_app true\nGC.respond_to?(:copy_on_write_friendly=) and GC.copy_on_write_friendly = true\n\nbefore_fork do |server, worker|\ndefined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!\n\nold_pid = \"#{ server.config[:pid] }.oldbin\"\nunless old_pid == server.pid\n  begin\n   sig = (worker.nr + 1) >= server.worker_processes ? :QUIT : :TTOU\n   Process.kill :QUIT, File.read(old_pid).to_i\n   rescue Errno::ENOENT, Errno::ESRCH\n  end\nend\nend\n\nafter_fork do |server, worker|\n    defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n\n\nUnicorn\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u62dd\u501f\u3057\u307e\u3057\u305f\uff0e\n\n~/testapp/script/unicorn\n#!/bin/bash\n\nset -e\n\nTIMEOUT=${TIMEOUT-60}\nAPP_ROOT=${my_app}\nPID=/tmp/unicorn.pid\n#RAILS_ENV=production\nRAILS_ENV=development\nCMD=\"bundle exec unicorn -D -c $APP_ROOT/config/unicorn.rb -E $RAILS_ENV\"\naction=\"$1\"\nset -u\n\nold_pid=\"$PID.oldbin\"\n\ncd $APP_ROOT || exit 1\n\nsig () {\n    test -s \"$PID\" && kill -$1 `cat $PID`\n}\n\noldsig () {\n    test -s $old_pid && kill -$1 `cat $old_pid`\n}\n\ncase $action in\nstart)\n    sig 0 && echo >&2 \"Already running\" && exit 0\n    $CMD\n    ;;\nstop)\n    sig QUIT && rm -f ${PID} && exit 0\n    echo >&2 \"Not running\"\n    ;;\nforce-stop)\n    sig TERM && exit 0\n    echo >&2 \"Not running\"\n    ;;\nrestart|reload)\n    sig HUP && echo reloaded OK && exit 0\n    echo >&2 \"Couldn't reload, starting '$CMD' instead\"\n    $CMD\n    ;;\nupgrade)\n    if sig USR2 && sleep 2 && sig 0 && oldsig QUIT\n    then\n        n=$TIMEOUT\n        while test -s $old_pid && test $n -ge 0\n        do\n            printf '.' && sleep 1 && n=$(( $n - 1 ))\n        done\n        echo\n\n        if test $n -lt 0 && test -s $old_pid\n        then\n            echo >&2 \"$old_pid still exists after $TIMEOUT seconds\"\n            exit 1\n        fi\n        exit 0\n    fi\n    echo >&2 \"Couldn't upgrade, starting '$CMD' instead\"\n    $CMD\n    ;;\nreopen-logs)\n    sig USR1\n    ;;\n*)\n    echo >&2 \"Usage: $0 <start|stop|restart|upgrade|force-stop|reopen-logs>\"\n    exit 1\n    ;;\nesac\n\n\n\nUnicorn\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u3061\u3083\u3093\u3068\u8fd4\u3063\u3066\u304d\u3066\u307e\u3059\u306d\uff0e\n[root@vagrant-centos65 ~]# ~/testapp/script/unicorn start\n[root@vagrant-centos65 ~]# curl localhost:8080\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Testapp</title>\n  <link data-turbolinks-track=\"true\" href=\"/assets/tests.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n<link data-turbolinks-track=\"true\" href=\"/assets/application.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n  <script data-turbolinks-track=\"true\" src=\"/assets/jquery.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/jquery_ujs.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/turbolinks.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/tests.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/application.js?body=1\"></script>\n  <meta content=\"authenticity_token\" name=\"csrf-param\" />\n<meta content=\"rc3+bjfvcy2GtRru/GGkV+9CuAxLOFbRVBShmmkeqCM=\" name=\"csrf-token\" />\n</head>\n<body>\n\n<h1>Tests#index</h1>\n<p>Find me in app/views/tests/index.html.erb</p>\n\n\n</body>\n</html>\n\n\nNginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nNginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\uff0e\nCentOS6.x\u306b\u3066nginx\u306e\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\n\nNginx\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n[root@vagrant-centos65 ~]$ nginx -v\nnginx version: nginx/1.6.2\n\n\nNginx\u306e\u8a2d\u5b9a(Unicorn\u3068\u9023\u643a)(WebServer)\nNginx\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\uff0e\n\n/etc/nginx/conf.d/rails-app.conf\nupstream rails-unicorn {\n    server unix:/tmp/unicorn.sock;\n}\n\nserver {\n    listen       80;\n    server_name  localhost;\n\n    access_log  /var/log/nginx/log/host.access.log  main;\n\n    root /root/testapp/public;\n    try_files $uri $uri.html $uri/index.html @rails-unicorn;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /root/testapp/public;\n    }\n    #error_page  404              /404.html;\n\n    location ~ ^/assets/(.*) {\n        alias /root/testapp/public/assets/$1;\n    }\n\n    location @rails-unicorn {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded_For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_pass http://rails-unicorn;\n    }\n\n}\n\n\n\nNginx\u306e\u8d77\u52d5\n[root@vagrant-centos65 ~]$ nginx\n[root@vagrant-centos65 ~]# curl localhost\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Testapp</title>\n  <link data-turbolinks-track=\"true\" href=\"/assets/tests.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n<link data-turbolinks-track=\"true\" href=\"/assets/application.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n  <script data-turbolinks-track=\"true\" src=\"/assets/jquery.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/jquery_ujs.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/turbolinks.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/tests.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/application.js?body=1\"></script>\n  <meta content=\"authenticity_token\" name=\"csrf-param\" />\n<meta content=\"WwNbfm70aA5AyUbNzR19WHEDagc6HkVWWW7oo0ozyFA=\" name=\"csrf-token\" />\n</head>\n<body>\n\n<h1>Tests#index</h1>\n<p>Find me in app/views/tests/index.html.erb</p>\n\n\n</body>\n</html>\n\n\n\u3053\u3053\u304b\u3089LoadBalancer\u306e\u8a2d\u5b9a\u3067\u3059\n\u540c\u69d8\u306bLoadBalancer\u306b\u3082Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff0e\nNginx\u3092\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3068\u3057\u3066\u4f7f\u3044\u307e\u3059\uff0e\n\nNginx\u306e\u8a2d\u5b9a(LoadBalancer)\nginx:/etc/nginx/nginx.conf\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n    server_tokens off;\n\n    # \u3053\u3053\u306b\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u30b5\u30fc\u30d0\u306eIP\u3092\u8ffd\u52a0\n    # \u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u3067\u3059\n    upstream webserver {\n        server 192.168.33.82;\n        server 192.168.33.83;\n    }\n\n}\n\n\nNginx\u306e\u8d77\u52d5\n[root@vagrant-centos65 ~]$ nginx\n\n\nWebServer\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u8a2d\u5b9a\nLoadBalancer\u306e\u5185\u5074\u30a2\u30c9\u30ec\u30b9\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e\n[root@vagrant-centos65 ~]$ route add default gw 192.168.33.81\n[root@vagrant-centos65 ~]$ route del -net default gw 10.0.2.2 dev eth0\n\n\u305f\u3060\u3057\uff0c\u3053\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3068\uff0cWebServer\u304c\u5916\u90e8\u3068\u901a\u4fe1\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff0e\uff08\u73fe\u72b6\u306eVagrant\u74b0\u5883\u3067\u306f\uff09\n\u3067\u3059\u306e\u3067\uff0cyum\u7b49\u3067\u4f55\u304b\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u6642\u306f\uff0c\u623b\u3057\u3066\u3042\u3052\u3066\u304f\u3060\u3055\u3044\uff0e\n[root@vagrant-centos65 ~]$ route add default gw 10.0.2.2\n[root@vagrant-centos65 ~]$ route del -net default gw 192.168.33.81 dev eth1\n\n\u203b\u3053\u306e\u901a\u4fe1\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3092\uff0cNAT\u3067\u306a\u3093\u3068\u304b\u3067\u304d\u305d\u3046\u306a\u6c17\u3082\u3059\u308b\u306e\u3067\u3059\u304c\uff0c\u73fe\u72b6\u306e\u79c1\u3067\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\uff0e\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3067LoadBalancer\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\uff0e\n\u6b21\u306e\u3082\u306e\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070OK\u3067\u3059\uff0e\n\n\u540c\u3058\u5185\u5bb9\u3060\u3068\u632f\u308a\u5206\u3051\u3089\u308c\u3066\u3044\u308b\u304b\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\uff0c/root/testapp/app/views/tests/index.html.erb \u306bWebServer1\u3068\u3044\u3063\u305f\u76ee\u5370\u3092\u8ffd\u52a0\u3057\u3066\u3042\u3052\u308b\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\uff0e\n\n\u305d\u306e\u4ed6\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\n\nnginx + unicorn + Rails\u306e\u8a2d\u5b9a\u65b9\u6cd5\nrails + nginx + unicorn\u9023\u643a\nVagrant(CentOS6.5)\u306bRails4.1 + Nginx + Unicorn + MySQL\u74b0\u5883\u3067Rails\u3092\u8d77\u52d5\u3059\u308b\u3002\nvagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059\n\n\n\n#\u74b0\u5883\nVagrant (CentOS 6.5)\n\nLoadBalancer\u306eIP: 192.168.33.81 \u3068 \u30b0\u30ed\u30fc\u30d0\u30ebIP \nWebServer1\u306eIP: 192.168.33.82\nWebServer2\u306eIP: 192.168.33.83\n\n\u203b 192.168.33.80/24 \u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\n#Vagrant\u306e\u74b0\u5883\u306e\u69cb\u7bc9\n\u5b9f\u306f\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\uff08LVS\uff09\u3092\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\uff0c\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\uff0c\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\uff0e\n\n[vagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059](http://qiita.com/ftakao2007/items/79c0e34657e2664801cf \"vagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059\")\n\n\n\n\n#\u307e\u305a\u306fWebServer\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\n\n\n\n\n#Rails\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\uff0cRuby\u3068Rails\u3092\u5165\u308c\u307e\u3057\u305f\uff0e\n\n[rbenv\u3067Ruby2.1.3,Rails4.1.6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb on CentOS6.5 (Vagrant)](http://qiita.com/icche/items/801ce357d41fd0137b79 \"rbenv\u3067Ruby2.1.3,Rails4.1.6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb on CentOS6.5 (Vagrant)\")\n\n####Ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n[root@vagrant-centos65 ~]$ ruby -v\nruby 2.1.3p242 (2014-09-19 revision 47630) [x86_64-linux]\n```\n\n####Rails\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n[root@vagrant-centos65 ~]$ rails -v\nRails 4.1.6\n```\n\n\n\n\n\n#Rails\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\uff0c\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3082\u4f5c\u6210\u3057\u307e\u3059\uff0e\n\n```\n[root@vagrant-centos65 ~]$ cd ~\n[root@vagrant-centos65 ~]$ rails new testapp\n[root@vagrant-centos65 ~]$ rails g controller Tests index\n```\n\n\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\uff0c\u30eb\u30fc\u30c8(`http://localhost/`) \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306b\u3001indexAction\u3092\u898b\u308b\u3088\u3046\u306b\u3059\u308b\n\n```ruby:~/testapp/config/routes.rb\nRails.application.routes.draw do\n  root :to => 'tests#index'\n\n  # The priority is based upon order of creation: first created -> highest priority.\n  # See how all your routes lay out with \"rake routes\".\n\n  # You can have the root of your site routed with \"root\"\n  \n  \t\t\uff1a\n  \t\t\uff1a\n  \nend\n```\n\n\n\n\n#Unicorn\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u300cunicorn\u300d\u306e\u3068\u3053\u308d\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\n```ruby:~/testapp/Gemfile\nsource 'https://rubygems.org'\n\n\n# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\ngem 'rails', '4.1.6'\n# Use sqlite3 as the database for Active Record\ngem 'sqlite3'\n# Use SCSS for stylesheets\ngem 'sass-rails', '~> 4.0.3'\n# Use Uglifier as compressor for JavaScript assets\ngem 'uglifier', '>= 1.3.0'\n# Use CoffeeScript for .js.coffee assets and views\ngem 'coffee-rails', '~> 4.0.0'\n# See https://github.com/sstephenson/execjs#readme for more supported runtimes\ngem 'therubyracer',  platforms: :ruby\n\n# Use jquery as the JavaScript library\ngem 'jquery-rails'\n# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks\ngem 'turbolinks'\n# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\ngem 'jbuilder', '~> 2.0'\n# bundle exec rake doc:rails generates the API under doc/api.\ngem 'sdoc', '~> 0.4.0',          group: :doc\n\n# Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\ngem 'spring',        group: :development\n\n# Use ActiveModel has_secure_password\n# gem 'bcrypt', '~> 3.1.7'\n\n# Use unicorn as the app server\ngem 'unicorn'\n\n# Use Capistrano for deployment\n# gem 'capistrano-rails', group: :development\n\n# Use debugger\n# gem 'debugger', group: [:development, :test]\n```\n\n\u305d\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff0e\n\n```\n[root@vagrant-centos65 ~]$ cd ~/testapp\n[root@vagrant-centos65 ~]$ bundle install\n```\n\n\n#Unicorn\u306e\u8a2d\u5b9a\n/root/testapp\u306eroot\u306f\u5404\u74b0\u5883\u306b\u3042\u3063\u305f\u3082\u306e\u306b\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\uff0e\n\n```ruby:~/testapp/config/unicorn.rb\n# -*- coding: utf-8 -*-\nworker_processes 2\n\nlisten  '/tmp/unicorn.sock'\npid     '/tmp/unicorn.pid'\n\nlog = '/root/testapp/log/unicorn.log'\nstderr_path File.expand_path('log/unicorn.log', '/root/testapp/')\nstdout_path File.expand_path('log/unicorn.log', '/root/testapp/')\n\npreload_app true\nGC.respond_to?(:copy_on_write_friendly=) and GC.copy_on_write_friendly = true\n\nbefore_fork do |server, worker|\ndefined?(ActiveRecord::Base) and ActiveRecord::Base.connection.disconnect!\n\nold_pid = \"#{ server.config[:pid] }.oldbin\"\nunless old_pid == server.pid\n  begin\n   sig = (worker.nr + 1) >= server.worker_processes ? :QUIT : :TTOU\n   Process.kill :QUIT, File.read(old_pid).to_i\n   rescue Errno::ENOENT, Errno::ESRCH\n  end\nend\nend\n\nafter_fork do |server, worker|\n    defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n```\n\n#Unicorn\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u62dd\u501f\u3057\u307e\u3057\u305f\uff0e\n\n```bash:~/testapp/script/unicorn\n#!/bin/bash\n\nset -e\n\nTIMEOUT=${TIMEOUT-60}\nAPP_ROOT=${my_app}\nPID=/tmp/unicorn.pid\n#RAILS_ENV=production\nRAILS_ENV=development\nCMD=\"bundle exec unicorn -D -c $APP_ROOT/config/unicorn.rb -E $RAILS_ENV\"\naction=\"$1\"\nset -u\n\nold_pid=\"$PID.oldbin\"\n\ncd $APP_ROOT || exit 1\n\nsig () {\n    test -s \"$PID\" && kill -$1 `cat $PID`\n}\n\noldsig () {\n    test -s $old_pid && kill -$1 `cat $old_pid`\n}\n\ncase $action in\nstart)\n    sig 0 && echo >&2 \"Already running\" && exit 0\n    $CMD\n    ;;\nstop)\n    sig QUIT && rm -f ${PID} && exit 0\n    echo >&2 \"Not running\"\n    ;;\nforce-stop)\n    sig TERM && exit 0\n    echo >&2 \"Not running\"\n    ;;\nrestart|reload)\n    sig HUP && echo reloaded OK && exit 0\n    echo >&2 \"Couldn't reload, starting '$CMD' instead\"\n    $CMD\n    ;;\nupgrade)\n    if sig USR2 && sleep 2 && sig 0 && oldsig QUIT\n    then\n        n=$TIMEOUT\n        while test -s $old_pid && test $n -ge 0\n        do\n            printf '.' && sleep 1 && n=$(( $n - 1 ))\n        done\n        echo\n\n        if test $n -lt 0 && test -s $old_pid\n        then\n            echo >&2 \"$old_pid still exists after $TIMEOUT seconds\"\n            exit 1\n        fi\n        exit 0\n    fi\n    echo >&2 \"Couldn't upgrade, starting '$CMD' instead\"\n    $CMD\n    ;;\nreopen-logs)\n    sig USR1\n    ;;\n*)\n    echo >&2 \"Usage: $0 <start|stop|restart|upgrade|force-stop|reopen-logs>\"\n    exit 1\n    ;;\nesac\n```\n\n\n\n\n\n\n#Unicorn\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u3061\u3083\u3093\u3068\u8fd4\u3063\u3066\u304d\u3066\u307e\u3059\u306d\uff0e\n\n```html\n[root@vagrant-centos65 ~]# ~/testapp/script/unicorn start\n[root@vagrant-centos65 ~]# curl localhost:8080\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Testapp</title>\n  <link data-turbolinks-track=\"true\" href=\"/assets/tests.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n<link data-turbolinks-track=\"true\" href=\"/assets/application.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n  <script data-turbolinks-track=\"true\" src=\"/assets/jquery.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/jquery_ujs.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/turbolinks.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/tests.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/application.js?body=1\"></script>\n  <meta content=\"authenticity_token\" name=\"csrf-param\" />\n<meta content=\"rc3+bjfvcy2GtRru/GGkV+9CuAxLOFbRVBShmmkeqCM=\" name=\"csrf-token\" />\n</head>\n<body>\n\n<h1>Tests#index</h1>\n<p>Find me in app/views/tests/index.html.erb</p>\n\n\n</body>\n</html>\n```\n\n\n\n\n\n\n#Nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nNginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u6b21\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\uff0e\n\n[CentOS6.x\u306b\u3066nginx\u306e\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806](http://qiita.com/utano320/items/0c0d9b84a9a28525bcb9 \"CentOS6.x\u306b\u3066nginx\u306e\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\")\n\n####Nginx\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n[root@vagrant-centos65 ~]$ nginx -v\nnginx version: nginx/1.6.2\n```\n\n\n\n\n\n\n#Nginx\u306e\u8a2d\u5b9a(Unicorn\u3068\u9023\u643a)(WebServer)\nNginx\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\uff0e\n\n```nginx:/etc/nginx/conf.d/rails-app.conf\nupstream rails-unicorn {\n    server unix:/tmp/unicorn.sock;\n}\n\nserver {\n    listen       80;\n    server_name  localhost;\n\n    access_log  /var/log/nginx/log/host.access.log  main;\n\n    root /root/testapp/public;\n    try_files $uri $uri.html $uri/index.html @rails-unicorn;\n\n    # redirect server error pages to the static page /50x.html\n    #\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /root/testapp/public;\n    }\n    #error_page  404              /404.html;\n\n    location ~ ^/assets/(.*) {\n        alias /root/testapp/public/assets/$1;\n    }\n\n    location @rails-unicorn {\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded_For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_pass http://rails-unicorn;\n    }\n\n}\n```\n\n\n\n\n\n\n#Nginx\u306e\u8d77\u52d5\n\n```\n[root@vagrant-centos65 ~]$ nginx\n[root@vagrant-centos65 ~]# curl localhost\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Testapp</title>\n  <link data-turbolinks-track=\"true\" href=\"/assets/tests.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n<link data-turbolinks-track=\"true\" href=\"/assets/application.css?body=1\" media=\"all\" rel=\"stylesheet\" />\n  <script data-turbolinks-track=\"true\" src=\"/assets/jquery.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/jquery_ujs.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/turbolinks.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/tests.js?body=1\"></script>\n<script data-turbolinks-track=\"true\" src=\"/assets/application.js?body=1\"></script>\n  <meta content=\"authenticity_token\" name=\"csrf-param\" />\n<meta content=\"WwNbfm70aA5AyUbNzR19WHEDagc6HkVWWW7oo0ozyFA=\" name=\"csrf-token\" />\n</head>\n<body>\n\n<h1>Tests#index</h1>\n<p>Find me in app/views/tests/index.html.erb</p>\n\n\n</body>\n</html>\n```\n\n\n#\u3053\u3053\u304b\u3089LoadBalancer\u306e\u8a2d\u5b9a\u3067\u3059\n\u540c\u69d8\u306bLoadBalancer\u306b\u3082Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\uff0e\nNginx\u3092\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3068\u3057\u3066\u4f7f\u3044\u307e\u3059\uff0e\n\n\n\n#Nginx\u306e\u8a2d\u5b9a(LoadBalancer)\n\n```nginx\nginx:/etc/nginx/nginx.conf\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n\n    keepalive_timeout  65;\n\n    #gzip  on;\n\n    include /etc/nginx/conf.d/*.conf;\n    server_tokens off;\n\n\t# \u3053\u3053\u306b\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306e\u30b5\u30fc\u30d0\u306eIP\u3092\u8ffd\u52a0\n\t# \u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u30e9\u30a6\u30f3\u30c9\u30ed\u30d3\u30f3\u3067\u3059\n    upstream webserver {\n        server 192.168.33.82;\n        server 192.168.33.83;\n    }\n\n}\n```\n\n#Nginx\u306e\u8d77\u52d5\n\n```bash\n[root@vagrant-centos65 ~]$ nginx\n```\n\n#WebServer\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u8a2d\u5b9a\nLoadBalancer\u306e\u5185\u5074\u30a2\u30c9\u30ec\u30b9\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff0e\n\n```\n[root@vagrant-centos65 ~]$ route add default gw 192.168.33.81\n[root@vagrant-centos65 ~]$ route del -net default gw 10.0.2.2 dev eth0\n```\n\n\u305f\u3060\u3057\uff0c\u3053\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3068\uff0cWebServer\u304c\u5916\u90e8\u3068\u901a\u4fe1\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\uff0e\uff08\u73fe\u72b6\u306eVagrant\u74b0\u5883\u3067\u306f\uff09\n\n\u3067\u3059\u306e\u3067\uff0cyum\u7b49\u3067\u4f55\u304b\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u6642\u306f\uff0c\u623b\u3057\u3066\u3042\u3052\u3066\u304f\u3060\u3055\u3044\uff0e\n\n```\n[root@vagrant-centos65 ~]$ route add default gw 10.0.2.2\n[root@vagrant-centos65 ~]$ route del -net default gw 192.168.33.81 dev eth1\n```\n\n\u203b\u3053\u306e\u901a\u4fe1\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3092\uff0cNAT\u3067\u306a\u3093\u3068\u304b\u3067\u304d\u305d\u3046\u306a\u6c17\u3082\u3059\u308b\u306e\u3067\u3059\u304c\uff0c\u73fe\u72b6\u306e\u79c1\u3067\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\uff0e\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3067LoadBalancer\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\uff0e\n\u6b21\u306e\u3082\u306e\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070OK\u3067\u3059\uff0e\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-03-04 19.07.31.png](https://qiita-image-store.s3.amazonaws.com/0/63019/659e3e34-05c5-b96b-fb35-47d1ee17addd.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-03-04 19.07.31.png\")\n\n\u540c\u3058\u5185\u5bb9\u3060\u3068\u632f\u308a\u5206\u3051\u3089\u308c\u3066\u3044\u308b\u304b\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\uff0c/root/testapp/app/views/tests/index.html.erb \u306bWebServer1\u3068\u3044\u3063\u305f\u76ee\u5370\u3092\u8ffd\u52a0\u3057\u3066\u3042\u3052\u308b\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\uff0e\n\n\n#\u305d\u306e\u4ed6\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u8a18\u4e8b\n\n* [nginx + unicorn + Rails\u306e\u8a2d\u5b9a\u65b9\u6cd5](http://qiita.com/akito1986/items/56198edcafc222b320a8 \"nginx + unicorn + Rails\u306e\u8a2d\u5b9a\u65b9\u6cd5\")\n* [rails + nginx + unicorn\u9023\u643a](http://qiita.com/shinyashikis@github/items/ace49154f0c71c65b2c9 \"rails + nginx + unicorn\u9023\u643a\")\n* [Vagrant(CentOS6.5)\u306bRails4.1 + Nginx + Unicorn + MySQL\u74b0\u5883\u3067Rails\u3092\u8d77\u52d5\u3059\u308b\u3002](http://qiita.com/teitei_tk/items/74794983d9893c3e7a05 \"Vagrant(CentOS6.5)\u306bRails4.1 + Nginx + Unicorn + MySQL\u74b0\u5883\u3067Rails\u3092\u8d77\u52d5\u3059\u308b\u3002\")\n* [vagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059](http://qiita.com/ftakao2007/items/79c0e34657e2664801cf \"vagrant\u306eCentOS6.5\u3067LVS\u3092\u8a66\u3059\")\n", "tags": ["Rails", "vagrant", "unicorn", "\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5", "nginx"]}