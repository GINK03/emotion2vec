{"tags": ["test-kitchen", "\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9"], "context": " More than 1 year has passed since last update.Kitchen::Driver::Sakuracloud\u304c\u3072\u3063\u305d\u308a\u3068\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u3002\nTest-Kitchen \u306e\u30d0\u30fc\u30b8\u30e7\u30f31.4\u4ee5\u964d\u3067\u306fVM\u306e\u8abf\u9054\u306b\u95a2\u9023\u3059\u308b\u51e6\u7406\u3092\u3001\u72ec\u7acb\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nTest-Kitchen\u306b\u3064\u3044\u3066\u306f\uff1a test-kitchen\u306e\u3064\u304b\u3044\u304b\u305f\n\n\n\u5148\u65e5\u3001\u6240\u7528\u3067\u4f5c\u696d\u7528\u306eDebian\u30b5\u30fc\u30d0\u304c\u305d\u3053\u305d\u3053\u306e\u6027\u80fd\u30671\u3064\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306b\u4e00\u77ac\u3060\u3051\u4e0a\u3052\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\u30b3\u30f3\u30d1\u30cd\u958b\u304f\u306e\u304c\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067Test-Kitchen\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u66f8\u304f\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nTest-Kitchen\u306eDriver(VM\u306e\u4f5c\u6210\u30fb\u524a\u9664\u3092\u62c5\u5f53)\nv1.4\u4ee5\u964d\u306eDriver\u306f\u3001(\u8abf\u9054\u3057\u305f\u30b5\u30fc\u30d0\u3078\u306e\u63a5\u7d9a\u65b9\u6cd5\u304cSSH or WinRM\u306b\u9650\u308c\u3070)\n\n\u4f5c\u308b\u6642: \u4f5c\u3063\u3066\u3001ID(\u30af\u30e9\u30a6\u30c9\u30d9\u30f3\u30c0\u5074\u3067\u767a\u884c)\u3068SSH or WinRM\u3067\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30a2\u30c9\u30ec\u30b9\u3092state\u306b\u5165\u308c\u308b\n\u6d88\u3059\u6642: ID\u3092\u63a7\u3048\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u306b\u5f93\u3063\u3066\u524a\u9664\u3059\u308b\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u3076\u3093\u3067\u3001\u8a72\u5f53\u3059\u308b\u306e\u306f\u3053\u306e\u8fba\u3002\n\nlib/kitchen/driver/sakuracloud.rb\n...\n\n      def create(state)\n        server = create_server\n        state[:id] = server.id\n        state[:hostname] = server.interfaces.first[\"IPAddress\"]\n      end\n\n      def destroy(state)\n        destroy_server(state[:id]) if state[:id]\n      end\n\n...\n\n\n\nDriver\u306e\u5f79\u5272\u3063\u3066\u3053\u308c\u3060\u3051\u3067\u3059\u3002fog\u306b\u3057\u3066\u3042\u308b\u304b\u3089\u3001\u3053\u3046\u3044\u3046\u6642\u306b\u697d\u3061\u3093\u3002\n\n\u4f7f\u3046\u6642\nSAKURACLOUD_API_TOKEN\u3068SAKURACLOUD_API_TOKEN_SECRET\u306f\u74b0\u5883\u5909\u6570\u306b\u3042\u308c\u3070\u52dd\u624b\u306b\u4f7f\u3046\u306e\u3067\u3001\u3053\u306e\u3088\u3046\u306bYAML\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3002\n\n.kitchen.yml\n---\ndriver:\n  name: sakuracloud\n  sshkey_id: <%= ENV['SAKURA_SSHKEY_ID'] %>\n  api_zone: tk1a\n\ntransport:\n  username: root\n  ssh_key: <%= ENV['SAKURA_SSHKEY_PATH'] %>\n\nprovisioner:\n  name: shell\n\nverifier:\n  name: shell\n\nplatforms:\n  - name: debian8\n    driver:\n      sourcearchive: 112700890487\n      serverplan: 4004\n      diskplan: 4\n      size_mb: 20480\n  - name: ubuntu14\n    driver:\n      serverplan: 4004\n      diskplan: 4\n      size_mb: 20480\n    transport:\n      username: ubuntu\n\n\nsuites:\n  - name: default\n    run_list:\n    attributes:\n\n\nprovisioner=>shell\u3001\u306f\u30ab\u30ec\u30f3\u30c8\u306b\u3042\u308bbootstrap.sh\u3092\u8ee2\u9001\u3057\u3066\u53e9\u304f\u3002\nverifier =>shell\u3001\u306f\u7701\u7565\u3059\u308b\u3068\u30ed\u30fc\u30ab\u30eb\u306e/bin/true\u3067\u7d42\u308f\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u30a4\u30f3\u72b6\u614b\u3067\u5bfe\u8a71\u7684\u306b\u8a66\u3057\u305f\u3044\u4e8b\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u308c\u3067OK\u3002\nlist\u3092\u307f\u308c\u3070\u3001Driver\u306bSakuracloud\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002\n$ kitchen list\nInstance          Driver       Provisioner  Verifier  Transport  Last Action\ndefault-debian8   Sakuracloud  Shell        Shell     Ssh        <Not Created>\ndefault-ubuntu14  Sakuracloud  Shell        Shell     Ssh        <Not Created>\n\n\nVM\u3092\u8d77\u52d5\n\u305d\u3046\u305d\u3046\u3001\u3053\u306e\u3068\u304d\u306fglibc\u306e\u30ea\u30d3\u30eb\u30c9\u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u5909\u3048\u3064\u3064\u8a66\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u3002\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u6e96\u5099\u3060\u3051\u3057\u3066\u304f\u308c\u308c\u3070\u3088\u3044\u306e\u3067\u3001converge\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u304d\u307e\u3059\u3002\n\nbootstrap.sh\nsudo mkdir -p /usr/local/deb/glibc\ncd /usr/local/deb/glibc\n\nsudo apt-get update && apt-get install -y \\\ncmake dpkg-dev bison libbison-dev ruby \\\n&& apt-get build-dep -y glibc --fix-missing \\\n&& apt-get source -y glibc\n\n\n$ kitchen converge debian\n-----> Starting Kitchen (v1.4.2)\n-----> Creating <default-debian8>...\n[fog][WARNING] Create Server\n[fog][WARNING] Create Volume\n[fog][WARNING] Waiting disk until available\n.[fog][WARNING] Modifing disk\n       Finished creating <default-debian8> (1m31.15s).\n-----> Converging <default-debian8>...\n       Preparing files for transfer\n       Preparing script\n       [SSH] connection failed, retrying in 1 seconds (#<Timeout::Error: execution expired>)\n       Transferring files to <default-debian8>\nGet:1 http://security.debian.org jessie/updates InRelease [63.1 kB]\nGet:2 http://security.debian.org jessie/updates/main Sources [109 kB]          \nIgn http://dennou-h.gfd-dennou.org jessie InRelease     \n\n....\n\n-----> Kitchen is finished. (2m58.76s)\n\n\u3067\u306f\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u8272\u3005\u3068\u8a66\u3059\u3002\n$ kitchen login debian\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\n...\n\nroot@localhost:~#\n\n\nVM\u3092\u5ec3\u68c4\n\u3058\u3083\u3042\u6d88\u305d\u3046\u3002\n$ kitchen destroy debian\n-----> Starting Kitchen (v1.4.2)\n-----> Destroying <default-debian8>...\n       Finished destroying <default-debian8> (0m19.32s).\n-----> Kitchen is finished. (0m19.40s)\n\n\u306f\u3044\u6d88\u3048\u305f\u30fc\u3002\n\u666e\u901a\u306b\u5404\u7a2eProvisioner\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n[Kitchen::Driver::Sakuracloud](https://github.com/higanworks/kitchen-driver-sakuracloud)\u304c\u3072\u3063\u305d\u308a\u3068\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n[Test-Kitchen](http://kitchen.ci) \u306e\u30d0\u30fc\u30b8\u30e7\u30f31.4\u4ee5\u964d\u3067\u306fVM\u306e\u8abf\u9054\u306b\u95a2\u9023\u3059\u308b\u51e6\u7406\u3092\u3001\u72ec\u7acb\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n- Test-Kitchen\u306b\u3064\u3044\u3066\u306f\uff1a [test-kitchen\u306e\u3064\u304b\u3044\u304b\u305f](http://qiita.com/sawanoboly/items/9f560bd63ad0712b17ba)\n\n\u5148\u65e5\u3001\u6240\u7528\u3067\u4f5c\u696d\u7528\u306eDebian\u30b5\u30fc\u30d0\u304c\u305d\u3053\u305d\u3053\u306e\u6027\u80fd\u30671\u3064\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306b\u4e00\u77ac\u3060\u3051\u4e0a\u3052\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\u30b3\u30f3\u30d1\u30cd\u958b\u304f\u306e\u304c\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067Test-Kitchen\u306e\u30c9\u30e9\u30a4\u30d0\u3092\u66f8\u304f\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n## Test-Kitchen\u306eDriver(VM\u306e\u4f5c\u6210\u30fb\u524a\u9664\u3092\u62c5\u5f53)\n\nv1.4\u4ee5\u964d\u306eDriver\u306f\u3001(\u8abf\u9054\u3057\u305f\u30b5\u30fc\u30d0\u3078\u306e\u63a5\u7d9a\u65b9\u6cd5\u304cSSH or WinRM\u306b\u9650\u308c\u3070)\n\n- \u4f5c\u308b\u6642: \u4f5c\u3063\u3066\u3001ID(\u30af\u30e9\u30a6\u30c9\u30d9\u30f3\u30c0\u5074\u3067\u767a\u884c)\u3068SSH or WinRM\u3067\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30a2\u30c9\u30ec\u30b9\u3092state\u306b\u5165\u308c\u308b\n- \u6d88\u3059\u6642: ID\u3092\u63a7\u3048\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u306b\u5f93\u3063\u3066\u524a\u9664\u3059\u308b\n\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u3076\u3093\u3067\u3001\u8a72\u5f53\u3059\u308b\u306e\u306f\u3053\u306e\u8fba\u3002\n\n\n```ruby:lib/kitchen/driver/sakuracloud.rb\n...\n\n      def create(state)\n        server = create_server\n        state[:id] = server.id\n        state[:hostname] = server.interfaces.first[\"IPAddress\"]\n      end\n\n      def destroy(state)\n        destroy_server(state[:id]) if state[:id]\n      end\n\n...\n\n```\n\nDriver\u306e\u5f79\u5272\u3063\u3066\u3053\u308c\u3060\u3051\u3067\u3059\u3002[fog\u306b\u3057\u3066\u3042\u308b](https://github.com/fog/fog-sakuracloud)\u304b\u3089\u3001\u3053\u3046\u3044\u3046\u6642\u306b\u697d\u3061\u3093\u3002\n\n\n## \u4f7f\u3046\u6642\n\n`SAKURACLOUD_API_TOKEN`\u3068`SAKURACLOUD_API_TOKEN_SECRET`\u306f\u74b0\u5883\u5909\u6570\u306b\u3042\u308c\u3070\u52dd\u624b\u306b\u4f7f\u3046\u306e\u3067\u3001\u3053\u306e\u3088\u3046\u306bYAML\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3002\n\n```yaml:.kitchen.yml\n---\ndriver:\n  name: sakuracloud\n  sshkey_id: <%= ENV['SAKURA_SSHKEY_ID'] %>\n  api_zone: tk1a\n\ntransport:\n  username: root\n  ssh_key: <%= ENV['SAKURA_SSHKEY_PATH'] %>\n\nprovisioner:\n  name: shell\n\nverifier:\n  name: shell\n\nplatforms:\n  - name: debian8\n    driver:\n      sourcearchive: 112700890487\n      serverplan: 4004\n      diskplan: 4\n      size_mb: 20480\n  - name: ubuntu14\n    driver:\n      serverplan: 4004\n      diskplan: 4\n      size_mb: 20480\n    transport:\n      username: ubuntu\n\n\nsuites:\n  - name: default\n    run_list:\n    attributes:\n```\n\n`provisioner=>shell`\u3001\u306f\u30ab\u30ec\u30f3\u30c8\u306b\u3042\u308bbootstrap.sh\u3092\u8ee2\u9001\u3057\u3066\u53e9\u304f\u3002\n`verifier =>shell`\u3001\u306f\u7701\u7565\u3059\u308b\u3068\u30ed\u30fc\u30ab\u30eb\u306e`/bin/true`\u3067\u7d42\u308f\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u30a4\u30f3\u72b6\u614b\u3067\u5bfe\u8a71\u7684\u306b\u8a66\u3057\u305f\u3044\u4e8b\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u3053\u308c\u3067OK\u3002\n\n\nlist\u3092\u307f\u308c\u3070\u3001Driver\u306b`Sakuracloud`\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002\n\n```\n$ kitchen list\nInstance          Driver       Provisioner  Verifier  Transport  Last Action\ndefault-debian8   Sakuracloud  Shell        Shell     Ssh        <Not Created>\ndefault-ubuntu14  Sakuracloud  Shell        Shell     Ssh        <Not Created>\n```\n\n### VM\u3092\u8d77\u52d5\n\n\u305d\u3046\u305d\u3046\u3001\u3053\u306e\u3068\u304d\u306fglibc\u306e\u30ea\u30d3\u30eb\u30c9\u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u5909\u3048\u3064\u3064\u8a66\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u3002\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u6e96\u5099\u3060\u3051\u3057\u3066\u304f\u308c\u308c\u3070\u3088\u3044\u306e\u3067\u3001converge\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u304d\u307e\u3059\u3002\n\n```bootstrap.sh\nsudo mkdir -p /usr/local/deb/glibc\ncd /usr/local/deb/glibc\n\nsudo apt-get update && apt-get install -y \\\ncmake dpkg-dev bison libbison-dev ruby \\\n&& apt-get build-dep -y glibc --fix-missing \\\n&& apt-get source -y glibc\n```\n\n\n\n\n```\n$ kitchen converge debian\n-----> Starting Kitchen (v1.4.2)\n-----> Creating <default-debian8>...\n[fog][WARNING] Create Server\n[fog][WARNING] Create Volume\n[fog][WARNING] Waiting disk until available\n.[fog][WARNING] Modifing disk\n       Finished creating <default-debian8> (1m31.15s).\n-----> Converging <default-debian8>...\n       Preparing files for transfer\n       Preparing script\n       [SSH] connection failed, retrying in 1 seconds (#<Timeout::Error: execution expired>)\n       Transferring files to <default-debian8>\nGet:1 http://security.debian.org jessie/updates InRelease [63.1 kB]\nGet:2 http://security.debian.org jessie/updates/main Sources [109 kB]          \nIgn http://dennou-h.gfd-dennou.org jessie InRelease     \n\n....\n\n-----> Kitchen is finished. (2m58.76s)\n```\n\n\u3067\u306f\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u8272\u3005\u3068\u8a66\u3059\u3002\n\n```\n$ kitchen login debian\n\nThe programs included with the Debian GNU/Linux system are free software;\nthe exact distribution terms for each program are described in the\nindividual files in /usr/share/doc/*/copyright.\n\n...\n\nroot@localhost:~#\n```\n\n### VM\u3092\u5ec3\u68c4\n\n\u3058\u3083\u3042\u6d88\u305d\u3046\u3002\n\n```\n$ kitchen destroy debian\n-----> Starting Kitchen (v1.4.2)\n-----> Destroying <default-debian8>...\n       Finished destroying <default-debian8> (0m19.32s).\n-----> Kitchen is finished. (0m19.40s)\n```\n\n\u306f\u3044\u6d88\u3048\u305f\u30fc\u3002\n\n\u666e\u901a\u306b\u5404\u7a2eProvisioner\u3082\u4f7f\u3048\u307e\u3059\u3002\n"}