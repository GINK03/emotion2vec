{"context": "Mac OS X \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u51e6\u7406\uff08\u4e3b\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5229\u7528\u3059\u308b\u51e6\u7406\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\uff09\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\u4eba\u304c\u30ad\u30fc\u30dc\u30fc\u30c9\u3084\u30bf\u30c3\u30c1\u30d1\u30c3\u30c9\u306b\u89e6\u3063\u305f\u3089\u3001\u4eba\u9593\u304c\u884c\u306a\u3046\u51e6\u7406\u3092\u512a\u5148\u3059\u308b\u305f\u3081\u306b\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306e\u51e6\u7406\u3092\u4e00\u65e6\u505c\u6b62\u3057\u3001\u3057\u3070\u3089\u304f\u3055\u308f\u3089\u306a\u304b\u3063\u305f\u3089\u51e6\u7406\u3092\u518d\u958b\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\u30b3\u30fc\u30c9\u306f Gist \u306b\u3042\u308a\u307e\u3059\u3002 \u2225 Run processes while you do not touch your Mac.\n\n\u52d5\u6a5f\nMac \u306b\u5b9a\u671f\u7684\u306b\u9060\u65b9\u304b\u3089 rsync \u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a7\u30c3\u30c1\u3055\u305b\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3044\u304b\u3093\u305b\u3093\u3046\u3061\u306f\u7530\u820e\u3067 ADSL \u3057\u304b\u6765\u3066\u304a\u3089\u305a\u3001\u3055\u3066\u4f5c\u696d\u3092\u3059\u308b\u305e\u3068\u306a\u308b\u3068\u5049\u304f\u30cd\u30c3\u30c8\u304c\u9045\u304f\u3001\u3042\u3042\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u51e6\u7406\u3092\u3055\u305b\u3066\u3044\u305f\u3093\u3060\u3063\u3051\u3001\u3068\u3044\u3046\u3053\u3068\u306b\u3088\u304f\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001UI \u306b\u89e6\u3063\u3066\u3044\u308b\u9593\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306e\u51e6\u7406\u3092\u6b62\u3081\u3066\u3001\u30b5\u30af\u30b5\u30af\u3068\u4f5c\u696d\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u3002\nCPU \u8ca0\u8377\u306e\u9ad8\u3044\u3088\u3046\u306a\u51e6\u7406\u3067\u3082\u4f7f\u3048\u308b\u3063\u3061\u3083\u3042\u4f7f\u3048\u308b\u304b\u306a\uff1f Mac \u3067\u305d\u3093\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3002\n\u3067\u3001\u4f55\u3092\u3057\u3088\u3046\u3068\u3057\u305f\u304b\uff08\u3042\u308b\u3044\u306f\u3001\u4f55\u3092\u3057\u306a\u304b\u3063\u305f\u306e\u304b\uff09\u3092\u5fd8\u308c\u305d\u3046\u306a\u306e\u3067\u30e1\u30e2\u3057\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\u65b9\u6cd5\n\u30b3\u30de\u30f3\u30c9\u540d\u306f darwinbg \u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u3044\u305f\u306e\u3068\u540c\u3058\u5834\u6240\u306b darwinbg.d/ \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u305d\u306e\u4e0b\u306b\u5b9f\u884c\u53ef\u80fd\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u3051\u3070\u3001darwinbg \u3092\u5b9f\u884c\u3059\u308b\u305f\u3073\u306b\u914d\u4e0b\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u9806\u6b21\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3067\u3059\u306e\u3067\u3001\u9069\u5f53\u306a\u9593\u9694\u3067 cron \u306b\u3067\u3082\u4ed5\u639b\u3051\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\nUI \u306b\u89e6\u308c\u3066\u306f\u306a\u3089\u306a\u3044\u6642\u9593\u306f idlethresh \u306b\u3001\u305d\u306e\u78ba\u8a8d\u306e\u9593\u9694\u306f checkinterval \u306b\u3001\u3068\u3082\u306b\u79d2\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u305d\u3053\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308b\u9593\u306f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u6b32\u3057\u304f\u306a\u3044 Wi-Fi \u306e SSID \u306f badssids \u306b\u3001\u540c\u3058\u304f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u6b32\u3057\u304f\u306a\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d3\u30b9\u306f badnwsvcs \u306b\u3001\u305d\u308c\u305e\u308c\u914d\u5217\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u5f8c\u8005\u306f\u3001Bluetooth PAN \u3067\u30c6\u30b6\u30ea\u30f3\u30b0\u3092\u3057\u3066\u3044\u308b\u9593\u306a\u3069\u304c\u76f8\u5f53\u3057\u307e\u3059\u3002\n\u74b0\u5883\u5909\u6570 FORCE \u306b\u4f55\u304b\u3092\u5165\u308c\u3066\u8d77\u52d5\u3059\u308c\u3070\u3001UI \u3078\u306e\u30bf\u30c3\u30c1\u304c\u3042\u3063\u3066\u3082\u4e2d\u65ad\u3057\u307e\u305b\u3093\u3002\n\u8981\u70b9\u3068\u3057\u3066\u306f\u3001\u305d\u3093\u306a\u3068\u3053\u308d\u304b\u3002\n\ndarwinbg\n#!/bin/bash\n# -*- coding: utf-8 -*-\n\nexport PATH=/usr/local/bin:/usr/local/sbin/:/usr/bin/:/usr/sbin/:/bin/:/sbin/\n\n## Avoid reentrance.\nexec 9< $0\nperl -mFcntl=:flock -e \"open(LOCK,'<&=9');exit(!flock(LOCK,LOCK_EX|LOCK_NB))\" || exit 0\n\n## Exit for error or undefined.\nset -eu\n\nidlethresh=$((60 * 5))\ncheckinterval=10\n# idlethresh=5\n# checkinterval=5\n## Do not start nor continue with these SSIDs.\nbadssids=(\"Too Slow\", \"Too Expensive\")\n## Do not start nor continue with these network services.\nbadnwsvcs=(\"Bluetooth PAN\")\n\ncontains () {\n  local e\n  for e in \"${@:2}\"\n  do\n    test \"$e\" == \"$1\" && return 0\n  done\n  return 1\n}\n\nfunction badnetworkp() {\n  local ssid\n  local badnwsvc\n  ssid=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | sed -n -e \"s/^ *SSID: //p\")\n  if test -n \"$ssid\" && contains \"$ssid\" \"${badssids[@]}\"\n  then\n    echo \"Bad Wi-Fi is active.\"\n    return 0\n  fi\n  for badnwsvc in \"${badnwsvcs[@]}\"\n  do\n    if test -n \"$(/usr/sbin/networksetup -getinfo \"Bluetooth PAN\" | sed -ne s/\"^IP address: //p\")\"\n    then\n      echo \"Bad network service is active.\"\n      return 0\n    fi\n  done\n  return 1\n}\n\nif badnetworkp\nthen\n  echo \"Network connection is bad one. Exiting.\"\n  exit 0\nfi\n\n: ${FORCE:=\"\"}\n\n## Get UI idle time in second.\nfunction idlesec() {\n  test -n \"$FORCE\" && echo 86400 && return\n  echo $(($(ioreg -c IOHIDSystem | grep HIDIdleTime | head -n 1 | sed 's/.* = //') / 1000000000))\n}\n\n## Stop for a while if UI is recently used.\necho Waiting.\nwhile :\ndo\n  test \"$(idlesec)\" -ge \"$idlethresh\" && break\n  sleep $checkinterval\ndone\n\n## Get child process IDs.\nfunction children() {\n  for pid in $(pgrep -P $1)\n  do\n    echo $pid\n    children $pid\n  done\n}\n\n## Send signal to all child processes.\nfunction killtree() {\n  kill -s $1 $pid $(children $2) && :\n}\n\n## Absolute path of this script.\nself=\"$(p=\"$0\";while :;do t=\"$(readlink \"$p\")\";cd \"$(dirname \"$p\")\";test -z \"$t\"&&break||p=\"$t\";done;echo \"$(pwd -P)/$(basename \"$p\")\")\"\n\npid=\n\nfunction onexit() {\n  trap - SIGTERM # Reset to default handler\n  kill -- -$$ && : # Not option but process group\n  ## command line - What is a stopped process in linux? - Super User http://superuser.com/questions/403200/what-is-a-stopped-process-in-linux\n  kill --CONT -- -$$ && :\n}\n\n# function onexit() {\n#   test -n \"$pid\" && killtree TERM \"$pid\" || :\n# }\n\ntrap onexit SIGINT SIGTERM EXIT\n\n## Run all the executables under $self.d/ sequently.\nfor file in $self.d/*\ndo\n  base=$(basename \"$file\")\n  test \"${base:0:1}\" = \"_\" && continue\n  echo \"$base\" | grep -q -e \"~\" -e \"#\" && continue\n  $file &\n  pid=$!\n  while :\n  do\n    if badnetworkp\n    then\n      echo Network connection has been changed to bad one. Exiting.\n      killtree TERM $pid\n      wait\n      exit 0\n    fi\n    stat=\"$(ps auxww $pid | tail -n +2 | awk '{print $8}' | sed -e 's/\\(.\\).*/\\1/')\"\n    test -z \"$stat\" && pid=\"\" && break\n    case $stat in\n      R | S | D ) # Running\n        if test \"$(idlesec)\" -lt \"$idlethresh\"\n        then\n          killtree STOP $pid\n          echo \"Stopped subprocess(es).\"\n        fi\n        ;;\n      T ) # Stopped\n        if test \"$(idlesec)\" -ge \"$idlethresh\"\n        then\n          killtree CONT $pid\n          echo \"Restarted subprocess(es).\"\n        fi\n        ;;\n    esac\n    sleep $checkinterval\n  done\ndone\n\n\n\n\u3084\u3089\u306a\u304b\u3063\u305f\u3053\u3068\uff06\u3084\u3081\u305f\u3053\u3068\n\n\u505c\u6b62\u30fb\u518d\u958b\u3092\u5225\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u884c\u3046\u3002\n\n\n\u51e6\u7406\u672c\u4f53\u3068\u3001\u51e6\u7406\u306e\u505c\u6b62\u30fb\u518d\u958b\u3092\u884c\u3046\u30d7\u30ed\u30bb\u30b9\u3092\u5f53\u521d\u306f\u5225\u306b\u3057\u3066\u304a\u3044\u3066\u53cc\u65b9\u3092 cron \u3067\u8d77\u52d5\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u304f\u8003\u3048\u305f\u3089\u5fc5\u8981\u304c\u7121\u304b\u3063\u305f\u306e\u306e\u3067\u3084\u3081\u307e\u3057\u305f\n\u305f\u3060\u3057\u3053\u306e\u65b9\u6cd5\u3067\u3042\u308c\u3070\u3001\u672c\u51e6\u7406\u3068\u305d\u306e\u5236\u5fa1\u3068\u3092\u5225\u30b3\u30de\u30f3\u30c9\u306b\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u306f\u305d\u308c\u3067\u30e1\u30ea\u30c3\u30c8\u306a\u3093\u3067\u3059\u3088\u306d\u3002\u3084\u3084\u8907\u96d1\u306b\u306a\u308a\u307e\u3059\u304c\u3002\u305d\u308c\u306b\u3064\u3044\u3066\u306f\u3001\u53f3\u8a18\u306b\u66f8\u304d\u307e\u3057\u305f\u3002 \u2225 cron \u304b\u3089\u8d77\u52d5\u3055\u308c\u305f\u30b8\u30e7\u30d6\u3092\u3001\u4e00\u6642\u505c\u6b62\u30fb\u518d\u958b\u3059\u308b - Qiita\n\n\n\n\u5b9a\u671f\u7684\u306a\u30bf\u30a4\u30de\u30fc\u5272\u308a\u8fbc\u307f\u3067\u3001\u51e6\u7406\u306e\u505c\u6b62\u30fb\u518d\u958b\u306e\u8981\u4e0d\u8981\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u3002\n\n\nUSR1 \u3092\u30c1\u30de\u30c1\u30de\u3068\u767a\u884c\u3057\u3066\u305d\u306e\u305f\u3073\u306b\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u4ed5\u7d44\u307f\u3082\u3084\u308a\u304b\u3051\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u307e\u305f\u3088\u304f\u8003\u3048\u305f\u3089\u4e0d\u8981\u3060\u3063\u305f\u306e\u3067\u3084\u3081\u307e\u3057\u305f\u3002\n\n\n\n\n\u3067\u304d\u308c\u3070\n\u65e9\u304f\u3046\u3061\u3078\u3082\u3001\u9ad8\u901f\u306a\u5149\u30b1\u30fc\u30d6\u30eb\u304c\u6765\u3066\u304f\u308c\u308b\u3068\u3044\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u3002\n\nMac OS X \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u51e6\u7406\uff08\u4e3b\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5229\u7528\u3059\u308b\u51e6\u7406\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\uff09\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\u4eba\u304c\u30ad\u30fc\u30dc\u30fc\u30c9\u3084\u30bf\u30c3\u30c1\u30d1\u30c3\u30c9\u306b\u89e6\u3063\u305f\u3089\u3001\u4eba\u9593\u304c\u884c\u306a\u3046\u51e6\u7406\u3092\u512a\u5148\u3059\u308b\u305f\u3081\u306b\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306e\u51e6\u7406\u3092\u4e00\u65e6\u505c\u6b62\u3057\u3001\u3057\u3070\u3089\u304f\u3055\u308f\u3089\u306a\u304b\u3063\u305f\u3089\u51e6\u7406\u3092\u518d\u958b\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\u30b3\u30fc\u30c9\u306f Gist \u306b\u3042\u308a\u307e\u3059\u3002 \u2225 [Run processes while you do not touch your Mac.](https://gist.github.com/knaka/d44f4b4e301f13314080dbf63b5159aa)\n\n# \u52d5\u6a5f\n\nMac \u306b\u5b9a\u671f\u7684\u306b\u9060\u65b9\u304b\u3089 rsync \u3067\u30d5\u30a1\u30a4\u30eb\u3092\u30d5\u30a7\u30c3\u30c1\u3055\u305b\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u3044\u304b\u3093\u305b\u3093\u3046\u3061\u306f\u7530\u820e\u3067 ADSL \u3057\u304b\u6765\u3066\u304a\u3089\u305a\u3001\u3055\u3066\u4f5c\u696d\u3092\u3059\u308b\u305e\u3068\u306a\u308b\u3068\u5049\u304f\u30cd\u30c3\u30c8\u304c\u9045\u304f\u3001\u3042\u3042\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u51e6\u7406\u3092\u3055\u305b\u3066\u3044\u305f\u3093\u3060\u3063\u3051\u3001\u3068\u3044\u3046\u3053\u3068\u306b\u3088\u304f\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001UI \u306b\u89e6\u3063\u3066\u3044\u308b\u9593\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306e\u51e6\u7406\u3092\u6b62\u3081\u3066\u3001\u30b5\u30af\u30b5\u30af\u3068\u4f5c\u696d\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u3002\n\nCPU \u8ca0\u8377\u306e\u9ad8\u3044\u3088\u3046\u306a\u51e6\u7406\u3067\u3082\u4f7f\u3048\u308b\u3063\u3061\u3083\u3042\u4f7f\u3048\u308b\u304b\u306a\uff1f Mac \u3067\u305d\u3093\u306a\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u306f\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3002\n\n\u3067\u3001\u4f55\u3092\u3057\u3088\u3046\u3068\u3057\u305f\u304b\uff08\u3042\u308b\u3044\u306f\u3001\u4f55\u3092\u3057\u306a\u304b\u3063\u305f\u306e\u304b\uff09\u3092\u5fd8\u308c\u305d\u3046\u306a\u306e\u3067\u30e1\u30e2\u3057\u307e\u3057\u305f\u3002\n\n# \u5b9f\u884c\u65b9\u6cd5\n\n\u30b3\u30de\u30f3\u30c9\u540d\u306f `darwinbg` \u3068\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u3044\u305f\u306e\u3068\u540c\u3058\u5834\u6240\u306b `darwinbg.d/` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u305d\u306e\u4e0b\u306b\u5b9f\u884c\u53ef\u80fd\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u3051\u3070\u3001darwinbg \u3092\u5b9f\u884c\u3059\u308b\u305f\u3073\u306b\u914d\u4e0b\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u9806\u6b21\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u3067\u3059\u306e\u3067\u3001\u9069\u5f53\u306a\u9593\u9694\u3067 cron \u306b\u3067\u3082\u4ed5\u639b\u3051\u3066\u304a\u304f\u3068\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nUI \u306b\u89e6\u308c\u3066\u306f\u306a\u3089\u306a\u3044\u6642\u9593\u306f `idlethresh` \u306b\u3001\u305d\u306e\u78ba\u8a8d\u306e\u9593\u9694\u306f `checkinterval` \u306b\u3001\u3068\u3082\u306b\u79d2\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u305d\u3053\u3078\u63a5\u7d9a\u3057\u3066\u3044\u308b\u9593\u306f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u6b32\u3057\u304f\u306a\u3044 Wi-Fi \u306e SSID \u306f `badssids` \u306b\u3001\u540c\u3058\u304f\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3066\u6b32\u3057\u304f\u306a\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d3\u30b9\u306f `badnwsvcs` \u306b\u3001\u305d\u308c\u305e\u308c\u914d\u5217\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u5f8c\u8005\u306f\u3001Bluetooth PAN \u3067\u30c6\u30b6\u30ea\u30f3\u30b0\u3092\u3057\u3066\u3044\u308b\u9593\u306a\u3069\u304c\u76f8\u5f53\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\u5909\u6570 `FORCE` \u306b\u4f55\u304b\u3092\u5165\u308c\u3066\u8d77\u52d5\u3059\u308c\u3070\u3001UI \u3078\u306e\u30bf\u30c3\u30c1\u304c\u3042\u3063\u3066\u3082\u4e2d\u65ad\u3057\u307e\u305b\u3093\u3002\n\n\u8981\u70b9\u3068\u3057\u3066\u306f\u3001\u305d\u3093\u306a\u3068\u3053\u308d\u304b\u3002\n\n~~~~bash:darwinbg\n#!/bin/bash\n# -*- coding: utf-8 -*-\n\nexport PATH=/usr/local/bin:/usr/local/sbin/:/usr/bin/:/usr/sbin/:/bin/:/sbin/\n\n## Avoid reentrance.\nexec 9< $0\nperl -mFcntl=:flock -e \"open(LOCK,'<&=9');exit(!flock(LOCK,LOCK_EX|LOCK_NB))\" || exit 0\n\n## Exit for error or undefined.\nset -eu\n\nidlethresh=$((60 * 5))\ncheckinterval=10\n# idlethresh=5\n# checkinterval=5\n## Do not start nor continue with these SSIDs.\nbadssids=(\"Too Slow\", \"Too Expensive\")\n## Do not start nor continue with these network services.\nbadnwsvcs=(\"Bluetooth PAN\")\n\ncontains () {\n  local e\n  for e in \"${@:2}\"\n  do\n    test \"$e\" == \"$1\" && return 0\n  done\n  return 1\n}\n\nfunction badnetworkp() {\n  local ssid\n  local badnwsvc\n  ssid=$(/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport -I | sed -n -e \"s/^ *SSID: //p\")\n  if test -n \"$ssid\" && contains \"$ssid\" \"${badssids[@]}\"\n  then\n    echo \"Bad Wi-Fi is active.\"\n    return 0\n  fi\n  for badnwsvc in \"${badnwsvcs[@]}\"\n  do\n    if test -n \"$(/usr/sbin/networksetup -getinfo \"Bluetooth PAN\" | sed -ne s/\"^IP address: //p\")\"\n    then\n      echo \"Bad network service is active.\"\n      return 0\n    fi\n  done\n  return 1\n}\n\nif badnetworkp\nthen\n  echo \"Network connection is bad one. Exiting.\"\n  exit 0\nfi\n\n: ${FORCE:=\"\"}\n\n## Get UI idle time in second.\nfunction idlesec() {\n  test -n \"$FORCE\" && echo 86400 && return\n  echo $(($(ioreg -c IOHIDSystem | grep HIDIdleTime | head -n 1 | sed 's/.* = //') / 1000000000))\n}\n\n## Stop for a while if UI is recently used.\necho Waiting.\nwhile :\ndo\n  test \"$(idlesec)\" -ge \"$idlethresh\" && break\n  sleep $checkinterval\ndone\n\n## Get child process IDs.\nfunction children() {\n  for pid in $(pgrep -P $1)\n  do\n    echo $pid\n    children $pid\n  done\n}\n\n## Send signal to all child processes.\nfunction killtree() {\n  kill -s $1 $pid $(children $2) && :\n}\n\n## Absolute path of this script.\nself=\"$(p=\"$0\";while :;do t=\"$(readlink \"$p\")\";cd \"$(dirname \"$p\")\";test -z \"$t\"&&break||p=\"$t\";done;echo \"$(pwd -P)/$(basename \"$p\")\")\"\n\npid=\n\nfunction onexit() {\n  trap - SIGTERM # Reset to default handler\n  kill -- -$$ && : # Not option but process group\n  ## command line - What is a stopped process in linux? - Super User http://superuser.com/questions/403200/what-is-a-stopped-process-in-linux\n  kill --CONT -- -$$ && :\n}\n\n# function onexit() {\n#   test -n \"$pid\" && killtree TERM \"$pid\" || :\n# }\n\ntrap onexit SIGINT SIGTERM EXIT\n\n## Run all the executables under $self.d/ sequently.\nfor file in $self.d/*\ndo\n  base=$(basename \"$file\")\n  test \"${base:0:1}\" = \"_\" && continue\n  echo \"$base\" | grep -q -e \"~\" -e \"#\" && continue\n  $file &\n  pid=$!\n  while :\n  do\n    if badnetworkp\n    then\n      echo Network connection has been changed to bad one. Exiting.\n      killtree TERM $pid\n      wait\n      exit 0\n    fi\n    stat=\"$(ps auxww $pid | tail -n +2 | awk '{print $8}' | sed -e 's/\\(.\\).*/\\1/')\"\n    test -z \"$stat\" && pid=\"\" && break\n    case $stat in\n      R | S | D ) # Running\n        if test \"$(idlesec)\" -lt \"$idlethresh\"\n        then\n          killtree STOP $pid\n          echo \"Stopped subprocess(es).\"\n        fi\n        ;;\n      T ) # Stopped\n        if test \"$(idlesec)\" -ge \"$idlethresh\"\n        then\n          killtree CONT $pid\n          echo \"Restarted subprocess(es).\"\n        fi\n        ;;\n    esac\n    sleep $checkinterval\n  done\ndone\n~~~~\n\n# \u3084\u3089\u306a\u304b\u3063\u305f\u3053\u3068\uff06\u3084\u3081\u305f\u3053\u3068\n\n* \u505c\u6b62\u30fb\u518d\u958b\u3092\u5225\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u884c\u3046\u3002\n\t* \u51e6\u7406\u672c\u4f53\u3068\u3001\u51e6\u7406\u306e\u505c\u6b62\u30fb\u518d\u958b\u3092\u884c\u3046\u30d7\u30ed\u30bb\u30b9\u3092\u5f53\u521d\u306f\u5225\u306b\u3057\u3066\u304a\u3044\u3066\u53cc\u65b9\u3092 cron \u3067\u8d77\u52d5\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u304f\u8003\u3048\u305f\u3089\u5fc5\u8981\u304c\u7121\u304b\u3063\u305f\u306e\u306e\u3067\u3084\u3081\u307e\u3057\u305f\n\t* \u305f\u3060\u3057\u3053\u306e\u65b9\u6cd5\u3067\u3042\u308c\u3070\u3001\u672c\u51e6\u7406\u3068\u305d\u306e\u5236\u5fa1\u3068\u3092\u5225\u30b3\u30de\u30f3\u30c9\u306b\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u306f\u305d\u308c\u3067\u30e1\u30ea\u30c3\u30c8\u306a\u3093\u3067\u3059\u3088\u306d\u3002\u3084\u3084\u8907\u96d1\u306b\u306a\u308a\u307e\u3059\u304c\u3002\u305d\u308c\u306b\u3064\u3044\u3066\u306f\u3001\u53f3\u8a18\u306b\u66f8\u304d\u307e\u3057\u305f\u3002 \u2225 [cron \u304b\u3089\u8d77\u52d5\u3055\u308c\u305f\u30b8\u30e7\u30d6\u3092\u3001\u4e00\u6642\u505c\u6b62\u30fb\u518d\u958b\u3059\u308b - Qiita](http://qiita.com/knaka/items/a98b877981c952f1a8aa)\n* \u5b9a\u671f\u7684\u306a\u30bf\u30a4\u30de\u30fc\u5272\u308a\u8fbc\u307f\u3067\u3001\u51e6\u7406\u306e\u505c\u6b62\u30fb\u518d\u958b\u306e\u8981\u4e0d\u8981\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u3002\n\t* USR1 \u3092\u30c1\u30de\u30c1\u30de\u3068\u767a\u884c\u3057\u3066\u305d\u306e\u305f\u3073\u306b\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u4ed5\u7d44\u307f\u3082\u3084\u308a\u304b\u3051\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u307e\u305f\u3088\u304f\u8003\u3048\u305f\u3089\u4e0d\u8981\u3060\u3063\u305f\u306e\u3067\u3084\u3081\u307e\u3057\u305f\u3002\n\n# \u3067\u304d\u308c\u3070\n\n\u65e9\u304f\u3046\u3061\u3078\u3082\u3001\u9ad8\u901f\u306a\u5149\u30b1\u30fc\u30d6\u30eb\u304c\u6765\u3066\u304f\u308c\u308b\u3068\u3044\u3044\u3093\u3067\u3059\u3051\u3069\u306d\u3002\n\n\n", "tags": ["rsync", "MacOSX"]}