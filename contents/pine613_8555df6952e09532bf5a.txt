{"tags": ["Perl5.18.2", "openshift"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u7121\u6599\u3067\u4f7f\u3048\u308b OpenShift \u4e0a\u306b Perl + Carton + Plack \u3067\u69cb\u6210\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 Hot-Deploy \u53ef\u80fd\u306a\u72b6\u614b\u3067\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\n\nOpenShift \u3068\u306f?\nOpenShift \u306f Red Hat \u304c\u904b\u55b6\u3059\u308b PaaS (Platform as a Service) \u3067\u3059\u3002\nRuby, Python, Node \u306a\u3069\u8907\u6570\u306e\u8a00\u8a9e\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u3082\u3061\u308d\u3093 Perl \u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n3 \u3064\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u307e\u3067\u7121\u6599\u3067\u5229\u7528\u3067\u304d\u3001\u8a66\u3057\u306b\u5229\u7528\u3057\u3066\u307f\u305f\u308a\u3001\u5c0f\u3055\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u904b\u7528\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u30fc (MySQL \u7b49) \u3082\u7121\u6599\u7bc4\u56f2\u5185\u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\nHot-Deploy \u3068\u306f\nHoy-Deploy \u3068\u306f\u3001\u904b\u7528\u4e2d\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u305b\u305a\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u306e\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\u3053\u3068\u3092\u3044\u3044\u307e\u3059\u3002Hot-Deploy \u304c\u5229\u7528\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u4e00\u5b9a\u671f\u9593\u30b5\u30fc\u30d3\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u306a\u3069\u306e\u554f\u984c\u304c\u751f\u3058\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001Hot-Deploy \u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b Server::Starter \u3092\u7528\u3044\u307e\u3059\u3002\n\nCarton \u3068\u306f\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7ba1\u7406\u3059\u308b Perl \u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3067\u3059\u3002Node.js \u3067\u306e NPM\u3001Ruby \u3067\u306e Bundler \u306b\u3042\u305f\u308a\u307e\u3059\u3002Perl \u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nOpenShift \u4e0a\u3067 Perl \u3092\u52d5\u4f5c\u3055\u305b\u308b\u65b9\u6cd5\nOpenShift \u4e0a\u3067 Perl \u3092\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3001\u5927\u304d\u304f\u5206\u3051\u3066 2 \u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6a19\u6e96\u306e Perl \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3092\u4f7f\u3046\u65b9\u6cd5\nOpenShift \u3067\u306f\u3001\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3068\u3044\u3046\u5358\u4f4d\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 (\u3084\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9) \u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nOpenShift \u306b\u306f\u65e2\u306b Perl \u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u5834\u5408\u3001\u3068\u3066\u3082\u7c21\u5358\u306b Perl \u3092 OpenShift \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u306f\u3001Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 5.10 \u3067\u56fa\u5b9a\u3055\u308c\u3066\u3057\u307e\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u4eca\u56de\u306f\u3053\u306e\u65b9\u6cd5\u306f\u7528\u3044\u307e\u305b\u3093\u3002\n\u203b \u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u5bfe\u5fdc\u3057\u3066\u308b\u306a\u3069\u3001\u3053\u3061\u3089\u306e\u65b9\u3092\u9078\u629e\u3059\u308b\u30e1\u30ea\u30c3\u30c8\u3082\u3042\u308a\u307e\u3059\n\nDIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u4e0a\u306b\u81ea\u5206\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\nDIY (Do-It-Yourself) \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3068\u547c\u3070\u308c\u308b\u81ea\u5206\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u30bf\u30a4\u30d7\u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u3059\u3002\u4eca\u56de\u306f\u3053\u306e\u65b9\u6cd5\u3092\u63a1\u7528\u3057\u3066\u3001Perl / Carton \u3092\u81ea\u529b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nOpenShift \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u53d6\u5f97\nOpenShift \u306e\u30da\u30fc\u30b8\u304b\u3089\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u767b\u9332\u306f\u4e0d\u8981\u3067\u3059\u3002\u7121\u6599\u3067 3 \u3064\u307e\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\n\nDIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\u3057\u307e\u3059\u3002\u4f5c\u6210\u306e\u969b\u3001\u4f5c\u6210\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3042\u3068\u66ab\u304f\u5f85\u305f\u3055\u308c\u307e\u3059\u3002\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\nSSH \u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u306e\u3067\u3001\u516c\u958b\u9375\u3092 OpenShift \u3078\u767b\u9332\u5f8c\u3001SSH \u3067\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n\u300c Want to log in to your application? \u300d \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001SSH \u63a5\u7d9a\u60c5\u5831\u304c\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002\n\u203b \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u805e\u304b\u308c\u307e\u3059\u304c\u3001\u516c\u958b\u9375\u304c\u767b\u9332\u3057\u3066\u3042\u308c\u3070\u7a7a\u3067\u901a\u308a\u307e\u3059\n\nPerl \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSSH \u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n    *********************************************************************\n\n    You are accessing a service that is for use only by authorized users.\n    If you do not have authorization, discontinue use at once.\n    Any use of the services is subject to the applicable terms of the\n    agreement which can be found at:\n    https://www.openshift.com/legal\n\n    *********************************************************************\n\n    Welcome to OpenShift shell\n\n    This shell will assist you in managing OpenShift applications.\n\n    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!\n    Shell access is quite powerful and it is possible for you to\n    accidentally damage your application.  Proceed with care!\n    If worse comes to worst, destroy your application with \"rhc app delete\"\n    and recreate it\n    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!\n\n    Type \"help\" for more info.\n\n\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> \n\n\u4eca\u56de\u306f Perl 5.18.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nroot \u6a29\u9650\u306f\u306a\u3044\u305f\u3081\u3001\u3053\u3053\u3067\u306f ~/app-root \u3068\u3044\u3046 OpenShift \u3067\u3044\u3046\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059 (OpenShift \u3067\u306f\u3001\u901a\u5e38\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea $HOME \u306b\u5bfe\u3057\u3066\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093)\u3002\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> cd ~/app-root/data/\n[diy-pinemz.rhcloud.com data]\\> mkdir src\n[diy-pinemz.rhcloud.com data]\\> cd src\n[diy-pinemz.rhcloud.com src]\\> wget http://www.cpan.org/src/5.0/perl-5.18.2.tar.gz # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com src]\\> ls\nperl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> tar xzf perl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> ls\nperl-5.18.2  perl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> cd perl-5.18.2\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> ls # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> ./Configure -des -Dprefix=~/app-root/data/perl-5.18.2 # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> make # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> make install # \u51fa\u529b\u7565\n\n\u3053\u308c\u3067 Perl \u304c ~/app-root/data/perl-5.18.2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\nCarton \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6a29\u9650\u306e\u95a2\u4fc2\u4e0a\u3001\u901a\u5e38\u306e\u65b9\u6cd5\u3067\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5c11\u3005\u7279\u6b8a\u306a\u65b9\u6cd5\u3092\u53d6\u308a\u307e\u3059\u3002\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> cd ~/app-root/data/perl-5.18.2/bin\n[diy-pinemz.rhcloud.com bin]\\> PATH=$PWD:$PATH # Perl 5.18.2 \u3092\u30d1\u30b9\u306b\u8ffd\u52a0\n[diy-pinemz.rhcloud.com bin]\\> perl -V:version\nversion='5.18.2';\n[diy-pinemz.rhcloud.com bin]\\> curl -L http://cpanmin.us > cpanm\n[diy-pinemz.rhcloud.com bin]\\> chmod +x cpanm\n[diy-pinemz.rhcloud.com bin]\\> HOME=~/app-root/data # \u3053\u308c\u304c\u809d\n[diy-pinemz.rhcloud.com bin]\\> cpanm --version # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com bin]\\> cpanm Carton\n[diy-pinemz.rhcloud.com bin]\\> carton -v\n\n\u203b cpanm \u306f\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u3068\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u307e\u305b\u3093\n\n\u30c6\u30b9\u30c8\u7528\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\u4ee5\u964d\u306f OpenShift \u4e0a\u3067\u306f\u306a\u304f\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001\u30c6\u30b9\u30c8\u7528\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066 Amon 2 \u3092\u4f7f\u3044\u307e\u3059\u3002\u30ea\u30e2\u30fc\u30c8\u306e Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u3001\u30ed\u30fc\u30ab\u30eb\u306e Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u63c3\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n$ cpanm Amon2 # \u51fa\u529b\u7565\n$ amon2-setup.pl diy # \u51fa\u529b\u7565\n$ cd diy\n$ carton install # \u51fa\u529b\u7565\n$ git status\nOn branch master\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        cpanfile.snapshot\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n$ git add .\n$ git commit -m \"Create cpanfile.snapshot\"\n[master fa15dac] Create cpanfile.snapshot\n 1 file changed, 2745 insertions(+)\n create mode 100644 cpanfile.snapshot\n\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ carton exec -- perl script/diy-server\ndiy: http://127.0.0.1:5000/\n\n\nOpenShift \u3078\u30c7\u30d7\u30ed\u30a4\n\nHot-Deploy \u975e\u5bfe\u5fdc\u7248\nHot-Deploy \u5316\u306f\u5f8c\u5468\u308a\u306b\u3057\u3066\u3001OpenShift \u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Perl / Carton \u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\nOpenShift \u3078\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u306f Git \u3092\u4f7f\u3044\u307e\u3059\u3002OpenShift \u4e0a\u306e Git \u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u30ea\u30e2\u30fc\u30c8\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059 (URI \u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u3066\u307e\u3059)\u3002\n\n$ git remote add deploy ssh://xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com/~/git/diy.git/\ngit pull deploy master # \u51fa\u529b\u7565\n\nOpenShift \u306e\u30ea\u30e2\u30fc\u30c8\u30ec\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u53d6\u5f97\u3055\u308c\u308b\u306e\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ls -a | grep openshift\n.openshift\n$ ls .openshift\naction_hooks  cron  markers  README.md\n$ ls .openshift/action_hooks\nREADME.md  start  stop\n\nOpenShift \u306e DIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u6642\u306b .openshift/action_hooks/start\u3001\u7d42\u4e86\u6642\u306b .openshift/action_hooks/stop \u304c\u547c\u3070\u308c\u308b\u4ed5\u69d8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n.openshift/action_hooks/start\n#!/bin/bash\n\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea `$OPENSHIFT_REPO_DIR` \u306f\u6bce\u56de\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\n# \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u52b9\u304b\u305b\u308b\u305f\u3081\u306b Carton \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u3092\u79fb\u52d5\nexport PERL_CARTON_PATH=~/app-root/data/local\n\n# PERL_CARTON_PATH \u3092\u5909\u66f4\u3057\u305f\u3089\u30bb\u30c3\u30c8\u3067\u6307\u5b9a\nexport PERL_CARTON_CPANFILE=$OPENSHIFT_REPO_DIR/cpanfile\n\n# Carton \u3092\u8aad\u307f\u306b\u884c\u304f\u3088\u3046\u306b\nexport PERL5LIB=$PERL_CARTON_PATH/lib/perl5\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Perl 5.18.2 \u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\nexport PATH=~/app-root/data/perl-5.18.2/bin:$PATH\n\n# \u4eca\u56de\u306e\u809d\nHOME=~/app-root/data\n\ncd $OPENSHIFT_REPO_DIR\n\n# \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncarton install --deployment\n\n# \u8d77\u52d5\nnohup carton exec -- perl ./script/diy-server --host=$OPENSHIFT_DIY_IP --port=$OPENSHIFT_DIY_PORT > /dev/null 2>&1 &\n\n\n\n.openshift/action_hooks/stop\n#!/bin/bash\n\nkill `ps -ef | grep diy-server | grep -v grep | awk '{ print $2 }'` > /dev/null 2>&1\nexit 0\n\n\n\u5909\u66f4\u3057\u305f\u3089\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n$ git status\nOn branch master\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\n\n        modified:   .openshift/action_hooks/start\n        modified:   .openshift/action_hooks/stop\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n$ git add .\n$ git commit -m \"Fix start/stop script\"\n$ git push deploy master\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u8868\u793a\u3057\u3066\u307f\u3066\u3001\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n\nHot-Deploy \u5bfe\u5fdc\u7248\n\u7121\u4e8b\u306b OpenShift \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306f Hot-Deploy \u306b\u5bfe\u5fdc\u3055\u305b\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Hot-Deploy \u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b Server::Starter \u3092\u7528\u3044\u307e\u3059\u3002Server::Starter \u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3053\u3067\u306f\u8aac\u660e\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u65b9\u306f\u5225\u9014\u8abf\u3079\u3066\u304f\u3060\u3055\u3044\u3002\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f .openshift/action_hooks/start \u3068 .openshift/action_hooks/stop \u306f\u4f7f\u308f\u306a\u3044\u306e\u3067\u6d88\u3057\u307e\u3059\u3002\u4ee3\u308f\u308a\u306b\u3001.openshift/action_hooks/deploy \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3068 `` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ rm -f .openshift/action_hooks/start\n$ rm -f .openshift/action_hooks/stop\n$ touch .openshift/markers/hot_deploy # Hot-Deploy \u3092\u6709\u52b9\u5316\n\n\n.openshift/action_hooks/deploy\n#!/bin/bash\n\necho \"Running .openshift/action_hooks/deploy\"\n\n# OpenShift \u74b0\u5883\u3067\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306e\u5909\u6570\u5b9a\u7fa9\nexport PERL_CARTON_PATH=~/app-root/data/local\nexport PERL_CARTON_CPANFILE=$OPENSHIFT_REPO_DIR/cpanfile\nexport PERL5LIB=$PERL_CARTON_PATH/lib/perl5\n\n# Carton \u306e bin \u3082 PATH \u306b\u8ffd\u52a0\u3059\u308b (start_server / plackup \u3067\u5229\u7528)\nexport PATH=$PERL_CARTON_PATH/bin:~/app-root/data/perl-5.18.2/bin:$PATH\n\n# \u4eca\u56de\u306e\u809d\nHOME=~/app-root/data\n\ncd $OPENSHIFT_REPO_DIR\n\n# \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncarton install --deployment\n\n# \u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u306e PID \u3092\u53d6\u5f97\nPID=`ps -ef | grep start_server | grep -v grep | awk '{ print $2 }'`\n\nif [ \"$PID\" != \"\" ]; then\n    kill -s HUP $PID # \u518d\u8d77\u52d5\nelse\n    nohup start_server --port=$OPENSHIFT_DIY_IP:$OPENSHIFT_DIY_PORT -- plackup -s Starlet \\\n        --max-workers=1 \\\n        $OPENSHIFT_REPO_DIR/script/diy-server \\\n        >> $OPENSHIFT_DIY_LOG_DIR/plack.log 2>&1 & # \u8d77\u52d5\nfi\n\n\n\u30c7\u30d7\u30ed\u30a4\u524d\u306b OpenShift \u4e0a\u3067\u65e2\u306b\u52d5\u3044\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> kill `ps -ef | grep diy-server | grep -v grep | awk '{ print $2 }'`\n\n\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n$ git status\ngit status\nOn branch master\nChanges not staged for commit:\n  (use \"git add/rm <file>...\" to update what will be committed)\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\n\n        deleted:    .openshift/action_hooks/start\n        deleted:    .openshift/action_hooks/stop\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        .openshift/action_hooks/deploy\n        .openshift/markers/hot_deploy\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n$ chmod +x .openshift/action_hooks/deploy\n$ git add --all\n$ git commit -m \"Support hot deloy\"\n$ git push deploy master\n\n\u304d\u3061\u3093\u3068\u52d5\u3044\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306b\u306f\u3001SSH \u3067 OpenShift \u3078\u7e4b\u3044\u3067\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> tail -f $OPENSHIFT_DIY_LOG_DIR/plack.log\nstart_server (pid:430204) starting now...\nstarting new worker 430218\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\n\nOpenShift \u3067\u306f push \u6642\u306b\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u52d5\u304f\u306e\u3067\u3001\u7a7a\u30b3\u30df\u30c3\u30c8\u3092\u9001\u3063\u3066\u5f37\u5236\u7684\u306b\u8d70\u3089\u305b\u307e\u3059\u3002\n$ git commit -m \"Test hot deploy\" --allow-empty\n$ git push deploy master\n\nServer::Starter \u306b\u3088\u308a\u3001Hot-Deploy \u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> tail -f $OPENSHIFT_DIY_LOG_DIR/plack.log\nstart_server (pid:430204) starting now...\nstarting new worker 430218\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\nreceived HUP, spawning a new worker\nstarting new worker 434971\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\nnew worker is now running, sending TERM to old workers:430218\nkilling old workers\nold worker 430218 died, status:0\n\n\n\u307e\u3068\u3081\nOpenShift \u3092\u4f7f\u3046\u3068\u3001\u7c21\u5358\u306b Perl + Carton \u3067 Hot-Deploy \u74b0\u5883\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\u7121\u6599\u67a0\u3082\u3042\u308a\u3001\u5c0f\u3055\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u904b\u7528\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u300c \u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u3060\u3068\u5236\u7d04\u304c\u304d\u3064\u3044\u3051\u3069 VPS \u5951\u7d04\u3059\u308b\u306e\u306f\u3061\u3087\u3063\u3068\u2026 \u300d \u3068\u3044\u3046\u65b9\u306b\u3001\u305c\u3072\u3069\u3046\u305e!\n\n\u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\n\nOpenShift Online\u3067\u4efb\u610f\u306ePerl\u30d0\u30fc\u30b8\u30e7\u30f3\u3067Web\u30a2\u30d7\u30ea\u3092\u516c\u958b\u3059\u308b\u65b9\u6cd5\n\n# \u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u7121\u6599\u3067\u4f7f\u3048\u308b OpenShift \u4e0a\u306b Perl + Carton + Plack \u3067\u69cb\u6210\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092 Hot-Deploy \u53ef\u80fd\u306a\u72b6\u614b\u3067\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\n\n## OpenShift \u3068\u306f?\nOpenShift \u306f Red Hat \u304c\u904b\u55b6\u3059\u308b PaaS (Platform as a Service) \u3067\u3059\u3002\nRuby, Python, Node \u306a\u3069\u8907\u6570\u306e\u8a00\u8a9e\u306b\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u3082\u3061\u308d\u3093 Perl \u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n3 \u3064\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u307e\u3067\u7121\u6599\u3067\u5229\u7528\u3067\u304d\u3001\u8a66\u3057\u306b\u5229\u7528\u3057\u3066\u307f\u305f\u308a\u3001\u5c0f\u3055\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u904b\u7528\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\u30fc (MySQL \u7b49) \u3082\u7121\u6599\u7bc4\u56f2\u5185\u3067\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n## Hot-Deploy \u3068\u306f\nHoy-Deploy \u3068\u306f\u3001\u904b\u7528\u4e2d\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u305b\u305a\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u306e\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\u3053\u3068\u3092\u3044\u3044\u307e\u3059\u3002Hot-Deploy \u304c\u5229\u7528\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u4e00\u5b9a\u671f\u9593\u30b5\u30fc\u30d3\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u306a\u3069\u306e\u554f\u984c\u304c\u751f\u3058\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001Hot-Deploy \u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b [Server::Starter](http://search.cpan.org/perldoc?Server::Starter) \u3092\u7528\u3044\u307e\u3059\u3002\n\n## Carton \u3068\u306f\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7ba1\u7406\u3059\u308b Perl \u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3067\u3059\u3002Node.js \u3067\u306e NPM\u3001Ruby \u3067\u306e Bundler \u306b\u3042\u305f\u308a\u307e\u3059\u3002Perl \u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# OpenShift \u4e0a\u3067 Perl \u3092\u52d5\u4f5c\u3055\u305b\u308b\u65b9\u6cd5\nOpenShift \u4e0a\u3067 Perl \u3092\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3001\u5927\u304d\u304f\u5206\u3051\u3066 2 \u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u6a19\u6e96\u306e Perl \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3092\u4f7f\u3046\u65b9\u6cd5\nOpenShift \u3067\u306f\u3001\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3068\u3044\u3046\u5358\u4f4d\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 (\u3084\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9) \u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nOpenShift \u306b\u306f\u65e2\u306b Perl \u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u4f7f\u3046\u5834\u5408\u3001\u3068\u3066\u3082\u7c21\u5358\u306b Perl \u3092 OpenShift \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u306f\u3001Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 5.10 \u3067\u56fa\u5b9a\u3055\u308c\u3066\u3057\u307e\u3046\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u4eca\u56de\u306f\u3053\u306e\u65b9\u6cd5\u306f\u7528\u3044\u307e\u305b\u3093\u3002\n\n\u203b \u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u5bfe\u5fdc\u3057\u3066\u308b\u306a\u3069\u3001\u3053\u3061\u3089\u306e\u65b9\u3092\u9078\u629e\u3059\u308b\u30e1\u30ea\u30c3\u30c8\u3082\u3042\u308a\u307e\u3059\n\n## DIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u4e0a\u306b\u81ea\u5206\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\nDIY (Do-It-Yourself) \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3068\u547c\u3070\u308c\u308b\u81ea\u5206\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u30bf\u30a4\u30d7\u306e\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u3059\u3002\u4eca\u56de\u306f\u3053\u306e\u65b9\u6cd5\u3092\u63a1\u7528\u3057\u3066\u3001Perl / Carton \u3092\u81ea\u529b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n# OpenShift \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u53d6\u5f97\n[OpenShift](https://www.openshift.com/) \u306e\u30da\u30fc\u30b8\u304b\u3089\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u60c5\u5831\u306e\u767b\u9332\u306f\u4e0d\u8981\u3067\u3059\u3002\u7121\u6599\u3067 3 \u3064\u307e\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u307e\u3059\u3002\n\n# \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\n\n![Do-It-Yourself](https://qiita-image-store.s3.amazonaws.com/0/51394/37374aad-a545-909d-8a0e-91afa3f10941.png)\n\nDIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\u3057\u307e\u3059\u3002\u4f5c\u6210\u306e\u969b\u3001\u4f5c\u6210\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3042\u3068\u66ab\u304f\u5f85\u305f\u3055\u308c\u307e\u3059\u3002\n\n![Git repository](https://qiita-image-store.s3.amazonaws.com/0/51394/1c4c5f1f-94ba-6f58-6276-f1d80ad41b0f.png)\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\nSSH \u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u306e\u3067\u3001\u516c\u958b\u9375\u3092 OpenShift \u3078\u767b\u9332\u5f8c\u3001SSH \u3067\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n![Git repository and SSH](https://qiita-image-store.s3.amazonaws.com/0/51394/b5f5ecee-5ffc-0730-0731-9a335f8ca218.png)\n\n\u300c Want to log in to your application? \u300d \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001SSH \u63a5\u7d9a\u60c5\u5831\u304c\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002\n\n\u203b \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u805e\u304b\u308c\u307e\u3059\u304c\u3001\u516c\u958b\u9375\u304c\u767b\u9332\u3057\u3066\u3042\u308c\u3070\u7a7a\u3067\u901a\u308a\u307e\u3059\n\n# Perl \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSSH \u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n```\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n    *********************************************************************\n\n    You are accessing a service that is for use only by authorized users.\n    If you do not have authorization, discontinue use at once.\n    Any use of the services is subject to the applicable terms of the\n    agreement which can be found at:\n    https://www.openshift.com/legal\n\n    *********************************************************************\n\n    Welcome to OpenShift shell\n\n    This shell will assist you in managing OpenShift applications.\n\n    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!\n    Shell access is quite powerful and it is possible for you to\n    accidentally damage your application.  Proceed with care!\n    If worse comes to worst, destroy your application with \"rhc app delete\"\n    and recreate it\n    !!! IMPORTANT !!! IMPORTANT !!! IMPORTANT !!!\n\n    Type \"help\" for more info.\n\n\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> \n```\n\n\u4eca\u56de\u306f Perl 5.18.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nroot \u6a29\u9650\u306f\u306a\u3044\u305f\u3081\u3001\u3053\u3053\u3067\u306f `~/app-root` \u3068\u3044\u3046 OpenShift \u3067\u3044\u3046\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059 (OpenShift \u3067\u306f\u3001\u901a\u5e38\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea `$HOME` \u306b\u5bfe\u3057\u3066\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093)\u3002\n\n```\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> cd ~/app-root/data/\n[diy-pinemz.rhcloud.com data]\\> mkdir src\n[diy-pinemz.rhcloud.com data]\\> cd src\n[diy-pinemz.rhcloud.com src]\\> wget http://www.cpan.org/src/5.0/perl-5.18.2.tar.gz # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com src]\\> ls\nperl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> tar xzf perl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> ls\nperl-5.18.2  perl-5.18.2.tar.gz\n[diy-pinemz.rhcloud.com src]\\> cd perl-5.18.2\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> ls # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> ./Configure -des -Dprefix=~/app-root/data/perl-5.18.2 # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> make # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> make install # \u51fa\u529b\u7565\n```\n\n\u3053\u308c\u3067 Perl \u304c `~/app-root/data/perl-5.18.2` \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n# Carton \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6a29\u9650\u306e\u95a2\u4fc2\u4e0a\u3001\u901a\u5e38\u306e\u65b9\u6cd5\u3067\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5c11\u3005\u7279\u6b8a\u306a\u65b9\u6cd5\u3092\u53d6\u308a\u307e\u3059\u3002\n\n```\n[diy-pinemz.rhcloud.com perl-5.18.2]\\> cd ~/app-root/data/perl-5.18.2/bin\n[diy-pinemz.rhcloud.com bin]\\> PATH=$PWD:$PATH # Perl 5.18.2 \u3092\u30d1\u30b9\u306b\u8ffd\u52a0\n[diy-pinemz.rhcloud.com bin]\\> perl -V:version\nversion='5.18.2';\n[diy-pinemz.rhcloud.com bin]\\> curl -L http://cpanmin.us > cpanm\n[diy-pinemz.rhcloud.com bin]\\> chmod +x cpanm\n[diy-pinemz.rhcloud.com bin]\\> HOME=~/app-root/data # \u3053\u308c\u304c\u809d\n[diy-pinemz.rhcloud.com bin]\\> cpanm --version # \u51fa\u529b\u7565\n[diy-pinemz.rhcloud.com bin]\\> cpanm Carton\n[diy-pinemz.rhcloud.com bin]\\> carton -v\n```\n\n\u203b cpanm \u306f\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u3068\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u307e\u305b\u3093\n\n# \u30c6\u30b9\u30c8\u7528\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\u4ee5\u964d\u306f OpenShift \u4e0a\u3067\u306f\u306a\u304f\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001\u30c6\u30b9\u30c8\u7528\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066 Amon 2 \u3092\u4f7f\u3044\u307e\u3059\u3002\u30ea\u30e2\u30fc\u30c8\u306e Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u3001\u30ed\u30fc\u30ab\u30eb\u306e Perl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u63c3\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ cpanm Amon2 # \u51fa\u529b\u7565\n$ amon2-setup.pl diy # \u51fa\u529b\u7565\n$ cd diy\n$ carton install # \u51fa\u529b\u7565\n$ git status\nOn branch master\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        cpanfile.snapshot\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n$ git add .\n$ git commit -m \"Create cpanfile.snapshot\"\n[master fa15dac] Create cpanfile.snapshot\n 1 file changed, 2745 insertions(+)\n create mode 100644 cpanfile.snapshot\n```\n\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ carton exec -- perl script/diy-server\ndiy: http://127.0.0.1:5000/\n```\n\n# OpenShift \u3078\u30c7\u30d7\u30ed\u30a4\n## Hot-Deploy \u975e\u5bfe\u5fdc\u7248\nHot-Deploy \u5316\u306f\u5f8c\u5468\u308a\u306b\u3057\u3066\u3001OpenShift \u4e0a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Perl / Carton \u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nOpenShift \u3078\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u306f Git \u3092\u4f7f\u3044\u307e\u3059\u3002OpenShift \u4e0a\u306e Git \u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u30ea\u30e2\u30fc\u30c8\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059 (URI \u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u3066\u307e\u3059)\u3002\n\n![Source Code](https://qiita-image-store.s3.amazonaws.com/0/51394/40ec9651-7096-3317-afe6-c60d8e446298.png)\n\n```\n$ git remote add deploy ssh://xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com/~/git/diy.git/\ngit pull deploy master # \u51fa\u529b\u7565\n```\n\nOpenShift \u306e\u30ea\u30e2\u30fc\u30c8\u30ec\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u53d6\u5f97\u3055\u308c\u308b\u306e\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ls -a | grep openshift\n.openshift\n$ ls .openshift\naction_hooks  cron  markers  README.md\n$ ls .openshift/action_hooks\nREADME.md  start  stop\n```\n\nOpenShift \u306e DIY \u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067\u306f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u6642\u306b `.openshift/action_hooks/start`\u3001\u7d42\u4e86\u6642\u306b `.openshift/action_hooks/stop` \u304c\u547c\u3070\u308c\u308b\u4ed5\u69d8\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```bash:.openshift/action_hooks/start\n#!/bin/bash\n\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea `$OPENSHIFT_REPO_DIR` \u306f\u6bce\u56de\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\n# \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u52b9\u304b\u305b\u308b\u305f\u3081\u306b Carton \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u3092\u79fb\u52d5\nexport PERL_CARTON_PATH=~/app-root/data/local\n\n# PERL_CARTON_PATH \u3092\u5909\u66f4\u3057\u305f\u3089\u30bb\u30c3\u30c8\u3067\u6307\u5b9a\nexport PERL_CARTON_CPANFILE=$OPENSHIFT_REPO_DIR/cpanfile\n\n# Carton \u3092\u8aad\u307f\u306b\u884c\u304f\u3088\u3046\u306b\nexport PERL5LIB=$PERL_CARTON_PATH/lib/perl5\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f Perl 5.18.2 \u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\nexport PATH=~/app-root/data/perl-5.18.2/bin:$PATH\n\n# \u4eca\u56de\u306e\u809d\nHOME=~/app-root/data\n\ncd $OPENSHIFT_REPO_DIR\n\n# \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncarton install --deployment\n\n# \u8d77\u52d5\nnohup carton exec -- perl ./script/diy-server --host=$OPENSHIFT_DIY_IP --port=$OPENSHIFT_DIY_PORT > /dev/null 2>&1 &\n```\n\n```bash:.openshift/action_hooks/stop\n#!/bin/bash\n\nkill `ps -ef | grep diy-server | grep -v grep | awk '{ print $2 }'` > /dev/null 2>&1\nexit 0\n```\n\n\u5909\u66f4\u3057\u305f\u3089\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n```\n$ git status\nOn branch master\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\n\n        modified:   .openshift/action_hooks/start\n        modified:   .openshift/action_hooks/stop\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n$ git add .\n$ git commit -m \"Fix start/stop script\"\n$ git push deploy master\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u8868\u793a\u3057\u3066\u307f\u3066\u3001\u8868\u793a\u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n\n## Hot-Deploy \u5bfe\u5fdc\u7248\n\u7121\u4e8b\u306b OpenShift \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306f Hot-Deploy \u306b\u5bfe\u5fdc\u3055\u305b\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Hot-Deploy \u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b [Server::Starter](http://search.cpan.org/perldoc?Server::Starter) \u3092\u7528\u3044\u307e\u3059\u3002Server::Starter \u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3053\u3067\u306f\u8aac\u660e\u3057\u307e\u305b\u3093\u306e\u3067\u3001\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u65b9\u306f\u5225\u9014\u8abf\u3079\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f `.openshift/action_hooks/start` \u3068 `.openshift/action_hooks/stop` \u306f\u4f7f\u308f\u306a\u3044\u306e\u3067\u6d88\u3057\u307e\u3059\u3002\u4ee3\u308f\u308a\u306b\u3001`.openshift/action_hooks/deploy` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3068 `` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ rm -f .openshift/action_hooks/start\n$ rm -f .openshift/action_hooks/stop\n$ touch .openshift/markers/hot_deploy # Hot-Deploy \u3092\u6709\u52b9\u5316\n```\n\n```bash:.openshift/action_hooks/deploy\n#!/bin/bash\n\necho \"Running .openshift/action_hooks/deploy\"\n\n# OpenShift \u74b0\u5883\u3067\u52d5\u4f5c\u3055\u305b\u308b\u305f\u3081\u306e\u5909\u6570\u5b9a\u7fa9\nexport PERL_CARTON_PATH=~/app-root/data/local\nexport PERL_CARTON_CPANFILE=$OPENSHIFT_REPO_DIR/cpanfile\nexport PERL5LIB=$PERL_CARTON_PATH/lib/perl5\n\n# Carton \u306e bin \u3082 PATH \u306b\u8ffd\u52a0\u3059\u308b (start_server / plackup \u3067\u5229\u7528)\nexport PATH=$PERL_CARTON_PATH/bin:~/app-root/data/perl-5.18.2/bin:$PATH\n\n# \u4eca\u56de\u306e\u809d\nHOME=~/app-root/data\n\ncd $OPENSHIFT_REPO_DIR\n\n# \u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncarton install --deployment\n\n# \u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u306e PID \u3092\u53d6\u5f97\nPID=`ps -ef | grep start_server | grep -v grep | awk '{ print $2 }'`\n\nif [ \"$PID\" != \"\" ]; then\n    kill -s HUP $PID # \u518d\u8d77\u52d5\nelse\n    nohup start_server --port=$OPENSHIFT_DIY_IP:$OPENSHIFT_DIY_PORT -- plackup -s Starlet \\\n        --max-workers=1 \\\n        $OPENSHIFT_REPO_DIR/script/diy-server \\\n        >> $OPENSHIFT_DIY_LOG_DIR/plack.log 2>&1 & # \u8d77\u52d5\nfi\n```\n\n\u30c7\u30d7\u30ed\u30a4\u524d\u306b OpenShift \u4e0a\u3067\u65e2\u306b\u52d5\u3044\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> kill `ps -ef | grep diy-server | grep -v grep | awk '{ print $2 }'`\n```\n\n\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\n```\n$ git status\ngit status\nOn branch master\nChanges not staged for commit:\n  (use \"git add/rm <file>...\" to update what will be committed)\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\n\n        deleted:    .openshift/action_hooks/start\n        deleted:    .openshift/action_hooks/stop\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\n        .openshift/action_hooks/deploy\n        .openshift/markers/hot_deploy\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\n$ chmod +x .openshift/action_hooks/deploy\n$ git add --all\n$ git commit -m \"Support hot deloy\"\n$ git push deploy master\n```\n\n\u304d\u3061\u3093\u3068\u52d5\u3044\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\u306b\u306f\u3001SSH \u3067 OpenShift \u3078\u7e4b\u3044\u3067\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> tail -f $OPENSHIFT_DIY_LOG_DIR/plack.log\nstart_server (pid:430204) starting now...\nstarting new worker 430218\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\n```\n\nOpenShift \u3067\u306f push \u6642\u306b\u30c7\u30d7\u30ed\u30a4\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u52d5\u304f\u306e\u3067\u3001\u7a7a\u30b3\u30df\u30c3\u30c8\u3092\u9001\u3063\u3066\u5f37\u5236\u7684\u306b\u8d70\u3089\u305b\u307e\u3059\u3002\n\n```\n$ git commit -m \"Test hot deploy\" --allow-empty\n$ git push deploy master\n```\n\nServer::Starter \u306b\u3088\u308a\u3001Hot-Deploy \u3055\u308c\u305f\u3089\u6210\u529f\u3067\u3059\u3002\n\n```\n$ ssh xxxxxxxxxxxxxxxxxxxxxxxx@diy-pinemz.rhcloud.com\n[diy-pinemz.rhcloud.com xxxxxxxxxxxxxxxxxxxxxxxx]\\> tail -f $OPENSHIFT_DIY_LOG_DIR/plack.log\nstart_server (pid:430204) starting now...\nstarting new worker 430218\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\nreceived HUP, spawning a new worker\nstarting new worker 434971\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\n127.0.0.1 - - [03/Jun/2015:10:50:45 -0400] \"HEAD / HTTP/1.1\" 200 4971 \"-\" \"Ruby\"\nPlack::Handler::Starlet: Accepting connections at http://127.1.253.129:8080/\nnew worker is now running, sending TERM to old workers:430218\nkilling old workers\nold worker 430218 died, status:0\n```\n\n# \u307e\u3068\u3081\nOpenShift \u3092\u4f7f\u3046\u3068\u3001\u7c21\u5358\u306b Perl + Carton \u3067 Hot-Deploy \u74b0\u5883\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\u7121\u6599\u67a0\u3082\u3042\u308a\u3001\u5c0f\u3055\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u904b\u7528\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u300c \u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u3060\u3068\u5236\u7d04\u304c\u304d\u3064\u3044\u3051\u3069 VPS \u5951\u7d04\u3059\u308b\u306e\u306f\u3061\u3087\u3063\u3068\u2026 \u300d \u3068\u3044\u3046\u65b9\u306b\u3001\u305c\u3072\u3069\u3046\u305e!\n\n# \u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\n- [OpenShift Online\u3067\u4efb\u610f\u306ePerl\u30d0\u30fc\u30b8\u30e7\u30f3\u3067Web\u30a2\u30d7\u30ea\u3092\u516c\u958b\u3059\u308b\u65b9\u6cd5](http://qiita.com/ingktds/items/575ed8ed7de34ce74d48)\n"}