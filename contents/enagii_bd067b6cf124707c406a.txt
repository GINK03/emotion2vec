{"context": " More than 1 year has passed since last update.<?php\nmb_language(\"Japanese\");\nmb_internal_encoding(\"UTF-8\");\n$userName = $_POST[\"userName\"];\n$userEmail = $_POST[\"userEmail\"];\n$passWord = $_POST[\"passWord\"];\n$image = $_FILES['image'];\n\nrequire_once 'connect.php';\nmysql_set_charset('utf8');\n$cResponse = new loginResult;\nif (!preg_match('/^(?:(?:(?:(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+)(?:\\.(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+))*)|(?:\"(?:\\\\[^\\r\\n]|[^\\\\\"])*\")))\\@(?:(?:(?:(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+)(?:\\.(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+))*)|(?:\\[(?:\\\\\\S|[\\x21-\\x5a\\x5e-\\x7e])*\\])))$/', $userEmail)) {\n    $cResponse ->statusID = 0;\n    $cResponse ->msg = \"EMAIL\";\n    $cResponse ->action = \"login\";\n    echo urldecode (json_encode($cResponse));\n    exit;\n  }\n$query = \"SELECT * FROM  ce276a_users where email = '$userEmail'\";\n$result = @mysql_query($query);\n$rowNum = mysql_num_rows($result);\nif ($rowNum > 0) {\n    $cResponse ->statusID = 0;\n    $cResponse ->msg = \"EMAIL1\";\n    $cResponse ->action = \"login\";\n}\nelse {\n    if ($image) {\n        $md5 = md5(date(\"YmdD His\"));\n        $filename = \"cavt\".substr($md5, 0, 21).\".jpg\";\n        move_uploaded_file( $image[\"tmp_name\"], '../../uploads/'.$filename);\n        $file = $filename;\n        $img_path = $file;\n    }\n    $passWord = md5($passWord);\n    $uploadDate =date(\"Y/m/d H:i:s\");\n    $uploadDate = strtotime(\"$uploadDate\");\n    $actkey=substr(md5(uniqid(mt_rand(),1)),0,8);\n    $user_mailok = \"0\";\n    if (strlen($img_path) != 0) {\n        $sql = sprintf(\"INSERT INTO ce276a_users(uname,email,user_avatar,actkey,user_regdate,pass,last_login,user_mailok)\n    VALUES('%s', '%s','%s','%s','%s','%s','%s','%s')\", $userName,$userEmail,$img_path,$actkey,$uploadDate,$passWord,$uploadDate,$user_mailok);\n    }\n    else{\n        $sql = sprintf(\"INSERT INTO ce276a_users(uname,email,actkey,user_regdate,pass,last_login,user_mailok)\n    VALUES('%s', '%s','%s','%s','%s','%s','%s')\", $userName,$userEmail,$actkey,$uploadDate,$passWord,$uploadDate,$user_mailok);\n    }\n\n    if (!mysql_query($sql)) {\n        $cResponse ->statusID = 0;\n        $cResponse ->msg = mysql_error();\n        $cResponse ->action = \"login\";\n    }else{\n        $query1 = \"SELECT * FROM  ce276a_users where email = '$userEmail' and pass = '$passWord'\";\n        $result1 = @mysql_query($query1);\n        $rowNum1 = mysql_num_rows($result1);\n        if ($rowNum1 > 0) {\n            $cResponse ->statusID = 1;\n            $cResponse ->msg = \"\u6ce8\u518c\u6210\u529f\";\n            $cResponse ->action = \"login\";\n            $response = array();\n            while ($line = mysql_fetch_array($result1,MYSQL_ASSOC)) {   \n                    $uid = $line[\"uid\"];\n                    $response[]= array(\n                    \"uid\" => $uid,\n                    \"name\" => $line[\"name\"],\n                    \"uname\" => $line[\"uname\"],\n                    \"email\" => $line[\"email\"],\n                    \"url\" => $line[\"url\"],\n                    \"user_avatar\" =>$line[\"user_avatar\"],\n                    \"user_regdate\" => $line[\"user_regdate\"],\n                    \"user_icq\" => $line[\"user_icq\"],\n                    \"user_sig\" => $line[\"user_sig\"],\n                    \"user_from\" => $line[\"user_from\"],\n                    \"user_viewemail\" => $line[\"user_viewemail\"],\n                    \"actkey\" => $line[\"actkey\"],\n                    \"user_aim\" => $line[\"user_aim\"],\n                    \"user_yim\" => $line[\"user_yim\"],\n                    \"user_msnm\" => $line[\"user_msnm\"],\n                    \"pass\" => $line[\"pass\"],\n                    \"posts\" => $line[\"posts\"],\n                    \"attachsig\" => $line[\"attachsig\"],\n                    \"rank\" => $line[\"rank\"],\n                    \"level\" => $line[\"level\"],\n                    \"theme\" => $line[\"theme\"],\n                    \"timezone_offset\" => $line[\"timezone_offset\"],\n                    \"last_login\" => $line[\"last_login\"],\n                    \"umode\" => $line[\"umode\"],\n                    \"uorder\" => $line[\"uorder\"],\n                    \"notify_method\" => $line[\"notify_method\"],\n                    \"notify_mode\" => $line[\"notify_mode\"],\n                    \"user_occ\" => $line[\"user_occ\"],\n                    \"bio\" => $line[\"bio\"],\n                    \"user_intrest\" => $line[\"user_intrest\"],\n                    \"user_mailok\" => $line[\"user_mailok\"],\n                    );\n                    break;\n                }\n            if (!empty($response)) {\n                $groupid = 2;\n                $sql = sprintf(\"INSERT INTO ce276a_groups_users_link(groupid,uid)\n                                VALUES('%s','%s')\",$groupid,$uid);\n                mysql_query($sql);\n                $cResponse ->reArray = $response;\n            }\n        }\n    }\n}\necho urldecode (json_encode($cResponse));\n\n?>\n\nSQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5bfe\u7b56\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u76f4\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3001\u3001\u3001\n\n```php\n<?php\nmb_language(\"Japanese\");\nmb_internal_encoding(\"UTF-8\");\n$userName = $_POST[\"userName\"];\n$userEmail = $_POST[\"userEmail\"];\n$passWord = $_POST[\"passWord\"];\n$image = $_FILES['image'];\n\nrequire_once 'connect.php';\nmysql_set_charset('utf8');\n$cResponse = new loginResult;\nif (!preg_match('/^(?:(?:(?:(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+)(?:\\.(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+))*)|(?:\"(?:\\\\[^\\r\\n]|[^\\\\\"])*\")))\\@(?:(?:(?:(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+)(?:\\.(?:[a-zA-Z0-9_!#\\$\\%&\\'*+\\/=?\\^`{}~|\\-]+))*)|(?:\\[(?:\\\\\\S|[\\x21-\\x5a\\x5e-\\x7e])*\\])))$/', $userEmail)) {\n    $cResponse ->statusID = 0;\n\t$cResponse ->msg = \"EMAIL\";\n\t$cResponse ->action = \"login\";\n\techo urldecode (json_encode($cResponse));\n    exit;\n  }\n$query = \"SELECT * FROM  ce276a_users where email = '$userEmail'\";\n$result = @mysql_query($query);\n$rowNum = mysql_num_rows($result);\nif ($rowNum > 0) {\n\t$cResponse ->statusID = 0;\n\t$cResponse ->msg = \"EMAIL1\";\n\t$cResponse ->action = \"login\";\n}\nelse {\n\tif ($image) {\n\t\t$md5 = md5(date(\"YmdD His\"));\n\t\t$filename = \"cavt\".substr($md5, 0, 21).\".jpg\";\n\t\tmove_uploaded_file( $image[\"tmp_name\"], '../../uploads/'.$filename);\n\t\t$file = $filename;\n\t\t$img_path = $file;\n\t}\n\t$passWord = md5($passWord);\n\t$uploadDate =date(\"Y/m/d H:i:s\");\n\t$uploadDate = strtotime(\"$uploadDate\");\n\t$actkey=substr(md5(uniqid(mt_rand(),1)),0,8);\n\t$user_mailok = \"0\";\n\tif (strlen($img_path) != 0) {\n\t\t$sql = sprintf(\"INSERT INTO ce276a_users(uname,email,user_avatar,actkey,user_regdate,pass,last_login,user_mailok)\n\tVALUES('%s', '%s','%s','%s','%s','%s','%s','%s')\", $userName,$userEmail,$img_path,$actkey,$uploadDate,$passWord,$uploadDate,$user_mailok);\n\t}\n\telse{\n\t\t$sql = sprintf(\"INSERT INTO ce276a_users(uname,email,actkey,user_regdate,pass,last_login,user_mailok)\n\tVALUES('%s', '%s','%s','%s','%s','%s','%s')\", $userName,$userEmail,$actkey,$uploadDate,$passWord,$uploadDate,$user_mailok);\n\t}\n\t\n\tif (!mysql_query($sql)) {\n\t\t$cResponse ->statusID = 0;\n\t\t$cResponse ->msg = mysql_error();\n\t\t$cResponse ->action = \"login\";\n\t}else{\n\t\t$query1 = \"SELECT * FROM  ce276a_users where email = '$userEmail' and pass = '$passWord'\";\n\t\t$result1 = @mysql_query($query1);\n\t\t$rowNum1 = mysql_num_rows($result1);\n\t\tif ($rowNum1 > 0) {\n\t\t\t$cResponse ->statusID = 1;\n\t\t\t$cResponse ->msg = \"\u6ce8\u518c\u6210\u529f\";\n\t\t\t$cResponse ->action = \"login\";\n\t\t\t$response = array();\n\t\t\twhile ($line = mysql_fetch_array($result1,MYSQL_ASSOC)) {\t\n\t\t\t\t\t$uid = $line[\"uid\"];\n\t\t\t\t\t$response[]= array(\n\t\t\t\t\t\"uid\" => $uid,\n\t\t\t\t\t\"name\" => $line[\"name\"],\n\t\t\t\t\t\"uname\" => $line[\"uname\"],\n\t\t\t\t\t\"email\" => $line[\"email\"],\n\t\t\t\t\t\"url\" => $line[\"url\"],\n\t\t\t\t\t\"user_avatar\" =>$line[\"user_avatar\"],\n\t\t\t\t\t\"user_regdate\" => $line[\"user_regdate\"],\n\t\t\t\t\t\"user_icq\" => $line[\"user_icq\"],\n\t\t\t\t\t\"user_sig\" => $line[\"user_sig\"],\n\t\t\t\t\t\"user_from\" => $line[\"user_from\"],\n\t\t\t\t\t\"user_viewemail\" => $line[\"user_viewemail\"],\n\t\t\t\t\t\"actkey\" => $line[\"actkey\"],\n\t\t\t\t\t\"user_aim\" => $line[\"user_aim\"],\n\t\t\t\t\t\"user_yim\" => $line[\"user_yim\"],\n\t\t\t\t\t\"user_msnm\" => $line[\"user_msnm\"],\n\t\t\t\t\t\"pass\" => $line[\"pass\"],\n\t\t\t\t\t\"posts\" => $line[\"posts\"],\n\t\t\t\t\t\"attachsig\" => $line[\"attachsig\"],\n\t\t\t\t\t\"rank\" => $line[\"rank\"],\n\t\t\t\t\t\"level\" => $line[\"level\"],\n\t\t\t\t\t\"theme\" => $line[\"theme\"],\n\t\t\t\t\t\"timezone_offset\" => $line[\"timezone_offset\"],\n\t\t\t\t\t\"last_login\" => $line[\"last_login\"],\n\t\t\t\t\t\"umode\" => $line[\"umode\"],\n\t\t\t\t\t\"uorder\" => $line[\"uorder\"],\n\t\t\t\t\t\"notify_method\" => $line[\"notify_method\"],\n\t\t\t\t\t\"notify_mode\" => $line[\"notify_mode\"],\n\t\t\t\t\t\"user_occ\" => $line[\"user_occ\"],\n\t\t\t\t\t\"bio\" => $line[\"bio\"],\n\t\t\t\t\t\"user_intrest\" => $line[\"user_intrest\"],\n\t\t\t\t\t\"user_mailok\" => $line[\"user_mailok\"],\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tif (!empty($response)) {\n\t\t\t\t$groupid = 2;\n\t\t\t\t$sql = sprintf(\"INSERT INTO ce276a_groups_users_link(groupid,uid)\n\t\t\t\t\t\t\t\tVALUES('%s','%s')\",$groupid,$uid);\n\t\t\t\tmysql_query($sql);\n\t\t\t\t$cResponse ->reArray = $response;\n\t\t\t}\n\t\t}\n\t}\n}\necho urldecode (json_encode($cResponse));\n\n?>\n```\n\nSQL\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5bfe\u7b56\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u76f4\u3055\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3001\u3001\u3001", "tags": ["xoopscube"]}