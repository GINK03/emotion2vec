{"context": " More than 1 year has passed since last update.Gradle \u524d\u63d0\u3060\u3051\u3069\u3001\u4ed6\u306e\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3067\u3082\u3067\u304d\u308b\u306f\u305a\u3002\n\n\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u30a2\u30d7\u30ea\n\n\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\napp/\n|-build.gradle\n`-src/main/\n   |-java/\n   |  `-Main.java\n   `-resources/\n     `-log4j.xml\n\n\n\u5b9f\u88c5\n\nlog4j.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE log4j:configuration SYSTEM \"log4j.dtd\">\n<log4j:configuration xmlns:log4j=\"http://jakarta.apache.org/log4j/\" >\n\n  <appender name=\"stdout\" class=\"org.apache.log4j.ConsoleAppender\">\n     <param name=\"Target\" value=\"System.out\" /> \n     <layout class=\"org.apache.log4j.PatternLayout\">\n        <param name=\"ConversionPattern\" value=\"%m%n\" />\n     </layout>\n  </appender>\n\n  <root>\n    <level value =\"${log.level}\" />\n    <appender-ref ref=\"stdout\"/>\n  </root>\n</log4j:configuration>\n\n\n\nMain.java\nimport org.apache.log4j.Logger;\n\npublic class Main {\n    public static void main(String[] args) {\n        boolean isRelease = Boolean.valueOf(System.getProperty(\"isRelease\"));\n\n        if (isRelease) {\n            System.out.println(\"Release Mode\");\n            System.setProperty(\"log.level\", \"INFO\");\n        } else {\n            System.out.println(\"Develop Mode\");\n            System.setProperty(\"log.level\", \"TRACE\");\n        }\n\n        Logger logger = Logger.getLogger(Main.class);\n\n        logger.trace(\"trace message\");\n        logger.debug(\"debug message\");\n        logger.info(\"info message\");\n    }\n}\n\n\n\nbuild.gradle\napply plugin: 'application'\n\nmainClassName = 'Main'\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    compile 'log4j:log4j:1.2.17'\n}\n\nstartScripts {\n    defaultJvmOpts += ['-DisRelease=true']\n}\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n\u958b\u767a\u4e2d\u306e\u72b6\u614b\u3067\u5b9f\u884c\n> gradle -q run\nDevelop Mode\ntrace message\ndebug message\ninfo message\n\n\n\u30d3\u30eb\u30c9\u3057\u3066\u304b\u3089\u5b9f\u884c\n\n\u30d3\u30eb\u30c9\n> gradle distZip\n\n\nbuild/distributions/app.zip \u3092\u89e3\u51cd\u3002\nbin \u306e\u4e0b\u306e\u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\u5b9f\u884c\n> build\\distributions\\app\\bin\\app.bat\nRelease Mode\ninfo message\n\n\n\n\u8aac\u660e\n\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3 isRelease \u306b true \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3067\u51e6\u7406\u3092\u5206\u5c90\u3057\u3066\u3044\u308b\u3002\nisRelease \u306e\u5024\u306f\u3001 Gradle \u306e Application \u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3042\u308b startScripts.defaultJvmOpts \u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30ea\u30fc\u30b9\u5f8c\u306e\u307f true \u304c\u9069\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\nLog4j \u306f ${xxxx} \u3068\u3044\u3046\u5f62\u5f0f\u3067\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5024\u3092\u53c2\u7167\u3067\u304d\u308b\u3002\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001 Log4j \u306e\u30ed\u30ac\u30fc\u3092\u6700\u521d\u306b\u53d6\u5f97\u3059\u308b\u524d\u306b\u3001\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5fc5\u8981\u306a\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\n\n\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\n\n\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\nwebapp/\n|-build.gradle\n`-src/main/\n   |-java/\n   |  |-MyListener.java\n   |  `-MyServlet.java\n   |-resources/\n   |  `-log4j.xml\n   `-webapp/WEB-INF\n      `-web.xml\n\n\n\u5b9f\u88c5\n\nlog4j.xml \u306e\u5b9f\u88c5\u306f\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u306e\u3068\u304d\u3068\u540c\u3058\u3002\n\n\nweb.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee\n                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n         version=\"2.5\">\n\n  <listener>\n    <listener-class>MyListener</listener-class>\n  </listener>\n\n  <servlet>\n    <servlet-name>MyServlet</servlet-name>\n    <servlet-class>MyServlet</servlet-class>\n  </servlet>\n\n  <servlet-mapping>\n    <servlet-name>MyServlet</servlet-name>\n    <url-pattern>/my-servlet</url-pattern>\n  </servlet-mapping>\n\n</web-app>\n\n\n\nMyListener.java\nimport javax.servlet.ServletContextListener;\nimport javax.servlet.ServletContextEvent;\n\npublic class MyListener implements ServletContextListener {\n\n    @Override\n    public void contextInitialized(ServletContextEvent sce) {\n        if (this.isRelease()) {\n            System.out.println(\"Release Mode\");\n            System.setProperty(\"log.level\", \"INFO\");\n        } else {\n            System.out.println(\"Develop Mode\");\n            System.setProperty(\"log.level\", \"TRACE\");\n        }\n    }\n\n    private boolean isRelease() {\n        return MyListener.class.getResource(\"/is_release\") != null;\n    }\n\n    @Override public void contextDestroyed(ServletContextEvent sce) {/*no use*/}\n}\n\n\n\nMyServlet.java\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport org.apache.log4j.Logger;\n\npublic class MyServlet extends HttpServlet {\n\n    private static final Logger logger = Logger.getLogger(MyServlet.class);\n\n    @Override\n    public void doGet(HttpServletRequest req, HttpServletResponse res) {\n        logger.trace(\"trace message\");\n        logger.debug(\"debug message\");\n        logger.info(\"info message\");\n    }\n}\n\n\n\nbuild.gradle\napply plugin: 'jetty'\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    compile 'log4j:log4j:1.2.17'\n    providedCompile 'javax.servlet:servlet-api:2.5'\n}\n\nwar {\n    doFirst {\n        def releaseFlagFile = new File(buildDir, 'tmp/release/is_release')\n\n        releaseFlagFile.with {\n            parentFile.mkdirs()\n            createNewFile()\n        }\n\n        classpath += files(releaseFlagFile.parent)\n    }\n}\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n\u958b\u767a\u4e2d\u306e\u72b6\u614b\u3067\u5b9f\u884c\n> gradle jettyRun\n:compileJava\n:processResources\n:classes\n:jettyRun\nDevelop Mode\n> Building 75% > :jettyRun > Running at http://localhost:8080/webapp\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066 http://localhost:8080/webapp/my-servlet \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\ntrace message\ndebug message\ninfo message\n\n\n\n\u751f\u6210\u3057\u305fwar\u30d5\u30a1\u30a4\u30eb\u3067\u5b9f\u884c\n> gradle jettyRunWar\n:compileJava\n:processResources\n:classes\n:war\n:jettyRunWar\nRelease Mode\n> Building 80% > :jettyRunWar > Running at http://localhost:8080/webapp\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066 http://localhost:8080/webapp/my-servlet \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\ninfo message\n\n\n\n\u8aac\u660e\ngradle war \u3057\u305f\u3068\u304d\u3060\u3051\u3001\u30af\u30e9\u30b9\u30d1\u30b9\u76f4\u4e0b\u306b is_release \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3002\nWeb \u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u306b MyListener \u304c is_release \u306e\u5b58\u5728\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u3002\n\n\u53c2\u8003\n\nWar - Gradle DSL Version 2.2-20140924021627+0000\nCreateStartScripts - Gradle DSL Version 2.2-20140924021627+0000\nProject (Gradle API 2.1)\n\nGradle \u524d\u63d0\u3060\u3051\u3069\u3001\u4ed6\u306e\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3067\u3082\u3067\u304d\u308b\u306f\u305a\u3002\n\n#\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u30a2\u30d7\u30ea\n##\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\n```text\napp/\n|-build.gradle\n`-src/main/\n   |-java/\n   |  `-Main.java\n   `-resources/\n     `-log4j.xml\n```\n\n##\u5b9f\u88c5\n```xml:log4j.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<!DOCTYPE log4j:configuration SYSTEM \"log4j.dtd\">\n<log4j:configuration xmlns:log4j=\"http://jakarta.apache.org/log4j/\" >\n\n  <appender name=\"stdout\" class=\"org.apache.log4j.ConsoleAppender\">\n     <param name=\"Target\" value=\"System.out\" /> \n     <layout class=\"org.apache.log4j.PatternLayout\">\n        <param name=\"ConversionPattern\" value=\"%m%n\" />\n     </layout>\n  </appender>\n\n  <root>\n    <level value =\"${log.level}\" />\n    <appender-ref ref=\"stdout\"/>\n  </root>\n</log4j:configuration>\n```\n\n```java:Main.java\nimport org.apache.log4j.Logger;\n\npublic class Main {\n    public static void main(String[] args) {\n        boolean isRelease = Boolean.valueOf(System.getProperty(\"isRelease\"));\n        \n        if (isRelease) {\n            System.out.println(\"Release Mode\");\n            System.setProperty(\"log.level\", \"INFO\");\n        } else {\n            System.out.println(\"Develop Mode\");\n            System.setProperty(\"log.level\", \"TRACE\");\n        }\n        \n        Logger logger = Logger.getLogger(Main.class);\n        \n        logger.trace(\"trace message\");\n        logger.debug(\"debug message\");\n        logger.info(\"info message\");\n    }\n}\n```\n\n```groovy:build.gradle\napply plugin: 'application'\n\nmainClassName = 'Main'\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    compile 'log4j:log4j:1.2.17'\n}\n\nstartScripts {\n    defaultJvmOpts += ['-DisRelease=true']\n}\n```\n\n##\u52d5\u4f5c\u78ba\u8a8d\n###\u958b\u767a\u4e2d\u306e\u72b6\u614b\u3067\u5b9f\u884c\n```text\n> gradle -q run\nDevelop Mode\ntrace message\ndebug message\ninfo message\n```\n\n###\u30d3\u30eb\u30c9\u3057\u3066\u304b\u3089\u5b9f\u884c\n```text:\u30d3\u30eb\u30c9\n> gradle distZip\n```\n\nbuild/distributions/app.zip \u3092\u89e3\u51cd\u3002\nbin \u306e\u4e0b\u306e\u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```text:\u5b9f\u884c\n> build\\distributions\\app\\bin\\app.bat\nRelease Mode\ninfo message\n```\n\n##\u8aac\u660e\n\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3 `isRelease` \u306b `true` \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3067\u51e6\u7406\u3092\u5206\u5c90\u3057\u3066\u3044\u308b\u3002\n`isRelease` \u306e\u5024\u306f\u3001 Gradle \u306e Application \u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3042\u308b `startScripts.defaultJvmOpts` \u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30ea\u30fc\u30b9\u5f8c\u306e\u307f `true` \u304c\u9069\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\nLog4j \u306f `${xxxx}` \u3068\u3044\u3046\u5f62\u5f0f\u3067\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5024\u3092\u53c2\u7167\u3067\u304d\u308b\u3002\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001 Log4j \u306e\u30ed\u30ac\u30fc\u3092\u6700\u521d\u306b\u53d6\u5f97\u3059\u308b\u524d\u306b\u3001\u30b7\u30b9\u30c6\u30e0\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5fc5\u8981\u306a\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\n\n#\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\n##\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\n```text:\nwebapp/\n|-build.gradle\n`-src/main/\n   |-java/\n   |  |-MyListener.java\n   |  `-MyServlet.java\n   |-resources/\n   |  `-log4j.xml\n   `-webapp/WEB-INF\n      `-web.xml\n```\n\n##\u5b9f\u88c5\n- log4j.xml \u306e\u5b9f\u88c5\u306f\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u306e\u3068\u304d\u3068\u540c\u3058\u3002\n\n```xml:web.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<web-app xmlns=\"http://java.sun.com/xml/ns/j2ee\"\n         xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee\n                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\"\n         version=\"2.5\">\n  \n  <listener>\n    <listener-class>MyListener</listener-class>\n  </listener>\n  \n  <servlet>\n    <servlet-name>MyServlet</servlet-name>\n    <servlet-class>MyServlet</servlet-class>\n  </servlet>\n  \n  <servlet-mapping>\n    <servlet-name>MyServlet</servlet-name>\n    <url-pattern>/my-servlet</url-pattern>\n  </servlet-mapping>\n  \n</web-app>\n```\n\n```java:MyListener.java\nimport javax.servlet.ServletContextListener;\nimport javax.servlet.ServletContextEvent;\n\npublic class MyListener implements ServletContextListener {\n    \n    @Override\n    public void contextInitialized(ServletContextEvent sce) {\n        if (this.isRelease()) {\n            System.out.println(\"Release Mode\");\n            System.setProperty(\"log.level\", \"INFO\");\n        } else {\n            System.out.println(\"Develop Mode\");\n            System.setProperty(\"log.level\", \"TRACE\");\n        }\n    }\n    \n    private boolean isRelease() {\n        return MyListener.class.getResource(\"/is_release\") != null;\n    }\n    \n    @Override public void contextDestroyed(ServletContextEvent sce) {/*no use*/}\n}\n```\n\n```java:MyServlet.java\nimport javax.servlet.http.HttpServlet;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport org.apache.log4j.Logger;\n\npublic class MyServlet extends HttpServlet {\n    \n    private static final Logger logger = Logger.getLogger(MyServlet.class);\n    \n    @Override\n    public void doGet(HttpServletRequest req, HttpServletResponse res) {\n        logger.trace(\"trace message\");\n        logger.debug(\"debug message\");\n        logger.info(\"info message\");\n    }\n}\n```\n\n```groovy:build.gradle\napply plugin: 'jetty'\n\nrepositories {\n    mavenCentral()\n}\n\ndependencies {\n    compile 'log4j:log4j:1.2.17'\n    providedCompile 'javax.servlet:servlet-api:2.5'\n}\n\nwar {\n    doFirst {\n        def releaseFlagFile = new File(buildDir, 'tmp/release/is_release')\n        \n        releaseFlagFile.with {\n            parentFile.mkdirs()\n            createNewFile()\n        }\n        \n        classpath += files(releaseFlagFile.parent)\n    }\n}\n```\n\n##\u52d5\u4f5c\u78ba\u8a8d\n###\u958b\u767a\u4e2d\u306e\u72b6\u614b\u3067\u5b9f\u884c\n```text:\n> gradle jettyRun\n:compileJava\n:processResources\n:classes\n:jettyRun\nDevelop Mode\n> Building 75% > :jettyRun > Running at http://localhost:8080/webapp\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066 `http://localhost:8080/webapp/my-servlet` \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n```text:\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\ntrace message\ndebug message\ninfo message\n```\n\n###\u751f\u6210\u3057\u305fwar\u30d5\u30a1\u30a4\u30eb\u3067\u5b9f\u884c\n```text:\n> gradle jettyRunWar\n:compileJava\n:processResources\n:classes\n:war\n:jettyRunWar\nRelease Mode\n> Building 80% > :jettyRunWar > Running at http://localhost:8080/webapp\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066 `http://localhost:8080/webapp/my-servlet` \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n```text:\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\ninfo message\n```\n\n##\u8aac\u660e\n`gradle war` \u3057\u305f\u3068\u304d\u3060\u3051\u3001\u30af\u30e9\u30b9\u30d1\u30b9\u76f4\u4e0b\u306b `is_release` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3002\nWeb \u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u306b `MyListener` \u304c `is_release` \u306e\u5b58\u5728\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u3002\n\n\n\n#\u53c2\u8003\n- [War - Gradle DSL Version 2.2-20140924021627+0000](http://gradle.monochromeroad.com/docs/dsl/org.gradle.api.tasks.bundling.War.html)\n- [CreateStartScripts - Gradle DSL Version 2.2-20140924021627+0000](http://gradle.monochromeroad.com/docs/dsl/org.gradle.api.tasks.application.CreateStartScripts.html)\n- [Project (Gradle API 2.1)](http://www.gradle.org/docs/current/javadoc/org/gradle/api/Project.html)\n", "tags": ["Java", "gradle", "log4j"]}