{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3084VPS\u3092\u501f\u308a\u3066\u3044\u308b\u3068\u4e0d\u610f\u306b\u30c7\u30fc\u30bf\u304c\u98db\u3076\u3053\u3068\u304c\u305f\u307e\u306b\u3042\u308a\u307e\u3059\u3088\u306d\u3002\n\u305d\u3093\u306a\u3068\u304d\u306b\u5099\u3048\u3066\u81ea\u5b85\u30b5\u30fc\u30d0\u306b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u306e\u30c7\u30fc\u30bf\u3092\u5dee\u5206\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u308b\u3068\u5b89\u5fc3\u3067\u3059\u3002\n\u6709\u511f/\u7121\u511f/\u5546\u7528\u3082\u542b\u3081\u3066\u69d8\u3005\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u81ea\u5206\u306f\u304a\u624b\u8efd\u306brsync\u3060\u3051\u3067\u5b9f\u65bd\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u65b9\u91dd\n\u30ea\u30e2\u30fc\u30c8\u306e\u30b5\u30fc\u30d0A\u304b\u3089\u3001\u624b\u5143\u306e\u30b5\u30fc\u30d0B\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A(IP\u30a2\u30c9\u30ec\u30b9aaa.bbb.ccc.ddd)\n\n\n[cron]\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A\u5185\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u30c7\u30fc\u30bf\u3092 /for_backup/ \u306b\u96c6\u3081\u308b\n\n\n\u624b\u5143\u306e\u30b5\u30fc\u30d0B\n\n\n[cron]rsync\u3067 A:/for_backup/ \u3092 /remote_a_backup/latest \u306b\u8ee2\u9001\u3059\u308b\n[cron]rsync\u3067 /remote_a_backup/latest \u3092 /remote_a_backup/YYYYMMDD \u306b\u5dee\u5206\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\n\n\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A\u5185\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u30c7\u30fc\u30bf\u3092 /for_backup/ \u306b\u96c6\u3081\u308b\n\u307e\u3042\u9069\u5f53\u306b\u3002\n\ngather_for_backup.sh\n#!/bin/sh\nrsync --progress -av --delete /etc                     /for_backup/\nrsync --progress -av --delete /data                    /for_backup\nrsync --progress -av --delete /root/bin                /for_backup/root\nrsync --progress -av --delete /var/lib/mysql           /for_backup/var/lib\n...\n\n# chown for rsync\nchown -R takeuchi.rsync /for_backup\n\n\n\nrsync\u3067 A:/for_backup/ \u3092 /remote_a_backup/latest \u306b\u8ee2\u9001\u3059\u308b\n\nrsync_from_remote_server.sh\n#!/bin/sh\nrsync --progress -avz -e ssh --delete --bwlimit=150 takeuchi@aaa.bbb.ccc.ddd:/for_backup/ /remote_a_backup/latest\n\n\n\nrsync\u3067 /remote_a_backup/latest \u3092 /remote_a_backup/YYYYMMDD \u306b\u5dee\u5206\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\n\nrotation.sh\n#!/bin/sh\n# \u4e16\u4ee3\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\n# ROTATE_DAYS : LATEST_DIR \u3092\u542b\u3081\u3066\u4f55\u4e16\u4ee3\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u304b\nROTATE_DAYS=30\n#\nBASEDIR=/remote_a_backup\nLATEST_DIR=${BASEDIR}/latest/\nNEW_DIR=${BASEDIR}/`date -d '-1 day' +%Y%m%d`/\nLINK_DIR=${BASEDIR}/`date -d '-2 day' +%Y%m%d`/\nOLDEST_DIR=${BASEDIR}/`date -d \"-$ROTATE_DAYS day\" +%Y%m%d`/\n\nrm -rf $OLDEST_DIR\nrsync -avz --progress --delete --link-dest=$LINK_DIR $LATEST_DIR $NEW_DIR\n\n\n\ncrontab(\u30ed\u30fc\u30ab\u30eb\u30b5\u30fc\u30d0)\n\ncrontab\n0 7 * * * /remote_a_backup/rsync_from_remote_server.sh > /tmp/a-backup-rsync.log; /remote_a_backup/rotation.sh > /tmp/a-backup-rotation.log\n\n\n\u672c\u5f53\u306f\u3082\u3046\u5c11\u3057\u7570\u5e38\u7cfb\u306e\u51e6\u7406\u304c\u5fc5\u8981\u3068\u306f\u601d\u3044\u307e\u3059\u3051\u3069 30 \u65e5\u4ee5\u5185\u306b\u6c17\u3065\u304f\u3068\u3044\u3046\u524d\u63d0\u3067\u3002\u3002\n# \u306f\u3058\u3081\u306b\n\n\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3084VPS\u3092\u501f\u308a\u3066\u3044\u308b\u3068<a href=\"http://support.sakura.ad.jp/mainte/mainteentry.php?id=14251\">\u4e0d\u610f\u306b\u30c7\u30fc\u30bf\u304c\u98db\u3076</a>\u3053\u3068\u304c\u305f\u307e\u306b\u3042\u308a\u307e\u3059\u3088\u306d\u3002\n\n\u305d\u3093\u306a\u3068\u304d\u306b\u5099\u3048\u3066\u81ea\u5b85\u30b5\u30fc\u30d0\u306b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u306e\u30c7\u30fc\u30bf\u3092\u5dee\u5206\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u308b\u3068\u5b89\u5fc3\u3067\u3059\u3002\n\n\u6709\u511f/\u7121\u511f/\u5546\u7528\u3082\u542b\u3081\u3066\u69d8\u3005\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u81ea\u5206\u306f\u304a\u624b\u8efd\u306brsync\u3060\u3051\u3067\u5b9f\u65bd\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u65b9\u91dd\n\n\u30ea\u30e2\u30fc\u30c8\u306e\u30b5\u30fc\u30d0A\u304b\u3089\u3001\u624b\u5143\u306e\u30b5\u30fc\u30d0B\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n- \u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A(IP\u30a2\u30c9\u30ec\u30b9aaa.bbb.ccc.ddd)\n - [cron]\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A\u5185\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u30c7\u30fc\u30bf\u3092 /for_backup/ \u306b\u96c6\u3081\u308b\n- \u624b\u5143\u306e\u30b5\u30fc\u30d0B\n - [cron]rsync\u3067 A:/for_backup/ \u3092 /remote_a_backup/latest \u306b\u8ee2\u9001\u3059\u308b\n - [cron]rsync\u3067 /remote_a_backup/latest \u3092 /remote_a_backup/YYYYMMDD \u306b\u5dee\u5206\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\n\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\n\n## \u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0A\u5185\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u5bfe\u8c61\u30c7\u30fc\u30bf\u3092 /for_backup/ \u306b\u96c6\u3081\u308b\n\n\u307e\u3042\u9069\u5f53\u306b\u3002\n\n```bash:gather_for_backup.sh\n#!/bin/sh\nrsync --progress -av --delete /etc                     /for_backup/\nrsync --progress -av --delete /data                    /for_backup\nrsync --progress -av --delete /root/bin                /for_backup/root\nrsync --progress -av --delete /var/lib/mysql           /for_backup/var/lib\n...\n\n# chown for rsync\nchown -R takeuchi.rsync /for_backup\n```\n\n## rsync\u3067 A:/for_backup/ \u3092 /remote_a_backup/latest \u306b\u8ee2\u9001\u3059\u308b\n\n```bash:rsync_from_remote_server.sh\n#!/bin/sh\nrsync --progress -avz -e ssh --delete --bwlimit=150 takeuchi@aaa.bbb.ccc.ddd:/for_backup/ /remote_a_backup/latest\n```\n\n## rsync\u3067 /remote_a_backup/latest \u3092 /remote_a_backup/YYYYMMDD \u306b\u5dee\u5206\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\n\n```bash:rotation.sh\n#!/bin/sh\n# \u4e16\u4ee3\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\n# ROTATE_DAYS : LATEST_DIR \u3092\u542b\u3081\u3066\u4f55\u4e16\u4ee3\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u304b\nROTATE_DAYS=30\n#\nBASEDIR=/remote_a_backup\nLATEST_DIR=${BASEDIR}/latest/\nNEW_DIR=${BASEDIR}/`date -d '-1 day' +%Y%m%d`/\nLINK_DIR=${BASEDIR}/`date -d '-2 day' +%Y%m%d`/\nOLDEST_DIR=${BASEDIR}/`date -d \"-$ROTATE_DAYS day\" +%Y%m%d`/\n\nrm -rf $OLDEST_DIR\nrsync -avz --progress --delete --link-dest=$LINK_DIR $LATEST_DIR $NEW_DIR\n```\n\n## crontab(\u30ed\u30fc\u30ab\u30eb\u30b5\u30fc\u30d0)\n\n```bash:crontab\n0 7 * * * /remote_a_backup/rsync_from_remote_server.sh > /tmp/a-backup-rsync.log; /remote_a_backup/rotation.sh > /tmp/a-backup-rotation.log\n```\n\n\u672c\u5f53\u306f\u3082\u3046\u5c11\u3057\u7570\u5e38\u7cfb\u306e\u51e6\u7406\u304c\u5fc5\u8981\u3068\u306f\u601d\u3044\u307e\u3059\u3051\u3069 30 \u65e5\u4ee5\u5185\u306b\u6c17\u3065\u304f\u3068\u3044\u3046\u524d\u63d0\u3067\u3002\u3002\n", "tags": ["rsync", "SSH"]}