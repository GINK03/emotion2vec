{"context": " More than 1 year has passed since last update.\n\n\u74b0\u5883\n\u30b3\u30f3\u30c6\u30ca\u306eOS\u306fUbuntu 15.10\nApache\u306emod_ssl\u3092\u4f7f\u7528\n\n\u7d4c\u7def\n\u73fe\u5728\u958b\u767a\u3057\u3066\u3044\u308b\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u554f\u984c\u304b\u3089Docker Registry\u306e\u4f5c\u6210\u3068\u4fdd\u5b88\u304c\u53b3\u3057\u3044\u306e\u3067\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3092\u30ea\u30ea\u30fc\u30b9\u3059\u308b\u969b\u306bDockerfile\u3092\u30d3\u30eb\u30c9\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u307e\u3059\u3002\u5c0f\u898f\u6a21\u306e\u4f1a\u793e\u3084\u6700\u8fd1Docker\u3092\u5c0e\u5165\u3057\u305f\u4f1a\u793e\u306b\u306f\u3053\u306e\u3088\u3046\u306a\u30ea\u30ea\u30fc\u30b9\u306e\u4ed5\u65b9\u3092\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3082\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u3053\u3067\u3001Dockerfile\u3092\u30d3\u30eb\u30c9\u3057\u305f\u6642\u306b\u305d\u306e\u307e\u307eApache\u306e\u8a2d\u5b9a\u3092\u81ea\u52d5\u3067\u3084\u3063\u3066\u3082\u3089\u304a\u3046\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u306b\u81f3\u308a\u307e\u3059\u3002\n\n\u65b9\u6cd5\n\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bDockerfile\u3068SSL\u8a3c\u660e\u66f8\u3068Apache\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\n\nssl.conf\n<VirtualHost _default_:443>\n    ServerAdmin webmaster@test.com\n\n    DocumentRoot /var/www/html/hoge\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    SSLEngine on\n\n    SSLCertificateFile /etc/apache2/hoge.crt\n    SSLCertificateKeyFile /etc/apache2/hoge.key\n\n    <FilesMatch \"\\.(cgi|shtml|phtml|php)$\">\n        SSLOptions +StdEnvVars\n    </FilesMatch>\n    <Directory /usr/lib/cgi-bin>\n        SSLOptions +StdEnvVars\n    </Directory>\n\n    <Directory /var/www/html/test>\n        Options Indexes FollowSymLinks\n        AllowOverride all\n        Require all granted\n    </Directory>\n    DirectoryIndex index.php\n\n\n    BrowserMatch \"MSIE [2-6]\" \\\n                  nokeepalive ssl-unclean-shutdown \\\n                  downgrade-1.0 force-response-1.0\n    # MSIE 7 and newer should be able to use keepalive\n    BrowserMatch \"MSIE [17-9]\" ssl-unclean-shutdown\n</VirtualHost>\n\n\n\u304a\u6c17\u3065\u304d\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306fApache\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bsites-available\u306b\u6700\u521d\u304b\u3089\u5165\u3063\u3066\u3044\u308bdefault-ssl.conf\u306e\u30d1\u30b9\u3060\u3051\u3044\u3058\u3063\u305f\u3082\u306e\u3067\u3059\u3002\n\nDockerfile\n.\n.\n.\nRUN apt-get install -y apache2\nRUN a2enmod ssl\nCOPY ./ssl.conf /etc/apache2/sites-available/ssl.conf\nCOPY ./hoge.key /etc/apache2/hoge.key\nCOPY ./hoge.crt /etc/apache2/hoge.crt\nRUN a2ensite ssl\n.\n.\n.\nCMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n\n\nDockerfile\u306fSSL\u8a3c\u660e\u66f8\u3068\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3092\u30b3\u30d4\u30fc\u3057\u3066a2ensite\u3067\u6709\u52b9\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3067\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u3059\u3067\u306bhttps\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n## \u74b0\u5883\n\u30b3\u30f3\u30c6\u30ca\u306eOS\u306fUbuntu 15.10\nApache\u306emod_ssl\u3092\u4f7f\u7528\n\n## \u7d4c\u7def\n\u73fe\u5728\u958b\u767a\u3057\u3066\u3044\u308b\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u554f\u984c\u304b\u3089Docker Registry\u306e\u4f5c\u6210\u3068\u4fdd\u5b88\u304c\u53b3\u3057\u3044\u306e\u3067\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3092\u30ea\u30ea\u30fc\u30b9\u3059\u308b\u969b\u306bDockerfile\u3092\u30d3\u30eb\u30c9\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u307e\u3059\u3002\u5c0f\u898f\u6a21\u306e\u4f1a\u793e\u3084\u6700\u8fd1Docker\u3092\u5c0e\u5165\u3057\u305f\u4f1a\u793e\u306b\u306f\u3053\u306e\u3088\u3046\u306a\u30ea\u30ea\u30fc\u30b9\u306e\u4ed5\u65b9\u3092\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3082\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u3053\u3067\u3001Dockerfile\u3092\u30d3\u30eb\u30c9\u3057\u305f\u6642\u306b\u305d\u306e\u307e\u307eApache\u306e\u8a2d\u5b9a\u3092\u81ea\u52d5\u3067\u3084\u3063\u3066\u3082\u3089\u304a\u3046\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u306b\u81f3\u308a\u307e\u3059\u3002\n\n## \u65b9\u6cd5\n\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bDockerfile\u3068SSL\u8a3c\u660e\u66f8\u3068Apache\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\n\n```:ssl.conf\n<VirtualHost _default_:443>\n    ServerAdmin webmaster@test.com\n\n    DocumentRoot /var/www/html/hoge\n\n    ErrorLog ${APACHE_LOG_DIR}/error.log\n    CustomLog ${APACHE_LOG_DIR}/access.log combined\n\n    SSLEngine on\n\n    SSLCertificateFile /etc/apache2/hoge.crt\n    SSLCertificateKeyFile /etc/apache2/hoge.key\n\n    <FilesMatch \"\\.(cgi|shtml|phtml|php)$\">\n        SSLOptions +StdEnvVars\n    </FilesMatch>\n    <Directory /usr/lib/cgi-bin>\n        SSLOptions +StdEnvVars\n    </Directory>\n\n    <Directory /var/www/html/test>\n        Options Indexes FollowSymLinks\n        AllowOverride all\n        Require all granted\n    </Directory>\n    DirectoryIndex index.php\n\n\n    BrowserMatch \"MSIE [2-6]\" \\\n                  nokeepalive ssl-unclean-shutdown \\\n                  downgrade-1.0 force-response-1.0\n    # MSIE 7 and newer should be able to use keepalive\n    BrowserMatch \"MSIE [17-9]\" ssl-unclean-shutdown\n</VirtualHost>\n```\n\n\u304a\u6c17\u3065\u304d\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306fApache\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bsites-available\u306b\u6700\u521d\u304b\u3089\u5165\u3063\u3066\u3044\u308bdefault-ssl.conf\u306e\u30d1\u30b9\u3060\u3051\u3044\u3058\u3063\u305f\u3082\u306e\u3067\u3059\u3002\n\n```:Dockerfile\n.\n.\n.\nRUN apt-get install -y apache2\nRUN a2enmod ssl\nCOPY ./ssl.conf /etc/apache2/sites-available/ssl.conf\nCOPY ./hoge.key /etc/apache2/hoge.key\nCOPY ./hoge.crt /etc/apache2/hoge.crt\nRUN a2ensite ssl\n.\n.\n.\nCMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]\n```\n\nDockerfile\u306fSSL\u8a3c\u660e\u66f8\u3068\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3092\u30b3\u30d4\u30fc\u3057\u3066`a2ensite`\u3067\u6709\u52b9\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3067\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u3059\u3067\u306bhttps\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n", "tags": ["docker", "dockerfile", "Apache"]}