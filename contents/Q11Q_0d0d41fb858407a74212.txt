{"tags": ["VBScript", "7zip"], "context": "\u6bce\u56de\u60a9\u3080\u306e\u3067\u4e00\u5fdc\u4f5c\u308a\u307e\u3057\u305f\u3002\n7zip\u306evbs\u306f\u3044\u308d\u3044\u308d\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308a\u3059\u304e\u3066\u6df7\u4e71\u3059\u308b\u306e\u3067\u3001\u81ea\u5206\u6d41\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\n\u30d5\u30a1\u30a4\u30eb\u3092\u30c9\u30e9\u30c3\u30b0\u30a2\u30f3\u30c9\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u3068\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3064\u304dzip\u3092\u5143\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\n\u307e\u305f\u3001\u5727\u7e2e\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4e00\u3064\u4e00\u3064\u660e\u793a\u3057\u307e\u3059\u3002\nmsgbox objFile.Name\u3000\u304c\u305d\u308c\u3067\u3059\u3002\n\u3044\u3089\u306a\u3044\u3068\u304d\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3000\u4f8b\u3048\u3070\u3001c:\\test\\hoge.txt \u3092c:\\test\\hoge.zip\u306b\u3057\u307e\u3059\n\u3000\u305f\u3060\u3057\u62e1\u5f35\u5b50ini,db\u306a\u3069\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a1\u30a4\u30eb\u3001accdb\u306e\u30a2\u30af\u30bb\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u9664\u5916\u3057\u307e\u3059\u3002\u307e\u305f\u30d5\u30eb\u30d1\u30b9\u304c260\u5b57\u4ee5\u4e0a\u3001\u4f7f\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u62e1\u5f35\u5b50\u3092\u9664\u5916\u3057\u307e\u3059\u3002\n\u3000\u3055\u3089\u306b\u4e38\u4ed8\u304d\u6570\u5b57\u3001\u5168\u89d2\u30a2\u30dd\u30b9\u30c8\u30ed\u30d5\u3092\u7f6e\u63db\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3057\u307e\u3059\u3002\n\u3000\u3082\u3061\u308d\u3093\u3053\u308c\u306f\u5341\u5206\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3002\n\u6b63\u898f\u8868\u73fe\u306f http://dobon.net/vb/dotnet/file/invalidpathchars.html\n\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u306a\u304a\u3001\u30c6\u30b9\u30c8\u3092\u517c\u306d\u3066\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u51f6\u5b50\u304c\u542b\u307e\u308c\u308c\u3070\u3001\u4eac\u56fa\u306b\u5909\u63db\u3057\u307e\u3059\u3002\u305d\u306e\u524d\u306e\u5168\u89d2\u30a2\u30dd\u30b9\u30c8\u30ed\u30d5\u3092\u534a\u89d2\u30a2\u30f3\u30c0\u30fc\u30d0\u30fc\u306b\u5909\u3048\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u8996\u8a8d\u6027\u3092\u78ba\u4fdd\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u308c\u3068\u6a5f\u7a2e\u4f9d\u5b58\u6587\u5b57\u306e\u5909\u63db\u306f\u305d\u308c\u81ea\u4f53\u306e\u5b9f\u9a13\u304c\u5371\u967a\u306a\u9762\u3082\u3042\u308b\u305f\u3081\u3067\u3059\u3002\n\u306a\u304a\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f-pPassword \u3067\u6c7a\u307e\u3063\u3066\u3044\u307e\u3059\u3002test\u306b\u3057\u305f\u3051\u308c\u3070\n-ptest \u306b\u3057\u307e\u3059\u3002\u304b\u306a\u3089\u305a\u5f8c\u308d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u3092\u3044\u308c\u3066\u304f\u3060\u3055\u3044\n\u3000\u305d\u308c\u306b\u3057\u3066\u3082\u30d1\u30b9\u30ef\u30fc\u30c9\u3064\u304dzip\u3092\u4f5c\u308b\u306e\u306b\u4eba\u751f\u306b\u306f\u306a\u3093\u3068\u969c\u5bb3\u306e\u591a\u3044\u3053\u3068\u3067\u3057\u3087\u3046\u304b\u3002\n \u3053\u308c\u306b\u3055\u3089\u306b\u3001\n\u3000260\u5b57\u4ee5\u4e0a\u306e\u77ed\u7e2e\n\u3000\u65e5\u4ed8\u306e\u4fdd\u6301\u6a5f\u80fd\n\u3000\u306a\u3069\u3092\u4ed8\u3051\u52a0\u3048\u306a\u3044\u3068\u5b8c\u5168\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u3002\u975e\u5e38\u306b\u5727\u7e2e\u306f\u5965\u6df1\u3044\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n \u203bobjShell.Run \u306f\u540c\u671f\u51e6\u7406\u304c\u826f\u3044\u3068\u306e\u3053\u3068\u3067True\u306b\u5909\u3048\u307e\u3057\u305f\u3002\nhttp://winofsql.jp/VA003334/infoboard.php?mid=vbsguide&id=051215192026&pid=1\n\n7zP.vbs\u3001\n\n    Option Explicit\n    Dim objArgs, I , strFile, strFolder\n    Dim objFile, objFolder,objPath,strScr\n    Dim strBase,strExt,strParent,strPath,strZip,RetVal\n    Dim objShell : Set objShell = Createobject(\"WScript.Shell\")\n    Dim FSO : Set FSO = Createobject(\"Scripting.FileSystemObject\")\n    Set objArgs = Wscript.Arguments\n    For I = 0 to objArgs.Count-1\n    set objFile = FSO.GetFile(cstr(objArgs(I)))\n    strParent =  FSO.GetParentFolderName(objFile)\n    set objPath = FSO.GetFolder(strParent)\n    strBase = FSO.GetBaseName(cstr(objArgs(I)))\n    strExt = FSO.GetExtensionName(cstr(objArgs(I)))\n    msgbox objFile.Name ' Delete?\n    if fnblExtCheck(strExt) = False then\n    If len(objFile.Path & \"\\\" &  objFile.Name) < 260 Then\n     If strExt <> \"db\" or strExt <> \"ini\" or strExt <> \"accdb\" then 'Exclude System File or Access file\n       strPath = strParent & \"\\\"\n       strZip = strPath & fnstr(strBase) & \".zip\" 'Set Zip File Name 'Already File then Do Nothing\n         if FSO.FileExists(strZip) = False then \n          strScr = \"\"\"%ProgramFiles%\" & \"\\7-zip\\7z.exe \"\" a -pPassword \" & chr(34) & strZip & chr(34) & \" \" & chr(34) & strPath & objFile.Name & chr(34)\n          RetVal = objShell.Run(strScr,0,True)\n         End if\n     End if\n    End If\n    End If\n    Next\n    set objShell = Nothing\n    set FSO = Nothing\n    Wscript.Quit\n\nFunction fnStr(strBase)\nDim A1,B1,i,buf\nA1=Split(\"\u2460,\u2461,\u2462,\u2463,\u2019,',\u51f6\u5b50\",\",\")\nB1=Split(\"1,2,3,4,_,_,\u4eac\u56fa\",\",\")\nbuf=\"\"\nbuf=strBase\nfor i= LBound(a1) to UBound(a1)\nbuf = Replace(buf,cstr(a1(i)),cstr(b1(i)),1,-1)\nNext\nfnstr=buf\nEnd Function\n\nFunction fnblExtCheck(strExt)\nDim Re : Set Re = New RegExp\nWith Re\n .Pattern = \"^(CON|PRN|AUX|NUL|COM[0-9]|LPT[0-9]|CLOCK\\$)\"\n .Ignorecase = True\n if .test(strExt) = true then \n  fnblExtCheck = true\n  Else\n  fnblExtCheck = False\n  End If\nEnd With\nset Re = Nothing\nEnd Function\n\n\n\n\u6bce\u56de\u60a9\u3080\u306e\u3067\u4e00\u5fdc\u4f5c\u308a\u307e\u3057\u305f\u3002\n7zip\u306evbs\u306f\u3044\u308d\u3044\u308d\u30d1\u30bf\u30fc\u30f3\u304c\u3042\u308a\u3059\u304e\u3066\u6df7\u4e71\u3059\u308b\u306e\u3067\u3001\u81ea\u5206\u6d41\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\n\u30d5\u30a1\u30a4\u30eb\u3092\u30c9\u30e9\u30c3\u30b0\u30a2\u30f3\u30c9\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u3068\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3064\u304dzip\u3092\u5143\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\n\u307e\u305f\u3001\u5727\u7e2e\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4e00\u3064\u4e00\u3064\u660e\u793a\u3057\u307e\u3059\u3002\nmsgbox objFile.Name\u3000\u304c\u305d\u308c\u3067\u3059\u3002\n\u3044\u3089\u306a\u3044\u3068\u304d\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3000\u4f8b\u3048\u3070\u3001c:\\test\\hoge.txt \u3092c:\\test\\hoge.zip\u306b\u3057\u307e\u3059\n\u3000\u305f\u3060\u3057\u62e1\u5f35\u5b50ini,db\u306a\u3069\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a1\u30a4\u30eb\u3001accdb\u306e\u30a2\u30af\u30bb\u30b9\u30d5\u30a1\u30a4\u30eb\u3092\u9664\u5916\u3057\u307e\u3059\u3002\u307e\u305f\u30d5\u30eb\u30d1\u30b9\u304c260\u5b57\u4ee5\u4e0a\u3001\u4f7f\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u62e1\u5f35\u5b50\u3092\u9664\u5916\u3057\u307e\u3059\u3002\n\u3000\u3055\u3089\u306b\u4e38\u4ed8\u304d\u6570\u5b57\u3001\u5168\u89d2\u30a2\u30dd\u30b9\u30c8\u30ed\u30d5\u3092\u7f6e\u63db\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3057\u307e\u3059\u3002\n\u3000\u3082\u3061\u308d\u3093\u3053\u308c\u306f\u5341\u5206\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3002\n\u6b63\u898f\u8868\u73fe\u306f [http://dobon.net/vb/dotnet/file/invalidpathchars.html](http://dobon.net/vb/dotnet/file/invalidpathchars.html)\n\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u306a\u304a\u3001\u30c6\u30b9\u30c8\u3092\u517c\u306d\u3066\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u51f6\u5b50\u304c\u542b\u307e\u308c\u308c\u3070\u3001\u4eac\u56fa\u306b\u5909\u63db\u3057\u307e\u3059\u3002\u305d\u306e\u524d\u306e\u5168\u89d2\u30a2\u30dd\u30b9\u30c8\u30ed\u30d5\u3092\u534a\u89d2\u30a2\u30f3\u30c0\u30fc\u30d0\u30fc\u306b\u5909\u3048\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u308f\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u8996\u8a8d\u6027\u3092\u78ba\u4fdd\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u308c\u3068\u6a5f\u7a2e\u4f9d\u5b58\u6587\u5b57\u306e\u5909\u63db\u306f\u305d\u308c\u81ea\u4f53\u306e\u5b9f\u9a13\u304c\u5371\u967a\u306a\u9762\u3082\u3042\u308b\u305f\u3081\u3067\u3059\u3002\n\u306a\u304a\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f-pPassword \u3067\u6c7a\u307e\u3063\u3066\u3044\u307e\u3059\u3002test\u306b\u3057\u305f\u3051\u308c\u3070\n-ptest \u306b\u3057\u307e\u3059\u3002\u304b\u306a\u3089\u305a\u5f8c\u308d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u3092\u3044\u308c\u3066\u304f\u3060\u3055\u3044\n\u3000\u305d\u308c\u306b\u3057\u3066\u3082\u30d1\u30b9\u30ef\u30fc\u30c9\u3064\u304dzip\u3092\u4f5c\u308b\u306e\u306b\u4eba\u751f\u306b\u306f\u306a\u3093\u3068\u969c\u5bb3\u306e\u591a\u3044\u3053\u3068\u3067\u3057\u3087\u3046\u304b\u3002\n \u3053\u308c\u306b\u3055\u3089\u306b\u3001\n\u3000260\u5b57\u4ee5\u4e0a\u306e\u77ed\u7e2e\n\u3000\u65e5\u4ed8\u306e\u4fdd\u6301\u6a5f\u80fd\n\u3000\u306a\u3069\u3092\u4ed8\u3051\u52a0\u3048\u306a\u3044\u3068\u5b8c\u5168\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u3002\u975e\u5e38\u306b\u5727\u7e2e\u306f\u5965\u6df1\u3044\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n \u203bobjShell.Run \u306f\u540c\u671f\u51e6\u7406\u304c\u826f\u3044\u3068\u306e\u3053\u3068\u3067True\u306b\u5909\u3048\u307e\u3057\u305f\u3002\nhttp://winofsql.jp/VA003334/infoboard.php?mid=vbsguide&id=051215192026&pid=1\n\n```VB:7zP.vbs\u3001\n\n\tOption Explicit\n\tDim objArgs, I , strFile, strFolder\n\tDim objFile, objFolder,objPath,strScr\n\tDim strBase,strExt,strParent,strPath,strZip,RetVal\n\tDim objShell : Set objShell = Createobject(\"WScript.Shell\")\n\tDim FSO : Set FSO = Createobject(\"Scripting.FileSystemObject\")\n\tSet objArgs = Wscript.Arguments\n\tFor I = 0 to objArgs.Count-1\n\tset objFile = FSO.GetFile(cstr(objArgs(I)))\n\tstrParent =  FSO.GetParentFolderName(objFile)\n\tset objPath = FSO.GetFolder(strParent)\n\tstrBase = FSO.GetBaseName(cstr(objArgs(I)))\n\tstrExt = FSO.GetExtensionName(cstr(objArgs(I)))\n\tmsgbox objFile.Name ' Delete?\n\tif fnblExtCheck(strExt) = False then\n\tIf len(objFile.Path & \"\\\" &  objFile.Name) < 260 Then\n\t If strExt <> \"db\" or strExt <> \"ini\" or strExt <> \"accdb\" then 'Exclude System File or Access file\n\t   strPath = strParent & \"\\\"\n\t   strZip = strPath & fnstr(strBase) & \".zip\" 'Set Zip File Name 'Already File then Do Nothing\n\t     if FSO.FileExists(strZip) = False then \n\t      strScr = \"\"\"%ProgramFiles%\" & \"\\7-zip\\7z.exe \"\" a -pPassword \" & chr(34) & strZip & chr(34) & \" \" & chr(34) & strPath & objFile.Name & chr(34)\n\t      RetVal = objShell.Run(strScr,0,True)\n\t     End if\n\t End if\n\tEnd If\n\tEnd If\n\tNext\n\tset objShell = Nothing\n\tset FSO = Nothing\n\tWscript.Quit\n\nFunction fnStr(strBase)\nDim A1,B1,i,buf\nA1=Split(\"\u2460,\u2461,\u2462,\u2463,\u2019,',\u51f6\u5b50\",\",\")\nB1=Split(\"1,2,3,4,_,_,\u4eac\u56fa\",\",\")\nbuf=\"\"\nbuf=strBase\nfor i= LBound(a1) to UBound(a1)\nbuf = Replace(buf,cstr(a1(i)),cstr(b1(i)),1,-1)\nNext\nfnstr=buf\nEnd Function\n\nFunction fnblExtCheck(strExt)\nDim Re : Set Re = New RegExp\nWith Re\n .Pattern = \"^(CON|PRN|AUX|NUL|COM[0-9]|LPT[0-9]|CLOCK\\$)\"\n .Ignorecase = True\n if .test(strExt) = true then \n  fnblExtCheck = true\n  Else\n  fnblExtCheck = False\n  End If\nEnd With\nset Re = Nothing\nEnd Function\n\n```\n"}