{"context": "adb\u3067\u9001\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u4fee\u6b63\u3059\u308b\n\nOn OSX, when you access Android using mass-storage mode, filenames are written in UTF-8.\nHowever, when you send files via adb, filenames are written UTF-8-MAC, i.e. filenames are not normalized.\n\nThese files looks corrupted;\n\nwhen the SD-card is inserted to OSX, the files can be Tab-Completed in Terminal, but they cannot be open()ed in anyways.\n\n\nOSX\u3067\u306f\u3001Android\u306b\u30de\u30b9\u30b9\u30c8\u30ec\u30fc\u30b8\u30e2\u30fc\u30c9\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u306fUTF-8\u3067\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001adb\u7d4c\u7531\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001UTF-8-MAC\u3067\u8a18\u9332\u3055\u308c\u307e\u3059(\u6b63\u898f\u5316\u3055\u308c\u307e\u305b\u3093)\u3002\n\n\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u7834\u640d\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\uff1b\n\nSD\u30ab\u30fc\u30c9\u3092\u53d6\u308a\u51fa\u3057\u3066OSX\u306b\u5165\u308c\u308b\u3068\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u306f\u3001\u30bf\u30d6\u88dc\u5b8c\u306f\u52b9\u304f\u304c\u4e00\u5207\u958b\u3051\u306a\u3044\u3068\u3044\u3063\u305f\u5947\u5999\u306a\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n\n\nTo address this issue, we have to rename via adb, because mass-storage mode cannot rename files properly. you can try following Ruby script.\n\n\nWell, C(++) edition executable on Android is appreciated.\nAndroid\u3067\u5b9f\u884c\u3067\u304d\u308bC(++)\u7248\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u6b53\u8fce\u3057\u307e\u3059\u3002\n\n\n\n\ntonfc_android.rb\n#!/usr/bin/ruby\n$<.each{|_s|\n    _s.chomp!\n    s=_s.dup\n    s.force_encoding(Encoding::UTF_8_MAC)\n    nfc=s.encode(Encoding::UTF_8)\n    if _s!=nfc\n        puts nfc\n        system(\"adb shell mv '#{_s}' '#{nfc}'\")\n    end\n}\n\n\n\nadb\u3067\u9001\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u4fee\u6b63\u3059\u308b\n\n- On OSX, when you access Android using mass-storage mode, filenames are written in UTF-8.\n- However, when you send files via adb, filenames are written UTF-8-MAC, i.e. filenames are not normalized.\n- These files looks corrupted;\n  - when the SD-card is inserted to OSX, the files can be Tab-Completed in Terminal, but they cannot be open()ed in anyways.\n\n- OSX\u3067\u306f\u3001Android\u306b\u30de\u30b9\u30b9\u30c8\u30ec\u30fc\u30b8\u30e2\u30fc\u30c9\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u306fUTF-8\u3067\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\n- \u3057\u304b\u3057\u3001adb\u7d4c\u7531\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001UTF-8-MAC\u3067\u8a18\u9332\u3055\u308c\u307e\u3059(\u6b63\u898f\u5316\u3055\u308c\u307e\u305b\u3093)\u3002\n- \u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u7834\u640d\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\uff1b\n  - SD\u30ab\u30fc\u30c9\u3092\u53d6\u308a\u51fa\u3057\u3066OSX\u306b\u5165\u308c\u308b\u3068\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u306f\u3001\u30bf\u30d6\u88dc\u5b8c\u306f\u52b9\u304f\u304c\u4e00\u5207\u958b\u3051\u306a\u3044\u3068\u3044\u3063\u305f\u5947\u5999\u306a\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\n\n----\n\n- To address this issue, we have to rename via adb, because mass-storage mode cannot rename files properly. you can try following Ruby script.\n  - Well, C(++) edition executable on Android is appreciated.\n  - Android\u3067\u5b9f\u884c\u3067\u304d\u308bC(++)\u7248\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u6b53\u8fce\u3057\u307e\u3059\u3002\n\n```tonfc_android.rb\n#!/usr/bin/ruby\n$<.each{|_s|\n\t_s.chomp!\n\ts=_s.dup\n\ts.force_encoding(Encoding::UTF_8_MAC)\n\tnfc=s.encode(Encoding::UTF_8)\n\tif _s!=nfc\n\t\tputs nfc\n\t\tsystem(\"adb shell mv '#{_s}' '#{nfc}'\")\n\tend\n}\n```\n", "tags": ["adb", "Android"]}