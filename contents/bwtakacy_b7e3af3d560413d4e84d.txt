{"context": "Mac\u4e0a\u306bVagrant\u3067CentOS\u306eVM\u3092\u7acb\u3066\u3066\u3001\u305d\u306e\u4e0a\u3067Amazon Linux\u306eDocker Container\u3092\u52d5\u304b\u3059\u624b\u9806\u3002\nAmazon Linux\u7528\u306eAnsible\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u4f5c\u8a66\u9a13\u3092\u3059\u308b\u305f\u3081\u306b\u7528\u610f\u3057\u305f\u3002\n\u306a\u304a\u3001\u6700\u521d\u306fDocker for Mac\u3067Mac\u4e0a\u306b\u76f4\u63a5\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u305d\u3046\u3068\u3057\u305f\u304c\u3001\u5f8c\u8ff0\u306e\u7406\u7531\u3067\u65ad\u5ff5\u3057\u305f\u3002\n\nMac OS Sierra 10.12.1\nVagrant 1.8.1\nVirtual Box 5.0.28 r111378\n\n\nVagrant, VirtualBox\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5148\u4eba\u306e\u3042\u308a\u304c\u305f\u3044\u77e5\u6075\u306b\u5f93\u3046\u3002\nhttp://qiita.com/you-me/items/3126e7f91ccdf4d8a873\ncentos7.2\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u3002\n$ vagrant box add centos7 https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'centos7' (v0) for provider: \n    box: Downloading: git@github.com:CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\nAn error occurred while downloading the remote file. The error\nmessage, if any, is reproduced below. Please fix this error and try\nagain.\n\n\n\n\u3053\u306e\u6642\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u306b\u4e0a\u304c\u3063\u3066\u3044\u308b\u4e0d\u5177\u5408\u306b\u906d\u9047\u3057\u305f\u306e\u3067\nhttp://qiita.com/kotatsu360/items/554da271d6935622254b\n$ sudo mv /opt/vagrant/embedded/bin/curl{,.bak}\n\n\u3067\u76f4\u3059\u3002\n\nCentOS7\u306eVM\u4f5c\u6210\u3001\u8d77\u52d5\n$ vagrant box add centos7 https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'centos7' (v0) for provider: \n    box: Downloading: https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Successfully added box 'centos7' (v0) for 'virtualbox'!\n$ vagrant box list\ncentos7 (virtualbox, 0)\n\n$ cd Vagrant/CentOS7\n$ vagrant init centos7\nA `Vagrantfile` has been placed in this directory. You are now\nready to `vagrant up` your first virtual environment! Please read\nthe comments in the Vagrantfile as well as documentation on\n`vagrantup.com` for more information on using Vagrant.\n\n$ vagrant up\n\n$ vagrant status\nCurrent machine states:\n\ndefault                   running (virtualbox)\n\nThe VM is running. To stop this VM, you can run `vagrant halt` to\nshut it down forcefully, or you can run `vagrant suspend` to simply\nsuspend the virtual machine. In either case, to restart it again,\nsimply run `vagrant up`.\nCentOS7 15:35:21 $ vagrant ssh\n[vagrant@ip-10-0-2-15 ~]$ vim\n\n\nVM(Docker\u30db\u30b9\u30c8)\u306e\u74b0\u5883\u8a2d\u5b9a\n\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u3092\u5165\u308c\u3066\u304a\u304f\u3002\n$ sudo yum install vim git ruby docker ansible\n\nGit\u306e\u8a2d\u5b9a\u7b49\u3092\u5b9f\u65bd\u3002\n$ sudo systemctl start docker\n$ sudo systemctl enable docker\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u4e00\u822c\u30e6\u30fc\u30b6\u3067docker deamon\u3068\u306e\u901a\u4fe1\u304c\u3067\u304d\u306a\u3044\u3002\n$ docker version\nClient:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\nCannot connect to the Docker daemon. Is the docker daemon running on this host?\n\nsudo\u4ed8\u304d\u3060\u3068OK\u3002\n$ sudo docker version\nClient:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\n\nServer:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\n\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u306b\u8ff0\u3079\u3089\u308c\u3066\u3044\u308b\u624b\u9806\u3067sudo\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nhttp://jetglass.hatenablog.jp/entry/2015/10/19/182052\n$ sudo groupadd docker\n$ sudo gpasswd -a vagrant docker\n\n\nAmazon Linux\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nawscli\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001aws\u306e\u30a2\u30af\u30bb\u30b9\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n$ pip install awscli\n$ aws configure\nAWS Access Key ID [None]: <\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID>\nAWS Secret Access Key [None]: <\u30a2\u30af\u30bb\u30b9\u30ad\u30fc>\nDefault region name [None]: ap-northeast-1\nDefault output format [None]: json\n\naws\u306e\u30e6\u30fc\u30b6\u306bAmazonEC2ContainerRegistryReadOnly\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u3092\u3064\u3051\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u308c\u304c\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n$ aws ecr get-login --region us-west-2 --registry-ids 137112412989\n\nAn error occurred (AccessDeniedException) when calling the GetAuthorizationToken operation:\n\n$ aws ecr get-login --region us-west-2 --registry-ids 137112412989\ndocker login -u AWS -p <Password> -e none https://137112412989.dkr.ecr.us-west-2.amazonaws.com\n\n\u6210\u529f\u3059\u308b\u3068docker login\u306e\u30b3\u30de\u30f3\u30c9\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5b9f\u884c\u3002\n$ docker login -u AWS -p <Password> -e none https://137112412989.dkr.ecr.us-west-2.amazonaws.com\nFlag --email has been deprecated, will be removed in 1.13.\nLogin Succeeded\n\ndocker pull\u3059\u308b\u3002\n$ docker pull 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\nlatest: Pulling from amazonlinux\n\ne2daa1633485: Pull complete \nDigest: sha256:939657b06a824c58f1532b104ba423c0c5efc16552c01427d96e9da20f8b2680\nStatus: Downloaded newer image for 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\n\n\nDockerfile\u3092\u7528\u610f\u3002\n\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308bimage\u3092\u4f5c\u308bDockerfile\u3092\u7528\u610f\u3002\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\nhttp://cross-black777.hatenablog.com/entry/2014/06/15/163130\nFROM 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux\n\n# set yum repository mirror for jp\nRUN yum -y install yum-plugin-fastestmirror\nRUN sed -ri 's/#include_only=.nl,.de,.uk,.ie/include_only=.jp/g' /etc/yum/pluginconf.d/fastestmirror.conf\n\n# install packages\nRUN yum -y update\nRUN yum -y install vim\nRUN yum -y install passwd openssh openssh-server openssh-clients sudo iproute\n\n# create users\nRUN useradd embulk\nRUN passwd -f -u embulk\n\n# setup sudoers\nRUN echo \"embulk ALL=(ALL) ALL\" >> /etc/sudoers.d/embulk\n\n# setup SSH\nRUN mkdir -p /home/embulk/.ssh; chown embulk /home/embulk/.ssh; chmod 700 /home/embulk/.ssh\nADD authorized_keys /home/embulk/.ssh/authorized_keys\nRUN chown embulk /home/embulk/.ssh/authorized_keys\nRUN chmod 600 /home/embulk/.ssh/authorized_keys\n\n# setup sshd config\nRUN sed -ri 's/#PermitRootLogin yes/PermitRootLogin yes/g' /etc/ssh/sshd_config\nRUN sed -ri 's/UsePAM yes/#UsePAM yes/g' /etc/ssh/sshd_config\nRUN sed -ri 's/#UsePAM no/UsePAM no/g' /etc/ssh/sshd_config\n\nRUN /etc/init.d/sshd start\n\nEXPOSE 22\nCMD [\"/sbin/init\"]\n\n\nSSH\u63a5\u7d9a\u7528\u306e\u6e96\u5099\nDockerfile\u3067\u4f7f\u3046SSH\u306e\u9375\u3092\u4f5c\u308b\u3002\n$ mkdir keys\n$ ssh-keygen\n$ cp keys/id_rsa.pub authorized_keys\n\n\n\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n$ docker build -t docker/amzlinux .\n\n$ docker images\nREPOSITORY                                                 TAG                 IMAGE ID            CREATED             SIZE\ndocker/amzlinux                                            latest              d2aa393e0b47        49 seconds ago      548.8 MB\n137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux   latest              feee9aea7094        2 weeks ago         328.3 MB\n\n$ docker run -d --name <\u30b3\u30f3\u30c6\u30ca\u540d> --hostname <\u30db\u30b9\u30c8\u540d> docker/amzlinux\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u308b\u3002\n$ ssh -i keys/id_rsa embulk@172.17.0.2\n\n       __|  __|_  )\n       _|  (     /   Amazon Linux AMI\n      ___|\\___|___|\n\nhttps://aws.amazon.com/amazon-linux-ami/2016.09-release-notes/\n\n\n\u4f59\u8ac7\u3002Docker for Mac\u3092\u8ae6\u3081\u305f\u7406\u7531\u3002\nDocker for mac\u3060\u3068\u30db\u30b9\u30c8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u306bping\u304c\u98db\u3070\u306a\u3044\u3002\n\nI cannot ping my containers\nUnfortunately, due to limitations in macOS, we\u2019re unable to route traffic to containers, and from containers back to the host.\n\nhttps://docs.docker.com/docker-for-mac/networking/\nhttp://stackoverflow.com/questions/39216830/how-could-i-ping-my-docker-container-from-my-host\n\u3082\u3046\u4e00\u3064\u5225\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u3066\u305d\u3053\u304b\u3089\u306a\u3089\u901a\u4fe1\u304c\u3067\u304d\u308b\u3002\n\u3053\u308c\u4ee5\u5916\u306b\u3082Docker for Mac\u7279\u6709\u306e\u4e8b\u60c5\u306b\u30cf\u30de\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u8ae6\u3081\u3066Linux\u4e0a\u3092Docker\u30db\u30b9\u30c8\u3068\u3059\u308b\u65b9\u91dd\u306b\u5909\u66f4\u3057\u305f\u3002\n\u4ee5\u4e0a\u3002\nMac\u4e0a\u306bVagrant\u3067CentOS\u306eVM\u3092\u7acb\u3066\u3066\u3001\u305d\u306e\u4e0a\u3067Amazon Linux\u306eDocker Container\u3092\u52d5\u304b\u3059\u624b\u9806\u3002\n\nAmazon Linux\u7528\u306eAnsible\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u4f5c\u8a66\u9a13\u3092\u3059\u308b\u305f\u3081\u306b\u7528\u610f\u3057\u305f\u3002\n\n\u306a\u304a\u3001\u6700\u521d\u306fDocker for Mac\u3067Mac\u4e0a\u306b\u76f4\u63a5\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u304b\u305d\u3046\u3068\u3057\u305f\u304c\u3001\u5f8c\u8ff0\u306e\u7406\u7531\u3067\u65ad\u5ff5\u3057\u305f\u3002\n\n* Mac OS Sierra 10.12.1\n* Vagrant 1.8.1\n* Virtual Box 5.0.28 r111378\n\n## Vagrant, VirtualBox\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u5148\u4eba\u306e\u3042\u308a\u304c\u305f\u3044\u77e5\u6075\u306b\u5f93\u3046\u3002\nhttp://qiita.com/you-me/items/3126e7f91ccdf4d8a873\n\ncentos7.2\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u3002\n\n```\n$ vagrant box add centos7 https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'centos7' (v0) for provider: \n    box: Downloading: git@github.com:CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\nAn error occurred while downloading the remote file. The error\nmessage, if any, is reproduced below. Please fix this error and try\nagain.\n\n\n```\n\n\u3053\u306e\u6642\u3001\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u306b\u4e0a\u304c\u3063\u3066\u3044\u308b\u4e0d\u5177\u5408\u306b\u906d\u9047\u3057\u305f\u306e\u3067\nhttp://qiita.com/kotatsu360/items/554da271d6935622254b\n\n```\n$ sudo mv /opt/vagrant/embedded/bin/curl{,.bak}\n```\n\n\u3067\u76f4\u3059\u3002\n\n## CentOS7\u306eVM\u4f5c\u6210\u3001\u8d77\u52d5\n\n```\n$ vagrant box add centos7 https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Box file was not detected as metadata. Adding it directly...\n==> box: Adding box 'centos7' (v0) for provider: \n    box: Downloading: https://github.com/CommanderK5/packer-centos-template/releases/download/0.7.2/vagrant-centos-7.2.box\n==> box: Successfully added box 'centos7' (v0) for 'virtualbox'!\n$ vagrant box list\ncentos7 (virtualbox, 0)\n```\n\n```\n$ cd Vagrant/CentOS7\n$ vagrant init centos7\nA `Vagrantfile` has been placed in this directory. You are now\nready to `vagrant up` your first virtual environment! Please read\nthe comments in the Vagrantfile as well as documentation on\n`vagrantup.com` for more information on using Vagrant.\n```\n\n```\n$ vagrant up\n```\n\n```\n$ vagrant status\nCurrent machine states:\n\ndefault                   running (virtualbox)\n\nThe VM is running. To stop this VM, you can run `vagrant halt` to\nshut it down forcefully, or you can run `vagrant suspend` to simply\nsuspend the virtual machine. In either case, to restart it again,\nsimply run `vagrant up`.\nCentOS7 15:35:21 $ vagrant ssh\n[vagrant@ip-10-0-2-15 ~]$ vim\n```\n\n## VM(Docker\u30db\u30b9\u30c8)\u306e\u74b0\u5883\u8a2d\u5b9a\n\n\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u3092\u5165\u308c\u3066\u304a\u304f\u3002\n\n```\n$ sudo yum install vim git ruby docker ansible\n```\n\nGit\u306e\u8a2d\u5b9a\u7b49\u3092\u5b9f\u65bd\u3002\n\n```\n$ sudo systemctl start docker\n$ sudo systemctl enable docker\n```\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u4e00\u822c\u30e6\u30fc\u30b6\u3067`docker` deamon\u3068\u306e\u901a\u4fe1\u304c\u3067\u304d\u306a\u3044\u3002\n\n```\n$ docker version\nClient:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\nCannot connect to the Docker daemon. Is the docker daemon running on this host?\n```\n\nsudo\u4ed8\u304d\u3060\u3068OK\u3002\n\n```\n$ sudo docker version\nClient:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\n\nServer:\n Version:         1.10.3\n API version:     1.22\n Package version: docker-common-1.10.3-46.el7.centos.14.x86_64\n Go version:      go1.6.3\n Git commit:      cb079f6-unsupported\n Built:           Fri Sep 16 13:24:25 2016\n OS/Arch:         linux/amd64\n```\n\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u306b\u8ff0\u3079\u3089\u308c\u3066\u3044\u308b\u624b\u9806\u3067sudo\u306a\u3057\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nhttp://jetglass.hatenablog.jp/entry/2015/10/19/182052\n\n\n```\n$ sudo groupadd docker\n$ sudo gpasswd -a vagrant docker\n```\n\n## Amazon Linux\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n`awscli`\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u306e\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001aws\u306e\u30a2\u30af\u30bb\u30b9\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\n```\n$ pip install awscli\n$ aws configure\nAWS Access Key ID [None]: <\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID>\nAWS Secret Access Key [None]: <\u30a2\u30af\u30bb\u30b9\u30ad\u30fc>\nDefault region name [None]: ap-northeast-1\nDefault output format [None]: json\n```\n\naws\u306e\u30e6\u30fc\u30b6\u306b`AmazonEC2ContainerRegistryReadOnly`\u7ba1\u7406\u30dd\u30ea\u30b7\u30fc\u3092\u3064\u3051\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u308c\u304c\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n\n```\n$ aws ecr get-login --region us-west-2 --registry-ids 137112412989\n\nAn error occurred (AccessDeniedException) when calling the GetAuthorizationToken operation:\n```\n\n```\n$ aws ecr get-login --region us-west-2 --registry-ids 137112412989\ndocker login -u AWS -p <Password> -e none https://137112412989.dkr.ecr.us-west-2.amazonaws.com\n```\n\n\u6210\u529f\u3059\u308b\u3068`docker login`\u306e\u30b3\u30de\u30f3\u30c9\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5b9f\u884c\u3002\n\n```\n$ docker login -u AWS -p <Password> -e none https://137112412989.dkr.ecr.us-west-2.amazonaws.com\nFlag --email has been deprecated, will be removed in 1.13.\nLogin Succeeded\n```\n\n`docker pull`\u3059\u308b\u3002\n\n```\n$ docker pull 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\nlatest: Pulling from amazonlinux\n\ne2daa1633485: Pull complete \nDigest: sha256:939657b06a824c58f1532b104ba423c0c5efc16552c01427d96e9da20f8b2680\nStatus: Downloaded newer image for 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux:latest\n```\n\n## Dockerfile\u3092\u7528\u610f\u3002\n\n\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308bimage\u3092\u4f5c\u308bDockerfile\u3092\u7528\u610f\u3002\n\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u5148\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3082\u3089\u3063\u305f\u3002\nhttp://cross-black777.hatenablog.com/entry/2014/06/15/163130\n\n```docker\nFROM 137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux\n\n# set yum repository mirror for jp\nRUN yum -y install yum-plugin-fastestmirror\nRUN sed -ri 's/#include_only=.nl,.de,.uk,.ie/include_only=.jp/g' /etc/yum/pluginconf.d/fastestmirror.conf\n\n# install packages\nRUN yum -y update\nRUN yum -y install vim\nRUN yum -y install passwd openssh openssh-server openssh-clients sudo iproute\n\n# create users\nRUN useradd embulk\nRUN passwd -f -u embulk\n\n# setup sudoers\nRUN echo \"embulk ALL=(ALL) ALL\" >> /etc/sudoers.d/embulk\n\n# setup SSH\nRUN mkdir -p /home/embulk/.ssh; chown embulk /home/embulk/.ssh; chmod 700 /home/embulk/.ssh\nADD authorized_keys /home/embulk/.ssh/authorized_keys\nRUN chown embulk /home/embulk/.ssh/authorized_keys\nRUN chmod 600 /home/embulk/.ssh/authorized_keys\n\n# setup sshd config\nRUN sed -ri 's/#PermitRootLogin yes/PermitRootLogin yes/g' /etc/ssh/sshd_config\nRUN sed -ri 's/UsePAM yes/#UsePAM yes/g' /etc/ssh/sshd_config\nRUN sed -ri 's/#UsePAM no/UsePAM no/g' /etc/ssh/sshd_config\n\nRUN /etc/init.d/sshd start\n\nEXPOSE 22\nCMD [\"/sbin/init\"]\n```\n\n## SSH\u63a5\u7d9a\u7528\u306e\u6e96\u5099\nDockerfile\u3067\u4f7f\u3046SSH\u306e\u9375\u3092\u4f5c\u308b\u3002\n\n```\n$ mkdir keys\n$ ssh-keygen\n$ cp keys/id_rsa.pub authorized_keys\n```\n\n## \u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\n\n```\n$ docker build -t docker/amzlinux .\n```\n\n```\n$ docker images\nREPOSITORY                                                 TAG                 IMAGE ID            CREATED             SIZE\ndocker/amzlinux                                            latest              d2aa393e0b47        49 seconds ago      548.8 MB\n137112412989.dkr.ecr.us-west-2.amazonaws.com/amazonlinux   latest              feee9aea7094        2 weeks ago         328.3 MB\n```\n\n```\n$ docker run -d --name <\u30b3\u30f3\u30c6\u30ca\u540d> --hostname <\u30db\u30b9\u30c8\u540d> docker/amzlinux\n```\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u308b\u3002\n\n```\n$ ssh -i keys/id_rsa embulk@172.17.0.2\n\n       __|  __|_  )\n       _|  (     /   Amazon Linux AMI\n      ___|\\___|___|\n\nhttps://aws.amazon.com/amazon-linux-ami/2016.09-release-notes/\n```\n\n## \u4f59\u8ac7\u3002Docker for Mac\u3092\u8ae6\u3081\u305f\u7406\u7531\u3002\n\nDocker for mac\u3060\u3068\u30db\u30b9\u30c8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u306bping\u304c\u98db\u3070\u306a\u3044\u3002\n\n> I cannot ping my containers\nUnfortunately, due to limitations in macOS, we\u2019re unable to route traffic to containers, and from containers back to the host.\n\nhttps://docs.docker.com/docker-for-mac/networking/\n\nhttp://stackoverflow.com/questions/39216830/how-could-i-ping-my-docker-container-from-my-host\n\n\u3082\u3046\u4e00\u3064\u5225\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3066\u3066\u305d\u3053\u304b\u3089\u306a\u3089\u901a\u4fe1\u304c\u3067\u304d\u308b\u3002\n\n\u3053\u308c\u4ee5\u5916\u306b\u3082Docker for Mac\u7279\u6709\u306e\u4e8b\u60c5\u306b\u30cf\u30de\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u8ae6\u3081\u3066Linux\u4e0a\u3092Docker\u30db\u30b9\u30c8\u3068\u3059\u308b\u65b9\u91dd\u306b\u5909\u66f4\u3057\u305f\u3002\n\n\n\u4ee5\u4e0a\u3002\n", "tags": ["vagrant", "docker", "AmazonLinux"]}