{"context": "\n\n\u6982\u8981\nQuery Builder\u304c\u5185\u90e8\u3067\u751f\u6210\u3057\u3066\u3044\u308bSQL\u3092\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b\u65b9\u6cd5\u3002\n\n\u65b9\u6cd5\nQuery Builder\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u7b87\u6240\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n    public function findAccountEntityByEmail(EmailValue $emailValue): AccountEntity\n    {\n        $selectColumns = [\n            'a.id',\n            'a.status',\n            'a.lock_version AS accounts_lock_version',\n            'ae.id AS email_id',\n            'ae.email',\n            'ae.email_verified',\n            'ae.lock_version AS accounts_emails_lock_version',\n            'ap.id AS password_id',\n            'ap.password_hash',\n            'ap.lock_version AS accounts_passwords_lock_version',\n        ];\n\n        // SQL\u3092\u5b9f\u884c\u3059\u308b\u524d\u306b\u3053\u308c\u3092\u8ffd\u52a0\u3059\u308b\n        \\DB::enableQueryLog();\n\n        $account = \\DB::table('accounts_emails AS ae')\n            ->select($selectColumns)\n            ->join('accounts AS a', 'a.id', '=', 'ae.account_id')\n            ->join('accounts_passwords AS ap', 'a.id', '=', 'ap.account_id')\n            ->where('ae.email', '=', $emailValue->getEmail())\n            ->first();\n\n        // \u30ed\u30ae\u30f3\u30b0\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b\n        // \"sql_debug_log\", \"findAccountEntityByEmail\"\u306e\u90e8\u5206\u306b\u306f\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u308c\u3089\u308c\u308b\n        \\Log::debug(\n            'sql_debug_log',\n            [\n                'findAccountEntityByEmail' => \\DB::getQueryLog()\n            ]\n        );\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u3001storage/logs/laravel.log \u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u30cf\u30ba\u306a\u306e\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u21931\u884c\u3067\u51fa\u529b\u3057\u3066\u3044\u308b\u306e\u3067\u5c11\u3057\u898b\u306b\u304f\u3044\u3067\u3059\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\nlaravel.log\n[2016-11-27 08:11:57] testing.DEBUG: sql_debug_log {\"findAccountEntityByEmail\":[{\"query\":\"select `a`.`id`, `a`.`status`, `a`.`lock_version` as `accounts_lock_version`, `ae`.`id` as `email_id`, `ae`.`email`, `ae`.`email_verified`, `ae`.`lock_version` as `accounts_emails_lock_version`, `ap`.`id` as `password_id`, `ap`.`password_hash`, `ap`.`lock_version` as `accounts_passwords_lock_version` from `accounts_emails` as `ae` inner join `accounts` as `a` on `a`.`id` = `ae`.`account_id` inner join `accounts_passwords` as `ap` on `a`.`id` = `ap`.`account_id` where `ae`.`email` = ? limit 1\",\"bindings\":[\"account-create-test-success-required-params@gmail.com\"],\"time\":1.1}]}\n\n\n## \u6982\u8981\nQuery Builder\u304c\u5185\u90e8\u3067\u751f\u6210\u3057\u3066\u3044\u308bSQL\u3092\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b\u65b9\u6cd5\u3002\n\n## \u65b9\u6cd5\nQuery Builder\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u7b87\u6240\u3067\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\n```php\n    public function findAccountEntityByEmail(EmailValue $emailValue): AccountEntity\n    {\n        $selectColumns = [\n            'a.id',\n            'a.status',\n            'a.lock_version AS accounts_lock_version',\n            'ae.id AS email_id',\n            'ae.email',\n            'ae.email_verified',\n            'ae.lock_version AS accounts_emails_lock_version',\n            'ap.id AS password_id',\n            'ap.password_hash',\n            'ap.lock_version AS accounts_passwords_lock_version',\n        ];\n\n        // SQL\u3092\u5b9f\u884c\u3059\u308b\u524d\u306b\u3053\u308c\u3092\u8ffd\u52a0\u3059\u308b\n        \\DB::enableQueryLog();\n\n        $account = \\DB::table('accounts_emails AS ae')\n            ->select($selectColumns)\n            ->join('accounts AS a', 'a.id', '=', 'ae.account_id')\n            ->join('accounts_passwords AS ap', 'a.id', '=', 'ap.account_id')\n            ->where('ae.email', '=', $emailValue->getEmail())\n            ->first();\n\n        // \u30ed\u30ae\u30f3\u30b0\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u30ed\u30b0\u306b\u51fa\u529b\u3059\u308b\n        // \"sql_debug_log\", \"findAccountEntityByEmail\"\u306e\u90e8\u5206\u306b\u306f\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u308c\u3089\u308c\u308b\n        \\Log::debug(\n            'sql_debug_log',\n            [\n                'findAccountEntityByEmail' => \\DB::getQueryLog()\n            ]\n        );\n\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068\u3001storage/logs/laravel.log \u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u30cf\u30ba\u306a\u306e\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u21931\u884c\u3067\u51fa\u529b\u3057\u3066\u3044\u308b\u306e\u3067\u5c11\u3057\u898b\u306b\u304f\u3044\u3067\u3059\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```:laravel.log\n[2016-11-27 08:11:57] testing.DEBUG: sql_debug_log {\"findAccountEntityByEmail\":[{\"query\":\"select `a`.`id`, `a`.`status`, `a`.`lock_version` as `accounts_lock_version`, `ae`.`id` as `email_id`, `ae`.`email`, `ae`.`email_verified`, `ae`.`lock_version` as `accounts_emails_lock_version`, `ap`.`id` as `password_id`, `ap`.`password_hash`, `ap`.`lock_version` as `accounts_passwords_lock_version` from `accounts_emails` as `ae` inner join `accounts` as `a` on `a`.`id` = `ae`.`account_id` inner join `accounts_passwords` as `ap` on `a`.`id` = `ap`.`account_id` where `ae`.`email` = ? limit 1\",\"bindings\":[\"account-create-test-success-required-params@gmail.com\"],\"time\":1.1}]}\n```\n", "tags": ["Laravel5.3"]}