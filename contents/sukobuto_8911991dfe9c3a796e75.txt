{"tags": ["Aurelia", "SinglePageApplication", "JavaScript"], "context": " More than 1 year has passed since last update.\n\nAurelia Dependency Injection\n\u901a\u5e38 DI \u3068\u3044\u3046\u3068\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u306e interface \u306b\u5bfe\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u751f\u6210\u65b9\u6cd5\u306a\u3069\u3092\u4e8b\u524d\u306b\u5b9a\u7fa9\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001Aurelia \u306e\u5834\u5408\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n@inject()\n\nsrc/services.js\n// \u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u4f7f\u3046\u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\nexport class SomeService {\n    _count = 0;\n    get count() {\n        return ++this._count;\n    }\n}\n\n\n\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u3088\u3046\u306a\u3001\u30ab\u30a6\u30f3\u30bf\u3092\u6301\u3063\u305f\u30b5\u30fc\u30d3\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u306b\u306f\u305f\u3060\u2193\u306e\u3088\u3046\u306b inject \u3059\u308b\u3060\u3051\u3067\u3088\u3044\u306e\u3067\u3059\u3002\n\nsrc/example1.js\nimport {inject} from 'aurelia-framework'\nimport {SomeService} from 'services'\n\n@inject(SomeService)\nexport class Example1 {\n\n    constructor(someService) {\n        console.log(someService.count); // -> 1\n    }\n\n}\n\n\n\u5358\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u304f\u308c\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u3061\u3083\u3093\u3068\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u30b5\u30fc\u30d3\u30b9\u3092\u5225\u306e\u30af\u30e9\u30b9\u3067 inject \u3057\u3066\u30ab\u30a6\u30f3\u30bf\u3092\u53c2\u7167\u3057\u3066\u307f\u308b\u3068\u3001\u6570\u304c\u5897\u3048\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u4e00\u5ea6\u751f\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f7f\u3044\u307e\u308f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nsrc/example1.js\nimport {inject} from 'aurelia-framework'\nimport {SomeService} from 'services'\n\n@inject(SomeService)\nexport class Example2 {\n\n    constructor(someService) {\n        console.log(someService.count); // -> 2\n    }\n\n}\n\n\n\n@transient()\n\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u3067\u306f\u306a\u304f\u6bce\u56de\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3057\u3066\u751f\u6210\u3057\u3066\u307b\u3057\u3044\u5834\u5408\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30af\u30e9\u30b9\u306b @transient() \u3068\u3044\u3046\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u3064\u3051\u307e\u3059\u3002\n\nsrc/services.js\nimport {transient, inject} from 'aurelia-framework'\nimport {HttpClient} from 'aurelia-fetch-client'\nimport {Dep1, Dep2} from 'other-services'\n\n@transient()           // inject \u306e\u305f\u3073\u306b\u65b0\u3057\u3044 SomeService \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u751f\u6210\u3055\u308c\u308b\n@inject(HttpClient, Dep1, Dep2)    // \u3082\u3061\u308d\u3093\u30b5\u30fc\u30d3\u30b9\u306b\u3082 inject \u3067\u304d\u308b\nexport class SomeService {\n\n    constructor(client, dep1, dep2) { // inject \u306b\u66f8\u3044\u305f\u9806\u756a\u306b\u5f15\u6570\u3068\u306a\u308b\n        this.client = client;\n        this.dep1 = dep1;\n        this.dep2 = dep2;\n    }\n\n    _count = 0;\n    get count() {\n        return ++this._count;\n    }\n}\n\n\n\n\u81ea\u5206\u3067 DI \u30b3\u30f3\u30c6\u30ca\u306b\u7a81\u3063\u8fbc\u3080\u65b9\u6cd5\n\u3082\u3061\u308d\u3093\u81ea\u524d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b main.js \u306a\u3069\u306e\u521d\u671f\u8a2d\u5b9a\u90e8\u5206\u3067\u884c\u3044\u307e\u3059\u3002\n\nsrc/main.js\nimport {SomeService} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n\n    // \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n    let someService = new SomeService();\n    // DI \u306b\u767b\u9332\u3059\u308b\n    aurelia.container.registerInstance(SomeService, someService);\n\n    aurelia.start().then(a => a.setRoot());\n}\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b aurelia.container.registerInstance \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u81ea\u524d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057 SomeService \u81ea\u4f53\u304c\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b (= inject \u3055\u308c\u308b) \u5834\u5408\u3001\u81ea\u5206\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\u305d\u308c\u3067\u3082\u521d\u671f\u8a2d\u5b9a\u306e\u6642\u70b9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u5ea6\u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u3082\u3089\u3046\u3068\u3044\u3046\u624b\u304c\u3042\u308a\u307e\u3059\u3002\n\nsrc/main.js\nimport {SomeService} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n\n    // \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210 ...\u767b\u9332\u3057\u306a\u304f\u3066\u3082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3067\u304d\u308b\u5229\u70b9\n    let someService = aurelia.container.get(SomeService);\n    // \u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u306a\u3069\n    someService._count = 100;\n\n    aurelia.start().then(a => a.setRoot());\n}\n\n\n\u3042\u3068\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u304c\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3059\u308b\u3068\u306a\u3063\u305f\u5834\u5408\u306b\u4fee\u6b63\u304c\u5927\u5909\u306a\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u306f\u6700\u521d\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u306b\u4efb\u305b\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u306d\u3002\n\n\u81ea\u4f5c API \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n\u524d\u56de \u5ba3\u8a00\u3057\u305f\u3068\u304a\u308a\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u3092\u6301\u3063\u305f ApiClient \u30af\u30e9\u30b9\u3092\u81ea\u4f5c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u524d\u56de\u4f7f\u7528\u3057\u305f SuperAgent \u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u3001jspm \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\u3055\u3089\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u6709\u52b9\u671f\u9650\u7ba1\u7406\u306e\u305f\u3081\u306b moment.js \u3092\u4f7f\u3044\u307e\u3059\u3002\n\nmoment.js\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[you@server aurelia-skeleton-navigation]$ jspm install npm:moment\n\n\n\nsrc/services.js\nimport superagent from 'superagent'\nimport moment from 'moment'\n\nexport class ApiClient {\n\n    token;      // \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c8\u30fc\u30af\u30f3\n    cache = {}; // \u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30fc\u30bf\u683c\u7d0d\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4fdd\u5b58\u3059\u308b\n     * @param {string} key\n     * @param {any} content\n     */\n    saveCache(key, content) {\n        this.cache[key] = {\n            content,\n            since: moment().unix()\n        };\n        return this;\n    }\n\n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u53d6\u5f97\u3059\u308b\n     * @param {string} key\n     * @param {number} ttl\n     */\n    getCache(key, ttl) {\n        if (!this.cache.hasOwnProperty(key)) return null;\n        let item = this.cache[key];\n        if (item.since < moment().unix() - ttl) {\n            this.purgeCache(key);\n            return null;\n        }\n        return item.content;\n    }\n\n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u524a\u9664\u3059\u308b\n     * @param {string} key\n     */\n    purgeCache(key) {\n        if (this.cache.hasOwnProperty(key)) {\n            delete this.cache[key];\n        }\n    }\n\n    /**\n     * \u30d7\u30ec\u30d5\u30a3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u524a\u9664\u3059\u308b\n     * @param {string} prefix\n     */\n    purgeCaches(prefix) {\n        for (var key in this.cache) {\n            if (this.cache.hasOwnProperty(key) && key.lastIndexOf(prefix, 0) === 0) {\n                delete this.cache[key];\n            }\n        }\n    }\n\n    /**\n     * GET \u30ea\u30af\u30a8\u30b9\u30c8\n     * @param {string} url \u30ea\u30af\u30a8\u30b9\u30c8URL\n     * @param {any} [params] \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\n     * @param {string} [cacheKey] \u30ad\u30e3\u30c3\u30b7\u30e5\u4fdd\u5b58\u30ad\u30fc\n     * @param {number} [cacheTtl] \u30ad\u30e3\u30c3\u30b7\u30e5\u6709\u52b9\u79d2\u6570\n     */\n    async get(url, params, cacheKey, cacheTtl = 60) {\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u30c1\u30a7\u30c3\u30af\n        if (cacheKey) {\n            let content = this.getCache(cacheKey, cacheTtl);\n            if (content) return content;\n        }\n\n        // \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u4ed8\u4e0e\n        params = params || {};\n        if (this.token) params._token = this.token;\n        let res = await new Promise((fulfilled, rejected) => {\n            // GET \u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\n            superagent.get(url)\n                .query(params)\n                .end((err, res) => {\n                    if (err) rejected(err);\n                    fulfilled(res.body);\n                });\n        });\n\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u4fdd\u5b58\n        if (cacheKey) {\n            this.saveCache(cacheKey, res);\n        }\n        return res;\n    }\n\n    /**\n     * POST request\n     * @param {string} url \u30ea\u30af\u30a8\u30b9\u30c8URL\n     * @param {Object} [params] \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf(\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf)\n     * @param {NodeList|Node} [files] input[type=\"file\"] \u307e\u305f\u306f\u305d\u306e NodeList\n     */\n    async post(url, params, files) {\n            params = params || {};\n            if (this.token) params._token = this.token;\n            let file_input;\n            let req = superagent.post(url);\n            for (var prop in params) {\n                if (params.hasOwnProperty(prop)) {\n                    req.field(prop, params[prop]);\n                }\n            }\n            // \u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\u306f\u6dfb\u4ed8\u3059\u308b\n            if (files) {\n                if (files.hasOwnProperty(length)) { // when the NodeList\n                    for (var i = 0; i < files.length; i++) {\n                        file_input = files[i];\n                        req.attach(file_input.name, file_input.files[0], file_input.value);\n                    }\n                } else {    // when an Element\n                    file_input = files;\n                    req.attach(file_input.name, file_input.files[0], file_input.value);\n                }\n            }\n            let res = await new Promise((fulfilled, rejected) => {\n                req.end((err, res) => {\n                    if (err) rejected(err);\n                    fulfilled(res.body);\n                });\n            });\n            return res;\n    }\n\n}\n\n\nGET \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3067\u304d\u3066\u3001POST \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5834\u5408\u306f post \u306e\u7b2c\u4e09\u5f15\u6570\u306b <input type=\"file\" name=\"file1\"> \u306e\u3088\u3046\u306a\u5165\u529b\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u6e21\u305b\u3070OK\u3067\u3059\u3002\n\nsrc/main.js(\u521d\u671f\u5316\u4f8b)\nimport {ApiClient, Account} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n\n    let client = aurelia.container.get(ApiClient);\n    // \u521d\u671f\u5316 API \u3092\u547c\u3073\u3001\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u60c5\u5831\u3084\u30c8\u30fc\u30af\u30f3\u306a\u3069\u3092\u53d6\u5f97\u3059\u308b\n    client.get('api/init')\n        .then(res => {\n            let account = aurelia.container.get(Account);\n            account.setData(res.account);\n            client.token = res.token;\n            // \u521d\u671f\u5316\u5f8c\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\n            aurelia.start().then(a => a.setRoot());\n        });\n}\n\n\n\u5b9f\u969b\u306b\u30da\u30fc\u30b8\u3067\u4f7f\u3046\u4f8b\u3067\u3059\u3002\n\nsrc/example1.js(\u4f7f\u7528\u4f8b)\nimport {inject} from 'aurelia-framework'\nimport {ApiClient, Account} from 'services'\n\n@inject(ApiClient, Account)\nexport class Example1 {\n\n    constructor(client, account) {\n        this.client = client;\n        this.account = account;\n    }\n\n    async activate() {\n        // 'articles:all' \u3068\u3044\u3046\u30ad\u30fc\u306710\u5206\u9593\u6709\u52b9\u306a\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\n        let res = await this.client.get('api/getArticles', null, 'articles:all', 600);\n        this.articles = res.articles;\n    }\n\n    purge() {\n        // \u30ad\u30fc\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u6d88\u3059\u4f8b(\u30c7\u30fc\u30bf\u3092\u5909\u66f4\u3057\u305f\u5f8c\u306a\u3069)\n        this.client.purgeCache('articles:all');\n        // \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u6d88\u3059\u4f8b\n        this.client.purgeCaches('articles:');\n    }\n\n}\n\n\n\u4eca\u56de\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\u4eca\u5f8c\u306e\u8a18\u4e8b\u3067\u3082 DI \u306f\u3070\u3093\u3070\u3093\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n# Aurelia Dependency Injection\n\n\u901a\u5e38 DI \u3068\u3044\u3046\u3068\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u306e interface \u306b\u5bfe\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u751f\u6210\u65b9\u6cd5\u306a\u3069\u3092\u4e8b\u524d\u306b\u5b9a\u7fa9\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001Aurelia \u306e\u5834\u5408\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n## @inject()\n\n```js:src/services.js\n// \u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u4f7f\u3046\u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\nexport class SomeService {\n    _count = 0;\n    get count() {\n        return ++this._count;\n    }\n}\n```\n\n\u4f8b\u3048\u3070\u4e0a\u8a18\u306e\u3088\u3046\u306a\u3001\u30ab\u30a6\u30f3\u30bf\u3092\u6301\u3063\u305f\u30b5\u30fc\u30d3\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u307f\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u306b\u306f\u305f\u3060\u2193\u306e\u3088\u3046\u306b inject \u3059\u308b\u3060\u3051\u3067\u3088\u3044\u306e\u3067\u3059\u3002\n\n```js:src/example1.js\nimport {inject} from 'aurelia-framework'\nimport {SomeService} from 'services'\n\n@inject(SomeService)\nexport class Example1 {\n    \n    constructor(someService) {\n        console.log(someService.count); // -> 1\n    }\n    \n}\n```\n\n\u5358\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u304f\u308c\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u3061\u3083\u3093\u3068\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u30b5\u30fc\u30d3\u30b9\u3092\u5225\u306e\u30af\u30e9\u30b9\u3067 inject \u3057\u3066\u30ab\u30a6\u30f3\u30bf\u3092\u53c2\u7167\u3057\u3066\u307f\u308b\u3068\u3001\u6570\u304c\u5897\u3048\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u4e00\u5ea6\u751f\u6210\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f7f\u3044\u307e\u308f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```js:src/example1.js\nimport {inject} from 'aurelia-framework'\nimport {SomeService} from 'services'\n\n@inject(SomeService)\nexport class Example2 {\n    \n    constructor(someService) {\n        console.log(someService.count); // -> 2\n    }\n    \n}\n```\n\n## @transient()\n\n\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u3067\u306f\u306a\u304f\u6bce\u56de\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3057\u3066\u751f\u6210\u3057\u3066\u307b\u3057\u3044\u5834\u5408\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u30af\u30e9\u30b9\u306b `@transient()` \u3068\u3044\u3046\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u3064\u3051\u307e\u3059\u3002\n\n```js:src/services.js\nimport {transient, inject} from 'aurelia-framework'\nimport {HttpClient} from 'aurelia-fetch-client'\nimport {Dep1, Dep2} from 'other-services'\n\n@transient()           // inject \u306e\u305f\u3073\u306b\u65b0\u3057\u3044 SomeService \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u751f\u6210\u3055\u308c\u308b\n@inject(HttpClient, Dep1, Dep2)    // \u3082\u3061\u308d\u3093\u30b5\u30fc\u30d3\u30b9\u306b\u3082 inject \u3067\u304d\u308b\nexport class SomeService {\n\n    constructor(client, dep1, dep2) { // inject \u306b\u66f8\u3044\u305f\u9806\u756a\u306b\u5f15\u6570\u3068\u306a\u308b\n        this.client = client;\n        this.dep1 = dep1;\n        this.dep2 = dep2;\n    }\n    \n    _count = 0;\n    get count() {\n        return ++this._count;\n    }\n}\n```\n\n## \u81ea\u5206\u3067 DI \u30b3\u30f3\u30c6\u30ca\u306b\u7a81\u3063\u8fbc\u3080\u65b9\u6cd5\n\n\u3082\u3061\u308d\u3093\u81ea\u524d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b main.js \u306a\u3069\u306e\u521d\u671f\u8a2d\u5b9a\u90e8\u5206\u3067\u884c\u3044\u307e\u3059\u3002\n\n```js:src/main.js\nimport {SomeService} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n        \n    // \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n    let someService = new SomeService();\n    // DI \u306b\u767b\u9332\u3059\u308b\n    aurelia.container.registerInstance(SomeService, someService);\n    \n    aurelia.start().then(a => a.setRoot());\n}\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b `aurelia.container.registerInstance` \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u81ea\u524d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057 SomeService \u81ea\u4f53\u304c\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b (= inject \u3055\u308c\u308b) \u5834\u5408\u3001\u81ea\u5206\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u305d\u308c\u3067\u3082\u521d\u671f\u8a2d\u5b9a\u306e\u6642\u70b9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u4e00\u5ea6\u30b3\u30f3\u30c6\u30ca\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u3082\u3089\u3046\u3068\u3044\u3046\u624b\u304c\u3042\u308a\u307e\u3059\u3002\n\n```js:src/main.js\nimport {SomeService} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n        \n    // \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210 ...\u767b\u9332\u3057\u306a\u304f\u3066\u3082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3067\u304d\u308b\u5229\u70b9\n    let someService = aurelia.container.get(SomeService);\n    // \u30c7\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u306a\u3069\n    someService._count = 100;\n    \n    aurelia.start().then(a => a.setRoot());\n}\n```\n\n\u3042\u3068\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u304c\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u4f9d\u5b58\u3059\u308b\u3068\u306a\u3063\u305f\u5834\u5408\u306b\u4fee\u6b63\u304c\u5927\u5909\u306a\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u306f\u6700\u521d\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u306b\u4efb\u305b\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u306d\u3002\n\n# \u81ea\u4f5c API \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n\n[\u524d\u56de](http://qiita.com/sukobuto/items/3892635e0caea19a2402) \u5ba3\u8a00\u3057\u305f\u3068\u304a\u308a\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u3092\u6301\u3063\u305f ApiClient \u30af\u30e9\u30b9\u3092\u81ea\u4f5c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u524d\u56de\u4f7f\u7528\u3057\u305f SuperAgent \u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u3001jspm \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u6709\u52b9\u671f\u9650\u7ba1\u7406\u306e\u305f\u3081\u306b [moment.js](http://momentjs.com/) \u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```shell-session:moment.js\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[you@server aurelia-skeleton-navigation]$ jspm install npm:moment\n```\n\n```js:src/services.js\nimport superagent from 'superagent'\nimport moment from 'moment'\n\nexport class ApiClient {\n    \n    token;      // \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c8\u30fc\u30af\u30f3\n    cache = {}; // \u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30fc\u30bf\u683c\u7d0d\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n    \n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4fdd\u5b58\u3059\u308b\n     * @param {string} key\n     * @param {any} content\n     */\n    saveCache(key, content) {\n        this.cache[key] = {\n            content,\n            since: moment().unix()\n        };\n        return this;\n    }\n    \n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u53d6\u5f97\u3059\u308b\n     * @param {string} key\n     * @param {number} ttl\n     */\n    getCache(key, ttl) {\n        if (!this.cache.hasOwnProperty(key)) return null;\n        let item = this.cache[key];\n        if (item.since < moment().unix() - ttl) {\n            this.purgeCache(key);\n            return null;\n        }\n        return item.content;\n    }\n    \n    /**\n     * \u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u524a\u9664\u3059\u308b\n     * @param {string} key\n     */\n    purgeCache(key) {\n        if (this.cache.hasOwnProperty(key)) {\n            delete this.cache[key];\n        }\n    }\n    \n    /**\n     * \u30d7\u30ec\u30d5\u30a3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u524a\u9664\u3059\u308b\n     * @param {string} prefix\n     */\n    purgeCaches(prefix) {\n        for (var key in this.cache) {\n            if (this.cache.hasOwnProperty(key) && key.lastIndexOf(prefix, 0) === 0) {\n                delete this.cache[key];\n            }\n        }\n    }\n    \n    /**\n     * GET \u30ea\u30af\u30a8\u30b9\u30c8\n     * @param {string} url \u30ea\u30af\u30a8\u30b9\u30c8URL\n     * @param {any} [params] \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\n     * @param {string} [cacheKey] \u30ad\u30e3\u30c3\u30b7\u30e5\u4fdd\u5b58\u30ad\u30fc\n     * @param {number} [cacheTtl] \u30ad\u30e3\u30c3\u30b7\u30e5\u6709\u52b9\u79d2\u6570\n     */\n    async get(url, params, cacheKey, cacheTtl = 60) {\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u30c1\u30a7\u30c3\u30af\n        if (cacheKey) {\n            let content = this.getCache(cacheKey, cacheTtl);\n            if (content) return content;\n        }\n        \n        // \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308b\u5834\u5408\u306f\u4ed8\u4e0e\n        params = params || {};\n        if (this.token) params._token = this.token;\n        let res = await new Promise((fulfilled, rejected) => {\n            // GET \u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\n            superagent.get(url)\n                .query(params)\n                .end((err, res) => {\n                    if (err) rejected(err);\n                    fulfilled(res.body);\n                });\n        });\n        \n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u4fdd\u5b58\n        if (cacheKey) {\n            this.saveCache(cacheKey, res);\n        }\n        return res;\n    }\n    \n\t/**\n\t * POST request\n\t * @param {string} url \u30ea\u30af\u30a8\u30b9\u30c8URL\n\t * @param {Object} [params] \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf(\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf)\n\t * @param {NodeList|Node} [files] input[type=\"file\"] \u307e\u305f\u306f\u305d\u306e NodeList\n\t */\n    async post(url, params, files) {\n\t\t\tparams = params || {};\n\t\t\tif (this.token) params._token = this.token;\n\t\t\tlet file_input;\n\t\t\tlet req = superagent.post(url);\n\t\t\tfor (var prop in params) {\n\t\t\t\tif (params.hasOwnProperty(prop)) {\n\t\t\t\t\treq.field(prop, params[prop]);\n\t\t\t\t}\n\t\t\t}\n            // \u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\u306f\u6dfb\u4ed8\u3059\u308b\n\t\t\tif (files) {\n\t\t\t\tif (files.hasOwnProperty(length)) {\t// when the NodeList\n\t\t\t\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\t\t\t\tfile_input = files[i];\n\t\t\t\t\t\treq.attach(file_input.name, file_input.files[0], file_input.value);\n\t\t\t\t\t}\n\t\t\t\t} else {\t// when an Element\n\t\t\t\t\tfile_input = files;\n\t\t\t\t\treq.attach(file_input.name, file_input.files[0], file_input.value);\n\t\t\t\t}\n\t\t\t}\n            let res = await new Promise((fulfilled, rejected) => {\n                req.end((err, res) => {\n                    if (err) rejected(err);\n                    fulfilled(res.body);\n                });\n            });\n            return res;\n    }\n    \n}\n```\n\nGET \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3067\u304d\u3066\u3001POST \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5834\u5408\u306f `post` \u306e\u7b2c\u4e09\u5f15\u6570\u306b `<input type=\"file\" name=\"file1\">` \u306e\u3088\u3046\u306a\u5165\u529b\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u6e21\u305b\u3070OK\u3067\u3059\u3002\n\n```js:src/main.js(\u521d\u671f\u5316\u4f8b)\nimport {ApiClient, Account} from 'services'\n\nexport function configure(aurelia) {\n    // \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\u90e8\u5206\n    aurelia.use\n        .standardConfiguration()\n        .developmentLogging()\n        .feature('resources');\n        \n    let client = aurelia.container.get(ApiClient);\n    // \u521d\u671f\u5316 API \u3092\u547c\u3073\u3001\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u60c5\u5831\u3084\u30c8\u30fc\u30af\u30f3\u306a\u3069\u3092\u53d6\u5f97\u3059\u308b\n    client.get('api/init')\n        .then(res => {\n            let account = aurelia.container.get(Account);\n            account.setData(res.account);\n            client.token = res.token;\n            // \u521d\u671f\u5316\u5f8c\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\n            aurelia.start().then(a => a.setRoot());\n        });\n}\n```\n\n\u5b9f\u969b\u306b\u30da\u30fc\u30b8\u3067\u4f7f\u3046\u4f8b\u3067\u3059\u3002\n\n```js:src/example1.js(\u4f7f\u7528\u4f8b)\nimport {inject} from 'aurelia-framework'\nimport {ApiClient, Account} from 'services'\n\n@inject(ApiClient, Account)\nexport class Example1 {\n\n    constructor(client, account) {\n        this.client = client;\n        this.account = account;\n    }\n    \n    async activate() {\n        // 'articles:all' \u3068\u3044\u3046\u30ad\u30fc\u306710\u5206\u9593\u6709\u52b9\u306a\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\n        let res = await this.client.get('api/getArticles', null, 'articles:all', 600);\n        this.articles = res.articles;\n    }\n    \n    purge() {\n        // \u30ad\u30fc\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u6d88\u3059\u4f8b(\u30c7\u30fc\u30bf\u3092\u5909\u66f4\u3057\u305f\u5f8c\u306a\u3069)\n        this.client.purgeCache('articles:all');\n        // \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u6d88\u3059\u4f8b\n        this.client.purgeCaches('articles:');\n    }\n\n}\n```\n\n\u4eca\u56de\u306f\u3053\u3053\u307e\u3067\u3067\u3059\u3002\n\u4eca\u5f8c\u306e\u8a18\u4e8b\u3067\u3082 DI \u306f\u3070\u3093\u3070\u3093\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n"}