{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\u6761\u4ef6\n\n1. S3 Bucket\u306e\u524a\u9664\n\n1.1. \u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\n\u30d0\u30b1\u30c3\u30c8\u540d\u3092\u78ba\u8a8d\n\ncommnad\ncat << ETX\n\n        S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n\nETX\n\n\n\nresult\n\n        S3_BUCKET_NAME: jaws-ug-cli-17-handson\n\n\n\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n\ncommnad\naws s3 rm s3://${S3_BUCKET_NAME}/ --recursive\n\n\n\nresult\ndelete: s3://jaws-ug-cli-17-handson/test01.txt\ndelete: s3://jaws-ug-cli-17-handson/test03.txt\ndelete: s3://jaws-ug-cli-17-handson/test02.txt\n\n\n\n1.2. Bucket\u306e\u524a\u9664\n\ncommnad\naws s3 rb s3://${S3_BUCKET_NAME}\n\n\n\nresult\nremove_bucket: s3://jaws-ug-cli-17-handson/\n\n\n\u30d0\u30b1\u30c3\u30c8\u304c\u524a\u9664\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\ncommnad\naws s3 ls s3://${S3_BUCKET_NAME}/\n\n\n\nresult\nA client error (NoSuchBucket) occurred when calling the ListObjects operation: The specified bucket does not exist\n\n\n\n2. Managed Policy\u306e\u524a\u9664\n\n2.1. Managed Policy\u306eDetach\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\ncommnad\ncat << ETX\n        IAM_GROUP_NAME: ${IAM_GROUP_NAME}\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\nETX\n\n\n\nresult\n        IAM_GROUP_NAME: IAM_limited\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n\n\nManaged Policy\u3092\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u30c7\u30bf\u30c3\u30c1\n\ncommnad\naws iam detach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u30c7\u30bf\u30c3\u30c1\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\ncommnad\naws iam list-attached-group-policies --group-name ${IAM_GROUP_NAME}\n\n\n\nresult\n{\n    \"AttachedPolicies\": [],\n    \"IsTruncated\": false\n}\n\n\n\n2.2. Managed Policy\u306e\u524a\u9664\nManaged Policy\u3092\u524a\u9664\u3059\u308b\u969b\u3001Default Version\u4ee5\u5916\u3092\u4e8b\u524d\u306b\u524a\u9664\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30dd\u30ea\u30b7\u30fc\u304c\u4fdd\u6301\u3057\u3066\u3044\u308bVersion\u3092\u78ba\u8a8d\n\ncommnad\naws iam list-policy-versions --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\ncommnad\n{\n    \"IsTruncated\": false,\n    \"Versions\": [\n        {\n            \"CreateDate\": \"2015-03-28T13:29:42Z\",\n            \"VersionId\": \"v6\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:29:39Z\",\n            \"VersionId\": \"v5\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:29:33Z\",\n            \"VersionId\": \"v4\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:06:44Z\",\n            \"VersionId\": \"v2\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T12:22:45Z\",\n            \"VersionId\": \"v1\",\n            \"IsDefaultVersion\": true\n        }\n    ]\n}\n\n\nDefault Version\u4ee5\u5916\u3092\u3059\u3079\u3066\u524a\u9664\n\uff08Default Version\u3092\u9664\u304f\u3059\u3079\u3066\u306eVersion\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\uff08\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u3001\u5b9f\u969b\u306b\u4fdd\u6301\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u6570\u306b\u5fdc\u3058\u3066\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\ncommnad\naws iam delete-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v2\"\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6012\u3089\u308c\u307e\u3059\u3002\n\ncommnad\naws iam delete-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v1\"\n\n\n\nresult\nA client error (DeleteConflict) occurred when calling the DeletePolicyVersion operation: Cannot delete the default version of a policy.\n\n\n\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664\n\ncommnad\naws iam delete-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n\n\n\n2.3. \u78ba\u8a8d\n\ncommnad\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n\n\n\nresult\nA client error (NoSuchEntity) occurred when calling the GetPolicy operation: Policy arn:aws:iam::************:policy/S3_ManagedPolicy does not exist.\n\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n# \u524d\u63d0\u6761\u4ef6\n\n\n# 1. S3 Bucket\u306e\u524a\u9664\n\n## 1.1. \u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\n\n\u30d0\u30b1\u30c3\u30c8\u540d\u3092\u78ba\u8a8d\n\n```bash:commnad\ncat << ETX\n\n        S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n\nETX\n```\n\n```text:result\n\n        S3_BUCKET_NAME: jaws-ug-cli-17-handson\n```\n\n\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n\n```bash:commnad\naws s3 rm s3://${S3_BUCKET_NAME}/ --recursive\n```\n\n```text:result\ndelete: s3://jaws-ug-cli-17-handson/test01.txt\ndelete: s3://jaws-ug-cli-17-handson/test03.txt\ndelete: s3://jaws-ug-cli-17-handson/test02.txt\n```\n\n## 1.2. Bucket\u306e\u524a\u9664\n\n```bash:commnad\naws s3 rb s3://${S3_BUCKET_NAME}\n```\n\n```text:result\nremove_bucket: s3://jaws-ug-cli-17-handson/\n```\n\n\u30d0\u30b1\u30c3\u30c8\u304c\u524a\u9664\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:commnad\naws s3 ls s3://${S3_BUCKET_NAME}/\n```\n\n```text:result\nA client error (NoSuchBucket) occurred when calling the ListObjects operation: The specified bucket does not exist\n```\n\n# 2. Managed Policy\u306e\u524a\u9664\n\n## 2.1. Managed Policy\u306eDetach\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:commnad\ncat << ETX\n        IAM_GROUP_NAME: ${IAM_GROUP_NAME}\n        IAM_MANAGED_POLICY_ARN: ${IAM_MANAGED_POLICY_ARN}\nETX\n```\n\n```text:result\n        IAM_GROUP_NAME: IAM_limited\n        IAM_MANAGED_POLICY_ARN: arn:aws:iam::************:policy/jawsug-cli/S3_ManagedPolicy\n```\n\n\nManaged Policy\u3092\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u30c7\u30bf\u30c3\u30c1\n\n```bash:commnad\naws iam detach-group-policy --group-name ${IAM_GROUP_NAME} --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u30c7\u30bf\u30c3\u30c1\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:commnad\naws iam list-attached-group-policies --group-name ${IAM_GROUP_NAME}\n```\n\n```text:result\n{\n    \"AttachedPolicies\": [],\n    \"IsTruncated\": false\n}\n```\n\n## 2.2. Managed Policy\u306e\u524a\u9664\n\nManaged Policy\u3092\u524a\u9664\u3059\u308b\u969b\u3001Default Version\u4ee5\u5916\u3092\u4e8b\u524d\u306b\u524a\u9664\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30dd\u30ea\u30b7\u30fc\u304c\u4fdd\u6301\u3057\u3066\u3044\u308bVersion\u3092\u78ba\u8a8d\n\n```bash:commnad\naws iam list-policy-versions --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:commnad\n{\n    \"IsTruncated\": false,\n    \"Versions\": [\n        {\n            \"CreateDate\": \"2015-03-28T13:29:42Z\",\n            \"VersionId\": \"v6\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:29:39Z\",\n            \"VersionId\": \"v5\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:29:33Z\",\n            \"VersionId\": \"v4\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T13:06:44Z\",\n            \"VersionId\": \"v2\",\n            \"IsDefaultVersion\": false\n        },\n        {\n            \"CreateDate\": \"2015-03-28T12:22:45Z\",\n            \"VersionId\": \"v1\",\n            \"IsDefaultVersion\": true\n        }\n    ]\n}\n```\n\nDefault Version\u4ee5\u5916\u3092\u3059\u3079\u3066\u524a\u9664\n\uff08Default Version\u3092\u9664\u304f\u3059\u3079\u3066\u306eVersion\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\uff08\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u3001\u5b9f\u969b\u306b\u4fdd\u6301\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u6570\u306b\u5fdc\u3058\u3066\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\n```bash:commnad\naws iam delete-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v2\"\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u524a\u9664\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6012\u3089\u308c\u307e\u3059\u3002\n\n```bash:commnad\naws iam delete-policy-version --policy-arn ${IAM_MANAGED_POLICY_ARN} --version-id \"v1\"\n```\n\n```text:result\nA client error (DeleteConflict) occurred when calling the DeletePolicyVersion operation: Cannot delete the default version of a policy.\n```\n\n\u30dd\u30ea\u30b7\u30fc\u3092\u524a\u9664\n\n```bash:commnad\naws iam delete-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\n\uff08\u623b\u308a\u5024\u306a\u3057\uff09\n```\n\n## 2.3. \u78ba\u8a8d\n\n```bash:commnad\naws iam get-policy --policy-arn ${IAM_MANAGED_POLICY_ARN}\n```\n\n```text:result\nA client error (NoSuchEntity) occurred when calling the GetPolicy operation: Policy arn:aws:iam::************:policy/S3_ManagedPolicy does not exist.\n```\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n", "tags": ["aws-cli"]}