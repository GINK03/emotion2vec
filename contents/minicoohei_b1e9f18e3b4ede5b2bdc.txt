{"tags": ["Django", "scikit-learn", ",", "\u3055\u304f\u3089VPS", ",pyhton"], "context": "\n\n\u3055\u304f\u3089\u306eVPS\u3068Django\u3068scikit-learn\u3092\u4f7f\u3063\u3066\u3001\u6c17\u306b\u306a\u308b\u9854\u753b\u50cf\u3068\u985e\u4f3c\u3057\u305fAV\u5973\u512a\u304c\u51fa\u3066\u308bAV\u306e\u985e\u4f3c\u753b\u50cf\u691c\u7d22\u3067\u304d\u308b\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u3092\u4f5c\u3063\u305f\u3002\n\n\u30b5\u30a4\u30c8\u540d\u306f\u305d\u3063\u304f\u308a\u30ca\u30d3\n\u4eca\u307e\u3067\u30a2\u30d7\u30ea\u306e\u958b\u767a\u3092\u3057\u3066\u3044\u305f\u306e\u3067unity\u3068\u304bopen-GL\u3068\u304bObjective-C\u306f\u4f7f\u3063\u305f\u3053\u3068\u3042\u3063\u305f\u306e\u3060\u3051\u3069\u3001python\u3084\u6a5f\u68b0\u5b66\u7fd2\u306e\u52c9\u5f37\u3068\u5b9f\u76ca\u3082\u304b\u306d\u3066\u30011\u304b\u3089\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u3063\u305f\u5c65\u6b74\u3092\u8a18\u9332\u3057\u307e\u3059\u3002\n\u521d\u5fc3\u8005\u304c\u306f\u307e\u308b\u30dd\u30a4\u30f3\u30c8\u306f\u5168\u90e8\u306f\u307e\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u521d\u5fc3\u8005\u306e\u4eba\u305f\u3061\u306b\u306f\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306bSIFT\u3068\u304bCNN\u3068\u304b\u4f7f\u308f\u306a\u304b\u3063\u305f\u306e\u306f\u3001BOVW\u7684\u306a\u3084\u3064\u306e\u7cbe\u5ea6\u304c\u4f4e\u304b\u3063\u305f\u308a\u3001\u6b21\u5143\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u8a08\u7b97\u91cf\u304c\u5897\u3048\u3061\u3083\u3063\u305f\u304b\u3089\u3067\u3059\u3002CNN\u3084\u308b\u306a\u3089\u52d5\u753b\u304b\u3089\u753b\u50cf\u62bd\u51fa\u3068\u304b\u3057\u306a\u3044\u3068\u30b5\u30f3\u30d7\u30eb\u6570\u8db3\u308a\u306a\u3044\u611f\u3058\u306b\u306a\u3063\u3061\u3083\u3063\u3066\u8ca7\u5f31\u306a\u30de\u30b7\u30f3\u3060\u3063\u305f\u306e\u3067\u8ae6\u3081\u307e\u3057\u305f\u3002\n\u5143\u30cd\u30bf\uff1aAV\u753b\u50cf\u8a8d\u8b58\u6280\u8853\u3068\u305d\u306e\u5468\u8fba \u3000\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059!\n\n\u76ee\u6b21\n\n------------\u30ed\u30fc\u30ab\u30eb\u5074\u4f5c\u696d----------------\n\n\u3010\uff11\u3011DMM\u304b\u3089AV\u5973\u512a\u306e\u9854\u753b\u50cf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3002\n\u3010\uff12\u3011opencv\u3067\u9854\u753b\u50cf\u62bd\u51fa\u3001\u9854\u753b\u50cf\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\n\u3010\uff13\u3011pca\u3068kmeans\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u4e0e\u3048\u305f\u9854\u753b\u50cf\u3092\u5206\u985e\u3059\u308b\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n\u3010\uff14\u3011django\u3092\u4f7f\u3063\u3066\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\n\u3010\uff15\u3011\u30af\u30e9\u30a6\u30c9\u30ef\u30fc\u30af\u30b9\u3067html\u3068\u30c7\u30b6\u30a4\u30f3\u4f5c\u3063\u3066\u3082\u3089\u3046\n\u3010\uff16\u3011CropperJS\u3092\u4f7f\u3063\u3066\u3001\u9854\u753b\u50cf\u3092\u5207\u308a\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\n\n------------\u30b5\u30fc\u30d0\u30fc\u5074\u4f5c\u696d----------------\n\n\u3010\uff17\u3011\u3055\u304f\u3089vps\u306bopencv\u3001virtualenv\u3001mod_wsgi\u3001scikit-learn,django\u7b49\u3005\u306e\u74b0\u5883\u69cb\u7bc9\u3059\u308b\n\u3010\uff18\u3011mod_wsgi\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3001\u3055\u304f\u3089VPS\u306bdjango\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\u3010\uff19\u3011\u3055\u304f\u3089VPS\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\n\n\n\u3010\uff11\u3011DMM\u304b\u3089AV\u5973\u512a\u306e\u9854\u753b\u50cf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3002\n\u30af\u30ed\u30fc\u30eb\u306b\u4f7f\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3042\u3052\u306a\u3044\u306e\u304c\u4e16\u306e\u5e38\u3063\u307d\u3044\u306e\u3067\u30b3\u30fc\u30c9\u306f\u6652\u3055\u306a\u3044\u3051\u3069\u3001\npython\u3068BeautifulSoup4\u3092\u4f7f\u3063\u305f\u3002\nPython\u3068Beautiful Soup\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3092\u898b\u308c\u3070\u3001\u4ee3\u3005\u89e3\u6c7a\u3059\u308b\u306e\u3067\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3010\uff12\u3011opencv\u3067\u9854\u753b\u50cf\u62bd\u51fa\u3001\u9854\u753b\u50cf\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\nopencv\u81ea\u4f53\u306f\u30d3\u30eb\u30c9\u3059\u308b\u3068\u5927\u5909\u306a\u306e\u3060\u3051\u3069\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u3084Mac\u3068\u304b\u3067\u3084\u308b\u5206\u306b\u306fanaconda\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\npip install anaconda\nconda install -c https://conda.binstar.org/jjhelmus opencv\n\u306e\u4e8c\u3064\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3060\u3051\u3067\u5229\u7528\u53ef\u80fd\u3002\u7c21\u5358\u3002\n\u3053\u306e\u8fba\u304c\u53c2\u8003\u306b\u306a\u308b\nPython(Anaconda)\u3068OpenCV\u3092\u4f7f\u3063\u3066\u52d5\u753b\u304b\u3089\u9854\u753b\u50cf\u3092\u62bd\u51fa\u3057\u3066\u307f\u308b\nOpenCV\u3067\u9854\u8a8d\u8b58\u3092\u884c\u3044\u3001\u9854\u306e\u90e8\u5206\u3060\u3051\u30c8\u30ea\u30df\u30f3\u30b0\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3010Python\u3011\n# -*- coding:utf-8 -*-\nimport cv2\nimport sys\nimport os\nimport shutil\n\nimage_path = \"image.png\"#\u4efb\u610f\u306e\u753b\u50cf\u30d1\u30b9\n\n#\u30ab\u30b9\u30b1\u30fc\u30c9\u5206\u985e\u5668\u306e\u7279\u5fb4\u91cf\u3092\u53d6\u5f97\u3059\u308b\nface_cascade = cv2.CascadeClassifier('[yourdir]/opencv/data/haarcascades/haarcascade_frontalface_default.xml')\n\n#\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\nimage = cv2.imread(image_path)#\u4efb\u610f\u306e\u753b\u50cf\u30d1\u30b9\n\n#\u30b0\u30ec\u30fc\u30b9\u30b1\u30fc\u30eb\u5909\u63db\nimage_gray = cv2.cvtColor(image, cv2.cv.CV_BGR2GRAY)\n\n\n#\u7269\u4f53\u8a8d\u8b58\uff08\u9854\u8a8d\u8b58\uff09\u306e\u5b9f\u884c\nfaces = cascade.detectMultiScale(image_gray, scaleFactor=1.2, minNeighbors=2, minSize=(10, 10))\n\n\n#\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nif len(faces) > 0:\n    path = os.path.splitext(image_path)\n    dir_path = path[0] + '_face'\n    if os.path.isdir(dir_path):\n        shutil.rmtree(dir_path)\n    os.mkdir(dir_path)\n\ni = 0;\nfor rect in faces:\n    #\u9854\u3060\u3051\u5207\u308a\u51fa\u3057\u3066\u4fdd\u5b58\n    x = rect[0]\n    y = rect[1]\n    width = rect[2]\n    height = rect[3]\n    dst = image[y:y+height, x:x+width]\n    new_image_path = dir_path + '/' + str(i) + path[1];\n    cv2.imwrite(new_image_path, dst)#\u3053\u3053\u3067\u5207\u308a\u53d6\u3063\u305f\u753b\u50cf\u3092\u4fdd\u5b58\u3059\u308b\u30d1\u30b9\u3092\u5165\u308c\u308b\n    i += 1\n\n\n\n\u9854\u753b\u50cf\u3092\u62bd\u51fa\u3057\u305f\u3089\u3001\u7d9a\u3044\u3066HOG\u7279\u5fb4\u91cf(Histograms of Oriented Gradients)\u3092\u62bd\u51fa\u3059\u308b\nHOG\u7279\u5fb4\u91cf\u306b\u3064\u3044\u3066\u53c2\u8003\uff1a\n\u753b\u50cf\u304b\u3089HOG\u7279\u5fb4\u91cf\u306e\u62bd\u51fa\n\u3081\u3063\u3061\u3083\u30b7\u30f3\u30d7\u30eb\u3067\nhog=cv2.HOGDescriptor()\nimg=cv2.imread('test.jpg')\nres=hog.compute(img)\n\n\u3068\u3059\u308b\u3060\u3051\u3002\u3053\u308c\u3067\u753b\u50cf\u306e\u5206\u6563\u8868\u73fe\u304c\u53d6\u308c\u308b\u3002\n\n\u3010\uff13\u3011pca\u3068kmeans\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u4e0e\u3048\u305f\u9854\u753b\u50cf\u3092\u5206\u985e\u3059\u308b\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n\u305f\u3060\u3001HOG\u7279\u5fb4\u91cf\u306e\u554f\u984c\u70b9\u3068\u3057\u3066\u3001\u6b21\u5143\u306e\u546a\u3044\u304c\u3042\u308b\u3002\n\u666e\u901a\u306b\uff13\uff10\u4e07\u679a\u8fd1\u3044\u753b\u50cf\u3068\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u3067\u985e\u4f3c\u5ea6\u8a08\u7b97\u3057\u3066\u8fd4\u305d\u3046\u3068\u3059\u308b\u306a\u3089\u8a08\u7b97\u91cf\u7684\u306b\u7121\u7406\u306a\u306e\u3067\u3001\u6b21\u5143\u5727\u7e2e(PCA)\u3068PCA\u3057\u305f\u7d50\u679c\u3092\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0(kmeans\uff09\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u307e\u305a\u5168\u753b\u50cf\u306b\u3064\u3044\u3066\u5206\u6563\u8868\u73fe\u3092\u5f97\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\n\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u3063\u3066\u3001\u753b\u50cf\u3092\u30d5\u30a9\u30eb\u30c0\u5358\u4f4d\u3067\u4e00\u62ec\u3067\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u305f\u3002\nfrom PIL import Image\nimport os\nimport cv2\nfrom sklearn.cluster import KMeans\nimport numpy as np\nimport random\nimport pickle\nimport re\nimport sklearn\nimport dill\n\n\n\nclass Imageob(object):\n    def __init__(self):\n        pass\n\n    def fileread(self, filepath):\n        self.path = filepath\n        try:\n            temp = cv2.imread(filepath)\n            self.src = cv2.resize(temp,(64,64))\n            self.shape = temp.shape\n\n        except cv2.error as e:\n            pass\n\n    def readArray(self, array):\n        self.srcGrey = array\n\n\nclass Images(object):\n    def __init__(self):\n        self.images = []\n\n    def addImage(self, image):\n        self.images.append(image)\n\n    def readAllFiles(self, folderpath, isResize=False, height=256, width=256):\n\n        for path in self.readAllFilePath(folderpath):\n            p = path.replace(folderpath, \"\")\n            p = p.split(\"/\")\n            m= m+1\n\n            image = Imageob()\n            image.fileread(path)\n\n            if image.shape[0] > 50:\u3000#\u5c0f\u3055\u3059\u304e\u308b\u753b\u50cf\u3092\u524a\u9664\n                pi = ProcessImage()\n                image = pi.resize(image, 64, 64)\n                self.addImage(image)\n                n = n+1\n\n\n    def readAllFilePath(self, folderpath):\n        for root, dirs, files in os.walk(folderpath):\n            for file in files:\n                if not file.startswith(\".\") and file.endswith(\".jpg\"):\n                    yield os.path.join(root, file)\n\n#\u3053\u3053\u304b\u3089HOG\u7279\u5fb4\u91cf\u3092\u62bd\u51fa\u3059\u308b\n\nimages = Images()\nprint(\"\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\u3092\u958b\u59cb\u3057\u307e\u3059\")\n\nimages.readAllFiles(\"/image_path\")#\u9854\u753b\u50cf\u304c\u5165\u3063\u3066\u3044\u308b\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\n\ndata = []\nlabel = []\nnum = 0\n\nfor image in images.images:\n    hog = cv2.HOGDescriptor((64, 64), (16, 16), (8, 8), (8, 8), 9)\n    img_ = cv2.imread(image.path)\n    img_ = cv2.resize(img_,(64,64))\n    try:\n        hist = hog.compute(img_)\n        k = [] #numpy\u306b\u3059\u308b\u3088\u3046\u306b\u30ea\u30b9\u30c8\u8868\u73fe\u306b\u3059\u308b\u3002\n        if hist is not None:\n            for i in hist:\n                k.append(i[0])\n        else:\n            print(\"hist is NONE\")\n\n        data.append(k)\n\n    except cv2.error as e:\n        pass\n\n\nnpdata = np.array(data)\u3000# scikit-learn\u3067\u4f7f\u3048\u308b\u3088\u3046\u306bnp.array\u5f62\u5f0f\u306b\u3059\u308b\n\npca = sklearn.decomposition.PCA(100)\npca.fit(npdata)\n\nX_pca= pca.transform(npdata)\n\na =[] # \u4e0a\u8a18\u3067\u4f5c\u3089\u308c\u305f\u30ea\u30b9\u30c8\u5f62\u5f0f\u3067\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u5165\u308c\u308b\n\nfor x in X_pca:\n   a.append(x)\n\nkmeans_model  = KMeans(n_clusters=10, random_state=10).fit(a)\nlabels = kmeans_model.labels_\n\n\n\n\u3053\u308c\u3067PCA\u306e\u30e2\u30c7\u30eb\u3068Kmeans\u306e\u30e2\u30c7\u30eb\u304c\u3067\u304d\u305f\u3002\n\u50d5\u307f\u305f\u3044\u306b\u304d\u3063\u305f\u306a\u3044\u30af\u30e9\u30b9\u3092\u4f5c\u3063\u305f\u308a\u3057\u3066\u3001\u5b50\u8981\u7d20\u3092\u6301\u3064\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3068\u3001\nPython\u306epickle\u3067serialize\u3067\u304d\u306a\u3044\u554f\u984c\u304c\u8d77\u3053\u308b\u306e\u3067\u3001\ndill\u3067\u4fdd\u5b58\u3059\u308b\u3068\u91cd\u304f\u3082\u306a\u3044\u3057\u3001\u6c38\u7d9a\u5316\u3055\u308c\u308b\u306e\u3067\u30aa\u30b9\u30b9\u30e1\u3002\nPython\u306epickle\u3067serialize\u3067\u304d\u306a\u3044\u554f\u984c\u306e\u56de\u907f\u7b56\n\u3042\u3068\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u3070\u3001\u753b\u50cf\u30d1\u30b9\u3092\u4e0e\u3048\u3066\u3001COS\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3067\u304d\u308b\n\ndef cos_sim(v1, v2):\n    return np.dot(v1, v2) / (np.linalg.norm(v1) * np.linalg.norm(v2))\n\nclass Hog(object):\n    def __init__(self):\n        pass\n\n    def hog(self, path):\n        hog = cv2.HOGDescriptor((64, 64), (16, 16), (8, 8), (8, 8), 9)\n        img = cv2.imread(path)\n        img = cv2.resize(img , (64, 64))\n\n        t = []\n        try:\n            hist = hog.compute(img)\n            k = []\n            if hist is not None:\n                for i in hist:\n                    k.append(i[0])\n            else:\n                print(\"hist is NONE\")\n            t.append(k)\n\n        except cv2.error as e:\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000print('cv2_error')\n        return t\n\n\n\n\u753b\u50cf\u3092\u4e0e\u3048\u305f\u3089HOG\u7279\u5fb4\u91cf\u53d6\u3063\u3066\u3001\u4e3b\u6210\u5206\u5206\u6790\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u305d\u308c\u3092\u5143\u306bKmeasn\u306e\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u6240\u5c5e\u3059\u308b\u30af\u30e9\u30b9\u30bf\u3092\u63a8\u5b9a\u3057\u3066\u3001\u305d\u306e\u30af\u30e9\u30b9\u30bf\u5185\u306e\u5168\u753b\u50cf\u3068\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\u306f\u4e0b\u8a18\u3002(\u3053\u3061\u3089\u306e\u65b9\u304c\u306e\u65b9\u304c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u78ba\u5b9f\u306b\u7dba\u9e97\u3067\u3059\u3002)\n\u30a2\u30cb\u30e1\u306e\u9854\u5199\u771f\u3092Bag of Keywords\u3067\u5206\u985e\u3057\u3066\u307f\u305f\n\u203b\u6ce8\uff1aSIFT\u306f\u73fe\u5728\u660e\u308b\u304f\u66f8\u3044\u3066\u3082\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001KAZE,AKAZE\u3092\u304a\u4f7f\u3044\u304f\u3060\u3055\u3044\u3002\nKAZE\u3068\u304b\u306e\u4f7f\u3044\u65b9\nOpenCV3.0.0-dev+Python2.7.6\u3067\u7279\u5fb4\u91cf(ORB/AKAZE/KAZE/FAST/BRISK)\u306e\u8a08\u6e2c\n\n\u3010\uff14\u3011django\u3092\u4f7f\u3063\u3066\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u3042\u3068\u306f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u307f\u305f\u3044\u306a\u7269\n\u3053\u3053\u3092\u898b\u3066\u4f5c\u3063\u305f\u3002\nPython Django\u5165\u9580\n\n\u3010\uff15\u3011\u30af\u30e9\u30a6\u30c9\u30ef\u30fc\u30af\u30b9\u3067html\u3068\u30c7\u30b6\u30a4\u30f3\u4f5c\u3063\u3066\u3082\u3089\u3046\n\u6b63\u76f4\u30c7\u30b6\u30a4\u30f3\u3068\u30de\u30fc\u30af\u30a2\u30c3\u30d7\u304c\u4e00\u756a\u5411\u3044\u3066\u3044\u306a\u3044\u4f5c\u696d\u306a\u306e\u3067\u3001\u5916\u6ce8\u3057\u305f\u3002\n\u3053\u3093\u306a\u611f\u3058\u3002\u3061\u306a\u307f\u306b\u6295\u8cc7\u306f\u5168\u304f\u56de\u53ce\u3067\u304d\u3066\u306a\u3044\u3002\u56de\u53ce\u306e\u76ee\u51e6\u3082\u306a\u3044\u3002\n\u7537\u306e\u30ed\u30de\u30f3\u304c\u3064\u307e\u3063\u305f\u300c\u305d\u3063\u304f\u308a\u30ca\u30d3!!\u300d \u306e\u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3/\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0 \n\n\u3010\uff16\u3011CropperJS\u3092\u4f7f\u3063\u3066\u3001\u9854\u753b\u50cf\u3092\u5207\u308a\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\nJS\u306f\u82e6\u624b\u3060\u3063\u305f\u3089\u3057\u304f\u3053\u3061\u3089\u3067\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u3002\nCropper.js\n\u30b9\u30de\u30db\u3082\u305d\u306e\u307e\u307e\u6700\u9069\u3055\u308c\u308b\u306e\u3067\u3059\u3054\u3044\u4fbf\u5229\u306a\u753b\u50cf\u3092\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u62bd\u51fa\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3057\u305f\u3002\u3042\u3063\u3055\u308a\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\n\u753b\u50cf\u3092\u5207\u308a\u629c\u304fjquery\u30d7\u30e9\u30b0\u30a4\u30f3\u300cCropper\u300d\u3092\u4f7f\u3063\u3066\u307f\u308b\n\u57fa\u672cdemo\u3092\u3044\u3058\u308c\u3070\u308f\u304b\u308b\u611f\u3058\u3002\n\n\u3053\u3053\u304b\u3089\u306f\u30b5\u30fc\u30d0\u30fc\u5074\n\n\u3010\uff17\u3011\u3055\u304f\u3089vps\u306bopencv\u3001virtualenv\u3001mod_wsgi\u3001scikit-learn,django\u7b49\u3005\u306e\u74b0\u5883\u69cb\u7bc9\u3059\u308b\n\u6b63\u76f4\u3053\u3053\u304c\u4e00\u756a\u6642\u9593\u304b\u304b\u3063\u305f\u3002\n\n\u3055\u304f\u3089VPS\u306e\u521d\u671f\u8a2d\u5b9a\u306f\u3053\u3053\u306e\u901a\u308a\u306b\u3084\u308b\u3002\npython\u3044\u308c\u308bCentOS 6.5\u306bPython 2.7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057Apache\u3067\u4f7f\u7528\u306e\u901a\u308a\u306b\u3084\u308b\n\n\u305d\u3082\u305d\u3082\u3055\u304f\u3089VPS\u306eCentOS6.5\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u304cpython 2.6.6 \u3067mod_wsgi \u3068\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3063\u3066\u30a8\u30e9\u30fc\u304c\u3067\u3066\u306f\u307e\u3063\u305f\u3002\u3057\u304b\u3082django\u306e\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u304f\u308c\u308b\u308f\u3051\u3067\u3082\u306a\u304f\u3001\u767d\u3044\u753b\u9762\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u8fd4\u3063\u3066\u3053\u306a\u304f\u306a\u308b\u306e\u3067\u672c\u5f53\u306b\u56f0\u308b\u3002\n\nvirtualenv\u3044\u308c\u308b\n\u3053\u3053\u304b\u3089\u3002\u3053\u308c\u304c\u306a\u3044\u3068\u666e\u901a\u306b\u30d1\u30b9\u304c\u3069\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u3093\u3060\u304b\u308f\u3051\u308f\u304b\u3089\u3093\u304f\u306a\u308b\u306e\u3067\u5fc5\u9808\u3002\nCENTOS6.5\u306bOpenCV\u5165\u308c\u308b(\u5168\u5de5\u7a0b\u3067\u4e00\u756a\u5927\u5909\u304b\u3082\uff09\n\n\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u898b\u3088\u3046\u898b\u771f\u4f3c\u3067\u3084\u308a\u304d\u308b\u3002\u591a\u5206\u4e00\u756a\u5927\u5909\u3060\u3063\u305f\u3002#\u6b63\u76f4\u899a\u3048\u3066\u3044\u306a\u3044\u3002\n\u3061\u306a\u307f\u306b\u306a\u3093\u304b\u4f9d\u5b58\u95a2\u4fc2\u304c\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u305b\u305a\u660e\u308b\u304f\u4e0a\u66f8\u304d\u3057\u305f\u3089\u30b5\u30fc\u30d0\u30fc\u4f7f\u3048\u306a\u304f\u306a\u3063\u305f\u3053\u3068\u306f\u60aa\u5922\u3060\u3063\u305f\u3002\nAMI\u306bOpenCV3.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b\nOpenCV3.0\u3068opencv_contrib\u3092ubuntu\u306b\u5165\u308c\u305f\u4f5c\u696d\u30e1\u30e2\nCENTOS6\u3067openCV\u3092\u5229\u7528\u3059\u308b\u6642\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\n\u3061\u306a\u307f\u306b\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9\u306f\u3053\u306e\u3078\u3093\u3067\u5b66\u3079\u308b\n\u307e\u3063\u3055\u3089\u306aVPS\uff08CentOS6\uff09\u304b\u3089Apache\u3092\u4f7f\u3063\u3066Django\u3092\u52d5\u304b\u3059\u307e\u3067\u306e\u30e1\u30e2\n\n\u3010\uff18\u3011mod_wsgi\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3001\u3055\u304f\u3089VPS\u306bdjango\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\ndjango\u306e\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u306f\ndjango \u672c\u756a\u74b0\u5883\u69cb\u7bc9\u304b\u3089\u30ea\u30ea\u30fc\u30b9\u307e\u3067(django1.8.7 + Apache + mod_wsgi)\n\u3092\u898b\u308c\u307099%\u306f\u5927\u4e08\u592b\u3002\n\u305f\u3060\u3001djnago \u3068\u3000scikit-learn\u3000\u304c\u3000CENTOS\u3067\u8d77\u3053\u3059\u554f\u984c\u3092\u89e3\u6d88\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002\u3053\u3053\u3082\u3064\u307e\u3063\u305f\u3002\nhttps://github.com/scikit-learn/scikit-learn/issues/3947\n\u4e0a\u3067\u4f5c\u3063\u305fwsgi.conf\u30d5\u30a1\u30a4\u30eb\u306b\n\nLoadModule wsgi_module modules/mod_wsgi.so\nWSGIPythonPath /home/hoge/ENV/lib/python2.7/site-packages\nWSGIApplicationGroup %{GLOBAL}\n\n\u3068\u3057\u3066\u3042\u3052\u308c\u3070\u89e3\u6c7a\u3059\u308b\u3002\n\n\u30109\u3011\u3055\u304f\u3089VPS\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\n\u3042\u3068\u306f\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\u3002\n\u4e0b\u8a18\u30b5\u30a4\u30c8\u3068\u304b\u53c2\u7167\n\u3055\u304f\u3089\u306eVPS\u3092\u4f7f\u3063\u3066\u307f\u308b\u30108\u3011-VirtualHost\uff08\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\uff09\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u308b\n\u9069\u5ea6\u306b******\u3067\u57cb\u3081\u3066\u3044\u308b\u306e\u3067\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\npython.conf\n\n<VirtualHost *:80>\n\nServerName sokkurinavi.com\nServerAlias www.sokkurinavi.com\n\nWSGIScriptAlias / /var/www/cgi-bin/*******************/wsgi.py\n\n#WSGIScriptAlias /sokuri /var/www/cgi-bin/*************\n#Alias /static /home/hoge/ENV/lib/python2.7/site-packages/django/contrib/admin/static\n\nAlias /static/ /var/www/cgi-bin/******************/static/\n\n<Directory /var/www/cgi-bin/******************/static>\nWSGIApplicationGroup %{GLOBAL}\nOrder deny,allow\nAllow from all\n</Directory>\n\n<Directory /var/www/cgi-bin/***************>\nOrder deny,allow\nAllow from all\n</Directory>\n\n</VirtualHost>\n\n\n\n\u5b8c\u6210\u7248\u304c\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\n\n\u305d\u3063\u304f\u308a\u30ca\u30d3\n\n\u4e00\u3064\u6700\u5f8c\u306b\u8a00\u3044\u305f\u3044\u306e\u306f\u3001\u30a8\u30ed\u30b5\u30a4\u30c8\u4f5c\u308c\u3070\u3001\u6d41\u5165\u3046\u306f\u3046\u306f\u3060\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001\u3044\u3064\u307e\u3067\u305f\u3063\u3066\u3082\u6d41\u5165\uff11\u3068\u304b\uff12\u3068\u304b\u3060\u304b\u3089\u3001\u30a8\u30ed\u30b5\u30a4\u30c8\u306f\u30aa\u30b9\u30b9\u30e1\u3057\u306a\u3044\u3002\n#**\u3055\u304f\u3089\u306eVPS\u3068Django\u3068scikit-learn\u3092\u4f7f\u3063\u3066\u3001\u6c17\u306b\u306a\u308b\u9854\u753b\u50cf\u3068\u985e\u4f3c\u3057\u305fAV\u5973\u512a\u304c\u51fa\u3066\u308bAV\u306e\u985e\u4f3c\u753b\u50cf\u691c\u7d22\u3067\u304d\u308b\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u3092\u4f5c\u3063\u305f\u3002**\n\n\u30b5\u30a4\u30c8\u540d\u306f[\u305d\u3063\u304f\u308a\u30ca\u30d3\b](http://sokkurinavi.com/)\n\n\u4eca\u307e\u3067\u30a2\u30d7\u30ea\u306e\u958b\u767a\u3092\u3057\u3066\u3044\u305f\u306e\u3067unity\u3068\u304bopen-GL\u3068\u304bObjective-C\u306f\u4f7f\u3063\u305f\u3053\u3068\u3042\u3063\u305f\u306e\u3060\u3051\u3069\u3001python\u3084\u6a5f\u68b0\u5b66\u7fd2\u306e\u52c9\u5f37\u3068\u5b9f\u76ca\u3082\u304b\u306d\u3066\u30011\u304b\u3089\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u3063\u305f\u5c65\u6b74\u3092\u8a18\u9332\u3057\u307e\u3059\u3002\n\n\u521d\u5fc3\u8005\u304c\u306f\u307e\u308b\u30dd\u30a4\u30f3\u30c8\u306f\u5168\u90e8\u306f\u307e\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u521d\u5fc3\u8005\u306e\u4eba\u305f\u3061\u306b\u306f\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306bSIFT\u3068\u304bCNN\u3068\u304b\u4f7f\u308f\u306a\u304b\u3063\u305f\u306e\u306f\u3001BOVW\u7684\u306a\u3084\u3064\u306e\u7cbe\u5ea6\u304c\u4f4e\u304b\u3063\u305f\u308a\u3001\u6b21\u5143\u304c\u5927\u304d\u304f\u306a\u3063\u3066\u8a08\u7b97\u91cf\u304c\u5897\u3048\u3061\u3083\u3063\u305f\u304b\u3089\u3067\u3059\u3002CNN\u3084\u308b\u306a\u3089\u52d5\u753b\u304b\u3089\u753b\u50cf\u62bd\u51fa\u3068\u304b\u3057\u306a\u3044\u3068\u30b5\u30f3\u30d7\u30eb\u6570\u8db3\u308a\u306a\u3044\u611f\u3058\u306b\u306a\u3063\u3061\u3083\u3063\u3066\u8ca7\u5f31\u306a\u30de\u30b7\u30f3\u3060\u3063\u305f\u306e\u3067\u8ae6\u3081\u307e\u3057\u305f\u3002\n\n\u5143\u30cd\u30bf\uff1a[AV\u753b\u50cf\u8a8d\u8b58\u6280\u8853\u3068\u305d\u306e\u5468\u8fba](http://sssslide.com/www.slideshare.net/parosky0/av-ut-startup-gym) \u3000**\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059!**\n\n##**\u76ee\u6b21**\n\n------------\u30ed\u30fc\u30ab\u30eb\u5074\u4f5c\u696d----------------\n\n\n- \u3010\uff11\u3011DMM\u304b\u3089AV\u5973\u512a\u306e\u9854\u753b\u50cf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3002\n- \u3010\uff12\u3011opencv\u3067\u9854\u753b\u50cf\u62bd\u51fa\u3001\u9854\u753b\u50cf\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\n- \u3010\uff13\u3011pca\u3068kmeans\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u4e0e\u3048\u305f\u9854\u753b\u50cf\u3092\u5206\u985e\u3059\u308b\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n- \u3010\uff14\u3011django\u3092\u4f7f\u3063\u3066\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\n- \u3010\uff15\u3011\u30af\u30e9\u30a6\u30c9\u30ef\u30fc\u30af\u30b9\u3067html\u3068\u30c7\u30b6\u30a4\u30f3\u4f5c\u3063\u3066\u3082\u3089\u3046\n- \u3010\uff16\u3011CropperJS\u3092\u4f7f\u3063\u3066\u3001\u9854\u753b\u50cf\u3092\u5207\u308a\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\n\n------------\u30b5\u30fc\u30d0\u30fc\u5074\u4f5c\u696d----------------\n\n\n- \u3010\uff17\u3011\u3055\u304f\u3089vps\u306bopencv\u3001virtualenv\u3001mod_wsgi\u3001scikit-learn,django\u7b49\u3005\u306e\u74b0\u5883\u69cb\u7bc9\u3059\u308b\n- \u3010\uff18\u3011mod_wsgi\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3001\u3055\u304f\u3089VPS\u306bdjango\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n- \u3010\uff19\u3011\u3055\u304f\u3089VPS\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\n\n\n##\u3010\uff11\u3011DMM\u304b\u3089AV\u5973\u512a\u306e\u9854\u753b\u50cf\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3002\n\n\u30af\u30ed\u30fc\u30eb\u306b\u4f7f\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u3042\u3052\u306a\u3044\u306e\u304c\u4e16\u306e\u5e38\u3063\u307d\u3044\u306e\u3067\u30b3\u30fc\u30c9\u306f\u6652\u3055\u306a\u3044\u3051\u3069\u3001\npython\u3068BeautifulSoup4\u3092\u4f7f\u3063\u305f\u3002\n\n[Python\u3068Beautiful Soup\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0](http://qiita.com/itkr/items/513318a9b5b92bd56185)\u3092\u898b\u308c\u3070\u3001\u4ee3\u3005\u89e3\u6c7a\u3059\u308b\u306e\u3067\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\n##\u3010\uff12\u3011opencv\u3067\u9854\u753b\u50cf\u62bd\u51fa\u3001\u9854\u753b\u50cf\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\n\nopencv\u81ea\u4f53\u306f\u30d3\u30eb\u30c9\u3059\u308b\u3068\u5927\u5909\u306a\u306e\u3060\u3051\u3069\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u3084Mac\u3068\u304b\u3067\u3084\u308b\u5206\u306b\u306fanaconda\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\n\n`pip install anaconda`\n`conda install -c https://conda.binstar.org/jjhelmus opencv`\n\n\u306e\u4e8c\u3064\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3060\u3051\u3067\u5229\u7528\u53ef\u80fd\u3002\u7c21\u5358\u3002\n\n\u3053\u306e\u8fba\u304c\u53c2\u8003\u306b\u306a\u308b\n[Python(Anaconda)\u3068OpenCV\u3092\u4f7f\u3063\u3066\u52d5\u753b\u304b\u3089\u9854\u753b\u50cf\u3092\u62bd\u51fa\u3057\u3066\u307f\u308b](https://hogehuga.com/post-241/)\n[OpenCV\u3067\u9854\u8a8d\u8b58\u3092\u884c\u3044\u3001\u9854\u306e\u90e8\u5206\u3060\u3051\u30c8\u30ea\u30df\u30f3\u30b0\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3010Python\u3011](http://famirror.hateblo.jp/entry/2015/12/19/180000)\n\n```\n# -*- coding:utf-8 -*-\nimport cv2\nimport sys\nimport os\nimport shutil\n\nimage_path = \"image.png\"#\u4efb\u610f\u306e\u753b\u50cf\u30d1\u30b9\n\n#\u30ab\u30b9\u30b1\u30fc\u30c9\u5206\u985e\u5668\u306e\u7279\u5fb4\u91cf\u3092\u53d6\u5f97\u3059\u308b\nface_cascade = cv2.CascadeClassifier('[yourdir]/opencv/data/haarcascades/haarcascade_frontalface_default.xml')\n\n#\u30d5\u30a1\u30a4\u30eb\u8aad\u307f\u8fbc\u307f\nimage = cv2.imread(image_path)#\u4efb\u610f\u306e\u753b\u50cf\u30d1\u30b9\n\n#\u30b0\u30ec\u30fc\u30b9\u30b1\u30fc\u30eb\u5909\u63db\nimage_gray = cv2.cvtColor(image, cv2.cv.CV_BGR2GRAY)\n\n\n#\u7269\u4f53\u8a8d\u8b58\uff08\u9854\u8a8d\u8b58\uff09\u306e\u5b9f\u884c\nfaces = cascade.detectMultiScale(image_gray, scaleFactor=1.2, minNeighbors=2, minSize=(10, 10))\n\n\n#\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nif len(faces) > 0:\n\tpath = os.path.splitext(image_path)\n\tdir_path = path[0] + '_face'\n\tif os.path.isdir(dir_path):\n\t\tshutil.rmtree(dir_path)\n\tos.mkdir(dir_path)\n\ni = 0;\nfor rect in faces:\n\t#\u9854\u3060\u3051\u5207\u308a\u51fa\u3057\u3066\u4fdd\u5b58\n\tx = rect[0]\n\ty = rect[1]\n\twidth = rect[2]\n\theight = rect[3]\n\tdst = image[y:y+height, x:x+width]\n\tnew_image_path = dir_path + '/' + str(i) + path[1];\n\tcv2.imwrite(new_image_path, dst)#\u3053\u3053\u3067\u5207\u308a\u53d6\u3063\u305f\u753b\u50cf\u3092\u4fdd\u5b58\u3059\u308b\u30d1\u30b9\u3092\u5165\u308c\u308b\n\ti += 1\n\n\n```\n\n\u9854\u753b\u50cf\u3092\u62bd\u51fa\u3057\u305f\u3089\u3001\u7d9a\u3044\u3066HOG\u7279\u5fb4\u91cf(Histograms of Oriented Gradients)\u3092\u62bd\u51fa\u3059\u308b\n\n HOG\u7279\u5fb4\u91cf\u306b\u3064\u3044\u3066\u53c2\u8003\uff1a\n[\u753b\u50cf\u304b\u3089HOG\u7279\u5fb4\u91cf\u306e\u62bd\u51fa](http://qiita.com/kooh-z/items/3e3f85e93d894b4645f7)\n\n\u3081\u3063\u3061\u3083\u30b7\u30f3\u30d7\u30eb\u3067\n\n```\nhog=cv2.HOGDescriptor()\nimg=cv2.imread('test.jpg')\nres=hog.compute(img)\n```\n\n\u3068\u3059\u308b\u3060\u3051\u3002\u3053\u308c\u3067\u753b\u50cf\u306e\u5206\u6563\u8868\u73fe\u304c\u53d6\u308c\u308b\u3002\n\n##\u3010\uff13\u3011pca\u3068kmeans\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u4e0e\u3048\u305f\u9854\u753b\u50cf\u3092\u5206\u985e\u3059\u308b\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n\n\u305f\u3060\u3001HOG\u7279\u5fb4\u91cf\u306e\u554f\u984c\u70b9\u3068\u3057\u3066\u3001\u6b21\u5143\u306e\u546a\u3044\u304c\u3042\u308b\u3002\n\u666e\u901a\u306b\uff13\uff10\u4e07\u679a\u8fd1\u3044\u753b\u50cf\u3068\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8\u3067\u985e\u4f3c\u5ea6\u8a08\u7b97\u3057\u3066\u8fd4\u305d\u3046\u3068\u3059\u308b\u306a\u3089\u8a08\u7b97\u91cf\u7684\u306b\u7121\u7406\u306a\u306e\u3067\u3001\u6b21\u5143\u5727\u7e2e(PCA)\u3068PCA\u3057\u305f\u7d50\u679c\u3092\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0(kmeans\uff09\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u307e\u305a\u5168\u753b\u50cf\u306b\u3064\u3044\u3066\u5206\u6563\u8868\u73fe\u3092\u5f97\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\n\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u3063\u3066\u3001\u753b\u50cf\u3092\u30d5\u30a9\u30eb\u30c0\u5358\u4f4d\u3067\u4e00\u62ec\u3067\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u305f\u3002\n\n```\nfrom PIL import Image\nimport os\nimport cv2\nfrom sklearn.cluster import KMeans\nimport numpy as np\nimport random\nimport pickle\nimport re\nimport sklearn\nimport dill\n\n\n\nclass Imageob(object):\n\tdef __init__(self):\n\t\tpass\n\n\tdef fileread(self, filepath):\n\t\tself.path = filepath\n\t\ttry:\n\t\t\ttemp = cv2.imread(filepath)\n\t\t\tself.src = cv2.resize(temp,(64,64))\n\t\t\tself.shape = temp.shape\n\t\t\t\n\t\texcept cv2.error as e:\n\t\t\tpass\n\n\tdef readArray(self, array):\n\t\tself.srcGrey = array\n\n\nclass Images(object):\n\tdef __init__(self):\n\t\tself.images = []\n\n\tdef addImage(self, image):\n\t\tself.images.append(image)\n\n\tdef readAllFiles(self, folderpath, isResize=False, height=256, width=256):\n\n\t\tfor path in self.readAllFilePath(folderpath):\n\t\t\tp = path.replace(folderpath, \"\")\n\t\t\tp = p.split(\"/\")\n\t\t\tm= m+1\n\n\t\t\timage = Imageob()\n\t\t\timage.fileread(path)\n\n\t\t\tif image.shape[0] > 50:\u3000#\u5c0f\u3055\u3059\u304e\u308b\u753b\u50cf\u3092\u524a\u9664\n\t\t\t\tpi = ProcessImage()\n\t\t\t\timage = pi.resize(image, 64, 64)\n\t\t\t\tself.addImage(image)\n\t\t\t\tn = n+1\n\n\n\tdef readAllFilePath(self, folderpath):\n\t\tfor root, dirs, files in os.walk(folderpath):\n\t\t\tfor file in files:\n\t\t\t\tif not file.startswith(\".\") and file.endswith(\".jpg\"):\n\t\t\t\t\tyield os.path.join(root, file)\n\n#\u3053\u3053\u304b\u3089HOG\u7279\u5fb4\u91cf\u3092\u62bd\u51fa\u3059\u308b\n\nimages = Images()\nprint(\"\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\u3092\u958b\u59cb\u3057\u307e\u3059\")\n\nimages.readAllFiles(\"/image_path\")#\u9854\u753b\u50cf\u304c\u5165\u3063\u3066\u3044\u308b\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\n\ndata = []\nlabel = []\nnum = 0\n\nfor image in images.images:\n\thog = cv2.HOGDescriptor((64, 64), (16, 16), (8, 8), (8, 8), 9)\n\timg_ = cv2.imread(image.path)\n\timg_ = cv2.resize(img_,(64,64))\n\ttry:\n\t\thist = hog.compute(img_)\n\t\tk = [] #numpy\u306b\u3059\u308b\u3088\u3046\u306b\u30ea\u30b9\u30c8\u8868\u73fe\u306b\u3059\u308b\u3002\n\t\tif hist is not None:\n\t\t\tfor i in hist:\n\t\t\t\tk.append(i[0])\n\t\telse:\n\t\t\tprint(\"hist is NONE\")\n\n\t\tdata.append(k)\n\n\texcept cv2.error as e:\n\t\tpass\n\n\nnpdata = np.array(data)\u3000# scikit-learn\u3067\u4f7f\u3048\u308b\u3088\u3046\u306bnp.array\u5f62\u5f0f\u306b\u3059\u308b\n\npca = sklearn.decomposition.PCA(100)\npca.fit(npdata)\n\nX_pca= pca.transform(npdata)\n\na =[] # \u4e0a\u8a18\u3067\u4f5c\u3089\u308c\u305f\u30ea\u30b9\u30c8\u5f62\u5f0f\u3067\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u5165\u308c\u308b\n\nfor x in X_pca:\n   a.append(x)\n\nkmeans_model  = KMeans(n_clusters=10, random_state=10).fit(a)\nlabels = kmeans_model.labels_\n\n\n```\n\n\u3053\u308c\u3067PCA\u306e\u30e2\u30c7\u30eb\u3068Kmeans\u306e\u30e2\u30c7\u30eb\u304c\u3067\u304d\u305f\u3002\n\u50d5\u307f\u305f\u3044\u306b\u304d\u3063\u305f\u306a\u3044\u30af\u30e9\u30b9\u3092\u4f5c\u3063\u305f\u308a\u3057\u3066\u3001\u5b50\u8981\u7d20\u3092\u6301\u3064\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3068\u3001\nPython\u306epickle\u3067serialize\u3067\u304d\u306a\u3044\u554f\u984c\u304c\u8d77\u3053\u308b\u306e\u3067\u3001\ndill\u3067\u4fdd\u5b58\u3059\u308b\u3068\u91cd\u304f\u3082\u306a\u3044\u3057\u3001\u6c38\u7d9a\u5316\u3055\u308c\u308b\u306e\u3067\u30aa\u30b9\u30b9\u30e1\u3002\n\n[Python\u306epickle\u3067serialize\u3067\u304d\u306a\u3044\u554f\u984c\u306e\u56de\u907f\u7b56](http://nishidy.hatenablog.com/entry/2016/02/01/225750)\n\n\u3042\u3068\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3051\u3070\u3001\u753b\u50cf\u30d1\u30b9\u3092\u4e0e\u3048\u3066\u3001COS\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3067\u304d\u308b\n\n\n```\n\ndef cos_sim(v1, v2):\n\treturn np.dot(v1, v2) / (np.linalg.norm(v1) * np.linalg.norm(v2))\n\nclass Hog(object):\n\tdef __init__(self):\n\t\tpass\n\n\tdef hog(self, path):\n\t\thog = cv2.HOGDescriptor((64, 64), (16, 16), (8, 8), (8, 8), 9)\n\t\timg = cv2.imread(path)\n\t\timg = cv2.resize(img , (64, 64))\n\n\t\tt = []\n\t\ttry:\n\t\t\thist = hog.compute(img)\n\t\t\tk = []\n\t\t\tif hist is not None:\n\t\t\t\tfor i in hist:\n\t\t\t\t\tk.append(i[0])\n\t\t\telse:\n\t\t\t\tprint(\"hist is NONE\")\n\t\t\tt.append(k)\n\n\t\texcept cv2.error as e:\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000print('cv2_error')\n\t\treturn t\n\n\n```\n\n\u753b\u50cf\u3092\u4e0e\u3048\u305f\u3089HOG\u7279\u5fb4\u91cf\u53d6\u3063\u3066\u3001\u4e3b\u6210\u5206\u5206\u6790\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u6b21\u5143\u5727\u7e2e\u3057\u3066\u3001\u305d\u308c\u3092\u5143\u306bKmeasn\u306e\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u6240\u5c5e\u3059\u308b\u30af\u30e9\u30b9\u30bf\u3092\u63a8\u5b9a\u3057\u3066\u3001\u305d\u306e\u30af\u30e9\u30b9\u30bf\u5185\u306e\u5168\u753b\u50cf\u3068\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3059\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\u306f\u4e0b\u8a18\u3002(\u3053\u3061\u3089\u306e\u65b9\u304c\u306e\u65b9\u304c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u78ba\u5b9f\u306b\u7dba\u9e97\u3067\u3059\u3002)\n\n[\u30a2\u30cb\u30e1\u306e\u9854\u5199\u771f\u3092Bag of Keywords\u3067\u5206\u985e\u3057\u3066\u307f\u305f](http://nonbiri-tereka.hatenablog.com/entry/2014/09/29/101030)\n\u203b\u6ce8\uff1aSIFT\u306f\u73fe\u5728\u660e\u308b\u304f\u66f8\u3044\u3066\u3082\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001KAZE,AKAZE\u3092\u304a\u4f7f\u3044\u304f\u3060\u3055\u3044\u3002\n\nKAZE\u3068\u304b\u306e\u4f7f\u3044\u65b9\n[OpenCV3.0.0-dev+Python2.7.6\u3067\u7279\u5fb4\u91cf(ORB/AKAZE/KAZE/FAST/BRISK)\u306e\u8a08\u6e2c](http://tamanobi.hatenablog.com/entry/2015/07/13/093440)\n\n\n##\u3010\uff14\u3011django\u3092\u4f7f\u3063\u3066\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\n\n\u3053\u3053\u307e\u3067\u304f\u308c\u3070\u3042\u3068\u306f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u307f\u305f\u3044\u306a\u7269\n\u3053\u3053\u3092\u898b\u3066\u4f5c\u3063\u305f\u3002\n\n[Python Django\u5165\u9580](http://qiita.com/kaki_k/items/511611cadac1d0c69c54)\n\n##\u3010\uff15\u3011\u30af\u30e9\u30a6\u30c9\u30ef\u30fc\u30af\u30b9\u3067html\u3068\u30c7\u30b6\u30a4\u30f3\u4f5c\u3063\u3066\u3082\u3089\u3046\n\n\u6b63\u76f4\u30c7\u30b6\u30a4\u30f3\u3068\u30de\u30fc\u30af\u30a2\u30c3\u30d7\u304c\u4e00\u756a\u5411\u3044\u3066\u3044\u306a\u3044\u4f5c\u696d\u306a\u306e\u3067\u3001\u5916\u6ce8\u3057\u305f\u3002\n\u3053\u3093\u306a\u611f\u3058\u3002\u3061\u306a\u307f\u306b\u6295\u8cc7\u306f\u5168\u304f\u56de\u53ce\u3067\u304d\u3066\u306a\u3044\u3002\u56de\u53ce\u306e\u76ee\u51e6\u3082\u306a\u3044\u3002\n\n[\u7537\u306e\u30ed\u30de\u30f3\u304c\u3064\u307e\u3063\u305f\u300c\u305d\u3063\u304f\u308a\u30ca\u30d3!!\u300d \u306e\u753b\u9762\u306e\u30c7\u30b6\u30a4\u30f3/\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0 ](https://crowdworks.jp/public/jobs/556788)\n\n##\u3010\uff16\u3011CropperJS\u3092\u4f7f\u3063\u3066\u3001\u9854\u753b\u50cf\u3092\u5207\u308a\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\n\nJS\u306f\u82e6\u624b\u3060\u3063\u305f\u3089\u3057\u304f\u3053\u3061\u3089\u3067\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u3002\n\n[Cropper.js](https://fengyuanchen.github.io/cropperjs/)\n\n\u30b9\u30de\u30db\u3082\u305d\u306e\u307e\u307e\u6700\u9069\u3055\u308c\u308b\u306e\u3067\u3059\u3054\u3044\u4fbf\u5229\u306a\u753b\u50cf\u3092\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u62bd\u51fa\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3057\u305f\u3002\u3042\u3063\u3055\u308a\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308b\n\n[\u753b\u50cf\u3092\u5207\u308a\u629c\u304fjquery\u30d7\u30e9\u30b0\u30a4\u30f3\u300cCropper\u300d\u3092\u4f7f\u3063\u3066\u307f\u308b](http://co.bsnws.net/article/50)\n\n\u57fa\u672cdemo\u3092\u3044\u3058\u308c\u3070\u308f\u304b\u308b\u611f\u3058\u3002\n\n##\u3053\u3053\u304b\u3089\u306f\u30b5\u30fc\u30d0\u30fc\u5074\n\n##\u3010\uff17\u3011\u3055\u304f\u3089vps\u306bopencv\u3001virtualenv\u3001mod_wsgi\u3001scikit-learn,django\u7b49\u3005\u306e\u74b0\u5883\u69cb\u7bc9\u3059\u308b\n\n\u6b63\u76f4\u3053\u3053\u304c\u4e00\u756a\u6642\u9593\u304b\u304b\u3063\u305f\u3002\n\n- \u3055\u304f\u3089VPS\u306e\u521d\u671f\u8a2d\u5b9a\u306f[\u3053\u3053](http://qiita.com/aild_arch_bfmv/items/99dd58fc6be84f87a075)\u306e\u901a\u308a\u306b\u3084\u308b\u3002\n\n\n- python\u3044\u308c\u308b[CentOS 6.5\u306bPython 2.7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057Apache\u3067\u4f7f\u7528](http://a-records.info/2014/10/25/34/)\u306e\u901a\u308a\u306b\u3084\u308b\n\n\u305d\u3082\u305d\u3082\u3055\u304f\u3089VPS\u306eCentOS6.5\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u304cpython 2.6.6 \u3067mod_wsgi \u3068\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3063\u3066\u30a8\u30e9\u30fc\u304c\u3067\u3066\u306f\u307e\u3063\u305f\u3002\u3057\u304b\u3082django\u306e\u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u304f\u308c\u308b\u308f\u3051\u3067\u3082\u306a\u304f\u3001\u767d\u3044\u753b\u9762\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u8fd4\u3063\u3066\u3053\u306a\u304f\u306a\u308b\u306e\u3067\u672c\u5f53\u306b\u56f0\u308b\u3002\n\n- virtualenv\u3044\u308c\u308b\n[\u3053\u3053](http://qiita.com/H-A-L/items/5d5a2ef73be8d140bdf3)\u304b\u3089\u3002\u3053\u308c\u304c\u306a\u3044\u3068\u666e\u901a\u306b\u30d1\u30b9\u304c\u3069\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u3093\u3060\u304b\u308f\u3051\u308f\u304b\u3089\u3093\u304f\u306a\u308b\u306e\u3067\u5fc5\u9808\u3002\n\n- CENTOS6.5\u306bOpenCV\u5165\u308c\u308b(\u5168\u5de5\u7a0b\u3067\u4e00\u756a\u5927\u5909\u304b\u3082\uff09\n\n\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u898b\u3088\u3046\u898b\u771f\u4f3c\u3067\u3084\u308a\u304d\u308b\u3002\u591a\u5206\u4e00\u756a\u5927\u5909\u3060\u3063\u305f\u3002#\u6b63\u76f4\u899a\u3048\u3066\u3044\u306a\u3044\u3002\n\u3061\u306a\u307f\u306b\u306a\u3093\u304b\u4f9d\u5b58\u95a2\u4fc2\u304c\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u305b\u305a\u660e\u308b\u304f\u4e0a\u66f8\u304d\u3057\u305f\u3089\u30b5\u30fc\u30d0\u30fc\u4f7f\u3048\u306a\u304f\u306a\u3063\u305f\u3053\u3068\u306f\u60aa\u5922\u3060\u3063\u305f\u3002\n\n[AMI\u306bOpenCV3.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u308b](http://qiita.com/mitokazzy/items/df2d8a4fd93f46210f5f)\n[OpenCV3.0\u3068opencv_contrib\u3092ubuntu\u306b\u5165\u308c\u305f\u4f5c\u696d\u30e1\u30e2](http://qiita.com/iwata-n@github/items/6ae7e430e8008be29377)\n[CENTOS6\u3067openCV\u3092\u5229\u7528\u3059\u308b\u6642\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8](http://www.gimmickgeek.com/2014/10/04/centos6%E3%81%A7opencv%E3%82%92%E5%88%A9%E7%94%A8%E3%81%99%E3%82%8B%E6%99%82%E3%81%AB%E5%BF%85%E8%A6%81%E3%81%AA%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8/)\n\n\n\u3061\u306a\u307f\u306b\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9\u306f\u3053\u306e\u3078\u3093\u3067\u5b66\u3079\u308b\n[\u307e\u3063\u3055\u3089\u306aVPS\uff08CentOS6\uff09\u304b\u3089Apache\u3092\u4f7f\u3063\u3066Django\u3092\u52d5\u304b\u3059\u307e\u3067\u306e\u30e1\u30e2](http://qiita.com/itkr/items/fef0978f808f36449f1f)\n\n\n##\u3010\uff18\u3011mod_wsgi\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3001\u3055\u304f\u3089VPS\u306bdjango\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\ndjango\u306e\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u306f\n\n[django \u672c\u756a\u74b0\u5883\u69cb\u7bc9\u304b\u3089\u30ea\u30ea\u30fc\u30b9\u307e\u3067(django1.8.7 + Apache + mod_wsgi)]\n(http://marrsan.hateblo.jp/entry/2015/12/03/145235)\n\n\u3092\u898b\u308c\u307099%\u306f\u5927\u4e08\u592b\u3002\n\n\u305f\u3060\u3001djnago \u3068\u3000scikit-learn\u3000\u304c\u3000CENTOS\u3067\u8d77\u3053\u3059\u554f\u984c\u3092\u89e3\u6d88\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002\u3053\u3053\u3082\u3064\u307e\u3063\u305f\u3002\nhttps://github.com/scikit-learn/scikit-learn/issues/3947\n\n\u4e0a\u3067\u4f5c\u3063\u305fwsgi.conf\u30d5\u30a1\u30a4\u30eb\u306b\n`\nLoadModule wsgi_module modules/mod_wsgi.so\nWSGIPythonPath /home/hoge/ENV/lib/python2.7/site-packages\nWSGIApplicationGroup %{GLOBAL}\n`\n\n\u3068\u3057\u3066\u3042\u3052\u308c\u3070\u89e3\u6c7a\u3059\u308b\u3002\n\n\n##\u30109\u3011\u3055\u304f\u3089VPS\u3067\u30c9\u30e1\u30a4\u30f3\u3092\u53d6\u5f97\u3057\u3066\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\n\n\u3042\u3068\u306f\u30c9\u30e1\u30a4\u30f3\u53d6\u5f97\u3057\u3066\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u8a2d\u5b9a\u3059\u308b\u3002\n\u4e0b\u8a18\u30b5\u30a4\u30c8\u3068\u304b\u53c2\u7167\n\n[\u3055\u304f\u3089\u306eVPS\u3092\u4f7f\u3063\u3066\u307f\u308b\u30108\u3011-VirtualHost\uff08\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\uff09\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u308b](http://pro-grammer.info/archives/894)\n\n\u9069\u5ea6\u306b******\u3067\u57cb\u3081\u3066\u3044\u308b\u306e\u3067\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```text:python.conf\n\n<VirtualHost *:80>\n\nServerName sokkurinavi.com\nServerAlias www.sokkurinavi.com\n\nWSGIScriptAlias / /var/www/cgi-bin/*******************/wsgi.py\n\n#WSGIScriptAlias /sokuri /var/www/cgi-bin/*************\n#Alias /static /home/hoge/ENV/lib/python2.7/site-packages/django/contrib/admin/static\n\nAlias /static/ /var/www/cgi-bin/******************/static/\n\n<Directory /var/www/cgi-bin/******************/static>\nWSGIApplicationGroup %{GLOBAL}\nOrder deny,allow\nAllow from all\n</Directory>\n\n<Directory /var/www/cgi-bin/***************>\nOrder deny,allow\nAllow from all\n</Directory>\n\n</VirtualHost>\n\n```\n\n\u5b8c\u6210\u7248\u304c[\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8](http://sokkurinavi.com/)\n\n#[\u305d\u3063\u304f\u308a\u30ca\u30d3\b](http://sokkurinavi.com/)\n\n\n\n**\u4e00\u3064\u6700\u5f8c\u306b\u8a00\u3044\u305f\u3044\u306e\u306f\u3001\u30a8\u30ed\u30b5\u30a4\u30c8\u4f5c\u308c\u3070\u3001\u6d41\u5165\u3046\u306f\u3046\u306f\u3060\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001\u3044\u3064\u307e\u3067\u305f\u3063\u3066\u3082\u6d41\u5165\uff11\u3068\u304b\uff12\u3068\u304b\u3060\u304b\u3089\u3001\u30a8\u30ed\u30b5\u30a4\u30c8\u306f\u30aa\u30b9\u30b9\u30e1\u3057\u306a\u3044\u3002**\n\n\n\n\n\n"}