{"tags": ["AWS", "Kinesis"], "context": "\n\n\u69cb\u6210\n\n\u3088\u304f\u3042\u308b\u30d1\u30bf\u30fc\u30f3\n\n\n\u30c7\u30d7\u30ed\u30a4\u3057\u3066AP\u30b5\u30fc\u30d0\u304b\u3089kinesis-firehose\u3078\u9001\u3063\u3066S3\u306b\u683c\u7d0d\n\n\n\n\n\n\u74b0\u5883\n\naws-kinesis-agent-1.1.2-1.amzn1.noarch\n\n\n\u4e8b\u8c61\n\n\u69cb\u7bc9\u6642\u306f\u554f\u984c\u306a\u304b\u3063\u305f\u304c\u3001\u53d6\u5f97\u5bfe\u8c61\u30ed\u30b0\u304c\u30ed\u30fc\u30c6\u30fc\u30c8\u51e6\u7406\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30a8\u30e9\u30fc\u767a\u751f\n\u5bfe\u8c61\u30ed\u30b0\n\n\n\n/var/app/current/log/production.log\n\n\u30ed\u30b0\n\n\n\n\n\n\n/var/log/aws-kinesis-agent/aws-kinesis-agent.log\nInitialization logs can be found in /tmp/aws-kinesis-agent.20170301165118.initlog\nUnhandled exception during startup.\njava.lang.IllegalStateException: Expected the service to be RUNNING, but the service has FAILED\n    at com.google.common.util.concurrent.AbstractService.checkCurrentState(AbstractService.java:285)\n    at com.google.common.util.concurrent.AbstractService.awaitRunning(AbstractService.java:229)\n    at com.google.common.util.concurrent.AbstractExecutionThreadService.awaitRunning(AbstractExecutionThreadService.java:197)\n    at com.amazon.kinesis.streaming.agent.Agent.startUp(Unknown Source)\n    at com.google.common.util.concurrent.AbstractIdleService$2$1.run(AbstractIdleService.java:54)\n    at com.google.common.util.concurrent.Callables$3.run(Callables.java:95)\n    at com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)\n    at com.google.common.util.concurrent.MoreExecutors$2.execute(MoreExecutors.java:849)\n    at com.google.common.util.concurrent.AbstractIdleService$2.doStart(AbstractIdleService.java:50)\n    at com.google.common.util.concurrent.AbstractService.startAsync(AbstractService.java:174)\n    at com.google.common.util.concurrent.AbstractIdleService.startAsync(AbstractIdleService.java:135)\n    at com.amazon.kinesis.streaming.agent.Agent.main(Unknown Source)\nCaused by: java.lang.IllegalStateException\n    at com.google.common.base.Preconditions.checkState(Preconditions.java:158)\n    at com.amazon.kinesis.streaming.agent.tailing.TrackedFileRotationAnalyzer.findCurrentOpenFileAfterTruncate(Unknown Source)\n    at com.amazon.kinesis.streaming.agent.tailing.SourceFileTracker.updateCurrentFile(Unknown Source)\n    at com.amazon.kinesis.streaming.agent.tailing.SourceFileTracker.initialize(Unknown Source)\n    at com.amazon.kinesis.streaming.agent.tailing.FileTailer.initialize(Unknown Source)\n    at com.amazon.kinesis.streaming.agent.tailing.FileTailer.startUp(Unknown Source)\n    at com.google.common.util.concurrent.AbstractExecutionThreadService$1$2.run(AbstractExecutionThreadService.java:55)\n    at com.google.common.util.concurrent.Callables$3.run(Callables.java:95)\n    at java.lang.Thread.run(Thread.java:745)\nFATAL: Thread FileTailer[fh:************:/var/app/current/log/production.log] threw an unrecoverable error. Aborting application\n\n\n\u30ed\u30fc\u30c6\u30fc\u30c8\u51e6\u7406\u6642\u306b\u4f55\u304b\u767a\u751f\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n\n\u539f\u56e0\n\nlogrotate \u306b\u304a\u3044\u3066 copytruncate \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306b\u767a\u751f\u3059\u308b\n\n\n/etc/logrotate.elasticbeanstalk.hourly/logrotate.elasticbeanstalk.webapp.conf\n/var/app/containerfiles/logs/* {\n size 10M\n rotate 5\n missingok \n compress\n notifempty\n copytruncate\n dateext\n dateformat %s\n olddir /var/app/containerfiles/logs/rotated\n }\n\n\n\n\u5bfe\u7b56\n\n\u30ed\u30b0\u306e\u51fa\u529b\u5148\u3092\u5909\u66f4\u3059\u308b\ncopytruncate\u3092copy\u306b\u5909\u66f4\u3059\u308b\n\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u304c/var/app/containerfiles/logs/rotated\u306bgzip\u5727\u7e2e\u3055\u308c\u305f\u72b6\u614b\u3067\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002logrotate\u3067\u5f53\u8a72\u30ed\u30b0\u3092nocompress\u3068\u3057\u3001\u53d6\u5f97\u5bfe\u8c61\u3068\u3059\u308b\u30ed\u30b0\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\n\n\n\u88dc\u8db3\n\nissue\u3068\u3057\u3066\u6271\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001update\u3092\u671f\u5f85\n\n\nException on LogRotate #50\n\n\n\n\n# \u69cb\u6210\n* \u3088\u304f\u3042\u308b\u30d1\u30bf\u30fc\u30f3\n * \u30c7\u30d7\u30ed\u30a4\u3057\u3066AP\u30b5\u30fc\u30d0\u304b\u3089kinesis-firehose\u3078\u9001\u3063\u3066S3\u306b\u683c\u7d0d\n\n![Untitled.png](https://qiita-image-store.s3.amazonaws.com/0/58788/f771739f-9855-f3cc-c2db-a63330613fb9.png)\n\n# \u74b0\u5883\n* aws-kinesis-agent-1.1.2-1.amzn1.noarch\n\n# \u4e8b\u8c61\n* \u69cb\u7bc9\u6642\u306f\u554f\u984c\u306a\u304b\u3063\u305f\u304c\u3001\u53d6\u5f97\u5bfe\u8c61\u30ed\u30b0\u304c\u30ed\u30fc\u30c6\u30fc\u30c8\u51e6\u7406\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30a8\u30e9\u30fc\u767a\u751f\n* \u5bfe\u8c61\u30ed\u30b0\n   * `/var/app/current/log/production.log`\n     * \u30ed\u30b0\n \n```/var/log/aws-kinesis-agent/aws-kinesis-agent.log\nInitialization logs can be found in /tmp/aws-kinesis-agent.20170301165118.initlog\nUnhandled exception during startup.\njava.lang.IllegalStateException: Expected the service to be RUNNING, but the service has FAILED\n\tat com.google.common.util.concurrent.AbstractService.checkCurrentState(AbstractService.java:285)\n\tat com.google.common.util.concurrent.AbstractService.awaitRunning(AbstractService.java:229)\n\tat com.google.common.util.concurrent.AbstractExecutionThreadService.awaitRunning(AbstractExecutionThreadService.java:197)\n\tat com.amazon.kinesis.streaming.agent.Agent.startUp(Unknown Source)\n\tat com.google.common.util.concurrent.AbstractIdleService$2$1.run(AbstractIdleService.java:54)\n\tat com.google.common.util.concurrent.Callables$3.run(Callables.java:95)\n\tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)\n\tat com.google.common.util.concurrent.MoreExecutors$2.execute(MoreExecutors.java:849)\n\tat com.google.common.util.concurrent.AbstractIdleService$2.doStart(AbstractIdleService.java:50)\n\tat com.google.common.util.concurrent.AbstractService.startAsync(AbstractService.java:174)\n\tat com.google.common.util.concurrent.AbstractIdleService.startAsync(AbstractIdleService.java:135)\n\tat com.amazon.kinesis.streaming.agent.Agent.main(Unknown Source)\nCaused by: java.lang.IllegalStateException\n\tat com.google.common.base.Preconditions.checkState(Preconditions.java:158)\n\tat com.amazon.kinesis.streaming.agent.tailing.TrackedFileRotationAnalyzer.findCurrentOpenFileAfterTruncate(Unknown Source)\n\tat com.amazon.kinesis.streaming.agent.tailing.SourceFileTracker.updateCurrentFile(Unknown Source)\n\tat com.amazon.kinesis.streaming.agent.tailing.SourceFileTracker.initialize(Unknown Source)\n\tat com.amazon.kinesis.streaming.agent.tailing.FileTailer.initialize(Unknown Source)\n\tat com.amazon.kinesis.streaming.agent.tailing.FileTailer.startUp(Unknown Source)\n\tat com.google.common.util.concurrent.AbstractExecutionThreadService$1$2.run(AbstractExecutionThreadService.java:55)\n\tat com.google.common.util.concurrent.Callables$3.run(Callables.java:95)\n\tat java.lang.Thread.run(Thread.java:745)\nFATAL: Thread FileTailer[fh:************:/var/app/current/log/production.log] threw an unrecoverable error. Aborting application\n```\n\u30ed\u30fc\u30c6\u30fc\u30c8\u51e6\u7406\u6642\u306b\u4f55\u304b\u767a\u751f\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n\n# \u539f\u56e0\n* logrotate \u306b\u304a\u3044\u3066 copytruncate \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306b\u767a\u751f\u3059\u308b\n\n```/etc/logrotate.elasticbeanstalk.hourly/logrotate.elasticbeanstalk.webapp.conf\n/var/app/containerfiles/logs/* {\n size 10M\n rotate 5\n missingok \n compress\n notifempty\n copytruncate\n dateext\n dateformat %s\n olddir /var/app/containerfiles/logs/rotated\n }\n```\n\n# \u5bfe\u7b56\n1. \u30ed\u30b0\u306e\u51fa\u529b\u5148\u3092\u5909\u66f4\u3059\u308b\n2. copytruncate\u3092copy\u306b\u5909\u66f4\u3059\u308b\n3. \u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u304c/var/app/containerfiles/logs/rotated\u306bgzip\u5727\u7e2e\u3055\u308c\u305f\u72b6\u614b\u3067\u7f6e\u304b\u308c\u3066\u3044\u308b\u3002logrotate\u3067\u5f53\u8a72\u30ed\u30b0\u3092nocompress\u3068\u3057\u3001\u53d6\u5f97\u5bfe\u8c61\u3068\u3059\u308b\u30ed\u30b0\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\n\n# \u88dc\u8db3\n* issue\u3068\u3057\u3066\u6271\u308f\u308c\u3066\u3044\u308b\u306e\u3067\u3001update\u3092\u671f\u5f85\n * [Exception on LogRotate #50](https://github.com/awslabs/amazon-kinesis-agent/issues/50)\n"}