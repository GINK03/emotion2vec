{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u30b9\u30de\u30db\u7528\u306eSingle Page Application\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u4e0a\u3067\u306e\u554f\u984c\u70b9\u3068\u5bfe\u5fdc \u3068SinglePageApplication\u306b\u304a\u3051\u308b\u554f\u984c\u70b9\u3068\u5bfe\u5fdc\u306b\u3064\u3065\u304f\u7b2c3\u5f3e\u3068\u3057\u3066Rails\u3092\u3064\u304b\u3063\u305fSPA(Single Page Application)\u306e\u30b5\u30a4\u30c8SmartFX\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u969b\u306b\u6c17\u3065\u3044\u305f\u3053\u3068\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u958b\u767a\u74b0\u5883\u306e\u30ea\u30ed\u30fc\u30c9\u306b\u6642\u9593\u304c\u304b\u304b\u308b\n\n\u7406\u7531\nSPA\u306f\u5927\u91cf\u306bJS\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3072\u3068\u3064\u3072\u3068\u3064\u8aad\u307f\u8fbc\u3080\u306e\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u3059\u304e\u308b\u3002\n\n\u5bfe\u5fdc\ndevelopment\u74b0\u5883\u3067\u3082js\u3092concat\u3055\u305b\u308b\n\nconfig/environments/development.rb\nconfig.assets.debug = false\n\n\n\n\u30c7\u30d7\u30ed\u30a4\u9014\u4e2d\u306b\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u753b\u9762\u304c\u771f\u3063\u767d\n\n\u7406\u7531\n\u7e2e\u9000\u3067Web\u30b5\u30fc\u30d0\u306b\u53cd\u6620(\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304b\u3089Web\u30b5\u30fc\u30d0\u3092\u5207\u308a\u96e2\u3057\u3066\u3001\u5207\u308a\u96e2\u3057\u305fWeb\u30b5\u30fc\u30d0\u306bdeploy\u3057\u3001\u53cd\u6620\u3057\u305f\u5f8c\u3067\u518d\u5ea6\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306b\u7e4b\u304e\u306a\u304a\u3059\u3053\u3068\u3067\u5404Web\u30b5\u30fc\u30d0\u3092\u66f4\u65b0\u3059\u308b\u65b9\u6cd5)\u3057\u305f\u969b\u306b\u3001html\u306f\u6700\u65b0\u306e\u30b5\u30fc\u30d0\u3001js\u304c\u53e4\u3044Web\u30b5\u30fc\u30d0\u306b\u898b\u306b\u3044\u3063\u3066\u3057\u307e\u3044\u3001\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u306a\u304f\u306a\u308b\u77ac\u9593\u304c\u3042\u308b\u3002\n\n\u5bfe\u5fdc\nasset_sync\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u3001assets compile\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u3092S3\u306b\u7f6e\u304f\u3053\u3068\u3067js\u3084css\u304c\u306a\u3044\u30a8\u30e9\u30fc\u3092\u56de\u907f\u3067\u304d\u308b\u3002\n1.Gemfile\u306bgem asset_sync\u3092\u8ffd\u52a0\u3057bundle install\n2.\u4e0b\u8a18\u3092\u5b9f\u884c\nrails g asset_sync:install --provider=AWS\n\n3.\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\n\nconfig/initializers/asset_sync.rb\nAssetSync.configure do |config|\n  config.fog_provider = 'AWS'\n  config.aws_access_key_id = Access Key Id\n  config.aws_secret_access_key = Secret Access Key\n  config.fog_directory = Bucket Name\n  config.gzip_compression  = true\n  config.fog_region = \"ap-northeast-1\"\nend\n\n\n4.\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\n\nconfig/environments/production.rb\n  config.action_controller.asset_host = \"//#{Bucket Name}.s3.amazonaws.com\"\n\n\n\u53c2\u7167(https://github.com/rumblelabs/asset_sync)\n\njs\u3067image\u306e\u30d1\u30b9\u3092\u66f8\u304d\u8fbc\u3080\u3068not found\u306b\u306a\u308b\n\n\u7406\u7531\nassets\u306fdigest\u304c\u3064\u304f\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u308b\u5ea6\u306bpass\u304c\u5909\u308f\u308b\n\n\u5bfe\u5fdc\nerb\u3092\u4f7f\u3063\u3066\u3001ruby\u306e\u8a55\u4fa1\u7d50\u679c\u3092js\u306e\u5b9a\u7fa9\u306b\u3059\u308b\u3002\nassets\u4ee5\u5916\u3067\u3082\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u5b9a\u6570\u3082js\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u5b9a\u7fa9\u7b87\u6240\u3092\u4e00\u7b87\u6240\u306b\u3059\u308b\u3002\n\u305f\u3060\u3057\u3001\u5b9a\u6570\u3092\u5909\u66f4\u3057\u3066\u3082\u3001definition.js.erb\u81ea\u4f53\u304c\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u3068compile\u3057\u76f4\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u30b3\u30e1\u30f3\u30c8\u306brevision\u306a\u3069\u3092\u4f5c\u3063\u3066\u66f4\u65b0\u3059\u308b\u3002\n\napp/assets/javascripts/definition.js.erb\n//revision: 2\nwindow.MyApp = {\n  assets:{\n    \"no-image\": \"<%= asset_path(\"no-image.png\") %>\",\n    \"logo\": \"<%= asset_path(\"logo.png\") %>\"\n  }\n}\nwindow.MyApp.Settings = <%= Settings.to_json.html_safe %>\n\n\n\n\u753b\u50cf\u3092upload\u3059\u308b\u3068CPU\u306e\u8ca0\u8377\u304c100%\u306b\u306a\u308b\n\n\u7406\u7531\n\u30b5\u30e0\u30cd\u30a4\u30eb\u4f5c\u6210\u306a\u3069\u3001\u753b\u50cf\u306e\u5727\u7e2e\u51e6\u7406\u306e\u8ca0\u8377\u304c\u9ad8\u3044\u3002\n\n\u5bfe\u5fdc\n\u30af\u30a2\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u5727\u7e2e\u3059\u308b\u3002\nhtml5\u306eFile API\u3068canvas\u3092\u4f7f\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u753b\u50cf\u3092\u5727\u7e2e\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u901a\u4fe1\u91cf\u3082\u6e1b\u3089\u305b\u308b\u3002\n@stomita\u3055\u3093\u306eMega pixel image rendering library\u3092\u4f7f\u3048\u3070\u7c21\u5358\u3002\n<form>\n  <input id=\"afile\" type=\"file\">\n  <input id=\"save\" type=\"submit\">\n</form>\n<canvas id=\"canvas1\" style=\"display:none\"></canvas>\n\nclass PhotoUpdateView extends Backbone.View\n  events:\n    \"click #save\":  \"save\"\n    \"change #file\": \"updatePhoto\"\n\n  updatePhoto: (e)->\n    files = e.target.files\n    if files.length == 0\n      return\n    @mpImg = new MegaPixImage(files[0])\n\n  save: (e)->\n    fd = new FormData()\n    @mpImg.render(@$(\"#canvas1\")[0], { maxWidth: 150, maxHeight: 150})\n    ctx = canvas.getContext('2d')\n    src = ctx.canvas.toDataURL('image/png', .9)\n    fd.append('photo', src)\n    $.ajax\n      url: /photos\n      type: \"POST\"\n      contentType: false\n      processData: false\n      data: fd\n      success: (obj) =>\n        alert(\"success\")\n      error: (xmlHttpRequest, textStatus, errorThrown) =>\n        alert(xmlHttpRequest.responseJSON.message)\n\n\napp/models/photo.rb\nclass Photo < ActiveRecord::Base\n  mount_uploader :image, PhotoUploader\n\n\n\napp/models/photos_controller.rb\nclass PhotosController < ApplicationController\n  def create\n    photo = Photo.new\n    file = Tempfile.new(['profile',\".png\"])\n    file.binmode\n    file.write Base64.decode64(params[:photo].sub!('data:image/png;base64,', ''))\n    photo.image = file\n    phto.save!\n  rescue => e\n    render :json => {:message => e.message}, :status => 400\n  ensure\n     file.close if file\n     file.unlink if file  # deletes the temp file\n  end\nend\n\n\n\nturbolink\u3092off\u306b\u3057\u305f\u3044\n\n\u7406\u7531\nSPA\u3067\u306f\u5fc5\u8981\u306a\u3044\n\n\u5bfe\u5fdc\nGemfile\u304b\u3089 gem 'turbolink'\u3092\u6d88\u3057\u3001application.js\u306e//= require turbolinks \u3092\u524a\u9664\n\n\u307e\u3068\u3081\n\u4eca\u56de\u306f\u3001\u6b63\u76f4Single Page Application\u3042\u3093\u307e\u308a\u95a2\u4fc2\u306a\u3044\u3067\u3059\u3002\n\u306a\u3093\u3068\u306a\u304f\u6d41\u308c\u3067\u3002\u3002\n# \u306f\u3058\u3081\u306b\n[\u30b9\u30de\u30db\u7528\u306eSingle Page Application\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u4e0a\u3067\u306e\u554f\u984c\u70b9\u3068\u5bfe\u5fdc](http://qiita.com/takeshy/items/892c0b0c5b5dc3885570) \u3068[SinglePageApplication\u306b\u304a\u3051\u308b\u554f\u984c\u70b9\u3068\u5bfe\u5fdc](http://qiita.com/takeshy/items/b7e1b6bd30d12ecb02c6)\u306b\u3064\u3065\u304f\u7b2c3\u5f3e\u3068\u3057\u3066Rails\u3092\u3064\u304b\u3063\u305fSPA(Single Page Application)\u306e\u30b5\u30a4\u30c8[SmartFX](http://smartfx.minkabu.jp)\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u969b\u306b\u6c17\u3065\u3044\u305f\u3053\u3068\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u958b\u767a\u74b0\u5883\u306e\u30ea\u30ed\u30fc\u30c9\u306b\u6642\u9593\u304c\u304b\u304b\u308b\n## \u7406\u7531\nSPA\u306f\u5927\u91cf\u306bJS\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3072\u3068\u3064\u3072\u3068\u3064\u8aad\u307f\u8fbc\u3080\u306e\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u3059\u304e\u308b\u3002\n## \u5bfe\u5fdc\ndevelopment\u74b0\u5883\u3067\u3082js\u3092concat\u3055\u305b\u308b\n\n```ruby:config/environments/development.rb\nconfig.assets.debug = false\n```\n\n# \u30c7\u30d7\u30ed\u30a4\u9014\u4e2d\u306b\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u753b\u9762\u304c\u771f\u3063\u767d\n## \u7406\u7531\n\u7e2e\u9000\u3067Web\u30b5\u30fc\u30d0\u306b\u53cd\u6620(\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u304b\u3089Web\u30b5\u30fc\u30d0\u3092\u5207\u308a\u96e2\u3057\u3066\u3001\u5207\u308a\u96e2\u3057\u305fWeb\u30b5\u30fc\u30d0\u306bdeploy\u3057\u3001\u53cd\u6620\u3057\u305f\u5f8c\u3067\u518d\u5ea6\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u306b\u7e4b\u304e\u306a\u304a\u3059\u3053\u3068\u3067\u5404Web\u30b5\u30fc\u30d0\u3092\u66f4\u65b0\u3059\u308b\u65b9\u6cd5)\u3057\u305f\u969b\u306b\u3001html\u306f\u6700\u65b0\u306e\u30b5\u30fc\u30d0\u3001js\u304c\u53e4\u3044Web\u30b5\u30fc\u30d0\u306b\u898b\u306b\u3044\u3063\u3066\u3057\u307e\u3044\u3001\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u306a\u304f\u306a\u308b\u77ac\u9593\u304c\u3042\u308b\u3002\n\n## \u5bfe\u5fdc\nasset_sync\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u3001assets compile\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u3092S3\u306b\u7f6e\u304f\u3053\u3068\u3067js\u3084css\u304c\u306a\u3044\u30a8\u30e9\u30fc\u3092\u56de\u907f\u3067\u304d\u308b\u3002\n1.Gemfile\u306bgem asset_sync\u3092\u8ffd\u52a0\u3057bundle install\n2.\u4e0b\u8a18\u3092\u5b9f\u884c\n\n```bash\nrails g asset_sync:install --provider=AWS\n```\n3.\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\n\n```ruby:config/initializers/asset_sync.rb\nAssetSync.configure do |config|\n  config.fog_provider = 'AWS'\n  config.aws_access_key_id = Access Key Id\n  config.aws_secret_access_key = Secret Access Key\n  config.fog_directory = Bucket Name\n  config.gzip_compression  = true\n  config.fog_region = \"ap-northeast-1\"\nend\n```\n\n4.\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\n\n```ruby:config/environments/production.rb\n  config.action_controller.asset_host = \"//#{Bucket Name}.s3.amazonaws.com\"\n```\n\n\u53c2\u7167(https://github.com/rumblelabs/asset_sync)\n\n\n# js\u3067image\u306e\u30d1\u30b9\u3092\u66f8\u304d\u8fbc\u3080\u3068not found\u306b\u306a\u308b\n## \u7406\u7531\nassets\u306fdigest\u304c\u3064\u304f\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u308b\u5ea6\u306bpass\u304c\u5909\u308f\u308b\n\n## \u5bfe\u5fdc\nerb\u3092\u4f7f\u3063\u3066\u3001ruby\u306e\u8a55\u4fa1\u7d50\u679c\u3092js\u306e\u5b9a\u7fa9\u306b\u3059\u308b\u3002\nassets\u4ee5\u5916\u3067\u3082\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u5b9a\u6570\u3082js\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u5b9a\u7fa9\u7b87\u6240\u3092\u4e00\u7b87\u6240\u306b\u3059\u308b\u3002\n\u305f\u3060\u3057\u3001\u5b9a\u6570\u3092\u5909\u66f4\u3057\u3066\u3082\u3001definition.js.erb\u81ea\u4f53\u304c\u5909\u66f4\u3057\u3066\u3044\u306a\u3044\u3068compile\u3057\u76f4\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u30b3\u30e1\u30f3\u30c8\u306brevision\u306a\u3069\u3092\u4f5c\u3063\u3066\u66f4\u65b0\u3059\u308b\u3002\n\n```js:app/assets/javascripts/definition.js.erb\n//revision: 2\nwindow.MyApp = {\n  assets:{\n    \"no-image\": \"<%= asset_path(\"no-image.png\") %>\",\n    \"logo\": \"<%= asset_path(\"logo.png\") %>\"\n  }\n}\nwindow.MyApp.Settings = <%= Settings.to_json.html_safe %>\n```\n\n# \u753b\u50cf\u3092upload\u3059\u308b\u3068CPU\u306e\u8ca0\u8377\u304c100%\u306b\u306a\u308b\n## \u7406\u7531\n\u30b5\u30e0\u30cd\u30a4\u30eb\u4f5c\u6210\u306a\u3069\u3001\u753b\u50cf\u306e\u5727\u7e2e\u51e6\u7406\u306e\u8ca0\u8377\u304c\u9ad8\u3044\u3002\n## \u5bfe\u5fdc\n\u30af\u30a2\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u5727\u7e2e\u3059\u308b\u3002\nhtml5\u306eFile API\u3068canvas\u3092\u4f7f\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u753b\u50cf\u3092\u5727\u7e2e\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u901a\u4fe1\u91cf\u3082\u6e1b\u3089\u305b\u308b\u3002\n@stomita\u3055\u3093\u306e[Mega pixel image rendering library](https://github.com/stomita/ios-imagefile-megapixel)\u3092\u4f7f\u3048\u3070\u7c21\u5358\u3002\n\n```html\n<form>\n  <input id=\"afile\" type=\"file\">\n  <input id=\"save\" type=\"submit\">\n</form>\n<canvas id=\"canvas1\" style=\"display:none\"></canvas>\n```\n\n``` coffeescript\nclass PhotoUpdateView extends Backbone.View\n  events:\n    \"click #save\":  \"save\"\n    \"change #file\": \"updatePhoto\"\n\n  updatePhoto: (e)->\n    files = e.target.files\n    if files.length == 0\n      return\n    @mpImg = new MegaPixImage(files[0])\n\n  save: (e)->\n    fd = new FormData()\n    @mpImg.render(@$(\"#canvas1\")[0], { maxWidth: 150, maxHeight: 150})\n    ctx = canvas.getContext('2d')\n    src = ctx.canvas.toDataURL('image/png', .9)\n    fd.append('photo', src)\n    $.ajax\n      url: /photos\n      type: \"POST\"\n      contentType: false\n      processData: false\n      data: fd\n      success: (obj) =>\n        alert(\"success\")\n      error: (xmlHttpRequest, textStatus, errorThrown) =>\n        alert(xmlHttpRequest.responseJSON.message)\n```\n \n``` ruby:app/models/photo.rb\nclass Photo < ActiveRecord::Base\n  mount_uploader :image, PhotoUploader\n```\n\n``` ruby:app/models/photos_controller.rb\nclass PhotosController < ApplicationController\n  def create\n    photo = Photo.new\n    file = Tempfile.new(['profile',\".png\"])\n    file.binmode\n    file.write Base64.decode64(params[:photo].sub!('data:image/png;base64,', ''))\n    photo.image = file\n    phto.save!\n  rescue => e\n    render :json => {:message => e.message}, :status => 400\n  ensure\n     file.close if file\n     file.unlink if file  # deletes the temp file\n  end\nend\n```\n\n# turbolink\u3092off\u306b\u3057\u305f\u3044 \n## \u7406\u7531\nSPA\u3067\u306f\u5fc5\u8981\u306a\u3044\n## \u5bfe\u5fdc\nGemfile\u304b\u3089 gem 'turbolink'\u3092\u6d88\u3057\u3001application.js\u306e//= require turbolinks \u3092\u524a\u9664\n\n#\u307e\u3068\u3081\n\u4eca\u56de\u306f\u3001\u6b63\u76f4Single Page Application\u3042\u3093\u307e\u308a\u95a2\u4fc2\u306a\u3044\u3067\u3059\u3002\n\u306a\u3093\u3068\u306a\u304f\u6d41\u308c\u3067\u3002\u3002\n", "tags": ["Rails", "SinglePageApplication", "JavaScript"]}