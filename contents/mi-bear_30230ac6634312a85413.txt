{"context": " More than 1 year has passed since last update.Console_CommandLine\u304c\u601d\u3044\u306e\u5916\u5229\u7528\u3057\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001TypeTalk\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Push\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u304a\u8a66\u3057\u3057\u3066\u307f\u305f\u3002\n\ncomposer\u3067\u8a2d\u5b9a\n\ncomposer.json\n{\n    \"require\": {\n         \"guzzle/guzzle\": \"*\"\n        ,\"codeception/codeception\": \"*\"\n        ,\"pear/pear_exception\": \"1.0.*@dev\"\n        ,\"pear/console_commandline\": \"dev-trunk\"\n    }\n}\n\n\n\n\u8a2d\u5b9a\u5024\n\nconfig.php\n//TypeTalk\u306eID\u7b49\n\n\n\nTypeTalk\n\ntypetalk.php\nrequire_once './vendor/autoload.php';\n\nuse Guzzle\\Http\\Client;\nuse Guzzle\\Http\\Message\\Request;\nuse Guzzle\\Http\\Exception\\RequestException;\n\n//\u30a2\u30af\u30bb\u30b9Token\u3092\u53d6\u5f97\u3059\u308b\n//\u307e\u3068\u3081\u306eTalkID\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\n//\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Push\u3059\u308b\n//...\n\n\n\npush\u3059\u308b\naddOption\u3067\u5fc5\u9808\u9805\u76ee\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u3001\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\npush.php\nrequire_once './vendor/autoload.php';\nrequire_once './config.php';\nrequire_once './typetalk.php';\n\nuse Console\\CommandLine;\n\n$cmdline = new Console_CommandLine();\n$cmdline->description = Configuration::CLI_DESCRIPTION;\n$cmdline->version = Configuration::VERSION;\n\n$cmdline->addOption('topic', array(\n     'short_name' => '-t'\n    ,'long_name' => '--topic'\n    ,'description' => 'TypeTalk TopicID' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_TOPIC_ID\n    ,'help_name' => '{TopicID}'\n    ,'action' => 'StoreInt'\n    ,'default' => Configuration::DEFAULT_TOPIC_ID\n));\n\n$cmdline->addOption('talk', array(\n     'short_name' => '-g'\n    ,'long_name' => '--group'\n    ,'description' => 'TypeTalk TalkID' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_TALK_ID\n    ,'help_name' => '{TalkID}'\n    ,'action' => 'StoreInt'\n    ,'default' => Configuration::DEFAULT_TALK_ID\n));\n\n$cmdline->addOption('message', array(\n     'short_name' => '-m'\n    ,'long_name' => '--message'\n    ,'description' => 'TypeTalk Push Message' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_MESSAGE\n    ,'help_name' => '{Message}'\n    ,'action' => 'StoreString'\n    ,'default' => Configuration::DEFAULT_MESSAGE\n));\n\ntry {\n    $cmdlineResult = $cmdline->parse();\n\n    $errors = array();\n\n    $typeTalkTopicId = isset($cmdlineResult->options['topic']) ? trim($cmdlineResult->options['topic']) : '';\n    $typeTalkTalkId = isset($cmdlineResult->options['talk']) ? trim($cmdlineResult->options['talk']) : '';\n    $message = isset($cmdlineResult->options['message']) ? trim($cmdlineResult->options['message']) : '';\n\n    if (!strlen($typeTalkTopicId)) $errors[] = 'TopicID is not null.'; //TopicID\u306f\u5fc5\u9808\n    if (!strlen($message)) $errors[] = 'Message is not null.'; //\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u9808\n    if (count($errors) > 0) throw new Exception(implode(PHP_EOL, $errors));\n\n    $typeTalk = new TypeTalk(Configuration::TYPETALK_CLIENT_ID, Configuration::TYPETALK_CLIENT_SECRET);\n    $talkIdList = $typeTalk->getTalkIdListByTopicId($typeTalkTopicId);\n\n    if (!in_array($typeTalkTalkId, $talkIdList)) {\n        //\u30c8\u30d4\u30c3\u30af\u306b\u5b58\u5728\u3057\u306a\u3044\u307e\u3068\u3081ID\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u307e\u3068\u3081\u30ca\u30b7\u3068\u3059\u308b\n        //throw new Exception('Missing TalkId[' . $typeTalkTalkId . '] in Topic[' . $typeTalkTopicId . '].');\n        $typeTalkTalkId = null;\n    }\n\n    $typeTalk->sendMessage($typeTalkTopicId, $typeTalkTalkId, $message, null);\n\n} catch (Exception $e) {\n    var_dump($e->getMessage());\n}\n\n\n\n\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\nphp ./push.php --help\n\nBearTalk CommandLine\n\nUsage:\n  push.php [options]\n\nOptions:\n  -t {TopicID}, --topic={TopicID}    TypeTalk TopicID\n                                     Default: {TopicID}\n  -g {TalkID}, --group={TalkID}      TypeTalk TalkID\n                                     Default: {TalkID}\n  -m {Message}, --message={Message}  TypeTalk Push Message\n                                     Default: \u30c7\u30e5\u30d5\u30d5\u30d5\u30d5\n  -h, --help                         show this help message and exit\n  -v, --version                      show the program version and exit\n\nConsole_CommandLine\u304c\u601d\u3044\u306e\u5916\u5229\u7528\u3057\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001TypeTalk\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Push\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u304a\u8a66\u3057\u3057\u3066\u307f\u305f\u3002\n\n## composer\u3067\u8a2d\u5b9a\n```json:composer.json\n{\n\t\"require\": {\n\t\t \"guzzle/guzzle\": \"*\"\n\t\t,\"codeception/codeception\": \"*\"\n\t\t,\"pear/pear_exception\": \"1.0.*@dev\"\n\t\t,\"pear/console_commandline\": \"dev-trunk\"\n\t}\n}\n```\n\n## \u8a2d\u5b9a\u5024\n```php:config.php\n//TypeTalk\u306eID\u7b49\n```\n\n## TypeTalk\n```php:typetalk.php\nrequire_once './vendor/autoload.php';\n\nuse Guzzle\\Http\\Client;\nuse Guzzle\\Http\\Message\\Request;\nuse Guzzle\\Http\\Exception\\RequestException;\n\n//\u30a2\u30af\u30bb\u30b9Token\u3092\u53d6\u5f97\u3059\u308b\n//\u307e\u3068\u3081\u306eTalkID\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\n//\u30e1\u30c3\u30bb\u30fc\u30b8\u3092Push\u3059\u308b\n//...\n```\n\n## push\u3059\u308b\naddOption\u3067\u5fc5\u9808\u9805\u76ee\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u3001\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\n```php:push.php\nrequire_once './vendor/autoload.php';\nrequire_once './config.php';\nrequire_once './typetalk.php';\n\nuse Console\\CommandLine;\n\n$cmdline = new Console_CommandLine();\n$cmdline->description = Configuration::CLI_DESCRIPTION;\n$cmdline->version = Configuration::VERSION;\n\n$cmdline->addOption('topic', array(\n\t 'short_name' => '-t'\n\t,'long_name' => '--topic'\n\t,'description' => 'TypeTalk TopicID' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_TOPIC_ID\n\t,'help_name' => '{TopicID}'\n\t,'action' => 'StoreInt'\n\t,'default' => Configuration::DEFAULT_TOPIC_ID\n));\n\n$cmdline->addOption('talk', array(\n\t 'short_name' => '-g'\n\t,'long_name' => '--group'\n\t,'description' => 'TypeTalk TalkID' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_TALK_ID\n\t,'help_name' => '{TalkID}'\n\t,'action' => 'StoreInt'\n\t,'default' => Configuration::DEFAULT_TALK_ID\n));\n\n$cmdline->addOption('message', array(\n\t 'short_name' => '-m'\n\t,'long_name' => '--message'\n\t,'description' => 'TypeTalk Push Message' . PHP_EOL . 'Default: ' . Configuration::DEFAULT_MESSAGE\n\t,'help_name' => '{Message}'\n\t,'action' => 'StoreString'\n\t,'default' => Configuration::DEFAULT_MESSAGE\n));\n\ntry {\n\t$cmdlineResult = $cmdline->parse();\n\t\n\t$errors = array();\n\t\n\t$typeTalkTopicId = isset($cmdlineResult->options['topic']) ? trim($cmdlineResult->options['topic']) : '';\n\t$typeTalkTalkId = isset($cmdlineResult->options['talk']) ? trim($cmdlineResult->options['talk']) : '';\n\t$message = isset($cmdlineResult->options['message']) ? trim($cmdlineResult->options['message']) : '';\n\t\n\tif (!strlen($typeTalkTopicId)) $errors[] = 'TopicID is not null.'; //TopicID\u306f\u5fc5\u9808\n\tif (!strlen($message)) $errors[] = 'Message is not null.'; //\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5fc5\u9808\n\tif (count($errors) > 0) throw new Exception(implode(PHP_EOL, $errors));\n\t\n\t$typeTalk = new TypeTalk(Configuration::TYPETALK_CLIENT_ID, Configuration::TYPETALK_CLIENT_SECRET);\n\t$talkIdList = $typeTalk->getTalkIdListByTopicId($typeTalkTopicId);\n\t\n\tif (!in_array($typeTalkTalkId, $talkIdList)) {\n\t\t//\u30c8\u30d4\u30c3\u30af\u306b\u5b58\u5728\u3057\u306a\u3044\u307e\u3068\u3081ID\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u306f\u307e\u3068\u3081\u30ca\u30b7\u3068\u3059\u308b\n\t\t//throw new Exception('Missing TalkId[' . $typeTalkTalkId . '] in Topic[' . $typeTalkTopicId . '].');\n\t\t$typeTalkTalkId = null;\n\t}\n\t\n\t$typeTalk->sendMessage($typeTalkTopicId, $typeTalkTalkId, $message, null);\n\t\n} catch (Exception $e) {\n\tvar_dump($e->getMessage());\n}\n```\n\n## \u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\n\n```\nphp ./push.php --help\n```\n\n```\nBearTalk CommandLine\n\nUsage:\n  push.php [options]\n\nOptions:\n  -t {TopicID}, --topic={TopicID}    TypeTalk TopicID\n                                     Default: {TopicID}\n  -g {TalkID}, --group={TalkID}      TypeTalk TalkID\n                                     Default: {TalkID}\n  -m {Message}, --message={Message}  TypeTalk Push Message\n                                     Default: \u30c7\u30e5\u30d5\u30d5\u30d5\u30d5\n  -h, --help                         show this help message and exit\n  -v, --version                      show the program version and exit\n```\n", "tags": ["pear", "Typetalk", "PHP"]}