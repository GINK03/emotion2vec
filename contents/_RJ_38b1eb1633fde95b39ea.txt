{"context": "\n\n\u6982\u8981\nSlack\u6295\u7a3f\u306f\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u306eSlackApp\u3092\u4f7f\u7528\n\u30b3\u30f3\u30d3\u30cb\u53d7\u3051\u53d6\u308a\u3092\u591a\u304f\u4f7f\u7528\u3059\u308b\u304b\u3064\u3001Gmail\u3092\u958b\u304f\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u304b\u3089\u4f5c\u6210\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\u672a\u8aad\u306eAmazon\u306e\u30b3\u30f3\u30d3\u30cb\u53d7\u3051\u53d6\u308a\u30e1\u30fc\u30eb\u306e\u53d7\u3051\u53d6\u308a\u756a\u53f7\u3092Slack\u3067\u901a\u77e5\u3059\u308b\u3002\n\u305d\u3057\u3066\u30e1\u30fc\u30eb\u3092\u65e2\u8aad\u306b\u3059\u308b\u3002\n\nmain.js\nfunction myFunction() {\n  var strTerms = '\u5e97\u8217\u5230\u7740\u6e08\uff1a\u53d7\u53d6\u65b9\u6cd5\u3092\u3054\u6848\u5185\u3057\u307e\u3059 is:unread';\n\n  var myThreads = GmailApp.search(strTerms, 0, 30); \n  var myMessages = GmailApp.getMessagesForThreads(myThreads); \n\n  for(var i=0;i < myMessages.length;i++){\n    var message = myMessages[i][0];\n    Logger.log(message.getSubject());  \n    //Logger.log(myMessages[i][0].getPlainBody().slice(0,1000)); \n\n    var text = message.getPlainBody().slice(0,1000);\n    var start = text.indexOf('\u304a\u554f\u3044\u5408\u308f\u305b\u756a\u53f7\uff1a');\n\n    var number = text.slice(start, start + 37);\n    postSlack('amazon-delivery-mail', 'amazon-delivery', number);\n\n    message.markRead();\n  }\n}\n\n\nfunction postSlack(channelname, username, message){\n  //Get channels\n  var slackApp = SlackApp.create('xoxp-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');\n  var channels = slackApp.channelsList().channels;\n\n  Logger.log(channels);\n\n  //Channel check\n  var channel = null;\n  channels.forEach(function(v, i){\n    if(v.name == channelname){\n     channel = v; \n    }\n  });\n\n  //Post Message\n  slackApp.postMessage(channel.id, message, {\n    username : username\n  }); \n}\n\n\n\n##\u6982\u8981\nSlack\u6295\u7a3f\u306f\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u306eSlackApp\u3092\u4f7f\u7528\n\u30b3\u30f3\u30d3\u30cb\u53d7\u3051\u53d6\u308a\u3092\u591a\u304f\u4f7f\u7528\u3059\u308b\u304b\u3064\u3001Gmail\u3092\u958b\u304f\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u304b\u3089\u4f5c\u6210\n\n##\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\u672a\u8aad\u306eAmazon\u306e\u30b3\u30f3\u30d3\u30cb\u53d7\u3051\u53d6\u308a\u30e1\u30fc\u30eb\u306e\u53d7\u3051\u53d6\u308a\u756a\u53f7\u3092Slack\u3067\u901a\u77e5\u3059\u308b\u3002\n\u305d\u3057\u3066\u30e1\u30fc\u30eb\u3092\u65e2\u8aad\u306b\u3059\u308b\u3002\n\n```javascript:main.js\nfunction myFunction() {\n  var strTerms = '\u5e97\u8217\u5230\u7740\u6e08\uff1a\u53d7\u53d6\u65b9\u6cd5\u3092\u3054\u6848\u5185\u3057\u307e\u3059 is:unread';\n \n  var myThreads = GmailApp.search(strTerms, 0, 30); \n  var myMessages = GmailApp.getMessagesForThreads(myThreads); \n \n  for(var i=0;i < myMessages.length;i++){\n    var message = myMessages[i][0];\n    Logger.log(message.getSubject());  \n    //Logger.log(myMessages[i][0].getPlainBody().slice(0,1000)); \n    \n    var text = message.getPlainBody().slice(0,1000);\n    var start = text.indexOf('\u304a\u554f\u3044\u5408\u308f\u305b\u756a\u53f7\uff1a');\n    \n    var number = text.slice(start, start + 37);\n    postSlack('amazon-delivery-mail', 'amazon-delivery', number);\n    \n    message.markRead();\n  }\n}\n\n\nfunction postSlack(channelname, username, message){\n  //Get channels\n  var slackApp = SlackApp.create('xoxp-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');\n  var channels = slackApp.channelsList().channels;\n  \n  Logger.log(channels);\n  \n  //Channel check\n  var channel = null;\n  channels.forEach(function(v, i){\n    if(v.name == channelname){\n     channel = v; \n    }\n  });\n\n  //Post Message\n  slackApp.postMessage(channel.id, message, {\n    username : username\n  }); \n}\n\n```\n", "tags": ["GoogleAppsScript", "gmail", "JavaScript", "Slack"]}