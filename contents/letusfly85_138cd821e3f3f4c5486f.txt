{"tags": ["Scala", "Play2", "dynalite", "DynamoDB"], "context": " More than 1 year has passed since last update.\u524d\u56de\u306e\u6295\u7a3f \u3067\u3001\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u305f\u306e\u3067\u3001\u672c\u65e5\u306fPost\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u30bd\u30fc\u30b9\nhttps://github.com/letusfly85/IoT_data_curator\n\n\u76ee\u6b21\n\nRouting\u8a2d\u5b9a\nModel\u4f5c\u6210\nController\u4f5c\u6210\n\n\n1. Routing\u8a2d\u5b9a\n# Routes\n# This file defines all application routes (Higher priority routes first)\n# ~~~~\n\n# Home page\nGET     /                           controllers.Application.index\n\n# Map static resources from the /public folder to the /assets URL path\nGET     /assets/*file               controllers.Assets.versioned(path=\"/public\", file: Asset)\n\nPOST    /v1/api/iot                 controllers.IotDataController.create()\n\n\n2. Model\u4f5c\u6210\nmkdir app/models\n\n\napp/models/IotData.scala\npackage models\n\nimport java.io.InputStream\n\nimport com.amazonaws.auth.profile.ProfileCredentialsProvider\nimport com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient\nimport com.amazonaws.services.dynamodbv2.document.{Item, DynamoDB}\n\nimport org.apache.commons.configuration.{PropertiesConfiguration}\n\n//case class IotData(id: Int, detail: String)\n\nobject IoTData {\n\n  //def create(entities: List[IotData]): Unit = {\n  def create(): Unit = {\n    val inputStream: InputStream =\n      getClass.getResourceAsStream(\"/endpoint.properties\")\n\n    val configuration: PropertiesConfiguration =\n      new PropertiesConfiguration()\n\n    configuration.load(inputStream, \"UTF8\")\n\n    val endpoint = configuration.getString(\"dynalite.endpoint\")\n\n    val client = new AmazonDynamoDBClient(new ProfileCredentialsProvider())\n    client.setEndpoint(endpoint)\n\n    val dynamoDB = new DynamoDB(client)\n    val table = dynamoDB.getTable(\"IotData\")\n\n    println(table.describe())\n\n    val item = new Item().withPrimaryKey(\"id\", 1).withString(\"detail\", \"sample data\")\n    List(1,2,3,4,5,6).foreach {id =>\n      val outcome = table.putItem(new Item().withInt(\"id\", id).withString(\"detail\", s\"sample data ${id}\"))\n\n      println(outcome)\n    }\n\n  }\n}\n\n\nDynamoDB\u3078\u306e\u63a5\u7d9a\u306f\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u306b\u4e0b\u8a18\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nhttp://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/AmazonDynamoDBClient.html\n\n3. Controller\u4f5c\u6210\n\napp/controllers/IotDataController.scala\npackage controllers\n\nimport models.IoTData\nimport play.api.mvc._\n\nclass IotDataController extends Controller {\n\n  def create = Action {\n    IoTData.create()\n    Ok(\"ok\")\n  }\n\n}\n\n\n\n4. \u5b9f\u884c\u3057\u3066\u307f\u308b\nconsole\u3067curl\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u305f\u3002\ncurl -XPOST http://localhost:9000/v1/api/iot -d ''\n\nplay2\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\u7d50\u679c\n{AttributeDefinitions: [{AttributeName: id,AttributeType: N}, {AttributeName: detail,AttributeType: S}],TableName: IotData,KeySchema: [{AttributeName: id,KeyType: HASH}, {AttributeName: detail,KeyType: RANGE}],TableStatus: ACTIVE,CreationDateTime: Tue Feb 16 11:17:59 JST 2016,ProvisionedThroughput: {NumberOfDecreasesToday: 0,ReadCapacityUnits: 10,WriteCapacityUnits: 10},TableSizeBytes: 0,ItemCount: 0,TableArn: arn:aws:dynamodb:us-east-1:000000000000:table/IotData,}\n{}\n{}\n{}\n{}\n{}\n{}\n\n\u3053\u308c\u306f\u3001\u30c7\u30fc\u30bf\u767b\u9332\u3067\u304d\u3066\u306a\u30fc\u3044\u3002\u3002\u3002\n\n\u304a\u307e\u3051\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001dynalite\u306bputItem\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001issue\u3092\u8d77\u7968\u3002\nhttps://github.com/mhart/dynalite/issues/49\n\u30bd\u30fc\u30b9\u3082\u8aad\u307f\u307e\u3057\u305f\u304c\u3061\u3087\u3063\u3068\u6319\u52d5\u304c\u4e0d\u660e\u77ad\u3067\u3059\u306d\u3002\u3002\n\n\u5229\u7528\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\n\ncreate.table.js\nvar AWS = require('aws-sdk')\nAWS.config.loadFromPath('config.json');\n\nvar dynamo = new AWS.DynamoDB({region: 'us-east-1', endpoint: 'http://*.*.*.*'})\ndynamo.listTables(console.log.bind(console))\n\nvar params = {\n    TableName : \"IotData\",\n    KeySchema: [\n        { AttributeName: \"id\",     KeyType: \"HASH\"},  //Partition key\n        { AttributeName: \"detail\", KeyType: \"RANGE\" }  //Sort key\n    ],\n    AttributeDefinitions: [\n        { AttributeName: \"id\", AttributeType: \"N\" },\n        { AttributeName: \"detail\", AttributeType: \"S\" }\n    ],\n    ProvisionedThroughput: {\n        ReadCapacityUnits: 1,\n        WriteCapacityUnits: 1\n    }\n};\n\n\n[\u524d\u56de\u306e\u6295\u7a3f](../../items/725e227e122332022cea) \u3067\u3001\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u305f\u306e\u3067\u3001\u672c\u65e5\u306fPost\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30bd\u30fc\u30b9\nhttps://github.com/letusfly85/IoT_data_curator\n\n## \u76ee\u6b21\n\n1. Routing\u8a2d\u5b9a\n2. Model\u4f5c\u6210\n3. Controller\u4f5c\u6210\n\n## 1. Routing\u8a2d\u5b9a\n\n```routes\n# Routes\n# This file defines all application routes (Higher priority routes first)\n# ~~~~\n\n# Home page\nGET     /                           controllers.Application.index\n\n# Map static resources from the /public folder to the /assets URL path\nGET     /assets/*file               controllers.Assets.versioned(path=\"/public\", file: Asset)\n\nPOST    /v1/api/iot                 controllers.IotDataController.create()\n```\n\n## 2. Model\u4f5c\u6210\n\n```bash\nmkdir app/models\n```\n\n```app/models/IotData.scala\npackage models\n\nimport java.io.InputStream\n\nimport com.amazonaws.auth.profile.ProfileCredentialsProvider\nimport com.amazonaws.services.dynamodbv2.AmazonDynamoDBClient\nimport com.amazonaws.services.dynamodbv2.document.{Item, DynamoDB}\n\nimport org.apache.commons.configuration.{PropertiesConfiguration}\n\n//case class IotData(id: Int, detail: String)\n\nobject IoTData {\n\n  //def create(entities: List[IotData]): Unit = {\n  def create(): Unit = {\n    val inputStream: InputStream =\n      getClass.getResourceAsStream(\"/endpoint.properties\")\n\n    val configuration: PropertiesConfiguration =\n      new PropertiesConfiguration()\n\n    configuration.load(inputStream, \"UTF8\")\n\n    val endpoint = configuration.getString(\"dynalite.endpoint\")\n\n    val client = new AmazonDynamoDBClient(new ProfileCredentialsProvider())\n    client.setEndpoint(endpoint)\n\n    val dynamoDB = new DynamoDB(client)\n    val table = dynamoDB.getTable(\"IotData\")\n\n    println(table.describe())\n\n    val item = new Item().withPrimaryKey(\"id\", 1).withString(\"detail\", \"sample data\")\n    List(1,2,3,4,5,6).foreach {id =>\n      val outcome = table.putItem(new Item().withInt(\"id\", id).withString(\"detail\", s\"sample data ${id}\"))\n\n      println(outcome)\n    }\n\n  }\n}\n```\n\nDynamoDB\u3078\u306e\u63a5\u7d9a\u306f\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u306b\u4e0b\u8a18\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nhttp://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/dynamodbv2/AmazonDynamoDBClient.html\n\n## 3. Controller\u4f5c\u6210\n\n```app/controllers/IotDataController.scala\npackage controllers\n\nimport models.IoTData\nimport play.api.mvc._\n\nclass IotDataController extends Controller {\n\n  def create = Action {\n    IoTData.create()\n    Ok(\"ok\")\n  }\n\n}\n```\n\n## 4. \u5b9f\u884c\u3057\u3066\u307f\u308b\n\nconsole\u3067curl\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\n```bash\ncurl -XPOST http://localhost:9000/v1/api/iot -d ''\n```\n\nplay2\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\u7d50\u679c\n\n```bash\n{AttributeDefinitions: [{AttributeName: id,AttributeType: N}, {AttributeName: detail,AttributeType: S}],TableName: IotData,KeySchema: [{AttributeName: id,KeyType: HASH}, {AttributeName: detail,KeyType: RANGE}],TableStatus: ACTIVE,CreationDateTime: Tue Feb 16 11:17:59 JST 2016,ProvisionedThroughput: {NumberOfDecreasesToday: 0,ReadCapacityUnits: 10,WriteCapacityUnits: 10},TableSizeBytes: 0,ItemCount: 0,TableArn: arn:aws:dynamodb:us-east-1:000000000000:table/IotData,}\n{}\n{}\n{}\n{}\n{}\n{}\n```\n\n\u3053\u308c\u306f\u3001\u30c7\u30fc\u30bf\u767b\u9332\u3067\u304d\u3066\u306a\u30fc\u3044\u3002\u3002\u3002\n\n## \u304a\u307e\u3051\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001dynalite\u306bputItem\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u3001issue\u3092\u8d77\u7968\u3002\n\nhttps://github.com/mhart/dynalite/issues/49\n\n\u30bd\u30fc\u30b9\u3082\u8aad\u307f\u307e\u3057\u305f\u304c\u3061\u3087\u3063\u3068\u6319\u52d5\u304c\u4e0d\u660e\u77ad\u3067\u3059\u306d\u3002\u3002\n\n### \u5229\u7528\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\n\n```create.table.js\nvar AWS = require('aws-sdk')\nAWS.config.loadFromPath('config.json');\n\nvar dynamo = new AWS.DynamoDB({region: 'us-east-1', endpoint: 'http://*.*.*.*'})\ndynamo.listTables(console.log.bind(console))\n\nvar params = {\n    TableName : \"IotData\",\n    KeySchema: [\n        { AttributeName: \"id\",     KeyType: \"HASH\"},  //Partition key\n        { AttributeName: \"detail\", KeyType: \"RANGE\" }  //Sort key\n    ],\n    AttributeDefinitions: [\n        { AttributeName: \"id\", AttributeType: \"N\" },\n        { AttributeName: \"detail\", AttributeType: \"S\" }\n    ],\n    ProvisionedThroughput: {\n        ReadCapacityUnits: 1,\n        WriteCapacityUnits: 1\n    }\n};\n```\n"}