{"context": " More than 1 year has passed since last update.SPACEWALK\u306fREDHAT\u793e\u88fd\u54c1\u30b5\u30c6\u30e9\u30a4\u30c8\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u7248\u306b\u306a\u308a\u307e\u3059\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u306f\u3082\u3061\u308d\u3093\u3001Cobbler\u3084Forman\u3068\u3044\u3063\u305f\u81ea\u52d5\u69cb\u7bc9\u30c4\u30fc\u30eb\u3068\u306e\u9023\u643a(include\u3057\u3066\u3044\u308b)\u3082\u53ef\u80fd\u3068\u306a\u3063\u3066\u304a\u308a\u3001Linux\u7d71\u5408\u7ba1\u7406\u30c4\u30fc\u30eb\u3068\u3057\u3066\u6d3b\u7528\u51fa\u6765\u305d\u3046\u3067\u3059\u3002\n\u79c1\u306fCobbler\u3092\u591a\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u7d30\u304b\u3044\u7ba1\u7406(rhel6.2\u304b\u3089\u4e0a\u3052\u305f\u304f\u306a\u3044\uff01\u3068\u304b)\u3068kickstart\u3092\u3044\u3063\u3057\u3087\u306b\u7ba1\u7406\u51fa\u6765\u308b\u306e\u306f\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002(\u3053\u306e\u30b5\u30fc\u30d0\u3067Fabric\u3084ansible\u3082\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u601d\u3063\u3066\u3044\u307e\u3059)\n\u74b0\u5883\n\nOS\u3000Fedora20\nCPU\u30002core\nMemory\u30004GB\nDISK\u3000/(root) 50GB , /var/satellite 200GB\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u3057\u3066\u683c\u7d0d\u3055\u308c\u308brpm\u306f/var/satellite\u914d\u4e0b\u306b\u4fdd\u7ba1\u3055\u308c\u307e\u3059\n\u3069\u308c\u304f\u3089\u3044\u306e\u5bb9\u91cf\u304c\u5fc5\u8981\u304b\u306f\u306a\u304b\u306a\u304b\u30b5\u30a4\u30b8\u30f3\u30b0\u3057\u3065\u3089\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001/(root)\u3068\u306f\u5225\u3067DISK\u3092\u6301\u3063\u3066\u304a\u304f\u65b9\u304c\u5f8c\u3005\u3001\u62e1\u5f35\u7b49\u306e\u904b\u7528\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059  \n\u3000\u3000\u3000\u3000\u3000\n\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\nbash# rpm -Uvh http://yum.spacewalkproject.org/2.2/Fedora/20/x86_64/spacewalk-repo-2.2-1.fc20.noarch.rpm\n\n\u3000\u3000\u3000\u3000\n\u3000\u3000\u3000\u3000\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\noracle\u3068postgres\u304c\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fpostgres\u3067\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\u53c2\u8003\u30b5\u30a4\u30c8: https://fedorahosted.org/spacewalk/wiki/PostgreSQLServerSetup\nPostgreSQL server, set up by Spacewalk (embedded)\nbash# yum install spacewalk-setup-postgresql\n\nbash# systemctl enable postgresql\n\nbash# postgresql-setup initdb\nInitializing database ... OK\n\nbash# systemctl start postgresql\n\n\u7ba1\u7406\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u30b9\u30ad\u30fc\u30de\u3092\u4f5c\u6210\u3057\u307e\u3059\n\u30e6\u30fc\u30b6\uff1aspaceadm\n\u30d1\u30b9\u30ef\u30fc\u30c9\uff1apassword\nbash# su - postgres -c 'PGPASSWORD=password; createdb -E UTF8 spaceschema ; createlang plpgsql spaceschema ; createlang pltclu spaceschema ; yes $PGPASSWORD | createuser -P -sDR spaceadm'\n\npg_hba.conf\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059(\u30e6\u30fc\u30b6\u540d\u306f\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044)\n\u8ffd\u52a0\u3059\u308b\u884c\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u884c\u3088\u308a\u524d\u306b\u8a18\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff03\u4e00\u756a\u4e0a\u306b\u8ffd\u8a18\u3067ok\u3067\u3059\n\n/var/lib/pgsql/data/pg_hba.conf\nlocal spaceschema spaceadm md5\nhost  spaceschema spaceadm 127.0.0.1/8 md5\nhost  spaceschema spaceadm ::1/128 md5\nlocal spaceschema postgres ident\n\n\nDB\u3092\u5225\u30b5\u30fc\u30d0\u3068\u3057\u305f\u3044\u5834\u5408\u306fhost\u884c\u306e\u8a2d\u5b9a\u3092Listen\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305fpostgres\u306elisten\u30a2\u30c9\u30ec\u30b9\u3082\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n/var/lib/pgsql/data/postgresql.conf\nlisten_addresses = '*'\n\n\npostgresql \u30ea\u30ed\u30fc\u30c9\nbash# systemctl reload postgresql\n\nbash# systemctl status postgresql\npostgresql.service - PostgreSQL database server\n   Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled)\n   Active: active (running) since \u571f 2014-12-20 22:30:35 JST; 7min ago\n  Process: 12832 ExecReload=/usr/bin/pg_ctl reload -D ${PGDATA} -s (code=exited, status=0/SUCCESS)\n  Process: 12732 ExecStart=/usr/bin/pg_ctl start -D ${PGDATA} -s -o -p ${PGPORT} -w -t 300 (code=exited, status=0/SUCCESS)\n  Process: 12726 ExecStartPre=/usr/bin/postgresql-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)\n Main PID: 12736 (postgres)\n   CGroup: /system.slice/postgresql.service\n           \u251c\u250012736 /usr/bin/postgres -D /var/lib/pgsql/data -p 5432\n           \u251c\u250012737 postgres: logger process   \n           \u251c\u250012739 postgres: checkpointer process   \n           \u251c\u250012740 postgres: writer process   \n           \u251c\u250012741 postgres: wal writer process   \n           \u251c\u250012742 postgres: autovacuum launcher process   \n           \u2514\u250012743 postgres: stats collector process \n\nDB\u63a5\u7d9a\u30c6\u30b9\u30c8\nbash# PGPASSWORD=password psql -a -U spaceadm spaceschema\npsql (9.3.5)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\nspaceschema=# \u3000<--- \u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u5909\u308f\u308a\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u308b\nspaceschema=# \\q\n\nbash# PGPASSWORD=password psql -h localhost -a -U spaceadm spaceschema\npsql (9.3.5)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\nspaceschema=# \nspaceschema=# \\q\n\n\nSpacewalk\u9023\u643a\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nDB\u3001\u30e6\u30fc\u30b6\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u306b\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\nbash#  spacewalk-setup-postgresql create \\\n> --db spaceschema --user spaceadm  --password password\n\n\u60c5\u5831:'systemctl enable postgresql.service'\u3078\u8ee2\u9001\u3057\u3066\u3044\u307e\u3059\u3002\nRedirecting to /bin/systemctl stop  postgresql.service\nRedirecting to /bin/systemctl start  postgresql.service\nRedirecting to /bin/systemctl reload  postgresql.service\n\nPostgres \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\nbash# yum install pgtune\n\nbash# pgtune --type=web -c 600 -i /var/lib/pgsql/data/postgresql.conf >/tmp/pgtune.conf\n\nbash# diff -u /var/lib/pgsql/data/postgresql.conf /tmp/pgtune.conf\n--- /var/lib/pgsql/data/postgresql.conf 2014-12-20 22:57:58.543134751 +0900\n+++ /tmp/pgtune.conf    2014-12-20 23:00:31.105142480 +0900\n@@ -601,11 +601,24 @@\n\n ### spacewalk-setup-postgresql modified values\n checkpoint_completion_target = 0.7\n-checkpoint_segments = 8\n-effective_cache_size = 1152MB\n+# checkpoint_segments = 8\n+# effective_cache_size = 1152MB\n log_line_prefix = '%m '\n-maintenance_work_mem = 96MB\n+# maintenance_work_mem = 96MB\n max_connections = 600\n-shared_buffers = 384MB\n-wal_buffers = 4MB\n-work_mem = 2560kB\n+# shared_buffers = 384MB\n+# wal_buffers = 4MB\n+# work_mem = 2560kB\n+\n+#----------------------------------------------------------------------\n+# pgtune run on 2014-12-20\n+# Based on 4049840 KB RAM, platform Linux\n+#----------------------------------------------------------------------\n+\n+default_statistics_target = 100\n+maintenance_work_mem = 240MB\n+effective_cache_size = 2816MB\n+work_mem = 6656kB\n+wal_buffers = 16MB\n+checkpoint_segments = 32\n+shared_buffers = 960MB\nbash# mv /var/lib/pgsql/data/postgresql.conf{,.bak}\nbash# cp /tmp/pgtune.conf /var/lib/pgsql/data/postgresql.conf\n\nbash# systemctl restart postgresql\nbash# echo max_connections = 600 >>/var/lib/pgsql/data/postgresql.conf\n\n\u3000\u3000\u3000\u3000\n\n\u3000\u3000\u3000\u3000\nSPACEWALK \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u53c2\u8003\u30b5\u30a4\u30c8: https://fedorahosted.org/spacewalk/wiki/HowToInstall\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\n\uff03\u5f8c\u304b\u3089\u3067\u3082\u8a2d\u5b9a\u51fa\u6765\u307e\u3059\u306e\u3067\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u3082\u5927\u4e08\u592b\u3067\u3059\nRed Hat Optional Server 6\nbash# cat > /etc/yum.repos.d/jpackage-generic.repo << EOF\n[jpackage-generic]\nname=JPackage generic\n#baseurl=http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/\nmirrorlist=http://www.jpackage.org/mirrorlist.php?dist=generic&type=free&release=5.0\nenabled=1\ngpgcheck=1\ngpgkey=http://www.jpackage.org/jpackage.asc\nEOF\n\npostgres\u7528spacewalk\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nbash# yum install spacewalk-postgresql \n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306b\u306fFQDN\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u306e\u3067hosts\u306b\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nFQDN\u304c\u8a2d\u5b9a\u51fa\u6765\u306a\u3044\u3088\u3046\u306a\u74b0\u5883\u3067\u306f\u5f8c\u8ff0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b3\u30de\u30f3\u30c9\u3067\u300c--skip-fqdn-test\u300d\u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u51fa\u6765\u307e\u3059\u3002\n\n/etc/hosts\n127.0.0.1       localhost \n10.210.48.32    spacewalk.local spacewalk\n\n\n\u3000\u3000\u3000\u3000\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a6\u30a3\u30b6\u30fc\u30c9\nbash# spacewalk-setup --disconnected\n** Database: Setting up database connection for PostgreSQL backend.\nDatabase \"rhnschema\" does not exist\n** Database: Installing the database:\n** Database: This is a long process that is logged in:\n** Database:   /var/log/rhn/install_db.log\n*** Progress: #\n** Database: Installation complete.\n** Database: Populating database.\n*** Progress: ####################################\n* Setting up users and groups.\n** GPG: Initializing GPG and importing key.\n** GPG: Creating /root/.gnupg directory\nYou must enter an email address.\nAdmin Email Address? root@local           # <-----------\n* Performing initial configuration.\n* Activating Spacewalk.\n** Loading Spacewalk Certificate.\n** Verifying certificate locally.\n** Activating Spacewalk.\n* Enabling Monitoring.\n* Configuring apache SSL virtual host.\nShould setup configure apaches default ssl server for you (saves original ssl.conf) [Y]?         # <-----------\n** /etc/httpd/conf.d/ssl.conf has been backed up to ssl.conf-swsave\n* Configuring tomcat.\n* Configuring jabberd.\n* Creating SSL certificates.\nCA certificate password?         # <----------- \nRe-enter CA certificate password?          # <-----------\nOrganization? ZYX          # <-----------\nOrganization Unit [spacewalk]?           # <-----------\nEmail Address [root@local]?         # <----------- \nCity? Tokyo         # <-----------\nState? JP         # <-----------\nCountry code (Examples: \"US\", \"JP\", \"IN\", or type \"?\" to see a list)? JP         # <-----------\n** SSL: Generating CA certificate.\n** SSL: Deploying CA certificate.\n** SSL: Generating server certificate.\n** SSL: Storing SSL certificates.\n* Deploying configuration files.\n* Update configuration in database.\n* Setting up Cobbler..\nProcessing /etc/cobbler/modules.conf\n`/etc/cobbler/modules.conf' -> `/etc/cobbler/modules.conf-swsave'\nProcessing /etc/cobbler/settings\n`/etc/cobbler/settings' -> `/etc/cobbler/settings-swsave'\nCobbler requires tftp and xinetd services be turned on for PXE provisioning functionality. Enable these services [Y]?         # <----------- \n* Restarting services.\nInstallation complete.\nVisit https://spacewalk to create the Spacewalk administrator account.\n\n\u79c1\u306f\u8a66\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001answer\u30d5\u30a1\u30a4\u30eb\u3067\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u53ef\u80fd\u306a\u3088\u3046\u3067\u3059\u3002\n\nanswerfile\nadmin-email = root@localhost\nssl-set-org = Spacewalk Org\nssl-set-org-unit = spacewalk\nssl-set-city = My City\nssl-set-state = My State\nssl-set-country = US\nssl-password = spacewalk\nssl-set-email = root@localhost\nssl-config-sslvhost = Y\ndb-backend=postgresql\ndb-name=spaceschema\ndb-user=spaceadm\ndb-password=password\ndb-host=localhost\ndb-port=5432\nenable-tftp=Y\n\n\nbash# spacewalk-setup --disconnected --answer-file=<FILENAME>\n\nspacewalk\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e /usr/sbin/spacewalk-service \u3092systemctl\u306b\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n/usr/lib/systemd/system/spacewalk.service\n [Unit]\nDescription=Spacewalk Service\n\n[Service]\nType=simple\nExecStart=/usr/sbin/spacewalk-service start\nExecStop=/usr/sbin/spacewalk-service stop\nExecRestart=/usr/sbin/spacewalk-service restart\nRemainAfterExit=yes\nStandardOutput=journal\n\n[Install]\nWantedBy=multi-user.target\n\n\nbash# systemctl --system daemon-reload\n\nbash# systemctl status spacewalk\nspacewalk.service - Spacewalk Service\n   Loaded: loaded (/usr/lib/systemd/system/spacewalk.service; disabled)\n   Active: inactive (dead)\n\nbash# systemctl start spacewalk\n\nbash# systemctl status spacewalk\nspacewalk.service - Spacewalk Service\n   Loaded: loaded (/usr/lib/systemd/system/spacewalk.service; disabled)\n   Active: active (exited) since \u65e5 2014-12-21 00:08:04 JST; 4s ago\n  Process: 3143 ExecStart=/usr/sbin/spacewalk-service start (code=exited, status=0/SUCCESS)\n Main PID: 3143 (code=exited, status=0/SUCCESS)\n\n12\u6708 21 00:08:04 spacewalk systemd[1]: Started Spacewalk Service.\n12\u6708 21 00:08:04 spacewalk spacewalk-service[3143]: Starting spacewalk services...\n12\u6708 21 00:08:04 spacewalk spacewalk-service[3143]: Done.\n\nbash# systemctl enable spacewalk\nln -s '/usr/lib/systemd/system/spacewalk.service' '/etc/systemd/system/multi-user.target.wants/spacewalk.service'\n\nbash# systemctl is-enabled spacewalk\nenabled\n\n\u4ee5\u4e0a\u3067\u521d\u671f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u5b8c\u4e86\u3067\u3059\u3002web\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6b63\u5e38\u306b\u5b8c\u4e86\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://(ipaddr)\n\n\u3000\u3000\u3000\u3000\n\u5225\u8a18\u4e8b\u3067\u5404\u8a2d\u5b9a\u624b\u9806\u3092\u8a18\u8f09\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n\nSPACEWALK\u306fREDHAT\u793e\u88fd\u54c1\u30b5\u30c6\u30e9\u30a4\u30c8\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u7248\u306b\u306a\u308a\u307e\u3059\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u306f\u3082\u3061\u308d\u3093\u3001Cobbler\u3084Forman\u3068\u3044\u3063\u305f\u81ea\u52d5\u69cb\u7bc9\u30c4\u30fc\u30eb\u3068\u306e\u9023\u643a(include\u3057\u3066\u3044\u308b)\u3082\u53ef\u80fd\u3068\u306a\u3063\u3066\u304a\u308a\u3001Linux\u7d71\u5408\u7ba1\u7406\u30c4\u30fc\u30eb\u3068\u3057\u3066\u6d3b\u7528\u51fa\u6765\u305d\u3046\u3067\u3059\u3002\n\u79c1\u306fCobbler\u3092\u591a\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u7d30\u304b\u3044\u7ba1\u7406(rhel6.2\u304b\u3089\u4e0a\u3052\u305f\u304f\u306a\u3044\uff01\u3068\u304b)\u3068kickstart\u3092\u3044\u3063\u3057\u3087\u306b\u7ba1\u7406\u51fa\u6765\u308b\u306e\u306f\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002(\u3053\u306e\u30b5\u30fc\u30d0\u3067Fabric\u3084ansible\u3082\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u601d\u3063\u3066\u3044\u307e\u3059)\n\n\n\u74b0\u5883\n>OS\u3000Fedora20\nCPU\u30002core\nMemory\u30004GB\nDISK\u3000/(root) 50GB , /var/satellite 200GB\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u3057\u3066\u683c\u7d0d\u3055\u308c\u308brpm\u306f/var/satellite\u914d\u4e0b\u306b\u4fdd\u7ba1\u3055\u308c\u307e\u3059\n\u3069\u308c\u304f\u3089\u3044\u306e\u5bb9\u91cf\u304c\u5fc5\u8981\u304b\u306f\u306a\u304b\u306a\u304b\u30b5\u30a4\u30b8\u30f3\u30b0\u3057\u3065\u3089\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001/(root)\u3068\u306f\u5225\u3067DISK\u3092\u6301\u3063\u3066\u304a\u304f\u65b9\u304c\u5f8c\u3005\u3001\u62e1\u5f35\u7b49\u306e\u904b\u7528\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059  \n\n\n\n\u3000\u3000\u3000\u3000\u3000\n\u30ea\u30dd\u30b8\u30c8\u30ea\u767b\u9332\n\n```bash\nbash# rpm -Uvh http://yum.spacewalkproject.org/2.2/Fedora/20/x86_64/spacewalk-repo-2.2-1.fc20.noarch.rpm\n```\n\u3000\u3000\u3000\u3000\n\u3000\u3000\u3000\u3000\n**\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\noracle\u3068postgres\u304c\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306fpostgres\u3067\u69cb\u7bc9\u3057\u307e\u3059\u3002\n*\u53c2\u8003\u30b5\u30a4\u30c8: https://fedorahosted.org/spacewalk/wiki/PostgreSQLServerSetup*\n\n*PostgreSQL server, set up by Spacewalk (embedded)*\n\n```bash\nbash# yum install spacewalk-setup-postgresql\n\nbash# systemctl enable postgresql\n\nbash# postgresql-setup initdb\nInitializing database ... OK\n\nbash# systemctl start postgresql\n```\n\n\u7ba1\u7406\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u30b9\u30ad\u30fc\u30de\u3092\u4f5c\u6210\u3057\u307e\u3059\n\u30e6\u30fc\u30b6\uff1aspaceadm\n\u30d1\u30b9\u30ef\u30fc\u30c9\uff1apassword\n\n```bash\nbash# su - postgres -c 'PGPASSWORD=password; createdb -E UTF8 spaceschema ; createlang plpgsql spaceschema ; createlang pltclu spaceschema ; yes $PGPASSWORD | createuser -P -sDR spaceadm'\n```\n\npg_hba.conf\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059(\u30e6\u30fc\u30b6\u540d\u306f\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u306b\u5408\u308f\u305b\u3066\u304f\u3060\u3055\u3044)\n\u8ffd\u52a0\u3059\u308b\u884c\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u884c\u3088\u308a\u524d\u306b\u8a18\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff03\u4e00\u756a\u4e0a\u306b\u8ffd\u8a18\u3067ok\u3067\u3059\n\n```bash:/var/lib/pgsql/data/pg_hba.conf\nlocal spaceschema spaceadm md5\nhost  spaceschema spaceadm 127.0.0.1/8 md5\nhost  spaceschema spaceadm ::1/128 md5\nlocal spaceschema postgres ident\n```\n\nDB\u3092\u5225\u30b5\u30fc\u30d0\u3068\u3057\u305f\u3044\u5834\u5408\u306fhost\u884c\u306e\u8a2d\u5b9a\u3092Listen\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305fpostgres\u306elisten\u30a2\u30c9\u30ec\u30b9\u3082\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash:/var/lib/pgsql/data/postgresql.conf\nlisten_addresses = '*'\n```\n\npostgresql \u30ea\u30ed\u30fc\u30c9\n\n```bash\nbash# systemctl reload postgresql\n\nbash# systemctl status postgresql\npostgresql.service - PostgreSQL database server\n   Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled)\n   Active: active (running) since \u571f 2014-12-20 22:30:35 JST; 7min ago\n  Process: 12832 ExecReload=/usr/bin/pg_ctl reload -D ${PGDATA} -s (code=exited, status=0/SUCCESS)\n  Process: 12732 ExecStart=/usr/bin/pg_ctl start -D ${PGDATA} -s -o -p ${PGPORT} -w -t 300 (code=exited, status=0/SUCCESS)\n  Process: 12726 ExecStartPre=/usr/bin/postgresql-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)\n Main PID: 12736 (postgres)\n   CGroup: /system.slice/postgresql.service\n           \u251c\u250012736 /usr/bin/postgres -D /var/lib/pgsql/data -p 5432\n           \u251c\u250012737 postgres: logger process   \n           \u251c\u250012739 postgres: checkpointer process   \n           \u251c\u250012740 postgres: writer process   \n           \u251c\u250012741 postgres: wal writer process   \n           \u251c\u250012742 postgres: autovacuum launcher process   \n           \u2514\u250012743 postgres: stats collector process \n```\n\nDB\u63a5\u7d9a\u30c6\u30b9\u30c8\n\n```bash\nbash# PGPASSWORD=password psql -a -U spaceadm spaceschema\npsql (9.3.5)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\nspaceschema=# \u3000<--- \u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u5909\u308f\u308a\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u308b\nspaceschema=# \\q\n\nbash# PGPASSWORD=password psql -h localhost -a -U spaceadm spaceschema\npsql (9.3.5)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\nspaceschema=# \nspaceschema=# \\q\n\n```\n\nSpacewalk\u9023\u643a\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nDB\u3001\u30e6\u30fc\u30b6\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u306b\u66f8\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n\n```bash\nbash#  spacewalk-setup-postgresql create \\\n> --db spaceschema --user spaceadm  --password password\n\n\u60c5\u5831:'systemctl enable postgresql.service'\u3078\u8ee2\u9001\u3057\u3066\u3044\u307e\u3059\u3002\nRedirecting to /bin/systemctl stop  postgresql.service\nRedirecting to /bin/systemctl start  postgresql.service\nRedirecting to /bin/systemctl reload  postgresql.service\n```\n\nPostgres \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n\n```bash\nbash# yum install pgtune\n\nbash# pgtune --type=web -c 600 -i /var/lib/pgsql/data/postgresql.conf >/tmp/pgtune.conf\n\nbash# diff -u /var/lib/pgsql/data/postgresql.conf /tmp/pgtune.conf\n--- /var/lib/pgsql/data/postgresql.conf 2014-12-20 22:57:58.543134751 +0900\n+++ /tmp/pgtune.conf    2014-12-20 23:00:31.105142480 +0900\n@@ -601,11 +601,24 @@\n \n ### spacewalk-setup-postgresql modified values\n checkpoint_completion_target = 0.7\n-checkpoint_segments = 8\n-effective_cache_size = 1152MB\n+# checkpoint_segments = 8\n+# effective_cache_size = 1152MB\n log_line_prefix = '%m '\n-maintenance_work_mem = 96MB\n+# maintenance_work_mem = 96MB\n max_connections = 600\n-shared_buffers = 384MB\n-wal_buffers = 4MB\n-work_mem = 2560kB\n+# shared_buffers = 384MB\n+# wal_buffers = 4MB\n+# work_mem = 2560kB\n+\n+#----------------------------------------------------------------------\n+# pgtune run on 2014-12-20\n+# Based on 4049840 KB RAM, platform Linux\n+#----------------------------------------------------------------------\n+\n+default_statistics_target = 100\n+maintenance_work_mem = 240MB\n+effective_cache_size = 2816MB\n+work_mem = 6656kB\n+wal_buffers = 16MB\n+checkpoint_segments = 32\n+shared_buffers = 960MB\nbash# mv /var/lib/pgsql/data/postgresql.conf{,.bak}\nbash# cp /tmp/pgtune.conf /var/lib/pgsql/data/postgresql.conf\n\nbash# systemctl restart postgresql\nbash# echo max_connections = 600 >>/var/lib/pgsql/data/postgresql.conf\n```\n\u3000\u3000\u3000\u3000\n\n---\n\u3000\u3000\u3000\u3000\n\n**SPACEWALK \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7**\n\n*\u53c2\u8003\u30b5\u30a4\u30c8: https://fedorahosted.org/spacewalk/wiki/HowToInstall*\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\n\uff03\u5f8c\u304b\u3089\u3067\u3082\u8a2d\u5b9a\u51fa\u6765\u307e\u3059\u306e\u3067\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u3082\u5927\u4e08\u592b\u3067\u3059\n\nRed Hat Optional Server 6\n\n```bash\nbash# cat > /etc/yum.repos.d/jpackage-generic.repo << EOF\n[jpackage-generic]\nname=JPackage generic\n#baseurl=http://mirrors.dotsrc.org/pub/jpackage/5.0/generic/free/\nmirrorlist=http://www.jpackage.org/mirrorlist.php?dist=generic&type=free&release=5.0\nenabled=1\ngpgcheck=1\ngpgkey=http://www.jpackage.org/jpackage.asc\nEOF\n```\n\npostgres\u7528spacewalk\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\nbash# yum install spacewalk-postgresql \n```\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306b\u306fFQDN\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u306e\u3067hosts\u306b\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nFQDN\u304c\u8a2d\u5b9a\u51fa\u6765\u306a\u3044\u3088\u3046\u306a\u74b0\u5883\u3067\u306f\u5f8c\u8ff0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b3\u30de\u30f3\u30c9\u3067\u300c--skip-fqdn-test\u300d\u3092\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u51fa\u6765\u307e\u3059\u3002\n\n```bash:/etc/hosts\n127.0.0.1       localhost \n10.210.48.32    spacewalk.local spacewalk\n```\n\u3000\u3000\u3000\u3000\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30a6\u30a3\u30b6\u30fc\u30c9\n\n```bash\nbash# spacewalk-setup --disconnected\n** Database: Setting up database connection for PostgreSQL backend.\nDatabase \"rhnschema\" does not exist\n** Database: Installing the database:\n** Database: This is a long process that is logged in:\n** Database:   /var/log/rhn/install_db.log\n*** Progress: #\n** Database: Installation complete.\n** Database: Populating database.\n*** Progress: ####################################\n* Setting up users and groups.\n** GPG: Initializing GPG and importing key.\n** GPG: Creating /root/.gnupg directory\nYou must enter an email address.\nAdmin Email Address? root@local           # <-----------\n* Performing initial configuration.\n* Activating Spacewalk.\n** Loading Spacewalk Certificate.\n** Verifying certificate locally.\n** Activating Spacewalk.\n* Enabling Monitoring.\n* Configuring apache SSL virtual host.\nShould setup configure apaches default ssl server for you (saves original ssl.conf) [Y]?         # <-----------\n** /etc/httpd/conf.d/ssl.conf has been backed up to ssl.conf-swsave\n* Configuring tomcat.\n* Configuring jabberd.\n* Creating SSL certificates.\nCA certificate password?         # <----------- \nRe-enter CA certificate password?          # <-----------\nOrganization? ZYX          # <-----------\nOrganization Unit [spacewalk]?           # <-----------\nEmail Address [root@local]?         # <----------- \nCity? Tokyo         # <-----------\nState? JP         # <-----------\nCountry code (Examples: \"US\", \"JP\", \"IN\", or type \"?\" to see a list)? JP         # <-----------\n** SSL: Generating CA certificate.\n** SSL: Deploying CA certificate.\n** SSL: Generating server certificate.\n** SSL: Storing SSL certificates.\n* Deploying configuration files.\n* Update configuration in database.\n* Setting up Cobbler..\nProcessing /etc/cobbler/modules.conf\n`/etc/cobbler/modules.conf' -> `/etc/cobbler/modules.conf-swsave'\nProcessing /etc/cobbler/settings\n`/etc/cobbler/settings' -> `/etc/cobbler/settings-swsave'\nCobbler requires tftp and xinetd services be turned on for PXE provisioning functionality. Enable these services [Y]?         # <----------- \n* Restarting services.\nInstallation complete.\nVisit https://spacewalk to create the Spacewalk administrator account.\n```\n\n\u79c1\u306f\u8a66\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001answer\u30d5\u30a1\u30a4\u30eb\u3067\u3082\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u53ef\u80fd\u306a\u3088\u3046\u3067\u3059\u3002\n\n```bash:answerfile\nadmin-email = root@localhost\nssl-set-org = Spacewalk Org\nssl-set-org-unit = spacewalk\nssl-set-city = My City\nssl-set-state = My State\nssl-set-country = US\nssl-password = spacewalk\nssl-set-email = root@localhost\nssl-config-sslvhost = Y\ndb-backend=postgresql\ndb-name=spaceschema\ndb-user=spaceadm\ndb-password=password\ndb-host=localhost\ndb-port=5432\nenable-tftp=Y\n```\n\n```bash\nbash# spacewalk-setup --disconnected --answer-file=<FILENAME>\n```\n\nspacewalk\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e /usr/sbin/spacewalk-service \u3092systemctl\u306b\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash:/usr/lib/systemd/system/spacewalk.service\n [Unit]\nDescription=Spacewalk Service\n\n[Service]\nType=simple\nExecStart=/usr/sbin/spacewalk-service start\nExecStop=/usr/sbin/spacewalk-service stop\nExecRestart=/usr/sbin/spacewalk-service restart\nRemainAfterExit=yes\nStandardOutput=journal\n\n[Install]\nWantedBy=multi-user.target\n```\n\n```bash\nbash# systemctl --system daemon-reload\n\nbash# systemctl status spacewalk\nspacewalk.service - Spacewalk Service\n   Loaded: loaded (/usr/lib/systemd/system/spacewalk.service; disabled)\n   Active: inactive (dead)\n\nbash# systemctl start spacewalk\n\nbash# systemctl status spacewalk\nspacewalk.service - Spacewalk Service\n   Loaded: loaded (/usr/lib/systemd/system/spacewalk.service; disabled)\n   Active: active (exited) since \u65e5 2014-12-21 00:08:04 JST; 4s ago\n  Process: 3143 ExecStart=/usr/sbin/spacewalk-service start (code=exited, status=0/SUCCESS)\n Main PID: 3143 (code=exited, status=0/SUCCESS)\n\n12\u6708 21 00:08:04 spacewalk systemd[1]: Started Spacewalk Service.\n12\u6708 21 00:08:04 spacewalk spacewalk-service[3143]: Starting spacewalk services...\n12\u6708 21 00:08:04 spacewalk spacewalk-service[3143]: Done.\n\nbash# systemctl enable spacewalk\nln -s '/usr/lib/systemd/system/spacewalk.service' '/etc/systemd/system/multi-user.target.wants/spacewalk.service'\n\nbash# systemctl is-enabled spacewalk\nenabled\n```\n\n\u4ee5\u4e0a\u3067\u521d\u671f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u5b8c\u4e86\u3067\u3059\u3002web\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6b63\u5e38\u306b\u5b8c\u4e86\u3057\u3066\u3044\u307e\u3059\u3002\n\nhttps://(ipaddr)\n\n![spacewalk_weblogin.png](https://qiita-image-store.s3.amazonaws.com/0/58845/e7446e89-06f9-70f1-1eba-413dcc321d4d.png)\n\u3000\u3000\u3000\u3000\n\n\n\u5225\u8a18\u4e8b\u3067\u5404\u8a2d\u5b9a\u624b\u9806\u3092\u8a18\u8f09\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n", "tags": ["spacewalk", "repository", "Cobbler", "fedora"]}