{"context": "facet_wrap()\u3067\u5206\u5272\u3057\u305f\u30b0\u30e9\u30d5\u6bce\u306b\u7570\u306a\u308b\u7d71\u8a08\u5024\u3001\u4f8b\u3048\u3070\u5e73\u5747\u5024\u3092\u66f8\u304d\u8fbc\u3080\u3053\u3068\u3092\u76ee\u6a19\u3068\u3059\u308b\u3002\n\n\u7528\u3044\u308b\u30c7\u30fc\u30bf\nmpg\u3092\u4f7f\u3044\u3001\u6392\u6c17\u91cf(displ)\u3068\u9ad8\u901f\u71c3\u8cbb(hwy)\u306e\u9593\u3067\u6563\u5e03\u56f3\u3092\u63cf\u304d\u3001\u99c6\u52d5\u65b9\u5f0f(drv)\u3067\u30b0\u30e9\u30d5\u3092\u5206\u5272\u3059\u308b\u3068\u3059\u308b\u3002\nlibrary(ggplot2)\np <- ggplot(mpg, aes(displ, hwy)) +\n  geom_point() +\n  facet_wrap(~drv) +\n  theme_bw() +\n  theme(panel.grid = element_blank())\np\n\n\n\u305d\u3057\u3066\u3001\u5404\u99c6\u52d5\u65b9\u5f0f\u5225\u306b\u5e73\u5747\u5024\u3092\u66f8\u304d\u8fbc\u307f\u305f\u3044\u3001\u3068\u3059\u308b\u3002\n\u3053\u308c\u306b\u306fannotate()\u3092\u4f7f\u3046\u3002annotate()\u306f\u5206\u5272\u3055\u308c\u305f\u30b0\u30e9\u30d5\u306b\u4f7f\u3046\u5834\u5408\u3001\u5206\u5272\u3055\u308c\u305f\u679a\u6570\u3068\u540c\u3058\u9577\u3055\u306e\u30d9\u30af\u30c8\u30eb\u3092\u4e0e\u3048\u308b\u3068\u3001\u305d\u308c\u305e\u308c\u306b\u5bfe\u5fdc\u3057\u305f\u5024\u3092\u66f8\u304d\u8fbc\u3080\u3002\n\u3057\u305f\u304c\u3063\u3066\u2026\n\n\u96c6\u8a08\u3057\u3001\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u3059\u308b\n\u307e\u305a\u306f\u30c7\u30fc\u30bf\u3092\u96c6\u8a08\u3057\u3001\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30b0\u30e9\u30d5\u3092\u5206\u5272\u3059\u308b\u65b9\u6cd5\u306b\u5bfe\u5fdc\u3059\u308b\u3088\u3046\u306b\u96c6\u8a08\u3059\u308b\u3002\u3064\u307e\u308adrv\u3067\u5206\u5272\u3059\u308b\u306e\u3067\u3042\u308c\u3070drv\u3067group\u3092\u4f5c\u3063\u3066\u96c6\u8a08\u3059\u308b\u3002\nlibrary(dplyr)\na <- mpg %>%\n  group_by(drv) %>%\n  summarize(average = mean(hwy)) %>%\n  apply(1, function(x){paste(\"average:\", sprintf(\"%.1f\", as.double(x[2])))})\n\n\nplot\u3059\u308b\n\u3042\u3068\u306f\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u3092annotate()\u306b\u4e0e\u3048\u308b\u3002\np + annotate(\"text\", label = a, x = 7, y = 40, adj = \"right\")\n\n\n\n\u8868\u5f62\u5f0f\u3067\u66f8\u304d\u8fbc\u307f\u305f\u3044\u5834\u5408\n## function ----\nsvp <- function(t){ # \u98fd\u548c\u6c34\u84b8\u6c17\u5727\u8a08\u7b97 Alduchov and Eskridge(1996)\n  ifelse(t > 0,\n         6.1094 * exp(17.625 * t / (243.04 + t)),\n         6.1121 * exp(22.587 * t / (273.86 + t)))\n}\nvpd <- function(t, RH){ #\u98fd\u5dee\uff08VPD\uff1a\u6c34\u84b8\u6c17\u5206\u5727\u5dee\uff09\n  svp(t) * (1 - RH/100)\n}\n\n## data ----\nstart <- as.POSIXct(\"2017/1/1\", tz = \"UTC\")\nend <- as.POSIXct(\"2017/1/4\", tz = \"UTC\")\nTime <- seq(start, end, by = \"10 min\") # \u6642\u9593\nTemp <- sin(seq(0, 3*pi, len = length(Time)) + runif(length(Time))*0.1) * 7 + 10 # \u6c17\u6e29\nRH <- cos(seq(0, 3*2*pi, len = length(Time)) + runif(length(Time))*0.2) * 5 + 60    # \u76f8\u5bfe\u6e7f\u5ea6\nVPD <- vpd(Temp, RH) # \u98fd\u5dee(VPD)\n\n\n# \u30c6\u30ad\u30b9\u30c8\u7528\u306b\u30c7\u30fc\u30bf\u3092\u96c6\u8a08\ntmp <- filter(ondo, day >= start, day <= end) %>%\ntmp <- cbind(round(tmp[,2:10],1))\n\n# \u65e5\u4ed8\u3054\u3068\u306b\u30e9\u30d9\u30eb\u3092\u751f\u6210\ndf <- data.frame(Time, day = as.Date(Time), Temp, RH, VPD)\ndf <- df[-nrow(df),]\ndf_summary <- df %>% group_by(day) %>%\n  summarize(tmax = max(Temp), tmean = mean(Temp), tmin = min(Temp),\n            rmax = max(RH),   rmean = mean(RH),   rmin = min(RH),\n            dmax = max(VPD),  dmean = mean(VPD),  dmin = min(VPD))\ndf_summary <- df_summary[,-1]\nlab <- apply(df_summary, MARGIN = 1,\n             function(x){\n               x <- sprintf(\"%5.1f\", x)\n               paste(\n                 \"\u6700\u9ad8\u3000\",  \"\u5e73\u5747\u3000\", \"\u6700\u4f4e\\n\",\n                 \"\u76f8\u5bfe\u6e7f\u5ea6 \", x[4], \" \", x[5], \" \", x[6], \"\\n\",\n                 \"\u6c17\u6e29 \",     x[1], \" \", x[2], \" \", x[3], \"\\n\",\n                 \"\u98fd\u5dee \",     x[7], \" \", x[8], \" \", x[9],  sep = \"\"\n               )})\n\ngather(df, key = param, value = val, -Time, -day) %>%\n  ggplot(aes(x = as.POSIXlt(Time)$hour + as.POSIXlt(Time)$min/60, y = val, col = param)) +\n  geom_line() +\n  scale_y_continuous(limits = c(0,100)) +\n  annotate(\"text\", label = lab, x = 24, y = 90, family = \"Osaka-Mono\", adj = \"right\") +\n  facet_wrap(~day) +\n  theme_bw()\n\n\nannotation_custom()\u3067\u306a\u3093\u3068\u304b\u306a\u3089\u306a\u3044\u304b\u3068\u601d\u3063\u305f\u3051\u3069\u3088\u304f\u308f\u304b\u3089\u305a\u7d50\u5c40\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u62bc\u3057\u8fbc\u3081\u308b\u3068\u3044\u3046\u529b\u6280\u3067\u89e3\u6c7a\u3057\u3066\u3057\u307e\u3063\u305f\u2026\u3002\n\u7e26\u306b\u63c3\u3048\u305f\u3044\u5834\u5408\u306fsprintf()\u3067\u6574\u5f62\u3057\u3066\u7b49\u5e45\u30d5\u30a9\u30f3\u30c8\u3092\u4f7f\u3046\u306e\u304c\u30dd\u30a4\u30f3\u30c8\u3002\n`facet_wrap()`\u3067\u5206\u5272\u3057\u305f\u30b0\u30e9\u30d5\u6bce\u306b\u7570\u306a\u308b\u7d71\u8a08\u5024\u3001\u4f8b\u3048\u3070\u5e73\u5747\u5024\u3092\u66f8\u304d\u8fbc\u3080\u3053\u3068\u3092\u76ee\u6a19\u3068\u3059\u308b\u3002\n\n# \u7528\u3044\u308b\u30c7\u30fc\u30bf\n\n`mpg`\u3092\u4f7f\u3044\u3001\u6392\u6c17\u91cf(displ)\u3068\u9ad8\u901f\u71c3\u8cbb(hwy)\u306e\u9593\u3067\u6563\u5e03\u56f3\u3092\u63cf\u304d\u3001\u99c6\u52d5\u65b9\u5f0f(drv)\u3067\u30b0\u30e9\u30d5\u3092\u5206\u5272\u3059\u308b\u3068\u3059\u308b\u3002\n\n```r\nlibrary(ggplot2)\np <- ggplot(mpg, aes(displ, hwy)) +\n  geom_point() +\n  facet_wrap(~drv) +\n  theme_bw() +\n  theme(panel.grid = element_blank())\np\n```\n\n![Rplot001.png](https://qiita-image-store.s3.amazonaws.com/0/109348/3fc4e926-b384-ca13-d889-95254141aa10.png)\n\n\u305d\u3057\u3066\u3001\u5404\u99c6\u52d5\u65b9\u5f0f\u5225\u306b\u5e73\u5747\u5024\u3092\u66f8\u304d\u8fbc\u307f\u305f\u3044\u3001\u3068\u3059\u308b\u3002\n\n\u3053\u308c\u306b\u306f`annotate()`\u3092\u4f7f\u3046\u3002`annotate()`\u306f\u5206\u5272\u3055\u308c\u305f\u30b0\u30e9\u30d5\u306b\u4f7f\u3046\u5834\u5408\u3001\u5206\u5272\u3055\u308c\u305f\u679a\u6570\u3068\u540c\u3058\u9577\u3055\u306e\u30d9\u30af\u30c8\u30eb\u3092\u4e0e\u3048\u308b\u3068\u3001\u305d\u308c\u305e\u308c\u306b\u5bfe\u5fdc\u3057\u305f\u5024\u3092\u66f8\u304d\u8fbc\u3080\u3002\n\u3057\u305f\u304c\u3063\u3066\u2026\n\n# \u96c6\u8a08\u3057\u3001\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u3059\u308b\n\n\u307e\u305a\u306f\u30c7\u30fc\u30bf\u3092\u96c6\u8a08\u3057\u3001\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30b0\u30e9\u30d5\u3092\u5206\u5272\u3059\u308b\u65b9\u6cd5\u306b\u5bfe\u5fdc\u3059\u308b\u3088\u3046\u306b\u96c6\u8a08\u3059\u308b\u3002\u3064\u307e\u308a`drv`\u3067\u5206\u5272\u3059\u308b\u306e\u3067\u3042\u308c\u3070`drv`\u3067group\u3092\u4f5c\u3063\u3066\u96c6\u8a08\u3059\u308b\u3002\n\n```r\nlibrary(dplyr)\na <- mpg %>%\n  group_by(drv) %>%\n  summarize(average = mean(hwy)) %>%\n  apply(1, function(x){paste(\"average:\", sprintf(\"%.1f\", as.double(x[2])))})\n```\n\n# plot\u3059\u308b\n\n\u3042\u3068\u306f\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u3092`annotate()`\u306b\u4e0e\u3048\u308b\u3002\n\n```r\np + annotate(\"text\", label = a, x = 7, y = 40, adj = \"right\")\n```\n\n![Rplot002.png](https://qiita-image-store.s3.amazonaws.com/0/109348/9053f61c-15e3-2b56-4994-bd4f3222db14.png)\n\n# \u8868\u5f62\u5f0f\u3067\u66f8\u304d\u8fbc\u307f\u305f\u3044\u5834\u5408\n\n```r\n## function ----\nsvp <- function(t){ # \u98fd\u548c\u6c34\u84b8\u6c17\u5727\u8a08\u7b97 Alduchov and Eskridge(1996)\n  ifelse(t > 0,\n         6.1094 * exp(17.625 * t / (243.04 + t)),\n         6.1121 * exp(22.587 * t / (273.86 + t)))\n}\nvpd <- function(t, RH){ #\u98fd\u5dee\uff08VPD\uff1a\u6c34\u84b8\u6c17\u5206\u5727\u5dee\uff09\n  svp(t) * (1 - RH/100)\n}\n\n## data ----\nstart <- as.POSIXct(\"2017/1/1\", tz = \"UTC\")\nend <- as.POSIXct(\"2017/1/4\", tz = \"UTC\")\nTime <- seq(start, end, by = \"10 min\") # \u6642\u9593\nTemp <- sin(seq(0, 3*pi, len = length(Time)) + runif(length(Time))*0.1) * 7 + 10 # \u6c17\u6e29\nRH <- cos(seq(0, 3*2*pi, len = length(Time)) + runif(length(Time))*0.2) * 5 + 60    # \u76f8\u5bfe\u6e7f\u5ea6\nVPD <- vpd(Temp, RH) # \u98fd\u5dee(VPD)\n\n\n# \u30c6\u30ad\u30b9\u30c8\u7528\u306b\u30c7\u30fc\u30bf\u3092\u96c6\u8a08\ntmp <- filter(ondo, day >= start, day <= end) %>%\ntmp <- cbind(round(tmp[,2:10],1))\n\n# \u65e5\u4ed8\u3054\u3068\u306b\u30e9\u30d9\u30eb\u3092\u751f\u6210\ndf <- data.frame(Time, day = as.Date(Time), Temp, RH, VPD)\ndf <- df[-nrow(df),]\ndf_summary <- df %>% group_by(day) %>%\n  summarize(tmax = max(Temp), tmean = mean(Temp), tmin = min(Temp),\n            rmax = max(RH),   rmean = mean(RH),   rmin = min(RH),\n            dmax = max(VPD),  dmean = mean(VPD),  dmin = min(VPD))\ndf_summary <- df_summary[,-1]\nlab <- apply(df_summary, MARGIN = 1,\n             function(x){\n               x <- sprintf(\"%5.1f\", x)\n               paste(\n                 \"\u6700\u9ad8\u3000\",  \"\u5e73\u5747\u3000\", \"\u6700\u4f4e\\n\",\n                 \"\u76f8\u5bfe\u6e7f\u5ea6 \", x[4], \" \", x[5], \" \", x[6], \"\\n\",\n                 \"\u6c17\u6e29 \",     x[1], \" \", x[2], \" \", x[3], \"\\n\",\n                 \"\u98fd\u5dee \",     x[7], \" \", x[8], \" \", x[9],  sep = \"\"\n               )})\n\ngather(df, key = param, value = val, -Time, -day) %>%\n  ggplot(aes(x = as.POSIXlt(Time)$hour + as.POSIXlt(Time)$min/60, y = val, col = param)) +\n  geom_line() +\n  scale_y_continuous(limits = c(0,100)) +\n  annotate(\"text\", label = lab, x = 24, y = 90, family = \"Osaka-Mono\", adj = \"right\") +\n  facet_wrap(~day) +\n  theme_bw()\n```\n\n![Rplot003.png](https://qiita-image-store.s3.amazonaws.com/0/109348/8e86fe2f-7901-218e-4c2b-5c9646d65776.png)\n\n`annotation_custom()`\u3067\u306a\u3093\u3068\u304b\u306a\u3089\u306a\u3044\u304b\u3068\u601d\u3063\u305f\u3051\u3069\u3088\u304f\u308f\u304b\u3089\u305a\u7d50\u5c40\u6587\u5b57\u5217\u30d9\u30af\u30c8\u30eb\u306b\u62bc\u3057\u8fbc\u3081\u308b\u3068\u3044\u3046\u529b\u6280\u3067\u89e3\u6c7a\u3057\u3066\u3057\u307e\u3063\u305f\u2026\u3002\n\u7e26\u306b\u63c3\u3048\u305f\u3044\u5834\u5408\u306f`sprintf()`\u3067\u6574\u5f62\u3057\u3066\u7b49\u5e45\u30d5\u30a9\u30f3\u30c8\u3092\u4f7f\u3046\u306e\u304c\u30dd\u30a4\u30f3\u30c8\u3002\n", "tags": ["R", "ggplot2"]}