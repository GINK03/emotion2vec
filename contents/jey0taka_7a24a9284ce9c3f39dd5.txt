{"context": " More than 1 year has passed since last update.\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\n\nnaxsi-core\n\n\u30b3\u30de\u30f3\u30c9\ncd /usr/local/src/\nwget https://naxsi.googlecode.com/files/naxsi-core-0.49.tgz\ntar zxvf naxsi-core-0.49.tgz\n\n\n\nnaxsi_util\n\n\u30b3\u30de\u30f3\u30c9\ncd /usr/local/src\nwget https://naxsi.googlecode.com/files/nx_util-1.1.tgz\ntar zxvf nx_util-1.1.tgz cd nx_util-1.1\n\n\n\nNginx\u3078\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8ffd\u52a0\n\n\u30b3\u30de\u30f3\u30c9\ncd /uer/local/src/nginx-1.5.9/\n./configure --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_stub_status_module --add-module=../naxsi-core-0.49/naxsi_src/\nmake\nmaike install\n\n\n\n\u6e96\u5099\n\n\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30eb\u306e\u8ffd\u52a0\n\n\u30b3\u30de\u30f3\u30c9\ncp -rp /usr/local/src/naxsi-core-0.49/naxsi_config/naxsi_core.rules /usr/local/nginx/conf/\n\n\n\nnx_util\u3092\u30b3\u30d4\u30fc\n\n\u30b3\u30de\u30f3\u30c9\ncp -rp /usr/local/src/nx_util-1.1/nx_util/ /usr/local/nginx/\n\n\n\nnx_util\u306e\u8a2d\u5b9a\n\n/usr/local/nginx/nx_util/nx_util.conf\n[nx_util]\ndata_dir=/usr/local/nginx/nx_util/nx_datas\ndatabase_dir=\nnaxsi_core_rules=/usr/local/nginx/conf/naxsi_core.rules\n\n\n\nNginx\u306e\u8a2d\u5b9a\n\n\u5b66\u7fd2\u30e2\u30fc\u30c9\n\n/usr/local/nginx/conf/nginx.conf\nhttp {\n     #Naxsi\u306e\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30eb\n     include        /usr/local/nginx/conf/naxsi_core.rules;\n\n     server {\n          listen       80;\n          server_name  hogehoge.com;\n\n          access_log   /var/log/nginx/hogehoge.com_access80.log main;\n          error_log    /var/log/nginx/hogehoge.com_error80.log debug;\n          #\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u201ddebug\u201d\u306b\u3057\u306a\u3044\u3068\u3001\u30eb\u30fc\u30eb\u306e\u751f\u6210\u304c\u884c\u308f\u308c\u306a\u3044\u306e\u3067\u6ce8\u610f\n          #error_log    /var/log/nginx/hogehoge.com_error80.log warn;\n\n          location / {\n               proxy_pass http://127.0.0.1:8080/;\n               proxy_set_header Host hogehoge.com;\n\n               #\u5b66\u7fd2\u30e2\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3059\u308b\n               LearningMode;\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000#\u81ea\u52d5\u5b66\u7fd2\u3057\u305f\u30eb\u30fc\u30eb\u306f\u4e00\u65e6\u8aad\u307f\u8fbc\u307e\u305b\u306a\u3044(\u307e\u3060\u4f55\u3082\u306a\u3044)\n               #include /usr/local/nginx/conf/my.rules;\n\n               SecRulesEnabled;\n               #SecRulesDisabled;\n               DeniedUrl \"/RequestDenied\";\n\n               #\u3057\u304d\u3044\u5024\u306e\u8a2d\u5b9a\n               ## check rules ##\n               CheckRule \"$SQL >= 8\" BLOCK;\n               CheckRule \"$RFI >= 8\" BLOCK;\n               CheckRule \"$TRAVERSAL >= 4\" BLOCK;\n               CheckRule \"$EVADE >= 4\" BLOCK;\n               CheckRule \"$XSS >= 8\" BLOCK;\n               ############\n          }\n          #\u30ea\u30b8\u30a7\u30af\u30c8\u3055\u308c\u305f\u969b\u306e\u30da\u30fc\u30b8\n          location /RequestDenied {\n               return 500;\n          }\n     }\n\n\n\nNginx\u306e\u518d\u8d77\u52d5\n\n\u30b3\u30de\u30f3\u30c9\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u8a3c\n/etc/init.d/nginx configtest\n#\u518d\u8d77\u52d5\n/etc/init.d/nginx restart\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d \u5b66\u7fd2\u30eb\u30fc\u30eb\u306e\u751f\u6210\n\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u304b\u3089\u8a72\u5f53\u306e\u30da\u30fc\u30b8\u30d8\u63a5\u7d9a\u3092\u884c\u3046\n\u30a8\u30e9\u30fc\u30ed\u30b0\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u3066\u3044\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\n\n\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\n2014/02/01 15:58:42 [alert] 9671#0: *5 header already sent, client: 111.222.333.111, server: hogehoge.com, request: \"GET /concrete/css/ccm.base.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", upstream: \"http://127.0.0.1:8080/concrete/css/ccm.base.css?v=c83aebd08ed4da35e834b3353901f784\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n2014/02/01 15:58:42 [alert] 9671#0: *6 header already sent, client: 111.222.333.111, server: hogehoge.com, request: \"GET /packages/image_slider/blocks/image_slider/css/easyslider.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", upstream: \"http://127.0.0.1:8080/packages/image_slider/blocks/image_slider/css/easyslider.css?v=c83aebd08ed4da35e834b3353901f784\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n2014/02/01 15:58:42 [error] 9671#0: *11 NAXSI_FMT: ip=111.222.333.111&server=hogehoge.com&uri=/packages/image_slider/blocks/image_slider/css/gallery.css&learning=1&total_processed=4&total_blocked=4&zone0=HEADERS&id0=1005&var_name0=cookie&zone1=HEADERS&id1=1010&var_name1=cookie&zone2=HEADERS&id2=1011&var_name2=cookie&zone3=HEADERS&id3=1315&var_name3=cookie, client: 111.222.333.111, server: hogehoge.com, request: \"GET /packages/image_slider/blocks/image_slider/css/gallery.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n\n\n\u30ed\u30b0\u306e\u51fa\u529b\u5f8c\u3001\u60f3\u5b9a\u3055\u308c\u308b\u6319\u52d5\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u884c\u3046\n\n\u30eb\u30fc\u30eb\u306e\u751f\u6210\npython /usr/local/nginx/nx_util/nx_util.py -c /usr/local/nginx/nx_util/nx_util.conf -l /var/log/nginx/hogehoge.com_error80.log -o > /usr/local/nginx/conf/my.rules\n\n\n\n\u30ec\u30dd\u30fc\u30c8\u306e\u751f\u6210\npython /usr/local/nginx/nx_util/nx_util.py -c /usr/local/nginx/nx_util/nx_util.conf -H /home/hoge/public_html/report.html\n\n\n\n\u6700\u65b0\u306e\u30ed\u30b0\u306e\u53cd\u6620\npython /usr/local/nginx/nx_util/nx_util.py -i -c /usr/local/nginx/nx_util/nx_util.conf -l /var/log/nginx/hogehoge.com_error80.log\n\n\n\n\u672c\u756a\u8a2d\u5b9a\n\n/usr/local/nginx/conf/nginx.conf\nhttp {\n\n     server {\n\n          #error_log    /var/log/nginx/hogehoge.com_error80.log debug;\n          error_log    /var/log/nginx/hogehoge_error80.log warn;\n\n          location / {\n\n               #LearningMode; #Enables learning mode\n               #\u81ea\u52d5\u5b66\u7fd2\u30e2\u30fc\u30c9\u3092OFF\n               include /usr/local/nginx/conf/my.rules;\n               #\u81ea\u52d5\u5b66\u7fd2\u3057\u305f\u30eb\u30fc\u30eb\u3092\u53cd\u6620\n          }\n     }\n\n\n\nNginx\u306e\u518d\u8d77\u52d5\n\n\u30b3\u30de\u30f3\u30c9\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u8a3c\n/etc/init.d/nginx configtest\n#\u518d\u8d77\u52d5\n/etc/init.d/nginx restart\n\n\n#\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\n##naxsi-core\n```bash:\u30b3\u30de\u30f3\u30c9\ncd /usr/local/src/\nwget https://naxsi.googlecode.com/files/naxsi-core-0.49.tgz\ntar zxvf naxsi-core-0.49.tgz\n```\n##naxsi_util\n```bash:\u30b3\u30de\u30f3\u30c9\ncd /usr/local/src\nwget https://naxsi.googlecode.com/files/nx_util-1.1.tgz\ntar zxvf nx_util-1.1.tgz cd nx_util-1.1\n```\n\n#Nginx\u3078\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8ffd\u52a0\n```bash:\u30b3\u30de\u30f3\u30c9\ncd /uer/local/src/nginx-1.5.9/\n./configure --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_stub_status_module --add-module=../naxsi-core-0.49/naxsi_src/\nmake\nmaike install\n```\n\n#\u6e96\u5099\n\n##\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30eb\u306e\u8ffd\u52a0\n```bash:\u30b3\u30de\u30f3\u30c9\ncp -rp /usr/local/src/naxsi-core-0.49/naxsi_config/naxsi_core.rules /usr/local/nginx/conf/\n```\n\n#nx_util\u3092\u30b3\u30d4\u30fc\n```bash:\u30b3\u30de\u30f3\u30c9\ncp -rp /usr/local/src/nx_util-1.1/nx_util/ /usr/local/nginx/\n``` \n\n#nx_util\u306e\u8a2d\u5b9a\n```nginx:/usr/local/nginx/nx_util/nx_util.conf\n[nx_util]\ndata_dir=/usr/local/nginx/nx_util/nx_datas\ndatabase_dir=\nnaxsi_core_rules=/usr/local/nginx/conf/naxsi_core.rules\n```\n\n#Nginx\u306e\u8a2d\u5b9a\n##\u5b66\u7fd2\u30e2\u30fc\u30c9\n```nginx:/usr/local/nginx/conf/nginx.conf\nhttp {\n     #Naxsi\u306e\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30eb\n     include        /usr/local/nginx/conf/naxsi_core.rules;\n     \n     server {\n          listen       80;\n          server_name  hogehoge.com;\n          \n          access_log   /var/log/nginx/hogehoge.com_access80.log main;\n          error_log    /var/log/nginx/hogehoge.com_error80.log debug;\n          #\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u201ddebug\u201d\u306b\u3057\u306a\u3044\u3068\u3001\u30eb\u30fc\u30eb\u306e\u751f\u6210\u304c\u884c\u308f\u308c\u306a\u3044\u306e\u3067\u6ce8\u610f\n          #error_log    /var/log/nginx/hogehoge.com_error80.log warn;\n          \n          location / {\n               proxy_pass http://127.0.0.1:8080/;\n               proxy_set_header Host hogehoge.com;\n\n               #\u5b66\u7fd2\u30e2\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3059\u308b\n               LearningMode;\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000#\u81ea\u52d5\u5b66\u7fd2\u3057\u305f\u30eb\u30fc\u30eb\u306f\u4e00\u65e6\u8aad\u307f\u8fbc\u307e\u305b\u306a\u3044(\u307e\u3060\u4f55\u3082\u306a\u3044)\n               #include /usr/local/nginx/conf/my.rules;\n               \n               SecRulesEnabled;\n               #SecRulesDisabled;\n               DeniedUrl \"/RequestDenied\";\n          \n               #\u3057\u304d\u3044\u5024\u306e\u8a2d\u5b9a\n               ## check rules ##\n               CheckRule \"$SQL >= 8\" BLOCK;\n               CheckRule \"$RFI >= 8\" BLOCK;\n               CheckRule \"$TRAVERSAL >= 4\" BLOCK;\n               CheckRule \"$EVADE >= 4\" BLOCK;\n               CheckRule \"$XSS >= 8\" BLOCK;\n               ############\n          }\n          #\u30ea\u30b8\u30a7\u30af\u30c8\u3055\u308c\u305f\u969b\u306e\u30da\u30fc\u30b8\n          location /RequestDenied {\n               return 500;\n          }\n     }\n```\n###Nginx\u306e\u518d\u8d77\u52d5\n```bash:\u30b3\u30de\u30f3\u30c9\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u8a3c\n/etc/init.d/nginx configtest\n#\u518d\u8d77\u52d5\n/etc/init.d/nginx restart\n```\n\n###\u52d5\u4f5c\u78ba\u8a8d \u5b66\u7fd2\u30eb\u30fc\u30eb\u306e\u751f\u6210\n\u30d6\u30e9\u30a6\u30b6\u306a\u3069\u304b\u3089\u8a72\u5f53\u306e\u30da\u30fc\u30b8\u30d8\u63a5\u7d9a\u3092\u884c\u3046\n\u30a8\u30e9\u30fc\u30ed\u30b0\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u3066\u3044\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\n\n```bash:\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\n2014/02/01 15:58:42 [alert] 9671#0: *5 header already sent, client: 111.222.333.111, server: hogehoge.com, request: \"GET /concrete/css/ccm.base.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", upstream: \"http://127.0.0.1:8080/concrete/css/ccm.base.css?v=c83aebd08ed4da35e834b3353901f784\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n2014/02/01 15:58:42 [alert] 9671#0: *6 header already sent, client: 111.222.333.111, server: hogehoge.com, request: \"GET /packages/image_slider/blocks/image_slider/css/easyslider.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", upstream: \"http://127.0.0.1:8080/packages/image_slider/blocks/image_slider/css/easyslider.css?v=c83aebd08ed4da35e834b3353901f784\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n2014/02/01 15:58:42 [error] 9671#0: *11 NAXSI_FMT: ip=111.222.333.111&server=hogehoge.com&uri=/packages/image_slider/blocks/image_slider/css/gallery.css&learning=1&total_processed=4&total_blocked=4&zone0=HEADERS&id0=1005&var_name0=cookie&zone1=HEADERS&id1=1010&var_name1=cookie&zone2=HEADERS&id2=1011&var_name2=cookie&zone3=HEADERS&id3=1315&var_name3=cookie, client: 111.222.333.111, server: hogehoge.com, request: \"GET /packages/image_slider/blocks/image_slider/css/gallery.css?v=c83aebd08ed4da35e834b3353901f784 HTTP/1.1\", host: \"hogehoge.com\", referrer: \"http://hogehoge.com/\"\n```\n\n\u30ed\u30b0\u306e\u51fa\u529b\u5f8c\u3001\u60f3\u5b9a\u3055\u308c\u308b\u6319\u52d5\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u884c\u3046\n\n```bash:\u30eb\u30fc\u30eb\u306e\u751f\u6210\npython /usr/local/nginx/nx_util/nx_util.py -c /usr/local/nginx/nx_util/nx_util.conf -l /var/log/nginx/hogehoge.com_error80.log -o > /usr/local/nginx/conf/my.rules\n```\n\n```bash:\u30ec\u30dd\u30fc\u30c8\u306e\u751f\u6210\npython /usr/local/nginx/nx_util/nx_util.py -c /usr/local/nginx/nx_util/nx_util.conf -H /home/hoge/public_html/report.html\n```\n\n```bash:\u6700\u65b0\u306e\u30ed\u30b0\u306e\u53cd\u6620\npython /usr/local/nginx/nx_util/nx_util.py -i -c /usr/local/nginx/nx_util/nx_util.conf -l /var/log/nginx/hogehoge.com_error80.log\n```\n\n##\u672c\u756a\u8a2d\u5b9a\n```/usr/local/nginx/conf/nginx.conf\nhttp {\n     \n     server {\n\n          #error_log    /var/log/nginx/hogehoge.com_error80.log debug;\n          error_log    /var/log/nginx/hogehoge_error80.log warn;\n          \n          location / {\n          \n               #LearningMode; #Enables learning mode\n               #\u81ea\u52d5\u5b66\u7fd2\u30e2\u30fc\u30c9\u3092OFF\n               include /usr/local/nginx/conf/my.rules;\n               #\u81ea\u52d5\u5b66\u7fd2\u3057\u305f\u30eb\u30fc\u30eb\u3092\u53cd\u6620\n          }\n     }\n```\n###Nginx\u306e\u518d\u8d77\u52d5\n```bash:\u30b3\u30de\u30f3\u30c9\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u8a3c\n/etc/init.d/nginx configtest\n#\u518d\u8d77\u52d5\n/etc/init.d/nginx restart\n```\n", "tags": ["nginx", "waf"]}