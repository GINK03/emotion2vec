{"context": "\n\nansible-playbook \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\n\nsudo \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u78ba\u8a8d\nansible-playbook --ask-become-pass main.yml\nansible-playbook --ask-sudo-pass main.yml #when using sudo instead of become\n\n\nplaybook \u3067\u4f7f\u3046\n\nHosts and Users\nhosts\u3067\u30db\u30b9\u30c8\u3084\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3001remote_user\u3067\u30ea\u30e2\u30fc\u30c8\u30e6\u30fc\u30b6\u3092\u6307\u5b9a.\n\u6307\u5b9a\u306b\u306f\u30d1\u30bf\u30fc\u30f3\u304c\u4f7f\u3048\u308b.\n---\n- hosts: webservers\n  remote_user: root\n\nremote_user \u306fversion 1.4 \u304b\u3089task \u3067\u3082\u6307\u5b9a\u3067\u304d\u308b.\n\ntask\u3067\u4f7f\u3046\n\nregister\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51fa\u529b\u3092\u5909\u6570\u306b\u683c\u7d0d\u3059\u308b\n- name: hogehoge\n  yum: name=vim state=latest\n  register: ret\n\n\nfailed_when\nansible \u3067\u306f\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u304c0\u4ee5\u5916\u306e\u3082\u306e\u3092\u30a8\u30e9\u30fc\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b.\nfailed_when \u306f\u3053\u308c\u3092\u5909\u66f4\u3057\u3001\u30a8\u30e9\u30fc\u3068\u306a\u308b\u6761\u4ef6\u5f0f\u3092\u30e6\u30fc\u30b6\u304c\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b.\n- name: hogehoge\n  yum: name=emacs state=latest\n  register: ret\n  failed_when: ret not in [0, 1]\n\n\nignore_errors\n\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u3066\u3082\u505c\u6b62\u3057\u306a\u3044\n- shell: cat /\n  ignore_errors: True\n\n\nRef\n\nansible \u306eshell \u3067\u51aa\u7b49\u6027\u3092\u4fdd\u3064\n\n#ansible-playbook \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\n## sudo \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u78ba\u8a8d\n```\nansible-playbook --ask-become-pass main.yml\nansible-playbook --ask-sudo-pass main.yml #when using sudo instead of become\n```\n\n#playbook \u3067\u4f7f\u3046\n##Hosts and Users\n`hosts`\u3067\u30db\u30b9\u30c8\u3084\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3001`remote_user`\u3067\u30ea\u30e2\u30fc\u30c8\u30e6\u30fc\u30b6\u3092\u6307\u5b9a.\n\u6307\u5b9a\u306b\u306f[\u30d1\u30bf\u30fc\u30f3](https://docs.ansible.com/ansible/intro_patterns.html)\u304c\u4f7f\u3048\u308b.\n\n```\n---\n- hosts: webservers\n  remote_user: root\n```\n`remote_user` \u306fversion 1.4 \u304b\u3089task \u3067\u3082\u6307\u5b9a\u3067\u304d\u308b.\n\n\n#task\u3067\u4f7f\u3046\n##register\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51fa\u529b\u3092\u5909\u6570\u306b\u683c\u7d0d\u3059\u308b\n\n```\n- name: hogehoge\n  yum: name=vim state=latest\n  register: ret\n```\n\n##failed_when\nansible \u3067\u306f\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u304c0\u4ee5\u5916\u306e\u3082\u306e\u3092\u30a8\u30e9\u30fc\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b.\nfailed_when \u306f\u3053\u308c\u3092\u5909\u66f4\u3057\u3001\u30a8\u30e9\u30fc\u3068\u306a\u308b\u6761\u4ef6\u5f0f\u3092\u30e6\u30fc\u30b6\u304c\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b.\n\n```\n- name: hogehoge\n  yum: name=emacs state=latest\n  register: ret\n  failed_when: ret not in [0, 1]\n```\n\n##ignore_errors\n\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u3066\u3082\u505c\u6b62\u3057\u306a\u3044\n\n```\n- shell: cat /\n  ignore_errors: True\n```\n\n#Ref\n- [ansible \u306eshell \u3067\u51aa\u7b49\u6027\u3092\u4fdd\u3064](http://sisidovski.hatenablog.com/entry/2015/01/27/033933)\n", "tags": ["Ansible", "ansible-playbook"]}