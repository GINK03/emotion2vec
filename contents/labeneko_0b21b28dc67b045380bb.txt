{"tags": ["Terraform"], "context": "\n\nterraform\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ brew install terraform\n==> Downloading https://homebrew.bintray.com/bottles/terraform-0.6.8.el_capitan.\n######################################################################## 100.0%\n==> Pouring terraform-0.6.8.el_capitan.bottle.tar.gz\n\ud83c\udf7a  /usr/local/Cellar/terraform/0.6.8: 29 files, 455M\n\n\n\u4f5c\u696d\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n$ mkdir aws_terraform\n$ cd aws_terraform/\n$ pwd\n/Users/labeneko/Projects/aws_terraform\n\n\nAWS\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n\u9069\u5f53\u306aIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3001 \u3068\u308a\u3042\u3048\u305a AdministratorAccess \u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304a\u304d\u307e\u3059(\u672c\u5f53\u306f\u5fc5\u8981\u306a\u6a29\u9650\u306e\u307f\u5272\u308a\u632f\u308b\u306e\u304c\u826f\u3044)\n\n\nvariable.tf\nprovider \"aws\" {\n  region     = \"ap-northeast-1\"\n  access_key = \"******\"\n  secret_key = \"******\"\n}\n\n\n\nVPC \u306e\u4f5c\u6210\n\n\u81ea\u5206\u5c02\u7528\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u7a7a\u9593\n\n\nvpc.tf\nresource \"aws_vpc\" \"tf_vpc\" {\n    cidr_block           = \"10.0.0.0/16\"\n    instance_tenancy     = \"default\"\n    enable_dns_support   = true\n    enable_dns_hostnames = true\n    tags {\n        Name = \"tf_vpc\"\n    }\n}\n\n\n\n\u5b9f\u884c\u3055\u308c\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001 terraform plan \u3092\u5b9f\u884c\u3057\u307e\u3059\n\n$ terraform plan\nRefreshing Terraform state prior to plan...\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_vpc.tf_vpc\n    cidr_block:                \"\" => \"10.0.0.0/16\"\n    default_network_acl_id:    \"\" => \"<computed>\"\n    default_security_group_id: \"\" => \"<computed>\"\n    dhcp_options_id:           \"\" => \"<computed>\"\n    enable_dns_hostnames:      \"\" => \"1\"\n    enable_dns_support:        \"\" => \"1\"\n    instance_tenancy:          \"\" => \"default\"\n    main_route_table_id:       \"\" => \"<computed>\"\n    tags.#:                    \"\" => \"1\"\n    tags.Name:                 \"\" => \"tf_vpc\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n\n\n\u3046\u307e\u304f\u3067\u304d\u305d\u3046\u3067\u3059\u3002 terraform apply \u3067\u5b9f\u884c\u3057\u307e\u3059\n\n$ terraform apply\naws_vpc.tf_vpc: Creating...\n  cidr_block:                \"\" => \"10.0.0.0/16\"\n  default_network_acl_id:    \"\" => \"<computed>\"\n  default_security_group_id: \"\" => \"<computed>\"\n  dhcp_options_id:           \"\" => \"<computed>\"\n  enable_dns_hostnames:      \"\" => \"1\"\n  enable_dns_support:        \"\" => \"1\"\n  instance_tenancy:          \"\" => \"default\"\n  main_route_table_id:       \"\" => \"<computed>\"\n  tags.#:                    \"\" => \"1\"\n  tags.Name:                 \"\" => \"tf_vpc\"\naws_vpc.tf_vpc: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\n\n\u7121\u4e8b\u5b9f\u884c\u3067\u304d\u307e\u3057\u305f\n\n\nsubnet\u306e\u4f5c\u6210\n\nvpc_id\u306b\u306f ${aws_vpc.tf_vpc.id} \u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u304a\u304f\u3068\u3001\u3044\u308d\u3044\u308d\u3068\u89e3\u6c7a\u3057\u3066\u5024\u3092\u5165\u308c\u3066\u304f\u308c\u308b\u3068\u306e\u3053\u3068\n\n\nsubnet.tf\nresource \"aws_subnet\" \"private_db1\" {\n    vpc_id            = \"${aws_vpc.tf_vpc.id}\"\n    cidr_block        = \"10.0.1.0/24\"\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n        Name = \"tf_private_db1\"\n    }\n}\n\nresource \"aws_subnet\" \"private_db2\" {\n    vpc_id            = \"${aws_vpc.tf_vpc.id}\"\n    cidr_block        = \"10.0.2.0/24\"\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n        Name = \"tf_private_db2\"\n    }\n}\n\n\n\n\u305d\u3057\u3066 terraform apply \u3067\u5b9f\u884c\u3057\u307e\u3059\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\n\u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3068\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7ba1\u7406\u3057\u307e\u3059\n\n\nsecurity_group.tf\nresource \"aws_security_group\" \"db\" {\n    name        = \"db_server\"\n    description = \"It is a security group on db of tf_vpc.\"\n    vpc_id      = \"${aws_vpc.tf_vpc.id}\"\n    tags {\n        Name = \"tf_db\"\n    }\n}\n\nresource \"aws_security_group_rule\" \"db\" {\n    type                     = \"ingress\"\n    from_port                = 3306\n    to_port                  = 3306\n    protocol                 = \"tcp\"\n    cidr_blocks              = [\"0.0.0.0/0\"]\n    security_group_id        = \"${aws_security_group.db.id}\"\n}\n\n\n\n\u5b9f\u884c\u3057\u307e\u3059\n\n\nDB\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\nRDS \u304b\u3089 VPC \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u306e\u3053\u3068\n\n\ndb_subnet_group.tf\nresource \"aws_db_subnet_group\" \"main\" {\n    name        = \"tf_dbsubnet\"\n    description = \"It is a DB subnet group on tf_vpc.\"\n    subnet_ids  = [\"${aws_subnet.private_db1.id}\", \"${aws_subnet.private_db2.id}\"]\n    tags {\n        Name = \"tf_dbsubnet\"\n    }\n}\n\n\n\n\u5b9f\u884c\u3057\u307e\u3059\n\n\nDB\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6307\u5b9a\n\n\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3068\u304b\n\n\ndb_parameter_group.tf\nresource \"aws_db_parameter_group\" \"default\" {\n    name = \"rds-pg\"\n    family = \"mysql5.7\"\n    description = \"Managed by Terraform\"\n\n    parameter {\n      name = \"time_zone\"\n      value = \"Asia/Tokyo\"\n    }\n}\n\n\n\nDB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nresource \"aws_db_instance\" \"db\" {\n    identifier              = \"dbinstance\"\n    allocated_storage       = 5\n    engine                  = \"mysql\"\n    engine_version          = \"5.7.11\"\n    instance_class          = \"db.t2.micro\"\n    storage_type            = \"gp2\"\n    username                = \"***\"\n    password                = \"***\"\n    publicly_accessible     = true\n    backup_retention_period = 1\n    vpc_security_group_ids  = [\"${aws_security_group.db.id}\"]\n    db_subnet_group_name    = \"${aws_db_subnet_group.main.name}\"\n}\n\n\n\u5b9f\u884c\u3057\u307e\u3059\n\n\n\u4fee\u6b63\u4e88\u5b9a\n\nuserid\u3068password\u3092\u76f4\u306b\u66f8\u304d\u3059\u304e\u306a\u306e\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u79fb\u52d5\n\n\n\u53c2\u8003\n\nhttps://tech.recruit-mp.co.jp/infrastructure/post-10665/\n\n# terraform\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ brew install terraform\n==> Downloading https://homebrew.bintray.com/bottles/terraform-0.6.8.el_capitan.\n######################################################################## 100.0%\n==> Pouring terraform-0.6.8.el_capitan.bottle.tar.gz\n\ud83c\udf7a  /usr/local/Cellar/terraform/0.6.8: 29 files, 455M\n```\n\n# \u4f5c\u696d\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\n```\n$ mkdir aws_terraform\n$ cd aws_terraform/\n$ pwd\n/Users/labeneko/Projects/aws_terraform\n```\n\n# AWS\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n- \u9069\u5f53\u306aIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3001 \u3068\u308a\u3042\u3048\u305a `AdministratorAccess` \u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304a\u304d\u307e\u3059(\u672c\u5f53\u306f\u5fc5\u8981\u306a\u6a29\u9650\u306e\u307f\u5272\u308a\u632f\u308b\u306e\u304c\u826f\u3044)\n\n```variable.tf\nprovider \"aws\" {\n  region     = \"ap-northeast-1\"\n  access_key = \"******\"\n  secret_key = \"******\"\n}\n```\n\n# VPC \u306e\u4f5c\u6210\n- \u81ea\u5206\u5c02\u7528\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u7a7a\u9593\n\n```vpc.tf\nresource \"aws_vpc\" \"tf_vpc\" {\n    cidr_block           = \"10.0.0.0/16\"\n    instance_tenancy     = \"default\"\n    enable_dns_support   = true\n    enable_dns_hostnames = true\n    tags {\n        Name = \"tf_vpc\"\n    }\n}\n```\n\n- \u5b9f\u884c\u3055\u308c\u305f\u3089\u3069\u3046\u306a\u308b\u304b\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001 `terraform plan` \u3092\u5b9f\u884c\u3057\u307e\u3059\n\n```\n$ terraform plan\nRefreshing Terraform state prior to plan...\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_vpc.tf_vpc\n    cidr_block:                \"\" => \"10.0.0.0/16\"\n    default_network_acl_id:    \"\" => \"<computed>\"\n    default_security_group_id: \"\" => \"<computed>\"\n    dhcp_options_id:           \"\" => \"<computed>\"\n    enable_dns_hostnames:      \"\" => \"1\"\n    enable_dns_support:        \"\" => \"1\"\n    instance_tenancy:          \"\" => \"default\"\n    main_route_table_id:       \"\" => \"<computed>\"\n    tags.#:                    \"\" => \"1\"\n    tags.Name:                 \"\" => \"tf_vpc\"\n\n\nPlan: 1 to add, 0 to change, 0 to destroy.\n```\n\n- \u3046\u307e\u304f\u3067\u304d\u305d\u3046\u3067\u3059\u3002 `terraform apply` \u3067\u5b9f\u884c\u3057\u307e\u3059\n\n```\n$ terraform apply\naws_vpc.tf_vpc: Creating...\n  cidr_block:                \"\" => \"10.0.0.0/16\"\n  default_network_acl_id:    \"\" => \"<computed>\"\n  default_security_group_id: \"\" => \"<computed>\"\n  dhcp_options_id:           \"\" => \"<computed>\"\n  enable_dns_hostnames:      \"\" => \"1\"\n  enable_dns_support:        \"\" => \"1\"\n  instance_tenancy:          \"\" => \"default\"\n  main_route_table_id:       \"\" => \"<computed>\"\n  tags.#:                    \"\" => \"1\"\n  tags.Name:                 \"\" => \"tf_vpc\"\naws_vpc.tf_vpc: Creation complete\n\nApply complete! Resources: 1 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n```\n\n- \u7121\u4e8b\u5b9f\u884c\u3067\u304d\u307e\u3057\u305f\n\n# subnet\u306e\u4f5c\u6210\n\n- vpc_id\u306b\u306f `${aws_vpc.tf_vpc.id}` \u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u304a\u304f\u3068\u3001\u3044\u308d\u3044\u308d\u3068\u89e3\u6c7a\u3057\u3066\u5024\u3092\u5165\u308c\u3066\u304f\u308c\u308b\u3068\u306e\u3053\u3068\n\n```subnet.tf\nresource \"aws_subnet\" \"private_db1\" {\n    vpc_id            = \"${aws_vpc.tf_vpc.id}\"\n    cidr_block        = \"10.0.1.0/24\"\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n        Name = \"tf_private_db1\"\n    }\n}\n\nresource \"aws_subnet\" \"private_db2\" {\n    vpc_id            = \"${aws_vpc.tf_vpc.id}\"\n    cidr_block        = \"10.0.2.0/24\"\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n        Name = \"tf_private_db2\"\n    }\n}\n```\n- \u305d\u3057\u3066 `terraform apply` \u3067\u5b9f\u884c\u3057\u307e\u3059\n\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n- \u30a4\u30f3\u30d0\u30a6\u30f3\u30c9\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3068\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7ba1\u7406\u3057\u307e\u3059\n\n```security_group.tf\nresource \"aws_security_group\" \"db\" {\n    name        = \"db_server\"\n    description = \"It is a security group on db of tf_vpc.\"\n    vpc_id      = \"${aws_vpc.tf_vpc.id}\"\n    tags {\n        Name = \"tf_db\"\n    }\n}\n\nresource \"aws_security_group_rule\" \"db\" {\n    type                     = \"ingress\"\n    from_port                = 3306\n    to_port                  = 3306\n    protocol                 = \"tcp\"\n    cidr_blocks              = [\"0.0.0.0/0\"]\n    security_group_id        = \"${aws_security_group.db.id}\"\n}\n```\n\n- \u5b9f\u884c\u3057\u307e\u3059\n\n# DB\u30b5\u30d6\u30cd\u30c3\u30c8\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\n- RDS \u304b\u3089 VPC \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u306e\u3053\u3068\n\n```db_subnet_group.tf\nresource \"aws_db_subnet_group\" \"main\" {\n    name        = \"tf_dbsubnet\"\n    description = \"It is a DB subnet group on tf_vpc.\"\n    subnet_ids  = [\"${aws_subnet.private_db1.id}\", \"${aws_subnet.private_db2.id}\"]\n    tags {\n        Name = \"tf_dbsubnet\"\n    }\n}\n```\n\n- \u5b9f\u884c\u3057\u307e\u3059\n\n# DB\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6307\u5b9a\n- \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3068\u304b\n\n```db_parameter_group.tf\nresource \"aws_db_parameter_group\" \"default\" {\n    name = \"rds-pg\"\n    family = \"mysql5.7\"\n    description = \"Managed by Terraform\"\n\n    parameter {\n      name = \"time_zone\"\n      value = \"Asia/Tokyo\"\n    }\n}\n```\n\n# DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\n```\nresource \"aws_db_instance\" \"db\" {\n    identifier              = \"dbinstance\"\n    allocated_storage       = 5\n    engine                  = \"mysql\"\n    engine_version          = \"5.7.11\"\n    instance_class          = \"db.t2.micro\"\n    storage_type            = \"gp2\"\n    username                = \"***\"\n    password                = \"***\"\n    publicly_accessible     = true\n    backup_retention_period = 1\n    vpc_security_group_ids  = [\"${aws_security_group.db.id}\"]\n    db_subnet_group_name    = \"${aws_db_subnet_group.main.name}\"\n}\n```\n\n- \u5b9f\u884c\u3057\u307e\u3059\n\n# \u4fee\u6b63\u4e88\u5b9a\n- userid\u3068password\u3092\u76f4\u306b\u66f8\u304d\u3059\u304e\u306a\u306e\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u79fb\u52d5\n\n# \u53c2\u8003\n- https://tech.recruit-mp.co.jp/infrastructure/post-10665/\n"}