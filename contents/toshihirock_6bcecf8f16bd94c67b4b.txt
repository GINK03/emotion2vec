{"tags": ["AWS", "redshift"], "context": " More than 1 year has passed since last update.Redshift\u3092\u4f7f\u3063\u305f\u4e8b\u304c\u306a\u304b\u3063\u305f\u306e\u3067GettingStarted\u3092\u3084\u3063\u3066\u307f\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3002\nAmazon Redshift \u306e\u4f7f\u7528\u3092\u958b\u59cb\u3059\u308b\n\n\u4e8b\u524d\u6e96\u5099\n\nRedshift\u7528\u306eInbound\u3067TCP\u306e5439\u30dd\u30fc\u30c8\u3092\u8a31\u53ef\u3059\u308bSecutiryGroup\nS3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u6301\u3063\u305fIAM\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u53ca\u3073\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u63a7\u3048\u308b\n\n\nEC2\u306e\u8d77\u52d5\n\nVPC\u306bAmazonLinux\u306eEC2\u3092\u8d77\u52d5\n\n\nRedshift\u306e\u8d77\u52d5(\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u8d77\u52d5\uff09\n\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\u306f\u4efb\u610f\u3067\nCluster Details\n\nCluster Identifier->my-example-cluster\nDatabase Name->()\nDatabase Port->5439\nMaster User Name->masteruser\nMaster User Password->xxxx\n\nNode Configuration\n\nNode Type->dc1.large(7 EC2 Compute Units(2 Virtual cores)per node\nCluster Type->Single Node\n\nAdditional Configuration\n\nEncrypt Database->None\nChoose a VPC->Default VPC\nCluster Subnet Group->default\nPublic Accessbile->No\nAvailability Zone->No Preference\nVPC Secutity Groups->\u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\n\n\npsql\u3067\u63a5\u7d9a\u3059\u308b\nPostgresql\u306e\u4e92\u63db\u6027\u304c\u3042\u308a\u3001psql\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3084\u3063\u3066\u307f\u308b\u3002\u4e8b\u524d\u306bRedshift\u8d77\u52d5\u5f8c\u3001\u63a5\u7d9a\u5148endpoint\u306f\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n# psql\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$sudo yum install postgresql94 -y\n\n# psql\u3067\u63a5\u7d9a\n$psql -U masteruser -h <endpoint> -p 5439 dev\n\n\nS3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u7a81\u3063\u8fbc\u3093\u3067\u307f\u308b\n\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u4e8b\u524d\u306b\u6e96\u5099\u3057\u3066\u3042\u308bS3\u306e\u30c7\u30fc\u30bf\u3092COPY\u30b3\u30de\u30f3\u30c9\u3067\u767b\u9332\u3057\u307e\u3059\u3002\n\u30b9\u30c6\u30c3\u30d7 5: Amazon S3 \u306e\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b\n\u307e\u305a\u306f\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncreatetable.txt\ncreate table users(\n    userid integer not null distkey sortkey,\n    username char(8),\n    firstname varchar(30),\n    lastname varchar(30),\n    city varchar(30),\n    state char(2),\n    email varchar(100),\n    phone char(14),\n    likesports boolean,\n    liketheatre boolean,\n    likeconcerts boolean,\n    likejazz boolean,\n    likeclassical boolean,\n    likeopera boolean,\n    likerock boolean,\n    likevegas boolean,\n    likebroadway boolean,\n    likemusicals boolean);\n\ncreate table venue(\n    venueid smallint not null distkey sortkey,\n    venuename varchar(100),\n    venuecity varchar(30),\n    venuestate char(2),\n    venueseats integer);\n\ncreate table category(\n    catid smallint not null distkey sortkey,\n    catgroup varchar(10),\n    catname varchar(10),\n    catdesc varchar(50));\n\ncreate table date(\n    dateid smallint not null distkey sortkey,\n    caldate date not null,\n    day character(3) not null,\n    week smallint not null,\n    month character(5) not null,\n    qtr character(5) not null,\n    year smallint not null,\n    holiday boolean default('N'));\n\ncreate table event(\n    eventid integer not null distkey,\n    venueid smallint not null,\n    catid smallint not null,\n    dateid smallint not null sortkey,\n    eventname varchar(200),\n    starttime timestamp);\n\ncreate table listing(\n    listid integer not null distkey,\n    sellerid integer not null,\n    eventid integer not null,\n    dateid smallint not null  sortkey,\n    numtickets smallint not null,\n    priceperticket decimal(8,2),\n    totalprice decimal(8,2),\n    listtime timestamp);\n\ncreate table sales(\n    salesid integer not null,\n    listid integer not null distkey,\n    sellerid integer not null,\n    buyerid integer not null,\n    eventid integer not null,\n    dateid smallint not null sortkey,\n    qtysold smallint not null,\n    pricepaid decimal(8,2),\n    commission decimal(8,2),\n    saletime timestamp);\n\n\n# psql\u304b\u3089SQL\u3092\u5b9f\u884c\n$psql -U masteruser -h <endpoint> -p 5439 dev -f createTable.sql\n\n# \u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u78ba\u8a8d\n$psql -U masteruser -h <endpoint> -p 5439 dev\n\ndev=# \\d\n           List of relations\n schema |   name   | type  |   owner\n--------+----------+-------+------------\n public | category | table | masteruser\n public | date     | table | masteruser\n public | event    | table | masteruser\n public | listing  | table | masteruser\n public | sales    | table | masteruser\n public | users    | table | masteruser\n public | venue    | table | masteruser\n(7 rows)\n\n\u6b21\u306bS3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u7a81\u3063\u8fbc\u307f\u307e\u3059\u3002\n<aws_access-key-id\u3068secret-access-key\u306f\u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305fS3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u3042\u308b\u3082\u306e\u306b\u7f6e\u63db\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ncopy.sql\ncopy users from 's3://awssampledbuswest2/tickit/allusers_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy venue from 's3://awssampledbuswest2/tickit/venue_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy category from 's3://awssampledbuswest2/tickit/category_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy date from 's3://awssampledbuswest2/tickit/date2008_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy event from 's3://awssampledbuswest2/tickit/allevents_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' timeformat 'YYYY-MM-DD HH:MI:SS' region 'us-west-2';\n\ncopy listing from 's3://awssampledbuswest2/tickit/listings_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy sales from 's3://awssampledbuswest2/tickit/sales_tab.txt'\ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>'\ndelimiter '\\t' timeformat 'MM/DD/YYYY HH:MI:SS' region 'us-west-2';\n\n\n\u540c\u3058\u3088\u3046\u306b\u5b9f\u884c\n$psql -U masteruser -h <endpoint> -p 5439 dev -f copy.sql\n\n\u767b\u9332\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nselect.sql\nselect count(*) from users;\nselect count(*) from venue;\nselect count(*) from category;\nselect count(*) from date;\nselect count(*) from event;\nselect count(*) from listing;\nselect count(*) from sales;\n\n\n$psql -U masteruser -h <endpoint> -p 5439 dev -f copy.sql\n\n\n\u30ea\u30bd\u30fc\u30b9\u524a\u9664\nEC2\u306eterminate,Redshift\u306eshutdown\u3092CLI\u304b\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\n\u7279\u306b\u306bRedshift\u306f\u5fd8\u308c\u305a\u306b\u3002\n\n\u6240\u611f\n\n\u7c21\u5358\u306b\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u9762\u767d\u3044\nPostgresql\u4e92\u63db\u306a\u306e\u3067\u3068\u3063\u3064\u304d\u3084\u3059\u3044\nS3\u304b\u3089\u306e\u30b3\u30d4\u30fc\u304c\u7c21\u5358\n\nRedshift\u3092\u4f7f\u3063\u305f\u4e8b\u304c\u306a\u304b\u3063\u305f\u306e\u3067GettingStarted\u3092\u3084\u3063\u3066\u307f\u305f\u306e\u3067\u305d\u306e\u30e1\u30e2\u3002\n\n[Amazon Redshift \u306e\u4f7f\u7528\u3092\u958b\u59cb\u3059\u308b](http://docs.aws.amazon.com/ja_jp/redshift/latest/gsg/getting-started.html)\n\n# \u4e8b\u524d\u6e96\u5099\n\n+ Redshift\u7528\u306eInbound\u3067TCP\u306e5439\u30dd\u30fc\u30c8\u3092\u8a31\u53ef\u3059\u308bSecutiryGroup\n+ S3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u6301\u3063\u305fIAM\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u53ca\u3073\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\u3092\u63a7\u3048\u308b\n\n# EC2\u306e\u8d77\u52d5\n\n+ VPC\u306bAmazonLinux\u306eEC2\u3092\u8d77\u52d5\n\n# Redshift\u306e\u8d77\u52d5(\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u8d77\u52d5\uff09\n\n\u30e6\u30fc\u30b6\u30fc\u540d\u306a\u3069\u306f\u4efb\u610f\u3067\n\nCluster Details\n\n+ Cluster Identifier->my-example-cluster\n+ Database Name->()\n+ Database Port->5439\n+ Master User Name->masteruser\n+ Master User Password->xxxx\n\nNode Configuration\n\n+ Node Type->dc1.large(7 EC2 Compute Units(2 Virtual cores)per node\n+ Cluster Type->Single Node\n\nAdditional Configuration\n\n+ Encrypt Database->None\n+ Choose a VPC->Default VPC\n+ Cluster Subnet Group->default\n+ Public Accessbile->No\n+ Availability Zone->No Preference\n+ VPC Secutity Groups->\u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\n\n# psql\u3067\u63a5\u7d9a\u3059\u308b\n\nPostgresql\u306e\u4e92\u63db\u6027\u304c\u3042\u308a\u3001psql\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u3084\u3063\u3066\u307f\u308b\u3002\u4e8b\u524d\u306bRedshift\u8d77\u52d5\u5f8c\u3001\u63a5\u7d9a\u5148endpoint\u306f\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n```bash\n# psql\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$sudo yum install postgresql94 -y\n\n# psql\u3067\u63a5\u7d9a\n$psql -U masteruser -h <endpoint> -p 5439 dev\n```\n\n# S3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u7a81\u3063\u8fbc\u3093\u3067\u307f\u308b\n\n\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u4e8b\u524d\u306b\u6e96\u5099\u3057\u3066\u3042\u308bS3\u306e\u30c7\u30fc\u30bf\u3092COPY\u30b3\u30de\u30f3\u30c9\u3067\u767b\u9332\u3057\u307e\u3059\u3002\n\n[\u30b9\u30c6\u30c3\u30d7 5: Amazon S3 \u306e\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b](http://docs.aws.amazon.com/ja_jp/redshift/latest/gsg/rs-gsg-create-sample-db.html)\n\n\u307e\u305a\u306f\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```createtable.txt\ncreate table users(\n\tuserid integer not null distkey sortkey,\n\tusername char(8),\n\tfirstname varchar(30),\n\tlastname varchar(30),\n\tcity varchar(30),\n\tstate char(2),\n\temail varchar(100),\n\tphone char(14),\n\tlikesports boolean,\n\tliketheatre boolean,\n\tlikeconcerts boolean,\n\tlikejazz boolean,\n\tlikeclassical boolean,\n\tlikeopera boolean,\n\tlikerock boolean,\n\tlikevegas boolean,\n\tlikebroadway boolean,\n\tlikemusicals boolean);\n\ncreate table venue(\n\tvenueid smallint not null distkey sortkey,\n\tvenuename varchar(100),\n\tvenuecity varchar(30),\n\tvenuestate char(2),\n\tvenueseats integer);\n\ncreate table category(\n\tcatid smallint not null distkey sortkey,\n\tcatgroup varchar(10),\n\tcatname varchar(10),\n\tcatdesc varchar(50));\n\ncreate table date(\n\tdateid smallint not null distkey sortkey,\n\tcaldate date not null,\n\tday character(3) not null,\n\tweek smallint not null,\n\tmonth character(5) not null,\n\tqtr character(5) not null,\n\tyear smallint not null,\n\tholiday boolean default('N'));\n\ncreate table event(\n\teventid integer not null distkey,\n\tvenueid smallint not null,\n\tcatid smallint not null,\n\tdateid smallint not null sortkey,\n\teventname varchar(200),\n\tstarttime timestamp);\n\ncreate table listing(\n\tlistid integer not null distkey,\n\tsellerid integer not null,\n\teventid integer not null,\n\tdateid smallint not null  sortkey,\n\tnumtickets smallint not null,\n\tpriceperticket decimal(8,2),\n\ttotalprice decimal(8,2),\n\tlisttime timestamp);\n\ncreate table sales(\n\tsalesid integer not null,\n\tlistid integer not null distkey,\n\tsellerid integer not null,\n\tbuyerid integer not null,\n\teventid integer not null,\n\tdateid smallint not null sortkey,\n\tqtysold smallint not null,\n\tpricepaid decimal(8,2),\n\tcommission decimal(8,2),\n\tsaletime timestamp);\n```\n\n\n```bash\n# psql\u304b\u3089SQL\u3092\u5b9f\u884c\n$psql -U masteruser -h <endpoint> -p 5439 dev -f createTable.sql\n\n# \u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u78ba\u8a8d\n$psql -U masteruser -h <endpoint> -p 5439 dev\n\ndev=# \\d\n           List of relations\n schema |   name   | type  |   owner\n--------+----------+-------+------------\n public | category | table | masteruser\n public | date     | table | masteruser\n public | event    | table | masteruser\n public | listing  | table | masteruser\n public | sales    | table | masteruser\n public | users    | table | masteruser\n public | venue    | table | masteruser\n(7 rows)\n```\n\n\u6b21\u306bS3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u7a81\u3063\u8fbc\u307f\u307e\u3059\u3002\n`<aws_access-key-id`\u3068`secret-access-key`\u306f\u4e8b\u524d\u6e96\u5099\u3067\u4f5c\u6210\u3057\u305fS3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u3042\u308b\u3082\u306e\u306b\u7f6e\u63db\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```copy.sql\ncopy users from 's3://awssampledbuswest2/tickit/allusers_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy venue from 's3://awssampledbuswest2/tickit/venue_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy category from 's3://awssampledbuswest2/tickit/category_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy date from 's3://awssampledbuswest2/tickit/date2008_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy event from 's3://awssampledbuswest2/tickit/allevents_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' timeformat 'YYYY-MM-DD HH:MI:SS' region 'us-west-2';\n\ncopy listing from 's3://awssampledbuswest2/tickit/listings_pipe.txt' \ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>' \ndelimiter '|' region 'us-west-2';\n\ncopy sales from 's3://awssampledbuswest2/tickit/sales_tab.txt'\ncredentials 'aws_access_key_id=<access-key-id>;aws_secret_access_key=<secret-access-key>'\ndelimiter '\\t' timeformat 'MM/DD/YYYY HH:MI:SS' region 'us-west-2';\n```\n\n\u540c\u3058\u3088\u3046\u306b\u5b9f\u884c\n\n```bash\n$psql -U masteruser -h <endpoint> -p 5439 dev -f copy.sql\n```\n\n\u767b\u9332\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```select.sql\nselect count(*) from users;\nselect count(*) from venue;\nselect count(*) from category;\nselect count(*) from date;\nselect count(*) from event;\nselect count(*) from listing;\nselect count(*) from sales;\n```\n\n```bash\n$psql -U masteruser -h <endpoint> -p 5439 dev -f copy.sql\n```\n\n# \u30ea\u30bd\u30fc\u30b9\u524a\u9664\n\nEC2\u306eterminate,Redshift\u306eshutdown\u3092CLI\u304b\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\n\u7279\u306b\u306bRedshift\u306f\u5fd8\u308c\u305a\u306b\u3002\n\n# \u6240\u611f\n\n+ \u7c21\u5358\u306b\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u9762\u767d\u3044\n+ Postgresql\u4e92\u63db\u306a\u306e\u3067\u3068\u3063\u3064\u304d\u3084\u3059\u3044\n+ S3\u304b\u3089\u306e\u30b3\u30d4\u30fc\u304c\u7c21\u5358\n"}