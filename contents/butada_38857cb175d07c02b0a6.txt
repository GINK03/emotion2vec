{"context": "\n\n\u306f\u3058\u3081\u306b\nTCP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u306f\u3088\u304f\u898b\u304b\u3051\u308b\u306e\u3067\u3059\u304c\u3001UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u306f\u7528\u9014\u304c\u9650\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u306e\u304b\u3001\u3042\u307e\u308a\u898b\u304b\u3051\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306f\u3001UDP\u3084\u30bd\u30b1\u30c3\u30c8\u306e\u52c9\u5f37\u3092\u517c\u306d\u3066UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u74b0\u5883\nOS X El Capitan\nPython 2.7.11\nsnmpwalk 5.6.2.1\n\nPython\u3067\u5b9f\u88c5\u3059\u308b\n\nudp_portforwarder.py\nimport socket\nUDP_IP_LISTEN = \"192.168.1.12\"\nUDP_PORT_LISTEN = 161\nUDP_IP_TO = \"192.168.1.119\"\nUDP_PORT_TO = 161\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) # UDP\nsock.bind((UDP_IP_LISTEN, UDP_PORT_LISTEN))\n\nsrc_port = 0\n\nwhile True:\n  data, (host, port) = sock.recvfrom(4096)\n\n  # receive from remote server\n  if src_port != 0 and host != UDP_IP_LISTEN:\n    sock.sendto(data, (UDP_IP_LISTEN, src_port))\n  # send to remote server\n  else:\n    src_port = port\n    sock.sendto(data, (UDP_IP_TO, UDP_PORT_TO))\n\n  print 'forwarded', host, port\n\n\n\u89e3\u8aac1\nUDP\u3092\u5bfe\u8c61\u306b\u3057\u305f\u3044\u306e\u3067\u3001socket\u306b\u306fSOCK_DGRAM\u3092\u6307\u5b9a\u3002\n\u89e3\u8aac2\nbind\u3057\u305f\u30dd\u30fc\u30c8\u306b\u306f\u3001\u8981\u6c42\u5143\u304b\u3089\u3068\u3001\u9001\u4ed8\u5148\u304b\u3089\u306e\u5fdc\u7b54\u30682\u7a2e\u985e\u306e\u30d1\u30b1\u30c3\u30c8\u304crecvfrom\u3067\u5c4a\u304f\u306e\u3067\u3001\u9001\u4fe1\u5143\u30a2\u30c9\u30ec\u30b9\u3067\u6761\u4ef6\u5206\u5c90\u3002\n\u89e3\u8aac3\n\u8981\u6c42\u5143\u306e\u30dd\u30fc\u30c8\u306b\u8fd4\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u8981\u6c42\u5143\u304b\u3089\u306e\u30d1\u30b1\u30c3\u30c8\u304c\u5230\u7740\u6642\u306b\u8981\u6c42\u5143\u30dd\u30fc\u30c8\u756a\u53f7\u3092src_port\u306b\u683c\u7d0d\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\ntshark udp\u3092\u5b9f\u884c\uff08\u30d1\u30b1\u30c3\u30c8\u306e\u8a73\u7d30\u3092\u78ba\u8a8d\u3059\u308b\u70ba\uff09\nsudo python udp_capture_portforwarder_remote.py\u3092\u5b9f\u884c\nsnmpwalk -c public -v 1 192.168.1.12\u3092\u5b9f\u884c\n\n\n\u52d5\u4f5c\u7d50\u679c\n\nsnmpwalk\nsnmpwalk -c public -v 1 192.168.1.12\nbutada-mac:python_udp_capture_test butada$ snmpwalk -c public -v 1 192.168.1.12\nSNMPv2-MIB::sysDescr.0 = STRING: Darwin macbook.local 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:33:36 PDT 2011; root:xnu-1504.15.3~1/RELEASE_I386 i386\nSNMPv2-MIB::sysObjectID.0 = OID: NET-SNMP-MIB::netSnmpAgentOIDs.16\nDISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (454525) 1:15:45.25\nSNMPv2-MIB::sysContact.0 = STRING: SysAdmin\nSNMPv2-MIB::sysName.0 = STRING: SystemName\nSNMPv2-MIB::sysLocation.0 = STRING: data centre A\nSNMPv2-MIB::sysORLastChange.0 = Timeticks: (4) 0:00:00.04\nSNMPv2-MIB::sysORID.1 = OID: SNMP-FRAMEWORK-MIB::snmpFrameworkMIBC\n\uff1c\u7701\u7565\uff1e\n\n\n\nudp_capture_portforwarder_remote.py\n$ sudo python udp_capture_portforwarder_remote.py \nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\n\uff1c\u7701\u7565\uff1e\n\n\n\ntshark\n$ tshark udp\n1897 2373.448956 192.168.1.12 -> 192.168.1.119 SNMP 82 get-next-request 1.3.6.1.2.1\n1898 2373.450958 192.168.1.119 -> 192.168.1.12 SNMP 215 get-response 1.3.6.1.2.1.1.1.0\n1899 2373.451207 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.1.0\n1900 2373.453134 192.168.1.119 -> 192.168.1.12 SNMP 95 get-response 1.3.6.1.2.1.1.2.0\n1901 2373.453259 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.2.0\n1902 2373.454931 192.168.1.119 -> 192.168.1.12 SNMP 88 get-response 1.3.6.1.2.1.1.3.0\n1903 2373.455061 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.3.0\n1904 2373.456796 192.168.1.119 -> 192.168.1.12 SNMP 93 get-response 1.3.6.1.2.1.1.4.0\n\uff1c\u7701\u7565\uff1e\n\n\n\n\u7d50\u679c\nsnmpget\u3092\u7528\u3044\u3066\u3001UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u5177\u4f53\u7684\u306a\u7d50\u679c\u3092\u3053\u3053\u306b\u8f09\u305b\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001IPMI\u306b\u3064\u3044\u3066\u3082ipmiutil\u3092\u4f7f\u3063\u3066\u540c\u69d8\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u5fdc\u7528\n\nSNMP\u306e\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\uff06\u30ea\u30d7\u30ec\u30a4\n\u3053\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3092\u5fdc\u7528\u3057\u3066\u3001\u30d1\u30b1\u30c3\u30c8\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u3084\u3001\u7c21\u6613\u7684\u306a\u30b9\u30bf\u30d6\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u3064\u307e\u308a\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u969b\u306b\u8a18\u9332\u3059\u308b\u306e\u304c\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u3001\u305d\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u5185\u5bb9\u306b\u57fa\u3065\u3044\u3066\u30d5\u30a9\u30fc\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u305b\u305a\u306b\u8a18\u9332\u3057\u305f\u5fdc\u7b54\u3092\u8fd4\u3059\u306e\u304c\u30b9\u30bf\u30d6\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://qiita.com/butada/items/77af324c2a1bb880f101\n\n\u53c2\u8003\nhttp://memo.saitodev.com/home/python_network_programing/\nhttp://stackoverflow.com/questions/11350145/are-there-simple-descriptions-on-port-forwarding-using-python\nhttp://stackoverflow.com/questions/2694212/socket-set-source-port-number\n# \u306f\u3058\u3081\u306b\n\nTCP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u306f\u3088\u304f\u898b\u304b\u3051\u308b\u306e\u3067\u3059\u304c\u3001UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u306f\u7528\u9014\u304c\u9650\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u306e\u304b\u3001\u3042\u307e\u308a\u898b\u304b\u3051\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306f\u3001UDP\u3084\u30bd\u30b1\u30c3\u30c8\u306e\u52c9\u5f37\u3092\u517c\u306d\u3066UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u74b0\u5883\nOS X El Capitan\nPython 2.7.11\nsnmpwalk 5.6.2.1\n\n# Python\u3067\u5b9f\u88c5\u3059\u308b\n\n```lang:udp_portforwarder.py\nimport socket\nUDP_IP_LISTEN = \"192.168.1.12\"\nUDP_PORT_LISTEN = 161\nUDP_IP_TO = \"192.168.1.119\"\nUDP_PORT_TO = 161\n\nsock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) # UDP\nsock.bind((UDP_IP_LISTEN, UDP_PORT_LISTEN))\n\nsrc_port = 0\n\nwhile True:\n  data, (host, port) = sock.recvfrom(4096)\n\n  # receive from remote server\n  if src_port != 0 and host != UDP_IP_LISTEN:\n    sock.sendto(data, (UDP_IP_LISTEN, src_port))\n  # send to remote server\n  else:\n    src_port = port\n    sock.sendto(data, (UDP_IP_TO, UDP_PORT_TO))\n   \n  print 'forwarded', host, port\n```\n\n\u89e3\u8aac1\nUDP\u3092\u5bfe\u8c61\u306b\u3057\u305f\u3044\u306e\u3067\u3001socket\u306b\u306fSOCK_DGRAM\u3092\u6307\u5b9a\u3002\n\n\u89e3\u8aac2\nbind\u3057\u305f\u30dd\u30fc\u30c8\u306b\u306f\u3001\u8981\u6c42\u5143\u304b\u3089\u3068\u3001\u9001\u4ed8\u5148\u304b\u3089\u306e\u5fdc\u7b54\u30682\u7a2e\u985e\u306e\u30d1\u30b1\u30c3\u30c8\u304crecvfrom\u3067\u5c4a\u304f\u306e\u3067\u3001\u9001\u4fe1\u5143\u30a2\u30c9\u30ec\u30b9\u3067\u6761\u4ef6\u5206\u5c90\u3002\n\n\u89e3\u8aac3\n\u8981\u6c42\u5143\u306e\u30dd\u30fc\u30c8\u306b\u8fd4\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u8981\u6c42\u5143\u304b\u3089\u306e\u30d1\u30b1\u30c3\u30c8\u304c\u5230\u7740\u6642\u306b\u8981\u6c42\u5143\u30dd\u30fc\u30c8\u756a\u53f7\u3092src_port\u306b\u683c\u7d0d\u3002\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n1. tshark udp\u3092\u5b9f\u884c\uff08\u30d1\u30b1\u30c3\u30c8\u306e\u8a73\u7d30\u3092\u78ba\u8a8d\u3059\u308b\u70ba\uff09\n1. sudo python udp_capture_portforwarder_remote.py\u3092\u5b9f\u884c\n1. snmpwalk -c public -v 1 192.168.1.12\u3092\u5b9f\u884c\n\n# \u52d5\u4f5c\u7d50\u679c\n\n```lang:snmpwalk\nsnmpwalk -c public -v 1 192.168.1.12\nbutada-mac:python_udp_capture_test butada$ snmpwalk -c public -v 1 192.168.1.12\nSNMPv2-MIB::sysDescr.0 = STRING: Darwin macbook.local 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:33:36 PDT 2011; root:xnu-1504.15.3~1/RELEASE_I386 i386\nSNMPv2-MIB::sysObjectID.0 = OID: NET-SNMP-MIB::netSnmpAgentOIDs.16\nDISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (454525) 1:15:45.25\nSNMPv2-MIB::sysContact.0 = STRING: SysAdmin\nSNMPv2-MIB::sysName.0 = STRING: SystemName\nSNMPv2-MIB::sysLocation.0 = STRING: data centre A\nSNMPv2-MIB::sysORLastChange.0 = Timeticks: (4) 0:00:00.04\nSNMPv2-MIB::sysORID.1 = OID: SNMP-FRAMEWORK-MIB::snmpFrameworkMIBC\n\uff1c\u7701\u7565\uff1e\n```\n\n```lang:udp_capture_portforwarder_remote.py \n$ sudo python udp_capture_portforwarder_remote.py \nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\nsent to remote snmp\nforwarded 192.168.1.12 57598\nreceived from remote snmp\nforwarded 192.168.1.119 161\n\uff1c\u7701\u7565\uff1e\n```\n\n```lang:tshark\n$ tshark udp\n1897 2373.448956 192.168.1.12 -> 192.168.1.119 SNMP 82 get-next-request 1.3.6.1.2.1\n1898 2373.450958 192.168.1.119 -> 192.168.1.12 SNMP 215 get-response 1.3.6.1.2.1.1.1.0\n1899 2373.451207 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.1.0\n1900 2373.453134 192.168.1.119 -> 192.168.1.12 SNMP 95 get-response 1.3.6.1.2.1.1.2.0\n1901 2373.453259 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.2.0\n1902 2373.454931 192.168.1.119 -> 192.168.1.12 SNMP 88 get-response 1.3.6.1.2.1.1.3.0\n1903 2373.455061 192.168.1.12 -> 192.168.1.119 SNMP 85 get-next-request 1.3.6.1.2.1.1.3.0\n1904 2373.456796 192.168.1.119 -> 192.168.1.12 SNMP 93 get-response 1.3.6.1.2.1.1.4.0\n\uff1c\u7701\u7565\uff1e\n```\n\n# \u7d50\u679c\n\nsnmpget\u3092\u7528\u3044\u3066\u3001UDP\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u5177\u4f53\u7684\u306a\u7d50\u679c\u3092\u3053\u3053\u306b\u8f09\u305b\u3089\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001IPMI\u306b\u3064\u3044\u3066\u3082ipmiutil\u3092\u4f7f\u3063\u3066\u540c\u69d8\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n# \u5fdc\u7528\n\n## SNMP\u306e\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\uff06\u30ea\u30d7\u30ec\u30a4\n\u3053\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3092\u5fdc\u7528\u3057\u3066\u3001\u30d1\u30b1\u30c3\u30c8\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u3084\u3001\u7c21\u6613\u7684\u306a\u30b9\u30bf\u30d6\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u3064\u307e\u308a\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u969b\u306b\u8a18\u9332\u3059\u308b\u306e\u304c\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u3001\u305d\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u5185\u5bb9\u306b\u57fa\u3065\u3044\u3066\u30d5\u30a9\u30fc\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u305b\u305a\u306b\u8a18\u9332\u3057\u305f\u5fdc\u7b54\u3092\u8fd4\u3059\u306e\u304c\u30b9\u30bf\u30d6\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://qiita.com/butada/items/77af324c2a1bb880f101\n\n# \u53c2\u8003 \n\nhttp://memo.saitodev.com/home/python_network_programing/\nhttp://stackoverflow.com/questions/11350145/are-there-simple-descriptions-on-port-forwarding-using-python\nhttp://stackoverflow.com/questions/2694212/socket-set-source-port-number\n", "tags": ["Python", "udp", "portforward", "snmp"]}