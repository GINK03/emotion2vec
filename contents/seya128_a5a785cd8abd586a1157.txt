{"tags": ["gas"], "context": "\n\n\u6982\u8981\n\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u304c\u591a\u3044\u3068\u3001\u30ec\u30d3\u30e5\u30fc\u306e\u30c1\u30a7\u30c3\u30af\u3068\u304b\u5927\u5909\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff1f\n\u3063\u3066\u3053\u3068\u3067\u3001\u524d\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u3092\u307e\u3068\u3081\u3066\u30e1\u30fc\u30eb\u3067\u9001\u3063\u3066\u304f\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092GAS\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\uff01\nAppStore\u306f\u3001\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\u306eAPI\u3092\u4f7f\u3044\u307e\u3057\u305f\u304c\u3001GooglePlay\u306b\u306fAPI\u304c\u306a\u3044\u306e\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3057\u3066\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001GooglePlay\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u5909\u308f\u3063\u305f\u308a\u3059\u308b\u3068\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30ec\u30d3\u30e5\u30fc\u30e1\u30fc\u30eb\u30b5\u30f3\u30d7\u30eb\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u524d\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u3092\u62bd\u51fa\u3057\u305f\u30e1\u30fc\u30eb\u304c\u6bce\u65e5\u9001\u3089\u308c\u3066\u304d\u307e\u3059\u3002\n\u25a0\n\u25a0 GooglePlay : \u6fc0J\u30d1\u30c1\u30b9\u30ed 2027\n\u25a0 https://play.google.com/store/apps/details?id=jp.dorasu.apps.and2027\n\u25a0\n\n2016/3/31 \u00d7\u00d7\u00d7\u00d7\n\u4f55\u3082\u3067\u304d\u307e\u305b\u3093 \u2605\u2606\u2606\u2606\u2606\n \u843d\u3068\u3057\u305f\u3051\u3069\u3044\u304d\u306a\u308a\u505c\u6b62\u3000\u4f55\u3082\u3067\u304d\u307e\u305b\u3093\u3000\u304a\u91d1\u3082\u53d6\u3089\u308c\u305f\u307e\u3093\u307e\u3000\u5b89\u58f2\u308a\u306e\u7f60\n\n\n\u25a0\n\u25a0 GooglePlay : \u6fc0J\u30d1\u30c1\u30b9\u30ed BLACK LAGOON\n\u25a0 https://play.google.com/store/apps/details?id=jp.dorasu.apps.blacklagoon\n\u25a0\n\n2016/3/31 \u25a1\u25a1\u25a1\u25a1\n \u2605\u2605\u2605\u2605\u2605\n \u61d0\u304b\u3057\u304f\u3066\u3088\u304b\u3063\u305f\n\n\n\u25a0\n\u25a0 AppStore : \u6fc0J\u30d1\u30c1\u30b9\u30ed BLACK LAGOON 2\n\u25a0 https://itunes.apple.com/jp/app/jijpachisuro-black-lagoon-2/id961851134?mt=8&uo=2\n\u25a0\n\n2016/03/31 11:24:00 \u306f\u3056\u305a\n\u306f\u3042 \u2605\u2605\u2605\u2605\u2605\n\u304a\u3082\u308d\u3044\n\n\n\u25a0\n\u25a0 AppStore : \u6fc0J\u30d1\u30c1\u30b9\u30ed HIGHSCHOOL OF THE DEAD\n\u25a0 https://itunes.apple.com/jp/app/jijpachisuro-highschool-dead/id684256528?mt=8&uo=2\n\u25a0\n\n2016/03/31 08:11:00 \u3089\u3086\u306a\u3055\n\u3088\u3044 \u2605\u2605\u2605\u2605\u2606\n\u3088\u3044\u3088\u3001\u3088\u3044\n\n2016/03/31 00:40:00 \u25b3\u25b3\u30b5\u30c0\u30aa\u30b7\n\u306a\u304b\u306a\u304b\u826f\u3044 \u2605\u2605\u2605\u2605\u2606\n\u5b9f\u6a5f\u306b\u304b\u306a\u308a\u8fd1\u3044\u30af\u30aa\u30ea\u30c6\u30a3\u30fc\u3002\n\n\n\u30ec\u30d3\u30e5\u30fc\u3092\u3068\u3063\u3066\u304f\u308b\u30a2\u30d7\u30ea\u306e\u6307\u5b9a\n\u30a2\u30d7\u30eaID\u3092B\u5217\u306e2\u884c\u76ee\u304b\u3089\u8a18\u8f09\u3057\u305f\u30ea\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u4f7f\u3046\u306e\u306f\uff22\u5217\u306e\u307f\u3067\u3059\u3002\nAppStore\u3068GooglePlay\u306f\u5225\u306e\u30b7\u30fc\u30c8\u3067\u4f5c\u6210\u3057\u3001\u30b7\u30fc\u30c8\u540d\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\n\n\u30b3\u30fc\u30c9\n\n\u30b3\u30fc\u30c9.GS\n//\n// \u6628\u65e5\u306e\u30a2\u30d7\u30ea\u30ec\u30d3\u30e5\u30fc\u3092\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\n//\nfunction sendMailYesterdayReview() {\n\n  //\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u8a18\u8f09\u306e\u30a2\u30d7\u30eaID\u306e\u30ec\u30d3\u30e5\u30fc\u3092\u53d6\u5f97\u3001\u6574\u5f62\n  var text = \"\";\n  text += jobSheet(\"GooglePlay\", \"Dorasu GooglePlay\");\n  text += jobSheet(\"AppStore\", \"Dorasu AppStore\");\n\n  //\u53d6\u5f97\u3057\u305f\u30ec\u30d3\u30e5\u30fc\u3092\u30e1\u30fc\u30eb\u9001\u4fe1\n  var MAIL_TO    = \"XXXX@XXXXX.XXXX,YYYY@YYYYY.YYY\";\n  var MAIL_TITLE = \"\u30a2\u30d7\u30ea\u30ec\u30d3\u30e5\u30fc\";\n  if (text != \"\") {\n    MailApp.sendEmail(MAIL_TO, MAIL_TITLE, text);\n    Logger.log(\"\u30e1\u30fc\u30eb\u9001\u4fe1 to:\"+MAIL_TO+\"  title:\"+MAIL_TITLE+\"\\n\"+text);\n  } else {\n    Logger.log(\"\u6628\u65e5\u5206\u306e\u30ec\u30d3\u30e5\u30fc\u304c\u306a\u3044\u306e\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u306f\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\");\n  }\n}\n\n\n// 1\u30b7\u30fc\u30c8\u5206\u306e\u51e6\u7406\nfunction jobSheet(type, sheetName)\n{\n  var ROW_START = 2;  //ID\u304c\u5165\u3063\u3066\u3044\u308b\u884c\u306e\u958b\u59cb\u4f4d\u7f6e\n  var COL_ID    = 2;  //ID\u304c\u5165\u3063\u3066\u3044\u308b\u5217\n\n  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName);\n  var values = sheet.getDataRange().getValues();\n\n  Logger.log(\"\u30b7\u30fc\u30c8[\"+sheetName+\"] \u51e6\u7406\u958b\u59cb\");\n\n  var cnt=0;\n  var text = \"\";\n  for(var i = ROW_START-1; i < values.length; i++){    \n    var id = values[i][COL_ID-1];\n    text += jobTitle(type, id);\n    cnt++;\n  } \n\n  Logger.log(\"\u30b7\u30fc\u30c8[\"+sheetName+\"] \"+cnt+\"\u30bf\u30a4\u30c8\u30eb\u51e6\u7406\u7d42\u4e86\");\n\n  return text;\n}\n\n// \uff11\u30bf\u30a4\u30c8\u30eb\u5206\u306e\u51e6\u7406\nfunction jobTitle(type, id)\n{\n  var result;\n  var text = \"\";\n\n  //\u30ec\u30d3\u30e5\u30fc\u3092\u3068\u3063\u3066\u304f\u308b\n  if (type == \"AppStore\") {\n    result = fetchReviewAppStore(id);\n    result.type = \"AppStore\";\n  } else {\n    result = fetchReviewGooglePlay(id);\n    result.type = \"GooglePlay\";\n  }\n\n  //\u30a8\u30e9\u30fc\n  if (result.error) {\n    text = \"ERROR : \" + result.url + \"\\n\";\n    Logger.log(text);\n    return text;\n  }\n\n  //\u6628\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u3092\u62bd\u51fa\n  var date = new Date();\n  date.setDate(date.getDate()-1);\n  result.reviews = extractReviewByDate(result.reviews, date);\n\n  if (result.reviews.length > 0) {\n    //\u30bf\u30a4\u30c8\u30eb\n    text += \"\\n\";\n    text += \"\u25a0\\n\";\n    text += \"\u25a0 \" + result.type + \" : \" + result.title + \"\\n\";\n    text += \"\u25a0 \" + result.link + \"\\n\";\n    text += \"\u25a0\\n\";\n    text += \"\\n\";\n\n    //\u30ec\u30d3\u30e5\u30fc\u3092\u65b0\u3057\u3044\u9806\u306b\u30bd\u30fc\u30c8\u3057\u3066\u8ffd\u52a0\n    result.reviews.sort((function(a,b){return(new Date(b.date).getTime() - new Date(a.date).getTime());}));\n    text += formatReview(result.reviews);\n\n  }\n\n  Logger.log(id+\" \"+result.title+\" \"+result.reviews.length+\"\u30ec\u30d3\u30e5\u30fc\");\n\n  return text;\n}\n\n\n//\u30ec\u30d3\u30e5\u30fc\u3092\u6574\u5f62\nfunction formatReview(reviews)\n{\n  var text = \"\";\n\n  for (var i in reviews) {\n    text = text + reviews[i].date + \" \" + reviews[i].author + \"\\n\";\n    text = text + reviews[i].title + \" \" + (\"\u2605\u2605\u2605\u2605\u2605\u2606\u2606\u2606\u2606\u2606\").substr(5-reviews[i].rating, 5) + \"\\n\";\n    text = text + reviews[i].content + \"\\n\";\n    text = text + \"\\n\";\n  }\n\n  return text;\n}\n\n//\u6307\u5b9a\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u62bd\u51fa\nfunction extractReviewByDate(reviews, date)\n{\n  var result = [];\n\n  date.setHours(0);\n  date.setMinutes(0);\n  date.setSeconds(0);\n  date.setMilliseconds(0);\n\n  for (var i in reviews) {\n    var d = new Date(reviews[i].date);\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n    if (d.getTime() == date.getTime()) {\n      result.push(reviews[i]);\n    }\n  }\n\n  return result;\n}\n\n\n\n// AppStore\u304b\u3089\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\nfunction fetchReviewAppStore(id) {\n  var url = \"https://itunes.apple.com/jp/rss/customerreviews/id=\" + id + \"/xml\";\n  var query = 'select * from xml where url=\"' + url + '\"';\n  var response = UrlFetchApp.fetch(\"https://query.yahooapis.com/v1/public/yql?format=json&q=\"+encodeURIComponent(query),{'muteHttpExceptions':true});\n  try {\n    var entrys = JSON.parse(response).query.results.feed.entry;\n    var result = {};\n    var review = [];\n\n    for (var entry in entrys) {\n      if (entry == 0) {\n        result.title = entrys[entry].name;\n        result.link  = entrys[entry].link.href;\n      }\n      else {\n        review.push({\n          date:    entrys[entry].updated.replace(/(.*?)-(.*?)-(.*?)T(.*?)-.*/,\"$1/$2/$3 $4\"),\n          title:   entrys[entry].title,\n          content: entrys[entry].content[0].content,\n          rating:  entrys[entry].rating,\n          version: entrys[entry].version,\n          author:  entrys[entry].author.name\n        });\n      }\n    }\n    result.reviews = review;\n    return result;\n  } catch (e) {\n    return {\n      error:   true,\n      title:   \"\",\n      link:    url,\n      reviews: review\n    };\n  }    \n}\n\n\n// GooglePlay\u304b\u3089\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\nfunction fetchReviewGooglePlay(id) {\n  var url      = \"https://play.google.com/store/apps/details?id=\" + id;\n  var response = UrlFetchApp.fetch(url,{'muteHttpExceptions':true});\n  try {\n    var result = {};\n    var review = [];\n\n    result.error = false;\n\n    var regexp   = /<div class=\\\"id-app-title\\\".+?<\\/div>/gi;\n    var elements = response.getContentText().match(regexp);\n    result.title = elements[0].replace(/.*?>(.*?)<.*/,\"$1\");\n    result.link  = url;\n\n    var regexp   = /<div class=\\\"single-review\\\".+?class=\\\"review-link\\\"/gi;\n    var elements = response.getContentText().match(regexp);\n    for (var i in elements) {\n      review.push({\n        author:     elements[i].replace(/.*<span class=\\\"author-name\\\">.*?>(.*?)<.*/,\"$1\"),\n        date:       elements[i].replace(/.*<span class=\\\"review-date\\\">(.*?)\u5e74(.*?)\u6708(.*?)\u65e5.*/,\"$1/$2/$3\"),\n        title:      elements[i].replace(/.*<span class=\\\"review-title\\\">(.*?)<.*/,\"$1\"),\n        content:    elements[i].replace(/.*<span class=\\\"review-title\\\">.*?>(.*?)<.*/,\"$1\"),\n        rating:     elements[i].replace(/.*aria-label=\\\"5\u3064\u661f\u306e\u3046\u3061(.*?)\u3064\u661f\u3067\u8a55\u4fa1\u3057\u307e\u3057\u305f.*/,\"$1\")\n\n      });\n    }\n    result.reviews = review;\n\n    return result;\n  } catch(e) {\n    return {\n      error:   true,\n      title:   \"\",\n      link:    url,\n      reviews: review\n    };\n  }\n}\n\n\n#\u6982\u8981\n\u30ea\u30ea\u30fc\u30b9\u3057\u3066\u3044\u308b\u30a2\u30d7\u30ea\u304c\u591a\u3044\u3068\u3001\u30ec\u30d3\u30e5\u30fc\u306e\u30c1\u30a7\u30c3\u30af\u3068\u304b\u5927\u5909\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff1f\n\n\u3063\u3066\u3053\u3068\u3067\u3001\u524d\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u3092\u307e\u3068\u3081\u3066\u30e1\u30fc\u30eb\u3067\u9001\u3063\u3066\u304f\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092GAS\u3067\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\uff01\n\nAppStore\u306f\u3001\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\u306eAPI\u3092\u4f7f\u3044\u307e\u3057\u305f\u304c\u3001GooglePlay\u306b\u306fAPI\u304c\u306a\u3044\u306e\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3057\u3066\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001GooglePlay\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u5909\u308f\u3063\u305f\u308a\u3059\u308b\u3068\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n#\u30ec\u30d3\u30e5\u30fc\u30e1\u30fc\u30eb\u30b5\u30f3\u30d7\u30eb\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u524d\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u3092\u62bd\u51fa\u3057\u305f\u30e1\u30fc\u30eb\u304c\u6bce\u65e5\u9001\u3089\u308c\u3066\u304d\u307e\u3059\u3002\n\n```\n\u25a0\n\u25a0 GooglePlay : \u6fc0J\u30d1\u30c1\u30b9\u30ed 2027\n\u25a0 https://play.google.com/store/apps/details?id=jp.dorasu.apps.and2027\n\u25a0\n\n2016/3/31 \u00d7\u00d7\u00d7\u00d7\n\u4f55\u3082\u3067\u304d\u307e\u305b\u3093 \u2605\u2606\u2606\u2606\u2606\n \u843d\u3068\u3057\u305f\u3051\u3069\u3044\u304d\u306a\u308a\u505c\u6b62\u3000\u4f55\u3082\u3067\u304d\u307e\u305b\u3093\u3000\u304a\u91d1\u3082\u53d6\u3089\u308c\u305f\u307e\u3093\u307e\u3000\u5b89\u58f2\u308a\u306e\u7f60\n\n\n\u25a0\n\u25a0 GooglePlay : \u6fc0J\u30d1\u30c1\u30b9\u30ed BLACK LAGOON\n\u25a0 https://play.google.com/store/apps/details?id=jp.dorasu.apps.blacklagoon\n\u25a0\n\n2016/3/31 \u25a1\u25a1\u25a1\u25a1\n \u2605\u2605\u2605\u2605\u2605\n \u61d0\u304b\u3057\u304f\u3066\u3088\u304b\u3063\u305f\n\n\n\u25a0\n\u25a0 AppStore : \u6fc0J\u30d1\u30c1\u30b9\u30ed BLACK LAGOON 2\n\u25a0 https://itunes.apple.com/jp/app/jijpachisuro-black-lagoon-2/id961851134?mt=8&uo=2\n\u25a0\n\n2016/03/31 11:24:00 \u306f\u3056\u305a\n\u306f\u3042 \u2605\u2605\u2605\u2605\u2605\n\u304a\u3082\u308d\u3044\n\n\n\u25a0\n\u25a0 AppStore : \u6fc0J\u30d1\u30c1\u30b9\u30ed HIGHSCHOOL OF THE DEAD\n\u25a0 https://itunes.apple.com/jp/app/jijpachisuro-highschool-dead/id684256528?mt=8&uo=2\n\u25a0\n\n2016/03/31 08:11:00 \u3089\u3086\u306a\u3055\n\u3088\u3044 \u2605\u2605\u2605\u2605\u2606\n\u3088\u3044\u3088\u3001\u3088\u3044\n\n2016/03/31 00:40:00 \u25b3\u25b3\u30b5\u30c0\u30aa\u30b7\n\u306a\u304b\u306a\u304b\u826f\u3044 \u2605\u2605\u2605\u2605\u2606\n\u5b9f\u6a5f\u306b\u304b\u306a\u308a\u8fd1\u3044\u30af\u30aa\u30ea\u30c6\u30a3\u30fc\u3002\n```\n\n#\u30ec\u30d3\u30e5\u30fc\u3092\u3068\u3063\u3066\u304f\u308b\u30a2\u30d7\u30ea\u306e\u6307\u5b9a\n\n\u30a2\u30d7\u30eaID\u3092B\u5217\u306e2\u884c\u76ee\u304b\u3089\u8a18\u8f09\u3057\u305f\u30ea\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u4f7f\u3046\u306e\u306f\uff22\u5217\u306e\u307f\u3067\u3059\u3002\n\nAppStore\u3068GooglePlay\u306f\u5225\u306e\u30b7\u30fc\u30c8\u3067\u4f5c\u6210\u3057\u3001\u30b7\u30fc\u30c8\u540d\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n![\u30b7\u30fc\u30c8AppStore-Screenshot.png](https://qiita-image-store.s3.amazonaws.com/0/49562/b511ec8e-8490-63de-1466-351f5fb7ab50.png)\n\n![\u30b7\u30fc\u30c8GooglePlay-Screenshot.png](https://qiita-image-store.s3.amazonaws.com/0/49562/a14b1f83-bc9b-bf3d-6550-a30addd46d45.png)\n\n\n#\u30b3\u30fc\u30c9\n```js:\u30b3\u30fc\u30c9.GS\n//\n// \u6628\u65e5\u306e\u30a2\u30d7\u30ea\u30ec\u30d3\u30e5\u30fc\u3092\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\n//\nfunction sendMailYesterdayReview() {\n  \n  //\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u8a18\u8f09\u306e\u30a2\u30d7\u30eaID\u306e\u30ec\u30d3\u30e5\u30fc\u3092\u53d6\u5f97\u3001\u6574\u5f62\n  var text = \"\";\n  text += jobSheet(\"GooglePlay\", \"Dorasu GooglePlay\");\n  text += jobSheet(\"AppStore\", \"Dorasu AppStore\");\n  \n  //\u53d6\u5f97\u3057\u305f\u30ec\u30d3\u30e5\u30fc\u3092\u30e1\u30fc\u30eb\u9001\u4fe1\n  var MAIL_TO    = \"XXXX@XXXXX.XXXX,YYYY@YYYYY.YYY\";\n  var MAIL_TITLE = \"\u30a2\u30d7\u30ea\u30ec\u30d3\u30e5\u30fc\";\n  if (text != \"\") {\n    MailApp.sendEmail(MAIL_TO, MAIL_TITLE, text);\n    Logger.log(\"\u30e1\u30fc\u30eb\u9001\u4fe1 to:\"+MAIL_TO+\"  title:\"+MAIL_TITLE+\"\\n\"+text);\n  } else {\n    Logger.log(\"\u6628\u65e5\u5206\u306e\u30ec\u30d3\u30e5\u30fc\u304c\u306a\u3044\u306e\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u306f\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\");\n  }\n}\n\n\n// 1\u30b7\u30fc\u30c8\u5206\u306e\u51e6\u7406\nfunction jobSheet(type, sheetName)\n{\n  var ROW_START = 2;  //ID\u304c\u5165\u3063\u3066\u3044\u308b\u884c\u306e\u958b\u59cb\u4f4d\u7f6e\n  var COL_ID    = 2;  //ID\u304c\u5165\u3063\u3066\u3044\u308b\u5217\n  \n  var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(sheetName);\n  var values = sheet.getDataRange().getValues();\n\n  Logger.log(\"\u30b7\u30fc\u30c8[\"+sheetName+\"] \u51e6\u7406\u958b\u59cb\");\n  \n  var cnt=0;\n  var text = \"\";\n  for(var i = ROW_START-1; i < values.length; i++){    \n    var id = values[i][COL_ID-1];\n    text += jobTitle(type, id);\n    cnt++;\n  } \n  \n  Logger.log(\"\u30b7\u30fc\u30c8[\"+sheetName+\"] \"+cnt+\"\u30bf\u30a4\u30c8\u30eb\u51e6\u7406\u7d42\u4e86\");\n  \n  return text;\n}\n\n// \uff11\u30bf\u30a4\u30c8\u30eb\u5206\u306e\u51e6\u7406\nfunction jobTitle(type, id)\n{\n  var result;\n  var text = \"\";\n  \n  //\u30ec\u30d3\u30e5\u30fc\u3092\u3068\u3063\u3066\u304f\u308b\n  if (type == \"AppStore\") {\n    result = fetchReviewAppStore(id);\n    result.type = \"AppStore\";\n  } else {\n    result = fetchReviewGooglePlay(id);\n    result.type = \"GooglePlay\";\n  }\n  \n  //\u30a8\u30e9\u30fc\n  if (result.error) {\n    text = \"ERROR : \" + result.url + \"\\n\";\n    Logger.log(text);\n    return text;\n  }\n  \n  //\u6628\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u3092\u62bd\u51fa\n  var date = new Date();\n  date.setDate(date.getDate()-1);\n  result.reviews = extractReviewByDate(result.reviews, date);\n    \n  if (result.reviews.length > 0) {\n    //\u30bf\u30a4\u30c8\u30eb\n    text += \"\\n\";\n    text += \"\u25a0\\n\";\n    text += \"\u25a0 \" + result.type + \" : \" + result.title + \"\\n\";\n    text += \"\u25a0 \" + result.link + \"\\n\";\n    text += \"\u25a0\\n\";\n    text += \"\\n\";\n    \n    //\u30ec\u30d3\u30e5\u30fc\u3092\u65b0\u3057\u3044\u9806\u306b\u30bd\u30fc\u30c8\u3057\u3066\u8ffd\u52a0\n    result.reviews.sort((function(a,b){return(new Date(b.date).getTime() - new Date(a.date).getTime());}));\n    text += formatReview(result.reviews);\n    \n  }\n  \n  Logger.log(id+\" \"+result.title+\" \"+result.reviews.length+\"\u30ec\u30d3\u30e5\u30fc\");\n\n  return text;\n}\n\n\n//\u30ec\u30d3\u30e5\u30fc\u3092\u6574\u5f62\nfunction formatReview(reviews)\n{\n  var text = \"\";\n  \n  for (var i in reviews) {\n    text = text + reviews[i].date + \" \" + reviews[i].author + \"\\n\";\n    text = text + reviews[i].title + \" \" + (\"\u2605\u2605\u2605\u2605\u2605\u2606\u2606\u2606\u2606\u2606\").substr(5-reviews[i].rating, 5) + \"\\n\";\n    text = text + reviews[i].content + \"\\n\";\n    text = text + \"\\n\";\n  }\n  \n  return text;\n}\n\n//\u6307\u5b9a\u65e5\u306e\u30ec\u30d3\u30e5\u30fc\u306e\u307f\u62bd\u51fa\nfunction extractReviewByDate(reviews, date)\n{\n  var result = [];\n  \n  date.setHours(0);\n  date.setMinutes(0);\n  date.setSeconds(0);\n  date.setMilliseconds(0);\n  \n  for (var i in reviews) {\n    var d = new Date(reviews[i].date);\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n    if (d.getTime() == date.getTime()) {\n      result.push(reviews[i]);\n    }\n  }\n  \n  return result;\n}\n\n\n\n// AppStore\u304b\u3089\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\nfunction fetchReviewAppStore(id) {\n  var url = \"https://itunes.apple.com/jp/rss/customerreviews/id=\" + id + \"/xml\";\n  var query = 'select * from xml where url=\"' + url + '\"';\n  var response = UrlFetchApp.fetch(\"https://query.yahooapis.com/v1/public/yql?format=json&q=\"+encodeURIComponent(query),{'muteHttpExceptions':true});\n  try {\n    var entrys = JSON.parse(response).query.results.feed.entry;\n    var result = {};\n    var review = [];\n    \n    for (var entry in entrys) {\n      if (entry == 0) {\n        result.title = entrys[entry].name;\n        result.link  = entrys[entry].link.href;\n      }\n      else {\n        review.push({\n          date:    entrys[entry].updated.replace(/(.*?)-(.*?)-(.*?)T(.*?)-.*/,\"$1/$2/$3 $4\"),\n          title:   entrys[entry].title,\n          content: entrys[entry].content[0].content,\n          rating:  entrys[entry].rating,\n          version: entrys[entry].version,\n          author:  entrys[entry].author.name\n        });\n      }\n    }\n    result.reviews = review;\n    return result;\n  } catch (e) {\n    return {\n      error:   true,\n      title:   \"\",\n      link:    url,\n      reviews: review\n    };\n  }    \n}\n\n\n// GooglePlay\u304b\u3089\u30ec\u30d3\u30e5\u30fc\u53d6\u5f97\nfunction fetchReviewGooglePlay(id) {\n  var url      = \"https://play.google.com/store/apps/details?id=\" + id;\n  var response = UrlFetchApp.fetch(url,{'muteHttpExceptions':true});\n  try {\n    var result = {};\n    var review = [];\n    \n    result.error = false;\n    \n    var regexp   = /<div class=\\\"id-app-title\\\".+?<\\/div>/gi;\n    var elements = response.getContentText().match(regexp);\n    result.title = elements[0].replace(/.*?>(.*?)<.*/,\"$1\");\n    result.link  = url;\n    \n    var regexp   = /<div class=\\\"single-review\\\".+?class=\\\"review-link\\\"/gi;\n    var elements = response.getContentText().match(regexp);\n    for (var i in elements) {\n      review.push({\n        author:     elements[i].replace(/.*<span class=\\\"author-name\\\">.*?>(.*?)<.*/,\"$1\"),\n        date:       elements[i].replace(/.*<span class=\\\"review-date\\\">(.*?)\u5e74(.*?)\u6708(.*?)\u65e5.*/,\"$1/$2/$3\"),\n        title:      elements[i].replace(/.*<span class=\\\"review-title\\\">(.*?)<.*/,\"$1\"),\n        content:    elements[i].replace(/.*<span class=\\\"review-title\\\">.*?>(.*?)<.*/,\"$1\"),\n        rating:     elements[i].replace(/.*aria-label=\\\"5\u3064\u661f\u306e\u3046\u3061(.*?)\u3064\u661f\u3067\u8a55\u4fa1\u3057\u307e\u3057\u305f.*/,\"$1\")\n        \n      });\n    }\n    result.reviews = review;\n    \n    return result;\n  } catch(e) {\n    return {\n      error:   true,\n      title:   \"\",\n      link:    url,\n      reviews: review\n    };\n  }\n}\n```\n"}