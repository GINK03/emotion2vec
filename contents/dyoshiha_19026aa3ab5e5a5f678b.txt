{"context": "\n\n\u672c\u7a3f\u306e\u69cb\u6210\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u5185\u5bb9\n\u30b3\u30e1\u30f3\u30c8\n\n\n\n\nCisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff11\nPuppet Master \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5143\u30cd\u30bf\uff1aInstalling Puppet: Linux\n\n\n\nCisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff12\uff41\nPuppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fbBash\u7de8\n\u5143\u30cd\u30bf\uff1aPuppet Agent Installation & Setup: Cisco Nexus\n\n\n\nCisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff12\uff42\nPuppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fbguestshell\u7de8\n\u672a\u5b8c\u6210\n\n\nCisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff13\npuppetlabs-ciscopuppet \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5143\u30cd\u30bf\uff1acisco-network-puppet-module: Example Manifest Usage\n\n\n\n\n\n\u306f\u3058\u3081\u306b\n\u203b\u5f53\u521d Guestshell \u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u9032\u3081\u307e\u3057\u305f\u304c\u554f\u984c\u306b\u906d\u9047\uff08puppetlabs-ciscopuppet \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u306a\u3044\uff09\u3057\u305f\u305f\u3081 bash \u3092\u4f7f\u3046\u65b9\u6cd5\u306b\u8a18\u8ff0\u3092\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\n\n\u4e8b\u524d\u6e96\u5099\uff1aNexus3048 \u3078 Puppet Agent \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u524d\u306b\n\nNexus3048 \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\n7.0(3)I2(1) \u304b\u3089 NX-OS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u65b9\u6cd5\u304c\u5909\u66f4\u3055\u308c\u305f\u3002Open Bootloader \u3068\u547c\u3070\u308c\u308b\u624b\u6cd5\u304c\u63a1\u7528\u3055\u308c\u4e3b\u306a\u5909\u66f4\u70b9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\uff08\u8a73\u7d30\uff09\uff1a\n\n\u5f93\u6765 NX-OS \u306b\u306f system (\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f8b\uff1an3000-uk9.6.0.2.U6.5.bin) \u3068 kickstart \uff12\u3064\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u305f\u304c\u3001\u65b0\u624b\u6cd5\u3067\u306f nx-os (\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f8b\uff1anxos.7.0.3.I2.2a.bin) \u3068\u8a00\u3046\u540d\u306e\u30a4\u30e1\u30fc\u30b8\uff11\u3064\u3078\u96c6\u7d04\u3055\u308c\u305f\n\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3082\u5909\u66f4\u3055\u308c\u305f\u3002\u4f8b\uff1ainstall all nxos bootflash:nxos.7.0.3.I2.1.bin\n\n\n\u203b\u6ce8\u610f\u70b9\n6.0(2)U6(2) \u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089 7.0(3)I2(1) \u4ee5\u964d\u3078\u3044\u304d\u306a\u308a\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u5931\u6557\u3059\u308b\uff08\u8a73\u7d30\uff09\u3002\nswitch# install all nxos bootflash:nxos.7.0.3.I2.2a.bin\nInstaller is forced disruptive\n\nVerifying image bootflash:/nxos.7.0.3.I2.2a.bin for boot variable \"nxos\".\n[########################################] 100% -- SUCCESS\n\nVerifying image type.\n[########################################] 100% -- SUCCESS\n\nExtracting \"nxos\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nExtracting \"bios\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\nPre-upgrade check failed. Return code 0x40930053 (failed to collection plugin information).\n\n\u5bfe\u5fdc\u7b56\u306f\u4e00\u5ea6 6.0(2)U6(3) \u3078\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u305f\u5f8c\u306b 7.0(3)I2(1) \u3078\u4e0a\u3052\u308c\u3070\u3088\u3044\u3002\nswitch# install all system bootflash:n3000-uk9.6.0.2.U6.3.bin kickstart bootflash:n3000-uk9-kickstart.6.0.2.U6.3.bin\n\n\u4ee5\u4e0b\u306f\u3046\u307e\u304f\u3044\u3063\u305f\u5834\u5408\u306e\u30ed\u30b0\uff086.0(2)U6(3) \u2192 7.0(3)I2(2a) \uff09\nswitch# install all nxos nxos.7.0.3.I2.2a.bin\nInstaller is forced disruptive\n\nVerifying image bootflash:/nxos.7.0.3.I2.2a.bin for boot variable \"nxos\".\n[########################################] 100% -- SUCCESS\n\nVerifying image type.\n[########################################] 100% -- SUCCESS\n\nExtracting \"nxos\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nExtracting \"bios\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nPerforming runtime checks.\n[########################################] 100% -- SUCCESS\n\nPerforming module support checks.\n[########################################] 100% -- SUCCESS\n\nNotifying services about system upgrade.\n[########################################] 100% -- SUCCESS\n\n\n\nCompatibility check is done:\nModule  bootable          Impact  Install-type  Reason\n------  --------  --------------  ------------  ------\n     1       yes      disruptive         reset  Unsupported in new image, module needs to be powered off\n\n\n\nImages will be upgraded according to following table:\nModule             Image         Running-Version             New-Version  Upg-Required\n------  ----------------  ----------------------  ----------------------  ------------\n     1         kickstart             6.0(2)U6(3)            7.0(3)I2(2a)           yes\n     1              bios      v1.2.0(08/25/2011)      v3.4.0(08/07/2015)           yes\n\n\nSwitch will be reloaded for disruptive upgrade.\nDo you want to continue with the installation (y/n)?  [n] y\n\n\nNX-OS \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\u4eca\u56de\u4f7f\u7528\u3059\u308b Nexus3048 \u306f\u4ee5\u4e0b\u306e\u5f62\uff1a\nNexus3048 (mgmt interface) ------ L2 \u30b9\u30a4\u30c3\u30c1 ----- \u30b3\u30f3\u30bd\u30fc\u30eb\u7528PC\n\u203b \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u304c\u5fc5\u8981\u3002\u4e0a\u8a18\u69cb\u6210\u56f3\u3067\u306fL2\u30b9\u30a4\u30c3\u30c1\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u60f3\u5b9a\u3002Nexus3048 \u306e mgmt interface (int mgmt0) \u7d4c\u7531\u3067\u63a5\u7d9a\u3092\u884c\u3063\u3066\u304a\u308a\u3001\u901a\u5e38 mgmt0 \u306f management \u3068\u3044\u3046\u540d\u306e VRF \u306b\u6240\u5c5e\u3055\u305b\u308b\u304c\u3001Bash \u306b\u5165\u3063\u305f\u5834\u5408\u3082 VRF \u306e\u5207\u308a\u66ff\u3048\u304c\u5fc5\u8981\uff08managemtn VRF \u3078\u5207\u308a\u66ff\u3048\u308b \u306b\u306f ip netns exec management bash\uff09\nNX-OS \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u4f8b\u306f\u4ee5\u4e0b\uff1a\nswitch# config term\nswitch(config)# ntp server 10.0.0.201 use-vrf management\nswitch(config)# vrf context management\nswitch(config)# ip name-server 10.0.0.202\nswitch(config)# ip domain-name mycompany.com\nswitch(config)# ip route 0.0.0.0/0 10.0.0.1\n\nswitch(config)# interface mgmt0\nswitch(config-if)# vrf member management\nswitch(config-if)# ip address 10.0.0.99/24\nswitch(config-if)# end\n\n\n\u8a2d\u5b9a\u65b9\u6cd5\u306e\u9078\u629e\uff08bash-shell or guestshell\uff09\nPuppet \u3092 Nexus3048 \u306e\u3069\u3053\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u304b\uff1f\nNX-OS \u306f\u5b9f\u306f Linux \u4e0a\u3067\u52d5\u3044\u3066\u304a\u308a\u3001\u305d\u306e\u30cd\u30a4\u30c6\u30a3\u30d6\u306e bash \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u3068\u3001Linux \u30b3\u30f3\u30c6\u30ca\u5185\u306e guestshell \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u306e\u4e8c\u901a\u308a\u304c\u5b58\u5728\u3059\u308b\u3002\u4eca\u56de\u306f Bash-shell \u306b\u3066\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nPuppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\uff08Bash-shell\u7de8\uff09\n\n\u57fa\u672c\u8a2d\u5b9a\nswitch# configure terminal\nswitch(config)# feature bash-shell\nswitch(config)# hostname n3k\nn3k# run bash\nbash-4.2$\nbash-4.2$ sudo su -\nroot@n3k# ip netns exec management bash\nroot@n3k# cat >> /etc/resolv.conf << EOF\nnameserver 10.0.0.202\ndomain mycompany.com\nsearch mycompany.com\nEOF\n\nip netns exec management bash \u306f VRF \u3092 VRF\u540d\uff1d management \u3078\u5909\u66f4\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\nNX-OS \u306e bash \u306f\u72ec\u81ea\u306e\u30af\u30bb\u304c\u3042\u308a\u3001Linux \u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u5909\u66f4\u3057\u3066\u3082\u518d\u8d77\u52d5\u3059\u308b\u3068\u5143\u306b\u623b\u3063\u3066\u3057\u307e\u3046\u3002\u4eca\u56de\u306f /etc/resolv.conf \u3078\u306e\u5909\u66f4\u3092\u3057\u3066\u3044\u308b\u304c\u3053\u308c\u3092\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u306b\u3057\u305f\u3044\u5834\u5408\u306f NX-OS \u306e\u30b7\u30a7\u30eb\u306b\u623b\u3063\u3066 copy running-config startup-config \u3092\u3059\u308b\u304b\u3001\u307e\u305f\u306f bash \u30b7\u30a7\u30eb\u304b\u3089\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\uff1a\n# vsh -c 'copy running-config startup-config'\n\n\nProxy \u8a2d\u5b9a\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\nproxy \u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306f proxy \u306e\u8a2d\u5b9a\u3092\u884c\u3046\uff1a\n# vi /etc/profile\n\nPROXY='proxy.server.com'\nexport http_proxy=$PROXY\nexport HTTP_PROXY=$PROXY\nexport HTTPS_PROXY=$PROXY\nexport https_proxy=$PROXY\n\n\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\uff1a\n# source /etc/profile\n\nproxy \u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306f yum \u306b\u3064\u3044\u3066\u3082 proxy \u306e\u8a2d\u5b9a\u3092\u884c\u3046\uff1a\n# vi /etc/yum.conf\n\nproxy=http://proxy.server.com:8080\n\n\nPuppet Agent RPM \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4ee5\u4e0b\u306e2\u884c\u3092\u5b9f\u65bd\u3059\u308c\u3070\u3088\u3044\uff1a\n# yum install http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm\n# yum install puppet\n\n\u3068\u3053\u308d\u304c\u30011\u884c\u76ee\u5b9f\u884c\u5f8c\nSetting up Install Process\npuppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm        | 5.8 kB     00:00\nwarning: rpmts_HdrFromFdno: Header V4 RSA/SHA512 signature: NOKEY, key ID 4bd6ec30\nCannot open: http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm. Skipping.\nError: Nothing to do\n\n\u3067\u6b62\u307e\u3063\u3066\u3057\u307e\u3063\u305f\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u3067\u89e3\u6c7a\u3067\u304d\u305f\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u306b\u554f\u984c\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\uff1a\n# wget http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm\n\nGPG-key \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff1a\n# rpm --import http://yum.puppetlabs.com/RPM-GPG-KEY-puppetlabs\n# rpm --import http://yum.puppetlabs.com/RPM-GPG-KEY-reductive\n\n\u4ee5\u4e0a\u3067\u554f\u984c\u304c\u89e3\u6c7a\u3057\u3001\u4e0a\u8a18\u4e8c\u884c\u306e yum install \u304c\u5b9f\u884c\u53ef\u80fd\u3068\u306a\u308b\u3002\n\u203b Nexus9000 7.0(3)I4(1) \u306b\u306f rpm \u306b\u554f\u984c\u304c\u3042\u308b\u3089\u3057\u304f yum install \u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff1a\nsed: can't read /bootflash/.rpmstore/thirdparty/inactive_feature_rpms.inf: No such file or directory\n\n2016/7/19 \u6642\u70b9\u3067\u306f\u3053\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3057\u305f 7.0(3)I2(2e) \u304c\u63a8\u5968\n\nPATH \u306e Update\n# export PATH=/opt/puppetlabs/puppet/bin:/opt/puppetlabs/puppet/lib:$PATH\n\n\ncisco_node_utils gem \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nPuppet \u306f cisco_node_utils gem \u3092\u4f7f\u3046\u306e\u3067\u5fc5\u305a Agent \u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n# /opt/puppetlabs/puppet/bin/gem install cisco_node_utils\n\n\u6210\u529f\u3059\u308b\u3068 cisco_node_utils, cisco_nxapi, net_http_unix \u306e 3\u3064\u306e gem \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\u78ba\u8a8d\u306f gem list \u3067\u53ef\u80fd\uff1a\n# /opt/puppetlabs/puppet/bin/gem list | egrep 'cisco|net_http'\ncisco_node_utils (1.2.0)\ncisco_nxapi (1.0.1)\nnet_http_unix (0.2.1)\n\n\ngem \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306e\u88dc\u8db3\nGuestshell \u306e\u5834\u5408 gem \u306f\u4e00\u5ea6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u5b8c\u4e86\u3002\nNX-OS bash-shell \u306e\u5834\u5408\u3001/opt/puppetlabs \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u518d\u8d77\u52d5\u3067\u6d88\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u518d\u8d77\u52d5\u306e\u90fd\u5ea6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u3044\u3061\u3044\u3061\u624b\u4f5c\u696d\u3067\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u3001\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u6700\u521d\u306b include ciscopuppet::install \u3092\u8a18\u8ff0\u3059\u308c\u3070\u81ea\u52d5\u3067\u6700\u65b0\u306e gem \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u3002\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u5177\u4f53\u4f8b\u306f \u3053\u3061\u3089 \u53c2\u7167\u3002\n\nPuppet \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\nvi /etc/puppetlabs/puppet/puppet.conf\n\n[main]\n  server = sevtdc001.localdomain\n\n[agent]\n  pluginsync  = true\n  ignorecache = true\n\n\ninit.d \u3092\u5909\u66f4\n# cp /etc/init.d/puppet /etc/init.d/puppet.old\n# vi /etc/init.d/puppet\n\n    #daemon $daemonopts $puppetd ${PUPPET_OPTS} ${PUPPET_EXTRA_OPTS}\n    daemon $daemonopts ip netns exec management $puppetd ${PUPPET_OPTS} ${PUPPETT\n_EXTRA_OPTS}\n\n\npuppet service \u3092\u8d77\u52d5\uff1a\n# chkconfig --add puppet\n# chkconfig --level 345 puppet on\n# service puppet start\n\n\npuppet Agent \u306e\u5b9f\u884c\npuppet agent -t \u30b3\u30de\u30f3\u30c9\u306b\u3066 Puppet Agent \u3092\u5b9f\u884c\u53ef\u80fd\u3002\u73fe\u5728 Puppet Master \u306b\u306f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u540c\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068 Puppet Master \u3068\u306e\u63a5\u7d9a\u6027\u78ba\u8a8d\u306e\u307f\u304c\u884c\u308f\u308c\u308b\u3002\u63a5\u7d9a\u306b\u306f\u8a3c\u660e\u66f8\u304c\u5229\u7528\u3055\u308c\u308b\u3002\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\uff1a\n# puppet agent -t\nInfo: Caching certificate for ca\nInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\nInfo: Creating a new SSL certificate request for n3k.mycompany.com\nInfo: Certificate Request fingerprint (SHA256): \nInfo: Caching certificate for ca\nExiting; no certificate found and waitforcert is disabled\n\n\u3068\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u304c\u3053\u308c\u306f\u671f\u5f85\u3055\u308c\u305f\u52d5\u4f5c\u3067\u3042\u308a\u3001Puppet Agent \u3092 Puppet Master \u306b\u767b\u9332\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3002\u8a66\u3057\u306b Puppet Master \u306b\u3066\u8a3c\u660e\u66f8\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u308b\uff1a\n# puppet cert list --all\n  \"n3k.cisco.com\"         (SHA256) x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x\n+ \"localhost.localdomain\" (SHA256) x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x (alt names: \"DNS:puppet\", \"DNS:localhost.localdomain\"\n\n\u4e0a\u8a18\u51fa\u529b\u4f8b\u306e\u3088\u3046\u306b\u8a72\u5f53 Puppet Agent \u306e\u982d\u306b + \u304c\u3064\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u306f Agent \u306e\u8a3c\u660e\u66f8\u306b\u7f72\u540d\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u305d\u3053\u3067 Puppet Master \u5074\u3067\u767b\u9332\u3092\u884c\u3046\uff1a\n# puppet cert sign --all\n\n\u518d\u5ea6 Puppet Agent \u306b\u3066 puppet agent -t \u3092\u5b9f\u884c\uff1a\n# puppet agent -t\nInfo: Caching certificate_revocation_list for ca\nInfo: Using configured environment 'production'\nInfo: Retrieving pluginfacts\nInfo: Retrieving plugin\nInfo: Caching catalog for n3k.mycompany.com\nInfo: Applying configuration version '1452153556'\nInfo: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml\nNotice: Applied catalog in 0.02 seconds\n\n\u7121\u4e8b\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3002\n# \u672c\u7a3f\u306e\u69cb\u6210\n\n| \u30bf\u30a4\u30c8\u30eb | \u5185\u5bb9 | \u30b3\u30e1\u30f3\u30c8 |\n|:-----------|:------------|:------------|\n|[Cisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff11](http://qiita.com/dyoshiha/items/079d04e42a1e66e29d89)|Puppet Master \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb|\u5143\u30cd\u30bf\uff1a[Installing Puppet: Linux](https://docs.puppet.com/puppet/4.0/reference/install_linux.html#installing-release-packages-on-yumrpm-systems)|\n|[Cisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff12\uff41](http://qiita.com/dyoshiha/items/19026aa3ab5e5a5f678b)|Puppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fbBash\u7de8|\u5143\u30cd\u30bf\uff1a[Puppet Agent Installation & Setup: Cisco Nexus](https://github.com/cisco/cisco-network-puppet-module/blob/develop/docs/README-agent-install.md)|\n|Cisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff12\uff42|Puppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fbguestshell\u7de8|\u672a\u5b8c\u6210|\n|[Cisco Nexus \u3092 Puppet \u3067\u8a2d\u5b9a\u3059\u308b\uff13](http://qiita.com/dyoshiha/items/2642ea3d4b3bf9c02e51)|puppetlabs-ciscopuppet \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb|\u5143\u30cd\u30bf\uff1a[cisco-network-puppet-module: Example Manifest Usage](https://github.com/cisco/cisco-network-puppet-module/blob/develop/examples/README.md)|\n\n# \u306f\u3058\u3081\u306b\n\n**\u203b\u5f53\u521d Guestshell \u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u9032\u3081\u307e\u3057\u305f\u304c\u554f\u984c\u306b\u906d\u9047\uff08puppetlabs-ciscopuppet \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u306a\u3044\uff09\u3057\u305f\u305f\u3081 bash \u3092\u4f7f\u3046\u65b9\u6cd5\u306b\u8a18\u8ff0\u3092\u5909\u66f4\u3057\u3066\u3044\u307e\u3059**\n\n# \u4e8b\u524d\u6e96\u5099\uff1aNexus3048 \u3078 Puppet Agent \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u524d\u306b\n## Nexus3048 \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\n\n7.0(3)I2(1) \u304b\u3089 NX-OS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u65b9\u6cd5\u304c\u5909\u66f4\u3055\u308c\u305f\u3002Open Bootloader \u3068\u547c\u3070\u308c\u308b\u624b\u6cd5\u304c\u63a1\u7528\u3055\u308c\u4e3b\u306a\u5909\u66f4\u70b9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\uff08[\u8a73\u7d30]\n(http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus3000/sw/release/70321/n3k_70321_nxos_rn.html)\uff09\uff1a\n\n* \u5f93\u6765 NX-OS \u306b\u306f system (\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f8b\uff1an3000-uk9.6.0.2.U6.5.bin) \u3068 kickstart \uff12\u3064\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u305f\u304c\u3001\u65b0\u624b\u6cd5\u3067\u306f nx-os (\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f8b\uff1anxos.7.0.3.I2.2a.bin) \u3068\u8a00\u3046\u540d\u306e\u30a4\u30e1\u30fc\u30b8\uff11\u3064\u3078\u96c6\u7d04\u3055\u308c\u305f\n* \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3082\u5909\u66f4\u3055\u308c\u305f\u3002\u4f8b\uff1ainstall all nxos bootflash:nxos.7.0.3.I2.1.bin\n\n## \u203b\u6ce8\u610f\u70b9\n6.0(2)U6(2) \u4ee5\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089 7.0(3)I2(1) \u4ee5\u964d\u3078\u3044\u304d\u306a\u308a\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u5931\u6557\u3059\u308b\uff08[\u8a73\u7d30](http://www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus3000/sw/release/70321_Overview/CiscoNXOSRelease70321Overview.html)\uff09\u3002\n\n```\nswitch# install all nxos bootflash:nxos.7.0.3.I2.2a.bin\nInstaller is forced disruptive\n\nVerifying image bootflash:/nxos.7.0.3.I2.2a.bin for boot variable \"nxos\".\n[########################################] 100% -- SUCCESS\n\nVerifying image type.\n[########################################] 100% -- SUCCESS\n\nExtracting \"nxos\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nExtracting \"bios\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\nPre-upgrade check failed. Return code 0x40930053 (failed to collection plugin information).\n```\n\n\u5bfe\u5fdc\u7b56\u306f\u4e00\u5ea6 6.0(2)U6(3) \u3078\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u305f\u5f8c\u306b 7.0(3)I2(1) \u3078\u4e0a\u3052\u308c\u3070\u3088\u3044\u3002\n\n```\nswitch# install all system bootflash:n3000-uk9.6.0.2.U6.3.bin kickstart bootflash:n3000-uk9-kickstart.6.0.2.U6.3.bin\n```\n\n\u4ee5\u4e0b\u306f\u3046\u307e\u304f\u3044\u3063\u305f\u5834\u5408\u306e\u30ed\u30b0\uff086.0(2)U6(3) \u2192 7.0(3)I2(2a) \uff09\n\n```\nswitch# install all nxos nxos.7.0.3.I2.2a.bin\nInstaller is forced disruptive\n\nVerifying image bootflash:/nxos.7.0.3.I2.2a.bin for boot variable \"nxos\".\n[########################################] 100% -- SUCCESS\n\nVerifying image type.\n[########################################] 100% -- SUCCESS\n\nExtracting \"nxos\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nExtracting \"bios\" version from image bootflash:/nxos.7.0.3.I2.2a.bin.\n[########################################] 100% -- SUCCESS\n\nPerforming runtime checks.\n[########################################] 100% -- SUCCESS\n\nPerforming module support checks.\n[########################################] 100% -- SUCCESS\n\nNotifying services about system upgrade.\n[########################################] 100% -- SUCCESS\n\n\n\nCompatibility check is done:\nModule  bootable          Impact  Install-type  Reason\n------  --------  --------------  ------------  ------\n     1       yes      disruptive         reset  Unsupported in new image, module needs to be powered off\n\n\n\nImages will be upgraded according to following table:\nModule             Image         Running-Version             New-Version  Upg-Required\n------  ----------------  ----------------------  ----------------------  ------------\n     1         kickstart             6.0(2)U6(3)            7.0(3)I2(2a)           yes\n     1              bios      v1.2.0(08/25/2011)      v3.4.0(08/07/2015)           yes\n\n\nSwitch will be reloaded for disruptive upgrade.\nDo you want to continue with the installation (y/n)?  [n] y\n```\n\n\n## NX-OS \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\n\u4eca\u56de\u4f7f\u7528\u3059\u308b Nexus3048 \u306f\u4ee5\u4e0b\u306e\u5f62\uff1a\n\nNexus3048 (mgmt interface) ------ L2 \u30b9\u30a4\u30c3\u30c1 ----- \u30b3\u30f3\u30bd\u30fc\u30eb\u7528PC\n\n\u203b \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u304c\u5fc5\u8981\u3002\u4e0a\u8a18\u69cb\u6210\u56f3\u3067\u306fL2\u30b9\u30a4\u30c3\u30c1\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u60f3\u5b9a\u3002Nexus3048 \u306e mgmt interface (int mgmt0) \u7d4c\u7531\u3067\u63a5\u7d9a\u3092\u884c\u3063\u3066\u304a\u308a\u3001\u901a\u5e38 mgmt0 \u306f management \u3068\u3044\u3046\u540d\u306e VRF \u306b\u6240\u5c5e\u3055\u305b\u308b\u304c\u3001**Bash \u306b\u5165\u3063\u305f\u5834\u5408\u3082 VRF \u306e\u5207\u308a\u66ff\u3048\u304c\u5fc5\u8981\uff08managemtn VRF \u3078\u5207\u308a\u66ff\u3048\u308b \u306b\u306f ip netns exec management bash\uff09**\n\nNX-OS \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u4f8b\u306f\u4ee5\u4e0b\uff1a\n\n```\nswitch# config term\nswitch(config)# ntp server 10.0.0.201 use-vrf management\nswitch(config)# vrf context management\nswitch(config)# ip name-server 10.0.0.202\nswitch(config)# ip domain-name mycompany.com\nswitch(config)# ip route 0.0.0.0/0 10.0.0.1\n\nswitch(config)# interface mgmt0\nswitch(config-if)# vrf member management\nswitch(config-if)# ip address 10.0.0.99/24\nswitch(config-if)# end\n```\n\n## \u8a2d\u5b9a\u65b9\u6cd5\u306e\u9078\u629e\uff08bash-shell or guestshell\uff09\n\nPuppet \u3092 Nexus3048 \u306e\u3069\u3053\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u304b\uff1f\n\nNX-OS \u306f\u5b9f\u306f Linux \u4e0a\u3067\u52d5\u3044\u3066\u304a\u308a\u3001\u305d\u306e\u30cd\u30a4\u30c6\u30a3\u30d6\u306e bash \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u3068\u3001Linux \u30b3\u30f3\u30c6\u30ca\u5185\u306e guestshell \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u306e\u4e8c\u901a\u308a\u304c\u5b58\u5728\u3059\u308b\u3002\u4eca\u56de\u306f Bash-shell \u306b\u3066\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n# Puppet Agent \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\uff08Bash-shell\u7de8\uff09\n\n## \u57fa\u672c\u8a2d\u5b9a\n\n```\nswitch# configure terminal\nswitch(config)# feature bash-shell\nswitch(config)# hostname n3k\nn3k# run bash\nbash-4.2$\nbash-4.2$ sudo su -\nroot@n3k# ip netns exec management bash\nroot@n3k# cat >> /etc/resolv.conf << EOF\nnameserver 10.0.0.202\ndomain mycompany.com\nsearch mycompany.com\nEOF\n```\n\nip netns exec management bash \u306f VRF \u3092 VRF\u540d\uff1d management \u3078\u5909\u66f4\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\n\nNX-OS \u306e bash \u306f\u72ec\u81ea\u306e\u30af\u30bb\u304c\u3042\u308a\u3001Linux \u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u5909\u66f4\u3057\u3066\u3082\u518d\u8d77\u52d5\u3059\u308b\u3068\u5143\u306b\u623b\u3063\u3066\u3057\u307e\u3046\u3002\u4eca\u56de\u306f /etc/resolv.conf \u3078\u306e\u5909\u66f4\u3092\u3057\u3066\u3044\u308b\u304c\u3053\u308c\u3092\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u306b\u3057\u305f\u3044\u5834\u5408\u306f NX-OS \u306e\u30b7\u30a7\u30eb\u306b\u623b\u3063\u3066 copy running-config startup-config \u3092\u3059\u308b\u304b\u3001\u307e\u305f\u306f bash \u30b7\u30a7\u30eb\u304b\u3089\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\uff1a\n\n```\n# vsh -c 'copy running-config startup-config'\n```\n\n## Proxy \u8a2d\u5b9a\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\nproxy \u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306f proxy \u306e\u8a2d\u5b9a\u3092\u884c\u3046\uff1a\n\n```\n# vi /etc/profile\n\nPROXY='proxy.server.com'\nexport http_proxy=$PROXY\nexport HTTP_PROXY=$PROXY\nexport HTTPS_PROXY=$PROXY\nexport https_proxy=$PROXY\n```\n\n\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\uff1a\n\n```\n# source /etc/profile\n```\n\nproxy \u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306f yum \u306b\u3064\u3044\u3066\u3082 proxy \u306e\u8a2d\u5b9a\u3092\u884c\u3046\uff1a\n\n```\n# vi /etc/yum.conf\n\nproxy=http://proxy.server.com:8080\n```\n\n## Puppet Agent RPM \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4ee5\u4e0b\u306e2\u884c\u3092\u5b9f\u65bd\u3059\u308c\u3070\u3088\u3044\uff1a\n\n```\n# yum install http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm\n# yum install puppet\n```\n\n\u3068\u3053\u308d\u304c\u30011\u884c\u76ee\u5b9f\u884c\u5f8c\n\n```\nSetting up Install Process\npuppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm        | 5.8 kB     00:00\nwarning: rpmts_HdrFromFdno: Header V4 RSA/SHA512 signature: NOKEY, key ID 4bd6ec30\nCannot open: http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm. Skipping.\nError: Nothing to do\n```\n\n\u3067\u6b62\u307e\u3063\u3066\u3057\u307e\u3063\u305f\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u3067\u89e3\u6c7a\u3067\u304d\u305f\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u63a5\u7d9a\u306b\u554f\u984c\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\uff1a\n\n```\n# wget http://yum.puppetlabs.com/puppetlabs-release-pc1-cisco-wrlinux-5.noarch.rpm\n```\n\nGPG-key \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff1a\n\n```\n# rpm --import http://yum.puppetlabs.com/RPM-GPG-KEY-puppetlabs\n# rpm --import http://yum.puppetlabs.com/RPM-GPG-KEY-reductive\n```\n\n\u4ee5\u4e0a\u3067\u554f\u984c\u304c\u89e3\u6c7a\u3057\u3001\u4e0a\u8a18\u4e8c\u884c\u306e yum install \u304c\u5b9f\u884c\u53ef\u80fd\u3068\u306a\u308b\u3002\n\n\u203b Nexus9000 7.0(3)I4(1) \u306b\u306f rpm \u306b\u554f\u984c\u304c\u3042\u308b\u3089\u3057\u304f yum install \u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff1a\n\n```\nsed: can't read /bootflash/.rpmstore/thirdparty/inactive_feature_rpms.inf: No such file or directory\n```\n2016/7/19 \u6642\u70b9\u3067\u306f\u3053\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3057\u305f 7.0(3)I2(2e) \u304c\u63a8\u5968\n\n## PATH \u306e Update\n\n```\n# export PATH=/opt/puppetlabs/puppet/bin:/opt/puppetlabs/puppet/lib:$PATH\n```\n\n## cisco_node_utils gem \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nPuppet \u306f cisco_node_utils gem \u3092\u4f7f\u3046\u306e\u3067\u5fc5\u305a Agent \u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```\n# /opt/puppetlabs/puppet/bin/gem install cisco_node_utils\n```\n\n\u6210\u529f\u3059\u308b\u3068 cisco_node_utils, cisco_nxapi, net_http_unix \u306e 3\u3064\u306e gem \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\u78ba\u8a8d\u306f gem list \u3067\u53ef\u80fd\uff1a\n\n```\n# /opt/puppetlabs/puppet/bin/gem list | egrep 'cisco|net_http'\ncisco_node_utils (1.2.0)\ncisco_nxapi (1.0.1)\nnet_http_unix (0.2.1)\n```\n\n## gem \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306e\u88dc\u8db3\n\nGuestshell \u306e\u5834\u5408 gem \u306f\u4e00\u5ea6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u5b8c\u4e86\u3002\n\nNX-OS bash-shell \u306e\u5834\u5408\u3001/opt/puppetlabs \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u518d\u8d77\u52d5\u3067\u6d88\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u518d\u8d77\u52d5\u306e\u90fd\u5ea6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001\u3044\u3061\u3044\u3061\u624b\u4f5c\u696d\u3067\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u3001\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u6700\u521d\u306b include ciscopuppet::install \u3092\u8a18\u8ff0\u3059\u308c\u3070\u81ea\u52d5\u3067\u6700\u65b0\u306e gem \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u3002\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u5177\u4f53\u4f8b\u306f [\u3053\u3061\u3089](http://qiita.com/dyoshiha/items/2642ea3d4b3bf9c02e51#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%9E%E3%83%8B%E3%83%95%E3%82%A7%E3%82%B9%E3%83%88%E3%82%92%E5%88%A9%E7%94%A8%E3%81%97%E3%81%9F%E3%83%87%E3%83%A2%E3%83%B3%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3) \u53c2\u7167\u3002\n\n## Puppet \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\n\n```\nvi /etc/puppetlabs/puppet/puppet.conf\n\n[main]\n  server = sevtdc001.localdomain\n\n[agent]\n  pluginsync  = true\n  ignorecache = true\n```\n\n## init.d \u3092\u5909\u66f4\n\n```\n# cp /etc/init.d/puppet /etc/init.d/puppet.old\n# vi /etc/init.d/puppet\n\n    #daemon $daemonopts $puppetd ${PUPPET_OPTS} ${PUPPET_EXTRA_OPTS}\n    daemon $daemonopts ip netns exec management $puppetd ${PUPPET_OPTS} ${PUPPETT\n_EXTRA_OPTS}\n```\n\n## puppet service \u3092\u8d77\u52d5\uff1a\n\n```\n# chkconfig --add puppet\n# chkconfig --level 345 puppet on\n# service puppet start\n```\n\n# puppet Agent \u306e\u5b9f\u884c\n\npuppet agent -t \u30b3\u30de\u30f3\u30c9\u306b\u3066 Puppet Agent \u3092\u5b9f\u884c\u53ef\u80fd\u3002\u73fe\u5728 Puppet Master \u306b\u306f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u540c\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068 Puppet Master \u3068\u306e\u63a5\u7d9a\u6027\u78ba\u8a8d\u306e\u307f\u304c\u884c\u308f\u308c\u308b\u3002\u63a5\u7d9a\u306b\u306f\u8a3c\u660e\u66f8\u304c\u5229\u7528\u3055\u308c\u308b\u3002\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\uff1a\n\n```\n# puppet agent -t\nInfo: Caching certificate for ca\nInfo: csr_attributes file loading from /etc/puppetlabs/puppet/csr_attributes.yaml\nInfo: Creating a new SSL certificate request for n3k.mycompany.com\nInfo: Certificate Request fingerprint (SHA256): \nInfo: Caching certificate for ca\nExiting; no certificate found and waitforcert is disabled\n```\n\n\u3068\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u304c\u3053\u308c\u306f\u671f\u5f85\u3055\u308c\u305f\u52d5\u4f5c\u3067\u3042\u308a\u3001Puppet Agent \u3092 Puppet Master \u306b\u767b\u9332\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3002\u8a66\u3057\u306b Puppet Master \u306b\u3066\u8a3c\u660e\u66f8\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u308b\uff1a\n\n```\n# puppet cert list --all\n  \"n3k.cisco.com\"         (SHA256) x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x\n+ \"localhost.localdomain\" (SHA256) x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x:x (alt names: \"DNS:puppet\", \"DNS:localhost.localdomain\"\n```\n\n\u4e0a\u8a18\u51fa\u529b\u4f8b\u306e\u3088\u3046\u306b\u8a72\u5f53 Puppet Agent \u306e\u982d\u306b + \u304c\u3064\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u306f Agent \u306e\u8a3c\u660e\u66f8\u306b\u7f72\u540d\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u305d\u3053\u3067 Puppet Master \u5074\u3067\u767b\u9332\u3092\u884c\u3046\uff1a\n\n```\n# puppet cert sign --all\n```\n\n\u518d\u5ea6 Puppet Agent \u306b\u3066 puppet agent -t \u3092\u5b9f\u884c\uff1a\n\n```\n# puppet agent -t\nInfo: Caching certificate_revocation_list for ca\nInfo: Using configured environment 'production'\nInfo: Retrieving pluginfacts\nInfo: Retrieving plugin\nInfo: Caching catalog for n3k.mycompany.com\nInfo: Applying configuration version '1452153556'\nInfo: Creating state file /opt/puppetlabs/puppet/cache/state/state.yaml\nNotice: Applied catalog in 0.02 seconds\n```\n\n\u7121\u4e8b\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3002\n", "tags": ["Puppet", "Linux", "Cisco"]}