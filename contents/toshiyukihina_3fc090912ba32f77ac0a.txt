{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u57fa\u672c\u7684\u306b\u3001Creating and using a Redis Cluster\u306e\u307e\u3093\u307e\u3002\n\n\u74b0\u5883\n\nUbuntu 14.04\n\n\n\u6700\u65b0\u7248\u306e\u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nredis\u304b\u3089\u6700\u65b0\u7248\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092clone\u3057\u3066\u3001\u30d3\u30eb\u30c9&\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ git clone https://github.com/antirez/redis.git\n$ cd redis\n$ make\n$ sudo make install\n\n\n\u30ce\u30fc\u30c9\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3059\u308b\n$ mkdir 7000 7001 7002 7003 7004 7005\n$ cat <<EOF > redis.conf\nport 7000\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly yes\nEOF\n$ for i in {0..5}; do cp -av redis.conf \"700$i/\"; sed -i -e \"s/port 7000/port 700$i/g\" \"700$i/redis.conf\"; done\n\n\n\u30ce\u30fc\u30c9\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n\u4f5c\u6210\u3057\u305f\u5404\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\u305d\u308c\u305e\u308c\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067redis-server ./redis.con\u3059\u308b\u3002ps\u3067\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u308a\u3001\u8a086\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3002\n$ ps auxw | egrep \"redis\" | grep -v egrep\nhina     19028  0.7  0.3  43304  7868 pts/11   Sl+  15:47   0:00 redis-server *:7000 [cluster]\nhina     19031  0.3  0.3  43304  7872 pts/14   Sl+  15:47   0:00 redis-server *:7001 [cluster]\nhina     19034  0.2  0.3  43304  7868 pts/15   Sl+  15:47   0:00 redis-server *:7002 [cluster]\nhina     19037  0.2  0.3  43304  7872 pts/16   Sl+  15:47   0:00 redis-server *:7003 [cluster]\nhina     19040  0.2  0.3  43304  7872 pts/17   Sl+  15:47   0:00 redis-server *:7004 [cluster]\nhina     19043  0.2  0.3  43304  7872 pts/18   Sl+  15:47   0:00 redis-server *:7005 [cluster]\n\n\n\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u3059\u308b\n\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u3059\u308b\u305f\u3081\u306b\u306f\u3001redis\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308bsrc/redis-trib.rb\u3092\u4f7f\u3046\u3002\u3053\u306e\u30c4\u30fc\u30eb\u306f\u3001redis\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4e88\u3081gem install redis\u3057\u3066\u304a\u304f\u3002\n\u4ee5\u4e0b\u306f\u3001\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u901a\u308a\u306e\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u3067\u3042\u308b\u3002\n$ ./redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005\n>>> Creating cluster\nConnecting to node 127.0.0.1:7000: OK\nConnecting to node 127.0.0.1:7001: OK\nConnecting to node 127.0.0.1:7002: OK\nConnecting to node 127.0.0.1:7003: OK\nConnecting to node 127.0.0.1:7004: OK\nConnecting to node 127.0.0.1:7005: OK\n>>> Performing hash slots allocation on 6 nodes...\nUsing 3 masters:\n127.0.0.1:7000\n127.0.0.1:7001\n127.0.0.1:7002\nAdding replica 127.0.0.1:7003 to 127.0.0.1:7000\nAdding replica 127.0.0.1:7004 to 127.0.0.1:7001\nAdding replica 127.0.0.1:7005 to 127.0.0.1:7002\nM: 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000\n   slots:0-5460 (5461 slots) master\nM: d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001\n   slots:5461-10922 (5462 slots) master\nM: 22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002\n   slots:10923-16383 (5461 slots) master\nS: f254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003\n   replicates 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b\nS: 590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004\n   replicates d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca\nS: 5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005\n   replicates 22bca92b78354dc995b35c815c54936f6efc28d4\nCan I set the above configuration? (type 'yes' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join..\n>>> Performing Cluster Check (using node 127.0.0.1:7000)\nM: 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000\n   slots:0-5460 (5461 slots) master\nM: d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001\n   slots:5461-10922 (5462 slots) master\nM: 22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002\n   slots:10923-16383 (5461 slots) master\nM: f254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003\n   slots: (0 slots) master\n   replicates 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b\nM: 590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004\n   slots: (0 slots) master\n   replicates d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca\nM: 5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005\n   slots: (0 slots) master\n   replicates 22bca92b78354dc995b35c815c54936f6efc28d4\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n\n\n127.0.0.1:7000\u301c127.0.0.1:7005\u3067\u5f85\u3061\u53d7\u3051\u308b\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n\u30ce\u30fc\u30c9\u306e\u5185\u8a33\u306f\u4ee5\u4e0b\u3002\n\n\n\u30de\u30b9\u30bf\u30fc: 3\n\u30b9\u30ec\u30fc\u30d6: 3\n\n\n\u30de\u30b9\u30bf\u30fc\u306b\u306f\u3001hash slot\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002\n\n\n93e53337037a3f9b1a5e0ae914e48aeca54a1d7b: 0-5460 (5461 slots)\nd64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca: 5461-10922 (5462 slots)\n22bca92b78354dc995b35c815c54936f6efc28d4: 10923-16383 (5461 slots)\n\n\n\n\u3061\u306a\u307f\u306b\u3001redis-cli\u3067\u63a5\u7d9a\u3057\u305f\u969b\u306b\u306f\u3069\u3046\u898b\u3048\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u898b\u3048\u308b\u3002\u30dd\u30fc\u30c8\u756a\u53f7\u306b7000\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u304c\u30017000\u301c7005\u3067\u3042\u308c\u3070\u3001\u30de\u30b9\u30bf\u30fc\u30fb\u30b9\u30ec\u30fc\u30d6\u306b\u95a2\u308f\u3089\u305a\u63a5\u7d9a\u53ef\u80fd\u3067\u3042\u308b\u3002\n$ redis-cli -c -p 7000\n127.0.0.1:7000> cluster nodes\nd64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001 master - 0 1430982942619 2 connected 5461-10922\n5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005 slave 22bca92b78354dc995b35c815c54936f6efc28d4 0 1430982943628 6 connected\nf254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003 slave 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 0 1430982943628 4 connected\n590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004 slave d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 0 1430982943125 5 connected\n93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000 myself,master - 0 0 1 connected 0-5460\n22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002 master - 0 1430982942115 3 connected 10923-16383\n\n\n\u611f\u60f3\nredis-trib.rb\u306f\u3001\u72ec\u7acb\u3057\u305f\u30c4\u30fc\u30eb\u306b\u306a\u3089\u306a\u3044\u3082\u306e\u304b\u3002\n\n## \u306f\u3058\u3081\u306b\n\n\u57fa\u672c\u7684\u306b\u3001[Creating and using a Redis Cluster](http://redis.io/topics/cluster-tutorial#creating-and-using-a-redis-cluster)\u306e\u307e\u3093\u307e\u3002\n\n## \u74b0\u5883\n\n* Ubuntu 14.04\n\n### \u6700\u65b0\u7248\u306e\u30d3\u30eb\u30c9\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[redis](https://github.com/antirez/redis)\u304b\u3089\u6700\u65b0\u7248\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092clone\u3057\u3066\u3001\u30d3\u30eb\u30c9&\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```bash\n$ git clone https://github.com/antirez/redis.git\n$ cd redis\n$ make\n$ sudo make install\n```\n\n### \u30ce\u30fc\u30c9\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3059\u308b\n\n```bash\n$ mkdir 7000 7001 7002 7003 7004 7005\n$ cat <<EOF > redis.conf\nport 7000\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\nappendonly yes\nEOF\n$ for i in {0..5}; do cp -av redis.conf \"700$i/\"; sed -i -e \"s/port 7000/port 700$i/g\" \"700$i/redis.conf\"; done\n```\n\n### \u30ce\u30fc\u30c9\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n\n\u4f5c\u6210\u3057\u305f\u5404\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\u305d\u308c\u305e\u308c\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067`redis-server ./redis.con`\u3059\u308b\u3002`ps`\u3067\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u308a\u3001\u8a086\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3002\n\n```bash\n$ ps auxw | egrep \"redis\" | grep -v egrep\nhina     19028  0.7  0.3  43304  7868 pts/11   Sl+  15:47   0:00 redis-server *:7000 [cluster]\nhina     19031  0.3  0.3  43304  7872 pts/14   Sl+  15:47   0:00 redis-server *:7001 [cluster]\nhina     19034  0.2  0.3  43304  7868 pts/15   Sl+  15:47   0:00 redis-server *:7002 [cluster]\nhina     19037  0.2  0.3  43304  7872 pts/16   Sl+  15:47   0:00 redis-server *:7003 [cluster]\nhina     19040  0.2  0.3  43304  7872 pts/17   Sl+  15:47   0:00 redis-server *:7004 [cluster]\nhina     19043  0.2  0.3  43304  7872 pts/18   Sl+  15:47   0:00 redis-server *:7005 [cluster]\n```\n\n### \u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u3059\u308b\n\n\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u306b\u3059\u308b\u305f\u3081\u306b\u306f\u3001redis\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b`src/redis-trib.rb`\u3092\u4f7f\u3046\u3002\u3053\u306e\u30c4\u30fc\u30eb\u306f\u3001`redis`\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4e88\u3081`gem install redis`\u3057\u3066\u304a\u304f\u3002\n\n\u4ee5\u4e0b\u306f\u3001\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u901a\u308a\u306e\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u3067\u3042\u308b\u3002\n\n```bash\n$ ./redis-trib.rb create --replicas 1 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005\n>>> Creating cluster\nConnecting to node 127.0.0.1:7000: OK\nConnecting to node 127.0.0.1:7001: OK\nConnecting to node 127.0.0.1:7002: OK\nConnecting to node 127.0.0.1:7003: OK\nConnecting to node 127.0.0.1:7004: OK\nConnecting to node 127.0.0.1:7005: OK\n>>> Performing hash slots allocation on 6 nodes...\nUsing 3 masters:\n127.0.0.1:7000\n127.0.0.1:7001\n127.0.0.1:7002\nAdding replica 127.0.0.1:7003 to 127.0.0.1:7000\nAdding replica 127.0.0.1:7004 to 127.0.0.1:7001\nAdding replica 127.0.0.1:7005 to 127.0.0.1:7002\nM: 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000\n   slots:0-5460 (5461 slots) master\nM: d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001\n   slots:5461-10922 (5462 slots) master\nM: 22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002\n   slots:10923-16383 (5461 slots) master\nS: f254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003\n   replicates 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b\nS: 590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004\n   replicates d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca\nS: 5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005\n   replicates 22bca92b78354dc995b35c815c54936f6efc28d4\nCan I set the above configuration? (type 'yes' to accept): yes\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join..\n>>> Performing Cluster Check (using node 127.0.0.1:7000)\nM: 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000\n   slots:0-5460 (5461 slots) master\nM: d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001\n   slots:5461-10922 (5462 slots) master\nM: 22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002\n   slots:10923-16383 (5461 slots) master\nM: f254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003\n   slots: (0 slots) master\n   replicates 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b\nM: 590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004\n   slots: (0 slots) master\n   replicates d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca\nM: 5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005\n   slots: (0 slots) master\n   replicates 22bca92b78354dc995b35c815c54936f6efc28d4\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n```\n\n* 127.0.0.1:7000\u301c127.0.0.1:7005\u3067\u5f85\u3061\u53d7\u3051\u308b\u30ce\u30fc\u30c9\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n* \u30ce\u30fc\u30c9\u306e\u5185\u8a33\u306f\u4ee5\u4e0b\u3002\n\t* \u30de\u30b9\u30bf\u30fc: 3\n\t* \u30b9\u30ec\u30fc\u30d6: 3\n* \u30de\u30b9\u30bf\u30fc\u306b\u306f\u3001hash slot\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002\n\t* 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b: 0-5460 (5461 slots)\n\t* d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca: 5461-10922 (5462 slots)\n\t* 22bca92b78354dc995b35c815c54936f6efc28d4: 10923-16383 (5461 slots)\n\n\u3061\u306a\u307f\u306b\u3001`redis-cli`\u3067\u63a5\u7d9a\u3057\u305f\u969b\u306b\u306f\u3069\u3046\u898b\u3048\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u898b\u3048\u308b\u3002\u30dd\u30fc\u30c8\u756a\u53f7\u306b`7000`\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u304c\u3001`7000`\u301c`7005`\u3067\u3042\u308c\u3070\u3001\u30de\u30b9\u30bf\u30fc\u30fb\u30b9\u30ec\u30fc\u30d6\u306b\u95a2\u308f\u3089\u305a\u63a5\u7d9a\u53ef\u80fd\u3067\u3042\u308b\u3002\n\n```bash\n$ redis-cli -c -p 7000\n127.0.0.1:7000> cluster nodes\nd64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 127.0.0.1:7001 master - 0 1430982942619 2 connected 5461-10922\n5b889edfad0301cebb997bb92fe84f6e097e0ff8 127.0.0.1:7005 slave 22bca92b78354dc995b35c815c54936f6efc28d4 0 1430982943628 6 connected\nf254c575fd2f06161905753f9e473c569ce4cdcf 127.0.0.1:7003 slave 93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 0 1430982943628 4 connected\n590b0db9b2031254645be39104aafb865bc70d31 127.0.0.1:7004 slave d64dd6fd3e5cea7d0cf87acb278d94c7d1e02bca 0 1430982943125 5 connected\n93e53337037a3f9b1a5e0ae914e48aeca54a1d7b 127.0.0.1:7000 myself,master - 0 0 1 connected 0-5460\n22bca92b78354dc995b35c815c54936f6efc28d4 127.0.0.1:7002 master - 0 1430982942115 3 connected 10923-16383\n```\n\n## \u611f\u60f3\n\n`redis-trib.rb`\u306f\u3001\u72ec\u7acb\u3057\u305f\u30c4\u30fc\u30eb\u306b\u306a\u3089\u306a\u3044\u3082\u306e\u304b\u3002\n", "tags": ["Redis", "Cluster"]}