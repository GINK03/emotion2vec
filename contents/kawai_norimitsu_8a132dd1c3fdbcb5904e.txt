{"context": "\u81ea\u793e\u30b5\u30a4\u30c8\u304cPHP\u3060\u3063\u305f\u306e\u3067\u3001LinePay\u3092PHP\u3067\u5c0e\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5fc5\u8981\u6700\u4f4e\u9650\u306eAPI\u3057\u304b\u53e9\u3044\u3066\u307e\u305b\u3093\u3002\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\nlinepay.php\n<?php\n\nif(!$_GET['transactionId']) {\n  // ----------------------------------- \u6c7a\u6e08reserve\n  $header = array(\n    'Content-Type: application/json; charset=UTF-8',\n    'X-LINE-ChannelId: 1466261954',\n    'X-LINE-ChannelSecret: ed0e387bf251243d52c7c6a9a215cc26',\n  );\n  $postData = array(\n    'productName' => \"Test Item\",\n    'amount' => 800,\n    'currency' => \"JPY\",\n    'confirmUrl' => \"https://hogehoge.com/linepay.php\",\n    'orderId' => \"00001\",\n  );\n\n  $ch = curl_init(\"https://api-pay.line.me/v2/payments/request\");\n  curl_setopt($ch, CURLOPT_POST, true);\n  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n  curl_setopt($ch, CURLOPT_SSLVERSION, 1);\n  curl_setopt($ch, CURLOPT_SSL_CIPHER_LIST, 'TLSv1');\n  curl_setopt($ch, CURLOPT_HTTPHEADER, $header);\n  curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));\n  $rs = json_decode(curl_exec($ch), true);\n  curl_close($ch);\n\n  if($rs['returnCode'] == \"0000\") {\n    header(\"Location: {$rs['info']['paymentUrl']['web']}\");\n  }\n  else {\n    echo \"\u30a8\u30e9\u30fc\u756a\u53f7\uff1a{$rs['returnCode']}\";\n  }\n}\nelse {\n  // ----------------------------------- \u6c7a\u6e08confirm\n  $header = array(\n    'Content-Type: application/json; charset=UTF-8',\n    'X-LINE-ChannelId: 1466261954',\n    'X-LINE-ChannelSecret: ed0e387bf251243d52c7c6a9a215cc26',\n  );\n  $postData = array(\n    'amount' => 800,\n    'currency' => \"JPY\",\n  );\n\n  $ch = curl_init(\"https://api-pay.line.me/v2/payments/{$_GET['transactionId']}/confirm\");\n  curl_setopt($ch, CURLOPT_POST, true);\n  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n  curl_setopt($ch, CURLOPT_SSLVERSION, 1);\n  curl_setopt($ch, CURLOPT_SSL_CIPHER_LIST, 'TLSv1');\n  curl_setopt($ch, CURLOPT_HTTPHEADER, $header);\n  curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));\n  $rs = json_decode(curl_exec($ch), true);\n  curl_close($ch);\n\n  if($rs['returnCode'] == \"0000\") {\n    echo \"\u6c7a\u6e08\u6210\u529f\uff1a{$rs['returnCode']}\";\n  }\n  else {\n    echo \"\u30a8\u30e9\u30fc\u756a\u53f7\uff1a{$rs['returnCode']}\";\n  }\n}\n\n?>\n\n\n\n\u8a73\u3057\u304f\u306f\u3001\u300cLINE Pay\u306eAPI\u3092PHP\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u300d\u3078\u3069\u3046\u305e\uff01\n\u81ea\u793e\u30b5\u30a4\u30c8\u304cPHP\u3060\u3063\u305f\u306e\u3067\u3001LinePay\u3092PHP\u3067\u5c0e\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5fc5\u8981\u6700\u4f4e\u9650\u306eAPI\u3057\u304b\u53e9\u3044\u3066\u307e\u305b\u3093\u3002\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n```php:linepay.php\n<?php\n\nif(!$_GET['transactionId']) {\n  // ----------------------------------- \u6c7a\u6e08reserve\n  $header = array(\n    'Content-Type: application/json; charset=UTF-8',\n    'X-LINE-ChannelId: 1466261954',\n    'X-LINE-ChannelSecret: ed0e387bf251243d52c7c6a9a215cc26',\n  );\n  $postData = array(\n    'productName' => \"Test Item\",\n    'amount' => 800,\n    'currency' => \"JPY\",\n    'confirmUrl' => \"https://hogehoge.com/linepay.php\",\n    'orderId' => \"00001\",\n  );\n\n  $ch = curl_init(\"https://api-pay.line.me/v2/payments/request\");\n  curl_setopt($ch, CURLOPT_POST, true);\n  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n  curl_setopt($ch, CURLOPT_SSLVERSION, 1);\n  curl_setopt($ch, CURLOPT_SSL_CIPHER_LIST, 'TLSv1');\n  curl_setopt($ch, CURLOPT_HTTPHEADER, $header);\n  curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));\n  $rs = json_decode(curl_exec($ch), true);\n  curl_close($ch);\n\n  if($rs['returnCode'] == \"0000\") {\n    header(\"Location: {$rs['info']['paymentUrl']['web']}\");\n  }\n  else {\n    echo \"\u30a8\u30e9\u30fc\u756a\u53f7\uff1a{$rs['returnCode']}\";\n  }\n}\nelse {\n  // ----------------------------------- \u6c7a\u6e08confirm\n  $header = array(\n    'Content-Type: application/json; charset=UTF-8',\n    'X-LINE-ChannelId: 1466261954',\n    'X-LINE-ChannelSecret: ed0e387bf251243d52c7c6a9a215cc26',\n  );\n  $postData = array(\n    'amount' => 800,\n    'currency' => \"JPY\",\n  );\n\n  $ch = curl_init(\"https://api-pay.line.me/v2/payments/{$_GET['transactionId']}/confirm\");\n  curl_setopt($ch, CURLOPT_POST, true);\n  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n  curl_setopt($ch, CURLOPT_SSLVERSION, 1);\n  curl_setopt($ch, CURLOPT_SSL_CIPHER_LIST, 'TLSv1');\n  curl_setopt($ch, CURLOPT_HTTPHEADER, $header);\n  curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($postData));\n  $rs = json_decode(curl_exec($ch), true);\n  curl_close($ch);\n\n  if($rs['returnCode'] == \"0000\") {\n    echo \"\u6c7a\u6e08\u6210\u529f\uff1a{$rs['returnCode']}\";\n  }\n  else {\n    echo \"\u30a8\u30e9\u30fc\u756a\u53f7\uff1a{$rs['returnCode']}\";\n  }\n}\n\n?>\n```\n\n![line.png](https://qiita-image-store.s3.amazonaws.com/0/72802/8295f7fd-9bb2-d63a-ee6e-79fb67853989.png)\n\n\u8a73\u3057\u304f\u306f\u3001\u300c[LINE Pay\u306eAPI\u3092PHP\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f](http://kawaidesu.com/php/line-pay/)\u300d\u3078\u3069\u3046\u305e\uff01\n\n", "tags": ["PHP", "Line"]}