{"context": "HTTP POST \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u52d5\u4f5c\u3059\u308b Hubot \u3092\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\nHubot \u3092\u30c6\u30b9\u30c8\u3059\u308b\u306b\u306f hubot-test-helper \u304c\u4fbf\u5229\nCoffeeScript \u66f8\u3044\u305f\u30c6\u30b9\u30c8\u3092 mocha \u3067\u52d5\u304b\u3059\u306b\u306f --compilers \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\nnpm test \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f package.json \u306b scripts \u3092\u66f8\u304f\nHTTP POST \u3092\u9001\u4fe1\u3059\u308b\u306b\u306f request \u304c\u697d\u3060\u3051\u3069\u3001json \u3092\u9001\u308b\u6642\u306b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\n\n\n\u30c6\u30b9\u30c8\u5bfe\u8c61\u306e Hubot\nPOST /hello/hook?room=<\u90e8\u5c4bID> \u3092\u53d7\u4fe1\u3059\u308b\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u304b\u3089\u540d\u524d\u3092\u53d6\u5f97\u3057\u3066\u3001\u6328\u62f6\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u308a\u3001\u90e8\u5c4b\u3078\u9001\u4fe1\u3059\u308b\u3002\nmodule.exports = (robot) ->\n  robot.router.post \"/hello/hook\", (req, res) ->\n    room = req.query.room\n    announceMessage req, (what) ->\n      robot.messageRoom room, what \n    res.end \"ok\"\n\n  announceMessage = (req, cb) ->\n    cb 'Hello, ' + req.body.name\n\n\n\n\u4e8b\u524d\u6e96\u5099\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u69cb\u6210\n.\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hook.coffee\n\u251c\u2500\u2500 tests\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test-hook.coffee\n...\n\n\nnpm\nmocha, chai, hubot-test-helper \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n$ npm install mocha chai hubot-test-helper --save-dev\n\nmocha \u3067 CoffeeScript \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u3001compilers \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3002\u307e\u305f\u3001\n$ npm test\n\n\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001package.json \u306b scripts \u3092\u8ffd\u8a18\u3059\u308b\u3002\n...\n    \"scripts\": {\n        \"test\": \"mocha 'tests/**/*.coffee' --compilers coffee:coffee-script\"\n    }\n...\n\n\n\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\nWebhook \u3092 HTTP GET \u3067\u8d77\u52d5\u3059\u308b\u30c6\u30b9\u30c8\u306f\nhttps://github.com/mtsmfm/hubot-test-helper/blob/master/test/httpd-world_test.coffee\n\u304c\u53c2\u8003\u306b\u306a\u308b\u3002\nHTTP POST \u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306b\u6ce8\u610f\u3059\u308b\u3002\n\nhttp \u3067\u306f\u306a\u304f request \u3067\u8d77\u52d5\u3059\u308b\u65b9\u304c\u697d\u3002\n\u305f\u3060\u3057 JSON \u3092\u6e21\u3059\u5834\u5408\u3001reuqest.post() \u3067\u306f\u306a\u304f\u3001request() \u3092\u4f7f\u3046\u3002json: true \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3002\n\nHelper = require('hubot-test-helper')\nhelper = new Helper('../scripts')\n{assert} = require('chai')\nrequest = require('request')\n\nprocess.env.EXPRESS_PORT = 8080\n\ndescribe 'hello-webhook', ->\n  beforeEach ->\n    @robot = helper.createRoom()\n\n  afterEach ->\n    @robot.destroy()\n\n  context 'POST /hello/hook', ->\n    beforeEach (done) ->\n      request {method: 'POST', url: 'http://localhost:8080/hello/webhook?room=12345', json: true, body: {name: 'takatama'}},\n        (@error, @response, @body) => done()\n\n    it 'responds with status 200', ->\n      assert.equal @response.statusCode, 200\n      assert.equal @body, 'ok'\n      assert.deepEqual @robot.messages, [['hubot', 'Hello, takatama']]\n\n\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\n$npm test\n\nHTTP POST \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u4fe1\u3059\u308b\u3068\u52d5\u4f5c\u3059\u308b [Hubot](https://hubot.github.com/) \u3092\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\n- Hubot \u3092\u30c6\u30b9\u30c8\u3059\u308b\u306b\u306f [hubot-test-helper](https://github.com/mtsmfm/hubot-test-helper) \u304c\u4fbf\u5229\n- CoffeeScript \u66f8\u3044\u305f\u30c6\u30b9\u30c8\u3092 [mocha](https://mochajs.org/) \u3067\u52d5\u304b\u3059\u306b\u306f --compilers \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\n- npm test \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f package.json \u306b scripts \u3092\u66f8\u304f\n- HTTP POST \u3092\u9001\u4fe1\u3059\u308b\u306b\u306f [request](https://www.npmjs.com/package/request) \u304c\u697d\u3060\u3051\u3069\u3001json \u3092\u9001\u308b\u6642\u306b\u306f\u6ce8\u610f\u304c\u5fc5\u8981\n\n# \u30c6\u30b9\u30c8\u5bfe\u8c61\u306e Hubot\n\nPOST /hello/hook?room=<\u90e8\u5c4bID> \u3092\u53d7\u4fe1\u3059\u308b\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u304b\u3089\u540d\u524d\u3092\u53d6\u5f97\u3057\u3066\u3001\u6328\u62f6\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u308a\u3001\u90e8\u5c4b\u3078\u9001\u4fe1\u3059\u308b\u3002\n\n```js\nmodule.exports = (robot) ->\n  robot.router.post \"/hello/hook\", (req, res) ->\n    room = req.query.room\n    announceMessage req, (what) ->\n      robot.messageRoom room, what \n    res.end \"ok\"\n    \n  announceMessage = (req, cb) ->\n    cb 'Hello, ' + req.body.name\n\n```\n\n# \u4e8b\u524d\u6e96\u5099\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u69cb\u6210\n\n```\n.\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hook.coffee\n\u251c\u2500\u2500 tests\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test-hook.coffee\n...\n```\n\n## npm\nmocha, chai, [hubot-test-helper](https://github.com/mtsmfm/hubot-test-helper) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```\n$ npm install mocha chai hubot-test-helper --save-dev\n```\n\nmocha \u3067 CoffeeScript \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u3001compilers \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3002\u307e\u305f\u3001\n\n```\n$ npm test\n```\n\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u3001package.json \u306b scripts \u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n```js\n...\n    \"scripts\": {\n        \"test\": \"mocha 'tests/**/*.coffee' --compilers coffee:coffee-script\"\n    }\n...\n```\n\n# \u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\nWebhook \u3092 HTTP GET \u3067\u8d77\u52d5\u3059\u308b\u30c6\u30b9\u30c8\u306f\nhttps://github.com/mtsmfm/hubot-test-helper/blob/master/test/httpd-world_test.coffee\n\u304c\u53c2\u8003\u306b\u306a\u308b\u3002\n\nHTTP POST \u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306b\u6ce8\u610f\u3059\u308b\u3002\n\n- http \u3067\u306f\u306a\u304f request \u3067\u8d77\u52d5\u3059\u308b\u65b9\u304c\u697d\u3002\n- \u305f\u3060\u3057 JSON \u3092\u6e21\u3059\u5834\u5408\u3001reuqest.post() \u3067\u306f\u306a\u304f\u3001request() \u3092\u4f7f\u3046\u3002json: true \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3002\n\n```js\nHelper = require('hubot-test-helper')\nhelper = new Helper('../scripts')\n{assert} = require('chai')\nrequest = require('request')\n\nprocess.env.EXPRESS_PORT = 8080\n\ndescribe 'hello-webhook', ->\n  beforeEach ->\n    @robot = helper.createRoom()\n\n  afterEach ->\n    @robot.destroy()\n\n  context 'POST /hello/hook', ->\n    beforeEach (done) ->\n      request {method: 'POST', url: 'http://localhost:8080/hello/webhook?room=12345', json: true, body: {name: 'takatama'}},\n        (@error, @response, @body) => done()\n\n    it 'responds with status 200', ->\n      assert.equal @response.statusCode, 200\n      assert.equal @body, 'ok'\n      assert.deepEqual @robot.messages, [['hubot', 'Hello, takatama']]\n```\n\n\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\n\n```\n$npm test\n```\n", "tags": ["CoffeeScript", "Hubot"]}