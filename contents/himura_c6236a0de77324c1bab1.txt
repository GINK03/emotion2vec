{"context": "\u5b89\u4fa1\u3067\u4f4e\u6d88\u8cbb\u96fb\u529b\u306e\u7121\u7dda\u30de\u30a4\u30b3\u30f3\u3001TWE-Lite\u306e\u30b7\u30ea\u30a2\u30eb\u30c7\u30fc\u30bf\u3092Raspberry Pi\u4e0a\u306epython\u3067\u53d7\u3051\u53d6\u308b\u30e1\u30e2\u3002\n\n\u69cb\u6210\n\u3000\u3000| TWE-Lite | - | raspberry Pi |\n\u307e\u305a\u3001Raspberry Pi\u306e\u30b7\u30ea\u30a2\u30eb\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u3053\u306e\u8fba\u3092\u898b\u308b\u3068\u3044\u3044\u3067\u3059\u3002\nhttp://qiita.com/ryugyoku/items/bf5fd10512c84a55d030\n\n\u30c6\u30b9\u30c8\nTWE-Lite\u306eTX,RD\u3092Raspberry Pi\u306e\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\u8a66\u3057\u306bminicom\u3067\u8aad\u307f\u8fbc\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\n\n$ sudo minicom -b 115200 -o -D /dev/ttyAMA0\n\n\nminicom\u306fsudo apt-get install minicom\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n-D\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u30bf\u30fc\u30df\u30ca\u30eb\u306e\u5834\u6240\u3002\nUSB\u30b7\u30ea\u30a2\u30eb\u5909\u63db\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u3053\u3092/dev/ttyUSB0\u3068\u304b\u306b\u5909\u3048\u308c\u3070\u3044\u3044\u3067\u3059\u3002\n\nminicom \u3078\u3088\u3046\u3053\u305d 2.7\n\n\u30aa\u30d7\u30b7\u30e7\u30f3: I18n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u65e5\u6642\u306f:  Jan 12 2014, 05:42:53.\n\u30dd\u30fc\u30c8 /dev/ttyAMA0, 01:54:51\n\nCTRL-A Z \u3092\u62bc\u3059\u3068\u3001\u8aac\u660e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\n\n:0F8115015481012CFB00A387000BB0150101FFFFFFFFFF66\n:0F8115015181012CFB00A389000BB0150101FFFFFFFFFF67\n:0F8115015481012CFB00A38B000BAC150101FFFFFFFFFF66\n:0F8115015181012CFB00A38D000BAC150101FFFFFFFFFF67\n:0F8115015481012CFB00A38F000BB0150101FFFFFFFFFF5E\n:0F8115014E81012CFB00A393000BAC150101FFFFFFFFFF64\n\n\n\u3053\u306e\u3088\u3046\u306a\u7269\u304c\u51fa\u305f\u3089\u63a5\u7d9a\u306f\u6b63\u5e38\u3067\u3059\u3002\nCtrl+A,Q\u3067\u7d42\u4e86\u3002\n\u3053\u3044\u3064\u3092Python\u3067\u53d7\u3051\u53d6\u3063\u3066\u30d1\u30fc\u30b9\u3057\u307e\u3057\u3087\u3046\n\n\u30b7\u30ea\u30a2\u30eb\u53d7\u3051\u53d6\u308a\n\u30b7\u30ea\u30a2\u30eb\u306e\u53d6\u5f97\u306fpyserial\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n$ pip3 install pyserial\n\n\n\nPython 3.4.2 (default, Oct 19 2014, 13:31:11)\n[GCC 4.9.1] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import serial\n>>> ser = serial.Serial('/dev/ttyAMA0',115200)\n>>> ser.readline()\nb':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\n>>> ser.close()\n<bound method Serial.close of Serial<id=0xb68fd550, open=True>(port='/dev/ttyAMA0', baudrate=115200, bytesize=8, parity='N', stopbits=1, timeout=None, xonxoff=False, rtscts=False, dsrdtr=False)>\n>>>\n\n\n\n\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u8a08\u7b97\n\u516c\u5f0f\u306b\u3088\u308b\u3068\u3001\u30b3\u30fc\u30c9\u306e\u6700\u5f8c\u306e1\u30d0\u30a4\u30c8\u304c\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u8a08\u7b97\u65b9\u6cd5\u306f\u3001\u5148\u982d\u884c\u304b\u30891\u30d0\u30a4\u30c8\u305a\u3064\u52a0\u7b97\u3057\u3066\u3044\u304d\u3001\u548c\u306e\u4e0b\u4f4d1\u30d0\u30a4\u30c8\u306e\u88dc\u6570\u304c\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3064\u307e\u308a\u3001':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\u306e\u5834\u5408\u306e\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u306f\u6700\u5f8c\u306eBF\u3067\u3001\n0x0f+0x81+....0xff+0xff = 0x941\u3000\u3053\u308c\u306e\u4e0b1\u30d0\u30a4\u30c8\u306e0x41 + 0xBF = 0xa00\u3068\u306a\u308a\u307e\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u6700\u521d\u306e\":\"\u3092\u9664\u304f\u5168\u6841\u30921\u30d0\u30a4\u30c8\u305a\u3064\u52a0\u7b97\u3057\u305f\u7dcf\u548c\u306e\u4e0b1\u30d0\u30a4\u30c8\u306f\u304b\u306a\u3089\u305a0\u306b\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\npython\u7684\u306a\u8a08\u7b97\u3092\u3059\u308b\u3068\u3001\n\nPython 3.5.2 (default, Jun 28 2016, 08:46:01) \n[GCC 6.1.1 20160602] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> string = ':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\n>>> string = string[1:] #\u5192\u982d\u306e:\u3092\u9664\u304f\n>>> lst = [ int(string[i:i+2], 16) for i in range(0, len(string), 2) ]\u3000#\u4e8c\u6841\u305a\u3064\u5207\u308a\u53d6\u3063\u306616\u9032\u6570\u3068\u3057\u3066\u6570\u5024\u5316\n>>> s = sum(lst) #\u7dcf\u548c\u3092\u53d6\u308b\n>>> hex(s & 0b1111)\n'0x0'\n>>>\n\n\n0\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3002\u8a71\u306e\u308f\u304b\u308b\u3084\u3064\u3060\n\n\u30d1\u30fc\u30b9\n\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u53c2\u7167\u3002\n# coding: utf-8\n#!/usr/bin/env python3\n\ndef parse(string):\n    if string[-2:] == b\"\\r\\n\"  : string = string[:-2]\n    if string[0]   == ord(':') : string = string[1:]\n    lst = [ int(string[i:i+2], 16) for i in range(0, len(string), 2) ]\n    if sum(lst) & 0xff == 0:\n        return lst\n\n    return False\n\nif __name__ == '__main__':\n    import serial\n    s = serial.Serial('/dev/ttyAMA0',115200)\n\n    l = s.readline()\n    lst = parse(l)\n\n    print (lst)\n\n    SOURCE_DEVIDE = lst[0]\n    COMMAND = lst[1]\n    PACKET = lst[2]\n    PROTOCOL = lst[3]\n    LQI = (7 * lst[4] - 1970 ) / 20\n    SN = lst[5] << 24 | lst[6] << 16 | lst[7] << 8 | lst[8]\n    DESTINATION_ID = lst[9]\n    TIMESTAMP = lst[10] << 8 | lst[11]\n    RELATED = True if lst[15] % 1 else False\n    VOLTAGE = lst[13] << 8 | lst[14]\n    NONE = 0\n    DIN = lst[16]\n    DCHANGE = lst[17]\n    ACOMP = lst[22]\n    AD1 = (lst[18] * 4 + ACOMP) * 4\n    AD2 = (lst[19] * 4 + ACOMP) * 4\n    AD3 = (lst[20] * 4 + ACOMP) * 4\n    AD4 = (lst[21] * 4 + ACOMP) * 4\n    SUM = lst[-1]\n\n    D1 = True if lst[16] & 0b0001 else False\n    D2 = True if lst[16] & 0b0010 else False\n    D3 = True if lst[16] & 0b0100 else False\n    D4 = True if lst[16] & 0b1000 else False\n\n\n\u3042\u3068\u306f\u3054\u81ea\u7531\u306b\u3002\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u304c\u3001\u4eca\u898b\u305f\u3089\u9177\u3044\u51fa\u6765\u3060\u3063\u305f\u306e\u3067\u305d\u306e\u3046\u3061\u6539\u9020\u3057\u307e\u3059\n\u5b89\u4fa1\u3067\u4f4e\u6d88\u8cbb\u96fb\u529b\u306e\u7121\u7dda\u30de\u30a4\u30b3\u30f3\u3001[TWE-Lite](http://mono-wireless.com/jp/products/TWE-Lite-DIP/index.html)\u306e\u30b7\u30ea\u30a2\u30eb\u30c7\u30fc\u30bf\u3092Raspberry Pi\u4e0a\u306epython\u3067\u53d7\u3051\u53d6\u308b\u30e1\u30e2\u3002\n\n\n## \u69cb\u6210\n\n\u3000\u3000| TWE-Lite | - | raspberry Pi |\n\n\u307e\u305a\u3001Raspberry Pi\u306e\u30b7\u30ea\u30a2\u30eb\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u3053\u306e\u8fba\u3092\u898b\u308b\u3068\u3044\u3044\u3067\u3059\u3002\nhttp://qiita.com/ryugyoku/items/bf5fd10512c84a55d030\n\n## \u30c6\u30b9\u30c8\n\nTWE-Lite\u306eTX,RD\u3092Raspberry Pi\u306e\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\u8a66\u3057\u306bminicom\u3067\u8aad\u307f\u8fbc\u3093\u3067\u307f\u307e\u3057\u3087\u3046\u3002\n\n~~~ shell\n\n$ sudo minicom -b 115200 -o -D /dev/ttyAMA0\n\n~~~\n\nminicom\u306fsudo apt-get install minicom\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n-D\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u30bf\u30fc\u30df\u30ca\u30eb\u306e\u5834\u6240\u3002\nUSB\u30b7\u30ea\u30a2\u30eb\u5909\u63db\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u3053\u3092/dev/ttyUSB0\u3068\u304b\u306b\u5909\u3048\u308c\u3070\u3044\u3044\u3067\u3059\u3002\n\n~~~\n\nminicom \u3078\u3088\u3046\u3053\u305d 2.7\n\n\u30aa\u30d7\u30b7\u30e7\u30f3: I18n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u65e5\u6642\u306f:  Jan 12 2014, 05:42:53.\n\u30dd\u30fc\u30c8 /dev/ttyAMA0, 01:54:51\n\nCTRL-A Z \u3092\u62bc\u3059\u3068\u3001\u8aac\u660e\u753b\u9762\u306b\u306a\u308a\u307e\u3059\u3002\n\n:0F8115015481012CFB00A387000BB0150101FFFFFFFFFF66\n:0F8115015181012CFB00A389000BB0150101FFFFFFFFFF67\n:0F8115015481012CFB00A38B000BAC150101FFFFFFFFFF66\n:0F8115015181012CFB00A38D000BAC150101FFFFFFFFFF67\n:0F8115015481012CFB00A38F000BB0150101FFFFFFFFFF5E\n:0F8115014E81012CFB00A393000BAC150101FFFFFFFFFF64\n\n~~~\n\n\u3053\u306e\u3088\u3046\u306a\u7269\u304c\u51fa\u305f\u3089\u63a5\u7d9a\u306f\u6b63\u5e38\u3067\u3059\u3002\nCtrl+A,Q\u3067\u7d42\u4e86\u3002\n\n\u3053\u3044\u3064\u3092Python\u3067\u53d7\u3051\u53d6\u3063\u3066\u30d1\u30fc\u30b9\u3057\u307e\u3057\u3087\u3046\n\n\n## \u30b7\u30ea\u30a2\u30eb\u53d7\u3051\u53d6\u308a\n\n\u30b7\u30ea\u30a2\u30eb\u306e\u53d6\u5f97\u306f[pyserial](https://github.com/pyserial/pyserial)\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n~~~ shell\n\n$ pip3 install pyserial\n\n~~~\n\n~~~ python3\n\nPython 3.4.2 (default, Oct 19 2014, 13:31:11)\n[GCC 4.9.1] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import serial\n>>> ser = serial.Serial('/dev/ttyAMA0',115200)\n>>> ser.readline()\nb':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\n>>> ser.close()\n<bound method Serial.close of Serial<id=0xb68fd550, open=True>(port='/dev/ttyAMA0', baudrate=115200, bytesize=8, parity='N', stopbits=1, timeout=None, xonxoff=False, rtscts=False, dsrdtr=False)>\n>>>\n\n~~~\n\n## \u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u8a08\u7b97\n\u516c\u5f0f\u306b\u3088\u308b\u3068\u3001\u30b3\u30fc\u30c9\u306e\u6700\u5f8c\u306e1\u30d0\u30a4\u30c8\u304c\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u8a08\u7b97\u65b9\u6cd5\u306f\u3001\u5148\u982d\u884c\u304b\u30891\u30d0\u30a4\u30c8\u305a\u3064\u52a0\u7b97\u3057\u3066\u3044\u304d\u3001\u548c\u306e\u4e0b\u4f4d1\u30d0\u30a4\u30c8\u306e\u88dc\u6570\u304c\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3064\u307e\u308a\u3001':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\u306e\u5834\u5408\u306e\u30c1\u30a7\u30c3\u30af\u30b5\u30e0\u306f\u6700\u5f8c\u306eBF\u3067\u3001\n0x0f+0x81+....0xff+0xff = 0x941\u3000\u3053\u308c\u306e\u4e0b1\u30d0\u30a4\u30c8\u306e0x41 + 0xBF = 0xa00\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u6700\u521d\u306e\":\"\u3092\u9664\u304f\u5168\u6841\u30921\u30d0\u30a4\u30c8\u305a\u3064\u52a0\u7b97\u3057\u305f\u7dcf\u548c\u306e\u4e0b1\u30d0\u30a4\u30c8\u306f\u304b\u306a\u3089\u305a0\u306b\u306a\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n\npython\u7684\u306a\u8a08\u7b97\u3092\u3059\u308b\u3068\u3001\n\n~~~python3\n\nPython 3.5.2 (default, Jun 28 2016, 08:46:01) \n[GCC 6.1.1 20160602] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> string = ':0F8115014E81012CFB00A437000BAC150101FFFFFFFFFFBF'\n>>> string = string[1:] #\u5192\u982d\u306e:\u3092\u9664\u304f\n>>> lst = [ int(string[i:i+2], 16) for i in range(0, len(string), 2) ]\u3000#\u4e8c\u6841\u305a\u3064\u5207\u308a\u53d6\u3063\u306616\u9032\u6570\u3068\u3057\u3066\u6570\u5024\u5316\n>>> s = sum(lst) #\u7dcf\u548c\u3092\u53d6\u308b\n>>> hex(s & 0b1111)\n'0x0'\n>>>\n\n~~~\n\n0\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3002\u8a71\u306e\u308f\u304b\u308b\u3084\u3064\u3060\n\n\n## \u30d1\u30fc\u30b9\n\n\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f[\u30de\u30cb\u30e5\u30a2\u30eb](http://mono-wireless.com/jp/products/TWE-Lite-USB/monitor.html)\u3092\u53c2\u7167\u3002\n\n~~~ python3\n# coding: utf-8\n#!/usr/bin/env python3\n\ndef parse(string):\n    if string[-2:] == b\"\\r\\n\"  : string = string[:-2]\n    if string[0]   == ord(':') : string = string[1:]\n    lst = [ int(string[i:i+2], 16) for i in range(0, len(string), 2) ]\n    if sum(lst) & 0xff == 0:\n        return lst\n\n    return False\n\nif __name__ == '__main__':\n    import serial\n    s = serial.Serial('/dev/ttyAMA0',115200)\n\n    l = s.readline()\n    lst = parse(l)\n\n    print (lst)\n\n    SOURCE_DEVIDE = lst[0]\n    COMMAND = lst[1]\n    PACKET = lst[2]\n    PROTOCOL = lst[3]\n    LQI = (7 * lst[4] - 1970 ) / 20\n    SN = lst[5] << 24 | lst[6] << 16 | lst[7] << 8 | lst[8]\n    DESTINATION_ID = lst[9]\n    TIMESTAMP = lst[10] << 8 | lst[11]\n    RELATED = True if lst[15] % 1 else False\n    VOLTAGE = lst[13] << 8 | lst[14]\n    NONE = 0\n    DIN = lst[16]\n    DCHANGE = lst[17]\n    ACOMP = lst[22]\n    AD1 = (lst[18] * 4 + ACOMP) * 4\n    AD2 = (lst[19] * 4 + ACOMP) * 4\n    AD3 = (lst[20] * 4 + ACOMP) * 4\n    AD4 = (lst[21] * 4 + ACOMP) * 4\n    SUM = lst[-1]\n\n    D1 = True if lst[16] & 0b0001 else False\n    D2 = True if lst[16] & 0b0010 else False\n    D3 = True if lst[16] & 0b0100 else False\n    D4 = True if lst[16] & 0b1000 else False\n\n~~~\n\n\u3042\u3068\u306f\u3054\u81ea\u7531\u306b\u3002\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u304c\u3001\u4eca\u898b\u305f\u3089\u9177\u3044\u51fa\u6765\u3060\u3063\u305f\u306e\u3067\u305d\u306e\u3046\u3061\u6539\u9020\u3057\u307e\u3059\n", "tags": ["TWE-Lite", "\u96fb\u5b50\u5de5\u4f5c", "python3", "RaspberryPi"]}