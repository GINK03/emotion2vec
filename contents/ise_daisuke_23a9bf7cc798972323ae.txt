{"tags": ["Ruby", "itamae"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nVagrant\u3067\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u74b0\u5883\u306bItamae\u3067rbenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u958b\u767a\u74b0\u5883\u3092\u81ea\u52d5\u69cb\u7bc9\u3057\u305f\u3044\u3051\u3069\u3001Chef\u304c\u624b\u306b\u4f59\u308b\u611f\u3058\uff08\u52c9\u5f37\u4e0d\u8db3\uff09\u306a\u306e\u3067Itamae\u3067\u3084\u3063\u3066\u307f\u308b\n\nVagrant\n\nVagrantfile\nVagrant.configure(2) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n  config.vm.box_url = \"http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_ubuntu-14.04_chef-provisionerless.box\"\n  config.vm.network \"private_network\", ip: \"192.168.33.109\"\n  config.ssh.forward_agent = true\nend\n\n\n$ vagrant up\n\n\nGemfile\n\nGemfile\nsource 'https://rubygems.org'\n\ngem 'rake'\ngem 'serverspec'\ngem 'itamae'\ngem 'itamae-plugin-recipe-rtn_rbenv'\n\n\n$ bundle install --path vendor/bundle\n\n\nItamae\u3067ruby-2.2.0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n# recipes/ruby.rb\ninclude_recipe 'rtn_rbenv::system'\n\n\n# nodes/node.json\n{\n    \"rtn_rbenv\": {\n        \"user\": \"vagrant\",\n        \"versions\": {\n            \"2.2.0\": []\n        },\n        \"global\": \"2.2.0\"\n    }\n}\n\n\n$ bundle exec itamae ssh -h 192.168.33.109 -u vagrant -j nodes/node.json recipes/ruby.rb -i .vagrant/machines/default/virtualbox/private_key\n\n\nserverspec\n$ bundle exec serverspec-init\n\n\nspec/default/sample_spec.rb\n\nrequire 'spec_helper'\n\ndescribe command('source /etc/profile.d/rbenv.sh; which rbenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/rbenv/bin/rbenv} }\nend\n\n\n\n$ bundle exec rake spec\n\nrake aborted!\nCircular dependency detected: TOP => spec => spec:all => spec:default => spec:all\n\nTasks: TOP => spec => spec:all => spec:default\n(See full trace by running task with --trace)\n\n# \u3068\u308a\u3042\u3048\u305aRakefile\u306e\u8a72\u5f53\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n#  task :default => :all\n\n\n$ bundle exec rake spec\n\n#\n# \u30c6\u30b9\u30c8\u304c\u3053\u3051\u307e\u3059\uff01\n\n\n\u3088\u304f\u8003\u3048\u3066\u307f\u305f\u3089ubuntu\u306a\u306e\u3067source\u30b3\u30de\u30f3\u30c9\u304c\u52b9\u304b\u306a\u3044\u3002\n\uff08\u4f55\u3082\u8003\u3048\u305a\u9069\u5f53\u306brbenv\u306eserverspec\u30b3\u30d4\u30da\u3057\u3066\u305f\u306e\u304c\u539f\u56e0\uff09\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\n\nspec/default/sample_spec.rb\n\nrequire 'spec_helper'\n\ndescribe command('. /etc/profile.d/rbenv.sh; which rbenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/rbenv/bin/rbenv} }\nend\n\n\n\n\u3053\u308c\u3067\u901a\u308b\u306f\u305a\n\n#### \u6982\u8981\nVagrant\u3067\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u74b0\u5883\u306bItamae\u3067rbenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u958b\u767a\u74b0\u5883\u3092\u81ea\u52d5\u69cb\u7bc9\u3057\u305f\u3044\u3051\u3069\u3001Chef\u304c\u624b\u306b\u4f59\u308b\u611f\u3058\uff08\u52c9\u5f37\u4e0d\u8db3\uff09\u306a\u306e\u3067Itamae\u3067\u3084\u3063\u3066\u307f\u308b\n\n#### Vagrant\n\n```rb:Vagrantfile\nVagrant.configure(2) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n  config.vm.box_url = \"http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_ubuntu-14.04_chef-provisionerless.box\"\n  config.vm.network \"private_network\", ip: \"192.168.33.109\"\n  config.ssh.forward_agent = true\nend\n```\n\n```\n$ vagrant up\n```\n\n\n#### Gemfile\n\n```rb:Gemfile\nsource 'https://rubygems.org'\n\ngem 'rake'\ngem 'serverspec'\ngem 'itamae'\ngem 'itamae-plugin-recipe-rtn_rbenv'\n```\n\n```\n$ bundle install --path vendor/bundle\n```\n\n\n#### Itamae\u3067ruby-2.2.0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n\n# recipes/ruby.rb\ninclude_recipe 'rtn_rbenv::system'\n\n\n# nodes/node.json\n{\n    \"rtn_rbenv\": {\n        \"user\": \"vagrant\",\n        \"versions\": {\n            \"2.2.0\": []\n        },\n        \"global\": \"2.2.0\"\n    }\n}\n\n```\n\n```\n$ bundle exec itamae ssh -h 192.168.33.109 -u vagrant -j nodes/node.json recipes/ruby.rb -i .vagrant/machines/default/virtualbox/private_key\n```\n\n\n#### serverspec\n\n```\n$ bundle exec serverspec-init\n```\n\n```spec/default/sample_spec.rb\n\nrequire 'spec_helper'\n\ndescribe command('source /etc/profile.d/rbenv.sh; which rbenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/rbenv/bin/rbenv} }\nend\n\n```\n\n```\n$ bundle exec rake spec\n\nrake aborted!\nCircular dependency detected: TOP => spec => spec:all => spec:default => spec:all\n\nTasks: TOP => spec => spec:all => spec:default\n(See full trace by running task with --trace)\n\n# \u3068\u308a\u3042\u3048\u305aRakefile\u306e\u8a72\u5f53\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n#  task :default => :all\n\n\n$ bundle exec rake spec\n\u0007\n#\n# \u30c6\u30b9\u30c8\u304c\u3053\u3051\u307e\u3059\uff01\n\n```\n\n\u3088\u304f\u8003\u3048\u3066\u307f\u305f\u3089ubuntu\u306a\u306e\u3067source\u30b3\u30de\u30f3\u30c9\u304c\u52b9\u304b\u306a\u3044\u3002\n\uff08\u4f55\u3082\u8003\u3048\u305a\u9069\u5f53\u306brbenv\u306eserverspec\u30b3\u30d4\u30da\u3057\u3066\u305f\u306e\u304c\u539f\u56e0\uff09\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\n\n```spec/default/sample_spec.rb\n\nrequire 'spec_helper'\n\ndescribe command('. /etc/profile.d/rbenv.sh; which rbenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/rbenv/bin/rbenv} }\nend\n\n```\n\n\u3053\u308c\u3067\u901a\u308b\u306f\u305a\n\n\n\n"}