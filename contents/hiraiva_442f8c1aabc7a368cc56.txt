{"context": "\n\n\u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\n\u4f8b\u3048\u3070\u3001\u3053\u3046\u3044\u3046\u4f55\u304b\u306e\u8cfc\u8cb7\u65e5\u304c\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb( purchase_log \u3068\u3059\u308b)\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3001\n\n\n\npurchase_date\nuser_id\n\n\n\n\n2016-12-01\nAAA\n\n\n2016-12-02\nBBB\n\n\n2016-12-02\nAAA\n\n\n2016-12-04\nBBB\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b \u4f55\u65e5\u304a\u304d\u306b\u8cfc\u5165\u3055\u308c\u3066\u3044\u308b\u304b \u3092\u8abf\u3079\u305f\u304b\u3063\u305f\u3002\n\n\u3084\u308a\u304b\u305f\n\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u99c6\u4f7f\u3057\u3066\u884c\u540c\u58eb\u306e\u5dee\u5206\u3092\u8a08\u7b97\u3059\u308b\u65b9\u6cd5\u3082\u3042\u308b\u304c\u3001\u30bd\u30fc\u30c8\u53ef\u80fd\u306a\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u304c\u5b58\u5728\u3057\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306a\u3069\u30b9\u30ad\u30fc\u30de\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\u305d\u3053\u3067 LAG() \u3068\u3044\u3046\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3048\u3070\u3001\u30bd\u30fc\u30c8\u306b\u6c17\u3092\u3064\u3051\u308b\u3060\u3051\u3067\u3067\u304d\u308b\u3002\u3084\u3063\u305f\u306d\uff01\n\nSQL\u306e\u4f8b\npurchase_log \u30c6\u30fc\u30d6\u30eb\u306e\u5834\u5408\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u8cfc\u8cb7\u65e5\u3054\u3068\u306e\u8cfc\u8cb7\u9593\u9694\u3092\u8a08\u7b97\u3059\u308b\u3002\nSELECT\n  purchase_date,\n  user_id,\n  purchase_date - LAG(purchase_date, 1) OVER (ORDER BY user_id ASC, purchase_date ASC) AS interval_days\nFROM purchase_log\nORDER BY user_id ASC, purchase_date ASC;\n\n\u3068\u3059\u308b\u3068\u3001\n purchase_date | user_id | interval_days \n---------------+---------+---------------\n 2016-12-01    | AAA     |              \n 2016-12-02    | AAA     |             1\n 2016-12-02    | BBB     |             0\n 2016-12-04    | BBB     |             2\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8fd4\u3063\u3066\u304f\u308b\u3002\n\u3042\u3068\u306f\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306b\u5165\u308c\u308b\u306a\u308a\u3057\u3066\u3001\u90aa\u9b54\u306a\u30c7\u30fc\u30bf( user_id \u306e\u5883\u754c\u3068\u304b)\u3092\u826f\u3044\u611f\u3058\u306b\u3057\u3066\u3001\u5e73\u5747\u8cfc\u8cb7\u9593\u9694\u306a\u3069\u305d\u308c\u3063\u307d\u3044\u6307\u6a19\u3092\u96c6\u8a08\u3059\u308c\u3070\u3088\u308d\u3057\u3002\n\n\u304a\u308f\u308a\u306b\n\u79c1\u306e\u5834\u5408\u306f\u5341\u5206\u5b9f\u7528\u306b\u8010\u3048\u3046\u308b\u51e6\u7406\u901f\u5ea6\u3067\u3057\u305f\u3002window\u95a2\u6570\u6d3b\u7528\u3057\u3066\u3044\u304d\u305f\u3044\u3002\nhttp://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html\nBigQuery\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3002\nhttps://cloud.google.com/bigquery/query-reference\n# \u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\n\n\u4f8b\u3048\u3070\u3001\u3053\u3046\u3044\u3046\u4f55\u304b\u306e\u8cfc\u8cb7\u65e5\u304c\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb( `purchase_log` \u3068\u3059\u308b)\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u3001\n\n| purchase_date | user_id |\n| --- | --- | --- |\n| 2016-12-01 | AAA | \n| 2016-12-02 | BBB | \n| 2016-12-02 | AAA | \n| 2016-12-04 | BBB | \n\n\u30e6\u30fc\u30b6\u30fc\u3054\u3068\u306b **\u4f55\u65e5\u304a\u304d\u306b\u8cfc\u5165\u3055\u308c\u3066\u3044\u308b\u304b** \u3092\u8abf\u3079\u305f\u304b\u3063\u305f\u3002\n\n# \u3084\u308a\u304b\u305f\n\n\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u99c6\u4f7f\u3057\u3066\u884c\u540c\u58eb\u306e\u5dee\u5206\u3092\u8a08\u7b97\u3059\u308b\u65b9\u6cd5\u3082\u3042\u308b\u304c\u3001\u30bd\u30fc\u30c8\u53ef\u80fd\u306a\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u304c\u5b58\u5728\u3057\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306a\u3069\u30b9\u30ad\u30fc\u30de\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\n\u305d\u3053\u3067 `LAG()` \u3068\u3044\u3046\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3048\u3070\u3001\u30bd\u30fc\u30c8\u306b\u6c17\u3092\u3064\u3051\u308b\u3060\u3051\u3067\u3067\u304d\u308b\u3002\u3084\u3063\u305f\u306d\uff01\n\n# SQL\u306e\u4f8b\n\n`purchase_log` \u30c6\u30fc\u30d6\u30eb\u306e\u5834\u5408\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u8cfc\u8cb7\u65e5\u3054\u3068\u306e\u8cfc\u8cb7\u9593\u9694\u3092\u8a08\u7b97\u3059\u308b\u3002\n\n```\nSELECT\n  purchase_date,\n  user_id,\n  purchase_date - LAG(purchase_date, 1) OVER (ORDER BY user_id ASC, purchase_date ASC) AS interval_days\nFROM purchase_log\nORDER BY user_id ASC, purchase_date ASC;\n```\n\n\u3068\u3059\u308b\u3068\u3001\n\n```\n purchase_date | user_id | interval_days \n---------------+---------+---------------\n 2016-12-01    | AAA     |              \n 2016-12-02    | AAA     |             1\n 2016-12-02    | BBB     |             0\n 2016-12-04    | BBB     |             2\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8fd4\u3063\u3066\u304f\u308b\u3002\n\n\u3042\u3068\u306f\u4e00\u6642\u30c6\u30fc\u30d6\u30eb\u306b\u5165\u308c\u308b\u306a\u308a\u3057\u3066\u3001\u90aa\u9b54\u306a\u30c7\u30fc\u30bf( `user_id` \u306e\u5883\u754c\u3068\u304b)\u3092\u826f\u3044\u611f\u3058\u306b\u3057\u3066\u3001\u5e73\u5747\u8cfc\u8cb7\u9593\u9694\u306a\u3069\u305d\u308c\u3063\u307d\u3044\u6307\u6a19\u3092\u96c6\u8a08\u3059\u308c\u3070\u3088\u308d\u3057\u3002\n\n# \u304a\u308f\u308a\u306b\n\n\u79c1\u306e\u5834\u5408\u306f\u5341\u5206\u5b9f\u7528\u306b\u8010\u3048\u3046\u308b\u51e6\u7406\u901f\u5ea6\u3067\u3057\u305f\u3002window\u95a2\u6570\u6d3b\u7528\u3057\u3066\u3044\u304d\u305f\u3044\u3002\n\nhttp://docs.aws.amazon.com/ja_jp/redshift/latest/dg/c_Window_functions.html\n\nBigQuery\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3002\n\nhttps://cloud.google.com/bigquery/query-reference\n", "tags": ["SQL", "redshift"]}