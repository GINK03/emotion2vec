{"context": "google/google-api-go-client\u3092\u4f7f\u3046\u3002\n\u53d6\u5f97\u51e6\u7406\u81ea\u4f53\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\nimport (\n  \"google.golang.org/api/compute/v1\"\n  \"net/http\"\n)\n\nfunc listInstances(client *http.Client, project_id string, zone string) (*compute.InstanceList, error) {\n    service, err := compute.New(client)  // New\u3092\u4f7f\u3046\u3068Serviec\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3064\u304f\u308c\u308b\u3002\u5404\u30b5\u30fc\u30d3\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3057\u3066\u304f\u308c\u308b\u3002\n    if err != nil {\n        return nil, err\n    }\n\n    t := services.instasces  //\u3000compute.NewInstancesService(service) \u3068\u7b49\u4fa1\n    list, err := t.List(project_id, zone).Do() // \u3044\u308d\u3093\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b List\u3092\u4f7f\u3046\u3068\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\u547d\u4ee4\u3092\u69cb\u7bc9\u3059\u308b\u3002 Do\u3067\u5b9f\u969b\u306e\u30a2\u30af\u30bb\u30b9\u304c\u767a\u751f\u3059\u308b\u3002\n    if err != nil {\n        return nil, err\n    }\n    return list, err\n}\n\nhttp.Client\u3068ProjectID\u3068ZONE\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\nhttp.Client\u306fGoogle API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u524d\u63d0\u306b\u306a\u308b\u3002\u5f8c\u8ff0\u3059\u308b\u3002\nGCE\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u306e\u53d6\u5f97\u306eAPI\u3092\u78ba\u8a8d\u3059\u308b\u3068 project \u3068 zone \u304c\u5fc5\u9808\u306a\u306e\u304c\u308f\u304b\u308b\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u306a\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306fDo\u3092\u547c\u3076\u969b\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nhttp.Clint\u306e\u53d6\u5f97\nDefaultClient\u3092\u4f7f\u3046\u3068\u3001gcloud auth login\u306a\u3069\u304c\u5b9f\u884c\u6e08\u307f\u3060\u3063\u305f\u308a\u3001GCE\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u6a29\u9650\u3092\u4ed8\u4e0e\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u60c5\u5831\u3092\u3064\u304b\u3063\u305fhttp.Client\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u5225\u9014APIKey\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u3001CLI\u30c4\u30fc\u30eb\u3068\u540c\u3058\u6a29\u9650\u3067\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u4fbf\u5229\u3002\n\u53c2\u8003\u30b3\u30fc\u30c9\u3002\nimport (\n  \"golang.org/x/oauth2/google\"\n  \"golang.org/x/net/context\"\n)\n\ndef client() *http.Client {\n    ctx := context.Background()\n    client, _ := google.DefaultClient(ctx)\n    return client\n}\n\ngoogle.DefaultClient\u3092\u4f7f\u3046\u306e\u306b\u3001Context\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\nGoogle AppEngine\u306e\u5834\u5408\nGoogle App Engine\u3067\u5229\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u5c11\u3057\u4fee\u6b63\u304c\u5fc5\u8981\u3002\nimport (\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/api/compute/v1\"\n    newurlfetch \"google.golang.org/appengine/urlfetch\"\n    \"net/http\"\n)\n\nfunc client(c *context.Context) *http.Client {\n    source, err := google.DefaultTokenSource(c, compute.ComputeScope)\n    if err != nil {\n        return nil, err\n    }\n    client := &http.Client{\n        Transport: &oauth2.Transport{\n            Source: source,\n            Base:   &newurlfetch.Transport{Context: c},\n        },\n    }\n    return client\n}\n\nGoogle App Engine\u306eSDK\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3082\u306e\u3067\u306f\u306a\u304f\u3001Managed VMs\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3088\u3046\u3060\u3002\n\u6700\u5f8c\u306b\u3001\u4e00\u3064\u306b\u307e\u3068\u3081\u305f\u30bd\u30fc\u30b9\u306e\u4f8b\u3092\u304a\u3044\u3068\u304f\npackage main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/net/context\"\n    \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/api/compute/v1\"\n    newurlfetch \"google.golang.org/appengine/urlfetch\"\n    \"net/http\"\n    \"os\"\n)\n\nconst project = \"XXXXXXXX\"  // project id\nconst zone = \"XXXXXXX\"      // east-asia1-b\u3068\u304b\n\nfunc listInstances(client *http.Client, project_id string, zone string) (*compute.InstanceList, error) {\n    service, err := compute.New(client)\n    if err != nil {\n        return nil, err\n    }\n    t := compute.NewInstancesService(service)\n    list, err := t.List(project_id, zone).Do()\n    if err != nil {\n        return nil, err\n    }\n    return list, err\n}\n\n// CLI\nfunc main() {\n    ctx := context.Background()\n    client, err := google.DefaultClient(ctx)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n    }\n\n    list, err := listInstances(client, project, zone)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    for _, v := range list.Items {\n        fmt.Println(v.Name)\n    }\n}\n\n// Google App Engine\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    ctx := context.Background()\n    if err != nil {\n        return nil, err\n    }\n    client := &http.Client{\n        Transport: &oauth2.Transport{\n            Source: source,\n            Base:   &newurlfetch.Transport{Context: c},\n        },\n    }\n    list, _ := listInstances(client, project, zone)\n    for _, v := range list.Items {\n        fmt.Fprintln(w, v.Name)\n    }\n}\n\n\n\u53c2\u8003\u6587\u732e\n\nhttps://github.com/google/google-api-go-client\nhttps://github.com/golang/oauth2\nhttps://godoc.org/google.golang.org/api/compute/v1\n\n[google/google-api-go-client](https://github.com/google/google-api-go-client)\u3092\u4f7f\u3046\u3002\n\n\u53d6\u5f97\u51e6\u7406\u81ea\u4f53\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n\n```go\nimport (\n  \"google.golang.org/api/compute/v1\"\n  \"net/http\"\n)\n\nfunc listInstances(client *http.Client, project_id string, zone string) (*compute.InstanceList, error) {\n\tservice, err := compute.New(client)  // New\u3092\u4f7f\u3046\u3068Serviec\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3064\u304f\u308c\u308b\u3002\u5404\u30b5\u30fc\u30d3\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u521d\u671f\u5316\u3057\u3066\u304f\u308c\u308b\u3002\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\t\n\tt := services.instasces  //\u3000compute.NewInstancesService(service) \u3068\u7b49\u4fa1\n\tlist, err := t.List(project_id, zone).Do() // \u3044\u308d\u3093\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b List\u3092\u4f7f\u3046\u3068\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b\u547d\u4ee4\u3092\u69cb\u7bc9\u3059\u308b\u3002 Do\u3067\u5b9f\u969b\u306e\u30a2\u30af\u30bb\u30b9\u304c\u767a\u751f\u3059\u308b\u3002\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn list, err\n}\n```\n\nhttp.Client\u3068ProjectID\u3068ZONE\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\nhttp.Client\u306fGoogle API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u524d\u63d0\u306b\u306a\u308b\u3002\u5f8c\u8ff0\u3059\u308b\u3002\n\n[GCE\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u306e\u53d6\u5f97\u306eAPI](https://cloud.google.com/compute/docs/reference/latest/instances/list)\u3092\u78ba\u8a8d\u3059\u308b\u3068 project \u3068 zone \u304c\u5fc5\u9808\u306a\u306e\u304c\u308f\u304b\u308b\u3002\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u306a\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306fDo\u3092\u547c\u3076\u969b\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\n# http.Clint\u306e\u53d6\u5f97\n\nDefaultClient\u3092\u4f7f\u3046\u3068\u3001`gcloud auth login`\u306a\u3069\u304c\u5b9f\u884c\u6e08\u307f\u3060\u3063\u305f\u308a\u3001GCE\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u969b\u306b\u6a29\u9650\u3092\u4ed8\u4e0e\u6e08\u307f\u3067\u3042\u308c\u3070\u3001\u305d\u306e\u60c5\u5831\u3092\u3064\u304b\u3063\u305fhttp.Client\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u5225\u9014APIKey\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u3001CLI\u30c4\u30fc\u30eb\u3068\u540c\u3058\u6a29\u9650\u3067\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u4fbf\u5229\u3002\n\n\u53c2\u8003\u30b3\u30fc\u30c9\u3002\n\n```\nimport (\n  \"golang.org/x/oauth2/google\"\n  \"golang.org/x/net/context\"\n)\n\ndef client() *http.Client {\n\tctx := context.Background()\n\tclient, _ := google.DefaultClient(ctx)\n\treturn client\n}\n```\n\ngoogle.DefaultClient\u3092\u4f7f\u3046\u306e\u306b\u3001Context\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\n## Google AppEngine\u306e\u5834\u5408\n\nGoogle App Engine\u3067\u5229\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u5c11\u3057\u4fee\u6b63\u304c\u5fc5\u8981\u3002\n\n\n```\nimport (\n\t\"golang.org/x/net/context\"\n\t\"golang.org/x/oauth2\"\n\t\"golang.org/x/oauth2/google\"\n\t\"google.golang.org/api/compute/v1\"\n\tnewurlfetch \"google.golang.org/appengine/urlfetch\"\n\t\"net/http\"\n)\n\nfunc client(c *context.Context) *http.Client {\n\tsource, err := google.DefaultTokenSource(c, compute.ComputeScope)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tclient := &http.Client{\n\t\tTransport: &oauth2.Transport{\n\t\t\tSource: source,\n\t\t\tBase:   &newurlfetch.Transport{Context: c},\n\t\t},\n\t}\n\treturn client\n}\n```\n\nGoogle App Engine\u306eSDK\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308b\u3082\u306e\u3067\u306f\u306a\u304f\u3001Managed VMs\u3092\u5229\u7528\u3059\u308b\u969b\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3088\u3046\u3060\u3002\n\n\u6700\u5f8c\u306b\u3001\u4e00\u3064\u306b\u307e\u3068\u3081\u305f\u30bd\u30fc\u30b9\u306e\u4f8b\u3092\u304a\u3044\u3068\u304f\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"golang.org/x/net/context\"\n\t\"golang.org/x/oauth2\"\n\t\"golang.org/x/oauth2/google\"\n\t\"google.golang.org/api/compute/v1\"\n\tnewurlfetch \"google.golang.org/appengine/urlfetch\"\n\t\"net/http\"\n\t\"os\"\n)\n\nconst project = \"XXXXXXXX\"  // project id\nconst zone = \"XXXXXXX\"      // east-asia1-b\u3068\u304b\n\nfunc listInstances(client *http.Client, project_id string, zone string) (*compute.InstanceList, error) {\n\tservice, err := compute.New(client)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tt := compute.NewInstancesService(service)\n\tlist, err := t.List(project_id, zone).Do()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn list, err\n}\n\n// CLI\nfunc main() {\n\tctx := context.Background()\n\tclient, err := google.DefaultClient(ctx)\n\tif err != nil {\n\t\tfmt.Fprintln(os.Stderr, err)\n\t}\n\n\tlist, err := listInstances(client, project, zone)\n\tif err != nil {\n\t\tfmt.Fprintln(os.Stderr, err)\n\t\treturn\n\t}\n\tfor _, v := range list.Items {\n\t\tfmt.Println(v.Name)\n\t}\n}\n\n// Google App Engine\nfunc init() {\n\thttp.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\tctx := context.Background()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tclient := &http.Client{\n\t\tTransport: &oauth2.Transport{\n\t\t\tSource: source,\n\t\t\tBase:   &newurlfetch.Transport{Context: c},\n\t\t},\n\t}\n\tlist, _ := listInstances(client, project, zone)\n\tfor _, v := range list.Items {\n\t\tfmt.Fprintln(w, v.Name)\n\t}\n}\n```\n\n### \u53c2\u8003\u6587\u732e\n\n* https://github.com/google/google-api-go-client\n* https://github.com/golang/oauth2\n* https://godoc.org/google.golang.org/api/compute/v1\n", "tags": ["golang", "GoogleAppEngine", "googlecomputeengine", "Go", "GAE"]}