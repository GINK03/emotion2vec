{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nIEnumerable \u304b\u3089 IDataReader \u3078\u5909\u63db\u3092\u4f5c\u6210\u3057\u3066\u3044\u3066\u3001\u3082\u3063\u3068\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u305f\u3081DataReader\u304b\u3089\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3068\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3067\u304d\u308b\u3068\u8003\u3048\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3002\nDbExecutor\u3082\u826f\u304b\u3063\u305f\u304c\u3001\u76f4\u63a5\u30af\u30e9\u30b9\u306b\u683c\u7d0d\u3057\u305f\u65b9\u304c\u624b\u9593\u304c\u7701\u3051\u308b\u3002\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3082DbExecutor \u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u8ffd\u52a0\u3057\u305f\u308a\u3001null\u306e\u5bfe\u5fdc\u3092\u3059\u308b\u3068\u4fbf\u5229\u306a\u30c4\u30fc\u30eb\u304c\u4f5c\u6210\u51fa\u6765\u305d\u3046\u3060\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data;\nusing System.Data.SqlClient;\nusing System.Reflection;\nusing System.Threading.Tasks;\nusing SampleDataReader.Properties;\n\nnamespace SampleDataReader\n{\n\n    class DataReaderEnumerable<TSource> \n    {\n        private readonly string _sql;\n        private readonly string _connectString;\n        private readonly List<PropertyInfo> listProp = new List<PropertyInfo>();\n\n        public DataReaderEnumerable(string sql, string connectString)\n        {\n            _sql = sql;\n            _connectString = connectString;\n            foreach (var prop in typeof(TSource).GetProperties())\n            {\n                listProp.Add(prop);\n            }\n        }\n\n        public IEnumerable<TSource> AsEnumerable()\n        {\n            using (var conn = new SqlConnection(_connectString))\n            {\n                conn.Open();\n                var cmd = new SqlCommand(_sql, conn);\n                using (var rd = cmd.ExecuteReader())\n                {\n                    while (rd.Read())\n                    {\n                        TSource cls = Activator.CreateInstance<TSource>();\n                        foreach (var fld in listProp)\n                            fld.SetValue(cls, rd[fld.Name]);\n                        yield return cls;\n                    }\n                }\n            }\n        }\n    }\n\n    class SampleTable\n    {\n        public int Field1 { get; set; }\n        public string Field2 { get; set; }\n    }\n\n    class Program\n    {\n        static void Main(string[] args)\n        {\n\n            string sql = \"SELECT * FROM SampleTable\";\n            string constr = Settings.Default.xxxConnectionString;\n            var cls = new DataReaderEnumerable<SampleTable>(sql, constr);\n            foreach (var row in cls.AsEnumerable())\n            {\n                Console.WriteLine(\"{0} {1}\", row.Field1, row.Field2);\n            }\n\n        }\n    }\n}```\n\n#\u306f\u3058\u3081\u306b\n[IEnumerable \u304b\u3089 IDataReader \u3078\u5909\u63db](http://qiita.com/st450/items/831d90990658e023a679)\u3092\u4f5c\u6210\u3057\u3066\u3044\u3066\u3001\u3082\u3063\u3068\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u305f\u3081DataReader\u304b\u3089\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u3068\u7c21\u5358\u306b\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3067\u304d\u308b\u3068\u8003\u3048\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3002\nDbExecutor\u3082\u826f\u304b\u3063\u305f\u304c\u3001\u76f4\u63a5\u30af\u30e9\u30b9\u306b\u683c\u7d0d\u3057\u305f\u65b9\u304c\u624b\u9593\u304c\u7701\u3051\u308b\u3002\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3082DbExecutor \u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u8ffd\u52a0\u3057\u305f\u308a\u3001null\u306e\u5bfe\u5fdc\u3092\u3059\u308b\u3068\u4fbf\u5229\u306a\u30c4\u30fc\u30eb\u304c\u4f5c\u6210\u51fa\u6765\u305d\u3046\u3060\u3002\n#\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n```csharp\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing System.Data;\nusing System.Data.SqlClient;\nusing System.Reflection;\nusing System.Threading.Tasks;\nusing SampleDataReader.Properties;\n\nnamespace SampleDataReader\n{\n\n    class DataReaderEnumerable<TSource> \n    {\n        private readonly string _sql;\n        private readonly string _connectString;\n        private readonly List<PropertyInfo> listProp = new List<PropertyInfo>();\n\n        public DataReaderEnumerable(string sql, string connectString)\n        {\n            _sql = sql;\n            _connectString = connectString;\n            foreach (var prop in typeof(TSource).GetProperties())\n            {\n                listProp.Add(prop);\n            }\n        }\n\n        public IEnumerable<TSource> AsEnumerable()\n        {\n            using (var conn = new SqlConnection(_connectString))\n            {\n                conn.Open();\n                var cmd = new SqlCommand(_sql, conn);\n                using (var rd = cmd.ExecuteReader())\n                {\n                    while (rd.Read())\n                    {\n                        TSource cls = Activator.CreateInstance<TSource>();\n                        foreach (var fld in listProp)\n                            fld.SetValue(cls, rd[fld.Name]);\n                        yield return cls;\n                    }\n                }\n            }\n        }\n    }\n\n    class SampleTable\n    {\n        public int Field1 { get; set; }\n        public string Field2 { get; set; }\n    }\n\n    class Program\n    {\n        static void Main(string[] args)\n        {\n\n            string sql = \"SELECT * FROM SampleTable\";\n            string constr = Settings.Default.xxxConnectionString;\n            var cls = new DataReaderEnumerable<SampleTable>(sql, constr);\n            foreach (var row in cls.AsEnumerable())\n            {\n                Console.WriteLine(\"{0} {1}\", row.Field1, row.Field2);\n            }\n\n        }\n    }\n}```\n", "tags": ["C#", "SQLServer"]}