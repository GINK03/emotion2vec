{"context": " More than 1 year has passed since last update.Mojolicious - 5\u5e74\u524d\u306e\u52d5\u304b\u306a\u304f\u306a\u3063\u3066\u3044\u305fWebSocket\u30b3\u30fc\u30c9\u3092\u306a\u3093\u3068\u304b\u3059\u308b - Qiita\n\u306e\u7d9a\u304d\u3002\ncurl\u30b3\u30de\u30f3\u30c9\u307f\u305f\u3044\u306ahttp\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3082\u306e\u3092\u60f3\u50cf\u3059\u308b\u3068\u8fd1\u3044\u3002\nWeb\u30d6\u30e9\u30a6\u30b6\u4f7f\u308f\u306a\u304f\u3066\u3082\u30c7\u30d0\u30c3\u30b0\u3067\u304d\u308b\u306e\u3067\u8ca0\u8377\u8a66\u9a13\u3060\u3068\u304b\u306b\u3082\u5f79\u7acb\u3064\u3002\n\n\u9001\u4fe1\u3057\u3066\u5207\u65ad\n\nagent.pl\nuse strict;\nuse warnings;\nuse Mojo::UserAgent;\n\nmy $ua = Mojo::UserAgent->new;\n$ua->websocket('ws://localhost/echo' => sub {\n  my ($ua, $tx) = @_;\n  print \"WebSocket handshake failed!\\n\" and return unless $tx->is_websocket;\n\n  $tx->on(finish => sub {\n    my ($tx, $code, $reason) = @_;\n    print \"WebSocket closed with status $code.\\n\";\n  });\n\n  $tx->on(message => sub {\n    my ($tx, $msg) = @_;\n    print \"WebSocket message: $msg\\n\";\n    $tx->finish;\n  });\n\n  $tx->send('Hi!');\n});\nMojo::IOLoop->start unless Mojo::IOLoop->is_running;\n\n\n$ perl agent.pl\nWebSocket message: {\"hms\":\"23:58:05\",\"text\":\"Hi!\"}\nWebSocket closed with status 1005.\n\n\n\u5f85\u3061\u7d9a\u3051\u3066\u53d7\u4fe1\u3059\u308b\n\nloop.pl\nuse strict;\nuse warnings;\nuse Mojo::UserAgent;\n\nmy $ua = Mojo::UserAgent->new;\n$ua->websocket('ws://localhost/echo' => sub {\n  my ($ua, $tx) = @_;\n  print \"WebSocket handshake failed!\\n\" and return unless $tx->is_websocket;\n\n  Mojo::IOLoop->stream($tx->connection)->timeout(0);\n\n  $tx->on(finish => sub {\n    my ($tx, $code, $reason) = @_;\n    print \"WebSocket closed with status $code.\\n\";\n  });\n\n  $tx->on(message => sub {\n    my ($tx, $msg) = @_;\n    print \"WebSocket message: $msg\\n\";\n    #$tx->finish;\n  });\n\n  $tx->send('Hi!');\n});\nMojo::IOLoop->start unless Mojo::IOLoop->is_running;\n\n\n$ perl loop.pl\nWebSocket message: {\"hms\":\"23:59:31\",\"text\":\"Hi!\"}\nWebSocket message: {\"hms\":\"23:59:34\",\"text\":\"aaa\"}\nWebSocket message: {\"hms\":\"23:59:36\",\"text\":\"bbb\"}\nWebSocket message: {\"hms\":\"23:59:37\",\"text\":\"ccc\"}\nWebSocket message: {\"hms\":\"23:59:42\",\"text\":\"test\"}\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u9001\u4fe1\u3059\u308b\u3068\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u308b\n\n\u53c2\u8003\nMojo::UserAgent \u00b7 yuki-kimoto/mojolicious-guides-japanese Wiki\nhttps://github.com/yuki-kimoto/mojolicious-guides-japanese/wiki/Mojo::UserAgent\nMojo::UserAgent - Non-blocking I/O HTTP and WebSocket user agent\nhttp://mojolicio.us/perldoc/Mojo/UserAgent\n[Mojolicious - 5\u5e74\u524d\u306e\u52d5\u304b\u306a\u304f\u306a\u3063\u3066\u3044\u305fWebSocket\u30b3\u30fc\u30c9\u3092\u306a\u3093\u3068\u304b\u3059\u308b - Qiita](http://qiita.com/ymko/items/03780e066ba3bf34d8e5)\n\u306e\u7d9a\u304d\u3002\n\ncurl\u30b3\u30de\u30f3\u30c9\u307f\u305f\u3044\u306ahttp\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3082\u306e\u3092\u60f3\u50cf\u3059\u308b\u3068\u8fd1\u3044\u3002\nWeb\u30d6\u30e9\u30a6\u30b6\u4f7f\u308f\u306a\u304f\u3066\u3082\u30c7\u30d0\u30c3\u30b0\u3067\u304d\u308b\u306e\u3067\u8ca0\u8377\u8a66\u9a13\u3060\u3068\u304b\u306b\u3082\u5f79\u7acb\u3064\u3002\n\n# \u9001\u4fe1\u3057\u3066\u5207\u65ad\n\n```pl:agent.pl\nuse strict;\nuse warnings;\nuse Mojo::UserAgent;\n\nmy $ua = Mojo::UserAgent->new;\n$ua->websocket('ws://localhost/echo' => sub {\n  my ($ua, $tx) = @_;\n  print \"WebSocket handshake failed!\\n\" and return unless $tx->is_websocket;\n\n  $tx->on(finish => sub {\n    my ($tx, $code, $reason) = @_;\n    print \"WebSocket closed with status $code.\\n\";\n  });\n\n  $tx->on(message => sub {\n    my ($tx, $msg) = @_;\n    print \"WebSocket message: $msg\\n\";\n    $tx->finish;\n  });\n\n  $tx->send('Hi!');\n});\nMojo::IOLoop->start unless Mojo::IOLoop->is_running;\n```\n\n```bash\n$ perl agent.pl\nWebSocket message: {\"hms\":\"23:58:05\",\"text\":\"Hi!\"}\nWebSocket closed with status 1005.\n```\n\n# \u5f85\u3061\u7d9a\u3051\u3066\u53d7\u4fe1\u3059\u308b\n\n```pl:loop.pl\nuse strict;\nuse warnings;\nuse Mojo::UserAgent;\n\nmy $ua = Mojo::UserAgent->new;\n$ua->websocket('ws://localhost/echo' => sub {\n  my ($ua, $tx) = @_;\n  print \"WebSocket handshake failed!\\n\" and return unless $tx->is_websocket;\n\n  Mojo::IOLoop->stream($tx->connection)->timeout(0);\n\n  $tx->on(finish => sub {\n    my ($tx, $code, $reason) = @_;\n    print \"WebSocket closed with status $code.\\n\";\n  });\n\n  $tx->on(message => sub {\n    my ($tx, $msg) = @_;\n    print \"WebSocket message: $msg\\n\";\n    #$tx->finish;\n  });\n\n  $tx->send('Hi!');\n});\nMojo::IOLoop->start unless Mojo::IOLoop->is_running;\n```\n\n\n```bash\n$ perl loop.pl\nWebSocket message: {\"hms\":\"23:59:31\",\"text\":\"Hi!\"}\nWebSocket message: {\"hms\":\"23:59:34\",\"text\":\"aaa\"}\nWebSocket message: {\"hms\":\"23:59:36\",\"text\":\"bbb\"}\nWebSocket message: {\"hms\":\"23:59:37\",\"text\":\"ccc\"}\nWebSocket message: {\"hms\":\"23:59:42\",\"text\":\"test\"}\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u9001\u4fe1\u3059\u308b\u3068\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u308b\n\n# \u53c2\u8003\n\nMojo::UserAgent \u00b7 yuki-kimoto/mojolicious-guides-japanese Wiki\nhttps://github.com/yuki-kimoto/mojolicious-guides-japanese/wiki/Mojo::UserAgent\n\nMojo::UserAgent - Non-blocking I/O HTTP and WebSocket user agent\nhttp://mojolicio.us/perldoc/Mojo/UserAgent\n", "tags": ["Perl", "Mojolicious"]}