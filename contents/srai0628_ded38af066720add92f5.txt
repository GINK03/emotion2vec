{"context": "\n\n\u80cc\u666f\n\u6027\u80fd\u554f\u984c\u306a\u3069\u306b\u3088\u3063\u3066\u767a\u884c\u3059\u308bSQL\u3092\u5909\u66f4\u3057\u305f\u3044\u304c\u3001\u51fa\u529b\u5f62\u5f0f\u3092\u5909\u3048\u305f\u304f\u306a\u3044\u3002\n\u305d\u306e\u3088\u3046\u306a\u5834\u5408\u304c\u3001\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nCakePHP\uff12\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3001Model\u306eafterFind\u30e1\u30bd\u30c3\u30c9\u3092override\u3059\u308c\u3070\u691c\u7d22\u7d50\u679c\u306e\u69cb\u9020\u5909\u66f4\u306a\u3069\u306f\u5b9f\u73fe\u3067\u304d\u307e\u3059\u304c\u3001\u7279\u5b9a\u306e\u753b\u9762\u306e\u7279\u5b9a\u306efind\u306e\u6642\u3060\u3051\u5909\u3048\u305f\u3044\u3088\u3046\u306a\u5834\u5408\u306fafterFind\u3060\u3068\u5f71\u97ff\u7bc4\u56f2\u304c\u5e83\u3059\u304e\u307e\u3059\u3002\n\u305d\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u3067\u306f\u3001find\u306b\u6e21\u3059\u30d1\u30e9\u30e1\u30fc\u30bf\u306btype\u3092\u6307\u5b9a\u3057\u3001\u305d\u306etype\u306b\u8a72\u5f53\u3059\u308bfind\u30e1\u30bd\u30c3\u30c9\u3092Model\u306b\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u524d\u51e6\u7406\u3084\u5f8c\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u5b9f\u88c5\u30b5\u30f3\u30d7\u30eb\nclass Book extends AppModel {\n\n    // type\u3092$findMethods\u3068\u3044\u3046\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u767b\u9332\u3057\u307e\u3059\n    public $findMethods = ['rented' => true, 'bought' => true];\n\n/**\n * type=rented\u306b\u5bfe\u5fdc\u3059\u308bfind\u30e1\u30bd\u30c3\u30c9.\n * \u547d\u540d\u898f\u5247\u306f_find\u306e\u5f8c\u306btype\u306e\u5148\u982d\u3092\u5927\u6587\u5b57\u306b\u3057\u305f\u6587\u5b57\u5217\u3068\u3059\u308b.\n *\n * @param string $state \"before\"\u304b\"after\"\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @param mixed $query find\u547c\u3073\u51fa\u3057\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @param array $results \"after\"\u306e\u5834\u5408\u306b\u691c\u7d22\u7d50\u679c\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @access protected\n * @return array\n */\n    protected function _findRented($state, $query, $results = array()) {\n        // \u691c\u7d22\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u66f4\u65b0\u3059\u308b\u5834\u5408\u306a\u3069\n        if ($state === 'before') {\n            $query['conditions']['rented'] = 1;\n            return $query;\n        }\n\n        // \u691c\u7d22\u7d50\u679c\u3092\u66f4\u65b0\u3059\u308b\u5834\u5408\u306a\u3069\n        if ($state === 'after') {\n            $customResults = [];\n            foreach ($results as $result) {\n                // \u7d50\u679c\u3092\u52a0\u5de5\n                $result['Book']['full_name'] = '\u501f\u308a\u7269:' . $result['Book']['name'];\n                $customResults[] = $result;\n            }\n            return $customResults;\n        }\n    }\n\n/**\n * type=bought\u3092\u5bfe\u5fdc\u3057\u305f\u30b5\u30f3\u30d7\u30eb\n *\n * @return array\n */\n    protected function _findBought($state, $query, $results = array()) {\n        if ($state === 'before') {\n            // \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u51e6\u7406\u3092\u8a18\u8f09\n            return $query;\n        }\n\n        if ($state === 'after') {\n            // \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u51e6\u7406\u3092\u8a18\u8f09\n            return $results\n        }\n    }\n\n/**\n * type=rented\u3092\u6307\u5b9a\u3057\u3066find\u3092\u547c\u3073\u51fa\u3059\u30b5\u30f3\u30d7\u30eb.\n *\n * @return array\n */\n    public function retrieveRentedBooks() {\n        // type\u306brented\u3092\u6307\u5b9a\u3059\u308b\u3068\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c_findRented\u3092\u547c\u3073\u51fa\u3059\n        return $this->find('all', [\n            'type' => 'rented'\n        ]);\n    }\n}\n\n# \u80cc\u666f\n\n\u6027\u80fd\u554f\u984c\u306a\u3069\u306b\u3088\u3063\u3066\u767a\u884c\u3059\u308bSQL\u3092\u5909\u66f4\u3057\u305f\u3044\u304c\u3001\u51fa\u529b\u5f62\u5f0f\u3092\u5909\u3048\u305f\u304f\u306a\u3044\u3002\n\u305d\u306e\u3088\u3046\u306a\u5834\u5408\u304c\u3001\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nCakePHP\uff12\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3001Model\u306eafterFind\u30e1\u30bd\u30c3\u30c9\u3092override\u3059\u308c\u3070\u691c\u7d22\u7d50\u679c\u306e\u69cb\u9020\u5909\u66f4\u306a\u3069\u306f\u5b9f\u73fe\u3067\u304d\u307e\u3059\u304c\u3001\u7279\u5b9a\u306e\u753b\u9762\u306e\u7279\u5b9a\u306efind\u306e\u6642\u3060\u3051\u5909\u3048\u305f\u3044\u3088\u3046\u306a\u5834\u5408\u306fafterFind\u3060\u3068\u5f71\u97ff\u7bc4\u56f2\u304c\u5e83\u3059\u304e\u307e\u3059\u3002\n\n\u305d\u306e\u3088\u3046\u306a\u30b1\u30fc\u30b9\u3067\u306f\u3001find\u306b\u6e21\u3059\u30d1\u30e9\u30e1\u30fc\u30bf\u306btype\u3092\u6307\u5b9a\u3057\u3001\u305d\u306etype\u306b\u8a72\u5f53\u3059\u308bfind\u30e1\u30bd\u30c3\u30c9\u3092Model\u306b\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u524d\u51e6\u7406\u3084\u5f8c\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u5b9f\u88c5\u30b5\u30f3\u30d7\u30eb\n\n```\nclass Book extends AppModel {\n\n    // type\u3092$findMethods\u3068\u3044\u3046\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u767b\u9332\u3057\u307e\u3059\n    public $findMethods = ['rented' => true, 'bought' => true];\n\n/**\n * type=rented\u306b\u5bfe\u5fdc\u3059\u308bfind\u30e1\u30bd\u30c3\u30c9.\n * \u547d\u540d\u898f\u5247\u306f_find\u306e\u5f8c\u306btype\u306e\u5148\u982d\u3092\u5927\u6587\u5b57\u306b\u3057\u305f\u6587\u5b57\u5217\u3068\u3059\u308b.\n *\n * @param string $state \"before\"\u304b\"after\"\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @param mixed $query find\u547c\u3073\u51fa\u3057\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @param array $results \"after\"\u306e\u5834\u5408\u306b\u691c\u7d22\u7d50\u679c\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n * @access protected\n * @return array\n */\n    protected function _findRented($state, $query, $results = array()) {\n        // \u691c\u7d22\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u66f4\u65b0\u3059\u308b\u5834\u5408\u306a\u3069\n        if ($state === 'before') {\n            $query['conditions']['rented'] = 1;\n            return $query;\n        }\n\n        // \u691c\u7d22\u7d50\u679c\u3092\u66f4\u65b0\u3059\u308b\u5834\u5408\u306a\u3069\n        if ($state === 'after') {\n            $customResults = [];\n            foreach ($results as $result) {\n                // \u7d50\u679c\u3092\u52a0\u5de5\n                $result['Book']['full_name'] = '\u501f\u308a\u7269:' . $result['Book']['name'];\n                $customResults[] = $result;\n            }\n            return $customResults;\n        }\n    }\n\n/**\n * type=bought\u3092\u5bfe\u5fdc\u3057\u305f\u30b5\u30f3\u30d7\u30eb\n *\n * @return array\n */\n    protected function _findBought($state, $query, $results = array()) {\n        if ($state === 'before') {\n            // \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u51e6\u7406\u3092\u8a18\u8f09\n            return $query;\n        }\n\n        if ($state === 'after') {\n            // \u5fc5\u8981\u306b\u5fdc\u3058\u3066\u51e6\u7406\u3092\u8a18\u8f09\n            return $results\n        }\n    }\n\n/**\n * type=rented\u3092\u6307\u5b9a\u3057\u3066find\u3092\u547c\u3073\u51fa\u3059\u30b5\u30f3\u30d7\u30eb.\n *\n * @return array\n */\n    public function retrieveRentedBooks() {\n        // type\u306brented\u3092\u6307\u5b9a\u3059\u308b\u3068\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c_findRented\u3092\u547c\u3073\u51fa\u3059\n        return $this->find('all', [\n            'type' => 'rented'\n        ]);\n    }\n}\n```\n\n", "tags": ["CakePHP", "cakephp2"]}