{"context": "\n\nAbstract\nThis article shows the EC2 and RDS template with CloudFormation, which follows the previous article on VPC template. \n\nLogical Architecture Blueprint\nSame as the previous one.\n\n\nTemplate\n\"XXX\" at the template below should be modified according to your environment. Plus, MySQL with 5.6.27 and Amazon Linux are adopted in the template. These should be changed as you like as well. \n* SubnetID and SecurityGroupID are obtained from VPC console after VPC is created with the previous VPC template.\n\nEc2Rds.template\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"EC2 and RDS for WordPress\",\n    \"Parameters\": {\n        \"Ec2InstanceTypeParameter\": {\n            \"Type\": \"String\",\n            \"Default\": \"t2.micro\",\n            \"Description\": \"Enter instance type\"},\n        \"KeyName\": {\n            \"Type\": \"String\",\n            \"Default\": \"XXX\"},\n        \"DmzSecurityGroupId\": {\n            \"Type\": \"String\",\n            \"Default\": \"sg-XXX\",\n            \"Description\": \"Enter Security Group Id to EC2\"},\n        \"DmzSubnetId\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter Subnet Id for the single Instance\"},\n\n        \"DbInstanceTypeParameter\": {\n            \"Type\": \"String\",\n            \"Default\": \"db.t2.micro\",\n            \"Description\" : \"The database instance type\",\n            \"AllowedValues\" : [ \"db.t2.micro\", \"db.m1.small\", \"db.m1.large\", \"db.m1.xlarge\", \"db.m2.xlarge\", \"db.m2.2xlarge\", \"db.m2.4xlarge\" ],\n            \"ConstraintDescription\" : \"must select a valid database instance type.\"},\n        \"DbPassword\": {\n            \"NoEcho\": \"true\",\n            \"Description\" : \"Password for MySQL database access\",\n            \"Type\": \"String\",\n            \"MinLength\": \"1\",\n            \"MaxLength\": \"41\",\n            \"AllowedPattern\" : \"[a-zA-Z0-9]*\",\n            \"ConstraintDescription\" : \"must contain only alphanumeric characters.\"},\n        \"DbAllocatedStorage\": {\n            \"Default\": \"5\",\n            \"Description\" : \"The size of the database (Gb)\",\n            \"Type\": \"String\",\n            \"ConstraintDescription\" : \"must be between 5 and 1024Gb.\"},\n        \"DbSecurityGroupId\": {\n            \"Type\": \"String\",\n            \"Default\": \"sg-XXX\",\n            \"Description\": \"Enter Security Group Id to RDS\"},\n        \"DbSubnetA\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter DB Subnet Group Id to RDS at AZ-a\"},\n        \"DbSubnetC\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter DB Subnet Group Id to RDS at AZ-c\"}\n    },    \n\n\n    \"Resources\": {\n        \"Ec2Instance1\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"Properties\": {\n                \"ImageId\": \"ami-29160d47\",\n                \"Tenancy\" : \"default\",\n                \"InstanceType\": {\"Ref\": \"Ec2InstanceTypeParameter\"},\n                \"NetworkInterfaces\": [{\n                    \"AssociatePublicIpAddress\": \"true\",\n                    \"GroupSet\": [ {\"Ref\": \"DmzSecurityGroupId\"} ],\n                    \"SubnetId\": {\"Ref\": \"DmzSubnetId\"},\n                    \"DeviceIndex\": \"0\"}],\n                \"KeyName\": {\"Ref\": \"KeyName\"},\n                \"Tags\": [{\"Key\": \"Name\", \"Value\": { \"Fn::Join\": [\" \", [{\"Ref\": \"AWS::StackName\"}, \"WP-EC2\"]]}}]}},\n\n        \"DbInstance1\": {\n            \"Type\": \"AWS::RDS::DBInstance\",\n            \"Properties\": {\n                \"DBInstanceIdentifier\": \"wp-mysql\",\n                \"VPCSecurityGroups\": [{\"Ref\": \"DbSecurityGroupId\"}],\n                \"DBSubnetGroupName\": {\"Ref\": \"DbSubnetGroup\"},\n                \"AllocatedStorage\": {\"Ref\": \"DbAllocatedStorage\"},\n                \"DBInstanceClass\": {\"Ref\": \"DbInstanceTypeParameter\"},\n                \"Engine\": \"MySQL\",\n                \"EngineVersion\": \"5.6.27\",\n                \"MultiAZ\": \"true\",\n                \"MasterUsername\": \"XXX\",\n                \"MasterUserPassword\": {\"Ref\": \"DbPassword\"},\n                \"Tags\": [{\"Key\": \"Name\", \"Value\": { \"Fn::Join\": [\" \", [{\"Ref\": \"AWS::StackName\"}, \"WP-RDS\"]]}}]}},\n        \"DbSubnetGroup\" : {\n            \"Type\" : \"AWS::RDS::DBSubnetGroup\",\n            \"Properties\" : {\n                \"DBSubnetGroupDescription\" : \"Subnets available for the RDS DB Instance\",\n                \"SubnetIds\" : [{\"Ref\": \"DbSubnetA\"}, {\"Ref\": \"DbSubnetC\"}]}}\n    },\n\n\n    \"Outputs\": {\n        \"Ec2InstanceId\": {\n            \"Value\": {\"Ref\": \"Ec2Instance1\"},\n            \"Description\": \"EC2 Instance Id newly created\"},\n        \"DbInstanceId\": {\n            \"Value\": {\"Ref\": \"DbInstance1\"},\n            \"Description\": \"RDS Instance Id newly created\"}}\n}\n\n\n\n# Abstract\nThis article shows the EC2 and RDS template with CloudFormation, which follows the previous [article](http://qiita.com/miz-k/items/4300e4d563e9e8b58b30) on VPC template. \n\n# Logical Architecture Blueprint\nSame as the previous one.\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-08 11.53.18.png](https://qiita-image-store.s3.amazonaws.com/0/105050/758f63d7-c60e-ee04-eab1-d278f8f04376.png)\n\n# Template\n\"XXX\" at the template below should be modified according to your environment. Plus, MySQL with 5.6.27 and Amazon Linux are adopted in the template. These should be changed as you like as well. \n* SubnetID and SecurityGroupID are obtained from VPC console after VPC is created with the previous VPC template.\n\n```JSON:Ec2Rds.template\n{\n    \"AWSTemplateFormatVersion\": \"2010-09-09\",\n    \"Description\": \"EC2 and RDS for WordPress\",\n    \"Parameters\": {\n        \"Ec2InstanceTypeParameter\": {\n            \"Type\": \"String\",\n            \"Default\": \"t2.micro\",\n            \"Description\": \"Enter instance type\"},\n        \"KeyName\": {\n            \"Type\": \"String\",\n            \"Default\": \"XXX\"},\n        \"DmzSecurityGroupId\": {\n            \"Type\": \"String\",\n            \"Default\": \"sg-XXX\",\n            \"Description\": \"Enter Security Group Id to EC2\"},\n        \"DmzSubnetId\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter Subnet Id for the single Instance\"},\n\n        \"DbInstanceTypeParameter\": {\n            \"Type\": \"String\",\n            \"Default\": \"db.t2.micro\",\n            \"Description\" : \"The database instance type\",\n            \"AllowedValues\" : [ \"db.t2.micro\", \"db.m1.small\", \"db.m1.large\", \"db.m1.xlarge\", \"db.m2.xlarge\", \"db.m2.2xlarge\", \"db.m2.4xlarge\" ],\n            \"ConstraintDescription\" : \"must select a valid database instance type.\"},\n        \"DbPassword\": {\n            \"NoEcho\": \"true\",\n            \"Description\" : \"Password for MySQL database access\",\n            \"Type\": \"String\",\n            \"MinLength\": \"1\",\n            \"MaxLength\": \"41\",\n            \"AllowedPattern\" : \"[a-zA-Z0-9]*\",\n            \"ConstraintDescription\" : \"must contain only alphanumeric characters.\"},\n        \"DbAllocatedStorage\": {\n            \"Default\": \"5\",\n            \"Description\" : \"The size of the database (Gb)\",\n            \"Type\": \"String\",\n            \"ConstraintDescription\" : \"must be between 5 and 1024Gb.\"},\n        \"DbSecurityGroupId\": {\n            \"Type\": \"String\",\n            \"Default\": \"sg-XXX\",\n            \"Description\": \"Enter Security Group Id to RDS\"},\n        \"DbSubnetA\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter DB Subnet Group Id to RDS at AZ-a\"},\n        \"DbSubnetC\": {\n            \"Type\": \"String\",\n            \"Default\": \"subnet-XXX\",\n            \"Description\": \"Enter DB Subnet Group Id to RDS at AZ-c\"}\n    },    \n\n\n    \"Resources\": {\n        \"Ec2Instance1\": {\n            \"Type\": \"AWS::EC2::Instance\",\n            \"Properties\": {\n                \"ImageId\": \"ami-29160d47\",\n                \"Tenancy\" : \"default\",\n                \"InstanceType\": {\"Ref\": \"Ec2InstanceTypeParameter\"},\n                \"NetworkInterfaces\": [{\n                    \"AssociatePublicIpAddress\": \"true\",\n                    \"GroupSet\": [ {\"Ref\": \"DmzSecurityGroupId\"} ],\n                    \"SubnetId\": {\"Ref\": \"DmzSubnetId\"},\n                    \"DeviceIndex\": \"0\"}],\n                \"KeyName\": {\"Ref\": \"KeyName\"},\n                \"Tags\": [{\"Key\": \"Name\", \"Value\": { \"Fn::Join\": [\" \", [{\"Ref\": \"AWS::StackName\"}, \"WP-EC2\"]]}}]}},\n\n        \"DbInstance1\": {\n            \"Type\": \"AWS::RDS::DBInstance\",\n            \"Properties\": {\n                \"DBInstanceIdentifier\": \"wp-mysql\",\n                \"VPCSecurityGroups\": [{\"Ref\": \"DbSecurityGroupId\"}],\n                \"DBSubnetGroupName\": {\"Ref\": \"DbSubnetGroup\"},\n                \"AllocatedStorage\": {\"Ref\": \"DbAllocatedStorage\"},\n                \"DBInstanceClass\": {\"Ref\": \"DbInstanceTypeParameter\"},\n                \"Engine\": \"MySQL\",\n                \"EngineVersion\": \"5.6.27\",\n                \"MultiAZ\": \"true\",\n                \"MasterUsername\": \"XXX\",\n                \"MasterUserPassword\": {\"Ref\": \"DbPassword\"},\n                \"Tags\": [{\"Key\": \"Name\", \"Value\": { \"Fn::Join\": [\" \", [{\"Ref\": \"AWS::StackName\"}, \"WP-RDS\"]]}}]}},\n        \"DbSubnetGroup\" : {\n            \"Type\" : \"AWS::RDS::DBSubnetGroup\",\n            \"Properties\" : {\n                \"DBSubnetGroupDescription\" : \"Subnets available for the RDS DB Instance\",\n                \"SubnetIds\" : [{\"Ref\": \"DbSubnetA\"}, {\"Ref\": \"DbSubnetC\"}]}}\n    },\n    \n    \n    \"Outputs\": {\n        \"Ec2InstanceId\": {\n            \"Value\": {\"Ref\": \"Ec2Instance1\"},\n            \"Description\": \"EC2 Instance Id newly created\"},\n        \"DbInstanceId\": {\n            \"Value\": {\"Ref\": \"DbInstance1\"},\n            \"Description\": \"RDS Instance Id newly created\"}}\n}\n\n```\n", "tags": ["AWS", "CloudFormation", "EC2", "RDS", "WordPress"]}