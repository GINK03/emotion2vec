{"tags": ["\u95a2\u6570\u578b\u8a00\u8a9e", "FRP", "Bacon.js", "JavaScript"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nBacon.js \u3092\u7528\u3044\u3066\u3001\u30ab\u30bf\u30f3\u306e\u30b5\u30a4\u30b3\u30ed\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3001\u30b5\u30a4\u30b3\u30ed\u306e\u76ee\u306b\u504f\u308a\u304c\u3042\u308b\u306e\u304b\u3092\u691c\u8a3c\u3057\u307e\u3057\u305f\u300236\u56de\u3092\u3072\u3068\u307e\u3068\u3081\u3068\u3057\u3001\u5404\u51fa\u76ee\uff082\u301c12\uff09\u304c\u5e73\u5747\u78ba\u7387\u4ee5\u4e0a\u306e\u983b\u5ea6\u3067\u3069\u306e\u7a0b\u5ea6\u51fa\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u6ce8: \u7279\u306b\u30ab\u30bf\u30f3\u306b\u3064\u3044\u3066\u77e5\u3089\u306a\u304f\u3066\u3082\u3001\u652f\u969c\u3042\u308a\u307e\u305b\u3093\u3002Bacon.js \u306b\u8208\u5473\u3042\u308b\u65b9\u306f\u3001\u5165\u9580\u7de8\u3068\u3057\u3066\u308f\u308a\u3068\u5f79\u306b\u7acb\u3064\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u6e96\u5099\n\n\u30b5\u30a4\u30b3\u30ed\nBacon.js \u306e EventStream.fromPoll \u30e1\u30bd\u30c3\u30c9\u3092\u7528\u3044\u3066\u3001100msec \u306b1\u56de\u30b5\u30a4\u30b3\u30ed\u3092\u632f\u308a\u307e\u3059\u3002\nfunction rollDie() {\n    return Math.ceil(Math.random() * 6);\n}\n\n\nfunction rollTwoDice() {\n    return rollDie() + rollDie();\n}\n\n\nvar diceStream = Bacon.fromPoll(100, function() {\n    return new Bacon.Next(rollTwoDice());\n});\n\n\n\u8a66\u884c\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\nwithStateMachine \u3092\u7528\u3044\u3066\u8a66\u884c\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\nvar counterStream = diceStream.withStateMachine(0, function(sum, event) {\n    if (event.hasValue()) {\n        sum = sum + 1;\n        return [sum, [new Bacon.Next(sum)]];\n    }\n});\n\n\n36\u56de\u3092\u3072\u3068\u307e\u3068\u3081\u306b\n\u51fa\u76ee\u306e\u504f\u308a\u3092\u898b\u308b\u305f\u3081\u306b\u3001\u9023\u7d9a\u3059\u308b36\u56de\u3054\u3068\u306b\u3072\u3068\u307e\u3068\u3081\u306b\u3057\u307e\u3059\u3002\n\n\u7a7a\u306e\u914d\u5217\u3092\u7528\u610f\nevent \u3092\u53d7\u3051\u53d6\u3063\u305f\u3089\u5f8c\u308d\u306b\u8ffd\u52a0\n36\u4ef6\u3088\u308a\u591a\u304f\u306a\u3063\u305f\u3089\u3001\u53e4\u3044\u3082\u306e\u304b\u3089\u524a\u9664\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3001\u6700\u592736\u306e\u9577\u3055\u306e\u914d\u5217\u3092 subscriber \u306b\u6e21\u3057\u307e\u3059\u3002\nvar RANGE = 36;\n\nvar bufferedStream = diceStream.withStateMachine(new Array(), function(sum, event) {\n    if (event.hasValue()) {\n        sum.push(event.value());\n        if (sum.length > RANGE) {\n            sum.shift();\n        }\n        return [sum, [new Bacon.Next(sum)]];\n    }\n});\n\n\n\u51fa\u73fe\u78ba\u7387\u3092\u8a08\u7b97\n\u6700\u65b0\u306e\u51fa\u76ee\u306e\uff08\u904e\u53bb36\u56de\u5185\u3067\u306e\uff09\u51fa\u73fe\u56de\u6570\u3068\u3001\u7406\u8ad6\u4e0a\u306e\u51fa\u73fe\u78ba\u7387\u3068\u306e\u6bd4\u3092 subscriber \u3078\u8fd4\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u300136\u56de\u8caf\u307e\u308b\u307e\u3067\u306e\u9593\u306f\u3001\u6bd4\u7387\u3092\u8fd4\u3055\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\uff08\u3084\u3084\u30a4\u30b1\u3066\u306a\u3044\uff09\u3002\nvar PRODUCTIVITY = {\n    2: 1/36,\n    3: 2/36,\n    4: 3/36,\n    5: 4/36,\n    6: 5/36,\n    7: 6/36,\n    8: 5/36,\n    9: 4/36,\n    10: 3/36,\n    11: 2/36,\n    12: 1/36\n};\n\nvar productivityStream = bufferedStream.map(function (value) {\n    var current = value[value.length - 1];\n    var prod = PRODUCTIVITY[current];\n    var num = value.filter(function (x) {return x == current;}).length;\n    var rate = (num / RANGE) / prod;\n    if (value.length < RANGE) {\n        return [num, undefined];\n    } else {\n        return [num, rate];\n    }\n});\n\n\n\u51fa\u73fe\u78ba\u7387\u306e\u78ba\u7387\u3092\u8a55\u4fa1\n\u51fa\u73fe\u78ba\u7387\u306e\u504f\u308a\u306b\u5fdc\u3058\u3066\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n\n\n\u6bd4\u7387\n\u30e1\u30c3\u30bb\u30fc\u30b8\n\n\n\n\n3\u500d\u4ee5\u4e0a\n\uff77\uff80\uff67\u2501\u2501\u2501(\u3000\u00b4\u2200\uff40)\u2501\u2501\u2501\u2501!!!\n\n\n2\u500d\u4ee5\u4e0a\n\uff77\uff80(\uff65\u2200\uff65)\uff7a\uff9a!!\n\n\n0.5~2\u500d\n\u8868\u793a\u306a\u3057\n\n\n0.5\u500d\u4ee5\u4e0b\n\u2211(\uffe3\u0414\uffe3\uff1b)\u306a\u306c\u3045\u3063\uff01\uff01\n\n\n\nvar productivityStateStream = productivityStream.map(function (value) {\n    if (value[1] === undefined) {\n        return \"\";\n    }\n    if (value[1] >= 3.0) {\n        return \"\uff77\uff80\uff67\u2501\u2501\u2501(\u3000\u00b4\u2200\uff40)\u2501\u2501\u2501\u2501!!!\";\n    } else if (value[1] >= 2.0) {\n        return \"\uff77\uff80(\uff65\u2200\uff65)\uff7a\uff9a!!\";\n    } else if (value[1] > 0.5) {\n        return \"\";\n    } else {\n        return \"\u2211(\uffe3\u0414\uffe3\uff1b)\u306a\u306c\u3045\u3063\uff01\uff01\";\n    }\n});\n\n\n\n\u5b9f\u884c\n\u6700\u5f8c\u306b\u3001\u3053\u308c\u3089\u306e EventStream \u3092\u7d50\u5408\u3057\u3066\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002event \u306e\u540c\u671f\u3092\u53d6\u308b\u306e\u306b combineTemplate \u304c\u4fbf\u5229\u3067\u3059\u3002\n    var $result = $('#result');\n    Bacon.combineTemplate({\n        'dice': diceStream,\n        'counter': counterStream,\n        'productivity': productivityStream,\n        'state': productivityStateStream\n    }).onValue(function(value) {\n        var val = value.counter + \": \" + value.dice + \" (\" + value.productivity[0] + \") \" + value.state;\n        $result.append($('<li>').text(val));\n    });\n\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u5b9f\u884c\u7d50\u679c\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nhttps://github.com/ledmonster/joking.bacon.catan\n\n\u5b9f\u884c\u7d50\u679c\u306f\u3053\u3053\u3067\u898b\u308c\u307e\u3059\u3002\n\n\nhttp://ledmonster.github.io/joking.bacon.catan/ (1000\u4ef6\u3067\u6253\u3061\u6b62\u3081)\n\n\n\u53c2\u8003\n\n\u30ab\u30bf\u30f3\u306e\u6d41\u308c\u3092\u691c\u8a3c\u3057\u3066\u307f\u305f\n\n\n# \u6982\u8981\nBacon.js \u3092\u7528\u3044\u3066\u3001\u30ab\u30bf\u30f3\u306e\u30b5\u30a4\u30b3\u30ed\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3057\u3001\u30b5\u30a4\u30b3\u30ed\u306e\u76ee\u306b\u504f\u308a\u304c\u3042\u308b\u306e\u304b\u3092\u691c\u8a3c\u3057\u307e\u3057\u305f\u300236\u56de\u3092\u3072\u3068\u307e\u3068\u3081\u3068\u3057\u3001\u5404\u51fa\u76ee\uff082\u301c12\uff09\u304c\u5e73\u5747\u78ba\u7387\u4ee5\u4e0a\u306e\u983b\u5ea6\u3067\u3069\u306e\u7a0b\u5ea6\u51fa\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u6ce8: \u7279\u306b[\u30ab\u30bf\u30f3](http://ja.wikipedia.org/wiki/%E3%82%AB%E3%82%BF%E3%83%B3%E3%81%AE%E9%96%8B%E6%8B%93%E8%80%85%E3%81%9F%E3%81%A1)\u306b\u3064\u3044\u3066\u77e5\u3089\u306a\u304f\u3066\u3082\u3001\u652f\u969c\u3042\u308a\u307e\u305b\u3093\u3002Bacon.js \u306b\u8208\u5473\u3042\u308b\u65b9\u306f\u3001\u5165\u9580\u7de8\u3068\u3057\u3066\u308f\u308a\u3068\u5f79\u306b\u7acb\u3064\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n# \u6e96\u5099\n\n## \u30b5\u30a4\u30b3\u30ed\n\nBacon.js \u306e EventStream.fromPoll \u30e1\u30bd\u30c3\u30c9\u3092\u7528\u3044\u3066\u3001100msec \u306b1\u56de\u30b5\u30a4\u30b3\u30ed\u3092\u632f\u308a\u307e\u3059\u3002\n\n``` JavaScript\nfunction rollDie() {\n    return Math.ceil(Math.random() * 6);\n}\n\n\nfunction rollTwoDice() {\n    return rollDie() + rollDie();\n}\n\n\nvar diceStream = Bacon.fromPoll(100, function() {\n    return new Bacon.Next(rollTwoDice());\n});\n```\n\n## \u8a66\u884c\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\n\nwithStateMachine \u3092\u7528\u3044\u3066\u8a66\u884c\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n``` JavaScript\nvar counterStream = diceStream.withStateMachine(0, function(sum, event) {\n    if (event.hasValue()) {\n        sum = sum + 1;\n        return [sum, [new Bacon.Next(sum)]];\n    }\n});\n```\n\n## 36\u56de\u3092\u3072\u3068\u307e\u3068\u3081\u306b\n\u51fa\u76ee\u306e\u504f\u308a\u3092\u898b\u308b\u305f\u3081\u306b\u3001\u9023\u7d9a\u3059\u308b36\u56de\u3054\u3068\u306b\u3072\u3068\u307e\u3068\u3081\u306b\u3057\u307e\u3059\u3002\n\n- \u7a7a\u306e\u914d\u5217\u3092\u7528\u610f\n- event \u3092\u53d7\u3051\u53d6\u3063\u305f\u3089\u5f8c\u308d\u306b\u8ffd\u52a0\n- 36\u4ef6\u3088\u308a\u591a\u304f\u306a\u3063\u305f\u3089\u3001\u53e4\u3044\u3082\u306e\u304b\u3089\u524a\u9664\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3001\u6700\u592736\u306e\u9577\u3055\u306e\u914d\u5217\u3092 subscriber \u306b\u6e21\u3057\u307e\u3059\u3002\n\n``` JavaScript\nvar RANGE = 36;\n\nvar bufferedStream = diceStream.withStateMachine(new Array(), function(sum, event) {\n    if (event.hasValue()) {\n        sum.push(event.value());\n        if (sum.length > RANGE) {\n            sum.shift();\n        }\n        return [sum, [new Bacon.Next(sum)]];\n    }\n});\n```\n\n## \u51fa\u73fe\u78ba\u7387\u3092\u8a08\u7b97\n\n\u6700\u65b0\u306e\u51fa\u76ee\u306e\uff08\u904e\u53bb36\u56de\u5185\u3067\u306e\uff09\u51fa\u73fe\u56de\u6570\u3068\u3001\u7406\u8ad6\u4e0a\u306e\u51fa\u73fe\u78ba\u7387\u3068\u306e\u6bd4\u3092 subscriber \u3078\u8fd4\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u300136\u56de\u8caf\u307e\u308b\u307e\u3067\u306e\u9593\u306f\u3001\u6bd4\u7387\u3092\u8fd4\u3055\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\uff08\u3084\u3084\u30a4\u30b1\u3066\u306a\u3044\uff09\u3002\n\n``` JavaScript\nvar PRODUCTIVITY = {\n    2: 1/36,\n    3: 2/36,\n    4: 3/36,\n    5: 4/36,\n    6: 5/36,\n    7: 6/36,\n    8: 5/36,\n    9: 4/36,\n    10: 3/36,\n    11: 2/36,\n    12: 1/36\n};\n\nvar productivityStream = bufferedStream.map(function (value) {\n    var current = value[value.length - 1];\n    var prod = PRODUCTIVITY[current];\n    var num = value.filter(function (x) {return x == current;}).length;\n    var rate = (num / RANGE) / prod;\n    if (value.length < RANGE) {\n        return [num, undefined];\n    } else {\n        return [num, rate];\n    }\n});\n```\n\n## \u51fa\u73fe\u78ba\u7387\u306e\u78ba\u7387\u3092\u8a55\u4fa1\n\n\u51fa\u73fe\u78ba\u7387\u306e\u504f\u308a\u306b\u5fdc\u3058\u3066\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n|\u6bd4\u7387|\u30e1\u30c3\u30bb\u30fc\u30b8|\n|---|---------|\n|3\u500d\u4ee5\u4e0a|\uff77\uff80\uff67\u2501\u2501\u2501(\u3000\u00b4\u2200\uff40)\u2501\u2501\u2501\u2501!!!|\n|2\u500d\u4ee5\u4e0a|\uff77\uff80(\uff65\u2200\uff65)\uff7a\uff9a!!|\n|0.5~2\u500d|\u8868\u793a\u306a\u3057|\n|0.5\u500d\u4ee5\u4e0b|\u2211(\uffe3\u0414\uffe3\uff1b)\u306a\u306c\u3045\u3063\uff01\uff01|\n\n``` JavaScript\nvar productivityStateStream = productivityStream.map(function (value) {\n    if (value[1] === undefined) {\n        return \"\";\n    }\n    if (value[1] >= 3.0) {\n        return \"\uff77\uff80\uff67\u2501\u2501\u2501(\u3000\u00b4\u2200\uff40)\u2501\u2501\u2501\u2501!!!\";\n    } else if (value[1] >= 2.0) {\n        return \"\uff77\uff80(\uff65\u2200\uff65)\uff7a\uff9a!!\";\n    } else if (value[1] > 0.5) {\n        return \"\";\n    } else {\n        return \"\u2211(\uffe3\u0414\uffe3\uff1b)\u306a\u306c\u3045\u3063\uff01\uff01\";\n    }\n});\n\n```\n\n# \u5b9f\u884c\n\u6700\u5f8c\u306b\u3001\u3053\u308c\u3089\u306e EventStream \u3092\u7d50\u5408\u3057\u3066\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002event \u306e\u540c\u671f\u3092\u53d6\u308b\u306e\u306b combineTemplate \u304c\u4fbf\u5229\u3067\u3059\u3002\n\n``` JavaScript\n    var $result = $('#result');\n    Bacon.combineTemplate({\n        'dice': diceStream,\n        'counter': counterStream,\n        'productivity': productivityStream,\n        'state': productivityStateStream\n    }).onValue(function(value) {\n        var val = value.counter + \": \" + value.dice + \" (\" + value.productivity[0] + \") \" + value.state;\n        $result.append($('<li>').text(val));\n    });\n\n```\n\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u5b9f\u884c\u7d50\u679c\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n- https://github.com/ledmonster/joking.bacon.catan\n\n\u5b9f\u884c\u7d50\u679c\u306f\u3053\u3053\u3067\u898b\u308c\u307e\u3059\u3002\n\n- http://ledmonster.github.io/joking.bacon.catan/ (1000\u4ef6\u3067\u6253\u3061\u6b62\u3081)\n\n# \u53c2\u8003\n- [\u30ab\u30bf\u30f3\u306e\u6d41\u308c\u3092\u691c\u8a3c\u3057\u3066\u307f\u305f](http://www.slideshare.net/ledmonster/ss-38441555)\n\n"}