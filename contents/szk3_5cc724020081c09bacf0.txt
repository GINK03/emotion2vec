{"tags": ["AWS", "CloudWatch", "CloudWatch-Logs"], "context": " More than 1 year has passed since last update.AmazonLinux\u3067cloudwatch logs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/etc/awslogs)\u306b proxy.conf \u3068 config\u30c7\u30a3\u30ec\u30af\u30c8\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u540c\u50da\u306b\u6559\u3048\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002\n\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u308b\u3068\u3001\u4eca\u307e\u3067 awslogs.conf \u306b\u5168\u90e8\u66f8\u304b\u306a\u3044\u3068\u884c\u3051\u306a\u304b\u3063\u305f\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u3066\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u307f\u305f\u3044\u3067\u3059\u3002\n\u307e\u305f\u3001proxy.conf \u306b\u306fawslogs\u306e\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u307f\u305f\u3044\u3067\u3059\uff01\nAmazonLinux\u304a\u3088\u3073\u3001awslogs\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n$ cat /etc/system-release\nAmazon Linux AMI release 2015.09\n\n$ yum install awslogs\n:\n$ rpm -qi awslogs\nName        : awslogs\nVersion     : 1.1.2\nRelease     : 1.10.amzn1\nArchitecture: noarch\nInstall Date: 2016\u5e7401\u670822\u65e5 14\u664224\u520647\u79d2\nGroup       : Amazon/Tools\nSize        : 11735\nLicense     : Amazon Software License\nSignature   : RSA/SHA256, 2016\u5e7401\u670822\u65e5 06\u664252\u520643\u79d2, Key ID bcb4a85b21c0f39f\nSource RPM  : awslogs-1.1.2-1.10.amzn1.src.rpm\nBuild Date  : 2016\u5e7401\u670822\u65e5 06\u664249\u520657\u79d2\nBuild Host  : build-60006.build\nRelocations : (not relocatable)\nPackager    : Amazon.com, Inc. <http://aws.amazon.com>\nVendor      : Amazon.com\nURL         : http://aws.amazon.com/cloudwatch\nSummary     : Scripts for CloudWatch Logs Daemon\nDescription :\nScripts to run Amazon CloudWatch Logs as a daemon.\n\n\nproxy.conf\nproxy.conf \u306e\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\u305d\u308c\u305e\u308c\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u30d7\u30ed\u30ad\u30b7\u7d4c\u7531\u3067log\u3092push\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n$ cat /etc/awslogs/proxy.conf\n# Version: 1.1.2rpm\n# Refer to http://docs.aws.amazon.com/cli/latest/userguide/cli-http-proxy.html for details.\nHTTP_PROXY=\nHTTPS_PROXY=\nNO_PROXY=\n\n\u3069\u3046\u3084\u3063\u3066\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u304b\u3068\u3044\u3046\u3068\u3001awslogsd \u306e\u4e2d\u8eab\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u3063\u305f\u3089\u8aad\u307f\u8fbc\u3080\u307f\u305f\u3044\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u8a2d\u5b9a\u65b9\u6cd5\u307f\u305f\u3044\u3067\u3059\u3002\n$ sudo cat /usr/sbin/awslogsd\n#!/bin/sh\n# Version: 1.1.2-rpm\necho -n $$ > /var/run/awslogs.pid\n[ -f /etc/awslogs/proxy.conf ] && . /etc/awslogs/proxy.conf\nexec /usr/bin/env -i HTTPS_PROXY=$HTTPS_PROXY HTTP_PROXY=$HTTP_PROXY NO_PROXY=$NO_PROXY AWS_CONFIG_FILE=/etc/awslogs/awscli.conf HOME=/root /bin/nice -n 4 /usr/bin/aws logs push --config-file /etc/awslogs/awslogs.conf --additional-configs-dir /etc/awslogs/config >> /var/log/awslogs.log 2>&1\n\n\u3053\u306e\u4e2d\u3092\u307f\u308b\u3068\u3001--additional-configs-dir\u30aa\u30d7\u30b7\u30e7\u30f3\u3067config\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3067\u306f\u3001config\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u306f\u3069\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3051\u3070\u3044\u3044\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\nconfig\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\u521d\u3081\u306f\u3001*.conf\u307f\u305f\u3044\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u5b9f\u88c5\u3092\u898b\u308b\u9650\u308a\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u306a\u3093\u3067\u3082\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\u5b9f\u969b\u306e\u8aad\u307f\u8fbc\u307f\u306f\u3001/usr/lib/python2.7/dist-packages/cwlogs/push.py \u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\npush.py\u304b\u3089\u4e00\u90e8\u629c\u7c8b\u3002\n$ sudo sed -n '236,267p' /usr/lib/python2.7/dist-packages/cwlogs/push.py\n    def _get_config(self, config_file, configs_dir):\n        validate_file_readable(config_file)\n        config = configparser.RawConfigParser(StreamConfig.DEFAULT_DICT)\n        config.read(config_file)\n        if not configs_dir:\n            return config\n\n        if os.path.isdir(configs_dir):\n            files = os.listdir(configs_dir)\n            for file_name in files:\n                file_name = os.path.join(configs_dir, file_name)\n                if os.path.isfile(file_name):\n                    validate_file_readable(file_name)\n                    logger.info(\"Loading additional configs from \" + file_name)\n                    subconfig = configparser.RawConfigParser(StreamConfig.DEFAULT_DICT)\n\n                    try:\n                        subconfig.read(file_name)\n                    except Exception as e:\n                        logger.warning(\"Failed to parse additional config file \" + file_name + \": \" + str(e))\n                        continue\n\n                    for section in subconfig.sections():\n                        if config.has_section(section) or section == StreamConfig.GENERAL_SECTION:\n                            continue\n                        for option in subconfig.options(section):\n                            if not config.has_section(section):\n                                config.add_section(section)\n\n                            config.set(section, option, subconfig.get(section, option))\n\n        return config\n\n\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u305f\u8a2d\u5b9a\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f\u3001/var/log/awslogs.log\u306b\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u306d\u3002\n\n\u307e\u3068\u3081\n\u3044\u307e\u307e\u3067\u306e awslogs.conf \u306f\u8a2d\u5b9a\u30921\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u304b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u8a2d\u5b9a\u306e\u8ffd\u52a0\u3084\u524a\u9664\u304c\u3084\u308a\u306b\u304f\u3044\u611f\u3058\u304c\u3057\u3066\u307e\u3057\u305f\u3002\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u5bfe\u5fdc\u3067\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u3066\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u3067\u3001\u30a4\u30f3\u30d5\u30e9\u74b0\u5883\u306e\u81ea\u52d5\u5316\u306a\u3069\u3082\u3084\u308a\u3084\u3059\u304f\u306a\u308b\u3088\u3046\u306b\u611f\u3058\u307e\u3059\u3002\n\u307e\u305f\u3001proxy\u306e\u8a2d\u5b9a\u3082\u3044\u307e\u307e\u3067\u306f /usr/sbin/awslogsd \u306e\u4e2d\u8eab\u3092\u66f8\u304d\u63db\u3048\u305f\u308a\u6b63\u76f4\u5fae\u5999\u306a\u611f\u3058  \u3067\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u305d\u308c\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5207\u308a\u51fa\u3055\u308c\u7ba1\u7406\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u74b0\u5883\u69cb\u7bc9\u3059\u308b\u5074\u304b\u3089\u3059\u308b\u3068\u3001\u3053\u3046\u3044\u3046\u5730\u5473\u306a\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306f\u5927\u5909\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u306d  \nAmazonLinux\u3067cloudwatch logs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/etc/awslogs)\u306b `proxy.conf` \u3068 config\u30c7\u30a3\u30ec\u30af\u30c8\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u540c\u50da\u306b\u6559\u3048\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002\n\n\u3061\u3087\u3063\u3068\u8abf\u3079\u3066\u307f\u308b\u3068\u3001\u4eca\u307e\u3067 `awslogs.conf` \u306b\u5168\u90e8\u66f8\u304b\u306a\u3044\u3068\u884c\u3051\u306a\u304b\u3063\u305f**\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u3066\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f**\u307f\u305f\u3044\u3067\u3059\u3002\n\u307e\u305f\u3001`proxy.conf` \u306b\u306fawslogs\u306e\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u307f\u305f\u3044\u3067\u3059\uff01\n\nAmazonLinux\u304a\u3088\u3073\u3001awslogs\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ cat /etc/system-release\nAmazon Linux AMI release 2015.09\n\n$ yum install awslogs\n:\n$ rpm -qi awslogs\nName        : awslogs\nVersion     : 1.1.2\nRelease     : 1.10.amzn1\nArchitecture: noarch\nInstall Date: 2016\u5e7401\u670822\u65e5 14\u664224\u520647\u79d2\nGroup       : Amazon/Tools\nSize        : 11735\nLicense     : Amazon Software License\nSignature   : RSA/SHA256, 2016\u5e7401\u670822\u65e5 06\u664252\u520643\u79d2, Key ID bcb4a85b21c0f39f\nSource RPM  : awslogs-1.1.2-1.10.amzn1.src.rpm\nBuild Date  : 2016\u5e7401\u670822\u65e5 06\u664249\u520657\u79d2\nBuild Host  : build-60006.build\nRelocations : (not relocatable)\nPackager    : Amazon.com, Inc. <http://aws.amazon.com>\nVendor      : Amazon.com\nURL         : http://aws.amazon.com/cloudwatch\nSummary     : Scripts for CloudWatch Logs Daemon\nDescription :\nScripts to run Amazon CloudWatch Logs as a daemon.\n```\n\n# proxy.conf\n\n`proxy.conf` \u306e\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\u305d\u308c\u305e\u308c\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u30d7\u30ed\u30ad\u30b7\u7d4c\u7531\u3067log\u3092push\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n$ cat /etc/awslogs/proxy.conf\n# Version: 1.1.2rpm\n# Refer to http://docs.aws.amazon.com/cli/latest/userguide/cli-http-proxy.html for details.\nHTTP_PROXY=\nHTTPS_PROXY=\nNO_PROXY=\n```\n\n\u3069\u3046\u3084\u3063\u3066\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u304b\u3068\u3044\u3046\u3068\u3001`awslogsd` \u306e\u4e2d\u8eab\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u3063\u305f\u3089\u8aad\u307f\u8fbc\u3080\u307f\u305f\u3044\u306a\u30b7\u30f3\u30d7\u30eb\u306a\u8a2d\u5b9a\u65b9\u6cd5\u307f\u305f\u3044\u3067\u3059\u3002\n\n```\n$ sudo cat /usr/sbin/awslogsd\n#!/bin/sh\n# Version: 1.1.2-rpm\necho -n $$ > /var/run/awslogs.pid\n[ -f /etc/awslogs/proxy.conf ] && . /etc/awslogs/proxy.conf\nexec /usr/bin/env -i HTTPS_PROXY=$HTTPS_PROXY HTTP_PROXY=$HTTP_PROXY NO_PROXY=$NO_PROXY AWS_CONFIG_FILE=/etc/awslogs/awscli.conf HOME=/root /bin/nice -n 4 /usr/bin/aws logs push --config-file /etc/awslogs/awslogs.conf --additional-configs-dir /etc/awslogs/config >> /var/log/awslogs.log 2>&1\n```\n\n\u3053\u306e\u4e2d\u3092\u307f\u308b\u3068\u3001**`--additional-configs-dir`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067config\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b**\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u3067\u306f\u3001config\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u306f\u3069\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3051\u3070\u3044\u3044\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\n# config\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n\u521d\u3081\u306f\u3001\\*.conf\u307f\u305f\u3044\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001**\u5b9f\u88c5\u3092\u898b\u308b\u9650\u308a\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u306a\u3093\u3067\u3082\u826f\u3055\u305d\u3046**\u3067\u3059\u3002\n\u5b9f\u969b\u306e\u8aad\u307f\u8fbc\u307f\u306f\u3001`/usr/lib/python2.7/dist-packages/cwlogs/push.py` \u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\npush.py\u304b\u3089\u4e00\u90e8\u629c\u7c8b\u3002\n\n```python\n$ sudo sed -n '236,267p' /usr/lib/python2.7/dist-packages/cwlogs/push.py\n    def _get_config(self, config_file, configs_dir):\n        validate_file_readable(config_file)\n        config = configparser.RawConfigParser(StreamConfig.DEFAULT_DICT)\n        config.read(config_file)\n        if not configs_dir:\n            return config\n\n        if os.path.isdir(configs_dir):\n            files = os.listdir(configs_dir)\n            for file_name in files:\n                file_name = os.path.join(configs_dir, file_name)\n                if os.path.isfile(file_name):\n                    validate_file_readable(file_name)\n                    logger.info(\"Loading additional configs from \" + file_name)\n                    subconfig = configparser.RawConfigParser(StreamConfig.DEFAULT_DICT)\n\n                    try:\n                        subconfig.read(file_name)\n                    except Exception as e:\n                        logger.warning(\"Failed to parse additional config file \" + file_name + \": \" + str(e))\n                        continue\n\n                    for section in subconfig.sections():\n                        if config.has_section(section) or section == StreamConfig.GENERAL_SECTION:\n                            continue\n                        for option in subconfig.options(section):\n                            if not config.has_section(section):\n                                config.add_section(section)\n\n                            config.set(section, option, subconfig.get(section, option))\n\n        return config\n```\n\n\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u305f\u8a2d\u5b9a\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306f\u3001`/var/log/awslogs.log`\u306b\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u306d\u3002\n\n# \u307e\u3068\u3081\n\n\u3044\u307e\u307e\u3067\u306e `awslogs.conf` \u306f\u8a2d\u5b9a\u30921\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u304b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001**\u8a2d\u5b9a\u306e\u8ffd\u52a0\u3084\u524a\u9664\u304c\u3084\u308a\u306b\u304f\u3044**\u611f\u3058\u304c\u3057\u3066\u307e\u3057\u305f\u3002\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u5bfe\u5fdc\u3067**\u8a2d\u5b9a\u3092\u30d5\u30a1\u30a4\u30eb\u5206\u5272\u3057\u3066\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3053\u3068\u3067\u3001\u30a4\u30f3\u30d5\u30e9\u74b0\u5883\u306e\u81ea\u52d5\u5316\u306a\u3069\u3082\u3084\u308a\u3084\u3059\u304f\u306a\u308b\u3088\u3046\u306b\u611f\u3058\u307e\u3059**\u3002\n\n\u307e\u305f\u3001proxy\u306e\u8a2d\u5b9a\u3082\u3044\u307e\u307e\u3067\u306f `/usr/sbin/awslogsd` \u306e\u4e2d\u8eab\u3092\u66f8\u304d\u63db\u3048\u305f\u308a\u6b63\u76f4\u5fae\u5999\u306a\u611f\u3058 :disappointed_relieved: \u3067\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u305d\u308c\u304c**\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u5207\u308a\u51fa\u3055\u308c\u7ba1\u7406\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3057\u305f**\u3002\n\n\u74b0\u5883\u69cb\u7bc9\u3059\u308b\u5074\u304b\u3089\u3059\u308b\u3068\u3001\u3053\u3046\u3044\u3046\u5730\u5473\u306a\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306f**\u5927\u5909\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u306d** :satisfied: \n\n"}