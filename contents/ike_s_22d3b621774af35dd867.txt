{"tags": ["AWS", "EC2", "AmazonLinux"], "context": " More than 1 year has passed since last update.\u3068\u308a\u3042\u3048\u305a\u3001EC2\u306ehosts\u3092\u307e\u3068\u3081\u3066\u3055\u3089\u3063\u3068\u66f8\u304d\u63db\u3048\u305f\u3044\u3068\u304d\u306escript\n\ngen_hosts.rb\n#!/usr/bin/ruby\n\nputs \"127.0.0.1   localhost localhost.localdomain\"\nputs \"\"\n\nSTDIN.each do | line |\n  line.chomp!\n  next if line.length == 0 || line =~ /^#/\n  remote_host, label = line.split(/\\s+/)\n  ip = `ssh #{remote_host} curl http://169.254.169.254/latest/meta-data/local-ipv4/ 2>/dev/null`\n  puts \"#{ip}\\t#{label}\"\nend\n\n\n\nupdate_hosts.sh\n#!/bin/sh\n\nif [ `id -u` -ne 0 ];then\n  echo \"error\"\n  exit\nfi\n\nBIN_PATH=`dirname $0`\necho $BIN_PATH\n\n$BIN_PATH/gen_hosts.rb  < $BIN_PATH/node_list >/etc/hosts.new\n\nif [ $? -eq 0 ]; then\n  cp /etc/hosts /etc/hosts.bak\n  mv /etc/hosts.new /etc/hosts\nelse\n  exit 1\nfi\n\nfor host_ip in `cat /etc/hosts |grep -v ^127.0.0.1 |grep -P \"^\\d+\" |awk '{print $1}'`; do\n  echo $host_ip ..\n  host_name=`cat /etc/hosts |grep ${host_ip} |awk '{print $2}'`\n  rsync -avr /etc/hosts ${host_ip}:/etc/hosts\n  ssh $host_ip \"hostname ${host_name}\"\ndone\n\n\n\nnode_list\nec2-XX-XX-XX-XX.ap-northeast-1.compute.amazonaws.com    node01\nec2-XX-XX-XX-XX.ap-northeast-1.compute.amazonaws.com    node02\n..\n\n\n\u5b9f\u884c\n$ update_hosts.sh\n\n\u3068\u308a\u3042\u3048\u305a\u3001EC2\u306ehosts\u3092\u307e\u3068\u3081\u3066\u3055\u3089\u3063\u3068\u66f8\u304d\u63db\u3048\u305f\u3044\u3068\u304d\u306escript\n\n```ruby:gen_hosts.rb\n#!/usr/bin/ruby\n\nputs \"127.0.0.1   localhost localhost.localdomain\"\nputs \"\"\n\nSTDIN.each do | line |\n  line.chomp!\n  next if line.length == 0 || line =~ /^#/\n  remote_host, label = line.split(/\\s+/)\n  ip = `ssh #{remote_host} curl http://169.254.169.254/latest/meta-data/local-ipv4/ 2>/dev/null`\n  puts \"#{ip}\\t#{label}\"\nend\n```\n\n```bash:update_hosts.sh\n#!/bin/sh\n\nif [ `id -u` -ne 0 ];then\n  echo \"error\"\n  exit\nfi\n\nBIN_PATH=`dirname $0`\necho $BIN_PATH\n\n$BIN_PATH/gen_hosts.rb  < $BIN_PATH/node_list >/etc/hosts.new\n\nif [ $? -eq 0 ]; then\n  cp /etc/hosts /etc/hosts.bak\n  mv /etc/hosts.new /etc/hosts\nelse\n  exit 1\nfi\n\nfor host_ip in `cat /etc/hosts |grep -v ^127.0.0.1 |grep -P \"^\\d+\" |awk '{print $1}'`; do\n  echo $host_ip ..\n  host_name=`cat /etc/hosts |grep ${host_ip} |awk '{print $2}'`\n  rsync -avr /etc/hosts ${host_ip}:/etc/hosts\n  ssh $host_ip \"hostname ${host_name}\"\ndone\n```\n\n```text:node_list\nec2-XX-XX-XX-XX.ap-northeast-1.compute.amazonaws.com\tnode01\nec2-XX-XX-XX-XX.ap-northeast-1.compute.amazonaws.com\tnode02\n..\n```\n\n\u5b9f\u884c\n```$ update_hosts.sh\n```\n"}