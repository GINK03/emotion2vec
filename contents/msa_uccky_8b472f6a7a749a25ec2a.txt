{"tags": ["ios7"], "context": " More than 1 year has passed since last update.\n\n\u554f\u984c\niOS 7 \u3067\u306f\u3001\u81ea\u8eab\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30ad\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3057\u305f\u6642\u3001\nUIApplicationWillResignActiveNotification / UIApplicationDidBecomeActiveNotification \u304c\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u30fb\u901a\u77e5\u3055\u308c\u306a\u3044\u3002\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5b9f\u88c5\u3057\u3066\u9077\u79fb\u3059\u308b\u305f\u3081\u306b\u547c\u3073\u51fa\u3057\u305f\u308a\u3001WebView \u3067\u8a8d\u8a3c\u3055\u305b\u3066\u308b\u5834\u5408\u306b\u5b9f\u88c5\u306b\u3088\u3063\u3066\u306f\u5f71\u97ff\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u306f\u306a\u304b\u308d\u3046\u304b\u3068\u601d\u3063\u3066\u307e\u3059\u3002\n\n\u81ea\u8eab\u3092\u547c\u3073\u51fa\u3059 (iOS 7)\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: (null), state: 0, annotation: (null)\n\n\n\u81ea\u8eab\u3092\u547c\u3073\u51fa\u3059 (iOS 8 later)\n-[AppDelegate applicationWillResignActive:] [Line 36] \n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: example.OpenURLTest, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n\n\n\u4ed6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u547c\u3073\u51fa\u3059 (iOS 7)\n-[AppDelegate applicationWillEnterForeground:] [Line 47]\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: com.apple.mobilesafari, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n\n\n\u4ed6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u547c\u3073\u51fa\u3059 (iOS 8 later)\n-[AppDelegate applicationWillEnterForeground:] [Line 47]\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: com.apple.mobilesafari, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n\n\n\n\u5bfe\u5fdc\nMethod Swizzling \u3067\u3001iOS 8 \u4ee5\u964d\u3068\u540c\u3058\u51e6\u7406\u306b\u306a\u308b\u3088\u3046 UIApplicationWillResignActiveNotification / UIApplicationDidBecomeActiveNotification \u3092\u88dc\u5b8c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nAppDelegate.m\n+ (void)initialize\n{\n    [super initialize];\n\n    static dispatch_once_t onceToken;\n    dispatch_once(&onceToken, ^{\n        if (NSOrderedAscending == [[UIDevice currentDevice].systemVersion compare:@\"8.0\"\n                                                                          options:NSNumericSearch]) {\n            Method fromMethod = class_getInstanceMethod([self class],\n                                                        @selector(application:openURL:sourceApplication:annotation:));\n            Method toMethod = class_getInstanceMethod([self class],\n                                                      @selector(iOS7_application:openURL:sourceApplication:annotation:));\n            method_exchangeImplementations(fromMethod, toMethod);\n        }\n    });\n}\n\n/**\n iOS 7 \u3067\u306f\u81ea\u8eab\u306e\u30b9\u30ad\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3057\u305f\u969b\u306b UIApplicationWillResignActiveNotification / UIApplicationDidBecomeActiveNotification \u304c\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u305f\u3081\u88dc\u5b8c\u3059\u308b\n */\n- (BOOL)iOS7_application:(UIApplication *)application\n                 openURL:(NSURL *)url\n       sourceApplication:(NSString *)sourceApplication\n              annotation:(id)annotation\n{\n    BOOL result = NO;\n    BOOL oneself = NO;\n    NSString *bundleIdentifier = sourceApplication;\n\n    // \u81ea\u8eab\u306e\u30b9\u30ad\u30fc\u30e0\u547c\u3073\u51fa\u3057\u6642\u3001sourceApplication \u304c nil \u306b\u306a\u3063\u3066\u3044\u308b\n    if (!sourceApplication || 0 == [sourceApplication length]) {\n        oneself = YES;\n        bundleIdentifier = [NSBundle mainBundle].bundleIdentifier;\n    }\n\n    // UIApplicationWillResignActiveNotification\n    if(oneself) {\n        // perform delegate\n        if([self respondsToSelector:@selector(applicationWillResignActive:)]) {\n            [self applicationWillResignActive:application];\n        }\n\n        // post notification\n        [[NSNotificationCenter defaultCenter] postNotificationName:UIApplicationWillResignActiveNotification\n                                                            object:nil];\n    }\n\n    // perform original\n    result = [self iOS7_application:application\n                            openURL:url\n                  sourceApplication:bundleIdentifier\n                         annotation:annotation];\n\n    // UIApplicationDidBecomeActiveNotification\n    if (oneself) {\n        // perform delegate\n        if([self respondsToSelector:@selector(applicationDidBecomeActive:)]) {\n            [self applicationDidBecomeActive:application];\n        }\n\n        // post notification\n        [[NSNotificationCenter defaultCenter] postNotificationName:UIApplicationDidBecomeActiveNotification\n                                                            object:nil];\n    }\n\n    return result;\n}\n\n\n\n\u8ab2\u984c\n\napplication.applicationState \u304c iOS 8 \u4ee5\u964d\u3068\u306f\u7570\u306a\u308b\n\n\n\niOS \u30d0\u30fc\u30b8\u30e7\u30f3\napplicationState\n\n\n\n\niOS 7\nUIApplicationStateActive\n\n\niOS 8 later\nUIApplicationStateInactive\n\n\n\n\u81ea\u8eab\u3092\u547c\u3073\u51fa\u3057\u305f\u6642\u306a\u306e\u3067\u6c17\u306b\u3057\u306a\u304f\u3066\u3044\u3044\u306f\u305a\u2026\u3002\n# \u554f\u984c\niOS 7 \u3067\u306f\u3001\u81ea\u8eab\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30ad\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3057\u305f\u6642\u3001\n`UIApplicationWillResignActiveNotification` / ` UIApplicationDidBecomeActiveNotification` \u304c\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u30fb\u901a\u77e5\u3055\u308c\u306a\u3044\u3002\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5b9f\u88c5\u3057\u3066\u9077\u79fb\u3059\u308b\u305f\u3081\u306b\u547c\u3073\u51fa\u3057\u305f\u308a\u3001WebView \u3067\u8a8d\u8a3c\u3055\u305b\u3066\u308b\u5834\u5408\u306b\u5b9f\u88c5\u306b\u3088\u3063\u3066\u306f\u5f71\u97ff\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u306f\u306a\u304b\u308d\u3046\u304b\u3068\u601d\u3063\u3066\u307e\u3059\u3002\n\n## \u81ea\u8eab\u3092\u547c\u3073\u51fa\u3059 (iOS 7)\n```\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: (null), state: 0, annotation: (null)\n```\n\n## \u81ea\u8eab\u3092\u547c\u3073\u51fa\u3059 (iOS 8 later)\n```\n-[AppDelegate applicationWillResignActive:] [Line 36] \n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: example.OpenURLTest, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n```\n\n## \u4ed6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u547c\u3073\u51fa\u3059 (iOS 7)\n```\n-[AppDelegate applicationWillEnterForeground:] [Line 47]\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: com.apple.mobilesafari, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n```\n\n## \u4ed6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u547c\u3073\u51fa\u3059 (iOS 8 later)\n```\n-[AppDelegate applicationWillEnterForeground:] [Line 47]\n-[AppDelegate application:openURL:sourceApplication:annotation:] [Line 28] url: openurl://, app: com.apple.mobilesafari, state: 1, annotation: (null)\n-[AppDelegate applicationDidBecomeActive:] [Line 52] \n\n```\n\n\n\n# \u5bfe\u5fdc\nMethod Swizzling \u3067\u3001iOS 8 \u4ee5\u964d\u3068\u540c\u3058\u51e6\u7406\u306b\u306a\u308b\u3088\u3046 `UIApplicationWillResignActiveNotification` / ` UIApplicationDidBecomeActiveNotification` \u3092\u88dc\u5b8c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```objc:AppDelegate.m\n+ (void)initialize\n{\n    [super initialize];\n\n    static dispatch_once_t onceToken;\n    dispatch_once(&onceToken, ^{\n        if (NSOrderedAscending == [[UIDevice currentDevice].systemVersion compare:@\"8.0\"\n                                                                          options:NSNumericSearch]) {\n            Method fromMethod = class_getInstanceMethod([self class],\n                                                        @selector(application:openURL:sourceApplication:annotation:));\n            Method toMethod = class_getInstanceMethod([self class],\n                                                      @selector(iOS7_application:openURL:sourceApplication:annotation:));\n            method_exchangeImplementations(fromMethod, toMethod);\n        }\n    });\n}\n\n/**\n iOS 7 \u3067\u306f\u81ea\u8eab\u306e\u30b9\u30ad\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3057\u305f\u969b\u306b UIApplicationWillResignActiveNotification / UIApplicationDidBecomeActiveNotification \u304c\u547c\u3073\u51fa\u3055\u308c\u306a\u3044\u305f\u3081\u88dc\u5b8c\u3059\u308b\n */\n- (BOOL)iOS7_application:(UIApplication *)application\n                 openURL:(NSURL *)url\n       sourceApplication:(NSString *)sourceApplication\n              annotation:(id)annotation\n{\n    BOOL result = NO;\n    BOOL oneself = NO;\n    NSString *bundleIdentifier = sourceApplication;\n    \n    // \u81ea\u8eab\u306e\u30b9\u30ad\u30fc\u30e0\u547c\u3073\u51fa\u3057\u6642\u3001sourceApplication \u304c nil \u306b\u306a\u3063\u3066\u3044\u308b\n    if (!sourceApplication || 0 == [sourceApplication length]) {\n        oneself = YES;\n        bundleIdentifier = [NSBundle mainBundle].bundleIdentifier;\n    }\n    \n    // UIApplicationWillResignActiveNotification\n    if(oneself) {\n        // perform delegate\n        if([self respondsToSelector:@selector(applicationWillResignActive:)]) {\n            [self applicationWillResignActive:application];\n        }\n        \n        // post notification\n        [[NSNotificationCenter defaultCenter] postNotificationName:UIApplicationWillResignActiveNotification\n                                                            object:nil];\n    }\n    \n    // perform original\n    result = [self iOS7_application:application\n                            openURL:url\n                  sourceApplication:bundleIdentifier\n                         annotation:annotation];\n    \n    // UIApplicationDidBecomeActiveNotification\n    if (oneself) {\n        // perform delegate\n        if([self respondsToSelector:@selector(applicationDidBecomeActive:)]) {\n            [self applicationDidBecomeActive:application];\n        }\n        \n        // post notification\n        [[NSNotificationCenter defaultCenter] postNotificationName:UIApplicationDidBecomeActiveNotification\n                                                            object:nil];\n    }\n    \n    return result;\n}\n```\n\n\n# \u8ab2\u984c\n## application.applicationState \u304c iOS 8 \u4ee5\u964d\u3068\u306f\u7570\u306a\u308b\n\n| iOS \u30d0\u30fc\u30b8\u30e7\u30f3 | applicationState | \n|:-----------|:------------|\n| iOS 7       |        UIApplicationStateActive | \n| iOS 8 later     |      UIApplicationStateInactive |  \n\n\u81ea\u8eab\u3092\u547c\u3073\u51fa\u3057\u305f\u6642\u306a\u306e\u3067\u6c17\u306b\u3057\u306a\u304f\u3066\u3044\u3044\u306f\u305a\u2026\u3002\n"}