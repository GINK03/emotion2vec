{"context": "\n\n\u306f\u3058\u3081\u306b\nAWS CloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u76e3\u8996\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5404\u7a2e\u60c5\u5831\u3092CloudWatch\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3078\u8ffd\u52a0\u3059\u308b\u4e8b\u3067\u3001CloudWatch\u304b\u3089EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5404\u7a2e\u60c5\u5831\u3092\u76e3\u8996\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u7a3c\u52d5\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u6570 (\u4f8b\u3048\u3070nginx\u306e\u30d7\u30ed\u30bb\u30b9\u6570)\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\n\u307e\u305a\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3078\u8ffd\u52a0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u306fGitHub\u306b\u3082\u4fdd\u5b58\u3057\u307e\u3057\u305f\u306e\u3067\u3001\u3088\u308d\u3057\u3051\u308c\u3070\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002\nhttps://github.com/na0AaooQ/aws-cloudwatch-put-ec2-metric\n\u6700\u5f8c\u306b\u3001CloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u306b\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u4f8b\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306f\u4ee5\u4e0b\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\nhttp://qiita.com/na0AaooQ/items/1fedb1d0136cd78c6aa1\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\n(1) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3001nginx\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ uname -a\nLinux cloudwatch-example-server 4.4.19-29.55.amzn1.x86_64 #1 SMP Mon Aug 29 23:29:40 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n[ec2-user@cloudwatch-example-server ~]$\n\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_process.sh\n\n\n/home/ec2-user/cloudwatch_put_process.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [ProcessName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [ProcessName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            process_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            process_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\nprocess_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${process_name}\"\nname_space=\"AmazonLinux/ProcessCount/${metric_name}\"\nunit=\"Count\"\n\n## \u30d7\u30ed\u30bb\u30b9\u6570\u3092\u53d6\u5f97\u3059\u308b\nprocess_count=`ps awux | grep -v grep | grep -v \"$0\" | grep -w \"${process_name}\" | wc -l`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/${metric_name} --namespace ${name_space} --value ${process_count} --unit ${unit}\n\n\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_process.sh\n\n\n(2) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ ps awux | grep -v grep | grep nginx\nroot      2610  0.0  0.1 109236  1960 ?        Ss   18:19   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx     2611  0.0  0.6 109676  6684 ?        S    18:19   0:00 nginx: worker process\n[ec2-user@cloudwatch-example-server ~]$\n\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_process.sh --debug nginx\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/nginx --namespace AmazonLinux/ProcessCount/nginx --value 2 --unit Count\n[ec2-user@cloudwatch-example-server ~]$\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\n(3) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_disk_use.sh\n\n\n/home/ec2-user/cloudwatch_put_disk_use.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [DiskPartitionName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [DiskPartitionName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            disk_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            disk_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndisk_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${disk_name}\"\nname_space=\"AmazonLinux/DiskUse/_${metric_name}\"\nunit=\"Percent\"\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u53d6\u5f97\u3059\u308b\ndisk_use=`df -Phl | grep -v \"Filesystem\" | grep -w \"${disk_name}\" | awk 'BEGIN{FS=\" \"}{print $5}' | sed -s 's/%//g'`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/DiskUse_${metric_name} --namespace ${name_space} --value ${disk_use} --unit ${unit}\n\n\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_disk_use.sh\n\n\n(4) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ df -Plh\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/xvda1      7.8G  1.3G  6.5G  17% /\ndevtmpfs        488M   56K  488M   1% /dev\ntmpfs           498M     0  498M   0% /dev/shm\n[ec2-user@cloudwatch-example-server ~]$\n\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_disk_use.sh --debug /\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/DiskUse_/ --namespace AmazonLinux/DiskUse/_/ --value 17 --unit Percent\n[ec2-user@cloudwatch-example-server ~]$\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\n(5) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_disk_inode_use.sh\n\n\n/home/ec2-user/cloudwatch_put_disk_inode_use.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [DiskPartitionName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [DiskPartitionName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            disk_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            disk_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndisk_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${disk_name}\"\nname_space=\"AmazonLinux/DiskInodeUse/_${metric_name}\"\nunit=\"Percent\"\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u53d6\u5f97\u3059\u308b\ndisk_inode_use=`df -Pil | grep -v \"Filesystem\" | grep -w \"${disk_name}\" | awk 'BEGIN{FS=\" \"}{print $5}' | sed -s 's/%//g'`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306bi\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/DiskInodeUse_${metric_name} --namespace ${name_space} --value ${disk_inode_use} --unit ${unit}\n\n\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_disk_inode_use.sh\n\n\n(6) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ df -Phi\nFilesystem     Inodes IUsed IFree IUse% Mounted on\n/dev/xvda1       512K   37K  476K    8% /\ndevtmpfs         122K   428  122K    1% /dev\ntmpfs            125K     1  125K    1% /dev/shm\n[ec2-user@cloudwatch-example-server ~]$\n\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_disk_inode_use.sh --debug /\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/DiskInodeUse_/ --namespace AmazonLinux/DiskInodeUse/_/ --value 8 --unit Percent\n[ec2-user@cloudwatch-example-server ~]$\n\n\ncron\u306b\u3088\u308aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u5b9a\u671f\u7684\u306b\u8ffd\u52a0\u3059\u308b\n\n(7) crontab\u306bnginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u767b\u9332\u3057\u307e\u3059\u3002\ncrontab\u30b3\u30de\u30f3\u30c9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306acron\u3092\u767b\u9332\u3059\u308b\u3068\u30015\u5206\u304a\u304d\u306bCloudWatch\u3078EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\n[ec2-user@cloudwatch-example-server ~]$ crontab -e\nMAILTO=********@example.com\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_loadaverage.sh\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_process.sh nginx\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e / \u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_disk_use.sh /\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e / \u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_disk_inode_use.sh /\n\n\nCloudWatch\u3067nginx\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u306b\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\n\n(8) CloudWatch\u3067ngxin\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001CloudWatch\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308bnginx\u30d7\u30ed\u30bb\u30b9\u6570\u304c\u76e3\u8996\u95be\u5024\u3092\u4e0b\u56de\u3063\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u306e\u505c\u6b62\u3092\u76e3\u8996\u51fa\u6765\u307e\u3059\u3002\nAWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u300cCloudWatch\u300d->\u300c\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u300d->\u300cAmazonLinux/ProcessCount/nginx\u300d->\u300ccloudwatch-example-server/nginx\u300d\u306e\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u5404\u9805\u76ee\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u304c1\u672a\u6e80\u306b\u306a\u3063\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\u5165\u529b\u304c\u7d42\u308f\u3063\u305f\u3089\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u3000\u540d\u524d: Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\u3000\u8aac\u660e: Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\u3000\u6b21\u306e\u6642: Monitoring-ProcessCount-nginx-cloudwatch-example-server \u304c : < 1 \u3092 1 \u56de\u9023\u7d9a\u3057\u305f\u5834\u5408\n\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c+ \u901a\u77e5\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u5404\u9805\u76ee\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: \u8b66\u544a\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: OK\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: \u4e0d\u8db3\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u300c\u65b0\u3057\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\u300d\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u8868\u793a\u3055\u308c\u3001Amazon SEN\u304b\u3089\u524d\u8ff0\u306e\u300c\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8\u300d\u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u300cAWS Notification - Subscription Confirmation\u300d\u3068\u3044\u3046\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u300cAWS Notification - Subscription Confirmation\u300d\u30e1\u30fc\u30eb\u672c\u6587\u4e2d\u306e\u300cConfirm subscription\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001CloudWatch\u304b\u3089\u306e\u30e1\u30fc\u30eb\u53d7\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u8a66\u3057\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u3092\u505c\u6b62\u3057\u3066\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[root@cloudwatch-example-server ~]# ps awux | grep -v grep | grep nginx\nroot     26561  0.0  0.1 109236  1960 ?        Ss   22:42   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx    26563  0.0  0.6 109676  6716 ?        S    22:42   0:00 nginx: worker process\n[root@cloudwatch-example-server ~]#\n\n[root@cloudwatch-example-server ~]# /etc/init.d/nginx stop\nStopping nginx:                                            [  OK  ]\n[root@cloudwatch-example-server ~]#\n\n[root@cloudwatch-example-server ~]# ps awux | grep -v grep | grep nginx\n[root@cloudwatch-example-server ~]#\n\n5\u5206\u7a0b\u5f85\u3064\u3068\u3001\u524d\u8ff0\u306e\u300c\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8\u300d\u3067\u6307\u5b9a\u3057\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304d\u307e\u3059\u3002\n\u3000\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u4ef6\u540d: ALARM: \"Monitoring-ProcessCount-nginx-cloudwatch-example-server\" in Asia Pacific - Tokyo\n\n\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u672c\u6587\u4f8b\nYou are receiving this email because your Amazon CloudWatch Alarm \"Monitoring-ProcessCount-nginx-cloudwatch-example-server\" in the Asia Pacific - Tokyo region has entered the ALARM state, because \"Threshold Crossed: 1 datapoint (0.0) was less than or equal to the threshold (1.0).\" at \"Sunday 18 September, 2016 13:41:55 UTC\".\n\nView this alarm in the AWS Management Console:\nhttps://console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#s=Alarms&alarm=Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\nAlarm Details:\n- Name:                       Monitoring-ProcessCount-nginx-cloudwatch-example-server\n- Description:                Monitoring-ProcessCount-nginx-cloudwatch-example-server\n- State Change:               OK -> ALARM\n- Reason for State Change:    Threshold Crossed: 1 datapoint (0.0) was less than or equal to the threshold (1.0).\n- Timestamp:                  Sunday 18 September, 2016 13:41:55 UTC\n- AWS Account:                **************\n\nThreshold:\n- The alarm is in the ALARM state when the metric is LessThanOrEqualToThreshold 1.0 for 300 seconds.\n\nMonitored Metric:\n- MetricNamespace:            AmazonLinux/ProcessCount/nginx\n- MetricName:                 cloudwatch-example-server/nginx\n- Dimensions:\n- Period:                     300 seconds\n- Statistic:                  Maximum\n- Unit:                       not specified\n\nState Change Actions:\n- OK:\n- ALARM: [arn:aws:sns:ap-northeast-1:***********:CloudWatch-Monitoring-Alert]\n- INSUFFICIENT_DATA:\n\n\n--\nIf you wish to stop receiving notifications from this topic, please click or visit the link below to unsubscribe:\nhttps://sns.ap-northeast-1.amazonaws.com/unsubscribe.html?SubscriptionArn=arn:aws:sns:ap-northeast-1:*************:CloudWatch-Monitoring-Alert:********-****-****-****-aca8dccfaff1&Endpoint=**************@gmail.com\n\nPlease do not reply directly to this email. If you have any questions or comments regarding this email, please contact us at https://aws.amazon.com/support\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\nCloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3082\u76e3\u8996\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/1fedb1d0136cd78c6aa1\n\n\u5099\u8003\nCloudWatch\u3067\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u8a2d\u5b9a\u624b\u9806\u306e\u753b\u50cf\u3092Qiita\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u753b\u50cf\u30b5\u30a4\u30ba\u30921MB\u672a\u6e80\u306b\u7e2e\u5c0f\u3057\u3066\u3082\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3001\u65b0\u898f\u753b\u50cf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u304f\u306a\u308a\u307e\u3057\u305f(\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u306a\u30b5\u30a4\u30ba\u5236\u9650\u306b\u5f15\u3063\u304b\u304b\u3063\u3066\u3057\u307e\u3063\u305f\u3088\u3046\u3067\u3059)\u3002\n\u624b\u9806\u306e\u753b\u50cf\u3092\u6b86\u3069\u63b2\u8f09\u51fa\u6765\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5206\u304b\u308a\u3065\u3089\u3044\u624b\u9806\u3067\u6e08\u307f\u307e\u305b\u3093\u3002\n![Failed to upload \"***********.JPG\": the image size Monthly limit exceeded]()\n\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n===\n\nAWS CloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u76e3\u8996\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5404\u7a2e\u60c5\u5831\u3092CloudWatch\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3078\u8ffd\u52a0\u3059\u308b\u4e8b\u3067\u3001CloudWatch\u304b\u3089EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u5404\u7a2e\u60c5\u5831\u3092\u76e3\u8996\u51fa\u6765\u307e\u3059\u3002\n\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u7a3c\u52d5\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u6570 (\u4f8b\u3048\u3070nginx\u306e\u30d7\u30ed\u30bb\u30b9\u6570)\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\n\u3000\u30fbEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\n\n\u307e\u305a\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3078\u8ffd\u52a0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306fGitHub\u306b\u3082\u4fdd\u5b58\u3057\u307e\u3057\u305f\u306e\u3067\u3001\u3088\u308d\u3057\u3051\u308c\u3070\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002\nhttps://github.com/na0AaooQ/aws-cloudwatch-put-ec2-metric\n\n\u6700\u5f8c\u306b\u3001CloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u306b\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u4f8b\u306b\u3064\u3044\u3066\u8a18\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\n===\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306f\u4ee5\u4e0b\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\n\nhttp://qiita.com/na0AaooQ/items/1fedb1d0136cd78c6aa1\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\n### (1) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u4f8b\u3067\u306f\u3001nginx\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ uname -a\nLinux cloudwatch-example-server 4.4.19-29.55.amzn1.x86_64 #1 SMP Mon Aug 29 23:29:40 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n[ec2-user@cloudwatch-example-server ~]$\n\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_process.sh\n```\n\n```bash:/home/ec2-user/cloudwatch_put_process.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [ProcessName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [ProcessName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            process_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            process_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\nprocess_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${process_name}\"\nname_space=\"AmazonLinux/ProcessCount/${metric_name}\"\nunit=\"Count\"\n\n## \u30d7\u30ed\u30bb\u30b9\u6570\u3092\u53d6\u5f97\u3059\u308b\nprocess_count=`ps awux | grep -v grep | grep -v \"$0\" | grep -w \"${process_name}\" | wc -l`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/${metric_name} --namespace ${name_space} --value ${process_count} --unit ${unit}\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_process.sh\n```\n\n### (2) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ ps awux | grep -v grep | grep nginx\nroot      2610  0.0  0.1 109236  1960 ?        Ss   18:19   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx     2611  0.0  0.6 109676  6684 ?        S    18:19   0:00 nginx: worker process\n[ec2-user@cloudwatch-example-server ~]$\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_process.sh --debug nginx\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/nginx --namespace AmazonLinux/ProcessCount/nginx --value 2 --unit Count\n[ec2-user@cloudwatch-example-server ~]$\n```\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\n### (3) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_disk_use.sh\n```\n\n```bash:/home/ec2-user/cloudwatch_put_disk_use.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [DiskPartitionName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [DiskPartitionName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            disk_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            disk_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndisk_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${disk_name}\"\nname_space=\"AmazonLinux/DiskUse/_${metric_name}\"\nunit=\"Percent\"\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u53d6\u5f97\u3059\u308b\ndisk_use=`df -Phl | grep -v \"Filesystem\" | grep -w \"${disk_name}\" | awk 'BEGIN{FS=\" \"}{print $5}' | sed -s 's/%//g'`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/DiskUse_${metric_name} --namespace ${name_space} --value ${disk_use} --unit ${unit}\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_disk_use.sh\n```\n\n### (4) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ df -Plh\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/xvda1      7.8G  1.3G  6.5G  17% /\ndevtmpfs        488M   56K  488M   1% /dev\ntmpfs           498M     0  498M   0% /dev/shm\n[ec2-user@cloudwatch-example-server ~]$\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_disk_use.sh --debug /\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/DiskUse_/ --namespace AmazonLinux/DiskUse/_/ --value 17 --unit Percent\n[ec2-user@cloudwatch-example-server ~]$\n```\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\n### (5) EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ vi /home/ec2-user/cloudwatch_put_disk_inode_use.sh\n```\n\n```bash:/home/ec2-user/cloudwatch_put_disk_inode_use.sh\n#!/bin/bash\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u306e\u8868\u793a\u3059\u308b\nfunction print_usage() {\n    echo \"Usage: $0 [DiskPartitionName]\"\n    echo \"       $0 [--help]\"\n    echo \"       $0 [--debug] [DiskPartitionName]\"\n\n    return 0\n}\n\n## \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nfunction check_parameter() {\n\n    if [ $# -ge 1 ] && [ $# -le 2 ] ; then\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --help \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u65b9\u6cd5\u3092\u8868\u793a\u3059\u308b\n        if [ $1 == \"--help\" ] ; then\n            print_usage\n            exit\n\n        ## \u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066 --debug \u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5b9f\u884c\u3059\u308baws\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u3082\u8868\u793a\u3059\u308b\n        elif [ $# -eq 2 ] && [ $1 == \"--debug\" ] ; then\n            debug_flg=\"on\"\n            disk_name=\"$2\"\n\n        elif [ $# -eq 1 ] && [ $1 == \"--debug\" ] ; then\n            print_usage\n            exit\n\n        elif [ $# -eq 1 ] ; then\n            disk_name=\"$1\"\n        fi\n\n    else\n        print_usage\n        exit\n    fi\n\n    return 0\n}\n\n## AWS CLI\u8a2d\u5b9a\nreadonly AWS_CLI=\"/usr/bin/aws\"\nreadonly AWS_CLI_REGION=\"ap-northeast-1\"\n\n## \u30c7\u30d0\u30c3\u30b0\u30d5\u30e9\u30b0\ndebug_flg=\"off\"\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndisk_name=\"\"\n\ncheck_parameter $@\n\n## CloudWatch\u306b\u8ffd\u52a0\u3059\u308b\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u540d\u3084\u5358\u4f4d\u306e\u8a2d\u5b9a\nmetric_name=\"${disk_name}\"\nname_space=\"AmazonLinux/DiskInodeUse/_${metric_name}\"\nunit=\"Percent\"\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u53d6\u5f97\u3059\u308b\ndisk_inode_use=`df -Pil | grep -v \"Filesystem\" | grep -w \"${disk_name}\" | awk 'BEGIN{FS=\" \"}{print $5}' | sed -s 's/%//g'`\n\n## AWS CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306bi\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\nif [ ${debug_flg} == \"on\" ] ; then\n    set -x\nfi\n\n${AWS_CLI} cloudwatch --region ${AWS_CLI_REGION} put-metric-data --metric-name `hostname -s`/DiskInodeUse_${metric_name} --namespace ${name_space} --value ${disk_inode_use} --unit ${unit}\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ chmod 755 /home/ec2-user/cloudwatch_put_disk_inode_use.sh\n```\n\n### (6) \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6307\u5b9a\u3057\u305f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ df -Phi\nFilesystem     Inodes IUsed IFree IUse% Mounted on\n/dev/xvda1       512K   37K  476K    8% /\ndevtmpfs         122K   428  122K    1% /dev\ntmpfs            125K     1  125K    1% /dev/shm\n[ec2-user@cloudwatch-example-server ~]$\n```\n\n```\n[ec2-user@cloudwatch-example-server ~]$ /home/ec2-user/cloudwatch_put_disk_inode_use.sh --debug /\n++ hostname -s\n+ /usr/bin/aws cloudwatch --region ap-northeast-1 put-metric-data --metric-name cloudwatch-example-server/DiskInodeUse_/ --namespace AmazonLinux/DiskInodeUse/_/ --value 8 --unit Percent\n[ec2-user@cloudwatch-example-server ~]$\n```\n\n\ncron\u306b\u3088\u308aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u5b9a\u671f\u7684\u306b\u8ffd\u52a0\u3059\u308b\n===\n\n### (7) crontab\u306bnginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\ncrontab\u30b3\u30de\u30f3\u30c9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306acron\u3092\u767b\u9332\u3059\u308b\u3068\u30015\u5206\u304a\u304d\u306bCloudWatch\u3078EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3001\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3001i\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```\n[ec2-user@cloudwatch-example-server ~]$ crontab -e\nMAILTO=********@example.com\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_loadaverage.sh\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_process.sh nginx\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e / \u306e\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u7387\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_disk_use.sh /\n\n##### EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e / \u306ei\u30ce\u30fc\u30c9\u4f7f\u7528\u7387\u3092CloudWatch\u306b\u8a18\u9332\u3059\u308b\n*/5 * * * * /home/ec2-user/cloudwatch_put_disk_inode_use.sh /\n```\n\n\nCloudWatch\u3067nginx\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u306b\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\n===\n\n### (8) CloudWatch\u3067ngxin\u30d7\u30ed\u30bb\u30b9\u304c\u505c\u6b62\u3057\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001CloudWatch\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308bnginx\u30d7\u30ed\u30bb\u30b9\u6570\u304c\u76e3\u8996\u95be\u5024\u3092\u4e0b\u56de\u3063\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u306e\u505c\u6b62\u3092\u76e3\u8996\u51fa\u6765\u307e\u3059\u3002\n\nAWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u300cCloudWatch\u300d->\u300c\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u300d->\u300cAmazonLinux/ProcessCount/nginx\u300d->\u300ccloudwatch-example-server/nginx\u300d\u306e\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n![WS000049.JPG](https://qiita-image-store.s3.amazonaws.com/0/63647/67e34dc1-11c9-0765-f2d6-3c8f607984f9.jpeg)\n\n\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u5404\u9805\u76ee\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u30d7\u30ed\u30bb\u30b9\u6570\u304c1\u672a\u6e80\u306b\u306a\u3063\u305f\u5834\u5408\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\u5165\u529b\u304c\u7d42\u308f\u3063\u305f\u3089\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u3000\u540d\u524d: Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\u3000\u8aac\u660e: Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\u3000\u6b21\u306e\u6642: Monitoring-ProcessCount-nginx-cloudwatch-example-server \u304c : < 1 \u3092 1 \u56de\u9023\u7d9a\u3057\u305f\u5834\u5408\n\n\n\u300c\u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\u300d\u753b\u9762\u3067\u300c+ \u901a\u77e5\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001\u5404\u9805\u76ee\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: \u8b66\u544a\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: OK\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\n\u3000\u30a2\u30e9\u30fc\u30e0\u304c\u6b21\u306e\u6642: \u72b6\u614b: \u4e0d\u8db3\n\u3000\u901a\u77e5\u306e\u9001\u4fe1\u5148: CloudWatch-Monitoring-Alert\n\u3000\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8: CloudWatch\u306b\u3088\u308b\u30d7\u30ed\u30bb\u30b9\u6b7b\u6d3b\u76e3\u8996\u3067\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u305f\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\n\u300c\u65b0\u3057\u3044\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\u300d\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u8868\u793a\u3055\u308c\u3001Amazon SEN\u304b\u3089\u524d\u8ff0\u306e\u300c\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8\u300d\u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u300cAWS Notification - Subscription Confirmation\u300d\u3068\u3044\u3046\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\u300cAWS Notification - Subscription Confirmation\u300d\u30e1\u30fc\u30eb\u672c\u6587\u4e2d\u306e\u300cConfirm subscription\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001CloudWatch\u304b\u3089\u306e\u30e1\u30fc\u30eb\u53d7\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n\u8a66\u3057\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306enginx\u3092\u505c\u6b62\u3057\u3066\u3001\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n[root@cloudwatch-example-server ~]# ps awux | grep -v grep | grep nginx\nroot     26561  0.0  0.1 109236  1960 ?        Ss   22:42   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx    26563  0.0  0.6 109676  6716 ?        S    22:42   0:00 nginx: worker process\n[root@cloudwatch-example-server ~]#\n\n[root@cloudwatch-example-server ~]# /etc/init.d/nginx stop\nStopping nginx:                                            [  OK  ]\n[root@cloudwatch-example-server ~]#\n\n[root@cloudwatch-example-server ~]# ps awux | grep -v grep | grep nginx\n[root@cloudwatch-example-server ~]#\n```\n\n5\u5206\u7a0b\u5f85\u3064\u3068\u3001\u524d\u8ff0\u306e\u300c\u30e1\u30fc\u30eb\u30ea\u30b9\u30c8\u300d\u3067\u6307\u5b9a\u3057\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u304c\u5c4a\u304d\u307e\u3059\u3002\n\n\u3000\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u4ef6\u540d: ALARM: \"Monitoring-ProcessCount-nginx-cloudwatch-example-server\" in Asia Pacific - Tokyo\n\n```html:\u30a2\u30e9\u30fc\u30c8\u30e1\u30fc\u30eb\u672c\u6587\u4f8b\nYou are receiving this email because your Amazon CloudWatch Alarm \"Monitoring-ProcessCount-nginx-cloudwatch-example-server\" in the Asia Pacific - Tokyo region has entered the ALARM state, because \"Threshold Crossed: 1 datapoint (0.0) was less than or equal to the threshold (1.0).\" at \"Sunday 18 September, 2016 13:41:55 UTC\".\n\nView this alarm in the AWS Management Console:\nhttps://console.aws.amazon.com/cloudwatch/home?region=ap-northeast-1#s=Alarms&alarm=Monitoring-ProcessCount-nginx-cloudwatch-example-server\n\nAlarm Details:\n- Name:                       Monitoring-ProcessCount-nginx-cloudwatch-example-server\n- Description:                Monitoring-ProcessCount-nginx-cloudwatch-example-server\n- State Change:               OK -> ALARM\n- Reason for State Change:    Threshold Crossed: 1 datapoint (0.0) was less than or equal to the threshold (1.0).\n- Timestamp:                  Sunday 18 September, 2016 13:41:55 UTC\n- AWS Account:                **************\n\nThreshold:\n- The alarm is in the ALARM state when the metric is LessThanOrEqualToThreshold 1.0 for 300 seconds.\n\nMonitored Metric:\n- MetricNamespace:            AmazonLinux/ProcessCount/nginx\n- MetricName:                 cloudwatch-example-server/nginx\n- Dimensions:\n- Period:                     300 seconds\n- Statistic:                  Maximum\n- Unit:                       not specified\n\nState Change Actions:\n- OK:\n- ALARM: [arn:aws:sns:ap-northeast-1:***********:CloudWatch-Monitoring-Alert]\n- INSUFFICIENT_DATA:\n\n\n--\nIf you wish to stop receiving notifications from this topic, please click or visit the link below to unsubscribe:\nhttps://sns.ap-northeast-1.amazonaws.com/unsubscribe.html?SubscriptionArn=arn:aws:sns:ap-northeast-1:*************:CloudWatch-Monitoring-Alert:********-****-****-****-aca8dccfaff1&Endpoint=**************@gmail.com\n\nPlease do not reply directly to this email. If you have any questions or comments regarding this email, please contact us at https://aws.amazon.com/support\n```\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3092CloudWatch\u3078\u8ffd\u52a0\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n===\n\nCloudWatch\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30fc\u30c9\u30a2\u30d9\u30ec\u30fc\u30b8\u3082\u76e3\u8996\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\nhttp://qiita.com/na0AaooQ/items/1fedb1d0136cd78c6aa1\n\n\u5099\u8003\n===\n\nCloudWatch\u3067\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u8a2d\u5b9a\u624b\u9806\u306e\u753b\u50cf\u3092Qiita\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u753b\u50cf\u30b5\u30a4\u30ba\u30921MB\u672a\u6e80\u306b\u7e2e\u5c0f\u3057\u3066\u3082\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3001\u65b0\u898f\u753b\u50cf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u306a\u304f\u306a\u308a\u307e\u3057\u305f(\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u306a\u30b5\u30a4\u30ba\u5236\u9650\u306b\u5f15\u3063\u304b\u304b\u3063\u3066\u3057\u307e\u3063\u305f\u3088\u3046\u3067\u3059)\u3002\n\u624b\u9806\u306e\u753b\u50cf\u3092\u6b86\u3069\u63b2\u8f09\u51fa\u6765\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5206\u304b\u308a\u3065\u3089\u3044\u624b\u9806\u3067\u6e08\u307f\u307e\u305b\u3093\u3002\n\n```\n![Failed to upload \"***********.JPG\": the image size Monthly limit exceeded]()\n```\n\n***\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["AWS", "CloudWatch", "Linux"]}