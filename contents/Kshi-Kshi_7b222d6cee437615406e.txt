{"context": " More than 1 year has passed since last update.\n\u7ffb\u8a33\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\n\n\nImplementing GCM Client on Chrome\n2015/06/02-05\n\n\n\n\nImplementing GCM Client on Chrome\n\n\u6982\u8981\nGCM \u306fChrome\u3092\u542b\u3080\u7570\u306a\u308b\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u305f\u3081\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\nChrome\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nChrome.GCM API \u306f Chrome apps \u307e\u305f\u306f Chrome\u62e1\u5f35 \u304c GCM\u30b5\u30fc\u30d3\u30b9\u306b\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\nAPP \u3084 \u62e1\u5f35 \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u304f\u3066\u3082Chrome.GCM API\u306f\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30ab\u30ec\u30f3\u30c0\u30fc\u30a2\u30d7\u30ea\u304c\u958b\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u3067\u3082\u30ab\u30ec\u30f3\u30c0\u30fc\u66f4\u65b0\u3055\u308c\u305f\u3053\u3068\u3092\u30e6\u30fc\u30b6\u306b\u901a\u77e5\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\u3042\u306a\u305f\u306f Google APIs \u30b5\u30fc\u30d3\u30b9\u5229\u7528\u898f\u7d04 \u3068 Google Cloud Platform \u30b5\u30fc\u30d3\u30b9\u5229\u7528\u898f\u7d04\u306e\u4e21\u65b9\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u5404\u5229\u7528\u898f\u7d04\u306b\u540c\u610f\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\nGCM\u306e\u5c0e\u5165\u306b\u306f Client\u5074\u306e\u5b9f\u88c5\u3068\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u306e\u3088\u308a\u8a73\u3057\u3044\u60c5\u5831\u306fGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nAPI Project\u3068\u8a3c\u660e\u66f8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nGoogle API Project\u3092\u4f5c\u308b\u305f\u3081\u306b\u306f\n\nGoogle Developers Console\u3092\u958b\u304d\u307e\u3059\n\u3082\u3057API Project\u3092\u4f5c\u3063\u305f\u3053\u3068\u304c\u306a\u3051\u308c\u3070\u3001\u300cCreate Project\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\nProject\u540d\u3092\u8a18\u5165\u3057\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u4e00\u5ea6\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u3001\u3042\u306a\u305f\u306eProject ID\u3068Project Number\u304c\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002Project Number: 670330094152\u306e\u3088\u3046\u306b\n4.\u3042\u306a\u305f\u306eProject Number\u3092\u66f8\u304d\u7559\u3081\u307e\u3057\u3087\u3046\u3002\u5f8c\u307b\u3069GCM Sender ID\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nGCM\u30b5\u30fc\u30d3\u30b9\u306e\u6709\u52b9\u5316\nGCM\u30b5\u30fc\u30d3\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u305f\u3081\u306b\u306f\n\n\u30b5\u30a4\u30c9\u30d0\u30fc\u5de6\u306e\u300cAPIs & auth\u300d\u3092\u9078\u629e\u3057\u307e\u3059\n\u8868\u793a\u3055\u308c\u3066\u3044\u308bAPI\u4e00\u89a7\u5185\u306e\u3001\u300cGogole Cloud Messaging for Android\u300d\u306e\u30c8\u30b0\u30eb\u3092ON\u306b\u3057\u307e\u3059\n\n\nChrome App \u307e\u305f\u306f Chrome \u62e1\u5f35\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nmanifest\u3078\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u8ffd\u52a0\nGCM\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306b\u306f 'manifest.json` \u5185\u306bGCM \u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u5ba3\u8a00\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\"permissions\": [\n  \"gcm\", ... // Other permissions, like \"storage\"\n]\n\n\u4e0b\u8a18\u52d5\u4f5c\u4e2d\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001Chrome.storage API\u3092\u901a\u3057\u3066\u30c7\u30fc\u30bf\u4fdd\u6301\u3059\u308b\u305f\u3081\u306b\u3001Storage \u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3082\u8981\u6c42\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nChrome\u30a2\u30d7\u30ea,\u62e1\u5f35\u3092\u4f5c\u308b\n\nGCM registration token\u306e\u53d6\u5f97\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u306b\u306f\u4e8b\u524d\u306bGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nchrome.gcm.register\u3092\u547c\u3073\u51fa\u3057\u3001Google Developers\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u306eProject number \u306b\u3088\u3063\u3066\u8b58\u5225\u3055\u308c\u308b\u9001\u4fe1\u5148\u30ea\u30b9\u30c8\u3092\u6e21\u3059\u3053\u3068\u3067\u5229\u7528\u6e96\u5099\u304c\u5b8c\u4e86\u3067\u3059\u3002\nChrome App\u307e\u305f\u306f\u62e1\u5f35\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u306b\u304a\u3044\u3066\u3001chrome.runtime.lastError \u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5024\u304c\u683c\u7d0d\u3055\u308c\u308b\u304b\u5426\u304b\u3067\u78ba\u8a8d\u3067\u304d\u308bGCM\u767b\u9332\u306e\u6210\u529f\u53ef\u5426\u3092\u78ba\u8a8d\u3059\u3079\u304d\u3067\u3059\u3002\n\u3082\u3057\u767b\u9332\u304c\u6210\u529f\u3057\u3066\u3044\u308c\u3070\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3067registration token\u3092\u53d7\u3051\u53d6\u308a\u3001HTTPS\u7d4c\u8def\u306a\u3069\u306e\u5b89\u5168\u306a\u65b9\u6cd5\u3067\u3042\u306a\u305f\u306e\u30b5\u30fc\u30d0\u306b\u9001\u308a\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e00\u65b9\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304cchrome.runtaime.lastError \u306b\u3088\u3063\u3066\u308f\u304b\u308b\u30a8\u30e9\u30fc\u306fGCM\u3078\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3053\u3068\u3067\u5bfe\u51e6\u3059\u3079\u304d\u3067\u3059\u3002\n\u3082\u3057\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u9001\u4fe1\u8005\u304c\u7570\u306a\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3044\u5834\u5408\u306f\u3001 \u3082\u3046\u4e00\u5ea6\u65b0\u3057\u3044\u9001\u4fe1\u8005\u30ea\u30b9\u30c8\u3068\u5171\u306bchrome.gcm.register \u3092\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u3067\u3001registration token\u304c\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002\nfunction registerCallback(registrationId) {\n  if (chrome.runtime.lastError) {\n    // When the registration fails, handle the error and retry the\n    // registration later.\n    return;\n  }\n\n  // Send the registration token to your application server.\n  sendRegistrationId(function(succeed) {\n    // Once the registration token is received by your server,\n    // set the flag such that register will not be invoked\n    // next time when the app starts up.\n    if (succeed)\n      chrome.storage.local.set({registered: true});\n  });\n}\n\nfunction sendRegistrationId(callback) {\n  // Send the registration token to your application server\n  // in a secure way.\n}\n\nchrome.runtime.onStartup.addListener(function() {\n  chrome.storage.local.get(\"registered\", function(result) {\n    // If already registered, bail out.\n    if (result[\"registered\"])\n      return;\n\n    // Up to 100 senders are allowed.\n    var senderIds = [\"Your-Sender-ID\"];\n    chrome.gcm.register(senderIds, registerCallback);\n  });\n});\n\n\n\u3082\u3057\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u7570\u306a\u308b\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u304b\u3064\u307e\u305f\u306f\u7570\u306a\u308b\u30af\u30ed\u30e0\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\n\u305d\u308c\u305e\u308c\u3001\u7570\u306a\u308bregistration token\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306f\u3000registration token\u3092\u7121\u52b9\u306b\u3059\u308b\u305f\u3081\u306b gcm.unregister \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u7121\u52b9\u5316\u51e6\u7406\u306f\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u3001\u6b21\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u304f\u306a\u3044\u6642\u3084\u3001registration token\u304c\u5371\u967a\u306b\u3055\u3089\u3055\u308c\u308b\u7591\u3044\u304c\u3042\u308b\u5834\u5408\u306a\u3069\u306e\u30ec\u30a2\u30b1\u30fc\u30b9\u306b\u306e\u307f\u3001\u884c\u3046\u3079\u304d\u3067\u3059\u3002\nfunction unregisterCallback() {\n  if (chrome.runtime.lastError) {\n    // When the unregistration fails, handle the error and retry\n    // the unregistration later.\n    return;\n  }\n}\n\nchrome.gcm.unregister(unregisterCallback);\n\n\u30e6\u30fc\u30b6\u304c\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3001\u81ea\u52d5\u7684\u306bGCM\u30b5\u30fc\u30d3\u30b9\u306e\u767b\u9332\u89e3\u9664\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\n\u30c0\u30a6\u30f3\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\n\u30b5\u30fc\u30d0\u304c\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u305f\u3044\u5834\u5408\u3001GCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b2\u7a2e\u985e\u306e\u63a5\u7d9a\u624b\u6bb5\u306e\u5185\u306e1\u3064\u3092\u7528\u3044\u3066GCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u306b\u3057\u305f\u969b\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306e\u5168\u3066\u306eChrome\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eregistration ID\u306e\u4e2d\u304b\u30891\u3064\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5c4a\u3051\u307e\u3059\u3002\nChrome\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306b\u4e00\u3064\u4ee5\u4e0a\u306eProfiles\u304c\u5165\u3063\u3066\u3044\u308bChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3067\u3082\n\u30e6\u30cb\u30fc\u30af\u306aRegistration token\u306b\u57fa\u3044\u304d\u3001\u5168\u3066\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3067\u500b\u5225\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\nchrome.gcm.onMessage event\u3092\u901a\u3057\u3066\u30b5\u30fc\u30d0\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u3042\u306a\u305f\u306f\u306eChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u3053\u306eevent\u3092\u53d7\u8a3a\u3059\u308b\u305f\u3081\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nchrome.gcm.onMessage.addListener(function(message) {\n  // A message is an object with a data property that\n  // consists of key-value pairs.\n});\n\nChrome\u304c\u52d5\u3044\u3066\u3044\u308b\u9650\u308a\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u304c\u52d5\u3044\u3066\u3044\u306a\u304f\u3066\u3082\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u9054\u3055\u308c\u308b\u305f\u3081\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n\n\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\n\u30b5\u30fc\u30d0\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306bPush\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u306b\u52a0\u3048\u3066\u3001GCM\u306fClient\u304b\u3089\u30b5\u30fc\u30d0\u306b\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\u3042\u306a\u305f\u306e\u30b5\u30fc\u30d0\u306fXMPP \u63a5\u7d9a\u30b5\u30fc\u30d0\u5b9f\u88c5\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b GCM Cloud \u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u305f\u3081\u306b\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f chrome.gcm.send \u4e0b\u8a18\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6dfb\u3048\u3066\u30b3\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nMessage ID:\n\n\n\u5931\u6557\u6642\u306b\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u3055\u308c\u914d\u9054\u3055\u308c\u308b\u969b\u306b\u7528\u3044\u308b\u5404\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u5b50\u3002Message ID\u306f\u6587\u5b57\u5217\u3067\u5b9a\u7fa9\u3055\u308c\u307e\u3059\u304c\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306e\u304c\u8d77\u52d5\u3055\u308c\u305f\u5f8c\u3082\u542b\u3081\u305f\u30e9\u30a4\u30d5\u30bf\u30a4\u30e0\u3092\u901a\u3057\u3066\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308bID\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3057\u540c\u3058Message Id\u3092\u4f7f\u3046\u3068\u3001\u4ee5\u524d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u4e0a\u66f8\u304d\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057Message Id\u4f5c\u6210\u6642\u306bAuto-increment \u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u4f7f\u308f\u308c\u3066\u3044\u305f\u5834\u5408\u4f7f\u3063\u3066\u3044\u305f\u5834\u5408\u3001\u3042\u306a\u305f\u306eChrome\u307e\u305f\u306fChrome\u62e1\u5f35\u306f chrome.storage API \u3092\u7528\u3044\u3066\u30ab\u30a6\u30f3\u30c8\u5024\u306e\u6c38\u7d9a\u5316\u3068\u30a2\u30d7\u30ea/\u62e1\u5f35\u304c\u518d\u8aad\u307f\u8fbc\u307f\u3055\u308c\u305f\u6642\u306b\u5fa9\u5143\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\nDestination ID:\n\n\n\u30b5\u30fc\u30d0\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306eID\u3002Google Developers Console \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30ca\u30f3\u30d0\u30fc\u306e\u672b\u5c3e\u306b @gcm.googleapis.com \u52a0\u3048\u305f\u3082\u306e\u3067\u3059\u3002\n\n\nData:\n\n\n4KB\u4e0a\u9650\u306eString-String\u306e\u30ad\u30fc\u30d0\u30ea\u30e5\u30fc\u306e\u914d\u5217\u3067\u69cb\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\n\n\nTTL (Time-to-live):\n\n\n\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306f0\u79d2\u304b\u308986400\u79d2(GCM\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u4fdd\u5b58\u671f\u9593\u306e\u5fdc\u7b54\u6642\u9593\u4e0a\u9650\u3068\u540c\u4e00\u306e1\u65e5)\u306e\u9593\u3067\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u6700\u5927\u5024(1\u65e5)\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3068\u3057\u3066\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002TTL\u306b0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5373\u6642\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u9001\u4fe1\u5931\u6557\u6642\u306b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7834\u68c4\u3055\u308c\u307e\u3059\u3002\n\n\n\nruntime error\u306a\u3057\u306b\u547c\u3073\u51fa\u3055\u308c\u308bchrome.gcm.send \u5185\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u969b\u3001\u65e2\u306bGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u4fe1\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3080\u3057\u308d\u30e1\u30c3\u30bb\u30fc\u30b8\u914d\u4fe1\u306e\u305f\u3081\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u3055\u308c\u305f\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306f chrome.runtime.lastError\u3092\u30c1\u30a7\u30c3\u30af\u3001\u30cf\u30f3\u30c9\u30eb\u3059\u3079\u304d\u3067\u3059\u3002\n\u8fd4\u5374\u3055\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308bError\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\nTTL\u671f\u9593\u5185\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u76ee\u7684\u306e\u30b5\u30fc\u30d0\u306b\u5230\u9054\u5931\u6557\u3059\u308b\u4f8b\u3068\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc\u8d77\u56e0\u306e\u5834\u5408\u306fchrome.gcm.onSendError\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u3042\u306a\u305f\u306eChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u30a4\u30d9\u30f3\u30c8\u3092Listen\u3057\u53cd\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002(\u305f\u3068\u3048\u3070\u3001\u518d\u9001\u4fe1\u3059\u308b\u306a\u3069)\n\u8fd4\u5374\u3055\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n// Substitute your own sender ID here. This is the project\n// number you got from the Google Developers Console.\nvar senderId = \"Your-Sender-ID\";\n\n// Make the message ID unique across the lifetime of your app.\n// One way to achieve this is to use the auto-increment counter\n// that is persisted to local storage.\n\n// Message ID is saved to and restored from local storage.\nvar messageId = 0;\nchrome.storage.local.get(\"messageId\", function(result) {\n  if (chrome.runtime.lastError)\n    return;\n  messageId = parseInt(result[\"messageId\"]);\n  if (isNaN(messageId))\n    messageId = 0;\n});\n\n// Sets up an event listener for send error.\nchrome.gcm.onSendError.addListener(sendError);\n\n// Returns a new ID to identify the message.\nfunction getMessageId() {\n  messageId++;\n  chrome.storage.local.set({messageId: messageId});\n  return messageId.toString();\n}\n\nfunction sendMessage() {\n  var message = {\n    messageId: getMessageId(),\n    destinationId: senderId + \"@gcm.googleapis.com\",\n    timeToLive: 86400,    // 1 day\n    data: {\n      \"key1\": \"value1\",\n      \"key2\": \"value2\"\n    }\n  };\n  chrome.gcm.send(message, function(messageId) {\n    if (chrome.runtime.lastError) {\n      // Some error occurred. Fail gracefully or try to send\n      // again.\n      return;\n    }\n\n    // The message has been accepted for delivery. If the message\n    // can not reach the destination, onSendError event will be\n    // fired.\n  });\n}\n\nfunction sendError(error) {\n  console.log(\"Message \" + error.messageId +\n      \" failed to be sent: \" + error.errorMessage);\n}\n\n\nAdvanced Topics\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u524a\u9664\u6642\u306e\u30a4\u30d9\u30f3\u30c8\nGCM\u306f\u30b5\u30fc\u30d0\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u9001\u4fe1\u3057\u305f\u6298\u308a\u305f\u305f\u3081\u306a\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u3092100\u500b\u4e0a\u9650\u3068\u3057\u3066\u3044\u308b\u3002\n\u305d\u306e\u5f8c\u5168\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fGCM\u304b\u3089\u524a\u9664\u3055\u308c\u3001Event chrome.gcm.onMessagesDeleted\u3000\u304c\u547c\u3070\u308c\u3001Client\u306b\u5bfe\u3057\u3066\u5931\u6557\u3057\u305f\u65e8\u3092\u77e5\u3089\u305b\u307e\u3059\u3002\nChrome App\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304c\u524a\u9664\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5fa9\u5143\u3067\u304d\u308b\u3088\u3046\u540c\u671f\u3059\u308b\u53cd\u5fdc\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nchrome.gcm.onMessagesDeleted.addListener(messagesDeleted);\n\nfunction messagesDeleted() {\n  // All messages have been discarded from GCM. Sync with\n  // your application server to recover from the situation.\n}\n\n\nCollapsible messages(\u539f\u6587)\nGCM messages are often a tickle, telling the app or extension to contact the server for fresh data.\nIn GCM, it's possible to create collapsible messages for this situation, wherein new messages replace older ones. When a collapse key is provided and multiple messages are queued up in the GCM connection servers for the same user, only the last one with any given collapse key is delivered to your app or extension.\nAs a result the message object passed to the chrome.gcm.onMessage event will contain a collapseKeyfield.\n\nError reference (\u539f\u6587)\nAn error could occur when a gcm API function is called. Your app or extension should check chrome.runtime.lastError for more information in your callback. The error code will also be passed as a parameter to chrome.gcm.onSendError event.\nHere's a brief summary of the gcm errors:\n\nFunction was called with invalid parameters: this could happen when gcm functions are called with bad parameters.\nAsynchronous operation is pending: this could happen when certain gcm function is called again without waiting for the callback passed in previous function to be called.\nNetwork error occurred: this could happen when GCM connection server fails to reach due to network problem, like losing Internet connection.\nServer error occurred: this could happen when GCM connection server fails to reach due to server problem, like server busy.\nTime-to-live exceeded: this could happen when a message could not be delivered within the specific time-to-live period.\nUnknown error occurred: this could happen due to any other internal errors.\n\n* \u7ffb\u8a33\u5bfe\u8c61\u306e\u30da\u30fc\u30b8\n  - [Implementing GCM Client on Chrome]\n(https://developers.google.com/cloud-messaging/chrome/client)\n  - 2015/06/02-05\n\n# Implementing GCM Client on Chrome\n\n### \u6982\u8981\n\nGCM \u306fChrome\u3092\u542b\u3080\u7570\u306a\u308b\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u305f\u3081\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\nChrome\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u53d7\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nChrome.GCM API \u306f Chrome apps \u307e\u305f\u306f Chrome\u62e1\u5f35 \u304c GCM\u30b5\u30fc\u30d3\u30b9\u306b\u63a5\u7d9a\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\nAPP \u3084 \u62e1\u5f35 \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u304f\u3066\u3082Chrome.GCM API\u306f\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30ab\u30ec\u30f3\u30c0\u30fc\u30a2\u30d7\u30ea\u304c\u958b\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u3067\u3082\u30ab\u30ec\u30f3\u30c0\u30fc\u66f4\u65b0\u3055\u308c\u305f\u3053\u3068\u3092\u30e6\u30fc\u30b6\u306b\u901a\u77e5\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3042\u306a\u305f\u306f Google APIs \u30b5\u30fc\u30d3\u30b9\u5229\u7528\u898f\u7d04 \u3068 Google Cloud Platform \u30b5\u30fc\u30d3\u30b9\u5229\u7528\u898f\u7d04\u306e\u4e21\u65b9\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u5404\u5229\u7528\u898f\u7d04\u306b\u540c\u610f\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\n\nGCM\u306e\u5c0e\u5165\u306b\u306f Client\u5074\u306e\u5b9f\u88c5\u3068\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u5074\u306e\u5b9f\u88c5\u306e\u3088\u308a\u8a73\u3057\u3044\u60c5\u5831\u306f[GCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066](https://developers.google.com/cloud-messaging/server)\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n# API Project\u3068\u8a3c\u660e\u66f8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\nGoogle API Project\u3092\u4f5c\u308b\u305f\u3081\u306b\u306f\n\n1. Google Developers Console\u3092\u958b\u304d\u307e\u3059\n2. \u3082\u3057API Project\u3092\u4f5c\u3063\u305f\u3053\u3068\u304c\u306a\u3051\u308c\u3070\u3001\u300cCreate Project\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\n3. Project\u540d\u3092\u8a18\u5165\u3057\u300cCreate\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u4e00\u5ea6\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u3001\u3042\u306a\u305f\u306eProject ID\u3068Project Number\u304c\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002`Project Number: 670330094152`\u306e\u3088\u3046\u306b\n4.\u3042\u306a\u305f\u306eProject Number\u3092\u66f8\u304d\u7559\u3081\u307e\u3057\u3087\u3046\u3002\u5f8c\u307b\u3069GCM Sender ID\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n## GCM\u30b5\u30fc\u30d3\u30b9\u306e\u6709\u52b9\u5316\n\nGCM\u30b5\u30fc\u30d3\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u305f\u3081\u306b\u306f\n\n1. \u30b5\u30a4\u30c9\u30d0\u30fc\u5de6\u306e\u300cAPIs & auth\u300d\u3092\u9078\u629e\u3057\u307e\u3059\n2. \u8868\u793a\u3055\u308c\u3066\u3044\u308bAPI\u4e00\u89a7\u5185\u306e\u3001\u300cGogole Cloud Messaging for Android\u300d\u306e\u30c8\u30b0\u30eb\u3092ON\u306b\u3057\u307e\u3059\n\n# Chrome App \u307e\u305f\u306f Chrome \u62e1\u5f35\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n### manifest\u3078\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u8ffd\u52a0\n\nGCM\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306b\u306f 'manifest.json` \u5185\u306bGCM \u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u5ba3\u8a00\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\n\"permissions\": [\n  \"gcm\", ... // Other permissions, like \"storage\"\n]\n```\n\n\u4e0b\u8a18\u52d5\u4f5c\u4e2d\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u306f\u3001Chrome.storage API\u3092\u901a\u3057\u3066\u30c7\u30fc\u30bf\u4fdd\u6301\u3059\u308b\u305f\u3081\u306b\u3001Storage \u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3082\u8981\u6c42\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## Chrome\u30a2\u30d7\u30ea,\u62e1\u5f35\u3092\u4f5c\u308b\n\n\n### GCM registration token\u306e\u53d6\u5f97\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u306b\u306f\u4e8b\u524d\u306bGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nchrome.gcm.register\u3092\u547c\u3073\u51fa\u3057\u3001Google Developers\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u306eProject number \u306b\u3088\u3063\u3066\u8b58\u5225\u3055\u308c\u308b\u9001\u4fe1\u5148\u30ea\u30b9\u30c8\u3092\u6e21\u3059\u3053\u3068\u3067\u5229\u7528\u6e96\u5099\u304c\u5b8c\u4e86\u3067\u3059\u3002\nChrome App\u307e\u305f\u306f\u62e1\u5f35\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u306b\u304a\u3044\u3066\u3001`chrome.runtime.lastError` \u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5024\u304c\u683c\u7d0d\u3055\u308c\u308b\u304b\u5426\u304b\u3067\u78ba\u8a8d\u3067\u304d\u308bGCM\u767b\u9332\u306e\u6210\u529f\u53ef\u5426\u3092\u78ba\u8a8d\u3059\u3079\u304d\u3067\u3059\u3002\n\u3082\u3057\u767b\u9332\u304c\u6210\u529f\u3057\u3066\u3044\u308c\u3070\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3067registration token\u3092\u53d7\u3051\u53d6\u308a\u3001HTTPS\u7d4c\u8def\u306a\u3069\u306e\u5b89\u5168\u306a\u65b9\u6cd5\u3067\u3042\u306a\u305f\u306e\u30b5\u30fc\u30d0\u306b\u9001\u308a\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e00\u65b9\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c`chrome.runtaime.lastError` \u306b\u3088\u3063\u3066\u308f\u304b\u308b\u30a8\u30e9\u30fc\u306fGCM\u3078\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u3053\u3068\u3067\u5bfe\u51e6\u3059\u3079\u304d\u3067\u3059\u3002\n\u3082\u3057\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u9001\u4fe1\u8005\u304c\u7570\u306a\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u3044\u5834\u5408\u306f\u3001 \u3082\u3046\u4e00\u5ea6\u65b0\u3057\u3044\u9001\u4fe1\u8005\u30ea\u30b9\u30c8\u3068\u5171\u306bchrome.gcm.register \u3092\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u3067\u3001registration token\u304c\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002\n\n```\nfunction registerCallback(registrationId) {\n  if (chrome.runtime.lastError) {\n    // When the registration fails, handle the error and retry the\n    // registration later.\n    return;\n  }\n\n  // Send the registration token to your application server.\n  sendRegistrationId(function(succeed) {\n    // Once the registration token is received by your server,\n    // set the flag such that register will not be invoked\n    // next time when the app starts up.\n    if (succeed)\n      chrome.storage.local.set({registered: true});\n  });\n}\n\nfunction sendRegistrationId(callback) {\n  // Send the registration token to your application server\n  // in a secure way.\n}\n\nchrome.runtime.onStartup.addListener(function() {\n  chrome.storage.local.get(\"registered\", function(result) {\n    // If already registered, bail out.\n    if (result[\"registered\"])\n      return;\n\n    // Up to 100 senders are allowed.\n    var senderIds = [\"Your-Sender-ID\"];\n    chrome.gcm.register(senderIds, registerCallback);\n  });\n});\n\n```\n\n\u3082\u3057\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u7570\u306a\u308b\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u304b\u3064\u307e\u305f\u306f\u7570\u306a\u308b\u30af\u30ed\u30e0\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\n\u305d\u308c\u305e\u308c\u3001\u7570\u306a\u308bregistration token\u304c\u53d7\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306f\u3000registration token\u3092\u7121\u52b9\u306b\u3059\u308b\u305f\u3081\u306b `gcm.unregister` \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u7121\u52b9\u5316\u51e6\u7406\u306f\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u304c\u3001\u6b21\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u305f\u304f\u306a\u3044\u6642\u3084\u3001registration token\u304c\u5371\u967a\u306b\u3055\u3089\u3055\u308c\u308b\u7591\u3044\u304c\u3042\u308b\u5834\u5408\u306a\u3069\u306e\u30ec\u30a2\u30b1\u30fc\u30b9\u306b\u306e\u307f\u3001\u884c\u3046\u3079\u304d\u3067\u3059\u3002\n\n```\nfunction unregisterCallback() {\n  if (chrome.runtime.lastError) {\n    // When the unregistration fails, handle the error and retry\n    // the unregistration later.\n    return;\n  }\n}\n\nchrome.gcm.unregister(unregisterCallback);\n```\n\n\u30e6\u30fc\u30b6\u304c\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3001\u81ea\u52d5\u7684\u306bGCM\u30b5\u30fc\u30d3\u30b9\u306e\u767b\u9332\u89e3\u9664\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\n### \u30c0\u30a6\u30f3\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u53d7\u4fe1\n\n\u30b5\u30fc\u30d0\u304c\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u305f\u3044\u5834\u5408\u3001GCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u3064\u3044\u3066\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b2\u7a2e\u985e\u306e\u63a5\u7d9a\u624b\u6bb5\u306e\u5185\u306e1\u3064\u3092\u7528\u3044\u3066GCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u306b\u3057\u305f\u969b\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306e\u5168\u3066\u306eChrome\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eregistration ID\u306e\u4e2d\u304b\u30891\u3064\u306b\u5bfe\u3057\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5c4a\u3051\u307e\u3059\u3002\nChrome\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306b\u4e00\u3064\u4ee5\u4e0a\u306eProfiles\u304c\u5165\u3063\u3066\u3044\u308bChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3067\u3082\n\u30e6\u30cb\u30fc\u30af\u306aRegistration token\u306b\u57fa\u3044\u304d\u3001\u5168\u3066\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u3067\u500b\u5225\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n`chrome.gcm.onMessage` event\u3092\u901a\u3057\u3066\u30b5\u30fc\u30d0\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u3042\u306a\u305f\u306f\u306eChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u3053\u306eevent\u3092\u53d7\u8a3a\u3059\u308b\u305f\u3081\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nchrome.gcm.onMessage.addListener(function(message) {\n  // A message is an object with a data property that\n  // consists of key-value pairs.\n});\n```\n\nChrome\u304c\u52d5\u3044\u3066\u3044\u308b\u9650\u308a\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u304c\u52d5\u3044\u3066\u3044\u306a\u304f\u3066\u3082\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u9054\u3055\u308c\u308b\u305f\u3081\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n\n### \u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\n\n\u30b5\u30fc\u30d0\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306bPush\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u306b\u52a0\u3048\u3066\u3001GCM\u306fClient\u304b\u3089\u30b5\u30fc\u30d0\u306b\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\u3042\u306a\u305f\u306e\u30b5\u30fc\u30d0\u306fXMPP \u63a5\u7d9a\u30b5\u30fc\u30d0\u5b9f\u88c5\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b GCM Cloud \u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u6e96\u5099\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u305f\u3081\u306b\u3001Chrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f `chrome.gcm.send` \u4e0b\u8a18\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6dfb\u3048\u3066\u30b3\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n* Message ID:\n  * \u5931\u6557\u6642\u306b\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u3055\u308c\u914d\u9054\u3055\u308c\u308b\u969b\u306b\u7528\u3044\u308b\u5404\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u8b58\u5225\u5b50\u3002Message ID\u306f\u6587\u5b57\u5217\u3067\u5b9a\u7fa9\u3055\u308c\u307e\u3059\u304c\u3001\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306e\u304c\u8d77\u52d5\u3055\u308c\u305f\u5f8c\u3082\u542b\u3081\u305f\u30e9\u30a4\u30d5\u30bf\u30a4\u30e0\u3092\u901a\u3057\u3066\u30e6\u30cb\u30fc\u30af\u3067\u3042\u308bID\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3057\u540c\u3058Message Id\u3092\u4f7f\u3046\u3068\u3001\u4ee5\u524d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u4e0a\u66f8\u304d\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057Message Id\u4f5c\u6210\u6642\u306bAuto-increment \u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u4f7f\u308f\u308c\u3066\u3044\u305f\u5834\u5408\u4f7f\u3063\u3066\u3044\u305f\u5834\u5408\u3001\u3042\u306a\u305f\u306eChrome\u307e\u305f\u306fChrome\u62e1\u5f35\u306f `chrome.storage API` \u3092\u7528\u3044\u3066\u30ab\u30a6\u30f3\u30c8\u5024\u306e\u6c38\u7d9a\u5316\u3068\u30a2\u30d7\u30ea/\u62e1\u5f35\u304c\u518d\u8aad\u307f\u8fbc\u307f\u3055\u308c\u305f\u6642\u306b\u5fa9\u5143\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n* Destination ID:\n  * \u30b5\u30fc\u30d0\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306eID\u3002Google Developers Console \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30ca\u30f3\u30d0\u30fc\u306e\u672b\u5c3e\u306b `@gcm.googleapis.com` \u52a0\u3048\u305f\u3082\u306e\u3067\u3059\u3002\n* Data:\n  * 4KB\u4e0a\u9650\u306eString-String\u306e\u30ad\u30fc\u30d0\u30ea\u30e5\u30fc\u306e\u914d\u5217\u3067\u69cb\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\n* TTL (Time-to-live):\n  * \u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306f0\u79d2\u304b\u308986400\u79d2(GCM\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u4fdd\u5b58\u671f\u9593\u306e\u5fdc\u7b54\u6642\u9593\u4e0a\u9650\u3068\u540c\u4e00\u306e1\u65e5)\u306e\u9593\u3067\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057\u3053\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u6700\u5927\u5024(1\u65e5)\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3068\u3057\u3066\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002TTL\u306b0\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u5373\u6642\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a66\u307f\u307e\u3059\u304c\u3001\u9001\u4fe1\u5931\u6557\u6642\u306b\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7834\u68c4\u3055\u308c\u307e\u3059\u3002\n\nruntime error\u306a\u3057\u306b\u547c\u3073\u51fa\u3055\u308c\u308b`chrome.gcm.send` \u5185\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u969b\u3001\u65e2\u306bGCM\u63a5\u7d9a\u30b5\u30fc\u30d0\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u914d\u4fe1\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3080\u3057\u308d\u30e1\u30c3\u30bb\u30fc\u30b8\u914d\u4fe1\u306e\u305f\u3081\u30ad\u30e5\u30fc\u30a4\u30f3\u30b0\u3055\u308c\u305f\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u307e\u305f\u306f\u62e1\u5f35\u306f `chrome.runtime.lastError`\u3092\u30c1\u30a7\u30c3\u30af\u3001\u30cf\u30f3\u30c9\u30eb\u3059\u3079\u304d\u3067\u3059\u3002\n\u8fd4\u5374\u3055\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308bError\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nTTL\u671f\u9593\u5185\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u76ee\u7684\u306e\u30b5\u30fc\u30d0\u306b\u5230\u9054\u5931\u6557\u3059\u308b\u4f8b\u3068\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc\u8d77\u56e0\u306e\u5834\u5408\u306f`chrome.gcm.onSendError`\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u3042\u306a\u305f\u306eChrome\u30a2\u30d7\u30ea\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u30a4\u30d9\u30f3\u30c8\u3092Listen\u3057\u53cd\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002(\u305f\u3068\u3048\u3070\u3001\u518d\u9001\u4fe1\u3059\u308b\u306a\u3069)\n\u8fd4\u5374\u3055\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n```\n// Substitute your own sender ID here. This is the project\n// number you got from the Google Developers Console.\nvar senderId = \"Your-Sender-ID\";\n\n// Make the message ID unique across the lifetime of your app.\n// One way to achieve this is to use the auto-increment counter\n// that is persisted to local storage.\n\n// Message ID is saved to and restored from local storage.\nvar messageId = 0;\nchrome.storage.local.get(\"messageId\", function(result) {\n  if (chrome.runtime.lastError)\n    return;\n  messageId = parseInt(result[\"messageId\"]);\n  if (isNaN(messageId))\n    messageId = 0;\n});\n\n// Sets up an event listener for send error.\nchrome.gcm.onSendError.addListener(sendError);\n\n// Returns a new ID to identify the message.\nfunction getMessageId() {\n  messageId++;\n  chrome.storage.local.set({messageId: messageId});\n  return messageId.toString();\n}\n\nfunction sendMessage() {\n  var message = {\n    messageId: getMessageId(),\n    destinationId: senderId + \"@gcm.googleapis.com\",\n    timeToLive: 86400,    // 1 day\n    data: {\n      \"key1\": \"value1\",\n      \"key2\": \"value2\"\n    }\n  };\n  chrome.gcm.send(message, function(messageId) {\n    if (chrome.runtime.lastError) {\n      // Some error occurred. Fail gracefully or try to send\n      // again.\n      return;\n    }\n\n    // The message has been accepted for delivery. If the message\n    // can not reach the destination, onSendError event will be\n    // fired.\n  });\n}\n\nfunction sendError(error) {\n  console.log(\"Message \" + error.messageId +\n      \" failed to be sent: \" + error.errorMessage);\n}\n```\n\n## Advanced Topics\n\n### \u30e1\u30c3\u30bb\u30fc\u30b8\u524a\u9664\u6642\u306e\u30a4\u30d9\u30f3\u30c8\n\nGCM\u306f\u30b5\u30fc\u30d0\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u9001\u4fe1\u3057\u305f\u6298\u308a\u305f\u305f\u3081\u306a\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u3092100\u500b\u4e0a\u9650\u3068\u3057\u3066\u3044\u308b\u3002\n\u305d\u306e\u5f8c\u5168\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306fGCM\u304b\u3089\u524a\u9664\u3055\u308c\u3001Event `chrome.gcm.onMessagesDeleted`\u3000\u304c\u547c\u3070\u308c\u3001Client\u306b\u5bfe\u3057\u3066\u5931\u6557\u3057\u305f\u65e8\u3092\u77e5\u3089\u305b\u307e\u3059\u3002\nChrome App\u307e\u305f\u306fChrome\u62e1\u5f35\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u304c\u524a\u9664\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5fa9\u5143\u3067\u304d\u308b\u3088\u3046\u540c\u671f\u3059\u308b\u53cd\u5fdc\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nchrome.gcm.onMessagesDeleted.addListener(messagesDeleted);\n\nfunction messagesDeleted() {\n  // All messages have been discarded from GCM. Sync with\n  // your application server to recover from the situation.\n}\n```\n\n### Collapsible messages(\u539f\u6587)\n\nGCM messages are often a tickle, telling the app or extension to contact the server for fresh data.\n\nIn GCM, it's possible to create collapsible messages for this situation, wherein new messages replace older ones. When a collapse key is provided and multiple messages are queued up in the GCM connection servers for the same user, only the last one with any given collapse key is delivered to your app or extension.\n\nAs a result the message object passed to the chrome.gcm.onMessage event will contain a collapseKeyfield.\n\n## Error reference (\u539f\u6587)\n\nAn error could occur when a gcm API function is called. Your app or extension should check chrome.runtime.lastError for more information in your callback. The error code will also be passed as a parameter to chrome.gcm.onSendError event.\n\nHere's a brief summary of the gcm errors:\n\n* Function was called with invalid parameters: this could happen when gcm functions are called with bad parameters.\n* Asynchronous operation is pending: this could happen when certain gcm function is called again without waiting for the callback passed in previous function to be called.\n* Network error occurred: this could happen when GCM connection server fails to reach due to network problem, like losing Internet connection.\n* Server error occurred: this could happen when GCM connection server fails to reach due to server problem, like server busy.\n* Time-to-live exceeded: this could happen when a message could not be delivered within the specific time-to-live period.\n* Unknown error occurred: this could happen due to any other internal errors.\n", "tags": ["GCM", "Chrome"]}