{"context": "\n\n\u4f7f\u3046\u3082\u306e\n\nGoogle SpreadSheet\nGoogle Apps Script\nChoregraphe\nPepper\n\n\n\u8aac\u660e\nPepper\u306e\u53f0\u672c\u3092\u4f5c\u308b\u6642\u3001Excel\u7b49\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u8907\u6570\u4eba\u3067\u958b\u767a\u3059\u308b\u6642\u3084\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u5834\u6240\u3092\u9078\u3070\u305a\u306b\u4f5c\u308a\u305f\u3044\u306e\u3067Google SpreadSheet\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u50d5\u306f\u4f1a\u8a71\u306e\u8abf\u6574\u3092\u884c\u3063\u305f\u3082\u306e\u3082\u53f0\u672c\u306b\u4e00\u7dd2\u306b\u5165\u529b\u3057\u3066\u4fdd\u5b58\u3057\u3066\u304a\u304f\u306e\u3067\u3044\u3061\u3044\u3061\u30b3\u30d4\u30da\u3057\u305f\u308a\u3001\u914d\u5e03\u6e08\u307f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u304b\u3051\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u53f0\u672c\u304b\u3089\u305d\u306e\u307e\u307e\u8aad\u307f\u8fbc\u3080\u4e8b\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u306e\u3067\u3001\u30e1\u30e2\u3068\u3057\u3066\u5404\u9805\u76ee\u6bce\u306b\u8a18\u8f09\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nGoogle SpreadSheet\n\u50d5\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u53f0\u672c\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u5de6\u304b\u3089\n\nID\n\u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u306e\u540d\u524d\n\u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u306b\u8868\u793a\u3059\u308b\u30da\u30fc\u30b8\u306e\u540d\u524d\n\u6761\u4ef6\n\u30dc\u30bf\u30f3\n\u30e2\u30fc\u30b7\u30e7\u30f3\u306e\u756a\u53f7\u3084\u7a2e\u985e\n\u30bb\u30ea\u30d5\uff08\u4eba\u8a9e\uff09\n\u30bb\u30ea\u30d5\uff08\u307a\u30d1\u8a9e\uff09\n\n\u30b9\u30ad\u30eb\u306e\u5185\u5bb9\u306b\u3088\u3063\u3066\u9805\u76ee\u306f\u591a\u5c11\u5909\u308f\u3063\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u57fa\u672c\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u53f0\u672c\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\u53f0\u672c\u3092\u4f5c\u3063\u305f\u3089SpreadSheet\u306eURL\u306e\u4e2d\u306b\u3042\u308b\u300chttps : //docs.google.com/spreadsheets/d/\u300d\u306e\u5f8c\u306b\u3042\u308b\u300cXXXXXXXXXXXXXXXX(Book ID)\u300d\u3068\u305d\u306e\u5f8c\u306b\u3042\u308b\u300c/edit#gid=\u300d\u306e\u5f8c\u308d\u306e\u6570\u5b57\u300c1234567(Sheet ID)\u300d\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u308c\u3089\u306fChoregraphe\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u6642\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nGoogle Apps Script\n\nSayText.gs\n//\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u6642\u306b\u9001\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nvar managerAddr = \"hoge@xxxx.co.jp\";\n\n\nfunction doGet(e) {\n  //param1\u3068\u3044\u3046\u540d\u524d\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308b\u3002\n  var json = JSON.parse(e.parameter.param1);\n  //\u30d1\u30e9\u30e1\u30fc\u30bf\u306eBookID\u306e\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3092\u958b\u304f\n  var ss = SpreadsheetApp.openById(decodeURI(json[\"sayDb_id\"]));\n  //\u958b\u3044\u305f\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u3042\u308b\u30b7\u30fc\u30c8\u53d6\u5f97\n  var sheets = ss.getSheets();\n\n  for (var i in sheets){\n    var sheet = sheets[i];\n    //\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8ID\u3092\u898b\u3064\u3051\u305f\u3089\u51e6\u7406\u3092\u958b\u59cb\n    if (sheet.getSheetId() == json[\"db_id\"]){\n      var say_txt = getSayTxt(sheet);\n    }\n  }\n  //json\u3067\u8fd4\u3059\n  return ContentService.createTextOutput(JSON.stringify(say_txt)).setMimeType(ContentService.MimeType.JSON);\n}\n\nfunction getSayTxt(sheet) {\n  var sCol = 1;\n  var sRow = 2;\n  var lRow = sheet.getLastRow();\n\n  //1\u884c\u76ee\u304c\"id\"\u3068\u3044\u3046\u540d\u524d\u304c\u3064\u3044\u3066\u308b\u5217\u3092\u63a2\u3059\n  var sayIdCol = getSayTxtCol(sheet, \"id\");\n  //\u540c\u69d8\u306b\"pepaLanguage\"\u3068\u3044\u3046\u540d\u524d\u304c\u3064\u3044\u3066\u308b\u5217\u3092\u63a2\u3059\n  var sayTxtCol = getSayTxtCol(sheet, \"pepaLanguage\");\n  //\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3089\u30a8\u30e9\u30fc\u3067\u8fd4\u3059\u3002\n  if (sayTxtCol == 0 || sayIdCol == 0){\n    GMailApp.sendMail(managerAddr, \"getSay\u5b9f\u884c\u6642\", \"\u5217\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u30b7\u30fc\u30c8\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\" + sheet.getSheetId());\n    Logger.log(\"Columns is not found\");\n    return [];\n  }\n\n  //\"id\"\u3068\"pepaLanguage\"\u306e\u4f4d\u7f6e\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u308b\u3002\n  if (sayIdCol > sayTxtCol){\n    var data = sheet.getRange(sRow, sayTxtCol, lRow, sayIdCol).getValues();\n  }else{\n    var data = sheet.getRange(sRow, sayIdCol, lRow, sayTxtCol).getValues();\n  }\n  var json = new Object();\n  var jsonArray = [];\n  //\u8ffd\u52a0\u3057\u3066\u3044\u304f\n  for (var i = 0; i < data.length -1; i++){\n    var val = data[i][sayIdCol - 1];\n    if (val != \"\" && val != null){\n      json[String(data[i][sayIdCol - 1])] = data[i][sayTxtCol - 1];\n    }\n  }\n  jsonArray.push(json);\n  return jsonArray;\n}\n\nfunction getSayTxtCol(sheet, title){\n  var lCol = sheet.getLastColumn();\n  for (var i = 1; i <= lCol; i++){\n    if (sheet.getRange(1, i).getValue() == title){\n      return i;\n      break;\n    }\n  }\n  return 0;\n}\n\n\n\nChoregraphe (Python)\nPython\u306e\u65b9\u306f\u898b\u308c\u3070\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nLoadSayText.py\nclass MyClass(GeneratedClass):\n    def __init__(self):\n        GeneratedClass.__init__(self)\n\n    def onLoad(self):\n        self.memory = ALProxy(\"ALMemory\")\n\n    def onUnload(self):\n        self.memory = None\n\n    def onInput_onStart(self):\n        import urllib, urllib2, json\n        #\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f5c\u308b\u3002\n        #\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u5185\u3067\u306f\u30e1\u30e2\u30ea\u3067\u6e21\u3057\u3066\u308b\u3002\n        p = {\n            \"sayDb_id\":XXXXXXXXXXXXXXXX(Book ID),\n            \"db_id\":1234567(Sheet ID)\n            }\n        data ={}\n\n        try:\n            data['param1'] = json.dumps(p)\n            url_values = urllib.urlencode(data)\n            full_url = '%s?%s' % url(api\u306eURL), url_values)\n            request = urllib2.urlopen(full_url)\n            self.json = json.loads(request.read(), \"utf-8\")[0]\n\n            if len(self.json) == 0:\n                self.onNotFound()\n                return\n            #\u8fd4\u3063\u3066\u304d\u305f\u5024\u3092\u30e1\u30e2\u30ea\u306b\u4fdd\u5b58\u3059\u308b\u3002\n            #\u4fdd\u5b58\u3057\u305fText\u306fSayBox\u3067\u547c\u3073\u51fa\u3057\u3066\u558b\u3089\u305b\u308b\u3002\n            for key, value in self.json.items():\n                self.memory.insertData(\"SayText/%d\" % int(key), value.encode('utf-8'))\n            self.onStopped()\n        except Exception as e:\n            self.logger.warn('==========\u30a8\u30e9\u30fc\u5185\u5bb9==========')\n            self.logger.warn(e)\n            self.logger.warn('============================')\n            self.onError()\n\n\n\n\u7d42\u308f\u308a\n\u66f8\u3044\u3066\u3066\u3061\u3087\u3063\u3068\u30a8\u30e9\u30fc\u304c\u8d77\u3053\u308a\u305d\u3046\u306a\u3068\u3053\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n# \u4f7f\u3046\u3082\u306e\n- Google SpreadSheet\n- Google Apps Script\n- Choregraphe\n- Pepper\n\n# \u8aac\u660e\nPepper\u306e\u53f0\u672c\u3092\u4f5c\u308b\u6642\u3001Excel\u7b49\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u8907\u6570\u4eba\u3067\u958b\u767a\u3059\u308b\u6642\u3084\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u5834\u6240\u3092\u9078\u3070\u305a\u306b\u4f5c\u308a\u305f\u3044\u306e\u3067Google SpreadSheet\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u50d5\u306f\u4f1a\u8a71\u306e\u8abf\u6574\u3092\u884c\u3063\u305f\u3082\u306e\u3082\u53f0\u672c\u306b\u4e00\u7dd2\u306b\u5165\u529b\u3057\u3066\u4fdd\u5b58\u3057\u3066\u304a\u304f\u306e\u3067\u3044\u3061\u3044\u3061\u30b3\u30d4\u30da\u3057\u305f\u308a\u3001\u914d\u5e03\u6e08\u307f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u304b\u3051\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u53f0\u672c\u304b\u3089\u305d\u306e\u307e\u307e\u8aad\u307f\u8fbc\u3080\u4e8b\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u306e\u3067\u3001\u30e1\u30e2\u3068\u3057\u3066\u5404\u9805\u76ee\u6bce\u306b\u8a18\u8f09\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n## Google SpreadSheet\n\n\u50d5\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u53f0\u672c\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"1657\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-23 22.07.31.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/56585/bda3f0f0-611b-1802-836f-8376fd1b659e.png\">\n\n\n\u5de6\u304b\u3089\n\n1. ID\n- \u30c0\u30a4\u30a2\u30ed\u30b0\u30dc\u30c3\u30af\u30b9\u306e\u540d\u524d\n- \u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u306b\u8868\u793a\u3059\u308b\u30da\u30fc\u30b8\u306e\u540d\u524d\n- \u6761\u4ef6\n- \u30dc\u30bf\u30f3\n- \u30e2\u30fc\u30b7\u30e7\u30f3\u306e\u756a\u53f7\u3084\u7a2e\u985e\n- \u30bb\u30ea\u30d5\uff08\u4eba\u8a9e\uff09\n- \u30bb\u30ea\u30d5\uff08\u307a\u30d1\u8a9e\uff09\n\n\u30b9\u30ad\u30eb\u306e\u5185\u5bb9\u306b\u3088\u3063\u3066\u9805\u76ee\u306f\u591a\u5c11\u5909\u308f\u3063\u305f\u308a\u3059\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u57fa\u672c\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u53f0\u672c\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\u53f0\u672c\u3092\u4f5c\u3063\u305f\u3089SpreadSheet\u306eURL\u306e\u4e2d\u306b\u3042\u308b\u300c**https : //docs.google.com/spreadsheets/d/**\u300d\u306e\u5f8c\u306b\u3042\u308b\u300c**XXXXXXXXXXXXXXXX(Book ID)**\u300d\u3068\u305d\u306e\u5f8c\u306b\u3042\u308b\u300c**/edit#gid=**\u300d\u306e\u5f8c\u308d\u306e\u6570\u5b57\u300c**1234567(Sheet ID)**\u300d\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u308c\u3089\u306fChoregraphe\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u6642\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n## Google Apps Script\n\n```js:SayText.gs\n//\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u305f\u6642\u306b\u9001\u308b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nvar managerAddr = \"hoge@xxxx.co.jp\";\n\n\nfunction doGet(e) {\n  //param1\u3068\u3044\u3046\u540d\u524d\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308b\u3002\n  var json = JSON.parse(e.parameter.param1);\n  //\u30d1\u30e9\u30e1\u30fc\u30bf\u306eBookID\u306e\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3092\u958b\u304f\n  var ss = SpreadsheetApp.openById(decodeURI(json[\"sayDb_id\"]));\n  //\u958b\u3044\u305f\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u3042\u308b\u30b7\u30fc\u30c8\u53d6\u5f97\n  var sheets = ss.getSheets();\n  \n  for (var i in sheets){\n    var sheet = sheets[i];\n    //\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8ID\u3092\u898b\u3064\u3051\u305f\u3089\u51e6\u7406\u3092\u958b\u59cb\n    if (sheet.getSheetId() == json[\"db_id\"]){\n      var say_txt = getSayTxt(sheet);\n    }\n  }\n  //json\u3067\u8fd4\u3059\n  return ContentService.createTextOutput(JSON.stringify(say_txt)).setMimeType(ContentService.MimeType.JSON);\n}\n\nfunction getSayTxt(sheet) {\n  var sCol = 1;\n  var sRow = 2;\n  var lRow = sheet.getLastRow();\n  \n  //1\u884c\u76ee\u304c\"id\"\u3068\u3044\u3046\u540d\u524d\u304c\u3064\u3044\u3066\u308b\u5217\u3092\u63a2\u3059\n  var sayIdCol = getSayTxtCol(sheet, \"id\");\n  //\u540c\u69d8\u306b\"pepaLanguage\"\u3068\u3044\u3046\u540d\u524d\u304c\u3064\u3044\u3066\u308b\u5217\u3092\u63a2\u3059\n  var sayTxtCol = getSayTxtCol(sheet, \"pepaLanguage\");\n  //\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3089\u30a8\u30e9\u30fc\u3067\u8fd4\u3059\u3002\n  if (sayTxtCol == 0 || sayIdCol == 0){\n    GMailApp.sendMail(managerAddr, \"getSay\u5b9f\u884c\u6642\", \"\u5217\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u30b7\u30fc\u30c8\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\" + sheet.getSheetId());\n    Logger.log(\"Columns is not found\");\n    return [];\n  }\n  \n  //\"id\"\u3068\"pepaLanguage\"\u306e\u4f4d\u7f6e\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u308b\u3002\n  if (sayIdCol > sayTxtCol){\n    var data = sheet.getRange(sRow, sayTxtCol, lRow, sayIdCol).getValues();\n  }else{\n    var data = sheet.getRange(sRow, sayIdCol, lRow, sayTxtCol).getValues();\n  }\n  var json = new Object();\n  var jsonArray = [];\n  //\u8ffd\u52a0\u3057\u3066\u3044\u304f\n  for (var i = 0; i < data.length -1; i++){\n    var val = data[i][sayIdCol - 1];\n    if (val != \"\" && val != null){\n      json[String(data[i][sayIdCol - 1])] = data[i][sayTxtCol - 1];\n    }\n  }\n  jsonArray.push(json);\n  return jsonArray;\n}\n  \nfunction getSayTxtCol(sheet, title){\n  var lCol = sheet.getLastColumn();\n  for (var i = 1; i <= lCol; i++){\n    if (sheet.getRange(1, i).getValue() == title){\n      return i;\n      break;\n    }\n  }\n  return 0;\n}\n```\n\n## Choregraphe (Python)\nPython\u306e\u65b9\u306f\u898b\u308c\u3070\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```py:LoadSayText.py\nclass MyClass(GeneratedClass):\n    def __init__(self):\n        GeneratedClass.__init__(self)\n\n    def onLoad(self):\n        self.memory = ALProxy(\"ALMemory\")\n\n    def onUnload(self):\n        self.memory = None\n\n    def onInput_onStart(self):\n        import urllib, urllib2, json\n        #\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f5c\u308b\u3002\n        #\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u5185\u3067\u306f\u30e1\u30e2\u30ea\u3067\u6e21\u3057\u3066\u308b\u3002\n        p = {\n            \"sayDb_id\":XXXXXXXXXXXXXXXX(Book ID),\n            \"db_id\":1234567(Sheet ID)\n            }\n        data ={}\n\n        try:\n            data['param1'] = json.dumps(p)\n            url_values = urllib.urlencode(data)\n            full_url = '%s?%s' % url(api\u306eURL), url_values)\n            request = urllib2.urlopen(full_url)\n            self.json = json.loads(request.read(), \"utf-8\")[0]\n\n            if len(self.json) == 0:\n                self.onNotFound()\n                return\n            #\u8fd4\u3063\u3066\u304d\u305f\u5024\u3092\u30e1\u30e2\u30ea\u306b\u4fdd\u5b58\u3059\u308b\u3002\n            #\u4fdd\u5b58\u3057\u305fText\u306fSayBox\u3067\u547c\u3073\u51fa\u3057\u3066\u558b\u3089\u305b\u308b\u3002\n            for key, value in self.json.items():\n                self.memory.insertData(\"SayText/%d\" % int(key), value.encode('utf-8'))\n            self.onStopped()\n        except Exception as e:\n            self.logger.warn('==========\u30a8\u30e9\u30fc\u5185\u5bb9==========')\n            self.logger.warn(e)\n            self.logger.warn('============================')\n            self.onError()\n```\n\n### \u7d42\u308f\u308a\n\u66f8\u3044\u3066\u3066\u3061\u3087\u3063\u3068\u30a8\u30e9\u30fc\u304c\u8d77\u3053\u308a\u305d\u3046\u306a\u3068\u3053\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n", "tags": ["Pepper", "GoogleAppsScript", "GoogleSpreadSheet", "Choregraphe", "Python"]}