{"context": " More than 1 year has passed since last update.Rails 5\u306e\u76ee\u7389\u6a5f\u80fd\u306e\u4e00\u3064\u306b\u3001WebSockets\u3092\u5bb9\u6613\u306b\u5229\u7528\u3067\u304d\u308bActionCable\u304c\u3042\u308a\u307e\u3059\u3002Rails 4\u3067\u3082gem\u3067\u63d0\u4f9b\u3055\u308c\u3066\u307e\u3057\u305f\u304c\u3001Rails 5\u3067\u672c\u4f53\u306b\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u672c\u756a\u74b0\u5883\u306e\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u8a18\u4e8b\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002ActionCable\u3092\u4f7f\u3063\u305fRails 5\u30a2\u30d7\u30ea\u306f\u3001\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u3002\n\nRails 5 + ActionCable\u3067\u4f5c\u308b\uff01\u30b7\u30f3\u30d7\u30eb\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\uff08DHH\u6c0f\u306e\u30c7\u30e2\u52d5\u753b\u3088\u308a\uff09\n\n\u3053\u306e\u4f8b\u3067\u306fdevelopment\u74b0\u5883\u304a\u3088\u3073Heroku\u3067\u306f\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u3053\u306e\u8a18\u4e8b\u306f\u672c\u756a\u74b0\u5883\u306enginx\u3092\u81ea\u524d\u3067\u8a2d\u5b9a\u3057\u3066\u3086\u304d\u307e\u3059\u3002\n\n \u52d5\u4f5c\u74b0\u5883\u3068\u69cb\u6210\n\u30d5\u30ed\u30f3\u30c8\u306eWeb\u30b5\u30fc\u30d0\u306b\u306fnginx\u3092\u3001Rack\u30b5\u30fc\u30d0\u306b\u306fPuma\u3092\u4f7f\u3044\u3001Capistrano3\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002Unicorn\u3092Rack\u30b5\u30fc\u30d0\u306b\u4f7f\u3046\u3068\u3001WebSockets\u30b5\u30fc\u30d0\u3082\u5225\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u4eca\u56de\u306fPuma\u3092\u4f7f\u3044\u307e\u3059\u3002Puma\u3068nginx\u306e\u51e6\u7406\u306f puma.sock \u7d4c\u7531\u3067\u884c\u3044\u307e\u3059\u3002\u30c7\u30d7\u30ed\u30a4\u304a\u3088\u3073Puma\u306e\u5236\u5fa1\u306b\u306fCapistrano\u3092\u4f7f\u3044\u307e\u3059\u3002\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u306b\u306f\u3001jungle\u307e\u305f\u306fsystemd\u306e\u8a2d\u5b9a\u3092\u81ea\u524d\u3067\u7528\u610f\u3059\u308c\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u89e6\u308c\u307e\u305b\u3093\u3002\nActionCable\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u5f93\u3044/cable\u3092WebSockets\u306e\u30d1\u30b9\u306b\u3001\u3064\u307e\u308aws://your-domain.example.com/cable\uff08\u307e\u305f\u306fwss://your-domain.example.com/cable\uff09\u304b\u3089WebSockets\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\nRails\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\n\u307e\u305aRails\u30a2\u30d7\u30ea\u5074\u3067\u3001ActionCable\u304c\u8a31\u53ef\u3059\u308b\u30db\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002nginx\u3068Rails\u30a2\u30d7\u30ea\u304c\u540c\u30b5\u30fc\u30d0\u4e0a\u3067\u3082\u3001\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u3092\u8a31\u53ef\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff08Allowed Request Origins\uff09\u3002\n\nconfig/environments/production.rb\nconfig.action_cable.allowed_request_origins = [ 'https://your-domain.example.com' ]\n\n\n\nCapistrano\u306e\u8a2d\u5b9a\u3068\u30c7\u30d7\u30ed\u30a4\ncapistrano-puma\u3068\u3044\u3046gem\u3092\u4f7f\u3046\u3068\u3001\u30b5\u30fc\u30d0\u5074\u306epuma\u3092\u624b\u5143\u304b\u3089\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002Gemfile \u306b capistrano3-puma \uff08capistrano-puma \u306f\u5225\u306egem\u306a\u3044\u306e\u3067\u6ce8\u610f\uff01\uff09\u3092\u8ffd\u52a0\u3057\u3066\u3001Capfile \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nGemfile\ngem 'capistrano3-puma' , group: :development\n\n\n\nCapfile\nrequire 'capistrano/puma'\n\n\n\u4ee5\u4e0a\u3067Capistrano\u7d4c\u7531\u3067\u672c\u756a\u74b0\u5883\u306epuma\u3092\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n(bundle exec) cap production puma:start\n\n\u3053\u306e\u6642 puma:config \u30bf\u30b9\u30af\u304c\u8d70\u308a\u3001puma\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u30c7\u30d7\u30ed\u30a4\u5148\u306e \"#{shared_path}/puma.rb\" \u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002puma\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f config/deploy.rb \u3092\u5143\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u8a2d\u5b9a\u9805\u76ee\u306fcapistrano-puma\u306eREADME\u306b\u3042\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001puma\u306esock\u30d5\u30a1\u30a4\u30eb\u304c \"#{shared_path}/tmp/sockets/puma.sock\" \u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\u3064\u307e\u308a puma:start \u3092\u8d70\u3089\u305b\u308b\u3068\"#{shared_path}/tmp/sockets/puma.sock\" \u8d8a\u3057\u306bRails\u30a2\u30d7\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u306e\u3067\u3001nginx\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u306b\u884c\u304f\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nnginx\u306e\u8a2d\u5b9a\n\u901a\u5e38\u306eHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u3001Unicorn\u540c\u69d8upstream\u306b\u30bd\u30b1\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002WebSockets\u306b\u5bfe\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\uff08/cable\uff09\u306fHTTP\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u30d8\u30c3\u30c0\u3092\u66f8\u304d\u63db\u3048\u3066\u540c\u3058\u30bd\u30b1\u30c3\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\nnginx.conf\nhttp {\n  upstream puma {\n    server unix:/path-to-your-project/tmp/sockets/puma.sock;\n  }\n\n  server {\n    # General web access\n    try_files $uri $uri/index.html $uri.html @webapp;\n    location @webapp {\n      root /path-to-your-project/public/;\n      proxy_pass http://puma;\n    }\n\n    # WebSocket configure\n    location /cable {\n      proxy_pass http://puma;\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection \"upgrade\";\n    }\n  }\n}\n\n\n\n \u7e4b\u304c\u3089\u306a\u3044\u3068\u304d\u306f\n\u691c\u8a3c\u7528\u306bcURL\u3067WebSockets\u901a\u4fe1\u3082\u3067\u304d\u307e\u3059\u304c\u3001wscat\u304c\u4fbf\u5229\u3067\u3059\u3002\nwscat -c ws://your-domain.example.com/cable    # or wss://... in SSL version\n\n\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\u304c\u5e30\u3063\u3066\u304d\u3066\u3001\u53cd\u5fdc\u304c\u7121\u3044\u3068\u304d\u306f\u6b63\u5e38\u306b\u901a\u4fe1\u3067\u304d\u3066\u308b\u5834\u5408\u304c\u591a\u3044\u3067\u3059\u3002\u6b63\u3057\u304f\u901a\u4fe1\u3067\u304d\u306a\u3044\u3068\u304d\u306f\u30ed\u30b0\u3068\u306b\u3089\u3081\u3063\u3053\u3057\u307e\u3057\u3087\u3046\u3002\n\n \u53c2\u8003\n\nRails 5 + ActionCable\u3067\u4f5c\u308b\uff01\u30b7\u30f3\u30d7\u30eb\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\uff08DHH\u6c0f\u306e\u30c7\u30e2\u52d5\u753b\u3088\u308a\uff09\nnginx(1.3.13)\u3067WebSocket\u306e\u30d7\u30ed\u30ad\u30b7\u3092\u8a66\u3057\u305f\nVagrant\u3067\u30b5\u30fc\u30d0\u30fc\u7acb\u3066\u3066ActionCable\u3092\u8a66\u3057\u3066\u308b\u6642\u306bRequest origin not allowed\u304c\u3067\u3066\u8f9b\u3044\nRails4\u7cfb\u3067\u306eActionCable\u306e\u4f7f\u3044\u65b9 - \u73c8\u7432\u99c6\u52d5\u958b\u767a\nAction Cable - GitHub\n\n\nRails 5\u306e\u76ee\u7389\u6a5f\u80fd\u306e\u4e00\u3064\u306b\u3001WebSockets\u3092\u5bb9\u6613\u306b\u5229\u7528\u3067\u304d\u308b[ActionCable](https://github.com/rails/rails/tree/master/actioncable)\u304c\u3042\u308a\u307e\u3059\u3002Rails 4\u3067\u3082gem\u3067\u63d0\u4f9b\u3055\u308c\u3066\u307e\u3057\u305f\u304c\u3001Rails 5\u3067\u672c\u4f53\u306b\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u672c\u756a\u74b0\u5883\u306e\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u8a18\u4e8b\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002ActionCable\u3092\u4f7f\u3063\u305fRails 5\u30a2\u30d7\u30ea\u306f\u3001\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u3002\n\n* [Rails 5 + ActionCable\u3067\u4f5c\u308b\uff01\u30b7\u30f3\u30d7\u30eb\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\uff08DHH\u6c0f\u306e\u30c7\u30e2\u52d5\u753b\u3088\u308a\uff09](http://qiita.com/jnchito/items/aec75fab42804287d71b)\n\n\u3053\u306e\u4f8b\u3067\u306fdevelopment\u74b0\u5883\u304a\u3088\u3073Heroku\u3067\u306f\u52d5\u4f5c\u3057\u307e\u3059\u304c\u3001\u3053\u306e\u8a18\u4e8b\u306f\u672c\u756a\u74b0\u5883\u306enginx\u3092\u81ea\u524d\u3067\u8a2d\u5b9a\u3057\u3066\u3086\u304d\u307e\u3059\u3002\n\n<i class=\"fa fa-server\"></i> \u52d5\u4f5c\u74b0\u5883\u3068\u69cb\u6210\n--------------\n\n\u30d5\u30ed\u30f3\u30c8\u306eWeb\u30b5\u30fc\u30d0\u306b\u306fnginx\u3092\u3001Rack\u30b5\u30fc\u30d0\u306b\u306f[Puma](http://puma.io/)\u3092\u4f7f\u3044\u3001Capistrano3\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002Unicorn\u3092Rack\u30b5\u30fc\u30d0\u306b\u4f7f\u3046\u3068\u3001WebSockets\u30b5\u30fc\u30d0\u3082\u5225\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001\u4eca\u56de\u306fPuma\u3092\u4f7f\u3044\u307e\u3059\u3002Puma\u3068nginx\u306e\u51e6\u7406\u306f `puma.sock` \u7d4c\u7531\u3067\u884c\u3044\u307e\u3059\u3002\u30c7\u30d7\u30ed\u30a4\u304a\u3088\u3073Puma\u306e\u5236\u5fa1\u306b\u306fCapistrano\u3092\u4f7f\u3044\u307e\u3059\u3002\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u306b\u306f\u3001[jungle](https://github.com/puma/puma/tree/master/tools/jungle)\u307e\u305f\u306fsystemd\u306e\u8a2d\u5b9a\u3092\u81ea\u524d\u3067\u7528\u610f\u3059\u308c\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u89e6\u308c\u307e\u305b\u3093\u3002\n\nActionCable\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u5f93\u3044`/cable`\u3092WebSockets\u306e\u30d1\u30b9\u306b\u3001\u3064\u307e\u308a`ws://your-domain.example.com/cable`\uff08\u307e\u305f\u306f`wss://your-domain.example.com/cable`\uff09\u304b\u3089WebSockets\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\nRails\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\n-----------------\n\n\u307e\u305aRails\u30a2\u30d7\u30ea\u5074\u3067\u3001ActionCable\u304c\u8a31\u53ef\u3059\u308b\u30db\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002nginx\u3068Rails\u30a2\u30d7\u30ea\u304c\u540c\u30b5\u30fc\u30d0\u4e0a\u3067\u3082\u3001\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u3092\u8a31\u53ef\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff08[Allowed Request Origins](https://github.com/rails/rails/tree/master/actioncable#allowed-request-origins)\uff09\u3002\n\n```ruby:config/environments/production.rb\nconfig.action_cable.allowed_request_origins = [ 'https://your-domain.example.com' ]\n```\n\nCapistrano\u306e\u8a2d\u5b9a\u3068\u30c7\u30d7\u30ed\u30a4\n--------------------------\n\n[capistrano-puma](https://github.com/seuros/capistrano-puma)\u3068\u3044\u3046gem\u3092\u4f7f\u3046\u3068\u3001\u30b5\u30fc\u30d0\u5074\u306epuma\u3092\u624b\u5143\u304b\u3089\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002`Gemfile` \u306b `capistrano3-puma` \uff08`capistrano-puma` \u306f\u5225\u306egem\u306a\u3044\u306e\u3067\u6ce8\u610f\uff01\uff09\u3092\u8ffd\u52a0\u3057\u3066\u3001`Capfile` \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```ruby:Gemfile\ngem 'capistrano3-puma' , group: :development\n```\n```ruby:Capfile\nrequire 'capistrano/puma'\n```\n\n\u4ee5\u4e0a\u3067Capistrano\u7d4c\u7531\u3067\u672c\u756a\u74b0\u5883\u306epuma\u3092\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n\n```\n(bundle exec) cap production puma:start\n```\n\n\u3053\u306e\u6642 `puma:config` \u30bf\u30b9\u30af\u304c\u8d70\u308a\u3001puma\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u30c7\u30d7\u30ed\u30a4\u5148\u306e `\"#{shared_path}/puma.rb\"` \u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002puma\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f `config/deploy.rb` \u3092\u5143\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u8a2d\u5b9a\u9805\u76ee\u306f[capistrano-puma](https://github.com/seuros/capistrano-puma)\u306eREADME\u306b\u3042\u308a\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001puma\u306esock\u30d5\u30a1\u30a4\u30eb\u304c `\"#{shared_path}/tmp/sockets/puma.sock\"` \u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\u3064\u307e\u308a `puma:start` \u3092\u8d70\u3089\u305b\u308b\u3068`\"#{shared_path}/tmp/sockets/puma.sock\"` \u8d8a\u3057\u306bRails\u30a2\u30d7\u30ea\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u306e\u3067\u3001nginx\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u306b\u884c\u304f\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nnginx\u306e\u8a2d\u5b9a\n-----------\n\n\u901a\u5e38\u306eHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u3001Unicorn\u540c\u69d8upstream\u306b\u30bd\u30b1\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002WebSockets\u306b\u5bfe\u3059\u308b\u30ea\u30af\u30a8\u30b9\u30c8\uff08`/cable`\uff09\u306fHTTP\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u30d8\u30c3\u30c0\u3092\u66f8\u304d\u63db\u3048\u3066\u540c\u3058\u30bd\u30b1\u30c3\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\n```nginx:nginx.conf\nhttp {\n  upstream puma {\n    server unix:/path-to-your-project/tmp/sockets/puma.sock;\n  }\n\n  server {\n    # General web access\n    try_files $uri $uri/index.html $uri.html @webapp;\n    location @webapp {\n      root /path-to-your-project/public/;\n      proxy_pass http://puma;\n    }\n\n    # WebSocket configure\n    location /cable {\n      proxy_pass http://puma;\n      proxy_http_version 1.1;\n      proxy_set_header Upgrade $http_upgrade;\n      proxy_set_header Connection \"upgrade\";\n    }\n  }\n}\n```\n\n<i class=\"fa fa-question-circle\"></i> \u7e4b\u304c\u3089\u306a\u3044\u3068\u304d\u306f\n--------\n\u691c\u8a3c\u7528\u306b[cURL\u3067WebSockets\u901a\u4fe1](http://hwmemo01.tumblr.com/post/24658856934/\u4e00\u767a\u82b8curl\u3067websocket\u53d7\u4fe1\u5c02\u7528)\u3082\u3067\u304d\u307e\u3059\u304c\u3001[wscat](https://www.npmjs.com/package/wscat)\u304c\u4fbf\u5229\u3067\u3059\u3002\n\n```sh\nwscat -c ws://your-domain.example.com/cable    # or wss://... in SSL version\n```\n\n\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u306a\u3051\u308c\u3070\u30a8\u30e9\u30fc\u304c\u5e30\u3063\u3066\u304d\u3066\u3001\u53cd\u5fdc\u304c\u7121\u3044\u3068\u304d\u306f\u6b63\u5e38\u306b\u901a\u4fe1\u3067\u304d\u3066\u308b\u5834\u5408\u304c\u591a\u3044\u3067\u3059\u3002\u6b63\u3057\u304f\u901a\u4fe1\u3067\u304d\u306a\u3044\u3068\u304d\u306f\u30ed\u30b0\u3068\u306b\u3089\u3081\u3063\u3053\u3057\u307e\u3057\u3087\u3046\u3002\n\n<i class=\"fa fa-book\"></i> \u53c2\u8003\n----\n* [Rails 5 + ActionCable\u3067\u4f5c\u308b\uff01\u30b7\u30f3\u30d7\u30eb\u306a\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\uff08DHH\u6c0f\u306e\u30c7\u30e2\u52d5\u753b\u3088\u308a\uff09](http://qiita.com/jnchito/items/aec75fab42804287d71b)\n* [nginx(1.3.13)\u3067WebSocket\u306e\u30d7\u30ed\u30ad\u30b7\u3092\u8a66\u3057\u305f](http://qiita.com/tomo_watanabe/items/484aa9bfb7bc4206ffed)\n* [Vagrant\u3067\u30b5\u30fc\u30d0\u30fc\u7acb\u3066\u3066ActionCable\u3092\u8a66\u3057\u3066\u308b\u6642\u306bRequest origin not allowed\u304c\u3067\u3066\u8f9b\u3044](http://qiita.com/togana/items/bc75aa9d0bd1f7de357b)\n* [Rails4\u7cfb\u3067\u306eActionCable\u306e\u4f7f\u3044\u65b9 - \u73c8\u7432\u99c6\u52d5\u958b\u767a](http://totutotu.hatenablog.com/entry/2015/12/14/141539)\n* [Action Cable - GitHub](https://github.com/rails/rails/tree/master/actioncable)\n", "tags": ["Rails", "capistrano", "websocket", "puma", "nginx"]}