{"tags": ["PHP5.4", "tips", "gif"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nGIF\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u3001PHP\u306e\u6a19\u6e96\u95a2\u6570\u3060\u3051\u3067\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\nGIF\u306eComment Extension block\u3092\u63a2\u3057\u3001\u305d\u308c\u3092\u524a\u9664\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\nWindows\u7248PHP 5.4.5\u3067\u306e\u52d5\u4f5c\u306f\u78ba\u8a8d\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001\u4ed6\u306e\u753b\u50cf\u5f62\u5f0f\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u305f\u3044\u5834\u5408\u3001\u95a2\u9023\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u6ce8\u610f\n\u79c1\u306f\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u64cd\u4f5c\u3092\u884c\u3046\u51e6\u7406\u306e\u5b9f\u88c5\u7d4c\u9a13\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u3053\u306e\u305f\u3081\u3001\u672c\u6295\u7a3f\u3067\u7d39\u4ecb\u3059\u308b\u51e6\u7406\u306f\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u30fb\u901f\u5ea6\u30fb\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306a\u3069\u306e\u70b9\u3067\u52a3\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u5b9f\u7528\u7684\u3067\u306a\u3044\u6050\u308c\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\n/**\n * \u5909\u6570\u5b9a\u7fa9\n */\n//\u5bfe\u8c61\u306eGIF\u30d5\u30a1\u30a4\u30eb\n$filename     = 'example.gif';\n//\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u305fGIF\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a1\u30a4\u30eb\u540d(\u4f5c\u6210\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d)\n$out_filename = 'example.clean.gif';\n\n\n\n\n\n/**\n * \u95a2\u6570\u5b9a\u7fa9\n */\n/**\n * \u30d0\u30a4\u30ca\u30ea\u306e\u30c7\u30fc\u30bf\u3092\u6570\u5024\u306b\u5909\u63db\u3059\u308b\n *\n * @param string $str \u5909\u63db\u3059\u308b\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\n * @return int \u5909\u63db\u3055\u308c\u305f\u6570\u5024\n */\nfunction bin2dec($str){\n    $str=unpack('Cdec',$str);\n    return $str['dec'];\n}\n/**\n * GIF\u306eSub block\u3092\u30d5\u30a1\u30a4\u30eb\u30dd\u30a4\u30f3\u30bf\u304b\u3089\u8aad\u307f\u8fbc\u307f\u3001\u9023\u7d9a\u3057\u305fSub block\u306e\u5168\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\n * \u51fa\u529b\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306b\u306f\u3001\u5404\u30d6\u30ed\u30c3\u30af\u306eBlock Size\u3084\u6700\u5f8c\u306eTerminator\u3082\u542b\u307e\u308c\u308b\n *\n * @param resource $handle fopen\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30dd\u30a4\u30f3\u30bf\u30ea\u30bd\u30fc\u30b9\n * @return string Sub block\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3002\u5404\u30d6\u30ed\u30c3\u30af\u306e\u9577\u3055\u3084Terminator\u3082\u542b\u307e\u308c\u308b\n */\nfunction subblock_read($handle){\n    $data='';\n    while(true){\n        $data.=\n        $length=fread($handle,1);\n        if($length===\"\\x00\"){\n            break;\n        }\n        $length=bin2dec($length);\n        $data.=fread($handle,$length);\n    }\n    return $data;\n}\n\n\n\n\n\ntry{\n    /**\n     * GIF\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\n     */\n    $fp=fopen($filename,'rb');\n    if(!$fp){\n        throw new RuntimeException('\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n    }\n\n    /**\n     * Header\u306e\u89e3\u6790\n     */\n    /* \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u304c\u4e00\u81f4\u3059\u308b\u304b\u30c1\u30a7\u30c3\u30af */\n    if(($output=fread($fp,3))!==\"\\x47\\x49\\x46\"){\n        throw new RuntimeException('\u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306fGIF\u5f62\u5f0f\u3067\u306f\u3042\u308a\u307e\u305b\u3093');\n    }\n    /* \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4e00\u81f4\u3059\u308b\u304b\u30c1\u30a7\u30c3\u30af */\n    $output.=\n    $version=fread($fp,3);\n    if($version!==\"\\x38\\x37\\x61\" && $version!==\"\\x38\\x39\\x61\"){\n        throw new RuntimeException('\u4e0d\u6b63\u306a\u30d0\u30fc\u30b8\u30e7\u30f3\u306eGIF\u3067\u3059: '.$version);\n    }\n\n    /**\n     * Logical Screen Descriptor\u306e\u89e3\u6790\n     */\n    $output.=fread($fp,4);\n    $output.=\n    $desc=fread($fp,1);\n    $output.=fread($fp,2);\n    $desc=bin2dec($desc);\n\n    /**\n     * Global Color Table\u306e\u89e3\u6790\n     */\n    if($desc>>7 & 1){\n        $output.=fread(\n            $fp,\n            pow(2,($desc & 7)+1)*3\n        );\n    }\n\n    $is_end=false;\n    while($blockHeader=fread($fp,1)){\n        if($is_end){\n            /**\n             * Trailer\u4ee5\u964d\u306b\u3082\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001\n             * \u4e0d\u6b63\u306aGIF\u3068\u3057\u3066\u30a8\u30e9\u30fc\u3092\u51fa\u3059\u3002\n             */\n            throw new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Trailer block\u4ee5\u964d\u306b\u30c7\u30fc\u30bf\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n        }\n        if($blockHeader===\"\\x2c\"){\n            /**\n             * Image Descriptor\u306e\u89e3\u6790\n             */\n            $blockHeader.=fread($fp,8);\n            $blockHeader.=\n            $desc=fread($fp,1);\n            $desc=bin2dec($desc);\n\n            /**\n             * Local Color Table\u306e\u89e3\u6790\n             */\n            if($desc>>7 & 1){\n                $blockHeader.=fread(\n                    $fp,\n                    pow(2,($desc & 7)+1)*3\n                );\n            }\n\n            /**\n             * Image Data\u306e\u89e3\u6790\n             */\n            $blockHeader.=fread($fp,1);\n            $blockHeader.=subblock_read($fp);\n        }elseif($blockHeader===\"\\x21\"){\n            $blockLabel=fread($fp,1);\n            if($blockLabel===\"\\xfe\"){\n                /**\n                 * Comment Extension\u306f\u98db\u3070\u3059\n                 */\n                subblock_read($fp);\n                continue;\n            }elseif($blockLabel!==\"\\xf9\" && $blockLabel!==\"\\x01\" && $blockLabel!==\"\\xff\"){\n                /**\n                 * Comment Extension\u4ee5\u5916\u306e\u3069\u306e\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u3067\u3082\u306a\u3044\u5834\u5408\u3001\u4f8b\u5916\u3092\u6295\u3052\u308b\n                 */\n                throw new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4ed5\u69d8\u306b\u306a\u3044\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n            }\n            $blockHeader.=$blockLabel.subblock_read($fp);\n        }elseif($blockHeader===\"\\x3b\"){\n            /**\n             * Trailer\u3092\u691c\u51fa\u3057\u305f\u5834\u5408\u3001\u7d42\u7aef\u30d5\u30e9\u30b0\u3092\u30bb\u30c3\u30c8\u3059\u308b\n             */\n            $is_end=true;\n        }else{\n            throw new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4ed5\u69d8\u306b\u306a\u3044\u30d6\u30ed\u30c3\u30af\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n        }\n        $output.=$blockHeader;\n    }\n    if(!$is_end){\n        /**\n         * Trailer\u3092\u691c\u51fa\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u3001\n         * \u4e0d\u6b63\u306aGIF\u3068\u3057\u3066\u30a8\u30e9\u30fc\u3092\u51fa\u3059\u3002\n         */\n        throw new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Trailer block\u3092\u691c\u51fa\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f');\n    }\n\n    //\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n    fclose($fp);\n\n    /**\n     * \u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u4fdd\u5b58\n     */\n    file_put_contents($out_filename,$output);\n}catch(RuntimeException $e){\n    //\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n    fclose($fp);\n    echo $e->getMessage();\n}\nif(isset($fp)){\n    //\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n    fclose($fp);\n}\n\n\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\nGIF\u3092\u30d6\u30ed\u30c3\u30af\u6bce\u306b\u89e3\u6790\u3057\u3001Comment Extension block\u3092\u9664\u304f\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u65b0\u3057\u3044\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\nGIF\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u8868\u3092\u4f5c\u308b\u904e\u7a0b\u3067\u3001\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u306f\u5148\u982d2\u30d0\u30a4\u30c8\u4ee5\u964d\u306f\u5168\u3066Sub block\u306a\u306e\u3060\u3068\u6c17\u3065\u3044\u305f\u305f\u3081\u3001\nComment Extension block\u4ee5\u5916\u306e\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u306f\u5148\u982d2\u30d0\u30a4\u30c8\u306e\u5224\u5b9a\u4ee5\u5916\u306f\u7565\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u3001\u3044\u308d\u3044\u308d\u7565\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u306b\u304f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u52d8\u5f01\u3092\u3002\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\n GIF\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f - Nekopps Web\u30a2\u30d7\u30ea\u5236\u4f5c\u7de8\u96c6\n\n GIF\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8a73\u7d30\n\n GIF\u753b\u50cf\u304b\u3089\u60c5\u5831\u3092\u629c\u304d\u53d6\u308b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb PHP\u3067\u30d0\u30a4\u30ca\u30ea\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u305d\u306e3 : \u30a2\u30b7\u30a2\u30eb\u30d6\u30ed\u30b0\n\n\n\n\u4e09\u5927\u753b\u50cf\u5f62\u5f0f\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u524a\u9664\u306b\u6210\u529f\u3057\u305f\u304b\u3089\u2026\n\u6b21\u306f\u3001\u79c1\u500b\u4eba\u306e\u5f53\u521d\u306e\u76ee\u7684\u3060\u3063\u305f\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3078\u306e\u643a\u5e2f\u7aef\u672b\u7528\u518d\u914d\u5e03\u7981\u6b62\u547d\u4ee4copy=\"NO\"\u3001kddi_copyright=on\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u3092\u66f8\u304d\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\nGIF\u306e\u4ed5\u69d8\u306f(PNG\u3068\u6bd4\u3079\u308b\u3068)\u591a\u5c11\u3084\u3084\u3053\u3057\u3044\u306e\u3067\u3001\u89e3\u6790\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u81ea\u524d\u3067\u7d44\u3080\u969b\u306f\u30d6\u30ed\u30c3\u30af\u306e\u524d\u5f8c\u95a2\u4fc2\u3084\u9577\u3055\u306a\u3069\u306b\u95a2\u3059\u308b\u8868\u3092\u4f5c\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u3002\n\u3061\u306a\u307f\u306b\u79c1\u306f\u3001\u4e0b\u8a18\u306e\u8868\u3092\u4f5c\u3063\u3066\u672c\u30b3\u30fc\u30c9\u3092\u7d44\u307f\u307e\u3057\u305f\u3002\nGIF\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u8868\n\n\u95a2\u9023\u8a18\u4e8b\n\nPHP\u3067\u3001PNG\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b - Qiita\nPHP\u3067\u3001JPEG\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3084Exif\u60c5\u5831\u3092\u524a\u9664\u3059\u308b - Qiita\n\n\n## \u6982\u8981\n\nGIF\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u3001PHP\u306e\u6a19\u6e96\u95a2\u6570\u3060\u3051\u3067\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n\nGIF\u306eComment Extension block\u3092\u63a2\u3057\u3001\u305d\u308c\u3092\u524a\u9664\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\nWindows\u7248PHP 5.4.5\u3067\u306e\u52d5\u4f5c\u306f\u78ba\u8a8d\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u4ed6\u306e\u753b\u50cf\u5f62\u5f0f\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u305f\u3044\u5834\u5408\u3001[\u95a2\u9023\u8a18\u4e8b](#%E9%96%A2%E9%80%A3%E8%A8%98%E4%BA%8B)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## \u6ce8\u610f\n\n\u79c1\u306f\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u64cd\u4f5c\u3092\u884c\u3046\u51e6\u7406\u306e\u5b9f\u88c5\u7d4c\u9a13\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u3053\u306e\u305f\u3081\u3001\u672c\u6295\u7a3f\u3067\u7d39\u4ecb\u3059\u308b\u51e6\u7406\u306f\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u30fb\u901f\u5ea6\u30fb\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306a\u3069\u306e\u70b9\u3067\u52a3\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u5b9f\u7528\u7684\u3067\u306a\u3044\u6050\u308c\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u30b3\u30fc\u30c9\n\n```php\n/**\n * \u5909\u6570\u5b9a\u7fa9\n */\n//\u5bfe\u8c61\u306eGIF\u30d5\u30a1\u30a4\u30eb\n$filename     = 'example.gif';\n//\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u305fGIF\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30a1\u30a4\u30eb\u540d(\u4f5c\u6210\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d)\n$out_filename = 'example.clean.gif';\n\n\n\n\n\n/**\n * \u95a2\u6570\u5b9a\u7fa9\n */\n/**\n * \u30d0\u30a4\u30ca\u30ea\u306e\u30c7\u30fc\u30bf\u3092\u6570\u5024\u306b\u5909\u63db\u3059\u308b\n *\n * @param string $str \u5909\u63db\u3059\u308b\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\n * @return int \u5909\u63db\u3055\u308c\u305f\u6570\u5024\n */\nfunction bin2dec($str){\n\t$str=unpack('Cdec',$str);\n\treturn $str['dec'];\n}\n/**\n * GIF\u306eSub block\u3092\u30d5\u30a1\u30a4\u30eb\u30dd\u30a4\u30f3\u30bf\u304b\u3089\u8aad\u307f\u8fbc\u307f\u3001\u9023\u7d9a\u3057\u305fSub block\u306e\u5168\u30c7\u30fc\u30bf\u3092\u51fa\u529b\u3059\u308b\n * \u51fa\u529b\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306b\u306f\u3001\u5404\u30d6\u30ed\u30c3\u30af\u306eBlock Size\u3084\u6700\u5f8c\u306eTerminator\u3082\u542b\u307e\u308c\u308b\n *\n * @param resource $handle fopen\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30dd\u30a4\u30f3\u30bf\u30ea\u30bd\u30fc\u30b9\n * @return string Sub block\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3002\u5404\u30d6\u30ed\u30c3\u30af\u306e\u9577\u3055\u3084Terminator\u3082\u542b\u307e\u308c\u308b\n */\nfunction subblock_read($handle){\n\t$data='';\n\twhile(true){\n\t\t$data.=\n\t\t$length=fread($handle,1);\n\t\tif($length===\"\\x00\"){\n\t\t\tbreak;\n\t\t}\n\t\t$length=bin2dec($length);\n\t\t$data.=fread($handle,$length);\n\t}\n\treturn $data;\n}\n\n\n\n\n\ntry{\n\t/**\n\t * GIF\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\n\t */\n\t$fp=fopen($filename,'rb');\n\tif(!$fp){\n\t\tthrow new RuntimeException('\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n\t}\n\n\t/**\n\t * Header\u306e\u89e3\u6790\n\t */\n\t/* \u30d5\u30a1\u30a4\u30eb\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u304c\u4e00\u81f4\u3059\u308b\u304b\u30c1\u30a7\u30c3\u30af */\n\tif(($output=fread($fp,3))!==\"\\x47\\x49\\x46\"){\n\t\tthrow new RuntimeException('\u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306fGIF\u5f62\u5f0f\u3067\u306f\u3042\u308a\u307e\u305b\u3093');\n\t}\n\t/* \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4e00\u81f4\u3059\u308b\u304b\u30c1\u30a7\u30c3\u30af */\n\t$output.=\n\t$version=fread($fp,3);\n\tif($version!==\"\\x38\\x37\\x61\" && $version!==\"\\x38\\x39\\x61\"){\n\t\tthrow new RuntimeException('\u4e0d\u6b63\u306a\u30d0\u30fc\u30b8\u30e7\u30f3\u306eGIF\u3067\u3059: '.$version);\n\t}\n\n\t/**\n\t * Logical Screen Descriptor\u306e\u89e3\u6790\n\t */\n\t$output.=fread($fp,4);\n\t$output.=\n\t$desc=fread($fp,1);\n\t$output.=fread($fp,2);\n\t$desc=bin2dec($desc);\n\n\t/**\n\t * Global Color Table\u306e\u89e3\u6790\n\t */\n\tif($desc>>7 & 1){\n\t\t$output.=fread(\n\t\t\t$fp,\n\t\t\tpow(2,($desc & 7)+1)*3\n\t\t);\n\t}\n\n\t$is_end=false;\n\twhile($blockHeader=fread($fp,1)){\n\t\tif($is_end){\n\t\t\t/**\n\t\t\t * Trailer\u4ee5\u964d\u306b\u3082\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u3001\n\t\t\t * \u4e0d\u6b63\u306aGIF\u3068\u3057\u3066\u30a8\u30e9\u30fc\u3092\u51fa\u3059\u3002\n\t\t\t */\n\t\t\tthrow new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Trailer block\u4ee5\u964d\u306b\u30c7\u30fc\u30bf\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n\t\t}\n\t\tif($blockHeader===\"\\x2c\"){\n\t\t\t/**\n\t\t\t * Image Descriptor\u306e\u89e3\u6790\n\t\t\t */\n\t\t\t$blockHeader.=fread($fp,8);\n\t\t\t$blockHeader.=\n\t\t\t$desc=fread($fp,1);\n\t\t\t$desc=bin2dec($desc);\n\n\t\t\t/**\n\t\t\t * Local Color Table\u306e\u89e3\u6790\n\t\t\t */\n\t\t\tif($desc>>7 & 1){\n\t\t\t\t$blockHeader.=fread(\n\t\t\t\t\t$fp,\n\t\t\t\t\tpow(2,($desc & 7)+1)*3\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Image Data\u306e\u89e3\u6790\n\t\t\t */\n\t\t\t$blockHeader.=fread($fp,1);\n\t\t\t$blockHeader.=subblock_read($fp);\n\t\t}elseif($blockHeader===\"\\x21\"){\n\t\t\t$blockLabel=fread($fp,1);\n\t\t\tif($blockLabel===\"\\xfe\"){\n\t\t\t\t/**\n\t\t\t\t * Comment Extension\u306f\u98db\u3070\u3059\n\t\t\t\t */\n\t\t\t\tsubblock_read($fp);\n\t\t\t\tcontinue;\n\t\t\t}elseif($blockLabel!==\"\\xf9\" && $blockLabel!==\"\\x01\" && $blockLabel!==\"\\xff\"){\n\t\t\t\t/**\n\t\t\t\t * Comment Extension\u4ee5\u5916\u306e\u3069\u306e\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u3067\u3082\u306a\u3044\u5834\u5408\u3001\u4f8b\u5916\u3092\u6295\u3052\u308b\n\t\t\t\t */\n\t\t\t\tthrow new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4ed5\u69d8\u306b\u306a\u3044\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n\t\t\t}\n\t\t\t$blockHeader.=$blockLabel.subblock_read($fp);\n\t\t}elseif($blockHeader===\"\\x3b\"){\n\t\t\t/**\n\t\t\t * Trailer\u3092\u691c\u51fa\u3057\u305f\u5834\u5408\u3001\u7d42\u7aef\u30d5\u30e9\u30b0\u3092\u30bb\u30c3\u30c8\u3059\u308b\n\t\t\t */\n\t\t\t$is_end=true;\n\t\t}else{\n\t\t\tthrow new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\u4ed5\u69d8\u306b\u306a\u3044\u30d6\u30ed\u30c3\u30af\u3092\u691c\u51fa\u3057\u307e\u3057\u305f');\n\t\t}\n\t\t$output.=$blockHeader;\n\t}\n\tif(!$is_end){\n\t\t/**\n\t\t * Trailer\u3092\u691c\u51fa\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u3001\n\t\t * \u4e0d\u6b63\u306aGIF\u3068\u3057\u3066\u30a8\u30e9\u30fc\u3092\u51fa\u3059\u3002\n\t\t */\n\t\tthrow new RuntimeException('\u4e0d\u6b63\u306a\u69cb\u9020\u306eGIF\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002Trailer block\u3092\u691c\u51fa\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f');\n\t}\n\n\t//\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n\tfclose($fp);\n\n\t/**\n\t * \u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u4fdd\u5b58\n\t */\n\tfile_put_contents($out_filename,$output);\n}catch(RuntimeException $e){\n\t//\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n\tfclose($fp);\n\techo $e->getMessage();\n}\nif(isset($fp)){\n\t//\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\n\tfclose($fp);\n}\n```\n\n## \u3084\u3063\u3066\u3044\u308b\u3053\u3068\n\nGIF\u3092\u30d6\u30ed\u30c3\u30af\u6bce\u306b\u89e3\u6790\u3057\u3001Comment Extension block\u3092\u9664\u304f\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u65b0\u3057\u3044\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\nGIF\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u8868\u3092\u4f5c\u308b\u904e\u7a0b\u3067\u3001\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u306f\u5148\u982d2\u30d0\u30a4\u30c8\u4ee5\u964d\u306f\u5168\u3066Sub block\u306a\u306e\u3060\u3068\u6c17\u3065\u3044\u305f\u305f\u3081\u3001\nComment Extension block\u4ee5\u5916\u306e\u62e1\u5f35\u30d6\u30ed\u30c3\u30af\u306f\u5148\u982d2\u30d0\u30a4\u30c8\u306e\u5224\u5b9a\u4ee5\u5916\u306f\u7565\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u3001\u3044\u308d\u3044\u308d\u7565\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u8aad\u307f\u306b\u304f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u52d8\u5f01\u3092\u3002\n\n## \u53c2\u8003\u30b5\u30a4\u30c8\n\n*  [GIF\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f - Nekopps Web\u30a2\u30d7\u30ea\u5236\u4f5c\u7de8\u96c6](http://www.nekopps.com/article/gif_format/)\n*  [GIF\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8a73\u7d30](http://www.tohoho-web.com/wwwgif.htm)\n*  [GIF\u753b\u50cf\u304b\u3089\u60c5\u5831\u3092\u629c\u304d\u53d6\u308b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb PHP\u3067\u30d0\u30a4\u30ca\u30ea\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u305d\u306e3 : \u30a2\u30b7\u30a2\u30eb\u30d6\u30ed\u30b0](http://blog.asial.co.jp/820)\n\n## \u4e09\u5927\u753b\u50cf\u5f62\u5f0f\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u524a\u9664\u306b\u6210\u529f\u3057\u305f\u304b\u3089\u2026\n\n\u6b21\u306f\u3001~~\u79c1\u500b\u4eba\u306e~~\u5f53\u521d\u306e\u76ee\u7684\u3060\u3063\u305f\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3078\u306e\u643a\u5e2f\u7aef\u672b\u7528\u518d\u914d\u5e03\u7981\u6b62\u547d\u4ee4`copy=\"NO\"`\u3001`kddi_copyright=on`\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u3092\u66f8\u304d\u307e\u3059\u3002\n\n## \u6700\u5f8c\u306b\n\nGIF\u306e\u4ed5\u69d8\u306f(PNG\u3068\u6bd4\u3079\u308b\u3068)\u591a\u5c11\u3084\u3084\u3053\u3057\u3044\u306e\u3067\u3001\u89e3\u6790\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u81ea\u524d\u3067\u7d44\u3080\u969b\u306f\u30d6\u30ed\u30c3\u30af\u306e\u524d\u5f8c\u95a2\u4fc2\u3084\u9577\u3055\u306a\u3069\u306b\u95a2\u3059\u308b\u8868\u3092\u4f5c\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u3002\n\u3061\u306a\u307f\u306b\u79c1\u306f\u3001\u4e0b\u8a18\u306e\u8868\u3092\u4f5c\u3063\u3066\u672c\u30b3\u30fc\u30c9\u3092\u7d44\u307f\u307e\u3057\u305f\u3002\n\n[GIF\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u8868](http://jsbin.com/silem)\n\n## \u95a2\u9023\u8a18\u4e8b\n\n* [PHP\u3067\u3001PNG\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b - Qiita](http://qiita.com/sounisi5011/items/e685ed1501a3cd979a3c)\n* [PHP\u3067\u3001JPEG\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u3084Exif\u60c5\u5831\u3092\u524a\u9664\u3059\u308b - Qiita](http://qiita.com/sounisi5011/items/cc3336775d4208fbcabd)\n"}