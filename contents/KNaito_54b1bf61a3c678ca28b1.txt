{"context": "\n\n\u306f\u3058\u3081\u306b\nAndroid 2.3\u306a\u3069\u306e\u53e4\u3044\u30d6\u30e9\u30a6\u30b6\u3067\u306fFormData\u3067\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092Post\u51fa\u6765\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u69cb\u9020\u3092\u81ea\u524d\u3067\u4f5c\u6210\u3057\u3066\u3001Post\u3059\u308b\u3053\u3068\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\nCordova\u306a\u3069\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30a2\u30d7\u30ea\u3067\u306e\u904b\u7528\u3092\u60f3\u5b9a\u3002\n\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u30c7\u30fc\u30bf\u69cb\u9020\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u69cb\u9020\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\nhttp://d.hatena.ne.jp/satox/20110726/1311665904\n\n\u30d8\u30c3\u30c0\u90e8\n\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\u306b\u4ee5\u4e0b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nContent-Type: multipart/form-data; boundary=\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d\\r\\n\n\n\n\u30dc\u30c7\u30a3\u90e8\n\u30c6\u30ad\u30b9\u30c8\u30c7\u30fc\u30bf\n--\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d\\r\\n\nContent-Disposition: form-data; name=\"\u300c\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u540d\u300d\"\\r\\n\n\\r\\n\n\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u672c\u4f53\\r\\n\n\n\u3000\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\nContent-Disposition: form-data; name=\"\u300c\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u540d\u300d\"; filename=\"\u30d5\u30a1\u30a4\u30eb\u540d\"\\r\\n\nContent-Type: application/octet-stream\\r\\n\nContent-Transfer-Encoding: binary\\r\\n\n\\r\\n\n\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306e\u672c\u4f53\n\nContent-Type\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5185\u5bb9\u306b\u3088\u3063\u3066\u9069\u5207\u306a\u3082\u306e\u306b\u3057\u307e\u3059\u3002\u307e\u305f\u3001Content-Transfer-Encoding\u306fbinary\u4ee5\u5916(\u4f8b\u3048\u3070base64)\u306b\u3057\u3066\u3082\u7121\u8996\u3055\u308c\u3066\u3001\u30d0\u30a4\u30ca\u30ea\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002\n\n\u30d5\u30c3\u30bf\u90e8\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u6700\u5f8c\u306b\u5fc5\u8981\n--\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d--\\r\\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\nindex.html\u3068\u540c\u3058\u968e\u5c64\u306b\u3042\u308bsample.jpg\u30d5\u30a1\u30a4\u30eb\u3092ajax\u306b\u3088\u308a\u8aad\u307f\u8fbc\u307f\u3001\u305d\u308c\u3092http://\u30b5\u30fc\u30d0\u30fc\u540d/uploader.php\u306b\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u3067Post\u3059\u308b\u3002Form\u8981\u7d20\u306ename\u3068\u3057\u3066\u306fuserfile\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6642\u306e\u4eee\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306fmyimage.png\u3068\u3057\u3066\u56fa\u5b9a\u3002\n<html>\n<head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\">\n    <link rel=\"stylesheet\" href=\"css/style.css\">\n    <script>\n        function sendPost() {\n\n            var oReq = new XMLHttpRequest();\n            oReq.open(\"GET\",\"sample.jpg\", true);\n            oReq.responseType = \"arraybuffer\";\n            oReq.onload = function(oEvent) {\n                var arrayBuffer = oReq.response;\n                console.log( \"len = \" +  arrayBuffer.byteLength );\n\n                var request = new XMLHttpRequest();\n                request.open(\"POST\",'http://\u30b5\u30fc\u30d0\u30fc\u540d/uploader.php',true);\n                var boundary = createBoundary();\n                request.setRequestHeader( \"Content-Type\", 'multipart/form-data; boundary=' + boundary );\n\n                var buffer = unicode2buffer( \n                    '--' + boundary + '\\r\\n' + 'Content-Disposition: form-data; name=\"userfile\"; filename=\"myimage.png\"\\r\\n'\n                                             + 'Content-Type: image/png\\r\\n\\r\\n'\n                );\n\n                var buffer = appendBuffer( buffer , \n                    arrayBuffer\n                );\n\n                var buffer = appendBuffer( buffer , \n                    unicode2buffer(\n                        '\\r\\n' + '--' + boundary + '--'\n                    )\n                );\n\n                request.send( buffer );\n                alert(\"send!\");\n            }\n            oReq.send(null);\n\n        }\n\n        function createBoundary() {\n            var multipartChars = \"-_1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n            var length = 30 + Math.floor( Math.random() * 10 );\n            var boundary = \"---------------------------\";\n            for (var i=0;i < length; i++) {\n                boundary += multipartChars.charAt( Math.floor( Math.random() * multipartChars.length ) );\n            }\n            return boundary;\n        }\n\n        function unicode2buffer(str){\n\n            var n = str.length,\n                idx = -1,\n                byteLength = 512,\n                bytes = new Uint8Array(byteLength),\n                i, c, _bytes;\n\n            for(i = 0; i < n; ++i){\n                c = str.charCodeAt(i);\n                if(c <= 0x7F){\n                    bytes[++idx] = c;\n                } else if(c <= 0x7FF){\n                    bytes[++idx] = 0xC0 | (c >>> 6);\n                    bytes[++idx] = 0x80 | (c & 0x3F);\n                } else if(c <= 0xFFFF){\n                    bytes[++idx] = 0xE0 | (c >>> 12);\n                    bytes[++idx] = 0x80 | ((c >>> 6) & 0x3F);\n                    bytes[++idx] = 0x80 | (c & 0x3F);\n                } else {\n                    bytes[++idx] = 0xF0 | (c >>> 18);\n                    bytes[++idx] = 0x80 | ((c >>> 12) & 0x3F);\n                    bytes[++idx] = 0x80 | ((c >>> 6) & 0x3F);\n                    bytes[++idx] = 0x80 | (c & 0x3F);\n                }\n                if(byteLength - idx <= 4){\n                    _bytes = bytes;\n                    byteLength *= 2;\n                    bytes = new Uint8Array(byteLength);\n                    bytes.set(_bytes);\n                }\n            }\n            idx++;\n\n            var result = new Uint8Array(idx);\n            result.set(bytes.subarray(0,idx),0);\n\n            return result.buffer;\n        }\n\n        function appendBuffer(buf1,buf2) {\n            var uint8array = new Uint8Array(buf1.byteLength + buf2.byteLength);\n            uint8array.set(new Uint8Array(buf1),0);\n            uint8array.set(new Uint8Array(buf2),buf1.byteLength);\n            return uint8array.buffer;\n        }\n    </script>\n</head>\n<body>\n  <br />\n    This is a template for Monaca app.\n    <div onClick=\"sendPost();\">Click!</div>\n    <br>\n    <div onClick=\"console.log(createBoundary());\">Generate Boundary</div>\n</body>\n</html>\n\n\n\u30dd\u30a4\u30f3\u30c8\n\u3000\u753b\u50cf\u30c7\u30fc\u30bf\u306a\u3069\u306f\u3001\u6587\u5b57\u5217\u5316\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u30d0\u30a4\u30ca\u30ea\u3067\u6271\u3046\u3057\u304b\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3002\n\u3000\u305d\u306e\u5834\u5408\u3001\u6587\u5b57\u5217\u90e8\u5206\u3082\u30d0\u30a4\u30ca\u30ea\u5316\u3057\u3066\u3042\u3052\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\u3000\u306a\u304a\u3001\u6a5f\u7a2e\u306b\u3082\u3088\u308b\u304c\u3001Android\u6a5f\u3067\u305d\u3082\u305d\u3082ArrayBuffer\u3084Uint8Array\u304c\u4f7f\u3048\u306a\u304b\u3063\u305f\u308a\u3001Ajax\u3067\u30d0\u30a4\u30c8\u5217\u3092\u6271\u3048\u306a\u3044\u5834\u5408\u3001\u4e0a\u8a18\u306e\u6a5f\u80fd\u3082\u4f7f\u3048\u306a\u3044\u306e\u3067\u6ce8\u610f\u3002\n\u306f\u3058\u3081\u306b\n====\n\nAndroid 2.3\u306a\u3069\u306e\u53e4\u3044\u30d6\u30e9\u30a6\u30b6\u3067\u306fFormData\u3067\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092Post\u51fa\u6765\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u69cb\u9020\u3092\u81ea\u524d\u3067\u4f5c\u6210\u3057\u3066\u3001Post\u3059\u308b\u3053\u3068\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\nCordova\u306a\u3069\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30a2\u30d7\u30ea\u3067\u306e\u904b\u7528\u3092\u60f3\u5b9a\u3002\n\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u30c7\u30fc\u30bf\u69cb\u9020\n====\n\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u69cb\u9020\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\nhttp://d.hatena.ne.jp/satox/20110726/1311665904\n\n### \u30d8\u30c3\u30c0\u90e8\n\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\u306b\u4ee5\u4e0b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n    Content-Type: multipart/form-data; boundary=\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d\\r\\n\n\n### \u30dc\u30c7\u30a3\u90e8\n  \u30c6\u30ad\u30b9\u30c8\u30c7\u30fc\u30bf\n\n    --\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d\\r\\n\n    Content-Disposition: form-data; name=\"\u300c\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u540d\u300d\"\\r\\n\n    \\r\\n\n    \u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u672c\u4f53\\r\\n\n\n\u3000\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\n\n    Content-Disposition: form-data; name=\"\u300c\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u540d\u300d\"; filename=\"\u30d5\u30a1\u30a4\u30eb\u540d\"\\r\\n\n    Content-Type: application/octet-stream\\r\\n\n    Content-Transfer-Encoding: binary\\r\\n\n    \\r\\n\n    \u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u306e\u672c\u4f53\n\n`Content-Type`\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5185\u5bb9\u306b\u3088\u3063\u3066\u9069\u5207\u306a\u3082\u306e\u306b\u3057\u307e\u3059\u3002\u307e\u305f\u3001`Content-Transfer-Encoding`\u306f`binary`\u4ee5\u5916(\u4f8b\u3048\u3070`base64`)\u306b\u3057\u3066\u3082\u7121\u8996\u3055\u308c\u3066\u3001\u30d0\u30a4\u30ca\u30ea\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002\n\n\n\n### \u30d5\u30c3\u30bf\u90e8\n\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u306e\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306e\u6700\u5f8c\u306b\u5fc5\u8981\n\n    --\u300c\u30d0\u30a6\u30f3\u30c0\u30ea\u6587\u5b57\u5217\u300d--\\r\\n\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n====\n `index.html`\u3068\u540c\u3058\u968e\u5c64\u306b\u3042\u308b`sample.jpg`\u30d5\u30a1\u30a4\u30eb\u3092ajax\u306b\u3088\u308a\u8aad\u307f\u8fbc\u307f\u3001\u305d\u308c\u3092`http://\u30b5\u30fc\u30d0\u30fc\u540d/uploader.php`\u306b\u30de\u30eb\u30c1\u30d1\u30fc\u30c8\u3067Post\u3059\u308b\u3002`Form`\u8981\u7d20\u306e`name`\u3068\u3057\u3066\u306f`userfile`\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6642\u306e\u4eee\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f`myimage.png`\u3068\u3057\u3066\u56fa\u5b9a\u3002\n\n    <html>\n    <head>\n        <meta charset=\"utf-8\">\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\">\n        <link rel=\"stylesheet\" href=\"css/style.css\">\n        <script>\n            function sendPost() {\n                \n                var oReq = new XMLHttpRequest();\n                oReq.open(\"GET\",\"sample.jpg\", true);\n                oReq.responseType = \"arraybuffer\";\n                oReq.onload = function(oEvent) {\n                    var arrayBuffer = oReq.response;\n                    console.log( \"len = \" +  arrayBuffer.byteLength );\n                    \n                    var request = new XMLHttpRequest();\n                    request.open(\"POST\",'http://\u30b5\u30fc\u30d0\u30fc\u540d/uploader.php',true);\n                    var boundary = createBoundary();\n                    request.setRequestHeader( \"Content-Type\", 'multipart/form-data; boundary=' + boundary );\n                    \n                    var buffer = unicode2buffer( \n                        '--' + boundary + '\\r\\n' + 'Content-Disposition: form-data; name=\"userfile\"; filename=\"myimage.png\"\\r\\n'\n                                                 + 'Content-Type: image/png\\r\\n\\r\\n'\n                    );\n                    \n                    var buffer = appendBuffer( buffer , \n                        arrayBuffer\n                    );\n                    \n                    var buffer = appendBuffer( buffer , \n                        unicode2buffer(\n                            '\\r\\n' + '--' + boundary + '--'\n                        )\n                    );\n                    \n                    request.send( buffer );\n                    alert(\"send!\");\n                }\n                oReq.send(null);\n                \n            }\n    \n            function createBoundary() {\n                var multipartChars = \"-_1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";\n                var length = 30 + Math.floor( Math.random() * 10 );\n                var boundary = \"---------------------------\";\n                for (var i=0;i < length; i++) {\n                    boundary += multipartChars.charAt( Math.floor( Math.random() * multipartChars.length ) );\n                }\n                return boundary;\n            }\n    \n            function unicode2buffer(str){\n            \n                var n = str.length,\n                    idx = -1,\n                    byteLength = 512,\n                    bytes = new Uint8Array(byteLength),\n                    i, c, _bytes;\n            \n                for(i = 0; i < n; ++i){\n                    c = str.charCodeAt(i);\n                    if(c <= 0x7F){\n                        bytes[++idx] = c;\n                    } else if(c <= 0x7FF){\n                        bytes[++idx] = 0xC0 | (c >>> 6);\n                        bytes[++idx] = 0x80 | (c & 0x3F);\n                    } else if(c <= 0xFFFF){\n                        bytes[++idx] = 0xE0 | (c >>> 12);\n                        bytes[++idx] = 0x80 | ((c >>> 6) & 0x3F);\n                        bytes[++idx] = 0x80 | (c & 0x3F);\n                    } else {\n                        bytes[++idx] = 0xF0 | (c >>> 18);\n                        bytes[++idx] = 0x80 | ((c >>> 12) & 0x3F);\n                        bytes[++idx] = 0x80 | ((c >>> 6) & 0x3F);\n                        bytes[++idx] = 0x80 | (c & 0x3F);\n                    }\n                    if(byteLength - idx <= 4){\n                        _bytes = bytes;\n                        byteLength *= 2;\n                        bytes = new Uint8Array(byteLength);\n                        bytes.set(_bytes);\n                    }\n                }\n                idx++;\n                \n                var result = new Uint8Array(idx);\n                result.set(bytes.subarray(0,idx),0);\n                \n                return result.buffer;\n            }\n            \n            function appendBuffer(buf1,buf2) {\n                var uint8array = new Uint8Array(buf1.byteLength + buf2.byteLength);\n                uint8array.set(new Uint8Array(buf1),0);\n                uint8array.set(new Uint8Array(buf2),buf1.byteLength);\n                return uint8array.buffer;\n            }\n        </script>\n    </head>\n    <body>\n      <br />\n        This is a template for Monaca app.\n        <div onClick=\"sendPost();\">Click!</div>\n        <br>\n        <div onClick=\"console.log(createBoundary());\">Generate Boundary</div>\n    </body>\n    </html>\n\n### \u30dd\u30a4\u30f3\u30c8\n\n\u3000\u753b\u50cf\u30c7\u30fc\u30bf\u306a\u3069\u306f\u3001\u6587\u5b57\u5217\u5316\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u30d0\u30a4\u30ca\u30ea\u3067\u6271\u3046\u3057\u304b\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3002\n\u3000\u305d\u306e\u5834\u5408\u3001\u6587\u5b57\u5217\u90e8\u5206\u3082\u30d0\u30a4\u30ca\u30ea\u5316\u3057\u3066\u3042\u3052\u306a\u304f\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\n\u3000\u306a\u304a\u3001\u6a5f\u7a2e\u306b\u3082\u3088\u308b\u304c\u3001Android\u6a5f\u3067\u305d\u3082\u305d\u3082ArrayBuffer\u3084Uint8Array\u304c\u4f7f\u3048\u306a\u304b\u3063\u305f\u308a\u3001Ajax\u3067\u30d0\u30a4\u30c8\u5217\u3092\u6271\u3048\u306a\u3044\u5834\u5408\u3001\u4e0a\u8a18\u306e\u6a5f\u80fd\u3082\u4f7f\u3048\u306a\u3044\u306e\u3067\u6ce8\u610f\u3002\n\n\n\n\n", "tags": ["JavaScript", "Cordova"]}