{"context": " More than 1 year has passed since last update.\n\n\u60f3\u5b9a\u30b5\u30fc\u30d0\u30fc\n\napl(\u53ce\u96c6\u30b5\u30fc\u30d0\u30fc)\nfluentd\u3092\u8d77\u52d5\u3057\u305f\u96c6\u7d04\u30b5\u30fc\u30d0\u30fc\n\u30ed\u30b0\u306e\u4fdd\u5b58\u3084\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3059\u308b\u30b5\u30fc\u30d0\u30fc(Growthforecast\u4f7f\u7528)\n\n\n\u6d41\u308c\napl\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092fluent-agent-lite\u3067\u53ce\u96c6\u3001fluentd\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u306b\u53d7\u3051\u6e21\u3057\u3066\u30ed\u30b0\u306e\u30d1\u30fc\u30b9\u3001\u60c5\u5831\u306e\u6574\u5f62\u3001\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\n\n\u53ce\u96c6\u30b5\u30fc\u30d0\u30fc\ncd\ngit clone git@github.com:tagomoris/fluent-agent-lite.git\nsudo mv ~/fluent-agent-lite /usr/local/src/\ncd /usr/local/src/fluent-agent-lite\nsudo ./bin/install.sh\n\nsudo vi /etc/fluent-agent-lite.conf\n\nTAG_PREFIX=\"apache\"\nLOGS=$(cat <<\"EOF\"\naccess /var/log/httpd/access_log\nEOF\n)\nPRIMARY_SERVER=\"<\u96c6\u7d04\u30b5\u30fc\u30d0\u30fcip>:24224\"\n\nsudo service fluent-agent-lite restart\n\n# \u6b63\u5e38\u306b\u8d77\u52d5\u3057\u3066\u3044\u308c\u3070\u51fa\u529b\u304c\u7121\u3044\ntail /tmp/fluent-agent.log\n\n\n\u96c6\u7d04\u30b5\u30fc\u30d0\u30fc\nsudo vi /etc/yum.repos.d/td.repo\n\n[treasuredata]\nname=TreasureData\nbaseurl=http://packages.treasure-data.com/redhat/$basearch\ngpgcheck=0\n\nsudo yum install td-agent\n\nsudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-file-alternative fluent-plugin-parser fluent-plugin-forest fluent-plugin-amplifier-filter fluent-plugin-numeric-monitor fluent-plugin-growthforecast fluent-plugin-rewrite\n\nsudo chgrp td-agent /var/log/httpd/\nsudo chmod g+rx /var/log/httpd/\n\nsudo mv /etc/td-agent/td-agent.conf /etc/td-agent/td-agent.conf.orig\nsudo vi /etc/td-agent/td-agent.conf\n\n<source>\n  type forward\n</source>\n\n# access\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\n<match apache.access.** >\n    type parser\n    remove_prefix apache.access\n    add_prefix parsed\n    format /^(?<host>[^ ]*) [^ ]+ [^ ]+ \\[(?<log_time>.+)\\] \"(?<method>[^ ]+) (?<path>[^ ]+) (?<protocol>[^\"]+)+\" (?<status>[^ ]+) (?<body_bytes_sent>[^ ]+) \"(?<referer>[^\"]+)\" \"(?<user_agent>[^\"]+)\" (?<response_time>[^ ]+) \"(?<x_forwarded_for>[^\"]+)\"/\n    time_format %d/%b/%Y:%H:%M:%S %z\n    key_name message\n</match>\n\n# \u4e0d\u8981\u30ed\u30b0\u306e\u524a\u9664\n<match parsed.** >\n  type rewrite\n\n  remove_prefix parsed\n  add_prefix filtered\n\n  <rule>\n    key     path\n    pattern ^\\/(?:images|js|img|favicon)\n    ignore  true\n  </rule>\n  <rule>\n    key     response_time\n    pattern ^$\n    ignore  true\n  </rule>\n  <rule>\n    key     status\n    pattern ^(?!200)\\d+$\n    ignore  true\n  </rule>\n  <rule>\n    key     method\n    pattern ^(?!GET).+$\n    ignore  true\n  </rule>\n  # \u30a2\u30af\u30bb\u30b9\u306e\u30d1\u30b9\u304b\u3089\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u308b\n  <rule>\n    key     path\n    pattern ^/([a-zA-Z]+).+$\n    append_to_tag true\n    fallback other\n  </rule>\n</match>\n\n# \u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\u3092\u30df\u30ea\u79d2\u306b\n<match filtered.**>\n  type amplifier_filter\n  remove_prefix filtered\n  add_prefix amplified\n  ratio      1000\n  key_names  response_time\n</match>\n\n# \u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\u3092\u96c6\u8a08\u3001\u5e73\u5747\u5024\u7b49\u306e\u7b97\u51fa\n<match amplified.** >\n  type numeric_monitor\n  #unit minute\n  monitor_key response_time\n\n  input_tag_remove_prefix amplified\n  tag apache.response\n  aggregate all\n  percentiles 90,95\n</match>\n\n# grh\u5316\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\n<match apache.response.**>\n  type copy\n  <store>\n    type      growthforecast\n    remove_prefix response_time\n    gfapi_url http://<growthforecast>:5125/api/\n    service   cat\n    tag_for   section\n    name_key_pattern .*_(num|avg|max|min|percentile_\\d+)\n  </store>\n\n  <store>\n    type file\n    path /var/log/td-agent/growthforecast.log\n  </store>\n</match>\n\nsudo chkconfig td-agent on\nsudo service td-agent restart\n\n# \u78ba\u8a8d\ntail -f /var/log/td-agent/parserd-httpd-access*\n\n\n\u30b0\u30e9\u30d5\u5316\u30b5\u30fc\u30d0\u30fc\ngrowthforecast\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066web\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3088\u3046\u306b\napache\u3067\u30db\u30b9\u30c8\u3057\u3066\u3044\u306a\u3044\nsudo yum install gcc pkgconfig glib2-devel gettext libxml2-devel pango-devel cairo-devel\nsudo yum install ipa-gothic-fonts ipa-mincho-fonts ipa-pgothic-fonts ipa-pmincho-fonts\n\nsudo useradd growthforecast\n\nsudo su - growthforecast\n\ncurl -kL http://install.perlbrew.pl | bash\necho '[[ -s \"$HOME/perl5/perlbrew/etc/bashrc\" ]] && source \"$HOME/perl5/perlbrew/etc/bashrc\"' >> .bash_profile\nsource $HOME/perl5/perlbrew/etc/bashrc\n\nperlbrew install perl-5.16.2\n# \u9577\u3044\n# install\u4e2d\u306e\u30ed\u30b0\u51fa\u529b sudo tail -f /home/growthforecast/perl5/perlbrew/build.perl-5.16.2.log\nperlbrew switch perl-5.16.2\nperl -v\n\nperlbrew install-cpanm\ncpanm -n GrowthForecast\nmkdir data\n\nexit\n\nwget -nd -O - https://github.com/hiro-su/gf-sample/archive/master.tar.gz|tar zxvf -\n\ncd gf-sample-master\nvi growthforecast\n\nperl $HOME/GrowthForecast/growthforecast.pl --port=5125 --host 0.0.0.0 --front-proxy 0.0.0.0 \\\n\n\u2b07\n\ngrowthforecast.pl --data-dir=/home/growthforecast/data --port=5125 --host 0.0.0.0 --front-proxy 0.0.0.0 \\\n\nsudo cp -rp growthforecast /etc/init.d\nchmod +x /etc/init.d/growthforecast\nsudo mkdir /var/run/growthforecast\nsudo mkdir /var/log/growthforecast\n\nsudo service growthforecast start\n\n# \u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\ncurl http://localhost:5125\n\n\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\nhttp://<hostname>:5125\n# \u30c7\u30fc\u30bf\u306e\u767b\u9332\u304c\u51fa\u6765\u308b\u304b\u78ba\u8a8d\ncurl -F number=10 http://localhost:5125/api/socialgame/member/register\n\n\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u3044\u308b\u306e\u3092\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304f\u308b\u30d1\u30b9\u3067\u5206\u3051\u3066\u3044\u308b\u3093\u3060\u3051\u3069\u3001\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u304c\u30a4\u30df\u30ef\u30ab\u30e9\u30f3\u30d1\u30b9\u306e\u3082\u306e\u3082\u6df7\u3056\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u5de5\u592b\u5fc5\u8981\u3002php\u304b\u3089apache\u30ed\u30b0\u306b\u8868\u793a\u3055\u305b\u308b\u95a2\u6570\u4f7f\u3063\u305f\u308a\u3068\u304b\u3002\n\u5f8c\u304b\u3089chef\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306b\u66f8\u304d\u63db\u3048\u305f\u3093\u3060\u3051\u3069\u3001chef\u306eservice\u3067start\u3059\u308b\u3068fluent-agent-lite\u304c\u4e00\u5ea6\u306f\u8d77\u52d5\u3059\u308b\u3093\u3060\u3051\u3069\u8b0e\u306e\u7570\u5e38\u7d42\u4e86\u3092\u8d77\u3053\u3059\u306e\u3067\u7d50\u5c40\u624b\u52d5\u3067\u8d77\u52d5\u3059\u308b\u4e8b\u306b\u3002\u4f55\u304b\u539f\u56e0\u77e5\u3063\u3066\u308b\u4eba\u3044\u306a\u3044\u3067\u3059\u304b\u306d\u3002\n\u4ee5\u4e0a\u3002\n## \u60f3\u5b9a\u30b5\u30fc\u30d0\u30fc\n1. apl(\u53ce\u96c6\u30b5\u30fc\u30d0\u30fc)\n2. fluentd\u3092\u8d77\u52d5\u3057\u305f\u96c6\u7d04\u30b5\u30fc\u30d0\u30fc\n3. \u30ed\u30b0\u306e\u4fdd\u5b58\u3084\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3059\u308b\u30b5\u30fc\u30d0\u30fc(Growthforecast\u4f7f\u7528)\n\n## \u6d41\u308c\napl\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092fluent-agent-lite\u3067\u53ce\u96c6\u3001fluentd\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u306b\u53d7\u3051\u6e21\u3057\u3066\u30ed\u30b0\u306e\u30d1\u30fc\u30b9\u3001\u60c5\u5831\u306e\u6574\u5f62\u3001\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\n\n\n## \u53ce\u96c6\u30b5\u30fc\u30d0\u30fc\n\n    cd\n    git clone git@github.com:tagomoris/fluent-agent-lite.git\n    sudo mv ~/fluent-agent-lite /usr/local/src/\n    cd /usr/local/src/fluent-agent-lite\n    sudo ./bin/install.sh\n\n    sudo vi /etc/fluent-agent-lite.conf\n\n```\nTAG_PREFIX=\"apache\"\nLOGS=$(cat <<\"EOF\"\naccess /var/log/httpd/access_log\nEOF\n)\nPRIMARY_SERVER=\"<\u96c6\u7d04\u30b5\u30fc\u30d0\u30fcip>:24224\"\n```\n\n    sudo service fluent-agent-lite restart\n\n    # \u6b63\u5e38\u306b\u8d77\u52d5\u3057\u3066\u3044\u308c\u3070\u51fa\u529b\u304c\u7121\u3044\n    tail /tmp/fluent-agent.log\n\n## \u96c6\u7d04\u30b5\u30fc\u30d0\u30fc\n\n    sudo vi /etc/yum.repos.d/td.repo\n\n```\n[treasuredata]\nname=TreasureData\nbaseurl=http://packages.treasure-data.com/redhat/$basearch\ngpgcheck=0\n```\n\n    sudo yum install td-agent\n\n    sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-file-alternative fluent-plugin-parser fluent-plugin-forest fluent-plugin-amplifier-filter fluent-plugin-numeric-monitor fluent-plugin-growthforecast fluent-plugin-rewrite\n\n    sudo chgrp td-agent /var/log/httpd/\n    sudo chmod g+rx /var/log/httpd/\n\n    sudo mv /etc/td-agent/td-agent.conf /etc/td-agent/td-agent.conf.orig\n    sudo vi /etc/td-agent/td-agent.conf\n\n\n```\n<source>\n  type forward\n</source>\n\n# access\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\n<match apache.access.** >\n    type parser\n    remove_prefix apache.access\n    add_prefix parsed\n    format /^(?<host>[^ ]*) [^ ]+ [^ ]+ \\[(?<log_time>.+)\\] \"(?<method>[^ ]+) (?<path>[^ ]+) (?<protocol>[^\"]+)+\" (?<status>[^ ]+) (?<body_bytes_sent>[^ ]+) \"(?<referer>[^\"]+)\" \"(?<user_agent>[^\"]+)\" (?<response_time>[^ ]+) \"(?<x_forwarded_for>[^\"]+)\"/\n    time_format %d/%b/%Y:%H:%M:%S %z\n    key_name message\n</match>\n\n# \u4e0d\u8981\u30ed\u30b0\u306e\u524a\u9664\n<match parsed.** >\n  type rewrite\n\n  remove_prefix parsed\n  add_prefix filtered\n\n  <rule>\n    key     path\n    pattern ^\\/(?:images|js|img|favicon)\n    ignore  true\n  </rule>\n  <rule>\n    key     response_time\n    pattern ^$\n    ignore  true\n  </rule>\n  <rule>\n    key     status\n    pattern ^(?!200)\\d+$\n    ignore  true\n  </rule>\n  <rule>\n    key     method\n    pattern ^(?!GET).+$\n    ignore  true\n  </rule>\n  # \u30a2\u30af\u30bb\u30b9\u306e\u30d1\u30b9\u304b\u3089\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u308b\n  <rule>\n    key     path\n    pattern ^/([a-zA-Z]+).+$\n    append_to_tag true\n    fallback other\n  </rule>\n</match>\n\n# \u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\u3092\u30df\u30ea\u79d2\u306b\n<match filtered.**>\n  type amplifier_filter\n  remove_prefix filtered\n  add_prefix amplified\n  ratio      1000\n  key_names  response_time\n</match>\n\n# \u30ec\u30b9\u30dd\u30f3\u30b9\u30bf\u30a4\u30e0\u3092\u96c6\u8a08\u3001\u5e73\u5747\u5024\u7b49\u306e\u7b97\u51fa\n<match amplified.** >\n  type numeric_monitor\n  #unit minute\n  monitor_key response_time\n\n  input_tag_remove_prefix amplified\n  tag apache.response\n  aggregate all\n  percentiles 90,95\n</match>\n\n# grh\u5316\u30b5\u30fc\u30d0\u30fc\u306b\u9001\u4fe1\n<match apache.response.**>\n  type copy\n  <store>\n    type      growthforecast\n    remove_prefix response_time\n    gfapi_url http://<growthforecast>:5125/api/\n    service   cat\n    tag_for   section\n    name_key_pattern .*_(num|avg|max|min|percentile_\\d+)\n  </store>\n\n  <store>\n    type file\n    path /var/log/td-agent/growthforecast.log\n  </store>\n</match>\n```\n\n    sudo chkconfig td-agent on\n    sudo service td-agent restart\n\n    # \u78ba\u8a8d\n    tail -f /var/log/td-agent/parserd-httpd-access*\n\n## \u30b0\u30e9\u30d5\u5316\u30b5\u30fc\u30d0\u30fc\n\ngrowthforecast\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066web\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3088\u3046\u306b\napache\u3067\u30db\u30b9\u30c8\u3057\u3066\u3044\u306a\u3044\n\n    sudo yum install gcc pkgconfig glib2-devel gettext libxml2-devel pango-devel cairo-devel\n    sudo yum install ipa-gothic-fonts ipa-mincho-fonts ipa-pgothic-fonts ipa-pmincho-fonts\n\n    sudo useradd growthforecast\n\n    sudo su - growthforecast\n\n    curl -kL http://install.perlbrew.pl | bash\n    echo '[[ -s \"$HOME/perl5/perlbrew/etc/bashrc\" ]] && source \"$HOME/perl5/perlbrew/etc/bashrc\"' >> .bash_profile\n    source $HOME/perl5/perlbrew/etc/bashrc\n\n    perlbrew install perl-5.16.2\n    # \u9577\u3044\n    # install\u4e2d\u306e\u30ed\u30b0\u51fa\u529b sudo tail -f /home/growthforecast/perl5/perlbrew/build.perl-5.16.2.log\n    perlbrew switch perl-5.16.2\n    perl -v\n\n    perlbrew install-cpanm\n    cpanm -n GrowthForecast\n    mkdir data\n\n    exit\n\n    wget -nd -O - https://github.com/hiro-su/gf-sample/archive/master.tar.gz|tar zxvf -\n\n    cd gf-sample-master\n    vi growthforecast\n\n```\nperl $HOME/GrowthForecast/growthforecast.pl --port=5125 --host 0.0.0.0 --front-proxy 0.0.0.0 \\\n\n\u2b07\n\ngrowthforecast.pl --data-dir=/home/growthforecast/data --port=5125 --host 0.0.0.0 --front-proxy 0.0.0.0 \\\n```\n\n    sudo cp -rp growthforecast /etc/init.d\n    chmod +x /etc/init.d/growthforecast\n    sudo mkdir /var/run/growthforecast\n    sudo mkdir /var/log/growthforecast\n\n    sudo service growthforecast start\n\n    # \u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n    curl http://localhost:5125\n\n\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\n`http://<hostname>:5125`\n\n    # \u30c7\u30fc\u30bf\u306e\u767b\u9332\u304c\u51fa\u6765\u308b\u304b\u78ba\u8a8d\n    curl -F number=10 http://localhost:5125/api/socialgame/member/register\n\n\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u3044\u308b\u306e\u3092\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304f\u308b\u30d1\u30b9\u3067\u5206\u3051\u3066\u3044\u308b\u3093\u3060\u3051\u3069\u3001\u30b0\u30eb\u30fc\u30d7\u5206\u3051\u304c\u30a4\u30df\u30ef\u30ab\u30e9\u30f3\u30d1\u30b9\u306e\u3082\u306e\u3082\u6df7\u3056\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u5de5\u592b\u5fc5\u8981\u3002php\u304b\u3089apache\u30ed\u30b0\u306b\u8868\u793a\u3055\u305b\u308b\u95a2\u6570\u4f7f\u3063\u305f\u308a\u3068\u304b\u3002\n\n\u5f8c\u304b\u3089chef\u306e\u30af\u30c3\u30af\u30d6\u30c3\u30af\u306b\u66f8\u304d\u63db\u3048\u305f\u3093\u3060\u3051\u3069\u3001chef\u306eservice\u3067start\u3059\u308b\u3068fluent-agent-lite\u304c\u4e00\u5ea6\u306f\u8d77\u52d5\u3059\u308b\u3093\u3060\u3051\u3069\u8b0e\u306e\u7570\u5e38\u7d42\u4e86\u3092\u8d77\u3053\u3059\u306e\u3067\u7d50\u5c40\u624b\u52d5\u3067\u8d77\u52d5\u3059\u308b\u4e8b\u306b\u3002\u4f55\u304b\u539f\u56e0\u77e5\u3063\u3066\u308b\u4eba\u3044\u306a\u3044\u3067\u3059\u304b\u306d\u3002\n\n\n\u4ee5\u4e0a\u3002", "tags": ["fluentd", "growthforecast"]}