{"context": "\n\n1. etcd\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\netcd\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u3001/var/lib/etcd\uff08\u30c7\u30d5\u30a9\u30eb\u30c8)\u914d\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u308b\u3002\n\u4e0b\u8a182\u3064\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u69cb\u6210\u3055\u308c\u308b\u3002wal\u3068snap\u306f\u5225\u306e\u5834\u6240\u306b\u7f6e\u304f\u3053\u3068\u304c\u53ef\u80fd\u3002\n\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u540d\u524d\n\u7528\u9014\n\n\n\n\nwal(write ahead log)\nwrite ahead log \u3068\u306f???\n\n\nsnap\nsnapshots\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3002snapshots\u3068\u306f\u4f55?\n\n\n\n\n2. \u74b0\u5883\n\n2\u53f0\u69cb\u6210(\u30db\u30b9\u30c8\u540d\u306fmaster1,master2)\n\n\n3. \u78ba\u8a8d\u306b\u4f7f\u7528\u3057\u305fetcdclt\u30b3\u30de\u30f3\u30c9\u7248\u6570\n[root@master1 ~]# etcdctl --version\netcdctl version 2.3.7\n\n\n4. etcdctl\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\n\n4.1 \u30d8\u30eb\u30d7\u306e\u4f7f\u3044\u65b9\n\netcdctl\u30b3\u30de\u30f3\u30c9\u306e\u5f8c\u306b-h\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# etcdctl -h\nNAME:\n   etcdctl - A simple command line client for etcd.\n\nUSAGE:\n   etcdctl [global options] command [command options] [arguments...]\n\nVERSION:\n   2.3.7\n\nCOMMANDS:\n   backup               backup an etcd directory\n   cluster-health       check the health of the etcd cluster\n   mk                   make a new key with a given value\n   mkdir                make a new directory\n   rm                   remove a key or a directory\n   rmdir                removes the key if it is an empty directory or a key-value pair\n   get                  retrieve the value of a key\n   ls                   retrieve a directory\n   set                  set the value of a key\n   setdir               create a new directory or update an existing directory TTL\n   update               update an existing key with a given value\n   updatedir            update an existing directory\n   watch                watch a key for changes\n   exec-watch           watch a key for changes and exec an executable\n   member               member add, remove and list subcommands\n   import               import a snapshot to a cluster\n   user                 user add, grant and revoke subcommands\n   role                 role add, grant and revoke subcommands\n   auth                 overall auth controls\n   help, h              Shows a list of commands or help for one command\n\n\u4ee5\u4e0b\u3001\u7565\n\n\n4.2 \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306e\u30d8\u30eb\u30d7\u306e\u4f7f\u3044\u65b9\n\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306e\u5f8c\u306b-h\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# etcdctl ls -h\nNAME:\n   etcdctl ls - retrieve a directory\n\nUSAGE:\n   etcdctl ls [command options] [key]\n\nOPTIONS:\n   --sort       returns result in sorted order\n   --recursive  returns all key names recursively for the given path\n   -p           append slash (/) to directories\n   --quorum     require quorum for get request\n\n[root@master1 ~]# etcdctl backup -h\nNAME:\n   etcdctl backup - backup an etcd directory\n\nUSAGE:\n   etcdctl backup [command options]\n\nOPTIONS:\n   --data-dir           Path to the etcd data dir\n   --wal-dir            Path to the etcd wal dir\n   --backup-dir         Path to the backup dir\n   --backup-wal-dir     Path to the backup wal dir\n   --keep-cluster-id    Do not rewrite the cluster id\n   --node-id            Use custom node id instead of a random value\n\n\n\n4.3 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3059\u308b(ls)\n[root@master1 ~]# etcdctl ls\n/scheduler\n/registry\n/controller\n\n/a/b\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b(mkdir)\n[root@master1 ~]# etcdctl mkdir /a/b\n\n/a\u914d\u4e0b\u306bb\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl ls /a\n/a/b\n\n\n\n4.4 \u30ad\u30fc\uff06\u30d0\u30ea\u30e5\u30fc\u306e\u8a2d\u5b9a\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u306bos=centos6\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n[root@master1 ~]# etcdctl get /a/b/os\ncentos6\n\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u306bcar=GT-R\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/car GT-R\nGT-R\n[root@master1 ~]# etcdctl get /a/b/car\nGT-R\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u914d\u4e0b\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls /a/b\n/a/b/os\n/a/b/car\n\n/a\u914d\u4e0b\u3092\u518d\u5e30\u7684\u306b\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls /a --recursive\n/a/b\n/a/b/os\n/a/b/car\n\nmaster2\u3067\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u914d\u4e0b\u3092\u78ba\u8a8d\u3059\u308b\u3002master1\u3068\u540c\u3058\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u305f\u3002\n[root@master2 ~]# etcdctl ls /a/b\n/a/b/os\n/a/b/car\n\n\n\n4.5 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\u30ad\u30fc&\u30d0\u30ea\u30e5\u30fc\u306e\u524a\u9664\nmaster2\u3067os=centos6\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rm /a/b/os\nPrevNode.Value: centos6\n\n\u524a\u9664\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3002os=centos6\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl get /a/b/os\nError:  100: Key not found (/a/b/os) [888]\n\ncar=GT-R\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rm /a/b/car\nPrevNode.Value: GT-R\n\n\u524a\u9664\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3002car=GT-R\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl get /a/b/car\nError:  100: Key not found (/a/b/car) [902]\n\nos=centos6,car=GT-R\u304c\u4e21\u65b9\u3068\u3082\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls /a/b\n[root@master2 ~]#\n\nb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rmdir /a/b\n\na\u914d\u4e0b\u306eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls /a\n[root@master2 ~]#\n\na\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rmdir /a\n\na\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls\n/scheduler\n/registry\n/controller\n\n\n4.6 \u6307\u5b9a\u3057\u305f\u5024(value)\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8(update\u30aa\u30d7\u30b7\u30e7\u30f3)\u3059\u308b\u3002\n\"os\"\u3068\u3044\u3046\u30ad\u30fc\u306b\"centos6\"\u3068\u3044\u3046\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n\n\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# etcdctl get /a/b/os\ncentos6\n\nos\u3092centos7\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n[root@master1 ~]# etcdctl update /a/b/os centos7\ncentos7\n\n\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6307\u5b9a\u3057\u305f\u5024\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl get /a/b/os\ncentos7\n\n\n\n4.7 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u518d\u5e30\u7684(recursive\u30aa\u30d7\u30b7\u30e7\u30f3)\u306b\u524a\u9664\u3059\u308b\u3002\n[root@master1 ~]# etcdctl mkdir /a/b/c\n[root@master1 ~]# etcdctl ls /a --recursive\n/a/b\n/a/b/c\n[root@master1 ~]# etcdctl rm /a --recursive\n[root@master1 ~]# etcdctl ls /a --recursive\nError:  100: Key not found (/a) [1367]\n[root@master1 ~]#\n\n\n\n4.8 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5bff\u547d(ttl\u30aa\u30d7\u30b7\u30e7\u30f3)\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n10\u79d2\u9593\u3060\u3051\u5b58\u5728\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# etcdctl mkdir /a --ttl 10;date\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:00:57 JST\n\n[root@master1 ~]# etcdctl ls;date\n/registry\n/controller\n/a\n/scheduler\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:00:59 JST\n\n-\u4e2d\u7565-\n\n[root@master1 ~]# etcdctl ls;date\n/scheduler\n/registry\n/controller\n/a\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:01:07 JST\n\n12\u79d2\u7d4c\u904e\u3057\u305f\u3068\u304d\u306b\u306f\u3001/a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u6d88\u3048\u3066\u3044\u308b\u3002\n[root@master1 ~]# etcdctl ls;date\n/scheduler\n/registry\n/controller\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:01:09 JST\n\n\n\n4.9 \u30ad\u30fc\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u306e\u5909\u5316(watch\u30aa\u30d7\u30b7\u30e7\u30f3)\u3092\u76e3\u8996\u3059\u308b\u3002\nos\u306bcentos6\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl mkdir /a/b\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n\nwatch\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u5024\u306e\u5909\u5316\u3092\u76e3\u8996\u3059\u308b\u3002\n[root@master1 ~]# etcdctl watch /a/b/os\n\nmaster2\u3067os\u306bcentos7\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master2 ~]# etcdctl set /a/b/os centos7\ncentos7\n\nos\u306e\u5024\u304c\u5909\u5316\u3057\u305f\u3053\u3068\u3067\u3001etcdctl\u30b3\u30de\u30f3\u30c9\u306e\u30d6\u30ed\u30c3\u30af\u304c\u89e3\u9664\u3055\u308c\u305f\u3002\n[root@master1 ~]# etcdctl watch /a/b/os\ncentos7\n\n\n\n4.10 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(--data-dir)\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ps aux|grep etcd\netcd       1024  7.8  2.2  40112 22232 ?        Ssl  19:36   9:17 /usr/bin/etcd --name=master1 --data-dir=/var/lib/etcd/default.etcd --listen-client-urls=http://0.0.0.0:2379\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# mkdir /backup\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092/backup\u914d\u4e0b\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n[root@master1 ~]# etcdctl backup --data-dir=/var/lib/etcd/default.etcd --backup-dir=/backup\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ls -R /backup/\n/backup/:\nmember\n\n/backup/member:\nsnap  wal\n\n/backup/member/snap:\n\n/backup/member/wal:\n0000000000000000-0000000000000000.wal\n\n\n\n4.11 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(wal\u306e\u307f)\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# mkdir /backup\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092/backup\u914d\u4e0b\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n[root@master1 ~]# etcdctl backup --wal-dir=/var/lib/etcd/default.etcd/member/wal --backup-wal-dir=/backup\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ls -R /backup/\n/backup/:\n0000000000000000-0000000000000000.wal\n\n\n\n4.12 \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306e\u8a73\u7d30\u60c5\u5831(--debug)\u3092\u51fa\u529b\u3059\u308b\u3002\n[root@master1 ~]# etcdctl --debug ls\nstart to sync cluster using endpoints(http://127.0.0.1:2379,http://127.0.0.1:4001)\ncURL Command: curl -X GET http://127.0.0.1:2379/v2/members\ngot endpoints(http://192.168.0.20:2379,http://192.168.0.10:2379) after sync\nCluster-Endpoints: http://192.168.0.20:2379, http://192.168.0.10:2379\ncURL Command: curl -X GET http://192.168.0.20:2379/v2/keys/?quorum=false&recursive=false&sorted=false\n/registry\n[root@master1 ~]#\n\n\n4.13 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\"/\"\u3092\u4ed8\u3051\u3066(-p)\u308f\u304b\u308a\u3084\u3059\u304f\u8868\u793a\u3059\u308b\u3002\n\u30aa\u30d7\u30b7\u30e7\u30f3(-p)\u3092\u4f7f\u308f\u306a\u3044\u3068\u3001\u3069\u308c\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u308f\u304b\u3089\u306a\u3044\u3002\n[root@master1 ~]# etcdctl ls --recursive\n/registry\n-\u4e2d\u7565-\n/registry/minions\n/registry/minions/master2\n/registry/minions/master1\n\n\u30aa\u30d7\u30b7\u30e7\u30f3(-p)\u3092\u4f7f\u3046\u3068\u3001minions\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3068\u308f\u304b\u308b\u3002master1,master2\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u30ad\u30fc\u3060\u3068\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl ls -p --recursive\n/registry/\n-\u4e2d\u7565-\n/registry/minions/\n/registry/minions/master2\n/registry/minions/master1\n\n\n\n4.14 HTTP\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3059\u308b\u3002\u73fe\u5728\u306f\u3001/registry\u306e\u307f\u5b58\u5728\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls\n/registry\n\n/\u76f4\u4e0b\u306bOS=linux\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XPUT -d \"value=linux\"\n{\"action\":\"set\",\"node\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8815,\"createdIndex\":8815}}\n\netcdctl\u30b3\u30de\u30f3\u30c9\u3067\u30ad\u30fc\u306e\u5024\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls\n/os\n/registry\n\netcdctl\u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30ea\u30e5\u30fc\u306e\u5024\u3092\u8868\u793a\u3059\u308b\u3002os\u306blinux\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# etcdctl get /os\nlinux\n\nHTTP\u3067os\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u30d0\u30ea\u30e5\u30fc\u3092\u8aad\u307f\u3060\u3059\u3002etcdctl\u30b3\u30de\u30f3\u30c9\u3068\u540c\u3058\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XGET\n{\"action\":\"get\",\"node\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8893,\"createdIndex\":8893}}\n\n\u30ad\u30fc\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XDELETE\n{\"action\":\"delete\",\"node\":{\"key\":\"/os\",\"modifiedIndex\":8962,\"createdIndex\":8893},\"prevNode\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8893,\"createdIndex\":8893}}\n\n[root@master1 ~]# etcdctl ls\n/registry\n\n\n\n5. \u53c2\u8003\u60c5\u5831\n[Deployment Considerations for ETCD in Production Kubernetes Clusters]http://cloudgeekz.com/1176/deployment-considerations-for-etcd-in-production-kubernetes-clusters.html\n#1. etcd\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\netcd\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u3001/var/lib/etcd\uff08\u30c7\u30d5\u30a9\u30eb\u30c8)\u914d\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u308b\u3002\n\u4e0b\u8a182\u3064\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3089\u69cb\u6210\u3055\u308c\u308b\u3002wal\u3068snap\u306f\u5225\u306e\u5834\u6240\u306b\u7f6e\u304f\u3053\u3068\u304c\u53ef\u80fd\u3002\n\n| \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u540d\u524d | \u7528\u9014 |\n|:----------------------|:-------------------------|\n| wal(write ahead log)  | write ahead log \u3068\u306f???  |\n| snap  | snapshots\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3002snapshots\u3068\u306f\u4f55?  |\n\n#2. \u74b0\u5883\n- 2\u53f0\u69cb\u6210(\u30db\u30b9\u30c8\u540d\u306fmaster1,master2)\n\n\n\n#3. \u78ba\u8a8d\u306b\u4f7f\u7528\u3057\u305fetcdclt\u30b3\u30de\u30f3\u30c9\u7248\u6570\n\n```\n[root@master1 ~]# etcdctl --version\netcdctl version 2.3.7\n```\n\n\n#4. etcdctl\u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u3044\u65b9\n\n\n##4.1 \u30d8\u30eb\u30d7\u306e\u4f7f\u3044\u65b9\n```\n\netcdctl\u30b3\u30de\u30f3\u30c9\u306e\u5f8c\u306b-h\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# etcdctl -h\nNAME:\n   etcdctl - A simple command line client for etcd.\n\nUSAGE:\n   etcdctl [global options] command [command options] [arguments...]\n\nVERSION:\n   2.3.7\n\nCOMMANDS:\n   backup               backup an etcd directory\n   cluster-health       check the health of the etcd cluster\n   mk                   make a new key with a given value\n   mkdir                make a new directory\n   rm                   remove a key or a directory\n   rmdir                removes the key if it is an empty directory or a key-value pair\n   get                  retrieve the value of a key\n   ls                   retrieve a directory\n   set                  set the value of a key\n   setdir               create a new directory or update an existing directory TTL\n   update               update an existing key with a given value\n   updatedir            update an existing directory\n   watch                watch a key for changes\n   exec-watch           watch a key for changes and exec an executable\n   member               member add, remove and list subcommands\n   import               import a snapshot to a cluster\n   user                 user add, grant and revoke subcommands\n   role                 role add, grant and revoke subcommands\n   auth                 overall auth controls\n   help, h              Shows a list of commands or help for one command\n\n\u4ee5\u4e0b\u3001\u7565\n```\n\n##4.2 \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306e\u30d8\u30eb\u30d7\u306e\u4f7f\u3044\u65b9\n\n```\n\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u306e\u5f8c\u306b-h\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[root@master1 ~]# etcdctl ls -h\nNAME:\n   etcdctl ls - retrieve a directory\n\nUSAGE:\n   etcdctl ls [command options] [key]\n\nOPTIONS:\n   --sort       returns result in sorted order\n   --recursive  returns all key names recursively for the given path\n   -p           append slash (/) to directories\n   --quorum     require quorum for get request\n\n[root@master1 ~]# etcdctl backup -h\nNAME:\n   etcdctl backup - backup an etcd directory\n\nUSAGE:\n   etcdctl backup [command options]\n\nOPTIONS:\n   --data-dir           Path to the etcd data dir\n   --wal-dir            Path to the etcd wal dir\n   --backup-dir         Path to the backup dir\n   --backup-wal-dir     Path to the backup wal dir\n   --keep-cluster-id    Do not rewrite the cluster id\n   --node-id            Use custom node id instead of a random value\n\n```\n\n\n##4.3 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n```\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3059\u308b(ls)\n[root@master1 ~]# etcdctl ls\n/scheduler\n/registry\n/controller\n\n/a/b\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b(mkdir)\n[root@master1 ~]# etcdctl mkdir /a/b\n\n/a\u914d\u4e0b\u306bb\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl ls /a\n/a/b\n\n```\n\n##4.4 \u30ad\u30fc\uff06\u30d0\u30ea\u30e5\u30fc\u306e\u8a2d\u5b9a\n\n```\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u306bos=centos6\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n[root@master1 ~]# etcdctl get /a/b/os\ncentos6\n\n\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u306bcar=GT-R\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/car GT-R\nGT-R\n[root@master1 ~]# etcdctl get /a/b/car\nGT-R\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u914d\u4e0b\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls /a/b\n/a/b/os\n/a/b/car\n\n/a\u914d\u4e0b\u3092\u518d\u5e30\u7684\u306b\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls /a --recursive\n/a/b\n/a/b/os\n/a/b/car\n\nmaster2\u3067\u3082\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/a/b)\u914d\u4e0b\u3092\u78ba\u8a8d\u3059\u308b\u3002master1\u3068\u540c\u3058\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u305f\u3002\n[root@master2 ~]# etcdctl ls /a/b\n/a/b/os\n/a/b/car\n\n```\n\n\n##4.5 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\u30ad\u30fc&\u30d0\u30ea\u30e5\u30fc\u306e\u524a\u9664\n\n```\nmaster2\u3067os=centos6\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rm /a/b/os\nPrevNode.Value: centos6\n\n\u524a\u9664\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3002os=centos6\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl get /a/b/os\nError:  100: Key not found (/a/b/os) [888]\n\ncar=GT-R\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rm /a/b/car\nPrevNode.Value: GT-R\n\n\u524a\u9664\u3067\u304d\u305f\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3059\u308b\u3002car=GT-R\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl get /a/b/car\nError:  100: Key not found (/a/b/car) [902]\n\nos=centos6,car=GT-R\u304c\u4e21\u65b9\u3068\u3082\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls /a/b\n[root@master2 ~]#\n\nb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rmdir /a/b\n\na\u914d\u4e0b\u306eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls /a\n[root@master2 ~]#\n\na\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u524a\u9664\u3059\u308b\u3002\n[root@master2 ~]# etcdctl rmdir /a\n\na\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u524a\u9664\u3067\u304d\u305f\u3002\n[root@master2 ~]# etcdctl ls\n/scheduler\n/registry\n/controller\n```\n\n##4.6 \u6307\u5b9a\u3057\u305f\u5024(value)\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8(update\u30aa\u30d7\u30b7\u30e7\u30f3)\u3059\u308b\u3002\n\n```\n\"os\"\u3068\u3044\u3046\u30ad\u30fc\u306b\"centos6\"\u3068\u3044\u3046\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n\n\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# etcdctl get /a/b/os\ncentos6\n\nos\u3092centos7\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n[root@master1 ~]# etcdctl update /a/b/os centos7\ncentos7\n\n\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\u6307\u5b9a\u3057\u305f\u5024\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl get /a/b/os\ncentos7\n\n```\n\n\n##4.7 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u518d\u5e30\u7684(recursive\u30aa\u30d7\u30b7\u30e7\u30f3)\u306b\u524a\u9664\u3059\u308b\u3002\n\n```\n[root@master1 ~]# etcdctl mkdir /a/b/c\n[root@master1 ~]# etcdctl ls /a --recursive\n/a/b\n/a/b/c\n[root@master1 ~]# etcdctl rm /a --recursive\n[root@master1 ~]# etcdctl ls /a --recursive\nError:  100: Key not found (/a) [1367]\n[root@master1 ~]#\n\n```\n\n\n##4.8 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5bff\u547d(ttl\u30aa\u30d7\u30b7\u30e7\u30f3)\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```\n10\u79d2\u9593\u3060\u3051\u5b58\u5728\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# etcdctl mkdir /a --ttl 10;date\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:00:57 JST\n\n[root@master1 ~]# etcdctl ls;date\n/registry\n/controller\n/a\n/scheduler\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:00:59 JST\n\n-\u4e2d\u7565-\n\n[root@master1 ~]# etcdctl ls;date\n/scheduler\n/registry\n/controller\n/a\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:01:07 JST\n\n12\u79d2\u7d4c\u904e\u3057\u305f\u3068\u304d\u306b\u306f\u3001/a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u6d88\u3048\u3066\u3044\u308b\u3002\n[root@master1 ~]# etcdctl ls;date\n/scheduler\n/registry\n/controller\n2016\u5e74 11\u6708 15\u65e5 \u706b\u66dc\u65e5 21:01:09 JST\n\n```\n\n\n##4.9 \u30ad\u30fc\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u5024\u306e\u5909\u5316(watch\u30aa\u30d7\u30b7\u30e7\u30f3)\u3092\u76e3\u8996\u3059\u308b\u3002\n\n```\nos\u306bcentos6\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl mkdir /a/b\n[root@master1 ~]# etcdctl set /a/b/os centos6\ncentos6\n\nwatch\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u5024\u306e\u5909\u5316\u3092\u76e3\u8996\u3059\u308b\u3002\n[root@master1 ~]# etcdctl watch /a/b/os\n\nmaster2\u3067os\u306bcentos7\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master2 ~]# etcdctl set /a/b/os centos7\ncentos7\n\nos\u306e\u5024\u304c\u5909\u5316\u3057\u305f\u3053\u3068\u3067\u3001etcdctl\u30b3\u30de\u30f3\u30c9\u306e\u30d6\u30ed\u30c3\u30af\u304c\u89e3\u9664\u3055\u308c\u305f\u3002\n[root@master1 ~]# etcdctl watch /a/b/os\ncentos7\n\n```\n\n##4.10 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n\n```\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(--data-dir)\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ps aux|grep etcd\netcd       1024  7.8  2.2  40112 22232 ?        Ssl  19:36   9:17 /usr/bin/etcd --name=master1 --data-dir=/var/lib/etcd/default.etcd --listen-client-urls=http://0.0.0.0:2379\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# mkdir /backup\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092/backup\u914d\u4e0b\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n[root@master1 ~]# etcdctl backup --data-dir=/var/lib/etcd/default.etcd --backup-dir=/backup\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ls -R /backup/\n/backup/:\nmember\n\n/backup/member:\nsnap  wal\n\n/backup/member/snap:\n\n/backup/member/wal:\n0000000000000000-0000000000000000.wal\n\n```\n\n\n##4.11 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9(wal\u306e\u307f)\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n\n```\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@master1 ~]# mkdir /backup\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092/backup\u914d\u4e0b\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3002\n[root@master1 ~]# etcdctl backup --wal-dir=/var/lib/etcd/default.etcd/member/wal --backup-wal-dir=/backup\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@master1 ~]# ls -R /backup/\n/backup/:\n0000000000000000-0000000000000000.wal\n\n```\n\n##4.12 \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306e\u8a73\u7d30\u60c5\u5831(--debug)\u3092\u51fa\u529b\u3059\u308b\u3002\n```\n[root@master1 ~]# etcdctl --debug ls\nstart to sync cluster using endpoints(http://127.0.0.1:2379,http://127.0.0.1:4001)\ncURL Command: curl -X GET http://127.0.0.1:2379/v2/members\ngot endpoints(http://192.168.0.20:2379,http://192.168.0.10:2379) after sync\nCluster-Endpoints: http://192.168.0.20:2379, http://192.168.0.10:2379\ncURL Command: curl -X GET http://192.168.0.20:2379/v2/keys/?quorum=false&recursive=false&sorted=false\n/registry\n[root@master1 ~]#\n```\n\n##4.13 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\"/\"\u3092\u4ed8\u3051\u3066(-p)\u308f\u304b\u308a\u3084\u3059\u304f\u8868\u793a\u3059\u308b\u3002\n\n```\n\u30aa\u30d7\u30b7\u30e7\u30f3(-p)\u3092\u4f7f\u308f\u306a\u3044\u3068\u3001\u3069\u308c\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u308f\u304b\u3089\u306a\u3044\u3002\n[root@master1 ~]# etcdctl ls --recursive\n/registry\n-\u4e2d\u7565-\n/registry/minions\n/registry/minions/master2\n/registry/minions/master1\n\n\u30aa\u30d7\u30b7\u30e7\u30f3(-p)\u3092\u4f7f\u3046\u3068\u3001minions\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3068\u308f\u304b\u308b\u3002master1,master2\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u30ad\u30fc\u3060\u3068\u308f\u304b\u308b\u3002\n[root@master1 ~]# etcdctl ls -p --recursive\n/registry/\n-\u4e2d\u7565-\n/registry/minions/\n/registry/minions/master2\n/registry/minions/master1\n\n```\n\n##4.14 HTTP\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n```\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3059\u308b\u3002\u73fe\u5728\u306f\u3001/registry\u306e\u307f\u5b58\u5728\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls\n/registry\n\n/\u76f4\u4e0b\u306bOS=linux\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XPUT -d \"value=linux\"\n{\"action\":\"set\",\"node\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8815,\"createdIndex\":8815}}\n\netcdctl\u30b3\u30de\u30f3\u30c9\u3067\u30ad\u30fc\u306e\u5024\u3092\u8868\u793a\u3059\u308b\u3002\n[root@master1 ~]# etcdctl ls\n/os\n/registry\n\netcdctl\u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30ea\u30e5\u30fc\u306e\u5024\u3092\u8868\u793a\u3059\u308b\u3002os\u306blinux\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n[root@master1 ~]# etcdctl get /os\nlinux\n\nHTTP\u3067os\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u30d0\u30ea\u30e5\u30fc\u3092\u8aad\u307f\u3060\u3059\u3002etcdctl\u30b3\u30de\u30f3\u30c9\u3068\u540c\u3058\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XGET\n{\"action\":\"get\",\"node\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8893,\"createdIndex\":8893}}\n\n\u30ad\u30fc\u3092\u524a\u9664\u3059\u308b\u3002\n[root@master1 ~]# curl http://localhost:2379/v2/keys/os -XDELETE\n{\"action\":\"delete\",\"node\":{\"key\":\"/os\",\"modifiedIndex\":8962,\"createdIndex\":8893},\"prevNode\":{\"key\":\"/os\",\"value\":\"linux\",\"modifiedIndex\":8893,\"createdIndex\":8893}}\n\n[root@master1 ~]# etcdctl ls\n/registry\n\n```\n\n\n#5. \u53c2\u8003\u60c5\u5831\n[Deployment Considerations for ETCD in Production Kubernetes Clusters]http://cloudgeekz.com/1176/deployment-considerations-for-etcd-in-production-kubernetes-clusters.html\n\n", "tags": ["etcd", "kubernetes", "k8s", "etcdclt"]}