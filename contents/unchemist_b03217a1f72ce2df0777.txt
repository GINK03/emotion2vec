{"context": "\u524d\u56de\u3001StackStorm\u306e\u69d8\u3005\u306a\u6a5f\u80fd\u306b\u3064\u3044\u3066\u898b\u3066\u304d\u307e\u3057\u305f\u3002\n\u30a4\u30d9\u30f3\u30c8\u30c9\u30ea\u30d6\u30f3\u306a\u81ea\u52d5\u5316\u30c4\u30fc\u30eb StackStorm\u3092\u8a66\u3059\n\n\u305d\u3053\u3067\u6b8b\u3057\u3066\u3044\u305fWorkflow\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nWorkflow\u3068\u306f\n\u69d8\u3005\u306a\u5358\u4f53\u306eAction\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u6570\u306e\u51e6\u7406\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002\nStackStorm\u306b\u3068\u3063\u3066\u306f\u3001\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u4f55\u7a2e\u985e\u304b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4e0a\u306b\u884c\u304f\u307b\u3069\u30b7\u30f3\u30d7\u30eb(\u305f\u3060\u3057\u6df7\u307f\u3044\u3063\u305f\u3053\u3068\u306f\u3067\u304d\u306a\u3044)\u3001\u4e0b\u306b\u884c\u304f\u307b\u3069\u9ad8\u6a5f\u80fd(\u305f\u3060\u3057\u66f8\u304d\u65b9\u304c\u8907\u96d1\u306b\u306a\u308b)\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\nActionChain\nMistral\nMistral + YAQL\n\n\u306a\u304a\u3001\u4ed6\u306bCloudSlang\u3068\u3044\u3046\u5f62\u5f0f\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u3001Experimental\u3068\u3044\u3046\u3053\u3068\u3067\u8abf\u67fb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\nhttps://docs.stackstorm.com/workflows.html\n\nActionChain\nStackStorm\u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u8a18\u6cd5\u3067\u3001\u901f\u3055\u3068\u30b7\u30f3\u30d7\u30eb\u3055\u3092\u6c42\u3081\u308b\u306a\u3089\u3053\u308c(\u3068\u306e\u3053\u3068)\u3002\n\u305f\u3060\u3057\u3001\u898b\u305f\u611f\u3058\u306f\u3001\u5358\u7d14\u306bAction\u3092\u7e4b\u3052\u308b\u3053\u3068\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\n\u3064\u307e\u308a\u3001Action\u3092\u4e26\u5217\u3067\u5b9f\u884c\u3057\u305f\u308a\u3068\u304b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\nMistral\nOpenStack\u306eWorkflow\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308bMistral\u304c\u4f7f\u3048\u308b\u3088\u3046\u3067\u3059\u3002\n\u3064\u307e\u308a\u3001Workflow\u306e\u66f8\u304d\u65b9\u306fMistral\u306b\u5b8c\u5168\u306b\u5023\u3063\u3066\u3044\u308b\u611f\u3058\u3067\u3059\u3002\nWorkflow\u306e\u4e2d\u306bWorkflow\u3068\u304b\u3001Action\u3092\u5206\u5c90\u3055\u305b\u305f\u308a\u5408\u6d41\u3055\u305b\u305f\u308a\u3001\u3042\u308b\u3044\u306f\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3068\u3044\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nMistral:\nhttp://docs.openstack.org/developer/mistral/dsl/dsl_v2.html\n\nMistral + YAQL\nMistral\u306b\u52a0\u3048\u3066\u3001\u5909\u6570\u306b\u57fa\u3065\u3044\u3066Action\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u914d\u5217\u5f62\u5f0f\u306einput\u3092\u4e0e\u3048\u3066\u3001\u305d\u306e\u914d\u5217\u306e\u5358\u4f4d\u3067Action\u3092\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b\u3068\u304b\u3001\n\u3088\u308a\u30d7\u30ed\u30b0\u30e9\u30de\u30d6\u30eb\u306bWorkflow\u3092\u69cb\u6210\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\nYAQL\u306f\u3001Yet Another Query Language \u306e\u7565\u3067\u3001\u3044\u308f\u3070JSON\u306b\u304a\u3051\u308b jq \u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306a\u3082\u306e\u306e\u7406\u89e3\u3067\u3059\u3002\n\u3064\u307e\u308a\u3001YAML\u3084JSON\u5f62\u5f0f\u306e\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u3001\u5fc5\u8981\u306a\u8981\u7d20\u3092\u62bd\u51fa\u3057\u305f\u308a\u52a0\u5de5\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nMistral + YAQL\u3067\u306f\u3001YAML\u3084JSON\u3092\u52a0\u5de5\u3057\u3066\u5024\u3092\u53d6\u308a\u51fa\u3057\u305f\u308a\u3057\u3066\u3001\u305d\u306e\u5024\u306b\u57fa\u3065\u3044\u3066Workflow\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nAnsible\u3092\u77e5\u3063\u3066\u3044\u308b\u4eba\u306a\u3089\u3001 with_items \u3068\u304b with_dict \u307f\u305f\u3044\u306a\u611f\u3058\u3067task\u3092\u56de\u305b\u308b\u3001\u3068\u3044\u3046\u3068\u4e00\u767a\u3067\u30a4\u30e1\u30fc\u30b8\u304c\u6e67\u304f\u304b\u3068\u601d\u3044\u307e\u3059\u3002\nYAQL: \nhttp://yaql.readthedocs.io/en/latest/getting_started.html\nYAQLuator(YAQL\u3092\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u30b5\u30fc\u30d3\u30b9):\nhttp://yaqluator.com/\n\n\u3069\u306eWorkflow\u3092\u4f7f\u3046\u3079\u304d\u304b\n\u3053\u306e\u3088\u3046\u306b\u3001Workflow\u3092\u4f7f\u3046\u305f\u3081\u306b\u306f\u69d8\u3005\u306a\u5b9f\u73fe\u624b\u6bb5\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\u306a\u3089\u3001\u3069\u308c\u3092\u4f7f\u3048\u3070\u3088\u3044\u304b\u3067\u3059\u304c\u3001\u6b63\u76f4ActionChain\u306f\u3084\u308a\u305f\u3044\u3053\u3068\u306b\u3059\u3050\u9650\u754c\u304c\u6765\u305d\u3046\u3067\u3059\u3057\u3001\n\u3053\u3053\u306fMistral\u3092\u899a\u3048\u3066\u3057\u307e\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nMistral\u3092\u4f7f\u3046\n\n\u8a8d\u8a3c\n\u524d\u56de\u306froot\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u901a\u5e38 st2 \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u8a8d\u8a3c\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nhttps://docs.stackstorm.com/authentication.html?highlight=user\nst2 auth st2admin -p <password> -t\n\n-t\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u30c8\u30fc\u30af\u30f3\u306e\u307f\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u308c\u3092\u3001ST2_AUTH_TOKEN \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3059\u308c\u3070\u3001\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n$ st2 action list\nERROR: 401 Client Error: Unauthorized\nMESSAGE: Unauthorized - One of Token or API key required. for url: http://127.0.0.1:9101/v1/actions\n\n$ export ST2_AUTH_TOKEN=$(st2 auth st2admin -p st2admin -t)\n$ st2 action list\n+---------------------------------+---------+--------------------------------------------------------------------+\n| ref                             | pack    | description                                                        |\n+---------------------------------+---------+--------------------------------------------------------------------+\n| chatops.format_execution_result | chatops | Format an execution result for chatops                             |\n| chatops.post_message            | chatops | Post a message to stream for chatops                               |\n(snip)\n\n\nWorkflow\u3068Action\u306e\u4f5c\u6210\u3068\u914d\u7f6e\nWorkflow\u306f\u3001Action\u3068\u30bb\u30c3\u30c8\u3067\u7d10\u4ed8\u304d\u307e\u3059\u3002\nWorkflow\u306b\u3082Action\u306b\u3082pack\u540d\u3068\u3044\u3046\u63a5\u982d\u8f9e\u304c\u3064\u304d\u3001\u3053\u306e\u540d\u524d\u3067\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u3082\u56fa\u5b9a\u7684\u306e\u3088\u3046\u3067\u3059\u3002\n\n/opt/stackstorm/packs/<pack>/actions/*.yml\n\nmetadata\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\u3069\u306eworkflow\u3092\u8aad\u307f\u8fbc\u3080\u304b\u3068\u304b\u3001\u3069\u3093\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5fc5\u8981\u304b\u306a\u3069\u3001\u5168\u4f53\u7684\u306a\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\n/opt/stackstorm/packs/test/actions/mistral-basic.yaml\n---\ndescription: Run a local linux command\nenabled: true\nentry_point: workflows/mistral-basic.yaml\nname: mistral-basic\npack: test\nparameters:\n  cmd:\n    required: true\n    type: string\nrunner_type: mistral-v2\n\n\n\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\ncmd\u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5b9f\u884c\u6642\u306b\u5165\u529b\u5fc5\u9808\n\nWorkflow\u3092mistral-v2` \u3067\u52d5\u304b\u3059\n\n\n/opt/stackstorm/packs/<pack>/actions/workflows/*.yml\n\nWorkflow\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u51e6\u7406\u306e\u4e2d\u8eab\u3092\u66f8\u304d\u307e\u3059\u3002\n\n/opt/stackstorm/packs/test/actions/workflows/mistral-basic.yaml\nversion: '2.0'\n\ntest.mistral-basic:\n    description: A basic workflow that runs an arbitrary linux command.\n    type: direct\n    input:\n        - cmd\n    output:\n        stdout: <% $.stdout %>\n    tasks:\n        task1:\n            action: core.local cmd=<% $.cmd %>\n            publish:\n                stdout: <% task(task1).result.stdout %>\n                stderr: <% task(task1).result.stderr %>\n\n\n\u5fc5\u305a/opt/stackstorm/pack\u306b\u7f6e\u304b\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u53cd\u6620\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\u914d\u7f6e\u5148\u3092\u5909\u66f4\u3059\u308b\u5834\u5408\u306f\u3001 /etc/st2/st2.conf \u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059(\u672a\u78ba\u8a8d)1\u3002\n[content]\npacks_base_paths=/home/myuser1/packs:/home/myuser2/packs\n\n\u914d\u7f6e\u5f8c\u3001\u30b8\u30e7\u30d6\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n$ st2 action create /opt/stackstorm/packs/test/actions/mistral-basic.yaml\n(snip)\n\n\nWorkflow\u306e\u5b9f\u884c\nAction\u3092\u5b9f\u884c\u3059\u308b\u6642\u3068\u540c\u3058\u304f\u3001 st2 run <workflow\u540d> \u3067\u3067\u304d\u307e\u3059\u3002\ncmd\u3092\u5165\u529b\u5fc5\u9808\u306b\u3057\u305f\u306e\u3067\u3001\u4f55\u3082\u4e0e\u3048\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n$ st2 run test.mistral-basic\nERROR: 400 Client Error: Bad Request\nMESSAGE: 'cmd' is a required property for url: http://127.0.0.1:9101/v1/executions\n\n\u307e\u305f\u3001\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3068\u5b8c\u4e86\u307e\u3067\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u623b\u3063\u3066\u304d\u307e\u305b\u3093\u304c\u3001-a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u3068\u3001\u975e\u540c\u671f\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n$ st2 run test.mistral-basic cmd=date -a\nTo get the results, execute:\n st2 execution get 57bc7191e368b9124ddab4da\n\n\u3057\u304b\u3082\u3054\u4e01\u5be7\u306b\u3001\u7d50\u679c\u3092\u898b\u308b\u3068\u304d\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3051\u3068\u6559\u3048\u3066\u304f\u308c\u308b\u3068\u3044\u3046\u3002\n\u53e9\u304f\u3068\u3001\u4ee5\u4e0b\u306e\u901a\u308a\u7d50\u679c\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n$ st2 execution get 57bc7191e368b9124ddab4da\nid: 57bc7191e368b9124ddab4da\naction.ref: test.mistral-basic\nparameters:\n  cmd: date\nstatus: succeeded (6s elapsed)\nstart_timestamp: 2016-08-23T15:53:53.347298Z\nend_timestamp: 2016-08-23T15:53:59.271906Z\n+--------------------------+------------------------+-------+------------+-------------------------------+\n| id                       | status                 | task  | action     | start_timestamp               |\n+--------------------------+------------------------+-------+------------+-------------------------------+\n| 57bc7194e368b9124ddab4dd | succeeded (1s elapsed) | task1 | core.local | Tue, 23 Aug 2016 15:53:56 UTC |\n+--------------------------+------------------------+-------+------------+-------------------------------+\n\n\u3082\u3061\u308d\u3093\u3001\u3055\u3089\u306b\u914d\u4e0b\u306eAction\u306e\u8a73\u7d30\u3082\u5206\u304b\u308a\u307e\u3059\u3002\n$ st2 execution get 57bc7194e368b9124ddab4dd\nid: 57bc7194e368b9124ddab4dd\nstatus: succeeded (1s elapsed)\nparameters:\n  cmd: date\nresult:\n  failed: false\n  return_code: 0\n  stderr: ''\n  stdout: Tue Aug 23 11:53:57 EDT 2016\n  succeeded: true\n\n\n\u3055\u3089\u306b\u8907\u96d1\u306aWorkflow\n\u3082\u3046\u5c11\u3057\u8907\u96d1\u306aWorkflow\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n/opt/stackstorm/packs/test/actions/mistral-advance.yaml\n---\ndescription: Run a complex workflow\nenabled: true\nentry_point: workflows/mistral-advance.yaml\nname: mistral-advance\npack: test\nparameters:\n  param:\n    required: true\n    type: string\nrunner_type: mistral-v2\n\n\n\n/opt/stackstorm/packs/test/actions/workflows/mistral-advance.yaml\nversion: \"2.0\"\nname: test.mistral-advance\ndescription: A sample workflow that demonstrates nested workflows, forks, and join.\n\nworkflows:\n\n  main:\n    type: direct\n    input:\n      - param\n    output:\n      output1: <% $.task1_result %>\n      output2: <% $.task2_result %>\n      output3: <% $.task3_result %>\n      output4: <% $.task4_result %>\n\n    tasks:\n      task1:\n        action: core.local\n        input:\n          cmd: \"sleep 1; echo '$.param: <% $.param %>'\"\n        publish:\n          task1_pub1: \"task1_publish1\"\n          task1_pub2: \"task1_publish2\"\n          task1_result: <% task(task1).result.stdout %>\n        on-success:\n          - task2\n          - task3\n\n      task2:\n        action: core.local\n        input:\n          cmd: \"sleep 2; echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>, $.task1_result: <% $.task1_result %>'\"\n        publish:\n          task2_pub1: \"task2_publish2\"\n          task2_result: <% task(task2).result.stdout %>\n        on-success:\n          - task4\n\n      task3:\n        action: core.local\n        input:\n          cmd: \"sleep 4; echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>'\"\n        publish:\n          task3_pub1: \"task3_publish1\"\n          task3_result: <% task(task3).result.stdout %>\n        on-success:\n          - task4\n\n      task4:\n        join: all\n        action: core.local\n        input:\n          cmd: \"echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>'\"\n        publish:\n          task4_pub1: \"task4_publish1\"\n          task4_result: <% task(task4).result.stdout %>\n\n\ntask1 -> [ task2, task3 ] -> task4 \u3068\u3044\u3046\u6d41\u308c\u3067Action\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u5909\u6570\u3092\u767b\u9332\u3057\u305f\u308a\u3001\u305d\u306e\u7d50\u679c\u3092\u53c2\u7167\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\n\u5404\u8a2d\u5b9a\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\npublish\n\u5909\u6570\u306b\u683c\u7d0d\u3057\u3001\u5024\u3092\u4ed6\u306eAction\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\npublish\u3067\u683c\u7d0d\u3057\u305f\u5024\u306f\u3001\u4ed6\u306eAction\u3067\u306f<% $.(publish\u540d) %>\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u9006\u306b\u8a00\u3046\u3068\u3001\u3053\u3053\u306b\u767b\u9332\u3057\u306a\u3044\u3068\u4ed6\u306eAction\u304b\u3089\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n$\u306b\u306f\u69d8\u3005\u306a\u5909\u6570\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4e00\u5ea6\u5168\u3066\u3092\u898b\u3066\u307f\u3066\u3082\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\u4f8b\u3048\u3070\u3001\u6700\u521d\u306b\u4e0e\u3048\u305finput (\u3053\u3053\u3067\u306fparam)\u3082\u3001$.param\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u6a19\u6e96\u51fa\u529b\n<% task(\u30bf\u30b9\u30af\u540d).result.stdout %>\u3068\u3044\u3046\u5f62\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\non-success\nAction\u304c\u6210\u529f\u3057\u305f\u3089\u3001\u6b21\u306eAction\u3092\u6307\u793a\u3057\u307e\u3059\u3002\n\njoin:all\n\u5148\u884c\u3059\u308bAction\u304c\u5168\u3066\u7d42\u308f\u3063\u305f\u3089\u3053\u306eAction\u3092\u52d5\u304b\u3057\u307e\u3059\u3002\n\u4e0a\u8a18\u3092\u4f5c\u6210\u3057\u305f\u3046\u3048\u3067\u3001Workflow\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n$ st2 action create /opt/stackstorm/packs/test/actions/mistral-advance.yaml\n+-------------+--------------------------------+\n| Property    | Value                          |\n+-------------+--------------------------------+\n| id          | 57be5ab5e368b916bff0d08d       |\n| name        | mistral-advance                |\n| pack        | test                           |\n| description | Run a complex workflow         |\n| enabled     | True                           |\n| entry_point | workflows/mistral-advance.yaml |\n| notify      |                                |\n| parameters  | {                              |\n|             |     \"param\": {                 |\n|             |         \"required\": true,      |\n|             |         \"type\": \"string\"       |\n|             |     }                          |\n|             | }                              |\n| ref         | test.mistral-advance           |\n| runner_type | mistral-v2                     |\n| tags        |                                |\n| uid         | action:test:mistral-advance    |\n+-------------+--------------------------------+\n\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ st2 run test.mistral-advance param=p\n..................\nid: 57be5b58e368b916bff0d08f\naction.ref: test.mistral-advance\nparameters:\n  param: p\nstatus: succeeded\nstart_timestamp: 2016-08-25T02:43:36.208702Z\nend_timestamp: 2016-08-25T02:44:14.778810Z\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n| id                       | status                  | task  | action     | start_timestamp               |\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n| 57be5b5fe368b916bff0d092 | succeeded (8s elapsed)  | task1 | core.local | Thu, 25 Aug 2016 02:43:43 UTC |\n| 57be5b6ae368b916bff0d095 | succeeded (8s elapsed)  | task2 | core.local | Thu, 25 Aug 2016 02:43:54 UTC |\n| 57be5b6ae368b916bff0d096 | succeeded (13s elapsed) | task3 | core.local | Thu, 25 Aug 2016 02:43:54 UTC |\n| 57be5b78e368b916bff0d098 | succeeded (4s elapsed)  | task4 | core.local | Thu, 25 Aug 2016 02:44:08 UTC |\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n\nstart_timestamp\u3092\u898b\u308c\u3070\u5206\u304b\u308b\u901a\u308a\u3001\u7121\u4e8b\u306btask2\u3068task3\u306f\u4e26\u5217\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u7d50\u679c\u3092\u8a73\u7d30\u306b\u898b\u3066\u307f\u307e\u3059\u3002workflow\u306e\u30b5\u30d6\u30bf\u30b9\u30af\u307e\u3067\u542b\u3081\u305f\u8a73\u7d30\u306a\u7d50\u679c\u3092\u898b\u308b\u305f\u3081\u306b\u306f\u3001 -d\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\u305f\u3060\u3001\u3053\u308c\u3060\u3068\u30c6\u30fc\u30d6\u30eb\u5f62\u5f0f\u3067\u306e\u51fa\u529b\u306a\u306e\u3067\u82e5\u5e72\u898b\u3065\u3089\u3044\u3067\u3059\u2026\u3002\u5b9f\u884c\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u898b\u308b\u3068\u3001--attr\u3084-k\u306a\u3069\u3067\u7d5e\u308a\u8fbc\u3081\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u5168\u304f\u610f\u5473\u3092\u6210\u3057\u307e\u305b\u3093\u3002\u306a\u3093\u3067\u3060\u308d\u3046\u2026\uff1f\n$ st2 execution get 57be5b58e368b916bff0d08f -d\n+-----------------+--------------------------------------------------------------+\n| Property        | Value                                                        |\n+-----------------+--------------------------------------------------------------+\n| id              | 57be5b58e368b916bff0d08f                                     |\n| action.ref      | test.mistral-advance                                         |\n| context.user    | st2admin                                                     |\n| parameters      | {                                                            |\n|                 |     \"param\": \"p\"                                             |\n|                 | }                                                            |\n| status          | succeeded (38s elapsed)                                      |\n| start_timestamp | Thu, 25 Aug 2016 02:43:36 UTC                                |\n| end_timestamp   | Thu, 25 Aug 2016 02:44:14 UTC                                |\n| result          | {                                                            |\n|                 |     \"tasks\": [                                               |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task1\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:42.250129\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:43:53.341116\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: p\"                       |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task1_pub2\": \"task1_publish2\",              |\n|                 |                 \"task1_pub1\": \"task1_publish1\",              |\n|                 |                 \"task1_result\": \"$.param: p\"                 |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"e8c54e34-10fc-49fc-bf12-3e4241f618c5\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task2\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:53.335244\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:05.149236\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1, $.task1_result: $.param: p\"    |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task2_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",   |\n|                 |                 \"task2_pub1\": \"task2_publish2\"               |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"ffd988de-591f-47cd-831d-8565ef725667\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task3\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:53.430928\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:08.432897\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task3_pub1\": \"task3_publish1\",              |\n|                 |                 \"task3_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"1b671f81-d0f0-4504-a15d-584bb4ceea63\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task4\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:44:05.130539\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:13.491646\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task4_pub1\": \"task4_publish1\",              |\n|                 |                 \"task4_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"0ff04b0c-2551-48d0-9a97-97064587b5de\"     |\n|                 |         }                                                    |\n|                 |     ],                                                       |\n|                 |     \"extra\": {                                               |\n|                 |         \"state_info\": null,                                  |\n|                 |         \"state\": \"SUCCESS\"                                   |\n|                 |     },                                                       |\n|                 |     \"output2\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1, $.task1_result: $.param: p\",                 |\n|                 |     \"output3\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1\",                                             |\n|                 |     \"output1\": \"$.param: p\",                                 |\n|                 |     \"output4\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1\"                                              |\n|                 | }                                                            |\n| liveaction      | {                                                            |\n|                 |     \"runner_info\": {                                         |\n|                 |         \"hostname\": \"demo1\",                                 |\n|                 |         \"pid\": 5339                                          |\n|                 |     },                                                       |\n|                 |     \"parameters\": {                                          |\n|                 |         \"param\": \"p\"                                         |\n|                 |     },                                                       |\n|                 |     \"action_is_workflow\": true,                              |\n|                 |     \"callback\": {},                                          |\n|                 |     \"action\": \"test.mistral-advance\",                        |\n|                 |     \"id\": \"57be5b58e368b916bff0d08e\"                         |\n|                 | }                                                            |\n+-----------------+--------------------------------------------------------------+\n\n\u975e\u5e38\u306b\u898b\u3065\u3089\u3044\u306e\u3067\u3001result\u306e\u90e8\u5206\u3060\u3051\u3002\n\nresult\n{\n  \"tasks\": [\n    {\n      \"state_info\": null,\n      \"name\": \"task1\",\n      \"created_at\": \"2016-08-25 02:43:42.250129\",\n      \"updated_at\": \"2016-08-25 02:43:53.341116\",\n      \"id\": \"e8c54e34-10fc-49fc-bf12-3e4241f618c5\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: p\"\n      },\n      \"published\": {\n        \"task1_pub2\": \"task1_publish2\",\n        \"task1_pub1\": \"task1_publish1\",\n        \"task1_result\": \"$.param: p\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task2\",\n      \"created_at\": \"2016-08-25 02:43:53.335244\",\n      \"updated_at\": \"2016-08-25 02:44:05.149236\",\n      \"id\": \"ffd988de-591f-47cd-831d-8565ef725667\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\"\n      },\n      \"published\": {\n        \"task2_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",\n        \"task2_pub1\": \"task2_publish2\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task3\",\n      \"created_at\": \"2016-08-25 02:43:53.430928\",\n      \"updated_at\": \"2016-08-25 02:44:08.432897\",\n      \"id\": \"1b671f81-d0f0-4504-a15d-584bb4ceea63\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"published\": {\n        \"task3_pub1\": \"task3_publish1\",\n        \"task3_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task4\",\n      \"created_at\": \"2016-08-25 02:44:05.130539\",\n      \"updated_at\": \"2016-08-25 02:44:13.491646\",\n      \"id\": \"0ff04b0c-2551-48d0-9a97-97064587b5de\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"published\": {\n        \"task4_pub1\": \"task4_publish1\",\n        \"task4_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    }\n  ],\n  \"extra\": {\n    \"state_info\": null,\n    \"state\": \"SUCCESS\"\n  },\n  \"output2\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",\n  \"output3\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\",\n  \"output1\": \"$.param: p\",\n  \"output4\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n}\n\n\noutput*\u306b\u306f\u3061\u3083\u3093\u3068\u5024\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u304c\u3001param\u306f\u6700\u4e0a\u4f4d\u306eAction\u3067\u3057\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u3067\u3059\u306d\u3002\n\u3064\u307e\u308a\u3001\u7b2c2Action\u3078\u6e21\u3059\u3068\u304d\u306f\u3001\u5fc5\u305aPublish\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\u4e00\u65b9\u3001\u4e00\u5ea6Publish\u3059\u308b\u3068\u3001\u76f4\u63a5\u7684\u306b\u95a2\u4fc2\u306e\u306a\u3044Action\u3067\u3082\u5024\u304c\u53d6\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u307e\u3068\u3081\nYML\u30d5\u30a1\u30a4\u30eb\u3067\u30d5\u30ed\u30fc\u304c\u5b9a\u7fa9\u3067\u304d\u308b\u306e\u306f\u304b\u306a\u308a\u4fbf\u5229\u3067\u3059\u3002\n\u4e00\u65b9\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\u3057\u3066\u3001\u5171\u901a\u306eAction\u3092\u4f7f\u3044\u56de\u3059\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u306e\u304b\u306a\uff1f\u3068\u3044\u3046\u306e\u306f\u3001\u3067\u304d\u308b\u306e\u304b\u3069\u3046\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u3002\nMistral\u306f\u304b\u306a\u308a\u3044\u308d\u3044\u308d\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3088\u30462\u306a\u306e\u3067\u3001\u4ed6\u306b\u3082\u4fbf\u5229\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\u6163\u308c\u308b\u307e\u3067\u306f\u5927\u5909\u3067\u3059\u304c\u3001\u67d4\u8edf\u306aWorkflow\u3092\u4f5c\u308c\u305d\u3046\u3067\u3059\u3002\n\n\n\n\nhttps://docs.stackstorm.com/packs.html\u00a0\u21a9\n\n\nhttp://docs.openstack.org/developer/mistral/dsl/dsl_v2.html\u00a0\u21a9\n\n\n\n\u524d\u56de\u3001StackStorm\u306e\u69d8\u3005\u306a\u6a5f\u80fd\u306b\u3064\u3044\u3066\u898b\u3066\u304d\u307e\u3057\u305f\u3002\n\n[\u30a4\u30d9\u30f3\u30c8\u30c9\u30ea\u30d6\u30f3\u306a\u81ea\u52d5\u5316\u30c4\u30fc\u30eb StackStorm\u3092\u8a66\u3059\n](http://qiita.com/unchemist/items/0e6425396ba1a1e6b43c)\n\n\u305d\u3053\u3067\u6b8b\u3057\u3066\u3044\u305fWorkflow\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n## Workflow\u3068\u306f\n\n\u69d8\u3005\u306a\u5358\u4f53\u306eAction\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u6570\u306e\u51e6\u7406\u3092\u52d5\u304b\u3059\u305f\u3081\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002\nStackStorm\u306b\u3068\u3063\u3066\u306f\u3001\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u304c\u4f55\u7a2e\u985e\u304b\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u4e0a\u306b\u884c\u304f\u307b\u3069\u30b7\u30f3\u30d7\u30eb(\u305f\u3060\u3057\u6df7\u307f\u3044\u3063\u305f\u3053\u3068\u306f\u3067\u304d\u306a\u3044)\u3001\u4e0b\u306b\u884c\u304f\u307b\u3069\u9ad8\u6a5f\u80fd(\u305f\u3060\u3057\u66f8\u304d\u65b9\u304c\u8907\u96d1\u306b\u306a\u308b)\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\n* ActionChain\n* Mistral\n* Mistral + YAQL\n\n\u306a\u304a\u3001\u4ed6\u306bCloudSlang\u3068\u3044\u3046\u5f62\u5f0f\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u3001Experimental\u3068\u3044\u3046\u3053\u3068\u3067\u8abf\u67fb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\nhttps://docs.stackstorm.com/workflows.html\n\n### ActionChain\n\nStackStorm\u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u8a18\u6cd5\u3067\u3001\u901f\u3055\u3068\u30b7\u30f3\u30d7\u30eb\u3055\u3092\u6c42\u3081\u308b\u306a\u3089\u3053\u308c(\u3068\u306e\u3053\u3068)\u3002\n\u305f\u3060\u3057\u3001\u898b\u305f\u611f\u3058\u306f\u3001\u5358\u7d14\u306bAction\u3092\u7e4b\u3052\u308b\u3053\u3068\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\n\u3064\u307e\u308a\u3001Action\u3092\u4e26\u5217\u3067\u5b9f\u884c\u3057\u305f\u308a\u3068\u304b\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n### Mistral\n\nOpenStack\u306eWorkflow\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3042\u308bMistral\u304c\u4f7f\u3048\u308b\u3088\u3046\u3067\u3059\u3002\n\u3064\u307e\u308a\u3001Workflow\u306e\u66f8\u304d\u65b9\u306fMistral\u306b\u5b8c\u5168\u306b\u5023\u3063\u3066\u3044\u308b\u611f\u3058\u3067\u3059\u3002\n\nWorkflow\u306e\u4e2d\u306bWorkflow\u3068\u304b\u3001Action\u3092\u5206\u5c90\u3055\u305b\u305f\u308a\u5408\u6d41\u3055\u305b\u305f\u308a\u3001\u3042\u308b\u3044\u306f\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3068\u3044\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nMistral:\nhttp://docs.openstack.org/developer/mistral/dsl/dsl_v2.html\n\n### Mistral + YAQL\n\nMistral\u306b\u52a0\u3048\u3066\u3001\u5909\u6570\u306b\u57fa\u3065\u3044\u3066Action\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u914d\u5217\u5f62\u5f0f\u306einput\u3092\u4e0e\u3048\u3066\u3001\u305d\u306e\u914d\u5217\u306e\u5358\u4f4d\u3067Action\u3092\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b\u3068\u304b\u3001\n\u3088\u308a\u30d7\u30ed\u30b0\u30e9\u30de\u30d6\u30eb\u306bWorkflow\u3092\u69cb\u6210\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\nYAQL\u306f\u3001`Yet Another Query Language` \u306e\u7565\u3067\u3001\u3044\u308f\u3070JSON\u306b\u304a\u3051\u308b `jq` \u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306a\u3082\u306e\u306e\u7406\u89e3\u3067\u3059\u3002\n\u3064\u307e\u308a\u3001YAML\u3084JSON\u5f62\u5f0f\u306e\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u3001\u5fc5\u8981\u306a\u8981\u7d20\u3092\u62bd\u51fa\u3057\u305f\u308a\u52a0\u5de5\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nMistral + YAQL\u3067\u306f\u3001YAML\u3084JSON\u3092\u52a0\u5de5\u3057\u3066\u5024\u3092\u53d6\u308a\u51fa\u3057\u305f\u308a\u3057\u3066\u3001\u305d\u306e\u5024\u306b\u57fa\u3065\u3044\u3066Workflow\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nAnsible\u3092\u77e5\u3063\u3066\u3044\u308b\u4eba\u306a\u3089\u3001 `with_items` \u3068\u304b `with_dict` \u307f\u305f\u3044\u306a\u611f\u3058\u3067task\u3092\u56de\u305b\u308b\u3001\u3068\u3044\u3046\u3068\u4e00\u767a\u3067\u30a4\u30e1\u30fc\u30b8\u304c\u6e67\u304f\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nYAQL: \nhttp://yaql.readthedocs.io/en/latest/getting_started.html  \nYAQLuator(YAQL\u3092\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u30b5\u30fc\u30d3\u30b9):\nhttp://yaqluator.com/\n\n### \u3069\u306eWorkflow\u3092\u4f7f\u3046\u3079\u304d\u304b\n\n\u3053\u306e\u3088\u3046\u306b\u3001Workflow\u3092\u4f7f\u3046\u305f\u3081\u306b\u306f\u69d8\u3005\u306a\u5b9f\u73fe\u624b\u6bb5\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\u306a\u3089\u3001\u3069\u308c\u3092\u4f7f\u3048\u3070\u3088\u3044\u304b\u3067\u3059\u304c\u3001\u6b63\u76f4ActionChain\u306f\u3084\u308a\u305f\u3044\u3053\u3068\u306b\u3059\u3050\u9650\u754c\u304c\u6765\u305d\u3046\u3067\u3059\u3057\u3001\n\u3053\u3053\u306fMistral\u3092\u899a\u3048\u3066\u3057\u307e\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## Mistral\u3092\u4f7f\u3046\n\n### \u8a8d\u8a3c\n\n\u524d\u56de\u306froot\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u901a\u5e38 `st2` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u8a8d\u8a3c\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\nhttps://docs.stackstorm.com/authentication.html?highlight=user\n\n```bash\nst2 auth st2admin -p <password> -t\n```\n\n`-t`\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u30c8\u30fc\u30af\u30f3\u306e\u307f\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u308c\u3092\u3001`ST2_AUTH_TOKEN` \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3059\u308c\u3070\u3001\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ st2 action list\nERROR: 401 Client Error: Unauthorized\nMESSAGE: Unauthorized - One of Token or API key required. for url: http://127.0.0.1:9101/v1/actions\n\n$ export ST2_AUTH_TOKEN=$(st2 auth st2admin -p st2admin -t)\n$ st2 action list\n+---------------------------------+---------+--------------------------------------------------------------------+\n| ref                             | pack    | description                                                        |\n+---------------------------------+---------+--------------------------------------------------------------------+\n| chatops.format_execution_result | chatops | Format an execution result for chatops                             |\n| chatops.post_message            | chatops | Post a message to stream for chatops                               |\n(snip)\n```\n\n### Workflow\u3068Action\u306e\u4f5c\u6210\u3068\u914d\u7f6e\n\nWorkflow\u306f\u3001Action\u3068\u30bb\u30c3\u30c8\u3067\u7d10\u4ed8\u304d\u307e\u3059\u3002\nWorkflow\u306b\u3082Action\u306b\u3082pack\u540d\u3068\u3044\u3046\u63a5\u982d\u8f9e\u304c\u3064\u304d\u3001\u3053\u306e\u540d\u524d\u3067\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u3082\u56fa\u5b9a\u7684\u306e\u3088\u3046\u3067\u3059\u3002\n\n#### `/opt/stackstorm/packs/<pack>/actions/*.yml`  \n\nmetadata\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\u3069\u306eworkflow\u3092\u8aad\u307f\u8fbc\u3080\u304b\u3068\u304b\u3001\u3069\u3093\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5fc5\u8981\u304b\u306a\u3069\u3001\u5168\u4f53\u7684\u306a\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```/opt/stackstorm/packs/test/actions/mistral-basic.yaml\n---\ndescription: Run a local linux command\nenabled: true\nentry_point: workflows/mistral-basic.yaml\nname: mistral-basic\npack: test\nparameters:\n  cmd:\n    required: true\n    type: string\nrunner_type: mistral-v2\n```\n\n\u306a\u3093\u3068\u306a\u304f\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9a\u7fa9\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n* `cmd`\u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5b9f\u884c\u6642\u306b\u5165\u529b\u5fc5\u9808\n* `Workflow\u3092 `mistral-v2` \u3067\u52d5\u304b\u3059\n\n#### `/opt/stackstorm/packs/<pack>/actions/workflows/*.yml`  \n\nWorkflow\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u51e6\u7406\u306e\u4e2d\u8eab\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```yml:/opt/stackstorm/packs/test/actions/workflows/mistral-basic.yaml\nversion: '2.0'\n\ntest.mistral-basic:\n    description: A basic workflow that runs an arbitrary linux command.\n    type: direct\n    input:\n        - cmd\n    output:\n        stdout: <% $.stdout %>\n    tasks:\n        task1:\n            action: core.local cmd=<% $.cmd %>\n            publish:\n                stdout: <% task(task1).result.stdout %>\n                stderr: <% task(task1).result.stderr %>\n```\n\n\u5fc5\u305a`/opt/stackstorm/pack`\u306b\u7f6e\u304b\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u53cd\u6620\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\u914d\u7f6e\u5148\u3092\u5909\u66f4\u3059\u308b\u5834\u5408\u306f\u3001 `/etc/st2/st2.conf` \u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059(\u672a\u78ba\u8a8d)[^1]\u3002\n\n```\n[content]\npacks_base_paths=/home/myuser1/packs:/home/myuser2/packs\n```\n\n\u914d\u7f6e\u5f8c\u3001\u30b8\u30e7\u30d6\u3092\u53cd\u6620\u3055\u305b\u307e\u3059\u3002\n\n```bash\n$ st2 action create /opt/stackstorm/packs/test/actions/mistral-basic.yaml\n(snip)\n```\n\n### Workflow\u306e\u5b9f\u884c\n\nAction\u3092\u5b9f\u884c\u3059\u308b\u6642\u3068\u540c\u3058\u304f\u3001 `st2 run <workflow\u540d>` \u3067\u3067\u304d\u307e\u3059\u3002\n\n`cmd`\u3092\u5165\u529b\u5fc5\u9808\u306b\u3057\u305f\u306e\u3067\u3001\u4f55\u3082\u4e0e\u3048\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ st2 run test.mistral-basic\nERROR: 400 Client Error: Bad Request\nMESSAGE: 'cmd' is a required property for url: http://127.0.0.1:9101/v1/executions\n```\n\n\u307e\u305f\u3001\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3068\u5b8c\u4e86\u307e\u3067\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u623b\u3063\u3066\u304d\u307e\u305b\u3093\u304c\u3001`-a`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u3068\u3001\u975e\u540c\u671f\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\n```\n$ st2 run test.mistral-basic cmd=date -a\nTo get the results, execute:\n st2 execution get 57bc7191e368b9124ddab4da\n```\n\n\u3057\u304b\u3082\u3054\u4e01\u5be7\u306b\u3001\u7d50\u679c\u3092\u898b\u308b\u3068\u304d\u306f\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3051\u3068\u6559\u3048\u3066\u304f\u308c\u308b\u3068\u3044\u3046\u3002\n\u53e9\u304f\u3068\u3001\u4ee5\u4e0b\u306e\u901a\u308a\u7d50\u679c\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n```\n$ st2 execution get 57bc7191e368b9124ddab4da\nid: 57bc7191e368b9124ddab4da\naction.ref: test.mistral-basic\nparameters:\n  cmd: date\nstatus: succeeded (6s elapsed)\nstart_timestamp: 2016-08-23T15:53:53.347298Z\nend_timestamp: 2016-08-23T15:53:59.271906Z\n+--------------------------+------------------------+-------+------------+-------------------------------+\n| id                       | status                 | task  | action     | start_timestamp               |\n+--------------------------+------------------------+-------+------------+-------------------------------+\n| 57bc7194e368b9124ddab4dd | succeeded (1s elapsed) | task1 | core.local | Tue, 23 Aug 2016 15:53:56 UTC |\n+--------------------------+------------------------+-------+------------+-------------------------------+\n```\n\n\u3082\u3061\u308d\u3093\u3001\u3055\u3089\u306b\u914d\u4e0b\u306eAction\u306e\u8a73\u7d30\u3082\u5206\u304b\u308a\u307e\u3059\u3002\n\n```\n$ st2 execution get 57bc7194e368b9124ddab4dd\nid: 57bc7194e368b9124ddab4dd\nstatus: succeeded (1s elapsed)\nparameters:\n  cmd: date\nresult:\n  failed: false\n  return_code: 0\n  stderr: ''\n  stdout: Tue Aug 23 11:53:57 EDT 2016\n  succeeded: true\n```\n\n### \u3055\u3089\u306b\u8907\u96d1\u306aWorkflow\n\n\u3082\u3046\u5c11\u3057\u8907\u96d1\u306aWorkflow\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n```/opt/stackstorm/packs/test/actions/mistral-advance.yaml\n---\ndescription: Run a complex workflow\nenabled: true\nentry_point: workflows/mistral-advance.yaml\nname: mistral-advance\npack: test\nparameters:\n  param:\n    required: true\n    type: string\nrunner_type: mistral-v2\n```\n\n```/opt/stackstorm/packs/test/actions/workflows/mistral-advance.yaml\nversion: \"2.0\"\nname: test.mistral-advance\ndescription: A sample workflow that demonstrates nested workflows, forks, and join.\n\nworkflows:\n\n  main:\n    type: direct\n    input:\n      - param\n    output:\n      output1: <% $.task1_result %>\n      output2: <% $.task2_result %>\n      output3: <% $.task3_result %>\n      output4: <% $.task4_result %>\n\n    tasks:\n      task1:\n        action: core.local\n        input:\n          cmd: \"sleep 1; echo '$.param: <% $.param %>'\"\n        publish:\n          task1_pub1: \"task1_publish1\"\n          task1_pub2: \"task1_publish2\"\n          task1_result: <% task(task1).result.stdout %>\n        on-success:\n          - task2\n          - task3\n\n      task2:\n        action: core.local\n        input:\n          cmd: \"sleep 2; echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>, $.task1_result: <% $.task1_result %>'\"\n        publish:\n          task2_pub1: \"task2_publish2\"\n          task2_result: <% task(task2).result.stdout %>\n        on-success:\n          - task4\n\n      task3:\n        action: core.local\n        input:\n          cmd: \"sleep 4; echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>'\"\n        publish:\n          task3_pub1: \"task3_publish1\"\n          task3_result: <% task(task3).result.stdout %>\n        on-success:\n          - task4\n\n      task4:\n        join: all\n        action: core.local\n        input:\n          cmd: \"echo '$.param: <$.param %>, $.task1_pub1: <% $.task1_pub1 %>'\"\n        publish:\n          task4_pub1: \"task4_publish1\"\n          task4_result: <% task(task4).result.stdout %>\n```\n\n`task1 -> [ task2, task3 ] -> task4` \u3068\u3044\u3046\u6d41\u308c\u3067Action\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u5909\u6570\u3092\u767b\u9332\u3057\u305f\u308a\u3001\u305d\u306e\u7d50\u679c\u3092\u53c2\u7167\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u5404\u8a2d\u5b9a\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n#### publish\n\n\u5909\u6570\u306b\u683c\u7d0d\u3057\u3001\u5024\u3092\u4ed6\u306eAction\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\npublish\u3067\u683c\u7d0d\u3057\u305f\u5024\u306f\u3001\u4ed6\u306eAction\u3067\u306f`<% $.(publish\u540d) %>`\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u9006\u306b\u8a00\u3046\u3068\u3001\u3053\u3053\u306b\u767b\u9332\u3057\u306a\u3044\u3068\u4ed6\u306eAction\u304b\u3089\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n`$`\u306b\u306f\u69d8\u3005\u306a\u5909\u6570\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u4e00\u5ea6\u5168\u3066\u3092\u898b\u3066\u307f\u3066\u3082\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\u4f8b\u3048\u3070\u3001\u6700\u521d\u306b\u4e0e\u3048\u305finput (\u3053\u3053\u3067\u306f`param`)\u3082\u3001`$.param`\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n#### \u6a19\u6e96\u51fa\u529b\n\n`<% task(\u30bf\u30b9\u30af\u540d).result.stdout %>`\u3068\u3044\u3046\u5f62\u3067\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n#### on-success\n\nAction\u304c\u6210\u529f\u3057\u305f\u3089\u3001\u6b21\u306eAction\u3092\u6307\u793a\u3057\u307e\u3059\u3002\n\n#### join:all\n\n\u5148\u884c\u3059\u308bAction\u304c\u5168\u3066\u7d42\u308f\u3063\u305f\u3089\u3053\u306eAction\u3092\u52d5\u304b\u3057\u307e\u3059\u3002\n\n\u4e0a\u8a18\u3092\u4f5c\u6210\u3057\u305f\u3046\u3048\u3067\u3001Workflow\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```bash\n$ st2 action create /opt/stackstorm/packs/test/actions/mistral-advance.yaml\n+-------------+--------------------------------+\n| Property    | Value                          |\n+-------------+--------------------------------+\n| id          | 57be5ab5e368b916bff0d08d       |\n| name        | mistral-advance                |\n| pack        | test                           |\n| description | Run a complex workflow         |\n| enabled     | True                           |\n| entry_point | workflows/mistral-advance.yaml |\n| notify      |                                |\n| parameters  | {                              |\n|             |     \"param\": {                 |\n|             |         \"required\": true,      |\n|             |         \"type\": \"string\"       |\n|             |     }                          |\n|             | }                              |\n| ref         | test.mistral-advance           |\n| runner_type | mistral-v2                     |\n| tags        |                                |\n| uid         | action:test:mistral-advance    |\n+-------------+--------------------------------+\n```\n\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ st2 run test.mistral-advance param=p\n..................\nid: 57be5b58e368b916bff0d08f\naction.ref: test.mistral-advance\nparameters:\n  param: p\nstatus: succeeded\nstart_timestamp: 2016-08-25T02:43:36.208702Z\nend_timestamp: 2016-08-25T02:44:14.778810Z\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n| id                       | status                  | task  | action     | start_timestamp               |\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n| 57be5b5fe368b916bff0d092 | succeeded (8s elapsed)  | task1 | core.local | Thu, 25 Aug 2016 02:43:43 UTC |\n| 57be5b6ae368b916bff0d095 | succeeded (8s elapsed)  | task2 | core.local | Thu, 25 Aug 2016 02:43:54 UTC |\n| 57be5b6ae368b916bff0d096 | succeeded (13s elapsed) | task3 | core.local | Thu, 25 Aug 2016 02:43:54 UTC |\n| 57be5b78e368b916bff0d098 | succeeded (4s elapsed)  | task4 | core.local | Thu, 25 Aug 2016 02:44:08 UTC |\n+--------------------------+-------------------------+-------+------------+-------------------------------+\n```\n\n`start_timestamp`\u3092\u898b\u308c\u3070\u5206\u304b\u308b\u901a\u308a\u3001\u7121\u4e8b\u306btask2\u3068task3\u306f\u4e26\u5217\u3067\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\u3092\u8a73\u7d30\u306b\u898b\u3066\u307f\u307e\u3059\u3002workflow\u306e\u30b5\u30d6\u30bf\u30b9\u30af\u307e\u3067\u542b\u3081\u305f\u8a73\u7d30\u306a\u7d50\u679c\u3092\u898b\u308b\u305f\u3081\u306b\u306f\u3001 `-d`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\u305f\u3060\u3001\u3053\u308c\u3060\u3068\u30c6\u30fc\u30d6\u30eb\u5f62\u5f0f\u3067\u306e\u51fa\u529b\u306a\u306e\u3067\u82e5\u5e72\u898b\u3065\u3089\u3044\u3067\u3059\u2026\u3002\u5b9f\u884c\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u898b\u308b\u3068\u3001`--attr`\u3084`-k`\u306a\u3069\u3067\u7d5e\u308a\u8fbc\u3081\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u5168\u304f\u610f\u5473\u3092\u6210\u3057\u307e\u305b\u3093\u3002\u306a\u3093\u3067\u3060\u308d\u3046\u2026\uff1f\n\n```\n$ st2 execution get 57be5b58e368b916bff0d08f -d\n+-----------------+--------------------------------------------------------------+\n| Property        | Value                                                        |\n+-----------------+--------------------------------------------------------------+\n| id              | 57be5b58e368b916bff0d08f                                     |\n| action.ref      | test.mistral-advance                                         |\n| context.user    | st2admin                                                     |\n| parameters      | {                                                            |\n|                 |     \"param\": \"p\"                                             |\n|                 | }                                                            |\n| status          | succeeded (38s elapsed)                                      |\n| start_timestamp | Thu, 25 Aug 2016 02:43:36 UTC                                |\n| end_timestamp   | Thu, 25 Aug 2016 02:44:14 UTC                                |\n| result          | {                                                            |\n|                 |     \"tasks\": [                                               |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task1\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:42.250129\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:43:53.341116\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: p\"                       |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task1_pub2\": \"task1_publish2\",              |\n|                 |                 \"task1_pub1\": \"task1_publish1\",              |\n|                 |                 \"task1_result\": \"$.param: p\"                 |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"e8c54e34-10fc-49fc-bf12-3e4241f618c5\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task2\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:53.335244\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:05.149236\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1, $.task1_result: $.param: p\"    |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task2_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",   |\n|                 |                 \"task2_pub1\": \"task2_publish2\"               |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"ffd988de-591f-47cd-831d-8565ef725667\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task3\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:43:53.430928\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:08.432897\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task3_pub1\": \"task3_publish1\",              |\n|                 |                 \"task3_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"1b671f81-d0f0-4504-a15d-584bb4ceea63\"     |\n|                 |         },                                                   |\n|                 |         {                                                    |\n|                 |             \"state_info\": null,                              |\n|                 |             \"name\": \"task4\",                                 |\n|                 |             \"workflow_name\": \"test.mistral-advance.main\",    |\n|                 |             \"created_at\": \"2016-08-25 02:44:05.130539\",      |\n|                 |             \"updated_at\": \"2016-08-25 02:44:13.491646\",      |\n|                 |             \"workflow_execution_id\": \"7e50bc87-b81c-481d-    |\n|                 | 8c90-239bfe194570\",                                          |\n|                 |             \"state\": \"SUCCESS\",                              |\n|                 |             \"result\": {                                      |\n|                 |                 \"failed\": false,                             |\n|                 |                 \"stderr\": \"\",                                |\n|                 |                 \"return_code\": 0,                            |\n|                 |                 \"succeeded\": true,                           |\n|                 |                 \"stdout\": \"$.param: <$.param %>,             |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"published\": {                                   |\n|                 |                 \"task4_pub1\": \"task4_publish1\",              |\n|                 |                 \"task4_result\": \"$.param: <$.param %>,       |\n|                 | $.task1_pub1: task1_publish1\"                                |\n|                 |             },                                               |\n|                 |             \"input\": null,                                   |\n|                 |             \"id\": \"0ff04b0c-2551-48d0-9a97-97064587b5de\"     |\n|                 |         }                                                    |\n|                 |     ],                                                       |\n|                 |     \"extra\": {                                               |\n|                 |         \"state_info\": null,                                  |\n|                 |         \"state\": \"SUCCESS\"                                   |\n|                 |     },                                                       |\n|                 |     \"output2\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1, $.task1_result: $.param: p\",                 |\n|                 |     \"output3\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1\",                                             |\n|                 |     \"output1\": \"$.param: p\",                                 |\n|                 |     \"output4\": \"$.param: <$.param %>, $.task1_pub1:          |\n|                 | task1_publish1\"                                              |\n|                 | }                                                            |\n| liveaction      | {                                                            |\n|                 |     \"runner_info\": {                                         |\n|                 |         \"hostname\": \"demo1\",                                 |\n|                 |         \"pid\": 5339                                          |\n|                 |     },                                                       |\n|                 |     \"parameters\": {                                          |\n|                 |         \"param\": \"p\"                                         |\n|                 |     },                                                       |\n|                 |     \"action_is_workflow\": true,                              |\n|                 |     \"callback\": {},                                          |\n|                 |     \"action\": \"test.mistral-advance\",                        |\n|                 |     \"id\": \"57be5b58e368b916bff0d08e\"                         |\n|                 | }                                                            |\n+-----------------+--------------------------------------------------------------+\n```\n\n\u975e\u5e38\u306b\u898b\u3065\u3089\u3044\u306e\u3067\u3001result\u306e\u90e8\u5206\u3060\u3051\u3002\n\n```json:result\n{\n  \"tasks\": [\n    {\n      \"state_info\": null,\n      \"name\": \"task1\",\n      \"created_at\": \"2016-08-25 02:43:42.250129\",\n      \"updated_at\": \"2016-08-25 02:43:53.341116\",\n      \"id\": \"e8c54e34-10fc-49fc-bf12-3e4241f618c5\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: p\"\n      },\n      \"published\": {\n        \"task1_pub2\": \"task1_publish2\",\n        \"task1_pub1\": \"task1_publish1\",\n        \"task1_result\": \"$.param: p\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task2\",\n      \"created_at\": \"2016-08-25 02:43:53.335244\",\n      \"updated_at\": \"2016-08-25 02:44:05.149236\",\n      \"id\": \"ffd988de-591f-47cd-831d-8565ef725667\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\"\n      },\n      \"published\": {\n        \"task2_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",\n        \"task2_pub1\": \"task2_publish2\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task3\",\n      \"created_at\": \"2016-08-25 02:43:53.430928\",\n      \"updated_at\": \"2016-08-25 02:44:08.432897\",\n      \"id\": \"1b671f81-d0f0-4504-a15d-584bb4ceea63\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"published\": {\n        \"task3_pub1\": \"task3_publish1\",\n        \"task3_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    },\n    {\n      \"state_info\": null,\n      \"name\": \"task4\",\n      \"created_at\": \"2016-08-25 02:44:05.130539\",\n      \"updated_at\": \"2016-08-25 02:44:13.491646\",\n      \"id\": \"0ff04b0c-2551-48d0-9a97-97064587b5de\",\n      \"workflow_execution_id\": \"7e50bc87-b81c-481d-8c90-239bfe194570\",\n      \"state\": \"SUCCESS\",\n      \"result\": {\n        \"succeeded\": true,\n        \"failed\": false,\n        \"return_code\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"published\": {\n        \"task4_pub1\": \"task4_publish1\",\n        \"task4_result\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n      },\n      \"input\": null,\n      \"workflow_name\": \"test.mistral-advance.main\"\n    }\n  ],\n  \"extra\": {\n    \"state_info\": null,\n    \"state\": \"SUCCESS\"\n  },\n  \"output2\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1, $.task1_result: $.param: p\",\n  \"output3\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\",\n  \"output1\": \"$.param: p\",\n  \"output4\": \"$.param: <$.param %>, $.task1_pub1: task1_publish1\"\n}\n```\n\n`output*`\u306b\u306f\u3061\u3083\u3093\u3068\u5024\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\u304c\u3001`param`\u306f\u6700\u4e0a\u4f4d\u306eAction\u3067\u3057\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u3067\u3059\u306d\u3002\n\u3064\u307e\u308a\u3001\u7b2c2Action\u3078\u6e21\u3059\u3068\u304d\u306f\u3001\u5fc5\u305aPublish\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\n\u4e00\u65b9\u3001\u4e00\u5ea6Publish\u3059\u308b\u3068\u3001\u76f4\u63a5\u7684\u306b\u95a2\u4fc2\u306e\u306a\u3044Action\u3067\u3082\u5024\u304c\u53d6\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n## \u307e\u3068\u3081\n\nYML\u30d5\u30a1\u30a4\u30eb\u3067\u30d5\u30ed\u30fc\u304c\u5b9a\u7fa9\u3067\u304d\u308b\u306e\u306f\u304b\u306a\u308a\u4fbf\u5229\u3067\u3059\u3002\n\u4e00\u65b9\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\u3057\u3066\u3001\u5171\u901a\u306eAction\u3092\u4f7f\u3044\u56de\u3059\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u306e\u304b\u306a\uff1f\u3068\u3044\u3046\u306e\u306f\u3001\u3067\u304d\u308b\u306e\u304b\u3069\u3046\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u3002\n\nMistral\u306f\u304b\u306a\u308a\u3044\u308d\u3044\u308d\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3088\u3046[^2]\u306a\u306e\u3067\u3001\u4ed6\u306b\u3082\u4fbf\u5229\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\u6163\u308c\u308b\u307e\u3067\u306f\u5927\u5909\u3067\u3059\u304c\u3001\u67d4\u8edf\u306aWorkflow\u3092\u4f5c\u308c\u305d\u3046\u3067\u3059\u3002\n\n\n[^1]: https://docs.stackstorm.com/packs.html\n[^2]: http://docs.openstack.org/developer/mistral/dsl/dsl_v2.html\n", "tags": ["stackstorm", "infrastructure", "Jenkins", "\u81ea\u52d5\u5316", "devops"]}