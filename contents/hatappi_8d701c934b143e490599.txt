{"tags": ["Ruby", "gmail", "Gem", "base64"], "context": " More than 1 year has passed since last update.ruby\u3055\u308f\u3063\u3066\u3044\u3066\u3001gmail\u306e\u4e2d\u8eab\u3092\u53d6\u5f97\u3057\u3066\u8272\u3005\u3057\u305f\u3044\u4eba\u304c\u3044\u308b\u3068\u601d\u3046\n\u300cgem gmail \u53d6\u5f97\u300d\u3068\u3044\u3046\u30af\u30a8\u30ea\u3067\u8abf\u3079\u308b\u3068\u4e0b\u8a18\u304c\u305f\u3076\u3093\u51fa\u3066\u304f\u308b\u3068\u601d\u3046\n\ngmail\nruby-gmail\n\n\u3044\u305a\u308c\u3082mail\u3068\u3044\u3046\u30e1\u30fc\u30eb\u306e\u9001\u53d7\u4fe1\u3092\u3088\u3057\u306a\u306b\u884c\u3063\u3066\u304f\u308c\u308bgem\u3092\u30e9\u30c3\u30d1\u30fc\u3057\u3066\u3044\u308b\u611f\u3058\u3002\n\u305f\u3060\u3057\u4e0a\u8a18\u3092\u4f7f\u3046\u306b\u306f\u5b89\u5168\u6027\u306e\u4f4e\u3044\u30a2\u30d7\u30ea\u304c\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3092\u8a31\u53ef\u3059\u308b\u3092\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\u306a\u3093\u304b\u6c17\u6301\u3061\u7684\u306b\u3061\u3087\u3063\u3068\u5acc\u3060\n\n\u3068\u601d\u3063\u305f\u3089\u3053\u308c\u306f Gmail\u306eAPI \u304c\u516c\u958b\u3055\u308c\u308b\u307e\u3067\u306e\u8a71\u30672014\u5e74\u590f?\u79fb\u884c\u306fAPI\u3042\u308b\uff01\uff01\n\n\u306a\u306e\u3067google\u5468\u308a\u306e\u30b5\u30fc\u30d3\u30b9\u4f7f\u3046\u3068\u304d\u306b\u306f\u304a\u99b4\u67d3\u307f\u306e\ngem install \"google-api-client\"\n\u3053\u308c\u3067\u3044\u3051\u308b\u3002\u5b09\u3057\u3044\u3002\u5b89\u5fc3\u3002\n\u516c\u5f0f\u306b\u30e9\u30d9\u30eb\u3092\u53d6\u5f97\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u304c\u304b\u3044\u3066\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u53c2\u8003\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\n\u203b \u4e0b\u8a18\u304b\u3089\u306f\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u52d5\u3044\u3066\u308b\u524d\u63d0\u3067\uff01\n\n\u5b9f\u969b\u306bgmail\u3092\u53d6\u5f97\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\n\u30e1\u30fc\u30eb\u306f\u30b3\u30b3\u306eapi\u3092\u53e9\u304f\u306e\u3060\u304c\u3001\u305d\u308c\u306b\u306fmail\u3092\u8b58\u5225\u3057\u3066\u3044\u308bid\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u305d\u308c\u3092\u30b3\u30b3\u304b\u3089\u53d6\u5f97\u3059\u308b\u3002\n\n\u30e1\u30fc\u30eb\u306eid\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\n\nruby\nresults = client.execute!(\n  api_method: gmail_api.users.messages.list,\n  parameters: { \n    userId: 'me',\n    q: 'is:read after:2015/12/20 before:2015/12/30 ' \n  }\n)\n\nresults.data.messages.each do |message|\n  p message.id\nend\n\n=> \"211df4423fb88\"\n   \"31fsd4423fb88\"\n\n\n\u4e0a\u8a18\u306epoint\u306fparameters\u306b\u3044\u308c\u3066\u308bq\u3067\u3001\u3053\u3053\u306b\u306fgmail\u306e\u691c\u7d22\u30af\u30a8\u30ea\u3092\u305d\u306e\u307e\u307e\u5165\u308c\u3089\u308c\u308b\uff01\u3081\u3063\u3061\u3083\u4fbf\u5229\n\n\u30e1\u30fc\u30eb\u306e\u8a73\u7d30\u3092\u53d6\u5f97\n\nruby\nresults = client.execute!(\n  api_method: @gmail_api.users.messages.get,\n  parameters: { userId: 'me', id: '\u3010\u3055\u3063\u304d\u53d6\u5f97\u3057\u305fmail\u306eid\u3011' },\n)\n# json\u3067\u304b\u3048\u3063\u3066\u304f\u308b\u304b\u3089\u30d1\u30fc\u30b9\u3059\u308b\nobj = JSON.parse(results.response.body, symbolize_names: true)\nenc_base64url = obj[:payload][:parts].first[:body][:data]\nheaders = obj[:payload][:headers]\n\n{\n  subject: headers.select { |e| e[:name] == 'Subject'}.try(:first)[:value],\n  from: headers.select { |e| e[:name] == 'From'}.try(:first)[:value],\n  date: Time.parse(headers.select { |e| e[:name] == 'Date'}.try(:first)[:value]),\n  # \u30e1\u30fc\u30eb\u672c\u6587\u3060\u3051\u306fBase64ulr\u3067encode\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u30c7\u30b3\u30fc\u30c9\u3059\u308b\n  body: Base64.urlsafe_decode64(enc_base64url).force_encoding('UTF-8'),\n}\n\n\n\u4e0a\u8a18\u306e\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b\u306e\u306f\u3001\u30e1\u30fc\u30eb\u672c\u6587\u306e\u53d6\u5f97\u3002\n\u53d6\u5f97\u3057\u305f\u6642\u306fbase64url\u3067\u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c\u3066\u304a\u308a\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u3002\u3059\u308b\u3068ASCII-8BIT\u3067\u304b\u3048\u3063\u3066\u304f\u308b\u3002\n\u8868\u793a\u3059\u308b\u3068\u304b\u3060\u3051\u306a\u3089\u3053\u308c\u3067\u3088\u3044\u306e\u3060\u304c\u3001match\u304b\u3051\u305f\u308agsub\u3057\u305f\u308a\u3057\u305f\u3044\u3068\u306a\u308b\u3068\nutf8\u306b\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001force_encoding('UTF-8')\u3059\u308b\n\n\u6240\u611f\n\u3056\u3063\u304f\u308a\u3060\u3051\u3069\u3053\u3093\u306a\u611f\u3058\n\u30e1\u30fc\u30eb\u672c\u6587\u3092\u53d6\u308a\u51fa\u3059\u6642\u306b\u7d50\u69cb\u306f\u307e\u3063\u305f\u3051\u3069\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3081\u3070\u96e3\u3057\u3044\u3053\u3068\u306f\u306a\u3044\u306e\u3067\n\u3057\u3063\u304b\u308a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3080\nruby\u3055\u308f\u3063\u3066\u3044\u3066\u3001gmail\u306e\u4e2d\u8eab\u3092\u53d6\u5f97\u3057\u3066\u8272\u3005\u3057\u305f\u3044\u4eba\u304c\u3044\u308b\u3068\u601d\u3046\n\u300cgem gmail \u53d6\u5f97\u300d\u3068\u3044\u3046\u30af\u30a8\u30ea\u3067\u8abf\u3079\u308b\u3068\u4e0b\u8a18\u304c\u305f\u3076\u3093\u51fa\u3066\u304f\u308b\u3068\u601d\u3046\n\n* [gmail](https://github.com/gmailgem/gmail)\n* [ruby-gmail](https://github.com/gmailgem/gmail)\n\n\u3044\u305a\u308c\u3082[mail](https://github.com/mikel/mail)\u3068\u3044\u3046\u30e1\u30fc\u30eb\u306e\u9001\u53d7\u4fe1\u3092\u3088\u3057\u306a\u306b\u884c\u3063\u3066\u304f\u308c\u308bgem\u3092\u30e9\u30c3\u30d1\u30fc\u3057\u3066\u3044\u308b\u611f\u3058\u3002\n\u305f\u3060\u3057\u4e0a\u8a18\u3092\u4f7f\u3046\u306b\u306f[\u5b89\u5168\u6027\u306e\u4f4e\u3044\u30a2\u30d7\u30ea\u304c\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3092\u8a31\u53ef\u3059\u308b](https://support.google.com/accounts/answer/6010255?hl=ja)\u3092\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\u306a\u3093\u304b\u6c17\u6301\u3061\u7684\u306b\u3061\u3087\u3063\u3068\u5acc\u3060\n\n## **\u3068\u601d\u3063\u305f\u3089\u3053\u308c\u306f [Gmail\u306eAPI](https://developers.google.com/gmail/api/) \u304c\u516c\u958b\u3055\u308c\u308b\u307e\u3067\u306e\u8a71\u30672014\u5e74\u590f?\u79fb\u884c\u306fAPI\u3042\u308b\uff01\uff01**\n\n\u306a\u306e\u3067google\u5468\u308a\u306e\u30b5\u30fc\u30d3\u30b9\u4f7f\u3046\u3068\u304d\u306b\u306f\u304a\u99b4\u67d3\u307f\u306e\n`gem install \"google-api-client\"`\n\u3053\u308c\u3067\u3044\u3051\u308b\u3002\u5b09\u3057\u3044\u3002\u5b89\u5fc3\u3002\n\n[\u516c\u5f0f](https://developers.google.com/gmail/api/quickstart/ruby)\u306b\u30e9\u30d9\u30eb\u3092\u53d6\u5f97\u3059\u308b\u307e\u3067\u306e\u624b\u9806\u304c\u304b\u3044\u3066\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u53c2\u8003\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\n\u203b \u4e0b\u8a18\u304b\u3089\u306f\u4e0a\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u52d5\u3044\u3066\u308b\u524d\u63d0\u3067\uff01\n\n## \u5b9f\u969b\u306bgmail\u3092\u53d6\u5f97\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\n\u30e1\u30fc\u30eb\u306f[\u30b3\u30b3](https://developers.google.com/gmail/api/v1/reference/users/messages/get)\u306eapi\u3092\u53e9\u304f\u306e\u3060\u304c\u3001\u305d\u308c\u306b\u306fmail\u3092\u8b58\u5225\u3057\u3066\u3044\u308bid\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u305d\u308c\u3092[\u30b3\u30b3](https://developers.google.com/gmail/api/v1/reference/users/messages/list)\u304b\u3089\u53d6\u5f97\u3059\u308b\u3002\n\n### \u30e1\u30fc\u30eb\u306eid\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\n```lang:ruby\nresults = client.execute!(\n  api_method: gmail_api.users.messages.list,\n  parameters: { \n    userId: 'me',\n    q: 'is:read after:2015/12/20 before:2015/12/30 ' \n  }\n)\n\nresults.data.messages.each do |message|\n  p message.id\nend\n\n=> \"211df4423fb88\"\n   \"31fsd4423fb88\"\n```\n\u4e0a\u8a18\u306epoint\u306fparameters\u306b\u3044\u308c\u3066\u308bq\u3067\u3001\u3053\u3053\u306b\u306fgmail\u306e\u691c\u7d22\u30af\u30a8\u30ea\u3092\u305d\u306e\u307e\u307e\u5165\u308c\u3089\u308c\u308b\uff01\u3081\u3063\u3061\u3083\u4fbf\u5229\n\n### \u30e1\u30fc\u30eb\u306e\u8a73\u7d30\u3092\u53d6\u5f97\n```lang:ruby\nresults = client.execute!(\n  api_method: @gmail_api.users.messages.get,\n  parameters: { userId: 'me', id: '\u3010\u3055\u3063\u304d\u53d6\u5f97\u3057\u305fmail\u306eid\u3011' },\n)\n# json\u3067\u304b\u3048\u3063\u3066\u304f\u308b\u304b\u3089\u30d1\u30fc\u30b9\u3059\u308b\nobj = JSON.parse(results.response.body, symbolize_names: true)\nenc_base64url = obj[:payload][:parts].first[:body][:data]\nheaders = obj[:payload][:headers]\n\n{\n  subject: headers.select { |e| e[:name] == 'Subject'}.try(:first)[:value],\n  from: headers.select { |e| e[:name] == 'From'}.try(:first)[:value],\n  date: Time.parse(headers.select { |e| e[:name] == 'Date'}.try(:first)[:value]),\n  # \u30e1\u30fc\u30eb\u672c\u6587\u3060\u3051\u306fBase64ulr\u3067encode\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u30c7\u30b3\u30fc\u30c9\u3059\u308b\n  body: Base64.urlsafe_decode64(enc_base64url).force_encoding('UTF-8'),\n}\n```\n\u4e0a\u8a18\u306e\u30dd\u30a4\u30f3\u30c8\u306b\u306a\u308b\u306e\u306f\u3001\u30e1\u30fc\u30eb\u672c\u6587\u306e\u53d6\u5f97\u3002\n\u53d6\u5f97\u3057\u305f\u6642\u306fbase64url\u3067\u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c\u3066\u304a\u308a\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u3002\u3059\u308b\u3068ASCII-8BIT\u3067\u304b\u3048\u3063\u3066\u304f\u308b\u3002\n\u8868\u793a\u3059\u308b\u3068\u304b\u3060\u3051\u306a\u3089\u3053\u308c\u3067\u3088\u3044\u306e\u3060\u304c\u3001match\u304b\u3051\u305f\u308agsub\u3057\u305f\u308a\u3057\u305f\u3044\u3068\u306a\u308b\u3068\nutf8\u306b\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001`force_encoding('UTF-8')`\u3059\u308b\n\n## \u6240\u611f\n\u3056\u3063\u304f\u308a\u3060\u3051\u3069\u3053\u3093\u306a\u611f\u3058\n\u30e1\u30fc\u30eb\u672c\u6587\u3092\u53d6\u308a\u51fa\u3059\u6642\u306b\u7d50\u69cb\u306f\u307e\u3063\u305f\u3051\u3069\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3081\u3070\u96e3\u3057\u3044\u3053\u3068\u306f\u306a\u3044\u306e\u3067\n\u3057\u3063\u304b\u308a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3080\n"}