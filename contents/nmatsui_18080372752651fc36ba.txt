{"context": " More than 1 year has passed since last update.AWS\u3067VPC\u3092\u7528\u3044\u3066\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u3001vyatta\u3092\u7528\u3044\u3066IPsec VPN\u63a5\u7d9a\u3059\u308b\u3002\nAWS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5bfe\u3057\u3066SNAT/DNAT\u3092\u7528\u3044\u305f\u308aVPC\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u63db\u3048\u3092\u305b\u305a\u3068\u3082\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9\u540c\u58eb\u304cPeer-to-Peer\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\nSoftLayer\u306evyatta\u306e\u8a2d\u5b9a\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u30b5\u30f3\u30ce\u30bcDC\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306eVirtual Server\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nOS: Vyatta 6.6 Community Edision (64bi)\nCPU: 2.0GHz 1core\nRAM: 1GB RAM\n\n\n\n\nDC\n\u30db\u30b9\u30c8\u540d\n\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\n\n\n\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\nvyatta-sl-sng\n119.81.4.122\n119.81.4.120/29\n10.67.3.168\n10.67.3.128/26\n\n\n\u30b5\u30f3\u30ce\u30bc\nvyatta-sl-sjc\n198.11.204.45\n198.11.204.32/28\n10.88.63.157\n10.88.63.128/26\n\n\n\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306evyatta\u306e\u8a2d\u5b9a\nvyatta\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nSoftLayer\u306feth1\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u5074\u306eNIC\u306a\u306e\u3067\u3001eth1\u306b\u5bfe\u3057\u3066IPsec\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-sl-sng:~$ configure \n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ipsec-interfaces interface eth1\n[edit]\n\n\n\nNAT\u30c8\u30e9\u30d0\u30fc\u30b9\u306e\u6709\u52b9\u5316\nAWS VPC\u3078\u306e\u30d1\u30b1\u30c3\u30c8\u306fNAT\u3055\u308c\u308b\u305f\u3081\u3001NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\u8a31\u53ef\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u3001AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3002\n\nNAT\u30c8\u30e9\u30d0\u30fc\u30b9\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec nat-traversal enable\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec nat-networks allowed-network 192.168.0.0/16\n[edit]\n\n\n\nIKE\u3068ESP\u306e\u8a2d\u5b9a\n\u3053\u306e\u8a2d\u5b9a\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\nIKE\u3068ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE lifetime 3600\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE proposal 1 hash sha1\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP lifetime 3600\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP proposal 1 hash sha1\n[edit]\n\n\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nSoftLayer\u5074\u306f\u4efb\u610f\u306e\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u63a5\u7d9a\u3092\u53d7\u3051\u5165\u308c\u308b\u3002pre-shared-secret\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\u306a\u304alocal-address\u306fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3001local prefix\u306fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3001remote prefix\u306fAWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec site-to-site peer 0.0.0.0\n[edit]\nvyatta@vyatta-sl-sng# edit vpn ipsec site-to-site peer 0.0.0.0\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set ike-group IKE\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set local-address 119.81.4.122\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set tunnel 1 local prefix 10.67.3.128/26\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set tunnel 1 remote prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# commit\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n\n\n\n\u672c\u6765\u3067\u3042\u308c\u3070\u3001vyatta\u306efirewall\u6a5f\u80fd\u3067eth1\u5074\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u9ad8\u3081\u308b\u3079\u304d\u3060\u304c\u3001\u4eca\u56de\u306f\u691c\u8a3c\u306e\u305f\u3081\u5b9f\u65bd\u3057\u3066\u3044\u306a\u3044\u3002\n\n\n\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u8a2d\u5b9a\n\u57fa\u672c\u7684\u306b\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u540c\u4e00\u624b\u9806\u3060\u304c\u3001local-address\u3068local prefix\u306f\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3068\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nAWS VPC\u4f5c\u6210\n192.168.0.0/16\u3068\u3044\u3046VPC\u304b\u3089\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u3057\u3066192.168.0.0/24\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u3057\u3066192.168.1.0/24\u3092\u5207\u308a\u51fa\u3059\u3002\u306a\u304a\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306f\u540c\u3058Availability Zone\u306b\u6240\u5c5e\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\nVPC\u30a6\u30a3\u30b6\u30fc\u30c9\u304b\u3089VPC\u3068\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n192.168.0.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u3001ap-northeast-1c\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n192.168.1.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u3068\u540c\u3058ap-northeast-1c\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n\nAWS\u306evyatta\u8a2d\u5b9a\n\nvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eap-northeast-1c\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nAMI: Vyatta Core 6.6 R1 x86_64 rev1 - ami-07f47b06\ntype: t1.micro\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fVPC\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\u3053\u306e\u969beth0\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u306e\u3067\u3001\u30d7\u30e9\u30a4\u30de\u30eaIP\u3068\u3057\u3066192.168.0.10\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u307e\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306eeth1\u3092\u8ffd\u52a0\u3057\u3066\u3001\u30d7\u30e9\u30a4\u30de\u30eaIP\u3068\u3057\u3066192.168.1.10\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\u4eca\u56de\u306f\u691c\u8a3c\u306a\u306e\u3067\u3042\u307e\u308a\u7d30\u304b\u304f\u8a2d\u5b9a\u305b\u305a\u3001IPsec\u7528\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092SoftLayer\u304b\u3089\u53d7\u3051\u4ed8\u3051\u308b\u8a2d\u5b9a\u3068\u3001SoftLayer\u3068AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u304b\u3089\u306e\u5168\u3066\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u53d7\u3051\u4ed8\u3051\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n\nENI\u306e\u8a2d\u5b9a\u5909\u66f4\n \u91cd\u8981\nEC2\u306eENI\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u9001\u4fe1\u5143\u30fb\u9001\u4fe1\u5148\u306e\u3069\u3061\u3089\u306b\u3082\u81ea\u5206\u81ea\u8eab\u304c\u542b\u307e\u308c\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u3002\u3053\u308c\u3067\u306fvyatta\u304c\u30eb\u30fc\u30bf\u3068\u3057\u3066\u52d5\u4f5c\u3067\u304d\u306a\u3044\u305f\u3081\u3001vyatta\u304c\u30d1\u30b1\u30c3\u30c8\u3092\u8ee2\u9001\u3067\u304d\u308b\u3088\u3046\u306bENI\u306e\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u4ee5\u4e0b\u306f\u30d1\u30d6\u30ea\u30c3\u30af\u5074\uff08eth0\uff09\u306e\u8a2d\u5b9a\u5909\u66f4\u753b\u9762\u3060\u304c\u3001\u540c\u69d8\u306b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074\uff08eth1\uff09\u306e\u8a2d\u5b9a\u3082\u5909\u66f4\u3059\u308b\u3002\n\nENI\u306e\u8a2d\u5b9a\u78ba\u8a8d\n\n\n\nENI\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\n\nElastic IP\u306e\u4ed8\u4e0e\nvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u5074ENI\uff08192.168.0.10\uff09\u306bElastic IP\u3092\u5272\u308a\u5f53\u3066\u308b\u3002\n\nvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\u8ffd\u52a0NIC\u306e\u8a8d\u8b58\nAWS Management Console\u304b\u3089\u8ffd\u52a0\u3057\u305fENI\u306f\u3001\u305d\u306e\u307e\u307e\u3067\u306fOS\u306b\u8a8d\u8b58\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001OS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u8a8d\u8b58\u3055\u305b\u308b\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u5909\u66f4\nvyatta@vyatta:~$ sudo vi /etc/network/interfaces \nvyatta@vyatta:~$ cat /etc/network/interfaces \n# Used by ifup(8) and ifdown(8). See the interfaces(5) manpage or\n# /usr/share/doc/ifupdown/examples for more information.\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\n    address 192.168.0.10\n    netmask 255.255.255.0\n    gateway 192.168.0.1\n\nauto eth1\niface eth1 inet static\n    address 192.168.1.10\n    netmask 255.255.255.0\n\n\n\n\u30db\u30b9\u30c8\u540d\u5909\u66f4\n\u5f8c\u3005\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u30db\u30b9\u30c8\u540d\u3082\u5909\u66f4\u3059\u308b\u3002\n\n\u30db\u30b9\u30c8\u540d\u5909\u66f4\nvyatta@vyatta:~$ configure\n[edit]\nvyatta@vyatta# set system host-name vyatta-aws\n[edit]\nvyatta@vyatta# commit\n[ system host-name vyatta-aws ]\nStopping enhanced syslogd: rsyslogd.\nStarting enhanced syslogd: rsyslogd.\n\n[edit]\nvyatta@vyatta# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\nvyatta@vyatta# exit\nexit\n\n\n\n\u518d\u8d77\u52d5\n\u518d\u8d77\u52d5\u3057\u3066\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\u3002\n\n\u518d\u8d77\u52d5\nvyatta@vyatta:~$ sudo reboot\n\n\n\n\u8a2d\u5b9a\u78ba\u8a8d\n\u30db\u30b9\u30c8\u540d\u53ca\u3073NIC\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nNIC\u78ba\u8a8d\nvyatta@vyatta-aws:~$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 0a:2a:10:85:6f:55 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.10/24 brd 192.168.0.255 scope global eth0\n    inet6 fe80::82a:10ff:fe85:6f55/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 0a:b1:de:fc:05:39 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.10/24 brd 192.168.1.255 scope global eth1\n    inet6 fe80::8b1:deff:fefc:539/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\nAWS\u306evyatta\u306e\u8a2d\u5b9a\nvyatta\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nSoftLayer\u3068\u306f\u9006\u306b\u3001\u8a2d\u5b9a\u3057\u305fVPC\u3067\u306feth0\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u5074\u306eNIC\u306a\u306e\u3067\u3001eth0\u306b\u5bfe\u3057\u3066IPsec\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-aws:~$ configure\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ipsec-interfaces interface eth0\n[edit]\n\n\n\nNAT\u30c8\u30e9\u30d0\u30fc\u30b9\u306e\u6709\u52b9\u5316\nSoftLayer\u3067\u306e\u5834\u5408\u3068\u540c\u69d8\u3001NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u30b5\u30f3\u30ce\u30bc\u306e\u500b\u3005\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a31\u53ef\u3057\u3066\u3082\u826f\u3044\u304c\u300110.0.0.0/8\u3067SoftLayer\u306e\u5168\u3066\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a31\u53ef\u3067\u304d\u308b\u3002\n\nNAT\u30c8\u30e9\u30d0\u30fc\u30b9\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec nat-traversal enable\n[edit]\nvyatta@vyatta-aws# set vpn ipsec nat-networks allowed-network 10.0.0.0/8\n[edit]\n\n\n\nIKE\u3068ESP\u306e\u8a2d\u5b9a\nSoftLayer\u3068\u540c\u4e00\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nIKE\u3068ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE lifetime 3600\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE proposal 1 hash sha1\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP lifetime 3600\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP proposal 1 hash sha1\n[edit]\n\n\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nAWS\u304b\u3089\u306f\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u30b5\u30f3\u30ce\u30bc\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u305d\u308c\u305e\u308c\u500b\u5225\u306b\u8a2d\u5b9a\u3059\u308b\u3002pre-shared-secret\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\u306a\u304alocal-address\u306f\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u5074\uff08eth0\uff09\u306eIP\u3001local prefix\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3001remote prefix\u306f\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3001\u30b5\u30f3\u30ce\u30bc\u305d\u308c\u305e\u308c\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec site-to-site peer 119.81.4.122\n[edit]\nvyatta@vyatta-aws# edit vpn ipsec site-to-site peer 119.81.4.122\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws#  set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set ike-group IKE\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set local-address 192.168.0.10\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set tunnel 1 local prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set tunnel 1 remote prefix 10.67.3.128/26\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# top\n[edit]\n\n\n\n\u30b5\u30f3\u30ce\u30bc\u3068\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec site-to-site peer 198.11.204.45\n[edit]\nvyatta@vyatta-aws# edit vpn ipsec site-to-site peer 198.11.204.45\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set ike-group IKE\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set local-address 192.168.0.10\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set tunnel 1 local prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set tunnel 1 remote prefix 10.88.63.128/26\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# commit\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n\n\n\nIPsec\u63a5\u7d9a\u306e\u72b6\u614b\u78ba\u8a8d\n\u3053\u3053\u307e\u3067\u3067\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC \u21d4 AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u21d4 SoftLayer\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u304cIPsec\u3067\u63a5\u7d9a\u3055\u308c\u305f\u3002\nshow vpn ike sa\u3067State\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3001show vpn ipsec sa\u3067\u6709\u52b9\u306aTunnel\u304cup\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3001\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-sl-sng# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           119.81.4.122                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    144     3600   \n\n\n[edit]\nvyatta@vyatta-sl-sng# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n0.0.0.0                                 119.81.4.122                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       down   n/a            n/a      n/a   no     0       3600    all\n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           119.81.4.122                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1[2]    up     0.0/0.0        aes256   sha1  yes    150     3600    all\n\n\n[edit]\n\n\n\nSoftLayer\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-sl-sjc# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           198.11.204.45                          \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    204     3600   \n\n\n[edit]\nvyatta@vyatta-sl-sjc# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n0.0.0.0                                 198.11.204.45                          \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       down   n/a            n/a      n/a   no     0       3600    all\n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           198.11.204.45                          \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1[2]    up     0.0/0.0        aes256   sha1  yes    211     3600    all\n\n\n[edit]\n\n\n\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-aws# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n119.81.4.122                            192.168.0.10                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    1290    3600   \n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n198.11.204.45                           192.168.0.10                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    1048    3600   \n\n\n[edit]\nvyatta@vyatta-aws# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n119.81.4.122                            192.168.0.10                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       up     0.0/0.0        aes256   sha1  yes    1265    3600    all\n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n198.11.204.45                           192.168.0.10                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       up     0.0/0.0        aes256   sha1  yes    1274    3600    all\n\n\n[edit]\n\n\n\n\u5404vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306e\u63a5\u7d9a\nSoftLayer\u3067VLAN Spanning\u3092ON\u306b\u3057\u3066\u3044\u308b\u3068\u3001\u5404DC\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u9593\u306f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3055\u308c\u308b\u3002\n\u305d\u306e\u305f\u3081\u3053\u3053\u307e\u3067\u306e\u72b6\u614b\u3067\u3001\u6771\u4eac\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3001\u30b5\u30f3\u30ce\u30bc\u306e\u5404vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3067\u758e\u901a\u3067\u304d\u308b\u3002\n\u4ee5\u4e0b\u306fAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u304b\u3089\u306e\u63a5\u7d9a\u72b6\u614b\u3060\u304c\u3001\u5168\u3066\u306evyatta\u3067\u758e\u901a\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nAWS\u6771\u4eac\u304b\u3089\nvyatta@vyatta-aws# ping -c3 10.67.3.168\nPING 10.67.3.168 (10.67.3.168) 56(84) bytes of data.\n64 bytes from 10.67.3.168: icmp_req=1 ttl=64 time=70.2 ms\n64 bytes from 10.67.3.168: icmp_req=2 ttl=64 time=70.1 ms\n64 bytes from 10.67.3.168: icmp_req=3 ttl=64 time=73.0 ms\n\n--- 10.67.3.168 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2000ms\nrtt min/avg/max/mdev = 70.114/71.148/73.050/1.380 ms\n[edit]\nvyatta@vyatta-aws# ping -c3 10.88.63.157\nPING 10.88.63.157 (10.88.63.157) 56(84) bytes of data.\n64 bytes from 10.88.63.157: icmp_req=1 ttl=64 time=105 ms\n64 bytes from 10.88.63.157: icmp_req=2 ttl=64 time=105 ms\n64 bytes from 10.88.63.157: icmp_req=3 ttl=64 time=103 ms\n\n--- 10.88.63.157 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 103.365/104.738/105.499/0.972 ms\n[edit]\nvyatta@vyatta-aws# ping -c3 192.168.1.10\nPING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.\n64 bytes from 192.168.1.10: icmp_req=1 ttl=64 time=0.044 ms\n64 bytes from 192.168.1.10: icmp_req=2 ttl=64 time=0.061 ms\n64 bytes from 192.168.1.10: icmp_req=3 ttl=64 time=0.060 ms\n\n--- 192.168.1.10 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1998ms\nrtt min/avg/max/mdev = 0.044/0.055/0.061/0.007 ms\n[edit]\n\n\n\nSoftLayer\u3067\u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306eVirtual Server\u3092\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u30b5\u30f3\u30ce\u30bcDC\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nOS: Ubuntu 14.04 LTS (64 bit) \nCPU: 2.0GHz 1core\nRAM: 1GB RAM\n\n\n\n\nDC\n\u30db\u30b9\u30c8\u540d\n\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\n\n\n\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\ntest-sl-sng-01\n119.81.4.123\n10.67.3.184\n\n\n\u30b5\u30f3\u30ce\u30bc\ntest-sl-sjc-01\n198.11.204.40\n10.88.63.164\n\n\n\u30b5\u30f3\u30ce\u30bc\ntest-sl-sjc-02\n198.11.204.37\n10.88.63.187\n\n\n\n\n\u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\nAWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3002\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sng-01:~# ip route add 192.168.0.0/16 via 10.67.3.168 dev eth0\n\n\n\n\u30b5\u30f3\u30ce\u30bc\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sjc-01:~# ip route add 192.168.0.0/16 via 10.88.63.157 dev eth0\n\n\n\nAWS\u3067\u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eap-northeast-1c\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nAMI: ubuntu/images/ebs-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-8d6d9d8d\ntype: t1.micro\n\n\n\n\n\u30db\u30b9\u30c8\u540d\n\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\n\n\n\n\ntest-aws-01\n192.168.0.21\n192.168.1.21\n\n\ntest-aws-02\n192.168.0.22\n192.168.1.22\n\n\n\n\u203b vyatta\u306e\u5834\u5408\u3068\u540c\u69d8\u3001eth0\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3001eth1\u3092\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\n\u203b\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u306f\u6709\u52b9\u306e\u307e\u307e\u3067\u826f\u3044\n\u203b \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001SoftLayer\u3068AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u5168\u3066\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u3059\u308b\n\n\n\u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\u8ffd\u52a0NIC\u306e\u8a8d\u8b58\nvyatta\u306e\u5834\u5408\u3068\u540c\u69d8\u3001OS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u8ffd\u52a0\u3057\u305fNIC\u3092\u8a8d\u8b58\u3055\u305b\u308b\u3002\n\u4ee5\u4e0b\u306ftest-aws-01\u306e\u4f8b\u3060\u304c\u3001test-aws-02\u3067\u3082\u540c\u69d8\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u5909\u66f4\nubuntu@ip-192-168-0-21:~$ sudo vi /etc/network/interfaces\nubuntu@ip-192-168-0-21:~$ cat /etc/network/interfaces\n# This file describes the network interfaces available on your system\n# and how to activate them. For more information, see interfaces(5).\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# Source interfaces\n# Please check /etc/network/interfaces.d before changing this file\n# as interfaces may have been defined in /etc/network/interfaces.d\n# NOTE: the primary ethernet device is defined in\n# /etc/network/interfaces.d/eth0\n# See LP: #1262951\n#source /etc/network/interfaces.d/*.cfg\nauto eth0\niface eth0 inet static\n    address 192.168.0.21\n    netmask 255.255.255.0\n    gateway 192.168.0.1\n\nauto eth1\niface eth1 inet static\n    address 192.168.1.21\n    netmask 255.255.255.0\n\n\n\n\u30db\u30b9\u30c8\u540d\u5909\u66f4\n\u5f8c\u3005\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u30db\u30b9\u30c8\u540d\u3082\u5909\u66f4\u3059\u308b\u3002\n\n\u30db\u30b9\u30c8\u540d\u5909\u66f4\nubuntu@ip-192-168-0-21:~$ sudo vi /etc/hostname\nubuntu@ip-192-168-0-21:~$ cat /etc/hostname \ntest-aws-01\n\n\n\n\u518d\u8d77\u52d5\n\n\u518d\u8d77\u52d5\nubuntu@ip-192-168-0-21:~$ sudo reboot\n\n\n\n\u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\nSoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3002\n\n\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nubuntu@test-aws-01:~$ sudo ip route add 10.0.0.0/8 via 192.168.1.10 dev eth1\n\n\n\n\u63a5\u7d9a\u78ba\u8a8d\nAWS test-aws-01\u3067Netcat\u3092\u8d77\u52d5\u3057\u3001\u5404\u30c6\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089TCP\u63a5\u7d9a\u3092\u8a66\u307f\u308b\u3002\n\n\u9001\u4fe1\u5074\nubuntu@test-aws-02:~$ echo 'from test-aws-02' | nc 192.168.1.21 7777\n\nroot@test-sl-sng-01:~# echo 'from test-sl-sng-01' | nc 192.168.1.21 7777\n\nroot@test-sl-sjc-01:~# echo 'from test-sl-sjc-01' | nc 192.168.1.21 7777\n\nroot@test-sl-sjc-02:~# echo 'from test-sl-sjc-02' | nc 192.168.1.21 7777\n\n\n\n\u53d7\u4fe1\u5074\nubuntu@test-aws-01:~$ nc -l -k -p 7777\nfrom test-aws-02\nfrom test-sl-sng-01\nfrom test-sl-sjc-01\nfrom test-sl-sjc-02\n\n\n\u540c\u69d8\u306e\u624b\u9806\u306b\u3088\u308a\u3001\u5168\u3066\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u304a\u4e92\u3044\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3067\u901a\u4fe1\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\u307e\u3068\u3081\nAWS\u3067VPC\u3092\u7528\u3044\u3066\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092VPN\u63a5\u7d9a\u3057\u3001SNAT/DNAT\u3084VPC\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u63db\u3048\u3092\u3057\u306a\u304f\u3066\u3082\u9069\u5207\u306b\u30d1\u30b1\u30c3\u30c8\u3092\u758e\u901a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u3002\u4eca\u5f8c\u306fAWS\u306e\u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u5bfe\u5fdc\u3084\u3001Azure\u7b49\u306e\u5225\u30af\u30e9\u30a6\u30c9\u3078\u306e\u5bfe\u5fdc\u306a\u3069\u306b\u3082\u53d6\u308a\u7d44\u307f\u305f\u3044\u3002\nAWS\u3067VPC\u3092\u7528\u3044\u3066\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u3001vyatta\u3092\u7528\u3044\u3066IPsec VPN\u63a5\u7d9a\u3059\u308b\u3002\nAWS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5bfe\u3057\u3066SNAT/DNAT\u3092\u7528\u3044\u305f\u308aVPC\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u63db\u3048\u3092\u305b\u305a\u3068\u3082\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9\u540c\u58eb\u304cPeer-to-Peer\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n![aws_sl_vpn.png](https://qiita-image-store.s3.amazonaws.com/0/37648/83e41190-8af7-ec57-fe1d-669ee6a39e12.png)\n\n# SoftLayer\u306evyatta\u306e\u8a2d\u5b9a\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u30b5\u30f3\u30ce\u30bcDC\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306eVirtual Server\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* OS: Vyatta 6.6 Community Edision (64bi)\n* CPU: 2.0GHz 1core\n* RAM: 1GB RAM\n\n|DC|\u30db\u30b9\u30c8\u540d|\u30d1\u30d6\u30ea\u30c3\u30afIP|\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8|\n|:--|:--|:--|:--|:--|:--|\n|\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb|vyatta-sl-sng|119.81.4.122|119.81.4.120/29|10.67.3.168|10.67.3.128/26|\n|\u30b5\u30f3\u30ce\u30bc|vyatta-sl-sjc|198.11.204.45|198.11.204.32/28|10.88.63.157|10.88.63.128/26|\n\n## \u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306evyatta\u306e\u8a2d\u5b9a\n\nvyatta\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n\n### IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\n\nSoftLayer\u306feth1\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u5074\u306eNIC\u306a\u306e\u3067\u3001eth1\u306b\u5bfe\u3057\u3066IPsec\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```text:IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-sl-sng:~$ configure \n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ipsec-interfaces interface eth1\n[edit]\n```\n\n### NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u306e\u6709\u52b9\u5316\n\nAWS VPC\u3078\u306e\u30d1\u30b1\u30c3\u30c8\u306fNAT\u3055\u308c\u308b\u305f\u3081\u3001NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\u8a31\u53ef\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u3001AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3002\n\n```text:NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec nat-traversal enable\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec nat-networks allowed-network 192.168.0.0/16\n[edit]\n```\n\n### IKE\u3068ESP\u306e\u8a2d\u5b9a\n\n\u3053\u306e\u8a2d\u5b9a\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\n```text:IKE\u3068ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE lifetime 3600\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec ike-group IKE proposal 1 hash sha1\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP lifetime 3600\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-sl-sng# set vpn ipsec esp-group ESP proposal 1 hash sha1\n[edit]\n```\n\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\nSoftLayer\u5074\u306f\u4efb\u610f\u306e\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u63a5\u7d9a\u3092\u53d7\u3051\u5165\u308c\u308b\u3002**pre-shared-secret**\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\u306a\u304a**local-address**\u306fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3001**local prefix**\u306fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3001**remote prefix**\u306fAWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```text:\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-sng# set vpn ipsec site-to-site peer 0.0.0.0\n[edit]\nvyatta@vyatta-sl-sng# edit vpn ipsec site-to-site peer 0.0.0.0\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set ike-group IKE\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set local-address 119.81.4.122\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set tunnel 1 local prefix 10.67.3.128/26\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# set tunnel 1 remote prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# commit\n[edit vpn ipsec site-to-site peer 0.0.0.0]\nvyatta@vyatta-sl-sng# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n```\n\n> \u672c\u6765\u3067\u3042\u308c\u3070\u3001vyatta\u306efirewall\u6a5f\u80fd\u3067eth1\u5074\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u9ad8\u3081\u308b\u3079\u304d\u3060\u304c\u3001\u4eca\u56de\u306f\u691c\u8a3c\u306e\u305f\u3081\u5b9f\u65bd\u3057\u3066\u3044\u306a\u3044\u3002\n\n## \u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u8a2d\u5b9a\n\n\u57fa\u672c\u7684\u306b\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u540c\u4e00\u624b\u9806\u3060\u304c\u3001**local-address**\u3068**local prefix**\u306f\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3068\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n# AWS VPC\u4f5c\u6210\n\n192.168.0.0/16\u3068\u3044\u3046VPC\u304b\u3089\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u3057\u3066192.168.0.0/24\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u3057\u3066192.168.1.0/24\u3092\u5207\u308a\u51fa\u3059\u3002\u306a\u304a\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3068\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306f\u540c\u3058Availability Zone\u306b\u6240\u5c5e\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n## VPC\u30a6\u30a3\u30b6\u30fc\u30c9\u304b\u3089VPC\u3068\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n\n192.168.0.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u3001**ap-northeast-1c**\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n![aws_sl_vpn_01.png](https://qiita-image-store.s3.amazonaws.com/0/37648/29a6ec3d-a24a-da60-43ad-5950a33d1e60.png)\n\n## \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n\n192.168.1.0/24\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u3068\u540c\u3058**ap-northeast-1c**\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n![aws_sl_vpn_02.png](https://qiita-image-store.s3.amazonaws.com/0/37648/857bb597-a2bd-0d07-a379-f526a4714240.png)\n\n# AWS\u306evyatta\u8a2d\u5b9a\n\n## vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e**ap-northeast-1c**\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* AMI: Vyatta Core 6.6 R1 x86_64 rev1 - ami-07f47b06\n* type: t1.micro\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fVPC\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3067\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\u3053\u306e\u969beth0\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u306e\u3067\u3001\u30d7\u30e9\u30a4\u30de\u30eaIP\u3068\u3057\u3066192.168.0.10\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\u307e\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306eeth1\u3092\u8ffd\u52a0\u3057\u3066\u3001\u30d7\u30e9\u30a4\u30de\u30eaIP\u3068\u3057\u3066192.168.1.10\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n![aws_sl_vpn_03.png](https://qiita-image-store.s3.amazonaws.com/0/37648/eddc2af3-ab66-413a-202a-bd6160a56b60.png)\n\n### \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\n\u4eca\u56de\u306f\u691c\u8a3c\u306a\u306e\u3067\u3042\u307e\u308a\u7d30\u304b\u304f\u8a2d\u5b9a\u305b\u305a\u3001IPsec\u7528\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092SoftLayer\u304b\u3089\u53d7\u3051\u4ed8\u3051\u308b\u8a2d\u5b9a\u3068\u3001SoftLayer\u3068AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u304b\u3089\u306e\u5168\u3066\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u53d7\u3051\u4ed8\u3051\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n![aws_sl_vpn_04.png](https://qiita-image-store.s3.amazonaws.com/0/37648/7e46ef5e-15df-ae50-8175-ceec383d7b4a.png)\n\n## ENI\u306e\u8a2d\u5b9a\u5909\u66f4\n\n:bangbang: **\u91cd\u8981**\n\nEC2\u306eENI\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u9001\u4fe1\u5143\u30fb\u9001\u4fe1\u5148\u306e\u3069\u3061\u3089\u306b\u3082\u81ea\u5206\u81ea\u8eab\u304c\u542b\u307e\u308c\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u3002\u3053\u308c\u3067\u306fvyatta\u304c\u30eb\u30fc\u30bf\u3068\u3057\u3066\u52d5\u4f5c\u3067\u304d\u306a\u3044\u305f\u3081\u3001vyatta\u304c\u30d1\u30b1\u30c3\u30c8\u3092\u8ee2\u9001\u3067\u304d\u308b\u3088\u3046\u306bENI\u306e\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u4ee5\u4e0b\u306f\u30d1\u30d6\u30ea\u30c3\u30af\u5074\uff08eth0\uff09\u306e\u8a2d\u5b9a\u5909\u66f4\u753b\u9762\u3060\u304c\u3001\u540c\u69d8\u306b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074\uff08eth1\uff09\u306e\u8a2d\u5b9a\u3082\u5909\u66f4\u3059\u308b\u3002\n\n### ENI\u306e\u8a2d\u5b9a\u78ba\u8a8d\n\n![aws_sl_vpn_05.png](https://qiita-image-store.s3.amazonaws.com/0/37648/cbdd048f-bec5-7827-3b1f-590a862e157b.png)\n\n![aws_sl_vpn_06.png](https://qiita-image-store.s3.amazonaws.com/0/37648/4b885969-5fa3-a8b2-1fb0-461339ceb8a6.png)\n\n### ENI\u306e\u8a2d\u5b9a\u5909\u66f4\n\n![aws_sl_vpn_07.png](https://qiita-image-store.s3.amazonaws.com/0/37648/36dbbd66-7111-86ad-60d6-35fbfceff117.png)\n\n![aws_sl_vpn_08.png](https://qiita-image-store.s3.amazonaws.com/0/37648/9b776a10-b50b-adfc-cbfc-1bc9987da431.png)\n\n## Elastic IP\u306e\u4ed8\u4e0e\n\nvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u5074ENI\uff08192.168.0.10\uff09\u306bElastic IP\u3092\u5272\u308a\u5f53\u3066\u308b\u3002\n\n## vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u5909\u66f4\n\n### \u8ffd\u52a0NIC\u306e\u8a8d\u8b58\n\nAWS Management Console\u304b\u3089\u8ffd\u52a0\u3057\u305fENI\u306f\u3001\u305d\u306e\u307e\u307e\u3067\u306fOS\u306b\u8a8d\u8b58\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001OS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u8a8d\u8b58\u3055\u305b\u308b\u3002\n\n```text:\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u5909\u66f4\nvyatta@vyatta:~$ sudo vi /etc/network/interfaces \nvyatta@vyatta:~$ cat /etc/network/interfaces \n# Used by ifup(8) and ifdown(8). See the interfaces(5) manpage or\n# /usr/share/doc/ifupdown/examples for more information.\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\n    address 192.168.0.10\n    netmask 255.255.255.0\n    gateway 192.168.0.1\n\nauto eth1\niface eth1 inet static\n    address 192.168.1.10\n    netmask 255.255.255.0\n```\n\n### \u30db\u30b9\u30c8\u540d\u5909\u66f4\n\n\u5f8c\u3005\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u30db\u30b9\u30c8\u540d\u3082\u5909\u66f4\u3059\u308b\u3002\n\n```text:\u30db\u30b9\u30c8\u540d\u5909\u66f4\nvyatta@vyatta:~$ configure\n[edit]\nvyatta@vyatta# set system host-name vyatta-aws\n[edit]\nvyatta@vyatta# commit\n[ system host-name vyatta-aws ]\nStopping enhanced syslogd: rsyslogd.\nStarting enhanced syslogd: rsyslogd.\n\n[edit]\nvyatta@vyatta# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\nvyatta@vyatta# exit\nexit\n```\n\n### \u518d\u8d77\u52d5\n\n\u518d\u8d77\u52d5\u3057\u3066\u5909\u66f4\u3092\u53cd\u6620\u3055\u305b\u308b\u3002\n\n```text:\u518d\u8d77\u52d5\nvyatta@vyatta:~$ sudo reboot\n```\n\n### \u8a2d\u5b9a\u78ba\u8a8d\n\n\u30db\u30b9\u30c8\u540d\u53ca\u3073NIC\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```text:NIC\u78ba\u8a8d\nvyatta@vyatta-aws:~$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 0a:2a:10:85:6f:55 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.10/24 brd 192.168.0.255 scope global eth0\n    inet6 fe80::82a:10ff:fe85:6f55/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000\n    link/ether 0a:b1:de:fc:05:39 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.10/24 brd 192.168.1.255 scope global eth1\n    inet6 fe80::8b1:deff:fefc:539/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n## AWS\u306evyatta\u306e\u8a2d\u5b9a\n\nvyatta\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u884c\u3046\n\n### IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\n\nSoftLayer\u3068\u306f\u9006\u306b\u3001\u8a2d\u5b9a\u3057\u305fVPC\u3067\u306feth0\u304c\u30d1\u30d6\u30ea\u30c3\u30af\u5074\u306eNIC\u306a\u306e\u3067\u3001eth0\u306b\u5bfe\u3057\u3066IPsec\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```text:IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-aws:~$ configure\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ipsec-interfaces interface eth0\n[edit]\n```\n\n### NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u306e\u6709\u52b9\u5316\n\nSoftLayer\u3067\u306e\u5834\u5408\u3068\u540c\u69d8\u3001NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u30b5\u30f3\u30ce\u30bc\u306e\u500b\u3005\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a31\u53ef\u3057\u3066\u3082\u826f\u3044\u304c\u300110.0.0.0/8\u3067SoftLayer\u306e\u5168\u3066\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a31\u53ef\u3067\u304d\u308b\u3002\n\n```text:NAT\u30c8\u30e9\u30d0\u30fc\u30b9\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec nat-traversal enable\n[edit]\nvyatta@vyatta-aws# set vpn ipsec nat-networks allowed-network 10.0.0.0/8\n[edit]\n```\n\n### IKE\u3068ESP\u306e\u8a2d\u5b9a\n\nSoftLayer\u3068\u540c\u4e00\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n```text:IKE\u3068ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE lifetime 3600\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-aws# set vpn ipsec ike-group IKE proposal 1 hash sha1\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP lifetime 3600\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP proposal 1 encryption aes256\n[edit]\nvyatta@vyatta-aws# set vpn ipsec esp-group ESP proposal 1 hash sha1\n[edit]\n```\n\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\nAWS\u304b\u3089\u306f\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u30b5\u30f3\u30ce\u30bc\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u305d\u308c\u305e\u308c\u500b\u5225\u306b\u8a2d\u5b9a\u3059\u308b\u3002**pre-shared-secret**\u306f\u5168\u3066\u306evyatta\u3067\u5171\u901a\u306b\u3059\u308b\u3002\n\u306a\u304a**local-address**\u306f\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u5074\uff08eth0\uff09\u306eIP\u3001**local prefix**\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3001**remote prefix**\u306f\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3001\u30b5\u30f3\u30ce\u30bc\u305d\u308c\u305e\u308c\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```text:\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec site-to-site peer 119.81.4.122\n[edit]\nvyatta@vyatta-aws# edit vpn ipsec site-to-site peer 119.81.4.122\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws#  set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set ike-group IKE\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set local-address 192.168.0.10\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set tunnel 1 local prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# set tunnel 1 remote prefix 10.67.3.128/26\n[edit vpn ipsec site-to-site peer 119.81.4.122]\nvyatta@vyatta-aws# top\n[edit]\n```\n\n```text:\u30b5\u30f3\u30ce\u30bc\u3068\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-aws# set vpn ipsec site-to-site peer 198.11.204.45\n[edit]\nvyatta@vyatta-aws# edit vpn ipsec site-to-site peer 198.11.204.45\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set authentication mode pre-shared-secret\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set authentication pre-shared-secret <\u79d8\u5bc6\u306e\u30ad\u30fc\u30ef\u30fc\u30c9>\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set default-esp-group ESP\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set ike-group IKE\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set local-address 192.168.0.10\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set tunnel 1 local prefix 192.168.1.0/24\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# set tunnel 1 remote prefix 10.88.63.128/26\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# commit\n[edit vpn ipsec site-to-site peer 198.11.204.45]\nvyatta@vyatta-aws# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n```\n\n# IPsec\u63a5\u7d9a\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u3053\u3053\u307e\u3067\u3067\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC \u21d4 AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u21d4 SoftLayer\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u304cIPsec\u3067\u63a5\u7d9a\u3055\u308c\u305f\u3002\n`show vpn ike sa`\u3067State\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3001`show vpn ipsec sa`\u3067\u6709\u52b9\u306aTunnel\u304cup\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3001\u6b63\u3057\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```text:SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-sl-sng# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           119.81.4.122                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    144     3600   \n\n \n[edit]\nvyatta@vyatta-sl-sng# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n0.0.0.0                                 119.81.4.122                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       down   n/a            n/a      n/a   no     0       3600    all\n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           119.81.4.122                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1[2]    up     0.0/0.0        aes256   sha1  yes    150     3600    all\n\n \n[edit]\n```\n\n```text:SoftLayer\u30b5\u30f3\u30ce\u30bcDC\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-sl-sjc# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           198.11.204.45                          \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    204     3600   \n\n \n[edit]\nvyatta@vyatta-sl-sjc# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n0.0.0.0                                 198.11.204.45                          \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       down   n/a            n/a      n/a   no     0       3600    all\n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n52.69.255.138                           198.11.204.45                          \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1[2]    up     0.0/0.0        aes256   sha1  yes    211     3600    all\n\n \n[edit]\n```\n\n```text:AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u306e\u72b6\u614b\nvyatta@vyatta-aws# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n119.81.4.122                            192.168.0.10                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    1290    3600   \n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n198.11.204.45                           192.168.0.10                           \n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes256   sha1  5        yes    1048    3600   \n\n \n[edit]\nvyatta@vyatta-aws# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n119.81.4.122                            192.168.0.10                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       up     0.0/0.0        aes256   sha1  yes    1265    3600    all\n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n198.11.204.45                           192.168.0.10                           \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    1       up     0.0/0.0        aes256   sha1  yes    1274    3600    all\n\n \n[edit]\n```\n\n# \u5404vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306e\u63a5\u7d9a\n\nSoftLayer\u3067VLAN Spanning\u3092ON\u306b\u3057\u3066\u3044\u308b\u3068\u3001\u5404DC\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u9593\u306f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3055\u308c\u308b\u3002\n\u305d\u306e\u305f\u3081\u3053\u3053\u307e\u3067\u306e\u72b6\u614b\u3067\u3001\u6771\u4eac\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3001\u30b5\u30f3\u30ce\u30bc\u306e\u5404vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3067\u758e\u901a\u3067\u304d\u308b\u3002\n\n\u4ee5\u4e0b\u306fAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u304b\u3089\u306e\u63a5\u7d9a\u72b6\u614b\u3060\u304c\u3001\u5168\u3066\u306evyatta\u3067\u758e\u901a\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```text:AWS\u6771\u4eac\u304b\u3089\nvyatta@vyatta-aws# ping -c3 10.67.3.168\nPING 10.67.3.168 (10.67.3.168) 56(84) bytes of data.\n64 bytes from 10.67.3.168: icmp_req=1 ttl=64 time=70.2 ms\n64 bytes from 10.67.3.168: icmp_req=2 ttl=64 time=70.1 ms\n64 bytes from 10.67.3.168: icmp_req=3 ttl=64 time=73.0 ms\n\n--- 10.67.3.168 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2000ms\nrtt min/avg/max/mdev = 70.114/71.148/73.050/1.380 ms\n[edit]\nvyatta@vyatta-aws# ping -c3 10.88.63.157\nPING 10.88.63.157 (10.88.63.157) 56(84) bytes of data.\n64 bytes from 10.88.63.157: icmp_req=1 ttl=64 time=105 ms\n64 bytes from 10.88.63.157: icmp_req=2 ttl=64 time=105 ms\n64 bytes from 10.88.63.157: icmp_req=3 ttl=64 time=103 ms\n\n--- 10.88.63.157 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 103.365/104.738/105.499/0.972 ms\n[edit]\nvyatta@vyatta-aws# ping -c3 192.168.1.10\nPING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.\n64 bytes from 192.168.1.10: icmp_req=1 ttl=64 time=0.044 ms\n64 bytes from 192.168.1.10: icmp_req=2 ttl=64 time=0.061 ms\n64 bytes from 192.168.1.10: icmp_req=3 ttl=64 time=0.060 ms\n\n--- 192.168.1.10 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1998ms\nrtt min/avg/max/mdev = 0.044/0.055/0.061/0.007 ms\n[edit]\n```\n\n# SoftLayer\u3067\u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\n\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306eVirtual Server\u3092\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u30b5\u30f3\u30ce\u30bcDC\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* OS: Ubuntu 14.04 LTS (64 bit) \n* CPU: 2.0GHz 1core\n* RAM: 1GB RAM\n\n|DC|\u30db\u30b9\u30c8\u540d|\u30d1\u30d6\u30ea\u30c3\u30afIP|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP|\n|:--|:--|:--|:--|\n|\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb|test-sl-sng-01|119.81.4.123|10.67.3.184|\n|\u30b5\u30f3\u30ce\u30bc|test-sl-sjc-01|198.11.204.40|10.88.63.164|\n|\u30b5\u30f3\u30ce\u30bc|test-sl-sjc-02|198.11.204.37|10.88.63.187|\n\n## \u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\n\nAWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3002\n\n```text:\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sng-01:~# ip route add 192.168.0.0/16 via 10.67.3.168 dev eth0\n```\n\n```text:\u30b5\u30f3\u30ce\u30bc\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sjc-01:~# ip route add 192.168.0.0/16 via 10.88.63.157 dev eth0\n```\n\n# AWS\u3067\u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\n\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eap-northeast-1c\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* AMI: ubuntu/images/ebs-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-8d6d9d8d\n* type: t1.micro\n\n|\u30db\u30b9\u30c8\u540d|\u30d1\u30d6\u30ea\u30c3\u30afIP|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP|\n|:--|:--|:--|\n|test-aws-01|192.168.0.21|192.168.1.21|\n|test-aws-02|192.168.0.22|192.168.1.22|\n\n\u203b vyatta\u306e\u5834\u5408\u3068\u540c\u69d8\u3001eth0\u3092\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3001eth1\u3092\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3078\u63a5\u7d9a\u3059\u308b\n\u203b\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u306f\u6709\u52b9\u306e\u307e\u307e\u3067\u826f\u3044\n\u203b \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u3001SoftLayer\u3068AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u306e\u5168\u3066\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u3059\u308b\n\n![aws_sl_vpn_09.png](https://qiita-image-store.s3.amazonaws.com/0/37648/fbc9afea-f0c5-7acc-76e1-edd6ea63d3c0.png)\n\n## \u63a5\u7d9a\u78ba\u8a8d\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u5909\u66f4\n\n### \u8ffd\u52a0NIC\u306e\u8a8d\u8b58\n\nvyatta\u306e\u5834\u5408\u3068\u540c\u69d8\u3001OS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u8ffd\u52a0\u3057\u305fNIC\u3092\u8a8d\u8b58\u3055\u305b\u308b\u3002\n\u4ee5\u4e0b\u306ftest-aws-01\u306e\u4f8b\u3060\u304c\u3001test-aws-02\u3067\u3082\u540c\u69d8\u3002\n\n```text:\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u5909\u66f4\nubuntu@ip-192-168-0-21:~$ sudo vi /etc/network/interfaces\nubuntu@ip-192-168-0-21:~$ cat /etc/network/interfaces\n# This file describes the network interfaces available on your system\n# and how to activate them. For more information, see interfaces(5).\n\n# The loopback network interface\nauto lo\niface lo inet loopback\n\n# Source interfaces\n# Please check /etc/network/interfaces.d before changing this file\n# as interfaces may have been defined in /etc/network/interfaces.d\n# NOTE: the primary ethernet device is defined in\n# /etc/network/interfaces.d/eth0\n# See LP: #1262951\n#source /etc/network/interfaces.d/*.cfg\nauto eth0\niface eth0 inet static\n    address 192.168.0.21\n    netmask 255.255.255.0\n    gateway 192.168.0.1\n\nauto eth1\niface eth1 inet static\n    address 192.168.1.21\n    netmask 255.255.255.0\n```\n\n### \u30db\u30b9\u30c8\u540d\u5909\u66f4\n\n\u5f8c\u3005\u308f\u304b\u308a\u3084\u3059\u3044\u3088\u3046\u306b\u3001\u30db\u30b9\u30c8\u540d\u3082\u5909\u66f4\u3059\u308b\u3002\n\n```text:\u30db\u30b9\u30c8\u540d\u5909\u66f4\nubuntu@ip-192-168-0-21:~$ sudo vi /etc/hostname\nubuntu@ip-192-168-0-21:~$ cat /etc/hostname \ntest-aws-01\n```\n\n### \u518d\u8d77\u52d5\n\n```text:\u518d\u8d77\u52d5\nubuntu@ip-192-168-0-21:~$ sudo reboot\n```\n\n## \u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\n\nSoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3002\n\n```text:\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nubuntu@test-aws-01:~$ sudo ip route add 10.0.0.0/8 via 192.168.1.10 dev eth1\n```\n\n# \u63a5\u7d9a\u78ba\u8a8d\n\nAWS test-aws-01\u3067Netcat\u3092\u8d77\u52d5\u3057\u3001\u5404\u30c6\u30b9\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089TCP\u63a5\u7d9a\u3092\u8a66\u307f\u308b\u3002\n\n```text:\u9001\u4fe1\u5074\nubuntu@test-aws-02:~$ echo 'from test-aws-02' | nc 192.168.1.21 7777\n\nroot@test-sl-sng-01:~# echo 'from test-sl-sng-01' | nc 192.168.1.21 7777\n\nroot@test-sl-sjc-01:~# echo 'from test-sl-sjc-01' | nc 192.168.1.21 7777\n\nroot@test-sl-sjc-02:~# echo 'from test-sl-sjc-02' | nc 192.168.1.21 7777\n```\n\n```text:\u53d7\u4fe1\u5074\nubuntu@test-aws-01:~$ nc -l -k -p 7777\nfrom test-aws-02\nfrom test-sl-sng-01\nfrom test-sl-sjc-01\nfrom test-sl-sjc-02\n```\n\n\u540c\u69d8\u306e\u624b\u9806\u306b\u3088\u308a\u3001\u5168\u3066\u306e\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u304a\u4e92\u3044\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3067\u901a\u4fe1\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n# \u307e\u3068\u3081\n\nAWS\u3067VPC\u3092\u7528\u3044\u3066\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u3092VPN\u63a5\u7d9a\u3057\u3001SNAT/DNAT\u3084VPC\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u63db\u3048\u3092\u3057\u306a\u304f\u3066\u3082\u9069\u5207\u306b\u30d1\u30b1\u30c3\u30c8\u3092\u758e\u901a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u3002\u4eca\u5f8c\u306fAWS\u306e\u8907\u6570\u30ea\u30fc\u30b8\u30e7\u30f3\u5bfe\u5fdc\u3084\u3001Azure\u7b49\u306e\u5225\u30af\u30e9\u30a6\u30c9\u3078\u306e\u5bfe\u5fdc\u306a\u3069\u306b\u3082\u53d6\u308a\u7d44\u307f\u305f\u3044\u3002\n", "tags": ["AWS", "SoftLayer", "vyatta"]}