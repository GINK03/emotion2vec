{"context": "\n\n\u306f\u3058\u3081\u306b\n\u300cFPGA+SoC+Linux\u306e\u30d6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b9(ZYNQ+U-Boot-SPL\u7de8)\u300d\u3067 U-Boot-spl(U-Boot Second Program Loader)\u3092\u30b9\u30c6\u30fc\u30b8\uff11\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u3068\u3057\u3066 Linux \u3092\u30d6\u30fc\u30c8\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u305d\u306e\u969b\u554f\u984c\u306b\u306a\u3063\u305f PL \u306e\u30af\u30ed\u30c3\u30af\u306e\u8a2d\u5b9a\u3067\u3059\u304c\u3001\u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d\u3067\u3001U-Boot \u304b\u3089 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f Linux \u3067\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 Zynq \u306e PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\u3068\u8a00\u3063\u3066\u3082\u3001U-Boot \u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306b Linux \u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304b\u3089\u30ec\u30b8\u30b9\u30bf\u3092\u53e9\u3051\u3070\u826f\u3044\u3068\u3044\u3046\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u306f Linux \u306e\u30ab\u30fc\u30cd\u30eb\u306f\u30af\u30ed\u30c3\u30af\u95a2\u9023\u306e\u30c7\u30d0\u30a4\u30b9\u3082 clk \u30c9\u30e9\u30a4\u30d0\u3068\u3044\u3046\u5f62\u3067\u3061\u3083\u3093\u3068\u7ba1\u7406\u3057\u3066\u3044\u3066\u3001PL \u306e\u30af\u30ed\u30c3\u30af\u3082\u305d\u306e\u7ba1\u7406\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\u306a\u306e\u306b\u88cf\u304b\u3089\u3053\u3063\u305d\u308a\u30ec\u30b8\u30b9\u30bf\u3092\u5909\u66f4\u3059\u308b\u306e\u306f\u304a\u884c\u5100\u304c\u60aa\u3044\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\u305d\u3053\u3067 clk \u30c9\u30e9\u30a4\u30d0\u3092\u4f7f\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nFPGA Clock Configuration Device Driver(https://github.com/ikwzm/fclkcfg)\n\nfclkcfg \u3068\u306f\nfclkcfg \u306f FPGA Clock Configuration Device Driver \u3067\u3001\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 Zynq \u306e PL \u306e\u30af\u30ed\u30c3\u30af\u306e\u5468\u6ce2\u6570\u3092\u5909\u66f4\u3057\u305f\u308a\u51fa\u529b\u3092\u5236\u5fa1\u3057\u305f\u308a\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3067\u3059\u3002\nLinux \u30ab\u30fc\u30cd\u30eb\u304c\u672c\u6765\u6301\u3063\u3066\u3044\u308b clk \u30c9\u30e9\u30a4\u30d0\u3092\u3001\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089\u5236\u5fa1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u5bfe\u5fdc\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\n\nOS: Linux Kernel Version 4.4.4\nCPU: ARM(ZYNQ)\n\n\u73fe\u5728(2016\u5e744\u67088\u65e5)\u3001Altera-SoC \u3067\u52d5\u4f5c\u78ba\u8a8d\u4e2d\u3067\u3059\u304c\u307e\u3060\u52d5\u3044\u3066\u3044\u307e\u305b\u3093\u3002\n\u73fe\u5728(2016\u5e744\u67088\u65e5)\u3001Linux Kernel Version 4.4.4 \u306b\u3042\u308b Altera-SoC \u7528\u306e clk \u30c9\u30e9\u30a4\u30d0\u3067\u306f\u3001\u51fa\u529b\u3092\u3059\u308b\u304b\u5426\u304b\u306f\u5236\u5fa1\u3067\u304d\u307e\u3059\u304c\u3001\u5468\u6ce2\u6570\u306e\u5909\u66f4\u306f\u51fa\u6765\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\u4f7f\u3044\u65b9\n\n\u6e96\u5099\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nshell$ git clone https://github.com/ikwzm/fclkcfg\nshell$ cd fclkcfg\n\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\nMakefile \u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u9069\u5f53\u306b\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ninsmod \u3067 fclkcfg \u306e\u30ab\u30fc\u30cd\u30eb\u30c9\u30e9\u30a4\u30d0\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u305d\u306e\u969b Device Tree \u306e\u8a2d\u5b9a\u306b\u5f93\u3044\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304c\u3067\u304d\u307e\u3059\u3002Device Tree \u306b\u95a2\u3057\u3066\u306f\u5f8c\u8ff0\u3057\u307e\u3059\u3002\nzynq# insmod fclkcfg.ko\n[  102.044387] fclkcfg amba:fclk0: driver installed.\n[  102.049016] fclkcfg amba:fclk0: device name : fclk0\n[  102.053949] fclkcfg amba:fclk0: clock  name : fclk0\n[  102.058748] fclkcfg amba:fclk0: clock  rate : 100000000\n\n\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f rmmod \u3092\u4f7f\u3044\u307e\u3059\u3002\nzynq# rmmod fclkcfg\n[  261.514039] fclkcfg amba:fclk0: driver unloaded\n\n\n\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\n\nZYBO \u3067\u306e\u4f8b1\nZYBO+linux(v4.4.4) \u3067\u3001\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u306b\u6b21\u306e\u3088\u3046\u306a\u9805\u76ee(\u3053\u306e\u4f8b\u3067\u306ffclk0)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\ndevicetree.dts\n/dts-v1/;\n        :\n        (\u4e2d\u7565)\n        :\n        slcr: slcr@f8000000 {\n            #address-cells = <1>;\n            #size-cells = <1>;\n            compatible = \"xlnx,zynq-slcr\", \"syscon\", \"simple-bus\";\n            reg = <0xF8000000 0x1000>;\n            ranges;\n            clkc: clkc@100 {\n                #clock-cells = <1>;\n                compatible = \"xlnx,ps7-clkc\";\n                fclk-enable = <0>;\n                clock-output-names = \"armpll\", \"ddrpll\", \"iopll\", \"cpu_6or4x\",\n                        \"cpu_3or2x\", \"cpu_2x\", \"cpu_1x\", \"ddr2x\", \"ddr3x\",\n                        \"dci\", \"lqspi\", \"smc\", \"pcap\", \"gem0\", \"gem1\",\n                        \"fclk0\", \"fclk1\", \"fclk2\", \"fclk3\", \"can0\", \"can1\",\n                        \"sdio0\", \"sdio1\", \"uart0\", \"uart1\", \"spi0\", \"spi1\",\n                        \"dma\", \"usb0_aper\", \"usb1_aper\", \"gem0_aper\",\n                        \"gem1_aper\", \"sdio0_aper\", \"sdio1_aper\",\n                        \"spi0_aper\", \"spi1_aper\", \"can0_aper\", \"can1_aper\",\n                        \"i2c0_aper\", \"i2c1_aper\", \"uart0_aper\", \"uart1_aper\",\n                        \"gpio_aper\", \"lqspi_aper\", \"smc_aper\", \"swdt\",\n                        \"dbg_trc\", \"dbg_apb\";\n                reg = <0x100 0x100>;\n            };\n        :\n        (\u4e2d\u7565)\n        :\n        fclk0 {\n            compatible  = \"ikwzm,fclkcfg-0.10.a\";\n            clocks      = <&clkc 15>;\n        };\n        :\n        (\u5f8c\u7565)\n        :\n\n\n\u3053\u308c\u306f fclk0 \u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306f\u3001ZYNQ \u306e PL Clock 0 \u3092\u5236\u5fa1\u3059\u308b\u3053\u3068\u3092\u793a\u3057\u307e\u3059\u3002\nclocks \u3067 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u306e\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u3067\u306f\u30af\u30ed\u30c3\u30af\u306e\u8a2d\u5b9a\u306f slcr(System Level Control Register) \u306e clkc \u3067\u884c\u3046\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\nclocks = <&clkc 15> \u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001fclk0 \u306f clkc \u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30af\u30ed\u30c3\u30af\u306e15\u756a\u76ee\u306e\u30af\u30ed\u30c3\u30af(\u3053\u308c\u304c PL Clock 0\u3092\u6307\u3059)\u3092\u5236\u5fa1\u3059\u308b\u3053\u3068\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nZYBO \u3067\u306e\u4f8b2\n&clkc \u306e\u4ee3\u308f\u308a\u306b phandle \u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\ndevicetree.dts\n/dts-v1/;\n        :\n        (\u4e2d\u7565)\n        :\n        slcr@f8000000 {\n            #address-cells = <0x1>;\n            #size-cells = <0x1>;\n            compatible = \"xlnx,zynq-slcr\", \"syscon\", \"simple-bus\";\n            reg = <0xf8000000 0x1000>;\n            ranges;\n            linux,phandle = <0x5>;\n            phandle = <0x5>;\n\n            clkc@100 {\n                #clock-cells = <0x1>;\n                compatible = \"xlnx,ps7-clkc\";\n                fclk-enable = <0xf>;\n                clock-output-names = \"armpll\", \"ddrpll\", \"iopll\", \"cpu_6or4x\",\n                        \"cpu_3or2x\", \"cpu_2x\", \"cpu_1x\", \"ddr2x\", \"ddr3x\",\n                        \"dci\", \"lqspi\", \"smc\", \"pcap\", \"gem0\", \"gem1\",\n                        \"fclk0\", \"fclk1\", \"fclk2\", \"fclk3\", \"can0\", \"can1\",\n                        \"sdio0\", \"sdio1\", \"uart0\", \"uart1\", \"spi0\", \"spi1\",\n                        \"dma\", \"usb0_aper\", \"usb1_aper\", \"gem0_aper\",\n                        \"gem1_aper\", \"sdio0_aper\", \"sdio1_aper\",\n                        \"spi0_aper\", \"spi1_aper\", \"can0_aper\", \"can1_aper\",\n                        \"i2c0_aper\", \"i2c1_aper\", \"uart0_aper\", \"uart1_aper\",\n                        \"gpio_aper\", \"lqspi_aper\", \"smc_aper\", \"swdt\",\n                        \"dbg_trc\", \"dbg_apb\";\n                reg = <0x100 0x100>;\n                ps-clk-frequency = <0x2faf080>;\n                linux,phandle = <0x1>;\n                phandle = <0x1>;\n            };\n        :\n        (\u4e2d\u7565)\n        :\n        fclk0 {\n            compatible  = \"ikwzm,fclkcfg-0.10.a\";\n            clocks      = <0x1 0xf>;\n        };\n        :\n        (\u5f8c\u7565)\n        :\n\n\n\u3053\u306e\u4f8b\u3067\u306f clkc \u306f phandle = <0x1> \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066 fclk0 \u306e clocks \u306e\u7b2c\u4e00\u5f15\u6570\u306f 0x1 \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nZYBO \u3067\u306e\u4f8b3\n\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d\u3067\u8aac\u660e\u3057\u305f\u3088\u3046\u306b\u3001Device Tree Overlay \u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306a\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nfclk0-zynq-zybo.dts\n/dts-v1/;\n/ {\n    fragment@0 {\n        target-path = \"/amba\";\n        __overlay__ {\n            fclk0 {\n                compatible  = \"ikwzm,fclkcfg-0.10.a\";\n                clocks      = <1 15>;\n            };\n        };\n    };\n};\n\n\nDevice Tree Overlay \u306e\u5834\u5408\u306e\u554f\u984c\u306f\u3001\u4f8b\uff11\u3067\u4f7f\u3063\u305f\u3088\u3046\u306a &clkc \u306e\u3088\u3046\u306a\u30b7\u30f3\u30dc\u30eb\u304c\u4f7f\u3048\u306a\u3044\u3053\u3068\u3067\u3059\u3002\u4f8b\uff12\u306e\u3088\u3046\u306b phandle \u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002phandle \u306e\u5024\u306f Device Tree Blob \u3092\u4f5c\u3063\u305f\u3068\u304d\u306b\u6c7a\u307e\u308b\u306e\u3067\u3001\u3053\u306e\u5024\u304c\u5224\u3089\u306a\u3044\u6642\u306f\u3001Linux \u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046 Device Tree Blob \u3092\u3001\u4e00\u5ea6 Device Tree Source \u306b\u623b\u3057\u3066\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d\u3067\u7d39\u4ecb\u3057\u305f dtbocfg (Device Tree Blob Overlay Configuration System) \u3092\u4f7f\u3046\u5834\u5408\u306f\u6b21\u306e\u69d8\u306b\u3057\u307e\u3059\u3002\nzynq# insmod fclkcfg.ko\nzynq# mkdir /config/device-tree/overlay/fclk0\nzynq# dtc -I dts -O dtb -o /config/device-tree/overlay/fclk0/dtbo fclk0-zynq-zybo.dts\nzynq# echo 1 >/config/device-tree/overlays/fclk0/status\n[ 3361.788836] fclkcfg amba:fclk0: driver installed.\n[ 3361.794680] fclkcfg amba:fclk0: device name : fclk0\n[ 3361.799542] fclkcfg amba:fclk0: clock  name : fclk0\n[ 3361.804344] fclkcfg amba:fclk0: clock  rate : 100000000\n\n\n\u30c7\u30d0\u30a4\u30b9\u30d5\u30a1\u30a4\u30eb\nfclkcfg \u3092\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30c7\u30d0\u30a4\u30b9\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n/sys/class/fclkcfg/<fclk0>/enable\n/sys/class/fclkcfg/<fclk0>/rate\n/sys/class/fclkcfg/<fclk0>/round_rate\n\n<fclk0> \u306e\u3068\u3053\u308d\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30c7\u30d0\u30a4\u30b9\u540d\u304c\u5165\u308a\u307e\u3059\u3002\n\n/sys/class/fclkcfg/<fclk0>/enable\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b 1 \u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b 0 \u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3080\u3053\u3068\u3067\u3001\u73fe\u5728\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u304b\u5426\u304b\u304c\u5224\u308a\u307e\u3059\u3002 1 \u306a\u3089\u51fa\u529b\u4e2d\u3092\u793a\u3057\u307e\u3059\u3002\nzynq# echo 1 > /sys/class/fclkcfg/fclk0/enable\nzynq# cat /sys/class/fclkcfg/fclk0/enable\n1\nzynq# echo 0 > /sys/class/fclkcfg/fclk0/enable\nzynq# cat /sys/class/fclkcfg/fclk0/enable\n0\n\n\n/sys/class/fclkcfg/<fclk0>/rate\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u5468\u6ce2\u6570\u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u306e\u5468\u6ce2\u6570\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u5468\u6ce2\u6570\u3092 100MHz \u306b\u5909\u66f4\u3057\u307e\u3059\u3002\nzynq# echo 100000000 > /sys/class/fclkcfg/fclk0/rate\nzynq# cat /sys/class/fclkcfg/fclk0/rate\n100000000\n\n\u305f\u3060\u3057\u3001\u30af\u30ed\u30c3\u30af\u306b\u3088\u3063\u3066\u306f PLL \u306e\u5236\u9650\u306b\u3088\u308a\u5e0c\u671b\u3057\u305f\u5468\u6ce2\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070 \u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d\u3067\u3082\u4f8b\u3092\u3042\u3052\u307e\u3057\u305f\u304c ZYBO \u3067\u306f 133 MHz \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\u5f37\u5f15\u306b\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6b21\u306e\u69d8\u306b125MHz\u306b\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\nzynq# echo 133333333 > /sys/class/fclkcfg/fclk0/rate\nzynq# cat /sys/class/fclkcfg/fclk0/rate\n125000000\n\n\n/sys/class/fclkcfg/<fclk0>/round_rate\n\u524d\u7bc0\u3067\u8aac\u660e\u3057\u305f\u901a\u308a\u3001\u30af\u30ed\u30c3\u30af\u306b\u3088\u3063\u3066\u306f PLL \u306e\u5236\u9650\u306b\u3088\u308a\u5e0c\u671b\u3057\u305f\u5468\u6ce2\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u5468\u6ce2\u6570\u3092\u66f8\u3044\u3066\u8aad\u3080\u3053\u3068\u306b\u3088\u308a\u3001\u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5468\u6ce2\u6570\u306b\u306a\u308b\u304b\u3092\u77e5\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nzynq# echo 133333333 > /sys/class/fclkcfg/fclk0/round_rate\nzynq# cat /sys/class/fclkcfg/fclk0/round_rate\n133333333 => 125000000\nzynq# echo  75000000 > /sys/class/fclkcfg/fclk0/round_rate\nzynq# cat /sys/class/fclkcfg/fclk0/round_rate\n75000000 => 71428572\n\n\n\u53c2\u8003\nFPGA Clock Configuration Device Driver(https://github.com/ikwzm/fclkcfg)\n\u300cFPGA+SoC+Linux\u306e\u30d6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b9(ZYNQ+U-Boot-SPL\u7de8)\u300d @Qiita\n\u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d @Qiita\n\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d @Qiita\n# \u306f\u3058\u3081\u306b\n\n[\u300cFPGA+SoC+Linux\u306e\u30d6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b9(ZYNQ+U-Boot-SPL\u7de8)\u300d](http://qiita.com/ikwzm/items/efacec8d8e0744e17d45)\u3067 U-Boot-spl(U-Boot Second Program Loader)\u3092\u30b9\u30c6\u30fc\u30b8\uff11\u30d6\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u3068\u3057\u3066 Linux \u3092\u30d6\u30fc\u30c8\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\n\u305d\u306e\u969b\u554f\u984c\u306b\u306a\u3063\u305f PL \u306e\u30af\u30ed\u30c3\u30af\u306e\u8a2d\u5b9a\u3067\u3059\u304c\u3001[\u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d](http://qiita.com/ikwzm/items/3253940484591da84777)\u3067\u3001U-Boot \u304b\u3089 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306f Linux \u3067\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 Zynq \u306e PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3068\u8a00\u3063\u3066\u3082\u3001U-Boot \u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306b Linux \u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304b\u3089\u30ec\u30b8\u30b9\u30bf\u3092\u53e9\u3051\u3070\u826f\u3044\u3068\u3044\u3046\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u306f Linux \u306e\u30ab\u30fc\u30cd\u30eb\u306f\u30af\u30ed\u30c3\u30af\u95a2\u9023\u306e\u30c7\u30d0\u30a4\u30b9\u3082 clk \u30c9\u30e9\u30a4\u30d0\u3068\u3044\u3046\u5f62\u3067\u3061\u3083\u3093\u3068\u7ba1\u7406\u3057\u3066\u3044\u3066\u3001PL \u306e\u30af\u30ed\u30c3\u30af\u3082\u305d\u306e\u7ba1\u7406\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\u306a\u306e\u306b\u88cf\u304b\u3089\u3053\u3063\u305d\u308a\u30ec\u30b8\u30b9\u30bf\u3092\u5909\u66f4\u3059\u308b\u306e\u306f\u304a\u884c\u5100\u304c\u60aa\u3044\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\u305d\u3053\u3067 clk \u30c9\u30e9\u30a4\u30d0\u3092\u4f7f\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n[FPGA Clock Configuration Device Driver(https://github.com/ikwzm/fclkcfg)](https://github.com/ikwzm/fclkcfg)\n\n## fclkcfg \u3068\u306f\n\nfclkcfg \u306f FPGA Clock Configuration Device Driver \u3067\u3001\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089 Zynq \u306e PL \u306e\u30af\u30ed\u30c3\u30af\u306e\u5468\u6ce2\u6570\u3092\u5909\u66f4\u3057\u305f\u308a\u51fa\u529b\u3092\u5236\u5fa1\u3057\u305f\u308a\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u3067\u3059\u3002\nLinux \u30ab\u30fc\u30cd\u30eb\u304c\u672c\u6765\u6301\u3063\u3066\u3044\u308b clk \u30c9\u30e9\u30a4\u30d0\u3092\u3001\u30e6\u30fc\u30b6\u30fc\u7a7a\u9593\u304b\u3089\u5236\u5fa1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n## \u5bfe\u5fdc\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\n\n* OS: Linux Kernel Version 4.4.4\n* CPU: ARM(ZYNQ)\n\n~~\u73fe\u5728(2016\u5e744\u67088\u65e5)\u3001Altera-SoC \u3067\u52d5\u4f5c\u78ba\u8a8d\u4e2d\u3067\u3059\u304c\u307e\u3060\u52d5\u3044\u3066\u3044\u307e\u305b\u3093\u3002~~\n\u73fe\u5728(2016\u5e744\u67088\u65e5)\u3001Linux Kernel Version 4.4.4 \u306b\u3042\u308b Altera-SoC \u7528\u306e clk \u30c9\u30e9\u30a4\u30d0\u3067\u306f\u3001\u51fa\u529b\u3092\u3059\u308b\u304b\u5426\u304b\u306f\u5236\u5fa1\u3067\u304d\u307e\u3059\u304c\u3001\u5468\u6ce2\u6570\u306e\u5909\u66f4\u306f\u51fa\u6765\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\n# \u4f7f\u3044\u65b9\n\n## \u6e96\u5099\n\n### \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n````shell\nshell$ git clone https://github.com/ikwzm/fclkcfg\nshell$ cd fclkcfg\n`````\n\n### \u30b3\u30f3\u30d1\u30a4\u30eb\n\nMakefile \u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u9069\u5f53\u306b\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ninsmod \u3067 fclkcfg \u306e\u30ab\u30fc\u30cd\u30eb\u30c9\u30e9\u30a4\u30d0\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u305d\u306e\u969b Device Tree \u306e\u8a2d\u5b9a\u306b\u5f93\u3044\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u304c\u3067\u304d\u307e\u3059\u3002Device Tree \u306b\u95a2\u3057\u3066\u306f\u5f8c\u8ff0\u3057\u307e\u3059\u3002\n\n````shell\nzynq# insmod fclkcfg.ko\n[  102.044387] fclkcfg amba:fclk0: driver installed.\n[  102.049016] fclkcfg amba:fclk0: device name : fclk0\n[  102.053949] fclkcfg amba:fclk0: clock  name : fclk0\n[  102.058748] fclkcfg amba:fclk0: clock  rate : 100000000\n````\n\n\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f rmmod \u3092\u4f7f\u3044\u307e\u3059\u3002\n\n````shell\nzynq# rmmod fclkcfg\n[  261.514039] fclkcfg amba:fclk0: driver unloaded\n````\n\n## \u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\n\n### ZYBO \u3067\u306e\u4f8b1\n\nZYBO+linux(v4.4.4) \u3067\u3001\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u306b\u6b21\u306e\u3088\u3046\u306a\u9805\u76ee(\u3053\u306e\u4f8b\u3067\u306ffclk0)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n````devicetree:devicetree.dts\n/dts-v1/;\n\t\t:\n\t\t(\u4e2d\u7565)\n\t\t:\n\t\tslcr: slcr@f8000000 {\n\t\t\t#address-cells = <1>;\n\t\t\t#size-cells = <1>;\n\t\t\tcompatible = \"xlnx,zynq-slcr\", \"syscon\", \"simple-bus\";\n\t\t\treg = <0xF8000000 0x1000>;\n\t\t\tranges;\n\t\t\tclkc: clkc@100 {\n\t\t\t\t#clock-cells = <1>;\n\t\t\t\tcompatible = \"xlnx,ps7-clkc\";\n\t\t\t\tfclk-enable = <0>;\n\t\t\t\tclock-output-names = \"armpll\", \"ddrpll\", \"iopll\", \"cpu_6or4x\",\n\t\t\t\t\t\t\"cpu_3or2x\", \"cpu_2x\", \"cpu_1x\", \"ddr2x\", \"ddr3x\",\n\t\t\t\t\t\t\"dci\", \"lqspi\", \"smc\", \"pcap\", \"gem0\", \"gem1\",\n\t\t\t\t\t\t\"fclk0\", \"fclk1\", \"fclk2\", \"fclk3\", \"can0\", \"can1\",\n\t\t\t\t\t\t\"sdio0\", \"sdio1\", \"uart0\", \"uart1\", \"spi0\", \"spi1\",\n\t\t\t\t\t\t\"dma\", \"usb0_aper\", \"usb1_aper\", \"gem0_aper\",\n\t\t\t\t\t\t\"gem1_aper\", \"sdio0_aper\", \"sdio1_aper\",\n\t\t\t\t\t\t\"spi0_aper\", \"spi1_aper\", \"can0_aper\", \"can1_aper\",\n\t\t\t\t\t\t\"i2c0_aper\", \"i2c1_aper\", \"uart0_aper\", \"uart1_aper\",\n\t\t\t\t\t\t\"gpio_aper\", \"lqspi_aper\", \"smc_aper\", \"swdt\",\n\t\t\t\t\t\t\"dbg_trc\", \"dbg_apb\";\n\t\t\t\treg = <0x100 0x100>;\n\t\t\t};\n\t\t:\n\t\t(\u4e2d\u7565)\n\t\t:\n\t\tfclk0 {\n\t\t\tcompatible  = \"ikwzm,fclkcfg-0.10.a\";\n\t\t\tclocks      = <&clkc 15>;\n\t\t};\n\t\t:\n\t\t(\u5f8c\u7565)\n\t\t:\n````\n\n\u3053\u308c\u306f fclk0 \u3068\u3044\u3046\u540d\u524d\u306e\u30c7\u30d0\u30a4\u30b9\u30c9\u30e9\u30a4\u30d0\u306f\u3001ZYNQ \u306e PL Clock 0 \u3092\u5236\u5fa1\u3059\u308b\u3053\u3068\u3092\u793a\u3057\u307e\u3059\u3002\nclocks \u3067 PL \u306e\u30af\u30ed\u30c3\u30af\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u306e\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u3067\u306f\u30af\u30ed\u30c3\u30af\u306e\u8a2d\u5b9a\u306f slcr(System Level Control Register) \u306e clkc \u3067\u884c\u3046\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\nclocks = \\<\\&clkc 15\\> \u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001fclk0 \u306f clkc \u304c\u7ba1\u7406\u3057\u3066\u3044\u308b\u30af\u30ed\u30c3\u30af\u306e15\u756a\u76ee\u306e\u30af\u30ed\u30c3\u30af(\u3053\u308c\u304c PL Clock 0\u3092\u6307\u3059)\u3092\u5236\u5fa1\u3059\u308b\u3053\u3068\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n### ZYBO \u3067\u306e\u4f8b2\n\n\\&clkc \u306e\u4ee3\u308f\u308a\u306b phandle \u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n````devicetree:devicetree.dts\n/dts-v1/;\n\t\t:\n\t\t(\u4e2d\u7565)\n\t\t:\n\t\tslcr@f8000000 {\n\t\t\t#address-cells = <0x1>;\n\t\t\t#size-cells = <0x1>;\n\t\t\tcompatible = \"xlnx,zynq-slcr\", \"syscon\", \"simple-bus\";\n\t\t\treg = <0xf8000000 0x1000>;\n\t\t\tranges;\n\t\t\tlinux,phandle = <0x5>;\n\t\t\tphandle = <0x5>;\n\n\t\t\tclkc@100 {\n\t\t\t\t#clock-cells = <0x1>;\n\t\t\t\tcompatible = \"xlnx,ps7-clkc\";\n\t\t\t\tfclk-enable = <0xf>;\n\t\t\t\tclock-output-names = \"armpll\", \"ddrpll\", \"iopll\", \"cpu_6or4x\",\n\t\t\t\t\t\t\"cpu_3or2x\", \"cpu_2x\", \"cpu_1x\", \"ddr2x\", \"ddr3x\",\n\t\t\t\t\t\t\"dci\", \"lqspi\", \"smc\", \"pcap\", \"gem0\", \"gem1\",\n\t\t\t\t\t\t\"fclk0\", \"fclk1\", \"fclk2\", \"fclk3\", \"can0\", \"can1\",\n\t\t\t\t\t\t\"sdio0\", \"sdio1\", \"uart0\", \"uart1\", \"spi0\", \"spi1\",\n\t\t\t\t\t\t\"dma\", \"usb0_aper\", \"usb1_aper\", \"gem0_aper\",\n\t\t\t\t\t\t\"gem1_aper\", \"sdio0_aper\", \"sdio1_aper\",\n\t\t\t\t\t\t\"spi0_aper\", \"spi1_aper\", \"can0_aper\", \"can1_aper\",\n\t\t\t\t\t\t\"i2c0_aper\", \"i2c1_aper\", \"uart0_aper\", \"uart1_aper\",\n\t\t\t\t\t\t\"gpio_aper\", \"lqspi_aper\", \"smc_aper\", \"swdt\",\n\t\t\t\t\t\t\"dbg_trc\", \"dbg_apb\";\n\t\t\t\treg = <0x100 0x100>;\n\t\t\t\tps-clk-frequency = <0x2faf080>;\n\t\t\t\tlinux,phandle = <0x1>;\n\t\t\t\tphandle = <0x1>;\n\t\t\t};\n\t\t:\n\t\t(\u4e2d\u7565)\n\t\t:\n\t\tfclk0 {\n\t\t\tcompatible  = \"ikwzm,fclkcfg-0.10.a\";\n\t\t\tclocks      = <0x1 0xf>;\n\t\t};\n\t\t:\n\t\t(\u5f8c\u7565)\n\t\t:\n````\n\n\u3053\u306e\u4f8b\u3067\u306f clkc \u306f phandle = \\<0x1\\> \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066 fclk0 \u306e clocks \u306e\u7b2c\u4e00\u5f15\u6570\u306f 0x1 \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n### ZYBO \u3067\u306e\u4f8b3\n\n[\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d](http://qiita.com/ikwzm/items/ec514e955c16076327ce)\u3067\u8aac\u660e\u3057\u305f\u3088\u3046\u306b\u3001Device Tree Overlay \u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306a\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n````devicetree:fclk0-zynq-zybo.dts\n/dts-v1/;\n/ {\n\tfragment@0 {\n\t\ttarget-path = \"/amba\";\n\t\t__overlay__ {\n\t\t\tfclk0 {\n\t\t\t\tcompatible  = \"ikwzm,fclkcfg-0.10.a\";\n\t\t\t\tclocks      = <1 15>;\n\t\t\t};\n\t\t};\n\t};\n};\n````\n\nDevice Tree Overlay \u306e\u5834\u5408\u306e\u554f\u984c\u306f\u3001\u4f8b\uff11\u3067\u4f7f\u3063\u305f\u3088\u3046\u306a \\&clkc \u306e\u3088\u3046\u306a\u30b7\u30f3\u30dc\u30eb\u304c\u4f7f\u3048\u306a\u3044\u3053\u3068\u3067\u3059\u3002\u4f8b\uff12\u306e\u3088\u3046\u306b phandle \u3092\u4f7f\u3063\u3066\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002phandle \u306e\u5024\u306f Device Tree Blob \u3092\u4f5c\u3063\u305f\u3068\u304d\u306b\u6c7a\u307e\u308b\u306e\u3067\u3001\u3053\u306e\u5024\u304c\u5224\u3089\u306a\u3044\u6642\u306f\u3001Linux \u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046 Device Tree Blob \u3092\u3001\u4e00\u5ea6 Device Tree Source \u306b\u623b\u3057\u3066\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\n[\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d](http://qiita.com/ikwzm/items/ec514e955c16076327ce)\u3067\u7d39\u4ecb\u3057\u305f [dtbocfg (Device Tree Blob Overlay Configuration System)](https://github.com/ikwzm/dtbocfg) \u3092\u4f7f\u3046\u5834\u5408\u306f\u6b21\u306e\u69d8\u306b\u3057\u307e\u3059\u3002\n\n\n````shell\nzynq# insmod fclkcfg.ko\nzynq# mkdir /config/device-tree/overlay/fclk0\nzynq# dtc -I dts -O dtb -o /config/device-tree/overlay/fclk0/dtbo fclk0-zynq-zybo.dts\nzynq# echo 1 >/config/device-tree/overlays/fclk0/status\n[ 3361.788836] fclkcfg amba:fclk0: driver installed.\n[ 3361.794680] fclkcfg amba:fclk0: device name : fclk0\n[ 3361.799542] fclkcfg amba:fclk0: clock  name : fclk0\n[ 3361.804344] fclkcfg amba:fclk0: clock  rate : 100000000\n````\n\n## \u30c7\u30d0\u30a4\u30b9\u30d5\u30a1\u30a4\u30eb\n\nfclkcfg \u3092\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30c7\u30d0\u30a4\u30b9\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n* /sys/class/fclkcfg/\\<fclk0\\>/enable\n* /sys/class/fclkcfg/\\<fclk0\\>/rate\n* /sys/class/fclkcfg/\\<fclk0\\>/round_rate\n\n\\<fclk0\\> \u306e\u3068\u3053\u308d\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u30c4\u30ea\u30fc\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30c7\u30d0\u30a4\u30b9\u540d\u304c\u5165\u308a\u307e\u3059\u3002\n\n### /sys/class/fclkcfg/\\<fclk0\\>/enable\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b 1 \u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002    \n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b 0 \u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002   \n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u3080\u3053\u3068\u3067\u3001\u73fe\u5728\u30af\u30ed\u30c3\u30af\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u304b\u5426\u304b\u304c\u5224\u308a\u307e\u3059\u3002 1 \u306a\u3089\u51fa\u529b\u4e2d\u3092\u793a\u3057\u307e\u3059\u3002\n\n````shell\nzynq# echo 1 > /sys/class/fclkcfg/fclk0/enable\nzynq# cat /sys/class/fclkcfg/fclk0/enable\n1\nzynq# echo 0 > /sys/class/fclkcfg/fclk0/enable\nzynq# cat /sys/class/fclkcfg/fclk0/enable\n0\n````\n\n### /sys/class/fclkcfg/\\<fclk0\\>/rate\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u5468\u6ce2\u6570\u3092\u66f8\u304f\u3053\u3068\u3067\u3001\u30af\u30ed\u30c3\u30af\u306e\u5468\u6ce2\u6570\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u5468\u6ce2\u6570\u3092 100MHz \u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\n````shell\nzynq# echo 100000000 > /sys/class/fclkcfg/fclk0/rate\nzynq# cat /sys/class/fclkcfg/fclk0/rate\n100000000\n````\n\n\u305f\u3060\u3057\u3001\u30af\u30ed\u30c3\u30af\u306b\u3088\u3063\u3066\u306f PLL \u306e\u5236\u9650\u306b\u3088\u308a\u5e0c\u671b\u3057\u305f\u5468\u6ce2\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070 [\u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d](http://qiita.com/ikwzm/items/3253940484591da84777)\u3067\u3082\u4f8b\u3092\u3042\u3052\u307e\u3057\u305f\u304c ZYBO \u3067\u306f 133 MHz \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u3002\u5f37\u5f15\u306b\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6b21\u306e\u69d8\u306b125MHz\u306b\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n````shell\nzynq# echo 133333333 > /sys/class/fclkcfg/fclk0/rate\nzynq# cat /sys/class/fclkcfg/fclk0/rate\n125000000\n````\n\n### /sys/class/fclkcfg/\\<fclk0\\>/round_rate\n\n\u524d\u7bc0\u3067\u8aac\u660e\u3057\u305f\u901a\u308a\u3001\u30af\u30ed\u30c3\u30af\u306b\u3088\u3063\u3066\u306f PLL \u306e\u5236\u9650\u306b\u3088\u308a\u5e0c\u671b\u3057\u305f\u5468\u6ce2\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u5468\u6ce2\u6570\u3092\u66f8\u3044\u3066\u8aad\u3080\u3053\u3068\u306b\u3088\u308a\u3001\u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306a\u5468\u6ce2\u6570\u306b\u306a\u308b\u304b\u3092\u77e5\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n````shell\nzynq# echo 133333333 > /sys/class/fclkcfg/fclk0/round_rate\nzynq# cat /sys/class/fclkcfg/fclk0/round_rate\n133333333 => 125000000\nzynq# echo  75000000 > /sys/class/fclkcfg/fclk0/round_rate\nzynq# cat /sys/class/fclkcfg/fclk0/round_rate\n75000000 => 71428572\n````\n\n# \u53c2\u8003\n\n[FPGA Clock Configuration Device Driver(https://github.com/ikwzm/fclkcfg)](https://github.com/ikwzm/fclkcfg)\n[\u300cFPGA+SoC+Linux\u306e\u30d6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b9(ZYNQ+U-Boot-SPL\u7de8)\u300d @Qiita](http://qiita.com/ikwzm/items/efacec8d8e0744e17d45)\n[\u300cU-Boot \u304b\u3089 Zynq \u306e PL\u30af\u30ed\u30c3\u30af\u3068\u30ea\u30bb\u30c3\u30c8\u4fe1\u53f7\u3092\u5236\u5fa1\u3059\u308b\u300d @Qiita](http://qiita.com/ikwzm/items/3253940484591da84777)\n[\u300cFPGA+SoC+Linux\u3067Device Tree Overlay\u3092\u8a66\u3057\u3066\u307f\u305f\u300d @Qiita](http://qiita.com/ikwzm/items/ec514e955c16076327ce)\n\n", "tags": ["Linux", "FPGA", "zynq"]}