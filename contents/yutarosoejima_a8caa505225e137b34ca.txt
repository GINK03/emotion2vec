{"context": "\n\n\u6982\u5ff5\u8aac\u660e\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306b\u4efb\u305b\u307e\u3059\nhttps://liginc.co.jp/web/programming/php/149799\n\n\u30b9\u30c8\u30fc\u30ea\u30fc\n\u30e6\u30fc\u30b6\u30fc\u304c\u4f1a\u54e1\u767b\u9332\u3057\u305f\u6642\u70b9\u3067\n\n\u30e6\u30fc\u30b6\u30fc\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\n\u7ba1\u7406\u8005\u306b\u901a\u77e5\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\n\n\u3092\u884c\u3044\u305f\u3044\n\n\u30c7\u30e2\n\n\u30b3\u30fc\u30c9\n\u203b extends\u3055\u308c\u308bSubject\u30af\u30e9\u30b9\u30fbObserver\u30af\u30e9\u30b9\u306e\u4f5c\u6210\u3084\u3001Value Object\u306e\u4f7f\u7528\u306f\u30b5\u30dc\u3063\u3066\u307e\u3059\u3002\n// \u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\n\nclass User {\n    constructor(name, email) {\n        this.name = name;\n        this.email = email;\n    }\n\n    save() {\n        console.log('DB\u306b\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066Promise\u3092\u8fd4\u3059\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve(this));\n    }\n}\n\nclass UserRegistrationSubject {\n    constructor() {\n        this.observers = [];\n    }\n\n    registerObserver(observer) {\n        this.observers.push(observer);\n    }\n\n    notifyObservers(user) {\n        return Promise.all(this.observers.map(o => o.getNotified(user)));\n    }\n}\n\nclass UserConfirmationObserver {\n    constructor(subject) {\n        subject.registerObserver(this);\n    }\n\n    getNotified(user) {\n        console.log('user.email\u5b9b\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve('\u30e6\u30fc\u30b6\u30fc\u78ba\u8a8d\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86'));\n    }\n}\n\nclass AdministratorNotificationObserver {\n    constructor(subject) {\n        subject.registerObserver(this);\n    }\n\n    getNotified(user) {\n        console.log('\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306buser\u306e\u60c5\u5831\u3092\u542b\u3093\u3060\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve('\u7ba1\u7406\u8005\u901a\u77e5\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86'));\n    }\n}\n\n// Observer\u30d1\u30bf\u30fc\u30f3\u306e\u30c7\u30e2\n\nconst subject = new UserRegistrationSubject();\n\nconst UCObserver = new UserConfirmationObserver(subject);\nconst ANObserver = new AdministratorNotificationObserver(subject);\n\nconst user = new User('\u5c71\u7530\u592a\u90ce', 'hoge@example.com');\n\nuser.save()\n    .then(user => subject.notifyObservers(user))\n    .then(console.log);\n\n\n\u7d50\u679c\n\u203b console.log \u3067\u51fa\u529b\u3055\u308c\u305f\u3082\u306e\nDB\u306b\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066Promise\u3092\u8fd4\u3059\u3001\u3066\u3044\u3067\u3002\nuser.email\u5b9b\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002\n\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306buser\u306e\u60c5\u5831\u3092\u542b\u3093\u3060\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002\n[ '\u30e6\u30fc\u30b6\u30fc\u78ba\u8a8d\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86', '\u7ba1\u7406\u8005\u901a\u77e5\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86' ]\n\n# \u6982\u5ff5\u8aac\u660e\n\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306b\u4efb\u305b\u307e\u3059\n\nhttps://liginc.co.jp/web/programming/php/149799\n\n# \u30b9\u30c8\u30fc\u30ea\u30fc\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u4f1a\u54e1\u767b\u9332\u3057\u305f\u6642\u70b9\u3067\n\n- \u30e6\u30fc\u30b6\u30fc\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\n- \u7ba1\u7406\u8005\u306b\u901a\u77e5\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\n\n\u3092\u884c\u3044\u305f\u3044\n\n# \u30c7\u30e2\n\n## \u30b3\u30fc\u30c9\n\n\u203b `extends`\u3055\u308c\u308b`Subject`\u30af\u30e9\u30b9\u30fb`Observer`\u30af\u30e9\u30b9\u306e\u4f5c\u6210\u3084\u3001`Value Object`\u306e\u4f7f\u7528\u306f\u30b5\u30dc\u3063\u3066\u307e\u3059\u3002\n\n```js\n// \u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\n\nclass User {\n    constructor(name, email) {\n        this.name = name;\n        this.email = email;\n    }\n\n    save() {\n        console.log('DB\u306b\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066Promise\u3092\u8fd4\u3059\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve(this));\n    }\n}\n\nclass UserRegistrationSubject {\n    constructor() {\n        this.observers = [];\n    }\n\n    registerObserver(observer) {\n        this.observers.push(observer);\n    }\n\n    notifyObservers(user) {\n        return Promise.all(this.observers.map(o => o.getNotified(user)));\n    }\n}\n\nclass UserConfirmationObserver {\n    constructor(subject) {\n        subject.registerObserver(this);\n    }\n\n    getNotified(user) {\n        console.log('user.email\u5b9b\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve('\u30e6\u30fc\u30b6\u30fc\u78ba\u8a8d\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86'));\n    }\n}\n\nclass AdministratorNotificationObserver {\n    constructor(subject) {\n        subject.registerObserver(this);\n    }\n\n    getNotified(user) {\n        console.log('\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306buser\u306e\u60c5\u5831\u3092\u542b\u3093\u3060\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002');\n        return new Promise(resolve => resolve('\u7ba1\u7406\u8005\u901a\u77e5\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86'));\n    }\n}\n\n// Observer\u30d1\u30bf\u30fc\u30f3\u306e\u30c7\u30e2\n\nconst subject = new UserRegistrationSubject();\n\nconst UCObserver = new UserConfirmationObserver(subject);\nconst ANObserver = new AdministratorNotificationObserver(subject);\n\nconst user = new User('\u5c71\u7530\u592a\u90ce', 'hoge@example.com');\n\nuser.save()\n    .then(user => subject.notifyObservers(user))\n    .then(console.log);\n```\n\n## \u7d50\u679c\n\n\u203b `console.log` \u3067\u51fa\u529b\u3055\u308c\u305f\u3082\u306e\n\n```\nDB\u306b\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066Promise\u3092\u8fd4\u3059\u3001\u3066\u3044\u3067\u3002\nuser.email\u5b9b\u306b\u78ba\u8a8d\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002\n\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5b9b\u306buser\u306e\u60c5\u5831\u3092\u542b\u3093\u3060\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3001\u3066\u3044\u3067\u3002\n[ '\u30e6\u30fc\u30b6\u30fc\u78ba\u8a8d\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86', '\u7ba1\u7406\u8005\u901a\u77e5\u30e1\u30fc\u30eb\u9001\u4fe1\u5b8c\u4e86' ]\n```\n", "tags": ["Node.js", "es6"]}