{"context": " More than 1 year has passed since last update.Hive\u52c9\u5f37\u3057\u3066\u3044\u3066\u3001\u304a\u624b\u8efd\u306a\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u304c\u306a\u3044\u304b\u306a\u30fc\u3068\u63a2\u3057\u3066\u3044\u305f\u3089\u81ea\u5206\u306e\u30b5\u30a4\u30c8\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u4e01\u5ea6\u3044\u3044\u611f\u3058\u306b\u96c6\u307e\u3063\u3066\u3044\u305f\u306e\u3067\u305d\u308c\u3092Hive\u306b\u5165\u308c\u3066\u307f\u308b\u307e\u3067\u306eTips\u3002\n\n\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u3068\u306f\n\u305f\u3076\u3093Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u304c\u3042\u308b\u306e\u3067\u3082\u3046\u30aa\u30ef\u30b3\u30f3\u3060\u3068\u306f\u601d\u3044\u307e\u3059\u304c\u3001\u306f\u3066\u306a\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30a2\u30af\u30bb\u30b9\u30ab\u30a6\u30f3\u30bf\u30fc\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3001\u306f\u3066\u306a\u3060\u3051\u3058\u3083\u306a\u304f\u3066\u3044\u308d\u3093\u306a\u30b5\u30a4\u30c8\u306b\u57cb\u3081\u8fbc\u307f\u3067\u304d\u307e\u3059\u3002\nhttp://counter.hatena.ne.jp/\n\u306f\u3066\u306a\u306e\u30d6\u30ed\u30b0\u3084\u30c0\u30a4\u30a2\u30ea\u30fc\u3092\u4f7f\u3063\u3066\u308b\u65b9\u306a\u3089\u81ea\u52d5\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u306f\u305a\u3002\n\u904e\u53bb\u306b\u306f\u3066\u306a\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u3044\u305f\u65b9\u306a\u3089\u307e\u3060\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u56de\u3063\u3066\u308b\u306f\u305a\u3067\u5272\u308a\u3068\u6709\u52b9\u6d3b\u7528\u3067\u304d\u305d\u3046\u306a\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3067\u3059\u3002\n\n\n\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30ed\u30b0\u69cb\u6210\n\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306fCSV\u5f62\u5f0f\u3067\u30ed\u30b0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\u30ab\u30f3\u30de\u533a\u5207\u308a\u30d5\u30a1\u30a4\u30eb\u3067\u30ab\u30e9\u30e0\u69cb\u6210\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\n\n\n\u9805\u76ee\n\u30b5\u30f3\u30d7\u30eb\n\n\n\n\n\u30a2\u30af\u30bb\u30b9\u65e5\u6642\n2015-08-01 00:01:06\n\n\n\u30a2\u30af\u30bb\u30b9\u5143IP\n255.255.255.255\n\n\n\u30ea\u30d5\u30a1\u30e9\nhttp://search.smt.docomo.ne.jp/result?search_box=%E3\n\n\n\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\nMozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210)  AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36\n\n\n\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\nja,en-US;q=0.8,en;q=0.6\n\n\n\u30d6\u30e9\u30a6\u30b6\u753b\u9762\u30b5\u30a4\u30ba\n600x960\n\n\n\u305f\u3076\u3093\u30d6\u30e9\u30a6\u30b6\u306e\u753b\u9762\u30d3\u30c3\u30c8\u6570\n32\n\n\n\u30a2\u30af\u30bb\u30b9URL\nhttp://d.hatena.ne.jp/hogehoge/touch/20140329\n\n\n\n\nHive \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306fOSX\u306eHome brew\u3092\u4f7f\u3044\u307e\u3059\u3002\nbrew install hive\n\nHive \u30b7\u30a7\u30eb\u8d77\u52d5\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\nhive\n\u3092\u6253\u3064\u3068\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\uff08Hadoop\u30af\u30e9\u30b9\u30bf\u3092\u4f7f\u308f\u306a\u3044\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u30e2\u30fc\u30c9\uff09\u3067Hive\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u306f\u3066\u306a\u7528\u30c7\u30fc\u30bf\u30fc\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\n\u57fa\u672c\u7684\u306b\u306fSQL\u3068\u540c\u3058\u3067\u3059\nhive>\ncreate databases hatena;\nuse hatena;\n\n\nCSV\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081csv-serde\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nHive\u306f\u305d\u306e\u307e\u307e\u3067\u306fCSV\u3092\u307e\u3068\u3082\u306b\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\u306e\u3067\u3061\u3083\u3093\u3068\u3057\u305fCSV\u30d1\u30fc\u30b5\u30fc\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\uff08\u203b\u30ab\u30f3\u30de\u533a\u5207\u308a\u3060\u3051\u306a\u3089Hive\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u53ef\u80fd\u3060\u304c\u3001\u5024\u306b\u30ab\u30f3\u30de\u3068\u304b\u30a8\u30b9\u30b1\u30fc\u30d7\u306a\u3069\u304c\u5165\u308b\u3068\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\uff09\nhttps://cwiki.apache.org/confluence/display/Hive/CSV+Serde\nhttps://github.com/ogrodnek/csv-serde\ngithub\u306e\u30ea\u30f3\u30af\u304b\u3089\ncsv-serde-1.1.2-0.11.0-all.jar\n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n\u30a2\u30c9\u30aa\u30f3\u8ffd\u52a0\nhive>add jar /Users/nico/Downloads/csv-serde-1.1.2-0.11.0-all.jar\n\n\nDDL\u6295\u5165\nCSV\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u306b\u5408\u308f\u305b\u3066\u4ee5\u4e0b\u306eDDL\u3092\u6295\u5165\nCREATE TABLE hatena_counter_access_log_2015_07 (\n  date STRING,\n  ip  STRING,\n  ref_url STRING,\n  ua STRING ,\n  loc STRING,\n  screen STRING,\n  screen_bit STRING,\n  url STRING\n)\nROW FORMAT SERDE 'com.bizo.hive.serde.csv.CSVSerde'\n with serdeproperties (\n   \"separatorChar\" = \",\",\n   \"quoteChar\"     = '\"',\n   \"escapeChar\"    = \"\\\\\"\n  )   \nSTORED AS TEXTFILE;\n\n\u69cb\u6587\u306f\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3067\u3059\u304cROW FORMAT SERDE\u3067\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nCSV\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\nLOAD DATA INPATH \"/Users/nico/Downloads/001-2015-07.csv\" into table hatena_counter_access_log_2015_07;\n\nlog\n\nLoading data to table hatena.hatena_counter_access_log_2015_07\nTable hatena.hatena_counter_access_log_2015_07 stats: [numFiles=1, numRows=0, totalSize=14516646, rawDataSize=0]\nOK\nTime taken: 0.588 seconds\n\n\u6295\u5165\u306b\u6210\u529f\u3059\u308b\u3068\u8a72\u5f53\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\n\n\u30c7\u30fc\u30bf\u78ba\u8a8d\n\ncount\nhive> select count(*) from hatena.hatena_counter_access_log_2015_07;\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:05:39 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802190505_59c93b51-c463-452b-a349-993fdd3ac2dd.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:05:42,796 null map = 0%,  reduce = 0%\n2015-08-02 19:05:43,864 null map = 100%,  reduce = 100%\nEnded Job = job_local561875456_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n52861\nTime taken: 9.449 seconds, Fetched: 1 row(s)\n\n\nselect\nhive> select * from hatena.hatena_counter_access_log_2015_07 limit 1;\nOK\n2015-08-01 00:01:06 123.13.112.122  http://search.smt.docomo.ne.jp/result?search_box=%E3%Mozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36    ja,en-US;q=0.8,en;q=0.6 600x960 32  http://d.hatena.ne.jp/cdcdcdcdcd/touch/20141111\nTime taken: 0.024 seconds, Fetched: 1 row(s)\n\n\nTEXTFILE\u304b\u3089RCFile\u306b\u5909\u63db\u3059\u308b\n\nDDL\nCREATE TABLE hatena_counter_access_log_2015_07_rc (\n  access_date TIMESTAMP,\n  ip  STRING,\n  ref_url STRING,\n  ua STRING ,\n  loc STRING,\n  screen STRING,\n  screen_bit SMALLINT,\n  url STRING\n)\nstored as rcfile;\n\n\n\u5909\u63db(Insert override)\nINSERT OVERWRITE TABLE hatena_counter_access_log_2015_07_rc select date,ip,ref_url,ua,loc,screen,screen_bit,url from hatena_counter_access_log_2015_07;\n\n\nRCFile count\nhive> select count(*) from hatena_counter_access_log_2015_07_rc;\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:31:55 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802193131_1a1f9f6e-da5f-454d-a4f2-2e8de498b620.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:31:58,495 null map = 100%,  reduce = 100%\nEnded Job = job_local533189434_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n52861\nTime taken: 8.329 seconds, Fetched: 1 row(s)\n\n\nRCFile select\nhive> select * from hatena_counter_access_log_2015_07_rc limit 1;\nOK\n2015-07-01 00:01:06 111.111.11.11   http://search.smt.docomo.ne.jp/result?search_box=%E3%   Mozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36 ja,en-US;q=0.8,en;q=0.6 600x960 32  http://d.hatena.ne.jp/hogehoge/touch/20140329\nTime taken: 0.027 seconds, Fetched: 1 row(s)\n\n\nRCFile desc formatted\nhive> desc formatted hatena_counter_access_log_2015_07_rc;\nOK\n# col_name              data_type           comment\n\naccess_date         timestamp\nip                      string\nref_url             string\nua                      string\nloc                 string\nscreen                  string\nscreen_bit              smallint\nurl                 string\n\n# Detailed Table Information\nDatabase:           hatena\nOwner:                  Siori\nCreateTime:         Sun Aug 02 19:22:06 JST 2015\nLastAccessTime:     UNKNOWN\nProtect Mode:       None\nRetention:              0\nLocation:           file:/user/hive/warehouse/hatena.db/hatena_counter_access_log_2015_07_rc\nTable Type:         MANAGED_TABLE\nTable Parameters:\nCOLUMN_STATS_ACCURATE   true\nnumFiles                1\nnumRows             52861\nrawDataSize         13176720\ntotalSize           13470197\ntransient_lastDdlTime   1438511461\n\n# Storage Information\nSerDe Library:          org.apache.hadoop.hive.serde2.columnar.LazyBinaryColumnarSerDe\nInputFormat:            org.apache.hadoop.hive.ql.io.RCFileInputFormat\nOutputFormat:       org.apache.hadoop.hive.ql.io.RCFileOutputFormat\nCompressed:         No\nNum Buckets:            -1\nBucket Columns:     []\nSort Columns:       []\nStorage Desc Params:\nserialization.format    1\nTime taken: 0.058 seconds, Fetched: 38 row(s)\n\n\nRCFile where timestamp > ?\nhive> select count(*) from hatena_counter_access_log_2015_07_rc where access_date > '2015-07-25';\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:52:11 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802195252_68269622-d3d5-4036-9151-f22942f86e48.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:52:14,592 null map = 0%,  reduce = 0%\n2015-08-02 19:52:15,781 null map = 100%,  reduce = 100%\nEnded Job = job_local451369236_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n22872\nTime taken: 9.444 seconds, Fetched: 1 row(s)\n\n\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n\u3053\u308c\u3067\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30ed\u30b0\u304b\u3089\u3044\u308d\u3044\u308d\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nHive\u52c9\u5f37\u3057\u3066\u3044\u3066\u3001\u304a\u624b\u8efd\u306a\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u304c\u306a\u3044\u304b\u306a\u30fc\u3068\u63a2\u3057\u3066\u3044\u305f\u3089\u81ea\u5206\u306e\u30b5\u30a4\u30c8\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u4e01\u5ea6\u3044\u3044\u611f\u3058\u306b\u96c6\u307e\u3063\u3066\u3044\u305f\u306e\u3067\u305d\u308c\u3092Hive\u306b\u5165\u308c\u3066\u307f\u308b\u307e\u3067\u306eTips\u3002\n\n\n#\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u3068\u306f\n\n\u305f\u3076\u3093Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u304c\u3042\u308b\u306e\u3067\u3082\u3046\u30aa\u30ef\u30b3\u30f3\u3060\u3068\u306f\u601d\u3044\u307e\u3059\u304c\u3001\u306f\u3066\u306a\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30a2\u30af\u30bb\u30b9\u30ab\u30a6\u30f3\u30bf\u30fc\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3001\u306f\u3066\u306a\u3060\u3051\u3058\u3083\u306a\u304f\u3066\u3044\u308d\u3093\u306a\u30b5\u30a4\u30c8\u306b\u57cb\u3081\u8fbc\u307f\u3067\u304d\u307e\u3059\u3002\n\nhttp://counter.hatena.ne.jp/\n\n\u306f\u3066\u306a\u306e\u30d6\u30ed\u30b0\u3084\u30c0\u30a4\u30a2\u30ea\u30fc\u3092\u4f7f\u3063\u3066\u308b\u65b9\u306a\u3089\u81ea\u52d5\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u306f\u305a\u3002\n\u904e\u53bb\u306b\u306f\u3066\u306a\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u3044\u305f\u65b9\u306a\u3089\u307e\u3060\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u56de\u3063\u3066\u308b\u306f\u305a\u3067\u5272\u308a\u3068\u6709\u52b9\u6d3b\u7528\u3067\u304d\u305d\u3046\u306a\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3067\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-08-02 18.42.03.png](https://qiita-image-store.s3.amazonaws.com/0/36931/73d8dc3a-6835-271c-8491-001c5197b0ca.png)\n\n\n#\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30ed\u30b0\u69cb\u6210\n\n\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306fCSV\u5f62\u5f0f\u3067\u30ed\u30b0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\u30ab\u30f3\u30de\u533a\u5207\u308a\u30d5\u30a1\u30a4\u30eb\u3067\u30ab\u30e9\u30e0\u69cb\u6210\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\n|\u9805\u76ee|\u30b5\u30f3\u30d7\u30eb|\n|----|-------|\n|\u30a2\u30af\u30bb\u30b9\u65e5\u6642|2015-08-01 00:01:06|\n|\u30a2\u30af\u30bb\u30b9\u5143IP|255.255.255.255|\n|\u30ea\u30d5\u30a1\u30e9|http://search.smt.docomo.ne.jp/result?search_box=%E3|\n|\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8|Mozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210)  AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36|\n|\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3|ja,en-US;q=0.8,en;q=0.6|\n|\u30d6\u30e9\u30a6\u30b6\u753b\u9762\u30b5\u30a4\u30ba|600x960|\n|\u305f\u3076\u3093\u30d6\u30e9\u30a6\u30b6\u306e\u753b\u9762\u30d3\u30c3\u30c8\u6570|32|\n|\u30a2\u30af\u30bb\u30b9URL|http://d.hatena.ne.jp/hogehoge/touch/20140329|\n\n\n# Hive \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4eca\u56de\u306fOSX\u306eHome brew\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n``brew install hive``\n\n# Hive \u30b7\u30a7\u30eb\u8d77\u52d5\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\n\n``hive``\n\n\u3092\u6253\u3064\u3068\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\uff08Hadoop\u30af\u30e9\u30b9\u30bf\u3092\u4f7f\u308f\u306a\u3044\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30f3\u30e2\u30fc\u30c9\uff09\u3067Hive\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n# \u306f\u3066\u306a\u7528\u30c7\u30fc\u30bf\u30fc\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\n\n\u57fa\u672c\u7684\u306b\u306fSQL\u3068\u540c\u3058\u3067\u3059\n\n```sql\nhive>\ncreate databases hatena;\nuse hatena;\n```\n\n# CSV\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081csv-serde\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nHive\u306f\u305d\u306e\u307e\u307e\u3067\u306fCSV\u3092\u307e\u3068\u3082\u306b\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\u306e\u3067\u3061\u3083\u3093\u3068\u3057\u305fCSV\u30d1\u30fc\u30b5\u30fc\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\uff08\u203b\u30ab\u30f3\u30de\u533a\u5207\u308a\u3060\u3051\u306a\u3089Hive\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u53ef\u80fd\u3060\u304c\u3001\u5024\u306b\u30ab\u30f3\u30de\u3068\u304b\u30a8\u30b9\u30b1\u30fc\u30d7\u306a\u3069\u304c\u5165\u308b\u3068\u30d1\u30fc\u30b9\u3067\u304d\u306a\u3044\uff09\n\nhttps://cwiki.apache.org/confluence/display/Hive/CSV+Serde\nhttps://github.com/ogrodnek/csv-serde\n\ngithub\u306e\u30ea\u30f3\u30af\u304b\u3089\ncsv-serde-1.1.2-0.11.0-all.jar\n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n## \u30a2\u30c9\u30aa\u30f3\u8ffd\u52a0\n\n\n```\nhive>add jar /Users/nico/Downloads/csv-serde-1.1.2-0.11.0-all.jar\n```\n\n\n## DDL\u6295\u5165\n\nCSV\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u306b\u5408\u308f\u305b\u3066\u4ee5\u4e0b\u306eDDL\u3092\u6295\u5165\n\n\n```sql\nCREATE TABLE hatena_counter_access_log_2015_07 (\n  date STRING,\n  ip  STRING,\n  ref_url STRING,\n  ua STRING ,\n  loc STRING,\n  screen STRING,\n  screen_bit STRING,\n  url STRING\n)\nROW FORMAT SERDE 'com.bizo.hive.serde.csv.CSVSerde'\n with serdeproperties (\n   \"separatorChar\" = \",\",\n   \"quoteChar\"     = '\"',\n   \"escapeChar\"    = \"\\\\\"\n  )   \nSTORED AS TEXTFILE;\n```\n\n\u69cb\u6587\u306f\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3067\u3059\u304c**ROW FORMAT SERDE**\u3067\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n\n\n#CSV\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u30c6\u30fc\u30d6\u30eb\u306b\u6295\u5165\n\n```\nLOAD DATA INPATH \"/Users/nico/Downloads/001-2015-07.csv\" into table hatena_counter_access_log_2015_07;\n```\n\nlog\n```\nLoading data to table hatena.hatena_counter_access_log_2015_07\nTable hatena.hatena_counter_access_log_2015_07 stats: [numFiles=1, numRows=0, totalSize=14516646, rawDataSize=0]\nOK\nTime taken: 0.588 seconds\n```\n\n\u6295\u5165\u306b\u6210\u529f\u3059\u308b\u3068\u8a72\u5f53\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\n\n\n#\u30c7\u30fc\u30bf\u78ba\u8a8d\n\n## count\n\n\n```\nhive> select count(*) from hatena.hatena_counter_access_log_2015_07;\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:05:39 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802190505_59c93b51-c463-452b-a349-993fdd3ac2dd.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:05:42,796 null map = 0%,  reduce = 0%\n2015-08-02 19:05:43,864 null map = 100%,  reduce = 100%\nEnded Job = job_local561875456_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n52861\nTime taken: 9.449 seconds, Fetched: 1 row(s)\n```\n\n\n\n## select \n\n```\nhive> select * from hatena.hatena_counter_access_log_2015_07 limit 1;\nOK\n2015-08-01 00:01:06\t123.13.112.122\thttp://search.smt.docomo.ne.jp/result?search_box=%E3%Mozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36\tja,en-US;q=0.8,en;q=0.6\t600x960\t32\thttp://d.hatena.ne.jp/cdcdcdcdcd/touch/20141111\nTime taken: 0.024 seconds, Fetched: 1 row(s)\n```\n\n# TEXTFILE\u304b\u3089RCFile\u306b\u5909\u63db\u3059\u308b\n\n## DDL\n\n```sql\nCREATE TABLE hatena_counter_access_log_2015_07_rc (\n  access_date TIMESTAMP,\n  ip  STRING,\n  ref_url STRING,\n  ua STRING ,\n  loc STRING,\n  screen STRING,\n  screen_bit SMALLINT,\n  url STRING\n)\nstored as rcfile;\n```\n\n## \u5909\u63db(Insert override)\n\n```\nINSERT OVERWRITE TABLE hatena_counter_access_log_2015_07_rc select date,ip,ref_url,ua,loc,screen,screen_bit,url from hatena_counter_access_log_2015_07;\n```\n\n\n## RCFile count\n```\nhive> select count(*) from hatena_counter_access_log_2015_07_rc;\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:31:55 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802193131_1a1f9f6e-da5f-454d-a4f2-2e8de498b620.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:31:58,495 null map = 100%,  reduce = 100%\nEnded Job = job_local533189434_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n52861\nTime taken: 8.329 seconds, Fetched: 1 row(s)\n```\n\n## RCFile select \n\n```\nhive> select * from hatena_counter_access_log_2015_07_rc limit 1;\nOK\n2015-07-01 00:01:06\t111.111.11.11\thttp://search.smt.docomo.ne.jp/result?search_box=%E3%\tMozilla/5.0 (Linux; Android 4.2.2; SH-08E Build/S8210) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.93 Safari/537.36\tja,en-US;q=0.8,en;q=0.6\t600x960\t32\thttp://d.hatena.ne.jp/hogehoge/touch/20140329\nTime taken: 0.027 seconds, Fetched: 1 row(s)\n```\n\n## RCFile desc formatted\n\n```\nhive> desc formatted hatena_counter_access_log_2015_07_rc;\nOK\n# col_name            \tdata_type           comment\n\naccess_date         timestamp\nip                  \tstring\nref_url             string\nua                  \tstring\nloc                 string\nscreen              \tstring\nscreen_bit          \tsmallint\nurl                 string\n\n# Detailed Table Information\nDatabase:           hatena\nOwner:              \tSiori\nCreateTime:         Sun Aug 02 19:22:06 JST 2015\nLastAccessTime:     UNKNOWN\nProtect Mode:       None\nRetention:          \t0\nLocation:           file:/user/hive/warehouse/hatena.db/hatena_counter_access_log_2015_07_rc\nTable Type:         MANAGED_TABLE\nTable Parameters:\nCOLUMN_STATS_ACCURATE\ttrue\nnumFiles            \t1\nnumRows             52861\nrawDataSize         13176720\ntotalSize           13470197\ntransient_lastDdlTime\t1438511461\n\n# Storage Information\nSerDe Library:      \torg.apache.hadoop.hive.serde2.columnar.LazyBinaryColumnarSerDe\nInputFormat:        \torg.apache.hadoop.hive.ql.io.RCFileInputFormat\nOutputFormat:       org.apache.hadoop.hive.ql.io.RCFileOutputFormat\nCompressed:         No\nNum Buckets:        \t-1\nBucket Columns:     []\nSort Columns:       []\nStorage Desc Params:\nserialization.format\t1\nTime taken: 0.058 seconds, Fetched: 38 row(s)\n```\n\n## RCFile where timestamp > ?\n\n```\nhive> select count(*) from hatena_counter_access_log_2015_07_rc where access_date > '2015-07-25';\nTotal jobs = 1\nLaunching Job 1 out of 1\nNumber of reduce tasks determined at compile time: 1\nIn order to change the average load for a reducer (in bytes):\n  set hive.exec.reducers.bytes.per.reducer=<number>\nIn order to limit the maximum number of reducers:\n  set hive.exec.reducers.max=<number>\nIn order to set a constant number of reducers:\n  set mapreduce.job.reduces=<number>\n15/08/02 19:52:11 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\nExecution log at: /var/folders/v4/rl_pwfrd0hg8j2_49by71fhw0000gn/T//Siori/Siori_20150802195252_68269622-d3d5-4036-9151-f22942f86e48.log\nJob running in-process (local Hadoop)\nHadoop job information for null: number of mappers: 0; number of reducers: 0\n2015-08-02 19:52:14,592 null map = 0%,  reduce = 0%\n2015-08-02 19:52:15,781 null map = 100%,  reduce = 100%\nEnded Job = job_local451369236_0001\nExecution completed successfully\nMapredLocal task succeeded\nOK\n22872\nTime taken: 9.444 seconds, Fetched: 1 row(s)\n```\n\n\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n\u3053\u308c\u3067\u306f\u3066\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30ed\u30b0\u304b\u3089\u3044\u308d\u3044\u308d\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n", "tags": ["hive", "hadoop"]}