{"context": "\n\n\u80cc\u666f\n\u6700\u8fd1ElasticCache\u306eRedis\u3092\u5229\u7528\u3057\u3066\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5e38\u306b\u9ad8\u3044\u72b6\u614b\u306b\u306a\u3063\u3066\u3001\u30e1\u30e2\u30ea\u5897\u52a0\u3057\u305f.\n\u305d\u306e\u5f8c\u3001\u30e1\u30e2\u30ea\u5229\u7528\u91cf\u3082\u30a2\u30a4\u30c6\u30e0\u6570\u3082\u305a\u3063\u3068\u5897\u3048\u7d9a\u304d\u3057\u3066\u305f\n\n\u3000\u8abf\u67fb\n\u30e1\u30e2\u30ea\u5897\u52a0\u524d\u306b\u30e1\u30e2\u30ea\u5229\u7528\u91cf\u304c\u30d4\u30c3\u30af\u306b\u306a\u3063\u3066\u3001\u30a2\u30a4\u30c6\u30e0\u6570\u304c\u305a\u3063\u3068\u540c\u3058\u6570\u5024\u3067\u3057\u305f\u3002\n\u304a\u304b\u3057\u3044\u306e\u3067\u3001\u4eee\u8aac\u3068\u3057\u3066Redis\u5229\u7528\u30e1\u30e2\u30ea\u304cMAX\u30e1\u30e2\u30ea\u8d85\u3048\u305f\u6642\u70b9\u3067\u3001\u30a2\u30a4\u30c6\u30e0\u304credis\u304b\u3089\u524a\u9664\u3055\u308c\u305f\u3067\u306f\u306a\u3044\u304b\nREDIS \u3092 LRU \u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3057\u3066\u4f7f\u3046\n\u3053\u3061\u3089\u3092\u898b\u308b\u3068\u3001volatile-lru\u306e\u5834\u5408\u306fexpire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u306a\u3089\u3001\u671f\u9650\u5207\u308c\u308b\u304b\u3069\u3046\u304b\u3068\u95a2\u4fc2\u306a\u304f\u5229\u7528\u983b\u5ea6\u304c\u5c11\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u304b\u3089\u524a\u9664\n\u30ed\u30fc\u30ab\u30eb\u3067\u691c\u8a3c\u3057\u3066\u307f\u308b\n\n\u524d\u6e96\u5099\n\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306bredis\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebMac\u306bRedis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u307f\u308b\n\n\n$ brew install redis \n\n\n\u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u30922MB\u306b\u3057\u3066\u3001maxmemory-policy\u3092volatile-lru\u306b\u3059\u308b\n\n\u671f\u9650\u4ed8\u304d\u304c\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u3092\u8ffd\u52a0\u3057\u3066\u3001\u6700\u5927\u30e1\u30e2\u30ea\u8d85\u3048\u308b\u3068\u3001\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\n\u8a2d\u5b9a\u5909\u66f4 /usr/local/etc/redis.conf\n\n\nmaxmemory 2MB\nmaxmemory-policy volatile-lru\n\n\n\u518d\u8d77\u52d5\n\nbrew services restart redis\n\n\n\u6709\u52b9\u671f\u9650\u8a2d\u5b9a\u3057\u306a\u3044\u306710000\u500b\u30a2\u30a4\u30c6\u30e0\u30bb\u30c3\u30c8\n\n(1..10000).each do |i|\n   Redis.current.set(SecureRandom.uuid, '1111111111111111111111111111111111')\nend\n\n\u30a8\u30e9\u30fc\u3067\u843d\u3061\u308b\n\nRedis::CommandError: OOM command not allowed when used memory > 'maxmemory'.\n\nredis-cli\u3067\u8ffd\u52a0\u3055\u308c\u308b\u30a2\u30a4\u30c6\u30e0\u6570\u78ba\u8a8d\n\ndbsize\n\n1570\u500b\u8ffd\u52a0\u3067\u304d\u305f\n\n\u671f\u9650\u4ed8\u304d\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u8ffd\u52a0\u3057\u3066\u3001\u6700\u5927\u30e1\u30e2\u30ea\u8d85\u3048\u308b\u3068\u3001\u5f8c\u3067\u56de\u53ce\u3055\u308c\u308b\n\n1000\u500b\u306e\u6709\u52b9\u671f\u9650\u4ed8\u304d\u3067\u8ffd\u52a0\n\ntime = 3.months.seconds\n(1..1000).each do |i|\n   id = SecureRandom.uuid\n   Redis.current.set(id, '1111111111111111111111111111111111')\n   Redis.current.expire(id, time)\nend\n\ndbsize\u3067\u78ba\u8a8d\u30010\u500b\u3001\u30e1\u30e2\u30ea\u4f7f\u3044\u3059\u304e\u3066\u3001\u524a\u9664\u3055\u308c\u305f\uff1f\n\n\n100\u500b\u3092\u8ffd\u52a0\n\n\u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\n\n\n\n300\u500b\u3092\u8ffd\u52a0\n\n\u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\n1\u5206\u3050\u3089\u3044\u5f85\u3064\u3068\u3001207\u500b\u306b\u306a\u3063\u3066\u308b\n5\u5206\u3050\u3089\u3044\u5f85\u3064\u3068\u300114\u500b\n\u56de\u53ce\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u304c\u3088\u304f\u308f\u304b\u3089\u3093\n\n\n\n500\u500b\u3092\u8ffd\u52a0\n\n\u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\u304c\u30011\u5206\u5f8c\u306b0\u500b\u306b\u306a\u3063\u305f\u3001\u56de\u53ce\u3055\u308c\u305f\n\n\n\n\n\u7d50\u8ad6\n\nvolatile-lru\u306e\u5834\u5408\u306fexpire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u306a\u3089\u3001\u671f\u9650\u5207\u308c\u308b\u304b\u3069\u3046\u304b\u3068\u95a2\u4fc2\u306a\u304f\u5229\u7528\u983b\u5ea6\u304c\u5c11\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u304b\u3089\u524a\u9664\u3001\u524a\u9664\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u304c\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044\n\u5168\u90e8expire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u3060\u3063\u305f\u3089\u3001\u30e1\u30e2\u30ea\u304c\u5c11\u306a\u304f\u306a\u3063\u3066\u3001redis\u304c\u843d\u3061\u308b\u3053\u3068\u304c\u306a\u3044\u304c\u3001\u6b63\u78ba\u306a\u6709\u52b9\u671f\u9650\u307e\u3067\u3058\u3083\u306a\u304f\u3066\u3082\u3001\u524a\u9664\u3055\u308c\u308b\n\n## \u80cc\u666f\n\u6700\u8fd1ElasticCache\u306eRedis\u3092\u5229\u7528\u3057\u3066\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5e38\u306b\u9ad8\u3044\u72b6\u614b\u306b\u306a\u3063\u3066\u3001\u30e1\u30e2\u30ea\u5897\u52a0\u3057\u305f.\n\u305d\u306e\u5f8c\u3001\u30e1\u30e2\u30ea\u5229\u7528\u91cf\u3082\u30a2\u30a4\u30c6\u30e0\u6570\u3082\u305a\u3063\u3068\u5897\u3048\u7d9a\u304d\u3057\u3066\u305f\n\n##\u3000\u8abf\u67fb\n\u30e1\u30e2\u30ea\u5897\u52a0\u524d\u306b\u30e1\u30e2\u30ea\u5229\u7528\u91cf\u304c\u30d4\u30c3\u30af\u306b\u306a\u3063\u3066\u3001\u30a2\u30a4\u30c6\u30e0\u6570\u304c\u305a\u3063\u3068\u540c\u3058\u6570\u5024\u3067\u3057\u305f\u3002\n\n\u304a\u304b\u3057\u3044\u306e\u3067\u3001\u4eee\u8aac\u3068\u3057\u3066Redis\u5229\u7528\u30e1\u30e2\u30ea\u304cMAX\u30e1\u30e2\u30ea\u8d85\u3048\u305f\u6642\u70b9\u3067\u3001\u30a2\u30a4\u30c6\u30e0\u304credis\u304b\u3089\u524a\u9664\u3055\u308c\u305f\u3067\u306f\u306a\u3044\u304b\n\n[REDIS \u3092 LRU \u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3057\u3066\u4f7f\u3046](http://redis-documentasion-japanese.readthedocs.io/ja/latest/topics/lru-cache.html)\n\u3053\u3061\u3089\u3092\u898b\u308b\u3068\u3001volatile-lru\u306e\u5834\u5408\u306fexpire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u306a\u3089\u3001\u671f\u9650\u5207\u308c\u308b\u304b\u3069\u3046\u304b\u3068\u95a2\u4fc2\u306a\u304f\u5229\u7528\u983b\u5ea6\u304c\u5c11\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u304b\u3089\u524a\u9664\n\n\u30ed\u30fc\u30ab\u30eb\u3067\u691c\u8a3c\u3057\u3066\u307f\u308b\n\n### \u524d\u6e96\u5099\n1. \u3053\u3061\u3089\u3092\u53c2\u8003\u306bredis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb[Mac\u306bRedis\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u307f\u308b](http://qiita.com/TakashiOshikawa/items/83d3b59b4835eb9ba63e)\n\n```\n$ brew install redis \n```\n\n### \u30e1\u30e2\u30ea\u30b5\u30a4\u30ba\u30922MB\u306b\u3057\u3066\u3001maxmemory-policy\u3092volatile-lru\u306b\u3059\u308b\n#### \u671f\u9650\u4ed8\u304d\u304c\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u3092\u8ffd\u52a0\u3057\u3066\u3001\u6700\u5927\u30e1\u30e2\u30ea\u8d85\u3048\u308b\u3068\u3001\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\n1. \u8a2d\u5b9a\u5909\u66f4 /usr/local/etc/redis.conf\n  * maxmemory 2MB\n  * maxmemory-policy volatile-lru\n1. \u518d\u8d77\u52d5\n    ```\n    brew services restart redis\n    ```\n1. \u6709\u52b9\u671f\u9650\u8a2d\u5b9a\u3057\u306a\u3044\u306710000\u500b\u30a2\u30a4\u30c6\u30e0\u30bb\u30c3\u30c8\n \n```ruby\n(1..10000).each do |i|\n   Redis.current.set(SecureRandom.uuid, '1111111111111111111111111111111111')\nend\n   ```\n\u30a8\u30e9\u30fc\u3067\u843d\u3061\u308b\n```\nRedis::CommandError: OOM command not allowed when used memory > 'maxmemory'.\n```\n\nredis-cli\u3067\u8ffd\u52a0\u3055\u308c\u308b\u30a2\u30a4\u30c6\u30e0\u6570\u78ba\u8a8d\n```\ndbsize\n```\n1570\u500b\u8ffd\u52a0\u3067\u304d\u305f\n\n#### \u671f\u9650\u4ed8\u304d\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u8ffd\u52a0\u3057\u3066\u3001\u6700\u5927\u30e1\u30e2\u30ea\u8d85\u3048\u308b\u3068\u3001\u5f8c\u3067\u56de\u53ce\u3055\u308c\u308b\n * 1000\u500b\u306e\u6709\u52b9\u671f\u9650\u4ed8\u304d\u3067\u8ffd\u52a0\n\n```rb\ntime = 3.months.seconds\n(1..1000).each do |i|\n   id = SecureRandom.uuid\n   Redis.current.set(id, '1111111111111111111111111111111111')\n   Redis.current.expire(id, time)\nend\n```\ndbsize\u3067\u78ba\u8a8d\u30010\u500b\u3001\u30e1\u30e2\u30ea\u4f7f\u3044\u3059\u304e\u3066\u3001\u524a\u9664\u3055\u308c\u305f\uff1f\n\n * 100\u500b\u3092\u8ffd\u52a0\n  * \u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\n\n * 300\u500b\u3092\u8ffd\u52a0\n  * \u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\n  * 1\u5206\u3050\u3089\u3044\u5f85\u3064\u3068\u3001207\u500b\u306b\u306a\u3063\u3066\u308b\n  * 5\u5206\u3050\u3089\u3044\u5f85\u3064\u3068\u300114\u500b\n  * \u56de\u53ce\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u304c\u3088\u304f\u308f\u304b\u3089\u3093\n\n * 500\u500b\u3092\u8ffd\u52a0\n  * \u6b63\u5e38\u306b\u8ffd\u52a0\u3067\u304d\u305f\u304c\u30011\u5206\u5f8c\u306b0\u500b\u306b\u306a\u3063\u305f\u3001\u56de\u53ce\u3055\u308c\u305f\n\n## \u7d50\u8ad6\n * volatile-lru\u306e\u5834\u5408\u306fexpire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u306a\u3089\u3001\u671f\u9650\u5207\u308c\u308b\u304b\u3069\u3046\u304b\u3068\u95a2\u4fc2\u306a\u304f\u5229\u7528\u983b\u5ea6\u304c\u5c11\u306a\u3044\u30a2\u30a4\u30c6\u30e0\u304b\u3089\u524a\u9664\u3001\u524a\u9664\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u304c\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044\n * \u5168\u90e8expire\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u308b\u30a2\u30a4\u30c6\u30e0\u3060\u3063\u305f\u3089\u3001\u30e1\u30e2\u30ea\u304c\u5c11\u306a\u304f\u306a\u3063\u3066\u3001redis\u304c\u843d\u3061\u308b\u3053\u3068\u304c\u306a\u3044\u304c\u3001\u6b63\u78ba\u306a\u6709\u52b9\u671f\u9650\u307e\u3067\u3058\u3083\u306a\u304f\u3066\u3082\u3001\u524a\u9664\u3055\u308c\u308b\n", "tags": ["Redis"]}