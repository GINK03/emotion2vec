{"context": "\u3010C#\u3011Where(it => it is Xxx).Select(it => it as Xxx)\u3063\u3066\u66f8\u304b\u305a\u3001OfType\u4f7f\u304a\u3046\uff01\u3010LINQ\u3011 - Qiita\u3092\u898b\u3066\u3001Swift\u3068\u306e\u5bfe\u6bd4\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\u5143\u8a18\u4e8b\u3067\u306f\u3001C#\u3067\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304b\u3089\u7279\u5b9a\u306e\u578b\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u53d6\u308a\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u3001Where\u30fbSelect\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3082\u51fa\u6765\u308b\u3082\u306e\u306e\u3001OfType\u3092\u4f7f\u3046\u3068\u7c21\u6f54\u306b\u66f8\u3051\u3066\u826f\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\n\u5143\u8a18\u4e8b\u306e\u30b3\u30fc\u30c9\u4f8b\u304b\u3089\u3001Unity\u4f9d\u5b58\u6392\u9664\u3057\u3066\u30b7\u30f3\u30d7\u30eb\u5316\u3059\u308b\u306a\u3069\u3057\u3066\u3001\u30b3\u30fc\u30c9\u4f8b\u3092\u66f8\u304d\u76f4\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n(Visual Studio for Mac\u304c\u3042\u308b\u3068Parallels\u3067Windows\u4eee\u60f3\u30de\u30b7\u30f3\u8d77\u52d5\u305b\u305a\u306b\u6e08\u3093\u3067\u4fbf\u5229\u3067\u3057\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40))\nusing System;\nusing System.Linq;\n\nclass Program\n{\n    class Base { }\n    class A : Base { }\n    class B : Base { }\n\n    static void Main(string[] args)\n    {\n        var objects = new Base[] { new A(), new B() };\n        var arrayOfA = objects\n            .Select(x => x as A)\n            .Where(x => x != null)\n            .ToArray(); // \u2192 A\u30aa\u30d6\u30b8\u30a7\u30af\u30c81\u3064\u3060\u3051\u306e\u914d\u5217\u3068\u306a\u308b\n\n        // \u4ee5\u4e0b\u306e\u3088\u3046\u306b`OfType`\u3092\u7528\u3044\u3066\u3082\u540c\u3058\u7d50\u679c\u306b\u306a\u308b\u306e\u3067\u3001\u3053\u3046\u66f8\u304f\u65b9\u304c\u30d9\u30bf\u30fc\n        var arrayOfA2 = objects.OfType<A>();\n    }\n}\n\n(\u5143\u8a18\u4e8b\u3067\u306f\u3001Where \u2192 Select \u3067is\u30fbas\u3068\u3044\u3046\u578b\u6bd4\u8f03\u7cfb\u306e\u51e6\u7406\u304c2\u56de\u884c\u308f\u308c\u3066\u3044\u305f\u306e\u304c\u5197\u9577\u306b\u611f\u3058\u305f\u306e\u3067\u3001Select \u2192 Where\u306e\u9806\u306b\u66f8\u304d\u63db\u3048\u3066\u3044\u307e\u3059)\n\nSwift \u3067\u306f\u3069\u3046\u66f8\u304f\uff1f\n\u3044\u304f\u3064\u304b\u30b3\u30fc\u30c9\u4f8b\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\nmap \u2192 filter (NG)\n\u4e0a\u306eC#\u306e\u4f8b\u306eSelect \u2192 Where\u306b\u76f8\u5f53\u3059\u308b\u51e6\u7406\u3067\u3042\u308bmap \u2192 filter\u306b\u5358\u7d14\u306b\u7f6e\u304d\u63db\u3048\u3066\u307f\u307e\u3057\u305f\u3002\nclass Base { }\nclass A: Base {}\nclass B: Base {}\n\nlet objects: [Base] = [A(), B()]\nlet arrayOfA = objects\n    .map { $0 as? A }\n    .filter { $0 != nil }\n\n\u7d50\u679c\u306f\u3001[Optional(A)]\u3068\u306a\u308a\u3001\u6c42\u3081\u3066\u3044\u305f[A]\u3067\u306f\u306a\u304fNG\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001filter(is\u3067\u30d5\u30a3\u30eb\u30bf\u30fc) \u2192 map(\u30d5\u30a3\u30eb\u30bf\u30fc\u6e08\u307f\u306a\u306e\u3067\u4e00\u5fdcas!\u3067\u3082OK\u2026)\u3059\u308b\u3068\u3001\u7d50\u679c\u306f\u6c42\u3081\u3066\u3044\u305f[A]\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30a4\u30de\u30a4\u30c1\u306a\u3084\u308a\u65b9\u3067\u3059\u3088\u306d\u3002\nlet arrayOfA2 = objects\n    .filter { $0 is A }\n    .map { $0 as! A }\n\n\nmap\u3067Optional(A)\u306eArray\u306b\u3057\u305f\u3042\u3068\u3001\u304c\u3093\u3070\u3063\u3066nil\u3092\u9664\u53bb\nreduce\u3067\u3044\u308f\u3086\u308bflatten\u307d\u3044\u3053\u3068\u3092\u3057\u305f\u30b3\u30fc\u30c9\u304c\u4ee5\u4e0b\u3067\u3059\u3002\nlet arrayOfA = objects\n    .map { $0 as? A }\n    .reduce([A]()) { sum, e in\n        if let e = e {\n            return sum + [e]\n        }\n        return sum\n    }\n\n\u3068\u308a\u3042\u3048\u305a\u7d50\u679c\u306f\u6c42\u3081\u3066\u3044\u305f[A]\u3068\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3063\u3068\u51e6\u7406\u304c\u7169\u96d1\u3067\u3059\u306d\u3002\n\nflatMap\u3092\u4f7f\u3046\n\u305d\u3053\u3067\u3001\u672c\u547d\u306eflatMap\u3092\u4f7f\u3046\u3068\u3001\u3053\u3093\u306a\u306b\u7c21\u5358\u306b\u66f8\u3051\u3066\u3057\u307e\u3044\u307e\u3059\ud83d\udc4f\nlet arrayOfA = objects.flatMap { $0 as? A }\n\nflatMap\u306f\u3001map\u3057\u3066flatten(\u5e73\u5766\u5316)\u306e\u610f\u5473\u306a\u306e\u3067\u3001\u307e\u3055\u3057\u304f\u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\u306b\u6cbf\u3063\u305f\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u306d\u3002\nflatMap\u3067\u306f\u3001Optional(A)\u306eArray\u306b\u3057\u3066(map)\u3001\u3055\u3089\u306b\u30a2\u30f3\u30e9\u30c3\u30d7(nil\u306f\u9664\u53bb)\u3059\u308b\u51e6\u7406(flatten)\u304c\u4e00\u5ea6\u306b\u306a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nSwift\u306b\u3082ofType\u3092\u5b9a\u7fa9\nflatMap\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u306e\u3067\u3042\u307e\u308a\u610f\u5473\u304c\u7121\u3044\u3067\u3059\u304c\u3001Swift\u306b\u3082ofType\u3092\u5b9a\u7fa9\u3057\u3066\u307f\u307e\u3059\u3002\nextension Collection {\n    func ofType<T>() -> [T] {\n        return flatMap { $0 as? T }\n    }\n}\n\n\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u3001Swift\u3067\u3082C#\u306eofType\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u305f\u3060\u3001flatMap\u3092\u30d9\u30bf\u306b\u66f8\u3044\u305f\u5834\u5408\u3068\u8a18\u8ff0\u91cf\u3082\u8aad\u307f\u3084\u3059\u3055\u3082\u5909\u308f\u3089\u306a\u3044\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u306fflatMap\u3092\u305d\u306e\u307e\u307e\u4f7f\u3048\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nlet arrayOfA = objects.ofType() as [A]\n\n\u3064\u307e\u308a\u3001flatMap\u3068\u3044\u3046\u6c4e\u7528\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3060\u3051\u3067\u3001ofType\u3084\u985e\u4f3c\u306e\u51e6\u7406\u304c\u7c21\u6f54\u306b\u66f8\u3051\u308b\u3001\u3068\u3044\u3046\u30ad\u30ec\u30a4\u306a\u4e16\u754c\u306b\u306a\u3063\u3066\u3044\u307e\u3059\ud83d\udc4f\n(Swift\u3067ofType\u66f8\u304f\u3068\u3057\u305f\u3089\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306bflatMap\u30e9\u30c3\u30d7\u3067\u306f\u306a\u304f\u30d9\u30bf\u306b\u66f8\u3044\u3066flatMap\u3088\u308a\u9ad8\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306a\u30e1\u30bd\u30c3\u30c9\u306b\u3057\u3066\u304a\u304f\u3068\u5b58\u5728\u4fa1\u5024\u3042\u308a\u305d\u3046)\n\nC#\u3067\u306fflatMap\u307d\u3044\u3082\u306e\u306f\u7121\u3044\u306e\uff1f\n\nSelectMany\u3067\u53ef\u80fd(Swift\u306eflatMap\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u306f\u7121\u3044)\n\u5c11\u3057\u8a18\u8ff0\u304c\u6df7\u307f\u5408\u3044\u307e\u3059\u304c\u3001SelectMany\u3067\u53ef\u80fd\u3067\u3059\u3002\nvar arrayOfA = objects.SelectMany(x =>\n        {\n            var a = x as A;\n            if (a == null)\n            {\n                return new A[0];\n            }\n            return new A[] { a };\n        }).ToArray();\n\n\nnil\u306e\u6271\u3044\u304c\u7d61\u3080\u3068Swift\u306e\u65b9\u304c\u30b7\u30f3\u30d7\u30eb\u30fb\u5805\u7262\u306b\u66f8\u3051\u308b\u3053\u3068\u304c\u591a\u3044\n\u4e0a\u306e\u4f8b\u3067\u306fSelectMany\u306e\u30e9\u30e0\u30c0\u5f0f\u304c\u8907\u96d1\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b[[1, 2], 3] \u2192 [1, 2, 3]\u3068\u5909\u63db\u3059\u308b\u3088\u3046\u306a\u5358\u7d14\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u5e73\u5766\u5316\u51e6\u7406\u3067\u3042\u308c\u3070\u3001swift\u3068\u3042\u307e\u308a\u5dee\u304c\u7121\u304f\u306a\u308a\u307e\u3059\u3002\n(\u914d\u5217\u306e\u521d\u671f\u5316\u90e8\u5206\u306f\u5c11\u3057\u9762\u5012\u306a\u8a18\u8ff0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001SelectMany\u306e\u4e2d\u8eab\u306f\u30b7\u30f3\u30d7\u30eb)\nC#:\nvar results = (new int[][] { new int[]{ 1, 2 }, new int[]{ 3 } }).SelectMany(x => x).ToArray();\n\nSwift:\nlet results = [[1, 2], [3]].flatMap { $0 }\n\nSwift\u3067\u306f\u30aa\u30d7\u30b7\u30e7\u30ca\u30eb\u304c\u8a00\u8a9e\u4ed5\u69d8\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u3066\u3001\u3055\u3089\u306bflatMap\u304c\u3001Array\u3082Optional\u3082\u540c\u3058\u300c\u5165\u308c\u7269\u300d\u3068\u3057\u3066\u62bd\u8c61\u5316\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u5e73\u5766\u5316\u300d\u51e6\u7406\u306e\u969b\u3001\u5165\u308c\u5b50\u306e\u914d\u5217\u3092\u5408\u4f53\u3055\u305b\u308b\u3088\u3046\u306a\u611f\u899a\u3067\u3001Optional\u306e\u30a2\u30f3\u30e9\u30c3\u30d7\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\nC# \u3067\u3082\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u8db3\u3059\u3053\u3068\u3067SelectMany\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u51fa\u6765\u308b\n@neuecc \u3055\u3093\u304b\u3089Tweet\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n\n\nhttps://gist.github.com/neuecc/6cbec456dab4d0bb3c81976799b5fc6e\nusing System;\nusing System.Collections.Generic;\n\nclass Base { }\n\nclass A : Base { }\nclass B : Base { }\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        var objects1 = new Base[] { new A(), new B() };\n        var objects2 = new int?[] { 1, 2, 100, null, 1000 };\n\n        var hoge = objects1.SelectMany(x => x as A);\n        var huga = objects2.SelectMany(x => x);\n    }\n}\n\n\npublic static class FlatMapLikeExtensions\n{\n    public static IEnumerable<U> SelectMany<T, U>(this IEnumerable<T> source, Func<T, U> selector)\n        where U : class\n    {\n        foreach (var item in source)\n        {\n            var v = selector(item);\n            if (v != null) yield return v;\n        }\n    }\n\n    public static IEnumerable<U> SelectMany<T, U>(this IEnumerable<T> source, Func<T, U?> selector)\n        where U : struct\n    {\n        foreach (var item in source)\n        {\n            var v = selector(item);\n            if (v.HasValue) yield return v.Value;\n        }\n    }\n}\n\nSelectManay\u3067\u30b7\u30f3\u30d7\u30eb(Swift\u306eflatMap\u3068\u540c\u7b49)\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001\u3064\u3044\u3067\u306b\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\u3082\u30e9\u30e0\u30c0\u5f0f\u3067\u306f\u7121\u304f\u306a\u308b\u306e\u3067yield\u4f7f\u3048\u3066 http://qiita.com/mono0926/items/b8ff59938a60ddf93c6e#selectmany\u3067\u53ef\u80fdswift\u306eflatmap\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u306f\u7121\u3044 \u306e\u30b3\u30fc\u30c9\u3088\u308a\u5c11\u3057\u30b7\u30f3\u30d7\u30eb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u8db3\u3059\u3068\u3001C#\u3067\u3082OfType\u3044\u3089\u306a\u3044\u306e\u3067\u306f\ud83e\udd14\u3068\u601d\u3048\u3066\u304d\u3061\u3083\u3044\u307e\u3059(\u3000\u00b4\uff65\u203f\uff65\uff40) (\u203b1)\n\u307e\u3063\u305f\u304f\u540c\u3058\u7d50\u679c:\nvar hoge = objects.OfType<A>();\nvar fuga = objects.SelectMany(x => x as A);\n\n(\u203b1: \u305f\u3060\u3057\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7684\u306b\u9055\u3044\u304c\u3042\u3063\u305f\u308a\u306f\u3057\u305d\u3046\u3002)\n\n\u95a2\u9023\n\u95a2\u9023\u3068\u3057\u3066\u3001\u4ee5\u4e0b\u306e @koher \u3055\u3093\u306e\u8a18\u4e8b\u306a\u3069\u304c\u3068\u3066\u3082\u53c2\u8003\u306b\u3042\u308a\u307e\u3059\u3002\n1\u5e74\u307b\u3069\u524d\u306e\u8a18\u4e8b\u3067\u3059\u304c\u3001\u3053\u306e\u3042\u305f\u308a\u306fSwift 2\u304b\u3089\u307b\u307c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u306f\u305a\u3067\u3059(1\u21922\u306e\u9593\u306f\u8272\u3005\u6539\u826f\u3042\u3063\u305f)\u3002\n\n\nSwift 2.0\u306e\u65b0\u3057\u3044flatMap\u304c\u4fbf\u5229\u904e\u304e\u308b - Qiita\n\n\u672c\u8a18\u4e8b\u66f8\u3044\u305f\u5f8c\u306b\u3001\u305d\u3046\u3044\u3048\u3070\u3053\u306e\u8a18\u4e8b\u3042\u3063\u305f\u306a\u3068\u601d\u3044\u51fa\u3057\u3066\u8aad\u307f\u8fd4\u3057\u305f\u3089\u3001\u4f3c\u305f\u5185\u5bb9\u3067\u3057\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40)\n\n\n\nArray\u3068Optional\u306emap\u306f\u540c\u3058\u3067\u3059 - Qiita\n\n\u3053\u3046\u3044\u3046\u8a71\u984c\u306b\u8e0f\u307f\u8fbc\u3082\u3046\u3068\u3057\u305f\u3082\u306e\u306e\u3001\u3053\u3061\u3089\u306e\u8a18\u4e8b\u306b\u5145\u5206\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u3066\u66f8\u304f\u4f59\u5730\u7121\u304b\u3063\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40)\n\n\nmap\u3068flatMap\u3068\u3044\u3046\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3092\u7406\u89e3\u3059\u308b - Qiita\n\n[\u3010C#\u3011Where(it => it is Xxx).Select(it => it as Xxx)\u3063\u3066\u66f8\u304b\u305a\u3001OfType\u4f7f\u304a\u3046\uff01\u3010LINQ\u3011 - Qiita](http://qiita.com/RyotaMurohoshi/items/c82a20e261dd0682e1d4)\u3092\u898b\u3066\u3001Swift\u3068\u306e\u5bfe\u6bd4\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n\u5143\u8a18\u4e8b\u3067\u306f\u3001C#\u3067\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304b\u3089\u7279\u5b9a\u306e\u578b\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3051\u53d6\u308a\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u3001`Where`\u30fb`Select`\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3082\u51fa\u6765\u308b\u3082\u306e\u306e\u3001`OfType`\u3092\u4f7f\u3046\u3068\u7c21\u6f54\u306b\u66f8\u3051\u3066\u826f\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\n\n\u5143\u8a18\u4e8b\u306e\u30b3\u30fc\u30c9\u4f8b\u304b\u3089\u3001Unity\u4f9d\u5b58\u6392\u9664\u3057\u3066\u30b7\u30f3\u30d7\u30eb\u5316\u3059\u308b\u306a\u3069\u3057\u3066\u3001\u30b3\u30fc\u30c9\u4f8b\u3092\u66f8\u304d\u76f4\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n([Visual Studio for Mac](https://www.visualstudio.com/vs/visual-studio-mac/)\u304c\u3042\u308b\u3068Parallels\u3067Windows\u4eee\u60f3\u30de\u30b7\u30f3\u8d77\u52d5\u305b\u305a\u306b\u6e08\u3093\u3067\u4fbf\u5229\u3067\u3057\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40))\n\n```csharp\nusing System;\nusing System.Linq;\n\nclass Program\n{\n\tclass Base { }\n\tclass A : Base { }\n\tclass B : Base { }\n\n\tstatic void Main(string[] args)\n\t{\n\t\tvar objects = new Base[] { new A(), new B() };\n\t\tvar arrayOfA = objects\n\t\t\t.Select(x => x as A)\n\t\t\t.Where(x => x != null)\n\t\t\t.ToArray(); // \u2192 A\u30aa\u30d6\u30b8\u30a7\u30af\u30c81\u3064\u3060\u3051\u306e\u914d\u5217\u3068\u306a\u308b\n\n        // \u4ee5\u4e0b\u306e\u3088\u3046\u306b`OfType`\u3092\u7528\u3044\u3066\u3082\u540c\u3058\u7d50\u679c\u306b\u306a\u308b\u306e\u3067\u3001\u3053\u3046\u66f8\u304f\u65b9\u304c\u30d9\u30bf\u30fc\n        var arrayOfA2 = objects.OfType<A>();\n\t}\n}\n```\n\n(\u5143\u8a18\u4e8b\u3067\u306f\u3001`Where` \u2192 `Select` \u3067`is`\u30fb`as`\u3068\u3044\u3046\u578b\u6bd4\u8f03\u7cfb\u306e\u51e6\u7406\u304c2\u56de\u884c\u308f\u308c\u3066\u3044\u305f\u306e\u304c\u5197\u9577\u306b\u611f\u3058\u305f\u306e\u3067\u3001`Select` \u2192 `Where`\u306e\u9806\u306b\u66f8\u304d\u63db\u3048\u3066\u3044\u307e\u3059)\n\n# Swift \u3067\u306f\u3069\u3046\u66f8\u304f\uff1f\n\n\u3044\u304f\u3064\u304b\u30b3\u30fc\u30c9\u4f8b\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n## `map` \u2192 `filter` (NG)\n\n\u4e0a\u306eC#\u306e\u4f8b\u306e`Select` \u2192 `Where`\u306b\u76f8\u5f53\u3059\u308b\u51e6\u7406\u3067\u3042\u308b`map` \u2192 `filter`\u306b\u5358\u7d14\u306b\u7f6e\u304d\u63db\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\n```Swift\nclass Base { }\nclass A: Base {}\nclass B: Base {}\n\nlet objects: [Base] = [A(), B()]\nlet arrayOfA = objects\n    .map { $0 as? A }\n    .filter { $0 != nil }\n```\n\u7d50\u679c\u306f\u3001`[Optional(A)]`\u3068\u306a\u308a\u3001\u6c42\u3081\u3066\u3044\u305f`[A]`\u3067\u306f\u306a\u304fNG\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3001`filter`(`is`\u3067\u30d5\u30a3\u30eb\u30bf\u30fc) \u2192 `map`(\u30d5\u30a3\u30eb\u30bf\u30fc\u6e08\u307f\u306a\u306e\u3067\u4e00\u5fdc`as!`\u3067\u3082OK\u2026)\u3059\u308b\u3068\u3001\u7d50\u679c\u306f\u6c42\u3081\u3066\u3044\u305f`[A]`\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30a4\u30de\u30a4\u30c1\u306a\u3084\u308a\u65b9\u3067\u3059\u3088\u306d\u3002\n\n```swift\nlet arrayOfA2 = objects\n    .filter { $0 is A }\n    .map { $0 as! A }\n```\n\n## `map`\u3067`Optional(A)`\u306eArray\u306b\u3057\u305f\u3042\u3068\u3001\u304c\u3093\u3070\u3063\u3066`nil`\u3092\u9664\u53bb\n\n`reduce`\u3067\u3044\u308f\u3086\u308b`flatten`\u307d\u3044\u3053\u3068\u3092\u3057\u305f\u30b3\u30fc\u30c9\u304c\u4ee5\u4e0b\u3067\u3059\u3002\n\n```swift\nlet arrayOfA = objects\n    .map { $0 as? A }\n    .reduce([A]()) { sum, e in\n        if let e = e {\n            return sum + [e]\n        }\n        return sum\n    }\n```\n\n\u3068\u308a\u3042\u3048\u305a\u7d50\u679c\u306f\u6c42\u3081\u3066\u3044\u305f`[A]`\u3068\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3063\u3068\u51e6\u7406\u304c\u7169\u96d1\u3067\u3059\u306d\u3002\n\n## `flatMap`\u3092\u4f7f\u3046\n\n\u305d\u3053\u3067\u3001\u672c\u547d\u306e`flatMap`\u3092\u4f7f\u3046\u3068\u3001\u3053\u3093\u306a\u306b\u7c21\u5358\u306b\u66f8\u3051\u3066\u3057\u307e\u3044\u307e\u3059\ud83d\udc4f\n\n```swift\nlet arrayOfA = objects.flatMap { $0 as? A }\n```\n\n`flatMap`\u306f\u3001`map`\u3057\u3066`flatten`(\u5e73\u5766\u5316)\u306e\u610f\u5473\u306a\u306e\u3067\u3001\u307e\u3055\u3057\u304f\u3084\u308a\u305f\u304b\u3063\u305f\u3053\u3068\u306b\u6cbf\u3063\u305f\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u306d\u3002\n`flatMap`\u3067\u306f\u3001`Optional(A)`\u306eArray\u306b\u3057\u3066(`map`)\u3001\u3055\u3089\u306b\u30a2\u30f3\u30e9\u30c3\u30d7(nil\u306f\u9664\u53bb)\u3059\u308b\u51e6\u7406(`flatten`)\u304c\u4e00\u5ea6\u306b\u306a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n## Swift\u306b\u3082`ofType`\u3092\u5b9a\u7fa9\n\n`flatMap`\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u306e\u3067\u3042\u307e\u308a\u610f\u5473\u304c\u7121\u3044\u3067\u3059\u304c\u3001Swift\u306b\u3082`ofType`\u3092\u5b9a\u7fa9\u3057\u3066\u307f\u307e\u3059\u3002\n\n```swift\nextension Collection {\n    func ofType<T>() -> [T] {\n        return flatMap { $0 as? T }\n    }\n}\n```\n\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u3001Swift\u3067\u3082C#\u306e`ofType`\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u305f\u3060\u3001`flatMap`\u3092\u30d9\u30bf\u306b\u66f8\u3044\u305f\u5834\u5408\u3068\u8a18\u8ff0\u91cf\u3082\u8aad\u307f\u3084\u3059\u3055\u3082\u5909\u308f\u3089\u306a\u3044\u306e\u3067\u3001\u57fa\u672c\u7684\u306b\u306f`flatMap`\u3092\u305d\u306e\u307e\u307e\u4f7f\u3048\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```swift\nlet arrayOfA = objects.ofType() as [A]\n```\n\n\u3064\u307e\u308a\u3001`flatMap`\u3068\u3044\u3046\u6c4e\u7528\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3060\u3051\u3067\u3001`ofType`\u3084\u985e\u4f3c\u306e\u51e6\u7406\u304c\u7c21\u6f54\u306b\u66f8\u3051\u308b\u3001\u3068\u3044\u3046\u30ad\u30ec\u30a4\u306a\u4e16\u754c\u306b\u306a\u3063\u3066\u3044\u307e\u3059\ud83d\udc4f\n\n(Swift\u3067`ofType`\u66f8\u304f\u3068\u3057\u305f\u3089\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306b`flatMap`\u30e9\u30c3\u30d7\u3067\u306f\u306a\u304f\u30d9\u30bf\u306b\u66f8\u3044\u3066`flatMap`\u3088\u308a\u9ad8\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306a\u30e1\u30bd\u30c3\u30c9\u306b\u3057\u3066\u304a\u304f\u3068\u5b58\u5728\u4fa1\u5024\u3042\u308a\u305d\u3046)\n\n# C#\u3067\u306f`flatMap`\u307d\u3044\u3082\u306e\u306f\u7121\u3044\u306e\uff1f\n\n## `SelectMany`\u3067\u53ef\u80fd(Swift\u306e`flatMap`\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u306f\u7121\u3044)\n\n\u5c11\u3057\u8a18\u8ff0\u304c\u6df7\u307f\u5408\u3044\u307e\u3059\u304c\u3001`SelectMany`\u3067\u53ef\u80fd\u3067\u3059\u3002\n\n```csharp\nvar arrayOfA = objects.SelectMany(x =>\n\t\t{\n\t\t\tvar a = x as A;\n\t\t\tif (a == null)\n\t\t\t{\n\t\t\t\treturn new A[0];\n\t\t\t}\n\t\t\treturn new A[] { a };\n\t\t}).ToArray();\n```\n\n## nil\u306e\u6271\u3044\u304c\u7d61\u3080\u3068`Swift`\u306e\u65b9\u304c\u30b7\u30f3\u30d7\u30eb\u30fb\u5805\u7262\u306b\u66f8\u3051\u308b\u3053\u3068\u304c\u591a\u3044\n\n\u4e0a\u306e\u4f8b\u3067\u306f`SelectMany`\u306e\u30e9\u30e0\u30c0\u5f0f\u304c\u8907\u96d1\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b`[[1, 2], 3]` \u2192 `[1, 2, 3]`\u3068\u5909\u63db\u3059\u308b\u3088\u3046\u306a\u5358\u7d14\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u5e73\u5766\u5316\u51e6\u7406\u3067\u3042\u308c\u3070\u3001`swift`\u3068\u3042\u307e\u308a\u5dee\u304c\u7121\u304f\u306a\u308a\u307e\u3059\u3002\n(\u914d\u5217\u306e\u521d\u671f\u5316\u90e8\u5206\u306f\u5c11\u3057\u9762\u5012\u306a\u8a18\u8ff0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001`SelectMany`\u306e\u4e2d\u8eab\u306f\u30b7\u30f3\u30d7\u30eb)\n\nC#:\n\n```csharp\nvar results = (new int[][] { new int[]{ 1, 2 }, new int[]{ 3 } }).SelectMany(x => x).ToArray();\n```\n\nSwift:\n\n```swift\nlet results = [[1, 2], [3]].flatMap { $0 }\n```\n\nSwift\u3067\u306f\u30aa\u30d7\u30b7\u30e7\u30ca\u30eb\u304c\u8a00\u8a9e\u4ed5\u69d8\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u3066\u3001\u3055\u3089\u306b`flatMap`\u304c\u3001Array\u3082Optional\u3082\u540c\u3058\u300c\u5165\u308c\u7269\u300d\u3068\u3057\u3066\u62bd\u8c61\u5316\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u5e73\u5766\u5316\u300d\u51e6\u7406\u306e\u969b\u3001\u5165\u308c\u5b50\u306e\u914d\u5217\u3092\u5408\u4f53\u3055\u305b\u308b\u3088\u3046\u306a\u611f\u899a\u3067\u3001Optional\u306e\u30a2\u30f3\u30e9\u30c3\u30d7\u304c\u884c\u308f\u308c\u307e\u3059\u3002\n\n## C# \u3067\u3082\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u8db3\u3059\u3053\u3068\u3067`SelectMany`\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u51fa\u6765\u308b\n\n@neuecc \u3055\u3093\u304b\u3089Tweet\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"ja\" dir=\"ltr\">flatMap\u306e\u5b9f\u88c5\u306b\u305d\u3046\u3044\u3046\u306e\u304c\u3042\u308b\u304b\u3089\u3063\u3066\u611f\u3058\u3067\u8a00\u8a9e\u4ed5\u69d8\u7684\u306b\u4e00\u7dd2\u3060\u304b\u3089\u3063\u3066\u308f\u3051\u3067\u306f\u306a\u3044\u611f\u3002(\u3057\u304b\u3057C#\u306fnullable\u306e\u8003\u616e\u3092\u8db3\u3059\u306e\u304c\u9762\u5012) <a href=\"https://t.co/cweyEGg5Y2\">https://t.co/cweyEGg5Y2</a> / \u201cC#\u306eOfType\u30e1\u30bd\u30c3\u30c9\u2026\u201d <a href=\"https://t.co/V6rrs1zCoW\">https://t.co/V6rrs1zCoW</a></p>&mdash; neuecc (@neuecc) <a href=\"https://twitter.com/neuecc/status/802125612978610177\">November 25, 2016</a></blockquote> <script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"ja\" dir=\"ltr\">\u5143\u306e\u6587\u4e2d\u306b\u306f\u300c\u8a00\u8a9e\u4ed5\u69d8\u7684\u306b\u4e00\u7dd2\u300d\u3068\u306f\u66f8\u304b\u308c\u3066\u306a\u3044\uff08\u540c\u3058\u300c\u5165\u308c\u7269\u300d\u3068\u3057\u3066\u62bd\u8c61\u5316\u3057\u3066\u3044\u308b\u3001\u3068\u3044\u3046\u306e\u304c\u6b63\u3057\u3044\uff09\u306e\u3067\u3001\u30b3\u30e1\u30f3\u30c8\u306f\u3061\u3087\u3063\u3068\u8aad\u307f\u9055\u3048\u542b\u3080\u3067\u3059\u3001\u3059\u307f\u307e\u305b\u3093\u3002 <a href=\"https://t.co/ASzeq8TrKs\">https://t.co/ASzeq8TrKs</a></p>&mdash; neuecc (@neuecc) <a href=\"https://twitter.com/neuecc/status/802128983240286208\">November 25, 2016</a></blockquote> <script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n<blockquote class=\"twitter-tweet\" data-lang=\"en\"><p lang=\"ja\" dir=\"ltr\">Rx\u304cTask\u3068\u878d\u5408\u3059\u308b\u3063\u3066\u306e\u3082IObservable.SelectMany\u306bTask\u306e\u30aa\u30fc\u30d0\u30fc\u30ed\u30fc\u30c9\u8db3\u3057\u305f\u3060\u3051\u3063\u3066\u3044\u3046\u8a71\u3067\u3001\u3053\u3046\u3044\u3046\u306e\u306f\u898b\u305b\u65b9\u304c\u5927\u4e8b\u3068\u3044\u3046\u306e\u304c\u3042\u308b\u3002\u5168\u4f53\u7684\u306b\u305d\u3046\u3044\u3046\u898b\u305b\u65b9\u3067\u7d71\u4e00\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3001\u305d\u3046\u3044\u3046\u3082\u306e\u3060\u3068\u6271\u3048\u308b\u3002\u305d\u3082\u305d\u3082LINQ\u304c\u305d\u3046\u3044\u3046\u3082\u306e\u3067\u3059\u304b\u3089\u306d\u3002</p>&mdash; neuecc (@neuecc) <a href=\"https://twitter.com/neuecc/status/802126395459530752\">November 25, 2016</a></blockquote> <script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\nhttps://gist.github.com/neuecc/6cbec456dab4d0bb3c81976799b5fc6e\n\n```csharp\nusing System;\nusing System.Collections.Generic;\n\nclass Base { }\n\nclass A : Base { }\nclass B : Base { }\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        var objects1 = new Base[] { new A(), new B() };\n        var objects2 = new int?[] { 1, 2, 100, null, 1000 };\n\n        var hoge = objects1.SelectMany(x => x as A);\n        var huga = objects2.SelectMany(x => x);\n    }\n}\n\n\npublic static class FlatMapLikeExtensions\n{\n    public static IEnumerable<U> SelectMany<T, U>(this IEnumerable<T> source, Func<T, U> selector)\n        where U : class\n    {\n        foreach (var item in source)\n        {\n            var v = selector(item);\n            if (v != null) yield return v;\n        }\n    }\n\n    public static IEnumerable<U> SelectMany<T, U>(this IEnumerable<T> source, Func<T, U?> selector)\n        where U : struct\n    {\n        foreach (var item in source)\n        {\n            var v = selector(item);\n            if (v.HasValue) yield return v.Value;\n        }\n    }\n}\n```\n\n`SelectManay`\u3067\u30b7\u30f3\u30d7\u30eb(`Swift`\u306e`flatMap`\u3068\u540c\u7b49)\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001\u3064\u3044\u3067\u306b\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\u3082\u30e9\u30e0\u30c0\u5f0f\u3067\u306f\u7121\u304f\u306a\u308b\u306e\u3067`yield`\u4f7f\u3048\u3066 http://qiita.com/mono0926/items/b8ff59938a60ddf93c6e#selectmany\u3067\u53ef\u80fdswift\u306eflatmap\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u306f\u7121\u3044 \u306e\u30b3\u30fc\u30c9\u3088\u308a\u5c11\u3057\u30b7\u30f3\u30d7\u30eb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u8db3\u3059\u3068\u3001C#\u3067\u3082`OfType`\u3044\u3089\u306a\u3044\u306e\u3067\u306f\ud83e\udd14\u3068\u601d\u3048\u3066\u304d\u3061\u3083\u3044\u307e\u3059(\u3000\u00b4\uff65\u203f\uff65\uff40) (\u203b1)\n\n\u307e\u3063\u305f\u304f\u540c\u3058\u7d50\u679c:\n\n```csharp\nvar hoge = objects.OfType<A>();\nvar fuga = objects.SelectMany(x => x as A);\n```\n\n(\u203b1: \u305f\u3060\u3057\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u7684\u306b\u9055\u3044\u304c\u3042\u3063\u305f\u308a\u306f\u3057\u305d\u3046\u3002)\n\n# \u95a2\u9023\n\n\u95a2\u9023\u3068\u3057\u3066\u3001\u4ee5\u4e0b\u306e @koher \u3055\u3093\u306e\u8a18\u4e8b\u306a\u3069\u304c\u3068\u3066\u3082\u53c2\u8003\u306b\u3042\u308a\u307e\u3059\u3002\n1\u5e74\u307b\u3069\u524d\u306e\u8a18\u4e8b\u3067\u3059\u304c\u3001\u3053\u306e\u3042\u305f\u308a\u306fSwift 2\u304b\u3089\u307b\u307c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u306f\u305a\u3067\u3059(1\u21922\u306e\u9593\u306f\u8272\u3005\u6539\u826f\u3042\u3063\u305f)\u3002\n\n- [Swift 2.0\u306e\u65b0\u3057\u3044flatMap\u304c\u4fbf\u5229\u904e\u304e\u308b - Qiita](http://qiita.com/koher/items/6a95cb8edb04fb81f787)\n    - \u672c\u8a18\u4e8b\u66f8\u3044\u305f\u5f8c\u306b\u3001\u305d\u3046\u3044\u3048\u3070\u3053\u306e\u8a18\u4e8b\u3042\u3063\u305f\u306a\u3068\u601d\u3044\u51fa\u3057\u3066\u8aad\u307f\u8fd4\u3057\u305f\u3089\u3001\u4f3c\u305f\u5185\u5bb9\u3067\u3057\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40)\n- [Array\u3068Optional\u306emap\u306f\u540c\u3058\u3067\u3059 - Qiita](http://qiita.com/koher/items/68585cff691d87124077)\n\t- \u3053\u3046\u3044\u3046\u8a71\u984c\u306b\u8e0f\u307f\u8fbc\u3082\u3046\u3068\u3057\u305f\u3082\u306e\u306e\u3001\u3053\u3061\u3089\u306e\u8a18\u4e8b\u306b\u5145\u5206\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u3066\u66f8\u304f\u4f59\u5730\u7121\u304b\u3063\u305f(\u3000\u00b4\uff65\u203f\uff65\uff40)\n- [map\u3068flatMap\u3068\u3044\u3046\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3092\u7406\u89e3\u3059\u308b - Qiita](http://qiita.com/shimesaba/items/1a89cb5600454f91cc67)\n", "tags": ["Swift", "swift3", "C#", "VisualStudioForMac", "optional"]}