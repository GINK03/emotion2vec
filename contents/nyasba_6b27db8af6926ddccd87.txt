{"context": "Visualforce\u3067\u4e00\u89a7\u691c\u7d22\u753b\u9762\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u4f5c\u3063\u305f\u3068\u304d\u306b\u7406\u89e3\u3057\u305f\u3053\u3068\u3092\u6574\u7406\u3059\u308b\u610f\u5473\u3067\u3082\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u516c\u958b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u6a19\u6e96\u753b\u9762\u30d9\u30fc\u30b9\u3067\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u305f\u3068\u3057\u3066\u3082\u3053\u3053\u3060\u3051\u306f\u4f5c\u308a\u3053\u3080\u3053\u3068\u306f\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3046\u306e\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u4f7f\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3046\u308c\u3057\u3044\u3067\u3059\u3002\n\u307e\u3060\u307e\u3060Salesforce\u306e\u57fa\u672c\u304c\u7406\u89e3\u3067\u304d\u3066\u304d\u305f\u30ec\u30d9\u30eb\u3067\u3001Visualforce\u3084Apex\u306f\u89e6\u308a\u59cb\u3081\u305f\u3070\u304b\u308a\u3067\u3059\u3002\u3082\u3057\u3082\u3063\u3068\u3088\u3044\u6a5f\u80fd\u3084\u66f8\u304d\u65b9\u304c\u3042\u308b\u306e\u3067\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n\u4f55\u3092\u4f5c\u3063\u305f\u306e\u304b\n\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u89a7\u691c\u7d22\u753b\u9762\n\n\u691c\u7d22\u6761\u4ef6\u304c\u3044\u304f\u3064\u304b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\n\u691c\u7d22\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u3068\u3001\u305d\u306e\u6761\u4ef6\u3092\u3082\u3068\u306b\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092SOQL\u3067\u691c\u7d22\u3057\u3001\u4e00\u89a7\u8868\u793a\u3059\u308b\n\u898b\u51fa\u3057\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30bd\u30fc\u30c8\u9806\u304c\u5207\u308a\u66ff\u308f\u308b\n\n\u3053\u3093\u306a\u753b\u9762\u3067\u3059\n\n\uff03\u6a5f\u80fd\u7684\u306b\u306f\u30ec\u30dd\u30fc\u30c8\u3067\u3082\u5b9f\u73fe\u3067\u304d\u308b\u6a5f\u80fd\u3067\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u3053\u306f\u30c4\u30c3\u30b3\u307e\u306a\u3044\u3067\u304f\u3060\u3055\u3044m(_ _)m\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3082\u4f5c\u308a\u3053\u3093\u3067\u3044\u307e\u3059\n\n\n\u4e8b\u524d\u6e96\u5099\n\n\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\u5148\u65e5\u306eSalesforceWorldTour\u306eminihack\u8ab2\u984c\uff11\u306e\u51fa\u5f35\u7533\u8acb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002\nhttps://developer.salesforce.com/ja/worldtour2016/minihacks\n\uff08\u305f\u307e\u305f\u307e\u5b9f\u65bd\u3057\u305f\u74b0\u5883\u304c\u3042\u3063\u305f\u306e\u3067\u6d41\u7528\u3057\u305f\u3060\u3051\u3067\u3059\u3002\u30ab\u30b9\u30bf\u30e0\u9805\u76ee\u304c\u3044\u304f\u3064\u304b\u5165\u3063\u3066\u3044\u308c\u3070\u4f55\u3067\u3082\u3088\u3044\u3067\u3059\uff09\n\n\u30ab\u30b9\u30bf\u30e0\u9805\u76ee\nminihack\u306e\u4e2d\u3067\u4f5c\u308b\u3082\u306e\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\n\n\n\u30e9\u30d9\u30eb\nAPI\u53c2\u7167\u540d\n\u578b\n\u8aac\u660e\n\n\n\n\n\u30b9\u30c6\u30fc\u30bf\u30b9\nStatus__c\n\u9078\u629e\u30ea\u30b9\u30c8\n\u30ea\u30b9\u30c8\u306e\u4e00\u4f8b\u3068\u3057\u3066\u7528\u610f\n\n\n\u691c\u7d22\u7528\u30b9\u30c6\u30fc\u30bf\u30b9\nSearchConditionStatus__c\n\u9078\u629e\u30ea\u30b9\u30c8\n\u30b9\u30c6\u30fc\u30bf\u30b9\u3068\u9078\u629e\u80a2\u304c\u9055\u3046\u53ef\u80fd\u6027\u3092\u8003\u616e\u3057\u3001\u5225\u306b\u3057\u305f\n\n\n\u691c\u7d22\u7528\u6700\u7d42\u66f4\u65b0\u65e5From\nSearchConditionLastModifiedFrom__c\n\u65e5\u4ed8\n\u691c\u7d22\u5bfe\u8c61\u306f\u65e5\u6642\u578b\u3060\u304c\u3001\u691c\u7d22\u6761\u4ef6\u306f\u65e5\u4ed8\u3068\u3059\u308b\n\n\n\u691c\u7d22\u7528\u6700\u7d42\u66f4\u65b0\u65e5To\nSearchConditionLastModifiedTo__c\n\u65e5\u4ed8\n\n\n\n\n\n\u5b9f\u88c5\n\nApex\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\n\nTravelRequestListController.apxc\npublic with sharing class TravelRequestListController {\n\n    // \u62bd\u51fa\u5bfe\u8c61\u3068\u306a\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u30ea\u30b9\u30c8\n    static List<String> TARGET_FIELDS = new List<String>{\n         'Id'\n        ,'Name'\n        ,'TravelRequestName__c'\n        ,'Status__c'\n        ,'TravelStartDate__c'\n        ,'TravelEndDate__c'\n        ,'Purpose_of_Travel__c'\n        ,'Total__c'\n        ,'LastModifiedDate'\n    };\n\n    public SearchCondition condition{ get;set; }        // \u691c\u7d22\u6761\u4ef6\n    public List<Travel_Request__c> results { get;set; } // \u691c\u7d22\u7d50\u679c\u30ea\u30b9\u30c8\n    public String sortingField { get;set; }             // \u898b\u51fa\u3057\u306e\u30bd\u30fc\u30c8\u7528\u30ea\u30f3\u30af\u3092\u62bc\u3055\u308c\u305f\u969b\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\n    /**\n     * \u521d\u671f\u5316\u51e6\u7406\n     */\n    public void init(){\n        this.condition = new SearchCondition();\n        this.results = new List<Travel_Request__c>();\n    }\n\n    /**\n     * \u30af\u30ea\u30a2\u30dc\u30bf\u30f3\u51e6\u7406\n     */\n    public PageReference clear(){\n        init();\n        return null;\n    }\n\n    /**\n     * \u691c\u7d22\u30dc\u30bf\u30f3\u51e6\u7406\n     */\n    public PageReference search() {\n\n        // \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n        if( condition.validate() ){\n            return null;\n        }\n\n        // \u691c\u7d22\u6761\u4ef6\u304b\u3089SOQL\u3092\u4f5c\u6210\n        String soqlQuery = condition.getSoqlQuery();\n        System.debug('[soql] ' + soqlQuery);\n\n        try{\n            this.results = database.query(soqlQuery);\n        }catch(DmlException e){\n            ApexPages.addMessages(e);\n        }catch(Exception e){\n            ApexPages.addMessages(e);\n        }\n        return null;\n    }\n\n    /**\n     * \u30bd\u30fc\u30c8\u30ea\u30f3\u30af\u51e6\u7406\n     */\n    public PageReference sort(){\n\n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u4e0d\u660e\u306a\u5834\u5408\u306f\u4f55\u3082\u3057\u306a\u3044\n        if(this.sortingField == null ){\n            return null;\n        }\n\n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u304c\u3001\u73fe\u5728\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u540c\u3058\u5834\u5408\u306f\u30bd\u30fc\u30c8\u9806\u3092\u53cd\u5bfe\u306b\u3059\u308b\n        if(this.sortingField == this.condition.sortkey){\n            this.condition.setOrderReverse();\n        }\n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u304c\u3001\u73fe\u5728\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u9055\u3046\u5834\u5408\u306f\u65b0\u3057\u3044\u9805\u76ee\u3067\u30bd\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u3059\u308b\n        else {\n            this.condition.sortkey = this.sortingField;\n        }\n\n        // \u691c\u7d22\u5b9f\u884c\n        search();\n        return null;\n    }\n\n    /**\n     * \u73fe\u5728\u306e\u30bd\u30fc\u30c8\u30ad\u30fc\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n     * \n     * \u30fb\u691c\u7d22\u7d50\u679c\u306e\u898b\u51fa\u3057\u306b\u30bd\u30fc\u30c8\u9806\u3092\u51fa\u3059\u305f\u3081\u306b\u4f7f\u3046\n     * \u30fb\u672c\u6765\u306fgetSortOrder\u3082\u542b\u3081\u3066\u3001\u30ed\u30b8\u30c3\u30af\u3082Apex\u5074\u3067\u6301\u3061\u305f\u3044\u304c\u3001\n     * \u3000VisualForce\u304b\u3089\u5f15\u6570\u3042\u308a\u3067\u30e1\u30bd\u30c3\u30c9\u304c\u547c\u3079\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n     * \n     */\n    public String getSortKey(){\n        return this.condition.sortkey;\n    }\n\n    /**\n     * \u73fe\u5728\u306e\u30bd\u30fc\u30c8\u9806\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\uff08\u25b2 or \u25bc\u3092\u8fd4\u3059\uff09\n     */ \n    public String getSortOrder(){\n        return this.condition.sortOrderToString();\n    }\n\n\n    /**\n     * \u691c\u7d22\u6761\u4ef6\u3092\u7ba1\u7406\u3059\u308b\u30af\u30e9\u30b9\n     */ \n    public Class SearchCondition {\n\n    private Time JST_AM0 = Time.newInstance(9, 0, 0, 0);  \n\n        /*\n         * \u691c\u7d22\u6761\u4ef6\u306e\u5165\u529b\u30d5\u30a3\u30fc\u30eb\u30c9\u7528\n         * \n         * \u30fb\u30ab\u30b9\u30bf\u30e0\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u3057\u3066\u691c\u7d22\u6761\u4ef6\u306e\u5165\u529b\u9805\u76ee\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n         * \u30fb\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30eb\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u306e\u5834\u5408\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089\n         * \u3000\u9078\u629e\u30ea\u30b9\u30c8\u5024\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u4e00\u89a7\u753b\u9762\u306e\u9078\u629e\u80a2\u3082\u8ffd\u52a0\u3055\u308c\u308b\u3002\n         */\n        public Travel_Request__c obj {get;set;}     \n\n        public String sortkey { get;set; }          // \u30bd\u30fc\u30c8\u30ad\u30fc\n        public String order { get;set; }            // \u30bd\u30fc\u30c8\u9806\n\n        public SearchCondition() {\n            this.obj = new Travel_Request__c();\n\n            // \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u6642\u306e\u964d\u9806\u3068\u3059\u308b\n            sortkey = 'LastModifiedDate';\n            order = 'DESC';\n        }\n\n\n        // \u691c\u7d22\u6761\u4ef6\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n        public boolean validate(){\n            boolean isError = false;\n            if( this.obj.SearchConditionLastModifiedFrom__c != null &&\n                this.obj.SearchConditionLastModifiedTo__c != null &&\n                this.obj.SearchConditionLastModifiedFrom__c > this.obj.SearchConditionLastModifiedTo__c ){\n                    ApexPages.addMessage(new ApexPages.Message(ApexPages.Severity.ERROR, '\u6700\u7d42\u66f4\u65b0\u65e5\u306e\u7bc4\u56f2\u6307\u5b9a\u304c\u9006\u8ee2\u3057\u3066\u3044\u307e\u3059', ''));\n                    isError = true;\n            }\n            return isError;\n        }\n\n\n        // \u6700\u7d42\u7684\u306aSOQL\u3092\u751f\u6210\uff08\u6700\u5927500\u4ef6\u3068\u3044\u3046\u306e\u306f\u56fa\u5b9a\uff09\n        public String getSoqlQuery(){\n            List<String> param = new String[]{ getFieldList(), getWhere(), getOrder() };\n            return String.format('SELECT {0} FROM Travel_Request__c {1} {2} LIMIT 500', param);\n        }\n\n        // SELECT\u5bfe\u8c61\u30d5\u30a3\u30fc\u30eb\u30c9\n        private String getFieldList(){\n            return String.join(TARGET_FIELDS, ',');\n        }\n\n        // WHERE\u53e5\u4f5c\u6210\n        private String getWhere(){\n            List<String> param = new String[]{ };\n\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\n            if( !String.isBlank(this.obj.SearchConditionStatus__c) ){\n                param.add('Status__c = \\'' + obj.SearchConditionStatus__c + '\\'');\n            }\n            // \u6700\u7d42\u66f4\u65b0\u65e5From\n            if( this.obj.SearchConditionLastModifiedFrom__c != null ){\n                Datetime fromDate = getStartOfDay(obj.SearchConditionLastModifiedFrom__c );\n                param.add('LastModifiedDate >= ' + fromDate.format('yyyy-MM-dd\\'T\\'HH:mm:ss.000\\'Z\\''));\n            }            \n            // \u6700\u7d42\u66f4\u65b0\u65e5To\n            if( this.obj.SearchConditionLastModifiedTo__c != null ){\n                Datetime toDateAddOneDay = getStartOfDay( obj.SearchConditionLastModifiedTo__c.addDays(1));\n                param.add('LastModifiedDate < ' + toDateAddOneDay.format('yyyy-MM-dd\\'T\\'HH:mm:ss.000\\'Z\\''));\n            }\n\n            if(param.isEmpty()){\n                return '';\n            }\n            return 'WHERE ' + String.join(param, ' AND ');\n        }\n\n        // ORDERBY\u53e5\u4f5c\u6210\n        private String getOrder(){\n            List<String> param = new String[]{ sortkey, order };\n            return String.format('ORDER BY {0} {1}', param);\n        }\n\n        private DateTime getStartOfDay(Date d){\n            // GMT+9\u3092\u8003\u616e\u3057\u3066\u3001GMT\u3067\u65e5\u672c\u306e0\u6642\u3092\u4f5c\u6210\u3059\u308b\uff08\uff1dGMT\u3067\u306f1\u65e5\u524d\u306e15\u6642\uff09\n            JST_AM0 = Time.newInstance(15, 0, 0, 0);\n            return Datetime.newInstance(d.addDays(-1), JST_AM0);\n        }\n\n        // \u30bd\u30fc\u30c8\u9806\u3092\u898b\u51fa\u3057\u306b\u8868\u793a\u3059\u308b\u8a18\u53f7\u306b\u5909\u63db\u3059\u308b\n        public String sortOrderToString(){\n            if(this.order == 'DESC'){\n                return '\u25bc';\n            }\n            return '\u25b2';\n        }\n\n        // \u30bd\u30fc\u30c8\u9806\u3092\u9006\u306b\u3059\u308b\n        public void setOrderReverse(){\n            if(this.order == 'DESC'){\n                this.order = 'ASC';\n            }\n            else {\n                this.order = 'DESC';\n            }\n        } \n    }\n}\n\n\n\nVisualforce\u30da\u30fc\u30b8\n\nTravelRequestList.vfp\n<apex:page controller=\"TravelRequestListController\" action=\"{!init}\" sidebar=\"false\" Id=\"TravelRequestList\" >\n<style type=\"text/css\">\n    #conditionTable { width: 50%; border: 0; margin-left: 5%; }\n    #conditionTable .label { text-align: right; }\n    #conditionTable .dateFormat { display: none; }\n</style>\n<script type=\"text/javascript\">\n    // \u30da\u30fc\u30b8\u3092\u958b\u3044\u305f\u3068\u304d\u306b\u521d\u671f\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u3057\u306a\u3044\n    beenFocused = true;\n</script>\n<apex:form id=\"form1\">\n    <apex:pageBlock title=\"\u51fa\u5f35\u4e00\u89a7\">\n        <apex:pageMessages id=\"messagearea\" showDetail=\"false\"/>\n        <apex:pageblockSection id=\"conditionSection\" title=\"\u691c\u7d22\" columns=\"1\">\n            <apex:outputpanel id=\"searchcondition\">\n                <table id=\"conditionTable\">\n                    <tr>\n                        <td class=\"label\"><apex:outputLabel value=\"\u30b9\u30c6\u30fc\u30bf\u30b9\" for=\"scStatus\" styleClass=\"labelCol\" /></td>\n                        <td><apex:inputField id=\"scStatus\" value=\"{!condition.obj.SearchConditionStatus__c}\" /></td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\"><apex:outputLabel value=\"\u6700\u7d42\u66f4\u65b0\u65e5\"  styleClass=\"labelCol\" /></td>\n                        <td>\n                            <apex:inputField id=\"scLastModifiedFrom\" value=\"{!condition.obj.SearchConditionLastModifiedFrom__c}\" />\n                            <apex:outputLabel value=\" \uff5e\u3000\"  styleClass=\"labelCol\" />\n                            <apex:inputField id=\"scLastModifiedTo\" value=\"{!condition.obj.SearchConditionLastModifiedTo__c}\" />\n                        </td>\n                    </tr>\n                </table>\n            </apex:outputpanel>\n        </apex:pageblockSection>\n        <apex:pageBlockButtons id=\"buttonSection\" location=\"bottom\" >\n            <apex:commandButton value=\"\u691c\u7d22\" action=\"{!search}\" style=\"font-size:12pt;width:100px;height:30px;\" reRender=\"searchresult,messagearea\"/>\n            <apex:commandButton value=\"\u30af\u30ea\u30a2\" action=\"{!clear}\" style=\"font-size:12pt;width:100px;height:30px;\" reRender=\"searchcondition,searchresult,messagearea\"/>\n        </apex:pageBlockButtons>\n    </apex:pageBlock>\n</apex:form>\n<apex:outputpanel id=\"searchresult\">\n    <apex:pageBlock title=\"\u691c\u7d22\u7d50\u679c\uff1a\" rendered=\"{!(results.size == 0)}\">\n         \u691c\u7d22\u6761\u4ef6\u306b\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\n    </apex:pageBlock>\n\n    <apex:form id=\"resultForm\">\n        <apex:pageBlock id=\"resultBlock\" title=\"\u51fa\u5f35\u4e00\u89a7\" rendered=\"{!(results.size > 0)}\">\n            <apex:outputtext style=\"width:110px\" value=\"\u7d50\u679c : {!results.size}\u4ef6\"/>\n            <apex:pageblockTable id=\"resultTable\" value=\"{!results}\" var=\"o\" frame=\"box\">\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7533\u8acb\u756a\u53f7{!IF(sortKey == 'Name', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Name\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet>\n                    <apex:outputlink value=\"/{!o.Id}\"><apex:outputField style=\"width:80px\" value=\"{!o.Name}\"/></apex:outputlink>\n                </apex:column>\n                <apex:column style=\"width:160px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7533\u8acb\u540d{!IF(sortKey == 'TravelRequestName__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelRequestName__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.TravelRequestName__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u30b9\u30c6\u30fc\u30bf\u30b9{!IF(sortKey == 'Status__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Status__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet>\n                    <apex:outputField style=\"width:150px\" value=\"{!o.Status__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u958b\u59cb\u65e5{!IF(sortKey == 'TravelStartDate__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelStartDate__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.TravelStartDate__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7d42\u4e86\u65e5{!IF(sortKey == 'TravelEndDate__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelEndDate__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.TravelEndDate__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:120px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u76ee\u7684{!IF(sortKey == 'Purpose_of_Travel__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Purpose_of_Travel__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.Purpose_of_Travel__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:120px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u7dcf\u8cbb\u7528{!IF(sortKey == 'Total__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Total__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.Total__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u6700\u7d42\u66f4\u65b0\u65e5\u6642{!IF(sortKey == 'LastModifiedDate', sortOrder, '\u3000')}\">\n                            <apex:param value=\"LastModifiedDate\" name=\"String\" assignTo=\"{!sortingField}\" />\n                        </apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.LastModifiedDate}\"/>\n                </apex:column>\n            </apex:pageblockTable>\n        </apex:pageBlock>\n    </apex:form>\n</apex:outputpanel>\n</apex:page>\n\n\n\nVisualforce\u30bf\u30d6\n\u4e0a\u8a18\u306eVisualforce\u30da\u30fc\u30b8\u3092\u958b\u304f\u30bf\u30d6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nApex\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u30c6\u30b9\u30c8\n\u7c21\u5358\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u30c6\u30b9\u30c8\u3082\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\u30ab\u30d0\u30ec\u30c3\u30b8\u306f88%\u3067\u3059\u3002\n\u4f59\u8ac7\u3067\u3059\u304c\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u305f\u3053\u3068\u306b\u9023\u52d5\u3057\u3066\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u3044\u3046\u9805\u76ee\u81ea\u52d5\u66f4\u65b0\u304c\u4ed5\u8fbc\u307e\u308c\u3066\u3044\u305f\u305f\u3081\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u306e\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3067\u306f\u6b63\u3057\u304f\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u306b\u30fb\u30fb\u3068\u5c11\u3057\u30cf\u30de\u308a\u307e\u3057\u305f\u304c\u30011\u30641\u3064\u30ed\u30b0\u3092\u8ffd\u3063\u3066\u3044\u304f\u3068\u30c6\u30b9\u30c8\u6642\u306b\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3082\u5b9f\u884c\u3055\u308c\u308b\u3093\u3060\u3068\u3044\u3046\u3053\u3068\u304c\u3088\u304f\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\nTravelRequestListControllerTest.apex\n@isTest\npublic class TravelRequestListControllerTest {\n\n    /**\n     * \u691c\u7d22\u6761\u4ef6\u306a\u3057\u3067\u691c\u7d22\n     */ \n    @isTest\n    static void noKeywordSearch(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n\n        Test.startTest();\n        sut.init();\n        sut.search();\n        Test.stopTest();\n\n        System.assert(sut.results.size() == 3);\n    }\n\n    /**\n     * \u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u6307\u5b9a\u3057\u305f\u691c\u7d22\u306e\u5b9f\u65bd\n     */ \n    @isTest\n    static void statusSearch(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n\n        Test.startTest();\n        sut.init();\n        sut.condition.obj.SearchConditionStatus__c = '\u627f\u8a8d\u5b8c\u4e86';\n        sut.search();\n        Test.stopTest();\n\n        System.debug(sut.results.size());\n        System.debug(sut.results);\n        System.assert(sut.results.size() == 1);\n    }\n\n    /**\n     * \u30bd\u30fc\u30c8\u30ad\u30fc\u5909\u66f4\u3001\u30bd\u30fc\u30c8\u9806\u5909\u66f4\u306a\u3069\n     */ \n    @isTest\n    static void lastModifiedDateSearchWithSorting(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n\n        Test.startTest();\n        sut.init();\n        sut.condition.obj.SearchConditionLastModifiedFrom__c = Date.today();\n        sut.condition.obj.SearchConditionLastModifiedTo__c = Date.today();\n        sut.search();\n\n        // \u51fa\u5f35\u7533\u8acb\u540d\u306e\u964d\u9806\u30bd\u30fc\u30c8\n        sut.sortingField = 'TravelRequestName__c'; \n        sut.sort();                    \n        Travel_Request__c actual1 = sut.results.get(0);\n        System.assert(actual1.TravelRequestName__c == '\u51fa\u5f353');\n\n        // \u6607\u9806\u30bd\u30fc\u30c8\u306b\u5909\u66f4\n        sut.sort();\n        Travel_Request__c actual2 = sut.results.get(0);\n        System.assert(actual2.TravelRequestName__c == '\u51fa\u5f351');\n        System.assert(sut.getSortKey() == 'TravelRequestName__c');\n        System.assert(sut.getSortOrder() == '\u25b2');\n\n        Test.stopTest();\n    }\n\n    /**\n     * \u30af\u30ea\u30a2\u30dc\u30bf\u30f3\u51e6\u7406\n     */ \n    @isTest\n    static void clear(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n\n        Test.startTest();\n        sut.init();\n        sut.search();\n        System.assert(sut.results.size() > 0);\n        sut.clear();\n        Test.stopTest();\n\n        System.assert(sut.results.size() == 0);\n    }\n\n\n    /**\n     * \u30c6\u30b9\u30c8\u7528\u306b3\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210\u3059\u308b\n     */ \n    private static void createRecords(){\n        List<Travel_Request__c> records = new Travel_Request__c[]{\n              createRecord(1, '\u7533\u8acb\u4e2d')\n            , createRecord(2, '\u627f\u8a8d\u5b8c\u4e86')\n            , createRecord(3, '\u5374\u4e0b')\n        };\n        insert records;\n    }\n\n    private static Travel_Request__c createRecord(Integer index, String status){\n        Travel_Request__c tr = new Travel_Request__c();\n    tr.TravelRequestName__c = '\u51fa\u5f35' + String.valueOf(index);\n        tr.Status__c = status;\n        tr.TravelStartDate__c = Date.newInstance(2017, 1, 1).addDays(index);\n        tr.TravelEndDate__c = Date.newInstance(2017, 1, 4).addDays(index);\n        tr.Airfare__c = 1000;\n        return tr;\n    }\n\n}\n\n\n\n\u611f\u60f3\n\n\u601d\u3063\u305f\u4ee5\u4e0a\u306b\u30b7\u30f3\u30d7\u30eb\u306b\u4e00\u89a7\u753b\u9762\u304c\u5b9f\u73fe\u3067\u304d\u305f\u3002\u3053\u308c\u306a\u3089\u30c6\u30f3\u30d7\u30ec\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u305d\u3046\u3002\n\u958b\u767a\u8005\u30b3\u30f3\u30bd\u30fc\u30eb\u306f\u3064\u3089\u304b\u3063\u305f\u3002\u88dc\u5b8c\u3084\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u306a\u3069\u672c\u5f53\u306b\u3084\u308a\u306b\u304f\u3044\u3002\nVisualforce\u304b\u3089\u5f15\u6570\u3042\u308a\u3067\u30e1\u30bd\u30c3\u30c9\u547c\u3079\u306a\u3044\u306e\u306f\u6b8b\u5ff5\u3002param\u306eassignTo\u306a\u3069\u6982\u5ff5\u306e\u7406\u89e3\u304c\u96e3\u3057\u3044\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306estartTest/stopTest\u3068assert\u3092\u3069\u3046\u3044\u3046\u9806\u306b\u66f8\u304f\u3079\u304d\u306a\u306e\u304b\u304c\u308f\u304b\u3089\u306a\u3044\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3067\u5171\u901a\u306esetup\u30e1\u30bd\u30c3\u30c9\u304c\u307b\u3057\u3044\u3002\u3042\u308b\u30fb\u30fb\uff1f\n\nVisualforce\u3067\u4e00\u89a7\u691c\u7d22\u753b\u9762\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u4f5c\u3063\u305f\u3068\u304d\u306b\u7406\u89e3\u3057\u305f\u3053\u3068\u3092\u6574\u7406\u3059\u308b\u610f\u5473\u3067\u3082\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u516c\u958b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u6a19\u6e96\u753b\u9762\u30d9\u30fc\u30b9\u3067\u958b\u767a\u3092\u884c\u3063\u3066\u3044\u305f\u3068\u3057\u3066\u3082\u3053\u3053\u3060\u3051\u306f\u4f5c\u308a\u3053\u3080\u3053\u3068\u306f\u591a\u3044\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3046\u306e\u3067\u3001\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u4f7f\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3046\u308c\u3057\u3044\u3067\u3059\u3002\n\n\u307e\u3060\u307e\u3060Salesforce\u306e\u57fa\u672c\u304c\u7406\u89e3\u3067\u304d\u3066\u304d\u305f\u30ec\u30d9\u30eb\u3067\u3001Visualforce\u3084Apex\u306f\u89e6\u308a\u59cb\u3081\u305f\u3070\u304b\u308a\u3067\u3059\u3002\u3082\u3057\u3082\u3063\u3068\u3088\u3044\u6a5f\u80fd\u3084\u66f8\u304d\u65b9\u304c\u3042\u308b\u306e\u3067\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n## \u4f55\u3092\u4f5c\u3063\u305f\u306e\u304b\n\n\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u89a7\u691c\u7d22\u753b\u9762\n\n* \u691c\u7d22\u6761\u4ef6\u304c\u3044\u304f\u3064\u304b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\n* \u691c\u7d22\u30dc\u30bf\u30f3\u304c\u62bc\u3055\u308c\u308b\u3068\u3001\u305d\u306e\u6761\u4ef6\u3092\u3082\u3068\u306b\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092SOQL\u3067\u691c\u7d22\u3057\u3001\u4e00\u89a7\u8868\u793a\u3059\u308b\n* \u898b\u51fa\u3057\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30bd\u30fc\u30c8\u9806\u304c\u5207\u308a\u66ff\u308f\u308b\n\n\u3053\u3093\u306a\u753b\u9762\u3067\u3059\n![1.JPG](https://qiita-image-store.s3.amazonaws.com/0/47589/d20a5b02-f6bf-5f88-bcf0-f89e412334c1.jpeg)\n\n\uff03\u6a5f\u80fd\u7684\u306b\u306f\u30ec\u30dd\u30fc\u30c8\u3067\u3082\u5b9f\u73fe\u3067\u304d\u308b\u6a5f\u80fd\u3067\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u3053\u306f\u30c4\u30c3\u30b3\u307e\u306a\u3044\u3067\u304f\u3060\u3055\u3044m(_ _)m\n\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3082\u4f5c\u308a\u3053\u3093\u3067\u3044\u307e\u3059\n![2.JPG](https://qiita-image-store.s3.amazonaws.com/0/47589/57b7ab65-eb8c-e65e-e64c-033694858bc0.jpeg)\n\n\n## \u4e8b\u524d\u6e96\u5099\n\n### \u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\n\u5148\u65e5\u306eSalesforceWorldTour\u306eminihack\u8ab2\u984c\uff11\u306e\u51fa\u5f35\u7533\u8acb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3044\u307e\u3059\u3002\nhttps://developer.salesforce.com/ja/worldtour2016/minihacks\n\n\uff08\u305f\u307e\u305f\u307e\u5b9f\u65bd\u3057\u305f\u74b0\u5883\u304c\u3042\u3063\u305f\u306e\u3067\u6d41\u7528\u3057\u305f\u3060\u3051\u3067\u3059\u3002\u30ab\u30b9\u30bf\u30e0\u9805\u76ee\u304c\u3044\u304f\u3064\u304b\u5165\u3063\u3066\u3044\u308c\u3070\u4f55\u3067\u3082\u3088\u3044\u3067\u3059\uff09\n\n### \u30ab\u30b9\u30bf\u30e0\u9805\u76ee\n\nminihack\u306e\u4e2d\u3067\u4f5c\u308b\u3082\u306e\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\n| \u30e9\u30d9\u30eb | API\u53c2\u7167\u540d | \u578b | \u8aac\u660e |\n|:------|:---|:------|:---------------------|\n| \u30b9\u30c6\u30fc\u30bf\u30b9  | Status__c  | \u9078\u629e\u30ea\u30b9\u30c8  | \u30ea\u30b9\u30c8\u306e\u4e00\u4f8b\u3068\u3057\u3066\u7528\u610f  |\n| \u691c\u7d22\u7528\u30b9\u30c6\u30fc\u30bf\u30b9  | SearchConditionStatus__c  | \u9078\u629e\u30ea\u30b9\u30c8  | \u30b9\u30c6\u30fc\u30bf\u30b9\u3068\u9078\u629e\u80a2\u304c\u9055\u3046\u53ef\u80fd\u6027\u3092\u8003\u616e\u3057\u3001\u5225\u306b\u3057\u305f  |\n| \u691c\u7d22\u7528\u6700\u7d42\u66f4\u65b0\u65e5From  | SearchConditionLastModifiedFrom__c  | \u65e5\u4ed8  | \u691c\u7d22\u5bfe\u8c61\u306f\u65e5\u6642\u578b\u3060\u304c\u3001\u691c\u7d22\u6761\u4ef6\u306f\u65e5\u4ed8\u3068\u3059\u308b |\n| \u691c\u7d22\u7528\u6700\u7d42\u66f4\u65b0\u65e5To  | SearchConditionLastModifiedTo__c  | \u65e5\u4ed8  |   |\n\n\n## \u5b9f\u88c5\n\n### Apex\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\n\n```TravelRequestListController.apxc\npublic with sharing class TravelRequestListController {\n    \n    // \u62bd\u51fa\u5bfe\u8c61\u3068\u306a\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u30ea\u30b9\u30c8\n    static List<String> TARGET_FIELDS = new List<String>{\n         'Id'\n        ,'Name'\n        ,'TravelRequestName__c'\n        ,'Status__c'\n        ,'TravelStartDate__c'\n        ,'TravelEndDate__c'\n        ,'Purpose_of_Travel__c'\n        ,'Total__c'\n        ,'LastModifiedDate'\n    };\n    \n    public SearchCondition condition{ get;set; } \t\t// \u691c\u7d22\u6761\u4ef6\n    public List<Travel_Request__c> results { get;set; }\t// \u691c\u7d22\u7d50\u679c\u30ea\u30b9\u30c8\n    public String sortingField { get;set; } \t\t\t// \u898b\u51fa\u3057\u306e\u30bd\u30fc\u30c8\u7528\u30ea\u30f3\u30af\u3092\u62bc\u3055\u308c\u305f\u969b\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\n    /**\n     * \u521d\u671f\u5316\u51e6\u7406\n     */\n    public void init(){\n        this.condition = new SearchCondition();\n        this.results = new List<Travel_Request__c>();\n    }\n    \n    /**\n     * \u30af\u30ea\u30a2\u30dc\u30bf\u30f3\u51e6\u7406\n     */\n    public PageReference clear(){\n        init();\n        return null;\n    }\n    \n    /**\n     * \u691c\u7d22\u30dc\u30bf\u30f3\u51e6\u7406\n     */\n    public PageReference search() {\n\n        // \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n        if( condition.validate() ){\n            return null;\n        }\n        \n        // \u691c\u7d22\u6761\u4ef6\u304b\u3089SOQL\u3092\u4f5c\u6210\n        String soqlQuery = condition.getSoqlQuery();\n        System.debug('[soql] ' + soqlQuery);\n\n        try{\n            this.results = database.query(soqlQuery);\n        }catch(DmlException e){\n            ApexPages.addMessages(e);\n        }catch(Exception e){\n            ApexPages.addMessages(e);\n        }\n        return null;\n    }\n\n    /**\n     * \u30bd\u30fc\u30c8\u30ea\u30f3\u30af\u51e6\u7406\n     */\n    public PageReference sort(){\n        \n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u4e0d\u660e\u306a\u5834\u5408\u306f\u4f55\u3082\u3057\u306a\u3044\n        if(this.sortingField == null ){\n            return null;\n        }\n        \n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u304c\u3001\u73fe\u5728\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u540c\u3058\u5834\u5408\u306f\u30bd\u30fc\u30c8\u9806\u3092\u53cd\u5bfe\u306b\u3059\u308b\n        if(this.sortingField == this.condition.sortkey){\n            this.condition.setOrderReverse();\n        }\n        // \u30bd\u30fc\u30c8\u3092\u884c\u3046\u5bfe\u8c61\u304c\u3001\u73fe\u5728\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u9055\u3046\u5834\u5408\u306f\u65b0\u3057\u3044\u9805\u76ee\u3067\u30bd\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u3059\u308b\n        else {\n            this.condition.sortkey = this.sortingField;\n        }\n        \n        // \u691c\u7d22\u5b9f\u884c\n        search();\n        return null;\n    }\n    \n    /**\n     * \u73fe\u5728\u306e\u30bd\u30fc\u30c8\u30ad\u30fc\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n     * \n     * \u30fb\u691c\u7d22\u7d50\u679c\u306e\u898b\u51fa\u3057\u306b\u30bd\u30fc\u30c8\u9806\u3092\u51fa\u3059\u305f\u3081\u306b\u4f7f\u3046\n     * \u30fb\u672c\u6765\u306fgetSortOrder\u3082\u542b\u3081\u3066\u3001\u30ed\u30b8\u30c3\u30af\u3082Apex\u5074\u3067\u6301\u3061\u305f\u3044\u304c\u3001\n     * \u3000VisualForce\u304b\u3089\u5f15\u6570\u3042\u308a\u3067\u30e1\u30bd\u30c3\u30c9\u304c\u547c\u3079\u306a\u3044\u305f\u3081\u3001\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n     * \n     */\n    public String getSortKey(){\n        return this.condition.sortkey;\n    }\n    \n    /**\n     * \u73fe\u5728\u306e\u30bd\u30fc\u30c8\u9806\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\uff08\u25b2 or \u25bc\u3092\u8fd4\u3059\uff09\n     */ \n    public String getSortOrder(){\n        return this.condition.sortOrderToString();\n    }\n    \n\n    /**\n     * \u691c\u7d22\u6761\u4ef6\u3092\u7ba1\u7406\u3059\u308b\u30af\u30e9\u30b9\n     */ \n    public Class SearchCondition {\n\n\tprivate Time JST_AM0 = Time.newInstance(9, 0, 0, 0);  \n        \n        /*\n         * \u691c\u7d22\u6761\u4ef6\u306e\u5165\u529b\u30d5\u30a3\u30fc\u30eb\u30c9\u7528\n         * \n         * \u30fb\u30ab\u30b9\u30bf\u30e0\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u3057\u3066\u691c\u7d22\u6761\u4ef6\u306e\u5165\u529b\u9805\u76ee\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n         * \u30fb\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30eb\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u306e\u5834\u5408\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089\n         * \u3000\u9078\u629e\u30ea\u30b9\u30c8\u5024\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u4e00\u89a7\u753b\u9762\u306e\u9078\u629e\u80a2\u3082\u8ffd\u52a0\u3055\u308c\u308b\u3002\n         */\n\t    public Travel_Request__c obj {get;set;}\t\t\n        \n        public String sortkey { get;set; }\t\t\t// \u30bd\u30fc\u30c8\u30ad\u30fc\n        public String order { get;set; }        \t// \u30bd\u30fc\u30c8\u9806\n        \n        public SearchCondition() {\n        \tthis.obj = new Travel_Request__c();\n            \n            // \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u6642\u306e\u964d\u9806\u3068\u3059\u308b\n            sortkey = 'LastModifiedDate';\n            order = 'DESC';\n        }\n\n        \n        // \u691c\u7d22\u6761\u4ef6\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\n        public boolean validate(){\n            boolean isError = false;\n            if( this.obj.SearchConditionLastModifiedFrom__c != null &&\n               \tthis.obj.SearchConditionLastModifiedTo__c != null &&\n               \tthis.obj.SearchConditionLastModifiedFrom__c > this.obj.SearchConditionLastModifiedTo__c ){\n            \t\tApexPages.addMessage(new ApexPages.Message(ApexPages.Severity.ERROR, '\u6700\u7d42\u66f4\u65b0\u65e5\u306e\u7bc4\u56f2\u6307\u5b9a\u304c\u9006\u8ee2\u3057\u3066\u3044\u307e\u3059', ''));\n                \tisError = true;\n            }\n            return isError;\n        }\n\n\n        // \u6700\u7d42\u7684\u306aSOQL\u3092\u751f\u6210\uff08\u6700\u5927500\u4ef6\u3068\u3044\u3046\u306e\u306f\u56fa\u5b9a\uff09\n        public String getSoqlQuery(){\n            List<String> param = new String[]{ getFieldList(), getWhere(), getOrder() };\n            return String.format('SELECT {0} FROM Travel_Request__c {1} {2} LIMIT 500', param);\n        }\n        \n        // SELECT\u5bfe\u8c61\u30d5\u30a3\u30fc\u30eb\u30c9\n        private String getFieldList(){\n            return String.join(TARGET_FIELDS, ',');\n        }\n        \n        // WHERE\u53e5\u4f5c\u6210\n        private String getWhere(){\n            List<String> param = new String[]{ };\n            \n            // \u30b9\u30c6\u30fc\u30bf\u30b9\n            if( !String.isBlank(this.obj.SearchConditionStatus__c) ){\n                param.add('Status__c = \\'' + obj.SearchConditionStatus__c + '\\'');\n            }\n            // \u6700\u7d42\u66f4\u65b0\u65e5From\n            if( this.obj.SearchConditionLastModifiedFrom__c != null ){\n                Datetime fromDate = getStartOfDay(obj.SearchConditionLastModifiedFrom__c );\n                param.add('LastModifiedDate >= ' + fromDate.format('yyyy-MM-dd\\'T\\'HH:mm:ss.000\\'Z\\''));\n            }            \n            // \u6700\u7d42\u66f4\u65b0\u65e5To\n            if( this.obj.SearchConditionLastModifiedTo__c != null ){\n                Datetime toDateAddOneDay = getStartOfDay( obj.SearchConditionLastModifiedTo__c.addDays(1));\n                param.add('LastModifiedDate < ' + toDateAddOneDay.format('yyyy-MM-dd\\'T\\'HH:mm:ss.000\\'Z\\''));\n            }\n            \n            if(param.isEmpty()){\n                return '';\n            }\n            return 'WHERE ' + String.join(param, ' AND ');\n        }\n        \n        // ORDERBY\u53e5\u4f5c\u6210\n        private String getOrder(){\n            List<String> param = new String[]{ sortkey, order };\n            return String.format('ORDER BY {0} {1}', param);\n        }\n        \n        private DateTime getStartOfDay(Date d){\n            // GMT+9\u3092\u8003\u616e\u3057\u3066\u3001GMT\u3067\u65e5\u672c\u306e0\u6642\u3092\u4f5c\u6210\u3059\u308b\uff08\uff1dGMT\u3067\u306f1\u65e5\u524d\u306e15\u6642\uff09\n            JST_AM0 = Time.newInstance(15, 0, 0, 0);\n            return Datetime.newInstance(d.addDays(-1), JST_AM0);\n        }\n        \n        // \u30bd\u30fc\u30c8\u9806\u3092\u898b\u51fa\u3057\u306b\u8868\u793a\u3059\u308b\u8a18\u53f7\u306b\u5909\u63db\u3059\u308b\n        public String sortOrderToString(){\n            if(this.order == 'DESC'){\n                return '\u25bc';\n            }\n            return '\u25b2';\n        }\n        \n        // \u30bd\u30fc\u30c8\u9806\u3092\u9006\u306b\u3059\u308b\n        public void setOrderReverse(){\n            if(this.order == 'DESC'){\n                this.order = 'ASC';\n            }\n            else {\n\t            this.order = 'DESC';\n            }\n        } \n    }\n}\n```\n\n\n### Visualforce\u30da\u30fc\u30b8\n\n\n```TravelRequestList.vfp\n<apex:page controller=\"TravelRequestListController\" action=\"{!init}\" sidebar=\"false\" Id=\"TravelRequestList\" >\n<style type=\"text/css\">\n\t#conditionTable { width: 50%; border: 0; margin-left: 5%; }\n    #conditionTable .label { text-align: right; }\n    #conditionTable .dateFormat { display: none; }\n</style>\n<script type=\"text/javascript\">\n\t// \u30da\u30fc\u30b8\u3092\u958b\u3044\u305f\u3068\u304d\u306b\u521d\u671f\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\u3057\u306a\u3044\n\tbeenFocused = true;\n</script>\n<apex:form id=\"form1\">\n    <apex:pageBlock title=\"\u51fa\u5f35\u4e00\u89a7\">\n\t\t<apex:pageMessages id=\"messagearea\" showDetail=\"false\"/>\n        <apex:pageblockSection id=\"conditionSection\" title=\"\u691c\u7d22\" columns=\"1\">\n\t\t    <apex:outputpanel id=\"searchcondition\">\n                <table id=\"conditionTable\">\n                    <tr>\n\t\t               \t<td class=\"label\"><apex:outputLabel value=\"\u30b9\u30c6\u30fc\u30bf\u30b9\" for=\"scStatus\" styleClass=\"labelCol\" /></td>\n                        <td><apex:inputField id=\"scStatus\" value=\"{!condition.obj.SearchConditionStatus__c}\" /></td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\"><apex:outputLabel value=\"\u6700\u7d42\u66f4\u65b0\u65e5\"  styleClass=\"labelCol\" /></td>\n                        <td>\n                            <apex:inputField id=\"scLastModifiedFrom\" value=\"{!condition.obj.SearchConditionLastModifiedFrom__c}\" />\n                            <apex:outputLabel value=\" \uff5e\u3000\"  styleClass=\"labelCol\" />\n                            <apex:inputField id=\"scLastModifiedTo\" value=\"{!condition.obj.SearchConditionLastModifiedTo__c}\" />\n                        </td>\n            \t\t</tr>\n                </table>\n    \t\t</apex:outputpanel>\n        </apex:pageblockSection>\n        <apex:pageBlockButtons id=\"buttonSection\" location=\"bottom\" >\n            <apex:commandButton value=\"\u691c\u7d22\" action=\"{!search}\" style=\"font-size:12pt;width:100px;height:30px;\" reRender=\"searchresult,messagearea\"/>\n            <apex:commandButton value=\"\u30af\u30ea\u30a2\" action=\"{!clear}\" style=\"font-size:12pt;width:100px;height:30px;\" reRender=\"searchcondition,searchresult,messagearea\"/>\n        </apex:pageBlockButtons>\n    </apex:pageBlock>\n</apex:form>\n<apex:outputpanel id=\"searchresult\">\n    <apex:pageBlock title=\"\u691c\u7d22\u7d50\u679c\uff1a\" rendered=\"{!(results.size == 0)}\">\n         \u691c\u7d22\u6761\u4ef6\u306b\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\n    </apex:pageBlock>\n    \n    <apex:form id=\"resultForm\">\n        <apex:pageBlock id=\"resultBlock\" title=\"\u51fa\u5f35\u4e00\u89a7\" rendered=\"{!(results.size > 0)}\">\n            <apex:outputtext style=\"width:110px\" value=\"\u7d50\u679c : {!results.size}\u4ef6\"/>\n            <apex:pageblockTable id=\"resultTable\" value=\"{!results}\" var=\"o\" frame=\"box\">\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7533\u8acb\u756a\u53f7{!IF(sortKey == 'Name', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Name\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet>\n                    <apex:outputlink value=\"/{!o.Id}\"><apex:outputField style=\"width:80px\" value=\"{!o.Name}\"/></apex:outputlink>\n                </apex:column>\n                <apex:column style=\"width:160px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7533\u8acb\u540d{!IF(sortKey == 'TravelRequestName__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelRequestName__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.TravelRequestName__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u30b9\u30c6\u30fc\u30bf\u30b9{!IF(sortKey == 'Status__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Status__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet>\n                    <apex:outputField style=\"width:150px\" value=\"{!o.Status__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u958b\u59cb\u65e5{!IF(sortKey == 'TravelStartDate__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelStartDate__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.TravelStartDate__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u7d42\u4e86\u65e5{!IF(sortKey == 'TravelEndDate__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"TravelEndDate__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.TravelEndDate__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:120px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u51fa\u5f35\u76ee\u7684{!IF(sortKey == 'Purpose_of_Travel__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Purpose_of_Travel__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.Purpose_of_Travel__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:120px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u7dcf\u8cbb\u7528{!IF(sortKey == 'Total__c', sortOrder, '\u3000')}\">\n                            <apex:param value=\"Total__c\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:150px\" value=\"{!o.Total__c}\"/>\n                </apex:column>\n                <apex:column style=\"width:80px\">\n                    <apex:facet name=\"header\">\n                        <apex:commandLink action=\"{!sort}\" value=\"\u6700\u7d42\u66f4\u65b0\u65e5\u6642{!IF(sortKey == 'LastModifiedDate', sortOrder, '\u3000')}\">\n                            <apex:param value=\"LastModifiedDate\" name=\"String\" assignTo=\"{!sortingField}\" />\n                    \t</apex:commandLink>\n                    </apex:facet> \n                    <apex:outputField style=\"width:80px\" value=\"{!o.LastModifiedDate}\"/>\n                </apex:column>\n            </apex:pageblockTable>\n        </apex:pageBlock>\n    </apex:form>\n</apex:outputpanel>\n</apex:page>\n```\n\n### Visualforce\u30bf\u30d6\n\n\u4e0a\u8a18\u306eVisualforce\u30da\u30fc\u30b8\u3092\u958b\u304f\u30bf\u30d6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n### Apex\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u30c6\u30b9\u30c8\n\n\u7c21\u5358\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u30c6\u30b9\u30c8\u3082\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\u30ab\u30d0\u30ec\u30c3\u30b8\u306f88%\u3067\u3059\u3002\n\n\u4f59\u8ac7\u3067\u3059\u304c\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u767b\u9332\u3057\u305f\u3053\u3068\u306b\u9023\u52d5\u3057\u3066\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u66f4\u65b0\u3055\u308c\u308b\u3068\u3044\u3046\u9805\u76ee\u81ea\u52d5\u66f4\u65b0\u304c\u4ed5\u8fbc\u307e\u308c\u3066\u3044\u305f\u305f\u3081\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3088\u308b\u7d5e\u308a\u8fbc\u307f\u306e\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3067\u306f\u6b63\u3057\u304f\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u306b\u30fb\u30fb\u3068\u5c11\u3057\u30cf\u30de\u308a\u307e\u3057\u305f\u304c\u30011\u30641\u3064\u30ed\u30b0\u3092\u8ffd\u3063\u3066\u3044\u304f\u3068\u30c6\u30b9\u30c8\u6642\u306b\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3082\u5b9f\u884c\u3055\u308c\u308b\u3093\u3060\u3068\u3044\u3046\u3053\u3068\u304c\u3088\u304f\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\n```TravelRequestListControllerTest.apex\n@isTest\npublic class TravelRequestListControllerTest {\n\n    /**\n     * \u691c\u7d22\u6761\u4ef6\u306a\u3057\u3067\u691c\u7d22\n     */ \n    @isTest\n    static void noKeywordSearch(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n        \n        Test.startTest();\n        sut.init();\n        sut.search();\n        Test.stopTest();\n        \n        System.assert(sut.results.size() == 3);\n    }\n    \n    /**\n     * \u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u6307\u5b9a\u3057\u305f\u691c\u7d22\u306e\u5b9f\u65bd\n     */ \n    @isTest\n    static void statusSearch(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n        \n        Test.startTest();\n        sut.init();\n        sut.condition.obj.SearchConditionStatus__c = '\u627f\u8a8d\u5b8c\u4e86';\n        sut.search();\n        Test.stopTest();\n        \n        System.debug(sut.results.size());\n        System.debug(sut.results);\n        System.assert(sut.results.size() == 1);\n    }\n    \n    /**\n     * \u30bd\u30fc\u30c8\u30ad\u30fc\u5909\u66f4\u3001\u30bd\u30fc\u30c8\u9806\u5909\u66f4\u306a\u3069\n     */ \n    @isTest\n    static void lastModifiedDateSearchWithSorting(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n        \n        Test.startTest();\n        sut.init();\n        sut.condition.obj.SearchConditionLastModifiedFrom__c = Date.today();\n        sut.condition.obj.SearchConditionLastModifiedTo__c = Date.today();\n        sut.search();\n        \n        // \u51fa\u5f35\u7533\u8acb\u540d\u306e\u964d\u9806\u30bd\u30fc\u30c8\n        sut.sortingField = 'TravelRequestName__c'; \n        sut.sort();                    \n        Travel_Request__c actual1 = sut.results.get(0);\n        System.assert(actual1.TravelRequestName__c == '\u51fa\u5f353');\n\n        // \u6607\u9806\u30bd\u30fc\u30c8\u306b\u5909\u66f4\n        sut.sort();\n        Travel_Request__c actual2 = sut.results.get(0);\n        System.assert(actual2.TravelRequestName__c == '\u51fa\u5f351');\n        System.assert(sut.getSortKey() == 'TravelRequestName__c');\n        System.assert(sut.getSortOrder() == '\u25b2');\n\n        Test.stopTest();\n    }\n    \n    /**\n     * \u30af\u30ea\u30a2\u30dc\u30bf\u30f3\u51e6\u7406\n     */ \n    @isTest\n    static void clear(){\n        createRecords();\n        TravelRequestListController sut = new TravelRequestListController();\n        \n        Test.startTest();\n        sut.init();\n        sut.search();\n        System.assert(sut.results.size() > 0);\n        sut.clear();\n        Test.stopTest();\n        \n        System.assert(sut.results.size() == 0);\n    }\n    \n    \n    /**\n     * \u30c6\u30b9\u30c8\u7528\u306b3\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210\u3059\u308b\n     */ \n    private static void createRecords(){\n        List<Travel_Request__c> records = new Travel_Request__c[]{\n              createRecord(1, '\u7533\u8acb\u4e2d')\n            , createRecord(2, '\u627f\u8a8d\u5b8c\u4e86')\n            , createRecord(3, '\u5374\u4e0b')\n        };\n        insert records;\n    }\n    \n    private static Travel_Request__c createRecord(Integer index, String status){\n        Travel_Request__c tr = new Travel_Request__c();\n\ttr.TravelRequestName__c = '\u51fa\u5f35' + String.valueOf(index);\n        tr.Status__c = status;\n        tr.TravelStartDate__c = Date.newInstance(2017, 1, 1).addDays(index);\n        tr.TravelEndDate__c = Date.newInstance(2017, 1, 4).addDays(index);\n        tr.Airfare__c = 1000;\n        return tr;\n    }\n    \n}\n```\n\n## \u611f\u60f3\n\n* \u601d\u3063\u305f\u4ee5\u4e0a\u306b\u30b7\u30f3\u30d7\u30eb\u306b\u4e00\u89a7\u753b\u9762\u304c\u5b9f\u73fe\u3067\u304d\u305f\u3002\u3053\u308c\u306a\u3089\u30c6\u30f3\u30d7\u30ec\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u305d\u3046\u3002\n* \u958b\u767a\u8005\u30b3\u30f3\u30bd\u30fc\u30eb\u306f\u3064\u3089\u304b\u3063\u305f\u3002\u88dc\u5b8c\u3084\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u306a\u3069\u672c\u5f53\u306b\u3084\u308a\u306b\u304f\u3044\u3002\n* Visualforce\u304b\u3089\u5f15\u6570\u3042\u308a\u3067\u30e1\u30bd\u30c3\u30c9\u547c\u3079\u306a\u3044\u306e\u306f\u6b8b\u5ff5\u3002param\u306eassignTo\u306a\u3069\u6982\u5ff5\u306e\u7406\u89e3\u304c\u96e3\u3057\u3044\n* \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306estartTest/stopTest\u3068assert\u3092\u3069\u3046\u3044\u3046\u9806\u306b\u66f8\u304f\u3079\u304d\u306a\u306e\u304b\u304c\u308f\u304b\u3089\u306a\u3044\n* \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3067\u5171\u901a\u306esetup\u30e1\u30bd\u30c3\u30c9\u304c\u307b\u3057\u3044\u3002\u3042\u308b\u30fb\u30fb\uff1f\n\n", "tags": ["Salesforce", "Visualforce", "Apex"]}