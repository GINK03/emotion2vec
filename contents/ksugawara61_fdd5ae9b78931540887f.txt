{"context": "\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u69cb\u6210\u56f3\u306e\u3088\u3046\u306bMySQL\u3067Master-Slave\u69cb\u6210\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306e\u3084\u308a\u65b9\u3092\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n\u74b0\u5883\n\n\n\nOS/\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\n\nCentOS\n7.1\n\n\nMySQL\n5.7.12\n\n\n\n\n\n\n\u30db\u30b9\u30c8\u540d\nIP\u30a2\u30c9\u30ec\u30b9\n\u5f79\u5272\n\n\n\n\nweb001\n192.168.33.10\nMaster DB\u30b5\u30fc\u30d0\n\n\nweb002\n192.168.33.20\nSlave DB\u30b5\u30fc\u30d0\n\n\n\n\nMaster DB\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\n\n1. conf\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\n\u307e\u305a\u3001mysql\u3067\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u51e6\u7406\u304c\u884c\u3048\u308b\u3088\u3046\u306bMaster DB\u30b5\u30fc\u30d0\u306eMySQL\u306econf\u30d5\u30a1\u30a4\u30eb\u306b\u30b5\u30fc\u30d0ID\u3068\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u53d6\u5f97\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306b\u3064\u3044\u3066\u306f\u3001MySQL\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3084\u3053\u306e\u3042\u305f\u308a\u306e\u30a6\u30a7\u30d6\u30da\u30fc\u30b8\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\n\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nmy.cnf\u306e\u7de8\u96c6\n\n$ sudo vi /etc/my.cnf\n\n\nmy.cnf\u306b\u30b5\u30fc\u30d0ID\u3068\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u53d6\u5f97\u8a2d\u5b9a\u3092\u8ffd\u8a18\n\n\nmy.cnf(MasterDB)\n[mysqld]\n\u30fb\n\u30fb\n\u30fb\nlog-bin\nserver-id=101\n\n\n\n\u8a2d\u5b9a\u5185\u5bb9\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bMySQL\u3092\u518d\u8d77\u52d5\n\n$ sudo systemctl restart mysqld.service\n\n\n2. \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306eDB\u3092\u4f5c\u6210\n\u7d9a\u3044\u3066\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046DB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nMySQL\u306b\u30ed\u30b0\u30a4\u30f3\n\n$ mysql -u root -p  # \u4ee5\u5f8cDB\u306e\u30ed\u30b0\u30a4\u30f3\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\nEnter password: \n\n\nexample DB\u3092\u4f5c\u6210\n\nmysql> create database example;\n\n\n3. Slave\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\n\u6b21\u306b\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046\u305f\u3081\u306eSlave\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nmysql> create user 'repl'@'192.168.33.20' identified by 'Slave-passw0rd';\nmysql> grant replication slave on *.* to 'repl'@'192.168.33.20';\n\n\n4. example DB\u3092dump\nMaster DB\u30b5\u30fc\u30d0\u306eexample DB\u306e\u5185\u5bb9\u3092Slave DB\u30b5\u30fc\u30d0\u306b\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081 example DB\u3092dump\u3057\u307e\u3059\u3002\n\ndump\u4e2d\u306bDB\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u8fbc\u307f\u3092\u30ed\u30c3\u30af\n\nmysql> flush tables with read lock;\n\n\n\u73fe\u5728\u306e\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\nmysql> show master status;\n*************************** 1. row ***************************\n             File: web001-bin.000001\n         Position: 619\n     Binlog_Do_DB: \n Binlog_Ignore_DB: \nExecuted_Gtid_Set: \n1 row in set (0.01 sec)\n\n\n\u203b\u88dc\u8db3\n\u4e0a\u8a18\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u306b\u306a\u3063\u305f\u5834\u5408\u3001File\u306f\u7a7a\u767d\u6587\u5b57\u5217 '' \u3001Position\u306f4\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nmysql> show master status;\nEmpty set (0.00 sec)\n\n\nexample DB\u3092dump\n\n$ mysqldump --single-transaction -u root -p example > example.dump\nEnter password: \n$ scp example.dump 192.168.33.20:~  # scp\u3067slave DB\u30b5\u30fc\u30d0\u306b dump\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\nexample.dump                                                                                                                                           100% 1252     1.2KB/s   00:00    \n\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3059\u308b\n\nmysql> unlock tables;\n\n\n\u4ee5\u4e0a\u3067\u3001Master DB\u30b5\u30fc\u30d0\u306e\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nSlave DB\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\n\n1. conf\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\nMaster DB\u3068\u540c\u69d8\u306bSlave DB\u30b5\u30fc\u30d0\u306eMySQL\u306econf\u30d5\u30a1\u30a4\u30eb\u306b\u3082\u30b5\u30fc\u30d0ID\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001Master DB\u30b5\u30fc\u30d0\u306e\u30b5\u30fc\u30d0ID\u3068\u91cd\u8907\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nmy.cnf\u306e\u7de8\u96c6\n\n$ sudo vi /etc/my.cnf\n\n\nmy.cnf\u306b\u30b5\u30fc\u30d0ID\u3092\u8ffd\u8a18\n\n\nmy.cnf(SlaveDB)\n[mysqld]\n\u30fb\n\u30fb\n\u30fb\nserver-id=102\n\n\n\n\u8a2d\u5b9a\u5185\u5bb9\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bMySQL\u3092\u518d\u8d77\u52d5\n\n$ sudo systemctl restart mysqld.service\n\n\n2. dump\u30c7\u30fc\u30bf\u3092\u30b3\u30d4\u30fc\n\u7d9a\u3044\u3066\u3001Master DB\u30b5\u30fc\u30d0\u304b\u3089dump\u3057\u305fexample DB\u306e\u5185\u5bb9\u3092 Slave DB\u30b5\u30fc\u30d0\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nmysql> create database example;\nmysql> use example;\nmysql> source ~/example.dump;  # dump\u30c7\u30fc\u30bf\u3092\u30b3\u30d4\u30fc\n\n\n3. Slave DB\u306e\u8a2d\u5b9a\n\nSlave DB\u3067 Master DB\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\n\nmysql> change master to\n    -> master_host='192.168.33.10',          # Master DB\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d/IP\u30a2\u30c9\u30ec\u30b9\n    -> master_user='repl',                   # Master DB\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\n    -> master_password='Slave-passw0rd',     # \u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n    -> master_log_file='web001-bin.000001',  # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\n    -> master_log_pos=619;                   # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u73fe\u5728\u4f4d\u7f6e\n\n\u203b\u88dc\u8db3\nshow master status \u3067 Empty set \u304c\u51fa\u529b\u3055\u308c\u305f\u5834\u5408\u4ee5\u4e0b\u3092\u5165\u529b\nmysql> change master to\n    -> master_host='192.168.33.10',          # Master DB\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d/IP\u30a2\u30c9\u30ec\u30b9\n    -> master_user='repl',                   # Master DB\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\n    -> master_password='Slave-passw0rd',     # \u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n    -> master_log_file='',  # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\n    -> master_log_pos=4;                   # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u73fe\u5728\u4f4d\u7f6e\n\n\nexample DB\u3092\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5bfe\u8c61\u306eDB\u3068\u3057\u3066\u8a2d\u5b9a\n\nmysql> change replication filter replicate_do_db = (example);\n\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3059\u308b\n\nmysql> start slave;\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Slave DB\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3053\u306e\u3068\u304d\u306b\u7279\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u554f\u984c\u306a\u304f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\nmysql> show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 192.168.33.10\n                  Master_User: repl\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: web001-bin.000001\n          Read_Master_Log_Pos: 619\n               Relay_Log_File: web002-relay-bin.000003\n                Relay_Log_Pos: 321\n        Relay_Master_Log_File: web001-bin.000001\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: example\n          Replicate_Ignore_DB: \n           Replicate_Do_Table: \n       Replicate_Ignore_Table: \n      Replicate_Wild_Do_Table: \n  Replicate_Wild_Ignore_Table: \n                   Last_Errno: 0\n                   Last_Error: \n                 Skip_Counter: 0\n          Exec_Master_Log_Pos: 619\n              Relay_Log_Space: 696\n              Until_Condition: None\n               Until_Log_File: \n                Until_Log_Pos: 0\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File: \n           Master_SSL_CA_Path: \n              Master_SSL_Cert: \n            Master_SSL_Cipher: \n               Master_SSL_Key: \n        Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: 0\n                Last_IO_Error: \n               Last_SQL_Errno: 0\n               Last_SQL_Error: \n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: 101\n                  Master_UUID: 7ac6cdf0-07cb-11e6-9e7e-08002751d15e\n             Master_Info_File: /var/lib/mysql/master.info\n                    SQL_Delay: 0\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates\n           Master_Retry_Count: 86400\n                  Master_Bind: \n      Last_IO_Error_Timestamp: \n     Last_SQL_Error_Timestamp: \n               Master_SSL_Crl: \n           Master_SSL_Crlpath: \n           Retrieved_Gtid_Set: \n            Executed_Gtid_Set: \n                Auto_Position: 0\n         Replicate_Rewrite_DB: \n                 Channel_Name: \n           Master_TLS_Version: \n\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u6700\u5f8c\u306b\u3001Master DB\u30b5\u30fc\u30d0\u306eexample DB\u306bhoge\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306b\u6b63\u5e38\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u3001Slave DB\u30b5\u30fc\u30d0\u306eexample DB\u306b hoge\u30c6\u30fc\u30d6\u30eb\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\nSlaveDB\nmysql> use example;\nmysql> show tables;\nEmpty set (0.00 sec)\n\n\n\n\u7d9a\u3044\u3066Master DB \u30b5\u30fc\u30d0\u306eexample DB\u306bhoge\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\nMasterDB\nmysql> use example;\nmysql> create table hoge ( id INT not null );  # hoge\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\nmysql> show tables;\n+-------------------+\n| Tables_in_example |\n+-------------------+\n| hoge              |\n+-------------------+\n\n\n\u30fb\u518d\u3073Slave DB \u30b5\u30fc\u30d0\u306eexample DB\u3092\u78ba\u8a8d\u3057\u3001hoge\u30c6\u30fc\u30d6\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u6b63\u5e38\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\nSlaveDB\nmysql> show tables;\n+-------------------+\n| Tables_in_example |\n+-------------------+\n| hoge              |\n+-------------------+\n\n\n\u4ee5\u4e0a\u3067\u3001MySQL\u3067\u306eMaster-Slave\u69cb\u6210\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\u53c2\u8003\u6587\u732e\n\n\u305f\u3063\u305f30\u5206\u3067WordPress\u3092\u5197\u9577\u5316\u3059\u308b\u65b9\u6cd5 _ (\u3063\u00b4\u2200\uff40)\u3063 \u3083\u30fc _ nullpopopo,  http://nullpopopo.blogcube.info/2012/08/%E3%81%9F%E3%81%A3%E3%81%9F30%E5%88%86%E3%81%A7wordpress%E3%82%92%E5%86%97%E9%95%B7%E5%8C%96%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95.html, Online; accessed 23-Apirl-2016.\nMySQL \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a - \u3068\u307f\u305e\u30fc\u30ce\u30fc\u30c8, http://wiki.bit-hive.com/tomizoo/pg/MySQL%20%A5%EC%A5%D7%A5%EA%A5%B1%A1%BC%A5%B7%A5%E7%A5%F3%A4%CE%C0%DF%C4%EA, Online; accessed 23-Apirl-2016.\nmysql\u3067\u30de\u30eb\u30c1\u30de\u30b9\u30bf\u30fc \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u308b\u00a0_\u00a0\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u30fb\u81ea\u5b85\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u30fb\u69cb\u7bc9\u306e\u30d2\u30f3\u30c8, http://server-setting.info/centos/mysql-multi-master.html, Online; accessed 23-Apirl-2016.\nMySQL __ MySQL 5.6 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u30de\u30cb\u30e5\u30a2\u30eb __ 5.2.4 \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0, https://dev.mysql.com/doc/refman/5.6/ja/binary-log.html, Online; accessed 23-April-2016.\nMySQL\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u4ed5\u69d8 _ OpenGroove, http://open-groove.net/mysql/mysql-binlog/, 23-Apirl-2016.\nMySQL 5.7 _ \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u5909\u66f4\u3059\u308b _ Yakst, https://yakst.com/ja/posts/3486, 23-April-2016.\nMySQL\u5165\u9580\u3000\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7de8 - Qiita, http://qiita.com/Tocyuki/items/c224cef57493f536a941, 23-April-2016.\n\n\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u69cb\u6210\u56f3\u306e\u3088\u3046\u306bMySQL\u3067Master-Slave\u69cb\u6210\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306e\u3084\u308a\u65b9\u3092\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n![Master-Slave\u69cb\u6210\u56f3.png](https://qiita-image-store.s3.amazonaws.com/0/69983/2d3aed13-eb45-0acf-c6c5-045f94468101.png)\n\n# \u74b0\u5883\n|OS/\u30df\u30c9\u30eb\u30a6\u30a7\u30a2|\u30d0\u30fc\u30b8\u30e7\u30f3     |\n|:------------|------------:|\n| CentOS      |7.1          |\n| MySQL       |5.7.12       |\n\n|\u30db\u30b9\u30c8\u540d|IP\u30a2\u30c9\u30ec\u30b9|\u5f79\u5272|\n|:------|:--------|:---|\n|web001|192.168.33.10|Master DB\u30b5\u30fc\u30d0|\n|web002|192.168.33.20|Slave DB\u30b5\u30fc\u30d0|\n\n# Master DB\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\n\n## 1. conf\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\n\n\u307e\u305a\u3001mysql\u3067\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u51e6\u7406\u304c\u884c\u3048\u308b\u3088\u3046\u306bMaster DB\u30b5\u30fc\u30d0\u306eMySQL\u306econf\u30d5\u30a1\u30a4\u30eb\u306b**\u30b5\u30fc\u30d0ID**\u3068**\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u53d6\u5f97\u8a2d\u5b9a**\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306b\u3064\u3044\u3066\u306f\u3001[MySQL\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](https://dev.mysql.com/doc/refman/5.6/ja/binary-log.html)\u3084[\u3053\u306e\u3042\u305f\u308a\u306e\u30a6\u30a7\u30d6\u30da\u30fc\u30b8](http://open-groove.net/mysql/mysql-binlog/)\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\n\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n* my.cnf\u306e\u7de8\u96c6\n\n```bash\n$ sudo vi /etc/my.cnf\n```\n\n* my.cnf\u306b**\u30b5\u30fc\u30d0ID**\u3068**\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u53d6\u5f97\u8a2d\u5b9a**\u3092\u8ffd\u8a18\n\n```conf:my.cnf(MasterDB)\n[mysqld]\n\u30fb\n\u30fb\n\u30fb\nlog-bin\nserver-id=101\n```\n\n* \u8a2d\u5b9a\u5185\u5bb9\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bMySQL\u3092\u518d\u8d77\u52d5\n\n```bash\n$ sudo systemctl restart mysqld.service\n```\n\n## 2. \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306eDB\u3092\u4f5c\u6210\n\n\u7d9a\u3044\u3066\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046DB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n* MySQL\u306b\u30ed\u30b0\u30a4\u30f3\n\n```bash\n$ mysql -u root -p  # \u4ee5\u5f8cDB\u306e\u30ed\u30b0\u30a4\u30f3\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\nEnter password: \n```\n* example DB\u3092\u4f5c\u6210\n\n```mysql\nmysql> create database example;\n```\n\n## 3. Slave\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\n\n\u6b21\u306b\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046\u305f\u3081\u306eSlave\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```mysql\nmysql> create user 'repl'@'192.168.33.20' identified by 'Slave-passw0rd';\nmysql> grant replication slave on *.* to 'repl'@'192.168.33.20';\n```\n\n## 4. example DB\u3092dump\n\nMaster DB\u30b5\u30fc\u30d0\u306eexample DB\u306e\u5185\u5bb9\u3092Slave DB\u30b5\u30fc\u30d0\u306b\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081 example DB\u3092dump\u3057\u307e\u3059\u3002\n\n* dump\u4e2d\u306bDB\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u306e\u66f8\u304d\u8fbc\u307f\u3092\u30ed\u30c3\u30af\n\n```mysql\nmysql> flush tables with read lock;\n```\n\n* \u73fe\u5728\u306e\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```mysql\nmysql> show master status;\n*************************** 1. row ***************************\n             File: web001-bin.000001\n         Position: 619\n     Binlog_Do_DB: \n Binlog_Ignore_DB: \nExecuted_Gtid_Set: \n1 row in set (0.01 sec)\n\n```\n\n**\u203b\u88dc\u8db3**\n\u4e0a\u8a18\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u306b\u306a\u3063\u305f\u5834\u5408\u3001File\u306f\u7a7a\u767d\u6587\u5b57\u5217 '' \u3001Position\u306f4\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```mysql\nmysql> show master status;\nEmpty set (0.00 sec)\n```\n\n* example DB\u3092dump\n\n```bash\n$ mysqldump --single-transaction -u root -p example > example.dump\nEnter password: \n$ scp example.dump 192.168.33.20:~  # scp\u3067slave DB\u30b5\u30fc\u30d0\u306b dump\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\nexample.dump                                                                                                                                           100% 1252     1.2KB/s   00:00    \n```\n\n* \u30c6\u30fc\u30d6\u30eb\u306e\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3059\u308b\n\n```bash\nmysql> unlock tables;\n\n```\n\n\u4ee5\u4e0a\u3067\u3001Master DB\u30b5\u30fc\u30d0\u306e\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\n# Slave DB\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\n\n## 1. conf\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\n\nMaster DB\u3068\u540c\u69d8\u306bSlave DB\u30b5\u30fc\u30d0\u306eMySQL\u306econf\u30d5\u30a1\u30a4\u30eb\u306b\u3082**\u30b5\u30fc\u30d0ID**\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001Master DB\u30b5\u30fc\u30d0\u306e\u30b5\u30fc\u30d0ID\u3068\u91cd\u8907\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n* my.cnf\u306e\u7de8\u96c6\n\n```bash\n$ sudo vi /etc/my.cnf\n```\n\n* my.cnf\u306b**\u30b5\u30fc\u30d0ID**\u3092\u8ffd\u8a18\n\n```conf:my.cnf(SlaveDB)\n[mysqld]\n\u30fb\n\u30fb\n\u30fb\nserver-id=102\n```\n\n* \u8a2d\u5b9a\u5185\u5bb9\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bMySQL\u3092\u518d\u8d77\u52d5\n\n```bash\n$ sudo systemctl restart mysqld.service\n```\n\n## 2. dump\u30c7\u30fc\u30bf\u3092\u30b3\u30d4\u30fc\n\n\u7d9a\u3044\u3066\u3001Master DB\u30b5\u30fc\u30d0\u304b\u3089dump\u3057\u305fexample DB\u306e\u5185\u5bb9\u3092 Slave DB\u30b5\u30fc\u30d0\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```mysql\nmysql> create database example;\nmysql> use example;\nmysql> source ~/example.dump;  # dump\u30c7\u30fc\u30bf\u3092\u30b3\u30d4\u30fc\n```\n\n## 3. Slave DB\u306e\u8a2d\u5b9a\n\n* Slave DB\u3067 Master DB\u3078\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\n\n```mysql\nmysql> change master to\n    -> master_host='192.168.33.10',          # Master DB\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d/IP\u30a2\u30c9\u30ec\u30b9\n    -> master_user='repl',                   # Master DB\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\n    -> master_password='Slave-passw0rd',     # \u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n    -> master_log_file='web001-bin.000001',  # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\n    -> master_log_pos=619;                   # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u73fe\u5728\u4f4d\u7f6e\n```\n\n**\u203b\u88dc\u8db3**\nshow master status \u3067 Empty set \u304c\u51fa\u529b\u3055\u308c\u305f\u5834\u5408\u4ee5\u4e0b\u3092\u5165\u529b\n\n```mysql\nmysql> change master to\n    -> master_host='192.168.33.10',          # Master DB\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d/IP\u30a2\u30c9\u30ec\u30b9\n    -> master_user='repl',                   # Master DB\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\n    -> master_password='Slave-passw0rd',     # \u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u540d\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n    -> master_log_file='',  # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u540d\n    -> master_log_pos=4;                   # \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u73fe\u5728\u4f4d\u7f6e\n```\n\n\n* example DB\u3092\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5bfe\u8c61\u306eDB\u3068\u3057\u3066\u8a2d\u5b9a\n\n```mysql\nmysql> change replication filter replicate_do_db = (example);\n```\n\n* \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3059\u308b\n\n```mysql\nmysql> start slave;\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Slave DB\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3053\u306e\u3068\u304d\u306b\u7279\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u554f\u984c\u306a\u304f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\n```mysql\nmysql> show slave status\\G\n*************************** 1. row ***************************\n               Slave_IO_State: Waiting for master to send event\n                  Master_Host: 192.168.33.10\n                  Master_User: repl\n                  Master_Port: 3306\n                Connect_Retry: 60\n              Master_Log_File: web001-bin.000001\n          Read_Master_Log_Pos: 619\n               Relay_Log_File: web002-relay-bin.000003\n                Relay_Log_Pos: 321\n        Relay_Master_Log_File: web001-bin.000001\n             Slave_IO_Running: Yes\n            Slave_SQL_Running: Yes\n              Replicate_Do_DB: example\n          Replicate_Ignore_DB: \n           Replicate_Do_Table: \n       Replicate_Ignore_Table: \n      Replicate_Wild_Do_Table: \n  Replicate_Wild_Ignore_Table: \n                   Last_Errno: 0\n                   Last_Error: \n                 Skip_Counter: 0\n          Exec_Master_Log_Pos: 619\n              Relay_Log_Space: 696\n              Until_Condition: None\n               Until_Log_File: \n                Until_Log_Pos: 0\n           Master_SSL_Allowed: No\n           Master_SSL_CA_File: \n           Master_SSL_CA_Path: \n              Master_SSL_Cert: \n            Master_SSL_Cipher: \n               Master_SSL_Key: \n        Seconds_Behind_Master: 0\nMaster_SSL_Verify_Server_Cert: No\n                Last_IO_Errno: 0\n                Last_IO_Error: \n               Last_SQL_Errno: 0\n               Last_SQL_Error: \n  Replicate_Ignore_Server_Ids: \n             Master_Server_Id: 101\n                  Master_UUID: 7ac6cdf0-07cb-11e6-9e7e-08002751d15e\n             Master_Info_File: /var/lib/mysql/master.info\n                    SQL_Delay: 0\n          SQL_Remaining_Delay: NULL\n      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates\n           Master_Retry_Count: 86400\n                  Master_Bind: \n      Last_IO_Error_Timestamp: \n     Last_SQL_Error_Timestamp: \n               Master_SSL_Crl: \n           Master_SSL_Crlpath: \n           Retrieved_Gtid_Set: \n            Executed_Gtid_Set: \n                Auto_Position: 0\n         Replicate_Rewrite_DB: \n                 Channel_Name: \n           Master_TLS_Version: \n```\n\n# \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u6700\u5f8c\u306b\u3001Master DB\u30b5\u30fc\u30d0\u306eexample DB\u306b**hoge\u30c6\u30fc\u30d6\u30eb**\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306b\u6b63\u5e38\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n* \u307e\u305a\u3001Slave DB\u30b5\u30fc\u30d0\u306eexample DB\u306b hoge\u30c6\u30fc\u30d6\u30eb\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```mysql:SlaveDB\nmysql> use example;\nmysql> show tables;\nEmpty set (0.00 sec)\n```\n\n* \u7d9a\u3044\u3066Master DB \u30b5\u30fc\u30d0\u306eexample DB\u306bhoge\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```mysql:MasterDB\nmysql> use example;\nmysql> create table hoge ( id INT not null );  # hoge\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\nmysql> show tables;\n+-------------------+\n| Tables_in_example |\n+-------------------+\n| hoge              |\n+-------------------+\n```\n\n\u30fb\u518d\u3073Slave DB \u30b5\u30fc\u30d0\u306eexample DB\u3092\u78ba\u8a8d\u3057\u3001hoge\u30c6\u30fc\u30d6\u30eb\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u6b63\u5e38\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\n```mysql:SlaveDB\nmysql> show tables;\n+-------------------+\n| Tables_in_example |\n+-------------------+\n| hoge              |\n+-------------------+\n```\n\n\u4ee5\u4e0a\u3067\u3001MySQL\u3067\u306eMaster-Slave\u69cb\u6210\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n# \u53c2\u8003\u6587\u732e\n1. \u305f\u3063\u305f30\u5206\u3067WordPress\u3092\u5197\u9577\u5316\u3059\u308b\u65b9\u6cd5 _ (\u3063\u00b4\u2200\uff40)\u3063 \u3083\u30fc _ nullpopopo,  http://nullpopopo.blogcube.info/2012/08/%E3%81%9F%E3%81%A3%E3%81%9F30%E5%88%86%E3%81%A7wordpress%E3%82%92%E5%86%97%E9%95%B7%E5%8C%96%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95.html, Online; accessed 23-Apirl-2016.\n2. MySQL \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a - \u3068\u307f\u305e\u30fc\u30ce\u30fc\u30c8, http://wiki.bit-hive.com/tomizoo/pg/MySQL%20%A5%EC%A5%D7%A5%EA%A5%B1%A1%BC%A5%B7%A5%E7%A5%F3%A4%CE%C0%DF%C4%EA, Online; accessed 23-Apirl-2016.\n3. mysql\u3067\u30de\u30eb\u30c1\u30de\u30b9\u30bf\u30fc \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u308b\u00a0_\u00a0\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u30fb\u81ea\u5b85\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u30fb\u69cb\u7bc9\u306e\u30d2\u30f3\u30c8, http://server-setting.info/centos/mysql-multi-master.html, Online; accessed 23-Apirl-2016.\n4. MySQL __ MySQL 5.6 \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u30de\u30cb\u30e5\u30a2\u30eb __ 5.2.4 \u30d0\u30a4\u30ca\u30ea\u30ed\u30b0, https://dev.mysql.com/doc/refman/5.6/ja/binary-log.html, Online; accessed 23-April-2016.\n5. MySQL\u30d0\u30a4\u30ca\u30ea\u30ed\u30b0\u306e\u4ed5\u69d8 _ OpenGroove, http://open-groove.net/mysql/mysql-binlog/, 23-Apirl-2016.\n6. MySQL 5.7 _ \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u5909\u66f4\u3059\u308b _ Yakst, https://yakst.com/ja/posts/3486, 23-April-2016.\n7. MySQL\u5165\u9580\u3000\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7de8 - Qiita, http://qiita.com/Tocyuki/items/c224cef57493f536a941, 23-April-2016.\n", "tags": ["mysql5.7", "MySQL", "\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3"]}