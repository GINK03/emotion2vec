{"context": " More than 1 year has passed since last update.PHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\nhttps://phpunit.de/manual/current/ja/database.html\n\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3001YAML\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u4f7f\u3063\u305f\u30c6\u30b9\u30c8\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b MySQL \u3092\u4f7f\u3046\u3002\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\uff1a\ntakatama/php-dbunit-yaml\nhttps://github.com/takatama/php-dbunit-yaml\nMac OS X \u3092\u4f7f\u3063\u3066\u958b\u767a\u3059\u308b\u3002\n$ sw_vers -productVersion \n10.10.2\n\n\nMySQL \u306e\u6e96\u5099\n\nMySQL \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nMac \u3078 MySQL \u3092 Homebrew \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806 - Qiita\nhttp://qiita.com/hkusu/items/cda3e8461e7a46ecf25d\n\n\u30e6\u30fc\u30b6\u30fc\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f5c\u308b\n\u30e6\u30fc\u30b6\u30fc user@localhost \u3092\u3001\u30d1\u30b9\u30ef\u30fc\u30c9 passwd \u3067\u4f5c\u308b\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 myguestbook \u306b\u3001\u30c6\u30fc\u30d6\u30eb guestbook \u3092\u4f5c\u308b\u3002\n\ncreate_guestbook.sql\ngrant all on myguestbook.* to 'user'@'localhost' identified by 'passwd';\ncreate database if not exists myguestbook;\ncreate table if not exists myguestbook.guestbook (id int auto_increment, content varchar(255), user varchar(255), created timestamp, index(id));\n\n\n$ mysql -u root -p < create_guestbook.sql\n\n\u6b63\u3057\u304f\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n$ mysql -uuser -ppasswd myguestbook\n\nWarning: Using a password on the command line interface can be insecure.\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 25\nServer version: 5.6.23 Homebrew\n\nCopyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> show tables;\n+------------------------------+\n| Tables_in_guestbook_database |\n+------------------------------+\n| guestbook                    |\n+------------------------------+\n1 row in set (0.00 sec)\n\nmysql> desc guestbook;\n+---------+--------------+------+-----+---------+----------------+\n| Field   | Type         | Null | Key | Default | Extra          |\n+---------+--------------+------+-----+---------+----------------+\n| id      | int(11)      | NO   | MUL | NULL    | auto_increment |\n| content | varchar(255) | YES  |     | NULL    |                |\n| user    | varchar(255) | YES  |     | NULL    |                |\n| created | datetime     | YES  |     | NULL    |                |\n+---------+--------------+------+-----+---------+----------------+\n4 rows in set (0.01 sec)\n\n\nPHP \u306e\u6e96\u5099\n\nPHP \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nHomebrew \u3092\u4f7f\u3063\u3066 PHP5.6 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nHomebrew/homebrew-php\nhttps://github.com/Homebrew/homebrew-php\n$ brew tap homebrew/dupes\n$ brew tap homebrew/versions\n$ brew tab homebrew/homebrew-php\n\n\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u304b\u9078\u3076\u3002\n$ brew options php56\n\n\u4eca\u56de\u306f\u7d20\u306e PHP5.6 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ brew install php56\n\n\u6b63\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3059\u308b\u3002\n$ php -v\nPHP 5.6.6 (cli) (built: Feb 26 2015 12:42:39) \nCopyright (c) 1997-2015 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2015 Zend Technologies\n    with Zend OPcache v7.0.4-dev, Copyright (c) 1999-2015, by Zend Technologies\n    with Xdebug v2.3.1, Copyright (c) 2002-2015, by Derick Rethans\n\n\nComposer \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\ncomposer \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n$ brew search composer\ncomposer\n\ncomposer \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$brew install composer\n\n\u6b63\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n$ composer -V\nComposer version 1.0.0-alpha9 2014-12-07 17:15:20\n\n\nPHPUnit, DBUnit \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\ncomposer.json \u306e require-dev (\u958b\u767a\u74b0\u5883\u306b\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8) \u306b phpunit \u3068 dbunit \u3092\u6307\u5b9a\u3059\u308b\u3002\n\ncomposer.json\n\"require-dev\": {\n    \"phpunit/phpunit\": \"4.5.*\",\n    \"phpunit/dbunit\": \">=1.2\"\n}\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ composer update\n\n\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb\u3092\u8aad\u3080\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\nhttps://phpunit.de/manual/current/ja/database.html\n\u4eca\u56de\u306f YAML \u5f62\u5f0f\u3067 Fixute \u3092\u6e96\u5099\u3059\u308b\u3084\u308a\u65b9\u3092\u63a1\u7528\u3059\u308b\u3002\n\nPHPUnit \u306e\u8a2d\u5b9a\u60c5\u5831\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a\u60c5\u5831\u3092\u66f8\u304f\nphpunit.xml \u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306b\u63a5\u7d9a\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u66f8\u304f\u3002PHPUnit \u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u5f15\u6570\u3067\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nphpunit.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<phpunit>\n    <php>\n        <var name=\"DB_DSN\" value=\"mysql:dbname=myguestbook;host=localhost\" />\n        <var name=\"DB_USER\" value=\"user\" />\n        <var name=\"DB_PASSWD\" value=\"passwd\" />\n        <var name=\"DB_DBNAME\" value=\"myguestbook\" />\n    </php>\n</phpunit>\n\n\n\nGeneric_Tests_DatabaseTestCase.php \u3092\u4f5c\u308b\n\nGeneric_Tests_DatabaseTestCase.php\n<?php\nabstract class Generic_Tests_DatabaseTestCase extends PHPUnit_Extensions_Database_TestCase\n{\n    // PDO \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u304a\u3088\u3073\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u8aad\u307f\u8fbc\u307f\u306e\u3068\u304d\u306b\u4e00\u5ea6\u3060\u3051\n    static private $pdo = null;\n\n    // PHPUnit_Extensions_Database_DB_IDatabaseConnection \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u4e00\u5ea6\u3060\u3051\n    private $conn = null;\n\n    /**\n     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection\n     */\n    final public function getConnection()\n    {\n        if ($this->conn === null) {\n            if (self::$pdo == null) {\n                self::$pdo = new PDO( $GLOBALS['DB_DSN'], $GLOBALS['DB_USER'], $GLOBALS['DB_PASSWD'] );\n            }\n            $this->conn = $this->createDefaultDBConnection(self::$pdo, $GLOBALS['DB_DBNAME']);\n        }\n\n        return $this->conn;\n    }\n}\n\n\n\nFixute \u3092\u4f5c\u308b\n\u30c7\u30fc\u30bf\u30922\u3064\u6e96\u5099\u3059\u308b\u3002\n$ mkdir _files\n$ vi guestbook.yml\n\n\nguestbook.yml\nguestbook:\n  -\n    id: 1\n    content: \"Hello buddy!\"\n    user: \"joe\"\n    created: \"2010-04-24 17:15:23\"\n  -\n    id: 2\n    content: \"I like it!\"\n    user:\n    created: \"2010-04-26 12:14:20\"\n\n\n\nYAML \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u4f7f\u3046\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u4f5c\u308b\n2\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nYamlGuestbookTest.php\n<?php\n\nrequire_once dirname(__FILE__).'/Generic_Tests_DatabaseTestCase.php';\n\nclass YamlGuestbookTest extends Generic_Tests_DatabaseTestCase\n{\n    /**\n     * @return PHPUnit_Extensions_Database_DataSet_IDataSet\n     */\n    protected function getDataSet()\n    {\n        return new PHPUnit_Extensions_Database_DataSet_YamlDataSet(\n            dirname(__FILE__).\"/_files/guestbook.yml\"\n        );\n    }\n\n    public function testGetRowCount()\n    {\n        $this->assertEquals(2, $this->getConnection()->getRowCount('guestbook'));\n    }\n}\n\n\n\u5f15\u6570\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3002\n$ vendor/bin/phpunit -c phpunit.xml YamlGuestbookTest.php \nPHPUnit 4.5.0 by Sebastian Bergmann and contributors.\n\nConfiguration read from /Users/takatama/openshift/ranking/phpunit.xml\n\n.\n\nTime: 125 ms, Memory: 4.25Mb\n\nOK (1 test, 1 assertion)\n\n\n\u3088\u304f\u3042\u308b\u9593\u9055\u3044\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b guestbook \u30c6\u30fc\u30d6\u30eb\u304c\u306a\u3044\u306e\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n$ vendor/bin/phpunit -c phpunit.xml YamlGuestbookTest.php \nPHPUnit 4.5.0 by Sebastian Bergmann and contributors.\n\nE\n\nTime: 119 ms, Memory: 3.75Mb\n\nThere was 1 error:\n\n1) YamlGuestbookTest::testGetRowCount\nPHPUnit_Extensions_Database_Operation_Exception: COMPOSITE[TRUNCATE] operation failed on query: \n                DELETE FROM \"guestbook\"\n             using args: Array\n(\n)\n [SQLSTATE[HY000]: General error: 1 no such table: guestbook]\n\nFAILURES!\nTests: 1, Assertions: 0, Errors: 1.\n\n\u53c2\u8003: \ndatabase - Loading schema from SQL file, in PHPUnit test - Stack Overflow\nhttp://stackoverflow.com/questions/10948273/loading-schema-from-sql-file-in-phpunit-test\n\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\nhttps://phpunit.de/manual/current/ja/database.html\n\n\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3001YAML\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u4f7f\u3063\u305f\u30c6\u30b9\u30c8\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b MySQL \u3092\u4f7f\u3046\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\uff1a\n\ntakatama/php-dbunit-yaml\nhttps://github.com/takatama/php-dbunit-yaml\n\nMac OS X \u3092\u4f7f\u3063\u3066\u958b\u767a\u3059\u308b\u3002\n\n```\n$ sw_vers -productVersion \n10.10.2\n```\n\n## MySQL \u306e\u6e96\u5099\n\n### MySQL \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nMac \u3078 MySQL \u3092 Homebrew \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806 - Qiita\nhttp://qiita.com/hkusu/items/cda3e8461e7a46ecf25d\n\n### \u30e6\u30fc\u30b6\u30fc\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f5c\u308b\n\n\u30e6\u30fc\u30b6\u30fc user@localhost \u3092\u3001\u30d1\u30b9\u30ef\u30fc\u30c9 passwd \u3067\u4f5c\u308b\u3002\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 myguestbook \u306b\u3001\u30c6\u30fc\u30d6\u30eb guestbook \u3092\u4f5c\u308b\u3002\n\n```create_guestbook.sql\ngrant all on myguestbook.* to 'user'@'localhost' identified by 'passwd';\ncreate database if not exists myguestbook;\ncreate table if not exists myguestbook.guestbook (id int auto_increment, content varchar(255), user varchar(255), created timestamp, index(id));\n```\n\n```\n$ mysql -u root -p < create_guestbook.sql\n```\n\n\u6b63\u3057\u304f\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ mysql -uuser -ppasswd myguestbook\n\nWarning: Using a password on the command line interface can be insecure.\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 25\nServer version: 5.6.23 Homebrew\n\nCopyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> show tables;\n+------------------------------+\n| Tables_in_guestbook_database |\n+------------------------------+\n| guestbook                    |\n+------------------------------+\n1 row in set (0.00 sec)\n\nmysql> desc guestbook;\n+---------+--------------+------+-----+---------+----------------+\n| Field   | Type         | Null | Key | Default | Extra          |\n+---------+--------------+------+-----+---------+----------------+\n| id      | int(11)      | NO   | MUL | NULL    | auto_increment |\n| content | varchar(255) | YES  |     | NULL    |                |\n| user    | varchar(255) | YES  |     | NULL    |                |\n| created | datetime     | YES  |     | NULL    |                |\n+---------+--------------+------+-----+---------+----------------+\n4 rows in set (0.01 sec)\n```\n\n## PHP \u306e\u6e96\u5099\n\n### PHP \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nHomebrew \u3092\u4f7f\u3063\u3066 PHP5.6 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nHomebrew/homebrew-php\nhttps://github.com/Homebrew/homebrew-php\n\n```\n$ brew tap homebrew/dupes\n$ brew tap homebrew/versions\n$ brew tab homebrew/homebrew-php\n```\n\n\u3069\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u304b\u9078\u3076\u3002\n\n```\n$ brew options php56\n```\n\n\u4eca\u56de\u306f\u7d20\u306e PHP5.6 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```\n$ brew install php56\n```\n\n\u6b63\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ php -v\nPHP 5.6.6 (cli) (built: Feb 26 2015 12:42:39) \nCopyright (c) 1997-2015 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2015 Zend Technologies\n    with Zend OPcache v7.0.4-dev, Copyright (c) 1999-2015, by Zend Technologies\n    with Xdebug v2.3.1, Copyright (c) 2002-2015, by Derick Rethans\n```\n    \n### Composer \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\ncomposer \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ brew search composer\ncomposer\n```\n\ncomposer \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```\n$brew install composer\n```\n\n\u6b63\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ composer -V\nComposer version 1.0.0-alpha9 2014-12-07 17:15:20\n```\n\n### PHPUnit, DBUnit \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\ncomposer.json \u306e require-dev (\u958b\u767a\u74b0\u5883\u306b\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8) \u306b phpunit \u3068 dbunit \u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```composer.json\n\"require-dev\": {\n    \"phpunit/phpunit\": \"4.5.*\",\n    \"phpunit/dbunit\": \">=1.2\"\n}\n```\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```\n$ composer update\n```\n\n### PHPUnit \u30de\u30cb\u30e5\u30a2\u30eb\u3092\u8aad\u3080\n\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\nhttps://phpunit.de/manual/current/ja/database.html\n\n\u4eca\u56de\u306f YAML \u5f62\u5f0f\u3067 Fixute \u3092\u6e96\u5099\u3059\u308b\u3084\u308a\u65b9\u3092\u63a1\u7528\u3059\u308b\u3002\n\n### PHPUnit \u306e\u8a2d\u5b9a\u60c5\u5831\u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a\u60c5\u5831\u3092\u66f8\u304f\n\nphpunit.xml \u306b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306b\u63a5\u7d9a\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u66f8\u304f\u3002PHPUnit \u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u5f15\u6570\u3067\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```phpunit.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" ?>\n<phpunit>\n    <php>\n        <var name=\"DB_DSN\" value=\"mysql:dbname=myguestbook;host=localhost\" />\n        <var name=\"DB_USER\" value=\"user\" />\n        <var name=\"DB_PASSWD\" value=\"passwd\" />\n        <var name=\"DB_DBNAME\" value=\"myguestbook\" />\n    </php>\n</phpunit>\n```\n\n### Generic_Tests_DatabaseTestCase.php \u3092\u4f5c\u308b\n\n```Generic_Tests_DatabaseTestCase.php\n<?php\nabstract class Generic_Tests_DatabaseTestCase extends PHPUnit_Extensions_Database_TestCase\n{\n    // PDO \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u304a\u3088\u3073\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u8aad\u307f\u8fbc\u307f\u306e\u3068\u304d\u306b\u4e00\u5ea6\u3060\u3051\n    static private $pdo = null;\n\n    // PHPUnit_Extensions_Database_DB_IDatabaseConnection \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u4e00\u5ea6\u3060\u3051\n    private $conn = null;\n\n    /**\n     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection\n     */\n    final public function getConnection()\n    {\n        if ($this->conn === null) {\n            if (self::$pdo == null) {\n                self::$pdo = new PDO( $GLOBALS['DB_DSN'], $GLOBALS['DB_USER'], $GLOBALS['DB_PASSWD'] );\n            }\n            $this->conn = $this->createDefaultDBConnection(self::$pdo, $GLOBALS['DB_DBNAME']);\n        }\n\n        return $this->conn;\n    }\n}\n```\n\n### Fixute \u3092\u4f5c\u308b\n\n\u30c7\u30fc\u30bf\u30922\u3064\u6e96\u5099\u3059\u308b\u3002\n\n```\n$ mkdir _files\n$ vi guestbook.yml\n```\n\n```guestbook.yml\nguestbook:\n  -\n    id: 1\n    content: \"Hello buddy!\"\n    user: \"joe\"\n    created: \"2010-04-24 17:15:23\"\n  -\n    id: 2\n    content: \"I like it!\"\n    user:\n    created: \"2010-04-26 12:14:20\"\n```\n\n### YAML \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u4f7f\u3046\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3092\u4f5c\u308b\n2\u4ef6\u306e\u30c7\u30fc\u30bf\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```YamlGuestbookTest.php\n<?php\n\nrequire_once dirname(__FILE__).'/Generic_Tests_DatabaseTestCase.php';\n\nclass YamlGuestbookTest extends Generic_Tests_DatabaseTestCase\n{\n    /**\n     * @return PHPUnit_Extensions_Database_DataSet_IDataSet\n     */\n    protected function getDataSet()\n    {\n        return new PHPUnit_Extensions_Database_DataSet_YamlDataSet(\n            dirname(__FILE__).\"/_files/guestbook.yml\"\n        );\n    }\n\n    public function testGetRowCount()\n    {\n        $this->assertEquals(2, $this->getConnection()->getRowCount('guestbook'));\n    }\n}\n```\n\n\u5f15\u6570\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3059\u308b\u3002\n\n```\n$ vendor/bin/phpunit -c phpunit.xml YamlGuestbookTest.php \nPHPUnit 4.5.0 by Sebastian Bergmann and contributors.\n\nConfiguration read from /Users/takatama/openshift/ranking/phpunit.xml\n\n.\n\nTime: 125 ms, Memory: 4.25Mb\n\nOK (1 test, 1 assertion)\n```\n\n### \u3088\u304f\u3042\u308b\u9593\u9055\u3044\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b guestbook \u30c6\u30fc\u30d6\u30eb\u304c\u306a\u3044\u306e\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3002\n\n```\n$ vendor/bin/phpunit -c phpunit.xml YamlGuestbookTest.php \nPHPUnit 4.5.0 by Sebastian Bergmann and contributors.\n\nE\n\nTime: 119 ms, Memory: 3.75Mb\n\nThere was 1 error:\n\n1) YamlGuestbookTest::testGetRowCount\nPHPUnit_Extensions_Database_Operation_Exception: COMPOSITE[TRUNCATE] operation failed on query: \n                DELETE FROM \"guestbook\"\n             using args: Array\n(\n)\n [SQLSTATE[HY000]: General error: 1 no such table: guestbook]\n\nFAILURES!\nTests: 1, Assertions: 0, Errors: 1.\n```\n\n\u53c2\u8003: \ndatabase - Loading schema from SQL file, in PHPUnit test - Stack Overflow\nhttp://stackoverflow.com/questions/10948273/loading-schema-from-sql-file-in-phpunit-test\n", "tags": ["YAML", "DBUnit", "PHPUnit", "MySQL"]}