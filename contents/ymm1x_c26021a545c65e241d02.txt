{"context": "\u52d5\u304b\u3059\u306b\u306f Redis \u3068 PHP \u306e Redis \u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u4f7f\u7528\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\n\nPHP 7.0.10\nRedis 3.2.3\nNode.js 4.3.2\nnpm 2.14.12\n\n\n\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\nserver/package.json\n{\n  \"name\": \"sample-server\",\n  \"main\": \"index.js\",\n  \"dependencies\": {\n    \"express\": \"^4.10.2\",\n    \"socket.io\": \"^1.4.8\",\n    \"socket.io-redis\": \"^1.0.0\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^1.9.1\"\n  }\n}\n\n\nserver/index.js\nvar app = require('express')();\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\nvar redis = require('socket.io-redis');\nvar adapter = io.adapter(redis({ host: '127.0.0.1', port: 6379 }));\n\napp.get('/', function(req, res){\n  res.sendFile(__dirname + '/index.html');\n});\n\nhttp.listen(3000, function(){\n  console.log('listening on *:3000');\n});\n\n\nserver/index.html\n<script src=\"https://cdn.socket.io/socket.io-1.4.8.js\"></script>\n<script>\n  var socket = io.connect('http://localhost:3000/');\n\n  socket.on('update', function(socket){\n    console.log('received emit!');\n  });\n</script>\n\n\n\nphp-emitter/composer.json\n{\n    \"name\": \"sample-client\",\n    \"type\": \"project\",\n    \"require\": {\n        \"ashiina/socket.io-emitter\": \"^0.8.0\"\n    }\n}\n\n2016\u5e7409\u670816\u65e5\u73fe\u5728\u3001rase/socket.io-emitter \u306b\u306f\u4e92\u63db\u6027\u306e\u554f\u984c\u304c\u3042\u308a\u52d5\u4f5c\u3057\u306a\u3044\u305f\u3081\u3001\u4ee3\u308f\u308a\u306b\u6709\u5fd7\u306e\u65b9\u304c\u516c\u958b\u3057\u305f\u4fee\u6b63\u7248\u306e ashiina/socket.io-emitter \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f socket.io-php-emitter 0.7.0\u304c\u52d5\u4f5c\u3057\u306a\u3044\u554f\u984c \u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nphp-emitter/src/client.php\n<?php\nrequire_once('../vendor/autoload.php');\n\n$redis = new \\Redis();\n$redis->connect('127.0.0.1', '6379');\n\n$emitter = new SocketIO\\Emitter($redis);\n$emitter->emit('update', 'data'));\n\n\n\u78ba\u8a8d\u65b9\u6cd5\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067 node \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u305f\u72b6\u614b\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067 index.html (http://localhost:3000/) \u3092\u8868\u793a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nnode index.js \n\n\u305d\u306e\u72b6\u614b\u3067 client.php \u3092\u5b9f\u884c\u3057\u3066\u30b3\u30f3\u30bd\u30fc\u30eb\u306b received emit! \u3068\u8868\u793a\u3055\u308c\u308c\u3070\u758e\u901a\u6210\u529f\u3067\u3059\u3002\ud83c\udf89\n\n\u758e\u901a\u78ba\u8a8d\u6642\u306e\u30c7\u30d0\u30c3\u30b0\u306b\u4fbf\u5229\u306a\u65b9\u6cd5\n\u6700\u521d\u8a66\u3057\u305f\u3068\u304d\u306b\u4e2d\u3005\u7e4b\u304c\u3089\u306a\u304f\u3066\u82e6\u52b4\u3057\u305f\u306e\u3067\u3001\u5f79\u306b\u7acb\u3063\u305f\u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n1. \u30b5\u30fc\u30d0\u306e\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306e\u6709\u52b9\u5316\n\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3057\u3066 node \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3066\u304a\u304f\u3068 emit \u6642\u306b\u8a73\u7d30\u306a\u60c5\u5831\u304c\u6d41\u308c\u307e\u3059\u3002\nDEBUG=* node index.js\n\n\n2. Redis \u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\nRedis \u3092\u4ecb\u3057\u3066 emit \u3059\u308b\u305f\u3081\u3001Redis \u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067 monitor \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304a\u304f\u3068\u5b9f\u969b\u306e\u901a\u4fe1\u5185\u5bb9 (msgpack) \u306e\u6587\u5b57\u5217\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u52d5\u304b\u3059\u306b\u306f Redis \u3068 PHP \u306e Redis \u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n## \u4f7f\u7528\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\n\n- PHP 7.0.10\n- Redis 3.2.3\n- Node.js 4.3.2\n- npm 2.14.12\n\n## \u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\n### server/package.json\n\n```\n{\n  \"name\": \"sample-server\",\n  \"main\": \"index.js\",\n  \"dependencies\": {\n    \"express\": \"^4.10.2\",\n    \"socket.io\": \"^1.4.8\",\n    \"socket.io-redis\": \"^1.0.0\"\n  },\n  \"devDependencies\": {\n    \"nodemon\": \"^1.9.1\"\n  }\n}\n```\n\n### server/index.js\n\n```js\nvar app = require('express')();\nvar http = require('http').Server(app);\nvar io = require('socket.io')(http);\n\nvar redis = require('socket.io-redis');\nvar adapter = io.adapter(redis({ host: '127.0.0.1', port: 6379 }));\n\napp.get('/', function(req, res){\n  res.sendFile(__dirname + '/index.html');\n});\n\nhttp.listen(3000, function(){\n  console.log('listening on *:3000');\n});\n```\n\n### server/index.html\n\n\n```html\n<script src=\"https://cdn.socket.io/socket.io-1.4.8.js\"></script>\n<script>\n  var socket = io.connect('http://localhost:3000/');\n  \n  socket.on('update', function(socket){\n    console.log('received emit!');\n  });\n</script>\n\n```\n\n### php-emitter/composer.json\n\n```\n{\n    \"name\": \"sample-client\",\n    \"type\": \"project\",\n    \"require\": {\n        \"ashiina/socket.io-emitter\": \"^0.8.0\"\n    }\n}\n```\n\n2016\u5e7409\u670816\u65e5\u73fe\u5728\u3001`rase/socket.io-emitter` \u306b\u306f\u4e92\u63db\u6027\u306e\u554f\u984c\u304c\u3042\u308a\u52d5\u4f5c\u3057\u306a\u3044\u305f\u3081\u3001\u4ee3\u308f\u308a\u306b\u6709\u5fd7\u306e\u65b9\u304c\u516c\u958b\u3057\u305f\u4fee\u6b63\u7248\u306e `ashiina/socket.io-emitter` \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f [socket.io-php-emitter 0.7.0\u304c\u52d5\u4f5c\u3057\u306a\u3044\u554f\u984c](http://sousaku-memo.net/php-system/1590) \u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### php-emitter/src/client.php\n\n```php\n<?php\nrequire_once('../vendor/autoload.php');\n\n$redis = new \\Redis();\n$redis->connect('127.0.0.1', '6379');\n\n$emitter = new SocketIO\\Emitter($redis);\n$emitter->emit('update', 'data'));\n```\n\n### \u78ba\u8a8d\u65b9\u6cd5\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067 node \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u305f\u72b6\u614b\u3067\u3001\u30d6\u30e9\u30a6\u30b6\u3067 index.html (http://localhost:3000/) \u3092\u8868\u793a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash\nnode index.js \n```\n\n\u305d\u306e\u72b6\u614b\u3067 client.php \u3092\u5b9f\u884c\u3057\u3066\u30b3\u30f3\u30bd\u30fc\u30eb\u306b `received emit!` \u3068\u8868\u793a\u3055\u308c\u308c\u3070\u758e\u901a\u6210\u529f\u3067\u3059\u3002\ud83c\udf89\n\n## \u758e\u901a\u78ba\u8a8d\u6642\u306e\u30c7\u30d0\u30c3\u30b0\u306b\u4fbf\u5229\u306a\u65b9\u6cd5\n\n\u6700\u521d\u8a66\u3057\u305f\u3068\u304d\u306b\u4e2d\u3005\u7e4b\u304c\u3089\u306a\u304f\u3066\u82e6\u52b4\u3057\u305f\u306e\u3067\u3001\u5f79\u306b\u7acb\u3063\u305f\u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n### 1. \u30b5\u30fc\u30d0\u306e\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306e\u6709\u52b9\u5316\n\n\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u3092\u6709\u52b9\u306b\u3057\u3066 node \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3066\u304a\u304f\u3068 emit \u6642\u306b\u8a73\u7d30\u306a\u60c5\u5831\u304c\u6d41\u308c\u307e\u3059\u3002\n\n```bash\nDEBUG=* node index.js\n```\n\n### 2. Redis \u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\n\nRedis \u3092\u4ecb\u3057\u3066 emit \u3059\u308b\u305f\u3081\u3001Redis \u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067 `monitor` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304a\u304f\u3068\u5b9f\u969b\u306e\u901a\u4fe1\u5185\u5bb9 (msgpack) \u306e\u6587\u5b57\u5217\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n", "tags": ["PHP", "Redis", "Node.js", "Socket.io", "Composer"]}