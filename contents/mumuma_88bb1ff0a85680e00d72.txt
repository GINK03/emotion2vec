{"tags": ["lumen", "laravel", "PHP"], "context": "\u5143\u3005\u30d1\u30e9\u30e1\u30fc\u30bf\u3092session\u306b\u4fdd\u5b58\u3057\u3066Controller\u306b\u4f7f\u3046\u3064\u3082\u308a\u3067\u3001\u6700\u521d\u306b\u8003\u3048\u305f\u65b9\u6cd5\u306f\n\nbootstrap/app.php \u306b\u8a18\u8ff0\nServiceProvider\u8aad\u307f\u8fbc\u307f\u306b\u30d5\u30c3\u30af\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u767b\u9332\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u767b\u9332\n\n\u3067\u3059\u304c\u3001\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3082\u3063\u3068\u7c21\u5358\u306a\u65b9\u6cd5\u3067request\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$request->attributes->add(['user' => $user]);\nreturn $next($request);\n\nController\u5074\u53d7\u3051\u53d6\u308b\u65b9\u6cd5\nuse Illuminate\\Http\\Request;\n\npublic function index(Request $request)\n{\n    $user = $request->get('user');\n}\n\nMiddleware\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n<?php\n\nnamespace App\\Http\\Middleware;\n\nuse Closure;\nuse App\\Models\\Entities\\User;\n\nclass BeforeMiddleware\n{\n    /**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */\n    public function handle($request, Closure $next)\n    {\n        $user['user_agent'] = $_SERVER['HTTP_USER_AGENT'];\n        $user['ip'] = $_SERVER['REMOTE_ADDR'];\n        $user['referer'] = $_SERVER['HTTP_REFERER'] ?? '';\n\n        $userObj = new User();\n        $userObj->setProperties($user);\n        $request->attributes->add(['user' => $userObj]);\n\n        return $next($request);\n    }\n}\n\n\u305d\u308c\u3067\u89e3\u6c7a\u3002\n\u5143\u3005\u30d1\u30e9\u30e1\u30fc\u30bf\u3092session\u306b\u4fdd\u5b58\u3057\u3066Controller\u306b\u4f7f\u3046\u3064\u3082\u308a\u3067\u3001\u6700\u521d\u306b\u8003\u3048\u305f\u65b9\u6cd5\u306f\n\n* bootstrap/app.php \u306b\u8a18\u8ff0\n* ServiceProvider\u8aad\u307f\u8fbc\u307f\u306b\u30d5\u30c3\u30af\n* \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n* \u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u767b\u9332\n* \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u767b\u9332\n\n\u3067\u3059\u304c\u3001\u3046\u307e\u304f\u884c\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u3082\u3063\u3068\u7c21\u5358\u306a\u65b9\u6cd5\u3067request\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n$request->attributes->add(['user' => $user]);\nreturn $next($request);\n```\n\nController\u5074\u53d7\u3051\u53d6\u308b\u65b9\u6cd5\n\n```\nuse Illuminate\\Http\\Request;\n\npublic function index(Request $request)\n{\n    $user = $request->get('user');\n}\n```\n\nMiddleware\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\n```\n<?php\n\nnamespace App\\Http\\Middleware;\n\nuse Closure;\nuse App\\Models\\Entities\\User;\n\nclass BeforeMiddleware\n{\n    /**\n     * Handle an incoming request.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @param  \\Closure  $next\n     * @return mixed\n     */\n    public function handle($request, Closure $next)\n    {\n        $user['user_agent'] = $_SERVER['HTTP_USER_AGENT'];\n        $user['ip'] = $_SERVER['REMOTE_ADDR'];\n        $user['referer'] = $_SERVER['HTTP_REFERER'] ?? '';\n\n        $userObj = new User();\n        $userObj->setProperties($user);\n        $request->attributes->add(['user' => $userObj]);\n\n        return $next($request);\n    }\n}\n```\n\n\u305d\u308c\u3067\u89e3\u6c7a\u3002\n"}