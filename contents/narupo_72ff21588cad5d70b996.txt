{"tags": ["es6", "JavaScript"], "context": "WebGL\u306a\u3069\u3067\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3067\u304b\u3089\u30e1\u30a4\u30f3\u306e\u51e6\u7406\u3092\u3057\u305f\u3044\u6642\uff08\u30c6\u30af\u30b9\u30c1\u30e3\u5468\u308a\uff09\u306b\u4f7f\u3046\uff08\u4e88\u5b9a\uff09\u3002\n\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u5909\u6570\u3067const\u4f7f\u3044\u305f\u304b\u3063\u305f\u3002\u3042\u3068Promise\u306f\u307b\u3093\u3068\u4fbf\u5229\u3002\n\u30a8\u30e9\u30fc\u51e6\u7406\u304c\u7121\u3044\u306e\u3067\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u305f\u3089\u9759\u304b\u306b\u6b62\u307e\u308a\u307e\u3059\u3002\nclass ImageLoader {\n    constructor() {\n        this._srcs = {};\n        this._tmpimgs = {};\n        this._imgs = {};\n    }\n\n    static get INTERVAL_MS() {\n        return 10;\n    }\n\n    add({ key, src }) {\n        this._srcs[key] = src;\n    }\n\n    loadall() {\n        this._tmpimgs = {};\n        this._imgs = {};\n\n        return new Promise((resolve, reject) => {\n            for (let key in this._srcs) {\n                let src = this._srcs[key];\n                let img = new Image();\n\n                img.onload = () => {\n                    let img = this._tmpimgs[key];\n                    this._imgs[key] = img;\n                    delete this._tmpimgs[key];\n                };\n\n                this._tmpimgs[key] = img;\n                img.src = src; // load start\n            }\n\n            let iid = setInterval(() => {\n                if (Object.keys(this._tmpimgs).length === 0) {\n                    clearInterval(iid);\n                    resolve(this._imgs);\n                }\n            }, ImageLoader.INTERVAL_MS);\n        });\n    }\n}\n\nlet imgloader = new ImageLoader();\n\nimgloader.add({ key: 'aaa', src: 'http://localhost:8000/32x32.png' });\nimgloader.add({ key: 'bbb', src: 'http://localhost:8000/32x32.png' });\n\nimgloader.loadall().then(imgs => {\n    for (let k in imgs) {\n        console.log(imgs[k]);\n    }\n});\n\n\nWebGL\u306a\u3069\u3067\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3067\u304b\u3089\u30e1\u30a4\u30f3\u306e\u51e6\u7406\u3092\u3057\u305f\u3044\u6642\uff08\u30c6\u30af\u30b9\u30c1\u30e3\u5468\u308a\uff09\u306b\u4f7f\u3046\uff08\u4e88\u5b9a\uff09\u3002\n\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u5909\u6570\u3067const\u4f7f\u3044\u305f\u304b\u3063\u305f\u3002\u3042\u3068Promise\u306f\u307b\u3093\u3068\u4fbf\u5229\u3002\n\u30a8\u30e9\u30fc\u51e6\u7406\u304c\u7121\u3044\u306e\u3067\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u305f\u3089\u9759\u304b\u306b\u6b62\u307e\u308a\u307e\u3059\u3002\n\n```js:\nclass ImageLoader {\n    constructor() {\n        this._srcs = {};\n        this._tmpimgs = {};\n        this._imgs = {};\n    }\n\n    static get INTERVAL_MS() {\n        return 10;\n    }\n\n    add({ key, src }) {\n        this._srcs[key] = src;\n    }\n\n    loadall() {\n        this._tmpimgs = {};\n        this._imgs = {};\n\n        return new Promise((resolve, reject) => {\n            for (let key in this._srcs) {\n                let src = this._srcs[key];\n                let img = new Image();\n\n                img.onload = () => {\n                    let img = this._tmpimgs[key];\n                    this._imgs[key] = img;\n                    delete this._tmpimgs[key];\n                };\n                \n                this._tmpimgs[key] = img;\n                img.src = src; // load start\n            }\n\n            let iid = setInterval(() => {\n                if (Object.keys(this._tmpimgs).length === 0) {\n                    clearInterval(iid);\n                    resolve(this._imgs);\n                }\n            }, ImageLoader.INTERVAL_MS);\n        });\n    }\n}\n\nlet imgloader = new ImageLoader();\n\nimgloader.add({ key: 'aaa', src: 'http://localhost:8000/32x32.png' });\nimgloader.add({ key: 'bbb', src: 'http://localhost:8000/32x32.png' });\n\nimgloader.loadall().then(imgs => {\n    for (let k in imgs) {\n        console.log(imgs[k]);\n    }\n});\n\n```\n"}