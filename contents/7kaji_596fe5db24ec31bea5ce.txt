{"context": "\n\nLet's Encrypt \u306e\u4ed5\u7d44\u307f - Let's Encrypt \u7dcf\u5408\u30dd\u30fc\u30bf\u30eb : https://letsencrypt.jp/technology/\n\n\nSinatra \u30a2\u30d7\u30ea\u3064\u304f\u308b\nGemfile\n\nGemfile\nsource \"https://rubygems.org\"\n\nruby '2.3.3'\ngem 'sinatra'\n\n\n\napp.rb\n#! /usr/bin/env ruby\n\nrequire 'bundler'\nBundler.require\n\nclass App < Sinatra::Base\n  get '/' do\n    \"Hello World\"\n  end\nend\n\n\n\nHeroku \u306b \u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\nconfig.ru\nrequire './app'\nrun App\n\n\n$ git init\n$ git add .\n$ git commit -m 'first commit'\n$ heroku create <\u30a2\u30d7\u30ea\u540d>\n$ git push heroku master\n\nheroku open \u3057\u3066 \u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nLetsEncrypt \u3092\u8ffd\u52a0\u3059\u308b\n\nGemfile\ngem 'rake'\ngem 'platform-api', git: 'https://github.com/jalada/platform-api', branch: 'master'\ngem 'letsencrypt-rails-heroku'\n\n\n\n\nrake \u306f\u3001\u8a3c\u660e\u66f8\u767a\u884c\u3001\u66f4\u65b0\u7528\u306e Task \u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\n\nplatform-api \u306f\u3001Heroku \u306e API \u3092\u4f7f\u3046\u305f\u3081\uff08\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u305f\u3089\u3044\u3089\u306a\u304f\u306a\u308b\u304b\u3082\uff09\n\n\u306e\u305f\u3081\u306b\u8ffd\u52a0\n\nRakefile \u8ffd\u52a0\n\nRakefile\nrequire 'letsencrypt-rails-heroku'\nLetsencrypt.configure\nspec = Gem::Specification.find_by_name 'letsencrypt-rails-heroku'\nload \"#{spec.gem_dir}/lib/tasks/letsencrypt.rake\"\n\n\n\u3053\u308c\u3067\u3001Heroku \u4e0a\u3067 Rake \u306e Task \u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u30a2\u30d7\u30ea\u306e\u65b9\u306b\u3082\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u8ffd\u52a0\u3059\u308b\n\napp.rb\n#! /usr/bin/env ruby\nrequire 'bundler'\nBundler.require\n\nclass App < Sinatra::Base\n  Letsencrypt.configure\n  use Letsencrypt::Middleware\n\n  get '/' do\n    \"Hello World\"\n  end\nend\n\n\n\u3082\u3063\u304b\u3044\u3001Heroku \u306b \u00a0\u30c7\u30d7\u30ed\u30a4\u3002\n\n\u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\n\u9069\u5f53\u306a\u30c9\u30e1\u30a4\u30f3\u3092\u8cb7\u3063\u3066\u304a\u304f\u3002\n\uff08\u4eca\u56de\u306f\u3001b-dayz.date \u3063\u3066\u3044\u3046\u30c0\u30b5\u3044\u30c9\u30e1\u30a4\u30f3\u3092\u304a\u540d\u524d.com \u3067\u8cb7\u3063\u305f\uff09\n$ heroku domains:add b-dayz.date\n\n\u203b .herokuapp.com \u306e\u30c9\u30e1\u30a4\u30f3\u306b CNAME \u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n\u74b0\u5883\u5909\u6570\u306b\u8272\u3005\u8a2d\u5b9a\u3059\u308b\n$ heroku config:add ACME_DOMAIN=b-dayz.date\n$ heroku config:add ACME_EMAIL=<\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9>\n$ heroku config:add HEROKU_APP=<Heorku\u3067\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u540d>\n\n$ heroku plugins:install heroku-cli-oauth\n$ heroku authorizations:create -d \"LetsEncrypt\"\n$ heroku config:add HEROKU_TOKEN=<\u524d\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8868\u793a\u3055\u308c\u305fTOKEN>\n\n\nHeroku \u306e\u30d7\u30e9\u30f3\u5909\u66f4\nfree \u306e dyno \u3067\u306f\u3001\u8a3c\u660e\u66f8\u306e\u767b\u9332\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001hobby($7/month)\u306b\u3042\u3052\u308b\u3002\n$ heroku dyno:type hobby\n\n\u3053\u308c\u3067\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n$ heroku run rake letsencrypt:renew\n\nhttps \u3067\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a\u3002\n\n\nhttp \u5bfe\u5fdc\nhttp \u3067\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u53d7\u3051\u4ed8\u3051\u3066\u3044\u308b\u306e\u3067\u3001https \u306b\u77ef\u6b63\u3055\u305b\u308b\u3002\n\nGemfile\ngem 'rack-ssl-enforcer'\n\n\n\napp.rb\nuse Rack::SslEnforcer if production?\n\n\n\n.herokuapp \u30c9\u30e1\u30a4\u30f3\u5bfe\u5fdc\n.herokuapp \u306e\u30c9\u30e1\u30a4\u30f3\u306e\u65b9\u3067\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u3066\u3044\u308b\u306e\u3067\u3001301 \u304b\u3051\u3066\u304a\u304f\u3002\n\napp.rb\nclass App < Sinatra::Base\n  before do  \n    ensure_domain if production?\n  end\n\n  # def hoge end\n  # def fuga end\n\n  private\n\n  def production?\n    ENV['RACK_ENV'] == 'production'\n  end\n\n  def ensure_domain\n    return unless /\\.herokuapp.com/ =~ request.env['HTTP_HOST']\n    redirect \"https://#{ENV['FQDN']}#{request.env['REQUEST_PATH']}\", 301\n  end\nend\n\n\n$ heroku config:add FQDN=b-dayz.date\n\n\n\u8a3c\u660e\u66f8\u306e\u81ea\u52d5\u66f4\u65b0\n\nhttps://elements.heroku.com/addons/scheduler\n\n$ heroku addons:create scheduler:standard\n$ heroku addons:open scheduler\n\n\nJob\u3000\u3092\u8ffd\u52a0\u3057\u3066\u5b8c\u4e86\nif [ \"$(date +%d)\" = 01 ]; then rake letsencrypt:renew; fi\n\n\nREF\n\npixielabs/letsencrypt-rails-heroku: Automatic LetsEncrypt SSL certificates in your Rails app on Heroku : https://github.com/pixielabs/letsencrypt-rails-heroku\n\n[SEO\u5bfe\u7b56] Rails\u3067herokuapp.com\u3092\u6b63\u3057\u3044FQDN\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b - Qiita : http://qiita.com/kon_yu/items/223aa03554ff6141001f\n\n\n<img src=https://letsencrypt.org/images/le-logo-twitter.png width=200px>\n\n> Let's Encrypt \u306e\u4ed5\u7d44\u307f - Let's Encrypt \u7dcf\u5408\u30dd\u30fc\u30bf\u30eb : https://letsencrypt.jp/technology/\n\n## Sinatra \u30a2\u30d7\u30ea\u3064\u304f\u308b\n\nGemfile\n\n```rb:Gemfile\nsource \"https://rubygems.org\"\n\nruby '2.3.3'\ngem 'sinatra'\n```\n\n```rb:app.rb\n#! /usr/bin/env ruby\n\nrequire 'bundler'\nBundler.require\n\nclass App < Sinatra::Base\n  get '/' do\n    \"Hello World\"\n  end\nend\n```\n\n## Heroku \u306b \u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\n```rb:config.ru\nrequire './app'\nrun App\n```\n\n```\n$ git init\n$ git add .\n$ git commit -m 'first commit'\n$ heroku create <\u30a2\u30d7\u30ea\u540d>\n$ git push heroku master\n```\n\nheroku open \u3057\u3066 \u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n## LetsEncrypt \u3092\u8ffd\u52a0\u3059\u308b\n\n```rb:Gemfile\ngem 'rake'\ngem 'platform-api', git: 'https://github.com/jalada/platform-api', branch: 'master'\ngem 'letsencrypt-rails-heroku'\n```\n\n- `rake` \u306f\u3001\u8a3c\u660e\u66f8\u767a\u884c\u3001\u66f4\u65b0\u7528\u306e Task \u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\n- `platform-api` \u306f\u3001Heroku \u306e API \u3092\u4f7f\u3046\u305f\u3081\uff08\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u305f\u3089\u3044\u3089\u306a\u304f\u306a\u308b\u304b\u3082\uff09\n\n\u306e\u305f\u3081\u306b\u8ffd\u52a0\n\n###  Rakefile \u8ffd\u52a0\n\n```rb:Rakefile\nrequire 'letsencrypt-rails-heroku'\nLetsencrypt.configure\nspec = Gem::Specification.find_by_name 'letsencrypt-rails-heroku'\nload \"#{spec.gem_dir}/lib/tasks/letsencrypt.rake\"\n```\n\n\u3053\u308c\u3067\u3001Heroku \u4e0a\u3067 Rake \u306e Task \u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n### \u30a2\u30d7\u30ea\u306e\u65b9\u306b\u3082\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u8ffd\u52a0\u3059\u308b\n\n\n```rb:app.rb\n#! /usr/bin/env ruby\nrequire 'bundler'\nBundler.require\n\nclass App < Sinatra::Base\n  Letsencrypt.configure\n  use Letsencrypt::Middleware\n  \n  get '/' do\n    \"Hello World\"\n  end\nend\n```\n\n\u3082\u3063\u304b\u3044\u3001Heroku \u306b \u00a0\u30c7\u30d7\u30ed\u30a4\u3002\n\n## \u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\n\n\u9069\u5f53\u306a\u30c9\u30e1\u30a4\u30f3\u3092\u8cb7\u3063\u3066\u304a\u304f\u3002\n\uff08\u4eca\u56de\u306f\u3001`b-dayz.date` \u3063\u3066\u3044\u3046\u30c0\u30b5\u3044\u30c9\u30e1\u30a4\u30f3\u3092\u304a\u540d\u524d.com \u3067\u8cb7\u3063\u305f\uff09\n\n```\n$ heroku domains:add b-dayz.date\n```\n\n\u203b `.herokuapp.com` \u306e\u30c9\u30e1\u30a4\u30f3\u306b `CNAME` \u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n### \u74b0\u5883\u5909\u6570\u306b\u8272\u3005\u8a2d\u5b9a\u3059\u308b\n\n```\n$ heroku config:add ACME_DOMAIN=b-dayz.date\n$ heroku config:add ACME_EMAIL=<\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9>\n$ heroku config:add HEROKU_APP=<Heorku\u3067\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u540d>\n```\n\n```\n$ heroku plugins:install heroku-cli-oauth\n$ heroku authorizations:create -d \"LetsEncrypt\"\n$ heroku config:add HEROKU_TOKEN=<\u524d\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8868\u793a\u3055\u308c\u305fTOKEN>\n```\n\n### Heroku \u306e\u30d7\u30e9\u30f3\u5909\u66f4\n\nfree \u306e dyno \u3067\u306f\u3001\u8a3c\u660e\u66f8\u306e\u767b\u9332\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001hobby($7/month)\u306b\u3042\u3052\u308b\u3002\n\n```\n$ heroku dyno:type hobby\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u304c\u6574\u3044\u307e\u3057\u305f\u3002\n\n```\n$ heroku run rake letsencrypt:renew\n```\n\n`https` \u3067\u78ba\u8a8d\u3067\u304d\u308b\u306f\u305a\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/4598/3a6435c5-5dbb-9d26-1685-ecd0d4378656.png)\n\n## http \u5bfe\u5fdc\n\nhttp \u3067\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u53d7\u3051\u4ed8\u3051\u3066\u3044\u308b\u306e\u3067\u3001https \u306b\u77ef\u6b63\u3055\u305b\u308b\u3002\n\n```rb:Gemfile\ngem 'rack-ssl-enforcer'\n```\n\n```rb:app.rb\nuse Rack::SslEnforcer if production?\n```\n\n## `.herokuapp` \u30c9\u30e1\u30a4\u30f3\u5bfe\u5fdc\n\n`.herokuapp` \u306e\u30c9\u30e1\u30a4\u30f3\u306e\u65b9\u3067\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u3066\u3044\u308b\u306e\u3067\u3001301 \u304b\u3051\u3066\u304a\u304f\u3002\n\n```rb:app.rb\nclass App < Sinatra::Base\n  before do  \n    ensure_domain if production?\n  end\n\n  # def hoge end\n  # def fuga end\n\n  private\n\n  def production?\n    ENV['RACK_ENV'] == 'production'\n  end\n\n  def ensure_domain\n    return unless /\\.herokuapp.com/ =~ request.env['HTTP_HOST']\n    redirect \"https://#{ENV['FQDN']}#{request.env['REQUEST_PATH']}\", 301\n  end\nend\n```\n\n```\n$ heroku config:add FQDN=b-dayz.date\n```\n\n## \u8a3c\u660e\u66f8\u306e\u81ea\u52d5\u66f4\u65b0\n\n> https://elements.heroku.com/addons/scheduler\n\n```\n$ heroku addons:create scheduler:standard\n$ heroku addons:open scheduler\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/4598/bde3971d-5731-3339-45bc-699e5ad66db5.png)\n\nJob\u3000\u3092\u8ffd\u52a0\u3057\u3066\u5b8c\u4e86\n\n```bash\nif [ \"$(date +%d)\" = 01 ]; then rake letsencrypt:renew; fi\n```\n\n## REF\n\n- pixielabs/letsencrypt-rails-heroku: Automatic LetsEncrypt SSL certificates in your Rails app on Heroku : https://github.com/pixielabs/letsencrypt-rails-heroku\n- [SEO\u5bfe\u7b56] Rails\u3067herokuapp.com\u3092\u6b63\u3057\u3044FQDN\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b - Qiita : http://qiita.com/kon_yu/items/223aa03554ff6141001f\n", "tags": ["Ruby", "Sinatra", "Heroku", "letsencrypt"]}