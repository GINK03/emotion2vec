{"tags": ["lamp", "itamae", "vagrant"], "context": "\u6700\u8fd1Linux\u3092\u3044\u3058\u308b\u3053\u3068\u304c\u3061\u3087\u3063\u3068\u591a\u3044\u306e\u3067\u3001\u305d\u308c\u3092\u30b3\u30fc\u30c9\u5316\u3067\u304d\u308b\u3068\u3044\u3044\u306a\u3041(\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u5fd8\u308c\u308b\u304b\u3089orz)\u3068\u601d\u3044\u3001\u4eca\u66f4\u306a\u304c\u3089vagrant\u3068itamae\u3092\u4f7f\u3063\u3066\u624b\u59cb\u3081\u306bLAMP\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u306b\u306fchef\u304c\u30e1\u30b8\u30e3\u30fc\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u30b7\u30f3\u30d7\u30eb\u304c\u597d\u304d\u306a\u306e\u3067itamae\u3092\u9078\u629e\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u74b0\u5883\n\nMac OS X Yosemite 10.10.5\nVirtualBox 5.0.8 for OS X hosts\nVagrant 1.7.4\nItamae v1.6.3\nruby 2.0.0p481 (2014-05-08 revision 45883) [universal.x86_64-darwin14]\n\n\nvagrant\u74b0\u5883\u69cb\u7bc9\n\nVirtualBox\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://www.virtualbox.org/wiki/Downloads\n\n\n\nvagrant\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://www.vagrantup.com/downloads.html\n\n\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir -p ~/Vagrant/CentOS65\ncd ~/Vagrant/CentOS65\n\n\n\nCentOS6.5\u4eee\u60f3\u74b0\u5883\u30d9\u30fc\u30b9\u7528\u610f\nvagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box\n\n\n\n\u521d\u671f\u5316\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(Vagrantfile)\u4f5c\u6210\u304a\u3088\u3073\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nvagrant init centos65\ncp Vagrantfile Vagrantfile.org\n\n\n\nVagrantfie\u4fee\u6b63\ndiff Vagrantfile.org Vagrantfile\n<   # config.vm.network \"private_network\", ip: \"192.168.33.10\"\n---\n>   config.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n\n\nitamae\u74b0\u5883\u69cb\u7bc9\n\nbundle\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo gem install bundler\n\n\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir recipe-lamp\ncd recipe-lamp\n\n\n\nGemfile\u4f5c\u6210\nvim Gemfile\n\n\n\nGemfile\nsource 'https://rubygems.org'\ngem 'itamae'\n\n\n\nitamae\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nbundle install\n\n\n\nitamae\u306b\u3088\u308bLAMP\u74b0\u5883\u69cb\u7bc9\u30ec\u30b7\u30d4\u4f5c\u6210\n\n\u5404\u30ec\u30b7\u30d4\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir cookbooks\nmkdir cookbooks/apache\nmkdir cookbooks/mysql\nmkdir cookbooks/php\nmkdir cookbooks/phpmyadmin\n\n\n\nrecipe-lamp/set.rb\n# timezone\u8a2d\u5b9a\nexecute 'set timezone' do\n    user \"root\"\n    command <<-EOL\n        cp -p /usr/share/zoneinfo/Japan /etc/localtime\n        echo 'ZONE=\"Asia/Tokyo\"' > /etc/sysconfig/clock\n        echo 'UTC=false' >> /etc/sysconfig/clock\n    EOL\nend\n\n# \u8a00\u8a9e\u8a2d\u5b9a\nfile '/etc/sysconfig/i18n' do\n    action :edit\n    user \"root\"\n    block do |content|\n        content.gsub!(\"en_US\", \"ja_JP\")\n    end\nend\n\n# vim\u306e\u30bf\u30d6\u5e45\u3001\u6587\u5b57\u30b3\u30fc\u30c9\u7b49\u8a2d\u5b9a\nfile '/home/vagrant/.vimrc' do\n    action :create\n    user \"vagrant\"\n    content <<-EOL\nset tabstop=4\nset shiftwidth=4\nset noexpandtab\nset softtabstop=0\nset encoding=utf-8\nset fileencodings=iso-2022-jp,cp932,sjis,euc-jp,utf-8\nset fileformats=unix,mac,dos\n    EOL\nend\n\n# firewalld\u505c\u6b62\u3001\u7121\u52b9\u5316\nservice 'firewalld' do\n    action [:disable, :stop]\nend\n\ninclude_recipe \"./cookbooks/apache/default.rb\"\ninclude_recipe \"./cookbooks/php/default.rb\"\ninclude_recipe \"./cookbooks/mysql/default.rb\"\ninclude_recipe \"./cookbooks/phpmyadmin/default.rb\"\n\n# Apache\u8d77\u52d5\u3001\u6709\u52b9\u5316\nservice 'httpd' do\n    action [:start, :enable]\nend\n\n\n\nrecipe-lamp/cookbooks/apache/default.rb\n# Apache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'httpd'\n\n# httpd.conf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'httpd.conf backup' do\n    command 'cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.org'\nend\n\n# www\u30e6\u30fc\u30b6\u8ffd\u52a0\nexecute 'add www user' do\n    user \"root\"\n    command <<-EOL\n        useradd www\n        gpasswd -a apache www\n        chown -R www:apache /var/www/html\n    EOL\nend\n\n\n\nrecipe-lamp/cookbooks/mysql/default.rb\n# MySQL\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'mysql-server'\n\n# MySQL\u6a29\u9650\u8a2d\u5b9a\nexecute 'mysql permission' do\n    command <<-EOL\n        chown mysql:mysql /var/log/mysqld.log\n        chown -R mysql:mysql /var/lib/mysql\n    EOL\nend\n\n# my.cnf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'my.cnf backup' do\n    command 'cp /etc/my.cnf /etc/my.cnf.org'\nend\n\n# MySQL\u8d77\u52d5\u3001\u6709\u52b9\u5316\nservice 'mysqld' do\n    action [:start, :enable]\nend\n\n# MySQL\u521d\u671f\u8a2d\u5b9a\nexecute \"mysql_secure_installation\" do\n    user \"root\"\n    only_if \"mysql -u root -e 'show databases' | grep information_schema\" # \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u7a7a\u306e\u5834\u5408\n    command <<-EOL\n        mysqladmin -u root password \"password\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.user WHERE User='';\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1');\"\n        mysql -u root -ppassword -e \"DROP DATABASE test;\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.db WHERE Db='test' OR Db='test\\\\_%';\"\n        mysql -u root -ppassword -e \"FLUSH PRIVILEGES;\"\n    EOL\nend\n\n\n\nrecipe-lamp/cookbooks/php/default.rb\n# PHP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'php'\n\n# PHP\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'php-mysqlnd php-gd php-intl php-mbstring'\n\n# php.ini\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'php.ini backup' do\n    command 'cp /etc/php.ini /etc/php.ini.org'\nend\n\n\n\nrecipe-lamp/cookbooks/phpmyadmin/default.rb\n# phpMyAdmin\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'phpMyAdmin'\n\n# phpMyAdmin\u6a29\u9650\u8a2d\u5b9a\nexecute 'phpMyAdmin permission' do\n    command <<-EOL\n    chown -R root:apache /usr/share/phpMyAdmin/\n    EOL\nend\n\n# phpMyAdmin.conf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'phpMyAdmin.conf backup' do\n    command 'cp /etc/httpd/conf.d/phpMyAdmin.conf /etc/httpd/conf.d/phpMyAdmin.conf.org'\nend\n\n# phpMyAdmin.conf\u306e\u8a2d\u5b9a\nfile '/etc/httpd/conf.d/phpMyAdmin.conf' do\n    action :edit\n    block do |content|\n        content.gsub!(\"Allow from ::1\", \"Allow from ::1\\n     Allow from 192.168.\")\n    end\nend\n\n\n\nLAMP\u74b0\u5883\u8d77\u52d5\n\nCentOS\u4eee\u60f3\u74b0\u5883\u8d77\u52d5\ncd ~/Vagrant/CentOS65/recipe-lamp/\nvagrant up\n\n\n\nLAMP\u74b0\u5883\u69cb\u7bc9\nitamae ssh --vagrant set.rb\n\n\n\u3053\u308c\u3067\nhttp://192.168.33.10/\n\u3068\nhttp://192.168.33.10/phpmyadmin/\n\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3002\nphpmyadmin\u306froot\u3001password\u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n\u53c2\u8003\nChef-solo\u304b\u3089Itamae\u306b\u5b8c\u5168\u79fb\u884c\u3057\u305f\u8a71\nVagrant\u306e\u57fa\u672c\n\u30af\u30c3\u30af\u30d1\u30c3\u30c9\u306e\u30b5\u30fc\u30d0\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u4e8b\u60c5\nLAMP\u74b0\u5883\u69cb\u7bc9itamae\u30ec\u30b7\u30d4\u3092\u4f5c\u3063\u3066\u307f\u308b\nItamae\u306eedit\u30a2\u30af\u30b7\u30e7\u30f3\u304c\u4fbf\u5229\nItamae\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\n\n\u6700\u8fd1Linux\u3092\u3044\u3058\u308b\u3053\u3068\u304c\u3061\u3087\u3063\u3068\u591a\u3044\u306e\u3067\u3001\u305d\u308c\u3092\u30b3\u30fc\u30c9\u5316\u3067\u304d\u308b\u3068\u3044\u3044\u306a\u3041(\u8a2d\u5b9a\u3057\u305f\u5185\u5bb9\u5fd8\u308c\u308b\u304b\u3089orz)\u3068\u601d\u3044\u3001\u4eca\u66f4\u306a\u304c\u3089\bvagrant\u3068itamae\u3092\u4f7f\u3063\u3066\u624b\u59cb\u3081\u306bLAMP\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30b5\u30fc\u30d0\u30fc\u8a2d\u5b9a\u306b\u306fchef\u304c\u30e1\u30b8\u30e3\u30fc\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u30b7\u30f3\u30d7\u30eb\u304c\u597d\u304d\u306a\u306e\u3067itamae\u3092\u9078\u629e\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## \u74b0\u5883\n+ Mac OS X Yosemite 10.10.5\n+ VirtualBox 5.0.8 for OS X hosts\n+ Vagrant 1.7.4\n+ Itamae v1.6.3\n+ ruby 2.0.0p481 (2014-05-08 revision 45883) [universal.x86_64-darwin14]\n\n## vagrant\u74b0\u5883\u69cb\u7bc9\n```:VirtualBox\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://www.virtualbox.org/wiki/Downloads\n```\n\n```:vagrant\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://www.vagrantup.com/downloads.html\n```\n\n```bash:\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir -p ~/Vagrant/CentOS65\ncd ~/Vagrant/CentOS65\n```\n\n```bash:CentOS6.5\u4eee\u60f3\u74b0\u5883\u30d9\u30fc\u30b9\u7528\u610f\nvagrant box add centos65 https://github.com/2creatives/vagrant-centos/releases/download/v6.5.3/centos65-x86_64-20140116.box\n```\n\n```bash:\u521d\u671f\u5316\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(Vagrantfile)\u4f5c\u6210\u304a\u3088\u3073\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nvagrant init centos65\ncp Vagrantfile Vagrantfile.org\n```\n\n```bash:Vagrantfie\u4fee\u6b63\ndiff Vagrantfile.org Vagrantfile\n<   # config.vm.network \"private_network\", ip: \"192.168.33.10\"\n---\n>   config.vm.network \"private_network\", ip: \"192.168.33.10\"\n```\n\n## itamae\u74b0\u5883\u69cb\u7bc9\n```bash:bundle\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo gem install bundler\n```\n\n```bash:\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir recipe-lamp\ncd recipe-lamp\n```\n\n```bash:Gemfile\u4f5c\u6210\nvim Gemfile\n```\n\n```vim:Gemfile\nsource 'https://rubygems.org'\ngem 'itamae'\n```\n\n```bash:itamae\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nbundle install\n```\n\n## itamae\u306b\u3088\u308bLAMP\u74b0\u5883\u69cb\u7bc9\u30ec\u30b7\u30d4\u4f5c\u6210\n\n```bash:\u5404\u30ec\u30b7\u30d4\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\nmkdir cookbooks\nmkdir cookbooks/apache\nmkdir cookbooks/mysql\nmkdir cookbooks/php\nmkdir cookbooks/phpmyadmin\n```\n\n```rb:recipe-lamp/set.rb\n# timezone\u8a2d\u5b9a\nexecute 'set timezone' do\n    user \"root\"\n    command <<-EOL\n        cp -p /usr/share/zoneinfo/Japan /etc/localtime\n        echo 'ZONE=\"Asia/Tokyo\"' > /etc/sysconfig/clock\n        echo 'UTC=false' >> /etc/sysconfig/clock\n    EOL\nend\n\n# \u8a00\u8a9e\u8a2d\u5b9a\nfile '/etc/sysconfig/i18n' do\n    action :edit\n    user \"root\"\n    block do |content|\n        content.gsub!(\"en_US\", \"ja_JP\")\n    end\nend\n\n# vim\u306e\u30bf\u30d6\u5e45\u3001\u6587\u5b57\u30b3\u30fc\u30c9\u7b49\u8a2d\u5b9a\nfile '/home/vagrant/.vimrc' do\n    action :create\n    user \"vagrant\"\n    content <<-EOL\nset tabstop=4\nset shiftwidth=4\nset noexpandtab\nset softtabstop=0\nset encoding=utf-8\nset fileencodings=iso-2022-jp,cp932,sjis,euc-jp,utf-8\nset fileformats=unix,mac,dos\n    EOL\nend\n\n# firewalld\u505c\u6b62\u3001\u7121\u52b9\u5316\nservice 'firewalld' do\n    action [:disable, :stop]\nend\n\ninclude_recipe \"./cookbooks/apache/default.rb\"\ninclude_recipe \"./cookbooks/php/default.rb\"\ninclude_recipe \"./cookbooks/mysql/default.rb\"\ninclude_recipe \"./cookbooks/phpmyadmin/default.rb\"\n\n# Apache\u8d77\u52d5\u3001\u6709\u52b9\u5316\nservice 'httpd' do\n    action [:start, :enable]\nend\n```\n\n```rb:recipe-lamp/cookbooks/apache/default.rb \n# Apache\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'httpd'\n\n# httpd.conf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'httpd.conf backup' do\n    command 'cp /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.org'\nend\n\n# www\u30e6\u30fc\u30b6\u8ffd\u52a0\nexecute 'add www user' do\n    user \"root\"\n    command <<-EOL\n        useradd www\n        gpasswd -a apache www\n        chown -R www:apache /var/www/html\n    EOL\nend\n```\n\n```rb:recipe-lamp/cookbooks/mysql/default.rb\n# MySQL\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'mysql-server'\n\n# MySQL\u6a29\u9650\u8a2d\u5b9a\nexecute 'mysql permission' do\n    command <<-EOL\n        chown mysql:mysql /var/log/mysqld.log\n        chown -R mysql:mysql /var/lib/mysql\n    EOL\nend\n\n# my.cnf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'my.cnf backup' do\n    command 'cp /etc/my.cnf /etc/my.cnf.org'\nend\n\n# MySQL\u8d77\u52d5\u3001\u6709\u52b9\u5316\nservice 'mysqld' do\n    action [:start, :enable]\nend\n\n# MySQL\u521d\u671f\u8a2d\u5b9a\nexecute \"mysql_secure_installation\" do\n    user \"root\"\n    only_if \"mysql -u root -e 'show databases' | grep information_schema\" # \u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u7a7a\u306e\u5834\u5408\n    command <<-EOL\n        mysqladmin -u root password \"password\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.user WHERE User='';\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.user WHERE User='root' AND Host NOT IN ('localhost', '127.0.0.1');\"\n        mysql -u root -ppassword -e \"DROP DATABASE test;\"\n        mysql -u root -ppassword -e \"DELETE FROM mysql.db WHERE Db='test' OR Db='test\\\\_%';\"\n        mysql -u root -ppassword -e \"FLUSH PRIVILEGES;\"\n    EOL\nend\n```\n\n```rb:recipe-lamp/cookbooks/php/default.rb \n# PHP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'php'\n\n# PHP\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'php-mysqlnd php-gd php-intl php-mbstring'\n\n# php.ini\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'php.ini backup' do\n    command 'cp /etc/php.ini /etc/php.ini.org'\nend\n```\n\n```rb:recipe-lamp/cookbooks/phpmyadmin/default.rb\n# phpMyAdmin\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npackage 'phpMyAdmin'\n\n# phpMyAdmin\u6a29\u9650\u8a2d\u5b9a\nexecute 'phpMyAdmin permission' do\n    command <<-EOL\n    chown -R root:apache /usr/share/phpMyAdmin/\n    EOL\nend\n\n# phpMyAdmin.conf\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nexecute 'phpMyAdmin.conf backup' do\n    command 'cp /etc/httpd/conf.d/phpMyAdmin.conf /etc/httpd/conf.d/phpMyAdmin.conf.org'\nend\n\n# phpMyAdmin.conf\u306e\u8a2d\u5b9a\nfile '/etc/httpd/conf.d/phpMyAdmin.conf' do\n    action :edit\n    block do |content|\n        content.gsub!(\"Allow from ::1\", \"Allow from ::1\\n     Allow from 192.168.\")\n    end\nend\n```\n\n## LAMP\u74b0\u5883\u8d77\u52d5\n```bash:CentOS\u4eee\u60f3\u74b0\u5883\u8d77\u52d5\ncd ~/Vagrant/CentOS65/recipe-lamp/\nvagrant up\n```\n\n```bash:LAMP\u74b0\u5883\u69cb\u7bc9\nitamae ssh --vagrant set.rb\n```\n\n\u3053\u308c\u3067\nhttp://192.168.33.10/\n\u3068\nhttp://192.168.33.10/phpmyadmin/\n\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3002\nphpmyadmin\u306froot\u3001password\u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n## \u53c2\u8003\n[Chef-solo\u304b\u3089Itamae\u306b\u5b8c\u5168\u79fb\u884c\u3057\u305f\u8a71](http://qiita.com/toritori0318/items/00ea2a75c8321aaf9ef6)\n[Vagrant\u306e\u57fa\u672c](http://qiita.com/kidach1/items/e63c1607705178aa257c)\n[\u30af\u30c3\u30af\u30d1\u30c3\u30c9\u306e\u30b5\u30fc\u30d0\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u4e8b\u60c5](http://techlife.cookpad.com/entry/2015/05/12/080000#f-d0cb48da)\n[LAMP\u74b0\u5883\u69cb\u7bc9itamae\u30ec\u30b7\u30d4\u3092\u4f5c\u3063\u3066\u307f\u308b](http://blog.shuusetu.com/?p=208)\n[Itamae\u306eedit\u30a2\u30af\u30b7\u30e7\u30f3\u304c\u4fbf\u5229](http://qiita.com/namusyaka/items/b7061d2f7be441b7f19b)\n[Itamae\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8](http://qiita.com/fukuiretu/items/170aa956731f2ffb5715)\n"}