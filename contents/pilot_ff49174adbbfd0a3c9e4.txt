{"tags": ["TreasureData", "digdag", "Embulk"], "context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nTreasureData\u306b\u306f\u8272\u3005\u306a\u65b9\u6cd5\u3067\u63a5\u7d9a\u3059\u308b(td\u30b3\u30de\u30f3\u30c9\u3001embulk\u30b3\u30de\u30f3\u30c9\u3001Digdag\u306etd>\u3001Digdag\u306eembulk>)\n\u540c\u3058TreasureData\u63a5\u7d9a\u60c5\u5831(\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30fbAPI\u30ad\u30fc)\u3092\u8907\u6570\u7b87\u6240\u306b\u91cd\u8907\u3057\u3066\u66f8\u304f\u306e\u306f\u3067\u304d\u308b\u3060\u3051\u907f\u3051\u305f\u3044\n\n\u7d50\u679c\n~/.td/td.conf\u306b\u66f8\u3044\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\u306a\u7b87\u6240\u3068\u7121\u52b9\u306a\u7b87\u6240\u304c\u3042\u3063\u305f\n\n\u6709\u52b9\n\n\ntd\u30b3\u30de\u30f3\u30c9\nDigdag\u306etd>(\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9)\n\n\n\u7121\u52b9\n\n\nDigdag\u306etd>(\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9)\nEmbulk\u306eembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\nEmbulk\u306eembulk-output-td\u30d7\u30e9\u30b0\u30a4\u30f3\n\n\n\nDigdag\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9\u306b\u52b9\u304b\u306a\u3044\u306e\u306f\u7d0d\u5f97\u304c\u884c\u304f\nEmbulk\u306etd\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u52b9\u304b\u306a\u3044\u306e\u306f\u6b8b\u5ff5\n\u6539\u5584\u3057\u3066\u9802\u3051\u308b\u3068\u5b09\u3057\u3044\n\n\u3084\u3063\u305f\u3053\u3068\n\n\u4f5c\u6210\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306fhttps://\u3092\u3064\u3051\u308b\u3053\u3068(\u3064\u3051\u306a\u3044\u3068\u30a8\u30e9\u30fc)\n$ id\nuid=500(vagrant) gid=500(vagrant) groups=500(vagrant) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n$ pwd\n/home/vagrant\n$ td --version\n0.15.0\n$ ls .td\nls: cannot access .td: No such file or directory\n$ td -e https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e account\nEnter your Treasure Data credentials. For Google SSO user, please see https://docs.treasuredata.com/articles/command-line#google-sso-users\nEmail: \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\nPassword (typing will be hidden): \uff1c\u30d1\u30b9\u30ef\u30fc\u30c9\uff1e\nAuthenticated successfully.\nUse 'td -e https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e db:create <db_name>' to create a database.\n$ ls .td\ntd.conf\n$ cat .td/td.conf\n[account]\n  user = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\n  apikey = \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n\n\u5b9f\u306fvagrant\u5b9f\u884c\u6642\u306b\u306f\u3053\u306etd.conf\u3092\u76f4\u63a5\u4f5c\u3063\u3066\u3044\u308b\n(td account\u3092\u5b9f\u884c\u3057\u3066\u3082\u4f5c\u308c\u308b\u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u3092Vagrantfile\u306b\u66f8\u304f\u306e\u304cAPI\u30ad\u30fc\u3092\u66f8\u304f\u3088\u308a\u62b5\u6297\u304c\u5f37\u304b\u3063\u305f\u304b\u3089)\n  config.vm.provision \"shell\", privileged: false, inline: <<-EOT\n    mkdir                                         ~/.td\n    echo '[account]'                           >  ~/.td/td.conf\n    echo 'user     = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e'              >> ~/.td/td.conf\n    echo 'apikey   = \uff1cAPI\u30ad\u30fc\uff1e'               >> ~/.td/td.conf\n    echo 'endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e' >> ~/.td/td.conf\n  EOT\n\n\ntd\u30b3\u30de\u30f3\u30c9\n\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\n$ cat xxx.sql\nSELECT COUNT(*) AS count FROM xxx\n$ td query -d xxx -w -q xxx.sql\nJob 9999999 is queued.\nUse 'td job:show 9999999' to show the status.\nqueued...\n\uff5e\u4e2d\u7565\uff5e\nStatus      : success\nResult      :\n+-------+\n| count |\n+-------+\n| 42    |\n+-------+\n1 row in set\n\n\nDigdag\u306etd>(\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9)\n\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\n$ cat xxx.dig\n+task1:\n   td>: xxx.sql\n   database: xxx\n   store_last_results: true\n+task2:\n   echo>: ${td.last_results.count}\n$ digdag run xxx.dig\n2016-10-26 10:56:52 +0900: Digdag v0.8.17\n2016-10-26 10:56:55 +0900 [WARN] (main): Using a new session time 2016-10-26T00:00:00+00:00.\n2016-10-26 10:56:55 +0900 [INFO] (main): Using session /tmp/test/.digdag/status/20161026T000000+0000.\n2016-10-26 10:56:55 +0900 [INFO] (main): Starting a new session project id=1 workflow name=xxx session_time=2016-10-26T00:00:00+00:00\n2016-10-26 10:56:58 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:56:59 +0900 [INFO] (0016@+xxx+task1): td-client version: 0.7.26\n2016-10-26 10:56:59 +0900 [INFO] (0016@+xxx+task1): Logging initialized @6699ms\n2016-10-26 10:57:00 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:57:01 +0900 [INFO] (0016@+xxx+task1): Started presto job id=9999999:\nSELECT COUNT(*) AS count FROM xxx\n\n2016-10-26 10:57:04 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:57:06 +0900 [INFO] (0016@+xxx+task2): echo>: 42\n42\nSuccess. Task state is saved at /tmp/test/.digdag/status/20161026T000000+0000 directory.\n  * Use --session <daily | hourly | \"yyyy-MM-dd[ HH:mm:ss]\"> to not reuse the last session time.\n  * Use --rerun, --start +NAME, or --goal +NAME argument to rerun skipped tasks.\n\n\nDigdag\u306etd>(\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9)\n\u4ee5\u4e0b\u306e\u901a\u308a\u7121\u52b9\n$ cat ~/.config/digdag/config\nclient.http.endpoint = http://\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e:\uff1c\u30dd\u30fc\u30c8\u756a\u53f7\uff1e/\n$ digdag push proj1\n2016-10-27 12:27:30 +0900: Digdag v0.8.17\nCreating .digdag/tmp/archive-7184579153809927090.tar.gz...\n  Archiving xxx.dig\n  Archiving xxx.sql\nWorkflows:\n  xxx\n\nUploaded:\n  id: 10\n  name: proj1\n  revision: a5b35e9e-8ae5-4942-af2a-7b0a4ed12c3d\n  archive type: db\n  project created at: 2016-10-27T03:27:33Z\n  revision updated at: 2016-10-27T03:27:33Z\n\nUse `digdag workflows` to show all workflows.\n$ digdag start proj1 xxx --session now\n2016-10-27 12:28:16 +0900: Digdag v0.8.17\nStarted a session attempt:\n  session id: 112\n  attempt id: 111\n  uuid: 4ed676b1-01bf-4dee-ba5d-d9b5e032588d\n  project: proj1\n  workflow: xxx\n  session time: 2016-10-27 03:28:19 +0000\n  retry attempt name:\n  params: {}\n  created at: 2016-10-27 12:28:19 +0900\n\n* Use `digdag session 112` to show session status.\n* Use `digdag task 111` and `digdag log 111` to show task status and logs.\n$ digdag log 111\n2016-10-27 12:29:32 +0900: Digdag v0.8.17\n2016-10-27 12:28:22.488 +0900 [INFO] (0074@+xxx+task1) io.digdag.core.agent.OperatorManager: td>: xxx.sql\n2016-10-27 12:28:23.146 +0900 [INFO] (0074@+xxx+task1) com.treasuredata.client.TDClient: td-client version: 0.7.26\n2016-10-27 12:28:23.161 +0900 [ERROR] (0074@+xxx+task1) io.digdag.core.agent.OperatorManager: Configuration error at task +xxx+task1: The 'td.apikey' secret is missing (config)\n2016-10-27 12:28:23.971 +0900 [INFO] (0074@+xxx^failure-alert) io.digdag.core.agent.OperatorManager: type: notify\n$ ssh \uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e ps -ef|grep digdag\nvagrant@\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e's password:\nvagrant   1524     1  2 12:18 ?        00:00:16 java -XX:+AggressiveOpts -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xverify:none -jar /usr/local/bin/digdag server -c /home/vagrant/.config/digdag/config -O /home/vagrant/digdag-server/task-log\n$ ssh \uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e cat ~/.td/td.conf\nvagrant@\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e's password:\n[account]\n  user = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\n  apikey = \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n$ digdag version\n2016-10-27 12:34:41 +0900: Digdag v0.8.17\nClient version: 0.8.17\nServer version: 0.8.17\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b~/.td/td.conf\u304c\u3042\u3063\u3066\u3082\u305d\u308c\u306f\u30b5\u30fc\u30d0\u3067\u306e\u5b9f\u884c\u6642\u306b\u306f\u898b\u306a\u3044\nDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u3067\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u30e6\u30fc\u30b6\u306e~/.td/td.conf\u304c\u3042\u3063\u3066\u3082\u305d\u308c\u306f\u30b5\u30fc\u30d0\u3067\u306e\u5b9f\u884c\u6642\u306b\u306f\u898b\u306a\u3044\n\u30b5\u30fc\u30d0\u306b\u306f\u8907\u6570\u30e6\u30fc\u30b6\u304b\u3089\u8907\u6570\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306epush\u304c\u3042\u308a\u3001\u305d\u308c\u3089\u306f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30fbAPI\u30ad\u30fc\u3092\u5171\u901a\u4f7f\u7528\u3059\u3079\u304d\u3067\u306a\u3044\u304b\u3089\u3001\u3068\u3044\u3046\u3053\u3068\u304b\n\nEmbulk\u306eembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\n\u307e\u305a\u52d5\u304f\u4f8b\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306fhttps://\u3092\u3064\u3051\u306a\u3044\u3053\u3068(\u3064\u3051\u308b\u3068\u30a8\u30e9\u30fc)\n$ cat input.yml\nin:\n  type: td\n  apikey: \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n  database: xxx\n  query: SELECT * FROM xxx\nout:\n  type: file\n  path_prefix: xxx\n  file_ext: csv\n  formatter:\n    type: csv\n    header_line: true\n$ embulk run input.yml\n2016-10-27 12:43:01.916 +0900: Embulk v0.8.14\n2016-10-27 12:43:06.817 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\n2016-10-27 12:43:06.925 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 12:43:06.938 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 12:43:07.006 +0900 [INFO] (0001:transaction): Logging initialized @13514ms\n2016-10-27 12:43:07.648 +0900 [INFO] (0001:transaction): Submit a query for database 'xxx': SELECT * FROM xxx\n2016-10-27 12:43:08.650 +0900 [INFO] (0001:transaction): Job 8065368 is queued.\n2016-10-27 12:43:08.650 +0900 [INFO] (0001:transaction): Confirm that job 8065368 finished\n2016-10-27 12:43:14.317 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 12:43:14.460 +0900 [INFO] (0001:transaction): {done:  0 / 1, running: 0}\n2016-10-27 12:43:14.668 +0900 [INFO] (0023:task-0000): Writing local file 'xxx000.00.csv'\n2016-10-27 12:43:15.141 +0900 [INFO] (0001:transaction): {done:  1 / 1, running: 0}\n2016-10-27 12:43:15.168 +0900 [INFO] (main): Committed.\n2016-10-27 12:43:15.170 +0900 [INFO] (main): Next config diff: {\"in\":{},\"out\":{}}\n\nReading configuration file: /home/vagrant/.td/td.conf\u3068\u3042\u308b\u306e\u3067API\u30ad\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092td.conf\u304b\u3089\u53d6\u5f97\u3057\u3066\u304f\u308c\u305d\u3046\n\u3057\u304b\u3057endpoint\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\nhttps://github.com/muga/embulk-input-td#configuration \u306b\u3042\u308b\u3088\u3046\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e api.treasuredata.com \u306b\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3060\u308d\u3046\n$ embulk run input.yml\n2016-10-27 12:46:48.242 +0900: Embulk v0.8.14\n2016-10-27 12:46:52.945 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\n2016-10-27 12:46:53.061 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 12:46:53.068 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 12:46:53.158 +0900 [INFO] (0001:transaction): Logging initialized @13498ms\n2016-10-27 12:46:53.743 +0900 [INFO] (0001:transaction): Submit a query for database 'xxx': SELECT * FROM xxx\n2016-10-27 12:46:55.023 +0900 [WARN] (0001:transaction): API request failed\njava.util.concurrent.ExecutionException: org.eclipse.jetty.client.HttpResponseException: HTTP protocol violation: Authentication challenge without WWW-Authenticate header\n        at org.eclipse.jetty.client.util.FutureResponseListener.getResult(FutureResponseListener.java:118) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n        at org.eclipse.jetty.client.util.FutureResponseListener.get(FutureResponseListener.java:101) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n\uff5e\u7565\uff5e\n\nendpoint\u3092\u623b\u3057\u3066apikey\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u3082\u30a8\u30e9\u30fc\nhttps://github.com/muga/embulk-input-td#configuration \u306bapikey\u306f\u5fc5\u9808\u3068\u3042\u308b\n$ embulk run input.yml\n2016-10-27 12:49:09.632 +0900: Embulk v0.8.14\n2016-10-27 12:49:14.507 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\norg.embulk.exec.PartialExecutionException: org.embulk.config.ConfigException: com.fasterxml.jackson.databind.JsonMappingException: Field 'apikey' is required but not set\n at [Source: N/A; line: -1, column: -1]\n        at org.embulk.exec.BulkLoader$LoaderState.buildPartialExecuteException(org/embulk/exec/BulkLoader.java:363)\n\n\nEmbulk\u306eembulk-output-td\u30d7\u30e9\u30b0\u30a4\u30f3\nembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u7d50\u679c\u306f\u540c\u3058\n$ cat output_for_guess.yml\nin:\n type: file\n path_prefix: xxx\nout:\n  type: td\n  apikey: \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n  database: xxx\n  table: xxx2\n  mode: truncate\n$ embulk guess output_for_guess.yml -o output.yml\n2016-10-27 13:01:49.899 +0900: Embulk v0.8.14\n2016-10-27 13:01:51.835 +0900 [INFO] (0001:guess): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:01:51.839 +0900 [INFO] (0001:guess): Loading files [xxx000.00.csv]\n2016-10-27 13:01:52.038 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/gzip from a load path\n2016-10-27 13:01:52.062 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/bzip2 from a load path\n2016-10-27 13:01:52.102 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/json from a load path\n2016-10-27 13:01:52.119 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/csv from a load path\nin:\n  type: file\n  path_prefix: xxx\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: col1, type: string}\n    - {name: col2, type: string}\n    - {name: time, type: long}\nout: {type: td, apikey: \uff1cAPI\u30ad\u30fc\uff1e, endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e,\n  database: xxx, table: xxx2, mode: truncate}\nCreated 'output.yml' file.\n$ embulk run output.yml\n2016-10-27 13:02:22.364 +0900: Embulk v0.8.14\n2016-10-27 13:02:27.395 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:02:27.511 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:02:27.522 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:02:27.690 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 13:02:27.803 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 13:02:27.815 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 13:02:27.887 +0900 [INFO] (0001:transaction): Logging initialized @13895ms\n2016-10-27 13:02:29.793 +0900 [INFO] (0001:transaction): Using time:long column as the data partitioning key\n2016-10-27 13:02:29.796 +0900 [INFO] (0001:transaction): Create bulk_import session embulk_20161027_040227_014000000\n2016-10-27 13:02:30.176 +0900 [INFO] (0001:transaction): {done:  0 / 1, running: 0}\n2016-10-27 13:02:30.540 +0900 [INFO] (0022:task-0000): {uploading: {rows: 20, size: 1,166 bytes (compressed)}}\n2016-10-27 13:02:30.974 +0900 [INFO] (0001:transaction): {done:  1 / 1, running: 0}\n2016-10-27 13:02:31.761 +0900 [INFO] (0001:transaction): Performing bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:12.793 +0900 [INFO] (0001:transaction):     job id: 8065734\n2016-10-27 13:03:13.262 +0900 [INFO] (0001:transaction): Committing bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     valid records: 20\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     error records: 0\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     valid parts: 1\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     error parts: 0\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     new columns:\n2016-10-27 13:03:13.265 +0900 [INFO] (0001:transaction):       - col1: string\n2016-10-27 13:03:13.266 +0900 [INFO] (0001:transaction):       - col2: string\n2016-10-27 13:03:20.469 +0900 [INFO] (0001:transaction): Deleting bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:20.876 +0900 [INFO] (main): Committed.\n2016-10-27 13:03:20.877 +0900 [INFO] (main): Next config diff: {\"in\":{\"last_path\":\"xxx000.00.csv\"},\"out\":{\"last_session\":\"embulk_20161027_040227_014000000\"}}\n$ vi output.yml # endpoint\u5b9a\u7fa9\u524a\u9664\n$ embulk run output.yml\n2016-10-27 13:07:21.973 +0900: Embulk v0.8.14\n2016-10-27 13:07:26.872 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:07:26.993 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:07:27.004 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:07:27.159 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 13:07:27.271 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 13:07:27.277 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 13:07:27.345 +0900 [INFO] (0001:transaction): Logging initialized @13797ms\n2016-10-27 13:07:29.389 +0900 [WARN] (0001:transaction): API request failed\njava.util.concurrent.ExecutionException: org.eclipse.jetty.client.HttpResponseException: HTTP protocol violation: Authentication challenge without WWW-Authenticate header\n        at org.eclipse.jetty.client.util.FutureResponseListener.getResult(FutureResponseListener.java:118) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n\uff5e\u7565\uff5e\n$ vi output.yml # apikey\u5b9a\u7fa9\u524a\u9664\n$ embulk run output.yml\n2016-10-27 13:08:38.456 +0900: Embulk v0.8.14\n2016-10-27 13:08:43.483 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:08:43.607 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:08:43.617 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:08:43.788 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\norg.embulk.exec.PartialExecutionException: org.embulk.config.ConfigException: com.fasterxml.jackson.databind.JsonMappingException: Field 'apikey' is required but not set\n at [Source: N/A; line: -1, column: -1]\n        at org.embulk.exec.BulkLoader$LoaderState.buildPartialExecuteException(org/embulk/exec/BulkLoader.java:363)\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n===========\n\nTreasureData\u306b\u306f\u8272\u3005\u306a\u65b9\u6cd5\u3067\u63a5\u7d9a\u3059\u308b(td\u30b3\u30de\u30f3\u30c9\u3001embulk\u30b3\u30de\u30f3\u30c9\u3001Digdag\u306etd>\u3001Digdag\u306eembulk>)\n\u540c\u3058TreasureData\u63a5\u7d9a\u60c5\u5831(\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30fbAPI\u30ad\u30fc)\u3092\u8907\u6570\u7b87\u6240\u306b\u91cd\u8907\u3057\u3066\u66f8\u304f\u306e\u306f\u3067\u304d\u308b\u3060\u3051\u907f\u3051\u305f\u3044\n\n\u7d50\u679c\n====\n\n~/.td/td.conf\u306b\u66f8\u3044\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\u306a\u7b87\u6240\u3068\u7121\u52b9\u306a\u7b87\u6240\u304c\u3042\u3063\u305f\n\n1. \u6709\u52b9\n    1. td\u30b3\u30de\u30f3\u30c9\n    1. Digdag\u306etd>(\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9)\n1. \u7121\u52b9\n    1. Digdag\u306etd>(\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9)\n    1. Embulk\u306eembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\n    1. Embulk\u306eembulk-output-td\u30d7\u30e9\u30b0\u30a4\u30f3\n\nDigdag\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9\u306b\u52b9\u304b\u306a\u3044\u306e\u306f\u7d0d\u5f97\u304c\u884c\u304f\n\nEmbulk\u306etd\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u52b9\u304b\u306a\u3044\u306e\u306f\u6b8b\u5ff5\n\u6539\u5584\u3057\u3066\u9802\u3051\u308b\u3068\u5b09\u3057\u3044\n\n\u3084\u3063\u305f\u3053\u3068\n=========\n\n\u4f5c\u6210\n----\n\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306f`https://`\u3092\u3064\u3051\u308b\u3053\u3068(\u3064\u3051\u306a\u3044\u3068\u30a8\u30e9\u30fc)\n\n```\n$ id\nuid=500(vagrant) gid=500(vagrant) groups=500(vagrant) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n$ pwd\n/home/vagrant\n$ td --version\n0.15.0\n$ ls .td\nls: cannot access .td: No such file or directory\n$ td -e https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e account\nEnter your Treasure Data credentials. For Google SSO user, please see https://docs.treasuredata.com/articles/command-line#google-sso-users\nEmail: \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\nPassword (typing will be hidden): \uff1c\u30d1\u30b9\u30ef\u30fc\u30c9\uff1e\nAuthenticated successfully.\nUse 'td -e https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e db:create <db_name>' to create a database.\n$ ls .td\ntd.conf\n$ cat .td/td.conf\n[account]\n  user = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\n  apikey = \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n```\n\n\u5b9f\u306fvagrant\u5b9f\u884c\u6642\u306b\u306f\u3053\u306etd.conf\u3092\u76f4\u63a5\u4f5c\u3063\u3066\u3044\u308b\n(td account\u3092\u5b9f\u884c\u3057\u3066\u3082\u4f5c\u308c\u308b\u304c\u30d1\u30b9\u30ef\u30fc\u30c9\u3092Vagrantfile\u306b\u66f8\u304f\u306e\u304cAPI\u30ad\u30fc\u3092\u66f8\u304f\u3088\u308a\u62b5\u6297\u304c\u5f37\u304b\u3063\u305f\u304b\u3089)\n\n```\n  config.vm.provision \"shell\", privileged: false, inline: <<-EOT\n    mkdir                                         ~/.td\n    echo '[account]'                           >  ~/.td/td.conf\n    echo 'user     = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e'              >> ~/.td/td.conf\n    echo 'apikey   = \uff1cAPI\u30ad\u30fc\uff1e'               >> ~/.td/td.conf\n    echo 'endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e' >> ~/.td/td.conf\n  EOT\n```\n\ntd\u30b3\u30de\u30f3\u30c9\n---------\n\n\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\n\n```\n$ cat xxx.sql\nSELECT COUNT(*) AS count FROM xxx\n$ td query -d xxx -w -q xxx.sql\nJob 9999999 is queued.\nUse 'td job:show 9999999' to show the status.\nqueued...\n\uff5e\u4e2d\u7565\uff5e\nStatus      : success\nResult      :\n+-------+\n| count |\n+-------+\n| 42    |\n+-------+\n1 row in set\n```\n\nDigdag\u306etd>(\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9)\n--------------------------\n\n\u4ee5\u4e0b\u306e\u901a\u308a\u6709\u52b9\n\n```\n$ cat xxx.dig\n+task1:\n   td>: xxx.sql\n   database: xxx\n   store_last_results: true\n+task2:\n   echo>: ${td.last_results.count}\n$ digdag run xxx.dig\n2016-10-26 10:56:52 +0900: Digdag v0.8.17\n2016-10-26 10:56:55 +0900 [WARN] (main): Using a new session time 2016-10-26T00:00:00+00:00.\n2016-10-26 10:56:55 +0900 [INFO] (main): Using session /tmp/test/.digdag/status/20161026T000000+0000.\n2016-10-26 10:56:55 +0900 [INFO] (main): Starting a new session project id=1 workflow name=xxx session_time=2016-10-26T00:00:00+00:00\n2016-10-26 10:56:58 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:56:59 +0900 [INFO] (0016@+xxx+task1): td-client version: 0.7.26\n2016-10-26 10:56:59 +0900 [INFO] (0016@+xxx+task1): Logging initialized @6699ms\n2016-10-26 10:57:00 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:57:01 +0900 [INFO] (0016@+xxx+task1): Started presto job id=9999999:\nSELECT COUNT(*) AS count FROM xxx\n\n2016-10-26 10:57:04 +0900 [INFO] (0016@+xxx+task1): td>: xxx.sql\n2016-10-26 10:57:06 +0900 [INFO] (0016@+xxx+task2): echo>: 42\n42\nSuccess. Task state is saved at /tmp/test/.digdag/status/20161026T000000+0000 directory.\n  * Use --session <daily | hourly | \"yyyy-MM-dd[ HH:mm:ss]\"> to not reuse the last session time.\n  * Use --rerun, --start +NAME, or --goal +NAME argument to rerun skipped tasks.\n```\n\nDigdag\u306etd>(\u30b5\u30fc\u30d0\u30e2\u30fc\u30c9)\n------------------------\n\n\u4ee5\u4e0b\u306e\u901a\u308a\u7121\u52b9\n\n```\n$ cat ~/.config/digdag/config\nclient.http.endpoint = http://\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e:\uff1c\u30dd\u30fc\u30c8\u756a\u53f7\uff1e/\n$ digdag push proj1\n2016-10-27 12:27:30 +0900: Digdag v0.8.17\nCreating .digdag/tmp/archive-7184579153809927090.tar.gz...\n  Archiving xxx.dig\n  Archiving xxx.sql\nWorkflows:\n  xxx\n\nUploaded:\n  id: 10\n  name: proj1\n  revision: a5b35e9e-8ae5-4942-af2a-7b0a4ed12c3d\n  archive type: db\n  project created at: 2016-10-27T03:27:33Z\n  revision updated at: 2016-10-27T03:27:33Z\n\nUse `digdag workflows` to show all workflows.\n$ digdag start proj1 xxx --session now\n2016-10-27 12:28:16 +0900: Digdag v0.8.17\nStarted a session attempt:\n  session id: 112\n  attempt id: 111\n  uuid: 4ed676b1-01bf-4dee-ba5d-d9b5e032588d\n  project: proj1\n  workflow: xxx\n  session time: 2016-10-27 03:28:19 +0000\n  retry attempt name:\n  params: {}\n  created at: 2016-10-27 12:28:19 +0900\n\n* Use `digdag session 112` to show session status.\n* Use `digdag task 111` and `digdag log 111` to show task status and logs.\n$ digdag log 111\n2016-10-27 12:29:32 +0900: Digdag v0.8.17\n2016-10-27 12:28:22.488 +0900 [INFO] (0074@+xxx+task1) io.digdag.core.agent.OperatorManager: td>: xxx.sql\n2016-10-27 12:28:23.146 +0900 [INFO] (0074@+xxx+task1) com.treasuredata.client.TDClient: td-client version: 0.7.26\n2016-10-27 12:28:23.161 +0900 [ERROR] (0074@+xxx+task1) io.digdag.core.agent.OperatorManager: Configuration error at task +xxx+task1: The 'td.apikey' secret is missing (config)\n2016-10-27 12:28:23.971 +0900 [INFO] (0074@+xxx^failure-alert) io.digdag.core.agent.OperatorManager: type: notify\n$ ssh \uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e ps -ef|grep digdag\nvagrant@\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e's password:\nvagrant   1524     1  2 12:18 ?        00:00:16 java -XX:+AggressiveOpts -XX:+TieredCompilation -XX:TieredStopAtLevel=1 -Xverify:none -jar /usr/local/bin/digdag server -c /home/vagrant/.config/digdag/config -O /home/vagrant/digdag-server/task-log\n$ ssh \uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e cat ~/.td/td.conf\nvagrant@\uff1cDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u306eIP\u30a2\u30c9\u30ec\u30b9\uff1e's password:\n[account]\n  user = \uff1c\u30e6\u30fc\u30b6\u540d\uff1e\n  apikey = \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint = https://\uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n$ digdag version\n2016-10-27 12:34:41 +0900: Digdag v0.8.17\nClient version: 0.8.17\nServer version: 0.8.17\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b~/.td/td.conf\u304c\u3042\u3063\u3066\u3082\u305d\u308c\u306f\u30b5\u30fc\u30d0\u3067\u306e\u5b9f\u884c\u6642\u306b\u306f\u898b\u306a\u3044\n\nDigdag\u30b5\u30fc\u30d0\u30de\u30b7\u30f3\u3067\u30b5\u30fc\u30d0\u30d7\u30ed\u30bb\u30b9\u30e6\u30fc\u30b6\u306e~/.td/td.conf\u304c\u3042\u3063\u3066\u3082\u305d\u308c\u306f\u30b5\u30fc\u30d0\u3067\u306e\u5b9f\u884c\u6642\u306b\u306f\u898b\u306a\u3044\n\u30b5\u30fc\u30d0\u306b\u306f\u8907\u6570\u30e6\u30fc\u30b6\u304b\u3089\u8907\u6570\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306epush\u304c\u3042\u308a\u3001\u305d\u308c\u3089\u306f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30fbAPI\u30ad\u30fc\u3092\u5171\u901a\u4f7f\u7528\u3059\u3079\u304d\u3067\u306a\u3044\u304b\u3089\u3001\u3068\u3044\u3046\u3053\u3068\u304b\n\nEmbulk\u306eembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\n--------------------------------\n\n\u307e\u305a\u52d5\u304f\u4f8b\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u306f`https://`\u3092\u3064\u3051\u306a\u3044\u3053\u3068(\u3064\u3051\u308b\u3068\u30a8\u30e9\u30fc)\n\n```\n$ cat input.yml\nin:\n  type: td\n  apikey: \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n  database: xxx\n  query: SELECT * FROM xxx\nout:\n  type: file\n  path_prefix: xxx\n  file_ext: csv\n  formatter:\n    type: csv\n    header_line: true\n$ embulk run input.yml\n2016-10-27 12:43:01.916 +0900: Embulk v0.8.14\n2016-10-27 12:43:06.817 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\n2016-10-27 12:43:06.925 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 12:43:06.938 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 12:43:07.006 +0900 [INFO] (0001:transaction): Logging initialized @13514ms\n2016-10-27 12:43:07.648 +0900 [INFO] (0001:transaction): Submit a query for database 'xxx': SELECT * FROM xxx\n2016-10-27 12:43:08.650 +0900 [INFO] (0001:transaction): Job 8065368 is queued.\n2016-10-27 12:43:08.650 +0900 [INFO] (0001:transaction): Confirm that job 8065368 finished\n2016-10-27 12:43:14.317 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 12:43:14.460 +0900 [INFO] (0001:transaction): {done:  0 / 1, running: 0}\n2016-10-27 12:43:14.668 +0900 [INFO] (0023:task-0000): Writing local file 'xxx000.00.csv'\n2016-10-27 12:43:15.141 +0900 [INFO] (0001:transaction): {done:  1 / 1, running: 0}\n2016-10-27 12:43:15.168 +0900 [INFO] (main): Committed.\n2016-10-27 12:43:15.170 +0900 [INFO] (main): Next config diff: {\"in\":{},\"out\":{}}\n```\n\n`Reading configuration file: /home/vagrant/.td/td.conf`\u3068\u3042\u308b\u306e\u3067API\u30ad\u30fc\u30fb\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092td.conf\u304b\u3089\u53d6\u5f97\u3057\u3066\u304f\u308c\u305d\u3046\n\u3057\u304b\u3057endpoint\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\nhttps://github.com/muga/embulk-input-td#configuration \u306b\u3042\u308b\u3088\u3046\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e api.treasuredata.com \u306b\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3060\u308d\u3046\n\n```\n$ embulk run input.yml\n2016-10-27 12:46:48.242 +0900: Embulk v0.8.14\n2016-10-27 12:46:52.945 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\n2016-10-27 12:46:53.061 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 12:46:53.068 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 12:46:53.158 +0900 [INFO] (0001:transaction): Logging initialized @13498ms\n2016-10-27 12:46:53.743 +0900 [INFO] (0001:transaction): Submit a query for database 'xxx': SELECT * FROM xxx\n2016-10-27 12:46:55.023 +0900 [WARN] (0001:transaction): API request failed\njava.util.concurrent.ExecutionException: org.eclipse.jetty.client.HttpResponseException: HTTP protocol violation: Authentication challenge without WWW-Authenticate header\n        at org.eclipse.jetty.client.util.FutureResponseListener.getResult(FutureResponseListener.java:118) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n        at org.eclipse.jetty.client.util.FutureResponseListener.get(FutureResponseListener.java:101) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n\uff5e\u7565\uff5e\n```\n\nendpoint\u3092\u623b\u3057\u3066apikey\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u3082\u30a8\u30e9\u30fc\nhttps://github.com/muga/embulk-input-td#configuration \u306bapikey\u306f\u5fc5\u9808\u3068\u3042\u308b\n\n```\n$ embulk run input.yml\n2016-10-27 12:49:09.632 +0900: Embulk v0.8.14\n2016-10-27 12:49:14.507 +0900 [INFO] (0001:transaction): Loaded plugin embulk-input-td (0.1.0)\norg.embulk.exec.PartialExecutionException: org.embulk.config.ConfigException: com.fasterxml.jackson.databind.JsonMappingException: Field 'apikey' is required but not set\n at [Source: N/A; line: -1, column: -1]\n        at org.embulk.exec.BulkLoader$LoaderState.buildPartialExecuteException(org/embulk/exec/BulkLoader.java:363)\n```\n\nEmbulk\u306eembulk-output-td\u30d7\u30e9\u30b0\u30a4\u30f3\n---------------------------------\n\nembulk-input-td\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u7d50\u679c\u306f\u540c\u3058\n\n```\n$ cat output_for_guess.yml\nin:\n type: file\n path_prefix: xxx\nout:\n  type: td\n  apikey: \uff1cAPI\u30ad\u30fc\uff1e\n  endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e\n  database: xxx\n  table: xxx2\n  mode: truncate\n$ embulk guess output_for_guess.yml -o output.yml\n2016-10-27 13:01:49.899 +0900: Embulk v0.8.14\n2016-10-27 13:01:51.835 +0900 [INFO] (0001:guess): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:01:51.839 +0900 [INFO] (0001:guess): Loading files [xxx000.00.csv]\n2016-10-27 13:01:52.038 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/gzip from a load path\n2016-10-27 13:01:52.062 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/bzip2 from a load path\n2016-10-27 13:01:52.102 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/json from a load path\n2016-10-27 13:01:52.119 +0900 [INFO] (0001:guess): Loaded plugin embulk/guess/csv from a load path\nin:\n  type: file\n  path_prefix: xxx\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: ','\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: col1, type: string}\n    - {name: col2, type: string}\n    - {name: time, type: long}\nout: {type: td, apikey: \uff1cAPI\u30ad\u30fc\uff1e, endpoint: \uff1c\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1e,\n  database: xxx, table: xxx2, mode: truncate}\nCreated 'output.yml' file.\n$ embulk run output.yml\n2016-10-27 13:02:22.364 +0900: Embulk v0.8.14\n2016-10-27 13:02:27.395 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:02:27.511 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:02:27.522 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:02:27.690 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 13:02:27.803 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 13:02:27.815 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 13:02:27.887 +0900 [INFO] (0001:transaction): Logging initialized @13895ms\n2016-10-27 13:02:29.793 +0900 [INFO] (0001:transaction): Using time:long column as the data partitioning key\n2016-10-27 13:02:29.796 +0900 [INFO] (0001:transaction): Create bulk_import session embulk_20161027_040227_014000000\n2016-10-27 13:02:30.176 +0900 [INFO] (0001:transaction): {done:  0 / 1, running: 0}\n2016-10-27 13:02:30.540 +0900 [INFO] (0022:task-0000): {uploading: {rows: 20, size: 1,166 bytes (compressed)}}\n2016-10-27 13:02:30.974 +0900 [INFO] (0001:transaction): {done:  1 / 1, running: 0}\n2016-10-27 13:02:31.761 +0900 [INFO] (0001:transaction): Performing bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:12.793 +0900 [INFO] (0001:transaction):     job id: 8065734\n2016-10-27 13:03:13.262 +0900 [INFO] (0001:transaction): Committing bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     valid records: 20\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     error records: 0\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     valid parts: 1\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     error parts: 0\n2016-10-27 13:03:13.263 +0900 [INFO] (0001:transaction):     new columns:\n2016-10-27 13:03:13.265 +0900 [INFO] (0001:transaction):       - col1: string\n2016-10-27 13:03:13.266 +0900 [INFO] (0001:transaction):       - col2: string\n2016-10-27 13:03:20.469 +0900 [INFO] (0001:transaction): Deleting bulk import session 'embulk_20161027_040227_014000000'\n2016-10-27 13:03:20.876 +0900 [INFO] (main): Committed.\n2016-10-27 13:03:20.877 +0900 [INFO] (main): Next config diff: {\"in\":{\"last_path\":\"xxx000.00.csv\"},\"out\":{\"last_session\":\"embulk_20161027_040227_014000000\"}}\n$ vi output.yml # endpoint\u5b9a\u7fa9\u524a\u9664\n$ embulk run output.yml\n2016-10-27 13:07:21.973 +0900: Embulk v0.8.14\n2016-10-27 13:07:26.872 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:07:26.993 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:07:27.004 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:07:27.159 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\n2016-10-27 13:07:27.271 +0900 [INFO] (0001:transaction): td-client version: 0.7.24\n2016-10-27 13:07:27.277 +0900 [INFO] (0001:transaction): Reading configuration file: /home/vagrant/.td/td.conf\n2016-10-27 13:07:27.345 +0900 [INFO] (0001:transaction): Logging initialized @13797ms\n2016-10-27 13:07:29.389 +0900 [WARN] (0001:transaction): API request failed\njava.util.concurrent.ExecutionException: org.eclipse.jetty.client.HttpResponseException: HTTP protocol violation: Authentication challenge without WWW-Authenticate header\n        at org.eclipse.jetty.client.util.FutureResponseListener.getResult(FutureResponseListener.java:118) ~[jetty-client-9.2.2.v20140723.jar:9.2.2.v20140723]\n\uff5e\u7565\uff5e\n$ vi output.yml # apikey\u5b9a\u7fa9\u524a\u9664\n$ embulk run output.yml\n2016-10-27 13:08:38.456 +0900: Embulk v0.8.14\n2016-10-27 13:08:43.483 +0900 [INFO] (0001:transaction): Loaded plugin embulk-output-td (0.3.8)\n2016-10-27 13:08:43.607 +0900 [INFO] (0001:transaction): Listing local files at directory '.' filtering filename by prefix 'xxx'\n2016-10-27 13:08:43.617 +0900 [INFO] (0001:transaction): Loading files [xxx000.00.csv]\n2016-10-27 13:08:43.788 +0900 [INFO] (0001:transaction): Using local thread executor with max_threads=2 / tasks=1\norg.embulk.exec.PartialExecutionException: org.embulk.config.ConfigException: com.fasterxml.jackson.databind.JsonMappingException: Field 'apikey' is required but not set\n at [Source: N/A; line: -1, column: -1]\n        at org.embulk.exec.BulkLoader$LoaderState.buildPartialExecuteException(org/embulk/exec/BulkLoader.java:363)\n```\n"}