{"tags": ["TestFlight", "Idobata", "iOS", "direnv"], "context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u50d5\u306f\u4eca\u306e\u3068\u3053\u308d Version (CFBundleShortVersionString) \u3092 1.0.0 \u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3001Build (CFBundleVersion) \u3092\u5358\u7d14\u306b\u30d3\u30eb\u30c9\u3054\u3068\u306b 1, 2, 3... \u3068\u9023\u756a\u3067\u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u3088\u3046\u306a\u904b\u7528\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nTestFlight \u306b\u6295\u3052\u308b\u3068\u304d\u306b\u308f\u3056\u308f\u3056\u624b\u52d5\u3067 Build \u3092\u4e0a\u3052\u3066\u3001git \u3067\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3001tag \u6253\u3063\u3066...\u3068\u3084\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u5316\u3057\u307e\u3057\u305f\u3002\n\n\u6e96\u5099\n\n\ndirenv \u304c\u5fc5\u8981\u3067\u3059 (brew install direnv \u3067\u5165\u308a\u307e\u3059)\n\nshenzhen \u304c\u5fc5\u8981\u3067\u3059 (gem install shenzhen \u3067\u5165\u308a\u307e\u3059)\n\n\n\u8a2d\u5b9a\n.envrc \u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u4f5c\u308a\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u30b3\u30df\u30c3\u30c8\u3057\u306a\u3044\u65b9\u304c\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\n.envrc\nexport PRODUCT_NAME=YOUR_PRODUCT_NAME\nexport TESTFLIGHT_API_TOKEN=YOUR_API_TOKEN\nexport TESTFLIGHT_TEAM_TOKEN=YOUR_TEAM_TOKEN\nexport TESTFLIGHT_DISTRIBUTION_LISTS=\"testers, developers\"\nexport IDOBATA_ENDPOINT_URL=YOUR_ENDPOINT_URL\n\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\n\nbuild.sh\n#!/bin/sh\n\n#\n# $ brew install direnv\n# $ cp dotenvrc .envrc && vim .envrc\n# $ gem install shenzhen && rbenv rehash\n# $ ./build.sh -m \"hoge\"\n#\n\n_usage() {\n  echo \"Usage:\"\n  echo \"${0} -m MESSAGE\"\n  exit 1\n}\n\nwhile getopts :m: OPT\ndo\n  case $OPT in\n    \"m\" ) FLG_M=\"TRUE\"; MESSAGE=\"$OPTARG\";;\n    :|\\?) _usage;;\n  esac\ndone\n\nshift `expr ${OPTIND} - 1`\n\n[ \"${FLG_M}\" != \"TRUE\" ] && _usage\n\n# bump build version\nplistFile=${PRODUCT_NAME}/${PRODUCT_NAME}-Info.plist\nbundleVersion=$(/usr/libexec/PlistBuddy -c \"Print CFBundleVersion\" $plistFile)\nshortVersion=$(/usr/libexec/PlistBuddy -c \"Print CFBundleShortVersionString\" $plistFile)\nbundleVersion=$(($bundleVersion + 1))\n/usr/libexec/PlistBuddy -c \"Set :CFBundleVersion $bundleVersion\" $plistFile\n\n# # commit && tag\ngit add $plistFile\ngit commit -m \"build $shortVersion($bundleVersion)\"\ngit tag $shortVersion-$bundleVersion\n\n# build\nipa build\n\n# testflight\nipafile=$(ls *.ipa)\ndsymfile=$(ls *.dSYM.zip)\nresponse=$(curl http://testflightapp.com/api/builds.json \\\n    -F file=@$ipafile \\\n    -F dsym=@$dsymfile \\\n    -F api_token=$TESTFLIGHT_API_TOKEN \\\n    -F team_token=$TESTFLIGHT_TEAM_TOKEN \\\n    -F notes=\"$MESSAGE\" \\\n    -F notify=True \\\n    -F distribution_lists=\"$TESTFLIGHT_DISTRIBUTION_LISTS\"\n  )\n\n# notify\ntitle=\"$PRODUCT_NAME $shortVersion($bundleVersion) is now available.\"\ncurl --data-urlencode \"source=<p>$title</p><pre>$response</pre>\" -d format=html $IDOBATA_ENDPOINT_URL\n\n\n## \u80cc\u666f\n\n\u50d5\u306f\u4eca\u306e\u3068\u3053\u308d Version (CFBundleShortVersionString) \u3092 1.0.0 \u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3001Build (CFBundleVersion) \u3092\u5358\u7d14\u306b\u30d3\u30eb\u30c9\u3054\u3068\u306b 1, 2, 3... \u3068\u9023\u756a\u3067\u30ab\u30a6\u30f3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u3088\u3046\u306a\u904b\u7528\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nTestFlight \u306b\u6295\u3052\u308b\u3068\u304d\u306b\u308f\u3056\u308f\u3056\u624b\u52d5\u3067 Build \u3092\u4e0a\u3052\u3066\u3001git \u3067\u30b3\u30df\u30c3\u30c8\u3057\u3066\u3001tag \u6253\u3063\u3066...\u3068\u3084\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u5316\u3057\u307e\u3057\u305f\u3002\n\n\n## \u6e96\u5099\n\n- [direnv](https://github.com/zimbatm/direnv) \u304c\u5fc5\u8981\u3067\u3059 (`brew install direnv` \u3067\u5165\u308a\u307e\u3059)\n- [shenzhen](https://github.com/nomad/shenzhen) \u304c\u5fc5\u8981\u3067\u3059 (`gem install shenzhen` \u3067\u5165\u308a\u307e\u3059)\n\n\n## \u8a2d\u5b9a\n\n.envrc \u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u4f5c\u308a\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u30b3\u30df\u30c3\u30c8\u3057\u306a\u3044\u65b9\u304c\u3044\u3044\u3067\u3057\u3087\u3046\u3002\n\n```bash:.envrc\nexport PRODUCT_NAME=YOUR_PRODUCT_NAME\nexport TESTFLIGHT_API_TOKEN=YOUR_API_TOKEN\nexport TESTFLIGHT_TEAM_TOKEN=YOUR_TEAM_TOKEN\nexport TESTFLIGHT_DISTRIBUTION_LISTS=\"testers, developers\"\nexport IDOBATA_ENDPOINT_URL=YOUR_ENDPOINT_URL\n```\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\n\n```bash:build.sh\n#!/bin/sh\n\n#\n# $ brew install direnv\n# $ cp dotenvrc .envrc && vim .envrc\n# $ gem install shenzhen && rbenv rehash\n# $ ./build.sh -m \"hoge\"\n#\n\n_usage() {\n  echo \"Usage:\"\n  echo \"${0} -m MESSAGE\"\n  exit 1\n}\n\nwhile getopts :m: OPT\ndo\n  case $OPT in\n    \"m\" ) FLG_M=\"TRUE\"; MESSAGE=\"$OPTARG\";;\n    :|\\?) _usage;;\n  esac\ndone\n\nshift `expr ${OPTIND} - 1`\n\n[ \"${FLG_M}\" != \"TRUE\" ] && _usage\n\n# bump build version\nplistFile=${PRODUCT_NAME}/${PRODUCT_NAME}-Info.plist\nbundleVersion=$(/usr/libexec/PlistBuddy -c \"Print CFBundleVersion\" $plistFile)\nshortVersion=$(/usr/libexec/PlistBuddy -c \"Print CFBundleShortVersionString\" $plistFile)\nbundleVersion=$(($bundleVersion + 1))\n/usr/libexec/PlistBuddy -c \"Set :CFBundleVersion $bundleVersion\" $plistFile\n\n# # commit && tag\ngit add $plistFile\ngit commit -m \"build $shortVersion($bundleVersion)\"\ngit tag $shortVersion-$bundleVersion\n\n# build\nipa build\n\n# testflight\nipafile=$(ls *.ipa)\ndsymfile=$(ls *.dSYM.zip)\nresponse=$(curl http://testflightapp.com/api/builds.json \\\n    -F file=@$ipafile \\\n    -F dsym=@$dsymfile \\\n    -F api_token=$TESTFLIGHT_API_TOKEN \\\n    -F team_token=$TESTFLIGHT_TEAM_TOKEN \\\n    -F notes=\"$MESSAGE\" \\\n    -F notify=True \\\n    -F distribution_lists=\"$TESTFLIGHT_DISTRIBUTION_LISTS\"\n  )\n\n# notify\ntitle=\"$PRODUCT_NAME $shortVersion($bundleVersion) is now available.\"\ncurl --data-urlencode \"source=<p>$title</p><pre>$response</pre>\" -d format=html $IDOBATA_ENDPOINT_URL\n```\n"}