{"context": " More than 1 year has passed since last update.\u3064\u304f\u3063\u3066\u307f\u305f\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\n\nhttps://github.com/kasei-san/hexo_server\n\n\n\u521d\u624b\n$ git init\n$ vagrant init\n\n\nOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6298\u89d2\u306a\u306e\u3067\u3001\u6700\u65b0\u306eCentOS\u3092\u5165\u308c\u3066\u307f\u308b\n\n\u30b5\u30fc\u30d0\u540d\u304c default \u306e\u307e\u307e\u3060\u3068\u3001serverspec \u306b\u5931\u6557\u3059\u308b\u306e\u3067\u5909\u66f4\n\u53c2\u8003 : Carousel is a lie!: \"Circular dependency detected\" error in ServerSpec\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# All Vagrant configuration is done below. The \"2\" in Vagrant.configure\n# configures the configuration version (we support older styles for\n# backwards compatibility). Please don't change it unless you know what\n# you're doing.\nVagrant.configure(2) do |config|\n  config.vm.box = \"chef/centos-7.0\"\n  config.vm.define :hexo_server do |hexo_server|\n  end\nend\n\n$ vagrant up\n\n\nOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ vagrant ssh\nLast login: Tue Jul 22 03:42:16 2014 from 10.0.2.2\n[vagrant@localhost ~]$ cat /etc/redhat-release\nCentOS Linux release 7.0.1406 (Core)\n\n\n.gitignore \u306b /.vagrant \u3092\u8ffd\u52a0\necho  \"/.vagrant/\" >> .gitignore\n\n\nserverspec \u5c0e\u5165\n\nbundle install\n$ bundle init\n$ cat <<EOS >> Gemfile\ngem 'rake'\ngem 'serverspec'\nEOS\n$ bundle --binstubs --path vendor/bundle\n$ cat <<EOS >> .gitignore\n/.bundle/\n/vendor/bundle/\n/bin\nEOS\n\n\nserverspec-init\n$ serverspec-init\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: y\nAuto-configure Vagrant from Vagrantfile? y/n: y\n + spec/\n + spec/default/\n + spec/default/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n\n\n\u30c6\u30b9\u30c8\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\n$ rake spec\n\n\u30c6\u30b9\u30c8\u306f\u5931\u6557\u3059\u308b\n\nnode.js \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30c6\u30b9\u30c8\u5b9f\u88c5\n\nspec/hexo_server/node_spec.rb\nrequire 'spec_helper'\n\ndescribe package 'nodejs' do\n  it { should be_installed.with_version('0.10') }\nend\n\ndescribe package 'npm' do\n  it { should be_installed.with_version('1.3.6') }\nend\n\n\ngit rm spec/hexo_server/sample_spec.rb\n\n$ rake spec\n\n\u30c6\u30b9\u30c8\u306f\u5931\u6557\u3059\u308b\n\nvagrant-omnibus \u5c0e\u5165\nchef client \u3092 \u30b5\u30fc\u30d0\u306b\u5c0e\u5165\u3057\u3066\u304f\u308c\u308b\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ vagrant plugin install vagrant-omnibus\n\nVagrant.configure(2) do |config|\n  config.omnibus.chef_version = :latest\n...\n\n$ vagrant provision\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ vagrant ssh\n[vagrant@localhost ~]$ knife --version\nChef: 12.0.3\n\n\nchef \u5c0e\u5165\n$ echo \"gem 'knife-solo'\" >> Gemfile\n$ bundle install\n\n\nepel \u30ea\u30dd\u30b8\u30c8\u30ea\u5c0e\u5165\nnode.js \u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306eyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306a\u3044\u306e\u3067\u3001EPEL\u3092\u8ffd\u52a0\u3059\u308b\n\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba Linux \u7528\u306e\u62e1\u5f35\u30d1\u30c3\u30b1\u30fc\u30b8(EPEL) \u306f\u3001 Red Hat Enterprise Linux (RHEL) \u5411\u3051\u306e\u9ad8\u54c1\u8cea\u306a\u30a2\u30c9\u30aa\u30f3\u30d1\u30c3\u30b1\u30fc\u30b8\n\nhttps://fedoraproject.org/wiki/EPEL/ja\n$ knife cookbook create epel_repo -o cookbooks\n$ cd cookbooks/epel_repo\n$ rm -rf CHANGELOG.md attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo package \\'epel-release\\' > recipes/default.rb\n\n\nnode.js \u5c0e\u5165\n$ knife cookbook create node -o cookbooks\n$ cd cookbooks/node/\n$ rm -rf CHANGELOG.md attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo depends          \\'epel_repo\\' >> metadata.rb\n$ cat <<EOS > recipes/default.rb\ninclude_recipe 'apache'\npackage 'nodejs'\npackage 'npm'\nEOS\n\n\nVagrantfile \u306b\u5b9f\u884c\u3059\u308b\u30ec\u30b7\u30d4\u3092\u8ffd\u8a18\nVagrant.configure(2) do |config|\n  config.omnibus.chef_version = :latest\n  config.vm.box = \"chef/centos-7.0\"\n  config.vm.define :hexo_server do |hexo_server|\n    hexo_server.vm.provision :chef_solo do |chef|\n      chef.cookbooks_path = './cookbooks'\n      chef.log_level = 'debug'\n      chef.add_recipe 'epel_repo'\n      chef.add_recipe 'node'\n    end\n  end\nend\n\n$ vagrant reload\n\n\n\u30c6\u30b9\u30c8\u5b9f\u884c\n$ rake spec\n\n\u4eca\u5ea6\u306f\u6210\u529f\n\nvagrant-cachier \u5c0e\u5165\nvagrant-cachier \u306f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u5185\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n\u958b\u767a\u4e2d\u306b\u4f55\u5ea6\u3082 vagrant destroy, vagrant up \u3057\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u305d\u306e\u90fd\u5ea6\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3092\u9632\u3044\u3067\u3001\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u69cb\u7bc9\u3092\u9ad8\u901f\u5316\u3057\u3066\u304f\u308c\u308b\n$ vagrant plugin install vagrant-cachier\n\nVagrant.configure(2) do |config|\n...\n  config.cache.scope = :box if Vagrant.has_plugin?(\"vagrant-cachier\")\nend\n\n\nHexo\u5c0e\u5165\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068init\n$ knife cookbook create hexo -o cookbooks\n$ rm -rf attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo depends \\'node\\' >> metadata.rb\n$ cat <<EOF > recipes/default.rb\ninclude_recipe 'node'\nexecute 'hexo install' do\n  command 'npm install -g hexo'\n  not_if { File.exists?('/usr/bin/hexo') }\nend\n\nexecute 'hexo init' do\n  cwd '/var/www/mypage'\n  command <<EOS\nhexo init .\nnpm install\nEOS\nend\nEOF\n\nhexo\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 synced_folder \u306b\n\u3042\u3068\u3001\u30db\u30b9\u30c8\u304b\u3089\u898b\u308b\u6642\u306e\u70ba\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\nVagrant.configure(2) do |config|\n...\n  config.vm.define :hexo_server do |hexo_server|\n    hexo_server.vm.provision :chef_solo do |chef|\n...\n       chef.add_recipe 'hexo'\n     end\n...\n  config.vm.synced_folder 'mypage', '/var/www/mypage', create: true\n  config.vm.network :private_network, ip: \"192.168.33.10\"\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n$ vagrant ssh\n$ cd /var/www/mypage/\n$ hexo server -i 192.168.33.10\n[info] Hexo is running at http://192.168.33.10:4000/. Press Ctrl+C to stop.hexo server\n\nhttp://192.168.33.10:4000/\n\n\u898b\u308c\u305f\u30fc!!\n\nNext\n\ngithub-page\u3067\u516c\u958b\n\n\n\u3064\u304f\u3063\u3066\u307f\u305f\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\n\n- https://github.com/kasei-san/hexo_server\n\n# \u521d\u624b\n\n```Vagrantfile\n$ git init\n$ vagrant init\n```\n\n# OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6298\u89d2\u306a\u306e\u3067\u3001\u6700\u65b0\u306eCentOS\u3092\u5165\u308c\u3066\u307f\u308b\n\n## \u30b5\u30fc\u30d0\u540d\u304c default \u306e\u307e\u307e\u3060\u3068\u3001serverspec \u306b\u5931\u6557\u3059\u308b\u306e\u3067\u5909\u66f4\n\n\u53c2\u8003 : [Carousel is a lie!: \"Circular dependency detected\" error in ServerSpec](https://saintaardvarkthecarpeted.com/blog/archive/2014/10/_Circular_dependency_detected__error_in_ServerSpec.html)\n\n```Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# All Vagrant configuration is done below. The \"2\" in Vagrant.configure\n# configures the configuration version (we support older styles for\n# backwards compatibility). Please don't change it unless you know what\n# you're doing.\nVagrant.configure(2) do |config|\n  config.vm.box = \"chef/centos-7.0\"\n  config.vm.define :hexo_server do |hexo_server|\n  end\nend\n```\n\n```sh-session\n$ vagrant up\n```\n\n## OS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n\n```sh-session\n$ vagrant ssh\nLast login: Tue Jul 22 03:42:16 2014 from 10.0.2.2\n[vagrant@localhost ~]$ cat /etc/redhat-release\nCentOS Linux release 7.0.1406 (Core)\n```\n\n## .gitignore \u306b /.vagrant \u3092\u8ffd\u52a0\n\n```sh-session\necho  \"/.vagrant/\" >> .gitignore\n```\n\n# serverspec \u5c0e\u5165\n\n## bundle install\n\n```sh-session\n$ bundle init\n$ cat <<EOS >> Gemfile\ngem 'rake'\ngem 'serverspec'\nEOS\n$ bundle --binstubs --path vendor/bundle\n$ cat <<EOS >> .gitignore\n/.bundle/\n/vendor/bundle/\n/bin\nEOS\n```\n\n## serverspec-init\n\n```sh-session\n$ serverspec-init\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: y\nAuto-configure Vagrant from Vagrantfile? y/n: y\n + spec/\n + spec/default/\n + spec/default/sample_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n + .rspec\n```\n\n## \u30c6\u30b9\u30c8\u304c\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n```sh-session\n$ rake spec\n```\n\n\u30c6\u30b9\u30c8\u306f\u5931\u6557\u3059\u308b\n\n# node.js \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n## \u30c6\u30b9\u30c8\u5b9f\u88c5\n\n```spec/hexo_server/node_spec.rb\nrequire 'spec_helper'\n\ndescribe package 'nodejs' do\n  it { should be_installed.with_version('0.10') }\nend\n\ndescribe package 'npm' do\n  it { should be_installed.with_version('1.3.6') }\nend\n```\n\n```sh-session\ngit rm spec/hexo_server/sample_spec.rb\n```\n\n```sh-session\n$ rake spec\n```\n\n\u30c6\u30b9\u30c8\u306f\u5931\u6557\u3059\u308b\n\n## vagrant-omnibus \u5c0e\u5165\n\nchef client \u3092 \u30b5\u30fc\u30d0\u306b\u5c0e\u5165\u3057\u3066\u304f\u308c\u308b\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5165\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```sh-session\n$ vagrant plugin install vagrant-omnibus\n```\n\n```Vagrantfile\nVagrant.configure(2) do |config|\n  config.omnibus.chef_version = :latest\n...\n```\n\n```sh-session\n$ vagrant provision\n```\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```sh-session\n$ vagrant ssh\n[vagrant@localhost ~]$ knife --version\nChef: 12.0.3\n```\n\n## chef \u5c0e\u5165\n\n```sh-session\n$ echo \"gem 'knife-solo'\" >> Gemfile\n$ bundle install\n```\n\n## epel \u30ea\u30dd\u30b8\u30c8\u30ea\u5c0e\u5165\n\nnode.js \u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306eyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306a\u3044\u306e\u3067\u3001EPEL\u3092\u8ffd\u52a0\u3059\u308b\n\n    \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba Linux \u7528\u306e\u62e1\u5f35\u30d1\u30c3\u30b1\u30fc\u30b8(EPEL) \u306f\u3001 Red Hat Enterprise Linux (RHEL) \u5411\u3051\u306e\u9ad8\u54c1\u8cea\u306a\u30a2\u30c9\u30aa\u30f3\u30d1\u30c3\u30b1\u30fc\u30b8\n\nhttps://fedoraproject.org/wiki/EPEL/ja\n\n```sh-session\n$ knife cookbook create epel_repo -o cookbooks\n$ cd cookbooks/epel_repo\n$ rm -rf CHANGELOG.md attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo package \\'epel-release\\' > recipes/default.rb\n```\n\n## node.js \u5c0e\u5165\n\n```sh-session\n$ knife cookbook create node -o cookbooks\n$ cd cookbooks/node/\n$ rm -rf CHANGELOG.md attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo depends          \\'epel_repo\\' >> metadata.rb\n$ cat <<EOS > recipes/default.rb\ninclude_recipe 'apache'\npackage 'nodejs'\npackage 'npm'\nEOS\n```\n\n\n## Vagrantfile \u306b\u5b9f\u884c\u3059\u308b\u30ec\u30b7\u30d4\u3092\u8ffd\u8a18\n\n```Vagrantfile\nVagrant.configure(2) do |config|\n  config.omnibus.chef_version = :latest\n  config.vm.box = \"chef/centos-7.0\"\n  config.vm.define :hexo_server do |hexo_server|\n    hexo_server.vm.provision :chef_solo do |chef|\n      chef.cookbooks_path = './cookbooks'\n      chef.log_level = 'debug'\n      chef.add_recipe 'epel_repo'\n      chef.add_recipe 'node'\n    end\n  end\nend\n```\n\n```\n$ vagrant reload\n```\n\n## \u30c6\u30b9\u30c8\u5b9f\u884c\n\n```\n$ rake spec\n```\n\n\u4eca\u5ea6\u306f\u6210\u529f\n\n## vagrant-cachier \u5c0e\u5165\n\nvagrant-cachier \u306f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u5185\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n\u958b\u767a\u4e2d\u306b\u4f55\u5ea6\u3082 vagrant destroy, vagrant up \u3057\u3066\u3044\u308b\u3068\u304d\u306b\u3001\u305d\u306e\u90fd\u5ea6\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3092\u9632\u3044\u3067\u3001\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u69cb\u7bc9\u3092\u9ad8\u901f\u5316\u3057\u3066\u304f\u308c\u308b\n\n```sh-session\n$ vagrant plugin install vagrant-cachier\n```\n\n```Vagrantfile\nVagrant.configure(2) do |config|\n...\n  config.cache.scope = :box if Vagrant.has_plugin?(\"vagrant-cachier\")\nend\n```\n\n# Hexo\u5c0e\u5165\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068init\n\n```sh-session\n$ knife cookbook create hexo -o cookbooks\n$ rm -rf attributes/ definitions/ files/ libraries/ providers/ resources/ templates/\n$ echo depends \\'node\\' >> metadata.rb\n$ cat <<EOF > recipes/default.rb\ninclude_recipe 'node'\nexecute 'hexo install' do\n  command 'npm install -g hexo'\n  not_if { File.exists?('/usr/bin/hexo') }\nend\n\nexecute 'hexo init' do\n  cwd '/var/www/mypage'\n  command <<EOS\nhexo init .\nnpm install\nEOS\nend\nEOF\n```\n\nhexo\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 synced_folder \u306b\n\u3042\u3068\u3001\u30db\u30b9\u30c8\u304b\u3089\u898b\u308b\u6642\u306e\u70ba\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\n\n```Vagrantfile\nVagrant.configure(2) do |config|\n...\n  config.vm.define :hexo_server do |hexo_server|\n    hexo_server.vm.provision :chef_solo do |chef|\n...\n       chef.add_recipe 'hexo'\n     end\n...\n  config.vm.synced_folder 'mypage', '/var/www/mypage', create: true\n  config.vm.network :private_network, ip: \"192.168.33.10\"\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n```sh-session\n$ vagrant ssh\n$ cd /var/www/mypage/\n$ hexo server -i 192.168.33.10\n[info] Hexo is running at http://192.168.33.10:4000/. Press Ctrl+C to stop.hexo server\n```\n\nhttp://192.168.33.10:4000/\n\n![Hexo_-_Vimperator.png](https://qiita-image-store.s3.amazonaws.com/0/5329/4257f18d-b217-b324-62ee-8cd876395f51.png \"Hexo_-_Vimperator.png\")\n\n\u898b\u308c\u305f\u30fc!!\n\n# Next\n\n- github-page\u3067\u516c\u958b\n", "tags": ["vagrant", "Node.js", "Hexo", "chef"]}