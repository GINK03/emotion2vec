{"context": " More than 1 year has passed since last update.\u74b0\u5883: Debian wheezy (7.5), Docker 0.11.0 (-e lxc), Zabbix 2.2.3 (Docker\u5468\u308a\u304c\u5909\u5247\u74b0\u5883\u306a\u3053\u3068\u306b\u6ce8\u610f)\nLLD (Low Level Discovery) \u306e vfs.fs.discovery \u3067\u306f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u308b\u5168\u3066\u3092\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8fd4\u3057\u307e\u3059\u3002\n\u901a\u5e38\u306f\u554f\u984c\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306fDocker\u304b\u3089/var/lib/docker\u914d\u4e0b\u306e\u4f55\u304b\u3092\u591a\u6570\u30de\u30a6\u30f3\u30c8\u3055\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u3001\u3061\u3087\u3044\u3068\u56f0\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u983b\u7e41\u306bdocker\u306e\u30a4\u30e1\u30fc\u30b8\u3084\u30b3\u30f3\u30c6\u30ca\u3092\u3044\u3058\u308b\u3068Zabbix Server\u306f\u7d42\u59cb\u4e01\u5be7\u306b\u3053\u308c\u3092\u8ffd\u3044\u304b\u3051\u307e\u3059\u3002\u90aa\u9b54\u3067\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001vfs.fs.discovery\u306e\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306aJSON\u3067\u8fd4\u3055\u308c\u307e\u3059\n{\n    \"data\":[\n        {\n            \"{#FSNAME}\":\"\\/\",\n            \"{#FSTYPE}\":\"rootfs\"},\n        {\n            \"{#FSNAME}\":\"\\/sys\",\n            \"{#FSTYPE}\":\"sysfs\"},\n        {\n            \"{#FSNAME}\":\"\\/proc\",\n            \"{#FSTYPE}\":\"proc\"},\n        {\n            \"{#FSNAME}\":\"\\/dev\",\n            \"{#FSTYPE}\":\"devtmpfs\"},\n        {\n            \"{#FSNAME}\":\"\\/dev\\/pts\",\n            \"{#FSTYPE}\":\"devpts\"},\n        {\n            \"{#FSNAME}\":\"\\/run\",\n            \"{#FSTYPE}\":\"tmpfs\"},\n        {\n            \"{#FSNAME}\":\"\\/\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/run\\/lock\",\n            \"{#FSTYPE}\":\"tmpfs\"},\n        {\n            \"{#FSNAME}\":\"\\/run\\/shm\",\n            \"{#FSTYPE}\":\"tmpfs\"},\n        {\n            \"{#FSNAME}\":\"\\/boot\",\n            \"{#FSTYPE}\":\"ext2\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/nfs\\/rpc_pipefs\",\n            \"{#FSTYPE}\":\"rpc_pipefs\"},\n        {\n            \"{#FSNAME}\":\"\\/proc\\/sys\\/fs\\/binfmt_misc\",\n            \"{#FSTYPE}\":\"binfmt_misc\"},\n        {\n            \"{#FSNAME}\":\"\\/sys\\/fs\\/fuse\\/connections\",\n            \"{#FSTYPE}\":\"fusectl\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2-init\",\n            \"{#FSTYPE}\":\"aufs\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\",\n            \"{#FSTYPE}\":\"aufs\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/.dockerinit\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/.dockerenv\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...407ef395f2\\/etc\\/resolv.conf\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/etc\\/hostname\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/etc\\/hosts\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/var\\/lib\\/docker\",\n            \"{#FSTYPE}\":\"ext4\"},\n        {\n            \"{#FSNAME}\":\"\\/sys\\/fs\\/cgroup\",\n            \"{#FSTYPE}\":\"cgroup\"}]}\n\n\u3053\u306e/var/lib/docker\u306b\u95a2\u308f\u308bFS\u3060\u3051\u3092\u6d88\u3059\u3001\u3068\u3044\u3046\u8a2d\u5b9a\u3092\u884c\u304a\u3046\u3068\u3057\u307e\u3057\u305f\u304c\u30012.2\u3067\u306f\u3069\u3046\u3082\u96e3\u3057\u3044\u5370\u8c61\u3067\u3059\u3002\n\u79c1\u306e\u74b0\u5883(Debian wheezy + docker 0.11.0\u3001\u305d\u3082\u305d\u3082\u5909\u5247\u69cb\u6210\u3067\u3059\u6ce8\u610f)\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3001Zabbix\u306f/var/lib/docker\u914d\u4e0b\u306e\u3082\u306e\u3092 aufs \u3068 ext4 \u306e\u4e21\u65b9\u306e\u5f62\u5f0f\u3067\u8a8d\u8b58\u3057\u3066\u3044\u307e\u3057\u305f\u3002\next4 \u306f\u5225\u306e\u76e3\u8996\u3057\u3066\u6b32\u3057\u3044FS (\u5177\u4f53\u7684\u306b\u306f/)\u3067\u3082\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001#FSTYPE\u30d5\u30a3\u30eb\u30bf\u5bfe\u8c61\u304b\u3089\u306f\u5916\u305b\u307e\u305b\u3093\u3002\n\u4ee3\u308f\u308a\u306b#FSNAME\u306bdocker\u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u3042\u3063\u305f\u3089\u5f3e\u304f\u3001\u3068\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u4eca\u5ea6\u306ftmpfs\u7b49\u306e\u6709\u8c61\u7121\u8c61\u306eFS\u3092Zabbix\u304c\u76e3\u8996\u3057\u59cb\u3081\u307e\u3059\u3002\u6a19\u6e96\u3067Mounted Filesytem Discovery\u304c\u5229\u7528\u3059\u308b\u30d5\u30a3\u30eb\u30bf (POSIX\u62e1\u5f35\u6b63\u898f\u8868\u73fe)\u306f\u4ee5\u4e0b\u306e\u901a\u308a\n^(btrfs|ext2|ext3|ext4|jfs|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|ntfs|fat32)$\n\n\u3053\u308c\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044tmpfs\u3084rpc_pipefs\u306f\u76e3\u8996\u3055\u308c\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u3055\u3059\u304c\u306b\u3053\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u5916\u3057\u305f\u304f\u306a\u3044\u3067\u3059\u3002\n\u3053\u308c\u306f\u3001\u30d5\u30a3\u30eb\u30bf\u3092\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u306a\u3044Zabbix 2.2\u4ee5\u524d\u306e\u5236\u7d04\u3068\u8003\u3048\u307e\u3057\u305f\u3002\u958b\u767a\u4e2d\u3068\u3055\u308c\u308b2.4\u3067\u306f\u8907\u6570\u30d5\u30a3\u30eb\u30bf\u306b\u5bfe\u5fdc\u3059\u308b\u305d\u3046\u306a\u306e\u3067\u3053\u306e\u554f\u984c\u306f\u8d77\u3053\u3089\u306a\u3044\u3068\u601d\u308f\u308c\u307e\u3059\u304c\u3001\u3068\u308a\u307e\u3053\u3053\u3067\u306f\u6f38\u6b21\u7684\u306a\u5bfe\u7b56\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001UserParameter\u3092\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5074\u306b\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\u524d\u63d0\u3068\u3057\u3066\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f127.0.0.1\u304b\u3089\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u307e\u305a\u4e0a\u8a18\u306e\u52a0\u5de5\u524dJSON\u3092zabbix_get\u3067\u5f97\u308b\u305f\u3081\u3067\u3059\u3002\u6b63\u76f4\u3061\u3087\u3063\u3068\u982d\u60aa\u3044\u5370\u8c61\u3067\u3059\u304c\u3001\u826f\u3044\u65b9\u6cd5\u304c\u601d\u3044\u3064\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nUserParameter=amedama.fs.discovery.nodocker,zabbix_get -s localhost -k vfs.fs.discovery | jq '{data: [.data | .[] | select(.[\"{#FSNAME}\"] | contains(\"docker\") | not)]}'\n\n\u3053\u3053\u306f\u5510\u7a81\u306bjq\u306e\u6f14\u7fd2\u3067\u3059\u3002(http://stedolan.github.io/jq/) jq 1.3 \u306fDebian wheezy (7.5)\u306b\u306f\u901a\u5e38\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067sid\u304b\u3089\u30bd\u30fc\u30b9\u3092\u53d6\u3063\u3066\u304d\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\u5358\u306b\u30d0\u30a4\u30ca\u30ea\u3092\u672c\u5bb6\u304b\u3089\u53d6\u3063\u3066\u304d\u3066\u3082\u826f\u3044\u3067\u3057\u3087\u3046\u3002\njq\u306b\u6e21\u3057\u3066\u3044\u308b\u4e2d\u8eab\u3092\u3082\u3046\u4e00\u5ea6\u898b\u3066\u307f\u307e\u3059\n{data: [.data | .[] | select(.[\"{#FSNAME}\"] | contains(\"docker\") | not)]}\n\ndata\u3068\u305d\u306e\u914d\u4e0b\u306e[]\u3092\u5265\u304e\u53d6\u308a\u3001\"{#FSNAME}\"\u306b(.[\"{#FSNAME}\"]) docker\u304c\u5165\u3063\u3066(contains(\"docker\")) \u3044\u306a\u304b\u3063\u305f (not) \u5834\u5408\u3060\u3051\u305d\u306e\u8981\u7d20\u3092\u63a1\u7528\u3057 (select())\u3001\u518d\u3073[]\u3067\u56f2\u3063\u3066\u30ea\u30b9\u30c8\u3068\u3057\u3001\u8f9e\u66f8\u7684\u306b{data: }\u3067\u66f4\u306b\u56f2\u3044\u307e\u3059\u3002\n\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n{\n  \"data\": [\n    {\n      \"{#FSTYPE}\": \"rootfs\",\n      \"{#FSNAME}\": \"/\"\n    },\n    {\n      \"{#FSTYPE}\": \"sysfs\",\n      \"{#FSNAME}\": \"/sys\"\n    },\n    {\n      \"{#FSTYPE}\": \"proc\",\n      \"{#FSNAME}\": \"/proc\"\n    },\n    {\n      \"{#FSTYPE}\": \"devtmpfs\",\n      \"{#FSNAME}\": \"/dev\"\n    },\n    {\n      \"{#FSTYPE}\": \"devpts\",\n      \"{#FSNAME}\": \"/dev/pts\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run\"\n    },\n    {\n      \"{#FSTYPE}\": \"ext4\",\n      \"{#FSNAME}\": \"/\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run/lock\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run/shm\"\n    },\n    {\n      \"{#FSTYPE}\": \"ext2\",\n      \"{#FSNAME}\": \"/boot\"\n    },\n    {\n      \"{#FSTYPE}\": \"rpc_pipefs\",\n      \"{#FSNAME}\": \"/var/lib/nfs/rpc_pipefs\"\n    },\n    {\n      \"{#FSTYPE}\": \"binfmt_misc\",\n      \"{#FSNAME}\": \"/proc/sys/fs/binfmt_misc\"\n    },\n    {\n      \"{#FSTYPE}\": \"fusectl\",\n      \"{#FSNAME}\": \"/sys/fs/fuse/connections\"\n    },\n    {\n      \"{#FSTYPE}\": \"cgroup\",\n      \"{#FSNAME}\": \"/sys/fs/cgroup\"\n    }\n  ]\n}\n\n\u3053\u308c\u3092Zabbix Server\u5074\u3067\u5229\u7528\u3059\u308b\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n\u305f\u3060\u3057\u65e2\u5b58\u306eTemplate OS Linux\u306b\u3053\u308c\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nDiscovery\u306e\u30ad\u30fc\u306e\u7570\u306a\u308bDiscovery\u30a2\u30a4\u30c6\u30e0\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u3059\u304c\u3001Discovery\u306b\u30ea\u30f3\u30af\u3057\u3066\u3044\u308bItem prototypes\u7b49\u306f\u3082\u3068\u3082\u3068\u306eDiscovery (vfs.fs.discovery) \u3068\u5168\u304f\u540c\u3058\u3067\u3059\u3002\u3088\u3063\u3066\u3001Items, Triggers, Graphs\u7b49\u306e\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u306e\u30ad\u30fc\u81ea\u4f53\u304c\u4e00\u81f4\u3057\u3066\u885d\u7a81\u3057\u307e\u3059\u3002\n\u3055\u3059\u304c\u306b\u5168\u3066\u306e\u76e3\u8996\u74b0\u5883\u3067\u3053\u3093\u306aUserParameter\u30cf\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u308f\u3051\u306b\u306f\u3044\u304d\u307e\u305b\u3093\u306e\u3067\u3001\u3053\u306e\u30b3\u30f3\u30d5\u30ea\u30af\u30c8\u306f\u3061\u3087\u3063\u3068\u9762\u5012\u3067\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3060\u3051\u3067\u7ba1\u7406\u51fa\u6765\u306a\u3044\u3053\u3068\u3092\u3084\u308b\u3068\u8272\u3005\u9762\u5012\u3067\u3059\u3002\n\u8a66\u9a13\u904b\u7528\u3059\u308bLinux\u74b0\u5883\u7528\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30ec\u30d9\u30eb\u3067full clone\u3057\u307e\u3057\u305f\u30022.4\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5468\u308a\u306e\u6319\u52d5\u306b\u6539\u5584\u304c\u5165\u308b\u3068\u3053\u30fc\u3060\u3044\u6c0f\u304c\u8a00\u3063\u3066\u305f\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u554f\u984c\u3068\u95a2\u4fc2\u3059\u308b\u304b\u307e\u3067\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n2.4 \u306e\u30ea\u30ea\u30fc\u30b9\u4e88\u5b9a\u6a5f\u80fd\u306f\u4e00\u90e8\u3001\u3053\u3061\u3089\u304b\u3089\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\nhttps://www.zabbix.com/documentation/2.4/manual/introduction/whatsnew240\n\u74b0\u5883: Debian wheezy (7.5), Docker 0.11.0 (-e lxc), Zabbix 2.2.3 (Docker\u5468\u308a\u304c\u5909\u5247\u74b0\u5883\u306a\u3053\u3068\u306b\u6ce8\u610f)\n\nLLD (Low Level Discovery) \u306e vfs.fs.discovery \u3067\u306f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u308b\u5168\u3066\u3092\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n\u901a\u5e38\u306f\u554f\u984c\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306fDocker\u304b\u3089```/var/lib/docker```\u914d\u4e0b\u306e\u4f55\u304b\u3092\u591a\u6570\u30de\u30a6\u30f3\u30c8\u3055\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u3001\u3061\u3087\u3044\u3068\u56f0\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u983b\u7e41\u306bdocker\u306e\u30a4\u30e1\u30fc\u30b8\u3084\u30b3\u30f3\u30c6\u30ca\u3092\u3044\u3058\u308b\u3068Zabbix Server\u306f\u7d42\u59cb\u4e01\u5be7\u306b\u3053\u308c\u3092\u8ffd\u3044\u304b\u3051\u307e\u3059\u3002\u90aa\u9b54\u3067\u3059\u3002\n\n\u5177\u4f53\u7684\u306b\u306f\u3001vfs.fs.discovery\u306e\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306aJSON\u3067\u8fd4\u3055\u308c\u307e\u3059\n\n```json\n{\n\t\"data\":[\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/\",\n\t\t\t\"{#FSTYPE}\":\"rootfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/sys\",\n\t\t\t\"{#FSTYPE}\":\"sysfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/proc\",\n\t\t\t\"{#FSTYPE}\":\"proc\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/dev\",\n\t\t\t\"{#FSTYPE}\":\"devtmpfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/dev\\/pts\",\n\t\t\t\"{#FSTYPE}\":\"devpts\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/run\",\n\t\t\t\"{#FSTYPE}\":\"tmpfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/run\\/lock\",\n\t\t\t\"{#FSTYPE}\":\"tmpfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/run\\/shm\",\n\t\t\t\"{#FSTYPE}\":\"tmpfs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/boot\",\n\t\t\t\"{#FSTYPE}\":\"ext2\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/nfs\\/rpc_pipefs\",\n\t\t\t\"{#FSTYPE}\":\"rpc_pipefs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/proc\\/sys\\/fs\\/binfmt_misc\",\n\t\t\t\"{#FSTYPE}\":\"binfmt_misc\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/sys\\/fs\\/fuse\\/connections\",\n\t\t\t\"{#FSTYPE}\":\"fusectl\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2-init\",\n\t\t\t\"{#FSTYPE}\":\"aufs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\",\n\t\t\t\"{#FSTYPE}\":\"aufs\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/.dockerinit\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/.dockerenv\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...407ef395f2\\/etc\\/resolv.conf\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/etc\\/hostname\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\\/aufs\\/mnt\\/2f6...07ef395f2\\/etc\\/hosts\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/var\\/lib\\/docker\",\n\t\t\t\"{#FSTYPE}\":\"ext4\"},\n\t\t{\n\t\t\t\"{#FSNAME}\":\"\\/sys\\/fs\\/cgroup\",\n\t\t\t\"{#FSTYPE}\":\"cgroup\"}]}\n```\n\n\u3053\u306e```/var/lib/docker```\u306b\u95a2\u308f\u308bFS\u3060\u3051\u3092\u6d88\u3059\u3001\u3068\u3044\u3046\u8a2d\u5b9a\u3092\u884c\u304a\u3046\u3068\u3057\u307e\u3057\u305f\u304c\u30012.2\u3067\u306f\u3069\u3046\u3082\u96e3\u3057\u3044\u5370\u8c61\u3067\u3059\u3002\n\n\u79c1\u306e\u74b0\u5883(Debian wheezy + docker 0.11.0\u3001\u305d\u3082\u305d\u3082\u5909\u5247\u69cb\u6210\u3067\u3059\u6ce8\u610f)\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3001Zabbix\u306f```/var/lib/docker```\u914d\u4e0b\u306e\u3082\u306e\u3092 aufs \u3068 ext4 \u306e\u4e21\u65b9\u306e\u5f62\u5f0f\u3067\u8a8d\u8b58\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n\next4 \u306f\u5225\u306e\u76e3\u8996\u3057\u3066\u6b32\u3057\u3044FS (\u5177\u4f53\u7684\u306b\u306f```/```)\u3067\u3082\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001```#FSTYPE```\u30d5\u30a3\u30eb\u30bf\u5bfe\u8c61\u304b\u3089\u306f\u5916\u305b\u307e\u305b\u3093\u3002\n\n\u4ee3\u308f\u308a\u306b```#FSNAME```\u306bdocker\u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u3042\u3063\u305f\u3089\u5f3e\u304f\u3001\u3068\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u4eca\u5ea6\u306ftmpfs\u7b49\u306e\u6709\u8c61\u7121\u8c61\u306eFS\u3092Zabbix\u304c\u76e3\u8996\u3057\u59cb\u3081\u307e\u3059\u3002\u6a19\u6e96\u3067Mounted Filesytem Discovery\u304c\u5229\u7528\u3059\u308b\u30d5\u30a3\u30eb\u30bf (POSIX\u62e1\u5f35\u6b63\u898f\u8868\u73fe)\u306f\u4ee5\u4e0b\u306e\u901a\u308a\n\n```\n^(btrfs|ext2|ext3|ext4|jfs|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|ntfs|fat32)$\n```\n\n\u3053\u308c\u306b\u30de\u30c3\u30c1\u3057\u306a\u3044tmpfs\u3084rpc_pipefs\u306f\u76e3\u8996\u3055\u308c\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u3055\u3059\u304c\u306b\u3053\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u5916\u3057\u305f\u304f\u306a\u3044\u3067\u3059\u3002\n\n\u3053\u308c\u306f\u3001\u30d5\u30a3\u30eb\u30bf\u3092\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u306a\u3044Zabbix 2.2\u4ee5\u524d\u306e\u5236\u7d04\u3068\u8003\u3048\u307e\u3057\u305f\u3002\u958b\u767a\u4e2d\u3068\u3055\u308c\u308b2.4\u3067\u306f\u8907\u6570\u30d5\u30a3\u30eb\u30bf\u306b\u5bfe\u5fdc\u3059\u308b\u305d\u3046\u306a\u306e\u3067\u3053\u306e\u554f\u984c\u306f\u8d77\u3053\u3089\u306a\u3044\u3068\u601d\u308f\u308c\u307e\u3059\u304c\u3001\u3068\u308a\u307e\u3053\u3053\u3067\u306f\u6f38\u6b21\u7684\u306a\u5bfe\u7b56\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n\u5177\u4f53\u7684\u306b\u306f\u3001```UserParameter```\u3092\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5074\u306b\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3059\u3002\u524d\u63d0\u3068\u3057\u3066\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f127.0.0.1\u304b\u3089\u3082\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u307e\u305a\u4e0a\u8a18\u306e\u52a0\u5de5\u524dJSON\u3092```zabbix_get```\u3067\u5f97\u308b\u305f\u3081\u3067\u3059\u3002\u6b63\u76f4\u3061\u3087\u3063\u3068\u982d\u60aa\u3044\u5370\u8c61\u3067\u3059\u304c\u3001\u826f\u3044\u65b9\u6cd5\u304c\u601d\u3044\u3064\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\nUserParameter=amedama.fs.discovery.nodocker,zabbix_get -s localhost -k vfs.fs.discovery | jq '{data: [.data | .[] | select(.[\"{#FSNAME}\"] | contains(\"docker\") | not)]}'\n```\n\n\u3053\u3053\u306f\u5510\u7a81\u306bjq\u306e\u6f14\u7fd2\u3067\u3059\u3002(http://stedolan.github.io/jq/) jq 1.3 \u306fDebian wheezy (7.5)\u306b\u306f\u901a\u5e38\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067sid\u304b\u3089\u30bd\u30fc\u30b9\u3092\u53d6\u3063\u3066\u304d\u3066\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\u5358\u306b\u30d0\u30a4\u30ca\u30ea\u3092\u672c\u5bb6\u304b\u3089\u53d6\u3063\u3066\u304d\u3066\u3082\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\njq\u306b\u6e21\u3057\u3066\u3044\u308b\u4e2d\u8eab\u3092\u3082\u3046\u4e00\u5ea6\u898b\u3066\u307f\u307e\u3059\n\n```\n{data: [.data | .[] | select(.[\"{#FSNAME}\"] | contains(\"docker\") | not)]}\n```\n\ndata\u3068\u305d\u306e\u914d\u4e0b\u306e[]\u3092\u5265\u304e\u53d6\u308a\u3001\"{#FSNAME}\"\u306b(```.[\"{#FSNAME}\"]```) docker\u304c\u5165\u3063\u3066(```contains(\"docker\")```) \u3044\u306a\u304b\u3063\u305f (```not```) \u5834\u5408\u3060\u3051\u305d\u306e\u8981\u7d20\u3092\u63a1\u7528\u3057 (```select()```)\u3001\u518d\u3073[]\u3067\u56f2\u3063\u3066\u30ea\u30b9\u30c8\u3068\u3057\u3001\u8f9e\u66f8\u7684\u306b```{data: }```\u3067\u66f4\u306b\u56f2\u3044\u307e\u3059\u3002\n\n\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```json\n{\n  \"data\": [\n    {\n      \"{#FSTYPE}\": \"rootfs\",\n      \"{#FSNAME}\": \"/\"\n    },\n    {\n      \"{#FSTYPE}\": \"sysfs\",\n      \"{#FSNAME}\": \"/sys\"\n    },\n    {\n      \"{#FSTYPE}\": \"proc\",\n      \"{#FSNAME}\": \"/proc\"\n    },\n    {\n      \"{#FSTYPE}\": \"devtmpfs\",\n      \"{#FSNAME}\": \"/dev\"\n    },\n    {\n      \"{#FSTYPE}\": \"devpts\",\n      \"{#FSNAME}\": \"/dev/pts\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run\"\n    },\n    {\n      \"{#FSTYPE}\": \"ext4\",\n      \"{#FSNAME}\": \"/\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run/lock\"\n    },\n    {\n      \"{#FSTYPE}\": \"tmpfs\",\n      \"{#FSNAME}\": \"/run/shm\"\n    },\n    {\n      \"{#FSTYPE}\": \"ext2\",\n      \"{#FSNAME}\": \"/boot\"\n    },\n    {\n      \"{#FSTYPE}\": \"rpc_pipefs\",\n      \"{#FSNAME}\": \"/var/lib/nfs/rpc_pipefs\"\n    },\n    {\n      \"{#FSTYPE}\": \"binfmt_misc\",\n      \"{#FSNAME}\": \"/proc/sys/fs/binfmt_misc\"\n    },\n    {\n      \"{#FSTYPE}\": \"fusectl\",\n      \"{#FSNAME}\": \"/sys/fs/fuse/connections\"\n    },\n    {\n      \"{#FSTYPE}\": \"cgroup\",\n      \"{#FSNAME}\": \"/sys/fs/cgroup\"\n    }\n  ]\n}\n```\n\n\u3053\u308c\u3092Zabbix Server\u5074\u3067\u5229\u7528\u3059\u308b\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n\n\u305f\u3060\u3057\u65e2\u5b58\u306eTemplate OS Linux\u306b\u3053\u308c\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\nDiscovery\u306e\u30ad\u30fc\u306e\u7570\u306a\u308bDiscovery\u30a2\u30a4\u30c6\u30e0\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u3059\u304c\u3001Discovery\u306b\u30ea\u30f3\u30af\u3057\u3066\u3044\u308bItem prototypes\u7b49\u306f\u3082\u3068\u3082\u3068\u306eDiscovery (vfs.fs.discovery) \u3068\u5168\u304f\u540c\u3058\u3067\u3059\u3002\u3088\u3063\u3066\u3001Items, Triggers, Graphs\u7b49\u306e\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u306e\u30ad\u30fc\u81ea\u4f53\u304c\u4e00\u81f4\u3057\u3066\u885d\u7a81\u3057\u307e\u3059\u3002\n\n\u3055\u3059\u304c\u306b\u5168\u3066\u306e\u76e3\u8996\u74b0\u5883\u3067\u3053\u3093\u306a```UserParameter```\u30cf\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u308f\u3051\u306b\u306f\u3044\u304d\u307e\u305b\u3093\u306e\u3067\u3001\u3053\u306e\u30b3\u30f3\u30d5\u30ea\u30af\u30c8\u306f\u3061\u3087\u3063\u3068\u9762\u5012\u3067\u3057\u305f\u3002\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3060\u3051\u3067\u7ba1\u7406\u51fa\u6765\u306a\u3044\u3053\u3068\u3092\u3084\u308b\u3068\u8272\u3005\u9762\u5012\u3067\u3059\u3002\n\n\u8a66\u9a13\u904b\u7528\u3059\u308bLinux\u74b0\u5883\u7528\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30ec\u30d9\u30eb\u3067full clone\u3057\u307e\u3057\u305f\u30022.4\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5468\u308a\u306e\u6319\u52d5\u306b\u6539\u5584\u304c\u5165\u308b\u3068\u3053\u30fc\u3060\u3044\u6c0f\u304c\u8a00\u3063\u3066\u305f\u6c17\u304c\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u554f\u984c\u3068\u95a2\u4fc2\u3059\u308b\u304b\u307e\u3067\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n\n2.4 \u306e\u30ea\u30ea\u30fc\u30b9\u4e88\u5b9a\u6a5f\u80fd\u306f\u4e00\u90e8\u3001\u3053\u3061\u3089\u304b\u3089\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\nhttps://www.zabbix.com/documentation/2.4/manual/introduction/whatsnew240\n\n", "tags": ["zabbix2.2.3", "jq1.3", "docker"]}