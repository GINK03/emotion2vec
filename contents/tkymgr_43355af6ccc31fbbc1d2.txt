{"context": " More than 1 year has passed since last update.\u7b97\u6570\u306f\u5fc5\u8981\u3060\u3088\u3002\u5b9f\u751f\u6d3b\u3067\u3082...\n\u3053\u308c\u3067\u3001\u592a\u90ce\u3068\u6b21\u90ce\u306e\u5192\u967a\u306f\u4e00\u65e6\u7d42\u308f\u308a\u307e\u3059\u3002\n\n\u5148\u65e5\u3001\u3046\u3061\u306e\u5c0f\u5b66\u751f\u304c\u7b97\u6570\u306e\u30c6\u30b9\u30c8\u3067\u76ee\u3082\u5f53\u3066\u3089\u308c\u306a\u3044\u3088\u3046\u306a\u70b9\u6570\u3092\u6301\u3063\u3066\u5e30\u3063\u3066\u304d\u307e\u3057\u305f\u3002\u30b9\u30de\u30db\u3067\u30b2\u30fc\u30e0\u3057\u305f\u308a\u3001Youtube\u3070\u304b\u308a\u898b\u3066\u305f\u308a\u3001\uff08\u30b9\u30de\u30db\u3092\u4e0e\u3048\u308b\u306a\u3063\u3066\uff57\uff09\u5c11\u3057\u306f\u52c9\u5b66\u306b\u52b1\u3093\u3067\u307b\u3057\u3044\u3082\u306e\u3067\u3059\u3002\u305d\u3053\u3067\u3001\n\u4ffa\u300c\u307b\u3089\u3001\u7b97\u6570\u3067\u304d\u308c\u3070\u3001\u3053\u3093\u306a\u30b2\u30fc\u30e0\u307f\u305f\u3044\u306a\u306e\u4f5c\u308c\u308b\u3088\uff1f\u5c11\u3057\u306f\u52c9\u5f37\u3057\u306a\u3055\u3044\u3088\u300d\n\u5c0f\u5b66\u751f\u300c\u3048\u3001\u306a\u306b\u3053\u308c\uff1f\u308f\u304b\u3063\u305f\uff01\u3059\u3050\u30af\u30ea\u30a2\u3059\u308b\u3088\uff01\u300d\n\u3044\u3084\u3001\u9055...\u9006\u52b9\u679c\u3067\u3057\u305f...orz\n\n\u6700\u5f8c\u306f\u3001\u79fb\u52d5\u51e6\u7406\u306e\u5b9f\u88c5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u5165\u529b\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u306e\u60c5\u5831\u3067\u3001\u9032\u3080\u306e\u304b\u3001\u65b9\u5411\u5909\u3048\u308b\u306e\u304b\u3092\u5224\u65ad\u3057\u3066\u3001\u30ab\u30e1\u30e9\u3092\u64cd\u4f5c\u3059\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u524d\u9032\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\npoge.js\nvar moveForward = function() {\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var map = getMap(Player.x + deltaX, Player.y + deltaY);\n  // \u6249\u306a\u3089\u3082\u3046\u4e00\u6b69\u9032\u3080\n  var times = (map == \"\u25a1\") ? 2 : 1;\n  if (map == \"\u25a0\") {\n    return;\n  }\n  // \u4f4d\u7f6e\u60c5\u5831\u306e\u66f4\u65b0\n  Player.x += deltaX * times;\n  Player.y += deltaY * times;\n  // \u30ab\u30e1\u30e9\u306e\u4f4d\u7f6e\u66f4\u65b0\n  camera.position.x += deltaX * times * blockSize;\n  camera.position.z += deltaY * times * blockSize;\n  // \u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\n  light.position.copy( camera.position );\n  light.position.x += deltaX;\n  light.position.z += deltaY;\n};\n\n\n\u3053\u308c\u3092\u3001update\u95a2\u6570\u3067\u30b3\u30fc\u30eb\u3057\u307e\u3059\u3002\n\npoge.js\nfunction update() {\n  if (upKey.isDown || game.touchControl.cursors.up) {\n    moveForward();\n    console.log('UP');\n  }\n  if (leftKey.isDown || game.touchControl.cursors.left) {\n\n\n\u3053\u306e\u307e\u307e\u3067\u826f\u3044\u3068\u3044\u3048\u3070\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u306a\u3093\u304b\u3053\u3046\u3001\u30b0\u30b0\u30c3\u3068\u6b69\u3044\u3066\u308b\u96f0\u56f2\u6c17\u304c\u307b\u3057\u3044\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff01\u305d\u3053\u3067\u3001Tween\u3068\u3044\u3046\u6a5f\u80fd\u3067\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u3066\u307f\u307e\u3059\u3002\nTween\u3067\u306f\u3001\u521d\u671f\u5024\u3068\u6700\u7d42\u7684\u306a\u5024\u3068\u6642\u9593\u3092\u30bb\u30c3\u30c8\u3059\u308b\u3068\u3001\u521d\u671f\u5024\u304b\u3089\u6700\u7d42\u5024\u307e\u3067\u30bb\u30c3\u30c8\u3057\u305f\u6642\u9593\u3092\u304b\u3051\u3066\u5909\u5316\u3055\u305b\u3066\u304f\u308c\u307e\u3059\u3002\u3069\u3093\u306a\u5909\u5316\u3092\u3059\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u95a2\u6570\u3092\u81ea\u4f5c\u3082\u3067\u304d\u307e\u3059\u304c\u30d7\u30ea\u30bb\u30c3\u30c8\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\u3053\u3053\u306b\u30d7\u30ea\u30bb\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\u3069\u3093\u306a\u52d5\u304d\u306a\u306e\u304b\u306f\u3001Tween.js\u306e\u30b0\u30e9\u30d5\u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u304b...\n\u5148\u307b\u3069\u306emoveForward\u95a2\u6570\u306e\u30ab\u30e1\u30e9\u306e\u4f4d\u7f6e\u66f4\u65b0\u3068\u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\u306e\u90e8\u5206\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\npoge.js\n  // \u30ab\u30e1\u30e9\u3068\u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX * times * blockSize,\n    z : camera.position.z + deltaY * times * blockSize\n  }, 1000, Phaser.Easing.Quartic.In);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.start();\n\n\n1000ms\u304b\u3051\u3066\u5ea7\u6a19\u304c\u5909\u5316\u3057\u307e\u3059\u3002\u5149\u6e90\u306e\u4f4d\u7f6e\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u3067\u5909\u5316\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\u540c\u69d8\u306b\u5411\u304d\u306e\u5909\u66f4\u306f\u3001y\u8ef8\u3067\u56de\u8ee2\u3055\u305b\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\n\n\u226a\u5f8c\u8a18\u226b\n\u307e\u3041\u3001\u606f\u5b50\u306b\u7b97\u6570\u3092\u52c9\u5f37\u3057\u3066\u307b\u3057\u3044\u4e00\u5fc3\u3067\u3001javascript\u3082Three\u3068\u304bPhaser\u3082\u4f7f\u3044\u59cb\u3081\u30661\u9031\u9593\u307b\u3069\u306a\u306e\u3067\u3001\u7a1a\u62d9\u306a\u611f\u3058\u3067\u30a2\u30ec\u3067\u3059\u304c\u3001\u6700\u5f8c\u306b\u30c7\u30e2\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30c7\u30e2\n\n\npoge-final.js\n//*--- Const\n// \u65b9\u89d2\nvar direction = {\n  north : 0,\n  west  : 1,\n  south : 2,\n  east  : 3\n};\n// \u8ff7\u8def\u8868\u793a\u30b5\u30a4\u30ba\nvar mazeScreen = {\n  width : 16 * 30,\n  height : 9 * 30\n};\n// \u30ab\u30e1\u30e9\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\nvar cameraParams = {\n  fov : 95,\n  aspect : 1.8,\n  near : 1,\n  far : 50\n};\n// \u5149\u6e90\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\nvar lightParams = {\n  ambient : 0x404040, // \u74b0\u5883\u5149\n  point   : 0xffffff, // \u70b9\u5149\u6e90\n};\n// \u79fb\u52d5\u5909\u79fb\u4fc2\u6570\nvar moveTransition = [\n  { x :  0, y : -1 },\n  { x : -1, y :  0 },\n  { x :  0, y :  1 },\n  { x :  1, y :  0 }\n];\n// Cube\u306e\u4e00\u8fba\u9577\nvar blockSize = 10;\nvar textureFile = {\n  wall    : \"img/wall.png\",\n  door    : \"img/door.png\",\n  ceiling : \"img/ceiling.png\",\n  floor   : \"img/floor.png\",\n};\nvar joypadImage = {\n  compass  : { text : 'compass',       file : \"img/compass_rose.png\" },\n  touchSeg : { text : 'touch_segment', file : \"img/touch_segment.png\" },\n  touch    : { text : \"touch\",         file : \"img/touch.png\" },\n}\n// \u65b9\u89d2\u306b\u5bfe\u3059\u308b\u56de\u8ee2\u89d2\u5ea6\nvar rotationAngle = [\n  0,\n  Math.PI/2,\n  Math.PI,\n  -Math.PI/2\n];\n// \u5730\u56f3\nvar mapData = {\n  ceiling : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ],\n  wall : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u25a0\u3000\u3000\u3000\u3000\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u25a0\u25a1\u25a0\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u25a1\u25a0\u25a0\u3000\u3000\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u3000\u25a0\u25a0\u3000\u3000\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u3000\u25a0\u25a0\u25a0\u25a1\u25a0\u3000\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u3000\u3000\u3000\u25a1\u3000\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ],\n  floor : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u3000\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ]\n};\n\n// Variable\n// \u30d7\u30ec\u30a4\u30e4\u30fc\u60c5\u5831\nvar Player = {\n  x : 6,\n  y : 1,\n  direction : direction.west,\n};\n\n// Three.js\nvar camera;\nvar scene;\nvar renderer;\nvar mesh;\nvar light;\n// Phaser.js\nvar baseTexture;\nvar texture;\nvar textureFlame;\nvar upKey;\nvar leftKey;\nvar rightKey;\n// \u30ef\u30fc\u30af\nvar deltaX;\nvar deltaY;\nvar isTween;\n\nvar game = new Phaser.Game(\n  mazeScreen.width, mazeScreen.height, Phaser.AUTO, 'game',\n  { preload: preload, create: create, update: update, render: render }\n);\n\nvar calcPos = function(x){\n  return x * blockSize;\n};\n\nvar getMap = function(x, y){\n  return mapData.wall[y].charAt(x);\n};\n\nfunction preload() {\n  scene = new THREE.Scene();\n  camera = new THREE.PerspectiveCamera(\n    cameraParams.fov, cameraParams.aspect, cameraParams.near, cameraParams.far\n  );\n  camera.position.set( calcPos(Player.x), 0, calcPos(Player.y) );\n  camera.rotation.y = rotationAngle[Player.direction];\n  light = new THREE.PointLight( lightParams.point, 5, 10, 1 );\n  light.position.copy( camera.position );\n  light.position.z -= 1;\n  scene.add( light );\n  var ambient = new THREE.AmbientLight(lightParams.ambient);\n  scene.add(ambient);\n  var loader = new THREE.TextureLoader();\n  var texture = {\n    door   :loader.load(textureFile.door),\n    wall   :loader.load(textureFile.wall),\n    ceiling:loader.load(textureFile.ceiling),\n    floor  :loader.load(textureFile.floor)\n  };\n  var material = {\n    door   : new THREE.MeshPhongMaterial({map:texture.door, bumpMap:texture.door, bumpScale: 0.08}),\n    wall   : new THREE.MeshPhongMaterial({map:texture.wall, bumpMap:texture.wall, bumpScale: 0.05}),\n    ceiling: new THREE.MeshPhongMaterial({map:texture.ceiling, bumpMap:texture.ceiling,bumpScale: 0.09}),\n    floor  : new THREE.MeshPhongMaterial({map:texture.floor, bumpMap:texture.floor, bumpScale: 0.09})\n  };\n  var geometry = new THREE.CubeGeometry(blockSize, blockSize, blockSize);\n  for (y = 0; y < mapData.wall.length; y++) {\n    for (x = 0; x < mapData.wall[y].length; x++) {\n      if (mapData.wall[y].charAt(x) == \"\u25a0\") {\n        var cube = new THREE.Mesh(geometry, material.wall);\n        cube.position.set(blockSize * x, 0, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.wall[y].charAt(x) == \"\u25a1\") {\n        var cube = new THREE.Mesh(geometry, material.door);\n        cube.position.set(blockSize * x, 0, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.ceiling[y].charAt(x) == \"\u25a0\") {\n        var cube = new THREE.Mesh(geometry, material.ceiling);\n        cube.position.set(blockSize * x, blockSize, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.floor[y].charAt(x) == \"\u25a0\") {\n        var cube = new THREE.Mesh(geometry, material.floor);\n        cube.position.set(blockSize * x, -blockSize, blockSize * y);\n        scene.add(cube);\n      }\n    }\n  }\n  renderer = new THREE.WebGLRenderer({antialias: true});\n  renderer.setSize( mazeScreen.width, mazeScreen.height );\n  var canvas = renderer.domElement;\n  baseTexture = new PIXI.BaseTexture(canvas);\n  texture = new PIXI.Texture(baseTexture);\n  textureFrame = new Phaser.Frame(\n    0, 0, 0, mazeScreen.width, mazeScreen.height,\n  'debug', game.rnd.uuid());\n  var sprite = game.add.sprite(0, 0, texture, textureFrame);\n  game.load.image(joypadImage.compass.text, 'img/compass_rose.png');\n  game.load.image('touch_segment', 'img/touch_segment.png');\n  game.load.image('touch', 'img/touch.png');\n}\n\nfunction create() {\n  game.touchControl = game.plugins.add(Phaser.Plugin.TouchControl);\n  game.touchControl.inputEnable();\n  upKey = game.input.keyboard.addKey(Phaser.Keyboard.UP);\n  leftKey = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);\n  rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);\n  game.input.keyboard.addKeyCapture([\n    Phaser.Keyboard.UP, Phaser.Keyboard.LEFT, Phaser.Keyboard.RIGHT\n  ]);\n  isTween = false;\n}\n\nfunction update() {\n  if (upKey.isDown || game.touchControl.cursors.up) {\n    moveForward();\n    //console.log('UP');\n  }\n  if (leftKey.isDown || game.touchControl.cursors.left) {\n    _turn(Math.PI / 2, 1);\n    //console.log('LEFT');\n  }\n  if (rightKey.isDown || game.touchControl.cursors.right) {\n    _turn(-Math.PI / 2, -1);\n    //console.log('RIGHT');\n  }\n}\n\nfunction render() {\n  renderer.render(scene, camera);\n  game.renderer.updateTexture(baseTexture);\n}\n\nvar moveForward = function() {\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var map = getMap(Player.x + deltaX, Player.y + deltaY);\n  var times = (map == \"\u25a1\") ? 2 : 1;\n  if (map == \"\u25a0\") {\n    isTween = false;\n    oops();\n    return;\n  }\n  Player.x += deltaX * times;\n  Player.y += deltaY * times;\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX * times * blockSize,\n    z : camera.position.z + deltaY * times * blockSize\n  }, 1000, Phaser.Easing.Quartic.In);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.onComplete.add(function(){\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar _turn = function(rotation, direction) {\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  var tween = game.add.tween(camera.rotation);\n  tween.to( { y: camera.rotation.y + rotation }, 1000, Phaser.Easing.Cubic.InOut );\n  tween.onUpdateCallback(function(){\n    light.rotation.y = camera.rotation.y;\n  }, this);\n  tween.onComplete.add(function() {\n    Player.direction += direction;\n    if (Player.direction > 3) Player.direction = 0;\n    if (Player.direction < 0) Player.direction = 3;\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar oops = function(){\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX,\n    z : camera.position.z + deltaY\n  }, 1000, Phaser.Easing.Cubic.InOut, false, 0, 0, true);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.onComplete.add(function(){\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar turnLeft = function(){\n  _turn(Math.PI / 2, 1);\n};\n\nvar turnRight = function(){\n  _turn(-Math.PI / 2, -1);\n};\n\n\n**\u7b97\u6570\u306f\u5fc5\u8981\u3060\u3088\u3002\u5b9f\u751f\u6d3b\u3067\u3082...**\n\n\u3053\u308c\u3067\u3001\u592a\u90ce\u3068\u6b21\u90ce\u306e\u5192\u967a\u306f\u4e00\u65e6\u7d42\u308f\u308a\u307e\u3059\u3002\n***\n\u5148\u65e5\u3001\u3046\u3061\u306e\u5c0f\u5b66\u751f\u304c\u7b97\u6570\u306e\u30c6\u30b9\u30c8\u3067\u76ee\u3082\u5f53\u3066\u3089\u308c\u306a\u3044\u3088\u3046\u306a\u70b9\u6570\u3092\u6301\u3063\u3066\u5e30\u3063\u3066\u304d\u307e\u3057\u305f\u3002\u30b9\u30de\u30db\u3067\u30b2\u30fc\u30e0\u3057\u305f\u308a\u3001Youtube\u3070\u304b\u308a\u898b\u3066\u305f\u308a\u3001\uff08\u30b9\u30de\u30db\u3092\u4e0e\u3048\u308b\u306a\u3063\u3066\uff57\uff09\u5c11\u3057\u306f\u52c9\u5b66\u306b\u52b1\u3093\u3067\u307b\u3057\u3044\u3082\u306e\u3067\u3059\u3002\u305d\u3053\u3067\u3001\n\n\u4ffa\u300c\u307b\u3089\u3001\u7b97\u6570\u3067\u304d\u308c\u3070\u3001\u3053\u3093\u306a\u30b2\u30fc\u30e0\u307f\u305f\u3044\u306a\u306e\u4f5c\u308c\u308b\u3088\uff1f\u5c11\u3057\u306f\u52c9\u5f37\u3057\u306a\u3055\u3044\u3088\u300d\n\n\u5c0f\u5b66\u751f\u300c\u3048\u3001\u306a\u306b\u3053\u308c\uff1f\u308f\u304b\u3063\u305f\uff01\u3059\u3050\u30af\u30ea\u30a2\u3059\u308b\u3088\uff01\u300d\n\n\u3044\u3084\u3001\u9055...\u9006\u52b9\u679c\u3067\u3057\u305f...orz\n***\n\u6700\u5f8c\u306f\u3001\u79fb\u52d5\u51e6\u7406\u306e\u5b9f\u88c5\u3067\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u5165\u529b\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u306e\u60c5\u5831\u3067\u3001\u9032\u3080\u306e\u304b\u3001\u65b9\u5411\u5909\u3048\u308b\u306e\u304b\u3092\u5224\u65ad\u3057\u3066\u3001\u30ab\u30e1\u30e9\u3092\u64cd\u4f5c\u3059\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u524d\u9032\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n```js:poge.js\nvar moveForward = function() {\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var map = getMap(Player.x + deltaX, Player.y + deltaY);\n  // \u6249\u306a\u3089\u3082\u3046\u4e00\u6b69\u9032\u3080\n  var times = (map == \"\u25a1\") ? 2 : 1;\n  if (map == \"\u25a0\") {\n    return;\n  }\n  // \u4f4d\u7f6e\u60c5\u5831\u306e\u66f4\u65b0\n  Player.x += deltaX * times;\n  Player.y += deltaY * times;\n  // \u30ab\u30e1\u30e9\u306e\u4f4d\u7f6e\u66f4\u65b0\n  camera.position.x += deltaX * times * blockSize;\n  camera.position.z += deltaY * times * blockSize;\n  // \u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\n  light.position.copy( camera.position );\n  light.position.x += deltaX;\n  light.position.z += deltaY;\n};\n```\n\u3053\u308c\u3092\u3001update\u95a2\u6570\u3067\u30b3\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```js:poge.js\nfunction update() {\n  if (upKey.isDown || game.touchControl.cursors.up) {\n    moveForward();\n    console.log('UP');\n  }\n  if (leftKey.isDown || game.touchControl.cursors.left) {\n```\n\u3053\u306e\u307e\u307e\u3067\u826f\u3044\u3068\u3044\u3048\u3070\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u306a\u3093\u304b\u3053\u3046\u3001\u30b0\u30b0\u30c3\u3068\u6b69\u3044\u3066\u308b\u96f0\u56f2\u6c17\u304c\u307b\u3057\u3044\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff01\u305d\u3053\u3067\u3001Tween\u3068\u3044\u3046\u6a5f\u80fd\u3067\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u3066\u307f\u307e\u3059\u3002\nTween\u3067\u306f\u3001\u521d\u671f\u5024\u3068\u6700\u7d42\u7684\u306a\u5024\u3068\u6642\u9593\u3092\u30bb\u30c3\u30c8\u3059\u308b\u3068\u3001\u521d\u671f\u5024\u304b\u3089\u6700\u7d42\u5024\u307e\u3067\u30bb\u30c3\u30c8\u3057\u305f\u6642\u9593\u3092\u304b\u3051\u3066\u5909\u5316\u3055\u305b\u3066\u304f\u308c\u307e\u3059\u3002\u3069\u3093\u306a\u5909\u5316\u3092\u3059\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\u95a2\u6570\u3092\u81ea\u4f5c\u3082\u3067\u304d\u307e\u3059\u304c\u30d7\u30ea\u30bb\u30c3\u30c8\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n[\u3053\u3053](http://phaser.io/docs/2.4.6/Phaser.Easing.html)\u306b\u30d7\u30ea\u30bb\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\u3069\u3093\u306a\u52d5\u304d\u306a\u306e\u304b\u306f\u3001[Tween.js\u306e\u30b0\u30e9\u30d5](http://sole.github.io/tween.js/examples/03_graphs.html)\u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u304b...\n\n\u5148\u307b\u3069\u306emoveForward\u95a2\u6570\u306e\u30ab\u30e1\u30e9\u306e\u4f4d\u7f6e\u66f4\u65b0\u3068\u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\u306e\u90e8\u5206\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```js:poge.js\n  // \u30ab\u30e1\u30e9\u3068\u5149\u6e90\u306e\u4f4d\u7f6e\u66f4\u65b0\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX * times * blockSize,\n    z : camera.position.z + deltaY * times * blockSize\n  }, 1000, Phaser.Easing.Quartic.In);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.start();\n```\n1000ms\u304b\u3051\u3066\u5ea7\u6a19\u304c\u5909\u5316\u3057\u307e\u3059\u3002\u5149\u6e90\u306e\u4f4d\u7f6e\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u3067\u5909\u5316\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\n\u540c\u69d8\u306b\u5411\u304d\u306e\u5909\u66f4\u306f\u3001y\u8ef8\u3067\u56de\u8ee2\u3055\u305b\u308c\u3070\u3044\u3044\u308f\u3051\u3067\u3059\u3002\n***\n\u226a\u5f8c\u8a18\u226b\n\u307e\u3041\u3001\u606f\u5b50\u306b\u7b97\u6570\u3092\u52c9\u5f37\u3057\u3066\u307b\u3057\u3044\u4e00\u5fc3\u3067\u3001javascript\u3082Three\u3068\u304bPhaser\u3082\u4f7f\u3044\u59cb\u3081\u30661\u9031\u9593\u307b\u3069\u306a\u306e\u3067\u3001\u7a1a\u62d9\u306a\u611f\u3058\u3067\u30a2\u30ec\u3067\u3059\u304c\u3001\u6700\u5f8c\u306b\u30c7\u30e2\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n***\n[\u30c7\u30e2](http://tkymgr.o0o0.jp/demo/)\n![final.png](https://qiita-image-store.s3.amazonaws.com/0/105644/f8614f1e-01f1-2a6b-ae60-23c7c737f37c.png)\n\n```js:poge-final.js\n//*--- Const\n// \u65b9\u89d2\nvar direction = {\n  north : 0,\n  west  : 1,\n  south : 2,\n  east  : 3\n};\n// \u8ff7\u8def\u8868\u793a\u30b5\u30a4\u30ba\nvar mazeScreen = {\n  width : 16 * 30,\n  height : 9 * 30\n};\n// \u30ab\u30e1\u30e9\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\nvar cameraParams = {\n  fov : 95,\n  aspect : 1.8,\n  near : 1,\n  far : 50\n};\n// \u5149\u6e90\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\nvar lightParams = {\n  ambient : 0x404040, // \u74b0\u5883\u5149\n  point   : 0xffffff, // \u70b9\u5149\u6e90\n};\n// \u79fb\u52d5\u5909\u79fb\u4fc2\u6570\nvar moveTransition = [\n  { x :  0, y : -1 },\n  { x : -1, y :  0 },\n  { x :  0, y :  1 },\n  { x :  1, y :  0 }\n];\n// Cube\u306e\u4e00\u8fba\u9577\nvar blockSize = 10;\nvar textureFile = {\n  wall    : \"img/wall.png\",\n  door    : \"img/door.png\",\n  ceiling : \"img/ceiling.png\",\n  floor   : \"img/floor.png\",\n};\nvar joypadImage = {\n  compass  : { text : 'compass',       file : \"img/compass_rose.png\" },\n  touchSeg : { text : 'touch_segment', file : \"img/touch_segment.png\" },\n  touch    : { text : \"touch\",         file : \"img/touch.png\" },\n}\n// \u65b9\u89d2\u306b\u5bfe\u3059\u308b\u56de\u8ee2\u89d2\u5ea6\nvar rotationAngle = [\n  0,\n  Math.PI/2,\n  Math.PI,\n  -Math.PI/2\n];\n// \u5730\u56f3\nvar mapData = {\n  ceiling : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ],\n  wall : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u25a0\u3000\u3000\u3000\u3000\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u25a0\u25a1\u25a0\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u25a1\u25a0\u25a0\u3000\u3000\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u3000\u25a0\u25a0\u3000\u3000\u25a0\u3000\u25a0\",\n    \"\u25a0\u25a0\u3000\u25a0\u25a0\u25a0\u25a1\u25a0\u3000\u25a0\",\n    \"\u25a0\u3000\u3000\u3000\u3000\u3000\u3000\u25a1\u3000\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ],\n  floor : [\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u3000\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\",\n    \"\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\u25a0\"\n  ]\n};\n\n// Variable\n// \u30d7\u30ec\u30a4\u30e4\u30fc\u60c5\u5831\nvar Player = {\n  x : 6,\n  y : 1,\n  direction : direction.west,\n};\n\n// Three.js\nvar camera;\nvar scene;\nvar renderer;\nvar mesh;\nvar light;\n// Phaser.js\nvar baseTexture;\nvar texture;\nvar textureFlame;\nvar upKey;\nvar leftKey;\nvar rightKey;\n// \u30ef\u30fc\u30af\nvar deltaX;\nvar deltaY;\nvar isTween;\n\nvar game = new Phaser.Game(\n  mazeScreen.width, mazeScreen.height, Phaser.AUTO, 'game',\n  { preload: preload, create: create, update: update, render: render }\n);\n\nvar calcPos = function(x){\n  return x * blockSize;\n};\n\nvar getMap = function(x, y){\n  return mapData.wall[y].charAt(x);\n};\n\nfunction preload() {\n  scene = new THREE.Scene();\n  camera = new THREE.PerspectiveCamera(\n    cameraParams.fov, cameraParams.aspect, cameraParams.near, cameraParams.far\n  );\n  camera.position.set( calcPos(Player.x), 0, calcPos(Player.y) );\n  camera.rotation.y = rotationAngle[Player.direction];\n  light = new THREE.PointLight( lightParams.point, 5, 10, 1 );\n  light.position.copy( camera.position );\n  light.position.z -= 1;\n  scene.add( light );\n  var ambient = new THREE.AmbientLight(lightParams.ambient);\n  scene.add(ambient);\n  var loader = new THREE.TextureLoader();\n  var texture = {\n    door   :loader.load(textureFile.door),\n    wall   :loader.load(textureFile.wall),\n    ceiling:loader.load(textureFile.ceiling),\n    floor  :loader.load(textureFile.floor)\n  };\n  var material = {\n    door   : new THREE.MeshPhongMaterial({map:texture.door, bumpMap:texture.door, bumpScale: 0.08}),\n    wall   : new THREE.MeshPhongMaterial({map:texture.wall, bumpMap:texture.wall, bumpScale: 0.05}),\n    ceiling: new THREE.MeshPhongMaterial({map:texture.ceiling, bumpMap:texture.ceiling,bumpScale: 0.09}),\n    floor  : new THREE.MeshPhongMaterial({map:texture.floor, bumpMap:texture.floor, bumpScale: 0.09})\n  };\n  var geometry = new THREE.CubeGeometry(blockSize, blockSize, blockSize);\n  for (y = 0; y < mapData.wall.length; y++) {\n    for (x = 0; x < mapData.wall[y].length; x++) {\n      if (mapData.wall[y].charAt(x) == \"\u25a0\") {\n        var cube = new THREE.Mesh(geometry, material.wall);\n        cube.position.set(blockSize * x, 0, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.wall[y].charAt(x) == \"\u25a1\") {\n        var cube = new THREE.Mesh(geometry, material.door);\n        cube.position.set(blockSize * x, 0, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.ceiling[y].charAt(x) == \"\u25a0\") {\n        var cube = new THREE.Mesh(geometry, material.ceiling);\n        cube.position.set(blockSize * x, blockSize, blockSize * y);\n        scene.add(cube);\n      }\n      if (mapData.floor[y].charAt(x) == \"\u25a0\") {\n      \tvar cube = new THREE.Mesh(geometry, material.floor);\n      \tcube.position.set(blockSize * x, -blockSize, blockSize * y);\n      \tscene.add(cube);\n      }\n    }\n  }\n  renderer = new THREE.WebGLRenderer({antialias: true});\n  renderer.setSize( mazeScreen.width, mazeScreen.height );\n  var canvas = renderer.domElement;\n  baseTexture = new PIXI.BaseTexture(canvas);\n  texture = new PIXI.Texture(baseTexture);\n  textureFrame = new Phaser.Frame(\n    0, 0, 0, mazeScreen.width, mazeScreen.height,\n  'debug', game.rnd.uuid());\n  var sprite = game.add.sprite(0, 0, texture, textureFrame);\n  game.load.image(joypadImage.compass.text, 'img/compass_rose.png');\n  game.load.image('touch_segment', 'img/touch_segment.png');\n  game.load.image('touch', 'img/touch.png');\n}\n\nfunction create() {\n  game.touchControl = game.plugins.add(Phaser.Plugin.TouchControl);\n  game.touchControl.inputEnable();\n  upKey = game.input.keyboard.addKey(Phaser.Keyboard.UP);\n  leftKey = game.input.keyboard.addKey(Phaser.Keyboard.LEFT);\n  rightKey = game.input.keyboard.addKey(Phaser.Keyboard.RIGHT);\n  game.input.keyboard.addKeyCapture([\n    Phaser.Keyboard.UP, Phaser.Keyboard.LEFT, Phaser.Keyboard.RIGHT\n  ]);\n  isTween = false;\n}\n\nfunction update() {\n  if (upKey.isDown || game.touchControl.cursors.up) {\n    moveForward();\n    //console.log('UP');\n  }\n  if (leftKey.isDown || game.touchControl.cursors.left) {\n    _turn(Math.PI / 2, 1);\n    //console.log('LEFT');\n  }\n  if (rightKey.isDown || game.touchControl.cursors.right) {\n    _turn(-Math.PI / 2, -1);\n    //console.log('RIGHT');\n  }\n}\n\nfunction render() {\n  renderer.render(scene, camera);\n  game.renderer.updateTexture(baseTexture);\n}\n\nvar moveForward = function() {\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var map = getMap(Player.x + deltaX, Player.y + deltaY);\n  var times = (map == \"\u25a1\") ? 2 : 1;\n  if (map == \"\u25a0\") {\n    isTween = false;\n    oops();\n    return;\n  }\n  Player.x += deltaX * times;\n  Player.y += deltaY * times;\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX * times * blockSize,\n    z : camera.position.z + deltaY * times * blockSize\n  }, 1000, Phaser.Easing.Quartic.In);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.onComplete.add(function(){\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar _turn = function(rotation, direction) {\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  var tween = game.add.tween(camera.rotation);\n  tween.to( { y: camera.rotation.y + rotation }, 1000, Phaser.Easing.Cubic.InOut );\n  tween.onUpdateCallback(function(){\n    light.rotation.y = camera.rotation.y;\n  }, this);\n  tween.onComplete.add(function() {\n    Player.direction += direction;\n    if (Player.direction > 3) Player.direction = 0;\n    if (Player.direction < 0) Player.direction = 3;\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar oops = function(){\n  if (isTween) {\n    return;\n  }\n  isTween = true;\n  deltaX = moveTransition[Player.direction].x;\n  deltaY = moveTransition[Player.direction].y;\n  var tween = game.add.tween(camera.position);\n  tween.to({\n    x : camera.position.x + deltaX,\n    z : camera.position.z + deltaY\n  }, 1000, Phaser.Easing.Cubic.InOut, false, 0, 0, true);\n  tween.onUpdateCallback(function(){\n    light.position.copy( camera.position );\n    light.position.x += deltaX;\n    light.position.z += deltaY;\n  }, this);\n  tween.onComplete.add(function(){\n    isTween = false;\n  });\n  tween.start();\n};\n\nvar turnLeft = function(){\n  _turn(Math.PI / 2, 1);\n};\n\nvar turnRight = function(){\n  _turn(-Math.PI / 2, -1);\n};\n```\n", "tags": ["JavaScript", "three.js", "Phaser", "game", "battle"]}