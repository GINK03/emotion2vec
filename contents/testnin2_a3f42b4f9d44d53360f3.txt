{"context": " More than 1 year has passed since last update.\n\n1. \u306f\u3058\u3081\u306b\nSendGrid\u521d\u5fc3\u8005\u306e\u305f\u3081\u306e\u6ce8\u610f\u70b9\uff08SoftLayer\u7248\uff09 \u306b\u3066\u7d39\u4ecb\u3057\u305f\u3088\u3046\u306b\u3001SendGrid\u306f\u3069\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u9078\u629e\u3059\u308b\u304b\u306b\u3088\u3063\u3066\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u9001\u4fe1\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\u7279\u306b\u6ce8\u610f\u3059\u308b\u3079\u304d\u9805\u76ee\u306f\u3001Click Tracking\u3084Open Tracking\u3067\u3059\u3002\u8a73\u7d30\u306f\u5148\u8ff0\u306e\u30ea\u30f3\u30af\u3092\u3054\u78ba\u8a8d\u4e0b\u3055\u3044\u3002\n\u30ea\u30ec\u30fc\u30b5\u30fc\u30d0\u30fc\u306b\u3088\u3063\u3066\u306f\u3001SendGrid\u3078\u306e\u8ee2\u9001\u524d\u306bPostfix\u306b\u3066X-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u30e1\u30fc\u30eb\u9001\u4fe1\u6642\u306bClick Tracking/Open Tracking\u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u3001Postfix\u3092\u30ea\u30ec\u30fc\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u3044\u308b\u969b\u306b\u3001SendGrid\u306eX-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u5404\u7a2e\u8a2d\u5b9a\u3092\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u3092\u63d0\u793a\u3057\u307e\u3059\u3002\n\n2. Postfix\u306e\u5c0e\u5165\u3068\u69cb\u6210\n\n2.1 Postfix\u306e\u5c0e\u5165\n\u4eca\u56de\u306f\u57f7\u7b46\u6642\u70b9\u3067\u6700\u65b0\u306eCentOS7\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002SASL\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001cyrus-sasl-plain\u3082\u4f75\u305b\u3066\u5c0e\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nPostfix\u306e\u5c0e\u5165\n# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n# yum install -y postfix cyrus-sasl-plain\n\n# postconf |grep mail_version\nmail_version = 2.10.1\nmilter_macro_v = $mail_name $mail_version\n\n\n\n\n2.2 SendGrid\u3068\u9023\u643a\u3059\u308b\u305f\u3081\u306e\u30ea\u30ec\u30fc\u8a2d\u5b9a\n/etc/postfix/main.cf\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff08\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u3082\u306e\u306e\u307f\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\uff09\u3002yourSendGridUsername\u3068yourSendGridPassword\u306e\u7b87\u6240\u306f\u3001SendGrid\u306euserid/password\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001pcre\u3068\u306fPerl Compatible Regular Expressions\uff08Perl \u4e92\u63db\u6b63\u898f\u8868\u73fe\uff09\u306e\u3053\u3068\u3067\u3059\u3002\n\n/etc/postfix/main.cf\nsmtp_sasl_auth_enable = yes\nsmtp_sasl_password_maps = static:yourSendGridUsername:yourSendGridPassword\nsmtp_sasl_security_options = noanonymous\nsmtp_tls_security_level = encrypt\nheader_size_limit = 4096000\nrelayhost = [smtp.sendgrid.net]:587\nheader_checks = pcre:/etc/postfix/header_checks\n\n\n\u53c2\u8003URL\nhttps://sendgrid.kke.co.jp/docs/Integrate/Mail_Servers/postfix.html\nhttps://knowledgelayer.softlayer.com/procedure/e-mail-delivery-service-server-side-configuration-centos-plesk-postfix\n\n3. X-SMTPAPI\u30d8\u30c3\u30c0\u4ed8\u4e0e\u306e\u8a2d\u5b9a\nPostfix\u3067\u306e\u30ea\u30ec\u30fc\u6642\u306bX-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u305f\u3081\u306b\u3001/etc/postfix/header_checks\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001subscriptiontrack\u3001clicktrack\u3001opentrack\u3092\u5168\u3066\u7121\u52b9\u306b\u3059\u308b\u969b\u306e\u4f8b\u3092\u6319\u3052\u3066\u3044\u307e\u3059\u3002\u3082\u3057\u6709\u52b9\u306b\u3057\u305f\u3044\u5834\u5408\u306f\u5168\u3066{\"enable\":1}\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n/etc/postfix/header_checks\n/^From:/ PREPEND X-SMTPAPI: {\"filters\":{\"subscriptiontrack\":{\"settings\":{\"enable\":0}},\"clicktrack\":{\"settings\":{\"enable\":0}},\"opentrack\":{\"settings\":{\"enable\":0}}}}\n\n\n\u5168\u3066\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bPostfix\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\npostfix\u306e\u518d\u8d77\u52d5\n# systemctl restart postfix\n\n\n\u53c2\u8003URL\nhttps://sendgrid.kke.co.jp/docs/API_Reference/SMTP_API/\nhttps://sendgrid.com/docs/Utilities/smtpapi_validator.html\nhttp://hoursofop.tumblr.com/post/17760274650\n\n4. \u30c6\u30b9\u30c8\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7aef\u672b\u304b\u3089\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n# sendmail xxxxx@xxx.xxx.xxx\nFrom:test@test.com\nTo:xxxxx@xxx.xxx.xxx\nSubject: Test4\nThis is test4\nhttp://www.yahoo.co.jp\n.\n\n\u3059\u308b\u3068\u3001maillog\u304b\u3089\u3001X-SMTPAPI\u304c\u30d8\u30c3\u30c0\u30fc\u306b\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u65e8\u306e\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n/var/log/maillog\nMar  7 22:34:00 osc01 postfix/pickup[22110]: C13B2FC30D: uid=0 from=<root>\nMar  7 22:34:00 osc01 postfix/cleanup[26093]: C13B2FC30D: prepend: header From:test@test.com from local; from=<root@osc01.localdomain> to=<xxxxx@xxx.xxx.xxx>: X-SMTPAPI: {\"filters\":{\"subscriptiontrack\":{\"settings\":{\"enable\":0}},\"clicktrack\":{\"settings\":{\"enable\":0}},\"opentrack\":{\"settings\":{\"enable\":0}}}}\nMar  7 22:34:00 osc01 postfix/cleanup[26093]: C13B2FC30D: message-id=<20160307133400.C13B2FC30D@osc01.localdomain>\nMar  7 22:34:00 osc01 postfix/qmgr[2397]: C13B2FC30D: from=<root@osc01.localdomain>, size=441, nrcpt=1 (queue active)\nMar  7 22:34:02 osc01 postfix/smtp[26095]: C13B2FC30D: to=<xxxxx@xxx.xxx.xxx>, relay=smtp.sendgrid.net[xxx.xxx.xxx.xxx]:587, delay=48, delays=46/0.14/1.1/0.29, dsn=2.0.0, status=sent (250 Ok: queued as vG74ZLh5TnCCvxnH3mkz_A)\nMar  7 22:34:02 osc01 postfix/qmgr[2397]: C13B2FC30D: removed\n\n\n\u3061\u306a\u307f\u306bFree Package\u3067\u3042\u3063\u3066\u3082\u3001Click Tracking\u3084Open Tracking\u306e\u6709\u52b9\u30fb\u7121\u52b9\u306f\u5207\u308a\u66ff\u3048\u53ef\u80fd\u3067\u3057\u305f\u3002\n\nClick Tracking\u3084Open Tracking\u3092\u7121\u52b9\u306b\u8a2d\u5b9a\u3057\u305f\u6642={\"enable\":0}\n\n\nClick Tracking\u3084Open Tracking\u3092\u6709\u52b9\u306b\u8a2d\u5b9a\u3057\u305f\u6642={\"enable\":1}\n\n\n\n#1. \u306f\u3058\u3081\u306b\n[SendGrid\u521d\u5fc3\u8005\u306e\u305f\u3081\u306e\u6ce8\u610f\u70b9\uff08SoftLayer\u7248\uff09](http://qiita.com/testnin2/items/ceb27d418a017c0c3490) \u306b\u3066\u7d39\u4ecb\u3057\u305f\u3088\u3046\u306b\u3001SendGrid\u306f\u3069\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u9078\u629e\u3059\u308b\u304b\u306b\u3088\u3063\u3066\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u9001\u4fe1\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\u7279\u306b\u6ce8\u610f\u3059\u308b\u3079\u304d\u9805\u76ee\u306f\u3001Click Tracking\u3084Open Tracking\u3067\u3059\u3002\u8a73\u7d30\u306f\u5148\u8ff0\u306e\u30ea\u30f3\u30af\u3092\u3054\u78ba\u8a8d\u4e0b\u3055\u3044\u3002\n\u30ea\u30ec\u30fc\u30b5\u30fc\u30d0\u30fc\u306b\u3088\u3063\u3066\u306f\u3001SendGrid\u3078\u306e\u8ee2\u9001\u524d\u306bPostfix\u306b\u3066X-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u30e1\u30fc\u30eb\u9001\u4fe1\u6642\u306bClick Tracking/Open Tracking\u3092\u7121\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u3053\u3053\u3067\u306f\u3001Postfix\u3092\u30ea\u30ec\u30fc\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u5229\u7528\u3057\u3066\u3044\u308b\u969b\u306b\u3001SendGrid\u306eX-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u5404\u7a2e\u8a2d\u5b9a\u3092\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u3092\u63d0\u793a\u3057\u307e\u3059\u3002\n\n#2. Postfix\u306e\u5c0e\u5165\u3068\u69cb\u6210\n\n##2.1 Postfix\u306e\u5c0e\u5165\n\u4eca\u56de\u306f\u57f7\u7b46\u6642\u70b9\u3067\u6700\u65b0\u306eCentOS7\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002SASL\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001cyrus-sasl-plain\u3082\u4f75\u305b\u3066\u5c0e\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```text:Postfix\u306e\u5c0e\u5165\n# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n# yum install -y postfix cyrus-sasl-plain\n\n# postconf |grep mail_version\nmail_version = 2.10.1\nmilter_macro_v = $mail_name $mail_version\n\n```\n\n##2.2 SendGrid\u3068\u9023\u643a\u3059\u308b\u305f\u3081\u306e\u30ea\u30ec\u30fc\u8a2d\u5b9a\n`/etc/postfix/main.cf`\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff08\u6700\u4f4e\u9650\u5fc5\u8981\u306a\u3082\u306e\u306e\u307f\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\uff09\u3002yourSendGridUsername\u3068yourSendGridPassword\u306e\u7b87\u6240\u306f\u3001SendGrid\u306euserid/password\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001pcre\u3068\u306fPerl Compatible Regular Expressions\uff08Perl \u4e92\u63db\u6b63\u898f\u8868\u73fe\uff09\u306e\u3053\u3068\u3067\u3059\u3002\n\n```text:/etc/postfix/main.cf\nsmtp_sasl_auth_enable = yes\nsmtp_sasl_password_maps = static:yourSendGridUsername:yourSendGridPassword\nsmtp_sasl_security_options = noanonymous\nsmtp_tls_security_level = encrypt\nheader_size_limit = 4096000\nrelayhost = [smtp.sendgrid.net]:587\nheader_checks = pcre:/etc/postfix/header_checks\n```\n\n\u53c2\u8003URL\nhttps://sendgrid.kke.co.jp/docs/Integrate/Mail_Servers/postfix.html\nhttps://knowledgelayer.softlayer.com/procedure/e-mail-delivery-service-server-side-configuration-centos-plesk-postfix\n\n#3. X-SMTPAPI\u30d8\u30c3\u30c0\u4ed8\u4e0e\u306e\u8a2d\u5b9a\nPostfix\u3067\u306e\u30ea\u30ec\u30fc\u6642\u306bX-SMTPAPI\u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3059\u308b\u305f\u3081\u306b\u3001`/etc/postfix/header_checks`\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001subscriptiontrack\u3001clicktrack\u3001opentrack\u3092\u5168\u3066\u7121\u52b9\u306b\u3059\u308b\u969b\u306e\u4f8b\u3092\u6319\u3052\u3066\u3044\u307e\u3059\u3002\u3082\u3057\u6709\u52b9\u306b\u3057\u305f\u3044\u5834\u5408\u306f\u5168\u3066{\"enable\":1}\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```text:/etc/postfix/header_checks\n/^From:/ PREPEND X-SMTPAPI: {\"filters\":{\"subscriptiontrack\":{\"settings\":{\"enable\":0}},\"clicktrack\":{\"settings\":{\"enable\":0}},\"opentrack\":{\"settings\":{\"enable\":0}}}}\n```\n\n\u5168\u3066\u4f5c\u696d\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u3092\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306bPostfix\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```text:postfix\u306e\u518d\u8d77\u52d5\n# systemctl restart postfix\n```\n\n\u53c2\u8003URL\nhttps://sendgrid.kke.co.jp/docs/API_Reference/SMTP_API/\nhttps://sendgrid.com/docs/Utilities/smtpapi_validator.html\nhttp://hoursofop.tumblr.com/post/17760274650\n\n\n#4. \u30c6\u30b9\u30c8\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7aef\u672b\u304b\u3089\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n```\n# sendmail xxxxx@xxx.xxx.xxx\nFrom:test@test.com\nTo:xxxxx@xxx.xxx.xxx\nSubject: Test4\nThis is test4\nhttp://www.yahoo.co.jp\n.\n```\n\n\u3059\u308b\u3068\u3001maillog\u304b\u3089\u3001X-SMTPAPI\u304c\u30d8\u30c3\u30c0\u30fc\u306b\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u65e8\u306e\u60c5\u5831\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```text:/var/log/maillog\nMar  7 22:34:00 osc01 postfix/pickup[22110]: C13B2FC30D: uid=0 from=<root>\nMar  7 22:34:00 osc01 postfix/cleanup[26093]: C13B2FC30D: prepend: header From:test@test.com from local; from=<root@osc01.localdomain> to=<xxxxx@xxx.xxx.xxx>: X-SMTPAPI: {\"filters\":{\"subscriptiontrack\":{\"settings\":{\"enable\":0}},\"clicktrack\":{\"settings\":{\"enable\":0}},\"opentrack\":{\"settings\":{\"enable\":0}}}}\nMar  7 22:34:00 osc01 postfix/cleanup[26093]: C13B2FC30D: message-id=<20160307133400.C13B2FC30D@osc01.localdomain>\nMar  7 22:34:00 osc01 postfix/qmgr[2397]: C13B2FC30D: from=<root@osc01.localdomain>, size=441, nrcpt=1 (queue active)\nMar  7 22:34:02 osc01 postfix/smtp[26095]: C13B2FC30D: to=<xxxxx@xxx.xxx.xxx>, relay=smtp.sendgrid.net[xxx.xxx.xxx.xxx]:587, delay=48, delays=46/0.14/1.1/0.29, dsn=2.0.0, status=sent (250 Ok: queued as vG74ZLh5TnCCvxnH3mkz_A)\nMar  7 22:34:02 osc01 postfix/qmgr[2397]: C13B2FC30D: removed\n```\n\n\u3061\u306a\u307f\u306bFree Package\u3067\u3042\u3063\u3066\u3082\u3001Click Tracking\u3084Open Tracking\u306e\u6709\u52b9\u30fb\u7121\u52b9\u306f\u5207\u308a\u66ff\u3048\u53ef\u80fd\u3067\u3057\u305f\u3002\n\n* Click Tracking\u3084Open Tracking\u3092\u7121\u52b9\u306b\u8a2d\u5b9a\u3057\u305f\u6642={\"enable\":0}<br>\n![001.jpg](https://qiita-image-store.s3.amazonaws.com/0/62127/b36a8403-f9a2-42df-3798-aa867b2733b1.jpeg)\n* Click Tracking\u3084Open Tracking\u3092\u6709\u52b9\u306b\u8a2d\u5b9a\u3057\u305f\u6642={\"enable\":1}<br>\n![002.jpg](https://qiita-image-store.s3.amazonaws.com/0/62127/8da118c6-2dc2-254c-d736-107e97138c5f.jpeg)\n\n", "tags": ["ShinobiLayer", "SendGrid", "postfix", "SoftLayer", "SMTPAPI"]}