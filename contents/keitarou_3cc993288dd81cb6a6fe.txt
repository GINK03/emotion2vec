{"context": " More than 1 year has passed since last update.\n\nBackbone.js\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u307f\u308b\n\u4eca\u56de\u306fBackbone\u306eRouter, History\n\u6b63\u76f4\u3001\u3061\u3087\u3063\u3068\u75b2\u308c\u3066\u304d\u305f\u306e\u3068\u3001Backbone.History\u96e3\u3057\u3044\u306e\u3067\u30ad\u30ec\u304c\u306a\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\u9593\u9055\u3063\u3066\u89e3\u91c8\u3057\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3064\u3082\u308a\u3067\u3044\u308b\u306e\u3067\u52a9\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5bfe\u8c61Version\nBackbone.js 1.2.3\n\nBackbone.Router\n\n  // Router\u306fMVC\u3067\u3044\u3046\u3068\u3053\u308d\u306eController\u3068\u601d\u3063\u3066\u826f\u3044, Marionette.js\u3067\u306fRouter, Controller\u3067\u5f79\u5272\u3092\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304cBackbone.js\u3067\u306f\u4e21\u65b9\u306e\u5f79\u5272\u3092\u6301\u3064\u3053\u3068\u306b\u306a\u308b\n  // \u5f15\u6570options\u306b\u306f.Router.routes\u3092\u4e0a\u66f8\u304d\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n  // Model\u3084View\u3068\u540c\u3058\u304f\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u30fc\u5b9a\u7fa9\u3057\u3066\u3044\u308b.initialize\u3092\u6700\u5f8c\u306b\u8a55\u4fa1\u3059\u308b\n  var Router = Backbone.Router = function(options) {\n\n    // options\u304c\u3042\u308c\u304c.routes\u306b\u3066\n    options || (options = {});\n    if (options.routes) this.routes = options.routes;\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    this._bindRoutes();\n    j\n    // \u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u521d\u671f\u5316\u51e6\u7406\u306e\u5b9f\u884c\n    this.initialize.apply(this, arguments);\n  };\n  j\n  // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5909\u63db\u3059\u308b\u969b\u306b\u4f7f\u3046\n  var optionalParam = /\\((.*?)\\)/g;\n  var namedParam    = /(\\(\\?)?:\\w+/g;\n  var splatParam    = /\\*\\w+/g;\n  var escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n  _.extend(Router.prototype, Events, {\n\n    initialize: function(){},\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    // \u5f15\u6570\u306e\u9806\u756a\u3092\u305a\u3089\u3059\u4ed5\u7d44\u307f\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u5c11\u3057\u898b\u3065\u3089\u3044\n    route: function(route, name, callback) {\n\n      // route\u304c\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3058\u3083\u306a\u3044\u306f\u5834\u5408\u306b\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\n      if (!_.isRegExp(route)) route = this._routeToRegExp(route);\n\n      // 2\u3064\u3081\u306e\u6587\u5b57\u5217\u306b\u306fcallback\u7528\u306e\u95a2\u6570\u304c\u5165\u3063\u3066\u304f\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\n      // \u305d\u306e\u5834\u5408\u306f\u5f15\u6570\u306e\u5f79\u5272\u3092\u305a\u3089\u3059 \n      if (_.isFunction(name)) {\n        callback = name;\n        name = '';\n      }\n      // \u3053\u3053\u3067\u3084\u3063\u3068\u5909\u6570callback\u306b\u95a2\u6570\u304c\u5165\u308b\u3053\u3068\u3092\u7d04\u675f\u3067\u304d\u308b\n      if (!callback) callback = this[name];\n\n      // \u4e00\u65e6\u6574\u7406\u3059\u308b\u3068\n      // route: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306ekey\u540d\u3068\u306a\u308b\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n      // name: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9f\u884c\u6642\u306ecallback\u95a2\u6570\u306e\u30e1\u30bd\u30c3\u30c9\u540d(Router.xxx)\u3068\u8aad\u3081\u308b\u5834\u5408\u306b\u306e\u307f\u5229\u7528\u3001callback\u304c\u7121\u540d\u95a2\u6570\u306e\u5834\u5408\u306f\u7279\u306b\u5f79\u5272\u304c\u306a\u3044\n      // callback: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9f\u884c\u6642\u306ecallback\u95a2\u6570\n\n\n      // \u3053\u306e\u8a18\u8ff0\u306b\u95a2\u3057\u3066\u306fvar self = this;\u3068\u540c\u3058\u610f\u5473\u5408\u3044\u3067\u4f7f\u3063\u3066\u3044\u308b\n      // \u2193\u306ehistory.route\u306b\u3066\u7121\u540d\u95a2\u6570\u3068\u767b\u9332\u3059\u308b\u304c\u305d\u306e\u95a2\u6570\u306econtext\u304cRouter\u3068\u306f\u7570\u306a\u308b\u304b\u3089\u3053\u3046\u306a\u3063\u3066\u3044\u308b\n      var router = this;\n\n      // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u95a2\u3059\u308b\u60c5\u5831\u306fBackbone.history\u306b\u767b\u9332\u3059\u308b\n      // Backbone.history.route\u306b\u95a2\u3057\u3066\u306f\u5358\u7d14\u306b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u767b\u9332\u3059\u308b\u3060\u3051\u3067\u3042\u308b\n      // \u7b2c\u4e8c\u5f15\u6570\u306e\u7121\u540d\u95a2\u6570\u304c\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6210\u7acb\u6642\u306b\u5b9f\u88c5\u3059\u308b\u95a2\u6570\u306b\u306a\u308b\n      // fragment\u3063\u3066\u3044\u3046\u306e\u306f\u5b9f\u969b\u306b\u30d6\u30e9\u30a6\u30b6\u306eURL\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3010blog/1\u3011\u306e\u3088\u3046\u306a\u30cf\u30c3\u30b7\u30e5\u306e\u5185\u5bb9\u306e\u6587\u5b57\u5217\u3092\u6307\u3057\u3066\u3044\u308b\n      Backbone.history.route(route, function(fragment) {\n\n        // \u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5f15\u6570\u306e\u60c5\u5831\u3092\u53d6\u308a\u51fa\u3059\u3002\n        // \u8981\u306f\u3001blog/(:id)\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u4eee\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u305f\u3068\u3059\u308b\u3068\u3001[id, ...]\u307f\u305f\u3044\u306a\u914d\u5217\u306bparse\u3055\u305b\u308b\u5f79\u5272\u3092\u6301\u3064\n        var args = router._extractParameters(route, fragment);\n\n        // router.execute\u306b\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306ecallback\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\n        // false\u306a\u3089route\u30a4\u30d9\u30f3\u30c8\u3092\u5b9f\u884c\u3057\u306a\u3044\u3001\u3063\u3066\u8a00\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u304c.execute\u306e\u8a55\u4fa1\u7d50\u679c\u306f\u5e38\u306bundefined\u306b\u306a\u308b\u306f\u305a\u306a\u306e\u3067\u610f\u5473\u306a\u3044\u6c17\u304c\u3059\u308b\u3002\u306a\u3093\u3093\u3060\u308d\u3046\u304b\u3053\u308c\u306f\u30fb\u30fb\u30fb\u30fb\n        if (router.execute(callback, args, name) !== false) {\n\n\n          // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306b\u30a4\u30d9\u30f3\u30c8\u30923\u3064\u767a\u884c\u3057\u3066\u3044\u308b\n          // Router\u306e \u3010route:\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u540d\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\n          // Router\u306e \u3010route\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n          // history\u306e\u3010route\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n          router.trigger.apply(router, ['route:' + name].concat(args));\n          router.trigger('route', name, args);\n          Backbone.history.trigger('route', router, name, args);\n        }\n      });\n      return this;\n    },\n\n    // \u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallbasck\u3092\u5b9f\u969b\u306b\u5b9f\u884c\u3059\u308b\u5f79\u5272\u3092\u6301\u3064\n    // \u898b\u3066\u306e\u901a\u308a\u3001callback\u306e\u5b9f\u884c\u6642\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306fRouter\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\n    execute: function(callback, args, name) {\n      if (callback) callback.apply(this, args);\n    },\n\n    // Backbone.history.navigate\u3078\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u306e\u5f79\u5272\u3067\u3042\u308b\u3002\n    // Backbone.history.navigate\u304c\u3069\u306e\u3088\u3046\u306a\u5f79\u5272\u304b\u306f\u305d\u3063\u3061\u306e\u958b\u8a2d\u306e\u6642\u306b\n    navigate: function(fragment, options) {\n      Backbone.history.navigate(fragment, options);\n      return this;\n    },\n\n    // .routes\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    // Router\u306e\u5f79\u5272\u306f\u307b\u307c\u3053\u308c\u304c\u5168\u3066\u3067\u3042\u308a\u3001\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092Backbone.history\u306b\u767b\u9332\u3057\u3001\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b8c\u4e86\u6642\u306ecallback\u3092\u5b9f\u884c\u3057\u3001\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\n    _bindRoutes: function() {\n      if (!this.routes) return;\n      this.routes = _.result(this, 'routes');\n      var route, routes = _.keys(this.routes);\n\n      // pop\u306b\u3088\u3063\u3066\u5f8c\u308d\u306e\u8981\u7d20\u304b\u3089\u767b\u9332\u3057\u3066\u3044\u3063\u3066\u308b\u306e\u306b\u6ce8\u76ee!!\n      // \u30cd\u30bf\u30d0\u30ec\u3092\u3059\u308b\u3068\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u95a2\u3059\u308b\u60c5\u5831\u306fBackbone.history\u306b\u5168\u90e8\u767b\u9332\u3055\u308c\u307e\u3059\n      // \u305d\u306e\u969b\u306f\u3053\u3053\u3067pop\u3057\u305f\u8981\u7d20\u3092Backbone.history.handlers\u3068\u3044\u3046\u914d\u5217\u306bunshift\u3067\u8ffd\u52a0\u3057\u3066\u3044\u304f\u306e\u3067\u7d50\u679c\u7684\u306bBackbone.Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u9806\u756a\u3067\u3001\u6700\u7d42\u7684\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n      // \u6700\u5f8c\u306b\u3001\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8(URL\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u6587\u5b57\u5217)\u306b\u30de\u30c3\u30c1\u3057\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u691c\u7d22\u3059\u308b\u969b\u306fBackbone.history.handlers\u3092\u4e0a\u304b\u3089\u9806\u756a\u306b\u63a2\u7d22\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n      // \u8981\u306f\u4f55\u3092\u8a00\u3044\u305f\u3044\u304b\u3068\u3044\u3046\u3068\u3001\u3088\u304f\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u30da\u30fc\u30b8\u306fBackbone.Router\u3067\u5b9a\u7fa9\u3059\u308b\u969b\u306b\u306a\u308b\u3079\u304f\u5c0f\u3055\u3044\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3059\u3079\u304d\u3067\u3059\u3002\u6700\u7d42\u7684\u306a\u63a2\u7d22\u30b3\u30b9\u30c8\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n      while ((route = routes.pop()) != null) {\n\n        // route: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306e\u540d\u524d, mypage,\u3068\u304bblog(/:id)\u3068\u304b\u306e\u6587\u5b57\u5217\u304c\u5165\u308b\n        // this.routes[route]: \u2191\u306b\u7d10\u4ed8\u3044\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6210\u7acb\u6642\u306ecallback\u306e\u95a2\u6570\u540dor\u95a2\u6570\u304c\u306f\u3044\u308b\n        // this.route\u306b\u3088\u3063\u3066\u5b9f\u969b\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n        this.route(route, this.routes[route]);\n      }\n    },\n\n    // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n    // \u4f55\u3084\u3063\u3066\u308b\u304b\u5168\u304f\u7406\u89e3\u3067\u304d\u306a\u3044\u3051\u3069\u3001\u3053\u308c\u3068\u304bUnderscore.js\u306b\u7d44\u307f\u8fbc\u3093\u3060\u3089\u3044\u3044\u3093\u3061\u3083\u3046\u3093\u304b\u306a\uff1f\n    _routeToRegExp: function(route) {\n      route = route.replace(escapeRegExp, '\\\\$&')\n                   .replace(optionalParam, '(?:$1)?')\n                   .replace(namedParam, function(match, optional) {\n                     return optional ? match : '([^/?]+)';\n                   })\n                   .replace(splatParam, '([^?]*?)');\n      return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n\n    // URL\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5185\u5bb9\u304b\u3089Router\u306b\u767b\u9332\u3057\u3066\u3044\u308b\u6b63\u898f\u8868\u73fe\u3092\u5143\u306b\u914d\u5217\u3092\u751f\u6210\u3059\u308b\n    // \u8981\u306f\u3001blog/1\u307f\u305f\u3044\u306a\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3067\u3001blog/(:id)\u307f\u305f\u3044\u306bRouter\u3067\u767b\u9332\u3057\u3066\u3044\u305f\u969b\u306b[1]\u306e\u3088\u3046\u306a\u914d\u5217\u3092\u751f\u6210\u3055\u305b\u308b\n    _extractParameters: function(route, fragment) {\n\n      // \u5f15\u6570route\u306f\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001route.exec\u306fRegExp.prototype.exec\u306e\u3053\u3068\u3067\u3042\u308b\n      // https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec\n      // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u8a55\u4fa1\u3059\u308b\n      var params = route.exec(fragment).slice(1);\n\n      return _.map(params, function(param, i) {\n        // Don't decode the search params.\n        if (i === params.length - 1) return param || null;\n        return param ? decodeURIComponent(param) : null;\n      });\n    }\n\n  });\n\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u969b\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8a55\u4fa1\u3055\u308c\u308b\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u95a2\u3059\u308b\u60c5\u5831\u306f\u6700\u7d42\u7684\u306bBackbone.History\u306b\u3066\u7ba1\u7406\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.Router\u306e\u3010route\u3011\u3010route:xxx\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.history\u306e\u3010route\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\n\n\nBackbone.History\n\n  // Backbone.History\u306fHTML5\u306epushState\u306a\u3069\u306eAPI\u3092\u30e9\u30c3\u30d7\u3059\u308b\u3053\u3068\u3067\u3001URL\u306e\u5909\u66f4\u3092\u7ba1\u7406\u3057\u3001Router\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u706b\u3055\u305b\u308b\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\n  // pushState\u306a\u3069\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30d6\u30e9\u30a6\u30b6\u306b\u3082\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306b\u3001\u72ec\u81ea\u306eURL\u7ba1\u7406\u306e\u305f\u3081\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3059\u308b\u3053\u3068\u3082\u884c\u306a\u3063\u3066\u3044\u308b\n  // -- \u304a\u3055\u3089\u3044 --\n  // history.pushState: \u30d6\u30e9\u30a6\u30b6\u306e\u5c65\u6b74\u3092\u8ffd\u52a0\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f(HTML5\u306eAPI\u306e\u3053\u3068) \n  // popState\u30a4\u30d9\u30f3\u30c8: \u5c65\u6b74\u3092\u79fb\u52d5\u3057\u305f\u3089\u767a\u706b\u3059\u308b\u30a4\u30d9\u30f3\u30c8\n  // hashchange\u30a4\u30d9\u30f3\u30c8: URL\u306e\u30cf\u30c3\u30b7\u30e5\u3060\u3051\u304c\u5909\u308f\u3063\u305f\u5834\u5408\u306b\u767a\u706b\u3059\u308b\u30a4\u30d9\u30f3\u30c8 \n  var History = Backbone.History = function() {\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306e\u914d\u5217\n    this.handlers = [];\n\n    // this.checkUrl\u3092History\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u3066\u3044\u308b\n    this.checkUrl = _.bind(this.checkUrl, this);\n\n    // Ensure that `History` can be used outside of the browser.\n    // window.location/window.history\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n    if (typeof window !== 'undefined') {\n      this.location = window.location;\n      this.history = window.history;\n    }\n  };\n\n  // Cached regex for stripping a leading hash/slash and trailing space.\n  var routeStripper = /^[#\\/]|\\s+$/g;\n\n  // Cached regex for stripping leading and trailing slashes.\n  var rootStripper = /^\\/+|\\/+$/g;\n\n  // Cached regex for stripping urls of hash.\n  var pathStripper = /#.*$/;\n\n  // .start\u304c\u5b9f\u884c\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n  // Backbone.History\u306b\u76f4\u63a5\u30e1\u30e2\u3059\u308b\u3053\u3068\u3067History\u306e\u5b9f\u88c5\u3092\u7d99\u627f\u3057\u305f\u3082\u306e\u304c\u4eee\u306b\u8907\u6570\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u30011\u3064\u3057\u304b\u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u3066\u3044\u308b\n  // Backbone.History\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u72b6\u614b(URL)\u306a\u3069\u3092\u76f4\u63a5\u7ba1\u7406\u3059\u308b\u3082\u306e\u306a\u306e\u3067\u3001\u552f\u4e00\u7121\u4e8c\u3067\u3042\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\n  History.started = false;\n\n  _.extend(History.prototype, Events, {\n\n    // URL\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306b\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3059\u308b\u304c\n    // \u305d\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u5468\u671f\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\n    interval: 50,\n\n    // Are we at the app root?\n    atRoot: function() {\n      var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n      return path === this.root && !this.getSearch();\n    },\n\n    // Does the pathname match the root?\n    matchRoot: function() {\n      var path = this.decodeFragment(this.location.pathname);\n      var root = path.slice(0, this.root.length - 1) + '/';\n      return root === this.root;\n    },\n\n    // Unicode characters in `location.pathname` are percent encoded so they're\n    // decoded for comparison. `%25` should not be decoded since it may be part\n    // of an encoded parameter.\n    decodeFragment: function(fragment) {\n      return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n\n    // In IE6, the hash fragment and search params are incorrect if the\n    // fragment contains `?`.\n    getSearch: function() {\n      var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n      return match ? match[0] : '';\n    },\n\n    // Gets the true hash value. Cannot use location.hash directly due to bug\n    // in Firefox where location.hash will always be decoded.\n    getHash: function(window) {\n      var match = (window || this).location.href.match(/#(.*)$/);\n      return match ? match[1] : '';\n    },\n\n    // Get the pathname and search params, without the root.\n    getPath: function() {\n      var path = this.decodeFragment(\n        this.location.pathname + this.getSearch()\n      ).slice(this.root.length - 1);\n      return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n\n    // \u73fe\u5728\u306efragment\u306e\u6587\u5b57\u5217\u3092\u53d6\u5f97\u3059\u308b\n    // fragment\u306e\u6587\u5b57\u5217\u3068\u306f\u3010router.html#mypage\u3011\u3067\u3044\u3046\u3068\u3053\u308d\u306e\u3010mypage\u3011\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3042\u308b\n    getFragment: function(fragment) {\n      if (fragment == null) {\n        if (this._usePushState || !this._wantsHashChange) {\n          fragment = this.getPath();\n        } else {\n          fragment = this.getHash();\n        }\n      }\n      return fragment.replace(routeStripper, '');\n    },\n\n    // Backbone.History\u306e\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\n    // \u6e21\u305b\u308boptions\n    // silent: start\u5b9f\u884c\u6642\u306efragment\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5373\u6642\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\n    // hashChange: onhashChange\u3092\u4f7f\u3063\u305fURL\u306e\u5909\u66f4\u7ba1\u7406\u3092\u884c\u3046\u304b\u5426\u304b\n    // pushState: pushState\u3092\u4f7f\u3063\u305fURL\u306e\u5909\u66f4\u7ba1\u7406\u3092\u884c\u3046\u304b\u5426\u304b\n    // root: URL\u306e\u3069\u3053\u3092\u8d77\u70b9\u306b\u30eb\u30fc\u30bf\u30fc\u3092\u8a2d\u7f6e\u3059\u308b\u304b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3010/\u3011\u306a\u3063\u3066\u3044\u308b\u3002\u4f55\u304b\u3057\u3089\u306e\u7406\u7531\u3067/mypage\u304b\u3089\u59cb\u3081\u305f\u3044\u3068\u304b\u306e\u5834\u5408\u306b\u3053\u308c\u3092\u5229\u7528\u3059\u308b\n    start: function(options) {\n\n      // Backbone.History\u306f\u5b9f\u884c\u4e2d\u3067\u3042\u308c\u3070\u3001\u4f8b\u5916\u3092\u8fd4\u3059\n      if (History.started) throw new Error('Backbone.history has already been started');\n      History.started = true;\n\n      // root\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u306f\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n      // root\u3068\u306f\u3001URL\u306e\u3069\u3053\u3092\u8d77\u70b9\u306b\u30eb\u30fc\u30bf\u30fc\u3092\u8a2d\u7f6e\u3059\u308b\u304b\u3092\u6c7a\u3081\u308b\u3082\u306e\u3060\u3068\u601d\u3063\u3066\u3044\u3044\n      this.options          = _.extend({root: '/'}, this.options, options);\n      this.root             = this.options.root\n      ;\n      // onhashchange\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u304b\u3092\u78ba\u8a8d\u3057\u3066\u3001\u7d50\u679c\u3092\u30e1\u30f3\u30d0\u306b\u6301\u305f\u305b\u308b\n      // options\u306b\u3066hashChange\u3092\u4f7f\u308f\u306a\u3044\u7528\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3042\u308b\n      // \u30e6\u30fc\u30b6\u30fc\u304c\u4f7f\u3044\u305f\u3044\u304b\u3069\u3046\u304b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306e\u7d50\u679c\u3092\u5143\u306b\u3001\u5b9f\u969b\u306b\u4f7f\u3046\u304b\u5426\u304b\u3092\u8a55\u4fa1\u3057\u3066\u3044\u308b\n      this._wantsHashChange = this.options.hashChange !== false;\n      this._hasHashChange   = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n      this._useHashChange   = this._wantsHashChange && this._hasHashChange;\n\n      // onhashchange\u3068\u540c\u3058\u304f\u3001window.history.pushState\u3092\u4f7f\u3046\u304b\u5426\u304b\u3092\u8a55\u4fa1\u3057\u3066\u3044\u308b\n      this._wantsPushState  = !!this.options.pushState;\n      this._hasPushState    = !!(this.history && this.history.pushState);\n      this._usePushState    = this._wantsPushState && this._hasPushState;\n\n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\n      this.fragment         = this.getFragment();\n\n      // Normalize root to always include a leading and trailing slash.\n      this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n      // Transition from hashChange to pushState or vice versa if both are\n      // requested.\n      if (this._wantsHashChange && this._wantsPushState) {\n\n        // If we've started off with a route from a `pushState`-enabled\n        // browser, but we're currently in a browser that doesn't support it...\n        if (!this._hasPushState && !this.atRoot()) {\n          var root = this.root.slice(0, -1) || '/';\n          this.location.replace(root + '#' + this.getPath());\n          // Return immediately as browser will do redirect to new url\n          return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n        } else if (this._hasPushState && this.atRoot()) {\n          this.navigate(this.getHash(), {replace: true});\n        }\n\n      }\n\n      // pushState\u3082hashChange\u3082\u4f7f\u308f\u306a\u3044\u30fb\u4f7f\u3048\u306a\u3044\u5834\u5408\u306fiframe\u3092\u4f7f\u3063\u3066\u5c65\u6b74\u7ba1\u7406\u3092\u884c\u3046\uff1f\n      if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n        this.iframe = document.createElement('iframe');\n        this.iframe.src = 'javascript:0';\n        this.iframe.style.display = 'none';\n        this.iframe.tabIndex = -1;\n        var body = document.body;\n        // Using `appendChild` will throw on IE < 9 if the document is not ready.\n        var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n        iWindow.document.open();\n        iWindow.document.close();\n        iWindow.location.hash = '#' + this.fragment;\n      }\n\n      // \u3053\u308c\u306faddEventListener\u306e\u30af\u30ed\u30b9\u30d6\u30e9\u30a6\u30b6\u5bfe\u5fdc\u306e\u66f8\u304d\u65b9\n      // addEventListener\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u306fattachEvent\u304c\u5b9f\u884c\u3055\u308c\u308b\n      // IE8\u4ee5\u524d\u306e\u3084\u3064\u306e\u5bfe\u5fdc\u306b\u306a\u308b \n      var addEventListener = window.addEventListener || function (eventName, listener) {\n        return attachEvent('on' + eventName, listener);\n      };\n\n      // pushState\u3092\u4f7f\u3048\u308b\u3070\u3042\u3044(\u4f7f\u3044\u305f\u3044\u5834\u5408)\u306fpopstate\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // pushState\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306fhashchange\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3055\u305b\u3066URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // \u2191\u306e\u4e21\u65b9\u3068\u3082\u4f7f\u308f\u306a\u3044\u5834\u5408(hashchange\u3063\u307d\u3044\u3053\u3068\u306f\u3084\u308a\u305f\u3044)\u5834\u5408\u306f\u30dd\u30fc\u30ea\u30f3\u30b0\u3055\u305b\u3001URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // \u8981\u306fpopState\u306b\u3088\u308b\u3001URL\u306e\u691c\u77e5\u65b9\u6cd5\u3092\u512a\u5148\u3057\u3066\u4f7f\u3044\u307e\u3059\n      if (this._usePushState) {\n        addEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        addEventListener('hashchange', this.checkUrl, false);\n      } else if (this._wantsHashChange) {\n        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n      }\n\n      // start\u6642\u306bsilent\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3001\u3053\u308c\u306f\u73fe\u5728\u306efragment\u306e\u60c5\u5831\u3092\u5143\u306b\u5373\u6642\u306bRouter\u306ecallback\u3092\u5b9f\u884c\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3042\u308b\u3002\n      // \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fundefined\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u5373\u6642\u5b9f\u884c\u3055\u308c\u308b\u3002\n      if (!this.options.silent) return this.loadUrl();\n    },\n\n    // Backbone.history\u306b\u3088\u308b\u3001URL\u306e\u5909\u66f4\u691c\u77e5\u3092\u6b62\u3081\u308b\n    // \u4f55\u304b\u3057\u3089\u306e\u8272\u3005\u306a\u30a4\u30d9\u30f3\u30c8\u3084\u30bf\u30a4\u30de\u30fc\u3092\u6b62\u3081\u308b\u3060\u3051\u3067\u7279\u306b\u7279\u5225\u306a\u3053\u3068\u306f\u3057\u3066\u3044\u306a\u3044\n    stop: function() {\n\n      // addEventListener\u306e\u6642\u3068\u540c\u3058\u304fIE8\u5bfe\u5fdc\n      var removeEventListener = window.removeEventListener || function (eventName, listener) {\n        return detachEvent('on' + eventName, listener);\n      };\n\n      // Remove window listeners.\n      if (this._usePushState) {\n        removeEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        removeEventListener('hashchange', this.checkUrl, false);\n      }\n\n      // Clean up the iframe if necessary.\n      if (this.iframe) {\n        document.body.removeChild(this.iframe);\n        this.iframe = null;\n      }\n\n      // Some environments will throw when clearing an undefined interval.\n      if (this._checkUrlInterval) clearInterval(this._checkUrlInterval);\n\n      History.started = false;\n    },\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u60c5\u5831.handlers\u306b\u4fdd\u5b58\u3059\u308b\u3002\n    // \u57fa\u672c\u7684\u306b\u306fBackbone.Router\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u3088\u3063\u3066\u5b9f\u884c\u3055\u308c\u3066\u3001Backbone.Router\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u304c\u767b\u9332\u3055\u308c\u308b\u3068\u601d\u3063\u3066\u304a\u3051\u3070\u826f\u3044\n    // \u8981\u306fBackbone.history\u304c\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092\u6301\u3064\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001\u7d50\u5c40Backbone.Router\u306f\u5225\u306b\u4f7f\u308f\u306a\u304f\u305f\u3063\u3066\u3044\u3044(route\u30a4\u30d9\u30f3\u30c8\u304c\u767a\u884c\u3055\u308c\u306a\u304f\u306a\u308b\u3060\u3051\u3067\u3042\u308b)\n    route: function(route, callback) {\n      this.handlers.unshift({route: route, callback: callback});\n    },\n\n    // \u73fe\u5728\u306eURL\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n    checkUrl: function(e) {\n\n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n      var current = this.getFragment();\n\n      // If the user pressed the back button, the iframe's hash will have\n      // changed and we should use that for comparison.\n      if (current === this.fragment && this.iframe) {\n        current = this.getHash(this.iframe.contentWindow);\n      }\n\n      if (current === this.fragment) return false;\n      if (this.iframe) this.navigate(current);\n      this.loadUrl();\n    },\n\n    // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306bcallback\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u8abf\u3079\u3066\u30de\u30c3\u30c1\u3057\u305f\u5834\u5408\u306bcallback\u3092\u5b9f\u884c\u3059\u308b\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306f\u3059\u3079\u3066\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u306e\u691c\u7d22\u30ad\u30fc\u3092\u6240\u6709\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u8a55\u4fa1\u3059\u308b\n    loadUrl: function(fragment) {\n      // If the root doesn't match, no routes can match either.\n      if (!this.matchRoot()) return false;\n\n      // \u3053\u3053\u3067Backbone.history.fragment\u3092\u66f4\u65b0\u3057\u3066\u3044\u308b\n      fragment = this.fragment = this.getFragment(fragment);\n      return _.some(this.handlers, function(handler) {\n        // \u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3063\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u8a55\u4fa1\n        if (handler.route.test(fragment)) {\n          handler.callback(fragment);\n          return true;\n        }\n      });\n    },\n\n    // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5185\u5bb9\u3092history\u306b\u4fdd\u5b58\u3055\u305b\u3001loadUrl\u3092\u5b9f\u884c\u3057\u3001Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5b9f\u884c\u3059\u308b\n    // \u4fdd\u5b58\u3059\u308b\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8(URL\u3092\u6c7a\u5b9a\u3055\u305b\u308b\u6587\u5b57\u5217)\u3068options\u3092\u5f15\u6570\u306b\u53d7\u3051\u308b\n    // options\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u9805\u76ee\n    // trigger: Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u6700\u7d42\u7684\u306b\u5b9f\u884c\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u8a55\u4fa1\u3059\u308b\n    // replace: this.history.replaceState, this.history.pushState\u306e\u3069\u3063\u3061\u3092\u5229\u7528\u3059\u308b\u304b\u3092\u6c7a\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u8981\u306f\u4e0a\u66f8\u304d\u304b\u30fb\u8ffd\u52a0\u304b\n    navigate: function(fragment, options) {\n      if (!History.started) return false;\n\n      // options\u304ctrue\u306e\u5834\u5408\u306f{trigger: true}\u306b\u5909\u63db\u3055\u308c\u308b\n      // options\u304cundefined\u306e\u5834\u5408\u306f{trigger: false}\u306b\u5909\u63db\u3055\u308c\u308b\n      if (!options || options === true) options = {trigger: !!options};\n\n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n      fragment = this.getFragment(fragment || '');\n\n      // Don't include a trailing slash on the root.\n      var root = this.root;\n      if (fragment === '' || fragment.charAt(0) === '?') {\n        root = root.slice(0, -1) || '/';\n      }\n      var url = root + fragment;\n\n      // Strip the hash and decode for matching.\n      fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n\n      // fragment\u306b\u66f4\u65b0\u304c\u306a\u3044\u5834\u5408(URL\u306e\u30cf\u30c3\u30b7\u30e5\u306b\u5909\u66f4\u304c\u306a\u3044\u5834\u5408)\n      // \u306f\u4f55\u3082\u51e6\u7406\u3092\u305b\u305a\u306b\u7d42\u4e86\u3059\u308b\n      if (this.fragment === fragment) return;\n      this.fragment = fragment;\n\n      // If pushState is available, we use it to set the fragment as a real URL.\n      if (this._usePushState) {\n\n        // options.replace\u306e\u5185\u5bb9\u306b\u3088\u3063\u3066\u4e0a\u66f8\u304d\u3067\u306ehistory\u4fdd\u5b58\u304b\u3001\u8ffd\u52a0\u304b\u3092\u6c7a\u5b9a\u3057\u3001\u5b9f\u884c\u3059\u308b\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n      } else if (this._wantsHashChange) {\n\n        // pushState\u3092\u5229\u7528\u3057\u306a\u3044\u3067hashchange\u3067\u3084\u308a\u305f\u3044\u5834\u5408\u306fURL\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u4e0a\u66f8\u304d\u3057\u3001iframe\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306fiframe\u306e\u30da\u30fc\u30b8\u306e\u5207\u308a\u66ff\u3048\u3092\u884c\u3044\u3001\u5c65\u6b74\u3092\u8fbf\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n        this._updateHash(this.location, fragment, options.replace);\n        if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n          var iWindow = this.iframe.contentWindow;\n\n          // Opening and closing the iframe tricks IE7 and earlier to push a\n          // history entry on hash-tag change.  When replace is true, we don't\n          // want this.\n          if (!options.replace) {\n            iWindow.document.open();\n            iWindow.document.close();\n          }\n\n          this._updateHash(iWindow.location, fragment, options.replace);\n        }\n\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n      } else {\n        // pushState, hashchange\u306e\u3069\u3063\u3061\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u5358\u7d14\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\n        return this.location.assign(url);\n      }\n\n      // trigger\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306ffragment\u306b\u5bfe\u5fdc\u3057\u305f\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u306a\u308b\n      if (options.trigger) return this.loadUrl(fragment);\n    },\n\n    // URL\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u66f8\u304d\u63db\u3048\u3092\u884c\u3046\n    _updateHash: function(location, fragment, replace) {\n      if (replace) {\n        var href = location.href.replace(/(javascript:|#).*$/, '');\n        location.replace(href + '#' + fragment);\n      } else {\n        // Some browsers require that `hash` contains a leading #.\n        location.hash = '#' + fragment;\n      }\n    }\n\n  });\n\n  // Create the default Backbone.history.\n  // \u3053\u3053\u3067\u3082\u3046History\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\n  // Backbone.history\u3092\u6271\u3046\u5834\u5408\u306fBackbone.history\u306e\u53c2\u7167\u3092\u5229\u7528\u3059\u3079\u304d\n  Backbone.history = new History;\n\n\n\n\nBackbone.History\u96e3\u3057\u3059\u304e\u308b\nBackbone.Router\u3068Backbone.History\u306f\u30bb\u30c3\u30c8\u3067\u8003\u3048\u305f\u307b\u3046\u304c\u826f\u3044\npushState\u306b\u3088\u3063\u3066\u5c65\u6b74\u3092\u7ba1\u7406\u3059\u308b\u304c\u3001pushState\u3092\u4f7f\u3048\u306a\u3044\u74b0\u5883\u3067\u306fiframe\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b?\nhashchange\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u5143\u306b\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5207\u308a\u66ff\u3048\u308b\u304c\u3001hashchange\u3092\u4f7f\u3048\u306a\u3044\u74b0\u5883\u3060\u3068\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u3055\u305b\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\n\u540c\u4e00\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3078\u306e\u30da\u30fc\u30b8\u9077\u79fb\u306f\u30da\u30fc\u30b8\u9077\u79fb\u3068\u306f\u307f\u306a\u3055\u306a\u3044\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.history\u306e\u3010route\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\naddEventListener\u306e\u66f8\u304d\u65b9\u304c\u30a4\u30b1\u3066\u308b\n\n\n\u611f\u60f3\nBackbone.History\u304c\u74b0\u5883\u4f9d\u5b58\u3068\u307e\u3058\u3081\u306b\u4ed8\u304d\u5408\u3063\u3066\u3044\u3066\u3001JavaScript\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3063\u3066\u5927\u5909\u306a\u3093\u3084\u306a\u3068\u611f\u3058\u305f\n# Backbone.js\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u307f\u308b\n\n\u4eca\u56de\u306fBackbone\u306eRouter, History\n\u6b63\u76f4\u3001\u3061\u3087\u3063\u3068\u75b2\u308c\u3066\u304d\u305f\u306e\u3068\u3001Backbone.History\u96e3\u3057\u3044\u306e\u3067\u30ad\u30ec\u304c\u306a\u304f\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\u9593\u9055\u3063\u3066\u89e3\u91c8\u3057\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3064\u3082\u308a\u3067\u3044\u308b\u306e\u3067\u52a9\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\n# \u5bfe\u8c61Version\n\nBackbone.js 1.2.3\n\n# Backbone.Router\n\n```js\n\n  // Router\u306fMVC\u3067\u3044\u3046\u3068\u3053\u308d\u306eController\u3068\u601d\u3063\u3066\u826f\u3044, Marionette.js\u3067\u306fRouter, Controller\u3067\u5f79\u5272\u3092\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304cBackbone.js\u3067\u306f\u4e21\u65b9\u306e\u5f79\u5272\u3092\u6301\u3064\u3053\u3068\u306b\u306a\u308b\n  // \u5f15\u6570options\u306b\u306f.Router.routes\u3092\u4e0a\u66f8\u304d\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n  // Model\u3084View\u3068\u540c\u3058\u304f\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u30fc\u5b9a\u7fa9\u3057\u3066\u3044\u308b.initialize\u3092\u6700\u5f8c\u306b\u8a55\u4fa1\u3059\u308b\n  var Router = Backbone.Router = function(options) {\n\n    // options\u304c\u3042\u308c\u304c.routes\u306b\u3066\n    options || (options = {});\n    if (options.routes) this.routes = options.routes;\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    this._bindRoutes();\n    j\n    // \u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u521d\u671f\u5316\u51e6\u7406\u306e\u5b9f\u884c\n    this.initialize.apply(this, arguments);\n  };\n  j\n  // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5909\u63db\u3059\u308b\u969b\u306b\u4f7f\u3046\n  var optionalParam = /\\((.*?)\\)/g;\n  var namedParam    = /(\\(\\?)?:\\w+/g;\n  var splatParam    = /\\*\\w+/g;\n  var escapeRegExp  = /[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;\n\n  _.extend(Router.prototype, Events, {\n\n    initialize: function(){},\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    // \u5f15\u6570\u306e\u9806\u756a\u3092\u305a\u3089\u3059\u4ed5\u7d44\u307f\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u5c11\u3057\u898b\u3065\u3089\u3044\n    route: function(route, name, callback) {\n\n      // route\u304c\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3058\u3083\u306a\u3044\u306f\u5834\u5408\u306b\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\n      if (!_.isRegExp(route)) route = this._routeToRegExp(route);\n\n      // 2\u3064\u3081\u306e\u6587\u5b57\u5217\u306b\u306fcallback\u7528\u306e\u95a2\u6570\u304c\u5165\u3063\u3066\u304f\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\n      // \u305d\u306e\u5834\u5408\u306f\u5f15\u6570\u306e\u5f79\u5272\u3092\u305a\u3089\u3059 \n      if (_.isFunction(name)) {\n        callback = name;\n        name = '';\n      }\n      // \u3053\u3053\u3067\u3084\u3063\u3068\u5909\u6570callback\u306b\u95a2\u6570\u304c\u5165\u308b\u3053\u3068\u3092\u7d04\u675f\u3067\u304d\u308b\n      if (!callback) callback = this[name];\n      \n      // \u4e00\u65e6\u6574\u7406\u3059\u308b\u3068\n      // route: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306ekey\u540d\u3068\u306a\u308b\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n      // name: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9f\u884c\u6642\u306ecallback\u95a2\u6570\u306e\u30e1\u30bd\u30c3\u30c9\u540d(Router.xxx)\u3068\u8aad\u3081\u308b\u5834\u5408\u306b\u306e\u307f\u5229\u7528\u3001callback\u304c\u7121\u540d\u95a2\u6570\u306e\u5834\u5408\u306f\u7279\u306b\u5f79\u5272\u304c\u306a\u3044\n      // callback: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b9f\u884c\u6642\u306ecallback\u95a2\u6570\n      \n      \n      // \u3053\u306e\u8a18\u8ff0\u306b\u95a2\u3057\u3066\u306fvar self = this;\u3068\u540c\u3058\u610f\u5473\u5408\u3044\u3067\u4f7f\u3063\u3066\u3044\u308b\n      // \u2193\u306ehistory.route\u306b\u3066\u7121\u540d\u95a2\u6570\u3068\u767b\u9332\u3059\u308b\u304c\u305d\u306e\u95a2\u6570\u306econtext\u304cRouter\u3068\u306f\u7570\u306a\u308b\u304b\u3089\u3053\u3046\u306a\u3063\u3066\u3044\u308b\n      var router = this;\n      \n      // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u95a2\u3059\u308b\u60c5\u5831\u306fBackbone.history\u306b\u767b\u9332\u3059\u308b\n      // Backbone.history.route\u306b\u95a2\u3057\u3066\u306f\u5358\u7d14\u306b\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306b\u767b\u9332\u3059\u308b\u3060\u3051\u3067\u3042\u308b\n      // \u7b2c\u4e8c\u5f15\u6570\u306e\u7121\u540d\u95a2\u6570\u304c\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6210\u7acb\u6642\u306b\u5b9f\u88c5\u3059\u308b\u95a2\u6570\u306b\u306a\u308b\n      // fragment\u3063\u3066\u3044\u3046\u306e\u306f\u5b9f\u969b\u306b\u30d6\u30e9\u30a6\u30b6\u306eURL\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u3010blog/1\u3011\u306e\u3088\u3046\u306a\u30cf\u30c3\u30b7\u30e5\u306e\u5185\u5bb9\u306e\u6587\u5b57\u5217\u3092\u6307\u3057\u3066\u3044\u308b\n      Backbone.history.route(route, function(fragment) {\n        \n        // \u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5f15\u6570\u306e\u60c5\u5831\u3092\u53d6\u308a\u51fa\u3059\u3002\n        // \u8981\u306f\u3001blog/(:id)\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u4eee\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u305f\u3068\u3059\u308b\u3068\u3001[id, ...]\u307f\u305f\u3044\u306a\u914d\u5217\u306bparse\u3055\u305b\u308b\u5f79\u5272\u3092\u6301\u3064\n        var args = router._extractParameters(route, fragment);\n        \n        // router.execute\u306b\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306ecallback\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\n        // false\u306a\u3089route\u30a4\u30d9\u30f3\u30c8\u3092\u5b9f\u884c\u3057\u306a\u3044\u3001\u3063\u3066\u8a00\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u3044\u308b\u304c.execute\u306e\u8a55\u4fa1\u7d50\u679c\u306f\u5e38\u306bundefined\u306b\u306a\u308b\u306f\u305a\u306a\u306e\u3067\u610f\u5473\u306a\u3044\u6c17\u304c\u3059\u308b\u3002\u306a\u3093\u3093\u3060\u308d\u3046\u304b\u3053\u308c\u306f\u30fb\u30fb\u30fb\u30fb\n        if (router.execute(callback, args, name) !== false) {\n          \n          \n          // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306b\u30a4\u30d9\u30f3\u30c8\u30923\u3064\u767a\u884c\u3057\u3066\u3044\u308b\n          // Router\u306e \u3010route:\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u540d\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\n          // Router\u306e \u3010route\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n          // history\u306e\u3010route\u3011, \u5f15\u6570\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n          router.trigger.apply(router, ['route:' + name].concat(args));\n          router.trigger('route', name, args);\n          Backbone.history.trigger('route', router, name, args);\n        }\n      });\n      return this;\n    },\n\n    // \u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallbasck\u3092\u5b9f\u969b\u306b\u5b9f\u884c\u3059\u308b\u5f79\u5272\u3092\u6301\u3064\n    // \u898b\u3066\u306e\u901a\u308a\u3001callback\u306e\u5b9f\u884c\u6642\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306fRouter\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\n    execute: function(callback, args, name) {\n      if (callback) callback.apply(this, args);\n    },\n\n    // Backbone.history.navigate\u3078\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u306e\u5f79\u5272\u3067\u3042\u308b\u3002\n    // Backbone.history.navigate\u304c\u3069\u306e\u3088\u3046\u306a\u5f79\u5272\u304b\u306f\u305d\u3063\u3061\u306e\u958b\u8a2d\u306e\u6642\u306b\n    navigate: function(fragment, options) {\n      Backbone.history.navigate(fragment, options);\n      return this;\n    },\n\n    // .routes\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306e\u767b\u9332\u3092\u884c\u3046\n    // Router\u306e\u5f79\u5272\u306f\u307b\u307c\u3053\u308c\u304c\u5168\u3066\u3067\u3042\u308a\u3001\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092Backbone.history\u306b\u767b\u9332\u3057\u3001\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u5b8c\u4e86\u6642\u306ecallback\u3092\u5b9f\u884c\u3057\u3001\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\n    _bindRoutes: function() {\n      if (!this.routes) return;\n      this.routes = _.result(this, 'routes');\n      var route, routes = _.keys(this.routes);\n      \n      // pop\u306b\u3088\u3063\u3066\u5f8c\u308d\u306e\u8981\u7d20\u304b\u3089\u767b\u9332\u3057\u3066\u3044\u3063\u3066\u308b\u306e\u306b\u6ce8\u76ee!!\n      // \u30cd\u30bf\u30d0\u30ec\u3092\u3059\u308b\u3068\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u95a2\u3059\u308b\u60c5\u5831\u306fBackbone.history\u306b\u5168\u90e8\u767b\u9332\u3055\u308c\u307e\u3059\n      // \u305d\u306e\u969b\u306f\u3053\u3053\u3067pop\u3057\u305f\u8981\u7d20\u3092Backbone.history.handlers\u3068\u3044\u3046\u914d\u5217\u306bunshift\u3067\u8ffd\u52a0\u3057\u3066\u3044\u304f\u306e\u3067\u7d50\u679c\u7684\u306bBackbone.Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u9806\u756a\u3067\u3001\u6700\u7d42\u7684\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n      // \u6700\u5f8c\u306b\u3001\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8(URL\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u6587\u5b57\u5217)\u306b\u30de\u30c3\u30c1\u3057\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u691c\u7d22\u3059\u308b\u969b\u306fBackbone.history.handlers\u3092\u4e0a\u304b\u3089\u9806\u756a\u306b\u63a2\u7d22\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n      // \u8981\u306f\u4f55\u3092\u8a00\u3044\u305f\u3044\u304b\u3068\u3044\u3046\u3068\u3001\u3088\u304f\u30a2\u30af\u30bb\u30b9\u3055\u308c\u308b\u30da\u30fc\u30b8\u306fBackbone.Router\u3067\u5b9a\u7fa9\u3059\u308b\u969b\u306b\u306a\u308b\u3079\u304f\u5c0f\u3055\u3044\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3059\u3079\u304d\u3067\u3059\u3002\u6700\u7d42\u7684\u306a\u63a2\u7d22\u30b3\u30b9\u30c8\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n      while ((route = routes.pop()) != null) {\n        \n        // route: \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6642\u306e\u540d\u524d, mypage,\u3068\u304bblog(/:id)\u3068\u304b\u306e\u6587\u5b57\u5217\u304c\u5165\u308b\n        // this.routes[route]: \u2191\u306b\u7d10\u4ed8\u3044\u305f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u6210\u7acb\u6642\u306ecallback\u306e\u95a2\u6570\u540dor\u95a2\u6570\u304c\u306f\u3044\u308b\n        // this.route\u306b\u3088\u3063\u3066\u5b9f\u969b\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092\u767b\u9332\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n        this.route(route, this.routes[route]);\n      }\n    },\n\n    // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n    // \u4f55\u3084\u3063\u3066\u308b\u304b\u5168\u304f\u7406\u89e3\u3067\u304d\u306a\u3044\u3051\u3069\u3001\u3053\u308c\u3068\u304bUnderscore.js\u306b\u7d44\u307f\u8fbc\u3093\u3060\u3089\u3044\u3044\u3093\u3061\u3083\u3046\u3093\u304b\u306a\uff1f\n    _routeToRegExp: function(route) {\n      route = route.replace(escapeRegExp, '\\\\$&')\n                   .replace(optionalParam, '(?:$1)?')\n                   .replace(namedParam, function(match, optional) {\n                     return optional ? match : '([^/?]+)';\n                   })\n                   .replace(splatParam, '([^?]*?)');\n      return new RegExp('^' + route + '(?:\\\\?([\\\\s\\\\S]*))?$');\n    },\n\n    // URL\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5185\u5bb9\u304b\u3089Router\u306b\u767b\u9332\u3057\u3066\u3044\u308b\u6b63\u898f\u8868\u73fe\u3092\u5143\u306b\u914d\u5217\u3092\u751f\u6210\u3059\u308b\n    // \u8981\u306f\u3001blog/1\u307f\u305f\u3044\u306a\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3067\u3001blog/(:id)\u307f\u305f\u3044\u306bRouter\u3067\u767b\u9332\u3057\u3066\u3044\u305f\u969b\u306b[1]\u306e\u3088\u3046\u306a\u914d\u5217\u3092\u751f\u6210\u3055\u305b\u308b\n    _extractParameters: function(route, fragment) {\n\n      // \u5f15\u6570route\u306f\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001route.exec\u306fRegExp.prototype.exec\u306e\u3053\u3068\u3067\u3042\u308b\n      // https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec\n      // \u6587\u5b57\u5217\u3092\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u8a55\u4fa1\u3059\u308b\n      var params = route.exec(fragment).slice(1);\n\n      return _.map(params, function(param, i) {\n        // Don't decode the search params.\n        if (i === params.length - 1) return param || null;\n        return param ? decodeURIComponent(param) : null;\n      });\n    }\n\n  });\n\n```\n\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u969b\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f\u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8a55\u4fa1\u3055\u308c\u308b\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u95a2\u3059\u308b\u60c5\u5831\u306f\u6700\u7d42\u7684\u306bBackbone.History\u306b\u3066\u7ba1\u7406\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308b\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.Router\u306e\u3010route\u3011\u3010route:xxx\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.history\u306e\u3010route\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\n\n\n\n# Backbone.History\n\n```js\n\n  // Backbone.History\u306fHTML5\u306epushState\u306a\u3069\u306eAPI\u3092\u30e9\u30c3\u30d7\u3059\u308b\u3053\u3068\u3067\u3001URL\u306e\u5909\u66f4\u3092\u7ba1\u7406\u3057\u3001Router\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u706b\u3055\u305b\u308b\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\n  // pushState\u306a\u3069\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30d6\u30e9\u30a6\u30b6\u306b\u3082\u5bfe\u5fdc\u3059\u308b\u305f\u3081\u306b\u3001\u72ec\u81ea\u306eURL\u7ba1\u7406\u306e\u305f\u3081\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3059\u308b\u3053\u3068\u3082\u884c\u306a\u3063\u3066\u3044\u308b\n  // -- \u304a\u3055\u3089\u3044 --\n  // history.pushState: \u30d6\u30e9\u30a6\u30b6\u306e\u5c65\u6b74\u3092\u8ffd\u52a0\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f(HTML5\u306eAPI\u306e\u3053\u3068) \n  // popState\u30a4\u30d9\u30f3\u30c8: \u5c65\u6b74\u3092\u79fb\u52d5\u3057\u305f\u3089\u767a\u706b\u3059\u308b\u30a4\u30d9\u30f3\u30c8\n  // hashchange\u30a4\u30d9\u30f3\u30c8: URL\u306e\u30cf\u30c3\u30b7\u30e5\u3060\u3051\u304c\u5909\u308f\u3063\u305f\u5834\u5408\u306b\u767a\u706b\u3059\u308b\u30a4\u30d9\u30f3\u30c8 \n  var History = Backbone.History = function() {\n    \n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306e\u914d\u5217\n    this.handlers = [];\n    \n    // this.checkUrl\u3092History\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u3066\u3044\u308b\n    this.checkUrl = _.bind(this.checkUrl, this);\n\n    // Ensure that `History` can be used outside of the browser.\n    // window.location/window.history\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n    if (typeof window !== 'undefined') {\n      this.location = window.location;\n      this.history = window.history;\n    }\n  };\n\n  // Cached regex for stripping a leading hash/slash and trailing space.\n  var routeStripper = /^[#\\/]|\\s+$/g;\n\n  // Cached regex for stripping leading and trailing slashes.\n  var rootStripper = /^\\/+|\\/+$/g;\n\n  // Cached regex for stripping urls of hash.\n  var pathStripper = /#.*$/;\n\n  // .start\u304c\u5b9f\u884c\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n  // Backbone.History\u306b\u76f4\u63a5\u30e1\u30e2\u3059\u308b\u3053\u3068\u3067History\u306e\u5b9f\u88c5\u3092\u7d99\u627f\u3057\u305f\u3082\u306e\u304c\u4eee\u306b\u8907\u6570\u3042\u3063\u305f\u3068\u3057\u3066\u3082\u30011\u3064\u3057\u304b\u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u3066\u3044\u308b\n  // Backbone.History\u306f\u30d6\u30e9\u30a6\u30b6\u306e\u72b6\u614b(URL)\u306a\u3069\u3092\u76f4\u63a5\u7ba1\u7406\u3059\u308b\u3082\u306e\u306a\u306e\u3067\u3001\u552f\u4e00\u7121\u4e8c\u3067\u3042\u308b\u3053\u3068\u304c\u671b\u307e\u3057\u3044\n  History.started = false;\n\n  _.extend(History.prototype, Events, {\n\n    // URL\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\u305f\u3081\u306b\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3059\u308b\u304c\n    // \u305d\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u306e\u5468\u671f\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\n    interval: 50,\n\n    // Are we at the app root?\n    atRoot: function() {\n      var path = this.location.pathname.replace(/[^\\/]$/, '$&/');\n      return path === this.root && !this.getSearch();\n    },\n\n    // Does the pathname match the root?\n    matchRoot: function() {\n      var path = this.decodeFragment(this.location.pathname);\n      var root = path.slice(0, this.root.length - 1) + '/';\n      return root === this.root;\n    },\n\n    // Unicode characters in `location.pathname` are percent encoded so they're\n    // decoded for comparison. `%25` should not be decoded since it may be part\n    // of an encoded parameter.\n    decodeFragment: function(fragment) {\n      return decodeURI(fragment.replace(/%25/g, '%2525'));\n    },\n\n    // In IE6, the hash fragment and search params are incorrect if the\n    // fragment contains `?`.\n    getSearch: function() {\n      var match = this.location.href.replace(/#.*/, '').match(/\\?.+/);\n      return match ? match[0] : '';\n    },\n\n    // Gets the true hash value. Cannot use location.hash directly due to bug\n    // in Firefox where location.hash will always be decoded.\n    getHash: function(window) {\n      var match = (window || this).location.href.match(/#(.*)$/);\n      return match ? match[1] : '';\n    },\n\n    // Get the pathname and search params, without the root.\n    getPath: function() {\n      var path = this.decodeFragment(\n        this.location.pathname + this.getSearch()\n      ).slice(this.root.length - 1);\n      return path.charAt(0) === '/' ? path.slice(1) : path;\n    },\n\n    // \u73fe\u5728\u306efragment\u306e\u6587\u5b57\u5217\u3092\u53d6\u5f97\u3059\u308b\n    // fragment\u306e\u6587\u5b57\u5217\u3068\u306f\u3010router.html#mypage\u3011\u3067\u3044\u3046\u3068\u3053\u308d\u306e\u3010mypage\u3011\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3042\u308b\n    getFragment: function(fragment) {\n      if (fragment == null) {\n        if (this._usePushState || !this._wantsHashChange) {\n          fragment = this.getPath();\n        } else {\n          fragment = this.getHash();\n        }\n      }\n      return fragment.replace(routeStripper, '');\n    },\n\n    // Backbone.History\u306e\u8d77\u52d5\u30b3\u30de\u30f3\u30c9\n    // \u6e21\u305b\u308boptions\n    // silent: start\u5b9f\u884c\u6642\u306efragment\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5373\u6642\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\n    // hashChange: onhashChange\u3092\u4f7f\u3063\u305fURL\u306e\u5909\u66f4\u7ba1\u7406\u3092\u884c\u3046\u304b\u5426\u304b\n    // pushState: pushState\u3092\u4f7f\u3063\u305fURL\u306e\u5909\u66f4\u7ba1\u7406\u3092\u884c\u3046\u304b\u5426\u304b\n    // root: URL\u306e\u3069\u3053\u3092\u8d77\u70b9\u306b\u30eb\u30fc\u30bf\u30fc\u3092\u8a2d\u7f6e\u3059\u308b\u304b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3010/\u3011\u306a\u3063\u3066\u3044\u308b\u3002\u4f55\u304b\u3057\u3089\u306e\u7406\u7531\u3067/mypage\u304b\u3089\u59cb\u3081\u305f\u3044\u3068\u304b\u306e\u5834\u5408\u306b\u3053\u308c\u3092\u5229\u7528\u3059\u308b\n    start: function(options) {\n\n      // Backbone.History\u306f\u5b9f\u884c\u4e2d\u3067\u3042\u308c\u3070\u3001\u4f8b\u5916\u3092\u8fd4\u3059\n      if (History.started) throw new Error('Backbone.history has already been started');\n      History.started = true;\n\n      // root\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u306f\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n      // root\u3068\u306f\u3001URL\u306e\u3069\u3053\u3092\u8d77\u70b9\u306b\u30eb\u30fc\u30bf\u30fc\u3092\u8a2d\u7f6e\u3059\u308b\u304b\u3092\u6c7a\u3081\u308b\u3082\u306e\u3060\u3068\u601d\u3063\u3066\u3044\u3044\n      this.options          = _.extend({root: '/'}, this.options, options);\n      this.root             = this.options.root\n      ;\n      // onhashchange\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u30d6\u30e9\u30a6\u30b6\u304b\u3092\u78ba\u8a8d\u3057\u3066\u3001\u7d50\u679c\u3092\u30e1\u30f3\u30d0\u306b\u6301\u305f\u305b\u308b\n      // options\u306b\u3066hashChange\u3092\u4f7f\u308f\u306a\u3044\u7528\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3042\u308b\n      // \u30e6\u30fc\u30b6\u30fc\u304c\u4f7f\u3044\u305f\u3044\u304b\u3069\u3046\u304b\u3068\u3001\u30d6\u30e9\u30a6\u30b6\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u306e\u7d50\u679c\u3092\u5143\u306b\u3001\u5b9f\u969b\u306b\u4f7f\u3046\u304b\u5426\u304b\u3092\u8a55\u4fa1\u3057\u3066\u3044\u308b\n      this._wantsHashChange = this.options.hashChange !== false;\n      this._hasHashChange   = 'onhashchange' in window && (document.documentMode === void 0 || document.documentMode > 7);\n      this._useHashChange   = this._wantsHashChange && this._hasHashChange;\n      \n      // onhashchange\u3068\u540c\u3058\u304f\u3001window.history.pushState\u3092\u4f7f\u3046\u304b\u5426\u304b\u3092\u8a55\u4fa1\u3057\u3066\u3044\u308b\n      this._wantsPushState  = !!this.options.pushState;\n      this._hasPushState    = !!(this.history && this.history.pushState);\n      this._usePushState    = this._wantsPushState && this._hasPushState;\n      \n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\n      this.fragment         = this.getFragment();\n      \n      // Normalize root to always include a leading and trailing slash.\n      this.root = ('/' + this.root + '/').replace(rootStripper, '/');\n\n      // Transition from hashChange to pushState or vice versa if both are\n      // requested.\n      if (this._wantsHashChange && this._wantsPushState) {\n\n        // If we've started off with a route from a `pushState`-enabled\n        // browser, but we're currently in a browser that doesn't support it...\n        if (!this._hasPushState && !this.atRoot()) {\n          var root = this.root.slice(0, -1) || '/';\n          this.location.replace(root + '#' + this.getPath());\n          // Return immediately as browser will do redirect to new url\n          return true;\n\n        // Or if we've started out with a hash-based route, but we're currently\n        // in a browser where it could be `pushState`-based instead...\n        } else if (this._hasPushState && this.atRoot()) {\n          this.navigate(this.getHash(), {replace: true});\n        }\n\n      }\n\n      // pushState\u3082hashChange\u3082\u4f7f\u308f\u306a\u3044\u30fb\u4f7f\u3048\u306a\u3044\u5834\u5408\u306fiframe\u3092\u4f7f\u3063\u3066\u5c65\u6b74\u7ba1\u7406\u3092\u884c\u3046\uff1f\n      if (!this._hasHashChange && this._wantsHashChange && !this._usePushState) {\n        this.iframe = document.createElement('iframe');\n        this.iframe.src = 'javascript:0';\n        this.iframe.style.display = 'none';\n        this.iframe.tabIndex = -1;\n        var body = document.body;\n        // Using `appendChild` will throw on IE < 9 if the document is not ready.\n        var iWindow = body.insertBefore(this.iframe, body.firstChild).contentWindow;\n        iWindow.document.open();\n        iWindow.document.close();\n        iWindow.location.hash = '#' + this.fragment;\n      }\n\n      // \u3053\u308c\u306faddEventListener\u306e\u30af\u30ed\u30b9\u30d6\u30e9\u30a6\u30b6\u5bfe\u5fdc\u306e\u66f8\u304d\u65b9\n      // addEventListener\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u306fattachEvent\u304c\u5b9f\u884c\u3055\u308c\u308b\n      // IE8\u4ee5\u524d\u306e\u3084\u3064\u306e\u5bfe\u5fdc\u306b\u306a\u308b \n      var addEventListener = window.addEventListener || function (eventName, listener) {\n        return attachEvent('on' + eventName, listener);\n      };\n\n      // pushState\u3092\u4f7f\u3048\u308b\u3070\u3042\u3044(\u4f7f\u3044\u305f\u3044\u5834\u5408)\u306fpopstate\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // pushState\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306fhashchange\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u767b\u9332\u3055\u305b\u3066URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // \u2191\u306e\u4e21\u65b9\u3068\u3082\u4f7f\u308f\u306a\u3044\u5834\u5408(hashchange\u3063\u307d\u3044\u3053\u3068\u306f\u3084\u308a\u305f\u3044)\u5834\u5408\u306f\u30dd\u30fc\u30ea\u30f3\u30b0\u3055\u305b\u3001URL\u3092\u78ba\u8a8d\u3055\u305b\u3066\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3055\u305b\u308b\n      // \u8981\u306fpopState\u306b\u3088\u308b\u3001URL\u306e\u691c\u77e5\u65b9\u6cd5\u3092\u512a\u5148\u3057\u3066\u4f7f\u3044\u307e\u3059\n      if (this._usePushState) {\n        addEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        addEventListener('hashchange', this.checkUrl, false);\n      } else if (this._wantsHashChange) {\n        this._checkUrlInterval = setInterval(this.checkUrl, this.interval);\n      }\n\n      // start\u6642\u306bsilent\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3001\u3053\u308c\u306f\u73fe\u5728\u306efragment\u306e\u60c5\u5831\u3092\u5143\u306b\u5373\u6642\u306bRouter\u306ecallback\u3092\u5b9f\u884c\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u5236\u5fa1\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3042\u308b\u3002\n      // \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fundefined\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u5373\u6642\u5b9f\u884c\u3055\u308c\u308b\u3002\n      if (!this.options.silent) return this.loadUrl();\n    },\n\n    // Backbone.history\u306b\u3088\u308b\u3001URL\u306e\u5909\u66f4\u691c\u77e5\u3092\u6b62\u3081\u308b\n    // \u4f55\u304b\u3057\u3089\u306e\u8272\u3005\u306a\u30a4\u30d9\u30f3\u30c8\u3084\u30bf\u30a4\u30de\u30fc\u3092\u6b62\u3081\u308b\u3060\u3051\u3067\u7279\u306b\u7279\u5225\u306a\u3053\u3068\u306f\u3057\u3066\u3044\u306a\u3044\n    stop: function() {\n      \n      // addEventListener\u306e\u6642\u3068\u540c\u3058\u304fIE8\u5bfe\u5fdc\n      var removeEventListener = window.removeEventListener || function (eventName, listener) {\n        return detachEvent('on' + eventName, listener);\n      };\n\n      // Remove window listeners.\n      if (this._usePushState) {\n        removeEventListener('popstate', this.checkUrl, false);\n      } else if (this._useHashChange && !this.iframe) {\n        removeEventListener('hashchange', this.checkUrl, false);\n      }\n\n      // Clean up the iframe if necessary.\n      if (this.iframe) {\n        document.body.removeChild(this.iframe);\n        this.iframe = null;\n      }\n\n      // Some environments will throw when clearing an undefined interval.\n      if (this._checkUrlInterval) clearInterval(this._checkUrlInterval);\n      \n      History.started = false;\n    },\n\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u60c5\u5831.handlers\u306b\u4fdd\u5b58\u3059\u308b\u3002\n    // \u57fa\u672c\u7684\u306b\u306fBackbone.Router\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u3088\u3063\u3066\u5b9f\u884c\u3055\u308c\u3066\u3001Backbone.Router\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u304c\u767b\u9332\u3055\u308c\u308b\u3068\u601d\u3063\u3066\u304a\u3051\u3070\u826f\u3044\n    // \u8981\u306fBackbone.history\u304c\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u3092\u6301\u3064\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001\u7d50\u5c40Backbone.Router\u306f\u5225\u306b\u4f7f\u308f\u306a\u304f\u305f\u3063\u3066\u3044\u3044(route\u30a4\u30d9\u30f3\u30c8\u304c\u767a\u884c\u3055\u308c\u306a\u304f\u306a\u308b\u3060\u3051\u3067\u3042\u308b)\n    route: function(route, callback) {\n      this.handlers.unshift({route: route, callback: callback});\n    },\n\n    // \u73fe\u5728\u306eURL\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\n    checkUrl: function(e) {\n      \n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n      var current = this.getFragment();\n\n      // If the user pressed the back button, the iframe's hash will have\n      // changed and we should use that for comparison.\n      if (current === this.fragment && this.iframe) {\n        current = this.getHash(this.iframe.contentWindow);\n      }\n\n      if (current === this.fragment) return false;\n      if (this.iframe) this.navigate(current);\n      this.loadUrl();\n    },\n\n    // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u5143\u306b\u30eb\u30fc\u30bf\u30fc\u306bcallback\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u8abf\u3079\u3066\u30de\u30c3\u30c1\u3057\u305f\u5834\u5408\u306bcallback\u3092\u5b9f\u884c\u3059\u308b\n    // \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u60c5\u5831\u306f\u3059\u3079\u3066\u6b63\u898f\u8868\u73fe\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u306e\u691c\u7d22\u30ad\u30fc\u3092\u6240\u6709\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u6587\u5b57\u5217\u3092\u8a55\u4fa1\u3059\u308b\n    loadUrl: function(fragment) {\n      // If the root doesn't match, no routes can match either.\n      if (!this.matchRoot()) return false;\n      \n      // \u3053\u3053\u3067Backbone.history.fragment\u3092\u66f4\u65b0\u3057\u3066\u3044\u308b\n      fragment = this.fragment = this.getFragment(fragment);\n      return _.some(this.handlers, function(handler) {\n        // \u6b63\u898f\u8868\u73fe\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3063\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u5b58\u5728\u3059\u308b\u304b\u3092\u8a55\u4fa1\n        if (handler.route.test(fragment)) {\n          handler.callback(fragment);\n          return true;\n        }\n      });\n    },\n\n    // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5185\u5bb9\u3092history\u306b\u4fdd\u5b58\u3055\u305b\u3001loadUrl\u3092\u5b9f\u884c\u3057\u3001Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u5b9f\u884c\u3059\u308b\n    // \u4fdd\u5b58\u3059\u308b\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8(URL\u3092\u6c7a\u5b9a\u3055\u305b\u308b\u6587\u5b57\u5217)\u3068options\u3092\u5f15\u6570\u306b\u53d7\u3051\u308b\n    // options\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u9805\u76ee\n    // trigger: Router\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bcallback\u3092\u6700\u7d42\u7684\u306b\u5b9f\u884c\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u8a55\u4fa1\u3059\u308b\n    // replace: this.history.replaceState, this.history.pushState\u306e\u3069\u3063\u3061\u3092\u5229\u7528\u3059\u308b\u304b\u3092\u6c7a\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u8981\u306f\u4e0a\u66f8\u304d\u304b\u30fb\u8ffd\u52a0\u304b\n    navigate: function(fragment, options) {\n      if (!History.started) return false;\n      \n      // options\u304ctrue\u306e\u5834\u5408\u306f{trigger: true}\u306b\u5909\u63db\u3055\u308c\u308b\n      // options\u304cundefined\u306e\u5834\u5408\u306f{trigger: false}\u306b\u5909\u63db\u3055\u308c\u308b\n      if (!options || options === true) options = {trigger: !!options};\n\n      // \u73fe\u5728\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n      fragment = this.getFragment(fragment || '');\n\n      // Don't include a trailing slash on the root.\n      var root = this.root;\n      if (fragment === '' || fragment.charAt(0) === '?') {\n        root = root.slice(0, -1) || '/';\n      }\n      var url = root + fragment;\n\n      // Strip the hash and decode for matching.\n      fragment = this.decodeFragment(fragment.replace(pathStripper, ''));\n\n      // fragment\u306b\u66f4\u65b0\u304c\u306a\u3044\u5834\u5408(URL\u306e\u30cf\u30c3\u30b7\u30e5\u306b\u5909\u66f4\u304c\u306a\u3044\u5834\u5408)\n      // \u306f\u4f55\u3082\u51e6\u7406\u3092\u305b\u305a\u306b\u7d42\u4e86\u3059\u308b\n      if (this.fragment === fragment) return;\n      this.fragment = fragment;\n\n      // If pushState is available, we use it to set the fragment as a real URL.\n      if (this._usePushState) {\n        \n        // options.replace\u306e\u5185\u5bb9\u306b\u3088\u3063\u3066\u4e0a\u66f8\u304d\u3067\u306ehistory\u4fdd\u5b58\u304b\u3001\u8ffd\u52a0\u304b\u3092\u6c7a\u5b9a\u3057\u3001\u5b9f\u884c\u3059\u308b\n        this.history[options.replace ? 'replaceState' : 'pushState']({}, document.title, url);\n\n      // If hash changes haven't been explicitly disabled, update the hash\n      // fragment to store history.\n      } else if (this._wantsHashChange) {\n        \n        // pushState\u3092\u5229\u7528\u3057\u306a\u3044\u3067hashchange\u3067\u3084\u308a\u305f\u3044\u5834\u5408\u306fURL\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u4e0a\u66f8\u304d\u3057\u3001iframe\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306fiframe\u306e\u30da\u30fc\u30b8\u306e\u5207\u308a\u66ff\u3048\u3092\u884c\u3044\u3001\u5c65\u6b74\u3092\u8fbf\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n        this._updateHash(this.location, fragment, options.replace);\n        if (this.iframe && (fragment !== this.getHash(this.iframe.contentWindow))) {\n          var iWindow = this.iframe.contentWindow;\n\n          // Opening and closing the iframe tricks IE7 and earlier to push a\n          // history entry on hash-tag change.  When replace is true, we don't\n          // want this.\n          if (!options.replace) {\n            iWindow.document.open();\n            iWindow.document.close();\n          }\n\n          this._updateHash(iWindow.location, fragment, options.replace);\n        }\n\n      // If you've told us that you explicitly don't want fallback hashchange-\n      // based history, then `navigate` becomes a page refresh.\n      } else {\n        // pushState, hashchange\u306e\u3069\u3063\u3061\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u5358\u7d14\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\n        return this.location.assign(url);\n      }\n      \n      // trigger\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306ffragment\u306b\u5bfe\u5fdc\u3057\u305f\u30eb\u30fc\u30bf\u30fc\u306ecallback\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u306a\u308b\n      if (options.trigger) return this.loadUrl(fragment);\n    },\n\n    // URL\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u66f8\u304d\u63db\u3048\u3092\u884c\u3046\n    _updateHash: function(location, fragment, replace) {\n      if (replace) {\n        var href = location.href.replace(/(javascript:|#).*$/, '');\n        location.replace(href + '#' + fragment);\n      } else {\n        // Some browsers require that `hash` contains a leading #.\n        location.hash = '#' + fragment;\n      }\n    }\n\n  });\n\n  // Create the default Backbone.history.\n  // \u3053\u3053\u3067\u3082\u3046History\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\n  // Backbone.history\u3092\u6271\u3046\u5834\u5408\u306fBackbone.history\u306e\u53c2\u7167\u3092\u5229\u7528\u3059\u3079\u304d\n  Backbone.history = new History;\n\n\n```\n\n- Backbone.History\u96e3\u3057\u3059\u304e\u308b\n- Backbone.Router\u3068Backbone.History\u306f\u30bb\u30c3\u30c8\u3067\u8003\u3048\u305f\u307b\u3046\u304c\u826f\u3044\n- pushState\u306b\u3088\u3063\u3066\u5c65\u6b74\u3092\u7ba1\u7406\u3059\u308b\u304c\u3001pushState\u3092\u4f7f\u3048\u306a\u3044\u74b0\u5883\u3067\u306fiframe\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b?\n- hashchange\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u5143\u306b\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5909\u66f4\u3092\u691c\u77e5\u3057\u3066\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5207\u308a\u66ff\u3048\u308b\u304c\u3001hashchange\u3092\u4f7f\u3048\u306a\u3044\u74b0\u5883\u3060\u3068\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u3055\u305b\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u5909\u66f4\u3092\u691c\u77e5\u3059\u308b\n- \u540c\u4e00\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u3078\u306e\u30da\u30fc\u30b8\u9077\u79fb\u306f\u30da\u30fc\u30b8\u9077\u79fb\u3068\u306f\u307f\u306a\u3055\u306a\u3044\n- \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u78ba\u7acb\u6642\u306b\u306fBackbone.history\u306e\u3010route\u3011\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\u3059\u308b\n- addEventListener\u306e\u66f8\u304d\u65b9\u304c\u30a4\u30b1\u3066\u308b\n\n# \u611f\u60f3\n\nBackbone.History\u304c\u74b0\u5883\u4f9d\u5b58\u3068\u307e\u3058\u3081\u306b\u4ed8\u304d\u5408\u3063\u3066\u3044\u3066\u3001JavaScript\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3063\u3066\u5927\u5909\u306a\u3093\u3084\u306a\u3068\u611f\u3058\u305f\n\n\n\n\n", "tags": ["JavaScript", "Backbone.js"]}