{"context": "\n\n\u306f\u3058\u3081\u306b\n\u672c\u8cc7\u6599\u3067\u306f\u3001\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000(1) Salesforce Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3001\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\n\u3000(2) PHP\u304b\u3089\u4f5c\u6210\u3057\u305fSalesforce REST API\u3092\u5b9f\u884c\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\n\u53c2\u8003\u8cc7\u6599\nApex\u306b\u3088\u308bSalesforce REST API\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nhttp://kayakuguri.github.io/blog/2014/09/08/apex-restapi/\nhttps://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST\nApex\u3067\u72ec\u81ea\u306b\u4f5c\u6210\u3057\u305fSalesforce REST API\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u306b\u3088\u308a\u69cb\u7bc9\u3057\u305fAmazon EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u4e0a\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://qiita.com/na0AaooQ/items/157c28a80948c4b97bed\n\nApex\u30af\u30e9\u30b9\u3067\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\n\n(1) https://login.salesforce.com/ \u3078\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n(2)\u300c\u8a2d\u5b9a\u300d->\u300c\u30d3\u30eb\u30c9\u300d->\u300c\u958b\u767a\u300d->\u300cApex\u30af\u30e9\u30b9\u300d->\u300c\u65b0\u898f\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n(3)\u300cApex Class\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cApex Class Edit\u300d\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u4ee5\u4e0b\u306eApex\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u306b\u3064\u3044\u3066\u3001\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3059Apex\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u4eca\u56de\u4f5c\u6210\u3059\u308bSalesforce REST API\u306b\u5bfe\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u3092GET\u3067\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u3092LIKE\u691c\u7d22\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3057\u307e\u3059\u3002\n@RestResource(urlMapping='/CustomContact/*')\nglobal with sharing class CustomContactSample {\n    @HttpGet\n    global static sObject doGet() {\n        RestRequest req = RestContext.request;\n        String ContactName = req.params.get('name');\n        ContactName = '%' + ContactName + '%';\n        try {\n            Contact acc = [SELECT Id, Name, Email, Account.Name FROM Contact WHERE Name LIKE :ContactName LIMIT 1];\n            return acc;\n        } catch (exception e) {\n            return null;\n        }\n    }\n}\n\n\u300cSave\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n(4) \u300c\u8a2d\u5b9a\u300d->\u300c\u30d3\u30eb\u30c9\u300d->\u300c\u958b\u767a\u300d->\u300cApex\u30af\u30e9\u30b9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002Apex\u30af\u30e9\u30b9\u300cCustomContactSample\u300d\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u300cCustomContactSample\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u5148\u307b\u3069Apex\u30af\u30e9\u30b9\u4f5c\u6210\u6642\u306b\u8cbc\u308a\u4ed8\u3051\u305f\u30b3\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n(5)\u300c\u8a2d\u5b9a\u300d->\u300c\u7ba1\u7406\u300d->\u300c\u30e6\u30fc\u30b6\u306e\u7ba1\u7406\u300d->\u300c\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n(6)\u300c\u30c6\u30b9\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n(7) \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u300c\u6709\u52b9\u306a Apex \u30af\u30e9\u30b9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n(8)\u300c\u6709\u52b9\u306a Apex \u30af\u30e9\u30b9\u300d\u306e\u300c\u7de8\u96c6\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n(9)\u300cApex \u30af\u30e9\u30b9\u30a2\u30af\u30bb\u30b9\u3092\u6709\u52b9\u5316\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u300c\u5229\u7528\u53ef\u80fd\u306a Apex \u30af\u30e9\u30b9\u300d\u3067\u300cCustomContactSample\u300d\u3092\u9078\u629e\u3057\u3066\u300c\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\u300c\u6709\u52b9\u5316\u3055\u308c\u305f Apex \u30af\u30e9\u30b9\u300d\u306b\u300cCustomContactSample\u300d\u304c\u8ffd\u52a0\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n(10) .bashrc\u306bSalesforce REST API\u306e\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u3001.bashrc\u306bSalesforce REST API\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nhttp://qiita.com/na0AaooQ/items/157c28a80948c4b97bed\n.bashrc\u306bSalesforce REST API\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[ec2-user@salesforce-api-test ~]$ vi /home/ec2-user/.bashrc\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b)\n\n### Sandbox\u74b0\u5883\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306eAPI\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n##export DATABASEDOTCOM_HOST=\"test.salesforce.com\"\n### \u672c\u756a\u74b0\u5883\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306eAPI\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nexport DATABASEDOTCOM_HOST=\"login.salesforce.com\"\n\nexport DATABASEDOTCOM_CLIENT_ID=\"\u524d\u8ff0\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u9375\u300d(OAuth\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30ad\u30fc)\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_SECRET=\"\u524d\u8ff0\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u306e\u79d8\u5bc6\u300d(OAuth\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30b7\u30fc\u30af\u30ec\u30c3\u30c8)\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_USERNAME=\"API\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u308bSalesforce\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD=\"API\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u308bSalesforce\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\n\n.bashrc\u306b\u8ffd\u52a0\u3057\u305f\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n[ec2-user@salesforce-api-test ~]$ source /home/ec2-user/.bashrc\n[ec2-user@salesforce-api-test ~]$ \n\n\n\u4f5c\u6210\u3057\u305f\u72ec\u81ea\u306eSalesforce REST API\u3092PHP\u304b\u3089\u5b9f\u884c\u3059\u308b\n\n(11) \u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3059PHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n[ec2-user@salesforce-api-test ~]$ php -v\nPHP 5.3.29 (cli) (built: May 12 2015 22:42:19) \nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.3.0, Copyright (c) 1998-2014 Zend Technologies\n[ec2-user@salesforce-api-test ~]$ \n\n[ec2-user@salesforce-api-test ~]$ vi /home/ec2-user/select_salesforce_custom_api_contact.php\n\n\n/home/ec2-user/select_salesforce_custom_api_contact.php\n<?php\n\nrequire_once(\"/home/ec2-user/Force.com-OAuth-Toolkit-for-PHP/oauth.php\");\n\nif ( $argc == 2 ) {\n  $name = \"$argv[1]\";\n}\nelse {\n  echo \"[Usage]: $argv[0] \u30c6\u30b9\u30c8\\n\";\n  exit;\n}\n\n///// Salesforce REST API\u63a5\u7d9a\u7528\u306e\u74b0\u5883\u5909\u6570\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n// Salesforce REST API\u3067\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u9375\u300d\n$DATABASEDOTCOM_CLIENT_ID = getenv('DATABASEDOTCOM_CLIENT_ID');\n\n// Salesforce REST API\u3067\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u306e\u79d8\u5bc6\u300d\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_SECRET = getenv('DATABASEDOTCOM_CLIENT_SECRET');\n\n// Salesforce REST API\u63a5\u7d9a\u7528\u306eSalesforce\u30e6\u30fc\u30b6(Salesforce\u30ed\u30b0\u30a4\u30f3\u306b\u4f7f\u7528\u3057\u3066\u3044\u308bE\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a)\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_USERNAME = getenv('DATABASEDOTCOM_CLIENT_USERNAME');\n\n// Salesforce REST API\u63a5\u7d9a\u7528\u306eSalesforce\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD = getenv('DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD');\n\n// Salesforce REST API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_HOST = getenv('DATABASEDOTCOM_HOST');\n$LOGIN_URL = \"https://\" . $DATABASEDOTCOM_HOST . \"/\";\n\n///// Salesforce REST API\u63a5\u7d9a\u7528\u306e\u8a2d\u5b9a\n$CACHE_DIR = '/home/ec2-user/tmp/session';\n$CALLBACK_URL = 'https://localhost/callback';\n\n/////\n// Salesforce REST API\u63a5\u7d9a\u7528\u306eOauth\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n$oauth = new oauth( $DATABASEDOTCOM_CLIENT_ID, $DATABASEDOTCOM_CLIENT_SECRET, $CALLBACK_URL, $LOGIN_URL, $CACHE_DIR);\n\n// Salesforce REST API\u63a5\u7d9a\u306b\u3042\u305f\u308aSalesforce\u3078\u306e\u8a8d\u8a3c\u3092\u5b9f\u884c\n$oauth->auth_with_password( $DATABASEDOTCOM_CLIENT_USERNAME, $DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD );\n\n// \u30ab\u30b9\u30bf\u30e0API\u306eURL\u3092\u6307\u5b9a\u3059\u308b\n$url = $oauth->instance_url . \"/services/apexrest/CustomContact/?name=\" . $name;\n$curl = curl_init($url);\nvar_dump($url);\n\ncurl_setopt($curl, CURLOPT_HEADER, false);\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($curl, CURLOPT_HTTPHEADER, array(\"Authorization: OAuth \" . $oauth->access_token));\n\n// Salesforce REST API\u5b9f\u884c\u7d50\u679c\u3092\u4fdd\u5b58\n$response = json_decode(curl_exec($curl), true);\n$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);\n\nif ( $status != 200 ) {\n    print(\"Salesforce Custom REST API Access Failed  StatusCode =[\" . $status . \"]\\n\");\n} else {\n    print(\"Salesforce Custom REST API Access Success StatusCode =[\" . $status . \"]\\n\");\n}\n\nvar_dump( $response );\n\ncurl_close($curl);\n\n$oauth->auth_with_refresh_token();\n\n?>\n\n\n\n(12) \u4f5c\u6210\u3057\u305fPHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u69cb\u6587\u306b\u554f\u984c\u306a\u3044\u4e8b\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n[ec2-user@salesforce-api-test ~]$ php -l /home/ec2-user/select_salesforce_custom_api_contact.php \nNo syntax errors detected in /home/ec2-user/select_salesforce_custom_api_contact.php\n[ec2-user@salesforce-api-test ~]$ \n\n\n(13) PHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3001\u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\nPHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001Salesforce REST API\u306b\u5bfe\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u3092GET\u3067\u6e21\u3057\u3066\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u3092LIKE\u691c\u7d22\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n[ec2-user@salesforce-api-test ~]$ php /home/ec2-user/select_salesforce_custom_api_contact.php \u30c6\u30b9\u30c8\nstring(74) \"https://ap2.salesforce.com/services/apexrest/CustomContact/?name=\u30c6\u30b9\u30c8\"\nSalesforce Custom REST API Access Success StatusCode =[200]\narray(6) {\n  [\"attributes\"]=>\n  array(2) {\n    [\"type\"]=>\n    string(7) \"Contact\"\n    [\"url\"]=>\n    string(56) \"/services/data/v39.0/sobjects/Contact/00**************AS\"\n  }\n  [\"Id\"]=>\n  string(18) \"00**************AS\"\n  [\"Name\"]=>\n  string(16) \"\u30c6\u30b9\u30c8 \u592a\u90ce\"\n  [\"Email\"]=>\n  string(19) \"example@example.com\"\n  [\"AccountId\"]=>\n  string(18) \"00**************AH\"\n  [\"Account\"]=>\n  array(3) {\n    [\"attributes\"]=>\n    array(2) {\n      [\"type\"]=>\n      string(7) \"Account\"\n      [\"url\"]=>\n      string(56) \"/services/data/v39.0/sobjects/Account/00**************AH\"\n    }\n    [\"Id\"]=>\n    string(18) \"00**************AH\"\n    [\"Name\"]=>\n    string(21) \"\u30c6\u30b9\u30c8\u682a\u5f0f\u4f1a\u793e\"\n  }\n}\n[ec2-user@salesforce-api-test ~]$ \n\n\u4eca\u56de\u306eAPI\u3067\u306f\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005\u306e\u300c\u30c6\u30b9\u30c8 \u592a\u90ce\u300d\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n===\n\n\u672c\u8cc7\u6599\u3067\u306f\u3001\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3000**(1) Salesforce Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3001\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806**\n\u3000**(2) PHP\u304b\u3089\u4f5c\u6210\u3057\u305fSalesforce REST API\u3092\u5b9f\u884c\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9**\n\n\u53c2\u8003\u8cc7\u6599\n===\n\nApex\u306b\u3088\u308bSalesforce REST API\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\nhttp://kayakuguri.github.io/blog/2014/09/08/apex-restapi/\nhttps://developer.salesforce.com/page/Creating_REST_APIs_using_Apex_REST\n\nApex\u3067\u72ec\u81ea\u306b\u4f5c\u6210\u3057\u305fSalesforce REST API\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u306b\u3088\u308a\u69cb\u7bc9\u3057\u305fAmazon EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u4e0a\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\nhttp://qiita.com/na0AaooQ/items/157c28a80948c4b97bed\n \nApex\u30af\u30e9\u30b9\u3067\u72ec\u81ea\u306eSalesforce REST API\u3092\u4f5c\u6210\u3059\u308b\n===\n\n## (1) https://login.salesforce.com/ \u3078\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n## (2)\u300c\u8a2d\u5b9a\u300d->\u300c\u30d3\u30eb\u30c9\u300d->\u300c\u958b\u767a\u300d->\u300cApex\u30af\u30e9\u30b9\u300d->\u300c\u65b0\u898f\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n<img width=\"1272\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 1.54.49.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/854f2292-9133-db4d-5f3c-efddbe956522.png\">\n\n## (3)\u300cApex Class\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cApex Class Edit\u300d\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u4ee5\u4e0b\u306eApex\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051\u307e\u3059\u3002\n\n\u3053\u308c\u306f\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u306b\u3064\u3044\u3066\u3001\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3059Apex\u30af\u30e9\u30b9\u3067\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001\u4eca\u56de\u4f5c\u6210\u3059\u308bSalesforce REST API\u306b\u5bfe\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u3092GET\u3067\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u3092LIKE\u691c\u7d22\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n\n```\n@RestResource(urlMapping='/CustomContact/*')\nglobal with sharing class CustomContactSample {\n    @HttpGet\n    global static sObject doGet() {\n        RestRequest req = RestContext.request;\n        String ContactName = req.params.get('name');\n        ContactName = '%' + ContactName + '%';\n        try {\n            Contact acc = [SELECT Id, Name, Email, Account.Name FROM Contact WHERE Name LIKE :ContactName LIMIT 1];\n            return acc;\n        } catch (exception e) {\n            return null;\n        }\n    }\n}\n```\n\n\u300cSave\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u3001Apex\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n<img width=\"1279\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 1.58.01.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/f6d953e0-5ae5-ffe7-6cac-ad05fd57b2b6.png\">\n\n## (4) \u300c\u8a2d\u5b9a\u300d->\u300c\u30d3\u30eb\u30c9\u300d->\u300c\u958b\u767a\u300d->\u300cApex\u30af\u30e9\u30b9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002Apex\u30af\u30e9\u30b9\u300cCustomContactSample\u300d\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n<img width=\"1249\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.01.36.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/b16b5703-7534-8770-6c38-86b9621fc6d9.png\">\n\n\u300cCustomContactSample\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\u5148\u307b\u3069Apex\u30af\u30e9\u30b9\u4f5c\u6210\u6642\u306b\u8cbc\u308a\u4ed8\u3051\u305f\u30b3\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n<img width=\"1256\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.03.31.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/98a8a951-fa9b-8300-8714-48aa1d2ec81c.png\">\n\n## (5)\u300c\u8a2d\u5b9a\u300d->\u300c\u7ba1\u7406\u300d->\u300c\u30e6\u30fc\u30b6\u306e\u7ba1\u7406\u300d->\u300c\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n<img width=\"1246\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.10.38.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/3afaa70f-c55f-3f95-c452-57a52ff3d95f.png\">\n\n## (6)\u300c\u30c6\u30b9\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n## (7) \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u300c\u6709\u52b9\u306a Apex \u30af\u30e9\u30b9\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n<img width=\"1247\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.12.10.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/72ef94b5-07c1-a517-998c-fccea3cd9fa7.png\">\n\n## (8)\u300c\u6709\u52b9\u306a Apex \u30af\u30e9\u30b9\u300d\u306e\u300c\u7de8\u96c6\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n<img width=\"1265\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.13.09.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/4082077d-83ae-b5c5-2fcb-68f541436e7e.png\">\n\n## (9)\u300cApex \u30af\u30e9\u30b9\u30a2\u30af\u30bb\u30b9\u3092\u6709\u52b9\u5316\u300d\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u300c\u5229\u7528\u53ef\u80fd\u306a Apex \u30af\u30e9\u30b9\u300d\u3067\u300cCustomContactSample\u300d\u3092\u9078\u629e\u3057\u3066\u300c\u8ffd\u52a0\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300c\u6709\u52b9\u5316\u3055\u308c\u305f Apex \u30af\u30e9\u30b9\u300d\u306b\u300cCustomContactSample\u300d\u304c\u8ffd\u52a0\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n<img width=\"1251\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.15.33.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/07828f18-98c0-96cc-80f4-7e72a59b7a7e.png\">\n\n## (10) .bashrc\u306bSalesforce REST API\u306e\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u3001.bashrc\u306bSalesforce REST API\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nhttp://qiita.com/na0AaooQ/items/157c28a80948c4b97bed\n\n.bashrc\u306bSalesforce REST API\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@salesforce-api-test ~]$ vi /home/ec2-user/.bashrc\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b)\n\n### Sandbox\u74b0\u5883\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306eAPI\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n##export DATABASEDOTCOM_HOST=\"test.salesforce.com\"\n### \u672c\u756a\u74b0\u5883\u3078\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306eAPI\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nexport DATABASEDOTCOM_HOST=\"login.salesforce.com\"\n\nexport DATABASEDOTCOM_CLIENT_ID=\"\u524d\u8ff0\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u9375\u300d(OAuth\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30ad\u30fc)\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_SECRET=\"\u524d\u8ff0\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u306e\u79d8\u5bc6\u300d(OAuth\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u30b7\u30fc\u30af\u30ec\u30c3\u30c8)\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_USERNAME=\"API\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u308bSalesforce\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\nexport DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD=\"API\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u308bSalesforce\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\"\n```\n\n.bashrc\u306b\u8ffd\u52a0\u3057\u305f\u74b0\u5883\u5909\u6570\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```\n[ec2-user@salesforce-api-test ~]$ source /home/ec2-user/.bashrc\n[ec2-user@salesforce-api-test ~]$ \n```\n\n\u4f5c\u6210\u3057\u305f\u72ec\u81ea\u306eSalesforce REST API\u3092PHP\u304b\u3089\u5b9f\u884c\u3059\u308b\n===\n\n## (11) \u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3059PHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@salesforce-api-test ~]$ php -v\nPHP 5.3.29 (cli) (built: May 12 2015 22:42:19) \nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.3.0, Copyright (c) 1998-2014 Zend Technologies\n[ec2-user@salesforce-api-test ~]$ \n```\n\n```\n[ec2-user@salesforce-api-test ~]$ vi /home/ec2-user/select_salesforce_custom_api_contact.php\n```\n\n```php:/home/ec2-user/select_salesforce_custom_api_contact.php\n<?php\n \nrequire_once(\"/home/ec2-user/Force.com-OAuth-Toolkit-for-PHP/oauth.php\");\n\nif ( $argc == 2 ) {\n  $name = \"$argv[1]\";\n}\nelse {\n  echo \"[Usage]: $argv[0] \u30c6\u30b9\u30c8\\n\";\n  exit;\n}\n\n///// Salesforce REST API\u63a5\u7d9a\u7528\u306e\u74b0\u5883\u5909\u6570\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n// Salesforce REST API\u3067\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u9375\u300d\n$DATABASEDOTCOM_CLIENT_ID = getenv('DATABASEDOTCOM_CLIENT_ID');\n \n// Salesforce REST API\u3067\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u300c\u30b3\u30f3\u30b7\u30e5\u30fc\u30de\u306e\u79d8\u5bc6\u300d\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_SECRET = getenv('DATABASEDOTCOM_CLIENT_SECRET');\n \n// Salesforce REST API\u63a5\u7d9a\u7528\u306eSalesforce\u30e6\u30fc\u30b6(Salesforce\u30ed\u30b0\u30a4\u30f3\u306b\u4f7f\u7528\u3057\u3066\u3044\u308bE\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a)\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_USERNAME = getenv('DATABASEDOTCOM_CLIENT_USERNAME');\n \n// Salesforce REST API\u63a5\u7d9a\u7528\u306eSalesforce\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD = getenv('DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD');\n \n// Salesforce REST API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092.bashrc\u304b\u3089\u53d6\u5f97\u3059\u308b\n$DATABASEDOTCOM_HOST = getenv('DATABASEDOTCOM_HOST');\n$LOGIN_URL = \"https://\" . $DATABASEDOTCOM_HOST . \"/\";\n \n///// Salesforce REST API\u63a5\u7d9a\u7528\u306e\u8a2d\u5b9a\n$CACHE_DIR = '/home/ec2-user/tmp/session';\n$CALLBACK_URL = 'https://localhost/callback';\n\n/////\n// Salesforce REST API\u63a5\u7d9a\u7528\u306eOauth\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n$oauth = new oauth( $DATABASEDOTCOM_CLIENT_ID, $DATABASEDOTCOM_CLIENT_SECRET, $CALLBACK_URL, $LOGIN_URL, $CACHE_DIR);\n \n// Salesforce REST API\u63a5\u7d9a\u306b\u3042\u305f\u308aSalesforce\u3078\u306e\u8a8d\u8a3c\u3092\u5b9f\u884c\n$oauth->auth_with_password( $DATABASEDOTCOM_CLIENT_USERNAME, $DATABASEDOTCOM_CLIENT_AUTHENTICATE_PASSWORD );\n \n// \u30ab\u30b9\u30bf\u30e0API\u306eURL\u3092\u6307\u5b9a\u3059\u308b\n$url = $oauth->instance_url . \"/services/apexrest/CustomContact/?name=\" . $name;\n$curl = curl_init($url);\nvar_dump($url);\n \ncurl_setopt($curl, CURLOPT_HEADER, false);\ncurl_setopt($curl, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($curl, CURLOPT_HTTPHEADER, array(\"Authorization: OAuth \" . $oauth->access_token));\n \n// Salesforce REST API\u5b9f\u884c\u7d50\u679c\u3092\u4fdd\u5b58\n$response = json_decode(curl_exec($curl), true);\n$status = curl_getinfo($curl, CURLINFO_HTTP_CODE);\n \nif ( $status != 200 ) {\n    print(\"Salesforce Custom REST API Access Failed  StatusCode =[\" . $status . \"]\\n\");\n} else {\n    print(\"Salesforce Custom REST API Access Success StatusCode =[\" . $status . \"]\\n\");\n}\n \nvar_dump( $response );\n\ncurl_close($curl);\n \n$oauth->auth_with_refresh_token();\n \n?>\n```\n\n## (12) \u4f5c\u6210\u3057\u305fPHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u69cb\u6587\u306b\u554f\u984c\u306a\u3044\u4e8b\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n\n```\n[ec2-user@salesforce-api-test ~]$ php -l /home/ec2-user/select_salesforce_custom_api_contact.php \nNo syntax errors detected in /home/ec2-user/select_salesforce_custom_api_contact.php\n[ec2-user@salesforce-api-test ~]$ \n```\n\n## (13) PHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u3001\u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\nPHP\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u72ec\u81ea\u306b\u4f5c\u3063\u305fSalesforce REST API\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u3001Salesforce REST API\u306b\u5bfe\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u30d1\u30e9\u30e1\u30fc\u30bf\u3092GET\u3067\u6e21\u3057\u3066\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005(Contact)\u306eName\u9805\u76ee\u3092LIKE\u691c\u7d22\u3057\u3066 '\u30c6\u30b9\u30c8' \u3068\u3044\u3046\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u30ec\u30b3\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n```\n[ec2-user@salesforce-api-test ~]$ php /home/ec2-user/select_salesforce_custom_api_contact.php \u30c6\u30b9\u30c8\nstring(74) \"https://ap2.salesforce.com/services/apexrest/CustomContact/?name=\u30c6\u30b9\u30c8\"\nSalesforce Custom REST API Access Success StatusCode =[200]\narray(6) {\n  [\"attributes\"]=>\n  array(2) {\n    [\"type\"]=>\n    string(7) \"Contact\"\n    [\"url\"]=>\n    string(56) \"/services/data/v39.0/sobjects/Contact/00**************AS\"\n  }\n  [\"Id\"]=>\n  string(18) \"00**************AS\"\n  [\"Name\"]=>\n  string(16) \"\u30c6\u30b9\u30c8 \u592a\u90ce\"\n  [\"Email\"]=>\n  string(19) \"example@example.com\"\n  [\"AccountId\"]=>\n  string(18) \"00**************AH\"\n  [\"Account\"]=>\n  array(3) {\n    [\"attributes\"]=>\n    array(2) {\n      [\"type\"]=>\n      string(7) \"Account\"\n      [\"url\"]=>\n      string(56) \"/services/data/v39.0/sobjects/Account/00**************AH\"\n    }\n    [\"Id\"]=>\n    string(18) \"00**************AH\"\n    [\"Name\"]=>\n    string(21) \"\u30c6\u30b9\u30c8\u682a\u5f0f\u4f1a\u793e\"\n  }\n}\n[ec2-user@salesforce-api-test ~]$ \n```\n\n\u4eca\u56de\u306eAPI\u3067\u306f\u3001\u53d6\u5f15\u5148\u8cac\u4efb\u8005\u306e\u300c\u30c6\u30b9\u30c8 \u592a\u90ce\u300d\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"1254\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-14 2.28.14.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/63647/dd213fe0-476a-da86-0a36-f25eb5375093.png\">\n\n***\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["Salesforce", "force.com", "PHP", "AWS", "Linux"]}