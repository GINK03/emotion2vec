{"context": "\u3082\u30463\u9031\u9593\u524d\u304f\u3089\u3044\u3067\u3059\u304c\u3001Pull\u578b\u3068\u3044\u3046\u73cd\u3057\u3044\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u76e3\u8996\u30c4\u30fc\u30eb\u3067\u3042\u308bPrometheus1.0\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u3002\u6700\u8fd1\u306f\u65e5\u672c\u3067\u3082Prometheus Casual Talk\u304c\u958b\u50ac\u3055\u308c\u308b\u306a\u3069\u5c0e\u5165\u4e8b\u4f8b\u3082\u5897\u3048\u3066\u304d\u305f\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u5f8c\u306e\u5c0e\u5165\u3092\u8996\u91ce\u306b\u5165\u308c\u3066\u89e6\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u7279\u5fb4\n\u81ea\u5206\u304c\u898b\u305f\u7bc4\u56f2\u3067\u6c17\u306b\u306a\u3063\u305f\u7279\u5fb4\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\nGo\u88fd\n\u30a2\u30e9\u30fc\u30c8\u6a5f\u80fd\u304c\u7121\u511f\u3067\u5229\u7528\u53ef\u80fd(\u4f8b\u3048\u3070ELK\u30b9\u30bf\u30c3\u30af\u4f7f\u3046\u5834\u5408\u3001Watcher\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5229\u7528\u306b\u306f\u6709\u511f\u5951\u7d04\u304c\u5fc5\u8981)\n\u6271\u3048\u308b\u306e\u306f\u6570\u5024\u306e\u307f(\u30ed\u30b0\u7b49\u3067\u6587\u5b57\u5217\u3092\u6271\u3046\u5834\u5408\u306f\u5225\u306e\u30c4\u30fc\u30eb\u7b49\u304c\u5fc5\u8981)\nPull\u578b\n\u76e3\u8996\u30c4\u30fc\u30eb\u306fPush\u578b(\u76e3\u8996\u5bfe\u8c61\u5074\u304c\u76e3\u8996\u30c4\u30fc\u30eb\u306b\u60c5\u5831\u3092\u9001\u308b)\u306e\u3082\u306e\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001Prometheus\u306fPull\u578b(Prometheus\u304c\u76e3\u8996\u5bfe\u8c61\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b)\u3067\u3059\u3002\u7406\u7531\u306f\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u7b49\u3067\u6c17\u8efd\u306b\u76e3\u8996\u30c4\u30fc\u30eb\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3001\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u843d\u3061\u3066\u3044\u308b\u5834\u5408\u306e\u5224\u65ad\u304c\u697d\u306a\u3053\u3068(Push\u578b\u3060\u3068\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u30a8\u30e9\u30fc\u3067\u843d\u3061\u305f\u306e\u304b\u30e1\u30f3\u30c6\u3067\u843d\u3061\u305f\u306e\u304b\u306e\u5224\u65ad\u304c\u76e3\u8996\u30c4\u30fc\u30eb\u306b\u306f\u3067\u304d\u306a\u3044)\u3001\u30bf\u30fc\u30b2\u30c3\u30c8\u306e\u72b6\u614b\u3092\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3001\u3068\u3044\u3063\u305f\u70b9\u304c\u4e0a\u3052\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001Prometheus\u306b\u3082Pushgateway\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\u3001Push\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002(\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u7d50\u679c\u9001\u4fe1\u7b49\u9650\u3089\u308c\u305f\u7528\u9014\u3067\u306e\u307f\u4f7f\u3046\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059)\n\n\n\u4f7f\u3063\u3066\u307f\u308b\n\u4e00\u901a\u308a\u6a5f\u80fd\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u524d\u56de\u306e\u8a18\u4e8b\u3067docker1.12\u3067\u8ffd\u52a0\u3055\u308c\u305fswarm\u30e2\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u3001\u4eca\u56de\u3082swarm\u30e2\u30fc\u30c9\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u304c\u3001\u3042\u3093\u307e\u308a\u76f8\u5fdc\u3057\u3044\u4f8b\u3067\u306f\u306a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002(Prometheus\u81ea\u4f53\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u7406\u7531\u306f\u6700\u5f8c\u306b\u8a18\u8f09)\nswarm\u4f7f\u3063\u3066\u3084\u308b\u5834\u5408\u306fdocker-machin\u3068docker\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3055\u3048\u3044\u308c\u3070\u3001\u4e0a\u8a18\u306e\u8a18\u4e8b\u3092\u8aad\u307e\u306a\u304f\u3066\u3082\u69cb\u7bc9\u3067\u304d\u308b\u3088\u3046\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u305e\u308c\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3069\u306e\u3088\u3046\u306a\u610f\u5473\u304b\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u4e0a\u8a18\u306e\u524d\u56de\u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nswarm\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u9069\u5b9cdocker run\u3068\u304b\u306b\u8aad\u307f\u66ff\u3048\u3066\u8cb0\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\u30a4\u30f3\u30d5\u30e9\u306fDigitalOcean\u3092\u4f7f\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u304b\u3089\u767b\u9332\u3057\u3066\u9802\u3051\u308b\u3068\u304a\u4e92\u3044\u30cf\u30c3\u30d4\u30fc\u306a\u306e\u3067(ry\n\nPrometheus\u306e\u69cb\u7bc9\u3068\u81ea\u8eab\u306e\u76e3\u8996\n\u307e\u305a\u306fswarm\u306emanager\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# manager\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\n$ docker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"512mb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} manager\n(\u7d50\u679c\u7565)\n\n# manager\u306eIP\u3092\u30e1\u30e2\u308b\n$ docker-machine ls\nNAME           ACTIVE   DRIVER         STATE     URL                          SWARM   DOCKER    ERRORS\nmanager        *        digitalocean   Running   tcp://104.131.149.142:2376           v1.12.0\n\n# swarm\u30e2\u30fc\u30c9\u3092\u521d\u671f\u5316\n$ eval $(docker-machine env manager)\n$ docker swarm init --advertise-addr 104.131.149.142\n\n# \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\u5f97\u3089\u308c\u308b\u306e\u3067worker\u3092\u8ffd\u52a0\u3059\u308b\u30b3\u30de\u30f3\u30c9(1\u500b\u76ee)\u3092\u63a7\u3048\u3066\u304a\u304f\nTo add a worker to this swarm, run the following command:\n    docker swarm join \\\n    --token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n    104.131.149.142:2377\n\nTo add a manager to this swarm, run the following command:\n    docker swarm join \\\n    --token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-en1rtjwtlujupv16qqjja9xda \\\n    104.131.149.142:2377\n\n\u7d9a\u3044\u3066Prometheus\u7528\u306eDocker\u30db\u30b9\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\n# Prometheus\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\ndocker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} prometheus\n(\u7d50\u679c\u7565)\n\n# prometheus\u30ce\u30fc\u30c9\u3092swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\n$ eval $(docker-machine env prometheus)\n$ docker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u81ea\u8eab\u3092\u76e3\u8996\u3059\u308b\u6700\u5c0f\u9650\u306econfig\u3092\u4f5c\u308a\u307e\u3059\u3002\nmkdir prometheus\nvi prometheus/prometheus.yml\n\n\nprometheus.yml\u306e\u4e2d\u8eab\nglobal:\n  scrape_interval:     15s\n  external_labels:\n    monitor: 'codelab-monitor'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n\n\n\u4f55\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u304b\u306f\u30e9\u30d9\u30eb\u304b\u3089\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u898b\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\u4e00\u65e6\u3001Prometheus\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nPrometheus\u306e\u8d77\u52d5\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092Docker\u30db\u30b9\u30c8\u306b\u30b3\u30d4\u30fc\ndocker-machine scp -r prometheus prometheus:/opt/\n\n# manager\u3067docker\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\neval $(docker-machine env manager)\n\n# prometheus\u30b5\u30fc\u30d3\u30b9\u3092prometheus\u30db\u30b9\u30c8\u3067\u306e\u307f\u8d77\u52d5\u3059\u308b\u3088\u3046\u4f5c\u6210\ndocker service create \\\n  --replicas 1 \\\n  --name prometheus \\\n  --publish 9090:9090 \\\n  --mount type=volume,source=/opt/prometheus,target=/etc/prometheus \\\n  --constraint node.hostname==prometheus \\\n  prom/prometheus\n\n\n\u3053\u308c\u3067http://<prometheus_ip>:9090/metrics\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4e00\u89a7\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\nPrometheus\u306eIP\u306fdocker-machine ls\u306a\u3069\u3067\u8abf\u3079\u3066\u304f\u3060\u3055\u3044\u3002\n\nhttp://<prometheus_ip>:9090/graph\u304b\u3089Graph\u30bf\u30d6\u307e\u305f\u306fConsole\u30bf\u30d6\u3092\u9078\u3076\u3068\u305d\u308c\u305e\u308c\u30b0\u30e9\u30d5\u3068\u30b3\u30f3\u30bd\u30fc\u30eb\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u307e\u305a\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u30bf\u30d6\u3092\u9078\u629e\u3057\u3066\u3001/metrics\u3067\u3067\u3066\u304d\u305f\u4e00\u89a7\u304b\u3089\u9069\u5f53\u306b\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u3092\u5165\u529b\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u7a2e\u985e\u3084\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u7b49\u306f\u5f8c\u8ff0\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8a66\u3057\u306bgo_goroutines\u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u7d9a\u3044\u3066\u30b0\u30e9\u30d5\u30bf\u30d6\u3092\u958b\u304f\u3068\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6642\u9593\u8ef8\u7b49\u306f\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\n\u5225\u306e\u76e3\u8996\u5bfe\u8c61\u3092\u8ffd\u52a0\n\u3053\u3053\u307e\u3067\u3060\u3068prometheus\u81ea\u4f53\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3057\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u5225\u306e\u76e3\u8996\u5bfe\u8c61\u3092\u8ffd\u52a0\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nexporter\nOS\u81ea\u4f53\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3084\u65e2\u5b58\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306fexporter\u3092\u4f7f\u3044\u307e\u3059\u3002MySQL\u3084HAProxy\u7b49\u6709\u540d\u3069\u3053\u308d\u306eexporter\u306f\u516c\u5f0f\u307e\u305f\u306f\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u3082\u306e\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u306a\u304a\u3001kubernetes\u3084etcd\u7b49\u306fPrometheus\u5411\u3051\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067expose\u3057\u3066\u3044\u308b\u306e\u3067exporter\u4e0d\u8981\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4f8b\u3068\u3057\u3066\u30b7\u30b9\u30c6\u30e0\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3059\u308bnode exporter\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\nnode_exporter\u306e\u8d77\u52d5\n\n# host\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3046\u305f\u3081\u3001swarm\u3067\u306f\u306a\u304f\u901a\u5e38\u306edocker\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\n# manager\u4e0a\u3067\u5b9f\u884c\neval $(docker-machine env manager)\ndocker run -d -p 9100:9100 --net=\"host\" prom/node-exporter\n\n# prometheus\u30ce\u30fc\u30c9\u3067\u3082\u5b9f\u884c\neval $(docker-machine env prometheus)\ndocker run -d -p 9100:9100 --net=\"host\" prom/node-exporter\n\n\nhttp://<\u5bfe\u8c61\u30ce\u30fc\u30c9\u306eIP>:9100/metrics\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u5148\u307b\u3069\u3068\u540c\u69d8\u306e\u69d8\u3005\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u304a\u3088\u3073node exporeter\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\nPrometheus\u304b\u3089\u76e3\u8996\u3067\u304d\u308b\u3088\u3046\u306bconfig\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\nprometheus.yml\nglobal:\n  scrape_interval:     15s\n  external_labels:\n    monitor: 'codelab-monitor'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n  - job_name:       'node'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['manager_host_ip:9100']\n        labels:\n          group: 'manager'\n      - targets: ['prometheus_ip:9100']\n        labels:\n          group: 'worker'\n\n\nconfig\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u6642\u306fPrometheus\u306e\u30d7\u30ed\u30bb\u30b9\u306bSIGHUP\u3092\u9001\u308b\u304b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3068\u30ea\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\u3061\u306a\u307f\u306bPOST\u3067\u3059\u304c\u3001config\u30d5\u30a1\u30a4\u30eb\u81ea\u4f53\u3092\u6e21\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002(\u4ed5\u69d8)\n# config\u30d5\u30a1\u30a4\u30eb\u3092\u30db\u30b9\u30c8\u306b\u9001\u4fe1\ndocker-machine scp -r prometheus prometheus:/opt/\n\n# curl\u3067\u30ea\u30ed\u30fc\u30c9\ncurl -X POST http://prometheus_ip:9090/-/reload\n\n\u76e3\u8996\u5bfe\u8c61\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u3067\u3001http://<prometheus_ip>:9090/graph\u306eConsole\u30bf\u30d6\u304b\u3089\u8a66\u3057\u306bnode_cpu\u3068\u3044\u3046\u540d\u524d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\n\u3053\u3053\u3067\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u3092\u7c21\u5358\u306b\u7d39\u4ecb\u3057\u3066\u307f\u307e\u3059\u3002\nnode_cpu\u3092\u5b9f\u884c\u3057\u305f\u4e0a\u8a18\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u306b\u3042\u308b\u901a\u308a\u3001Element\u30ab\u30e9\u30e0\u306b\u69d8\u3005\u306a\u30e9\u30d9\u30eb\u4ed8\u304d\u3067node_cpu\u306e\u5024\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059(\u305f\u3068\u3048\u3070\u3001node_cpu{cpu=\"cpu0\",group=\"worker\",instance=\"192.241.200.47:9100\",job=\"node\",mode=\"idle\"})\u3002\n\u3053\u306e\u5f62\u5f0f\u306f\u305d\u306e\u307e\u307e\u30af\u30a8\u30ea\u306b\u4f7f\u3048\u3066\u3001\u4f8b\u3048\u3070\nnode_cpu{cpu=\"cpu0\",group=\"manager\",mode=\"user\"}\u3092\u5b9f\u884c\u3059\u308b\u3068\u8a72\u5f53\u306e\u30c7\u30fc\u30bf\u306e\u307f\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306bjob\u3068group\u3068\u3044\u3046\u30e9\u30d9\u30eb\u306f\u4e0a\u8a18\u306eyml\u30d5\u30a1\u30a4\u30eb\u3067\u6307\u5b9a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u306e\u7db2\u7f85\u7684\u306a\u8aac\u660e\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u8f09\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3063\u305f\u308a\u3001\nnode_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u76f4\u8fd15\u5206\u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3057\u305f\u308a\nnode_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}[5m]\n\u76f4\u8fd15\u5206\u306e\u5e73\u5747\u3092\u8868\u793a\u3057\u305f\u308a\nrate(node_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}[5m])\nuser\u3068system\u306e\u5408\u8a08\u3092\u8868\u793a\u3057\u305f\u308a\nsum(rate(node_cpu{cpu=\"cpu0\",group=\"worker\",mode=~\"user|system\"}[5m]))\n\u8272\u3005\u3067\u304d\u307e\u3059\u3002\n\u305d\u306e\u307e\u307e\u30b0\u30e9\u30d5\u30bf\u30d6\u3092\u958b\u3051\u3070\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u306e\u30b0\u30e9\u30d5\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u3082\u3061\u308d\u3093exporter\u306f\u81ea\u4f5c\u3082\u3067\u304d\u307e\u3059\u3002\nhttps://prometheus.io/docs/instrumenting/writing_exporters/\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u66f8\u304f\n\u30a2\u30d7\u30ea\u3084\u30c4\u30fc\u30eb\u7b49\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3055\u305b\u305f\u3044\u5834\u5408\u306fexporter\u3092\u66f8\u304f\u307e\u3067\u3082\u306a\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u516c\u958b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nhttps://prometheus.io/docs/instrumenting/clientlibs/\nGo\u4ee5\u5916\u306e\u8a00\u8a9e\u3067\u3082\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u304a\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u610f\u5473\u306e\u306a\u3044Counter\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002Counter\u306e\u4ed6\u306b\u3082Gauge,Summary,Histogram\u3068\u3044\u3046\u30bf\u30a4\u30d7\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3053\u3053\u306bpublish\u3057\u3066\u3042\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3068Dockerfile\u306f\u4f5c\u3089\u306a\u304f\u3066OK\u3067\u3059\u3002\npackage main\n\nimport (\n    \"math/rand\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/prometheus/client_golang/prometheus\"\n)\n\nfunc main() {\n    pushCounter := prometheus.NewCounter(prometheus.CounterOpts{\n        Name: \"sample_counter\",\n        Help: \"just a simple counter\",\n    })\n    prometheus.MustRegister(pushCounter)\n\n    go func() {\n        for {\n            pushCounter.Inc()\n            time.Sleep(time.Duration(rand.Intn(1000)) * time.Millisecond)\n        }\n    }()\n\n    http.Handle(\"/metrics\", prometheus.Handler())\n    http.ListenAndServe(\":9111\", nil)\n}\n\nalpine\u3067\u52d5\u304b\u3059\u306e\u3067\u3053\u3093\u306a\u611f\u3058\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\nCGO_ENABLED=0 go build\n\u3053\u3093\u306a\u611f\u3058\u306eDokcerfile\u3092\u4f5c\u308a\u307e\u3059\u3002\nFROM alpine:latest\nADD prometheus /\nCMD /prometheus\n\n\u3053\u306e\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\ndocker service create \\\n  --replicas 1 \\\n  --name sample-client \\\n  --publish 9111:9111 \\\n  daikikohara/prometheus-client:v1\n\nswarm\u30ce\u30fc\u30c9\u306e\u4efb\u610f\u306eIP:9111/metrics\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u52a0\u3048\u3066\u8ffd\u52a0\u3057\u305fsample_counter\u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nPrometheus\u306e\u76e3\u8996\u5bfe\u8c61\u306b\u8ffd\u52a0\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u3001\n  - job_name:       'sample'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['sample-client\u304c\u52d5\u3044\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306eIP:9111']\n\n\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\ndocker-machine scp -r prometheus prometheus:/opt/\ncurl -X POST http://prometheus_ip:9090/-/reload\n\nWebUI\u304b\u3089\u30b0\u30e9\u30d5\u3082\u8868\u793a\u3067\u304d\u307e\u3059\u3002\n\n\nRecording rule\nRecording rule\u3092\u4f7f\u3046\u3068\u3088\u304f\u4f7f\u3046\u30af\u30a8\u30ea\u306e\u7d50\u679c\u7b49\u3092\u5225\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u5143\u306e\u30af\u30a8\u30ea\u3092\u90fd\u5ea6\u5b9f\u884c\u3059\u308b\u3088\u308a\u52b9\u7387\u7684\u3067\u3001\u7279\u306b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7b49\u3067\u983b\u7e41\u306b\u5b9f\u884c\u3055\u308c\u308b\u30b1\u30fc\u30b9\u3067\u306f\u6709\u5229\u307f\u305f\u3044\u3067\u3059\u3002\n\u304a\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u306eprometheus/prometheus.rules\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nprometheus.rules\nsample_rule:node_cpu_user:avg_rate5m = avg(rate(node_cpu{mode=\"user\"}[5m])) by (instance, cpu)\n\n\n\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9\u304c\u6b63\u3057\u3044\u304b\u306f\u4ee5\u4e0b\u306e\u30c4\u30fc\u30eb\u3067\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\n$ go get github.com/prometheus/prometheus/cmd/promtool\n$ promtool check-rules ./prometheus.rules\nChecking ./prometheus.rules\n  SUCCESS: 1 rules found\n\nprometheus.yml\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u8ffd\u52a0\u3057\u305f\u306e\u306fevaluation_interval\u3068rule_files\u3067\u3059\u3002\u30eb\u30fc\u30eb\u306e\u8a55\u4fa1\u309215\u79d2\u3054\u3068\u306b\u884c\u3046\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\nglobal:\n  scrape_interval:     15s\n  evaluation_interval: 15s\n  external_labels:\n    monitor: 'codelab-monitor'\nrule_files:\n  - 'prometheus.rules'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n  - job_name:       'node'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['manager_ip:9100']\n        labels:\n          group: 'manager'\n      - targets: ['prometheus_ip:9100']\n        labels:\n          group: 'worker'\n  - job_name:       'sample'\n    scrape_interval: 5s\n    scrape_timeout: 3s\n    static_configs:\n      - targets: ['prometheus_ip:9111']\n\n\u30eb\u30fc\u30eb\u3068config\u30d5\u30a1\u30a4\u30eb\u3092Prometheus\u306e\u30db\u30b9\u30c8\u306b\u9001\u3063\u3066\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\ndocker-machine scp -r prometheus prometheus:/opt/\ncurl -X POST http://prometheus_ip:9090/-/reload\n\n\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\u540d\u3067\u30b0\u30e9\u30d5\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nAlertmanager\nAlertmanager\u3092\u4f7f\u3046\u3068\u69d8\u3005\u306a\u6761\u4ef6\u3067\u30a2\u30e9\u30fc\u30c8\u306e\u9001\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nAlertmanager\u306fPrometheus\u3068\u306f\u5225\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u3001Prometheus\u4e0a\u3067rule\u3092\u8a2d\u5b9a\u3057\u3066Alertmanager\u306b\u30a2\u30e9\u30fc\u30c8\u3092\u9001\u4fe1\u3001Alertmanager\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u30a2\u30e9\u30fc\u30c8\u3092\u6761\u4ef6\u306b\u5f93\u3063\u3066\u69d8\u3005\u306a\u901a\u77e5\u5148\u306b\u9001\u4fe1\u3059\u308b\u7b49\u306e\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3068\u3044\u3046\u6319\u52d5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u9001\u4fe1\u5148\u306femail\u3084Slack\u7b49\u69d8\u3005\u306a\u3082\u306e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\u30eb\u30fc\u30eb\u3082\u69d8\u3005\u306a\u3082\u306e\u304c\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u516c\u5f0f\u30da\u30fc\u30b8\u3067\u89e6\u308c\u3089\u308c\u3066\u3044\u308b\u3082\u306e\u3060\u3068Grouping(\u4f8b\u3048\u3070DB\u304c\u843d\u3061\u305f\u3089\u767a\u751f\u3059\u308b\u30a8\u30e9\u30fc\u7b49\u306f1\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u53d7\u4fe1\u3067\u304d\u308c\u3070\u826f\u3044\u306e\u3067\u3001\u540c\u3058\u7a2e\u985e\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u307e\u3068\u3081\u308b)\u3001Inhibition(\u3042\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30e9\u30fc\u30c8\u304c\u65e2\u306b\u767a\u751f\u3057\u3066\u3044\u305f\u3089\u5225\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u767a\u751f\u3055\u305b\u306a\u3044)\u3001Silence(\u7279\u5b9a\u306e\u30a2\u30e9\u30fc\u30c8\u3092\u4e00\u5b9a\u6642\u9593\u767a\u751f\u3055\u305b\u306a\u3044)\u3068\u3044\u3063\u305f\u30bf\u30a4\u30d7\u306e\u30eb\u30fc\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u306e\u4f8b\u306b\u3042\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5834\u5408\u306e\u30a2\u30e9\u30fc\u30c8\u3092\u8a66\u3057\u307f\u3066\u307e\u3059\u3002\u9001\u4fe1\u5148\u306fSlack\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u307e\u305a\u306falertmanager\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u4f5c\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nmkdir alertmanager\nvi alertmanager/config.yml\n\n\nconfig.yml\nglobal:\nroute:\n  receiver: main\n  group_by: ['alertname', 'instance']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 1h\nreceivers:\n- name: 'main'\n  slack_configs:\n  - api_url: 'https://hooks.slack.com/services/your_api_token'\n    channel: '#channel_name'\n\n\n\u6b21\u306bAlertmanager\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n# alertmaanger\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\ndocker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} alertmanager\n\n# swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\neval $(docker-machine env alertmanager)\ndocker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092alertmanager\u306e\u30db\u30b9\u30c8\u306b\u9001\u4fe1\ndocker-machine scp -r alertmanager alertmanager:/opt/\n\n# Alertmanager\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\neval $(docker-machine env manager)\ndocker service create \\\n  --replicas 1 \\\n  --name alertmanager \\\n  --publish 9093:9093 \\\n  --mount type=volume,source=/opt/alertmanager,target=/etc/alertmanager \\\n  --constraint node.hostname==alertmanager \\\n  prom/alertmanager:latest\n\nAlertmanager\u30ce\u30fc\u30c9\u306eIP:9093\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u51fa\u6765\u304d\u305f\u3089OK\u3067\u3059\u3002\n\n\u7d9a\u3044\u3066Prometheus\u5074\u306b\u30a2\u30e9\u30fc\u30c8\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002prometheus\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nalert.rules\nALERT InstanceDown\n  IF up == 0\n  FOR 1m\n  LABELS { severity = \"page\" }\n  ANNOTATIONS {\n    summary = \"Instance {{ $labels.instance }} down\",\n    description = \"{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.\",\n  }\n\n\n\u4e0a\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092prometheus.yml\u304b\u3089\u53c2\u7167\u3057\u307e\u3059\u3002\n\n\u8a72\u5f53\u7b87\u6240\u306e\u307f\nrule_files:\n  - 'prometheus.rules'\n  - 'alert.rules'\n\n\nPrometheus\u306e\u30b3\u30f3\u30c6\u30ca\u5074\u3082\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u516c\u5f0f\u306eDocker image\u3067\u306fAlertmanager\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306aDockerfile\u3092\u4f5c\u6210\u3057\u3066\u3053\u3061\u3089\u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\nDockerfile\nFROM prom/prometheus\nENTRYPOINT [ \"sh\" ]\nCMD [ \"-c\", \\\n      \"/bin/prometheus \\\n      -config.file=/etc/prometheus/prometheus.yml \\\n      -storage.local.path=/prometheus \\\n      -alertmanager.url=${ALERTMANAGER}\" ]\n\n\n\u4e00\u5ea6\u5143\u306eprometheus\u30b5\u30fc\u30d3\u30b9\u3092\u843d\u3068\u3057\u3066\u304b\u3089\u4e0a\u8a18\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u305fprometheus\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n# \u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\n$ docker service rm prometheus\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30db\u30b9\u30c8\u306b\u9001\u4fe1\n$ docker-machine scp -r prometheus prometheus:/opt/\n\n# \u30b5\u30fc\u30d3\u30b9\u3092\u518d\u4f5c\u6210\n$ docker service create \\\n  --replicas 1 \\\n  --name prometheus \\\n  --publish 9090:9090 \\\n  --mount type=volume,source=/opt/prometheus,target=/etc/prometheus \\\n  --env ALERTMANAGER=\"http://alertmanager_ip:9093\" \\\n  --constraint node.hostname==prometheus \\\n  daikikohara/prometheus:v1\n\n\u304a\u3082\u3080\u308d\u306b\u76e3\u8996\u5bfe\u8c61\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4e00\u3064\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n# manager\u4e0a\u306edocker\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\n$ docker ps\nCONTAINER ID        IMAGE                              COMMAND                  CREATED             STATUS              PORTS               NAMES\n57aa0d720403        prom/node-exporter                 \"/bin/node_exporter\"     2 hours ago         Up 2 hours                              suspicious_keller\n9687d44ae859        daikikohara/prometheus-client:v1   \"/bin/sh -c /promethe\"   7 hours ago         Up 7 hours                              sample-client.1.2zkn3wtvw37f8fiy6xqfhui4n\n\n# node_exporter\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\n$ docker stop suspicious_keller\nsuspicious_keller\n\n\u3053\u3053\u3067Alert\u30bf\u30d6\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3068PENDING\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n1\u5206\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u304b\u3089\u518d\u78ba\u8a8d\u3059\u308b\u3068State\u304cFIRING\u306b\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\nAlertmanager\u306b\u3082\u901a\u77e5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n(\u30ad\u30e3\u30d7\u30c1\u30e3\u64ae\u308a\u5fd8\u308c)\nAlertmanager\u7d4c\u7531\u3067Slack\u306b\u3082\u901a\u77e5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\nGrafana\u9023\u643a\n\u3053\u308c\u307e\u3067\u898b\u3066\u304d\u305f\u901a\u308aPrometheus\u81ea\u8eab\u306b\u3082\u30b0\u30e9\u30d5\u306e\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u307e\u308a\u30d1\u30ef\u30d5\u30eb\u3067\u306f\u306a\u3044\u305f\u3081\u3001Grafana\u3068\u9023\u643a\u3059\u308b\u3053\u3068\u3092\u516c\u5f0f\u3067\u3082\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u3002Grafana\u306f\u69d8\u3005\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53ef\u8996\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3001Prometheus\u4ee5\u5916\u306b\u3082InfluxDB\u3084CloudWatch\u7b49\u69d8\u3005\u306a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305a\u306fGrafana\u7528\u306e\u30de\u30b7\u30f3\u3068\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# Grafana\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\n$ docker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} grafana\n\n# grafana\u30ce\u30fc\u30c9\u3092swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\n$ eval $(docker-machine env grafana)\n$ docker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n\n# Grafana\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\n$ docker service create \\\n  --replicas 1 \\\n  --name grafana \\\n  --publish 3000:3000 \\\n  --constraint node.hostname==grafana \\\n  grafana/grafana\n\n\nGrafana\u306e\u30ce\u30fc\u30c9\u306eIP:3000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306a\u306e\u3067admin/admin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\nPrometheus\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f\u3001\n\nlogo\u30af\u30ea\u30c3\u30af\nData Sources\u30af\u30ea\u30c3\u30af\nAdd data source\u3092\u30af\u30ea\u30c3\u30af\nName\u306b\u9069\u5f53\u306a\u540d\u524d\u3092\u5165\u529b\nDefault\u306b\u30c1\u30a7\u30c3\u30af(\u30aa\u30d7\u30b7\u30e7\u30ca\u30eb)\nType \u3092Prometheus\u306b\u5909\u66f4\nUrl\u3092Prometheus\u306eURL\u306b\u5909\u66f4\nAccess\u3092Direct\u306b\u5909\u66f4\nAdd\u3092\u30af\u30ea\u30c3\u30af\n\n\u3067\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002\n\n\u6b21\u306b\u30b0\u30e9\u30d5\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001\n\n\u5de6\u4e0a\u306elogo\u30af\u30ea\u30c3\u30af\nDashboards\u304b\u3089New\u3092\u9078\u629e\n\u5de6\u7aef\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089Add Panel\u3001Graph\u3092\u9078\u629e\nQuery\u306b\u9069\u5f53\u306b\u30b0\u30e9\u30d5\u306b\u3057\u305f\u3044\u30af\u30a8\u30ea\u3092\u5165\u529b\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\nPrometheus\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u5165\u529b\u3067\u304d\u305f\u3082\u306e\u306f\u305d\u306e\u307e\u307e\u5165\u529b\u3067\u304d\u307e\u3059\u3002\u88dc\u5b8c\u3082lookup metrics\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u5165\u529b\u3059\u308b\u3068\u6a5f\u80fd\u3057\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u9069\u5f53\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3067\u30b0\u30e9\u30d5\u3092\u4f5c\u308a\u3001\u5f8c\u306f\u4fdd\u5b58\u3059\u308b\u306a\u308a\u3059\u308c\u3070\u3001\u4ee5\u5f8c\u306f\u4e00\u89a7\u304b\u3089\u9078\u629e\u3059\u308b\u3060\u3051\u3067\u305d\u306e\u30b0\u30e9\u30d5\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u30b0\u30e9\u30d5\u4f5c\u6210\u306e\u8a73\u7d30\u306fGrafana\u81ea\u4f53\u306e\u6a5f\u80fd\u306a\u306e\u3067Grafana\u306e\u516c\u5f0f\u30da\u30fc\u30b8\u3067\u3082\u898b\u3066\u3082\u3089\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u306e\u4ed6\n\u4ee5\u4e0b\u306f\u6c17\u306b\u306a\u3063\u3066\u308b\u3051\u3069\u307e\u3060\u8a66\u305b\u3066\u3044\u306a\u3044\u306e\u3067\u4eca\u5f8c\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u305f\u3089\u8ffd\u8a18\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\nPushgateway\n\u6700\u521d\u306b\u66f8\u304d\u307e\u3057\u305f\u304cPushgateway\u3092\u4f7f\u3046\u3068Pull\u3067\u306f\u306a\u304fPush\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nConsul\u9023\u643a\nConsul\u3068\u9023\u643a\u3059\u308b\u3053\u3068\u3067Consul\u304b\u3089\u76e3\u8996\u5bfe\u8c61\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u76e3\u8996\u5bfe\u8c61\u306e\u5897\u6e1b\u306b\u4f34\u3046\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u63db\u3048\u304c\u4e0d\u8981\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\nFederation\nFederation\u3092\u4f7f\u3046\u3068\u4ed6\u306ePrometheus\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u53d6\u5f97\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u5834\u5408\u7b49\u306b\u4f7f\u3046\u3088\u3046\u3067\u3059\u304c\u3001\u4eca\u306e\u3068\u3053\u308d\u305d\u3053\u307e\u3067\u306e\u898f\u6a21\u304c\u5fc5\u8981\u306b\u306a\u308b\u3053\u3068\u306f\u7121\u3055\u305d\u3046\u306a\u306e\u3067\u8a66\u3059\u3053\u3068\u306f\u7121\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u3002\u3002\n\n\n\u6700\u5f8c\u306b\n\u3068\u3044\u3046\u3053\u3068\u3067\u7c21\u5358\u306bPrometheus\u306e\u4f7f\u3044\u65b9\u3092\u898b\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e2d\u3005\u9762\u767d\u305d\u3046\u306a\u306e\u3067\u6a5f\u4f1a\u304c\u3042\u308c\u3070\u5b9f\u6226\u6295\u5165\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306bdocker\u306eswarm\u30e2\u30fc\u30c9\u4f7f\u3044\u307e\u3057\u305f\u304c\u3001\u76e3\u8996\u30c4\u30fc\u30eb\u306f\u56fa\u5b9a\u30ce\u30fc\u30c9\u3067\u52d5\u304b\u3057\u305f\u3044\u3057\u3001\u76e3\u8996\u5bfe\u8c61\u3082service\u3068\u3057\u3066\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u843d\u3061\u305f\u3053\u3068\u306b\u6c17\u4ed8\u3051\u306a\u3044(Routing mesh\u3067\u5225\u306e\u30ce\u30fc\u30c9\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d7\u3051\u53d6\u3063\u3066\u3057\u307e\u3046)\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001swarm\u30e2\u30fc\u30c9\u306e\u4f8b\u3068\u3057\u3066\u306f\u6fc0\u3057\u304f\u4e0d\u9069\u5207\u3060\u3063\u305f\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5b9f\u969b\u306b\u4f5c\u308b\u5834\u5408\u306f\u666e\u901a\u306bcompose\u8fba\u308a\u3092\u4f7f\u3063\u3066\u7acb\u3066\u308b\u306e\u304c\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3082\u30463\u9031\u9593\u524d\u304f\u3089\u3044\u3067\u3059\u304c\u3001Pull\u578b\u3068\u3044\u3046\u73cd\u3057\u3044\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u76e3\u8996\u30c4\u30fc\u30eb\u3067\u3042\u308b[Prometheus1.0\u304c\u30ea\u30ea\u30fc\u30b9](https://prometheus.io/blog/2016/07/18/prometheus-1-0-released/)\u3055\u308c\u307e\u3057\u305f\u3002\u6700\u8fd1\u306f\u65e5\u672c\u3067\u3082[Prometheus Casual Talk](http://connpass.com/event/32859/)\u304c\u958b\u50ac\u3055\u308c\u308b\u306a\u3069\u5c0e\u5165\u4e8b\u4f8b\u3082\u5897\u3048\u3066\u304d\u305f\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u5f8c\u306e\u5c0e\u5165\u3092\u8996\u91ce\u306b\u5165\u308c\u3066\u89e6\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u7279\u5fb4\n\n\u81ea\u5206\u304c\u898b\u305f\u7bc4\u56f2\u3067\u6c17\u306b\u306a\u3063\u305f\u7279\u5fb4\u3068\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n* Go\u88fd\n* \u30a2\u30e9\u30fc\u30c8\u6a5f\u80fd\u304c\u7121\u511f\u3067\u5229\u7528\u53ef\u80fd(\u4f8b\u3048\u3070ELK\u30b9\u30bf\u30c3\u30af\u4f7f\u3046\u5834\u5408\u3001[Watcher](https://www.elastic.co/guide/en/watcher/current/actions.html)\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5229\u7528\u306b\u306f\u6709\u511f\u5951\u7d04\u304c\u5fc5\u8981)\n* \u6271\u3048\u308b\u306e\u306f\u6570\u5024\u306e\u307f(\u30ed\u30b0\u7b49\u3067\u6587\u5b57\u5217\u3092\u6271\u3046\u5834\u5408\u306f\u5225\u306e\u30c4\u30fc\u30eb\u7b49\u304c\u5fc5\u8981)\n* Pull\u578b<br/>\n\u76e3\u8996\u30c4\u30fc\u30eb\u306fPush\u578b(\u76e3\u8996\u5bfe\u8c61\u5074\u304c\u76e3\u8996\u30c4\u30fc\u30eb\u306b\u60c5\u5831\u3092\u9001\u308b)\u306e\u3082\u306e\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001Prometheus\u306fPull\u578b(Prometheus\u304c\u76e3\u8996\u5bfe\u8c61\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b)\u3067\u3059\u3002\u7406\u7531\u306f[\u3053\u3053](https://prometheus.io/docs/introduction/faq/#why-do-you-pull-rather-than-push?)\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u30e9\u30c3\u30d7\u30c8\u30c3\u30d7\u7b49\u3067\u6c17\u8efd\u306b\u76e3\u8996\u30c4\u30fc\u30eb\u3092\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3001\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u843d\u3061\u3066\u3044\u308b\u5834\u5408\u306e\u5224\u65ad\u304c\u697d\u306a\u3053\u3068(Push\u578b\u3060\u3068\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u30a8\u30e9\u30fc\u3067\u843d\u3061\u305f\u306e\u304b\u30e1\u30f3\u30c6\u3067\u843d\u3061\u305f\u306e\u304b\u306e\u5224\u65ad\u304c\u76e3\u8996\u30c4\u30fc\u30eb\u306b\u306f\u3067\u304d\u306a\u3044)\u3001\u30bf\u30fc\u30b2\u30c3\u30c8\u306e\u72b6\u614b\u3092\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3001\u3068\u3044\u3063\u305f\u70b9\u304c\u4e0a\u3052\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001Prometheus\u306b\u3082[Pushgateway](https://prometheus.io/docs/instrumenting/pushing/)\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308a\u3001Push\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002(\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u7d50\u679c\u9001\u4fe1\u7b49\u9650\u3089\u308c\u305f\u7528\u9014\u3067\u306e\u307f\u4f7f\u3046\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059)\n\n# \u4f7f\u3063\u3066\u307f\u308b\n\n\u4e00\u901a\u308a\u6a5f\u80fd\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n[\u524d\u56de\u306e\u8a18\u4e8b](http://qiita.com/kiida/items/6dac109dcd063609b064)\u3067docker1.12\u3067\u8ffd\u52a0\u3055\u308c\u305fswarm\u30e2\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u307f\u305f\u306e\u3067\u3001\u4eca\u56de\u3082swarm\u30e2\u30fc\u30c9\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u304c\u3001\u3042\u3093\u307e\u308a\u76f8\u5fdc\u3057\u3044\u4f8b\u3067\u306f\u306a\u304b\u3063\u305f\u3068\u601d\u3044\u307e\u3059\u3002(Prometheus\u81ea\u4f53\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u7406\u7531\u306f\u6700\u5f8c\u306b\u8a18\u8f09)\n\nswarm\u4f7f\u3063\u3066\u3084\u308b\u5834\u5408\u306fdocker-machin\u3068docker\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3055\u3048\u3044\u308c\u3070\u3001\u4e0a\u8a18\u306e\u8a18\u4e8b\u3092\u8aad\u307e\u306a\u304f\u3066\u3082\u69cb\u7bc9\u3067\u304d\u308b\u3088\u3046\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u305e\u308c\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3069\u306e\u3088\u3046\u306a\u610f\u5473\u304b\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u4e0a\u8a18\u306e\u524d\u56de\u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nswarm\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u9069\u5b9cdocker run\u3068\u304b\u306b\u8aad\u307f\u66ff\u3048\u3066\u8cb0\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30a4\u30f3\u30d5\u30e9\u306fDigitalOcean\u3092\u4f7f\u3044\u307e\u3059\u3002[\u3053\u3061\u3089](https://m.do.co/c/7be3336a0400)\u304b\u3089\u767b\u9332\u3057\u3066\u9802\u3051\u308b\u3068\u304a\u4e92\u3044\u30cf\u30c3\u30d4\u30fc\u306a\u306e\u3067(ry\n\n## Prometheus\u306e\u69cb\u7bc9\u3068\u81ea\u8eab\u306e\u76e3\u8996\n\n\u307e\u305a\u306fswarm\u306emanager\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n# manager\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\n$ docker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"512mb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} manager\n(\u7d50\u679c\u7565)\n\n# manager\u306eIP\u3092\u30e1\u30e2\u308b\n$ docker-machine ls\nNAME           ACTIVE   DRIVER         STATE     URL                          SWARM   DOCKER    ERRORS\nmanager        *        digitalocean   Running   tcp://104.131.149.142:2376           v1.12.0\n\n# swarm\u30e2\u30fc\u30c9\u3092\u521d\u671f\u5316\n$ eval $(docker-machine env manager)\n$ docker swarm init --advertise-addr 104.131.149.142\n\n# \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\u5f97\u3089\u308c\u308b\u306e\u3067worker\u3092\u8ffd\u52a0\u3059\u308b\u30b3\u30de\u30f3\u30c9(1\u500b\u76ee)\u3092\u63a7\u3048\u3066\u304a\u304f\nTo add a worker to this swarm, run the following command:\n    docker swarm join \\\n    --token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n    104.131.149.142:2377\n\nTo add a manager to this swarm, run the following command:\n    docker swarm join \\\n    --token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-en1rtjwtlujupv16qqjja9xda \\\n    104.131.149.142:2377\n```\n\n\u7d9a\u3044\u3066Prometheus\u7528\u306eDocker\u30db\u30b9\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```bash\n# Prometheus\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\ndocker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} prometheus\n(\u7d50\u679c\u7565)\n\n# prometheus\u30ce\u30fc\u30c9\u3092swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\n$ eval $(docker-machine env prometheus)\n$ docker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u81ea\u8eab\u3092\u76e3\u8996\u3059\u308b\u6700\u5c0f\u9650\u306econfig\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```bash\nmkdir prometheus\nvi prometheus/prometheus.yml\n```\n\n```bash:prometheus.yml\u306e\u4e2d\u8eab\nglobal:\n  scrape_interval:     15s\n  external_labels:\n    monitor: 'codelab-monitor'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n```\n\n\u4f55\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u304b\u306f\u30e9\u30d9\u30eb\u304b\u3089\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f[\u516c\u5f0f\u30da\u30fc\u30b8](https://prometheus.io/docs/operating/configuration/)\u3092\u898b\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4e00\u65e6\u3001Prometheus\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash:Prometheus\u306e\u8d77\u52d5\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092Docker\u30db\u30b9\u30c8\u306b\u30b3\u30d4\u30fc\ndocker-machine scp -r prometheus prometheus:/opt/\n\n# manager\u3067docker\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\neval $(docker-machine env manager)\n\n# prometheus\u30b5\u30fc\u30d3\u30b9\u3092prometheus\u30db\u30b9\u30c8\u3067\u306e\u307f\u8d77\u52d5\u3059\u308b\u3088\u3046\u4f5c\u6210\ndocker service create \\\n  --replicas 1 \\\n  --name prometheus \\\n  --publish 9090:9090 \\\n  --mount type=volume,source=/opt/prometheus,target=/etc/prometheus \\\n  --constraint node.hostname==prometheus \\\n  prom/prometheus\n```\n\n\u3053\u308c\u3067`http://<prometheus_ip>:9090/metrics`\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4e00\u89a7\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\nPrometheus\u306eIP\u306fdocker-machine ls\u306a\u3069\u3067\u8abf\u3079\u3066\u304f\u3060\u3055\u3044\u3002\n\n![Screenshot from 2016-08-03 17-54-57.png](https://qiita-image-store.s3.amazonaws.com/0/36003/99d1e015-f339-f13d-cf20-fea7e1c466cf.png)\n\n`http://<prometheus_ip>:9090/graph`\u304b\u3089Graph\u30bf\u30d6\u307e\u305f\u306fConsole\u30bf\u30d6\u3092\u9078\u3076\u3068\u305d\u308c\u305e\u308c\u30b0\u30e9\u30d5\u3068\u30b3\u30f3\u30bd\u30fc\u30eb\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u30bf\u30d6\u3092\u9078\u629e\u3057\u3066\u3001/metrics\u3067\u3067\u3066\u304d\u305f\u4e00\u89a7\u304b\u3089\u9069\u5f53\u306b\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u3092\u5165\u529b\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u7a2e\u985e\u3084\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u7b49\u306f\u5f8c\u8ff0\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8a66\u3057\u306bgo_goroutines\u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n![Screenshot from 2016-08-03 22-14-33.png](https://qiita-image-store.s3.amazonaws.com/0/36003/f83f0226-1d8e-30dc-06fd-4ecf774c1bd3.png)\n\n\u7d9a\u3044\u3066\u30b0\u30e9\u30d5\u30bf\u30d6\u3092\u958b\u304f\u3068\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![Screenshot from 2016-08-03 22-16-57.png](https://qiita-image-store.s3.amazonaws.com/0/36003/565a42db-891d-8133-08eb-053c34e0631d.png)\n\n\u6642\u9593\u8ef8\u7b49\u306f\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\n## \u5225\u306e\u76e3\u8996\u5bfe\u8c61\u3092\u8ffd\u52a0\n\n\u3053\u3053\u307e\u3067\u3060\u3068prometheus\u81ea\u4f53\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3057\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u5225\u306e\u76e3\u8996\u5bfe\u8c61\u3092\u8ffd\u52a0\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n### exporter\n\nOS\u81ea\u4f53\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3084\u65e2\u5b58\u306e\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306f[exporter](https://prometheus.io/docs/instrumenting/exporters/)\u3092\u4f7f\u3044\u307e\u3059\u3002MySQL\u3084HAProxy\u7b49\u6709\u540d\u3069\u3053\u308d\u306eexporter\u306f\u516c\u5f0f\u307e\u305f\u306f\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u306e\u3082\u306e\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u306a\u304a\u3001kubernetes\u3084etcd\u7b49\u306fPrometheus\u5411\u3051\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067expose\u3057\u3066\u3044\u308b\u306e\u3067exporter\u4e0d\u8981\u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u4f8b\u3068\u3057\u3066\u30b7\u30b9\u30c6\u30e0\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3059\u308b[node exporter](https://github.com/prometheus/node_exporter)\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n```bash:node_exporter\u306e\u8d77\u52d5\n\n# host\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f7f\u3046\u305f\u3081\u3001swarm\u3067\u306f\u306a\u304f\u901a\u5e38\u306edocker\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\n# manager\u4e0a\u3067\u5b9f\u884c\neval $(docker-machine env manager)\ndocker run -d -p 9100:9100 --net=\"host\" prom/node-exporter\n\n# prometheus\u30ce\u30fc\u30c9\u3067\u3082\u5b9f\u884c\neval $(docker-machine env prometheus)\ndocker run -d -p 9100:9100 --net=\"host\" prom/node-exporter\n```\n\n`http://<\u5bfe\u8c61\u30ce\u30fc\u30c9\u306eIP>:9100/metrics`\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u5148\u307b\u3069\u3068\u540c\u69d8\u306e\u69d8\u3005\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u304a\u3088\u3073node exporeter\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-04 18-24-09.png](https://qiita-image-store.s3.amazonaws.com/0/36003/a8dcddff-586b-e79a-88a8-f991a2fdc8f7.png)\n\nPrometheus\u304b\u3089\u76e3\u8996\u3067\u304d\u308b\u3088\u3046\u306bconfig\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```bash:prometheus.yml\nglobal:\n  scrape_interval:     15s\n  external_labels:\n    monitor: 'codelab-monitor'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n  - job_name:       'node'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['manager_host_ip:9100']\n        labels:\n          group: 'manager'\n      - targets: ['prometheus_ip:9100']\n        labels:\n          group: 'worker'\n```\n\nconfig\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u6642\u306fPrometheus\u306e\u30d7\u30ed\u30bb\u30b9\u306bSIGHUP\u3092\u9001\u308b\u304b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3068\u30ea\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\u3061\u306a\u307f\u306bPOST\u3067\u3059\u304c\u3001config\u30d5\u30a1\u30a4\u30eb\u81ea\u4f53\u3092\u6e21\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002([\u4ed5\u69d8](https://github.com/prometheus/prometheus/issues/1714))\n\n```\n# config\u30d5\u30a1\u30a4\u30eb\u3092\u30db\u30b9\u30c8\u306b\u9001\u4fe1\ndocker-machine scp -r prometheus prometheus:/opt/\n\n# curl\u3067\u30ea\u30ed\u30fc\u30c9\ncurl -X POST http://prometheus_ip:9090/-/reload\n```\n\n\u76e3\u8996\u5bfe\u8c61\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u3067\u3001`http://<prometheus_ip>:9090/graph`\u306eConsole\u30bf\u30d6\u304b\u3089\u8a66\u3057\u306bnode_cpu\u3068\u3044\u3046\u540d\u524d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n![Screenshot from 2016-08-04 20-08-53.png](https://qiita-image-store.s3.amazonaws.com/0/36003/27ff744a-6c17-df78-1c63-daecf773152c.png)\n\n### \u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\n\n\u3053\u3053\u3067\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u3092\u7c21\u5358\u306b\u7d39\u4ecb\u3057\u3066\u307f\u307e\u3059\u3002\nnode_cpu\u3092\u5b9f\u884c\u3057\u305f\u4e0a\u8a18\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u306b\u3042\u308b\u901a\u308a\u3001Element\u30ab\u30e9\u30e0\u306b\u69d8\u3005\u306a\u30e9\u30d9\u30eb\u4ed8\u304d\u3067node_cpu\u306e\u5024\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059(\u305f\u3068\u3048\u3070\u3001node_cpu{cpu=\"cpu0\",group=\"worker\",instance=\"192.241.200.47:9100\",job=\"node\",mode=\"idle\"})\u3002\n\u3053\u306e\u5f62\u5f0f\u306f\u305d\u306e\u307e\u307e\u30af\u30a8\u30ea\u306b\u4f7f\u3048\u3066\u3001\u4f8b\u3048\u3070\n`node_cpu{cpu=\"cpu0\",group=\"manager\",mode=\"user\"}`\u3092\u5b9f\u884c\u3059\u308b\u3068\u8a72\u5f53\u306e\u30c7\u30fc\u30bf\u306e\u307f\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-04 20-20-31.png](https://qiita-image-store.s3.amazonaws.com/0/36003/3a750c1e-ff62-ead7-91a7-7a3efe7f6430.png)\n\n\u3061\u306a\u307f\u306bjob\u3068group\u3068\u3044\u3046\u30e9\u30d9\u30eb\u306f\u4e0a\u8a18\u306eyml\u30d5\u30a1\u30a4\u30eb\u3067\u6307\u5b9a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\u30af\u30a8\u30ea\u306e\u66f8\u304d\u65b9\u306e\u7db2\u7f85\u7684\u306a\u8aac\u660e\u306f[\u516c\u5f0f\u30da\u30fc\u30b8](https://prometheus.io/docs/querying/basics/)\u306b\u8f09\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3063\u305f\u308a\u3001\n\n`node_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}`\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u76f4\u8fd15\u5206\u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3057\u305f\u308a\n\n`node_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}[5m]`\n\n\u76f4\u8fd15\u5206\u306e\u5e73\u5747\u3092\u8868\u793a\u3057\u305f\u308a\n\n`rate(node_cpu{cpu=~\"cpu.+\",group=\"worker\",mode=~\"user|system\"}[5m])`\n\nuser\u3068system\u306e\u5408\u8a08\u3092\u8868\u793a\u3057\u305f\u308a\n\n`sum(rate(node_cpu{cpu=\"cpu0\",group=\"worker\",mode=~\"user|system\"}[5m]))`\n\n\u8272\u3005\u3067\u304d\u307e\u3059\u3002\n\n\u305d\u306e\u307e\u307e\u30b0\u30e9\u30d5\u30bf\u30d6\u3092\u958b\u3051\u3070\u8a72\u5f53\u3059\u308b\u30c7\u30fc\u30bf\u306e\u30b0\u30e9\u30d5\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![Screenshot from 2016-08-04 20-51-45.png](https://qiita-image-store.s3.amazonaws.com/0/36003/c5bb773f-529c-f8fb-b883-7a96de1c4070.png)\n\n\u3082\u3061\u308d\u3093exporter\u306f\u81ea\u4f5c\u3082\u3067\u304d\u307e\u3059\u3002\nhttps://prometheus.io/docs/instrumenting/writing_exporters/\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u66f8\u304f\n\n\u30a2\u30d7\u30ea\u3084\u30c4\u30fc\u30eb\u7b49\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3055\u305b\u305f\u3044\u5834\u5408\u306fexporter\u3092\u66f8\u304f\u307e\u3067\u3082\u306a\u304f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u516c\u958b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nhttps://prometheus.io/docs/instrumenting/clientlibs/\n\nGo\u4ee5\u5916\u306e\u8a00\u8a9e\u3067\u3082\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u304a\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u610f\u5473\u306e\u306a\u3044Counter\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002Counter\u306e\u4ed6\u306b\u3082Gauge,Summary,Histogram\u3068\u3044\u3046\u30bf\u30a4\u30d7\u306e[\u30e1\u30c8\u30ea\u30af\u30b9](https://prometheus.io/docs/concepts/metric_types/)\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b[\u3053\u3053](https://hub.docker.com/r/daikikohara/prometheus-client/)\u306bpublish\u3057\u3066\u3042\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3068Dockerfile\u306f\u4f5c\u3089\u306a\u304f\u3066OK\u3067\u3059\u3002\n\n```go\npackage main\n\nimport (\n\t\"math/rand\"\n\t\"net/http\"\n\t\"time\"\n\n\t\"github.com/prometheus/client_golang/prometheus\"\n)\n\nfunc main() {\n\tpushCounter := prometheus.NewCounter(prometheus.CounterOpts{\n\t\tName: \"sample_counter\",\n\t\tHelp: \"just a simple counter\",\n\t})\n\tprometheus.MustRegister(pushCounter)\n\n\tgo func() {\n\t\tfor {\n\t\t\tpushCounter.Inc()\n\t\t\ttime.Sleep(time.Duration(rand.Intn(1000)) * time.Millisecond)\n\t\t}\n\t}()\n\n\thttp.Handle(\"/metrics\", prometheus.Handler())\n\thttp.ListenAndServe(\":9111\", nil)\n}\n```\n\nalpine\u3067\u52d5\u304b\u3059\u306e\u3067\u3053\u3093\u306a\u611f\u3058\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n`CGO_ENABLED=0 go build`\n\n\u3053\u3093\u306a\u611f\u3058\u306eDokcerfile\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\nFROM alpine:latest\nADD prometheus /\nCMD /prometheus\n````\n\n\u3053\u306e\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\ndocker service create \\\n  --replicas 1 \\\n  --name sample-client \\\n  --publish 9111:9111 \\\n  daikikohara/prometheus-client:v1\n```\n\nswarm\u30ce\u30fc\u30c9\u306e\u4efb\u610f\u306eIP:9111/metrics\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u52a0\u3048\u3066\u8ffd\u52a0\u3057\u305fsample_counter\u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot from 2016-08-05 00-45-03.png](https://qiita-image-store.s3.amazonaws.com/0/36003/263ac757-cb38-617b-6f9c-a7936aacd265.png)\n\nPrometheus\u306e\u76e3\u8996\u5bfe\u8c61\u306b\u8ffd\u52a0\u3059\u308b\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30bb\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u3001\n\n```\n  - job_name:       'sample'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['sample-client\u304c\u52d5\u3044\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306eIP:9111']\n```\n\n\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```\ndocker-machine scp -r prometheus prometheus:/opt/\ncurl -X POST http://prometheus_ip:9090/-/reload\n```\n\nWebUI\u304b\u3089\u30b0\u30e9\u30d5\u3082\u8868\u793a\u3067\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-05 15-32-23.png](https://qiita-image-store.s3.amazonaws.com/0/36003/2b2eb5b0-d761-6b8e-b290-f90790b8407e.png)\n\n## Recording rule\n\n[Recording rule](https://prometheus.io/docs/querying/rules/)\u3092\u4f7f\u3046\u3068\u3088\u304f\u4f7f\u3046\u30af\u30a8\u30ea\u306e\u7d50\u679c\u7b49\u3092\u5225\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u5143\u306e\u30af\u30a8\u30ea\u3092\u90fd\u5ea6\u5b9f\u884c\u3059\u308b\u3088\u308a\u52b9\u7387\u7684\u3067\u3001\u7279\u306b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7b49\u3067\u983b\u7e41\u306b\u5b9f\u884c\u3055\u308c\u308b\u30b1\u30fc\u30b9\u3067\u306f\u6709\u5229\u307f\u305f\u3044\u3067\u3059\u3002\n\n\u304a\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30ed\u30fc\u30ab\u30eb\u306eprometheus/prometheus.rules\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:prometheus.rules\nsample_rule:node_cpu_user:avg_rate5m = avg(rate(node_cpu{mode=\"user\"}[5m])) by (instance, cpu)\n```\n\n\u30eb\u30fc\u30eb\u306e\u66f8\u304d\u65b9\u304c\u6b63\u3057\u3044\u304b\u306f\u4ee5\u4e0b\u306e\u30c4\u30fc\u30eb\u3067\u30c1\u30a7\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\n\n```bash\n$ go get github.com/prometheus/prometheus/cmd/promtool\n$ promtool check-rules ./prometheus.rules\nChecking ./prometheus.rules\n  SUCCESS: 1 rules found\n```\n\nprometheus.yml\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u8ffd\u52a0\u3057\u305f\u306e\u306fevaluation_interval\u3068rule_files\u3067\u3059\u3002\u30eb\u30fc\u30eb\u306e\u8a55\u4fa1\u309215\u79d2\u3054\u3068\u306b\u884c\u3046\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\n```\nglobal:\n  scrape_interval:     15s\n  evaluation_interval: 15s\n  external_labels:\n    monitor: 'codelab-monitor'\nrule_files:\n  - 'prometheus.rules'\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:9090']\n  - job_name:       'node'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['manager_ip:9100']\n        labels:\n          group: 'manager'\n      - targets: ['prometheus_ip:9100']\n        labels:\n          group: 'worker'\n  - job_name:       'sample'\n    scrape_interval: 5s\n    scrape_timeout: 3s\n    static_configs:\n      - targets: ['prometheus_ip:9111']\n```\n\n\u30eb\u30fc\u30eb\u3068config\u30d5\u30a1\u30a4\u30eb\u3092Prometheus\u306e\u30db\u30b9\u30c8\u306b\u9001\u3063\u3066\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```\ndocker-machine scp -r prometheus prometheus:/opt/\ncurl -X POST http://prometheus_ip:9090/-/reload\n```\n\n\u8a2d\u5b9a\u3057\u305f\u30eb\u30fc\u30eb\u540d\u3067\u30b0\u30e9\u30d5\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot from 2016-08-05 18-45-55.png](https://qiita-image-store.s3.amazonaws.com/0/36003/1056119a-3e34-a301-32cc-d163b42ce31c.png)\n\n## Alertmanager\n\n[Alertmanager](https://prometheus.io/docs/alerting/alertmanager/)\u3092\u4f7f\u3046\u3068\u69d8\u3005\u306a\u6761\u4ef6\u3067\u30a2\u30e9\u30fc\u30c8\u306e\u9001\u4fe1\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nAlertmanager\u306fPrometheus\u3068\u306f\u5225\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u3001Prometheus\u4e0a\u3067rule\u3092\u8a2d\u5b9a\u3057\u3066Alertmanager\u306b\u30a2\u30e9\u30fc\u30c8\u3092\u9001\u4fe1\u3001Alertmanager\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u30a2\u30e9\u30fc\u30c8\u3092\u6761\u4ef6\u306b\u5f93\u3063\u3066\u69d8\u3005\u306a\u901a\u77e5\u5148\u306b\u9001\u4fe1\u3059\u308b\u7b49\u306e\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3068\u3044\u3046\u6319\u52d5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u9001\u4fe1\u5148\u306femail\u3084Slack\u7b49\u69d8\u3005\u306a\u3082\u306e\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30eb\u30fc\u30eb\u3082\u69d8\u3005\u306a\u3082\u306e\u304c\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n[\u516c\u5f0f\u30da\u30fc\u30b8](https://prometheus.io/docs/alerting/alertmanager/)\u3067\u89e6\u308c\u3089\u308c\u3066\u3044\u308b\u3082\u306e\u3060\u3068Grouping(\u4f8b\u3048\u3070DB\u304c\u843d\u3061\u305f\u3089\u767a\u751f\u3059\u308b\u30a8\u30e9\u30fc\u7b49\u306f1\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u53d7\u4fe1\u3067\u304d\u308c\u3070\u826f\u3044\u306e\u3067\u3001\u540c\u3058\u7a2e\u985e\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u307e\u3068\u3081\u308b)\u3001Inhibition(\u3042\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30e9\u30fc\u30c8\u304c\u65e2\u306b\u767a\u751f\u3057\u3066\u3044\u305f\u3089\u5225\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u767a\u751f\u3055\u305b\u306a\u3044)\u3001Silence(\u7279\u5b9a\u306e\u30a2\u30e9\u30fc\u30c8\u3092\u4e00\u5b9a\u6642\u9593\u767a\u751f\u3055\u305b\u306a\u3044)\u3068\u3044\u3063\u305f\u30bf\u30a4\u30d7\u306e\u30eb\u30fc\u30eb\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f[\u516c\u5f0f\u30da\u30fc\u30b8\u306e\u4f8b](https://prometheus.io/docs/alerting/rules/)\u306b\u3042\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5834\u5408\u306e\u30a2\u30e9\u30fc\u30c8\u3092\u8a66\u3057\u307f\u3066\u307e\u3059\u3002\u9001\u4fe1\u5148\u306fSlack\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u307e\u305a\u306falertmanager\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u4f5c\u3063\u3066\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nmkdir alertmanager\nvi alertmanager/config.yml\n```\n\n```bash:config.yml\nglobal:\nroute:\n  receiver: main\n  group_by: ['alertname', 'instance']\n  group_wait: 30s\n  group_interval: 5m\n  repeat_interval: 1h\nreceivers:\n- name: 'main'\n  slack_configs:\n  - api_url: 'https://hooks.slack.com/services/your_api_token'\n    channel: '#channel_name'\n```\n\n\u6b21\u306bAlertmanager\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n# alertmaanger\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\ndocker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} alertmanager\n\n# swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\neval $(docker-machine env alertmanager)\ndocker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092alertmanager\u306e\u30db\u30b9\u30c8\u306b\u9001\u4fe1\ndocker-machine scp -r alertmanager alertmanager:/opt/\n\n# Alertmanager\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\neval $(docker-machine env manager)\ndocker service create \\\n  --replicas 1 \\\n  --name alertmanager \\\n  --publish 9093:9093 \\\n  --mount type=volume,source=/opt/alertmanager,target=/etc/alertmanager \\\n  --constraint node.hostname==alertmanager \\\n  prom/alertmanager:latest\n```\n\nAlertmanager\u30ce\u30fc\u30c9\u306eIP:9093\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u304c\u51fa\u6765\u304d\u305f\u3089OK\u3067\u3059\u3002\n\n![Screenshot from 2016-08-05 20-37-23.png](https://qiita-image-store.s3.amazonaws.com/0/36003/57c36427-f54f-2d57-f3be-3d4f53bebe27.png)\n\n\u7d9a\u3044\u3066Prometheus\u5074\u306b\u30a2\u30e9\u30fc\u30c8\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002prometheus\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:alert.rules\nALERT InstanceDown\n  IF up == 0\n  FOR 1m\n  LABELS { severity = \"page\" }\n  ANNOTATIONS {\n    summary = \"Instance {{ $labels.instance }} down\",\n    description = \"{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 5 minutes.\",\n  }\n```\n\n\u4e0a\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092prometheus.yml\u304b\u3089\u53c2\u7167\u3057\u307e\u3059\u3002\n\n```bash:\u8a72\u5f53\u7b87\u6240\u306e\u307f\nrule_files:\n  - 'prometheus.rules'\n  - 'alert.rules'\n```\n\nPrometheus\u306e\u30b3\u30f3\u30c6\u30ca\u5074\u3082\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u516c\u5f0f\u306eDocker image\u3067\u306fAlertmanager\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306aDockerfile\u3092\u4f5c\u6210\u3057\u3066[\u3053\u3061\u3089](https://hub.docker.com/r/daikikohara/prometheus/)\u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\n```bash:Dockerfile\nFROM prom/prometheus\nENTRYPOINT [ \"sh\" ]\nCMD [ \"-c\", \\\n      \"/bin/prometheus \\\n      -config.file=/etc/prometheus/prometheus.yml \\\n      -storage.local.path=/prometheus \\\n      -alertmanager.url=${ALERTMANAGER}\" ]\n```\n\n\u4e00\u5ea6\u5143\u306eprometheus\u30b5\u30fc\u30d3\u30b9\u3092\u843d\u3068\u3057\u3066\u304b\u3089\u4e0a\u8a18\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u305fprometheus\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n# \u30b5\u30fc\u30d3\u30b9\u3092\u524a\u9664\n$ docker service rm prometheus\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30db\u30b9\u30c8\u306b\u9001\u4fe1\n$ docker-machine scp -r prometheus prometheus:/opt/\n\n# \u30b5\u30fc\u30d3\u30b9\u3092\u518d\u4f5c\u6210\n$ docker service create \\\n  --replicas 1 \\\n  --name prometheus \\\n  --publish 9090:9090 \\\n  --mount type=volume,source=/opt/prometheus,target=/etc/prometheus \\\n  --env ALERTMANAGER=\"http://alertmanager_ip:9093\" \\\n  --constraint node.hostname==prometheus \\\n  daikikohara/prometheus:v1\n```\n\n\u304a\u3082\u3080\u308d\u306b\u76e3\u8996\u5bfe\u8c61\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4e00\u3064\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n# manager\u4e0a\u306edocker\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\n$ docker ps\nCONTAINER ID        IMAGE                              COMMAND                  CREATED             STATUS              PORTS               NAMES\n57aa0d720403        prom/node-exporter                 \"/bin/node_exporter\"     2 hours ago         Up 2 hours                              suspicious_keller\n9687d44ae859        daikikohara/prometheus-client:v1   \"/bin/sh -c /promethe\"   7 hours ago         Up 7 hours                              sample-client.1.2zkn3wtvw37f8fiy6xqfhui4n\n\n# node_exporter\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\n$ docker stop suspicious_keller\nsuspicious_keller\n```\n\n\u3053\u3053\u3067Alert\u30bf\u30d6\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3068PENDING\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot from 2016-08-05 23-23-42.png](https://qiita-image-store.s3.amazonaws.com/0/36003/3a008a6c-d5d5-276c-4b74-1a987df2d7a2.png)\n\n1\u5206\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u304b\u3089\u518d\u78ba\u8a8d\u3059\u308b\u3068State\u304cFIRING\u306b\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\n![Screenshot from 2016-08-05 23-28-41.png](https://qiita-image-store.s3.amazonaws.com/0/36003/32fb7fa3-8d59-87d0-de8a-b84a7f1914e1.png)\n\nAlertmanager\u306b\u3082\u901a\u77e5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n(\u30ad\u30e3\u30d7\u30c1\u30e3\u64ae\u308a\u5fd8\u308c)\n\nAlertmanager\u7d4c\u7531\u3067Slack\u306b\u3082\u901a\u77e5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot from 2016-08-08 00-38-02.png](https://qiita-image-store.s3.amazonaws.com/0/36003/a444c13a-518f-0f64-2c67-8cc02dd9e6d8.png)\n\n## Grafana\u9023\u643a\n\n\u3053\u308c\u307e\u3067\u898b\u3066\u304d\u305f\u901a\u308aPrometheus\u81ea\u8eab\u306b\u3082\u30b0\u30e9\u30d5\u306e\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u307e\u308a\u30d1\u30ef\u30d5\u30eb\u3067\u306f\u306a\u3044\u305f\u3081\u3001[Grafana](https://prometheus.io/docs/visualization/grafana/)\u3068\u9023\u643a\u3059\u308b\u3053\u3068\u3092\u516c\u5f0f\u3067\u3082\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u3002[Grafana](http://docs.grafana.org/)\u306f\u69d8\u3005\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53ef\u8996\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3001Prometheus\u4ee5\u5916\u306b\u3082InfluxDB\u3084CloudWatch\u7b49\u69d8\u3005\u306a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u305a\u306fGrafana\u7528\u306e\u30de\u30b7\u30f3\u3068\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n# Grafana\u7528\u306e\u30db\u30b9\u30c8\u3092\u4f5c\u6210\n$ docker-machine create -d digitalocean --digitalocean-image \"ubuntu-16-04-x64\" --digitalocean-region \"sfo1\" --digitalocean-size \"2gb\" --digitalocean-access-token ${DIGITALOCEAN_API_TOKEN} grafana\n\n# grafana\u30ce\u30fc\u30c9\u3092swarm\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\n$ eval $(docker-machine env grafana)\n$ docker swarm join \\\n--token SWMTKN-1-12wn17zowr4ysj089mb4s0zijbwexx6w3oucz77k87uwkmxlsu-e9lv6z80x48hx42mxz50t0l6g \\\n104.131.149.142:2377\n\n# Grafana\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\n$ docker service create \\\n  --replicas 1 \\\n  --name grafana \\\n  --publish 3000:3000 \\\n  --constraint node.hostname==grafana \\\n  grafana/grafana\n\n```\n\nGrafana\u306e\u30ce\u30fc\u30c9\u306eIP:3000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-08 12-01-14.png](https://qiita-image-store.s3.amazonaws.com/0/36003/619e1ed1-feb0-6c48-0ed8-739d5abfa490.png)\n\n\u4eca\u56de\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306a\u306e\u3067admin/admin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\nPrometheus\u306e\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f\u3001\n\n* logo\u30af\u30ea\u30c3\u30af\n* Data Sources\u30af\u30ea\u30c3\u30af\n* Add data source\u3092\u30af\u30ea\u30c3\u30af\n* Name\u306b\u9069\u5f53\u306a\u540d\u524d\u3092\u5165\u529b\n* Default\u306b\u30c1\u30a7\u30c3\u30af(\u30aa\u30d7\u30b7\u30e7\u30ca\u30eb)\n* Type \u3092Prometheus\u306b\u5909\u66f4\n* Url\u3092Prometheus\u306eURL\u306b\u5909\u66f4\n* Access\u3092Direct\u306b\u5909\u66f4\n* Add\u3092\u30af\u30ea\u30c3\u30af\n\n\u3067\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-08 12-57-37.png](https://qiita-image-store.s3.amazonaws.com/0/36003/d8702c41-5494-37b9-333a-f3b9a7da4c20.png)\n\n\u6b21\u306b\u30b0\u30e9\u30d5\u3092\u4f5c\u6210\u3059\u308b\u306b\u306f\u3001\n\n* \u5de6\u4e0a\u306elogo\u30af\u30ea\u30c3\u30af\n* Dashboards\u304b\u3089New\u3092\u9078\u629e\n* \u5de6\u7aef\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089Add Panel\u3001Graph\u3092\u9078\u629e\n* Query\u306b\u9069\u5f53\u306b\u30b0\u30e9\u30d5\u306b\u3057\u305f\u3044\u30af\u30a8\u30ea\u3092\u5165\u529b\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\n![Screenshot from 2016-08-08 12-59-59.png](https://qiita-image-store.s3.amazonaws.com/0/36003/28d47771-2b86-a71b-a9be-8ce679c0d066.png)\n\n\nPrometheus\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u5165\u529b\u3067\u304d\u305f\u3082\u306e\u306f\u305d\u306e\u307e\u307e\u5165\u529b\u3067\u304d\u307e\u3059\u3002\u88dc\u5b8c\u3082lookup metrics\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u5165\u529b\u3059\u308b\u3068\u6a5f\u80fd\u3057\u307e\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u9069\u5f53\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3067\u30b0\u30e9\u30d5\u3092\u4f5c\u308a\u3001\u5f8c\u306f\u4fdd\u5b58\u3059\u308b\u306a\u308a\u3059\u308c\u3070\u3001\u4ee5\u5f8c\u306f\u4e00\u89a7\u304b\u3089\u9078\u629e\u3059\u308b\u3060\u3051\u3067\u305d\u306e\u30b0\u30e9\u30d5\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u306e\u4ed6\u30b0\u30e9\u30d5\u4f5c\u6210\u306e\u8a73\u7d30\u306fGrafana\u81ea\u4f53\u306e\u6a5f\u80fd\u306a\u306e\u3067[Grafana\u306e\u516c\u5f0f\u30da\u30fc\u30b8](http://docs.grafana.org/guides/gettingstarted/)\u3067\u3082\u898b\u3066\u3082\u3089\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u305d\u306e\u4ed6\n\n\u4ee5\u4e0b\u306f\u6c17\u306b\u306a\u3063\u3066\u308b\u3051\u3069\u307e\u3060\u8a66\u305b\u3066\u3044\u306a\u3044\u306e\u3067\u4eca\u5f8c\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u305f\u3089\u8ffd\u8a18\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n* Pushgateway<br/>\n\u6700\u521d\u306b\u66f8\u304d\u307e\u3057\u305f\u304cPushgateway\u3092\u4f7f\u3046\u3068Pull\u3067\u306f\u306a\u304fPush\u3082\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n* [Consul\u9023\u643a](https://prometheus.io/docs/operating/configuration/#%3Cconsul_sd_config%3E)<br/>\n[Consul](https://www.consul.io/)\u3068\u9023\u643a\u3059\u308b\u3053\u3068\u3067Consul\u304b\u3089\u76e3\u8996\u5bfe\u8c61\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u76e3\u8996\u5bfe\u8c61\u306e\u5897\u6e1b\u306b\u4f34\u3046\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u63db\u3048\u304c\u4e0d\u8981\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u8a66\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n* [Federation](https://prometheus.io/docs/operating/federation/)<br/>\nFederation\u3092\u4f7f\u3046\u3068\u4ed6\u306ePrometheus\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u53d6\u5f97\u304c\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\u5834\u5408\u7b49\u306b\u4f7f\u3046\u3088\u3046\u3067\u3059\u304c\u3001\u4eca\u306e\u3068\u3053\u308d\u305d\u3053\u307e\u3067\u306e\u898f\u6a21\u304c\u5fc5\u8981\u306b\u306a\u308b\u3053\u3068\u306f\u7121\u3055\u305d\u3046\u306a\u306e\u3067\u8a66\u3059\u3053\u3068\u306f\u7121\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u3002\u3002\n\n# \u6700\u5f8c\u306b\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u7c21\u5358\u306bPrometheus\u306e\u4f7f\u3044\u65b9\u3092\u898b\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e2d\u3005\u9762\u767d\u305d\u3046\u306a\u306e\u3067\u6a5f\u4f1a\u304c\u3042\u308c\u3070\u5b9f\u6226\u6295\u5165\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306bdocker\u306eswarm\u30e2\u30fc\u30c9\u4f7f\u3044\u307e\u3057\u305f\u304c\u3001\u76e3\u8996\u30c4\u30fc\u30eb\u306f\u56fa\u5b9a\u30ce\u30fc\u30c9\u3067\u52d5\u304b\u3057\u305f\u3044\u3057\u3001\u76e3\u8996\u5bfe\u8c61\u3082service\u3068\u3057\u3066\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u843d\u3061\u305f\u3053\u3068\u306b\u6c17\u4ed8\u3051\u306a\u3044([Routing mesh](http://qiita.com/kiida/items/6dac109dcd063609b064#routing-mesh%E3%82%92%E8%A9%A6%E3%81%99)\u3067\u5225\u306e\u30ce\u30fc\u30c9\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d7\u3051\u53d6\u3063\u3066\u3057\u307e\u3046)\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001swarm\u30e2\u30fc\u30c9\u306e\u4f8b\u3068\u3057\u3066\u306f\u6fc0\u3057\u304f\u4e0d\u9069\u5207\u3060\u3063\u305f\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5b9f\u969b\u306b\u4f5c\u308b\u5834\u5408\u306f\u666e\u901a\u306bcompose\u8fba\u308a\u3092\u4f7f\u3063\u3066\u7acb\u3066\u308b\u306e\u304c\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["prometheus", "grafana", "docker"]}