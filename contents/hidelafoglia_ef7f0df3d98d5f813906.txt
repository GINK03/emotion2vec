{"context": " More than 1 year has passed since last update.\n\n\u65b9\u91dd\n\n\u3042\u308b\u30e2\u30c7\u30eb\u306b OneToOne\u3067\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u3092\u8a2d\u5b9a\u3059\u308b\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3059\u308b\n\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306f\u5143\u306e\u30e2\u30c7\u30eb\u3068\u540c\u3058\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u3068\u3059\u308b\n\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306f\u52d5\u7684\u306b\u5b9a\u7fa9\u3059\u308b\n\n\n\u5143\u30e2\u30c7\u30eb:\u500b\u4eba\u5c5e\u6027(Profile)\n\n\u62bd\u8c61\u30e2\u30c7\u30eb\n\n\nclass AbstractProfile(models.Model):\n    user = models.OneToOneField(User)\n    age = models.IntegerField()\n    gender = models.IntegerField(choices=((0, 'Femail', ), (1, 'Male', ), ))\n\n    class Meta:\n        abstract = True\n\n\n\u5177\u4f53\u30e2\u30c7\u30eb\n\nclass Profile(AbstractProfile):                                                     \n    pass   \n\n\n\u30e2\u30c7\u30eb\u306b\u5bfe\u3057\u3066\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u751f\u6210\n\n\u62bd\u8c61\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8fd4\u3059\n\ndef create_privacy_fields(model_class, field_class, **kwargs):    \n    # \u30e1\u30bf\u30af\u30e9\u30b9\u3092 abstract = True\u3067\u4f5c\u308b                                               \n    fields = {\n        '__module__': model_class.__module__,\n        'Meta': type('Meta', (object, ), {'abstract': True, }),\n    }\n\n    for i in model_class._meta.fields:\n        if isinstance(i, models.AutoField):\n            continue\n        fields[i.name] = field_class(i.verbose_name, **kwargs)\n\n    return fields\n\n\n\u30d7\u30e9\u30a4\u30d0\u30b7\u5236\u5fa1\u30e2\u30c7\u30eb(ProfilePrivacy)\n\n\u62bd\u8c61\u30e2\u30c7\u30eb\u3092AbstractProfile\u3092\u5143\u306b\u52d5\u7684\u306b\u751f\u6210\n\nAbstractProfilePrivacy = type(\n    'AbstractProfilePrivacy',\n    (models.Model,),\n    create_privacy_fields(\n        AbstractProfile, models.BooleanField, default=False),\n)   \n\n\n\u5177\u4f53\u30e2\u30c7\u30eb: Profile <-(OneToOne)- ProfilePrivacy\n\n\nclass ProfilePrivacy(AbstractProfilePrivacy):\n    profile = models.OneToOneField(Profile)\n\n\n\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\n$ python manage.py makemigrations accounts\n\nMigrations for 'accounts':\n  0001_initial.py:\n    - Create model Profile\n    - Create model ProfilePrivacy\n\n$ python manage.py migrate\n\nOperations to perform:\n  Apply all migrations: accounts\nRunning migrations:\n  Rendering model states... DONE\n  Applying accounts.0001_initial... OK\n\n$ python manage.py shell\n\nIn [1]: from django.contrib.auth.models import *\nIn [2]: from accounts.models import *\nIn [3]: u = User.objects.get(username='admin')\nIn [4]: p = Profile.objects.create(user=u, age=33, gender=0)\nIn [5]: pr = ProfilePrivacy.objects.create(profile=p)\nIn [6]: u.profile.profileprivacy.gender\nOut[6]: False\nIn [7]: pr.gender = True\nIn [8]: pr.save()\nIn [9]: u.profile.profileprivacy.gender\nOut[9]: True\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n<td>{% if request.user == profile.user or profile.profileprivacy.age %}\n    {{ profile.age }} {% else %} \u516c\u958b\u3055\u308c\u3066\u3044\u307e\u305b\u3093 {% endif %}</td>\n\n\n\n## \u65b9\u91dd\n\n- \u3042\u308b\u30e2\u30c7\u30eb\u306b OneToOne\u3067\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u3092\u8a2d\u5b9a\u3059\u308b\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3059\u308b\n- \u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306f\u5143\u306e\u30e2\u30c7\u30eb\u3068\u540c\u3058\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u3068\u3059\u308b\n- \u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306f\u52d5\u7684\u306b\u5b9a\u7fa9\u3059\u308b\n\n## \u5143\u30e2\u30c7\u30eb:\u500b\u4eba\u5c5e\u6027(Profile)\n\n- \u62bd\u8c61\u30e2\u30c7\u30eb\n\n~~~py\n\nclass AbstractProfile(models.Model):\n    user = models.OneToOneField(User)\n    age = models.IntegerField()\n    gender = models.IntegerField(choices=((0, 'Femail', ), (1, 'Male', ), ))\n\n    class Meta:\n        abstract = True\n~~~\n\n- \u5177\u4f53\u30e2\u30c7\u30eb\n\n~~~py\nclass Profile(AbstractProfile):                                                     \n    pass   \n~~~\n\n\n## \u30e2\u30c7\u30eb\u306b\u5bfe\u3057\u3066\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u5236\u5fa1\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u751f\u6210\n\n- \u62bd\u8c61\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u8fd4\u3059\n\n~~~py\ndef create_privacy_fields(model_class, field_class, **kwargs):    \n\t# \u30e1\u30bf\u30af\u30e9\u30b9\u3092 abstract = True\u3067\u4f5c\u308b                                               \n    fields = {\n        '__module__': model_class.__module__,\n        'Meta': type('Meta', (object, ), {'abstract': True, }),\n    }\n\n    for i in model_class._meta.fields:\n        if isinstance(i, models.AutoField):\n            continue\n        fields[i.name] = field_class(i.verbose_name, **kwargs)\n\n    return fields\n~~~    \n\n## \u30d7\u30e9\u30a4\u30d0\u30b7\u5236\u5fa1\u30e2\u30c7\u30eb(ProfilePrivacy)\n\n- \u62bd\u8c61\u30e2\u30c7\u30eb\u3092AbstractProfile\u3092\u5143\u306b\u52d5\u7684\u306b\u751f\u6210\n\n~~~py\nAbstractProfilePrivacy = type(\n    'AbstractProfilePrivacy',\n    (models.Model,),\n    create_privacy_fields(\n        AbstractProfile, models.BooleanField, default=False),\n)   \n~~~\n\n- \u5177\u4f53\u30e2\u30c7\u30eb: `Profile <-(OneToOne)- ProfilePrivacy`\n\n~~~py\nclass ProfilePrivacy(AbstractProfilePrivacy):\n    profile = models.OneToOneField(Profile)\n~~~\n\n## \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\n\n\n~~~bash\n$ python manage.py makemigrations accounts\n\nMigrations for 'accounts':\n  0001_initial.py:\n    - Create model Profile\n    - Create model ProfilePrivacy\n~~~\n\n~~~bash\n$ python manage.py migrate\n\nOperations to perform:\n  Apply all migrations: accounts\nRunning migrations:\n  Rendering model states... DONE\n  Applying accounts.0001_initial... OK\n~~~\n\n~~~bash\n$ python manage.py shell\n~~~\n~~~py\nIn [1]: from django.contrib.auth.models import *\nIn [2]: from accounts.models import *\nIn [3]: u = User.objects.get(username='admin')\nIn [4]: p = Profile.objects.create(user=u, age=33, gender=0)\nIn [5]: pr = ProfilePrivacy.objects.create(profile=p)\nIn [6]: u.profile.profileprivacy.gender\nOut[6]: False\nIn [7]: pr.gender = True\nIn [8]: pr.save()\nIn [9]: u.profile.profileprivacy.gender\nOut[9]: True\n~~~\n\n## \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n~~~html\n\n<td>{% if request.user == profile.user or profile.profileprivacy.age %}\n    {{ profile.age }} {% else %} \u516c\u958b\u3055\u308c\u3066\u3044\u307e\u305b\u3093 {% endif %}</td>\n\n~~~\n", "tags": ["Django"]}