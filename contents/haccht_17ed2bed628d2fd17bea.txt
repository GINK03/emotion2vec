{"context": "\u3053\u306e\u305f\u3073Edgerouter Lite-3\u3092\u5b89\u304f\u8cfc\u5165\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u3001IIJmio\u3072\u304b\u308a\u3067IPoE\u3092\u5951\u7d04\u3057\u3066DS-Lite\u3057\u3066\u307f\u305f\u3002\nEdgerouter\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306fEdgeOS\u3068\u8a00\u3063\u3066Vyos\u304b\u3089\u30d5\u30a9\u30fc\u30af\u3057\u305f\u3082\u306e\u3067\u3001\u3044\u304f\u3064\u304b\u72ec\u81ea\u4ed5\u69d8\u306e\u90e8\u5206\u3082\u3042\u308b\u3051\u308c\u3069IPv6\u307e\u308f\u308a\u306e\u307e\u3068\u307e\u3063\u305f\u8cc7\u6599\u3082\u306a\u304b\u3063\u305f\u306e\u3067\u6574\u7406\u304c\u3066\u3089\u6295\u7a3f\u3057\u3066\u307f\u308b\u3002\n\u3061\u306a\u307f\u306bEdgeOS\u306f\u3064\u3044\u5148\u65e51.9.1\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u3070\u304b\u308a\u3067\u3001\u3053\u306e\u30ea\u30ea\u30fc\u30b9\u3067IPv6\u3067\u306eIPIP\u30c8\u30f3\u30cd\u30eb\u304c\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3060\u3002\u3061\u3087\u3046\u3069\u3044\u3044\u30bf\u30a4\u30df\u30f3\u30b0\u3060\u3063\u305f\u3002\n\n\u69cb\u6210\nERL-3\u306eeth0\u3092WAN\u306b\u3001eth1\u3068eth2\u3092LAN\u306b\u8a2d\u5b9a\u3002 \neth1\u3068eth2\u3092\u30d6\u30ea\u30c3\u30b8\u3055\u305b\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u3088\u3046\u3060\u3051\u3069\u3001\u6027\u80fd\u304c\u5927\u304d\u304f\u4f4e\u4e0b\u3059\u308b\u305f\u3081\u4eca\u56de\u306f\u500b\u5225\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306b\u3057\u305f\u3002ER-x\u306a\u3089\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30b9\u30a4\u30c3\u30c1\u30f3\u30b0\u304c\u53ef\u80fd\u306a\u3088\u3046\u306a\u306e\u3067\u3001\u5fc5\u8981\u306a\u3089\u305d\u3061\u3089\u3067\u3002  \n\u5149\u30b3\u30e9\u30dc\u30ec\u30fc\u30b7\u30e7\u30f3\u4e8b\u696d\u8005\u3067\u3042\u308b\u3068\u3053\u308d\u306eIIJ\u304b\u3089\u8cb8\u4e0e\u3055\u308c\u305f\u3072\u304b\u308a\u96fb\u8a71\u30eb\u30fc\u30bf\u306fpr-500ki\u3002pr-500ki\u306eLAN\u30dd\u30fc\u30c8\u3068ERL-3\u306eeth0\u3092\u63a5\u7d9a\u3057\u3066\u304a\u304f\u3002\n\u307e\u305fpr-500ki\u306epppoe\u306f\u505c\u6b62\u3057\u3066\u3001pppoe\u30d6\u30ea\u30c3\u30b8\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\u4eca\u56de\u306f\u3072\u304b\u308a\u96fb\u8a71\u5951\u7d04\u3042\u308a\u306a\u306e\u3067\u3001HGW\u304b\u3089\u306eRA\u3092\u3082\u3068\u306beth0\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306fautoconf\u3059\u308b\u3002\n\u307e\u305fDHCPv6-PD\u306b\u3088\u308aHGW\u306b\u306f/60\u306eprefix\u304c\n\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002\u3053\u308c\u3092/64\u306eprefix\u306b\u5206\u5272\u3057\u3066LAN\u5185\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306b\u5229\u7528\u3059\u308b\u3002\n\n\u30b3\u30f3\u30d5\u30a3\u30b0\n\u30b3\u30f3\u30d5\u30a3\u30b0\u306fVyos\u3068\u307b\u307c\u540c\u3058\u3002\n\u305f\u3060port-forward\u5468\u308a\u304c\u5c11\u3057\u7279\u6b8a\uff1f\u306a\u69d8\u5b50\u3002\npppoe\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2offload\u306f\u8a2d\u5b9a\u3059\u308b\u3068\u3080\u3057\u308d\u9045\u304f\u306a\u308b\u3068\u3044\u3046\u8a71\u3082\u3042\u308b\u306e\u3067\u3001\u304a\u597d\u307f\u3067\u3002\nset firewall ipv6-name WANv6_IN default-action drop\nset firewall ipv6-name WANv6_IN description 'WAN to LAN'\nset firewall ipv6-name WANv6_IN enable-default-log\nset firewall ipv6-name WANv6_IN rule 10 action accept\nset firewall ipv6-name WANv6_IN rule 10 description 'Allow established/related'\nset firewall ipv6-name WANv6_IN rule 10 state established enable\nset firewall ipv6-name WANv6_IN rule 10 state related enable\nset firewall ipv6-name WANv6_IN rule 20 action drop\nset firewall ipv6-name WANv6_IN rule 20 description 'Drop invalid state'\nset firewall ipv6-name WANv6_IN rule 20 state invalid enable\nset firewall ipv6-name WANv6_IN rule 30 action accept\nset firewall ipv6-name WANv6_IN rule 30 description 'Allow IPv6 ICMP'\nset firewall ipv6-name WANv6_IN rule 30 protocol ipv6-icmp\nset firewall ipv6-name WANv6_LOCAL default-action drop\nset firewall ipv6-name WANv6_LOCAL description 'WAN to Router'\nset firewall ipv6-name WANv6_LOCAL enable-default-log\nset firewall ipv6-name WANv6_LOCAL rule 10 action accept\nset firewall ipv6-name WANv6_LOCAL rule 10 description 'Allow established/related'\nset firewall ipv6-name WANv6_LOCAL rule 10 state established enable\nset firewall ipv6-name WANv6_LOCAL rule 10 state related enable\nset firewall ipv6-name WANv6_LOCAL rule 20 action drop\nset firewall ipv6-name WANv6_LOCAL rule 20 description 'Drop invalid state'\nset firewall ipv6-name WANv6_LOCAL rule 20 state invalid enable\nset firewall ipv6-name WANv6_LOCAL rule 30 action accept\nset firewall ipv6-name WANv6_LOCAL rule 30 description 'Allow IPv6 ICMP'\nset firewall ipv6-name WANv6_LOCAL rule 30 protocol ipv6-icmp\nset firewall ipv6-name WANv6_LOCAL rule 40 action accept\nset firewall ipv6-name WANv6_LOCAL rule 40 description 'Allow DHCPv6'\nset firewall ipv6-name WANv6_LOCAL rule 40 destination port 546\nset firewall ipv6-name WANv6_LOCAL rule 40 protocol udp\nset firewall ipv6-name WANv6_LOCAL rule 40 source port 547\nset firewall ipv6-name WANv6_LOCAL rule 50 action accept\nset firewall ipv6-name WANv6_LOCAL rule 50 description 'Allow DS-Lite'\nset firewall ipv6-name WANv6_LOCAL rule 50 protocol ipip\n\n\nset firewall name WAN_IN default-action drop\nset firewall name WAN_IN description 'WAN to LAN'\nset firewall name WAN_IN rule 10 action accept\nset firewall name WAN_IN rule 10 description 'Allow established/related'\nset firewall name WAN_IN rule 10 state established enable\nset firewall name WAN_IN rule 10 state related enable\nset firewall name WAN_IN rule 20 action drop\nset firewall name WAN_IN rule 20 description 'Drop invalid state'\nset firewall name WAN_IN rule 20 state invalid enable\nset firewall name WAN_LOCAL default-action drop\nset firewall name WAN_LOCAL description 'WAN to Router'\nset firewall name WAN_LOCAL rule 10 action accept\nset firewall name WAN_LOCAL rule 10 description 'Allow established/related'\nset firewall name WAN_LOCAL rule 10 state established enable\nset firewall name WAN_LOCAL rule 10 state related enable\nset firewall name WAN_LOCAL rule 20 action drop\nset firewall name WAN_LOCAL rule 20 description 'Drop invalid state'\nset firewall name WAN_LOCAL rule 20 state invalid enable\n\n\nset firewall modify LAN_PBR rule 10 action modify\nset firewall modify LAN_PBR rule 10 description 'Traffic from DMZ'\nset firewall modify LAN_PBR rule 10 modify table 1\nset firewall modify LAN_PBR rule 10 source address 192.168.1.2-192.168.1.37\nset firewall modify LAN_PBR rule 20 action modify\nset firewall modify LAN_PBR rule 20 description 'Traffic from LAN'\nset firewall modify LAN_PBR rule 20 modify table 2\nset firewall modify LAN_PBR rule 20 source address 192.168.1.0/24\n\n\nset firewall options mss-clamp interface-type pppoe\nset firewall options mss-clamp mss 1414\n\n\nset interfaces ethernet eth0 address dhcp\nset interfaces ethernet eth0 duplex auto\nset interfaces ethernet eth0 speed auto\nset interfaces ethernet eth0 description WAN\n\n\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 host-address '::1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 prefix-id ':1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 service slaac\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 host-address '::1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 prefix-id ':2'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 service slaac\nset interfaces ethernet eth0 dhcpv6-pd pd 0 prefix-length /60\nset interfaces ethernet eth0 dhcpv6-pd rapid-commit enable\n\n\nset interfaces ethernet eth0 firewall in ipv6-name WANv6_IN\nset interfaces ethernet eth0 firewall in name WAN_IN\nset interfaces ethernet eth0 firewall local ipv6-name WANv6_LOCAL\nset interfaces ethernet eth0 firewall local name WAN_LOCAL\n\n\nset interfaces ethernet eth0 ipv6 address autoconf\nset interfaces ethernet eth0 ipv6 dup-addr-detect-transmits 1\nset interfaces ethernet eth0 ipv6 router-advert other-config-flag true\nset interfaces ethernet eth0 ipv6 router-advert send-advert true\n\n\nset interfaces ethernet eth0 pppoe 0 default-route auto\nset interfaces ethernet eth0 pppoe 0 description 'PPPoE IPv4'\nset interfaces ethernet eth0 pppoe 0 firewall in name WAN_IN\nset interfaces ethernet eth0 pppoe 0 firewall local name WAN_LOCAL\nset interfaces ethernet eth0 pppoe 0 mtu 1454\nset interfaces ethernet eth0 pppoe 0 name-server auto\nset interfaces ethernet eth0 pppoe 0 password <password>\nset interfaces ethernet eth0 pppoe 0 user-id <username>@iij.ad.jp\n\n\nset interfaces ethernet eth1 address 192.168.1.1/24\nset interfaces ethernet eth1 description LAN1\nset interfaces ethernet eth1 duplex auto\nset interfaces ethernet eth1 firewall in modify LAN_PBR\nset interfaces ethernet eth1 speed auto\n\n\nset interfaces ethernet eth2 address 192.168.2.1/24\nset interfaces ethernet eth2 description LAN2\nset interfaces ethernet eth2 duplex auto\nset interfaces ethernet eth2 speed auto\n\n\nset interfaces ipv6-tunnel v6tun0 encapsulation ipip6\nset interfaces ipv6-tunnel v6tun0 firewall in name WAN_IN\nset interfaces ipv6-tunnel v6tun0 local-ip <eth0 global ipv6>\nset interfaces ipv6-tunnel v6tun0 mtu 1500\nset interfaces ipv6-tunnel v6tun0 multicast disable\nset interfaces ipv6-tunnel v6tun0 remote-ip '2404:8e00::feed:100'\nset interfaces ipv6-tunnel v6tun0 ttl 64\n\n\nset port-forward auto-firewall enable\nset port-forward hairpin-nat enable\nset port-forward lan-interface eth1\nset port-forward rule 1 forward-to address 192.168.1.20\nset port-forward rule 1 forward-to port 80\nset port-forward rule 1 original-port 50080\nset port-forward rule 1 protocol tcp_udp\nset port-forward rule 2 forward-to address 192.168.1.20\nset port-forward rule 2 forward-to port 1932\nset port-forward rule 2 original-port 51932\nset port-forward rule 2 protocol tcp_udp\nset port-forward wan-interface pppoe0\n\n\nset protocols static interface-route 0.0.0.0/0 next-hop-interface v6tun0\nset protocols static table 1 interface-route 0.0.0.0/0 next-hop-interface pppoe0\nset protocols static table 2 interface-route 0.0.0.0/0 next-hop-interface v6tun0\n\n\nset service dhcp-server disabled false\nset service dhcp-server hostfile-update disable\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 default-router 192.168.1.1\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server 192.168.1.1\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 lease 86400\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 start 192.168.1.38 stop 192.168.1.243\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping 10 ip-address 192.168.1.10\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24\nstatic-mapping 10 mac-address <mac-address>\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping 20 ip-address 192.168.1.20\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24\nstatic-mapping 20 mac-address <mac-adress>\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 default-router 192.168.2.1\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 dns-server 192.168.2.1\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 lease 86400\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 start 192.168.2.38 stop 192.168.2.243\n\n\nset service dns forwarding cache-size 150\nset service dns forwarding listen-on eth1\nset service dns forwarding listen-on eth2\nset service dns forwarding name-server 202.232.2.3\nset service dns forwarding name-server 202.232.2.2\n\n\nset service nat rule 5010 description 'masquerade for WAN'\nset service nat rule 5010 outbound-interface pppoe0\nset service nat rule 5010 type masquerade\n\n\nset service upnp2 listen-on eth1\nset service upnp2 wan pppoe0\n\n\nset system time-zone Asia/Tokyo\n\n\nset system traffic-analysis dpi enable\nset system traffic-analysis export enable\n\n\nset system offload ipv4 forwarding enable\nset system offload ipv4 pppoe enable\nset system offload ipv6 forwarding enable\n\n\u3053\u306e\u305f\u3073[Edgerouter Lite-3](https://www.ubnt.com/edgemax/edgerouter-lite)\u3092\u5b89\u304f\u8cfc\u5165\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u3001IIJmio\u3072\u304b\u308a\u3067IPoE\u3092\u5951\u7d04\u3057\u3066DS-Lite\u3057\u3066\u307f\u305f\u3002  \nEdgerouter\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u306fEdgeOS\u3068\u8a00\u3063\u3066Vyos\u304b\u3089\u30d5\u30a9\u30fc\u30af\u3057\u305f\u3082\u306e\u3067\u3001\u3044\u304f\u3064\u304b\u72ec\u81ea\u4ed5\u69d8\u306e\u90e8\u5206\u3082\u3042\u308b\u3051\u308c\u3069IPv6\u307e\u308f\u308a\u306e\u307e\u3068\u307e\u3063\u305f\u8cc7\u6599\u3082\u306a\u304b\u3063\u305f\u306e\u3067\u6574\u7406\u304c\u3066\u3089\u6295\u7a3f\u3057\u3066\u307f\u308b\u3002  \n\u3061\u306a\u307f\u306bEdgeOS\u306f\u3064\u3044\u5148\u65e51.9.1\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u3070\u304b\u308a\u3067\u3001\u3053\u306e\u30ea\u30ea\u30fc\u30b9\u3067IPv6\u3067\u306eIPIP\u30c8\u30f3\u30cd\u30eb\u304c\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3060\u3002\u3061\u3087\u3046\u3069\u3044\u3044\u30bf\u30a4\u30df\u30f3\u30b0\u3060\u3063\u305f\u3002\n\n## \u69cb\u6210\nERL-3\u306eeth0\u3092WAN\u306b\u3001eth1\u3068eth2\u3092LAN\u306b\u8a2d\u5b9a\u3002 \neth1\u3068eth2\u3092\u30d6\u30ea\u30c3\u30b8\u3055\u305b\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u3088\u3046\u3060\u3051\u3069\u3001\u6027\u80fd\u304c\u5927\u304d\u304f\u4f4e\u4e0b\u3059\u308b\u305f\u3081\u4eca\u56de\u306f\u500b\u5225\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306b\u3057\u305f\u3002ER-x\u306a\u3089\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30b9\u30a4\u30c3\u30c1\u30f3\u30b0\u304c\u53ef\u80fd\u306a\u3088\u3046\u306a\u306e\u3067\u3001\u5fc5\u8981\u306a\u3089\u305d\u3061\u3089\u3067\u3002  \n\n\u5149\u30b3\u30e9\u30dc\u30ec\u30fc\u30b7\u30e7\u30f3\u4e8b\u696d\u8005\u3067\u3042\u308b\u3068\u3053\u308d\u306eIIJ\u304b\u3089\u8cb8\u4e0e\u3055\u308c\u305f\u3072\u304b\u308a\u96fb\u8a71\u30eb\u30fc\u30bf\u306fpr-500ki\u3002pr-500ki\u306eLAN\u30dd\u30fc\u30c8\u3068ERL-3\u306eeth0\u3092\u63a5\u7d9a\u3057\u3066\u304a\u304f\u3002\n\u307e\u305fpr-500ki\u306epppoe\u306f\u505c\u6b62\u3057\u3066\u3001pppoe\u30d6\u30ea\u30c3\u30b8\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n\u4eca\u56de\u306f\u3072\u304b\u308a\u96fb\u8a71\u5951\u7d04\u3042\u308a\u306a\u306e\u3067\u3001HGW\u304b\u3089\u306eRA\u3092\u3082\u3068\u306beth0\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306fautoconf\u3059\u308b\u3002\n\u307e\u305fDHCPv6-PD\u306b\u3088\u308aHGW\u306b\u306f/60\u306eprefix\u304c\n\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u3002\u3053\u308c\u3092/64\u306eprefix\u306b\u5206\u5272\u3057\u3066LAN\u5185\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306b\u5229\u7528\u3059\u308b\u3002\n\n## \u30b3\u30f3\u30d5\u30a3\u30b0\n\u30b3\u30f3\u30d5\u30a3\u30b0\u306fVyos\u3068\u307b\u307c\u540c\u3058\u3002\n\u305f\u3060`port-forward`\u5468\u308a\u304c\u5c11\u3057\u7279\u6b8a\uff1f\u306a\u69d8\u5b50\u3002\npppoe\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2offload\u306f\u8a2d\u5b9a\u3059\u308b\u3068\u3080\u3057\u308d\u9045\u304f\u306a\u308b\u3068\u3044\u3046\u8a71\u3082\u3042\u308b\u306e\u3067\u3001\u304a\u597d\u307f\u3067\u3002\n\n```\nset firewall ipv6-name WANv6_IN default-action drop\nset firewall ipv6-name WANv6_IN description 'WAN to LAN'\nset firewall ipv6-name WANv6_IN enable-default-log\nset firewall ipv6-name WANv6_IN rule 10 action accept\nset firewall ipv6-name WANv6_IN rule 10 description 'Allow established/related'\nset firewall ipv6-name WANv6_IN rule 10 state established enable\nset firewall ipv6-name WANv6_IN rule 10 state related enable\nset firewall ipv6-name WANv6_IN rule 20 action drop\nset firewall ipv6-name WANv6_IN rule 20 description 'Drop invalid state'\nset firewall ipv6-name WANv6_IN rule 20 state invalid enable\nset firewall ipv6-name WANv6_IN rule 30 action accept\nset firewall ipv6-name WANv6_IN rule 30 description 'Allow IPv6 ICMP'\nset firewall ipv6-name WANv6_IN rule 30 protocol ipv6-icmp\nset firewall ipv6-name WANv6_LOCAL default-action drop\nset firewall ipv6-name WANv6_LOCAL description 'WAN to Router'\nset firewall ipv6-name WANv6_LOCAL enable-default-log\nset firewall ipv6-name WANv6_LOCAL rule 10 action accept\nset firewall ipv6-name WANv6_LOCAL rule 10 description 'Allow established/related'\nset firewall ipv6-name WANv6_LOCAL rule 10 state established enable\nset firewall ipv6-name WANv6_LOCAL rule 10 state related enable\nset firewall ipv6-name WANv6_LOCAL rule 20 action drop\nset firewall ipv6-name WANv6_LOCAL rule 20 description 'Drop invalid state'\nset firewall ipv6-name WANv6_LOCAL rule 20 state invalid enable\nset firewall ipv6-name WANv6_LOCAL rule 30 action accept\nset firewall ipv6-name WANv6_LOCAL rule 30 description 'Allow IPv6 ICMP'\nset firewall ipv6-name WANv6_LOCAL rule 30 protocol ipv6-icmp\nset firewall ipv6-name WANv6_LOCAL rule 40 action accept\nset firewall ipv6-name WANv6_LOCAL rule 40 description 'Allow DHCPv6'\nset firewall ipv6-name WANv6_LOCAL rule 40 destination port 546\nset firewall ipv6-name WANv6_LOCAL rule 40 protocol udp\nset firewall ipv6-name WANv6_LOCAL rule 40 source port 547\nset firewall ipv6-name WANv6_LOCAL rule 50 action accept\nset firewall ipv6-name WANv6_LOCAL rule 50 description 'Allow DS-Lite'\nset firewall ipv6-name WANv6_LOCAL rule 50 protocol ipip\n\n\nset firewall name WAN_IN default-action drop\nset firewall name WAN_IN description 'WAN to LAN'\nset firewall name WAN_IN rule 10 action accept\nset firewall name WAN_IN rule 10 description 'Allow established/related'\nset firewall name WAN_IN rule 10 state established enable\nset firewall name WAN_IN rule 10 state related enable\nset firewall name WAN_IN rule 20 action drop\nset firewall name WAN_IN rule 20 description 'Drop invalid state'\nset firewall name WAN_IN rule 20 state invalid enable\nset firewall name WAN_LOCAL default-action drop\nset firewall name WAN_LOCAL description 'WAN to Router'\nset firewall name WAN_LOCAL rule 10 action accept\nset firewall name WAN_LOCAL rule 10 description 'Allow established/related'\nset firewall name WAN_LOCAL rule 10 state established enable\nset firewall name WAN_LOCAL rule 10 state related enable\nset firewall name WAN_LOCAL rule 20 action drop\nset firewall name WAN_LOCAL rule 20 description 'Drop invalid state'\nset firewall name WAN_LOCAL rule 20 state invalid enable\n\n\nset firewall modify LAN_PBR rule 10 action modify\nset firewall modify LAN_PBR rule 10 description 'Traffic from DMZ'\nset firewall modify LAN_PBR rule 10 modify table 1\nset firewall modify LAN_PBR rule 10 source address 192.168.1.2-192.168.1.37\nset firewall modify LAN_PBR rule 20 action modify\nset firewall modify LAN_PBR rule 20 description 'Traffic from LAN'\nset firewall modify LAN_PBR rule 20 modify table 2\nset firewall modify LAN_PBR rule 20 source address 192.168.1.0/24\n\n\nset firewall options mss-clamp interface-type pppoe\nset firewall options mss-clamp mss 1414\n\n\nset interfaces ethernet eth0 address dhcp\nset interfaces ethernet eth0 duplex auto\nset interfaces ethernet eth0 speed auto\nset interfaces ethernet eth0 description WAN\n\n\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 host-address '::1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 prefix-id ':1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth1 service slaac\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 host-address '::1'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 prefix-id ':2'\nset interfaces ethernet eth0 dhcpv6-pd pd 0 interface eth2 service slaac\nset interfaces ethernet eth0 dhcpv6-pd pd 0 prefix-length /60\nset interfaces ethernet eth0 dhcpv6-pd rapid-commit enable\n\n\nset interfaces ethernet eth0 firewall in ipv6-name WANv6_IN\nset interfaces ethernet eth0 firewall in name WAN_IN\nset interfaces ethernet eth0 firewall local ipv6-name WANv6_LOCAL\nset interfaces ethernet eth0 firewall local name WAN_LOCAL\n\n\nset interfaces ethernet eth0 ipv6 address autoconf\nset interfaces ethernet eth0 ipv6 dup-addr-detect-transmits 1\nset interfaces ethernet eth0 ipv6 router-advert other-config-flag true\nset interfaces ethernet eth0 ipv6 router-advert send-advert true\n\n\nset interfaces ethernet eth0 pppoe 0 default-route auto\nset interfaces ethernet eth0 pppoe 0 description 'PPPoE IPv4'\nset interfaces ethernet eth0 pppoe 0 firewall in name WAN_IN\nset interfaces ethernet eth0 pppoe 0 firewall local name WAN_LOCAL\nset interfaces ethernet eth0 pppoe 0 mtu 1454\nset interfaces ethernet eth0 pppoe 0 name-server auto\nset interfaces ethernet eth0 pppoe 0 password <password>\nset interfaces ethernet eth0 pppoe 0 user-id <username>@iij.ad.jp\n\n\nset interfaces ethernet eth1 address 192.168.1.1/24\nset interfaces ethernet eth1 description LAN1\nset interfaces ethernet eth1 duplex auto\nset interfaces ethernet eth1 firewall in modify LAN_PBR\nset interfaces ethernet eth1 speed auto\n\n\nset interfaces ethernet eth2 address 192.168.2.1/24\nset interfaces ethernet eth2 description LAN2\nset interfaces ethernet eth2 duplex auto\nset interfaces ethernet eth2 speed auto\n\n\nset interfaces ipv6-tunnel v6tun0 encapsulation ipip6\nset interfaces ipv6-tunnel v6tun0 firewall in name WAN_IN\nset interfaces ipv6-tunnel v6tun0 local-ip <eth0 global ipv6>\nset interfaces ipv6-tunnel v6tun0 mtu 1500\nset interfaces ipv6-tunnel v6tun0 multicast disable\nset interfaces ipv6-tunnel v6tun0 remote-ip '2404:8e00::feed:100'\nset interfaces ipv6-tunnel v6tun0 ttl 64\n\n\nset port-forward auto-firewall enable\nset port-forward hairpin-nat enable\nset port-forward lan-interface eth1\nset port-forward rule 1 forward-to address 192.168.1.20\nset port-forward rule 1 forward-to port 80\nset port-forward rule 1 original-port 50080\nset port-forward rule 1 protocol tcp_udp\nset port-forward rule 2 forward-to address 192.168.1.20\nset port-forward rule 2 forward-to port 1932\nset port-forward rule 2 original-port 51932\nset port-forward rule 2 protocol tcp_udp\nset port-forward wan-interface pppoe0\n\n\nset protocols static interface-route 0.0.0.0/0 next-hop-interface v6tun0\nset protocols static table 1 interface-route 0.0.0.0/0 next-hop-interface pppoe0\nset protocols static table 2 interface-route 0.0.0.0/0 next-hop-interface v6tun0\n\n\nset service dhcp-server disabled false\nset service dhcp-server hostfile-update disable\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 default-router 192.168.1.1\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server 192.168.1.1\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 lease 86400\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 start 192.168.1.38 stop 192.168.1.243\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping 10 ip-address 192.168.1.10\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24\nstatic-mapping 10 mac-address <mac-address>\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping 20 ip-address 192.168.1.20\nset service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24\nstatic-mapping 20 mac-address <mac-adress>\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 default-router 192.168.2.1\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 dns-server 192.168.2.1\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 lease 86400\nset service dhcp-server shared-network-name LAN2 subnet 192.168.2.0/24 start 192.168.2.38 stop 192.168.2.243\n\n\nset service dns forwarding cache-size 150\nset service dns forwarding listen-on eth1\nset service dns forwarding listen-on eth2\nset service dns forwarding name-server 202.232.2.3\nset service dns forwarding name-server 202.232.2.2\n\n\nset service nat rule 5010 description 'masquerade for WAN'\nset service nat rule 5010 outbound-interface pppoe0\nset service nat rule 5010 type masquerade\n\n\nset service upnp2 listen-on eth1\nset service upnp2 wan pppoe0\n\n\nset system time-zone Asia/Tokyo\n\n\nset system traffic-analysis dpi enable\nset system traffic-analysis export enable\n\n\nset system offload ipv4 forwarding enable\nset system offload ipv4 pppoe enable\nset system offload ipv6 forwarding enable\n```\n", "tags": ["Network", "DSLite"]}