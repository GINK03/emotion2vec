{"context": " More than 1 year has passed since last update.\u30e1\u30e2\u3067\u3059\u3002\n\nScript\n#!/bin/bash\n\nip_addr=\"\"\npasswd=\"\"\n\ncurl=$(which curl)\nlcurl=\"\"\n\ncookie_file=\"cookie\"\n\nvps_init() {\n\n  if [ -z $ip_addr ]; then\n    echo -n \"IP Addr: \"\n    read ip_addr\n  fi\n\n  if [ -z $passwd ]; then\n    echo -n \"Password \"\n    stty -echo\n    read passwd\n    stty echo\n  fi\n\n  echo -e \"\\n\"\n}\n\nlogin() {\n  vps_init\n  url=\"https://secure.sakura.ad.jp/vpscontrol/\"\n  token=$($curl -L $url | grep Token | sed -e 's/.* value=\"\\(.*\\)\".*/\\1/g')\n\n  $curl -L -c $cookie_file \\\n      -F \"Submit=index\" \\\n      -F \"Token=$token\" \\\n      -F \"ipaddress=$ip_addr\" \\\n      -F \"password=$passwd\" \\\n      $url > /dev/null\n\n  if [ ! -e $cookie_file ]; then\n    echo \"Login failure.\"\n    finish -1\n  fi\n\n  name=$(cat $cookie_file | grep secure.sakura.ad.jp  |awk '{print $6}')\n  val=$(cat $cookie_file | grep secure.sakura.ad.jp  |awk '{print $7}')\n\n\n\n  lcurl=\"eval $curl -L -b \\\"$name=$val\\\"\"\n\n}\n\ngenerate_config() {\n  url=\"https://secure.sakura.ad.jp/vpscontrol/main/\"\n\n  tmp=$($lcurl \\\n      -F \"Token=$token\" \\\n      $url | egrep \"[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\" | sed -e \"s/[^0-9\\.,]//g\" | tr ',' ' ')\n\n  ip=$(echo $tmp | awk '{print $1}')\n  gateway=$(echo $tmp | awk '{print $3}')\n  dns1=$(echo $tmp | awk '{print $4}')\n  dns2=$(echo $tmp | awk '{print $5}')\n  cat <<EOF > ./vps-config\n#VPS Config\nVPS_IP=\"$ip/23\"\nVPS_GATEWAY=\"$gateway\"\nVPS_DNS1=\"$dns1\"\nVPS_DNS2=\"$dns2\"\nEOF\n\n\n}\n\nfinish() {\n\n  rm -f $cookie_file\n\n  exit $1\n}\n\nmain() {\n  login\n  generate_config\n  finish 0\n}\n\nmain\n\n\u30e1\u30e2\u3067\u3059\u3002\n\n#Script\n```shell-session\n#!/bin/bash\n\nip_addr=\"\"\npasswd=\"\"\n\ncurl=$(which curl)\nlcurl=\"\"\n\ncookie_file=\"cookie\"\n\nvps_init() {\n\n  if [ -z $ip_addr ]; then\n    echo -n \"IP Addr: \"\n    read ip_addr\n  fi\n\n  if [ -z $passwd ]; then\n    echo -n \"Password \"\n    stty -echo\n    read passwd\n    stty echo\n  fi\n\n  echo -e \"\\n\"\n}\n\nlogin() {\n  vps_init\n  url=\"https://secure.sakura.ad.jp/vpscontrol/\"\n  token=$($curl -L $url | grep Token | sed -e 's/.* value=\"\\(.*\\)\".*/\\1/g')\n  \n  $curl -L -c $cookie_file \\\n      -F \"Submit=index\" \\\n      -F \"Token=$token\" \\\n      -F \"ipaddress=$ip_addr\" \\\n      -F \"password=$passwd\" \\\n      $url > /dev/null\n\n  if [ ! -e $cookie_file ]; then\n    echo \"Login failure.\"\n    finish -1\n  fi\n\n  name=$(cat $cookie_file | grep secure.sakura.ad.jp  |awk '{print $6}')\n  val=$(cat $cookie_file | grep secure.sakura.ad.jp  |awk '{print $7}')\n\n  \n\n  lcurl=\"eval $curl -L -b \\\"$name=$val\\\"\"\n\n}\n\ngenerate_config() {\n  url=\"https://secure.sakura.ad.jp/vpscontrol/main/\"\n\n  tmp=$($lcurl \\\n      -F \"Token=$token\" \\\n      $url | egrep \"[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+\" | sed -e \"s/[^0-9\\.,]//g\" | tr ',' ' ')\n\n  ip=$(echo $tmp | awk '{print $1}')\n  gateway=$(echo $tmp | awk '{print $3}')\n  dns1=$(echo $tmp | awk '{print $4}')\n  dns2=$(echo $tmp | awk '{print $5}')\n  cat <<EOF > ./vps-config\n#VPS Config\nVPS_IP=\"$ip/23\"\nVPS_GATEWAY=\"$gateway\"\nVPS_DNS1=\"$dns1\"\nVPS_DNS2=\"$dns2\"\nEOF\n  \n\n}\n\nfinish() {\n\n  rm -f $cookie_file\n\n  exit $1\n}\n\nmain() {\n  login\n  generate_config\n  finish 0\n}\n\nmain\n```\n", "tags": ["\u3055\u304f\u3089VPS"]}