{"tags": ["SoftLayer", "openstack"], "context": " More than 1 year has passed since last update.\u524d\u56de\u306f\u3053\u3061\u3089 - \u6b21\u56de\u306f\u3053\u3061\u3089\n\n\n\u3053\u308c\u306f\u306a\u306b\n\u300cOpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580\u300d\u306e\u5b9f\u7fd2\u3092SoftLayer\u306e\u7121\u6599\u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u884c\u3046\u8a18\u9332\u3067\u3042\u308b\u3002\n\n\n\u7b2c12\u7ae0 Fog\u3092\u4f7f\u3063\u305f\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u3078\u306e\u30b7\u30b9\u30c6\u30e0\u5c55\u958b\n\u5f53\u7ae0\u3067\u306fFog\u3068Chef\u3092\u5229\u7528\u3057OpenStack\u3068AWS\u306e\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\u5f53\u7ae0\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u3061\u3089\u3002\n\n12.1 \u30b7\u30b9\u30c6\u30e0\u81ea\u52d5\u5c55\u958b\u306e\u6982\u8981\n\u7b2c11\u7ae0\u306eAnsible\u306e\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u3067\u306fOpenStack\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u306b\u306f\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u3088\u306d\u3001\u3068\u3044\u3046\u8a71\u3002\n\n12.2 \u81ea\u52d5\u5c55\u958b\u306e\u5185\u90e8\u52d5\u4f5c\n\u81ea\u52d5\u5c55\u958b\u306b\u306f\u5927\u304d\u304f\u5206\u3051\u3066\u3001(1)\u30a4\u30f3\u30d5\u30e9\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u3001(2)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3068\u3044\u30462\u3064\u306e\u30b9\u30c6\u30c3\u30d7\u304c\u3042\u308b\u3002(1)\u306f\u30af\u30e9\u30a6\u30c9\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3067\u30af\u30e9\u30a6\u30c9\u6bce\u306b\u7570\u306a\u308bAPI\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001(2)\u306fOS\u3078\u306e\u64cd\u4f5c\u306a\u306e\u3067\u5171\u901a\u3067\u3042\u308aChef\u3001Ansible\u3001Puppet\u3068\u304b\u306e\u30c4\u30fc\u30eb\u3067\u81ea\u52d5\u5316\u53ef\u80fd\u3067\u3042\u308b\u3002\n\u3053\u306e\u7ae0\u3067\u306f(1)\u3092Fog\u3067\u3001(2)\u3092Chef\u3067\u81ea\u52d5\u5316\u3059\u308b\u3002\u8a71\u306e\u4e2d\u5fc3\u306f\u3082\u3061\u308d\u3093(1)\u3002\n\n12.3 Fog\u306b\u3064\u3044\u3066\nFog\u306f\u30af\u30e9\u30a6\u30c9\u64cd\u4f5c\u7528\u306eRuby\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30fc\u3002AWS\u3067\u3082OpenStack\u3067\u3082Fog::Compute.new\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f5c\u6210\u3067\u304d\u308b\u304c\u3001\u6e21\u3059\u5f15\u6570\u304c\u9055\u3044\u5358\u7d14\u306b\u5171\u901a\u5316\u3067\u304d\u308b\u3082\u306e\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u8a71\u3002\n\n12.4 \u4e8b\u524d\u6e96\u5099\n\n12.4.1 \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u306e\u6e96\u5099\nOpenStack\u306f\u5f53\u7136\u3053\u308c\u307e\u3067\u4f7f\u3063\u3066\u304d\u305f\u3082\u306e\u3092\u5229\u7528\u3059\u308b\u3002AWS\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u3064\u304f\u308a\u3001CentOS 6 x86_64 - with Updates HVM\u3092\u30de\u30fc\u30b1\u30c3\u30c8\u30d7\u30ec\u30fc\u30b9\u3067\u8cfc\u5165\u3057\u3066\u304a\u304f\u3002\n\n12.4.2 \u524d\u63d0\u74b0\u5883\u306e\u69cb\u7bc9\n\u307e\u305a\u3001OpenStack\u5074\u306e\u6e96\u5099\u3002\u624b\u9806\u306f\u3053\u3061\u3089\n\u30ad\u30fc\u30da\u30a2key-openstack\u3092\u4f5c\u308b\u3002\n[root@step-server ~]# nova keypair-add key-openstack | tee key-openstack.pem\n-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA6O4FWIoi1oQ7XVn2ysvH0NNmhU48MpmB5MGua7zI0b93uinZ\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n\n[root@step-server ~]# chmod 600 key-openstack.pem\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30affog-net\u3092192.168.1.0/24\u3067\u4f5c\u6210\u3059\u308b\u3002\n[root@step-server ~]# neutron net-create fog-net\nCreated a new network:\n+-----------------+--------------------------------------+\n| Field           | Value                                |\n+-----------------+--------------------------------------+\n| admin_state_up  | True                                 |\n| id              | 2d6b7733-8381-4ca1-8de5-a47d3054a088 |\n| name            | fog-net                              |\n| router:external | False                                |\n| shared          | False                                |\n| status          | ACTIVE                               |\n| subnets         |                                      |\n| tenant_id       | 106e169743964758bcad1f06cc69c472     |\n+-----------------+--------------------------------------+\n\n[root@step-server ~]# neutron subnet-create --ip-version 4 --gateway 192.168.1.254 \\\n> --name fog-subnet fog-net 192.168.1.0/24\nCreated a new subnet:\n+-------------------+--------------------------------------------------+\n| Field             | Value                                            |\n+-------------------+--------------------------------------------------+\n| allocation_pools  | {\"start\": \"192.168.1.1\", \"end\": \"192.168.1.253\"} |\n| cidr              | 192.168.1.0/24                                   |\n| dns_nameservers   |                                                  |\n| enable_dhcp       | True                                             |\n| gateway_ip        | 192.168.1.254                                    |\n| host_routes       |                                                  |\n| id                | 199d8419-1f7a-4959-ae3c-0ab4370464c7             |\n| ip_version        | 4                                                |\n| ipv6_address_mode |                                                  |\n| ipv6_ra_mode      |                                                  |\n| name              | fog-subnet                                       |\n| network_id        | 2d6b7733-8381-4ca1-8de5-a47d3054a088             |\n| tenant_id         | 106e169743964758bcad1f06cc69c472                 |\n+-------------------+--------------------------------------------------+\n\n[root@step-server ~]# neutron router-interface-add Ext-Router fog-subnet\nAdded interface 7fab4d8b-c854-42b4-8ce1-0a3330c9b55f to router Ext-Router.\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7sg-for-fog\u3092\u4f5c\u308a\u3001\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3002\n[root@step-server ~]# neutron security-group-create sg-for-fog\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe                                                                                                                                                                                                                                                                                          |\n| name                 | sg-for-fog                                                                                                                                                                                                                                                                                                                    |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"3b3b7311-f5ec-44c3-a4a4-d567ef515568\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"6d612c19-d6cb-40e2-9558-5794937cb6df\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol tcp \\\n>   --port-range-min 22 --port-range-max 22 \\\n>   --remote-ip-prefix 0.0.0.0/0 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 8479bc21-449e-4a98-8715-3a4ea7e696ff |\n| port_range_max    | 22                                   |\n| port_range_min    | 22                                   |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol icmp \\\n>   --remote-ip-prefix 0.0.0.0/0 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 6794a260-43a1-4683-8877-8cce01c1f4af |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol icmp \\\n>   --remote-ip-prefix 192.168.1.0/24 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 2ab010d1-39a3-4ae0-b786-4a8c586a6963 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 192.168.1.0/24                       |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol tcp \\\n>   --remote-ip-prefix 192.168.1.0/24 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b3cf5963-4815-4552-8250-f8f3382bb9e9 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 192.168.1.0/24                       |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\ncentos-base\u30a4\u30e1\u30fc\u30b8\u306eUUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@step-server ~]# nova image-list\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n| ID                                   | Name                     | Status | Server                               |\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n| 098f948e-e80b-4b1a-8a46-f8d2dd57e149 | centos-base              | ACTIVE |                                      |\n| 39fb3a6e-e543-4bfe-8ff7-a948acd1c7a3 | cirros-0.3.3-x86_64-disk | ACTIVE |                                      |\n| 362ae42a-1e46-4de4-afd9-af57965f1b3f | web-base-v1.0            | ACTIVE | d0ce0d2a-f4fa-448d-bb9b-b605af386b9f |\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n\n\u6b21\u306bAWS\u3067\u306e\u6e96\u5099\u4f5c\u696d\u3002\u4eca\u56de\u306f\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3(ap-northeast-1)\u3067\u4f5c\u696d\u3092\u3059\u308b\u3002\nEC2\u306e\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30ad\u30fc\u30da\u30a2key-aws\u3092\u4f5c\u308a\u3001\u79d8\u5bc6\u9375\u3092key-aws.pem\u3067\u4fdd\u5b58\u3059\u308b\u3002\nVPC\u3067fog-vpc\u3092192.168.0.0/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u4f5c\u308a\u3001Public\u3092192.168.1.0/24\u306b\u3059\u308b\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7 sg_for_fog \u3092\u4f5c\u6210\u3057\u30eb\u30fc\u30eb\u3092\u3064\u3051\u308b\u3002\nCentOS\u306e\u30a4\u30e1\u30fc\u30b8ID\u3092\u78ba\u8a8d\u3059\u308b\u3002Asia Pacific (Tokyo) \u306e CentOS 6 \u306fami-13614b12 \u3067\u672c\u66f8\u304b\u3089\u5909\u308f\u3089\u305a\u3002\n\n12.4.3 Fog\u30b5\u30fc\u30d0\u30fc\u306e\u69cb\u7bc9\nOpenStack\u306bFog\u7528\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u308b\u3002\u3053\u308c\u307e\u3067\u3068\u9055\u3044\u30d5\u30ec\u30fc\u30d0\u30fc\u304c standard.medium\u3002\n[root@step-server ~]# get_uuid () { cat - | grep \" id \" | awk '{print $4}'; }\n[root@step-server ~]# MY_FOG_NET=`neutron net-show fog-net | get_uuid`\n[root@step-server ~]# echo $MY_FOG_NET\n2d6b7733-8381-4ca1-8de5-a47d3054a088\n[root@step-server ~]# nova boot \\\n>   --image centos-base \\\n>   --key-name key-openstack \\\n>   --flavor standard.medium \\\n>   --nic net-id=$MY_FOG_NET \\\n>   --security-groups sg-for-fog \\\n>   --availability-zone az1 \\\n>   fog-server\n+--------------------------------------+----------------------------------------------------+\n| Property                             | Value                                              |\n+--------------------------------------+----------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                             |\n| OS-EXT-AZ:availability_zone          | nova                                               |\n| OS-EXT-STS:power_state               | 0                                                  |\n| OS-EXT-STS:task_state                | scheduling                                         |\n| OS-EXT-STS:vm_state                  | building                                           |\n| OS-SRV-USG:launched_at               | -                                                  |\n| OS-SRV-USG:terminated_at             | -                                                  |\n| accessIPv4                           |                                                    |\n| accessIPv6                           |                                                    |\n| adminPass                            | SE8gXSae2YmG                                       |\n| config_drive                         |                                                    |\n| created                              | 2015-03-31T04:17:20Z                               |\n| flavor                               | standard.medium (102)                              |\n| hostId                               |                                                    |\n| id                                   | d6a19009-7a64-42e6-8b75-9975191583eb               |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149) |\n| key_name                             | key-openstack                                      |\n| metadata                             | {}                                                 |\n| name                                 | fog-server                                         |\n| os-extended-volumes:volumes_attached | []                                                 |\n| progress                             | 0                                                  |\n| security_groups                      | sg-for-fog                                         |\n| status                               | BUILD                                              |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                   |\n| updated                              | 2015-03-31T04:17:20Z                               |\n| user_id                              | 98dd78b670884b64b879568215777c53                   |\n+--------------------------------------+----------------------------------------------------+\n\n[root@step-server ~]# FIP=`nova floating-ip-create Ext-Net | awk -F '|' '{print $2,$4}' | awk '{if ($2 == \"-\") print $1;}'`\n\n[root@step-server ~]# nova floating-ip-associate fog-server $FIP\n\n[root@step-server ~]# nova list --field name,networks\n+--------------------------------------+-------------+--------------------------------------+\n| ID                                   | Name        | Networks                             |\n+--------------------------------------+-------------+--------------------------------------+\n| d6a19009-7a64-42e6-8b75-9975191583eb | fog-server  | fog-net=192.168.1.1, 192.168.100.136 |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | work-net=10.0.0.1, 192.168.100.131   |\n+--------------------------------------+-------------+--------------------------------------+\n\nAWS\u306b\u3082\u6307\u793a\u306b\u3042\u308b\u3088\u3046\u306bFog\u7528\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u308b\u3002\n\u672c\u66f8\u306b\u306f\u300ct2.medium\u300d\u3067\u7acb\u3066\u308b\u3088\u3046\u306b\u3042\u308b\u3051\u308c\u3069\u300ct2.micro\u300d\u306a\u3089750\u6642\u9593\u307e\u3067\u7121\u6599\u306a\u306e\u3067\u300ct2.micro\u300d\u3067\u7acb\u3066\u3066\u307f\u308b\u3002\u3053\u308c\u3067\u5f8c\u3067\u82e6\u52b4\u3059\u308b\u3002\n\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u3092git clone\u3057\u3066\u3001\u5c0e\u5165\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6d41\u3059\u3002\n[root@step-server ~]# ssh -i key-openstack.pem root@192.168.100.136\n\n[root@fog-server ~]# yum -y install git\n\n[root@fog-server ~]# git clone https://github.com/josug-book1-materials/chapter12.git\n\n[root@fog-server ~]# sh chapter12/install_fog_chef.sh\n\nOpenStack\u3067\u306f\u6210\u529f\u3057\u305f\u5c0e\u5165\u30b9\u30af\u30ea\u30d7\u30c8\u304cAWS\u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002\u8abf\u3079\u3066\u307f\u308b\u3068 berkshelf \u306e\u4f9d\u5b58\u5148\u306e dep-selector-libgecode \u304c\u5c0e\u5165\u3055\u308c\u308b\u6642\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u8d70\u308a\u3001\u30e1\u30e2\u30ea\u30fc\u3092\u30d0\u30ab\u98df\u3044\u3057\u3066\u843d\u3061\u308b\u3089\u3057\u3044\u3002\n\u3053\u308c\u304c\u3001\u30e1\u30e2\u30ea\u30fc\u304c4GB\u306e\u300ct2.medium\u300d\u3092\u4f7f\u3046\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u308b\u7406\u7531\u306e\u3088\u3046\u3060\u3002\n\u3053\u306e\u304f\u3089\u3044\u3001\u8ab2\u91d1\u3059\u308b\u304b\u3068\u601d\u3063\u305f\u304c\u300cberkshelf\u306fAWS\u306emicro\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30d3\u30eb\u30c9\u51fa\u6765\u308b\u300d\u3092\u898b\u3064\u3051\u305f\u3002\u3053\u308c\u3067\u3001\u5148\u306b dep-selector-libgecode \u3092\u5c0e\u5165\u3057\u3066\u304a\u304f\u3002\nSuccessfully installed dep-selector-libgecode-1.0.2\n1 gem installed\n\n\u5165\u3063\u305f\uff01\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u5c0e\u5165\u30b7\u30a7\u30eb\u3092\u518d\u5b9f\u884c\u3059\u308b\u3002\u4eca\u5ea6\u306f\u5c0e\u5165\u304c\u5b8c\u4e86\u3057\u305f\u3002\n[root@ip-192-168-1-130 ~]# sh chapter12/install_fog_chef.sh\nUpdating all packages (it takes some time ...)\nInstalling ruby\nPackage flex-2.5.35-9.el6.x86_64 already installed and latest version\nPackage gcc-4.4.7-11.el6.x86_64 already installed and latest version\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nVendoring yum (3.5.3) to cookbooks/yum\nVendoring yum-epel (0.6.0) to cookbooks/yum-epel\nVendoring yum-mysql-community (0.1.16) to cookbooks/yum-mysql-community\n##### Building environment completed #####\n\n\n\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u30b3\u30de\u30f3\u30c9\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066reboot\u3002\n[root@ip-192-168-1-130 ~]# SU - FOG\n-bash: SU: command not found\n[root@ip-192-168-1-130 ~]# su - fog\n[fog@ip-192-168-1-130 ~]$ wchi fog\n-bash: wchi: command not found\n[fog@ip-192-168-1-130 ~]$ which fog\n/usr/bin/fog\n[fog@ip-192-168-1-130 ~]$ which chef-zero\n/usr/bin/chef-zero\n[fog@ip-192-168-1-130 ~]$ exit\nlogout\n[root@ip-192-168-1-130 ~]# reboot\n\n\n12.5 \u30de\u30eb\u30c1\u30af\u30e9\u30a4\u30c9\u3078\u306e\u30b7\u30b9\u30c6\u30e0\u5c55\u958b\n\n12.5.1 OpenStack\u3078\u306e\u5c55\u958b\n\u30e6\u30fc\u30b6\u30fcfog\u304cfog\u30b5\u30fc\u30d0\u30fc\u3067\u79d8\u5bc6\u9375\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6e96\u5099\u3059\u308b\u3002\n[root@step-server ~]# scp -i key-openstack.pem key-openstack.pem root@192.168.100.136:/home/fog/key-openstack.pem\nkey-openstack.pem                                                                   100% 1676     1.6KB/s   00:00\n[root@step-server ~]# ssh -i key-openstack.pem root@192.168.100.136\n[root@fog-server ~]# chown fog:fog /home/fog/key-openstack.pem\n[root@fog-server ~]# chmod 600 /home/fog/key-openstack.pem\n[root@fog-server ~]# ls -l /home/fog/key-openstack.pem\n\n\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb fogrc \u3092\u8aad\u307f\u8fbc\u3080\u3002\n[fog@fog-server ~]$ cat chapter12/etc/fogrc\n# OpenStack\nexport OS_AUTH_URL='http://192.168.100.10:5000/v2.0/'\nexport OS_USERNAME='snsapp-infra-user'\nexport OS_PASSWORD='passw0rd'\nexport OS_TENANT_NAME='SNSApp'\nexport OS_REGION_NAME='RegionOne'\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n\n[fog@fog-server ~]$ source chapter12/etc/fogrc\n\nOpenStack\u74b0\u5883\u7528\u306eyaml\u3092\u4eca\u56de\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u306f\u3001\u74b0\u5883\u56fa\u6709\u306eUUID\u306e\u90e8\u5206\u3067\u3042\u308b\u3002\nimage id   : 098f948e-e80b-4b1a-8a46-f8d2dd57e149\nnetwork id : 2d6b7733-8381-4ca1-8de5-a47d3054a088\n[fog@fog-server ~]$ sed -e 's/84ab092f-8e0a-42ba-a820-51fc40d07e72/098f948e-e80b-4b1a-8a46-f8d2dd57e149/g' chapter12/etc/openstack.yaml > chapter12/etc/openstack-1.yaml\n\n[fog@fog-server ~]$ sed -e 's/9ef02f9c-cff0-40b8-a25d-1ecd9e9a7694/2d6b7733-8381-4ca1-8de5-a47d3054a088/g' chapter12/etc/openstack-1.yaml > chapter12/etc/openstack-2.yaml\n\n\u66f8\u304d\u63db\u3048\u5f8c\u306e openstack-2.yaml \u3092\u6307\u5b9a\u3057\u3066 create_server.rb \u3092\u5b9f\u884c\u3059\u308b\u3002\n[fog@fog-server ~]$ cd chapter12/\n[fog@fog-server chapter12]$ ruby create_server.rb etc/openstack-2.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\n - provider: Openstack\n   name: db1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: db\n   ip_address: 192.168.1.3\n - provider: Openstack\n   name: web1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: web\n   ip_address: 192.168.1.4\n - provider: Openstack\n   name: web2\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: web\n   ip_address: 192.168.1.5\n - provider: Openstack\n   name: app1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: app\n   ip_address: 192.168.1.6\n - provider: Openstack\n   name: lb1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: lb\n   ip_address: 192.168.1.7\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n[root@step-server ~]# nova list --field name,networks\n+--------------------------------------+-------------+--------------------------------------+\n| ID                                   | Name        | Networks                             |\n+--------------------------------------+-------------+--------------------------------------+\n| 94b26056-af33-410e-84fc-93a0b4914f9b | app1        | fog-net=192.168.1.6                  |\n| a695dc3c-c1f8-4c60-82ee-a8e4ffc6aae6 | db1         | fog-net=192.168.1.3                  |\n| d6a19009-7a64-42e6-8b75-9975191583eb | fog-server  | fog-net=192.168.1.1, 192.168.100.136 |\n| 75f7b5ea-5fcf-4da2-9824-484dbdf6fd7a | lb1         | fog-net=192.168.1.7                  |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | work-net=10.0.0.1, 192.168.100.131   |\n| 805c81e9-23d9-4879-be49-31907f546165 | web1        | fog-net=192.168.1.4                  |\n| c056b4a0-ac8f-4057-956f-d2f7def1b832 | web2        | fog-net=192.168.1.5                  |\n+--------------------------------------+-------------+--------------------------------------+\n\n\n12.5.2 AWS\u3078\u306e\u5c55\u958b\nAWS\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u79d8\u5bc6\u9375\u3092\u8ee2\u9001\u3057\u30e6\u30fc\u30b6\u30fcfog\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6a29\u9650\u3092\u4e0e\u3048\u308b\u3002\n[root@ip-192-168-1-130 ~]# chown fog:fog /home/fog/key-aws.pem\n[root@ip-192-168-1-130 ~]# chmod 600 /home/fog/key-aws.pem\n[root@ip-192-168-1-130 ~]# ls -l /home/fog/key-openstack.pem\n\nAPI\u3092\u4f7f\u3046\u306e\u3067IAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002Access Key Id\u3068Secret Access Key\u3092\u5165\u624b\u3059\u308b\u3002\n\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306b AmazonEC2FullAccess \u306ePolicy\u3092\u4e0e\u3048\u305f\u3002\n\n\u300cchapter12/etc/fogrc\u300d\u306bIAM\u306eAccess Key Id\u3068Secret Access Key\u3092\u8a2d\u5b9a\u3057\u3066\u3001\u8aad\u307f\u8fbc\u3093\u3067\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n[fog@ip-192-168-1-130 ~]$ vi chapter12/etc/fogrc\n\n# AWS\nexport AWS_ACCESS_KEY_ID='AKIXXXXXXXXXXXXXXXXX'\nexport AWS_SECRET_ACCESS_KEY='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nexport AWS_REGION='ap-northeast-1'\n\n[fog@ip-192-168-1-130 ~]$ source chapter12/etc/fogrc\n\nAWS\u7528\u306eyaml\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\u3002\u672c\u66f8\u3069\u304a\u308a\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308c\u3070\u3001\u5909\u66f4\u304c\u5fc5\u8981\u306a\u306e\u306f network_id \u3050\u3089\u3044\u3002\n[fog@ip-192-168-1-130 ~]$ vi chapter12/etc/aws.yaml\n\n- provider: AWS\n  name: db1\n  flavor: t2.micro\n  image_id: ami-13614b12\n  key_name: key-aws\n  key_file: /home/fog/key-aws.pem\n  network_id: subnet-abcdefgh\n  security_groups:\n    - sg_for_fog\n  role: db\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n\nyaml\u3092\u6307\u5b9a\u3057\u3066create_server.rb\u3092\u5b9f\u884c\u3059\u308b\u3002\n[fog@ip-192-168-1-130 ~]$ cd chapter12/\n[fog@ip-192-168-1-130 chapter12]$ ruby create_server.rb etc/aws.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\n - provider: Aws\n   name: db1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: db\n   ip_address: 192.168.1.208\n - provider: Aws\n   name: web1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: web\n   ip_address: 192.168.1.131\n - provider: Aws\n   name: web2\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: web\n   ip_address: 192.168.1.114\n - provider: Aws\n   name: app1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: app\n   ip_address: 192.168.1.16\n - provider: Aws\n   name: lb1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: lb\n   ip_address: 192.168.1.56\n\n5\u53f0\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u8d77\u52d5\u3057\u305f\u3002\n\n\u540c\u3058\u30b9\u30af\u30ea\u30d7\u30c8\u306bOpenStack\u7528\u30fbAWS\u7528\u3068\u4e0e\u3048\u308byaml\u3092\u5909\u3048\u308b\u3060\u3051\u3067\u5225\u306e\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306b\u540c\u69d8\u306e\u5c55\u958b\u304c\u51fa\u6765\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n12.6 \u5185\u90e8\u52d5\u4f5c\u306e\u7d39\u4ecb\n\u5b9f\u884c\u3057\u305fFog\u30b3\u30fc\u30c9\u306e\u89e3\u8aac\u306e\u7bc0\u3067\u3042\u308b\u3002\u307e\u3058\u3081\u306b\u8aad\u3082\u3046\u3002\n\n12.7 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5c0e\u5165\u3092\u542b\u3081\u305f\u81ea\u52d5\u5316\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3068\u3001\u3055\u3089\u306b\u305d\u306e\u5f8c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5c0e\u5165\u3092Chef\u3067\u81ea\u52d5\u5316\u3057\u3066\u3044\u308b\u3002\n\u4e8b\u524d\u306b12.6\u3067\u4f5c\u6210\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u3092\u524a\u9664\u3057\u3066\u304a\u304f\u3002\ndeploy_app.rb \u3092 yaml \u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3002\u4e0b\u8a18\u306fOpenStack\u306e\u4f8b\u3060\u304b\u3001AWS\u306a\u3089\u5f53\u7136 aws.yaml \u3092\u6307\u5b9a\u3002\n[fog@fog-server chapter12]$ ruby deploy_app.rb etc/openstack-2.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\nwaiting icmp session to db1\nwaiting icmp session to db1\nwaiting icmp session to db1\nI found icmp session to db1\nI found icmp session to web1\nwaiting icmp session to web2\nI found icmp session to web2\nI found icmp session to app1\nI found icmp session to lb1\ncookbooks uploaded.\nroles uploaded.\ndeploy finished => db1\ncheck logfile => more /tmp/db1_bootstrap.log\ndeploy finished => web1\ncheck logfile => more /tmp/web1_bootstrap.log\ndeploy finished => web2\ncheck logfile => more /tmp/web2_bootstrap.log\ndeploy finished => app1\ncheck logfile => more /tmp/app1_bootstrap.log\ndeploy finished => lb1\ncheck logfile => more /tmp/lb1_bootstrap.log\n\nw3m \u3092\u5c0e\u5165\u3057\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc lb1 \u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n[root@fog-server ~]# yum install -y w3m\n\n[root@fog-server ~]# w3m http://192.168.1.17/\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\n\u7b2c12\u7ae0\u306e\u5b8c\u4e86\u3002AWS\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4eca\u56de\u306e\u305f\u3081\u306b\u4eca\u65e5\u3001\u4f5c\u3063\u305f\u3002\u304b\u306a\u308a\u4f7f\u3044\u52dd\u624b\u304cSoftLayer\u306e\u30dd\u30fc\u30bf\u30eb\u3068\u9055\u3046\u306e\u3067\u6238\u60d1\u3063\u305f\u3002\n\n\u524d\u56de\u306f\u3053\u3061\u3089 - \u6b21\u56de\u306f\u3053\u3061\u3089\n[\u524d\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/1df2dbc43bcd7638f672) - [\u6b21\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/11bcaef5faf5d8ff87f2)\n***\n#\u3053\u308c\u306f\u306a\u306b\n[\u300cOpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580\u300d](http://www.shoeisha.co.jp/book/detail/9784798139784)\u306e\u5b9f\u7fd2\u3092SoftLayer\u306e\u7121\u6599\u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u884c\u3046\u8a18\u9332\u3067\u3042\u308b\u3002\n![OpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580](http://www.seshop.com/static/images/product/17681/L.png)\n\n# \u7b2c12\u7ae0 Fog\u3092\u4f7f\u3063\u305f\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u3078\u306e\u30b7\u30b9\u30c6\u30e0\u5c55\u958b\n\n\u5f53\u7ae0\u3067\u306fFog\u3068Chef\u3092\u5229\u7528\u3057OpenStack\u3068AWS\u306e\u30de\u30eb\u30c1\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n\u5f53\u7ae0\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f[\u3053\u3061\u3089](https://github.com/josug-book1-materials/chapter12)\u3002\n\n## 12.1 \u30b7\u30b9\u30c6\u30e0\u81ea\u52d5\u5c55\u958b\u306e\u6982\u8981\n\n\u7b2c11\u7ae0\u306eAnsible\u306e\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u3067\u306fOpenStack\u4ee5\u5916\u306e\u30af\u30e9\u30a6\u30c9\u306b\u306f\u5bfe\u5fdc\u3067\u304d\u306a\u3044\u3088\u306d\u3001\u3068\u3044\u3046\u8a71\u3002\n\n## 12.2 \u81ea\u52d5\u5c55\u958b\u306e\u5185\u90e8\u52d5\u4f5c\n\n\u81ea\u52d5\u5c55\u958b\u306b\u306f\u5927\u304d\u304f\u5206\u3051\u3066\u3001(1)\u30a4\u30f3\u30d5\u30e9\u30ea\u30bd\u30fc\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u3001(2)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3068\u3044\u30462\u3064\u306e\u30b9\u30c6\u30c3\u30d7\u304c\u3042\u308b\u3002(1)\u306f\u30af\u30e9\u30a6\u30c9\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3067\u30af\u30e9\u30a6\u30c9\u6bce\u306b\u7570\u306a\u308bAPI\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308b\u304c\u3001(2)\u306fOS\u3078\u306e\u64cd\u4f5c\u306a\u306e\u3067\u5171\u901a\u3067\u3042\u308aChef\u3001Ansible\u3001Puppet\u3068\u304b\u306e\u30c4\u30fc\u30eb\u3067\u81ea\u52d5\u5316\u53ef\u80fd\u3067\u3042\u308b\u3002\n\u3053\u306e\u7ae0\u3067\u306f(1)\u3092Fog\u3067\u3001(2)\u3092Chef\u3067\u81ea\u52d5\u5316\u3059\u308b\u3002\u8a71\u306e\u4e2d\u5fc3\u306f\u3082\u3061\u308d\u3093(1)\u3002\n\n## 12.3 Fog\u306b\u3064\u3044\u3066\n\nFog\u306f\u30af\u30e9\u30a6\u30c9\u64cd\u4f5c\u7528\u306eRuby\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30fc\u3002AWS\u3067\u3082OpenStack\u3067\u3082Fog::Compute.new\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f5c\u6210\u3067\u304d\u308b\u304c\u3001\u6e21\u3059\u5f15\u6570\u304c\u9055\u3044\u5358\u7d14\u306b\u5171\u901a\u5316\u3067\u304d\u308b\u3082\u306e\u3067\u306f\u306a\u3044\u3068\u3044\u3046\u8a71\u3002\n\n## 12.4 \u4e8b\u524d\u6e96\u5099\n\n### 12.4.1 \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u306e\u6e96\u5099\n\nOpenStack\u306f\u5f53\u7136\u3053\u308c\u307e\u3067\u4f7f\u3063\u3066\u304d\u305f\u3082\u306e\u3092\u5229\u7528\u3059\u308b\u3002[AWS\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u3064\u304f\u308a](http://aws.amazon.com/jp/register-flow/)\u3001[CentOS 6 x86_64 - with Updates HVM](https://aws.amazon.com/marketplace/pp/B00NQAYLWO/ref=srh_res_product_title?ie=UTF8&sr=0-4&qid=1427764534059)\u3092\u30de\u30fc\u30b1\u30c3\u30c8\u30d7\u30ec\u30fc\u30b9\u3067\u8cfc\u5165\u3057\u3066\u304a\u304f\u3002\n\n### 12.4.2 \u524d\u63d0\u74b0\u5883\u306e\u69cb\u7bc9\n\n\u307e\u305a\u3001OpenStack\u5074\u306e\u6e96\u5099\u3002\u624b\u9806\u306f[\u3053\u3061\u3089](https://github.com/josug-book1-materials/chapter12/blob/master/openstack_prepare_fog_server.sh)\n\n\u30ad\u30fc\u30da\u30a2key-openstack\u3092\u4f5c\u308b\u3002\n\n```\n[root@step-server ~]# nova keypair-add key-openstack | tee key-openstack.pem\n-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEA6O4FWIoi1oQ7XVn2ysvH0NNmhU48MpmB5MGua7zI0b93uinZ\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n\n[root@step-server ~]# chmod 600 key-openstack.pem\n```\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30affog-net\u3092192.168.1.0/24\u3067\u4f5c\u6210\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# neutron net-create fog-net\nCreated a new network:\n+-----------------+--------------------------------------+\n| Field           | Value                                |\n+-----------------+--------------------------------------+\n| admin_state_up  | True                                 |\n| id              | 2d6b7733-8381-4ca1-8de5-a47d3054a088 |\n| name            | fog-net                              |\n| router:external | False                                |\n| shared          | False                                |\n| status          | ACTIVE                               |\n| subnets         |                                      |\n| tenant_id       | 106e169743964758bcad1f06cc69c472     |\n+-----------------+--------------------------------------+\n\n[root@step-server ~]# neutron subnet-create --ip-version 4 --gateway 192.168.1.254 \\\n> --name fog-subnet fog-net 192.168.1.0/24\nCreated a new subnet:\n+-------------------+--------------------------------------------------+\n| Field             | Value                                            |\n+-------------------+--------------------------------------------------+\n| allocation_pools  | {\"start\": \"192.168.1.1\", \"end\": \"192.168.1.253\"} |\n| cidr              | 192.168.1.0/24                                   |\n| dns_nameservers   |                                                  |\n| enable_dhcp       | True                                             |\n| gateway_ip        | 192.168.1.254                                    |\n| host_routes       |                                                  |\n| id                | 199d8419-1f7a-4959-ae3c-0ab4370464c7             |\n| ip_version        | 4                                                |\n| ipv6_address_mode |                                                  |\n| ipv6_ra_mode      |                                                  |\n| name              | fog-subnet                                       |\n| network_id        | 2d6b7733-8381-4ca1-8de5-a47d3054a088             |\n| tenant_id         | 106e169743964758bcad1f06cc69c472                 |\n+-------------------+--------------------------------------------------+\n\n[root@step-server ~]# neutron router-interface-add Ext-Router fog-subnet\nAdded interface 7fab4d8b-c854-42b4-8ce1-0a3330c9b55f to router Ext-Router.\n</pre>\n \n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7sg-for-fog\u3092\u4f5c\u308a\u3001\u30eb\u30fc\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# neutron security-group-create sg-for-fog\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe                                                                                                                                                                                                                                                                                          |\n| name                 | sg-for-fog                                                                                                                                                                                                                                                                                                                    |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"3b3b7311-f5ec-44c3-a4a4-d567ef515568\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"6d612c19-d6cb-40e2-9558-5794937cb6df\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol tcp \\\n>   --port-range-min 22 --port-range-max 22 \\\n>   --remote-ip-prefix 0.0.0.0/0 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 8479bc21-449e-4a98-8715-3a4ea7e696ff |\n| port_range_max    | 22                                   |\n| port_range_min    | 22                                   |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol icmp \\\n>   --remote-ip-prefix 0.0.0.0/0 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 6794a260-43a1-4683-8877-8cce01c1f4af |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol icmp \\\n>   --remote-ip-prefix 192.168.1.0/24 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 2ab010d1-39a3-4ae0-b786-4a8c586a6963 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 192.168.1.0/24                       |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --protocol tcp \\\n>   --remote-ip-prefix 192.168.1.0/24 \\\n>   sg-for-fog\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b3cf5963-4815-4552-8250-f8f3382bb9e9 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 192.168.1.0/24                       |\n| security_group_id | 4c9ac151-c1c0-43e3-8b6a-0b69e7217fbe |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n</pre>\n\ncentos-base\u30a4\u30e1\u30fc\u30b8\u306eUUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# nova image-list\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n| ID                                   | Name                     | Status | Server                               |\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n| 098f948e-e80b-4b1a-8a46-f8d2dd57e149 | centos-base              | ACTIVE |                                      |\n| 39fb3a6e-e543-4bfe-8ff7-a948acd1c7a3 | cirros-0.3.3-x86_64-disk | ACTIVE |                                      |\n| 362ae42a-1e46-4de4-afd9-af57965f1b3f | web-base-v1.0            | ACTIVE | d0ce0d2a-f4fa-448d-bb9b-b605af386b9f |\n+--------------------------------------+--------------------------+--------+--------------------------------------+\n</pre>\n\n\u6b21\u306bAWS\u3067\u306e\u6e96\u5099\u4f5c\u696d\u3002\u4eca\u56de\u306f\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3(ap-northeast-1)\u3067\u4f5c\u696d\u3092\u3059\u308b\u3002\nEC2\u306e\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30ad\u30fc\u30da\u30a2key-aws\u3092\u4f5c\u308a\u3001\u79d8\u5bc6\u9375\u3092key-aws.pem\u3067\u4fdd\u5b58\u3059\u308b\u3002\n\nVPC\u3067fog-vpc\u3092192.168.0.0/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u4f5c\u308a\u3001Public\u3092192.168.1.0/24\u306b\u3059\u308b\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7 sg_for_fog \u3092\u4f5c\u6210\u3057\u30eb\u30fc\u30eb\u3092\u3064\u3051\u308b\u3002\n\nCentOS\u306e\u30a4\u30e1\u30fc\u30b8ID\u3092\u78ba\u8a8d\u3059\u308b\u3002Asia Pacific (Tokyo) \u306e CentOS 6 \u306fami-13614b12 \u3067\u672c\u66f8\u304b\u3089\u5909\u308f\u3089\u305a\u3002\n\n\n### 12.4.3 Fog\u30b5\u30fc\u30d0\u30fc\u306e\u69cb\u7bc9\n\nOpenStack\u306bFog\u7528\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u308b\u3002\u3053\u308c\u307e\u3067\u3068\u9055\u3044\u30d5\u30ec\u30fc\u30d0\u30fc\u304c standard.medium\u3002\n\n<pre>\n[root@step-server ~]# get_uuid () { cat - | grep \" id \" | awk '{print $4}'; }\n[root@step-server ~]# MY_FOG_NET=`neutron net-show fog-net | get_uuid`\n[root@step-server ~]# echo $MY_FOG_NET\n2d6b7733-8381-4ca1-8de5-a47d3054a088\n[root@step-server ~]# nova boot \\\n>   --image centos-base \\\n>   --key-name key-openstack \\\n>   --flavor standard.medium \\\n>   --nic net-id=$MY_FOG_NET \\\n>   --security-groups sg-for-fog \\\n>   --availability-zone az1 \\\n>   fog-server\n+--------------------------------------+----------------------------------------------------+\n| Property                             | Value                                              |\n+--------------------------------------+----------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                             |\n| OS-EXT-AZ:availability_zone          | nova                                               |\n| OS-EXT-STS:power_state               | 0                                                  |\n| OS-EXT-STS:task_state                | scheduling                                         |\n| OS-EXT-STS:vm_state                  | building                                           |\n| OS-SRV-USG:launched_at               | -                                                  |\n| OS-SRV-USG:terminated_at             | -                                                  |\n| accessIPv4                           |                                                    |\n| accessIPv6                           |                                                    |\n| adminPass                            | SE8gXSae2YmG                                       |\n| config_drive                         |                                                    |\n| created                              | 2015-03-31T04:17:20Z                               |\n| flavor                               | standard.medium (102)                              |\n| hostId                               |                                                    |\n| id                                   | d6a19009-7a64-42e6-8b75-9975191583eb               |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149) |\n| key_name                             | key-openstack                                      |\n| metadata                             | {}                                                 |\n| name                                 | fog-server                                         |\n| os-extended-volumes:volumes_attached | []                                                 |\n| progress                             | 0                                                  |\n| security_groups                      | sg-for-fog                                         |\n| status                               | BUILD                                              |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                   |\n| updated                              | 2015-03-31T04:17:20Z                               |\n| user_id                              | 98dd78b670884b64b879568215777c53                   |\n+--------------------------------------+----------------------------------------------------+\n\n[root@step-server ~]# FIP=`nova floating-ip-create Ext-Net | awk -F '|' '{print $2,$4}' | awk '{if ($2 == \"-\") print $1;}'`\n\n[root@step-server ~]# nova floating-ip-associate fog-server $FIP\n\n[root@step-server ~]# nova list --field name,networks\n+--------------------------------------+-------------+--------------------------------------+\n| ID                                   | Name        | Networks                             |\n+--------------------------------------+-------------+--------------------------------------+\n| d6a19009-7a64-42e6-8b75-9975191583eb | fog-server  | fog-net=192.168.1.1, 192.168.100.136 |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | work-net=10.0.0.1, 192.168.100.131   |\n+--------------------------------------+-------------+--------------------------------------+\n</pre>\n\nAWS\u306b\u3082\u6307\u793a\u306b\u3042\u308b\u3088\u3046\u306bFog\u7528\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u308b\u3002\n\u672c\u66f8\u306b\u306f\u300ct2.medium\u300d\u3067\u7acb\u3066\u308b\u3088\u3046\u306b\u3042\u308b\u3051\u308c\u3069\u300ct2.micro\u300d\u306a\u3089750\u6642\u9593\u307e\u3067\u7121\u6599\u306a\u306e\u3067\u300ct2.micro\u300d\u3067\u7acb\u3066\u3066\u307f\u308b\u3002\u3053\u308c\u3067\u5f8c\u3067\u82e6\u52b4\u3059\u308b\u3002\n\n\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u3092git clone\u3057\u3066\u3001\u5c0e\u5165\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6d41\u3059\u3002\n\n<pre>\n[root@step-server ~]# ssh -i key-openstack.pem root@192.168.100.136\n\n[root@fog-server ~]# yum -y install git\n\n[root@fog-server ~]# git clone https://github.com/josug-book1-materials/chapter12.git\n\n[root@fog-server ~]# sh chapter12/install_fog_chef.sh\n</pre>\n\nOpenStack\u3067\u306f\u6210\u529f\u3057\u305f\u5c0e\u5165\u30b9\u30af\u30ea\u30d7\u30c8\u304cAWS\u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002\u8abf\u3079\u3066\u307f\u308b\u3068 berkshelf \u306e\u4f9d\u5b58\u5148\u306e dep-selector-libgecode \u304c\u5c0e\u5165\u3055\u308c\u308b\u6642\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u8d70\u308a\u3001\u30e1\u30e2\u30ea\u30fc\u3092\u30d0\u30ab\u98df\u3044\u3057\u3066\u843d\u3061\u308b\u3089\u3057\u3044\u3002\n\u3053\u308c\u304c\u3001\u30e1\u30e2\u30ea\u30fc\u304c4GB\u306e\u300ct2.medium\u300d\u3092\u4f7f\u3046\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u308b\u7406\u7531\u306e\u3088\u3046\u3060\u3002\n\u3053\u306e\u304f\u3089\u3044\u3001\u8ab2\u91d1\u3059\u308b\u304b\u3068\u601d\u3063\u305f\u304c\u300c[berkshelf\u306fAWS\u306emicro\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30d3\u30eb\u30c9\u51fa\u6765\u308b](http://qiita.com/ymmtmdk/items/a8e1edd64f34c5531725)\u300d\u3092\u898b\u3064\u3051\u305f\u3002\u3053\u308c\u3067\u3001\u5148\u306b dep-selector-libgecode \u3092\u5c0e\u5165\u3057\u3066\u304a\u304f\u3002\n\n```\nSuccessfully installed dep-selector-libgecode-1.0.2\n1 gem installed\n```\n\n\u5165\u3063\u305f\uff01\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3001\u5c0e\u5165\u30b7\u30a7\u30eb\u3092\u518d\u5b9f\u884c\u3059\u308b\u3002\u4eca\u5ea6\u306f\u5c0e\u5165\u304c\u5b8c\u4e86\u3057\u305f\u3002\n\n```\n[root@ip-192-168-1-130 ~]# sh chapter12/install_fog_chef.sh\nUpdating all packages (it takes some time ...)\nInstalling ruby\nPackage flex-2.5.35-9.el6.x86_64 already installed and latest version\nPackage gcc-4.4.7-11.el6.x86_64 already installed and latest version\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nVendoring yum (3.5.3) to cookbooks/yum\nVendoring yum-epel (0.6.0) to cookbooks/yum-epel\nVendoring yum-mysql-community (0.1.16) to cookbooks/yum-mysql-community\n##### Building environment completed #####\n\n```\n\n\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u3001\u30b3\u30de\u30f3\u30c9\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066reboot\u3002\n\n```\n[root@ip-192-168-1-130 ~]# SU - FOG\n-bash: SU: command not found\n[root@ip-192-168-1-130 ~]# su - fog\n[fog@ip-192-168-1-130 ~]$ wchi fog\n-bash: wchi: command not found\n[fog@ip-192-168-1-130 ~]$ which fog\n/usr/bin/fog\n[fog@ip-192-168-1-130 ~]$ which chef-zero\n/usr/bin/chef-zero\n[fog@ip-192-168-1-130 ~]$ exit\nlogout\n[root@ip-192-168-1-130 ~]# reboot\n```\n\n## 12.5 \u30de\u30eb\u30c1\u30af\u30e9\u30a4\u30c9\u3078\u306e\u30b7\u30b9\u30c6\u30e0\u5c55\u958b\n\n### 12.5.1 OpenStack\u3078\u306e\u5c55\u958b\n\n\n\u30e6\u30fc\u30b6\u30fcfog\u304cfog\u30b5\u30fc\u30d0\u30fc\u3067\u79d8\u5bc6\u9375\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6e96\u5099\u3059\u308b\u3002\n\n```\n[root@step-server ~]# scp -i key-openstack.pem key-openstack.pem root@192.168.100.136:/home/fog/key-openstack.pem\nkey-openstack.pem                                                                   100% 1676     1.6KB/s   00:00\n[root@step-server ~]# ssh -i key-openstack.pem root@192.168.100.136\n[root@fog-server ~]# chown fog:fog /home/fog/key-openstack.pem\n[root@fog-server ~]# chmod 600 /home/fog/key-openstack.pem\n[root@fog-server ~]# ls -l /home/fog/key-openstack.pem\n```\n\n\u74b0\u5883\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb fogrc \u3092\u8aad\u307f\u8fbc\u3080\u3002\n\n```\n[fog@fog-server ~]$ cat chapter12/etc/fogrc\n# OpenStack\nexport OS_AUTH_URL='http://192.168.100.10:5000/v2.0/'\nexport OS_USERNAME='snsapp-infra-user'\nexport OS_PASSWORD='passw0rd'\nexport OS_TENANT_NAME='SNSApp'\nexport OS_REGION_NAME='RegionOne'\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n\n[fog@fog-server ~]$ source chapter12/etc/fogrc\n```\n\n[OpenStack\u74b0\u5883\u7528\u306eyaml](https://github.com/josug-book1-materials/chapter12/blob/master/etc/openstack.yaml)\u3092\u4eca\u56de\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u306f\u3001\u74b0\u5883\u56fa\u6709\u306eUUID\u306e\u90e8\u5206\u3067\u3042\u308b\u3002\n\n\nimage id   : 098f948e-e80b-4b1a-8a46-f8d2dd57e149\nnetwork id : 2d6b7733-8381-4ca1-8de5-a47d3054a088\n\n```\n[fog@fog-server ~]$ sed -e 's/84ab092f-8e0a-42ba-a820-51fc40d07e72/098f948e-e80b-4b1a-8a46-f8d2dd57e149/g' chapter12/etc/openstack.yaml > chapter12/etc/openstack-1.yaml\n\n[fog@fog-server ~]$ sed -e 's/9ef02f9c-cff0-40b8-a25d-1ecd9e9a7694/2d6b7733-8381-4ca1-8de5-a47d3054a088/g' chapter12/etc/openstack-1.yaml > chapter12/etc/openstack-2.yaml\n```\n\n\u66f8\u304d\u63db\u3048\u5f8c\u306e openstack-2.yaml \u3092\u6307\u5b9a\u3057\u3066 create_server.rb \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```\n[fog@fog-server ~]$ cd chapter12/\n[fog@fog-server chapter12]$ ruby create_server.rb etc/openstack-2.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\n - provider: Openstack\n   name: db1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: db\n   ip_address: 192.168.1.3\n - provider: Openstack\n   name: web1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: web\n   ip_address: 192.168.1.4\n - provider: Openstack\n   name: web2\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: web\n   ip_address: 192.168.1.5\n - provider: Openstack\n   name: app1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: app\n   ip_address: 192.168.1.6\n - provider: Openstack\n   name: lb1\n   flavor: standard.xsmall\n   image_id: 098f948e-e80b-4b1a-8a46-f8d2dd57e149\n   key_name: key-openstack\n   key_file: \"/home/fog/key-openstack.pem\"\n   availability_zone: az1\n   network_id: 2d6b7733-8381-4ca1-8de5-a47d3054a088\n   security_groups:\n   - sg-for-fog\n   role: lb\n   ip_address: 192.168.1.7\n```\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3002\n\n<pre>\n[root@step-server ~]# nova list --field name,networks\n+--------------------------------------+-------------+--------------------------------------+\n| ID                                   | Name        | Networks                             |\n+--------------------------------------+-------------+--------------------------------------+\n| 94b26056-af33-410e-84fc-93a0b4914f9b | app1        | fog-net=192.168.1.6                  |\n| a695dc3c-c1f8-4c60-82ee-a8e4ffc6aae6 | db1         | fog-net=192.168.1.3                  |\n| d6a19009-7a64-42e6-8b75-9975191583eb | fog-server  | fog-net=192.168.1.1, 192.168.100.136 |\n| 75f7b5ea-5fcf-4da2-9824-484dbdf6fd7a | lb1         | fog-net=192.168.1.7                  |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | work-net=10.0.0.1, 192.168.100.131   |\n| 805c81e9-23d9-4879-be49-31907f546165 | web1        | fog-net=192.168.1.4                  |\n| c056b4a0-ac8f-4057-956f-d2f7def1b832 | web2        | fog-net=192.168.1.5                  |\n+--------------------------------------+-------------+--------------------------------------+\n</pre>\n\n### 12.5.2 AWS\u3078\u306e\u5c55\u958b\n\nAWS\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u79d8\u5bc6\u9375\u3092\u8ee2\u9001\u3057\u30e6\u30fc\u30b6\u30fcfog\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6a29\u9650\u3092\u4e0e\u3048\u308b\u3002\n\n```\n[root@ip-192-168-1-130 ~]# chown fog:fog /home/fog/key-aws.pem\n[root@ip-192-168-1-130 ~]# chmod 600 /home/fog/key-aws.pem\n[root@ip-192-168-1-130 ~]# ls -l /home/fog/key-openstack.pem\n```\n\nAPI\u3092\u4f7f\u3046\u306e\u3067IAM\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002Access Key Id\u3068Secret Access Key\u3092\u5165\u624b\u3059\u308b\u3002\n\u3053\u306e\u30e6\u30fc\u30b6\u30fc\u306b AmazonEC2FullAccess \u306ePolicy\u3092\u4e0e\u3048\u305f\u3002\n\n![IAM\u30e6\u30fc\u30b6\u30fc\u306e\u30dd\u30ea\u30b7\u30fc](https://qiita-image-store.s3.amazonaws.com/0/71995/23ff9a11-b38e-1ccc-7277-7251666c73d3.png)\n\n\u300cchapter12/etc/fogrc\u300d\u306bIAM\u306eAccess Key Id\u3068Secret Access Key\u3092\u8a2d\u5b9a\u3057\u3066\u3001\u8aad\u307f\u8fbc\u3093\u3067\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n```\n[fog@ip-192-168-1-130 ~]$ vi chapter12/etc/fogrc\n\n# AWS\nexport AWS_ACCESS_KEY_ID='AKIXXXXXXXXXXXXXXXXX'\nexport AWS_SECRET_ACCESS_KEY='XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'\nexport AWS_REGION='ap-northeast-1'\n\n[fog@ip-192-168-1-130 ~]$ source chapter12/etc/fogrc\n```\n\n[AWS\u7528\u306eyaml\u30d5\u30a1\u30a4\u30eb](https://github.com/josug-book1-materials/chapter12/blob/master/etc/aws.yaml)\u3092\u7de8\u96c6\u3059\u308b\u3002\u672c\u66f8\u3069\u304a\u308a\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308c\u3070\u3001\u5909\u66f4\u304c\u5fc5\u8981\u306a\u306e\u306f network_id \u3050\u3089\u3044\u3002\n\n```\n[fog@ip-192-168-1-130 ~]$ vi chapter12/etc/aws.yaml\n\n- provider: AWS\n  name: db1\n  flavor: t2.micro\n  image_id: ami-13614b12\n  key_name: key-aws\n  key_file: /home/fog/key-aws.pem\n  network_id: subnet-abcdefgh\n  security_groups:\n    - sg_for_fog\n  role: db\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n```\n\nyaml\u3092\u6307\u5b9a\u3057\u3066create_server.rb\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```\n[fog@ip-192-168-1-130 ~]$ cd chapter12/\n[fog@ip-192-168-1-130 chapter12]$ ruby create_server.rb etc/aws.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\n - provider: Aws\n   name: db1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: db\n   ip_address: 192.168.1.208\n - provider: Aws\n   name: web1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: web\n   ip_address: 192.168.1.131\n - provider: Aws\n   name: web2\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: web\n   ip_address: 192.168.1.114\n - provider: Aws\n   name: app1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: app\n   ip_address: 192.168.1.16\n - provider: Aws\n   name: lb1\n   flavor: t2.micro\n   image_id: ami-13614b12\n   key_name: key-aws\n   key_file: \"/home/fog/key-aws.pem\"\n   availability_zone:\n   network_id: subnet-abcdefgh\n   security_groups:\n   - sg_for_fog\n   role: lb\n   ip_address: 192.168.1.56\n```\n\n5\u53f0\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u8d77\u52d5\u3057\u305f\u3002\n\n![AWS\u3067\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5](https://qiita-image-store.s3.amazonaws.com/0/71995/232995e9-77ab-7e7a-36f2-da55a13fa72e.png)\n\n\u540c\u3058\u30b9\u30af\u30ea\u30d7\u30c8\u306bOpenStack\u7528\u30fbAWS\u7528\u3068\u4e0e\u3048\u308byaml\u3092\u5909\u3048\u308b\u3060\u3051\u3067\u5225\u306e\u30af\u30e9\u30a6\u30c9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306b\u540c\u69d8\u306e\u5c55\u958b\u304c\u51fa\u6765\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n## 12.6 \u5185\u90e8\u52d5\u4f5c\u306e\u7d39\u4ecb\n\n\u5b9f\u884c\u3057\u305fFog\u30b3\u30fc\u30c9\u306e\u89e3\u8aac\u306e\u7bc0\u3067\u3042\u308b\u3002\u307e\u3058\u3081\u306b\u8aad\u3082\u3046\u3002\n\n## 12.7 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5c0e\u5165\u3092\u542b\u3081\u305f\u81ea\u52d5\u5316\n\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3068\u3001\u3055\u3089\u306b\u305d\u306e\u5f8c\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5c0e\u5165\u3092Chef\u3067\u81ea\u52d5\u5316\u3057\u3066\u3044\u308b\u3002\n\u4e8b\u524d\u306b12.6\u3067\u4f5c\u6210\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u3092\u524a\u9664\u3057\u3066\u304a\u304f\u3002\n\ndeploy_app.rb \u3092 yaml \u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3002\u4e0b\u8a18\u306fOpenStack\u306e\u4f8b\u3060\u304b\u3001AWS\u306a\u3089\u5f53\u7136 aws.yaml \u3092\u6307\u5b9a\u3002\n\n```\n[fog@fog-server chapter12]$ ruby deploy_app.rb etc/openstack-2.yaml\nCreated server db1\nCreated server web1\nCreated server web2\nCreated server app1\nCreated server lb1\nwaiting icmp session to db1\nwaiting icmp session to db1\nwaiting icmp session to db1\nI found icmp session to db1\nI found icmp session to web1\nwaiting icmp session to web2\nI found icmp session to web2\nI found icmp session to app1\nI found icmp session to lb1\ncookbooks uploaded.\nroles uploaded.\ndeploy finished => db1\ncheck logfile => more /tmp/db1_bootstrap.log\ndeploy finished => web1\ncheck logfile => more /tmp/web1_bootstrap.log\ndeploy finished => web2\ncheck logfile => more /tmp/web2_bootstrap.log\ndeploy finished => app1\ncheck logfile => more /tmp/app1_bootstrap.log\ndeploy finished => lb1\ncheck logfile => more /tmp/lb1_bootstrap.log\n```\n\nw3m \u3092\u5c0e\u5165\u3057\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc lb1 \u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n```\n[root@fog-server ~]# yum install -y w3m\n\n[root@fog-server ~]# w3m http://192.168.1.17/\n```\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n![w3m\u3067\u306e\u30a2\u30d7\u30ea\u3078\u306e\u30a2\u30af\u30bb\u30b9](https://qiita-image-store.s3.amazonaws.com/0/71995/44c967b7-8560-00c5-bc47-d44fd596f450.png)\n\n***\n\u7b2c12\u7ae0\u306e\u5b8c\u4e86\u3002AWS\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4eca\u56de\u306e\u305f\u3081\u306b\u4eca\u65e5\u3001\u4f5c\u3063\u305f\u3002\u304b\u306a\u308a\u4f7f\u3044\u52dd\u624b\u304cSoftLayer\u306e\u30dd\u30fc\u30bf\u30eb\u3068\u9055\u3046\u306e\u3067\u6238\u60d1\u3063\u305f\u3002\n***\n\n[\u524d\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/1df2dbc43bcd7638f672) - [\u6b21\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/11bcaef5faf5d8ff87f2)\n"}