{"tags": ["gcp", "minikube"], "context": "\n\n\u6982\u8981\nminikube\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3001\u624b\u5143\u306e\u30de\u30b7\u30fc\u30f3\u3067VirtualBox\u3092\u4f7f\u3063\u3066Kubernetes\u3092\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u8efd\u304f\u89e6\u3063\u305f\u3002\n\u74b0\u5883\u306f\u3001mac\u3002\n\n\u524d\u7de8\nkubernetes\u5165\u9580\u3057\u307e\u3057\u305f\n\n\u5165\u9580\u7de8\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n\n\n\u8d77\u52d5\n\n$ minikube start\n\n$ minikube status\n\n\nKubernetes\u30b5\u30fc\u30d0\u306bssh\u63a5\u7d9a\n\n$ minikube ssh\n\n\n\u64cd\u4f5c\u3059\u308b\u30af\u30e9\u30b9\u30bf(context)\u3092minikube\u306b\u3059\u308b\n\n$ kubectl config use-context minikube\n\nminikube\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u52dd\u624b\u306b\u3053\u308c\u304c\u884c\u308f\u308c\u308b\u6a21\u69d8\u3002\n\nKubernetes\u3067\u30b3\u30f3\u30c6\u30ca\u30fc\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\n\n$ kubectl run my-nginx --image=nginx --replicas=2 --port=80\n\n$ kubectl get pods\nNAME                       READY     STATUS    RESTARTS   AGE\nmy-nginx-379829228-jft31   1/1       Running   0          1m\nmy-nginx-379829228-kc18n   1/1       Running   0          1m\n\n$ kubectl get deployment\nNAME       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nmy-nginx   2         2         2            2           2m\n\n$ kubectl expose deployment my-nginx --port=80 --type=LoadBalancer\n\n$ kubectl get services\nNAME         CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE\nkubernetes   10.0.0.1     <none>        443/TCP        16h\nmy-nginx     10.0.0.188   <pending>     80:32453/TCP   8m\n\nEXTERNAL-IP\u304c\u751f\u6210\u3055\u308c\u306a\u3044\u30fb\u30fb\n\n\u30b5\u30fc\u30d3\u30b9\u306eURL\u3092\u53d6\u5f97\u3059\u308b\n\n$ minikube service my-nginx --url\nhttp://192.168.99.101:32453\n\n\ndashboard\n\n$ minikube dashboard\n\n\u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3067\u304d\u306a\u304b\u3063\u305f\u6642\u306a\u3069\u30a8\u30e9\u30fc\u304c\u898b\u3048\u308b\u306e\u3067\u3044\u3044\u304b\u3082\u3002\n\u5b9f\u969b\u3042\u3068\u3067\u3001\u3053\u3053\u306e\u30ed\u30b0\u307f\u3066\u3001private\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u30a4\u30e1\u30fc\u30b8pull\u3067\u304d\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u6c17\u3065\u304f\u3002\n\nKubernetes\u74b0\u5883\u306e\u524a\u9664\n\n$ minikube stop\n$ minikube delete\n\n\nprivate\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u30a4\u30e1\u30fc\u30b8\u304b\u3089pod\u3092\u4f5c\u6210\u3059\u308b\n\ndocker\u304b\u3089image pull\u3067\u304d\u308b\u3088\u3046\u306bsecret\u30ad\u30fc\u3092\u4f5c\u6210\u3059\u308b\n\n$ kubectl create secret [key-name] --docker-server=https://gcr.io --docker-username=oauth2accesstoken --docker-password=\"$(gcloud auth print-access-token)\" --docker-email=[mail-address]\n\n\u203b\u3053\u306e\u6642\u3001\u30ad\u30fc\u540d\u306f\u3001deployment.yml\u306eimagePullSecrets.name\u3068\u540c\u4e00\u306e\u3082\u306e\u306b\u3059\u308b\nhttps://github.com/lovelytokyo/gcp-starter/blob/master/k8s/deployment.yml#L16\n\ngit clone\u3059\u308b\n\n$ git clone git@github.com:lovelytokyo/gcp-starter.git\n\n\n\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\n$ kubectl apply -f k8s/deployment.yml\n$ kubectl apply -f k8s/service.yml\n\n\n\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\n$ curl $(minikube service web-server  --url)\n\n\nimage\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306a\u3069\u306e\u5834\u5408\u3001deployment\u66f4\u65b0\n\n$ kubectl replace -f k8s/deployment.yml\n\ndocker ps\u3067\u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u53c2\u7167\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u78ba\u8a8d\u3067\u304d\u308b\n\nmount\u3059\u308b\n\u2460mac \u3000\u2192 \u3000minikube host\u3000\n\u2461minikube host\u3000 \u2192 \u3000minikube container (pod )\n\u2460 \uff1a mac /Users \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306f\u3001\u3059\u3067\u306bminikube\u306e/Users\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3002\nminikube\n\u2461\uff1adeployment.yml\u306a\u3069\u306b\u3066\u5b9a\u7fa9\u3057\u3066\u3042\u3052\u308b\ndeployment.yml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: mount-test\nspec:\n  template:\n    metadata:\n      labels:\n        name: mount-test\n    spec:\n      imagePullSecrets:\n        - name : gcp-registry-key\n      containers:\n        - image: gcr.io/lovelytokyo-018/nginx:v1\n          name: test-container\n          volumeMounts:\n            - mountPath: /opt/  \u2190 pod\u5074\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3000\n              name: test-volume\n      volumes:\n        - name: test-volume\n          hostPath:\n            path: /Users/lovelytokyo  \u2190 minikube host\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n#\u6982\u8981\nminikube\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3001\u624b\u5143\u306e\u30de\u30b7\u30fc\u30f3\u3067VirtualBox\u3092\u4f7f\u3063\u3066Kubernetes\u3092\u8a66\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306a\u306e\u3067\u8efd\u304f\u89e6\u3063\u305f\u3002\n\u74b0\u5883\u306f\u3001mac\u3002\n\n# \u524d\u7de8\n[kubernetes\u5165\u9580\u3057\u307e\u3057\u305f](http://qiita.com/kkam0907/items/2d13d3fbe9d93f499488)\n\n# \u5165\u9580\u7de8\n\n- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n```\n$ curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-darwin-amd64 && chmod +x minikube && sudo mv minikube /usr/local/bin/\n```\n\n- \u8d77\u52d5\n\n```\n$ minikube start\n```\n\n```\n$ minikube status\n```\n\n- Kubernetes\u30b5\u30fc\u30d0\u306bssh\u63a5\u7d9a\n\n```\n$ minikube ssh\n```\n\n- \u64cd\u4f5c\u3059\u308b\u30af\u30e9\u30b9\u30bf(context)\u3092minikube\u306b\u3059\u308b\n\n```\n$ kubectl config use-context minikube\n```\n\nminikube\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u52dd\u624b\u306b\u3053\u308c\u304c\u884c\u308f\u308c\u308b\u6a21\u69d8\u3002\n\n- Kubernetes\u3067\u30b3\u30f3\u30c6\u30ca\u30fc\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\n\n```\n$ kubectl run my-nginx --image=nginx --replicas=2 --port=80\n```\n```\n$ kubectl get pods\nNAME                       READY     STATUS    RESTARTS   AGE\nmy-nginx-379829228-jft31   1/1       Running   0          1m\nmy-nginx-379829228-kc18n   1/1       Running   0          1m\n```\n\n```\n$ kubectl get deployment\nNAME       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\nmy-nginx   2         2         2            2           2m\n```\n\n```\n$ kubectl expose deployment my-nginx --port=80 --type=LoadBalancer\n```\n\n```\n$ kubectl get services\nNAME         CLUSTER-IP   EXTERNAL-IP   PORT(S)        AGE\nkubernetes   10.0.0.1     <none>        443/TCP        16h\nmy-nginx     10.0.0.188   <pending>     80:32453/TCP   8m\n```\n\nEXTERNAL-IP\u304c\u751f\u6210\u3055\u308c\u306a\u3044\u30fb\u30fb\n\n- \u30b5\u30fc\u30d3\u30b9\u306eURL\u3092\u53d6\u5f97\u3059\u308b\n\n```\n$ minikube service my-nginx --url\nhttp://192.168.99.101:32453\n```\n\n- dashboard\n\n```\n$ minikube dashboard\n```\n\n\u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3067\u304d\u306a\u304b\u3063\u305f\u6642\u306a\u3069\u30a8\u30e9\u30fc\u304c\u898b\u3048\u308b\u306e\u3067\u3044\u3044\u304b\u3082\u3002\n\u5b9f\u969b\u3042\u3068\u3067\u3001\u3053\u3053\u306e\u30ed\u30b0\u307f\u3066\u3001private\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u30a4\u30e1\u30fc\u30b8pull\u3067\u304d\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u6c17\u3065\u304f\u3002\n\n- Kubernetes\u74b0\u5883\u306e\u524a\u9664\n\n```\n$ minikube stop\n$ minikube delete\n```\n\n\n# private\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u30a4\u30e1\u30fc\u30b8\u304b\u3089pod\u3092\u4f5c\u6210\u3059\u308b\n\n- docker\u304b\u3089image pull\u3067\u304d\u308b\u3088\u3046\u306bsecret\u30ad\u30fc\u3092\u4f5c\u6210\u3059\u308b\n\n```\n$ kubectl create secret [key-name] --docker-server=https://gcr.io --docker-username=oauth2accesstoken --docker-password=\"$(gcloud auth print-access-token)\" --docker-email=[mail-address]\n```\n\n\u203b\u3053\u306e\u6642\u3001\u30ad\u30fc\u540d\u306f\u3001deployment.yml\u306eimagePullSecrets.name\u3068\u540c\u4e00\u306e\u3082\u306e\u306b\u3059\u308b\nhttps://github.com/lovelytokyo/gcp-starter/blob/master/k8s/deployment.yml#L16\n\n- git clone\u3059\u308b\n\n```\n$ git clone git@github.com:lovelytokyo/gcp-starter.git\n```\n\n- \u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\n```\n$ kubectl apply -f k8s/deployment.yml\n$ kubectl apply -f k8s/service.yml\n```\n\n- \u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\n```\n$ curl $(minikube service web-server  --url)\n```\n\n- image\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306a\u3069\u306e\u5834\u5408\u3001deployment\u66f4\u65b0\n\n```\n$ kubectl replace -f k8s/deployment.yml\n```\n\ndocker ps\u3067\u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u53c2\u7167\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u78ba\u8a8d\u3067\u304d\u308b\n\n\n# mount\u3059\u308b\n\n\u2460mac \u3000\u2192 \u3000minikube host\u3000\n\u2461minikube host\u3000 \u2192 \u3000minikube container (pod )\n\n\u2460 \uff1a mac /Users \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306f\u3001\u3059\u3067\u306bminikube\u306e/Users\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3002\nminikube\n\u2461\uff1adeployment.yml\u306a\u3069\u306b\u3066\u5b9a\u7fa9\u3057\u3066\u3042\u3052\u308b\n\ndeployment.yml\n\n```\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: mount-test\nspec:\n  template:\n    metadata:\n      labels:\n        name: mount-test\n    spec:\n      imagePullSecrets:\n        - name : gcp-registry-key\n      containers:\n        - image: gcr.io/lovelytokyo-018/nginx:v1\n          name: test-container\n          volumeMounts:\n            - mountPath: /opt/  \u2190 pod\u5074\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3000\n              name: test-volume\n      volumes:\n        - name: test-volume\n          hostPath:\n            path: /Users/lovelytokyo  \u2190 minikube host\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n```\n"}