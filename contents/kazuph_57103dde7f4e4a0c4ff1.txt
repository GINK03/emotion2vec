{"context": " More than 1 year has passed since last update.\n\n\u7d4c\u7def\n\u524d\u3005\u304b\u3089Backlog\u3092\u4f7f\u3063\u3066\u3044\u3066Backlog\u8a18\u6cd5\u3067\u8ab2\u984c\u3084Wiki\u3092\u7de8\u96c6\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3063\u3068\u524d\u304b\u3089Markdown\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u65b0\u8a2d\u3057\u305d\u3061\u3089\u3067\u306e\u904b\u7528\u3092\u59cb\u3081\u3066\u3044\u307e\u3057\u305f\u3002\u666e\u6bb5\u306e\u8ab2\u984c\u306fMarkdown\u3067\u66f8\u3044\u3066\u307e\u3059\u304c\u3001Wiki\u306b\u95a2\u3057\u3066\u306f\u904e\u53bb\u306e\u8cc7\u6599\u304c\u5927\u91cf\u306b\u3042\u308b\u3053\u3068\u3068\uff12\u91cd\u7ba1\u7406\u304c\u6016\u304b\u3063\u305f\u306e\u3067\u53e4\u3044Backlog\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3044\u7d9a\u3051\u3066\u3044\u307e\u3057\u305f\u3002\n\u305f\u3060\u305d\u308c\u3060\u3068Wiki\u3092\u66f8\u304f\u3068\u304d\u3060\u3051Backlog\u8a18\u6cd5\u3067\u66f8\u304f\u5fc5\u8981\u6027\u304c\u3042\u308a\u3081\u3093\u3069\u3046\u3060\u3068\u601d\u3063\u3066\u3044\u3066\u3001\u691c\u7d22\u3057\u3066\u3082\u3001\n\u904e\u53bb\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u542b\u3081\u3066\u65b0wiki\u30eb\u30fc\u30eb(markdown)\u306b\u79fb\u884c\u3057\u305f\u3044\n\u3053\u306e\u30da\u30fc\u30b8\u3092\u898b\u3066m9(^\u0414^)\uff8c\uff9f\uff77\uff9e\uff6c\uff70\u3063\u3066\u306a\u308b\u3060\u3051\u3060\u3063\u305f\u306e\u3067\u3001\u3064\u3044\u30ab\u30c3\u3068\u306a\u3063\u3066\u81ea\u52d5\u3067Wiki\u3092\u79fb\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n\u30bd\u30fc\u30b9\n\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u4ee5\u4e0b\u3092\u62c5\u5f53\u3057\u3066\u307e\u3059\u3002\n\nmechanize\n\n\nBacklog\u8a18\u6cd5\u306eWiki\u306eURL\u4e00\u89a7\u3092\u53d6\u5f97\n\u4e00\u89a7\u306eURL\u3054\u3068\u306b\u958b\u3044\u3066\u30bf\u30a4\u30c8\u30eb\u3068HTML\u3092\u53d6\u5f97\nMarkdown\u3092\u65b0\u8a2d\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eWiki\u306b\u81ea\u52d5\u6295\u7a3f\n\n\npandoc\n\n\nHTML\u3092Markdown\u3078\u5909\u63db\n\n\n\ngist\u306f\u3053\u3061\u3089 \u2192\u3000https://gist.github.com/kazuph/9263163\n\nbacklog2markdown.rb\n#!/usr/bin/env ruby\n# coding : utf-8\n\nrequire 'open-uri'\nrequire \"mechanize\"\nrequire 'pandoc-ruby'\nrequire \"awesome_print\"\nrequire \"pry\"\nrequire \"date\"\n\nclass Backlog2Markdown\n\n  def initialize(user_id, password, subdomain, from, to)\n    @user_id   = user_id\n    @password  = password\n    @subdomain = subdomain\n    @from      = from\n    @to        = to\n\n    @agent                  = Mechanize.new\n    @agent.user_agent_alias = \"Mac Safari\"\n    @agent.max_history      = 1\n\n  end\n\n  def login\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/LoginDisplay.action\")\n    form = page.forms[0]\n    form.field_with(id: \"userId\").value    = @user_id\n    form.field_with(id: \"password\").value  = @password\n    @agent.submit(form, form.buttons.first)\n  end\n\n  def wiki_url_list()\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/wiki/#{@from}/Home\")\n    wikipagelist = page.at('#wikipagelist')\n    @links = wikipagelist.search('a').map{|a|\n      a.attributes['href'].value\n    }\n  end\n\n  def wiki_html(link)\n    page  = @agent.get(\"https://#{@subdomain}.backlog.jp\" + link)\n    title = page.at('#mainTitle').text.gsub(/(\\n|\\t)/, '')\n    article = page.at('#loom').to_s\n    {title: title, article: article}\n  end\n\n  def to_markdown(html)\n    @converter = PandocRuby.new(html, :from => :html, :to => :markdown)\n    md = @converter.convert\n  end\n\n  def post_wiki (title, article)\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/NewWiki.action?projectKey=#{@to}\")\n    form = page.forms[3]\n    form.field_with(id: \"page.name\").value    = fronted_tag title\n    form.field_with(id: \"page.content\").value = work_around article\n    form.checkbox_with(name: 'mailNotify').uncheck\n    # binding.pry\n    @agent.submit(form, form.buttons.first)\n  end\n\n  def fronted_tag title\n    title.gsub!(/(.*?)(\\[.*\\])/, '\\2\\1')\n    title\n  end\n\n  def work_around text\n    text.gsub!(/^\\\\$\\n/,  '')\n    text.gsub!(/!\\[\\]/,  '![some_image]')\n    text\n  end\n\nend\n\nif __FILE__ == $0\n  i = Backlog2Markdown.new( ENV[\"USER_ID\"], ENV[\"PASS\"], ENV[\"SUBDOMAIN\"], ENV[\"FROM\"], ENV[\"TO\"])\n  i.login\n\n  links = i.wiki_url_list\n\n  links.each do |l|\n    wiki = i.wiki_html l\n    # binding.pry\n    md   = i.to_markdown wiki[:article]\n    puts wiki[:title]\n    i.post_wiki wiki[:title], md\n    sleep 3\n  end\nend\n\n\n\nGemfile\nsource \"https://rubygems.org\"\n\ngem \"mechanize\"\ngem 'pandoc-ruby'\ngem \"awesome_print\"\ngem \"pry\"\n\n\n\n\u5b9f\u884c\u65b9\u6cd5\npandoc\u306f\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5fc5\u8981\u306a\u5909\u6570\u306e\u8aac\u660e\n\nUSER_ID: \u30e6\u30fc\u30b6\u30fcID\nPASS: \u30d1\u30b9\u30ef\u30fc\u30c9\nSUBDOMAIN: XXXXX.backlog.jp\u306eXXXXX\u306e\u90e8\u5206\nFROM: Backlog\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eID\nTO: Markdown\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eID\n\n\u74b0\u5883\u5909\u6570\u4f7f\u3046\u306e\u9762\u5012\u81ed\u304b\u3063\u305f\u3089\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5b9f\u884c\nbundle install\nUSER_ID=user_id PASS=password SUBDOMAIN=your_backlog_subdomain  FROM=backlog_prj  TO=markdown_prj bundle exec ruby backlog2markdown.rb\n\n\u3044\u304d\u306a\u308a\u3084\u308b\u306e\u306f\u6016\u3044\u3068\u601d\u3046\u306e\u3067binding.pry\u3092\u631f\u3093\u3067\u5f90\u3005\u306b\u5024\u78ba\u8a8d\u3057\u3064\u3064\u5b9f\u884c\u3059\u308b\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u3068Backlog\u304cView\u3092\u5909\u3048\u308b\u3068\u3059\u3050\u306b\u52d5\u304b\u306a\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u305d\u306e\u8fba\u306f\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\nTODO\n\n\u30c6\u30fc\u30d6\u30eb\u8a18\u6cd5\u304c\u5d29\u308c\u308b\n\u30bd\u30fc\u30b9\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u306a\u3044\uff08\u8aad\u3081\u3070\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\uff09\n\n## \u7d4c\u7def\n\n\u524d\u3005\u304b\u3089Backlog\u3092\u4f7f\u3063\u3066\u3044\u3066Backlog\u8a18\u6cd5\u3067\u8ab2\u984c\u3084Wiki\u3092\u7de8\u96c6\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3063\u3068\u524d\u304b\u3089Markdown\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u65b0\u8a2d\u3057\u305d\u3061\u3089\u3067\u306e\u904b\u7528\u3092\u59cb\u3081\u3066\u3044\u307e\u3057\u305f\u3002\u666e\u6bb5\u306e\u8ab2\u984c\u306fMarkdown\u3067\u66f8\u3044\u3066\u307e\u3059\u304c\u3001Wiki\u306b\u95a2\u3057\u3066\u306f\u904e\u53bb\u306e\u8cc7\u6599\u304c\u5927\u91cf\u306b\u3042\u308b\u3053\u3068\u3068\uff12\u91cd\u7ba1\u7406\u304c\u6016\u304b\u3063\u305f\u306e\u3067\u53e4\u3044Backlog\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3044\u7d9a\u3051\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u305f\u3060\u305d\u308c\u3060\u3068Wiki\u3092\u66f8\u304f\u3068\u304d\u3060\u3051Backlog\u8a18\u6cd5\u3067\u66f8\u304f\u5fc5\u8981\u6027\u304c\u3042\u308a\u3081\u3093\u3069\u3046\u3060\u3068\u601d\u3063\u3066\u3044\u3066\u3001\u691c\u7d22\u3057\u3066\u3082\u3001\n\n[\u904e\u53bb\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u542b\u3081\u3066\u65b0wiki\u30eb\u30fc\u30eb(markdown)\u306b\u79fb\u884c\u3057\u305f\u3044](http://feedback.backlog.jp/forums/140671-backlog-%E8%A6%81%E6%9C%9B-%E5%95%8F%E9%A1%8C%E3%81%AE%E5%A0%B1%E5%91%8A-%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A9%E3%83%A0/suggestions/4421682-%E9%81%8E%E5%8E%BB%E3%81%AE%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E5%90%AB%E3%82%81%E3%81%A6%E6%96%B0wiki%E3%83%AB%E3%83%BC%E3%83%AB-markdown-%E3%81%AB%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%9F%E3%81%84)\n\n\u3053\u306e\u30da\u30fc\u30b8\u3092\u898b\u3066m9(^\u0414^)\uff8c\uff9f\uff77\uff9e\uff6c\uff70\u3063\u3066\u306a\u308b\u3060\u3051\u3060\u3063\u305f\u306e\u3067\u3001\u3064\u3044\u30ab\u30c3\u3068\u306a\u3063\u3066\u81ea\u52d5\u3067Wiki\u3092\u79fb\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n## \u30bd\u30fc\u30b9\n\n\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u4ee5\u4e0b\u3092\u62c5\u5f53\u3057\u3066\u307e\u3059\u3002\n\n- mechanize\n    - Backlog\u8a18\u6cd5\u306eWiki\u306eURL\u4e00\u89a7\u3092\u53d6\u5f97\n    - \u4e00\u89a7\u306eURL\u3054\u3068\u306b\u958b\u3044\u3066\u30bf\u30a4\u30c8\u30eb\u3068HTML\u3092\u53d6\u5f97\n    - Markdown\u3092\u65b0\u8a2d\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eWiki\u306b\u81ea\u52d5\u6295\u7a3f\n- pandoc\n    - HTML\u3092Markdown\u3078\u5909\u63db\n\ngist\u306f\u3053\u3061\u3089 \u2192\u3000https://gist.github.com/kazuph/9263163\n\n```rb:backlog2markdown.rb\n#!/usr/bin/env ruby\n# coding : utf-8\n\nrequire 'open-uri'\nrequire \"mechanize\"\nrequire 'pandoc-ruby'\nrequire \"awesome_print\"\nrequire \"pry\"\nrequire \"date\"\n\nclass Backlog2Markdown\n\n  def initialize(user_id, password, subdomain, from, to)\n    @user_id   = user_id\n    @password  = password\n    @subdomain = subdomain\n    @from      = from\n    @to        = to\n\n    @agent                  = Mechanize.new\n    @agent.user_agent_alias = \"Mac Safari\"\n    @agent.max_history      = 1\n\n  end\n\n  def login\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/LoginDisplay.action\")\n    form = page.forms[0]\n    form.field_with(id: \"userId\").value    = @user_id\n    form.field_with(id: \"password\").value  = @password\n    @agent.submit(form, form.buttons.first)\n  end\n\n  def wiki_url_list()\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/wiki/#{@from}/Home\")\n    wikipagelist = page.at('#wikipagelist')\n    @links = wikipagelist.search('a').map{|a|\n      a.attributes['href'].value\n    }\n  end\n\n  def wiki_html(link)\n    page  = @agent.get(\"https://#{@subdomain}.backlog.jp\" + link)\n    title = page.at('#mainTitle').text.gsub(/(\\n|\\t)/, '')\n    article = page.at('#loom').to_s\n    {title: title, article: article}\n  end\n\n  def to_markdown(html)\n    @converter = PandocRuby.new(html, :from => :html, :to => :markdown)\n    md = @converter.convert\n  end\n\n  def post_wiki (title, article)\n    page = @agent.get(\"https://#{@subdomain}.backlog.jp/NewWiki.action?projectKey=#{@to}\")\n    form = page.forms[3]\n    form.field_with(id: \"page.name\").value    = fronted_tag title\n    form.field_with(id: \"page.content\").value = work_around article\n    form.checkbox_with(name: 'mailNotify').uncheck\n    # binding.pry\n    @agent.submit(form, form.buttons.first)\n  end\n\n  def fronted_tag title\n    title.gsub!(/(.*?)(\\[.*\\])/, '\\2\\1')\n    title\n  end\n\n  def work_around text\n    text.gsub!(/^\\\\$\\n/,  '')\n    text.gsub!(/!\\[\\]/,  '![some_image]')\n    text\n  end\n\nend\n\nif __FILE__ == $0\n  i = Backlog2Markdown.new( ENV[\"USER_ID\"], ENV[\"PASS\"], ENV[\"SUBDOMAIN\"], ENV[\"FROM\"], ENV[\"TO\"])\n  i.login\n\n  links = i.wiki_url_list\n\n  links.each do |l|\n    wiki = i.wiki_html l\n    # binding.pry\n    md   = i.to_markdown wiki[:article]\n    puts wiki[:title]\n    i.post_wiki wiki[:title], md\n    sleep 3\n  end\nend\n```\n\n```rb:Gemfile\nsource \"https://rubygems.org\"\n\ngem \"mechanize\"\ngem 'pandoc-ruby'\ngem \"awesome_print\"\ngem \"pry\"\n```\n\n## \u5b9f\u884c\u65b9\u6cd5\npandoc\u306f\u4e88\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u5fc5\u8981\u306a\u5909\u6570\u306e\u8aac\u660e\n\n- USER_ID: \u30e6\u30fc\u30b6\u30fcID\n- PASS: \u30d1\u30b9\u30ef\u30fc\u30c9\n- SUBDOMAIN: XXXXX.backlog.jp\u306eXXXXX\u306e\u90e8\u5206\n- FROM: Backlog\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eID\n- TO: Markdown\u8a18\u6cd5\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eID\n\n\u74b0\u5883\u5909\u6570\u4f7f\u3046\u306e\u9762\u5012\u81ed\u304b\u3063\u305f\u3089\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u5b9f\u884c\n```shell-session\nbundle install\nUSER_ID=user_id PASS=password SUBDOMAIN=your_backlog_subdomain  FROM=backlog_prj  TO=markdown_prj bundle exec ruby backlog2markdown.rb\n```\n\n\u3044\u304d\u306a\u308a\u3084\u308b\u306e\u306f\u6016\u3044\u3068\u601d\u3046\u306e\u3067```binding.pry```\u3092\u631f\u3093\u3067\u5f90\u3005\u306b\u5024\u78ba\u8a8d\u3057\u3064\u3064\u5b9f\u884c\u3059\u308b\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3042\u3068Backlog\u304cView\u3092\u5909\u3048\u308b\u3068\u3059\u3050\u306b\u52d5\u304b\u306a\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u305d\u306e\u8fba\u306f\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\n## TODO\n- \u30c6\u30fc\u30d6\u30eb\u8a18\u6cd5\u304c\u5d29\u308c\u308b\n- \u30bd\u30fc\u30b9\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u306a\u3044\uff08\u8aad\u3081\u3070\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u304c\uff09", "tags": ["Ruby", "Pandoc", "backlog"]}