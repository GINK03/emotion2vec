{"context": " More than 1 year has passed since last update.mochalog\u304b\u3089\u306e\u8ee2\u8f09\u3067\u3059\u3002\n\nEntity Framework\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7ba1\u7406\u3092\u4efb\u305b\u308b\nSaveChanges()\u3084ExecuteSqlCommand()\u304c\u547c\u3070\u308c\u308b\u305f\u3073\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\nusing (var context = new SampleContext())\n{\n    // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n    context.Database.ExecuteSqlCommand(\n        \"UPDATE Samples SET Name = 'Hoge' WHERE Id= 1\"\n    );\n\n    context.Samples.Add(new Sample());\n    context.SaveChanges(); // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n\n    context.Samples.Add(new Sample());\n    context.SaveChanges(); // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n}\n\n\n\u81ea\u5206\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\nBeginTransaction()\u3067\u8907\u6570\u306eSaveChanges()\u3084ExecuteSqlCommand()\u306a\u3069\u3092\u3072\u3068\u3064\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\nusing (var context = new SampleContext())\nusing (var tran = context.Database.BeginTransaction()) // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n{\n    try {\n        context.Database.ExecuteSqlCommand(\n            \"UPDATE Samples SET Name = 'Hoge' WHERE Id = 1\"\n        );\n\n        context.Samples.Add(new Sample());\n        context.SaveChanges();\n\n        context.Samples.Add(new Sample());\n        context.SaveChanges();\n\n        tran.Commit();\n    }\n    catch (Exception)\n    {\n        tran.Rollback();\n        throw;\n    }\n}\n\nTransactionScope\u3092\u4f7f\u3063\u3066\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\nAzure SQL DB\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5206\u6563\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u3063\u305f\u308a\u3001\n\u5f8c\u8ff0\u306eUseTransaction\u3068\u7d44\u307f\u5408\u308f\u305b\u3089\u308c\u306a\u3044\u305f\u3081\u3001\nEntity Framework 6\u3067\u306fBeginTransaction()\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u65e2\u5b58\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\nUseTransaction()\u3067\u65e2\u5b58\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\nusing (var conn = new SqlConnection(\"...\")) \n{ \n    conn.Open(); \n\n    using (var tran = conn.BeginTransaction())  // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n    { \n        try {\n            var command = new SqlCommand(sql, conn, tran);\n            sqlCommand.ExecuteNonQuery();\n\n            using (var context = new SampleContext(\n                conn, contextOwnsConnection: false))\n            {\n                context.Database.UseTransaction(tran);\n\n                context.Samples.Add(new Sample());\n                context.SaveChanges();\n            }\n\n            tran.Commit();\n        }\n        catch (Exception)\n        {\n            tran.Rollback();\n            throw;\n        }\n    }\n}\n\n[mochalog](http://blog.mochaware.jp/20140208/471.html)\u304b\u3089\u306e\u8ee2\u8f09\u3067\u3059\u3002\n\n## Entity Framework\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7ba1\u7406\u3092\u4efb\u305b\u308b\n\nSaveChanges()\u3084ExecuteSqlCommand()\u304c\u547c\u3070\u308c\u308b\u305f\u3073\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n``` csharp\nusing (var context = new SampleContext())\n{\n    // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n    context.Database.ExecuteSqlCommand(\n        \"UPDATE Samples SET Name = 'Hoge' WHERE Id= 1\"\n    );\n\n    context.Samples.Add(new Sample());\n    context.SaveChanges(); // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n\n    context.Samples.Add(new Sample());\n    context.SaveChanges(); // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n}\n```\n\n## \u81ea\u5206\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\nBeginTransaction()\u3067\u8907\u6570\u306eSaveChanges()\u3084ExecuteSqlCommand()\u306a\u3069\u3092\u3072\u3068\u3064\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5185\u3067\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\n``` csharp\nusing (var context = new SampleContext())\nusing (var tran = context.Database.BeginTransaction()) // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n{\n    try {\n        context.Database.ExecuteSqlCommand(\n            \"UPDATE Samples SET Name = 'Hoge' WHERE Id = 1\"\n        );\n    \n        context.Samples.Add(new Sample());\n        context.SaveChanges();\n    \n        context.Samples.Add(new Sample());\n        context.SaveChanges();\n    \n        tran.Commit();\n    }\n    catch (Exception)\n    {\n        tran.Rollback();\n        throw;\n    }\n}\n```\n\nTransactionScope\u3092\u4f7f\u3063\u3066\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\nAzure SQL DB\u3067\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5206\u6563\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3042\u3063\u305f\u308a\u3001\n\u5f8c\u8ff0\u306eUseTransaction\u3068\u7d44\u307f\u5408\u308f\u305b\u3089\u308c\u306a\u3044\u305f\u3081\u3001\nEntity Framework 6\u3067\u306fBeginTransaction()\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n## \u65e2\u5b58\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\n\nUseTransaction()\u3067\u65e2\u5b58\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\n``` csharp\nusing (var conn = new SqlConnection(\"...\")) \n{ \n    conn.Open(); \n\n    using (var tran = conn.BeginTransaction())  // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n    { \n        try {\n            var command = new SqlCommand(sql, conn, tran);\n            sqlCommand.ExecuteNonQuery();\n    \n            using (var context = new SampleContext(\n                conn, contextOwnsConnection: false))\n            {\n                context.Database.UseTransaction(tran);\n    \n                context.Samples.Add(new Sample());\n                context.SaveChanges();\n            }\n\n            tran.Commit();\n        }\n        catch (Exception)\n        {\n            tran.Rollback();\n            throw;\n        }\n    }\n}\n```\n\n", "tags": ["EntityFramework6", "C#", ".NET"]}