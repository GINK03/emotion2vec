{"context": "\u3053\u306e\u8a18\u4e8b\u306fDistributed computing Advent Calendar8\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nHadoop\u3092\u306f\u3058\u3081\u3068\u3059\u308b\u5927\u898f\u6a21\u306a\u8a08\u7b97\u30ea\u30bd\u30fc\u30b9\u3092\u52b9\u7387\u3088\u304f\u4f7f\u3046\u306b\u306f\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304c\u5fc5\u8981\u3067\u3059\u3002\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3068\u3044\u3048\u3070YARN\u3084Mesos\u3068\u3044\u3063\u305f\u30b7\u30b9\u30c6\u30e0\u304c\u6709\u540d\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u52b9\u7387\u306e\u3088\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u5b9a\u7fa9\u3057\u305fDominant Resource Fairness\u3068\u3044\u3046\u8003\u3048\u65b9\u3068\u305d\u306eYARN\u4e0a\u3067\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\"Fairness\"\u306e\u96e3\u3057\u3055\n\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u306b\u9650\u3089\u305a\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306b\u304a\u3044\u3066\u76ee\u6a19\u3068\u3055\u308c\u308b\u3082\u306e\u306e\u3072\u3068\u3064\u3068\u3057\u3066\"Fairness\"\u304c\u3042\u308a\u307e\u3059\u3002\u66d6\u6627\u306a\u8a00\u8449\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u52b9\u7387\u306e\u3088\u3044\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u9650\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u8907\u6570\u306e\u30e6\u30fc\u30b6\u3001\u30bf\u30b9\u30af\u9593\u3067\u5171\u6709\u3057\u3066\u305d\u308c\u305e\u308c\u306e\u8981\u6c42\u3092\u6e80\u305f\u3057\u3064\u3064\u3001\u5168\u4f53\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3082\u3042\u3052\u3066\u3044\u304f\u3053\u3068\u304c\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u306b\u3069\u306e\u3088\u3046\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u632f\u308c\u3070\"Fair\"\u3068\u3044\u3048\u308b\u3088\u3046\u306a\u72b6\u6cc1\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u304b\u3002\n\u4f8b\u3048\u3070OS\u304c\u5404\u30d7\u30ed\u30bb\u30b9\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3068\u304d\u306f\u5404\u30d7\u30ed\u30bb\u30b9\u304c\u6d88\u8cbb\u3057\u3066\u3044\u308bCPU\u6642\u9593\u304c\uff08\u305d\u308c\u304c\u91cd\u307f\u3065\u304d\u3067\u3042\u308c\uff09\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u308b\u5834\u5408\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u3082\u7b49\u3057\u304fCPU\u304c\u4f7f\u3048\u308c\u3070\u76f4\u611f\u7684\u306b\u3082\"Fair\"\u306a\u611f\u3058\u304c\u3057\u307e\u3059\u3057\u3001\u591a\u304f\u306e\u5834\u5408\u4e0a\u624b\u304f\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304cCPU\u6642\u9593\u3068\u3044\u3046\u5358\u4e00\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5747\u7b49\u306b\u5206\u914d\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u305f\u3081\u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3082\u4e0a\u624b\u304f\u3044\u304f\u3088\u3046\u3067\u3059\u3002\n\u3067\u306fCPU\u3060\u3051\u3067\u306a\u304f\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u4f7f\u3046Memory, Disk, I/O\u306a\u3069\u306e\u8907\u6570\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u3092\u8003\u616e\u3057\u3066\"Fairness\"\u3092\u8003\u3048\u308b\u5834\u5408\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5404\u30e6\u30fc\u30b6\u3001\u30bf\u30b9\u30af\u306b\u3088\u3063\u3066\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u306f\u7570\u306a\u308b\u305f\u3081\u7c21\u5358\u306b\u306f\u8a08\u7b97\u3067\u304d\u306a\u3055\u305d\u3046\u3067\u3059\u3002\u4f8b\u3048\u3070<CPU, Memory>\u304c\u305d\u308c\u305e\u308c\u30c8\u30fc\u30bf\u30eb\u3067<10core, 10GB>\u306e\u30b7\u30b9\u30c6\u30e0\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u30e6\u30fc\u30b6A\u306f<1core, 5GB>, \u30e6\u30fc\u30b6B\u306f<5core, 2GB>\u3092\u8981\u6c42\u3059\u308b\u30bf\u30b9\u30af\u3092\u5e7e\u3064\u304b\u6295\u3052\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3044\u304f\u3064\u306e\u30bf\u30b9\u30af\u3092\u52d5\u304b\u305b\u3070\u30e6\u30fc\u30b6A\u3068\u30e6\u30fc\u30b6B\u306e\u30ea\u30bd\u30fc\u30b9\u5229\u7528\u306f\u201dFair\"\u306b\u306a\u308b\u3067\u3088\u3046\u304b\u3001core\u4f7f\u7528\u91cf\u304c\u534a\u3005\u306b\u306a\u308b\u3088\u3046\u306b\uff1f memory\u4f7f\u7528\u91cf\u304c\u534a\u3005\u306b\u306a\u308b\u3088\u3046\u306b\uff1f\n\u3053\u306e\u3088\u3046\u306a\u554f\u984c\u3092\u5e7e\u3064\u304b\u306e\u597d\u307e\u3057\u3044\u6027\u8cea\u3092\u5099\u3048\u3064\u3064\u5b9f\u73fe\u3057\u305f\u306e\u304cDominant Resource Fairness\u3068\u3044\u3046\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3059\u3002\n\nDominant Resource Fairness(DRF)\u3068\u306f?\nDRF\u306e\u8003\u3048\u65b9\u81ea\u4f53\u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u6bce\u306e\u30b7\u30b9\u30c6\u30e0\u306etotal capacity\u3092RRR (r1r1r_1, r2r2r_2\u306fCPU\u3068\u304bmemory\u306a\u3069\u3068\u8003\u3048\u3066\u304f\u3060\u3055\u3044)\nR = <r_1, r_2,...,r_m>\nR=<r1,r2,...,rm>R=<r1,r2,...,rm>{R = <r_1, r_2,...,r_m>\n}\n\u30e6\u30fc\u30b6iii\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u3092UiUiU_i\nU_i = <u_{i, 1}, u_{i, 2}, ..., u_{i, m}>\nUi=<ui,1,ui,2,...,ui,m>Ui=<ui,1,ui,2,...,ui,m>{U_i = <u_{i, 1}, u_{i, 2}, ..., u_{i, m}>\n}\n\u3068\u3057\u305f\u3068\u304d\u306b\u30e6\u30fc\u30b6iii\u306eDominant Share\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\ns_i = max_j \\{ u_{i, j} / r_{j} \\}\nsi=maxj{ui,j/rj}si=maxj{ui,j/rj}{s_i = max_j \\{ u_{i, j} / r_{j} \\}\n}\n\u3064\u307e\u308a\u30e6\u30fc\u30b6iii\u306e\u6d88\u8cbb\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u4e2d\u3067\u305d\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u5bfe\u3059\u308b\u5272\u5408\u304c\u6700\u3082\u9ad8\u3044\u3082\u306e\u306e\u6d88\u8cbb\u5272\u5408\u3092Dominant Share\u3068\u3088\u3073\u307e\u3059\u3002DRF\u3067\u306f\u3053\u306esisis_i\u304c\u5168\u30e6\u30fc\u30b6\u3067\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067CPU,Memory\u304c\u305d\u308c\u305e\u308c<9core, 18GB>\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u3066\u30e6\u30fc\u30b6A\u304cDA=DA=D_A=<1core, 4GB>\u3092xxx\u30bf\u30b9\u30af, \u30e6\u30fc\u30b6B\u304cDB=DB=D_B=<3core, 1GB>\u3092yyy\u30bf\u30b9\u30af\u306f\u3057\u3089\u305b\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\uff08\u3053\u308c\u3089\u3092Demand Vector\u3068\u3044\u3044\u307e\u3059\uff09\u3053\u306e\u3068\u304dDRF\u306b\u3088\u308b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306f\u4e0b\u8a18\u306e\u6700\u9069\u5316\u554f\u984c\u3092\u89e3\u304f\u3053\u3068\u3067\u5f97\u3089\u308c\u307e\u3059\u3002\n\\begin{align}\n&max(x, y) \\\\\n&subject\\ to \\\\\nx + 3y &\\leq 9\\ (CPU\\ constraint)\\\\\n4x + y &\\leq 18\\ (Memory\\ constraint)\\\\\n\\frac{2x}{9} &= \\frac{y}{3} \\ (Equalize\\ dominant\\ shares)\\\\\n\\end{align}\nmax(x,y)subject\u00a0tox+3y\u22649\u00a0(CPU\u00a0constraint)4x+y\u226418\u00a0(Memory\u00a0constraint)2x9=y3\u00a0(Equalize\u00a0dominant\u00a0shares)x+3y4x+y2x9max(x,y)subject\u00a0to\u22649\u00a0(CPU\u00a0constraint)\u226418\u00a0(Memory\u00a0constraint)=y3\u00a0(Equalize\u00a0dominant\u00a0shares){\\begin{align}\n&max(x, y) \\\\\n&subject\\ to \\\\\nx + 3y &\\leq 9\\ (CPU\\ constraint)\\\\\n4x + y &\\leq 18\\ (Memory\\ constraint)\\\\\n\\frac{2x}{9} &= \\frac{y}{3} \\ (Equalize\\ dominant\\ shares)\\\\\n\\end{align}\n}\n\u3053\u308c\u3092\u89e3\u304f\u3068x=3,y=2x=3,y=2x=3, y=2\u3068\u306a\u308a\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\nhttps://people.eecs.berkeley.edu/~alig/papers/drf.pdf\n\u3053\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3001\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u306e\u3067\u3059\u304c\u3001\u8ad6\u6587\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305f\u3088\u3046\u306a\u4ed6\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(Asset Fairness, CEEI)\u306b\u306f\u306a\u3044\u597d\u307e\u3057\u3044\u6027\u8cea\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u304c\u4e0b\u8a18\u306e4\u3064\u3067\u3059\u3002\n\nSharing Incentive\nStrategy-proofness\nEnvy-freeness\nPareto efficiency\n\n\nSharing Incentive\n\u30b7\u30b9\u30c6\u30e0\u3092\u5225\u500b\u306en\u500b\u306e\u30b7\u30b9\u30c6\u30e0\u306b\u5206\u3051\u308b\u3088\u308a\u3082\u3072\u3068\u3064\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3057\u305f\u65b9\u304c\u5f97\u3059\u308b\u3088\u3046\u306a\u6027\u8cea\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u793a\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\uff12\u4eba\u306e\u30e6\u30fc\u30b6\u304c\u3044\u308bR=<30,30>R=<30,30>R= <30, 30>\u3068\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u306b\u5bfe\u3057\u3066D1=<1,3>D1=<1,3>D_1 = <1, 3>,D2=<1,1>D2=<1,1>D_2=<1, 1>\u3092\u8981\u6c42\u3059\u308b\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u4f8b\u3048\u3070\u8ad6\u6587\u3067\u6bd4\u8f03\u3055\u308c\u3066\u3044\u308bAsset Fairness\u3068\u3044\u3046\u3059\u3079\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u4f7f\u7528\u3092\u8003\u616e\u3057\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u3046\u3068U1=<6,18>U1=<6,18>U_1=<6,18>,U2=<12,12>U2=<12,12>U_2=<12,12>\u3068\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u30e6\u30fc\u30b62\u306f\u3069\u3061\u3089\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u3082\u5358\u7d14\u306b\u30b7\u30b9\u30c6\u30e0\u3092\uff12\u5206\u5272\u3057\u3066\u5229\u7528\u3067\u304d\u308b\u306f\u305a\u306e<15,15><15,15><15, 15>\u3092\u5229\u7528\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8ab0\u304b\u3068\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3059\u308b\u304f\u3089\u3044\u306a\u3089\u5206\u5272\u3057\u3066\u3057\u307e\u3063\u305f\u65b9\u304c\u3044\u3044\u3068\u8003\u3048\u308b\u308f\u3051\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306a\u72b6\u6cc1\u306b\u9665\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u6027\u8cea\u304cSharing Incentive\u3067\u3059\u3002DRF\u306f\u3053\u308c\u3092\u6e80\u305f\u3057\u307e\u3059\u3002\n\nStrategy-proofness\n\u3060\u308c\u304b\u304c\u672c\u6765\u5fc5\u8981\u306a\u30bd\u30fc\u30b9\u4ee5\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u507d\u3063\u3066\u8981\u6c42\u3057\u305f\u5834\u5408\u3001\u5f97\u3092\u3059\u308b\u3068\u306f\u9650\u3089\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u306e\u304cStrategy-proofness\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u30b7\u30b9\u30c6\u30e0\u306e\u30ea\u30bd\u30fc\u30b9\u304cR=<100,100>R=<100,100>R=<100,100>\u306e\u3068\u304d\u306b\u3001\u30e6\u30fc\u30b6\uff11\u304cD1=<16,1>D1=<16,1>D_1=<16,1>, \u30e6\u30fc\u30b62\u304cD2=<1,2>D2=<1,2>D_2=<1,2>\u3092\u8981\u6c42\u3057\u305f\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u4f8b\u3048\u3070CEEI\u3068\u3044\u3046\u30df\u30af\u30ed\u7d4c\u6e08\u5b66\u306e\u5747\u8861\u7406\u8ad6\u306b\u57fa\u3065\u3044\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u7528\u3059\u308b\u3068\u30e6\u30fc\u30b61, \u30e6\u30fc\u30b62\u3078\u306e\u5272\u5f53\u3066\u30bf\u30b9\u30af\u306f\u305d\u308c\u305e\u308c10031\u22483.210031\u22483.2\\frac{100}{31} \\approx 3.2\u3068150031\u224848.8150031\u224848.8\\frac{1500}{31}\\approx48.8\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u30e6\u30fc\u30b61\u304c\u507d\u3063\u3066D1=<16,8>D1=<16,8>D_1=<16,8>\u3092\u8981\u6c42\u3059\u308b\u3068CEEI\u306f\u305d\u308c\u305e\u308c256\u22484.2256\u22484.2\\frac{25}{6}\\approx4.2\u30681003\u224833.31003\u224833.3\\frac{100}{3}\\approx33.3\u3068\u306a\u308a\u7d14\u7c8b\u306b\u30e6\u30fc\u30b6A\u3078\u306e\u5272\u5f53\u304c\u5897\u3048\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nDRF\u3067\u306f\u3053\u306e\u3088\u3046\u306b\u5618\u3064\u304d\u304c\u5f97\u3092\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u304c\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u203b\u305f\u3060\u3057Strategy-proofness\u306b\u95a2\u3057\u3066\u306f\u5143\u8ad6\u6587\u306b\u66f8\u3044\u3066\u3042\u308b\u524d\u63d0\u304c\u79c1\u3082\u7406\u89e3\u3057\u304d\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u8ad6\u6587\u3060\u3068Strategy-proofness\u306f\u300c\u306f\u3058\u3081\u306b\u8981\u6c42\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u9014\u4e2d\u304b\u3089\u5897\u3084\u3057\u3066\u3082\u5272\u5f53\u304c\u5897\u3048\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u300d\u3068\u3044\u3046\u610f\u5473\u306b\u8aad\u3081\u307e\u3057\u305f\u3002\u6700\u521d\u304b\u3089\u5618\u3092\u3064\u3044\u3066\u30ea\u30bd\u30fc\u30b9\u8981\u6c42\u3057\u305f\u5834\u5408\u306b\u306f\u305d\u308c\u306b\u57fa\u3065\u3044\u3066DRF\u3092\u8a08\u7b97\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u3082\u305d\u3082\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304b\u3089\u898b\u3066\u6700\u521d\u304b\u3089\u5618\u3092\u3064\u3044\u3066\u8981\u6c42\u3092\u3057\u3066\u304d\u305f\u30e6\u30fc\u30b6\u3092\u898b\u7834\u308b\u3088\u3046\u306a\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u6c17\u304c\u3059\u308b\u306e\u3067\u3001\u3053\u306e\u3088\u3046\u306a\u524d\u63d0\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nEnvy-freeness\n\u4ed6\u4eba\u3092\u3046\u3089\u3084\u3080\u3053\u3068\u304c\u306a\u3044\u3002\u8ad6\u6587\u306e\u4e2d\u3067\u306f\u4ed6\u306e\u30e6\u30fc\u30b6\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3042\u3089\u3086\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30a7\u30a2\u304c\u81ea\u5206\u306e\u30b7\u30a7\u30a2\u3088\u308a\u3082\u591a\u3044\u5834\u5408\u304c\u306a\u3044\u72b6\u614b\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u30ea\u30bd\u30fc\u30b9\u5272\u308a\u5f53\u3066\u304c\u305d\u308c\u305e\u308cU1=<1,4>U1=<1,4>U_1 = <1, 4>\u3068U2=<2,6>U2=<2,6>U_2 = <2, 6>\u306e\u5834\u5408\u30e6\u30fc\u30b61\u306f\u30e6\u30fc\u30b62\u306e\u5272\u308a\u5f53\u3066\u3067Dominant Share\u3092\u7d14\u5897\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001Envy\u306b\u601d\u3046\u306f\u305a\u3067\u3059\u3002\n\nPareto efficiency\n\u30d1\u30ec\u30fc\u30c8\u6700\u9069\u3068\u3044\u3046\u7d4c\u6e08\u5b66\u306e\u6982\u5ff5\u3092\u6307\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u8ab0\u304b\u4ed6\u306e\u4eba\u306e\u30ea\u30bd\u30fc\u30b9\u30b7\u30a7\u30a2\u3092\u4e0b\u3052\u306a\u3044\u9650\u308a\u81ea\u5206\u306e\u30ea\u30bd\u30fc\u30b9\u30b7\u30a7\u30a2\u3092\u4e0a\u3052\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u72b6\u6cc1\u304c\u8ab0\u306b\u3068\u3063\u3066\u3082\u6210\u308a\u7acb\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3092\u6307\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u6301\u3066\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u52b9\u7387\u7684\u306b\u4f7f\u3048\u3066\u3044\u308b\u3068\u8003\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u4ed6\u306b\u3082\u5358\u8abf\u6027\u3068\u3044\u3046\u30b7\u30b9\u30c6\u30e0\u30ea\u30bd\u30fc\u30b9\u5897\u3084\u3057\u305f\u3089\u307f\u3093\u306a\u306e\u5272\u5f53\u3082\u5897\u3048\u308b\u3068\u304b\u3001\u30e6\u30fc\u30b6\u6e1b\u3063\u305f\u3089\u307f\u3093\u306a\u306e\u5272\u5f53\u5897\u3048\u308b\u3068\u3044\u3063\u305f\u597d\u307e\u3057\u3044\u6027\u8cea\u3082\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\u3067\u306f\u6b21\u306b\u4e0a\u8a18\u306e\u6027\u8cea\u306e\u4e2d\u3067\u6700\u3082\u91cd\u8981\u305d\u3046\uff08\u4e14\u3064\u9762\u767d\u305d\u3046\u306a\uff09Pareto efficiency\u306b\u3064\u3044\u3066\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\nProgressive filling\n\u307e\u305aDRF\u304c\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3057\u3066\u3069\u306e\u3088\u3046\u306b\u66f8\u304d\u4e0b\u3055\u308c\u308b\u304b\u793a\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nAlgorithm1: DRF pseudo-code\nDominant Share\u304c\u4e00\u756a\u4f4e\u3044\u30e6\u30fc\u30b6\u306e\u30bf\u30b9\u30af\u3092\u3072\u3068\u3064\u305a\u3064\u53d6\u308a\u51fa\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3059\u306d\u3002\u3053\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306fDemand Vector\u306escaling\u3055\u3048\u3059\u308c\u3070min-max scheduling\u3067\u7528\u3044\u3089\u308c\u308bProgressive filling\u3068\u3044\u3046\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u540c\u3058\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u306a\u308a\u307e\u3059\u3002Progressive filling\u306e\u5927\u304d\u306a\u7279\u5fb4\u306f\u5404\u30e6\u30fc\u30b6\u306eDominant Share\u304c\u56fa\u5b9a\u306e\u5272\u5408\u3067\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u3067\u3059\u3002\u56fa\u5b9a\u306e\u5272\u5408\u3067Dominant Share\u3092\u5f90\u3005\u306b\u5897\u3084\u3057\u3066\u3044\u304d\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u3067\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u3063\u305f\u3001\u3064\u307e\u308a\u30b7\u30b9\u30c6\u30e0\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3044\u5207\u3063\u305f\u6642\u70b9\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u7d42\u4e86\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u30e6\u30fc\u30b6iii\u306e\u8981\u6c42\u3059\u308b\u30ea\u30bd\u30fc\u30b9DiDiD_i\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nD_i = <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\nDi=<di,1,di,2,...,di,m>Di=<di,1,di,2,...,di,m>{D_i = <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\n}\nrkrkr_k\u3092\u3053\u306e\u30e6\u30fc\u30b6\u306eDominant Resource\u3068\u3059\u308b\u3068Dominant Share\u306f\ns_i = \\frac{d_{i, k}}{r_k}\nsi=di,krksi=di,krk{s_i = \\frac{d_{i, k}}{r_k}\n}\n\u3068\u306a\u308a\u307e\u3059\u3002rkrkr_k\u306f\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002Algorithm1\u306e\u30e6\u30fc\u30b6iii\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\nD_i^\\prime = \\frac{\\epsilon}{s_i} D_i = \\frac{\\epsilon}{s_i} <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\nD\u2032i=\u03f5siDi=\u03f5si<di,1,di,2,...,di,m>{D_i^\\prime = \\frac{\\epsilon}{s_i} D_i = \\frac{\\epsilon}{s_i} <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\n}\n\u03f5\\epsilon\u306f\u4efb\u610f\u306e\u5b9a\u6570\u3067\u3059\u3002\u3053\u306eD\u2032iD_i^\\prime\u3092\u5404\u30a4\u30c6\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u306e\u5272\u5f53\u3066\u3068\u3059\u308b\u3068\u6bce\u56deDominant Resource\u306f\u03f5sidi,k=\u03f5rk\\frac{\\epsilon}{s_i}d_{i, k} = \\epsilon r_k\u306e\u5206\u3060\u3051\u5897\u3048\u307e\u3059\u3002(\u30e6\u30fc\u30b6ii\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u304c\u56fa\u5b9a\u306e\u5834\u5408Dominant Resource\u306e\u30bf\u30a4\u30d7\u306f\u5909\u308f\u3089\u306a\u3044\u305f\u3081)\u3064\u307e\u308a\u3001Dominant Share\u306f(\u03f5rk)/rk=\u03f5(\\epsilon r_k) / r_k = \\epsilon\u306e\u4e00\u5b9a\u306e\u5206\u3060\u3051\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u4e00\u822c\u306b\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u3067\u6210\u308a\u7acb\u3061Progressive filling\u306e\u5927\u304d\u306a\u7279\u5fb4\u3068\u306a\u308a\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3053\u306eProgressive filling\u3067\u5b9f\u88c5\u3055\u308c\u305fDRF\u306ePareto efficiency\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\u307e\u305a\u5fc5\u8981\u306a\u88dc\u984c\u3092\u3072\u3068\u3064\u8003\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\nDRF\u3067\u306e\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3067\u306f\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u5c11\u306a\u304f\u3068\u3082\u3072\u3068\u3064\u306e\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306b\u5272\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\n\n\u4ecaProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3057\u307e\u3059\u3002\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9(Saturated Resource)\u3068\u3044\u3046\u306e\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u9650\u754c\u307e\u3067\u5272\u5f53\u305f\u3063\u3066\u3057\u307e\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u3053\u3068\u3067\u3059\u3002\u3064\u307e\u308a\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u5c11\u306a\u304f\u3068\u3082\u3053\u308c\u4ee5\u4e0a\u3069\u3046\u3084\u3063\u3066\u3082\u5897\u3084\u305b\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u3092\u80cc\u7406\u6cd5\u3067\u793a\u3057\u3066\u307f\u307e\u3059\u3002\u3064\u307e\u308a\u3042\u308b\u30e6\u30fc\u30b6ii\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u307e\u3060\u4f59\u88d5\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u307f\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306b\u306f\u3053\u306e\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066Dominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u3053\u308c\u306fProgressive filling\u306e\u524d\u63d0\u3068\u77db\u76fe\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u306a\u305c\u306a\u3089Progressive filling\u306f\u5168\u30e6\u30fc\u30b6\u306eDominant Share\u304c\u5897\u3084\u305b\u306a\u304f\u306a\u3063\u305f\u6642\u70b9\u3067\u7d42\u4e86\u3059\u308b\u304b\u3089\u3067\u3059\u3002\u3053\u308c\u306fProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3044\u3046\u3053\u3068\u3068\u77db\u76fe\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u306f\u30b7\u30b9\u30c6\u30e0\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u5c11\u306a\u304f\u3068\u3082\uff11\u3064\u306f\u8981\u6c42\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u88dc\u984c\u3092\u3082\u3068\u306bPareto efficiency\u3092\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\nDRF\u306fPareto efficient\u3067\u3042\u308b\n\nProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u30e6\u30fc\u30b6ii\u306fDominant Share, sis_i\u3092\u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\u4e0a\u8a18\u306e\u88dc\u984c\u304b\u3089\u30e6\u30fc\u30b6ii\u306f\u5c11\u306a\u304f\u3068\u3082\u30b7\u30b9\u30c6\u30e0\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9(rkr_k)\u3092\u5c11\u306a\u304f\u3068\u3082\u3072\u3068\u3064\u8981\u6c42\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u4ee5\u4e0b\u306e2\u30d1\u30bf\u30fc\u30f3\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n1) \u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u3082rkr_k\u3092\u8981\u6c42\u3057\u3066\u3044\u306a\u3044 -> rkr_k\u306f\u3059\u3079\u3066\u30e6\u30fc\u30b6ii\u304c\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u4ee5\u4e0a\u5897\u3084\u3057\u3088\u3046\u304c\u306a\u3044\n2) rkr_k\u3092\u8981\u6c42\u3059\u308b\u30e6\u30fc\u30b6\u304c\u3044\u308b -> \u30e6\u30fc\u30b6ii\u306erkr_k\u5272\u5f53\u3066\u3092\u5897\u3084\u3059\u3068\u3001\u4ed6\u306e\u30e6\u30fc\u30b6jj\u306erkr_k\u3078\u306e\u5272\u5f53\u3066\u3092\u6e1b\u3089\u3059\u3053\u3068\u306b\u306a\u308b\u3002\nProgressive filling\u306e\u4e0b\u3067\u306f\u5404\u30e6\u30fc\u30b6\u3078\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u306f\u305d\u306e\u30e6\u30fc\u30b6\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u306b\u6bd4\u4f8b\u3057\u305f\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\nU_i = \\sigma D_i\nUi=\u03c3Di{U_i = \\sigma D_i\n}\n\u3064\u307e\u308a\u30e6\u30fc\u30b6jj\u3078\u306e\u4efb\u610f\u306e\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u3066\u3092\u6e1b\u3089\u3059\u3053\u3068\u306f\u304b\u306a\u3089\u305aDominant Resource\u3078\u306e\u5272\u5f53\u3066\u3082\u6e1b\u3089\u3059\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002Dominant Resource\u3078\u306e\u5272\u5f53\u3066\u304c\u6e1b\u3063\u305f\u30e6\u30fc\u30b6jj\u306eDominant Share\u306f\u4e0b\u304c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3053\u308c\u306f\u30e6\u30fc\u30b6ii\u304c\u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u81ea\u8eab\u306eDominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u4eee\u5b9a\u306b\u77db\u76fe\u3057\u307e\u3059\u3002\u3088\u3063\u3066\u4ed6\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u81ea\u8eab\u306eDominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u304cPareto efficiency\u306e\u5b9a\u7fa9\u3067\u3057\u305f\u3002\n\u3053\u306e\u4ed6\u306b\u3082Sharing incentive\u3084Envy-freeness\u306b\u8a3c\u660e\u3082\u5143\u8ad6\u6587\u306b\u306e\u3063\u3066\u3044\u308b\u306e\u3067\u662f\u975e\u8208\u5473\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u898b\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nYARN\u306b\u304a\u3051\u308bDRF\n\u3053\u3053\u307e\u3067\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3053\u306eDRF\u304cYARN\u3067\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u307e\u3059\u3002YARN\u306b\u306f\u7d44\u307f\u8fbc\u307f\u3067FifoScheduler, FairScheduler, CapacityScheduler\u306e3\u3064\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u3046\u3061FairScheduler\u3068CapacityScheduler\u306f\u5185\u90e8\u306b\u30ad\u30e5\u30fc\u3092\u6301\u3063\u3066\u3044\u3066\u30e6\u30fc\u30b6\u3001\u90e8\u7f72\u306a\u3069\u6bce\u306b\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30ad\u30e5\u30fc\u3001\u30bf\u30b9\u30af\u6bce\u306e\u5272\u5f53\u3066\u3092\u6c7a\u3081\u308b\u306e\u304cSchedulingPolicy\u3067\"fifo\"/\"fair\"/\"drf\"\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u73fe\u72b6\u8907\u6570\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306fFairScheduler\u306e\u307f\u306e\u3088\u3046\u3067\u3059\u3002\u7c21\u5358\u306b\u3044\u3046\u3068\n\n\"fifo\": \u65e9\u3044\u3082\u306e\u9806\n\"fair\": Memory\u3060\u3051\u8003\u616e\u3057\u305fmin-max scheduling\n\"drf\": Memory, CPU\u3092\u8003\u616e\u3057\u305fdominant resource fair scheduling\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\"fair\"\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001DRF\u3092\u4f7f\u3046\u306b\u306ffair-scheduler.xml\u306e\u30ad\u30e5\u30fc\u30a8\u30f3\u30c8\u30ea\u306eschedulingPolicy\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8a73\u7d30\u306f\u65e5\u672c\u8a9e\u3067\u3057\u305f\u3089[\u7ffb\u8a33]Hadoop: Fair Scheduler\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nDRF\u306e\u8a08\u7b97\u3092\u62c5\u3046\u306e\u306fDominantResourceFairnessPolicy\u3068\u3044\u3046\u30af\u30e9\u30b9\u3067\u3053\u306eAPI\u3092\u3056\u3063\u304f\u308a\u898b\u3066\u307f\u308b\u3068\npublic class DominantResourceFairnessPolicy extends SchedulingPolicy {\n  @Override\n  // Schedulable\u306e\u30bd\u30fc\u30c8\u3092\u62c5\u3046\u3002Container Allocation\u7528\n  public Comparator<Schedulable> getComparator();\n\n  @Override\n  // \u4e0e\u3048\u3089\u308c\u305fSchedulable\u306e\u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3002\u4e3b\u306b\u66f4\u65b0\u7528\n  public void computeShares(Collection<? extends Schedulable> schedulables,\n      Resource totalResources);\n}\n\nSchedulable\u3068\u3044\u3046\u306e\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306e\u512a\u5148\u9806\u4f4d\u3092\u8003\u3048\u308b\u5bfe\u8c61\u3067\u5b9f\u4f53\u306f\u30ad\u30e5\u30fc\u3042\u308b\u3044\u306fYARN\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u3057\u307e\u3059\u3002Comparator<Schedulable>\u306fSchedulable\u540c\u58eb\u306e\u5927\u5c0f\u3092\u6bd4\u8f03\u3001computeShares\u306f\u30ad\u30e5\u30fc\u3042\u308b\u3044\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53d7\u3051\u53d6\u3063\u3066\u305d\u308c\u305e\u308c\u306e\u30b7\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\u30ea\u30bd\u30fc\u30b9\u8981\u6c42\u304c\u3042\u3063\u3066\u5b9f\u969b\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5272\u308a\u5f53\u3066\u308b\u306e\u306fFairScheduler#attemptScheduling\u3067\u884c\u308f\u308c\u307e\u3059\u3002\n  @VisibleForTesting\n  void attemptScheduling(FSSchedulerNode node) {\n    // ...\n    Resource assignment = queueMgr.getRootQueue().assignContainer(node);\n    // ...\n  }\n\n\u30ad\u30e5\u30fc\u306f\u30c4\u30ea\u30fc\u4e0a\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u3053\u3067\u30eb\u30fc\u30c8\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066assignContainer\u3092\u547c\u3076\u3053\u3068\u3067\u5b50\u306e\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066\u518d\u5e30\u7684\u306b\u3088\u3070\u308c\u3066\u3044\u304f\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6df1\u3055\u512a\u5148\u3067\u6700\u3082Dominant Share\u304c\u5c0f\u3055\u3044\u30ad\u30e5\u30fc\u3092\u63a2\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u5b50\u304c\u3044\u308b\u30ad\u30e5\u30fc(FSParentQueue)\u3067\u306f\n  @Override\n  public Resource assignContainer(FSSchedulerNode node) {\n    Resource assigned = Resources.none();\n    // ...\n    // Hold the write lock when sorting childQueues\n    writeLock.lock();\n    try {\n      // \u5b50\u30ad\u30e5\u30fc\u3092DRF policy\u306b\u57fa\u3044\u3066\u30bd\u30fc\u30c8\u3059\u308b\u3002\u3053\u306e\u3068\u304dDominant Share\u304c\u5c0f\u3055\u3044\u3082\u306e\u304c\u5148\u982d\u306b\u304f\u308b\n      Collections.sort(childQueues, policy.getComparator());\n    } finally {\n      writeLock.unlock();\n    }\n\n    // \u5b50\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066\u5272\u5f53\u3066\u3092\u9806\u756a\u306b\u8a66\u3057\u3066\u3044\u304f\n    readLock.lock();\n    try {\n      for (FSQueue child : childQueues) {\n        assigned = child.assignContainer(node);\n        if (!Resources.equals(assigned, Resources.none())) {\n          break;\n        }\n      }\n    } finally {\n      readLock.unlock();\n    }\n    return assigned;\n  }\n\n\u8449\u3068\u306a\u308b\u30ad\u30e5\u30fc(FSLeafQueue)\u3067\u306f\n  @Override\n  public Resource assignContainer(FSSchedulerNode node) {\n    Resource assigned = none();\n    // ...\n\n    // \u3053\u306e\u30ad\u30e5\u30fc\u306bsubmit\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 FSAppAttempt\u3082Schedulable\u3002\n    // fetchAppsWithDemand\u3067\u5185\u90e8\u7684\u306b\u30bd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\n    for (FSAppAttempt sched : fetchAppsWithDemand()) {\n      if (SchedulerAppUtils.isPlaceBlacklisted(sched, node, LOG)) {\n        continue;\n      }\n      assigned = sched.assignContainer(node);\n      if (!assigned.equals(none())) {\n        if (LOG.isDebugEnabled()) {\n          LOG.debug(\"Assigned container in queue:\" + getName() + \" \" +\n              \"container:\" + assigned);\n        }\n        // \u5272\u5f53\u3066\u304c\u8d77\u3053\u3063\u305f\u3089\u3053\u3053\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u7d42\u4e86\n        break;\n      }\n    }\n    return assigned;\n  }\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u5168\u4f53\u50cf\u3068\u3057\u3066\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nroot\u306e\u5b50\u30ad\u30e5\u30fc\u3092Dominant Share\u3067\u30bd\u30fc\u30c8\u3057\u3066\u4e00\u756a\u5c0f\u3055\u3044\u3082\u306e\u3092\u9078\u3076\u3001\u307e\u305f\u305d\u306e\u30ad\u30e5\u30fc\u306b\u5b50\u304c\u3044\u305f\u3089\u30bd\u30fc\u30c8\u3057\u3066\u5c0f\u3055\u3044\u3082\u306e\u3092\u9078\u3076\u3002Leaf\u307e\u3067\u3076\u3061\u5f53\u305f\u3063\u305f\u3089\u305d\u306e\u4e2d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30bd\u30fc\u30c8\u3057\u3066\u4e00\u756aDominant Share\u304c\u5c0f\u3055\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u30ea\u30bd\u30fc\u30b9(Container)\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u4e0a\u306e\u56f3\u3067\u793a\u3055\u308c\u3066\u3044\u308b\u6570\u5b57\u306f\u5404\u30ad\u30e5\u30fc\u306eDominant Share\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u304c\u3001Dominant Share\u306f\u7570\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30a7\u30a2\u540c\u58eb\u306e\u6bd4\u8f03\u3092\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u5fc5\u305a\u3057\u3082\u5404\u968e\u5c64\u3067\u8db3\u3057\u3066100%\u306b\u306f\u306a\u308a\u307e\u305b\u3093\u3002\n\u6700\u5f8c\u306b\u3053\u306eDRF\u306b\u57fa\u3044\u3066\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u90e8\u5206\u3092\u898b\u3066\u307f\u307e\u3059\u3002\u3053\u306e\u30bd\u30fc\u30c8\u306fDominantResourceFairnessComparator\u304c\u62c5\u3063\u3066\u304a\u308a\u3001Comparatorinterface\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u306e\u3067TreeSet\u306a\u3069\u306b\u7d44\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6838\u3068\u306a\u308bcompare\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n    @Override\n    public int compare(Schedulable s1, Schedulable s2) {\n      // ResourceWeights\u306fMemory, CPU\u305d\u308c\u305e\u308c\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u91cd\u307f\u3092\u8003\u616e\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n      ResourceWeights sharesOfCluster1 = new ResourceWeights();\n      ResourceWeights sharesOfCluster2 = new ResourceWeights();\n      // \u305d\u308c\u305e\u308c\u306eMinimum\u306a\u30ea\u30bd\u30fc\u30b9\n      ResourceWeights sharesOfMinShare1 = new ResourceWeights();\n      ResourceWeights sharesOfMinShare2 = new ResourceWeights();\n      // \u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306b\u5bfe\u3059\u308b\u30b7\u30a7\u30a2\u3067\u30bd\u30fc\u30c8\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3002Dominant Share\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u308f\u304b\u308a\u307e\u3059\n      ResourceType[] resourceOrder1 = new ResourceType[NUM_RESOURCES];\n      ResourceType[] resourceOrder2 = new ResourceType[NUM_RESOURCES];\n\n      // \u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3059\u308b\u3002\u8a73\u7d30\u306b\u95a2\u3057\u3066\u306f\u5f8c\u8ff0\u3002\n      // Memory, CPU\u306e\u91cd\u307f\u4ed8\u304d\u30b7\u30a7\u30a2\u304c\u964d\u9806\u306b\u30bd\u30fc\u30c8\u3055\u308csharesOfCluster*, resourceOrder*\u306b\u5165\u308c\u3089\u308c\u307e\u3059\u3002\n      calculateShares(s1.getResourceUsage(),\n          clusterCapacity, sharesOfCluster1, resourceOrder1, s1.getWeights());\n      // Miminum\u8a08\u7b97\u3059\u308b\u3068\u304d\u306f\u91cd\u307f\u3092\u305d\u308c\u305e\u308c1\u306b\u3057\u3066\u3044\u307e\u3059\n      calculateShares(s1.getResourceUsage(),\n          s1.getMinShare(), sharesOfMinShare1, null, ResourceWeights.NEUTRAL);\n      calculateShares(s2.getResourceUsage(),\n          clusterCapacity, sharesOfCluster2, resourceOrder2, s2.getWeights());\n      calculateShares(s2.getResourceUsage(),\n          s2.getMinShare(), sharesOfMinShare2, null, ResourceWeights.NEUTRAL);\n\n      // Dominant Share\u304cMinimum\u3055\u3048\u6e80\u305f\u3057\u3066\u3044\u306a\u3044\u5834\u5408\n      boolean s1Needy = sharesOfMinShare1.getWeight(resourceOrder1[0]) < 1.0f;\n      boolean s2Needy = sharesOfMinShare2.getWeight(resourceOrder2[0]) < 1.0f;\n\n      int res = 0;\n      if (!s2Needy && !s1Needy) {\n        // \u305d\u308c\u305e\u308c\u306e\u6bd4\u8f03\u3002\u8a73\u7d30\u306f\u5f8c\u8ff0\u3002\n        res = compareShares(sharesOfCluster1, sharesOfCluster2,\n            resourceOrder1, resourceOrder2);\n      } else if (s1Needy && !s2Needy) {\n        // Minimum\u3092\u6e80\u305f\u3057\u3066\u3044\u306a\u3044s1\u3092\u5148\u306b\n        res = -1;\n      } else if (s2Needy && !s1Needy) {\n        // Minimum\u3092\u6e80\u305f\u3057\u3066\u3044\u306a\u3044s2\u3092\u5148\u306b\n        res = 1;\n      } else { // both are needy below min share\n        res = compareShares(sharesOfMinShare1, sharesOfMinShare2,\n            resourceOrder1, resourceOrder2);\n      }\n      if (res == 0) {\n        // Dominant Share\u304c\u540c\u3058\u5834\u5408\u306f\u65e9\u3044\u3082\u306e\u52dd\u3061\n        res = (int)(s1.getStartTime() - s2.getStartTime());\n      }\n      return res;\n    }\n\ncalculateShares\u306e\u5b9f\u88c5\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002Memory\u3068CPU\u306b\u95a2\u3057\u3066\u91cd\u307f\u3092\u8003\u616e\u3057\u305f\u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3057\u3001Dominant Share\u304c\u5927\u304d\u3044\u9806\u306b\u4e26\u3073\u304b\u3048\u3066\u3044\u307e\u3059\u3002\n    void calculateShares(Resource resource, Resource pool,\n        ResourceWeights shares, ResourceType[] resourceOrder, ResourceWeights weights) {\n      // Memory\u306e\u91cd\u307f\u4ed8\u304dShare\n      shares.setWeight(MEMORY, (float)resource.getMemorySize() /\n          (pool.getMemorySize() * weights.getWeight(MEMORY)));\n      // CPU\u306e\u91cd\u307f\u4ed8\u304dShare\n      shares.setWeight(CPU, (float)resource.getVirtualCores() /\n          (pool.getVirtualCores() * weights.getWeight(CPU)));\n      // share\u304c\u5927\u304d\u3044\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u9806\u306b\u4e26\u3073\u66ff\u3048\u308b\n      if (resourceOrder != null) {\n        if (shares.getWeight(MEMORY) > shares.getWeight(CPU)) {\n          resourceOrder[0] = MEMORY;\n          resourceOrder[1] = CPU;\n        } else  {\n          resourceOrder[0] = CPU;\n          resourceOrder[1] = MEMORY;\n        }\n      }\n    }\n\n\u305d\u3057\u3066compare\u3059\u308b\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3002\u305d\u308c\u305e\u308c\u306eDominant Share\u306f\u308f\u304b\u3063\u305f\u306e\u3067\u3001\u9806\u756a\u306b\u6bd4\u8f03\u3059\u308b\u3060\u3051\u3002\n    private int compareShares(ResourceWeights shares1, ResourceWeights shares2,\n        ResourceType[] resourceOrder1, ResourceType[] resourceOrder2) {\n      for (int i = 0; i < resourceOrder1.length; i++) {\n        // Dominant Share\u540c\u58eb\u3092\u6bd4\u8f03\n        int ret = (int)Math.signum(shares1.getWeight(resourceOrder1[i])\n            - shares2.getWeight(resourceOrder2[i]));\n        if (ret != 0) {\n          return ret;\n        }\n      }\n      return 0;\n    }\n\nDominant Share\u304c\u540c\u3058\u5834\u5408\u306b\u306f\u6b21\u306bDominant\u306aResource\u306eShare\u3092\u6bd4\u8f03\u3057\u307e\u3059\u3002\u3053\u308c\u3067\u6700\u3082Dominant Share\u304c\u4f4e\u3044\u30ad\u30e5\u30fc\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5f97\u3089\u308c\u308b\u306e\u3067\u3053\u3044\u3064\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3042\u3052\u307e\u3059\u3002DRF\u81ea\u4f53\u306f\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u304c\u3044\u304f\u3064\u3042\u3063\u3066\u3082\u6bd4\u8f03\u3067\u304d\u308b\u4e00\u822c\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3059\u304c\u3001YARN\u306eDominantResouceFairnessPolicy\u306fMemory, CPU\u306b\u95a2\u3057\u3066\u30d9\u30bf\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\nYARN\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3001\u8a73\u7d30\u307e\u3067\u306f\u8ffd\u3048\u3066\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001DRF\u3068\u3044\u3046\u7814\u7a76\u306b\u57fa\u3044\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306bDRF\u306f\u540c\u3058\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3067\u3042\u308bMesos\u306b\u3082\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3092Mesos\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0\u3067\u77e5\u308a\u307e\u3057\u305f\u3002\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u306e\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u52c9\u5f37\u3057\u305f\u3044\u65b9\u306b\u3068\u3063\u3066\u306f\u3068\u3066\u3082\u3088\u3044\u52c9\u5f37\u4f1a\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u7167\n\nMin-max fairness\nDominant Resource Fairness: Fair Allocation of Multiple Resource Types, Ali Ghodsi\nMANAGING CPU RESOURCES IN YOUR HADOOP YARN CLUSTERS, hortonworks.com\nPareto efficieny\nMesos\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\u3053\u306e\u8a18\u4e8b\u306f[Distributed computing Advent Calendar](http://qiita.com/advent-calendar/2016/distributed-computing)8\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nHadoop\u3092\u306f\u3058\u3081\u3068\u3059\u308b\u5927\u898f\u6a21\u306a\u8a08\u7b97\u30ea\u30bd\u30fc\u30b9\u3092\u52b9\u7387\u3088\u304f\u4f7f\u3046\u306b\u306f\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304c\u5fc5\u8981\u3067\u3059\u3002\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3068\u3044\u3048\u3070YARN\u3084Mesos\u3068\u3044\u3063\u305f\u30b7\u30b9\u30c6\u30e0\u304c\u6709\u540d\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u52b9\u7387\u306e\u3088\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u5b9a\u7fa9\u3057\u305fDominant Resource Fairness\u3068\u3044\u3046\u8003\u3048\u65b9\u3068\u305d\u306eYARN\u4e0a\u3067\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \"Fairness\"\u306e\u96e3\u3057\u3055\n\n\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u306b\u9650\u3089\u305a\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306b\u304a\u3044\u3066\u76ee\u6a19\u3068\u3055\u308c\u308b\u3082\u306e\u306e\u3072\u3068\u3064\u3068\u3057\u3066\"Fairness\"\u304c\u3042\u308a\u307e\u3059\u3002\u66d6\u6627\u306a\u8a00\u8449\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u52b9\u7387\u306e\u3088\u3044\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u9650\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u8907\u6570\u306e\u30e6\u30fc\u30b6\u3001\u30bf\u30b9\u30af\u9593\u3067\u5171\u6709\u3057\u3066\u305d\u308c\u305e\u308c\u306e\u8981\u6c42\u3092\u6e80\u305f\u3057\u3064\u3064\u3001\u5168\u4f53\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3082\u3042\u3052\u3066\u3044\u304f\u3053\u3068\u304c\u6c42\u3081\u3089\u308c\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u306b\u3069\u306e\u3088\u3046\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u632f\u308c\u3070\"Fair\"\u3068\u3044\u3048\u308b\u3088\u3046\u306a\u72b6\u6cc1\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u304b\u3002\n\n\u4f8b\u3048\u3070OS\u304c\u5404\u30d7\u30ed\u30bb\u30b9\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3068\u304d\u306f\u5404\u30d7\u30ed\u30bb\u30b9\u304c\u6d88\u8cbb\u3057\u3066\u3044\u308bCPU\u6642\u9593\u304c\uff08\u305d\u308c\u304c\u91cd\u307f\u3065\u304d\u3067\u3042\u308c\uff09\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u308b\u5834\u5408\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u3082\u7b49\u3057\u304fCPU\u304c\u4f7f\u3048\u308c\u3070\u76f4\u611f\u7684\u306b\u3082\"Fair\"\u306a\u611f\u3058\u304c\u3057\u307e\u3059\u3057\u3001\u591a\u304f\u306e\u5834\u5408\u4e0a\u624b\u304f\u3044\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304cCPU\u6642\u9593\u3068\u3044\u3046**\u5358\u4e00\u306e\u30ea\u30bd\u30fc\u30b9**\u3092\u5747\u7b49\u306b\u5206\u914d\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u305f\u3081\u30b7\u30f3\u30d7\u30eb\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3082\u4e0a\u624b\u304f\u3044\u304f\u3088\u3046\u3067\u3059\u3002\n\n\u3067\u306fCPU\u3060\u3051\u3067\u306a\u304f\u3001\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u4f7f\u3046Memory, Disk, I/O\u306a\u3069\u306e**\u8907\u6570\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e**\u3092\u8003\u616e\u3057\u3066\"Fairness\"\u3092\u8003\u3048\u308b\u5834\u5408\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5404\u30e6\u30fc\u30b6\u3001\u30bf\u30b9\u30af\u306b\u3088\u3063\u3066\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u306f\u7570\u306a\u308b\u305f\u3081\u7c21\u5358\u306b\u306f\u8a08\u7b97\u3067\u304d\u306a\u3055\u305d\u3046\u3067\u3059\u3002\u4f8b\u3048\u3070\\<CPU, Memory\\>\u304c\u305d\u308c\u305e\u308c\u30c8\u30fc\u30bf\u30eb\u3067<10core, 10GB>\u306e\u30b7\u30b9\u30c6\u30e0\u304c\u3042\u3063\u305f\u3068\u3057\u3066\u30e6\u30fc\u30b6A\u306f<1core, 5GB>, \u30e6\u30fc\u30b6B\u306f<5core, 2GB>\u3092\u8981\u6c42\u3059\u308b\u30bf\u30b9\u30af\u3092\u5e7e\u3064\u304b\u6295\u3052\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3044\u304f\u3064\u306e\u30bf\u30b9\u30af\u3092\u52d5\u304b\u305b\u3070\u30e6\u30fc\u30b6A\u3068\u30e6\u30fc\u30b6B\u306e\u30ea\u30bd\u30fc\u30b9\u5229\u7528\u306f\u201dFair\"\u306b\u306a\u308b\u3067\u3088\u3046\u304b\u3001core\u4f7f\u7528\u91cf\u304c\u534a\u3005\u306b\u306a\u308b\u3088\u3046\u306b\uff1f memory\u4f7f\u7528\u91cf\u304c\u534a\u3005\u306b\u306a\u308b\u3088\u3046\u306b\uff1f\n\n\u3053\u306e\u3088\u3046\u306a\u554f\u984c\u3092\u5e7e\u3064\u304b\u306e\u597d\u307e\u3057\u3044\u6027\u8cea\u3092\u5099\u3048\u3064\u3064\u5b9f\u73fe\u3057\u305f\u306e\u304c**Dominant Resource Fairness**\u3068\u3044\u3046\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3059\u3002\n\n# Dominant Resource Fairness(DRF)\u3068\u306f?\n\nDRF\u306e\u8003\u3048\u65b9\u81ea\u4f53\u306f\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n\u30ea\u30bd\u30fc\u30b9\u306e\u7a2e\u985e\u6bce\u306e\u30b7\u30b9\u30c6\u30e0\u306etotal capacity\u3092$R$ ($r_1$, $r_2$\u306fCPU\u3068\u304bmemory\u306a\u3069\u3068\u8003\u3048\u3066\u304f\u3060\u3055\u3044)\n\n```math\nR = <r_1, r_2,...,r_m>\n```\n\n\u30e6\u30fc\u30b6$i$\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u3092$U_i$\n\n```math\nU_i = <u_{i, 1}, u_{i, 2}, ..., u_{i, m}>\n```\n\n\u3068\u3057\u305f\u3068\u304d\u306b\u30e6\u30fc\u30b6$i$\u306eDominant Share\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```math\ns_i = max_j \\{ u_{i, j} / r_{j} \\}\n```\n\n\u3064\u307e\u308a\u30e6\u30fc\u30b6$i$\u306e\u6d88\u8cbb\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u4e2d\u3067\u305d\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u5bfe\u3059\u308b\u5272\u5408\u304c\u6700\u3082\u9ad8\u3044\u3082\u306e\u306e\u6d88\u8cbb\u5272\u5408\u3092Dominant Share\u3068\u3088\u3073\u307e\u3059\u3002DRF\u3067\u306f\u3053\u306e$s_i$\u304c\u5168\u30e6\u30fc\u30b6\u3067\u5747\u7b49\u306b\u306a\u308b\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067CPU,Memory\u304c\u305d\u308c\u305e\u308c<9core, 18GB>\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3068\u3057\u3066\u30e6\u30fc\u30b6A\u304c$D_A=$<1core, 4GB>\u3092$x$\u30bf\u30b9\u30af, \u30e6\u30fc\u30b6B\u304c$D_B=$<3core, 1GB>\u3092$y$\u30bf\u30b9\u30af\u306f\u3057\u3089\u305b\u3088\u3046\u3068\u3057\u3066\u3044\u307e\u3059\u3002\uff08\u3053\u308c\u3089\u3092Demand Vector\u3068\u3044\u3044\u307e\u3059\uff09\u3053\u306e\u3068\u304dDRF\u306b\u3088\u308b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306f\u4e0b\u8a18\u306e\u6700\u9069\u5316\u554f\u984c\u3092\u89e3\u304f\u3053\u3068\u3067\u5f97\u3089\u308c\u307e\u3059\u3002\n\n```math\n\\begin{align}\n&max(x, y) \\\\\n&subject\\ to \\\\\nx + 3y &\\leq 9\\ (CPU\\ constraint)\\\\\n4x + y &\\leq 18\\ (Memory\\ constraint)\\\\\n\\frac{2x}{9} &= \\frac{y}{3} \\ (Equalize\\ dominant\\ shares)\\\\\n\\end{align}\n```\n\n\u3053\u308c\u3092\u89e3\u304f\u3068$x=3, y=2$\u3068\u306a\u308a\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\n<img width=\"500\" alt=\"Screen Shot 2016-12-03 at 16.45.35.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/7129/aad031a9-a2b3-a937-dc5d-0e289f5bccef.png\">\n<figcaption>https://people.eecs.berkeley.edu/~alig/papers/drf.pdf</figcaption>\n\n\u3053\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3001\u3068\u3066\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u306e\u3067\u3059\u304c\u3001\u8ad6\u6587\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305f\u3088\u3046\u306a\u4ed6\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(Asset Fairness, CEEI)\u306b\u306f\u306a\u3044\u597d\u307e\u3057\u3044\u6027\u8cea\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u304c\u4e0b\u8a18\u306e4\u3064\u3067\u3059\u3002\n\n* Sharing Incentive\n* Strategy-proofness\n* Envy-freeness\n* Pareto efficiency\n\n## Sharing Incentive\n\n\u30b7\u30b9\u30c6\u30e0\u3092\u5225\u500b\u306en\u500b\u306e\u30b7\u30b9\u30c6\u30e0\u306b\u5206\u3051\u308b\u3088\u308a\u3082\u3072\u3068\u3064\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3057\u305f\u65b9\u304c\u5f97\u3059\u308b\u3088\u3046\u306a\u6027\u8cea\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u793a\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\uff12\u4eba\u306e\u30e6\u30fc\u30b6\u304c\u3044\u308b$R= <30, 30>$\u3068\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u306b\u5bfe\u3057\u3066$D_1 = <1, 3>$,$D_2=<1, 1>$\u3092\u8981\u6c42\u3059\u308b\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u4f8b\u3048\u3070\u8ad6\u6587\u3067\u6bd4\u8f03\u3055\u308c\u3066\u3044\u308bAsset Fairness\u3068\u3044\u3046\u3059\u3079\u3066\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u4f7f\u7528\u3092\u8003\u616e\u3057\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u3046\u3068$U_1=<6,18>$,$U_2=<12,12>$\u3068\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u30e6\u30fc\u30b62\u306f\u3069\u3061\u3089\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u3082\u5358\u7d14\u306b\u30b7\u30b9\u30c6\u30e0\u3092\uff12\u5206\u5272\u3057\u3066\u5229\u7528\u3067\u304d\u308b\u306f\u305a\u306e$<15, 15>$\u3092\u5229\u7528\u3067\u304d\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8ab0\u304b\u3068\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u6709\u3059\u308b\u304f\u3089\u3044\u306a\u3089\u5206\u5272\u3057\u3066\u3057\u307e\u3063\u305f\u65b9\u304c\u3044\u3044\u3068\u8003\u3048\u308b\u308f\u3051\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306a\u72b6\u6cc1\u306b\u9665\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u6027\u8cea\u304cSharing Incentive\u3067\u3059\u3002DRF\u306f\u3053\u308c\u3092\u6e80\u305f\u3057\u307e\u3059\u3002\n\n## Strategy-proofness\n\n\u3060\u308c\u304b\u304c\u672c\u6765\u5fc5\u8981\u306a\u30bd\u30fc\u30b9\u4ee5\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u507d\u3063\u3066\u8981\u6c42\u3057\u305f\u5834\u5408\u3001\u5f97\u3092\u3059\u308b\u3068\u306f\u9650\u3089\u306a\u3044\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u306e\u304cStrategy-proofness\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u30b7\u30b9\u30c6\u30e0\u306e\u30ea\u30bd\u30fc\u30b9\u304c$R=<100,100>$\u306e\u3068\u304d\u306b\u3001\u30e6\u30fc\u30b6\uff11\u304c$D_1=<16,1>$, \u30e6\u30fc\u30b62\u304c$D_2=<1,2>$\u3092\u8981\u6c42\u3057\u305f\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u4f8b\u3048\u3070CEEI\u3068\u3044\u3046\u30df\u30af\u30ed\u7d4c\u6e08\u5b66\u306e\u5747\u8861\u7406\u8ad6\u306b\u57fa\u3065\u3044\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u7528\u3059\u308b\u3068\u30e6\u30fc\u30b61, \u30e6\u30fc\u30b62\u3078\u306e\u5272\u5f53\u3066\u30bf\u30b9\u30af\u306f\u305d\u308c\u305e\u308c$\\frac{100}{31} \\approx 3.2$\u3068$\\frac{1500}{31}\\approx48.8$\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u30e6\u30fc\u30b61\u304c\u507d\u3063\u3066$D_1=<16,8>$\u3092\u8981\u6c42\u3059\u308b\u3068CEEI\u306f\u305d\u308c\u305e\u308c$\\frac{25}{6}\\approx4.2$\u3068$\\frac{100}{3}\\approx33.3$\u3068\u306a\u308a\u7d14\u7c8b\u306b\u30e6\u30fc\u30b6A\u3078\u306e\u5272\u5f53\u304c\u5897\u3048\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nDRF\u3067\u306f\u3053\u306e\u3088\u3046\u306b\u5618\u3064\u304d\u304c\u5f97\u3092\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u304c\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u203b\u305f\u3060\u3057Strategy-proofness\u306b\u95a2\u3057\u3066\u306f\u5143\u8ad6\u6587\u306b\u66f8\u3044\u3066\u3042\u308b\u524d\u63d0\u304c\u79c1\u3082\u7406\u89e3\u3057\u304d\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u8ad6\u6587\u3060\u3068Strategy-proofness\u306f\u300c\u306f\u3058\u3081\u306b\u8981\u6c42\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u9014\u4e2d\u304b\u3089\u5897\u3084\u3057\u3066\u3082\u5272\u5f53\u304c\u5897\u3048\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u300d\u3068\u3044\u3046\u610f\u5473\u306b\u8aad\u3081\u307e\u3057\u305f\u3002\u6700\u521d\u304b\u3089\u5618\u3092\u3064\u3044\u3066\u30ea\u30bd\u30fc\u30b9\u8981\u6c42\u3057\u305f\u5834\u5408\u306b\u306f\u305d\u308c\u306b\u57fa\u3065\u3044\u3066DRF\u3092\u8a08\u7b97\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u305d\u3082\u305d\u3082\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u304b\u3089\u898b\u3066\u6700\u521d\u304b\u3089\u5618\u3092\u3064\u3044\u3066\u8981\u6c42\u3092\u3057\u3066\u304d\u305f\u30e6\u30fc\u30b6\u3092\u898b\u7834\u308b\u3088\u3046\u306a\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u6c17\u304c\u3059\u308b\u306e\u3067\u3001\u3053\u306e\u3088\u3046\u306a\u524d\u63d0\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## Envy-freeness\n\n\u4ed6\u4eba\u3092\u3046\u3089\u3084\u3080\u3053\u3068\u304c\u306a\u3044\u3002\u8ad6\u6587\u306e\u4e2d\u3067\u306f\u4ed6\u306e\u30e6\u30fc\u30b6\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3042\u3089\u3086\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30a7\u30a2\u304c\u81ea\u5206\u306e\u30b7\u30a7\u30a2\u3088\u308a\u3082\u591a\u3044\u5834\u5408\u304c\u306a\u3044\u72b6\u614b\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u30ea\u30bd\u30fc\u30b9\u5272\u308a\u5f53\u3066\u304c\u305d\u308c\u305e\u308c$U_1 = <1, 4>$\u3068$U_2 = <2, 6>$\u306e\u5834\u5408\u30e6\u30fc\u30b61\u306f\u30e6\u30fc\u30b62\u306e\u5272\u308a\u5f53\u3066\u3067Dominant Share\u3092\u7d14\u5897\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001Envy\u306b\u601d\u3046\u306f\u305a\u3067\u3059\u3002\n\n## Pareto efficiency\n\n\u30d1\u30ec\u30fc\u30c8\u6700\u9069\u3068\u3044\u3046\u7d4c\u6e08\u5b66\u306e\u6982\u5ff5\u3092\u6307\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u8ab0\u304b\u4ed6\u306e\u4eba\u306e\u30ea\u30bd\u30fc\u30b9\u30b7\u30a7\u30a2\u3092\u4e0b\u3052\u306a\u3044\u9650\u308a\u81ea\u5206\u306e\u30ea\u30bd\u30fc\u30b9\u30b7\u30a7\u30a2\u3092\u4e0a\u3052\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u72b6\u6cc1\u304c\u8ab0\u306b\u3068\u3063\u3066\u3082\u6210\u308a\u7acb\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3092\u6307\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u6301\u3066\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u52b9\u7387\u7684\u306b\u4f7f\u3048\u3066\u3044\u308b\u3068\u8003\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u306e\u4ed6\u306b\u3082\u5358\u8abf\u6027\u3068\u3044\u3046\u30b7\u30b9\u30c6\u30e0\u30ea\u30bd\u30fc\u30b9\u5897\u3084\u3057\u305f\u3089\u307f\u3093\u306a\u306e\u5272\u5f53\u3082\u5897\u3048\u308b\u3068\u304b\u3001\u30e6\u30fc\u30b6\u6e1b\u3063\u305f\u3089\u307f\u3093\u306a\u306e\u5272\u5f53\u5897\u3048\u308b\u3068\u3044\u3063\u305f\u597d\u307e\u3057\u3044\u6027\u8cea\u3082\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n\u3067\u306f\u6b21\u306b\u4e0a\u8a18\u306e\u6027\u8cea\u306e\u4e2d\u3067\u6700\u3082\u91cd\u8981\u305d\u3046\uff08\u4e14\u3064\u9762\u767d\u305d\u3046\u306a\uff09Pareto efficiency\u306b\u3064\u3044\u3066\u8003\u3048\u3066\u307f\u307e\u3059\u3002\n\n# Progressive filling\n\n\u307e\u305aDRF\u304c\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u3057\u3066\u3069\u306e\u3088\u3046\u306b\u66f8\u304d\u4e0b\u3055\u308c\u308b\u304b\u793a\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n<img width=\"500\" alt=\"progressive filling\" src=\"https://qiita-image-store.s3.amazonaws.com/0/7129/16a3ddfa-f8fa-4f53-53ac-2e1f2acf9335.png\">\n<figcaption>Algorithm1: DRF pseudo-code</figcaption>\n\nDominant Share\u304c\u4e00\u756a\u4f4e\u3044\u30e6\u30fc\u30b6\u306e\u30bf\u30b9\u30af\u3092\u3072\u3068\u3064\u305a\u3064\u53d6\u308a\u51fa\u3057\u3066\u3044\u304f\u3060\u3051\u3067\u3059\u306d\u3002\u3053\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306fDemand Vector\u306escaling\u3055\u3048\u3059\u308c\u3070min-max scheduling\u3067\u7528\u3044\u3089\u308c\u308bProgressive filling\u3068\u3044\u3046\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u540c\u3058\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u306a\u308a\u307e\u3059\u3002Progressive filling\u306e\u5927\u304d\u306a\u7279\u5fb4\u306f\u5404\u30e6\u30fc\u30b6\u306eDominant Share\u304c\u56fa\u5b9a\u306e\u5272\u5408\u3067\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u3067\u3059\u3002\u56fa\u5b9a\u306e\u5272\u5408\u3067Dominant Share\u3092\u5f90\u3005\u306b\u5897\u3084\u3057\u3066\u3044\u304d\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u3067\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u3063\u305f\u3001\u3064\u307e\u308a\u30b7\u30b9\u30c6\u30e0\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3044\u5207\u3063\u305f\u6642\u70b9\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u7d42\u4e86\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u30e6\u30fc\u30b6$i$\u306e\u8981\u6c42\u3059\u308b\u30ea\u30bd\u30fc\u30b9$D_i$\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```math\nD_i = <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\n```\n\n$r_k$\u3092\u3053\u306e\u30e6\u30fc\u30b6\u306eDominant Resource\u3068\u3059\u308b\u3068Dominant Share\u306f\n\n```math\ns_i = \\frac{d_{i, k}}{r_k}\n```\n\n\u3068\u306a\u308a\u307e\u3059\u3002$r_k$\u306f\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002Algorithm1\u306e\u30e6\u30fc\u30b6$i$\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n```math\nD_i^\\prime = \\frac{\\epsilon}{s_i} D_i = \\frac{\\epsilon}{s_i} <d_{i,1}, d_{i, 2}, ..., d_{i, m}>\n```\n\n$\\epsilon$\u306f\u4efb\u610f\u306e\u5b9a\u6570\u3067\u3059\u3002\u3053\u306e$D_i^\\prime$\u3092\u5404\u30a4\u30c6\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u306e\u5272\u5f53\u3066\u3068\u3059\u308b\u3068\u6bce\u56deDominant Resource\u306f$\\frac{\\epsilon}{s_i}d_{i, k} = \\epsilon r_k$\u306e\u5206\u3060\u3051\u5897\u3048\u307e\u3059\u3002(\u30e6\u30fc\u30b6$i$\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u304c\u56fa\u5b9a\u306e\u5834\u5408Dominant Resource\u306e\u30bf\u30a4\u30d7\u306f\u5909\u308f\u3089\u306a\u3044\u305f\u3081)\u3064\u307e\u308a\u3001Dominant Share\u306f$(\\epsilon r_k) / r_k = \\epsilon$\u306e\u4e00\u5b9a\u306e\u5206\u3060\u3051\u5897\u3048\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u4e00\u822c\u306b\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u3067\u6210\u308a\u7acb\u3061Progressive filling\u306e\u5927\u304d\u306a\u7279\u5fb4\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3053\u306eProgressive filling\u3067\u5b9f\u88c5\u3055\u308c\u305fDRF\u306ePareto efficiency\u3092\u8003\u3048\u3066\u307f\u307e\u3059\u3002\u307e\u305a\u5fc5\u8981\u306a\u88dc\u984c\u3092\u3072\u3068\u3064\u8003\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n> DRF\u3067\u306e\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3067\u306f\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u5c11\u306a\u304f\u3068\u3082\u3072\u3068\u3064\u306e\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u306b\u5272\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\n\n\u4ecaProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3057\u307e\u3059\u3002**\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9(Saturated Resource)**\u3068\u3044\u3046\u306e\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u9650\u754c\u307e\u3067\u5272\u5f53\u305f\u3063\u3066\u3057\u307e\u3063\u305f\u30ea\u30bd\u30fc\u30b9\u306e\u3053\u3068\u3067\u3059\u3002\u3064\u307e\u308a\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u304c\u5c11\u306a\u304f\u3068\u3082\u3053\u308c\u4ee5\u4e0a\u3069\u3046\u3084\u3063\u3066\u3082\u5897\u3084\u305b\u306a\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u3092\u80cc\u7406\u6cd5\u3067\u793a\u3057\u3066\u307f\u307e\u3059\u3002\u3064\u307e\u308a\u3042\u308b\u30e6\u30fc\u30b6$i$\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u307e\u3060\u4f59\u88d5\u306e\u3042\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u307f\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u3068\u3057\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306b\u306f\u3053\u306e\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066Dominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001\u3053\u308c\u306fProgressive filling\u306e\u524d\u63d0\u3068\u77db\u76fe\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u306a\u305c\u306a\u3089Progressive filling\u306f\u5168\u30e6\u30fc\u30b6\u306eDominant Share\u304c\u5897\u3084\u305b\u306a\u304f\u306a\u3063\u305f\u6642\u70b9\u3067\u7d42\u4e86\u3059\u308b\u304b\u3089\u3067\u3059\u3002\u3053\u308c\u306fProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3044\u3046\u3053\u3068\u3068\u77db\u76fe\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u306f\u30b7\u30b9\u30c6\u30e0\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3092\u5c11\u306a\u304f\u3068\u3082\uff11\u3064\u306f\u8981\u6c42\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u88dc\u984c\u3092\u3082\u3068\u306bPareto efficiency\u3092\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n> DRF\u306fPareto efficient\u3067\u3042\u308b\n\nProgressive filling\u3067\u306eDRF\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u304c\u5b8c\u4e86\u3057\u305f\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u30e6\u30fc\u30b6$i$\u306fDominant Share, $s_i$\u3092\u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\u4e0a\u8a18\u306e\u88dc\u984c\u304b\u3089\u30e6\u30fc\u30b6$i$\u306f\u5c11\u306a\u304f\u3068\u3082\u30b7\u30b9\u30c6\u30e0\u30ad\u30e3\u30d1\u30b7\u30c6\u30a3\u306b\u5bfe\u3057\u3066\u98fd\u548c\u3057\u305f\u30ea\u30bd\u30fc\u30b9($r_k$)\u3092\u5c11\u306a\u304f\u3068\u3082\u3072\u3068\u3064\u8981\u6c42\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u4ee5\u4e0b\u306e2\u30d1\u30bf\u30fc\u30f3\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n1) \u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u3082$r_k$\u3092\u8981\u6c42\u3057\u3066\u3044\u306a\u3044 -> $r_k$\u306f\u3059\u3079\u3066\u30e6\u30fc\u30b6$i$\u304c\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u4ee5\u4e0a\u5897\u3084\u3057\u3088\u3046\u304c\u306a\u3044\n2) $r_k$\u3092\u8981\u6c42\u3059\u308b\u30e6\u30fc\u30b6\u304c\u3044\u308b -> \u30e6\u30fc\u30b6$i$\u306e$r_k$\u5272\u5f53\u3066\u3092\u5897\u3084\u3059\u3068\u3001\u4ed6\u306e\u30e6\u30fc\u30b6$j$\u306e$r_k$\u3078\u306e\u5272\u5f53\u3066\u3092\u6e1b\u3089\u3059\u3053\u3068\u306b\u306a\u308b\u3002\n\nProgressive filling\u306e\u4e0b\u3067\u306f\u5404\u30e6\u30fc\u30b6\u3078\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u306f\u305d\u306e\u30e6\u30fc\u30b6\u306e\u8981\u6c42\u30ea\u30bd\u30fc\u30b9\u306b\u6bd4\u4f8b\u3057\u305f\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n\n```math\nU_i = \\sigma D_i\n```\n\n\u3064\u307e\u308a\u30e6\u30fc\u30b6$j$\u3078\u306e\u4efb\u610f\u306e\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u3066\u3092\u6e1b\u3089\u3059\u3053\u3068\u306f\u304b\u306a\u3089\u305aDominant Resource\u3078\u306e\u5272\u5f53\u3066\u3082\u6e1b\u3089\u3059\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002Dominant Resource\u3078\u306e\u5272\u5f53\u3066\u304c\u6e1b\u3063\u305f\u30e6\u30fc\u30b6$j$\u306eDominant Share\u306f\u4e0b\u304c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3053\u308c\u306f\u30e6\u30fc\u30b6$i$\u304c\u4ed6\u306e\u3069\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u81ea\u8eab\u306eDominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u4eee\u5b9a\u306b\u77db\u76fe\u3057\u307e\u3059\u3002\u3088\u3063\u3066\u4ed6\u306e\u30e6\u30fc\u30b6\u306eDominant Share\u3092\u6e1b\u3089\u3059\u3053\u3068\u306a\u304f\u81ea\u8eab\u306eDominant Share\u3092\u5897\u3084\u3059\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u304cPareto efficiency\u306e\u5b9a\u7fa9\u3067\u3057\u305f\u3002\n\n\u3053\u306e\u4ed6\u306b\u3082Sharing incentive\u3084Envy-freeness\u306b\u8a3c\u660e\u3082\u5143\u8ad6\u6587\u306b\u306e\u3063\u3066\u3044\u308b\u306e\u3067\u662f\u975e\u8208\u5473\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u898b\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n# YARN\u306b\u304a\u3051\u308bDRF\n\n\u3053\u3053\u307e\u3067\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3053\u306eDRF\u304cYARN\u3067\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u304b\u898b\u3066\u307f\u307e\u3059\u3002YARN\u306b\u306f\u7d44\u307f\u8fbc\u307f\u3067FifoScheduler, FairScheduler, CapacityScheduler\u306e3\u3064\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u3046\u3061FairScheduler\u3068CapacityScheduler\u306f\u5185\u90e8\u306b\u30ad\u30e5\u30fc\u3092\u6301\u3063\u3066\u3044\u3066\u30e6\u30fc\u30b6\u3001\u90e8\u7f72\u306a\u3069\u6bce\u306b\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30ad\u30e5\u30fc\u3001\u30bf\u30b9\u30af\u6bce\u306e\u5272\u5f53\u3066\u3092\u6c7a\u3081\u308b\u306e\u304cSchedulingPolicy\u3067\"fifo\"/\"fair\"/\"drf\"\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u73fe\u72b6\u8907\u6570\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306fFairScheduler\u306e\u307f\u306e\u3088\u3046\u3067\u3059\u3002\u7c21\u5358\u306b\u3044\u3046\u3068\n\n- \"fifo\": \u65e9\u3044\u3082\u306e\u9806\n- \"fair\": Memory\u3060\u3051\u8003\u616e\u3057\u305fmin-max scheduling\n- \"drf\": Memory, CPU\u3092\u8003\u616e\u3057\u305fdominant resource fair scheduling\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\"fair\"\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001DRF\u3092\u4f7f\u3046\u306b\u306f[fair-scheduler.xml](https://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/FairScheduler.html#Allocation_file_format)\u306e\u30ad\u30e5\u30fc\u30a8\u30f3\u30c8\u30ea\u306e`schedulingPolicy`\u3092\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8a73\u7d30\u306f\u65e5\u672c\u8a9e\u3067\u3057\u305f\u3089[\\[\u7ffb\u8a33\\]Hadoop: Fair Scheduler](http://qiita.com/shiumachi/items/afbb777b83689d07f3a0)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nDRF\u306e\u8a08\u7b97\u3092\u62c5\u3046\u306e\u306f`DominantResourceFairnessPolicy`\u3068\u3044\u3046\u30af\u30e9\u30b9\u3067\u3053\u306eAPI\u3092\u3056\u3063\u304f\u308a\u898b\u3066\u307f\u308b\u3068\n\n```java\npublic class DominantResourceFairnessPolicy extends SchedulingPolicy {\n  @Override\n  // Schedulable\u306e\u30bd\u30fc\u30c8\u3092\u62c5\u3046\u3002Container Allocation\u7528\n  public Comparator<Schedulable> getComparator();\n\n  @Override\n  // \u4e0e\u3048\u3089\u308c\u305fSchedulable\u306e\u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3002\u4e3b\u306b\u66f4\u65b0\u7528\n  public void computeShares(Collection<? extends Schedulable> schedulables,\n      Resource totalResources);\n}\n```\n\n`Schedulable`\u3068\u3044\u3046\u306e\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306e\u512a\u5148\u9806\u4f4d\u3092\u8003\u3048\u308b\u5bfe\u8c61\u3067\u5b9f\u4f53\u306f\u30ad\u30e5\u30fc\u3042\u308b\u3044\u306fYARN\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u3057\u307e\u3059\u3002`Comparator<Schedulable>`\u306f`Schedulable`\u540c\u58eb\u306e\u5927\u5c0f\u3092\u6bd4\u8f03\u3001`computeShares`\u306f\u30ad\u30e5\u30fc\u3042\u308b\u3044\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53d7\u3051\u53d6\u3063\u3066\u305d\u308c\u305e\u308c\u306e\u30b7\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\u30ea\u30bd\u30fc\u30b9\u8981\u6c42\u304c\u3042\u3063\u3066\u5b9f\u969b\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5272\u308a\u5f53\u3066\u308b\u306e\u306f`FairScheduler#attemptScheduling`\u3067\u884c\u308f\u308c\u307e\u3059\u3002\n\n```java\n  @VisibleForTesting\n  void attemptScheduling(FSSchedulerNode node) {\n    // ...\n    Resource assignment = queueMgr.getRootQueue().assignContainer(node);\n    // ...\n  }\n```\n\n\u30ad\u30e5\u30fc\u306f\u30c4\u30ea\u30fc\u4e0a\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u3053\u3067\u30eb\u30fc\u30c8\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066`assignContainer`\u3092\u547c\u3076\u3053\u3068\u3067\u5b50\u306e\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066\u518d\u5e30\u7684\u306b\u3088\u3070\u308c\u3066\u3044\u304f\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6df1\u3055\u512a\u5148\u3067\u6700\u3082Dominant Share\u304c\u5c0f\u3055\u3044\u30ad\u30e5\u30fc\u3092\u63a2\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u5b50\u304c\u3044\u308b\u30ad\u30e5\u30fc(`FSParentQueue`)\u3067\u306f\n\n```java\n  @Override\n  public Resource assignContainer(FSSchedulerNode node) {\n    Resource assigned = Resources.none();\n    // ...\n    // Hold the write lock when sorting childQueues\n    writeLock.lock();\n    try {\n      // \u5b50\u30ad\u30e5\u30fc\u3092DRF policy\u306b\u57fa\u3044\u3066\u30bd\u30fc\u30c8\u3059\u308b\u3002\u3053\u306e\u3068\u304dDominant Share\u304c\u5c0f\u3055\u3044\u3082\u306e\u304c\u5148\u982d\u306b\u304f\u308b\n      Collections.sort(childQueues, policy.getComparator());\n    } finally {\n      writeLock.unlock();\n    }\n\n    // \u5b50\u30ad\u30e5\u30fc\u306b\u5bfe\u3057\u3066\u5272\u5f53\u3066\u3092\u9806\u756a\u306b\u8a66\u3057\u3066\u3044\u304f\n    readLock.lock();\n    try {\n      for (FSQueue child : childQueues) {\n        assigned = child.assignContainer(node);\n        if (!Resources.equals(assigned, Resources.none())) {\n          break;\n        }\n      }\n    } finally {\n      readLock.unlock();\n    }\n    return assigned;\n  }\n```\n\n\u8449\u3068\u306a\u308b\u30ad\u30e5\u30fc(`FSLeafQueue`)\u3067\u306f\n\n```java\n  @Override\n  public Resource assignContainer(FSSchedulerNode node) {\n    Resource assigned = none();\n    // ...\n\n    // \u3053\u306e\u30ad\u30e5\u30fc\u306bsubmit\u3055\u308c\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 FSAppAttempt\u3082Schedulable\u3002\n    // fetchAppsWithDemand\u3067\u5185\u90e8\u7684\u306b\u30bd\u30fc\u30c8\u3055\u308c\u3066\u3044\u308b\n    for (FSAppAttempt sched : fetchAppsWithDemand()) {\n      if (SchedulerAppUtils.isPlaceBlacklisted(sched, node, LOG)) {\n        continue;\n      }\n      assigned = sched.assignContainer(node);\n      if (!assigned.equals(none())) {\n        if (LOG.isDebugEnabled()) {\n          LOG.debug(\"Assigned container in queue:\" + getName() + \" \" +\n              \"container:\" + assigned);\n        }\n        // \u5272\u5f53\u3066\u304c\u8d77\u3053\u3063\u305f\u3089\u3053\u3053\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u7d42\u4e86\n        break;\n      }\n    }\n    return assigned;\n  }\n```\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u5168\u4f53\u50cf\u3068\u3057\u3066\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n<img width=\"500\" alt=\"Screen Shot 2016-12-06 at 15.06.20.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/7129/24ed19dd-e1c5-d56e-48ec-99f5031db2c2.png\">\n\nroot\u306e\u5b50\u30ad\u30e5\u30fc\u3092Dominant Share\u3067\u30bd\u30fc\u30c8\u3057\u3066\u4e00\u756a\u5c0f\u3055\u3044\u3082\u306e\u3092\u9078\u3076\u3001\u307e\u305f\u305d\u306e\u30ad\u30e5\u30fc\u306b\u5b50\u304c\u3044\u305f\u3089\u30bd\u30fc\u30c8\u3057\u3066\u5c0f\u3055\u3044\u3082\u306e\u3092\u9078\u3076\u3002Leaf\u307e\u3067\u3076\u3061\u5f53\u305f\u3063\u305f\u3089\u305d\u306e\u4e2d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30bd\u30fc\u30c8\u3057\u3066\u4e00\u756aDominant Share\u304c\u5c0f\u3055\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u30ea\u30bd\u30fc\u30b9(Container)\u3092\u5272\u308a\u5f53\u3066\u307e\u3059\u3002\u4e0a\u306e\u56f3\u3067\u793a\u3055\u308c\u3066\u3044\u308b\u6570\u5b57\u306f\u5404\u30ad\u30e5\u30fc\u306eDominant Share\u3092\u8868\u3057\u3066\u3044\u307e\u3059\u304c\u3001Dominant Share\u306f\u7570\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u30b7\u30a7\u30a2\u540c\u58eb\u306e\u6bd4\u8f03\u3092\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u5fc5\u305a\u3057\u3082\u5404\u968e\u5c64\u3067\u8db3\u3057\u3066100%\u306b\u306f\u306a\u308a\u307e\u305b\u3093\u3002\n\n\u6700\u5f8c\u306b\u3053\u306eDRF\u306b\u57fa\u3044\u3066\u30bd\u30fc\u30c8\u3057\u3066\u3044\u308b\u90e8\u5206\u3092\u898b\u3066\u307f\u307e\u3059\u3002\u3053\u306e\u30bd\u30fc\u30c8\u306f`DominantResourceFairnessComparator`\u304c\u62c5\u3063\u3066\u304a\u308a\u3001`Comparator`interface\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u306e\u3067TreeSet\u306a\u3069\u306b\u7d44\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6838\u3068\u306a\u308b`compare`\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b\u3067\u3059\u3002\n\n```java\n    @Override\n    public int compare(Schedulable s1, Schedulable s2) {\n      // ResourceWeights\u306fMemory, CPU\u305d\u308c\u305e\u308c\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u91cd\u307f\u3092\u8003\u616e\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n      ResourceWeights sharesOfCluster1 = new ResourceWeights();\n      ResourceWeights sharesOfCluster2 = new ResourceWeights();\n      // \u305d\u308c\u305e\u308c\u306eMinimum\u306a\u30ea\u30bd\u30fc\u30b9\n      ResourceWeights sharesOfMinShare1 = new ResourceWeights();\n      ResourceWeights sharesOfMinShare2 = new ResourceWeights();\n      // \u30af\u30e9\u30b9\u30bf\u5168\u4f53\u306b\u5bfe\u3059\u308b\u30b7\u30a7\u30a2\u3067\u30bd\u30fc\u30c8\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3002Dominant Share\u3068\u306a\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u308f\u304b\u308a\u307e\u3059\n      ResourceType[] resourceOrder1 = new ResourceType[NUM_RESOURCES];\n      ResourceType[] resourceOrder2 = new ResourceType[NUM_RESOURCES];\n      \n      // \u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3059\u308b\u3002\u8a73\u7d30\u306b\u95a2\u3057\u3066\u306f\u5f8c\u8ff0\u3002\n      // Memory, CPU\u306e\u91cd\u307f\u4ed8\u304d\u30b7\u30a7\u30a2\u304c\u964d\u9806\u306b\u30bd\u30fc\u30c8\u3055\u308csharesOfCluster*, resourceOrder*\u306b\u5165\u308c\u3089\u308c\u307e\u3059\u3002\n      calculateShares(s1.getResourceUsage(),\n          clusterCapacity, sharesOfCluster1, resourceOrder1, s1.getWeights());\n      // Miminum\u8a08\u7b97\u3059\u308b\u3068\u304d\u306f\u91cd\u307f\u3092\u305d\u308c\u305e\u308c1\u306b\u3057\u3066\u3044\u307e\u3059\n      calculateShares(s1.getResourceUsage(),\n          s1.getMinShare(), sharesOfMinShare1, null, ResourceWeights.NEUTRAL);\n      calculateShares(s2.getResourceUsage(),\n          clusterCapacity, sharesOfCluster2, resourceOrder2, s2.getWeights());\n      calculateShares(s2.getResourceUsage(),\n          s2.getMinShare(), sharesOfMinShare2, null, ResourceWeights.NEUTRAL);\n      \n      // Dominant Share\u304cMinimum\u3055\u3048\u6e80\u305f\u3057\u3066\u3044\u306a\u3044\u5834\u5408\n      boolean s1Needy = sharesOfMinShare1.getWeight(resourceOrder1[0]) < 1.0f;\n      boolean s2Needy = sharesOfMinShare2.getWeight(resourceOrder2[0]) < 1.0f;\n      \n      int res = 0;\n      if (!s2Needy && !s1Needy) {\n        // \u305d\u308c\u305e\u308c\u306e\u6bd4\u8f03\u3002\u8a73\u7d30\u306f\u5f8c\u8ff0\u3002\n        res = compareShares(sharesOfCluster1, sharesOfCluster2,\n            resourceOrder1, resourceOrder2);\n      } else if (s1Needy && !s2Needy) {\n        // Minimum\u3092\u6e80\u305f\u3057\u3066\u3044\u306a\u3044s1\u3092\u5148\u306b\n        res = -1;\n      } else if (s2Needy && !s1Needy) {\n        // Minimum\u3092\u6e80\u305f\u3057\u3066\u3044\u306a\u3044s2\u3092\u5148\u306b\n        res = 1;\n      } else { // both are needy below min share\n        res = compareShares(sharesOfMinShare1, sharesOfMinShare2,\n            resourceOrder1, resourceOrder2);\n      }\n      if (res == 0) {\n        // Dominant Share\u304c\u540c\u3058\u5834\u5408\u306f\u65e9\u3044\u3082\u306e\u52dd\u3061\n        res = (int)(s1.getStartTime() - s2.getStartTime());\n      }\n      return res;\n    }\n```\n\n\n`calculateShares`\u306e\u5b9f\u88c5\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002Memory\u3068CPU\u306b\u95a2\u3057\u3066\u91cd\u307f\u3092\u8003\u616e\u3057\u305f\u30b7\u30a7\u30a2\u3092\u8a08\u7b97\u3057\u3001Dominant Share\u304c\u5927\u304d\u3044\u9806\u306b\u4e26\u3073\u304b\u3048\u3066\u3044\u307e\u3059\u3002\n\n```java\n    void calculateShares(Resource resource, Resource pool,\n        ResourceWeights shares, ResourceType[] resourceOrder, ResourceWeights weights) {\n      // Memory\u306e\u91cd\u307f\u4ed8\u304dShare\n      shares.setWeight(MEMORY, (float)resource.getMemorySize() /\n          (pool.getMemorySize() * weights.getWeight(MEMORY)));\n      // CPU\u306e\u91cd\u307f\u4ed8\u304dShare\n      shares.setWeight(CPU, (float)resource.getVirtualCores() /\n          (pool.getVirtualCores() * weights.getWeight(CPU)));\n      // share\u304c\u5927\u304d\u3044\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u9806\u306b\u4e26\u3073\u66ff\u3048\u308b\n      if (resourceOrder != null) {\n        if (shares.getWeight(MEMORY) > shares.getWeight(CPU)) {\n          resourceOrder[0] = MEMORY;\n          resourceOrder[1] = CPU;\n        } else  {\n          resourceOrder[0] = CPU;\n          resourceOrder[1] = MEMORY;\n        }\n      }\n    }\n```\n\n\u305d\u3057\u3066compare\u3059\u308b\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u3002\u305d\u308c\u305e\u308c\u306eDominant Share\u306f\u308f\u304b\u3063\u305f\u306e\u3067\u3001\u9806\u756a\u306b\u6bd4\u8f03\u3059\u308b\u3060\u3051\u3002\n\n```java\n    private int compareShares(ResourceWeights shares1, ResourceWeights shares2,\n        ResourceType[] resourceOrder1, ResourceType[] resourceOrder2) {\n      for (int i = 0; i < resourceOrder1.length; i++) {\n        // Dominant Share\u540c\u58eb\u3092\u6bd4\u8f03\n        int ret = (int)Math.signum(shares1.getWeight(resourceOrder1[i])\n            - shares2.getWeight(resourceOrder2[i]));\n        if (ret != 0) {\n          return ret;\n        }\n      }\n      return 0;\n    }\n```\n\nDominant Share\u304c\u540c\u3058\u5834\u5408\u306b\u306f\u6b21\u306bDominant\u306aResource\u306eShare\u3092\u6bd4\u8f03\u3057\u307e\u3059\u3002\u3053\u308c\u3067\u6700\u3082Dominant Share\u304c\u4f4e\u3044\u30ad\u30e5\u30fc\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5f97\u3089\u308c\u308b\u306e\u3067\u3053\u3044\u3064\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3042\u3052\u307e\u3059\u3002DRF\u81ea\u4f53\u306f\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u304c\u3044\u304f\u3064\u3042\u3063\u3066\u3082\u6bd4\u8f03\u3067\u304d\u308b\u4e00\u822c\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3059\u304c\u3001YARN\u306e`DominantResouceFairnessPolicy`\u306fMemory, CPU\u306b\u95a2\u3057\u3066\u30d9\u30bf\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\nYARN\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3001\u8a73\u7d30\u307e\u3067\u306f\u8ffd\u3048\u3066\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001DRF\u3068\u3044\u3046\u7814\u7a76\u306b\u57fa\u3044\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u3061\u306a\u307f\u306bDRF\u306f\u540c\u3058\u30ea\u30bd\u30fc\u30b9\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3067\u3042\u308bMesos\u306b\u3082\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u3053\u3068\u3092[Mesos\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0](https://mesos-scr-jp.connpass.com/event/43819/)\u3067\u77e5\u308a\u307e\u3057\u305f\u3002\u5206\u6563\u30b7\u30b9\u30c6\u30e0\u306e\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u52c9\u5f37\u3057\u305f\u3044\u65b9\u306b\u3068\u3063\u3066\u306f\u3068\u3066\u3082\u3088\u3044\u52c9\u5f37\u4f1a\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u53c2\u7167\n\n- [Min-max fairness](https://en.wikipedia.org/wiki/Max-min_fairness)\n- [Dominant Resource Fairness: Fair Allocation of Multiple Resource Types, Ali Ghodsi](https://people.eecs.berkeley.edu/~alig/papers/drf.pdf)\n- [MANAGING CPU RESOURCES IN YOUR HADOOP YARN CLUSTERS, hortonworks.com](http://hortonworks.com/blog/managing-cpu-resources-in-your-hadoop-yarn-clusters/)\n- [Pareto efficieny](https://en.wikipedia.org/wiki/Pareto_efficiency)\n- [Mesos\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30ea\u30fc\u30c7\u30a3\u30f3\u30b0](https://mesos-scr-jp.connpass.com/event/43819/)\n", "tags": ["hadoop", "YARN", "Java", "DistributedSystems"]}