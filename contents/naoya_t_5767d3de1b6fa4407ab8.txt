{"context": " More than 1 year has passed since last update.\u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u3092\u8868\u793a\u3057\u306a\u304c\u3089\u3001CSV\u30921\u884c\u305a\u3064\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u578b\u5909\u63db\u3092\u3057\u306a\u304c\u3089\u8aad\u3093\u3067\u4f55\u304b\u51e6\u7406\u3092\u3059\u308b\u4f8b\u3002\n\u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u306fclick\u306e\u3084\u3064\u3092\u3002\n\u3068\u308a\u3042\u3048\u305a\u30b3\u30fc\u30c9\u8cbc\u3063\u3068\u304d\u307e\u3059\n\uff08with \u306a\u3093\u3068\u304b... \u3067\u4f7f\u3048\u308biterator\u306e\u66f8\u304d\u65b9\u306e\u81ea\u5206\u7528\u30b3\u30d4\u30da\u4f8b\u3067\u3082\u3042\u308b\uff09\nfield_converter.py \u306f\u3053\u3061\u3089\uff1ahttps://gist.github.com/naoyat/3db8cd96c8dcecb5caea\n\u524d\u306e\u8a18\u4e8b\u300cPython\u3067 \"\u6587\u5b57\u5217\".split() \u3057\u305f\u7d50\u679c\u3092\u4e00\u62ec\u5909\u63db\u3057\u305f\u3044\u300d\u306e\u3084\u3064\u3067\u3059\n\ncsv_iterator.py\nimport sys\nimport csv\nimport click\nfrom field_converter import FieldConverter\n\nclass CSV_Iterator:\n    def __init__(self, path, skip_header=False, with_progress_bar=False,\n                 field_converter=None):\n        self.path = path\n        self.with_progress_bar = with_progress_bar\n        self.field_converter = field_converter\n\n        self.f = open(path, 'r')\n        self.line_count = sum(1 for line in self.f)\n\n        self.f.seek(0)  # rewind\n        self.r = csv.reader(self.f, dialect='excel')\n        if skip_header:\n            self.r.next()\n            self.line_count -= 1\n\n        print '(%d lines)' % (self.line_count,)\n\n        if self.with_progress_bar:\n            self.bar = click.progressbar(self.r, self.line_count)\n\n    def __iter__(self):\n        return self\n\n    def next(self):\n        try:\n            if self.with_progress_bar:\n                fields = self.bar.next()\n            else:\n                fields = self.r.next()\n            if self.field_converter:\n                try:\n                    fields = self.field_converter.convert(fields)\n                except:\n                    print sys.exc_info()\n            return fields\n        except:\n            raise StopIteration\n\n    def __enter__(self):\n        return self\n\n    def __exit__(self, exc_type, exc_value, traceback):\n        if exc_type:\n            return False\n        if self.with_progress_bar:\n            print\n        self.f.close()\n        return True\n\n\ngist\u306b\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://gist.github.com/naoyat/b1290d917638c412e140\n\u4f7f\u7528\u4f8b\u3002\n\nexample.py\nfrom csv_iterator import CSV_Iterator\n\ndef foobar(csv_path):\n    with CSV_Iterator(csv_path,\n                  skip_header=True,\n                  with_progress_bar=True,\n                  field_converter=FieldConverter(int, int, 'iso-8859-1', 'iso-8859-1', float)) as line:\n        for id, uid, title, query, target in line:\n            ...\n\n\n\u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u3092\u8868\u793a\u3057\u306a\u304c\u3089\u3001CSV\u30921\u884c\u305a\u3064\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u578b\u5909\u63db\u3092\u3057\u306a\u304c\u3089\u8aad\u3093\u3067\u4f55\u304b\u51e6\u7406\u3092\u3059\u308b\u4f8b\u3002\n\u30d7\u30ed\u30b0\u30ec\u30b9\u30d0\u30fc\u306f[click](http://click.pocoo.org/)\u306e\u3084\u3064\u3092\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u30b3\u30fc\u30c9\u8cbc\u3063\u3068\u304d\u307e\u3059\n\uff08with \u306a\u3093\u3068\u304b... \u3067\u4f7f\u3048\u308biterator\u306e\u66f8\u304d\u65b9\u306e\u81ea\u5206\u7528\u30b3\u30d4\u30da\u4f8b\u3067\u3082\u3042\u308b\uff09\n\nfield_converter.py \u306f\u3053\u3061\u3089\uff1ahttps://gist.github.com/naoyat/3db8cd96c8dcecb5caea\n\u524d\u306e\u8a18\u4e8b\u300c[Python\u3067 \"\u6587\u5b57\u5217\".split() \u3057\u305f\u7d50\u679c\u3092\u4e00\u62ec\u5909\u63db\u3057\u305f\u3044](http://qiita.com/naoya_t/items/7a660ea65830da9f55d3)\u300d\u306e\u3084\u3064\u3067\u3059\n\n```csv_iterator.py\nimport sys\nimport csv\nimport click\nfrom field_converter import FieldConverter\n\nclass CSV_Iterator:\n    def __init__(self, path, skip_header=False, with_progress_bar=False,\n                 field_converter=None):\n        self.path = path\n        self.with_progress_bar = with_progress_bar\n        self.field_converter = field_converter\n\n        self.f = open(path, 'r')\n        self.line_count = sum(1 for line in self.f)\n\n        self.f.seek(0)  # rewind\n        self.r = csv.reader(self.f, dialect='excel')\n        if skip_header:\n            self.r.next()\n            self.line_count -= 1\n\n        print '(%d lines)' % (self.line_count,)\n\n        if self.with_progress_bar:\n            self.bar = click.progressbar(self.r, self.line_count)\n\n    def __iter__(self):\n        return self\n\n    def next(self):\n        try:\n            if self.with_progress_bar:\n                fields = self.bar.next()\n            else:\n                fields = self.r.next()\n            if self.field_converter:\n                try:\n                    fields = self.field_converter.convert(fields)\n                except:\n                    print sys.exc_info()\n            return fields\n        except:\n            raise StopIteration\n\n    def __enter__(self):\n        return self\n\n    def __exit__(self, exc_type, exc_value, traceback):\n        if exc_type:\n            return False\n        if self.with_progress_bar:\n            print\n        self.f.close()\n        return True\n```\ngist\u306b\u8cbc\u3063\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://gist.github.com/naoyat/b1290d917638c412e140\n\n\u4f7f\u7528\u4f8b\u3002\n\n```example.py\nfrom csv_iterator import CSV_Iterator\n\ndef foobar(csv_path):\n    with CSV_Iterator(csv_path,\n                  skip_header=True,\n                  with_progress_bar=True,\n                  field_converter=FieldConverter(int, int, 'iso-8859-1', 'iso-8859-1', float)) as line:\n        for id, uid, title, query, target in line:\n            ...\n```\n", "tags": ["Python", "CSV"]}