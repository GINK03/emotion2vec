{"tags": ["AdventCalendar", "Lua", "Tarantool"], "context": " More than 1 year has passed since last update.\n\ntarantool\u306e\u3054\u7d39\u4ecb\ntarantool\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u3066\u3001\u89e6\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u89e6\u3063\u3066\u307f\u308b\u3002\nhttp://tarantool.org/\nKey-value store\u3068application\u30b5\u30fc\u30d0\u304c\n\u5408\u308f\u3055\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u3088\u3046\u3060\u3002\n\n\u672c\u5f53\u306fMacOS X\u4e0a\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u304c...\nMacOS X\u3067\u3042\u308c\u3070\u3001homebrew\u3067taranntool\u3092\u30d3\u30eb\u30c9\u3067\u304d\u308b\u3089\u3057\u304b\u3063\u305f\u3002\n\u304c\u3001\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u6642\u70b9\u3067\u306f\u3001\u30d3\u30eb\u30c9\u304c\u901a\u3089\u306a\u3044\uff01\n\u306a\u3093\u3067\u3060\u3063\u3066\u601d\u3063\u305f\u3089PR\u304c\u51fa\u3066\u305f...\nMac OS support #638\n\nUbuntu\u3067\u74b0\u5883\u3092\u69cb\u7bc9\nVagrant + bento\u3092\u5229\u7528\u3057\u3001Ubuntu\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\nbento\u30d7\u30ed\u30c0\u30af\u30c8\u306eVagrant.box\u3092\u8ffd\u52a0\u3059\u308b\nbento\u30d7\u30ed\u30c0\u30af\u30c8\u306eVagrant.box\u3092\u8ffd\u52a0\u3059\u308b\n> vagrant box add bento-Ubuntu-14.04 http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_ubuntu-14.04_chef-provisionerless.box \n\n\u66ab\u3057\u5f85\u3064\n\nansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3059\u308b\u3002\n> brew install ansible\n\n\nVagrant\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u516c\u5f0f\u304b\u3089\u843d\u3068\u3057\u3066\u304f\u308b\u3068\u697d\u3002\nhttps://www.vagrantup.com/downloads.html\n\nVagrant\u306e\u74b0\u5883\u3092git clone\n\u74b0\u5883\u6574\u3048\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u3055\u3059\u304e\u308b\u306e\u3067\nansible-playbook\u3068Vagrantfile\u3092\u540c\u68b1\u3057\u305f\u3002\nhttps://github.com/futoase/environment-for-tarantool\n\nVagrant\u74b0\u5883\u306e\u7acb\u3061\u4e0a\u3052\u30fbprovisioning\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092git clone\n> git clone git@github.com:futoase/environment-for-tarantool.git\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Vagrant box\u7acb\u3061\u4e0a\u3052\u3001provisioning\u958b\u59cb\n> cd environment-for-tarantool\n> vagrant up --provision\n\n\u624b\u52d5\u3067tarantool\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u3001\nluarock\u306e\u30ea\u30b9\u30c8\u306btarantool/http\u3092\u8ffd\u52a0\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n> luarocks --local install http://rocks.tarantool.org/http-scm-1.rockspec\n\n\ntarantool\u306e\u30c6\u30b9\u30c8\u3092\u3059\u308b\ntarantool.org\u306e\u30c8\u30c3\u30d7\u306b\u3042\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\ntarantool.lua\n#!/usr/bin/env tarantool\n\nbox.cfg{}\nhosts = box.space.hosts\nif not hosts then\n  hosts = box.schema.create_space('hosts')\n  hosts:create_index('primary', { parts = {1, 'STR'} })\nend\n\nlocal function handler(self)\n  local host = self.req.peer.host\n  local response = {\n    host = host;\n    counter = hosts:inc(host);\n  }\n  self:render{ json = response }\nend\n\nhttpd = require('http.server')\nserver = httpd.new('0.0.0.0', 8080)\nserver:route({ path = '/' }, handler)\nserver:start()\n\n\n\n\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\n\u5148\u307b\u3069\u306e\u30d5\u30a1\u30a4\u30eb\u3092Vagrantfile\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\n\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\u3092\u884c\u3063\u3066\u307f\u308b\u3002\n> cd environment-for-tarantool\n> vagrant ssh\n> cd /vagrant\n# vagrant \u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001taranatool.lua\u3092/vagrant\u4ee5\u4e0b\u306b\u4f5c\u6210\u3059\u308b\n> chmod +x ./tarantool.lua\n> ./tarantool.lua\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3068\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\n\n\u6c17\u306b\u306a\u308b\u70b9\ntarantool lua package\n\u3092\u307f\u308b\u3068\u3001YAML\u3084JSON\u3001\u4ed6MsgPack\u3084uuid\u306a\u3069\u30a6\u30a7\u30c3\u30d6\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d0\u306b\u5fc5\u8981\u3068\u306a\u308a\u305d\u3046\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u308b\u3002\n\u3053\u308c\u3089\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3057\u305f\u304b\u3063\u305f\u304c\u3001\n\u74b0\u5883\u3092\u6574\u3048\u3066\u3044\u308b\u6642\u70b9\u3067\u7d42\u308f\u3063\u3066\u3057\u307e\u3063\u305f... orz\n# tarantool\u306e\u3054\u7d39\u4ecb\n\ntarantool\u3068\u3044\u3046\u306e\u304c\u3042\u3063\u3066\u3001\u89e6\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u89e6\u3063\u3066\u307f\u308b\u3002\n\nhttp://tarantool.org/\n\nKey-value store\u3068application\u30b5\u30fc\u30d0\u304c\n\u5408\u308f\u3055\u3063\u305f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u3088\u3046\u3060\u3002\n\n# \u672c\u5f53\u306fMacOS X\u4e0a\u3067\u3084\u308a\u305f\u304b\u3063\u305f\u304c...\n\nMacOS X\u3067\u3042\u308c\u3070\u3001homebrew\u3067taranntool\u3092\u30d3\u30eb\u30c9\u3067\u304d\u308b\u3089\u3057\u304b\u3063\u305f\u3002\n\u304c\u3001\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u6642\u70b9\u3067\u306f\u3001\u30d3\u30eb\u30c9\u304c\u901a\u3089\u306a\u3044\uff01\n\u306a\u3093\u3067\u3060\u3063\u3066\u601d\u3063\u305f\u3089PR\u304c\u51fa\u3066\u305f...\n\n[Mac OS support #638](https://github.com/tarantool/tarantool/issues/638)\n\n# Ubuntu\u3067\u74b0\u5883\u3092\u69cb\u7bc9\n\n[Vagrant](https://www.vagrantup.com/) + [bento](https://github.com/opscode/bento)\u3092\u5229\u7528\u3057\u3001Ubuntu\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\n## bento\u30d7\u30ed\u30c0\u30af\u30c8\u306eVagrant.box\u3092\u8ffd\u52a0\u3059\u308b\n\nbento\u30d7\u30ed\u30c0\u30af\u30c8\u306eVagrant.box\u3092\u8ffd\u52a0\u3059\u308b\n\n```\n> vagrant box add bento-Ubuntu-14.04 http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_ubuntu-14.04_chef-provisionerless.box \n```\n\n\u66ab\u3057\u5f85\u3064\n\n## ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u3059\u308b\u3002\n\n```\n> brew install ansible\n```\n\n## Vagrant\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u516c\u5f0f\u304b\u3089\u843d\u3068\u3057\u3066\u304f\u308b\u3068\u697d\u3002\n\nhttps://www.vagrantup.com/downloads.html\n\n## Vagrant\u306e\u74b0\u5883\u3092git clone\n\n\u74b0\u5883\u6574\u3048\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u3055\u3059\u304e\u308b\u306e\u3067\nansible-playbook\u3068Vagrantfile\u3092\u540c\u68b1\u3057\u305f\u3002\n\nhttps://github.com/futoase/environment-for-tarantool\n\n\n## Vagrant\u74b0\u5883\u306e\u7acb\u3061\u4e0a\u3052\u30fbprovisioning\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u3092git clone\n\n```\n> git clone git@github.com:futoase/environment-for-tarantool.git\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Vagrant box\u7acb\u3061\u4e0a\u3052\u3001provisioning\u958b\u59cb\n\n```\n> cd environment-for-tarantool\n> vagrant up --provision\n```\n\n\u624b\u52d5\u3067tarantool\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u3001\nluarock\u306e\u30ea\u30b9\u30c8\u306b[tarantool/http](https://github.com/tarantool/http/)\u3092\u8ffd\u52a0\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3002\n\n```\n> luarocks --local install http://rocks.tarantool.org/http-scm-1.rockspec\n```\n\n# tarantool\u306e\u30c6\u30b9\u30c8\u3092\u3059\u308b\n\ntarantool.org\u306e\u30c8\u30c3\u30d7\u306b\u3042\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\n```lua:tarantool.lua\n#!/usr/bin/env tarantool\n\nbox.cfg{}\nhosts = box.space.hosts\nif not hosts then\n  hosts = box.schema.create_space('hosts')\n  hosts:create_index('primary', { parts = {1, 'STR'} })\nend\n\nlocal function handler(self)\n  local host = self.req.peer.host\n  local response = {\n    host = host;\n    counter = hosts:inc(host);\n  }\n  self:render{ json = response }\nend\n\nhttpd = require('http.server')\nserver = httpd.new('0.0.0.0', 8080)\nserver:route({ path = '/' }, handler)\nserver:start()\n```\n\n## \u30b5\u30fc\u30d0\u306e\u8d77\u52d5\n\n\u5148\u307b\u3069\u306e\u30d5\u30a1\u30a4\u30eb\u3092Vagrantfile\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\n\u30b5\u30fc\u30d0\u306e\u8d77\u52d5\u3092\u884c\u3063\u3066\u307f\u308b\u3002\n\n```\n> cd environment-for-tarantool\n> vagrant ssh\n> cd /vagrant\n# vagrant \u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001taranatool.lua\u3092/vagrant\u4ee5\u4e0b\u306b\u4f5c\u6210\u3059\u308b\n> chmod +x ./tarantool.lua\n> ./tarantool.lua\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3068\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\n![Screen Shot 2014-12-01 at 20.56.13.png](https://qiita-image-store.s3.amazonaws.com/0/3985/ea0e0dc4-e9ad-da49-a2a1-f392f53bd1c2.png)\n\n# \u6c17\u306b\u306a\u308b\u70b9\n\n[tarantool lua package](http://tarantool.org/doc/user_guide.html#lua-and-packages)\n\u3092\u307f\u308b\u3068\u3001[YAML](http://tarantool.org/doc/user_guide.html#sp-yaml)\u3084[JSON](http://tarantool.org/doc/user_guide.html#sp-box-cjson)\u3001\u4ed6[MsgPack](http://tarantool.org/doc/user_guide.html#sp-msgpack)\u3084[uuid](http://tarantool.org/doc/user_guide.html#sp-box-uuid)\u306a\u3069\u30a6\u30a7\u30c3\u30d6\u30b5\u30fc\u30d3\u30b9\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d0\u306b\u5fc5\u8981\u3068\u306a\u308a\u305d\u3046\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u3053\u308c\u3089\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3057\u305f\u304b\u3063\u305f\u304c\u3001\n\u74b0\u5883\u3092\u6574\u3048\u3066\u3044\u308b\u6642\u70b9\u3067\u7d42\u308f\u3063\u3066\u3057\u307e\u3063\u305f... orz\n"}