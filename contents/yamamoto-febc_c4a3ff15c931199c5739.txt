{"context": "\n\n\u6982\u8981\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3067\u306e\u30b7\u30f3\u30d7\u30eb\u76e3\u8996\u306e\u4f7f\u3044\u65b9\u3067\u3059\u3002\n\u3055\u304f\u3089\u306eIP\u306a\u3089\u7121\u6599+\u5916\u90e8\u306eIP\u3067\u3082\u6708\u959321\u5186\u3068\u3044\u3046\u5b89\u3055\u3067\u4f7f\u3048\u308b\u305f\u3081\u5927\u91cf\u306b\u4f7f\u3044\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\n\u305d\u306e\u5834\u5408\u3001Slack\u901a\u77e5\u5148\u306e\u5909\u66f4\u306a\u3069\u3092\u5404\u76e3\u8996\u5148\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u306e\u304c\u9762\u5012\u3067\u3059\u3002\n\u305d\u3053\u3067Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3092\u4f7f\u3048\u3070\u5927\u91cf\u306e\u76e3\u8996\u5148\u3067\u3082\u67d4\u8edf\u306b\u7ba1\u7406\u3067\u304d\u308b\u305f\u3081\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b7\u30f3\u30d7\u30eb\u76e3\u8996\u3068\u306f\n\u6307\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3 or IP\u30a2\u30c9\u30ec\u30b9\u306b\u5bfe\u3057\u3066\u69d8\u3005\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u901a\u3058\u3066\u6b7b\u6d3b\u76e3\u8996\u3092\u884c\u3044\u3001\n\u969c\u5bb3\u767a\u751f\u6642(+\u5fa9\u65e7\u6642)\u306b\u96fb\u5b50\u30e1\u30fc\u30eb\u3084Slack\u3067\u901a\u77e5\u3092\u884c\u3063\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\u53c2\u7167:\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u30cb\u30e5\u30fc\u30b9:\u30b7\u30f3\u30d7\u30eb\u76e3\u8996\n\n\u5927\u304d\u306a\u7279\u5fb4\u3068\u3057\u3066\u3001\n\n\u3055\u304f\u3089\u306eIP\u30a2\u30c9\u30ec\u30b9\u306a\u3089\u7121\u6599 \n\n\n\u3068\u3044\u3046\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n(\u3053\u306e\u8fba\u308a\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u304c\u8a73\u3057\u3044\u3067\u3059\u3002)\n\n\u53c2\u8003\u60c5\u5831\n\u4ee5\u4e0b\u3092\u8aad\u3093\u3067\u304a\u304f\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\nTerraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30ac\u30a4\u30c9\n\n\u5fc5\u8981\u306a\u3082\u306e\n\nTerraform\u3068Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u5b9f\u884c\u74b0\u5883(\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u69cb\u7bc9\u3057\u3066\u304f\u3060\u3055\u3044)\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9API\u30ad\u30fc(\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u6e96\u5099\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\nSlack\u306eWebhook URL\n\n\n\u4f7f\u3044\u65b9\ntf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066terraform apply\u3057\u307e\u3059\u3002\n\ntf\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u65b9\ntf\u30d5\u30a1\u30a4\u30eb\u306e\u57fa\u672c\u7684\u306a\u8a18\u8f09\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nsimplemonitor.tf\n\n# \u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a(API\u30ad\u30fc\u3092\u8a18\u8f09)\nprovider \"sakuracloud\" {\n    token = \"[ACCESS_TOKEN]\"\n    secret = \"[ACCESS_TOKEN_SECRET]\"\n}\n\n# \u76e3\u8996\u8a2d\u5b9a\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    target = \"[target FQDN] or [target IPAddress]\"\n    health_check = {\n        protocol = \"http\"\n        delay_loop = 120\n        path = \"/\"\n        status = \"200\"\n    }\n    notify_email_enabled = false\n    notify_slack_enabled = true\n    notify_slack_webhook = \"https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n\n\n\n\n\u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a\n\nsimplemonitor.tf(\u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a)\n# \u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a(API\u30ad\u30fc\u3092\u8a18\u8f09)\nprovider \"sakuracloud\" {\n    token = \"[ACCESS_TOKEN]\"\n    secret = \"[ACCESS_TOKEN_SECRET]\"\n}\n\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u3067\u53d6\u5f97\u3057\u305fAPI\u30ad\u30fc\u306e\u60c5\u5831\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u76e3\u8996\u8a2d\u5b9a\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\ntarget : \u5bfe\u8c61\u306eFQDN\u307e\u305f\u306fIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nhealth_check : \u76e3\u8996\u65b9\u6cd5\u3092\u8a2d\u5b9a\u3057\u307e\u3059(\u5f8c\u307b\u3069\u8a73\u7d30\u3092\u89e3\u8aac\u3057\u307e\u3059)\u3002\n\nnotify_email_enabled : E\u30e1\u30fc\u30eb\u3067\u306e\u901a\u77e5\u306e\u6709\u52b9/\u7121\u52b9\u3092\u8a18\u8f09\u3057\u307e\u3059(true or false)\u3002\n\nnotify_slack_enabled : Slack\u901a\u77e5\u306e\u6709\u52b9/\u7121\u52b9\u3092\u8a18\u8f09\u3057\u307e\u3059(true or false)\u3002\n\nnotify_slack_webhook : Slack\u306eWebhook URL\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nE\u30e1\u30fc\u30eb\u3067\u306e\u901a\u77e5\u5148\u306f\u3053\u3053\u3067\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u304b\u3089\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u76e3\u8996\u65b9\u6cd5(\u30d7\u30ed\u30c8\u30b3\u30eb)\u5225\u306e\u8a18\u8f09\u65b9\u6cd5\u306b\u3064\u3044\u3066\n\u76e3\u8996\u3092\u884c\u3046\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u3063\u3066health_check\u9805\u76ee\u306e\u8a18\u8f09\u65b9\u6cd5\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\nping\u306e\u5834\u5408\n\nsimplemonitor.tf(ping\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"ping\"\n        delay_loop = 120\n    }\n\n\n\n\nprotocol : \"ping\"\u3092\u6307\u5b9a\u3057\u307e\u3059\n\ndelay_loop: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f60\u304b\u3089\u6700\u59273600\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\nhttp/https\u306e\u5834\u5408\n\nsimplemonitor.tf(http/https\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"http\"     # or \"https\"\n        path = \"/\"\n        status = \"200\"\n        delay_loop = 120\n    }\n\n\n\n\nprotocol : http\u307e\u305f\u306fhttps\u3092\u6307\u5b9a\u3057\u307e\u3059\n\npath : \u76e3\u8996\u5bfe\u8c61\u3068\u306a\u308b\u30da\u30fc\u30b8\u306eURL\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4f8b: /index.html\n\nstatus : path\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u3059\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ndelay_loop: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f60\u304b\u3089\u6700\u59273600\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\ntcp/ssh/smtp/pop3\u306e\u5834\u5408\n\nsimplemonitor.tf(tcp/ssh/smtp/pop3\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"tcp\"     # or ssh / smtp / pop3\n        port = \"22\"\n        delay_loop = 120\n    }\n\n\n\n\nprotocol : tcp/ssh/smtp/pop3\u306e\u3044\u3065\u308c\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nport : \u76e3\u8996\u5bfe\u8c61\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ndelay_loop: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f60\u304b\u3089\u6700\u59273600\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\nDNS\u306e\u5834\u5408\n\nsimplemonitor.tf(DNS\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"dns\"\n        qname = \"example.com\"\n        expected_data = \"192.168.0.1\"\n        delay_loop = 120\n    }\n\n\n\n\nprotocol : \"dns\"\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nqname : \u76e3\u8996\u5bfe\u8c61\u306eFQDN\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nexpected_data : DNS\u5fdc\u7b54\u306e\u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u7701\u7565\u3057\u305f\u5834\u5408\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u4f55\u3089\u304b\u306eA\u30ec\u30b3\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n\ndelay_loop: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f60\u304b\u3089\u6700\u59273600\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\nSNMP\u306e\u5834\u5408\n\nsimplemonitor.tf(SNMP\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"snmp\"\n        community = \"community\"\n        snmp_version = \"1\" # or \"2c\"\n        oid = \".1.3.6.1.2.1.2.2.1.8.2\"\n        expected_data = \"2\"\n        delay_loop = 120\n    }\n\n\n\n\nprotocol : \"snmp\"\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ncommunity : \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nsnmp_version : \u5bfe\u8c61\u306eSNMP\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(1 or 2c)\n\noid : \u76e3\u8996\u5bfe\u8c61\u306eOID\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nexpected_data : \u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\ndelay_loop: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f60\u304b\u3089\u6700\u59273600\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\ntips\n\n\u8907\u6570\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u307e\u3068\u3081\u3066\u76e3\u8996\u3057\u305f\u3044\u5834\u5408\n\nTerraform\u306evariable\u6a5f\u80fd\u3068count\u3001element\u95a2\u6570\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\u307e\u305a\u76e3\u8996\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092variable\u3067\u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6587\u5b57\u5217\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u5b9a\u7fa9\u3057\u305fvariable\u306f${var.\u5b9a\u7fa9\u540d}\u3068\u3059\u308c\u3070\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\nsimplemonitor.tf(\u5bfe\u8c61\u30a2\u30c9\u30ec\u30b9\u5b9a\u7fa9\u90e8\u5206)\nvariable \"target_ip_list\"{\n    default = \"192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5\"\n}\n\n\n\u73fe\u5728(terraform 0.6.16)\u306f\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u304c\u3001\u6b21\u30d0\u30fc\u30b8\u30e7\u30f3(0.7\u4ee5\u964d)\u306f\u4ee5\u4e0b\u306e\u8a18\u8ff0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u4e88\u5b9a\u3067\u3059\n\nsimplemonitor.tf(terraform-0.7\u4ee5\u964d\u306e\u66f8\u304d\u65b9)\nvariable \"target_ip_list\"{\n    default = [\n        \"192.168.0.1\",\n        \"192.168.0.2\",\n        \"192.168.0.3\",\n        \"192.168.0.4\",\n        \"192.168.0.5\"\n    ]\n}\n\n\n\u6b21\u306b\u3001\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u90e8\u5206\u3067count\u306e\u6307\u5b9a\u3092\u884c\u3046\u3053\u3068\u3067\u3001\u5fc5\u8981\u6570\u5206\u306e\u76e3\u8996\u8a2d\u5b9a\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305ftarget_ip_list\u3092split\u95a2\u6570\u3067\u5206\u89e3\u3057\u3066\u5229\u7528\u3057\u307e\u3059\u3002\n\nsimplemonitor.tf(count\u306e\u6307\u5b9a\u90e8\u5206)\n\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    # (\u4e2d\u7565)\n\n    # \u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305ftarget_ip_list\u306e\u500b\u6570\u5206\u4f5c\u6210\u3059\u308b\n    count = \"${length(split(\",\" , var.target_ip_list))}\" \n}\n\n\n\n\u6700\u5f8c\u306b\u3001\u76e3\u8996\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nsimplemonitor.tf(IP\u30a2\u30c9\u30ec\u30b9\u306e\u6307\u5b9a\u90e8\u5206)\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    # (\u4e2d\u7565)\n    target = \"${element( split(\",\" ,var.target_ip_list) , count.index )}\"\n}\n\n\nelement\u95a2\u6570\u306f\u3001\u6307\u5b9a\u306e\u30ea\u30b9\u30c8\u304b\u3089\u6307\u5b9a\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3042\u308b\u5024\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570\u3067\u3059\u3002\ncount.index\u3068\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u73fe\u5728\u306e\u81ea\u5206\u81ea\u8eab\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u53d6\u5f97\u53ef\u80fd\u3067\u3059\u3002\n\u5168\u4f53\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nsimplemonitor.tf(count\u4f75\u7528\u5168\u4f53)\nvariable \"target_ip_list\"{\n    default = \"192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5\"\n}\n\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    count = \"${length(split(\",\" , var.target_ip_list))}\"\n    target = \"${element( split(\",\" ,var.target_ip_list) , count.index )}\"\n\n    health_check = {\n        protocol = \"http\"\n        delay_loop = 120\n        path = \"/\"\n        status = \"200\"\n    }\n    notify_email_enabled = false\n    notify_slack_enabled = true\n    notify_slack_webhook = \"https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n\n\ntf\u30d5\u30a1\u30a4\u30eb\u306f\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306a\u305f\u3081\u3001git\u306a\u3069\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3059\u308b\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\u3042\u3068\u306ftf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u30ac\u30f3\u30ac\u30f3\u76e3\u8996\u3057\u3061\u3083\u3063\u3066\u304f\u3060\u3055\u3044\u3002\nCI\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u304a\u304d\u3001\u76e3\u8996\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3089CI\u3067terraform apply\u3092\u30ad\u30c3\u30af\u3059\u308b\u306a\u3093\u3066\u3044\u3046\u306e\u3082\u9762\u767d\u3044\u3067\u3059\u306d \n\u4ee5\u4e0a\u3067\u3059\u3002\n## \u6982\u8981\n\n[Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9](https://github.com/yamamoto-febc/terraform-provider-sakuracloud)\u3067\u306e[\u30b7\u30f3\u30d7\u30eb\u76e3\u8996](http://cloud-news.sakura.ad.jp/simplemonitor/)\u306e\u4f7f\u3044\u65b9\u3067\u3059\u3002\n\n\u3055\u304f\u3089\u306eIP\u306a\u3089\u7121\u6599+\u5916\u90e8\u306eIP\u3067\u3082\u6708\u959321\u5186\u3068\u3044\u3046\u5b89\u3055\u3067\u4f7f\u3048\u308b\u305f\u3081\u5927\u91cf\u306b\u4f7f\u3044\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\n\u305d\u306e\u5834\u5408\u3001Slack\u901a\u77e5\u5148\u306e\u5909\u66f4\u306a\u3069\u3092\u5404\u76e3\u8996\u5148\u3054\u3068\u306b\u8a2d\u5b9a\u3059\u308b\u306e\u304c\u9762\u5012\u3067\u3059\u3002\n\n\u305d\u3053\u3067[Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9](http://qiita.com/yamamoto-febc/items/ae92cd258cf040957487)\u3092\u4f7f\u3048\u3070\u5927\u91cf\u306e\u76e3\u8996\u5148\u3067\u3082\u67d4\u8edf\u306b\u7ba1\u7406\u3067\u304d\u308b\u305f\u3081\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\n## \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b7\u30f3\u30d7\u30eb\u76e3\u8996\u3068\u306f\n\n\u6307\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3 or IP\u30a2\u30c9\u30ec\u30b9\u306b\u5bfe\u3057\u3066\u69d8\u3005\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u901a\u3058\u3066\u6b7b\u6d3b\u76e3\u8996\u3092\u884c\u3044\u3001\n\u969c\u5bb3\u767a\u751f\u6642(+\u5fa9\u65e7\u6642)\u306b\u96fb\u5b50\u30e1\u30fc\u30eb\u3084Slack\u3067\u901a\u77e5\u3092\u884c\u3063\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\n\u53c2\u7167:[\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u30cb\u30e5\u30fc\u30b9:\u30b7\u30f3\u30d7\u30eb\u76e3\u8996](http://cloud-news.sakura.ad.jp/simplemonitor/)\n\n![simplemon2-768x546.png](https://qiita-image-store.s3.amazonaws.com/0/20668/d8ea45bf-3b86-8688-1a09-7331aa48d09b.png)\n\n\u5927\u304d\u306a\u7279\u5fb4\u3068\u3057\u3066\u3001\n\n  - \u3055\u304f\u3089\u306eIP\u30a2\u30c9\u30ec\u30b9\u306a\u3089\u7121\u6599 :bangbang:\n\n\u3068\u3044\u3046\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n\n(\u3053\u306e\u8fba\u308a\u306f[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/jh1vxw/items/c3d9b2d329187d1dca90)\u304c\u8a73\u3057\u3044\u3067\u3059\u3002)\n\n## \u53c2\u8003\u60c5\u5831\n\n\u4ee5\u4e0b\u3092\u8aad\u3093\u3067\u304a\u304f\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n[Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9 \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u30ac\u30a4\u30c9](http://qiita.com/yamamoto-febc/items/ae92cd258cf040957487)\n\n## \u5fc5\u8981\u306a\u3082\u306e\n\n  1. `Terraform`\u3068`Terraform for \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9`\u306e\u5b9f\u884c\u74b0\u5883([\u3053\u3061\u3089](http://qiita.com/yamamoto-febc/items/ae92cd258cf040957487#terraform\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7)\u3092\u53c2\u8003\u306b\u69cb\u7bc9\u3057\u3066\u304f\u3060\u3055\u3044)\n\n  1. \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9API\u30ad\u30fc([\u3053\u3061\u3089](http://qiita.com/yamamoto-febc/items/ae92cd258cf040957487#\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9api\u30ad\u30fc\u53d6\u5f97)\u3092\u53c2\u8003\u306b\u6e96\u5099\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\n\n  1. Slack\u306eWebhook URL\n\n## \u4f7f\u3044\u65b9\n\ntf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066`terraform apply`\u3057\u307e\u3059\u3002\n\n## tf\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u65b9\n\ntf\u30d5\u30a1\u30a4\u30eb\u306e\u57fa\u672c\u7684\u306a\u8a18\u8f09\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```simplemonitor.tf\n\n# \u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a(API\u30ad\u30fc\u3092\u8a18\u8f09)\nprovider \"sakuracloud\" {\n    token = \"[ACCESS_TOKEN]\"\n    secret = \"[ACCESS_TOKEN_SECRET]\"\n}\n\n# \u76e3\u8996\u8a2d\u5b9a\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    target = \"[target FQDN] or [target IPAddress]\"\n    health_check = {\n        protocol = \"http\"\n        delay_loop = 120\n        path = \"/\"\n        status = \"200\"\n    }\n    notify_email_enabled = false\n    notify_slack_enabled = true\n    notify_slack_webhook = \"https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n\n```\n\n### \u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a\n\n```simplemonitor.tf(\u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a)\n# \u30d7\u30ed\u30d0\u30a4\u30c0\u8a2d\u5b9a(API\u30ad\u30fc\u3092\u8a18\u8f09)\nprovider \"sakuracloud\" {\n    token = \"[ACCESS_TOKEN]\"\n    secret = \"[ACCESS_TOKEN_SECRET]\"\n}\n```\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u3067\u53d6\u5f97\u3057\u305fAPI\u30ad\u30fc\u306e\u60c5\u5831\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n### \u76e3\u8996\u8a2d\u5b9a \n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n  * `target` : \u5bfe\u8c61\u306eFQDN\u307e\u305f\u306fIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n  * `health_check` : \u76e3\u8996\u65b9\u6cd5\u3092\u8a2d\u5b9a\u3057\u307e\u3059(\u5f8c\u307b\u3069\u8a73\u7d30\u3092\u89e3\u8aac\u3057\u307e\u3059)\u3002\n  * `notify_email_enabled` : E\u30e1\u30fc\u30eb\u3067\u306e\u901a\u77e5\u306e\u6709\u52b9/\u7121\u52b9\u3092\u8a18\u8f09\u3057\u307e\u3059(true or false)\u3002\n  * `notify_slack_enabled` : Slack\u901a\u77e5\u306e\u6709\u52b9/\u7121\u52b9\u3092\u8a18\u8f09\u3057\u307e\u3059(true or false)\u3002\n  * `notify_slack_webhook` : Slack\u306eWebhook URL\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nE\u30e1\u30fc\u30eb\u3067\u306e\u901a\u77e5\u5148\u306f\u3053\u3053\u3067\u306f\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3002\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u304b\u3089\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u76e3\u8996\u65b9\u6cd5(\u30d7\u30ed\u30c8\u30b3\u30eb)\u5225\u306e\u8a18\u8f09\u65b9\u6cd5\u306b\u3064\u3044\u3066\n\n\u76e3\u8996\u3092\u884c\u3046\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u3063\u3066`health_check`\u9805\u76ee\u306e\u8a18\u8f09\u65b9\u6cd5\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\n#### ping\u306e\u5834\u5408\n\n```simplemonitor.tf(ping\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"ping\"\n        delay_loop = 120\n    }\n```\n\n  * `protocol` : \"ping\"\u3092\u6307\u5b9a\u3057\u307e\u3059\n  * `delay_loop`: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f`60`\u304b\u3089\u6700\u5927`3600`\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n#### http/https\u306e\u5834\u5408\n\n```simplemonitor.tf(http/https\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"http\"     # or \"https\"\n        path = \"/\"\n        status = \"200\"\n        delay_loop = 120\n    }\n```\n\n  * `protocol` : http\u307e\u305f\u306fhttps\u3092\u6307\u5b9a\u3057\u307e\u3059\n  * `path` : \u76e3\u8996\u5bfe\u8c61\u3068\u306a\u308b\u30da\u30fc\u30b8\u306eURL\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4f8b: /index.html\n  * `status` : `path`\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u3059\u308b\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `delay_loop`: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f`60`\u304b\u3089\u6700\u5927`3600`\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n#### tcp/ssh/smtp/pop3\u306e\u5834\u5408\n\n```simplemonitor.tf(tcp/ssh/smtp/pop3\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"tcp\"     # or ssh / smtp / pop3\n        port = \"22\"\n        delay_loop = 120\n    }\n```\n\n  * `protocol` : tcp/ssh/smtp/pop3\u306e\u3044\u3065\u308c\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `port` : \u76e3\u8996\u5bfe\u8c61\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `delay_loop`: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f`60`\u304b\u3089\u6700\u5927`3600`\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n#### DNS\u306e\u5834\u5408\n\n```simplemonitor.tf(DNS\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"dns\"\n        qname = \"example.com\"\n        expected_data = \"192.168.0.1\"\n        delay_loop = 120\n    }\n```\n\n  * `protocol` : \"dns\"\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `qname` : \u76e3\u8996\u5bfe\u8c61\u306eFQDN\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `expected_data ` : DNS\u5fdc\u7b54\u306e\u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u7701\u7565\u3057\u305f\u5834\u5408\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u4f55\u3089\u304b\u306eA\u30ec\u30b3\u30fc\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n  * `delay_loop`: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f`60`\u304b\u3089\u6700\u5927`3600`\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n#### SNMP\u306e\u5834\u5408\n\n```simplemonitor.tf(SNMP\u76e3\u8996\u306e\u5834\u5408)\n    health_check = {\n        protocol = \"snmp\"\n        community = \"community\"\n        snmp_version = \"1\" # or \"2c\"\n        oid = \".1.3.6.1.2.1.2.2.1.8.2\"\n        expected_data = \"2\"\n        delay_loop = 120\n    }\n```\n\n  * `protocol` : \"snmp\"\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `community ` : \u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `snmp_version ` : \u5bfe\u8c61\u306eSNMP\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(1 or 2c)\n  * `oid ` : \u76e3\u8996\u5bfe\u8c61\u306eOID\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `expected_data ` : \u671f\u5f85\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n  * `delay_loop`: \u76e3\u8996\u9593\u9694\u3092\u79d2\u6570\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f`60`\u304b\u3089\u6700\u5927`3600`\u306e\u9593\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## tips\n\n * \u8907\u6570\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u307e\u3068\u3081\u3066\u76e3\u8996\u3057\u305f\u3044\u5834\u5408\n\nTerraform\u306e`variable`\u6a5f\u80fd\u3068`count`\u3001`element\u95a2\u6570`\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u76e3\u8996\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092`variable`\u3067\u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6587\u5b57\u5217\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u5b9a\u7fa9\u3057\u305f`variable`\u306f`${var.\u5b9a\u7fa9\u540d}`\u3068\u3059\u308c\u3070\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\n```simplemonitor.tf(\u5bfe\u8c61\u30a2\u30c9\u30ec\u30b9\u5b9a\u7fa9\u90e8\u5206)\nvariable \"target_ip_list\"{\n    default = \"192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5\"\n}\n```\n\n**\u73fe\u5728(terraform 0.6.16)\u306f\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u304c\u3001\u6b21\u30d0\u30fc\u30b8\u30e7\u30f3(0.7\u4ee5\u964d)\u306f\u4ee5\u4e0b\u306e\u8a18\u8ff0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u4e88\u5b9a\u3067\u3059**\n\n```simplemonitor.tf(terraform-0.7\u4ee5\u964d\u306e\u66f8\u304d\u65b9)\nvariable \"target_ip_list\"{\n    default = [\n        \"192.168.0.1\",\n        \"192.168.0.2\",\n        \"192.168.0.3\",\n        \"192.168.0.4\",\n        \"192.168.0.5\"\n    ]\n}\n```\n\n\u6b21\u306b\u3001\u30ea\u30bd\u30fc\u30b9\u5b9a\u7fa9\u90e8\u5206\u3067`count`\u306e\u6307\u5b9a\u3092\u884c\u3046\u3053\u3068\u3067\u3001\u5fc5\u8981\u6570\u5206\u306e\u76e3\u8996\u8a2d\u5b9a\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305f`target_ip_list`\u3092`split`\u95a2\u6570\u3067\u5206\u89e3\u3057\u3066\u5229\u7528\u3057\u307e\u3059\u3002\n\n```simplemonitor.tf(count\u306e\u6307\u5b9a\u90e8\u5206)\n\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    # (\u4e2d\u7565)\n    \n    # \u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305ftarget_ip_list\u306e\u500b\u6570\u5206\u4f5c\u6210\u3059\u308b\n    count = \"${length(split(\",\" , var.target_ip_list))}\" \n}\n\n```\n\n\u6700\u5f8c\u306b\u3001\u76e3\u8996\u5bfe\u8c61\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```simplemonitor.tf(IP\u30a2\u30c9\u30ec\u30b9\u306e\u6307\u5b9a\u90e8\u5206)\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    # (\u4e2d\u7565)\n    target = \"${element( split(\",\" ,var.target_ip_list) , count.index )}\"\n}\n```\n\n`element`\u95a2\u6570\u306f\u3001\u6307\u5b9a\u306e\u30ea\u30b9\u30c8\u304b\u3089\u6307\u5b9a\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u3042\u308b\u5024\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570\u3067\u3059\u3002\n`count.index`\u3068\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u73fe\u5728\u306e\u81ea\u5206\u81ea\u8eab\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u53d6\u5f97\u53ef\u80fd\u3067\u3059\u3002\n\n\u5168\u4f53\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```simplemonitor.tf(count\u4f75\u7528\u5168\u4f53)\nvariable \"target_ip_list\"{\n    default = \"192.168.0.1,192.168.0.2,192.168.0.3,192.168.0.4,192.168.0.5\"\n}\n\nresource \"sakuracloud_simple_monitor\" \"foobar\" {\n    count = \"${length(split(\",\" , var.target_ip_list))}\"\n    target = \"${element( split(\",\" ,var.target_ip_list) , count.index )}\"\n\n    health_check = {\n        protocol = \"http\"\n        delay_loop = 120\n        path = \"/\"\n        status = \"200\"\n    }\n    notify_email_enabled = false\n    notify_slack_enabled = true\n    notify_slack_webhook = \"https://hooks.slack.com/services/XXXXXXXXX/XXXXXXXXX/XXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n```\n\ntf\u30d5\u30a1\u30a4\u30eb\u306f\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306a\u305f\u3081\u3001git\u306a\u3069\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3059\u308b\u306e\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\u3002\n\u3042\u3068\u306ftf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u30ac\u30f3\u30ac\u30f3\u76e3\u8996\u3057\u3061\u3083\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\nCI\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u304a\u304d\u3001\u76e3\u8996\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u30fc\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3089CI\u3067`terraform apply`\u3092\u30ad\u30c3\u30af\u3059\u308b\u306a\u3093\u3066\u3044\u3046\u306e\u3082\u9762\u767d\u3044\u3067\u3059\u306d :bangbang:\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n", "tags": ["Hashicorp", "Terraform", "\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9"]}