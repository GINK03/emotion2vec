{"tags": ["Ruby", "GraphAPI", "api", "Rails", "Facebook"], "context": " More than 1 year has passed since last update.facebook\u306eapi\u3092\u8abf\u3079\u3066\u305f\u3089\u3001graph api\u3078\u306e\u30a2\u30af\u30bb\u30b9\u30921/50\u306b\u6e1b\u3089\u305b\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u5171\u6709\u3057\u307e\u301c\u3059\uff01\uff01\n\napi\u4ed5\u69d8\nfacebook\u306edeveloper\u30b5\u30a4\u30c8\u306e\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u306b\u8a73\u7d30\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://developers.facebook.com/docs/graph-api/making-multiple-requests/\n\nrb\u30d5\u30a1\u30a4\u30eb\u3067\u66f8\u3044\u3066\u307f\u308b\n\u4eca\u56de\u306f\u30b7\u30f3\u30d7\u30eb\u306burl\u306elike\u6570\u3092\u8fd4\u3057\u3066\u304f\u308c\u308bapi\u3092\u4f7f\u3063\u3066\u3001\n\u4e00\u6c17\u306b50\u500b\u306eurl\u3092api\u306b\u6295\u3052\u3066\u307f\u307e\u3059\u3002\n\u5f15\u6570\u306burl\u306e\u914d\u5217urls\u3092\u6e21\u3059\u5834\u5408\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\nget_like_count.rb\n  def self.get_like_counts(urls)\n    batch_data = []\n    urls.each do |url|\n      batch_data << { 'method' => 'GET', 'relative_url' => \"?ids=#{url}\" }\n    end\n    uri = URI(#{FACEBOOK_GRAPH_API_URL})\n    timeout = 60\n    https = Net::HTTP.new(uri.hostname, uri.port)\n    https.use_ssl = true\n\n    res = https.start do |h|\n      h.open_timeout = timeout\n      h.read_timeout = timeout\n      req = Net::HTTP::Post.new(uri)\n      req.form_data = {\n        'access_token' => #{APP_ACCESS_TOKEN}, \u203b\u306a\u304f\u3066\u3082\u3044\u3044\n        'batch'        => batch_data.to_json\n      }\n      h.request req\n    end\n  end\n\n\n\u203b\u3053\u306ebatch_data\u306e\u914d\u5217\u306b\u5165\u308c\u308bmethod\u3068relative_url\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3001\u3069\u3093\u306aapi\u308250\u56de\u307e\u3067\u307e\u3068\u3081\u3066\u9001\u308c\u307e\u3059\u3002\n\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n  urls = [\n    \"http://job-share.net/\",\n    \"http://atrae.co.jp/\"\n  ]\n  GetLikeCount.get_like_counts(urls)\n\n\u3068\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n50\u500b\u5206\u306e\u30c7\u30fc\u30bf\u304c\u914d\u5217\u3068\u3057\u3066\u4e00\u56de\u3067\u8fd4\u3063\u3066\u304f\u308b\nActiveSupport::JSON.decode(res.body).each_with_index do |content,index|\n    p content\nend\n\n===\n\"body\" : [{\n   \"http://job-share.net\": {\n      \"id\": \"http://job-share.net\",\n      \"shares\": 1083\n   },\n   \"http://atrae.co.jp\": {\n      \"id\": \"http://atrae.co.jp\",\n      \"shares\": 259\n   },\n   \u2026(50\u500b\u5206\u304c\u914d\u5217\u3067\u8fd4\u3063\u3066\u304f\u308b)\n   ]\n}\n\n\n\n\u611f\u60f3\n\u3061\u3087\u301c\u4fbf\u5229\u301c\uff01\uff01\n\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c1/50\u306b\u306a\u3063\u3066\u65e9\u3047\u301c\nAPI\u306e\u30a2\u30af\u30bb\u30b9\u6570\u304c\u5236\u9650\u3055\u308c\u3066\u62d2\u5426\u3089\u308c\u308b\u53ef\u80fd\u6027\u3082\u6e1b\u308b\u301c\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001facebook app developer\u306e\u65b9\u3067\u77e5\u3089\u306a\u304b\u3063\u305f\u301c\u3063\u3066\u65b9\u306f\u5373\u5c0e\u5165\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n\nfacebook\u306eapi\u3092\u8abf\u3079\u3066\u305f\u3089\u3001graph api\u3078\u306e\u30a2\u30af\u30bb\u30b9\u30921/50\u306b\u6e1b\u3089\u305b\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u5171\u6709\u3057\u307e\u301c\u3059\uff01\uff01\n\n##api\u4ed5\u69d8\nfacebook\u306edeveloper\u30b5\u30a4\u30c8\u306e\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u306b\u8a73\u7d30\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://developers.facebook.com/docs/graph-api/making-multiple-requests/\n\n\n##rb\u30d5\u30a1\u30a4\u30eb\u3067\u66f8\u3044\u3066\u307f\u308b\n\n\u4eca\u56de\u306f\u30b7\u30f3\u30d7\u30eb\u306burl\u306elike\u6570\u3092\u8fd4\u3057\u3066\u304f\u308c\u308bapi\u3092\u4f7f\u3063\u3066\u3001\n\u4e00\u6c17\u306b50\u500b\u306eurl\u3092api\u306b\u6295\u3052\u3066\u307f\u307e\u3059\u3002\n\n\u5f15\u6570\u306burl\u306e\u914d\u5217urls\u3092\u6e21\u3059\u5834\u5408\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\n```get_like_count.rb\n  def self.get_like_counts(urls)\n    batch_data = []\n    urls.each do |url|\n      batch_data << { 'method' => 'GET', 'relative_url' => \"?ids=#{url}\" }\n    end\n    uri = URI(#{FACEBOOK_GRAPH_API_URL})\n    timeout = 60\n    https = Net::HTTP.new(uri.hostname, uri.port)\n    https.use_ssl = true\n\n    res = https.start do |h|\n      h.open_timeout = timeout\n      h.read_timeout = timeout\n      req = Net::HTTP::Post.new(uri)\n      req.form_data = {\n        'access_token' => #{APP_ACCESS_TOKEN}, \u203b\u306a\u304f\u3066\u3082\u3044\u3044\n        'batch'        => batch_data.to_json\n      }\n      h.request req\n    end\n  end\n```\n\n\u203b\u3053\u306ebatch_data\u306e\u914d\u5217\u306b\u5165\u308c\u308bmethod\u3068relative_url\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3001\u3069\u3093\u306aapi\u308250\u56de\u307e\u3067\u307e\u3068\u3081\u3066\u9001\u308c\u307e\u3059\u3002\n\n\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```console\n  urls = [\n    \"http://job-share.net/\",\n    \"http://atrae.co.jp/\"\n  ]\n  GetLikeCount.get_like_counts(urls)\n```\n\n\u3068\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n\n##50\u500b\u5206\u306e\u30c7\u30fc\u30bf\u304c\u914d\u5217\u3068\u3057\u3066\u4e00\u56de\u3067\b\u8fd4\u3063\u3066\u304f\u308b\n\n```\nActiveSupport::JSON.decode(res.body).each_with_index do |content,index|\n\tp content\nend\n\n===\n\"body\" : [{\n   \"http://job-share.net\": {\n      \"id\": \"http://job-share.net\",\n      \"shares\": 1083\n   },\n   \"http://atrae.co.jp\": {\n      \"id\": \"http://atrae.co.jp\",\n      \"shares\": 259\n   },\n   \u2026(50\u500b\u5206\u304c\u914d\u5217\u3067\u8fd4\u3063\u3066\u304f\u308b)\n   ]\n}\n\n```\n\n##\u611f\u60f3\n\u3061\u3087\u301c\u4fbf\u5229\u301c\uff01\uff01\n\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c1/50\u306b\u306a\u3063\u3066\u65e9\u3047\u301c\nAPI\u306e\u30a2\u30af\u30bb\u30b9\u6570\u304c\u5236\u9650\u3055\u308c\u3066\u62d2\u5426\u3089\u308c\u308b\u53ef\u80fd\u6027\u3082\u6e1b\u308b\u301c\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001facebook app developer\u306e\u65b9\u3067\u77e5\u3089\u306a\u304b\u3063\u305f\u301c\u3063\u3066\u65b9\u306f\u5373\u5c0e\u5165\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n"}