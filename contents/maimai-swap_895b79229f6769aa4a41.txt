{"tags": ["aws-cli", "IAM", "group", "policy"], "context": " More than 1 year has passed since last update.\n\n\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u8a08\n\u3060\u3044\u305f\u3044\u306f\u6700\u521d\u4ee5\u4e0b\u3067\u8db3\u308a\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u3002\n\n\n\n\u30b0\u30eb\u30fc\u30d7\u540d\n\u6a29\u9650\n\u7528\u9014\n\n\n\n\nadmin\nAdministratorAccess\n\u306a\u3093\u3067\u3082\u3067\u304d\u308b\u3072\u3068\n\n\ndeployer\nPowerUserAccess,IAMReadOnlyAccess\n\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u4eba\u3068\u304b\u3002\u306a\u3093\u3067\u3082\u3067\u304d\u3051\u3069\u30e6\u30fc\u30b6\u30fc\u3068\u304b\u4f5c\u308c\u306a\u3044\u4eba\n\n\ndeveloper\nReadOnlyAccess, DeveloperPolicy(Local)\n\u4e00\u5fdc\u5168\u90e8\u898b\u308c\u3066\u3001\u958b\u767a\u8005\u3067\u958b\u767a\u7528\u306e\u30dd\u30ea\u30b7\u30fc\u3060\u3051\u306b\u3059\u308b\u4eba\n\n\noperator\nReadOnlyAccess\n\u5168\u90e8\u898b\u308c\u308b\u3060\u3051\u306e\u4eba\n\n\n\n\u53c2\u8003\uff1a[AWS IAM] \u7d4c\u9a13\u8005\u5411\u3051Managed Policy\u5bfe\u5fdc\u30ac\u30a4\u30c9\nhttp://dev.classmethod.jp/cloud/iam-managed-policy-guide-for-experts/\n\u6a29\u9650\u306f\u57fa\u672c\u7684\u306b\u3001aws\u306emanaged\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u3044\u3002\n\u958b\u767a\u8005\u30b0\u30eb\u30fc\u30d7\u3060\u3051\u81ea\u5206\u3067\u4f5c\u3063\u305f\u30dd\u30ea\u30b7\u30fc\u3092\u5f53\u3066\u3068\u304f\u3002\n(Local)\u3063\u3066\u3064\u3051\u3066\u308b\u306e\u304cCustomer Managed Policy\n\n\u958b\u767a\u8005\u7528(developer group)\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u308b\n\n\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u3063\u3068\u304f\n\u958b\u767a\u8005\u306b\u3069\u3093\u306a\u74b0\u5883\u3092\u4e0e\u3048\u308b\u304b\u306b\u3088\u3063\u3066\u304b\u308f\u3063\u3066\u304d\u307e\u3059\u304c\u3001\u30a4\u30f3\u30d5\u30e9\u7684\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u6e21\u3059\u3060\u3051\u306e\u5834\u5408\u3001stop\u3068start\u3060\u3051\u3067\u304d\u308c\u3070\u5927\u4e08\u592b\u3063\u3066\u3053\u3068\u306b\u3059\u308b\u3002\n\u4f8b EC2 \u3092 stop \u3068 start\u3060\u3051\u3067\u304d\u3066\u30bf\u30b0\u304c\u4ed8\u3051\u3089\u308c\u308b\u30dd\u30ea\u30b7\u30fc\n\ndeveloperpolicy.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Stmt1398823591000\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:RunInstances\",\n        \"ec2:StartInstances\",\n        \"ec2:StopInstances\",\n        \"ec2:CreateTags\" \n      ],\n      \"Resource\": [\n        \"*\" \n      ]\n    }\n  ]\n}\n\n\n\n\u30dd\u30ea\u30b7\u30fc\u306e\u540d\u524d\u3092\u6c7a\u3066\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\nDeveloperPolicy\u3068\u3057\u307e\u3059\u3002\n\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\nPOLICY_NAME=DeveloperPolicy\n\n\n\u30dd\u30ea\u30b7\u30fc\u306e\u8aac\u660e\u3092\u3092\u6c7a\u3081\u3066\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\nPOLICY_DESCRIPTION=\"DeveloperPolicy Resource Stop Start and more like RDS stop start...\"\n\n\n\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u6240\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u76f4\u4e0b\u306b\u304a\u3044\u3066\u3042\u308b\u6642\u306ffile://...\nPOLICY_DOCUMENT=file://developerpolicy.json\n\n\ncli\u306eprofile\u540d\u3092\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\nAWS_PROFILE_NAME=click_system_prod\n\n\n\u5b9f\u884c\naws iam create-policy  \\\n--policy-name $POLICY_NAME \\\n--policy-document $POLICY_DOCUMENT \\\n--description $POLICY_DESCRIPTION \\\n--profile $AWS_PROFILE_NAME\n\n\n\u3067\u304d\u3066\u308b\u304b\u78ba\u8a8d\naws iam list-policies --query Policies[][] --profile $AWS_PROFILE_NAME --scope Local\n\n\u81ea\u5206\u3067\u4f5c\u3063\u305f\u3084\u3064\u3060\u3051\u78ba\u8a8d\u3057\u305f\u3044\u3068\u304d\u306f\u3001--scope Local\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n[\n    {\n        \"PolicyName\": \"\u307e\u3048\u3064\u304f\u3063\u305f\u3084\u3064\", \n        \"CreateDate\": \"2015-04-07T09:23:46Z\", \n        \"AttachmentCount\": 4, \n        \"IsAttachable\": true, \n        \"PolicyId\": \"XXXXXXXXXXXXXX\", \n        \"DefaultVersionId\": \"v1\", \n        \"Path\": \"/\", \n        \"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/\u307e\u3048\u3064\u304f\u3063\u305f\u3084\u3064\", \n        \"UpdateDate\": \"2015-04-07T09:23:46Z\"\n    }, \n    {\n        \"PolicyName\": \"DeveloperPolicy\", \n        \"CreateDate\": \"2015-03-25T07:55:41Z\", \n        \"AttachmentCount\": 1, \n        \"IsAttachable\": true, \n        \"PolicyId\": \"XXXXXXXXXXXXXX\", \n        \"DefaultVersionId\": \"v1\", \n        \"Path\": \"/\", \n        \"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/DeveloperPolicy\", \n        \"UpdateDate\": \"2015-03-25T07:55:41Z\"\n    }\n]\n\n\u3067\u304d\u3066\u308b\u3002\n\nDeveloper\u7528\u306e\u30dd\u30ea\u30b7\u30fcARN\u3092\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\njson\u3060\u3068\"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/DeveloperPolicy\"\u3063\u3066\u306a\u3063\u3066\u308b\u90e8\u5206\u3067\u3059\u3002\n\u304b\u3063\u3053\u826f\u304f\u30b3\u30de\u30f3\u30c9\u3067\u5165\u308c\u308b\u3002\u307e\u305f\u306f\u30b3\u30d4\u30da\u3057\u3066\u5165\u308c\u3068\u304f\u3002\nPOLICY_ARN=$(aws iam list-policies --query Policies[][] --profile $AWS_PROFILE_NAME --scope Local --output text | grep $POLICY_NAME | awk '{print $1}')\n\n\n\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\n\nadmin\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fAdmin\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\nGROUP_NAME=admin\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/AdministratorAccess --profile $AWS_PROFILE_NAME\n\n\ndeveloper\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fReadOnly\u3068\u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u3084\u3064\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\nGROUP_NAME=developer\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn\n arn:aws:iam::aws:policy/ReadOnlyAccess --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn $POLICY_ARN --profile $AWS_PROFILE_NAME\n\n\ndeployer\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3068IAMReadOnlyAccess\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\nGROUP_NAME=deployer\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/PowerUserAccess --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/IAMReadOnlyAccess --profile $AWS_PROFILE_NAME\n\n\noperator\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fReadOnlyAccess\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\nGROUP_NAME=operator\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/ReadOnlyAccess --profile $AWS_PROFILE_NAME\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u308c\u3067\u4f53\u88c1\u306f\u6574\u3046\u306f\u305a\u3002\n\u306a\u3093\u304b\u5897\u3048\u305f\u3089\u3053\u306esnippet\u30b3\u30d4\u30da\u3067\u5897\u3084\u3059\u3002\n\n# \u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u8a08\n\n\u3060\u3044\u305f\u3044\u306f\u6700\u521d\u4ee5\u4e0b\u3067\u8db3\u308a\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u3002\n\n| \u30b0\u30eb\u30fc\u30d7\u540d | \u6a29\u9650 |\u7528\u9014|\n|:-----------|:------------:|:-----------|\n|admin| AdministratorAccess |\u306a\u3093\u3067\u3082\u3067\u304d\u308b\u3072\u3068|\n|deployer|PowerUserAccess,IAMReadOnlyAccess|\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u4eba\u3068\u304b\u3002\u306a\u3093\u3067\u3082\u3067\u304d\u3051\u3069\u30e6\u30fc\u30b6\u30fc\u3068\u304b\u4f5c\u308c\u306a\u3044\u4eba|\n|developer| ReadOnlyAccess, DeveloperPolicy(Local) |\u4e00\u5fdc\u5168\u90e8\u898b\u308c\u3066\u3001\u958b\u767a\u8005\u3067\u958b\u767a\u7528\u306e\u30dd\u30ea\u30b7\u30fc\u3060\u3051\u306b\u3059\u308b\u4eba|\n|operator| ReadOnlyAccess |\u5168\u90e8\u898b\u308c\u308b\u3060\u3051\u306e\u4eba|\n\n\n\u53c2\u8003\uff1a[AWS IAM] \u7d4c\u9a13\u8005\u5411\u3051Managed Policy\u5bfe\u5fdc\u30ac\u30a4\u30c9\nhttp://dev.classmethod.jp/cloud/iam-managed-policy-guide-for-experts/\n\n\n\u6a29\u9650\u306f\u57fa\u672c\u7684\u306b\u3001aws\u306emanaged\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u3044\u3002\n\u958b\u767a\u8005\u30b0\u30eb\u30fc\u30d7\u3060\u3051\u81ea\u5206\u3067\u4f5c\u3063\u305f\u30dd\u30ea\u30b7\u30fc\u3092\u5f53\u3066\u3068\u304f\u3002\n(Local)\u3063\u3066\u3064\u3051\u3066\u308b\u306e\u304cCustomer Managed Policy\n\n# \u958b\u767a\u8005\u7528(developer group)\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u308b\n\n## \u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u3063\u3068\u304f\n\n\u958b\u767a\u8005\u306b\u3069\u3093\u306a\u74b0\u5883\u3092\u4e0e\u3048\u308b\u304b\u306b\u3088\u3063\u3066\u304b\u308f\u3063\u3066\u304d\u307e\u3059\u304c\u3001\u30a4\u30f3\u30d5\u30e9\u7684\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u6e21\u3059\u3060\u3051\u306e\u5834\u5408\u3001stop\u3068start\u3060\u3051\u3067\u304d\u308c\u3070\u5927\u4e08\u592b\u3063\u3066\u3053\u3068\u306b\u3059\u308b\u3002\n\n\u4f8b EC2 \u3092 stop \u3068 start\u3060\u3051\u3067\u304d\u3066\u30bf\u30b0\u304c\u4ed8\u3051\u3089\u308c\u308b\u30dd\u30ea\u30b7\u30fc\n\n```json:developerpolicy.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Stmt1398823591000\",\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"ec2:RunInstances\",\n        \"ec2:StartInstances\",\n        \"ec2:StopInstances\",\n        \"ec2:CreateTags\" \n      ],\n      \"Resource\": [\n        \"*\" \n      ]\n    }\n  ]\n}\n```\n\n## \u30dd\u30ea\u30b7\u30fc\u306e\u540d\u524d\u3092\u6c7a\u3066\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\nDeveloperPolicy\u3068\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\n\tPOLICY_NAME=DeveloperPolicy\n\n## \u30dd\u30ea\u30b7\u30fc\u306e\u8aac\u660e\u3092\u3092\u6c7a\u3081\u3066\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\t\n\tPOLICY_DESCRIPTION=\"DeveloperPolicy Resource Stop Start and more like RDS stop start...\"\n\n## \u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u6240\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u76f4\u4e0b\u306b\u304a\u3044\u3066\u3042\u308b\u6642\u306ffile://...\n\n\tPOLICY_DOCUMENT=file://developerpolicy.json\n\t\n## cli\u306eprofile\u540d\u3092\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\n\tAWS_PROFILE_NAME=click_system_prod\n\n## \u5b9f\u884c\n\n```\naws iam create-policy  \\\n--policy-name $POLICY_NAME \\\n--policy-document $POLICY_DOCUMENT \\\n--description $POLICY_DESCRIPTION \\\n--profile $AWS_PROFILE_NAME\n```\n\n## \u3067\u304d\u3066\u308b\u304b\u78ba\u8a8d\n\n```\naws iam list-policies --query Policies[][] --profile $AWS_PROFILE_NAME --scope Local\n```\n\u81ea\u5206\u3067\u4f5c\u3063\u305f\u3084\u3064\u3060\u3051\u78ba\u8a8d\u3057\u305f\u3044\u3068\u304d\u306f\u3001```--scope Local```\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3002\n\n```\n[\n    {\n        \"PolicyName\": \"\u307e\u3048\u3064\u304f\u3063\u305f\u3084\u3064\", \n        \"CreateDate\": \"2015-04-07T09:23:46Z\", \n        \"AttachmentCount\": 4, \n        \"IsAttachable\": true, \n        \"PolicyId\": \"XXXXXXXXXXXXXX\", \n        \"DefaultVersionId\": \"v1\", \n        \"Path\": \"/\", \n        \"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/\u307e\u3048\u3064\u304f\u3063\u305f\u3084\u3064\", \n        \"UpdateDate\": \"2015-04-07T09:23:46Z\"\n    }, \n    {\n        \"PolicyName\": \"DeveloperPolicy\", \n        \"CreateDate\": \"2015-03-25T07:55:41Z\", \n        \"AttachmentCount\": 1, \n        \"IsAttachable\": true, \n        \"PolicyId\": \"XXXXXXXXXXXXXX\", \n        \"DefaultVersionId\": \"v1\", \n        \"Path\": \"/\", \n        \"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/DeveloperPolicy\", \n        \"UpdateDate\": \"2015-03-25T07:55:41Z\"\n    }\n]\n```\n\n\u3067\u304d\u3066\u308b\u3002\n\n## Developer\u7528\u306e\u30dd\u30ea\u30b7\u30fcARN\u3092\u74b0\u5883\u5909\u6570\u306b\u5165\u308c\u3068\u304f\n\njson\u3060\u3068```\"Arn\": \"arn:aws:iam::XXXXXXXXXXXXXX:policy/DeveloperPolicy\"```\u3063\u3066\u306a\u3063\u3066\u308b\u90e8\u5206\u3067\u3059\u3002\n\n\u304b\u3063\u3053\u826f\u304f\u30b3\u30de\u30f3\u30c9\u3067\u5165\u308c\u308b\u3002\u307e\u305f\u306f\u30b3\u30d4\u30da\u3057\u3066\u5165\u308c\u3068\u304f\u3002\n\n```\nPOLICY_ARN=$(aws iam list-policies --query Policies[][] --profile $AWS_PROFILE_NAME --scope Local --output text | grep $POLICY_NAME | awk '{print $1}')\n```\n\n# \u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\n\n## admin\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fAdmin\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n```\nGROUP_NAME=admin\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/AdministratorAccess --profile $AWS_PROFILE_NAME\n```\n \n## developer\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fReadOnly\u3068\u30aa\u30ea\u30b8\u30ca\u30eb\u306e\u3084\u3064\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n```\nGROUP_NAME=developer\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn\n arn:aws:iam::aws:policy/ReadOnlyAccess --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn $POLICY_ARN --profile $AWS_PROFILE_NAME\n```\n \n## deployer\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3068IAMReadOnlyAccess\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n```\n\nGROUP_NAME=deployer\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/PowerUserAccess --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/IAMReadOnlyAccess --profile $AWS_PROFILE_NAME\n```\n\n## operator\u30b0\u30eb\u30fc\u30d7\u4f5c\u308b\n\n\u30dd\u30ea\u30b7\u30fc\u306fReadOnlyAccess\u3060\u3051\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n```\nGROUP_NAME=operator\n\naws iam create-group --group-name $GROUP_NAME --profile $AWS_PROFILE_NAME\n\naws iam attach-group-policy --group-name $GROUP_NAME --policy-arn arn:aws:iam::aws:policy/ReadOnlyAccess --profile $AWS_PROFILE_NAME\n``` \n\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u308c\u3067\u4f53\u88c1\u306f\u6574\u3046\u306f\u305a\u3002\n\u306a\u3093\u304b\u5897\u3048\u305f\u3089\u3053\u306esnippet\u30b3\u30d4\u30da\u3067\u5897\u3084\u3059\u3002\n"}