{"context": "Internal Load Balancer\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u69cb\u6210\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nUnmanaged Instance Group\u3092\u4f5c\u6210\nAlpha\u7248\u306e\u5236\u7d04\u3068\u3057\u3066\u3001Managed Instance Group\u306b\u306f\u672a\u5bfe\u5fdc\u3002\ngcloud compute instance-groups unmanaged create asia-ig1 --zone asia-east1-a\n\ngcloud compute instance-groups unmanaged create asia-ig2 --zone asia\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Zone\u6bce\u306b\u4f5c\u6210\n gcloud compute instances create ig-asia-east1-1 --image-family debian-8 --image-project debian-cloud --tags int-lb --zone asia-east1-a --subnet stg-asia --metadata startup-script=\"#! /bin/bash\napt-get update\napt-get install apache2 -y\na2ensite default-ssl\na2enmod ssl\nservice apache2 start\necho '<!doctype html><html><body><h1>SSL load balanced instance - ASIA east 1</h1></body></html>' | tee /var\n/www/html/index.html\nEOF\"\n\n gcloud compute instances create ig-asia-east1-2 --image-family debian-8 --image-project debian-cloud --tags int-lb --zone asia-east1-c --subnet stg-asia --metadata startup-script=\"#! /bin/bash\napt-get update\napt-get install apache2 -y\na2ensite default-ssl\na2enmod ssl\nservice apache2 start\necho '<!doctype html><html><body><h1>SSL load balanced instance - ASIA east 2</h1></body></html>' | tee /var\n/www/html/index.html\nEOF\"\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Instance Group\u306b\u7d10\u4ed8\u3051\u308b\n gcloud compute instance-groups unmanaged add-instances asia-ig1 --instances ig-asia-east1-1 --zone asia-east1-a\n\ngcloud compute instance-groups unmanaged add-instances asia-ig2 --instances ig-asia-east1-2 --zone asia-east1-c\n\n\n\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306e\u4f5c\u6210\ngcloud alpha compute health-checks create tcp my-tcp-health-check --port 80\n\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\n gcloud alpha compute backend-services create my-backend-service \\\n> --load-balancing-scheme internal \\\n> --region asia-east1 \\\n> --health-check my-tcp-health-check \\\n> --timeout=5m\n\n\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306f132.0.0\u304b\u3089\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nWARNING: Abbreviated flag [--health-check] will be disabled in release 132.0.0, use the full name [--health-checks].\n\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u8ffd\u52a0\ngcloud alpha compute backend-services add-backend my-backend-service \\\n> --instance-group asia-ig1 \\\n> --instance-group-zone asia-east1-a \\\n> --region asia-east1\n\ngcloud alpha compute backend-services add-backend my-backend-service\n --instance-group asia-ig2 --instance-group-zone asia-east1-c --region asia-east1\n\n\nForwarding Rule\u306e\u4f5c\u6210\ngcloud alpha compute forwarding-rules create internal-lb-forwarding-rule  --load-balancing-scheme internal  --ports 80 --network stg-network  --subnet stg-asia  --region asia-east1 --backend-service my-backend-service\n\n--load-balancing-scheme\u4ee5\u5916\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306eLoad Balancer\u3068\u307b\u307c\u540c\u3058\u3067\u4f5c\u6210\u304c\u53ef\u80fd\n\n\u5f8c\u59cb\u672b\n ggcloud compute instances create standalone-instance-1 --image-family debian-8 --zone asia-east1-a --subnet stg-asia --image-project debian-cloud\n\ngcloud alpha compute forwarding-rules list\nNAME                         REGION      IP_ADDRESS     IP_PROTOCOL  TARGET\ninternal-lb-forwarding-rule  asia-east1  10.80.10.4     TCP\n\ngcloud alpha compute forwarding-rules delete internal-lb-forwarding-rule\n\ngcloud alpha compute backend-services list\n\nNAME                    BACKENDS                                                                   PROTOCOL  LOAD_BALANCING_SCHEME  HEALTH_CHECKS\nmy-backend-service      asia-east1-a/instanceGroups/asia-ig1,asia-east1-c/instanceGroups/asia-ig2  TCP       INTERNAL               my-tcp-health-check\n\n gcloud alpha compute backend-services delete my-backend-service --region asia-east1\n\ngcloud compute instance-groups unmanaged list\nNAME      ZONE          NETWORK      MANAGED  INSTANCES\nasia-ig2  asia-east1-c  stg-network  No       1\nasia-ig1  asia-east1-a  stg-network  No       1\n\ngcloud compute instance-groups unmanaged delete asia-ig1\n\ngcloud compute instance-groups unmanaged delete asia-ig2\n\n\ngcloud compute instances list\nNAME                   ZONE          MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP      STATUS\nig-asia-east1-2        asia-east1-c  n1-standard-1               10.80.10.3   104.199.139.71   RUNNING\nig-asia-east1-1        asia-east1-a  n1-standard-1               10.80.10.2   104.155.193.220  RUNNING\n`\ngcloud compute instances delete ig-asia-east1-1\n\ngcloud compute instances delete ig-asia-east1-2\n\ngcloud compute instances delete standalone-instance-1\n\nInternal Load Balancer\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u3001\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u69cb\u6210\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n![\u30d7\u30ec\u30bc\u30f3\u30c6\u30fc\u30b7\u30e7\u30f31.png](https://qiita-image-store.s3.amazonaws.com/0/32140/6861159a-c755-b9d5-d17f-be0bc3a2c7dc.png)\n\n# Unmanaged Instance Group\u3092\u4f5c\u6210\n\nAlpha\u7248\u306e\u5236\u7d04\u3068\u3057\u3066\u3001Managed Instance Group\u306b\u306f\u672a\u5bfe\u5fdc\u3002\n\n```\ngcloud compute instance-groups unmanaged create asia-ig1 --zone asia-east1-a\n```\n\n\n```\ngcloud compute instance-groups unmanaged create asia-ig2 --zone asia\n```\n\n# \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Zone\u6bce\u306b\u4f5c\u6210\n\n```\n gcloud compute instances create ig-asia-east1-1 --image-family debian-8 --image-project debian-cloud --tags int-lb --zone asia-east1-a --subnet stg-asia --metadata startup-script=\"#! /bin/bash\napt-get update\napt-get install apache2 -y\na2ensite default-ssl\na2enmod ssl\nservice apache2 start\necho '<!doctype html><html><body><h1>SSL load balanced instance - ASIA east 1</h1></body></html>' | tee /var\n/www/html/index.html\nEOF\"\n```\n\n```\n gcloud compute instances create ig-asia-east1-2 --image-family debian-8 --image-project debian-cloud --tags int-lb --zone asia-east1-c --subnet stg-asia --metadata startup-script=\"#! /bin/bash\napt-get update\napt-get install apache2 -y\na2ensite default-ssl\na2enmod ssl\nservice apache2 start\necho '<!doctype html><html><body><h1>SSL load balanced instance - ASIA east 2</h1></body></html>' | tee /var\n/www/html/index.html\nEOF\"\n```\n\n# \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Instance Group\u306b\u7d10\u4ed8\u3051\u308b\n\n```\n gcloud compute instance-groups unmanaged add-instances asia-ig1 --instances ig-asia-east1-1 --zone asia-east1-a\n```\n\n```\ngcloud compute instance-groups unmanaged add-instances asia-ig2 --instances ig-asia-east1-2 --zone asia-east1-c\n```\n\n# \u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306e\u4f5c\u6210\n\n```\ngcloud alpha compute health-checks create tcp my-tcp-health-check --port 80\n```\n\n# \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\n\n```\n gcloud alpha compute backend-services create my-backend-service \\\n> --load-balancing-scheme internal \\\n> --region asia-east1 \\\n> --health-check my-tcp-health-check \\\n> --timeout=5m\n```\n\n\u30d8\u30eb\u30b9\u30c1\u30a7\u30c3\u30af\u306f132.0.0\u304b\u3089\u901a\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nWARNING: Abbreviated flag [--health-check] will be disabled in release 132.0.0, use the full name [--health-checks].\n```\n\n# \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d3\u30b9\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u8ffd\u52a0\n\n```\ngcloud alpha compute backend-services add-backend my-backend-service \\\n> --instance-group asia-ig1 \\\n> --instance-group-zone asia-east1-a \\\n> --region asia-east1\n```\n\n```\ngcloud alpha compute backend-services add-backend my-backend-service\n --instance-group asia-ig2 --instance-group-zone asia-east1-c --region asia-east1\n```\n\n# Forwarding Rule\u306e\u4f5c\u6210\n\n```\ngcloud alpha compute forwarding-rules create internal-lb-forwarding-rule  --load-balancing-scheme internal  --ports 80 --network stg-network  --subnet stg-asia  --region asia-east1 --backend-service my-backend-service\n```\n\n--load-balancing-scheme\u4ee5\u5916\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306eLoad Balancer\u3068\u307b\u307c\u540c\u3058\u3067\u4f5c\u6210\u304c\u53ef\u80fd\n\n# \u5f8c\u59cb\u672b\n\n```\n ggcloud compute instances create standalone-instance-1 --image-family debian-8 --zone asia-east1-a --subnet stg-asia --image-project debian-cloud\n```\n\n```\ngcloud alpha compute forwarding-rules list\nNAME                         REGION      IP_ADDRESS     IP_PROTOCOL  TARGET\ninternal-lb-forwarding-rule  asia-east1  10.80.10.4     TCP\n```\n\n```\ngcloud alpha compute forwarding-rules delete internal-lb-forwarding-rule\n```\n\n```\ngcloud alpha compute backend-services list\n```\n\n```\nNAME                    BACKENDS                                                                   PROTOCOL  LOAD_BALANCING_SCHEME  HEALTH_CHECKS\nmy-backend-service      asia-east1-a/instanceGroups/asia-ig1,asia-east1-c/instanceGroups/asia-ig2  TCP       INTERNAL               my-tcp-health-check\n```\n\n```\n gcloud alpha compute backend-services delete my-backend-service --region asia-east1\n```\n\n```\ngcloud compute instance-groups unmanaged list\nNAME      ZONE          NETWORK      MANAGED  INSTANCES\nasia-ig2  asia-east1-c  stg-network  No       1\nasia-ig1  asia-east1-a  stg-network  No       1\n```\n\n\n```\ngcloud compute instance-groups unmanaged delete asia-ig1\n```\n\n```\ngcloud compute instance-groups unmanaged delete asia-ig2\n```\n\n``\ngcloud compute instances list\nNAME                   ZONE          MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP      STATUS\nig-asia-east1-2        asia-east1-c  n1-standard-1               10.80.10.3   104.199.139.71   RUNNING\nig-asia-east1-1        asia-east1-a  n1-standard-1               10.80.10.2   104.155.193.220  RUNNING\n```\n\n```\ngcloud compute instances delete ig-asia-east1-1\n```\n\n\n```\ngcloud compute instances delete ig-asia-east1-2\n```\n\n```\ngcloud compute instances delete standalone-instance-1\n```\n\n\n\n", "tags": ["GoogleCloudPlatform"]}