{"context": " More than 1 year has passed since last update.Node.js Advent Calender \u306e6\u65e5\u76ee\u3067\u3059\u3002\u9806\u8abf\u306b\u7d9a\u3044\u3066\u307e\u3059\u306d\u3002\n\u3053\u306e\u9593\u306e\u6771\u4eacNode\u5b66\u5712\u796d2014\u3067@upgrade_ayp\u3055\u3093\u30bb\u30c3\u30b7\u30e7\u30f3\u3067@mizchi\u3055\u3093\u3068\u96a3\u306e\u5e2d\u3067\u3057\u305f\u304c\u3053\u3053\u3067\u3082mizchi\u3055\u3093\u306e\u96a3(\u6b21\u306e\u65e5)\u307f\u305f\u3044\u3067\u3059\u7b11\n\n\u306f\u3058\u3081\u306b\n\u4eca\u56de\u306e\u30cd\u30bf\u306fNode.js/Socket.io\u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3059\u308b\u3068\u304d\u306b\u521d\u5fc3\u8005\u5411\u3051\u8a18\u4e8b\u3067\u3059\u3002\n(\u5b9f\u969b\u306bAWS\u4e0a\u3067\u8907\u6570\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u3066Node.js\u30d7\u30ed\u30bb\u30b9\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u3092\u3057\u305f\u3068\u304d\u306b\u3064\u307e\u3065\u3044\u305f\u7d4c\u9a13\u304b\u3089\u3001\u304a\u3055\u3089\u3044\u3092\u517c\u306d\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002)\n\n\u3053\u3061\u3089\u306e\u8a18\u4e8b(Node.js\u3063\u3066\u306a\u3093\u3058\u3083\uff1f\uff08Socket.IO\u3068ELB\u306e\u307e\u3068\u3081\uff09)\u306b\u3042\u308b\u3088\u3046\u306b\u8907\u6570\u30d7\u30ed\u30bb\u30b9\u3067Socket.io\u3092\u5171\u6709\u3059\u308b\u5834\u5408\u306fRedis\u3092\u4f7f\u3044\u307e\u3059\u3002\nSocket.io\u306e0.9\u7cfb\u4ee5\u524d\u30681\u7cfb\u4ee5\u964d\u3068\u3067\u306f\u3051\u3063\u3053\u3046\u4e2d\u8eab\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u5370\u8c61\u3067\u3059\u304c\u3001 \u66f8\u7c4d\u3084\u56fd\u5185\u6280\u8853\u30d6\u30ed\u30b0\u306a\u3069\u306f\u672a\u3060\u306b0.9\u7cfb\u4ee5\u524d\u3067\u8a18\u8ff0\u3055\u308c\u305f\u3082\u306e\u304c\u591a\u3044 \u3067\u3059\u3002\n(\u2191\u3067\u30ea\u30f3\u30af\u3092\u8cbc\u3063\u305f\u8a18\u4e8b\u3082\u3084\u306f\u308aSocket.io\u304c1\u7cfb\u306b\u306a\u308b\u524d\u306e\u8a18\u4e8b\u3067\u3059)\n\u4eca\u3067\u306f1\u7cfb\u304c\u4e3b\u6d41\u306a\u306e\u30671\u7cfb\u306e\u66f8\u304d\u65b9\u3067\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b1\u7cfb\u3067\u306fsocket.io-redis\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 0.9\u7cfb\u307e\u3067\u306fsocket.io\u3060\u3051\u3067\u51fa\u6765\u305f\u307f\u305f\u3044\u3067\u3059\u3051\u3069\u30011\u7cfb\u3067\u306f\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u5316\u3057\u305f\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\u3053\u306e\u8fba\u308a\u306f@nulltask\u3055\u3093\u306eExpress / Socket.IO \u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3057\u3066\u307f\u3088\u3046\u3092\u8aad\u3080\u3068\u52c9\u5f37\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001socket.io\u3092\u5229\u7528\u3057\u3066\u3044\u306a\u3044\u90e8\u5206\u304b\u3089socket.io\u3078\u63a5\u7d9a\u3055\u305b\u308b\u305f\u3081\u306esocket.io-emitter\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nsocket.io-emitter\n\n\n\u74b0\u5883\n\nMac OS X 10.9\nNode.js 0.10.26\n\nsocket.io 1.2.1\n\nsocket.io-redis 0.1.4\nredis 2.8.8\n\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u6e96\u5099\n$ mkdir socketApp\n$ cd socketApp\n$ npm i socket.io\n$ npm i socket.io-redis\n\n\n\u30c6\u30b9\u30c8\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u6570\u5206\u306e\u7528\u610f\n\u4eca\u56de\u306fA,B\u3092\u7528\u610f\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u3082\u3068\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n-> Node.js + Socket.IO + jQuery \u3067\u6700\u5c0f\u69cb\u6210\u30c1\u30e3\u30c3\u30c8\n\n\u30d7\u30ed\u30bb\u30b9A \u30dd\u30fc\u30c83001\n\nprocess_a.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9A</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3001);\n\nvar io = require('socket.io').listen(app);\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n    console.log('receive:', data);\n  });\n});\n\n\n\n\u30d7\u30ed\u30bb\u30b9B \u30dd\u30fc\u30c83002\nprocess_a.js\u3068\u9055\u3046\u306e\u306f\u30dd\u30fc\u30c8\u756a\u53f7(3002)\u3068res.write()\u306e\u8868\u793a\u5185\u5bb9\u3060\u3051\u3067\u3059\u3002\n\nprocess_b.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9B</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3002);\n\nvar io = require('socket.io').listen(app);\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n\u3000\u3000 console.log('receive:', data);\n  });\n});\n\n\n\n\u30d5\u30ed\u30f3\u30c8\u5074\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>chat</title>\n</head>\n<body>\n<script src=\"/socket.io/socket.io.js\"></script>\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\"></script>\n<script>\n$(function() {\n  var socket = io.connect();\n  $('form').submit(function() {\n    socket.emit('msg', $('input').val());\n    $('input').val('');\n    return false;\n  });\n\n  socket.on('msg', function(data) {\n        console.log(data);\n    $('div').prepend(data + '<br>');\n\n  });\n});\n</script>\n<form><input></form><div></div>\n</body>\n</html>\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\nsocketApp/\n|\n|---node_modules/\n|      |---socket.io/\n|      |___socket.io-redis/\n|\n|---index.html\n|---process_a.js (\u30dd\u30fc\u30c83001)\n|___process_b.js (\u30dd\u30fc\u30c83002)\n\n\n\u4e00\u5ea6\u8d77\u52d5\u3057\u3066\u307f\u308b\n\u30bf\u30fc\u30df\u30ca\u30eb\u3067node\u30d7\u30ed\u30bb\u30b9A\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ node process_a.js\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089http://localhost:3001\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u5225\u30bf\u30d6\u304b\u5225\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u30d7\u30ed\u30bb\u30b9B\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ node process_b.js\n\n\nSocket.io\u304c\u30d7\u30ed\u30bb\u30b9\u6bce\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092A\u3068B\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u5171\u6709\u3059\u308b\u305f\u3081\u306bRedis\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nredis\u306e\u6e96\u5099 (Mac OS X\u3067Redis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\nRedis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ brew install redis\n==> Downloading https://downloads.sf.net/project/machomebrew/Bottles/redis-2.8.8.mavericks.bottle.tar.gz\n######################################################################## 100.0%\n==> Pouring redis-2.8.8.mavericks.bottle.tar.gz\n==> Caveats\nTo have launchd start redis at login:\n    ln -sfv /usr/local/opt/redis/*.plist ~/Library/LaunchAgents\nThen to load redis now:\n    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.redis.plist\nOr, if you don't want/need launchctl, you can just run:\n    redis-server /usr/local/etc/redis.conf\n==> Summary\n?  /usr/local/Cellar/redis/2.8.8: 10 files, 1.3M\n\nRedis\u8d77\u52d5\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u30676379\u30dd\u30fc\u30c8\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ redis-server\n[41618] 26 Nov 10:20:26.224 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf\n[41618] 26 Nov 10:20:26.226 * Increased maximum number of open files to 10032 (it was originally set to 256).\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           Redis 2.8.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     Running in stand alone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 41618\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n[41618] 26 Nov 10:20:26.227 # Server started, Redis version 2.8.8\n[41618] 26 Nov 10:20:26.227 * The server is now ready to accept connections on port 6379\n\n\n\nsocket.io-redis\u3092\u5229\u7528\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u306b2\u884c\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \n\nprocess_a.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9A</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3001);\n\nvar io = require('socket.io').listen(app);\nvar redis = require('socket.io-redis'); //++\u8ffd\u8a18\nio.adapter(redis({ host: 'localhost', port: 6379 })); //++\u8ffd\u8a18\n\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n    console.log('receive:', data);\n  });\n});\n\n\n\nprocess_b.js\n(\u7701\u7565 process_a.js\u3068\u540c\u69d8\u306b2\u884c\u8ffd\u8a18)\n\n\nNode.js\u3092\u518d\u8d77\u52d5\u3057\u3066\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3053\u308c\u3067\u8907\u6570\u30d7\u30ed\u30bb\u30b9\u9593\u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u5171\u6709\u3067\u304d\u305f\u3053\u3068\u304c\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u307e\u3068\u3081\nNode.js/Socket.io\u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3055\u305b\u3088\u3046\u3068\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u306e\u9053\u3092\u901a\u308b\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002AWS\u3067\u3084\u308b\u5834\u5408\u306fELB\u306e\u90fd\u5408\u4e0a\u3082\u3046\u5c11\u3057\u8a2d\u5b9a\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u5fc5\u8981\u3042\u308a\u3067\u3059\u3051\u3069\u3001\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\u6700\u8fd1\u306fMilkcocoa\u3070\u304b\u308a\u4f7f\u3063\u3066\u3044\u305f\u306e\u3067\u4e45\u3057\u3076\u308a\u306bSocke.io\u3092\u89e6\u308a\u307e\u3057\u305f\u304c\u3084\u3063\u3071\u308a\u81ea\u5206\u3067\u30b5\u30fc\u30d0\u30fc\u5074\u4f5c\u308b\u306e\u306f\u697d\u3057\u3044\u3067\u3059\u306d\u3002\nAutomattic\u793e\u3068Guillermo\u6c0f\u3055\u307e\u3055\u307e\u3067\u3059\u3002\n\u6b21\u306f@t_wada\u3055\u3093\u3067\u3059\u3002\n\n\u306a\u3093\u304b\u3059\u3054\u3044\u4eba\u305f\u3061\u306b\u56f2\u307e\u308c\u3066\u305f\u3093\u3067\u3059\u306a\u6c57\n\n\n[Node.js Advent Calender](http://qiita.com/advent-calendar/2014/nodejs) \u306e6\u65e5\u76ee\u3067\u3059\u3002\u9806\u8abf\u306b\u7d9a\u3044\u3066\u307e\u3059\u306d\u3002\n\u3053\u306e\u9593\u306e[\u6771\u4eacNode\u5b66\u5712\u796d2014](http://yosuke-furukawa.hatenablog.com/entry/2014/11/26/113915)\u3067[@upgrade_ayp](https://twitter.com/upgrade_ayp)\u3055\u3093\u30bb\u30c3\u30b7\u30e7\u30f3\u3067[@mizchi](https://twitter.com/mizchi)\u3055\u3093\u3068\u96a3\u306e\u5e2d\u3067\u3057\u305f\u304c\u3053\u3053\u3067\u3082mizchi\u3055\u3093\u306e\u96a3(\u6b21\u306e\u65e5)\u307f\u305f\u3044\u3067\u3059\u7b11\n\n##\u306f\u3058\u3081\u306b\n\u4eca\u56de\u306e\u30cd\u30bf\u306fNode.js/Socket.io\u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3059\u308b\u3068\u304d\u306b\u521d\u5fc3\u8005\u5411\u3051\u8a18\u4e8b\u3067\u3059\u3002\n(\u5b9f\u969b\u306bAWS\u4e0a\u3067\u8907\u6570\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u3066Node.js\u30d7\u30ed\u30bb\u30b9\u306e\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u3092\u3057\u305f\u3068\u304d\u306b\u3064\u307e\u3065\u3044\u305f\u7d4c\u9a13\u304b\u3089\u3001\u304a\u3055\u3089\u3044\u3092\u517c\u306d\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002)\n\n![](http://i.gyazo.com/297913aca4065e43695c4b661407d031.png)\n\n\u3053\u3061\u3089\u306e\u8a18\u4e8b([Node.js\u3063\u3066\u306a\u3093\u3058\u3083\uff1f\uff08Socket.IO\u3068ELB\u306e\u307e\u3068\u3081\uff09](http://memocra.blogspot.jp/2013/02/nodejssocketioelb.html))\u306b\u3042\u308b\u3088\u3046\u306b\u8907\u6570\u30d7\u30ed\u30bb\u30b9\u3067Socket.io\u3092\u5171\u6709\u3059\u308b\u5834\u5408\u306fRedis\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nSocket.io\u306e0.9\u7cfb\u4ee5\u524d\u30681\u7cfb\u4ee5\u964d\u3068\u3067\u306f\u3051\u3063\u3053\u3046\u4e2d\u8eab\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u5370\u8c61\u3067\u3059\u304c\u3001 **\u66f8\u7c4d\u3084\u56fd\u5185\u6280\u8853\u30d6\u30ed\u30b0\u306a\u3069\u306f\u672a\u3060\u306b0.9\u7cfb\u4ee5\u524d\u3067\u8a18\u8ff0\u3055\u308c\u305f\u3082\u306e\u304c\u591a\u3044** \u3067\u3059\u3002\n(\u2191\u3067\u30ea\u30f3\u30af\u3092\u8cbc\u3063\u305f\u8a18\u4e8b\u3082\u3084\u306f\u308aSocket.io\u304c1\u7cfb\u306b\u306a\u308b\u524d\u306e\u8a18\u4e8b\u3067\u3059)\n\n\u4eca\u3067\u306f1\u7cfb\u304c\u4e3b\u6d41\u306a\u306e\u30671\u7cfb\u306e\u66f8\u304d\u65b9\u3067\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b1\u7cfb\u3067\u306f`socket.io-redis`\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 0.9\u7cfb\u307e\u3067\u306fsocket.io\u3060\u3051\u3067\u51fa\u6765\u305f\u307f\u305f\u3044\u3067\u3059\u3051\u3069\u30011\u7cfb\u3067\u306f\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u5316\u3057\u305f\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\n\u3053\u306e\u8fba\u308a\u306f@[nulltask](https://twitter.com/nulltask)\u3055\u3093\u306e[Express / Socket.IO \u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3057\u3066\u307f\u3088\u3046](https://gist.github.com/nulltask/89e6f36e194c951697a0)\u3092\u8aad\u3080\u3068\u52c9\u5f37\u306b\u306a\u308a\u307e\u3059\u3002\n\n> \u3061\u306a\u307f\u306b\u3001socket.io\u3092\u5229\u7528\u3057\u3066\u3044\u306a\u3044\u90e8\u5206\u304b\u3089socket.io\u3078\u63a5\u7d9a\u3055\u305b\u308b\u305f\u3081\u306e`socket.io-emitter`\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n> [socket.io-emitter](https://github.com/Automattic/socket.io-emitter)\n\n##\u74b0\u5883\n* Mac OS X 10.9\n* Node.js 0.10.26\n* [socket.io](http://socket.io/) 1.2.1\n* [socket.io-redis](https://github.com/Automattic/socket.io-redis) 0.1.4\n* redis 2.8.8\n\n##\u30e2\u30b8\u30e5\u30fc\u30eb\u6e96\u5099\n\n```\n$ mkdir socketApp\n$ cd socketApp\n$ npm i socket.io\n$ npm i socket.io-redis\n```\n\n###\u30c6\u30b9\u30c8\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u6570\u5206\u306e\u7528\u610f\n\u4eca\u56de\u306fA,B\u3092\u7528\u610f\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u3082\u3068\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n-> [Node.js + Socket.IO + jQuery \u3067\u6700\u5c0f\u69cb\u6210\u30c1\u30e3\u30c3\u30c8](http://qiita.com/naga3/items/bdf6176537a5ac77a9b5)\n\n####\u30d7\u30ed\u30bb\u30b9A \u30dd\u30fc\u30c83001\n\n```process_a.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9A</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3001);\n\nvar io = require('socket.io').listen(app);\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n    console.log('receive:', data);\n  });\n});\n```\n\n####\u30d7\u30ed\u30bb\u30b9B \u30dd\u30fc\u30c83002\n\n`process_a.js`\u3068\u9055\u3046\u306e\u306f\u30dd\u30fc\u30c8\u756a\u53f7(3002)\u3068res.write()\u306e\u8868\u793a\u5185\u5bb9\u3060\u3051\u3067\u3059\u3002\n\n```process_b.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9B</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3002);\n\nvar io = require('socket.io').listen(app);\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n\u3000\u3000 console.log('receive:', data);\n  });\n});\n```\n\n###\u30d5\u30ed\u30f3\u30c8\u5074\n\n```\n<!DOCTYPE html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>chat</title>\n</head>\n<body>\n<script src=\"/socket.io/socket.io.js\"></script>\n<script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\"></script>\n<script>\n$(function() {\n  var socket = io.connect();\n  $('form').submit(function() {\n    socket.emit('msg', $('input').val());\n    $('input').val('');\n    return false;\n  });\n  \n  socket.on('msg', function(data) {\n  \t    console.log(data);\n    $('div').prepend(data + '<br>');\n\n  });\n});\n</script>\n<form><input></form><div></div>\n</body>\n</html>\n```\n\n###\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n```\nsocketApp/\n|\n|---node_modules/\n|      |---socket.io/\n|      |___socket.io-redis/\n|\n|---index.html\n|---process_a.js (\u30dd\u30fc\u30c83001)\n|___process_b.js (\u30dd\u30fc\u30c83002)\n```\n\n###\u4e00\u5ea6\u8d77\u52d5\u3057\u3066\u307f\u308b\n\n\u30bf\u30fc\u30df\u30ca\u30eb\u3067node\u30d7\u30ed\u30bb\u30b9A\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ node process_a.js\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089`http://localhost:3001`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n\u5225\u30bf\u30d6\u304b\u5225\u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u30d7\u30ed\u30bb\u30b9B\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ node process_b.js\n```\n\n![](http://i.gyazo.com/33604812ecdba12d36da2641adb9045c.gif)\n\nSocket.io\u304c\u30d7\u30ed\u30bb\u30b9\u6bce\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3053\u308c\u3092A\u3068B\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u5171\u6709\u3059\u308b\u305f\u3081\u306bRedis\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n##redis\u306e\u6e96\u5099 (Mac OS X\u3067Redis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n\nRedis\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ brew install redis\n==> Downloading https://downloads.sf.net/project/machomebrew/Bottles/redis-2.8.8.mavericks.bottle.tar.gz\n######################################################################## 100.0%\n==> Pouring redis-2.8.8.mavericks.bottle.tar.gz\n==> Caveats\nTo have launchd start redis at login:\n    ln -sfv /usr/local/opt/redis/*.plist ~/Library/LaunchAgents\nThen to load redis now:\n    launchctl load ~/Library/LaunchAgents/homebrew.mxcl.redis.plist\nOr, if you don't want/need launchctl, you can just run:\n    redis-server /usr/local/etc/redis.conf\n==> Summary\n?  /usr/local/Cellar/redis/2.8.8: 10 files, 1.3M\n```\n\nRedis\u8d77\u52d5\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067`6379`\u30dd\u30fc\u30c8\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ redis-server\n[41618] 26 Nov 10:20:26.224 # Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf\n[41618] 26 Nov 10:20:26.226 * Increased maximum number of open files to 10032 (it was originally set to 256).\n                _._                                                  \n           _.-``__ ''-._                                             \n      _.-``    `.  `_.  ''-._           Redis 2.8.8 (00000000/0) 64 bit\n  .-`` .-```.  ```\\/    _.,_ ''-._                                   \n (    '      ,       .-`  | `,    )     Running in stand alone mode\n |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6379\n |    `-._   `._    /     _.-'    |     PID: 41618\n  `-._    `-._  `-./  _.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |           http://redis.io        \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n |`-._`-._    `-.__.-'    _.-'_.-'|                                  \n |    `-._`-._        _.-'_.-'    |                                  \n  `-._    `-._`-.__.-'_.-'    _.-'                                   \n      `-._    `-.__.-'    _.-'                                       \n          `-._        _.-'                                           \n              `-.__.-'                                               \n\n[41618] 26 Nov 10:20:26.227 # Server started, Redis version 2.8.8\n[41618] 26 Nov 10:20:26.227 * The server is now ready to accept connections on port 6379\n\n```\n\n##socket.io-redis\u3092\u5229\u7528\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u5148\u307b\u3069\u306e\u30b3\u30fc\u30c9\u306b2\u884c\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \n\n```process_a.js\nvar fs = require('fs');\nvar app = require('http').createServer(function(req, res) {\n  res.writeHead(200, {'Content-Type': 'text/html'});\n  res.write(\"<h1>\u30d7\u30ed\u30bb\u30b9A</h1>\");\n  res.end(fs.readFileSync('index.html'));\n}).listen(3001);\n\nvar io = require('socket.io').listen(app);\nvar redis = require('socket.io-redis'); //++\u8ffd\u8a18\nio.adapter(redis({ host: 'localhost', port: 6379 })); //++\u8ffd\u8a18\n\nio.sockets.on('connection', function(socket) {\n  socket.on('msg', function(data) {\n    io.sockets.emit('msg', data);\n    console.log('receive:', data);\n  });\n});\n```\n\n```process_b.js\n(\u7701\u7565 process_a.js\u3068\u540c\u69d8\u306b2\u884c\u8ffd\u8a18)\n```\n\nNode.js\u3092\u518d\u8d77\u52d5\u3057\u3066\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\n![](http://i.gyazo.com/83c0be188490c9ea72b57610ba1afc01.gif)\n\n\n\u3053\u308c\u3067\u8907\u6570\u30d7\u30ed\u30bb\u30b9\u9593\u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u5171\u6709\u3067\u304d\u305f\u3053\u3068\u304c\u5206\u304b\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n##\u307e\u3068\u3081\nNode.js/Socket.io\u3092\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3055\u305b\u3088\u3046\u3068\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u306e\u9053\u3092\u901a\u308b\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002AWS\u3067\u3084\u308b\u5834\u5408\u306fELB\u306e\u90fd\u5408\u4e0a\u3082\u3046\u5c11\u3057\u8a2d\u5b9a\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u5fc5\u8981\u3042\u308a\u3067\u3059\u3051\u3069\u3001\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u6700\u8fd1\u306f[Milkcocoa](https://mlkcca.com/)\u3070\u304b\u308a\u4f7f\u3063\u3066\u3044\u305f\u306e\u3067\u4e45\u3057\u3076\u308a\u306bSocke.io\u3092\u89e6\u308a\u307e\u3057\u305f\u304c\u3084\u3063\u3071\u308a\u81ea\u5206\u3067\u30b5\u30fc\u30d0\u30fc\u5074\u4f5c\u308b\u306e\u306f\u697d\u3057\u3044\u3067\u3059\u306d\u3002\n\nAutomattic\u793e\u3068Guillermo\u6c0f\u3055\u307e\u3055\u307e\u3067\u3059\u3002\n\n\u6b21\u306f@t_wada\u3055\u3093\u3067\u3059\u3002\n>\u306a\u3093\u304b\u3059\u3054\u3044\u4eba\u305f\u3061\u306b\u56f2\u307e\u308c\u3066\u305f\u3093\u3067\u3059\u306a\u6c57\n", "tags": ["Redis", "Socket.io", "AWS", "JavaScript", "Node.js"]}