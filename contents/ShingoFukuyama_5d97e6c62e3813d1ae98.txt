{"tags": ["iOS", "Objective-C", "iPhone", "WKWebView", "JavaScript"], "context": " More than 1 year has passed since last update.WKWebView\u306f\u81ea\u5206\u3067WKUIDelegate\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30fc\u30c9\u3092\u66f8\u304b\u306a\u3044\u9650\u308a\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u306f\u8868\u793a\u3055\u308c\u305a\u3001JavaScript\u304b\u3089\u306e\u8981\u6c42\u3092\u7121\u8996\u3057\u307e\u3059\u3002\n\n\u5de6\u304b\u3089\u3001JavaScript\u306ealert,confirm,prompt\u304c\u5b9f\u884c\u3055\u308c\u305f\u6642\u306e\u753b\u9762\u3067\u3059\u3002\n\u4ee5\u4e0bWKUIDelegate\u306e\u307f\u3092\u4f7f\u3046\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u305f\u30b3\u30fc\u30c9\u3092\u8a18\u3057\u307e\u3059\u3002\niOS8\u3067\u3042\u308c\u3070Xcode\u3067\u65b0\u898f\u4f5c\u6210\u6642\u306bSingle View Application\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u3001ViewController.m\u306b\u30b3\u30d4\u30da\u3059\u308b\u3060\u3051\u3067\u52d5\u304d\u307e\u3059\u306e\u3067\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002\n//\n//  ViewController.m\n//  MyWKWebView\n//\n//  Created by FukuyamaShingo on 9/22/14.\n//  Copyright (c) 2014 Shingo Fukuyama. All rights reserved.\n//\n\n#import \"ViewController.h\"\n#import <WebKit/WebKit.h>\n\n@interface ViewController ()\n<WKUIDelegate>\n@property (nonatomic, strong) WKWebView *webView;\n@property (nonatomic, strong) UIToolbar *toolbar;\n@property (nonatomic, strong) UIBarButtonItem *buttonForAlert;\n@property (nonatomic, strong) UIBarButtonItem *buttonForConfirm;\n@property (nonatomic, strong) UIBarButtonItem *buttonForPrompt;\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n\n\n    /*\n     * Setup WKWebView only for WKUIDelegate\n     */\n    WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];\n    _webView = [[WKWebView alloc] initWithFrame:CGRectZero configuration:configuration];\n    _webView.UIDelegate = self;\n    NSString *urlString = @\"https://www.google.com\";\n    NSURL *url = [NSURL URLWithString:urlString];\n    NSURLRequest *request = [NSURLRequest requestWithURL:url];\n    [_webView loadRequest:request];\n\n\n    /*\n     * Setup Toolbar\n     */\n    _buttonForAlert = [[UIBarButtonItem alloc] initWithTitle:@\"Alert\"\n                                                       style:UIBarButtonItemStylePlain\n                                                      target:self\n                                                      action:@selector(showAlert:)];\n    _buttonForConfirm = [[UIBarButtonItem alloc] initWithTitle:@\"Confirm\"\n                                                         style:UIBarButtonItemStylePlain\n                                                        target:self\n                                                        action:@selector(showConfirm:)];\n    _buttonForPrompt = [[UIBarButtonItem alloc] initWithTitle:@\"Prompt\"\n                                                        style:UIBarButtonItemStylePlain\n                                                       target:self\n                                                       action:@selector(showPrompt:)];\n    _buttonForAlert.width   = 80.0;\n    _buttonForConfirm.width = 80.0;\n    _buttonForPrompt.width  = 80.0;\n    _toolbar = [[UIToolbar alloc] initWithFrame:CGRectZero];\n    UIBarButtonItem *spacer = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemFlexibleSpace\n                                                                            target:nil\n                                                                            action:nil];\n    _toolbar.items = @[_buttonForAlert, spacer, _buttonForConfirm, spacer, _buttonForPrompt];\n\n    [self.view addSubview:_webView];\n    [self.view addSubview:_toolbar];\n    [self setupConstraints];\n}\n\n- (void)showAlert:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"alert('Alert\u304c\u62bc\u3055\u308c\u307e\u3057\u305f');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n- (void)showConfirm:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"var confirmed = confirm('OK?');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n- (void)showPrompt:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"var person = prompt('\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044', '\u30c7\u30d5\u30a9\u30eb\u30c8');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n\n#pragma mark - WKUIDelegate\n\n- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)())completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n\n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message message:sender preferredStyle:UIAlertControllerStyleAlert];\n\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u9589\u3058\u308b\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler();\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString *))completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n\n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:prompt message:sender preferredStyle:UIAlertControllerStyleAlert];\n    [alertController addTextFieldWithConfigurationHandler:^(UITextField *textField) {\n        //textField.placeholder = defaultText;\n        textField.text = defaultText;\n    }];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"OK\" style:UIAlertActionStyleDefault handler:^(UIAlertAction *action) {\n        NSString *input = ((UITextField *)alertController.textFields.firstObject).text;\n        completionHandler(input);\n    }]];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u30ad\u30e3\u30f3\u30bb\u30eb\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler(nil);\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL))completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n\n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message message:sender preferredStyle:UIAlertControllerStyleAlert];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"OK\" style:UIAlertActionStyleDefault handler:^(UIAlertAction *action) {\n        completionHandler(YES);\n    }]];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u30ad\u30e3\u30f3\u30bb\u30eb\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler(NO);\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n\n#pragma mark - Constraints\n\n- (void)setupConstraints\n{\n    _webView.translatesAutoresizingMaskIntoConstraints = NO;\n    [_webView.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"V:|-20.0-[view]-44.0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_webView}]];\n    [_webView.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"H:|-0-[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_webView}]];\n\n    _toolbar.translatesAutoresizingMaskIntoConstraints = NO;\n    [_toolbar.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"V:[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_toolbar}]];\n    [_toolbar.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"H:|-0-[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_toolbar}]];\n    [_toolbar.superview addConstraint:[NSLayoutConstraint constraintWithItem:_toolbar\n                                                               attribute:NSLayoutAttributeHeight\n                                                               relatedBy:NSLayoutRelationEqual\n                                                                  toItem:nil\n                                                               attribute:0\n                                                              multiplier:1.0\n                                                                constant:44.0]];\n\n}\n\n@end\n\n\nAlert\u5730\u7344\u306e\u30b5\u30a4\u30c8\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306b\"\u3053\u306e\u30da\u30fc\u30b8\u3067\u306f\u3053\u308c\u4ee5\u4e0a\u8868\u793a\u3057\u306a\u3044\"\u306a\u3069\u306e\u5bfe\u7b56\u3082\u5fc5\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\nPR: iOS8\u5411\u3051\u306e\u30d6\u30e9\u30a6\u30b6\u30a2\u30d7\u30ea\u30922\u3064\u307b\u3069\u516c\u958b\u3057\u307e\u3059\u306e\u3067\u3001\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002\n\u30d6\u30ed\u30b0: http://fukuyama.co/two-app-before-application\n\nWKWebView\u306f\u81ea\u5206\u3067`WKUIDelegate`\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30fc\u30c9\u3092\u66f8\u304b\u306a\u3044\u9650\u308a\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u753b\u9762\u306f\u8868\u793a\u3055\u308c\u305a\u3001JavaScript\u304b\u3089\u306e\u8981\u6c42\u3092\u7121\u8996\u3057\u307e\u3059\u3002\n\n![wkwebview_uidelegate.png](https://qiita-image-store.s3.amazonaws.com/0/8920/10b5bdc6-739b-121a-4ca6-4751257f0c2a.png)\n\n\n\u5de6\u304b\u3089\u3001JavaScript\u306e`alert`,`confirm`,`prompt`\u304c\u5b9f\u884c\u3055\u308c\u305f\u6642\u306e\u753b\u9762\u3067\u3059\u3002\n\n\u4ee5\u4e0bWKUIDelegate\u306e\u307f\u3092\u4f7f\u3046\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u305f\u30b3\u30fc\u30c9\u3092\u8a18\u3057\u307e\u3059\u3002\n\niOS8\u3067\u3042\u308c\u3070Xcode\u3067\u65b0\u898f\u4f5c\u6210\u6642\u306b`Single View Application`\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u6210\u3057\u3001`ViewController.m`\u306b\u30b3\u30d4\u30da\u3059\u308b\u3060\u3051\u3067\u52d5\u304d\u307e\u3059\u306e\u3067\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002\n\n```objc\n//\n//  ViewController.m\n//  MyWKWebView\n//\n//  Created by FukuyamaShingo on 9/22/14.\n//  Copyright (c) 2014 Shingo Fukuyama. All rights reserved.\n//\n\n#import \"ViewController.h\"\n#import <WebKit/WebKit.h>\n\n@interface ViewController ()\n<WKUIDelegate>\n@property (nonatomic, strong) WKWebView *webView;\n@property (nonatomic, strong) UIToolbar *toolbar;\n@property (nonatomic, strong) UIBarButtonItem *buttonForAlert;\n@property (nonatomic, strong) UIBarButtonItem *buttonForConfirm;\n@property (nonatomic, strong) UIBarButtonItem *buttonForPrompt;\n@end\n\n@implementation ViewController\n\n- (void)viewDidLoad {\n    [super viewDidLoad];\n    \n    \n    /*\n     * Setup WKWebView only for WKUIDelegate\n     */\n    WKWebViewConfiguration *configuration = [[WKWebViewConfiguration alloc] init];\n    _webView = [[WKWebView alloc] initWithFrame:CGRectZero configuration:configuration];\n    _webView.UIDelegate = self;\n    NSString *urlString = @\"https://www.google.com\";\n    NSURL *url = [NSURL URLWithString:urlString];\n    NSURLRequest *request = [NSURLRequest requestWithURL:url];\n    [_webView loadRequest:request];\n    \n    \n    /*\n     * Setup Toolbar\n     */\n    _buttonForAlert = [[UIBarButtonItem alloc] initWithTitle:@\"Alert\"\n                                                       style:UIBarButtonItemStylePlain\n                                                      target:self\n                                                      action:@selector(showAlert:)];\n    _buttonForConfirm = [[UIBarButtonItem alloc] initWithTitle:@\"Confirm\"\n                                                         style:UIBarButtonItemStylePlain\n                                                        target:self\n                                                        action:@selector(showConfirm:)];\n    _buttonForPrompt = [[UIBarButtonItem alloc] initWithTitle:@\"Prompt\"\n                                                        style:UIBarButtonItemStylePlain\n                                                       target:self\n                                                       action:@selector(showPrompt:)];\n    _buttonForAlert.width   = 80.0;\n    _buttonForConfirm.width = 80.0;\n    _buttonForPrompt.width  = 80.0;\n    _toolbar = [[UIToolbar alloc] initWithFrame:CGRectZero];\n    UIBarButtonItem *spacer = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemFlexibleSpace\n                                                                            target:nil\n                                                                            action:nil];\n    _toolbar.items = @[_buttonForAlert, spacer, _buttonForConfirm, spacer, _buttonForPrompt];\n    \n    [self.view addSubview:_webView];\n    [self.view addSubview:_toolbar];\n    [self setupConstraints];\n}\n\n- (void)showAlert:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"alert('Alert\u304c\u62bc\u3055\u308c\u307e\u3057\u305f');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n- (void)showConfirm:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"var confirmed = confirm('OK?');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n- (void)showPrompt:(UIBarButtonItem *)sender\n{\n    NSString *promptCode = @\"var person = prompt('\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044', '\u30c7\u30d5\u30a9\u30eb\u30c8');\";\n    [_webView evaluateJavaScript:promptCode completionHandler:^(id object, NSError *error) { }];\n}\n\n\n#pragma mark - WKUIDelegate\n\n- (void)webView:(WKWebView *)webView runJavaScriptAlertPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)())completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n    \n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message message:sender preferredStyle:UIAlertControllerStyleAlert];\n    \n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u9589\u3058\u308b\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler();\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n- (void)webView:(WKWebView *)webView runJavaScriptTextInputPanelWithPrompt:(NSString *)prompt defaultText:(NSString *)defaultText initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(NSString *))completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n    \n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:prompt message:sender preferredStyle:UIAlertControllerStyleAlert];\n    [alertController addTextFieldWithConfigurationHandler:^(UITextField *textField) {\n        //textField.placeholder = defaultText;\n        textField.text = defaultText;\n    }];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"OK\" style:UIAlertActionStyleDefault handler:^(UIAlertAction *action) {\n        NSString *input = ((UITextField *)alertController.textFields.firstObject).text;\n        completionHandler(input);\n    }]];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u30ad\u30e3\u30f3\u30bb\u30eb\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler(nil);\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n- (void)webView:(WKWebView *)webView runJavaScriptConfirmPanelWithMessage:(NSString *)message initiatedByFrame:(WKFrameInfo *)frame completionHandler:(void (^)(BOOL))completionHandler\n{\n    NSString *hostString = webView.URL.host;\n    NSString *sender = [NSString stringWithFormat:@\"%@\u304b\u3089\u306e\u8868\u793a\", hostString];\n    \n    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:message message:sender preferredStyle:UIAlertControllerStyleAlert];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"OK\" style:UIAlertActionStyleDefault handler:^(UIAlertAction *action) {\n        completionHandler(YES);\n    }]];\n    [alertController addAction:[UIAlertAction actionWithTitle:@\"\u30ad\u30e3\u30f3\u30bb\u30eb\" style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) {\n        completionHandler(NO);\n    }]];\n    [self presentViewController:alertController animated:YES completion:^{}];\n}\n\n\n#pragma mark - Constraints\n\n- (void)setupConstraints\n{\n    _webView.translatesAutoresizingMaskIntoConstraints = NO;\n    [_webView.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"V:|-20.0-[view]-44.0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_webView}]];\n    [_webView.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"H:|-0-[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_webView}]];\n    \n    _toolbar.translatesAutoresizingMaskIntoConstraints = NO;\n    [_toolbar.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"V:[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_toolbar}]];\n    [_toolbar.superview addConstraints:[NSLayoutConstraint\n                                        constraintsWithVisualFormat:@\"H:|-0-[view]-0-|\"\n                                        options:NSLayoutFormatDirectionLeadingToTrailing\n                                        metrics:nil\n                                        views:@{@\"view\":_toolbar}]];\n    [_toolbar.superview addConstraint:[NSLayoutConstraint constraintWithItem:_toolbar\n                                                               attribute:NSLayoutAttributeHeight\n                                                               relatedBy:NSLayoutRelationEqual\n                                                                  toItem:nil\n                                                               attribute:0\n                                                              multiplier:1.0\n                                                                constant:44.0]];\n    \n}\n\n@end\n\n```\n\nAlert\u5730\u7344\u306e\u30b5\u30a4\u30c8\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306b\"\u3053\u306e\u30da\u30fc\u30b8\u3067\u306f\u3053\u308c\u4ee5\u4e0a\u8868\u793a\u3057\u306a\u3044\"\u306a\u3069\u306e\u5bfe\u7b56\u3082\u5fc5\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nPR: iOS8\u5411\u3051\u306e\u30d6\u30e9\u30a6\u30b6\u30a2\u30d7\u30ea\u30922\u3064\u307b\u3069\u516c\u958b\u3057\u307e\u3059\u306e\u3067\u3001\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002\n\u30d6\u30ed\u30b0: http://fukuyama.co/two-app-before-application\n\n\n\n"}