{"context": " More than 1 year has passed since last update.\u3053\u306e\u6295\u7a3f\u306f\u81ea\u5206\u306e\u30d6\u30ed\u30b0\u8a18\u4e8b\u304b\u3089Redis Sentinel\u95a2\u9023\u306e\u9805\u76ee\u3060\u3051\u629c\u7c8b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u8ffd\u8a18\u4e8b\u9805\u304c\u3042\u308c\u3070\u30d6\u30ed\u30b0\u306e\u65b9\u306b\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\u300cRedis\u306e\u76e3\u8996/\u5206\u6790\u7cfb\u30c4\u30fc\u30eb\u307e\u3068\u3081\u300d http://rest-term.com/archives/3045/\n\nRedis Sentinel\n\nRedis\u672c\u5bb6\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u958b\u767a\u3055\u308c\u3066\u3044\u308b\u3001Redis\u30b5\u30fc\u30d0\u306e\u6b7b\u6d3b\u76e3\u8996/\u901a\u77e5\u304a\u3088\u3073\u81ea\u52d5\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u7ba1\u7406\u30b5\u30fc\u30d0(redis-sentinel)\u3067\u3059\u3002v2.4.16\u307e\u305f\u306f2.6.0-rc6\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u3064\u3064\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\n\u74b0\u5883: \nCentOS 5.9 (x86_64), Redis 2.6.10\n\n\n\u69cb\u6210\n\u3053\u3053\u3067\u306f2\u3064\u306e\u30db\u30b9\u30c8\u3067Slave\u30922\u30d7\u30ed\u30bb\u30b9\u3001Sentinel\u30923\u30d7\u30ed\u30bb\u30b9\u306e\u69cb\u6210\u3067\u8a66\u3057\u307e\u3059\u3002\n\nMaster db0:6379\nSlave db0:6380, db1:6379\nSentinel db0:26379, db0:23680, db1:26379\n\n\n\u8a2d\u5b9a\n\n/etc/redis/sentinel.conf\n# port <sentinel-port>\nport 26379\n# sentinel monitor <master-name> <ip> <redis-port> <quorum>\nsentinel monitor mymaster db0 6379 2\n# sentinel down-after-milliseconds <master-name> <milliseconds>\nsentinel down-after-milliseconds mymaster 5000\n# sentinel failover-timeout <master-name> <milliseconds>\nsentinel failover-timeout mymaster 900000\n# sentinel can-failover <master-name> <yes|no>\nsentinel can-failover mymaster yes\n# sentinel parallel-syncs <master-name> <numslaves>\nsentinel parallel-syncs mymaster 1\n\n\n\u5404\u8a2d\u5b9a\u9805\u76ee\u306b\u3064\u3044\u3066\u8868\u306b\u3057\u3066\u3044\u307e\u3059\u3002Sentinel\u306b\u3088\u308b\u30af\u30e9\u30b9\u30bf\u76e3\u8996\u306f\u3044\u308f\u3086\u308bQuorum\u30d9\u30fc\u30b9\u6295\u7968\u306e\u65b9\u5f0f\u3092\u63a1\u308a\u307e\u3059\u3002\u8907\u6570\u306eSentinel\u304cMaster\u3092\u76e3\u8996\u3057\u3066\u3044\u3066\u3001\u305d\u306e\u5185\u3057\u304d\u3044\u5024\u6570\u4ee5\u4e0a\u306eSentinel\u304cMaster\u306e\u30c0\u30a6\u30f3\u3092\u691c\u77e5\u3057\u305f\u3089\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n\n\n\u8a2d\u5b9a\u9805\u76ee\n\u6982\u8981\n\n\n\n\nmonitor\nMaster\u306e\u30db\u30b9\u30c8\u3068\u30dd\u30fc\u30c8\u304a\u3088\u3073\u72b6\u614b\u304cODOWN(objectively down)\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u5b9a\u8db3\u6570(quorum)\n\n\ndown-after-milliseconds\nMaster/Slave\u306e\u30c0\u30a6\u30f3\u691c\u77e5\u5f8c\u3001\u72b6\u614b\u304cSDOWN(subjectively down)\u306b\u79fb\u884c\u3059\u308b\u307e\u3067\u306e\u6642\u9593(ms)\n\n\nfailover-timeout\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(ms)\n\n\ncan-failover\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u304c\u5b9f\u884c\u53ef\u80fd\u304b(yes/no)\n\n\nparallel-syncs\nSlave\u3092Master\u306b\u6607\u683c\u3055\u305b\u305f\u5f8c\u3001\u3044\u304f\u3064\u306eSlave\u3068\u540c\u671f\u3055\u305b\u308b\u304b\n\n\n\nSentinel\u306fMaster\u3068Slave\u4e21\u65b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u72b6\u614b\u304cODOWN\u306b\u9077\u79fb\u3059\u308b\u306e\u306fMaster\u306e\u307f\u306a\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002can-failover \u3092 no \u306b\u3057\u3066\u8d77\u52d5\u3057\u305fSentinel\u30d7\u30ed\u30bb\u30b9\u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u81ea\u4f53\u306f\u884c\u308f\u305a(\u4ed6\u306eSentinel\u306b\u4efb\u305b\u308b)\u3001\u81ea\u8eab\u306f\u30c0\u30a6\u30f3\u691c\u77e5\u3068\u6295\u7968\u51e6\u7406\u306e\u307f\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u8d77\u52d5\nSentinel\u8d77\u52d5\u524d\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nredis-cli\nredis db0:6379> info replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:db0,6380,online\nslave1:db1,6379,online\n\n\n\u7d9a\u3051\u30663\u3064\u306eSentinel\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\nredis-sentinel\n$ redis-sentinel /etc/redis/sentinel.conf\n## \u307e\u305f\u306f redis-server \u3092sentinel\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\n$ redis-server /etc/redis/sentinel.conf --sentinel\n\n\n\u30ed\u30b0\u306b\u3066\u5404Slave\u304a\u3088\u3073Sentinel\u3068\u63a5\u7d9a\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n[19069] 14 May 16:30:31.909 * +slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:30:31.909 * +slave slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:30:38.320 * +sentinel sentinel db0:26380 db0 26380 @ mymaster db0 6379\n[19069] 14 May 16:30:39.655 * +sentinel sentinel db1:26379 db1 26379 @ mymaster db0 6379\n\n\u307e\u305f\u3001Sentinel\u8d77\u52d5\u5f8c\u306fINFO\u30b3\u30de\u30f3\u30c9\u3067Sentinel\u95a2\u9023\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n\nredis-cli\nredis db0:26379> info sentinel\n# Sentinel\nsentinel_masters:1\nsentinel_tilt:0\nsentinel_running_scripts:0\nsentinel_scripts_queue_length:0\nmaster0:name=mymaster,status=ok,address=db0:6379,slaves=2,sentinels=3\n\n\nSentinel\u30d7\u30ed\u30bb\u30b9\u81ea\u4f53\u306e\u76e3\u8996\u306f\u4e00\u756a\u4e0b\u306e\u9805\u76ee\u3092\u898b\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u52d5\u4f5c\u78ba\u8a8d\u306e\u70ba\u3001\u3053\u3053\u3067Master\u3092\u843d\u3068\u3057\u307e\u3059\u3002\n\nredis-cli\nredis db0:6379> shutdown\n\n\n\u30ed\u30b0\u306b\u3066\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u9032\u6357\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n[19069] 14 May 16:30:51.170 # +sdown master mymaster db0 6379\n[19069] 14 May 16:30:52.386 # +odown master mymaster db0 6379 #quorum 2/2\n[19069] 14 May 16:30:52.386 # +failover-triggered master mymaster db0 6379\n[19069] 14 May 16:30:52.386 # +failover-state-wait-start master mymaster db0 6379 #starting in 13910 milliseconds\n[19069] 14 May 16:31:06.379 # +failover-state-select-slave master mymaster db0 6379\n[19069] 14 May 16:31:06.480 # +selected-slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.480 * +failover-state-send-slaveof-noone slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.583 * +failover-state-wait-promotion slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.901 # +promoted-slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.902 # +failover-state-reconf-slaves master mymaster db0 6379\n[19069] 14 May 16:31:06.991 * +slave-reconf-sent slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:07.294 * +slave-reconf-inprog slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:08.316 * +slave-reconf-done slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:08.417 # +failover-end master mymaster db0 6379\n[19069] 14 May 16:31:08.417 # +switch-master mymaster db0 6379 db1 6379\n[19069] 14 May 16:31:08.548 * +slave slave db0:6380 db0 6380 @ mymaster db1 6379\n[19069] 14 May 16:31:09.068 * +sentinel sentinel db0:26380 db0 26380 @ mymaster db1 6379\n[19069] 14 May 16:31:12.258 * +sentinel sentinel db1:26379 db1 26379 @ mymaster db1 6379\n\nSentinel\u304cMaster\u306e\u30c0\u30a6\u30f3\u3092\u691c\u77e5\u3059\u308b\u3068\u72b6\u614b\u304cSDOWN\u306b\u3001quorum\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3057\u305f\u6570\u306eSDOWN\u304c\u63c3\u3046\u3068\u6b21\u306fODOWN\u3078\u3068\u9077\u79fb\u3001\u305d\u306e\u5f8c\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u65b0\u3057\u3044Master\u3068Slave\u3067\u6b63\u5e38\u7a3c\u50cd\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nredis-cli\nredis db1:6379> info replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:db0,6380,online\n\n\n\u4ee5\u4e0a\u3001Sentinel\u306b\u3088\u308b\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6a5f\u80fd\u306e\u52d5\u4f5c\u78ba\u8a8d\u307e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nSentinel API\nSentinel\u306f\u3044\u304f\u3064\u304b\u306eAPI\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u7c21\u5358\u306b\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nredis-cli\n## SENTINEL masters\n# \u76e3\u8996\u5bfe\u8c61\u306eMaster\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel masters\n1)  1) \"name\"\n    2) \"mymaster\"\n    3) \"ip\"\n    4) \"127.0.0.1\"\n    5) \"port\"\n    6) \"6379\"\n    7) \"runid\"\n    8) \"b3b31e6c6d1fbb0cec5d179fd666ce00ea103746\"\n    9) \"flags\"\n   10) \"master\"\n   11) \"pending-commands\"\n   12) \"0\"\n   13) \"last-ok-ping-reply\"\n   14) \"568\"\n   15) \"last-ping-reply\"\n   16) \"568\"\n   17) \"info-refresh\"\n   18) \"9745\"\n   19) \"num-slaves\"\n   20) \"1\"\n   21) \"num-other-sentinels\"\n   22) \"1\"\n   23) \"quorum\"\n   24) \"2\"\n\n## SENTINEL slaves <master name>\n# Slave\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel slaves mymaster\n1)  1) \"name\"\n    2) \"127.0.0.1:6380\"\n    3) \"ip\"\n    4) \"127.0.0.1\"\n    5) \"port\"\n    6) \"6380\"\n    7) \"runid\"\n    8) \"17c0f7e7e4d2af0f5f6140ea0ceb0d82d0010aed\"\n    9) \"flags\"\n   10) \"s_down,slave,disconnected\"\n   11) \"pending-commands\"\n   12) \"0\"\n   13) \"last-ok-ping-reply\"\n   14) \"709377\"\n   15) \"last-ping-reply\"\n   16) \"709377\"\n   17) \"s-down-time\"\n   18) \"704333\"\n   19) \"info-refresh\"\n   20) \"712808\"\n   21) \"master-link-down-time\"\n   22) \"0\"\n   23) \"master-link-status\"\n   24) \"ok\"\n   25) \"master-host\"\n   26) \"127.0.0.1\"\n   27) \"master-port\"\n   28) \"6379\"\n   29) \"slave-priority\"\n   30) \"100\"\n\n## SENTINEL is-master-down-by-addr <ip> <port>\n# Master\u306e\u6b7b\u6d3b\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel is-master-down-by-addr 127.0.0.1 6379\n1) (integer) 0  ## 0:UP, 1:DOWN\n2) \"397dec99760d5d30043941fe4c1c35ba99e99ebf\"  ## Sentinel(subjective leader)\u306erun_id\n\n## SENTINEL get-master-addr-by-name <master name>\n# Master\u306eIP, Port\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel get-master-addr-by-name mymaster\n1) \"127.0.0.1\"\n2) \"6379\"\n\n## SENTINEL reset\n# Sentinel\u306e\u73fe\u5728\u306e\u72b6\u614b\u3092\u30ea\u30bb\u30c3\u30c8(\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u4e2d\u3067\u3042\u3063\u3066\u3082)\nredis 127.0.0.1:26379> sentinel reset mymaster\n(integer) 1\n\n\nSentinel\u95a2\u9023\u306e\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u4f5c\u308b\u969b\u306b\u306f\u3053\u306eSentinel API\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3068\u697d\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u6319\u52d5\u306b\u95a2\u3059\u308b\u90e8\u5206\u3092\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u6607\u683c\u3055\u305b\u308bSlave\u306e\u9078\u629e\n\u5f53\u7136\u3067\u3059\u304cSlave\u3068\u3057\u3066\u6b63\u5e38\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u5bfe\u8c61\u3068\u306a\u308a\u307e\u3059\u3002\u7d30\u304b\u3044\u6761\u4ef6\u3092\u7701\u3044\u3066\u3056\u3063\u304f\u308a\u8a00\u3046\u3068\u3001Master\u3068\u306e\u63a5\u7d9a\u304c\u5b89\u5b9a\u3057\u3066\u3044\u3066(\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u304c\u5c11\u306a\u3044)\u3001Sentinel\u304b\u3089\u306ePING/INFO\u30b3\u30de\u30f3\u30c9\u306b\u76f4\u8fd15000ms\u4ee5\u5185\u306b\u5fdc\u7b54\u3057\u3066\u3044\u308bSlave\u304c\u5bfe\u8c61\u306b\u306a\u308a\u307e\u3059(\u8a73\u7d30\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068 src/sentinel.c \u3092\u53c2\u7167)\u3002\n\u5bfe\u8c61\u3068\u306a\u308bSlave\u304c\u8907\u6570\u3042\u308b\u5834\u5408\u306f slave_priority \u306e\u5024\u304c\u5c0f\u3055\u3044Slave\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\nredis-cli\nredis db0:6380> info replication\n# Replication\nrole:slave\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:0\nmaster_sync_in_progress:0\nslave_priority:100  ## <- \u3053\u306e\u5024\nslave_read_only:1\nconnected_slaves:0\n\n\n\u540c\u3058 slave_priority \u306eSlave\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f run_id \u304c\u5c0f\u3055\u3044Slave\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\nredis-cli\nredis db0:6380> info\n# Server\nredis_version:2.6.10\nredis_git_sha1:00000000\nredis_git_dirty:0\nredis_mode:standalone\nos:Linux 2.6.18-194.26.1.el5 x86_64\narch_bits:64\nmultiplexing_api:epoll\ngcc_version:4.1.2\nprocess_id:17468\nrun_id:17c0f7e7e4d2af0f5f6140ea0ceb0d82d0010aed  ## <- \u3053\u306e\u5024\ntcp_port:6380\nuptime_in_seconds:1738\nuptime_in_days:0\nlru_clock:538965\n\n\n2013/06\u73fe\u5728\u306f slave_priority \u306e\u5909\u66f4\u3092\u884c\u3046API\u306f\u516c\u958b\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u5358\u306b run_id \u304c\u82e5\u3044Slave\u304c\u9078\u629e\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002Slave\u9078\u629e\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u4eca\u5f8c\u5909\u66f4\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308b\u3067\u3057\u3087\u3046\u3002\n\nSentinels/Slaves\u306e\u81ea\u52d5\u691c\u51fa\nSentinel\u306e\u8a2d\u5b9a\u306bSlave\u306e\u30ea\u30b9\u30c8\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u306a\u3044\u306e\u306f\u3001Sentinel\u304cPub/Sub\u306b\u3088\u308b\u60c5\u5831\u5171\u6709\u3092\u884c\u3063\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\u9014\u4e2d\u3067\u5225\u306eSentinel\u3084Slave\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u8ffd\u52a0\u3057\u3066\u3082\u4ed6\u306eSentinel\u306b\u305d\u306e\u60c5\u5831\u306f\u4f1d\u308f\u308a\u307e\u3059\u3002\n\nredis-cli\n## Sentinel\u306f \"__sentinel__:hello\" \u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u308b\nredis db0:6379> subscribe __sentinel__:hello\nReading messages... (press Ctrl-C to quit)\n1) \"subscribe\"\n2) \"__sentinel__:hello\"\n3) (integer) 1\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26380:77887a367e1c76ee9dc15f67a2fb3dc49bb00bf4:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26379:3a92da7269b69fa1dcce5915068c4af6e8caf161:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26380:77887a367e1c76ee9dc15f67a2fb3dc49bb00bf4:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26379:3a92da7269b69fa1dcce5915068c4af6e8caf161:1\"\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5185\u5bb9\u306f host:port:run_id:can-failover \u3068\u306a\u3063\u3066\u3044\u3066\u3001__sentinel__:hello \u30c1\u30e3\u30f3\u30cd\u30eb\u306b5\u79d2\u6bce\u306bpublish\u3001\u5168\u3066\u306eSentinel\u306f\u3053\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u3092subscribe\u3057\u3066\u60c5\u5831\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u6ce8\u610f\u70b9\nRedis\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fMySQL\u306a\u3069\u306eRDBMS\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u306f\u7570\u306a\u308b\u90e8\u5206\u304c\u591a\u3044\u3067\u3059\u3002Redis\u306f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306b\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u30c7\u30a3\u30b9\u30af\u306b\u66f8\u304d\u51fa\u3057\u3066\u304b\u3089Slave\u306b\u8ee2\u9001\u3059\u308b\u306e\u3067I/O\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u306b\u306f\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057\u3001Redis v2.8\u3067\u306fPSYNC(Partial Resynchronization)\u304c\u5b9f\u88c5\u3055\u308c\u308b\u3068\u306e\u3053\u3068\u306a\u306e\u3067\u3053\u306e\u554f\u984c\u306f\u89e3\u6d88\u3055\u308c\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\u5f15\u304d\u7d9a\u304dSentinel\u306e\u691c\u8a3c\u3092\u7d9a\u3051\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u306e\u6295\u7a3f\u306f\u81ea\u5206\u306e\u30d6\u30ed\u30b0\u8a18\u4e8b\u304b\u3089Redis Sentinel\u95a2\u9023\u306e\u9805\u76ee\u3060\u3051\u629c\u7c8b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u8ffd\u8a18\u4e8b\u9805\u304c\u3042\u308c\u3070\u30d6\u30ed\u30b0\u306e\u65b9\u306b\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n__\u300cRedis\u306e\u76e3\u8996/\u5206\u6790\u7cfb\u30c4\u30fc\u30eb\u307e\u3068\u3081\u300d__ http://rest-term.com/archives/3045/\n\n# [Redis Sentinel](http://redis.io/topics/sentinel)\nRedis\u672c\u5bb6\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u958b\u767a\u3055\u308c\u3066\u3044\u308b\u3001Redis\u30b5\u30fc\u30d0\u306e\u6b7b\u6d3b\u76e3\u8996/\u901a\u77e5\u304a\u3088\u3073\u81ea\u52d5\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u7ba1\u7406\u30b5\u30fc\u30d0(redis-sentinel)\u3067\u3059\u3002v2.4.16\u307e\u305f\u306f2.6.0-rc6\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306b\u3057\u3064\u3064\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\n- \u74b0\u5883: \nCentOS 5.9 (x86_64), Redis 2.6.10\n\n## \u69cb\u6210\n\u3053\u3053\u3067\u306f2\u3064\u306e\u30db\u30b9\u30c8\u3067Slave\u30922\u30d7\u30ed\u30bb\u30b9\u3001Sentinel\u30923\u30d7\u30ed\u30bb\u30b9\u306e\u69cb\u6210\u3067\u8a66\u3057\u307e\u3059\u3002\n\n- Master db0:6379\n- Slave db0:6380, db1:6379\n- Sentinel db0:26379, db0:23680, db1:26379\n\n## \u8a2d\u5b9a\n\n```py:/etc/redis/sentinel.conf\n# port <sentinel-port>\nport 26379\n# sentinel monitor <master-name> <ip> <redis-port> <quorum>\nsentinel monitor mymaster db0 6379 2\n# sentinel down-after-milliseconds <master-name> <milliseconds>\nsentinel down-after-milliseconds mymaster 5000\n# sentinel failover-timeout <master-name> <milliseconds>\nsentinel failover-timeout mymaster 900000\n# sentinel can-failover <master-name> <yes|no>\nsentinel can-failover mymaster yes\n# sentinel parallel-syncs <master-name> <numslaves>\nsentinel parallel-syncs mymaster 1\n```\n\n\u5404\u8a2d\u5b9a\u9805\u76ee\u306b\u3064\u3044\u3066\u8868\u306b\u3057\u3066\u3044\u307e\u3059\u3002Sentinel\u306b\u3088\u308b\u30af\u30e9\u30b9\u30bf\u76e3\u8996\u306f\u3044\u308f\u3086\u308bQuorum\u30d9\u30fc\u30b9\u6295\u7968\u306e\u65b9\u5f0f\u3092\u63a1\u308a\u307e\u3059\u3002\u8907\u6570\u306eSentinel\u304cMaster\u3092\u76e3\u8996\u3057\u3066\u3044\u3066\u3001\u305d\u306e\u5185\u3057\u304d\u3044\u5024\u6570\u4ee5\u4e0a\u306eSentinel\u304cMaster\u306e\u30c0\u30a6\u30f3\u3092\u691c\u77e5\u3057\u305f\u3089\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n| \u8a2d\u5b9a\u9805\u76ee | \u6982\u8981 |\n|:---|:---|\n| monitor | Master\u306e\u30db\u30b9\u30c8\u3068\u30dd\u30fc\u30c8\u304a\u3088\u3073\u72b6\u614b\u304c**ODOWN(objectively down)**\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u5b9a\u8db3\u6570(quorum) |\n| down-after-milliseconds\t| Master/Slave\u306e\u30c0\u30a6\u30f3\u691c\u77e5\u5f8c\u3001\u72b6\u614b\u304c**SDOWN(subjectively down)**\u306b\u79fb\u884c\u3059\u308b\u307e\u3067\u306e\u6642\u9593(ms) |\n| failover-timeout | \u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(ms) |\n| can-failover | \u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u304c\u5b9f\u884c\u53ef\u80fd\u304b(yes/no) |\n| parallel-syncs | Slave\u3092Master\u306b\u6607\u683c\u3055\u305b\u305f\u5f8c\u3001\u3044\u304f\u3064\u306eSlave\u3068\u540c\u671f\u3055\u305b\u308b\u304b |\n\nSentinel\u306fMaster\u3068Slave\u4e21\u65b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u72b6\u614b\u304cODOWN\u306b\u9077\u79fb\u3059\u308b\u306e\u306fMaster\u306e\u307f\u306a\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002can-failover \u3092 no \u306b\u3057\u3066\u8d77\u52d5\u3057\u305fSentinel\u30d7\u30ed\u30bb\u30b9\u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u81ea\u4f53\u306f\u884c\u308f\u305a(\u4ed6\u306eSentinel\u306b\u4efb\u305b\u308b)\u3001\u81ea\u8eab\u306f\u30c0\u30a6\u30f3\u691c\u77e5\u3068\u6295\u7968\u51e6\u7406\u306e\u307f\u3092\u884c\u3044\u307e\u3059\u3002\n\n## \u8d77\u52d5\nSentinel\u8d77\u52d5\u524d\u306b\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```py:redis-cli\nredis db0:6379> info replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:db0,6380,online\nslave1:db1,6379,online\n```\n\n\u7d9a\u3051\u30663\u3064\u306eSentinel\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n```py:redis-sentinel\n$ redis-sentinel /etc/redis/sentinel.conf\n## \u307e\u305f\u306f redis-server \u3092sentinel\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\n$ redis-server /etc/redis/sentinel.conf --sentinel\n```\n\n\u30ed\u30b0\u306b\u3066\u5404Slave\u304a\u3088\u3073Sentinel\u3068\u63a5\u7d9a\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n[19069] 14 May 16:30:31.909 * +slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:30:31.909 * +slave slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:30:38.320 * +sentinel sentinel db0:26380 db0 26380 @ mymaster db0 6379\n[19069] 14 May 16:30:39.655 * +sentinel sentinel db1:26379 db1 26379 @ mymaster db0 6379\n```\n\n\u307e\u305f\u3001Sentinel\u8d77\u52d5\u5f8c\u306fINFO\u30b3\u30de\u30f3\u30c9\u3067Sentinel\u95a2\u9023\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n\n```py:redis-cli\nredis db0:26379> info sentinel\n# Sentinel\nsentinel_masters:1\nsentinel_tilt:0\nsentinel_running_scripts:0\nsentinel_scripts_queue_length:0\nmaster0:name=mymaster,status=ok,address=db0:6379,slaves=2,sentinels=3\n```\n\nSentinel\u30d7\u30ed\u30bb\u30b9\u81ea\u4f53\u306e\u76e3\u8996\u306f\u4e00\u756a\u4e0b\u306e\u9805\u76ee\u3092\u898b\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u52d5\u4f5c\u78ba\u8a8d\u306e\u70ba\u3001\u3053\u3053\u3067Master\u3092\u843d\u3068\u3057\u307e\u3059\u3002\n\n```py:redis-cli\nredis db0:6379> shutdown\n```\n\n\u30ed\u30b0\u306b\u3066\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u9032\u6357\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n[19069] 14 May 16:30:51.170 # +sdown master mymaster db0 6379\n[19069] 14 May 16:30:52.386 # +odown master mymaster db0 6379 #quorum 2/2\n[19069] 14 May 16:30:52.386 # +failover-triggered master mymaster db0 6379\n[19069] 14 May 16:30:52.386 # +failover-state-wait-start master mymaster db0 6379 #starting in 13910 milliseconds\n[19069] 14 May 16:31:06.379 # +failover-state-select-slave master mymaster db0 6379\n[19069] 14 May 16:31:06.480 # +selected-slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.480 * +failover-state-send-slaveof-noone slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.583 * +failover-state-wait-promotion slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.901 # +promoted-slave slave db1:6379 db1 6379 @ mymaster db0 6379\n[19069] 14 May 16:31:06.902 # +failover-state-reconf-slaves master mymaster db0 6379\n[19069] 14 May 16:31:06.991 * +slave-reconf-sent slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:07.294 * +slave-reconf-inprog slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:08.316 * +slave-reconf-done slave db0:6380 db0 6380 @ mymaster db0 6379\n[19069] 14 May 16:31:08.417 # +failover-end master mymaster db0 6379\n[19069] 14 May 16:31:08.417 # +switch-master mymaster db0 6379 db1 6379\n[19069] 14 May 16:31:08.548 * +slave slave db0:6380 db0 6380 @ mymaster db1 6379\n[19069] 14 May 16:31:09.068 * +sentinel sentinel db0:26380 db0 26380 @ mymaster db1 6379\n[19069] 14 May 16:31:12.258 * +sentinel sentinel db1:26379 db1 26379 @ mymaster db1 6379\n```\n\nSentinel\u304cMaster\u306e\u30c0\u30a6\u30f3\u3092\u691c\u77e5\u3059\u308b\u3068\u72b6\u614b\u304cSDOWN\u306b\u3001quorum\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3057\u305f\u6570\u306eSDOWN\u304c\u63c3\u3046\u3068\u6b21\u306fODOWN\u3078\u3068\u9077\u79fb\u3001\u305d\u306e\u5f8c\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u65b0\u3057\u3044Master\u3068Slave\u3067\u6b63\u5e38\u7a3c\u50cd\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```py:redis-cli\nredis db1:6379> info replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:db0,6380,online\n```\n\n\u4ee5\u4e0a\u3001Sentinel\u306b\u3088\u308b\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u6a5f\u80fd\u306e\u52d5\u4f5c\u78ba\u8a8d\u307e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## Sentinel API\nSentinel\u306f\u3044\u304f\u3064\u304b\u306eAPI\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u7c21\u5358\u306b\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```py:redis-cli\n## SENTINEL masters\n# \u76e3\u8996\u5bfe\u8c61\u306eMaster\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel masters\n1)  1) \"name\"\n    2) \"mymaster\"\n    3) \"ip\"\n    4) \"127.0.0.1\"\n    5) \"port\"\n    6) \"6379\"\n    7) \"runid\"\n    8) \"b3b31e6c6d1fbb0cec5d179fd666ce00ea103746\"\n    9) \"flags\"\n   10) \"master\"\n   11) \"pending-commands\"\n   12) \"0\"\n   13) \"last-ok-ping-reply\"\n   14) \"568\"\n   15) \"last-ping-reply\"\n   16) \"568\"\n   17) \"info-refresh\"\n   18) \"9745\"\n   19) \"num-slaves\"\n   20) \"1\"\n   21) \"num-other-sentinels\"\n   22) \"1\"\n   23) \"quorum\"\n   24) \"2\"\n\n## SENTINEL slaves <master name>\n# Slave\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel slaves mymaster\n1)  1) \"name\"\n    2) \"127.0.0.1:6380\"\n    3) \"ip\"\n    4) \"127.0.0.1\"\n    5) \"port\"\n    6) \"6380\"\n    7) \"runid\"\n    8) \"17c0f7e7e4d2af0f5f6140ea0ceb0d82d0010aed\"\n    9) \"flags\"\n   10) \"s_down,slave,disconnected\"\n   11) \"pending-commands\"\n   12) \"0\"\n   13) \"last-ok-ping-reply\"\n   14) \"709377\"\n   15) \"last-ping-reply\"\n   16) \"709377\"\n   17) \"s-down-time\"\n   18) \"704333\"\n   19) \"info-refresh\"\n   20) \"712808\"\n   21) \"master-link-down-time\"\n   22) \"0\"\n   23) \"master-link-status\"\n   24) \"ok\"\n   25) \"master-host\"\n   26) \"127.0.0.1\"\n   27) \"master-port\"\n   28) \"6379\"\n   29) \"slave-priority\"\n   30) \"100\"\n\n## SENTINEL is-master-down-by-addr <ip> <port>\n# Master\u306e\u6b7b\u6d3b\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel is-master-down-by-addr 127.0.0.1 6379\n1) (integer) 0  ## 0:UP, 1:DOWN\n2) \"397dec99760d5d30043941fe4c1c35ba99e99ebf\"  ## Sentinel(subjective leader)\u306erun_id\n\n## SENTINEL get-master-addr-by-name <master name>\n# Master\u306eIP, Port\u3092\u78ba\u8a8d\nredis 127.0.0.1:26379> sentinel get-master-addr-by-name mymaster\n1) \"127.0.0.1\"\n2) \"6379\"\n\n## SENTINEL reset\n# Sentinel\u306e\u73fe\u5728\u306e\u72b6\u614b\u3092\u30ea\u30bb\u30c3\u30c8(\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u4e2d\u3067\u3042\u3063\u3066\u3082)\nredis 127.0.0.1:26379> sentinel reset mymaster\n(integer) 1\n```\n\nSentinel\u95a2\u9023\u306e\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u4f5c\u308b\u969b\u306b\u306f\u3053\u306eSentinel API\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3068\u697d\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u3001\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u51e6\u7406\u306e\u6319\u52d5\u306b\u95a2\u3059\u308b\u90e8\u5206\u3092\u30d4\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n## \u6607\u683c\u3055\u305b\u308bSlave\u306e\u9078\u629e\n\u5f53\u7136\u3067\u3059\u304cSlave\u3068\u3057\u3066\u6b63\u5e38\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u5bfe\u8c61\u3068\u306a\u308a\u307e\u3059\u3002\u7d30\u304b\u3044\u6761\u4ef6\u3092\u7701\u3044\u3066\u3056\u3063\u304f\u308a\u8a00\u3046\u3068\u3001Master\u3068\u306e\u63a5\u7d9a\u304c\u5b89\u5b9a\u3057\u3066\u3044\u3066(\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u304c\u5c11\u306a\u3044)\u3001Sentinel\u304b\u3089\u306ePING/INFO\u30b3\u30de\u30f3\u30c9\u306b\u76f4\u8fd15000ms\u4ee5\u5185\u306b\u5fdc\u7b54\u3057\u3066\u3044\u308bSlave\u304c\u5bfe\u8c61\u306b\u306a\u308a\u307e\u3059(\u8a73\u7d30\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068 src/sentinel.c \u3092\u53c2\u7167)\u3002\n\n\u5bfe\u8c61\u3068\u306a\u308bSlave\u304c\u8907\u6570\u3042\u308b\u5834\u5408\u306f **slave_priority** \u306e\u5024\u304c\u5c0f\u3055\u3044Slave\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n```py:redis-cli\nredis db0:6380> info replication\n# Replication\nrole:slave\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:0\nmaster_sync_in_progress:0\nslave_priority:100  ## <- \u3053\u306e\u5024\nslave_read_only:1\nconnected_slaves:0\n```\n\n\u540c\u3058 slave_priority \u306eSlave\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f **run_id** \u304c\u5c0f\u3055\u3044Slave\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n```py:redis-cli\nredis db0:6380> info\n# Server\nredis_version:2.6.10\nredis_git_sha1:00000000\nredis_git_dirty:0\nredis_mode:standalone\nos:Linux 2.6.18-194.26.1.el5 x86_64\narch_bits:64\nmultiplexing_api:epoll\ngcc_version:4.1.2\nprocess_id:17468\nrun_id:17c0f7e7e4d2af0f5f6140ea0ceb0d82d0010aed  ## <- \u3053\u306e\u5024\ntcp_port:6380\nuptime_in_seconds:1738\nuptime_in_days:0\nlru_clock:538965\n```\n\n2013/06\u73fe\u5728\u306f slave_priority \u306e\u5909\u66f4\u3092\u884c\u3046API\u306f\u516c\u958b\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u5358\u306b run_id \u304c\u82e5\u3044Slave\u304c\u9078\u629e\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002Slave\u9078\u629e\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u4eca\u5f8c\u5909\u66f4\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308b\u3067\u3057\u3087\u3046\u3002\n\n## Sentinels/Slaves\u306e\u81ea\u52d5\u691c\u51fa\nSentinel\u306e\u8a2d\u5b9a\u306bSlave\u306e\u30ea\u30b9\u30c8\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u306a\u3044\u306e\u306f\u3001Sentinel\u304cPub/Sub\u306b\u3088\u308b\u60c5\u5831\u5171\u6709\u3092\u884c\u3063\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\u9014\u4e2d\u3067\u5225\u306eSentinel\u3084Slave\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u8ffd\u52a0\u3057\u3066\u3082\u4ed6\u306eSentinel\u306b\u305d\u306e\u60c5\u5831\u306f\u4f1d\u308f\u308a\u307e\u3059\u3002\n\n```py:redis-cli\n## Sentinel\u306f \"__sentinel__:hello\" \u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u308b\nredis db0:6379> subscribe __sentinel__:hello\nReading messages... (press Ctrl-C to quit)\n1) \"subscribe\"\n2) \"__sentinel__:hello\"\n3) (integer) 1\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26380:77887a367e1c76ee9dc15f67a2fb3dc49bb00bf4:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26379:3a92da7269b69fa1dcce5915068c4af6e8caf161:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26380:77887a367e1c76ee9dc15f67a2fb3dc49bb00bf4:1\"\n1) \"message\"\n2) \"__sentinel__:hello\"\n3) \"127.0.0.1:26379:3a92da7269b69fa1dcce5915068c4af6e8caf161:1\"\n```\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5185\u5bb9\u306f **host:port:run_id:can-failover** \u3068\u306a\u3063\u3066\u3044\u3066\u3001\\_\\_sentinel\\_\\_:hello \u30c1\u30e3\u30f3\u30cd\u30eb\u306b5\u79d2\u6bce\u306bpublish\u3001\u5168\u3066\u306eSentinel\u306f\u3053\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u3092subscribe\u3057\u3066\u60c5\u5831\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u6ce8\u610f\u70b9\nRedis\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fMySQL\u306a\u3069\u306eRDBMS\u306e\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u306f\u7570\u306a\u308b\u90e8\u5206\u304c\u591a\u3044\u3067\u3059\u3002Redis\u306f\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306b\u5168\u3066\u306e\u30c7\u30fc\u30bf\u3092\u30c7\u30a3\u30b9\u30af\u306b\u66f8\u304d\u51fa\u3057\u3066\u304b\u3089Slave\u306b\u8ee2\u9001\u3059\u308b\u306e\u3067I/O\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u306b\u306f\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057\u3001Redis v2.8\u3067\u306fPSYNC(Partial Resynchronization)\u304c\u5b9f\u88c5\u3055\u308c\u308b\u3068\u306e\u3053\u3068\u306a\u306e\u3067\u3053\u306e\u554f\u984c\u306f\u89e3\u6d88\u3055\u308c\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n\u5f15\u304d\u7d9a\u304dSentinel\u306e\u691c\u8a3c\u3092\u7d9a\u3051\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002", "tags": ["Redis2.6.10"]}