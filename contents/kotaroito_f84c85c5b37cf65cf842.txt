{"tags": ["Ruby", "rbenv", "itamae"], "context": " More than 1 year has passed since last update.itamae\u3067\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306brbenv\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u4f8b\u304c\u30a6\u30a7\u30d6\u306b\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u30b5\u30ed\u30f3\u5f53\u65e5\u4e88\u7d04\u30a2\u30d7\u30eaPopcorn \u3067\u63a1\u7528\u3057\u305f\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u74b0\u5883\u306f Ubuntu 14.04 \u3067\u3059\u304c\u3001\u3069\u306e OS \u3067\u3082\u5927\u4e08\u592b\u306a\u306f\u305a\u3067\u3059\uff08\u305f\u3076\u3093\uff09\u3002\n\n\u5b8c\u6210\u3057\u305f\u30ec\u30b7\u30d4\n# cookbooks/ruby/default.rb\n\ninclude_recipe './attributes/default.rb'\n\nrbenv_dir          = node['rbenv']['root_dir']\nrbenv_versions     = node['rbenv']['versions']\nrbenv_version      = node['rbenv']['version']\nrbenv_owner        = node['rbenv']['owner']\nrbenv_group        = node['rbenv']['group']\nsudo               = \"sudo -u #{rbenv_owner} -i\"\n\ngit rbenv_dir do\n  repository 'git://github.com/sstephenson/rbenv.git'\nend\n\ndirectory \"#{rbenv_dir}/plugins\" do\n  not_if \"test -d #{rbenv_dir}/plugins\"\nend\n\ngit \"#{rbenv_dir}/plugins/ruby-build\" do\n  repository \"git://github.com/sstephenson/ruby-build.git\"\nend\n\nexecute \"chown #{rbenv_dir}\" do\n  command \"chown -R #{rbenv_owner}:#{rbenv_group} #{rbenv_dir}\"\nend\n\nrbenv_versions.each do |version|\n  execute \"rbenv install #{version}\" do\n    command \"#{sudo} rbenv install #{version}\"\n    not_if  \"#{sudo} rbenv versions | grep #{version}\"\n  end\nend\n\nexecute \"rbenv local #{rbenv_version}\" do\n  command \"#{sudo} rbenv local #{rbenv_version}\"\nend\n\nexecute \"rbenv global #{rbenv_version}\" do\n  command \"#{sudo} rbenv global #{rbenv_version}\"\nend\n\nexecute \"gem install bundler\" do\n  command \"#{sudo} gem install bundler\"\n  not_if  \"#{sudo} gem list | grep bundler\"\nend\n\n\u5de5\u592b\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3092\u3044\u304f\u3064\u304b\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nnode attributes\nnode.reverse_merge! \u3092\u4f7f\u3063\u3066\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nnode.reverse_merge!(\n  rbenv: {\n    root_dir: '/home/kotaroito/.rbenv',\n    owner: 'kotaroito',\n    group: 'kotaroito',\n    versions: %w(2.1.4),\n    version: '2.1.4'\n  }\n)\n\n\u8a73\u3057\u304f\u306f\u3001itamae\u4f5c\u8005\u306e\u8352\u4e95\u3055\u3093\u304c http://gihyo.jp/admin/serial/01/itamae/0003 \u306b\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u307e\u3059\u3002\n\nsudo\nsudo = \"sudo -u #{rbenv_owner} -i\"\n\nsudo \u3067 -u \u3068 -i \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n-i, --login\n\n Run the shell specified by the target user's password database entry as a login shell. This means that login-specific resource files such as .profile or .login will be read by the shell.  If a command is specified, it is passed to the shell for execution via the shell's -c option.....\n\n-u user, --user=user\n\n  Run the command as a user other than the default target user (usually root )....\n\n\u3053\u308c\u3089\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u3001~/.bash_profile \u3092\u8aad\u307f\u8fbc\u3093\u3067\u304f\u308c\u308b\u306e\u3067\u3001rbenv install \u3084 gem install bundler \u3092 node attributes \u3067\u6307\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u4ee5\u4e0a\u3067\u3059\u3002\n\n\nitamae\u3067\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306brbenv\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u4e8b\u4f8b\u304c\u30a6\u30a7\u30d6\u306b\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001[\u30b5\u30ed\u30f3\u5f53\u65e5\u4e88\u7d04\u30a2\u30d7\u30eaPopcorn](https://popcorn.coubic.com) \u3067\u63a1\u7528\u3057\u305f\u65b9\u6cd5\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\n\u306a\u304a\u3001\u74b0\u5883\u306f Ubuntu 14.04 \u3067\u3059\u304c\u3001\u3069\u306e OS \u3067\u3082\u5927\u4e08\u592b\u306a\u306f\u305a\u3067\u3059\uff08\u305f\u3076\u3093\uff09\u3002\n\n\n## \u5b8c\u6210\u3057\u305f\u30ec\u30b7\u30d4\n\n```ruby\n# cookbooks/ruby/default.rb\n\ninclude_recipe './attributes/default.rb'\n\nrbenv_dir          = node['rbenv']['root_dir']\nrbenv_versions     = node['rbenv']['versions']\nrbenv_version      = node['rbenv']['version']\nrbenv_owner        = node['rbenv']['owner']\nrbenv_group        = node['rbenv']['group']\nsudo               = \"sudo -u #{rbenv_owner} -i\"\n\ngit rbenv_dir do\n  repository 'git://github.com/sstephenson/rbenv.git'\nend\n\ndirectory \"#{rbenv_dir}/plugins\" do\n  not_if \"test -d #{rbenv_dir}/plugins\"\nend\n\ngit \"#{rbenv_dir}/plugins/ruby-build\" do\n  repository \"git://github.com/sstephenson/ruby-build.git\"\nend\n\nexecute \"chown #{rbenv_dir}\" do\n  command \"chown -R #{rbenv_owner}:#{rbenv_group} #{rbenv_dir}\"\nend\n\nrbenv_versions.each do |version|\n  execute \"rbenv install #{version}\" do\n    command \"#{sudo} rbenv install #{version}\"\n    not_if  \"#{sudo} rbenv versions | grep #{version}\"\n  end\nend\n\nexecute \"rbenv local #{rbenv_version}\" do\n  command \"#{sudo} rbenv local #{rbenv_version}\"\nend\n\nexecute \"rbenv global #{rbenv_version}\" do\n  command \"#{sudo} rbenv global #{rbenv_version}\"\nend\n\nexecute \"gem install bundler\" do\n  command \"#{sudo} gem install bundler\"\n  not_if  \"#{sudo} gem list | grep bundler\"\nend\n```\n\n\u5de5\u592b\u3057\u305f\u30dd\u30a4\u30f3\u30c8\u3092\u3044\u304f\u3064\u304b\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n### node attributes\n\nnode.reverse_merge! \u3092\u4f7f\u3063\u3066\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```ruby\nnode.reverse_merge!(\n  rbenv: {\n    root_dir: '/home/kotaroito/.rbenv',\n    owner: 'kotaroito',\n    group: 'kotaroito',\n    versions: %w(2.1.4),\n    version: '2.1.4'\n  }\n)\n```\n\n\u8a73\u3057\u304f\u306f\u3001itamae\u4f5c\u8005\u306e\u8352\u4e95\u3055\u3093\u304c http://gihyo.jp/admin/serial/01/itamae/0003 \u306b\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n### sudo\n\n\n```ruby\nsudo = \"sudo -u #{rbenv_owner} -i\"\n```\n\nsudo \u3067 -u \u3068 -i \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n-i, --login\n\n Run the shell specified by the target user's password database entry as a login shell. This means that login-specific resource files such as .profile or .login will be read by the shell.  If a command is specified, it is passed to the shell for execution via the shell's -c option.....\n```\n\n```\n-u user, --user=user\n\n  Run the command as a user other than the default target user (usually root )....\n```\n\n\u3053\u308c\u3089\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3088\u3063\u3066\u3001~/.bash_profile \u3092\u8aad\u307f\u8fbc\u3093\u3067\u304f\u308c\u308b\u306e\u3067\u3001rbenv install \u3084 gem install bundler \u3092 node attributes \u3067\u6307\u5b9a\u3057\u305f\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n"}