{"context": "\n\n\u306f\u3058\u3081\u306b\n\u30a2\u30e9\u30fc\u30c8\u898b\u9003\u3057\u9632\u6b62\u306e\u305f\u3081\u306bZabbix\u306e\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u5165\u529b\u3055\u308c\u308b\u307e\u3067\u518d\u901a\u77e5\u3059\u308b\u4ed5\u7d44\u307f\uff08\u53c2\u8003\uff1aZabbix\u3068Slack\u3067ChatOps\u306e\u30b9\u30b9\u30e1\uff09\u3092\u5c0e\u5165\u3057\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u6bce\u56de\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066Zabbix\u306eWebGUI\u3078\u30a2\u30af\u30bb\u30b9\u3057\u30b3\u30e1\u30f3\u30c8\u5165\u529b\u64cd\u4f5c\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001\u7169\u308f\u3057\u3055\u3092\u611f\u3058\u3066\u3044\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u4eca\u56de\u306f\u65e5\u672c\u3067\u767a\u58f2\u3055\u308c\u305f\u3070\u304b\u308a\u306eAmazon Dash Button\u3092\u4f7f\u3063\u3066\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3060\u3051\u3067\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306e\u53d7\u8afe\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u307e\u305fAmazon Dash Button\u3060\u3051\u3067\u306f\u6b63\u5e38\u306b\u53d7\u8afe\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3067\u304d\u305a\u3001\u4f55\u3089\u304b\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304c\u306a\u3044\u3068\u4e0d\u5b89\u306b\u611f\u3058\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc\u306e\u5c0f\u578bLED\u8b66\u544a\u706f\u300cCrystal Signal Pi\u300d\u3092\u4f7f\u3063\u3066\u3001\u53d7\u8afe\u304c\u6b63\u5e38\u306b\u884c\u3048\u305f\u3053\u3068\u3092\u901a\u77e5\u3057\u307e\u3059\u3002\n\n\u4f5c\u3063\u305f\u3082\u306e\n\n\u203b\uff11\u56de\u76ee\u306e\u300cDush Button\u300d\u62bc\u4e0b\u6642\u306b\u300c\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u300d\u304c\u5168\u3066\u53d7\u8afe\u3055\u308c\u3001\uff12\u56de\u76ee\u306f\u53d7\u8afe\u3059\u3079\u304d\u30a4\u30d9\u30f3\u30c8\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u69cb\u6210\n\u4e0b\u56f3\u306e\u3088\u3046\u306bAmazon Dash Button\u3092\u62bc\u4e0b\u3059\u308b\u3068\u51fa\u529b\u3055\u308c\u308bARP\u30d7\u30ed\u30fc\u30d6\u30d1\u30b1\u30c3\u30c8\u3092Raspberry Pi\u3067\u53d7\u4fe1\u3057\u3001\u305d\u308c\u3092\u30c8\u30ea\u30ac\u30fc\u306bZabbix\u3078API\u9023\u643a\u3057\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n\nAmazon Dash Button\n\nRaspberry Pi 3 Model B\n\nOS: RASPBIAN JESSIE WITH PIXEL\n\nVersion:\u3000November 2016\nRelease date:\u30002016-11-25\nKernel version:\u30004.4\n\n\nnode.js v7.2.1\n\n\ndash-button\nzabbix-promise\n\n\n\n\nZabbix 3.0.6\n\nCrystal Signal Pi\n\nCrystal Signal Pi\u306f\u5c0f\u578b\u30b3\u30f3\u30d4\u30e5\u30fc\u30bfRaspberry Pi\u306bLED\u8b66\u544a\u706f\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\u8a73\u3057\u304f\u306f\u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc\u5c0f\u578bLED\u8b66\u544a\u706f\u300cCrystal Signal PI\u300d\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u300d\u306b\u7e8f\u3081\u3066\u3044\u307e\u3059\u3002\n\n\n\n\n\u30b3\u30fc\u30c9\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306fgithub\u306b\u3042\u308b\u306e\u3067\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\nhttps://github.com/usiusi360/zabbix-dash-eventAcknowledge\nzabbix-dash-eventAcknowledge/\n\u251c\u2500\u2500 conf.js   // \u8a2d\u5b9a\u60c5\u5831\n\u251c\u2500\u2500 index.js  // \u30e1\u30a4\u30f3\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n\nZabbix\u306eWebUI\u304b\u3089\u300c\u969c\u5bb3\u5bfe\u5fdc\u30b3\u30e1\u30f3\u30c8\u306e\u4e00\u62ec\u51e6\u7406\u300d\u3092\u3059\u308b\u5834\u5408\u3001\u300c\u76e3\u8996\u30c7\u30fc\u30bf\u21e8\u30c8\u30ea\u30ac\u30fc\u300d\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u3057\u304b\u3057API\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u5165\u529b\u3059\u308b\u969b\u3001\u76f4\u63a5\u30c8\u30ea\u30ac\u30fc\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u4ee5\u4e0b\u306e\u2460\u2461\u2462\u306e\u30b9\u30c6\u30c3\u30d7\u3092\u8e0f\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u2460 \u30b9\u30c6\u30fc\u30bf\u30b9=\u969c\u5bb3\u3001\u30b3\u30e1\u30f3\u30c8\u672a\u5165\u529b\u306e\u30c8\u30ea\u30ac\u30fc\u3092\u62bd\u51fa\n\n\u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/trigger/get\n\n\n    .then(function() {\n      return zabbix.request('trigger.get', {\n        \"output\": \"triggerid\",\n        \"active\": true,                        //Return only enabled triggers that belong to monitored hosts.\n        \"monitored\": true,                     //Return only enabled triggers that belong to monitored hosts and contain only enabled items.\n        \"withLastEventUnacknowledged\": true,   //Return only triggers that have unacknowledged events.\n        \"maintenance\": false,                  //If set to true return only enabled triggers that belong to hosts in maintenance.\n        \"skipDependent\": true                  //Skip triggers in a problem state that are dependent on other triggers. Note that the other triggers are ignored if disabled, have disabled items or disabled item hosts.\n      });\n    })\n\n\n\u2461\u62bd\u51fa\u3057\u305f\u30c8\u30ea\u30ac\u30fc\u3092\u914d\u5217\u5316\u3057\u3001\u30c8\u30ea\u30ac\u30fc\u306b\u7d10\u3065\u304f\u30a4\u30d9\u30f3\u30c8\u3092\u62bd\u51fa\n\n\u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/event/object\n\n\n    .then(function(value) {\n      let trigger_array = [];\n      value.forEach(function(val, j) {\n        trigger_array.push(val.triggerid);\n      });\n\n      return zabbix.request('event.get', {\n        \"output\": \"eventid\",\n        \"acknowledged\": 0, //Whether the event has been acknowledged.\n        \"object\": 0,       //Possible values for trigger events: 0 - trigger\n        \"source\": 0,       //Type of the event. Possible values: 0 - event created by a trigger\n        \"value\": 1,        //State of the related object. Possible values for trigger events: 1 - problem\n        \"objectids\": trigger_array\n      });\n    })\n\n\n\u2462\u62bd\u51fa\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u914d\u5217\u5316\u3057\u3001\u8a72\u5f53\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3059\u308b\n\n\u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/event/acknowledge\n\n\n    .then(function(value) {\n      let event_array = [];\n      value.forEach(function(val, j) {\n        event_array.push(val.eventid);\n      });\n\n      return zabbix.request('event.acknowledge', {\n        \"message\": \"Accepted by Dash button\",\n        \"eventids\": event_array\n      });\n    })\n\n\u4e0a\u8a18\u306e\u2460\u2461\u2462\u306f\u3001Zabbix\u306eWebUI\u4e0a\u3067\u300c\u9078\u629e\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u3068\u3059\u3079\u3066\u306e\u30b3\u30e1\u30f3\u30c8\u672a\u5165\u529b\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u300d\u3092\u9078\u629e\u3057\u305f\u3053\u3068\u3068\u540c\u7b49\u306b\u306a\u308a\u307e\u3059\n\n\n\u5b9f\u884c\n\nrasbian\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bnode.js\u306f\u53e4\u3044\u305f\u3081\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u3042\u308b\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -\n$ sudo apt-get install -y nodejs\n\n\n\ndash-button\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u3001libpcap-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n$ sudo apt-get install libpcap-dev\n\n\n\u4eca\u56de\u4f5c\u3063\u305f\u30b3\u30fc\u30c9\u3092\u300cgit clone\u300d\u3057\u3001\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n$ git clone https://github.com/usiusi360/zabbix-dash-eventAcknowledge.git\n$ cd zabbix-dash-eventAcknowledge\n$ npm install\n\n\nDash Button\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\n\u300cAmazon Dash Button\u3092\u305f\u3060\u306eIoT\u30dc\u30bf\u30f3\u3068\u3057\u3066\u4f7f\u3046\u300d\u306e\u300c\u30dc\u30bf\u30f3\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u300d\u306e\u9805\u76ee\u3092\u53c2\u8003\u306b\u3057\u3001\u767b\u9332\u3092\u884c\u3044\u307e\u3057\u305f\u3002\nDash button\u306eMAC\u30a2\u30c9\u30ec\u30b9\u3092\u8abf\u3079\u307e\u3059\n\n$ sudo npm run scan\n\n> zabbix-dash-accept@0.1.0 scan /home/pi/zabbix-dash-eventAcknowledge\n> dash-button scan\nScanning for DHCP requests and ARP probes on wlan0...\n\n//\u4e0a\u8a18\u306e\u3068\u304a\u308ascan\u3092\u59cb\u3081\u305f\u3089\u3001 Dash button\u306e\u30dc\u30bf\u30f3\u3092\u3092\u62bc\u3057\u307e\u3059\u3002\n//\u305d\u3046\u3059\u308b\u3068Dash button\u304b\u3089\u306eARP probe\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u691c\u77e5\u3057\u3001mac\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u30e1\u30e2\u3057\u307e\u3059\u3002\n\nDetected a DHCP request or ARP probe from xx:xx:xx:xx:xx:xx\n\n\nconf.js\u5185\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\n\u5148\u307b\u3069\u8abf\u3079\u305fmac\u30a2\u30c9\u30ec\u30b9\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\nzabbix\u30b5\u30fc\u30d0\u306e\u60c5\u5831\u3082\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\n\n\nconf.js\n// amazon dash botton \u306emac\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\nexports.PHY_ADDR = \"XX:XX:XX:XX:XX:XX\";\n\n// zabbix\u306e\u8a2d\u5b9a\nexports.zabbix_url = \"http://localhost/zabbix/api_jsonrpc.php\";\nexports.zabbix_user = \"Admin\";\nexports.zabbix_password = \"password\";\n\n//crystal signal pi\u306e\u8a2d\u5b9a\nexports.cs_url = \"http://localhost\";\nexports.cs_color_ok = \"0,255,255\";\nexports.cs_color_err = \"255,0,127\";\nexports.cs_mode = \"1\";\nexports.cs_repeat = \"10\";\nexports.cs_period = \"500\";\n\n\n\nindex.js\u3092\u5b9f\u884c\u3057\u307e\u3059\n\n\n\uff11\u56de\u76ee\u306f\u6b63\u5e38\u306b\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u767b\u9332\u3067\u304d\u307e\u3057\u305f\u304c\u3001\uff12\u56de\u76ee\u306f\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3059\u3079\u304d\u5bfe\u8c61\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\n$ sudo node index.js\nlistening start\n\n=== !! accept !! ===\n\n{\"info\": \"\", \"ack\": 0, \"json\": 1, \"repeat\": 5, \"mode\": 1, \"remote_addr\": \"127.0.0.1\", \"color\": [0, 255, 255], \"remote_host\": 0, \"period\": 500}\n\n\n=== !! exception !! ===\nno triggers that are not accepted\n\n{\"info\": \"\", \"ack\": 0, \"json\": 1, \"repeat\": 5, \"mode\": 1, \"remote_addr\": \"127.0.0.1\", \"color\": [255, 0, 127], \"remote_host\": 0, \"period\": 500}\n\n\n\n\u3055\u3044\u3054\u306b\n\u53c2\u8003URL\u5148\u3067\u3082\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001Amazon Dash Button\u306f\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304b\u3089\u306e\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u3042\u308b\u306e\u3067\u4f7f\u3044\u3069\u3053\u308d\u3092\u8003\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u7528\u9014\u3067\u3042\u308c\u3070\u8a31\u5bb9\u7bc4\u56f2\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\nAmazon Dash Button\u3092\u305f\u3060\u306eIoT\u30dc\u30bf\u30f3\u3068\u3057\u3066\u4f7f\u3046\nAmazon Dash Button\u3092(\u6b63\u3057\u304f\u306a\u3044\u65b9\u5411\u3067)\u4f7f\u3063\u3066\u307f\u305f \n# \u306f\u3058\u3081\u306b\n\u30a2\u30e9\u30fc\u30c8\u898b\u9003\u3057\u9632\u6b62\u306e\u305f\u3081\u306b**Zabbix\u306e\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u304c\u5165\u529b\u3055\u308c\u308b\u307e\u3067\u518d\u901a\u77e5**\u3059\u308b\u4ed5\u7d44\u307f\uff08\u53c2\u8003\uff1a[Zabbix\u3068Slack\u3067ChatOps\u306e\u30b9\u30b9\u30e1](http://qiita.com/usiusi360/items/7ce5cdec5940589f28af)\uff09\u3092\u5c0e\u5165\u3057\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u6bce\u56de\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066Zabbix\u306eWebGUI\u3078\u30a2\u30af\u30bb\u30b9\u3057\u30b3\u30e1\u30f3\u30c8\u5165\u529b\u64cd\u4f5c\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u305a\u3001**\u7169\u308f\u3057\u3055\u3092\u611f\u3058\u3066\u3044\u307e\u3057\u305f**\u3002\n\n\u305d\u3053\u3067\u4eca\u56de\u306f\u65e5\u672c\u3067\u767a\u58f2\u3055\u308c\u305f\u3070\u304b\u308a\u306e**Amazon Dash Button**\u3092\u4f7f\u3063\u3066\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3060\u3051\u3067**\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306e\u53d7\u8afe**\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\u307e\u305fAmazon Dash Button\u3060\u3051\u3067\u306f\u6b63\u5e38\u306b\u53d7\u8afe\u3067\u304d\u305f\u304b\u78ba\u8a8d\u3067\u304d\u305a\u3001\u4f55\u3089\u304b\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304c\u306a\u3044\u3068\u4e0d\u5b89\u306b\u611f\u3058\u307e\u3059\u3002\u305d\u306e\u305f\u3081**\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc\u306e\u5c0f\u578bLED\u8b66\u544a\u706f\u300cCrystal Signal Pi\u300d**\u3092\u4f7f\u3063\u3066\u3001\u53d7\u8afe\u304c\u6b63\u5e38\u306b\u884c\u3048\u305f\u3053\u3068\u3092\u901a\u77e5\u3057\u307e\u3059\u3002\n\n# \u4f5c\u3063\u305f\u3082\u306e\n\n<blockquote class=\"twitter-tweet\" data-lang=\"ja\"><p lang=\"ja\" dir=\"ltr\">Amazon Dash Button\u304b\u3089Zabbix\u306e\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u8afe\u3057\u3066\u307f\u305f<a href=\"https://t.co/iPo6aCrN0Q\">https://t.co/iPo6aCrN0Q</a></p>&mdash; usiusi360 (@usiusi360) <a href=\"https://twitter.com/usiusi360/status/810473965848293376\">2016\u5e7412\u670818\u65e5</a></blockquote> <script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n\u203b\uff11\u56de\u76ee\u306e\u300cDush Button\u300d\u62bc\u4e0b\u6642\u306b\u300c\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u300d\u304c\u5168\u3066\u53d7\u8afe\u3055\u308c\u3001\uff12\u56de\u76ee\u306f\u53d7\u8afe\u3059\u3079\u304d\u30a4\u30d9\u30f3\u30c8\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n# \u69cb\u6210\n\n\u4e0b\u56f3\u306e\u3088\u3046\u306bAmazon Dash Button\u3092\u62bc\u4e0b\u3059\u308b\u3068\u51fa\u529b\u3055\u308c\u308bARP\u30d7\u30ed\u30fc\u30d6\u30d1\u30b1\u30c3\u30c8\u3092Raspberry Pi\u3067\u53d7\u4fe1\u3057\u3001\u305d\u308c\u3092\u30c8\u30ea\u30ac\u30fc\u306bZabbix\u3078API\u9023\u643a\u3057\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/54952/22a0bc4f-8f8f-25c3-0c4b-2be7036b025f.png)\n\n- Amazon Dash Button\n- Raspberry Pi 3 Model B\n    - OS: [RASPBIAN JESSIE WITH PIXEL](https://www.raspberrypi.org/downloads/raspbian/)\n        - Version:\u3000November 2016\n        - Release date:\u30002016-11-25\n        - Kernel version:\u30004.4\n    - node.js v7.2.1\n        - [dash-button](https://www.npmjs.com/package/dash-button)\n        - [zabbix-promise](https://www.npmjs.com/package/zabbix-promise)\n\n- Zabbix 3.0.6\n- Crystal Signal Pi\n    - Crystal Signal Pi\u306f\u5c0f\u578b\u30b3\u30f3\u30d4\u30e5\u30fc\u30bfRaspberry Pi\u306bLED\u8b66\u544a\u706f\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u62e1\u5f35\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n    - \u8a73\u3057\u304f\u306f\u300c[\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc\u5c0f\u578bLED\u8b66\u544a\u706f\u300cCrystal Signal PI\u300d\u3092\u52d5\u304b\u3057\u3066\u307f\u305f](http://qiita.com/usiusi360/items/ab6498cb05d2a91927c4)\u300d\u306b\u7e8f\u3081\u3066\u3044\u307e\u3059\u3002\n\n\n\n# \u30b3\u30fc\u30c9\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306fgithub\u306b\u3042\u308b\u306e\u3067\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\nhttps://github.com/usiusi360/zabbix-dash-eventAcknowledge\n\n```\nzabbix-dash-eventAcknowledge/\n\u251c\u2500\u2500 conf.js   // \u8a2d\u5b9a\u60c5\u5831\n\u251c\u2500\u2500 index.js  // \u30e1\u30a4\u30f3\n\u251c\u2500\u2500 LICENSE\n\u251c\u2500\u2500 package.json\n\u2514\u2500\u2500 README.md\n```\n\n<div class='alert alert-warning'>Zabbix\u306eWebUI\u304b\u3089<b>\u300c\u969c\u5bb3\u5bfe\u5fdc\u30b3\u30e1\u30f3\u30c8\u306e\u4e00\u62ec\u51e6\u7406\u300d</b>\u3092\u3059\u308b\u5834\u5408\u3001<b>\u300c\u76e3\u8996\u30c7\u30fc\u30bf\u21e8\u30c8\u30ea\u30ac\u30fc\u300d</b>\u304b\u3089\u884c\u3044\u307e\u3059\u3002\u3057\u304b\u3057<b>API</b>\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u5165\u529b\u3059\u308b\u969b\u3001\u76f4\u63a5\u30c8\u30ea\u30ac\u30fc\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u4ee5\u4e0b\u306e\u2460\u2461\u2462\u306e\u30b9\u30c6\u30c3\u30d7\u3092\u8e0f\u3080\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</div>\n\n<img width=\"40%\" alt=\"image\" src=\"https://qiita-image-store.s3.amazonaws.com/0/54952/b6ced8e1-2df0-3a19-c81c-19fd9189d3e8.png\">\n\n\n#### \u2460 \u30b9\u30c6\u30fc\u30bf\u30b9=\u969c\u5bb3\u3001\u30b3\u30e1\u30f3\u30c8\u672a\u5165\u529b\u306e\u30c8\u30ea\u30ac\u30fc\u3092\u62bd\u51fa\n- \u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/trigger/get\n\n```js\n    .then(function() {\n      return zabbix.request('trigger.get', {\n        \"output\": \"triggerid\",\n        \"active\": true,                        //Return only enabled triggers that belong to monitored hosts.\n        \"monitored\": true,                     //Return only enabled triggers that belong to monitored hosts and contain only enabled items.\n        \"withLastEventUnacknowledged\": true,   //Return only triggers that have unacknowledged events.\n        \"maintenance\": false,                  //If set to true return only enabled triggers that belong to hosts in maintenance.\n        \"skipDependent\": true                  //Skip triggers in a problem state that are dependent on other triggers. Note that the other triggers are ignored if disabled, have disabled items or disabled item hosts.\n      });\n    })\n```\n\n#### \u2461\u62bd\u51fa\u3057\u305f\u30c8\u30ea\u30ac\u30fc\u3092\u914d\u5217\u5316\u3057\u3001\u30c8\u30ea\u30ac\u30fc\u306b\u7d10\u3065\u304f\u30a4\u30d9\u30f3\u30c8\u3092\u62bd\u51fa\n- \u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/event/object\n\n```js\n    .then(function(value) {\n      let trigger_array = [];\n      value.forEach(function(val, j) {\n        trigger_array.push(val.triggerid);\n      });\n\n      return zabbix.request('event.get', {\n        \"output\": \"eventid\",\n        \"acknowledged\": 0, //Whether the event has been acknowledged.\n        \"object\": 0,       //Possible values for trigger events: 0 - trigger\n        \"source\": 0,       //Type of the event. Possible values: 0 - event created by a trigger\n        \"value\": 1,        //State of the related object. Possible values for trigger events: 1 - problem\n        \"objectids\": trigger_array\n      });\n    })\n```\n\n#### \u2462\u62bd\u51fa\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u914d\u5217\u5316\u3057\u3001\u8a72\u5f53\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3059\u308b\n- \u53c2\u8003\uff1ahttps://www.zabbix.com/documentation/3.0/manual/api/reference/event/acknowledge\n\n```js\n    .then(function(value) {\n      let event_array = [];\n      value.forEach(function(val, j) {\n        event_array.push(val.eventid);\n      });\n\n      return zabbix.request('event.acknowledge', {\n        \"message\": \"Accepted by Dash button\",\n        \"eventids\": event_array\n      });\n    })\n```\n\n<div class='alert alert-success'>\u4e0a\u8a18\u306e\u2460\u2461\u2462\u306f\u3001Zabbix\u306eWebUI\u4e0a\u3067<b>\u300c\u9078\u629e\u3057\u305f\u30a4\u30d9\u30f3\u30c8\u3068\u3059\u3079\u3066\u306e\u30b3\u30e1\u30f3\u30c8\u672a\u5165\u529b\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u300d</b>\u3092\u9078\u629e\u3057\u305f\u3053\u3068\u3068\u540c\u7b49\u306b\u306a\u308a\u307e\u3059</div>\n<img width=\"60%\" alt=\"image\" src=\"https://qiita-image-store.s3.amazonaws.com/0/54952/56617593-1456-6ee1-85e3-c4dc4019c8da.png\">\n\n\n# \u5b9f\u884c\n- rasbian\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bnode.js\u306f\u53e4\u3044\u305f\u3081[\u516c\u5f0f\u30b5\u30a4\u30c8](https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)\u306b\u3042\u308b\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -sL https://deb.nodesource.com/setup_7.x | sudo -E bash -\n$ sudo apt-get install -y nodejs\n```\n\n- [dash-button](https://www.npmjs.com/package/dash-button)\u306b\u66f8\u3044\u3066\u3042\u308b\u3068\u304a\u308a\u3001libpcap-dev\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo apt-get install libpcap-dev\n```\n\n- \u4eca\u56de\u4f5c\u3063\u305f\u30b3\u30fc\u30c9\u3092\u300cgit clone\u300d\u3057\u3001\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```bash\n$ git clone https://github.com/usiusi360/zabbix-dash-eventAcknowledge.git\n$ cd zabbix-dash-eventAcknowledge\n$ npm install\n```\n\n- Dash Button\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\n\u300c[Amazon Dash Button\u3092\u305f\u3060\u306eIoT\u30dc\u30bf\u30f3\u3068\u3057\u3066\u4f7f\u3046](http://qiita.com/jsoizo/items/3b8bba4160f41aef20f4)\u300d\u306e\u300c\u30dc\u30bf\u30f3\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u300d\u306e\u9805\u76ee\u3092\u53c2\u8003\u306b\u3057\u3001\u767b\u9332\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n- Dash button\u306eMAC\u30a2\u30c9\u30ec\u30b9\u3092\u8abf\u3079\u307e\u3059\n\n```bash\n$ sudo npm run scan\n\n> zabbix-dash-accept@0.1.0 scan /home/pi/zabbix-dash-eventAcknowledge\n> dash-button scan\nScanning for DHCP requests and ARP probes on wlan0...\n\n//\u4e0a\u8a18\u306e\u3068\u304a\u308ascan\u3092\u59cb\u3081\u305f\u3089\u3001 Dash button\u306e\u30dc\u30bf\u30f3\u3092\u3092\u62bc\u3057\u307e\u3059\u3002\n//\u305d\u3046\u3059\u308b\u3068Dash button\u304b\u3089\u306eARP probe\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u691c\u77e5\u3057\u3001mac\u30a2\u30c9\u30ec\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u30e1\u30e2\u3057\u307e\u3059\u3002\n\nDetected a DHCP request or ARP probe from xx:xx:xx:xx:xx:xx\n```\n- conf.js\u5185\u306e\u8a2d\u5b9a\u5909\u66f4\n    - \u5148\u307b\u3069\u8abf\u3079\u305fmac\u30a2\u30c9\u30ec\u30b9\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n    - zabbix\u30b5\u30fc\u30d0\u306e\u60c5\u5831\u3082\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```js:conf.js\n// amazon dash botton \u306emac\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\nexports.PHY_ADDR = \"XX:XX:XX:XX:XX:XX\";\n\n// zabbix\u306e\u8a2d\u5b9a\nexports.zabbix_url = \"http://localhost/zabbix/api_jsonrpc.php\";\nexports.zabbix_user = \"Admin\";\nexports.zabbix_password = \"password\";\n\n//crystal signal pi\u306e\u8a2d\u5b9a\nexports.cs_url = \"http://localhost\";\nexports.cs_color_ok = \"0,255,255\";\nexports.cs_color_err = \"255,0,127\";\nexports.cs_mode = \"1\";\nexports.cs_repeat = \"10\";\nexports.cs_period = \"500\";\n```\n\n- index.js\u3092\u5b9f\u884c\u3057\u307e\u3059\n    - \uff11\u56de\u76ee\u306f\u6b63\u5e38\u306b\u969c\u5bb3\u30a4\u30d9\u30f3\u30c8\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u767b\u9332\u3067\u304d\u307e\u3057\u305f\u304c\u3001\uff12\u56de\u76ee\u306f\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3059\u3079\u304d\u5bfe\u8c61\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ sudo node index.js\nlistening start\n\n=== !! accept !! ===\n\n{\"info\": \"\", \"ack\": 0, \"json\": 1, \"repeat\": 5, \"mode\": 1, \"remote_addr\": \"127.0.0.1\", \"color\": [0, 255, 255], \"remote_host\": 0, \"period\": 500}\n\n\n=== !! exception !! ===\nno triggers that are not accepted\n\n{\"info\": \"\", \"ack\": 0, \"json\": 1, \"repeat\": 5, \"mode\": 1, \"remote_addr\": \"127.0.0.1\", \"color\": [255, 0, 127], \"remote_host\": 0, \"period\": 500}\n\n```\n\n# \u3055\u3044\u3054\u306b\n\u53c2\u8003URL\u5148\u3067\u3082\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001Amazon Dash Button\u306f\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304b\u3089\u306e\u30bf\u30a4\u30e0\u30e9\u30b0\u304c\u3042\u308b\u306e\u3067\u4f7f\u3044\u3069\u3053\u308d\u3092\u8003\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u7528\u9014\u3067\u3042\u308c\u3070\u8a31\u5bb9\u7bc4\u56f2\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\n\n## \u53c2\u8003\n[Amazon Dash Button\u3092\u305f\u3060\u306eIoT\u30dc\u30bf\u30f3\u3068\u3057\u3066\u4f7f\u3046](http://qiita.com/jsoizo/items/3b8bba4160f41aef20f4)\n[Amazon Dash Button\u3092(\u6b63\u3057\u304f\u306a\u3044\u65b9\u5411\u3067)\u4f7f\u3063\u3066\u307f\u305f](http://qiita.com/takustaqu/items/8539b33780c9675c8657) \n", "tags": ["zabbix", "AmazonDashButton", "RaspberryPi", "Linux", "Node.js"]}