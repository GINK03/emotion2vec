{"context": "Node-RED\u4e0a\u3067Cloudant\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u7528\u306e\u30ce\u30fc\u30c9\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001http request\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3001Cloudant\u306eREST API \u306b\u5bfe\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u304b\u305f\u3061\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nCloudant\u306eAttachments\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30fc\u3067\u4fdd\u5b58\u3059\u308b\u65b9\u6cd5\u3068\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306einline\u8981\u7d20\u3068\u3057\u3066BASE64\u3067\u4fdd\u5b58\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30fc\u3067\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u65e2\u5b58\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002REST API\u306e\u30d1\u30b9\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u300cid\u300d\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u300crev\u300d\u3092\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nTo create a new attachment on an existing document, or to update an attachment on a document, make a PUT request with the document\u2019s latest _rev to https://$USERNAME.cloudant.com/$DATABASE/$DOCUMENT_ID/$ATTACHMENT. The attachment\u2019s content type must be specified using the Content-Type header. The $ATTACHMENT value is the name by which the attachment is associated with the document.\n\n\nhttps://docs.cloudant.com/attachments.html\n\n\uff08\u30b5\u30f3\u30d7\u30eb\uff09Node-RED\u30d5\u30ed\u30fc\nput\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30ed\u30fc\u3001put\u3067\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30ed\u30fc\u306e\uff12\u3064\u306b\u5206\u3051\u3066\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\u3000PUT /api/user\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3000PUT /api/user/:_id/attachment\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\n\u65e2\u5b58\u306e\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u30c7\u30fc\u30bf\u4fdd\u7ba1\u3002\n\n\n\u30d5\u30ed\u30fc\u306eJSON\n\n\u300cinsert user\u300d\u30ce\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u81ea\u5206\u306e\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u4f7f\u7528\u3002\n\n[{\"id\":\"13019c96.565263\",\"type\":\"http in\",\"z\":\"7e517ea1.72905\",\"name\":\"\",\"url\":\"/api/user\",\"method\":\"put\",\"swaggerDoc\":\"\",\"x\":120,\"y\":129.33332061767578,\"wires\":[[\"7cecee77.70c7a\",\"4161ba4.3316b44\"]]},{\"id\":\"7cecee77.70c7a\",\"type\":\"cloudant out\",\"z\":\"7e517ea1.72905\",\"name\":\"insert user\",\"cloudant\":\"\",\"database\":\"user\",\"service\":\"\",\"payonly\":true,\"operation\":\"insert\",\"x\":313,\"y\":129.33330535888672,\"wires\":[]},{\"id\":\"4161ba4.3316b44\",\"type\":\"http response\",\"z\":\"7e517ea1.72905\",\"name\":\"\",\"x\":296,\"y\":164.99999237060547,\"wires\":[]},{\"id\":\"e0c84058.ac275\",\"type\":\"comment\",\"z\":\"7e517ea1.72905\",\"name\":\"\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\",\"info\":\"\",\"x\":128,\"y\":79.99999237060547,\"wires\":[]}]\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\uff09\nPOSTMAN\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\u3002\n\nCloudant\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u78ba\u8a8d\u3002\n\n\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u307e\u3059\u3001Node-RED\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30d1\u30b9\u306e{_id}\u3092\u30ad\u30fc\u306b\u3057\u3066\u3001user\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u691c\u7d22\u3057\u3001\u300c_rev\u300d\u3092\u5165\u624b\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u300c_rev\u300d\u3082\u542b\u3081\u3066\u3001\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u7528\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u4f5c\u3063\u3066\u3001Coudant\u306eREST API\u3092\u5b9f\u884c\u3002\n\n\n\u30d5\u30ed\u30fc\u306eJSON\n\n\u300csearch user\u300d\u30ce\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u81ea\u5206\u306e\u3082\u306e\u3092\u4f7f\u7528\u3002\n\u300cCloudant\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6e96\u5099\u300d\u30ce\u30fc\u30c9\u306e\u300curl\u300d\u306f\u3001Cloudant\u306eVCAP_SERVICES\u3092\u30b3\u30d4\u30da\n\u300cPUT Attachment To user\u300d\u30ce\u30fc\u30c9\u3067\u3001\u300cUse basic authentication\u300d\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002Username, Password\u306f\u3001Cloudant\u306eVCAP_SERVICES\u3092\u30b3\u30d4\u30da\n\n[{\"id\":\"c3f8eebe.36d51\",\"type\":\"http request\",\"z\":\"92620c6b.387a5\",\"name\":\"PUT Attachment To user\",\"method\":\"PUT\",\"ret\":\"obj\",\"url\":\"\",\"tls\":\"\",\"x\":804.8331909179688,\"y\":393.6666564941406,\"wires\":[[\"30a4dbe9.dc77a4\",\"2a578f04.885aa\"]]},{\"id\":\"30a4dbe9.dc77a4\",\"type\":\"http response\",\"z\":\"92620c6b.387a5\",\"name\":\"\",\"x\":993.8333129882812,\"y\":393.3333435058594,\"wires\":[]},{\"id\":\"de0dece1.8432a\",\"type\":\"cloudant in\",\"z\":\"92620c6b.387a5\",\"name\":\"search user\",\"cloudant\":\"\",\"database\":\"user\",\"service\":\"nodered-test-shimac-3848-cloudantNoSQLDB\",\"search\":\"_id_\",\"design\":\"\",\"index\":\"\",\"x\":700.8333129882812,\"y\":286.6667175292969,\"wires\":[[\"4425dd96.3af944\",\"d35e5262.63a4a\"]]},{\"id\":\"dee89630.5435e8\",\"type\":\"http in\",\"z\":\"92620c6b.387a5\",\"name\":\"\",\"url\":\"/api/user/:_id/attachment\",\"method\":\"put\",\"swaggerDoc\":\"\",\"x\":242.83334350585938,\"y\":286.33338928222656,\"wires\":[[\"83b780f8.65ca5\",\"4ee12752.6f8f98\"]]},{\"id\":\"83b780f8.65ca5\",\"type\":\"function\",\"z\":\"92620c6b.387a5\",\"name\":\"\u30d1\u30b9\u304b\u3089_id \u53d6\u5f97\",\"func\":\"msg.payload._id = msg.req.params._id;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":514.8333740234375,\"y\":286.6667175292969,\"wires\":[[\"de0dece1.8432a\"]]},{\"id\":\"2a578f04.885aa\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"ent put attachment\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":1032.8333129882812,\"y\":339.00006103515625,\"wires\":[]},{\"id\":\"4ee12752.6f8f98\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"start put attachment\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":534.8333740234375,\"y\":248.0000762939453,\"wires\":[]},{\"id\":\"be9657ea.a90998\",\"type\":\"comment\",\"z\":\"92620c6b.387a5\",\"name\":\"\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\",\"info\":\"\",\"x\":199,\"y\":239.33338165283203,\"wires\":[]},{\"id\":\"4425dd96.3af944\",\"type\":\"function\",\"z\":\"92620c6b.387a5\",\"name\":\"Cloudant\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6e96\u5099\",\"func\":\"// Cloudant\u691c\u7d22\u7d50\u679c\u304b\u3089_id\u3001_rev\u3092\u30bb\u30c3\u30c8\\nvar _id = msg.payload._id;\\nvar _rev = msg.payload._rev;\\n\\n// VCAP_SERVICE\u306eCloudant\u306eurl\\nvar url = \\\"\u81ea\u5206\u306eurl\\\";\\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\\nvar db_name = \\\"user\\\";\\n// \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u540d\\nvar file_name = _id + \\\".jpeg\\\";\\n\\n// \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u7528\u306eCloudant\u306eRESTAPI\u306e\u30d1\u30b9\\nmsg.url = url + \\\"/\\\" + db_name + \\\"/\\\" + _id + \\\"/\\\" + file_name + \\\"?rev=\\\" + _rev;\\nmsg.headers = {\\n    \\\"Content-Type\\\": \\\"image/jpeg\\\"\\n};\\n// \u30da\u30a4\u30ed\u30fc\u30c9\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30bb\u30c3\u30c8\\nmsg.payload = msg.req.body;\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":547.9999084472656,\"y\":394.3334045410156,\"wires\":[[\"c3f8eebe.36d51\"]]},{\"id\":\"d35e5262.63a4a\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"search user\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":846.9999694824219,\"y\":243.33338165283203,\"wires\":[]}]\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\uff08\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\uff09\nPOSTMAN\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\u3002\n\n\nNode-RED\u306e\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\n\n\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\nCloudant\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u307f\u308b\u3068\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u300c_attachment\u300d\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u300cView Attachments\u300d\u3067\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u307f\u308b\u3068\u3001\n\n\u7121\u4e8b\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n\n\u304a\u308f\u308a\n\u6b21\u56de\u306f\u3001Node-RED\u4e0a\u3067\u3001\u3053\u306e\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3057\u3066\u3001Watson\u306eVisual Recognition\u306b\u6295\u3052\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nNode-RED\u4e0a\u3067Cloudant\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u7528\u306e\u30ce\u30fc\u30c9\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001http request\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3001Cloudant\u306eREST API \u306b\u5bfe\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u304b\u305f\u3061\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n# Cloudant\u306eAttachments\n\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30fc\u3067\u4fdd\u5b58\u3059\u308b\u65b9\u6cd5\u3068\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306einline\u8981\u7d20\u3068\u3057\u3066BASE64\u3067\u4fdd\u5b58\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001\u30d0\u30a4\u30ca\u30ea\u30fc\u3067\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u65e2\u5b58\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002REST API\u306e\u30d1\u30b9\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u300c_id\u300d\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u300c_rev\u300d\u3092\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n>To create a new attachment on an existing document, or to update an attachment on a document, make a PUT request with the document\u2019s latest _rev to https://$USERNAME.cloudant.com/$DATABASE/$DOCUMENT_ID/$ATTACHMENT. The attachment\u2019s content type must be specified using the Content-Type header. The $ATTACHMENT value is the name by which the attachment is associated with the document.\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/68545f96-ef69-56ea-f4b8-539f1443da7e.png)\n\nhttps://docs.cloudant.com/attachments.html\n\n# \uff08\u30b5\u30f3\u30d7\u30eb\uff09Node-RED\u30d5\u30ed\u30fc\n\nput\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30ed\u30fc\u3001put\u3067\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30ed\u30fc\u306e\uff12\u3064\u306b\u5206\u3051\u3066\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n+ \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\u3000PUT /api/user\n+ \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3000PUT /api/user/:_id/attachment\n\n\n## \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\n\u65e2\u5b58\u306e\u30ce\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u30c7\u30fc\u30bf\u4fdd\u7ba1\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/011c26a5-70c2-1ae2-856b-f2a270a6d040.png)\n\n### \u30d5\u30ed\u30fc\u306eJSON\n+ \u300cinsert user\u300d\u30ce\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u81ea\u5206\u306e\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u4f7f\u7528\u3002\n\n```json\n[{\"id\":\"13019c96.565263\",\"type\":\"http in\",\"z\":\"7e517ea1.72905\",\"name\":\"\",\"url\":\"/api/user\",\"method\":\"put\",\"swaggerDoc\":\"\",\"x\":120,\"y\":129.33332061767578,\"wires\":[[\"7cecee77.70c7a\",\"4161ba4.3316b44\"]]},{\"id\":\"7cecee77.70c7a\",\"type\":\"cloudant out\",\"z\":\"7e517ea1.72905\",\"name\":\"insert user\",\"cloudant\":\"\",\"database\":\"user\",\"service\":\"\",\"payonly\":true,\"operation\":\"insert\",\"x\":313,\"y\":129.33330535888672,\"wires\":[]},{\"id\":\"4161ba4.3316b44\",\"type\":\"http response\",\"z\":\"7e517ea1.72905\",\"name\":\"\",\"x\":296,\"y\":164.99999237060547,\"wires\":[]},{\"id\":\"e0c84058.ac275\",\"type\":\"comment\",\"z\":\"7e517ea1.72905\",\"name\":\"\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\",\"info\":\"\",\"x\":128,\"y\":79.99999237060547,\"wires\":[]}]\n```\n\n### \u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4f5c\u6210\uff09\nPOSTMAN\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/f9fd98ec-a4c7-4674-2ecd-c5b8e1b1ea3a.png)\n\nCloudant\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u78ba\u8a8d\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/2d95270e-bf1a-5140-3900-38b46869a84b.png)\n\n\n## \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n\u307e\u3059\u3001Node-RED\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30d1\u30b9\u306e{_id}\u3092\u30ad\u30fc\u306b\u3057\u3066\u3001user\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u691c\u7d22\u3057\u3001\u300c_rev\u300d\u3092\u5165\u624b\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u300c_rev\u300d\u3082\u542b\u3081\u3066\u3001\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u7528\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u4f5c\u3063\u3066\u3001Coudant\u306eREST API\u3092\u5b9f\u884c\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/2017ff6f-9a8a-523c-e08b-8740c974171e.png)\n\n### \u30d5\u30ed\u30fc\u306eJSON\n+ \u300csearch user\u300d\u30ce\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u81ea\u5206\u306e\u3082\u306e\u3092\u4f7f\u7528\u3002\n+ \u300cCloudant\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6e96\u5099\u300d\u30ce\u30fc\u30c9\u306e\u300curl\u300d\u306f\u3001Cloudant\u306eVCAP_SERVICES\u3092\u30b3\u30d4\u30da\n+ \u300cPUT Attachment To user\u300d\u30ce\u30fc\u30c9\u3067\u3001\u300cUse basic authentication\u300d\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002Username, Password\u306f\u3001Cloudant\u306eVCAP_SERVICES\u3092\u30b3\u30d4\u30da\n\n```json\n[{\"id\":\"c3f8eebe.36d51\",\"type\":\"http request\",\"z\":\"92620c6b.387a5\",\"name\":\"PUT Attachment To user\",\"method\":\"PUT\",\"ret\":\"obj\",\"url\":\"\",\"tls\":\"\",\"x\":804.8331909179688,\"y\":393.6666564941406,\"wires\":[[\"30a4dbe9.dc77a4\",\"2a578f04.885aa\"]]},{\"id\":\"30a4dbe9.dc77a4\",\"type\":\"http response\",\"z\":\"92620c6b.387a5\",\"name\":\"\",\"x\":993.8333129882812,\"y\":393.3333435058594,\"wires\":[]},{\"id\":\"de0dece1.8432a\",\"type\":\"cloudant in\",\"z\":\"92620c6b.387a5\",\"name\":\"search user\",\"cloudant\":\"\",\"database\":\"user\",\"service\":\"nodered-test-shimac-3848-cloudantNoSQLDB\",\"search\":\"_id_\",\"design\":\"\",\"index\":\"\",\"x\":700.8333129882812,\"y\":286.6667175292969,\"wires\":[[\"4425dd96.3af944\",\"d35e5262.63a4a\"]]},{\"id\":\"dee89630.5435e8\",\"type\":\"http in\",\"z\":\"92620c6b.387a5\",\"name\":\"\",\"url\":\"/api/user/:_id/attachment\",\"method\":\"put\",\"swaggerDoc\":\"\",\"x\":242.83334350585938,\"y\":286.33338928222656,\"wires\":[[\"83b780f8.65ca5\",\"4ee12752.6f8f98\"]]},{\"id\":\"83b780f8.65ca5\",\"type\":\"function\",\"z\":\"92620c6b.387a5\",\"name\":\"\u30d1\u30b9\u304b\u3089_id \u53d6\u5f97\",\"func\":\"msg.payload._id = msg.req.params._id;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":514.8333740234375,\"y\":286.6667175292969,\"wires\":[[\"de0dece1.8432a\"]]},{\"id\":\"2a578f04.885aa\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"ent put attachment\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":1032.8333129882812,\"y\":339.00006103515625,\"wires\":[]},{\"id\":\"4ee12752.6f8f98\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"start put attachment\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":534.8333740234375,\"y\":248.0000762939453,\"wires\":[]},{\"id\":\"be9657ea.a90998\",\"type\":\"comment\",\"z\":\"92620c6b.387a5\",\"name\":\"\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\",\"info\":\"\",\"x\":199,\"y\":239.33338165283203,\"wires\":[]},{\"id\":\"4425dd96.3af944\",\"type\":\"function\",\"z\":\"92620c6b.387a5\",\"name\":\"Cloudant\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6e96\u5099\",\"func\":\"// Cloudant\u691c\u7d22\u7d50\u679c\u304b\u3089_id\u3001_rev\u3092\u30bb\u30c3\u30c8\\nvar _id = msg.payload._id;\\nvar _rev = msg.payload._rev;\\n\\n// VCAP_SERVICE\u306eCloudant\u306eurl\\nvar url = \\\"\u81ea\u5206\u306eurl\\\";\\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\\nvar db_name = \\\"user\\\";\\n// \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u540d\\nvar file_name = _id + \\\".jpeg\\\";\\n\\n// \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u7528\u306eCloudant\u306eRESTAPI\u306e\u30d1\u30b9\\nmsg.url = url + \\\"/\\\" + db_name + \\\"/\\\" + _id + \\\"/\\\" + file_name + \\\"?rev=\\\" + _rev;\\nmsg.headers = {\\n    \\\"Content-Type\\\": \\\"image/jpeg\\\"\\n};\\n// \u30da\u30a4\u30ed\u30fc\u30c9\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30bb\u30c3\u30c8\\nmsg.payload = msg.req.body;\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":547.9999084472656,\"y\":394.3334045410156,\"wires\":[[\"c3f8eebe.36d51\"]]},{\"id\":\"d35e5262.63a4a\",\"type\":\"debug\",\"z\":\"92620c6b.387a5\",\"name\":\"search user\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":846.9999694824219,\"y\":243.33338165283203,\"wires\":[]}]\n```\n\n### \u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\uff08\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\uff09\nPOSTMAN\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u5b9f\u884c\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/ddf960de-7967-c5ec-11c9-85aec4da4d81.png)\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/961cc193-14cd-4763-9872-6289020fedca.png)\n\nNode-RED\u306e\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/4561dd38-db44-89b7-a708-9f4f5c4a4ed1.png)\n\n### \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\nCloudant\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u307f\u308b\u3068\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u300c_attachment\u300d\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/9aba03cb-6487-2880-27a7-a3e7911cbc78.png)\n\n\u300cView Attachments\u300d\u3067\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u307f\u308b\u3068\u3001\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/451f4994-01c8-ea9f-8e27-d5664159760e.png)\n\n\u7121\u4e8b\u3001\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/100414/f830def1-9244-e8fe-d55b-90bae7aa2b42.png)\n\n# \u304a\u308f\u308a\n\u6b21\u56de\u306f\u3001Node-RED\u4e0a\u3067\u3001\u3053\u306e\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3057\u3066\u3001Watson\u306eVisual Recognition\u306b\u6295\u3052\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["Bluemix", "node-red", "Cloudant"]}