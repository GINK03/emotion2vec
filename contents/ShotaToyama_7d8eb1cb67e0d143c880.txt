{"tags": ["AWS", "awslogs", "CloudWatch"], "context": "\n\n\u306f\u3058\u3081\u306b\nawslogs\u306e\u30ed\u30b0\u8ee2\u9001\u3067\u6c17\u3065\u3044\u305f\u3089\u30ed\u30b0\u304c\u8ee2\u9001\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u304a\u308a\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u3057\u3066\u3082\u76f4\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u30b5\u30dd\u30fc\u30c8\u3078\u554f\u3044\u5408\u308f\u305b\u3057\u305f\u306e\u3067\u539f\u56e0\u3068\u89e3\u6c7a\u7b56\u3092\u8f09\u305b\u308b\n\n\u30a8\u30e9\u30fc\u30ed\u30b0\u5185\u5bb9\nOperationalError: database is locked\n\n\u539f\u56e0\nlogrotate(awslogs) \u3068 awslogs-nanny \u306e\u51e6\u7406\u304c\u885d\u7a81\u3059\u308b\u3068\u767a\u751f\u3059\u308b\n\n\u89e3\u6c7a\u65b9\u6cd5\n1.cron(awslogs)\u306e\u4e00\u6642\u505c\u6b62\n\u3000\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a/etc/cron.d/awslogs\n\u3000\u4e00\u6642\u7684\u306b\u9069\u5f53\u306a\u5834\u6240\u3078\u79fb\u52d5\u3059\u308b\u304b\u5b9f\u884c\u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u8abf\u6574\n2.logrotate\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a/etc/logrotate.d/awslogs\n\u203b\u4eca\u5f8c\u3082\u885d\u7a81\u3057\u306a\u3044\u3088\u3046\u306a\u5bfe\u7b56\u3002\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u304c\u8ee2\u9001\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u5834\u5408\u3001\u3053\u306e\u624b\u9806\u306f\u4e0d\u8981\n\n/var/log/awslogs.log {\n    missingok\n    notifempty\n    size 100M\n    create 0600 root root\n    delaycompress\n    compress\n    rotate 4\n    prerotate\n        if [ -f /etc/cron.d/awslogs ]; then\n            /bin/mv -f /etc/cron.d/awslogs /etc/cron.d_awslogs_bk\n        fi\n    endscript\n    postrotate\n        /bin/sleep 60\n        service awslogs condrestart\n        if [ -f /etc/cron.d_awslogs_bk ]; then\n            /bin/mv -f /etc/cron.d_awslogs_bk /etc/cron.d/awslogs\n        fi\n    endscript\n}\n\n3.awslogs\u306e\u505c\u6b62\u2192\u8d77\u52d5\n# service awslogs stop\n# service awslogs start\n\n\u203b\u30b5\u30fc\u30d3\u30b9\u505c\u6b62\u5f8c\u3001awslogs\u3067\u6b8b\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308c\u3070kill\n4.cron(awslogs)\u306e\u518d\u958b\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a/etc/cron.d/awslogs\n1\u3067\u884c\u3063\u305f\u4f5c\u696d\u3092\u5143\u306b\u623b\u3057\u305f\u3089\u5b8c\u4e86\u3002\n\n\u307e\u3068\u3081\nAWS\u5074\u3067\u306f\u6839\u672c\u7684\u306a\u5bfe\u7b56\u306b\u3064\u3044\u3066\u691c\u8a0e\u3092\u9032\u3081\u3066\u3044\u308b\u3068\u306e\u4e8b\u306a\u306e\u3067logrotate\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\u306f\u884c\u3063\u305f\u307b\u3046\u304c\u7121\u96e3\n# \u306f\u3058\u3081\u306b\nawslogs\u306e\u30ed\u30b0\u8ee2\u9001\u3067\u6c17\u3065\u3044\u305f\u3089\u30ed\u30b0\u304c\u8ee2\u9001\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u304a\u308a\u30b5\u30fc\u30d3\u30b9\u518d\u8d77\u52d5\u3057\u3066\u3082\u76f4\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u30b5\u30dd\u30fc\u30c8\u3078\u554f\u3044\u5408\u308f\u305b\u3057\u305f\u306e\u3067\u539f\u56e0\u3068\u89e3\u6c7a\u7b56\u3092\u8f09\u305b\u308b\n\n# \u30a8\u30e9\u30fc\u30ed\u30b0\u5185\u5bb9\n`OperationalError: database is locked`\n\n# \u539f\u56e0\nlogrotate(awslogs) \u3068 awslogs-nanny \u306e\u51e6\u7406\u304c\u885d\u7a81\u3059\u308b\u3068\u767a\u751f\u3059\u308b\n\n# \u89e3\u6c7a\u65b9\u6cd5\n1.cron(awslogs)\u306e\u4e00\u6642\u505c\u6b62\n\u3000\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a`/etc/cron.d/awslogs`\n\u3000\u4e00\u6642\u7684\u306b\u9069\u5f53\u306a\u5834\u6240\u3078\u79fb\u52d5\u3059\u308b\u304b\u5b9f\u884c\u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u8abf\u6574\n\n2.logrotate\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a`/etc/logrotate.d/awslogs`\n<font color=\"OrangeRed\">**\u203b\u4eca\u5f8c\u3082\u885d\u7a81\u3057\u306a\u3044\u3088\u3046\u306a\u5bfe\u7b56\u3002\u3068\u308a\u3042\u3048\u305a\u30ed\u30b0\u304c\u8ee2\u9001\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u5834\u5408\u3001\u3053\u306e\u624b\u9806\u306f\u4e0d\u8981**\n</font>\n\n```\n/var/log/awslogs.log {\n    missingok\n    notifempty\n    size 100M\n    create 0600 root root\n    delaycompress\n    compress\n    rotate 4\n    prerotate\n        if [ -f /etc/cron.d/awslogs ]; then\n            /bin/mv -f /etc/cron.d/awslogs /etc/cron.d_awslogs_bk\n        fi\n    endscript\n    postrotate\n        /bin/sleep 60\n        service awslogs condrestart\n        if [ -f /etc/cron.d_awslogs_bk ]; then\n            /bin/mv -f /etc/cron.d_awslogs_bk /etc/cron.d/awslogs\n        fi\n    endscript\n}\n```\n\n3.awslogs\u306e\u505c\u6b62\u2192\u8d77\u52d5\n\n```\n# service awslogs stop\n# service awslogs start\n```\n<font color=\"OrangeRed\">**\u203b\u30b5\u30fc\u30d3\u30b9\u505c\u6b62\u5f8c\u3001awslogs\u3067\u6b8b\u3063\u3066\u3044\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308c\u3070kill**</font>\n\n4.cron(awslogs)\u306e\u518d\u958b\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\uff1a`/etc/cron.d/awslogs`\n1\u3067\u884c\u3063\u305f\u4f5c\u696d\u3092\u5143\u306b\u623b\u3057\u305f\u3089\u5b8c\u4e86\u3002\n\n# \u307e\u3068\u3081\nAWS\u5074\u3067\u306f\u6839\u672c\u7684\u306a\u5bfe\u7b56\u306b\u3064\u3044\u3066\u691c\u8a0e\u3092\u9032\u3081\u3066\u3044\u308b\u3068\u306e\u4e8b\u306a\u306e\u3067logrotate\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\u306f\u884c\u3063\u305f\u307b\u3046\u304c\u7121\u96e3\n"}