{"context": " More than 1 year has passed since last update.\u30bf\u30a4\u30c8\u30eb\u306f\u91e3\u308a\u3067\u3059\u3002\u3059\u3044\u307e\u305b\u3093\u3002\n\u3068\u308a\u3042\u3048\u305aunicorn\u3092\u8a2d\u5b9a\u3057\u306a\u3051\u308c\u3070\u3068\u3044\u3046\u4eba\u5411\u3051\u3002\n\u4f55\u3082\u308f\u304b\u3089\u306a\u3044\u4eba\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308c\u3070\u3001Unicorn\u3092\u8d77\u52d5\u3067\u304d\u307e\u3059\u3002\n\nrails_root/config/unicron.rb\nrails_root = File.expand_path('../../', __FILE__)\n\nworker_processes 2\nworking_directory rails_root\ntimeout 10\n\nENV['BUNDLE_GEMFILE'] = rails_root + \"/Gemfile\"\n\nstderr_path File.expand_path('../../log/unicorn_stderr.log', __FILE__)\nstdout_path File.expand_path('../../log/unicorn_stdout.log', __FILE__)\n\nlisten File.expand_path('../../tmp/sockets/unicorn.sock', __FILE__)\npid File.expand_path('../../tmp/pids/unicorn.pid', __FILE__)\n\npreload_app true\n# GC.respond_to?(:copy_on_write_friendly=) and GC.copy_on_write_friendly = true\n\n# USR2\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u308b\u3068\u53e4\u3044\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b\u3002\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and\n      ActiveRecord::Base.connection.disconnect!\n\n  old_pid = \"#{server.config[:pid]}.oldbin\"\n  if old_pid != server.pid\n    begin\n      sig = (worker.nr + 1) >= server.worker_processes ? :QUIT : :TTOU\n      Process.kill(sig, File.read(old_pid).to_i)\n    rescue Errno::ENOENT, Errno::ESRCH\n    end\n  end\nend\n\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4ee5\u4e0b\u306e\u5024\u3092\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\nworker_processes 2\ntimeout 10\n\n\u8a73\u7d30\u3092\u77e5\u308a\u305f\u3044\u65b9\u306fUnicorn\u306e\u8a2d\u5b9a\u3092\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\u30bf\u30a4\u30c8\u30eb\u306f\u91e3\u308a\u3067\u3059\u3002\u3059\u3044\u307e\u305b\u3093\u3002\n\n\u3068\u308a\u3042\u3048\u305a`unicorn`\u3092\u8a2d\u5b9a\u3057\u306a\u3051\u308c\u3070\u3068\u3044\u3046\u4eba\u5411\u3051\u3002\n\n\u4f55\u3082\u308f\u304b\u3089\u306a\u3044\u4eba\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308c\u3070\u3001Unicorn\u3092\u8d77\u52d5\u3067\u304d\u307e\u3059\u3002\n\n```rb:rails_root/config/unicron.rb\nrails_root = File.expand_path('../../', __FILE__)\n\nworker_processes 2\nworking_directory rails_root\ntimeout 10\n\nENV['BUNDLE_GEMFILE'] = rails_root + \"/Gemfile\"\n\nstderr_path File.expand_path('../../log/unicorn_stderr.log', __FILE__)\nstdout_path File.expand_path('../../log/unicorn_stdout.log', __FILE__)\n\nlisten File.expand_path('../../tmp/sockets/unicorn.sock', __FILE__)\npid File.expand_path('../../tmp/pids/unicorn.pid', __FILE__)\n\npreload_app true\n# GC.respond_to?(:copy_on_write_friendly=) and GC.copy_on_write_friendly = true\n\n# USR2\u30b7\u30b0\u30ca\u30eb\u3092\u53d7\u3051\u308b\u3068\u53e4\u3044\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b\u3002\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and\n      ActiveRecord::Base.connection.disconnect!\n\n  old_pid = \"#{server.config[:pid]}.oldbin\"\n  if old_pid != server.pid\n    begin\n      sig = (worker.nr + 1) >= server.worker_processes ? :QUIT : :TTOU\n      Process.kill(sig, File.read(old_pid).to_i)\n    rescue Errno::ENOENT, Errno::ESRCH\n    end\n  end\nend\n\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n```\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4ee5\u4e0b\u306e\u5024\u3092\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```rb\nworker_processes 2\ntimeout 10\n```\n\n\u8a73\u7d30\u3092\u77e5\u308a\u305f\u3044\u65b9\u306f[Unicorn\u306e\u8a2d\u5b9a](http://qiita.com/syou007/items/555062cc96dd0b08a610)\u3092\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["Rails", "unicorn", "Ruby", "capistrano", "nginx"]}