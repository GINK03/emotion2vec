{"tags": ["OmniAuth", "RSpec"], "context": " More than 1 year has passed since last update.\n\nFeature \u30c6\u30b9\u30c8\nwiki \u306e\u901a\u308a\u3002\nIntegration Testing \u00b7 intridea/omniauth Wiki\n\nController \u30c6\u30b9\u30c8\nrequest.env[\"omniauth.auth\"] \u306b\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3084\u308b\u3002\n\u4f8b\ndescribe CustomDevise::OmniauthCallbacksController do\n\n  before do\n    stub_env_for_omniauth\n  end\n\n  describe \"GET #facebook\" do\n    context \"as a guest user\" do\n      before { get :facebook }\n      it { should redirect_to my_edit_user_registration_path }\n    end\n  end\n\n\n  def stub_env_for_omniauth(uid=\"1234567890\")\n    # devise \u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\n    @request.env[\"devise.mapping\"] = Devise.mappings[:user]\n\n    request.env[\"omniauth.auth\"] = OmniAuth::AuthHash.new({\n      \"provider\"=>\"facebook\",\n      \"uid\"=>uid,\n      ...\n    })\n  end\nend\n\n\n\nFeature \u30c6\u30b9\u30c8\n=====\n\nwiki \u306e\u901a\u308a\u3002\n\n[Integration Testing \u00b7 intridea/omniauth Wiki](https://github.com/intridea/omniauth/wiki/Integration-Testing)\n\n\nController \u30c6\u30b9\u30c8\n=====\n\n`request.env[\"omniauth.auth\"]` \u306b\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3084\u308b\u3002\n\n\u4f8b\n\n```rb\ndescribe CustomDevise::OmniauthCallbacksController do\n\n  before do\n    stub_env_for_omniauth\n  end\n\n  describe \"GET #facebook\" do\n    context \"as a guest user\" do\n      before { get :facebook }\n      it { should redirect_to my_edit_user_registration_path }\n    end\n  end\n\n\n  def stub_env_for_omniauth(uid=\"1234567890\")\n    # devise \u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\n    @request.env[\"devise.mapping\"] = Devise.mappings[:user]\n\n    request.env[\"omniauth.auth\"] = OmniAuth::AuthHash.new({\n      \"provider\"=>\"facebook\",\n      \"uid\"=>uid,\n      ...\n    })\n  end\nend\n\n\n```\n"}