{"tags": ["Ruby", "Rails", "Gem", "diff-lcs"], "context": "\n\n\u3084\u308a\u305f\u3044\u4e8b\n\u4e8c\u3064\u306e\u5165\u529b\u3092\u6bd4\u8f03\u3057\u3066\u3001\u30de\u30c3\u30c1\u3057\u3066\u3044\u306a\u3044\u90e8\u5206\u3092\u5f37\u8abf\u3057\u3066\u8868\u793a\u3055\u305b\u305f\u3044\u3002\n\u4f8b\u3048\u3070\u3001\u300cAbcDefGh\u300d\u3068\u300cabeffh\u300d\u3068\u3044\u3046\u5165\u529b\u304c\u3042\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a4\u30e1\u30fc\u30b8\u3067\u8868\u793a\u3055\u305b\u305f\u3044\u3002\n\n\u3053\u308c\u3067\u30d1\u30c3\u3068\u898b\u3067\u5dee\u5206\u304c\u308f\u304b\u308b\u3088\u3046\u306b\u3059\u308b\uff01\n\ndiff-lcs \u3067\u6587\u5b57\u5217\u3092\u6bd4\u8f03\u3059\u308b\n\u3069\u3046\u3084\u3063\u3066\u5dee\u5206\u3068\u308d\u3046\u304b\u306a\u3042\u3068\u8003\u3048\u3066\u3044\u305f\u3089\u3001diff-lcs \u3067\u7c21\u5358\u306b\u51fa\u6765\u305f\u3002\ngem 'diff-lcs'\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\nDiff::LCS.sdiff('AbcDefGh', 'abefffh')\n\n=> [[\"!\", [0, \"A\"], [0, \"a\"]],\n [\"=\", [1, \"b\"], [1, \"b\"]],\n [\"-\", [2, \"c\"], [2, nil]],\n [\"-\", [3, \"D\"], [2, nil]],\n [\"=\", [4, \"e\"], [2, \"e\"]],\n [\"=\", [5, \"f\"], [3, \"f\"]],\n [\"!\", [6, \"G\"], [4, \"f\"]],\n [\"+\", [7, nil], [5, \"f\"]],\n [\"=\", [7, \"h\"], [6, \"h\"]]]\n\n\u3093\u30fc\u4fbf\u5229\u3002\n\u305f\u3060\u306e\u591a\u6b21\u5143\u914d\u5217\u306b\u898b\u3048\u308b\u3051\u3069\u3001\u8981\u7d20\u4e00\u3064\u4e00\u3064\u304c Diff::LCS::ContextChange \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first\n#=> [\"!\", [0, \"A\"], [0, \"a\"]]\n\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.class\n#=> Diff::LCS::ContextChange\n\n\u6700\u521d\u306e ! \u306f Diff::LCS \u5185\u3067 action \u3068\u547c\u3070\u308c\u3066\u3044\u3066\u3001\u30a2\u30f3\u30de\u30c3\u30c1\u3092\u8868\u3057\u3066\u3044\u308b\u3002\u4ed6\u306b\u3082 = \u306f\u30de\u30c3\u30c1\u3001+ \u306f\u8ffd\u52a0\u3001- \u306f\u524a\u9664\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\u307e\u305f\u30010 \u306f Diff::LCS \u3067\u306f position\u3001A \u3068 a \u306f element \u3068\u547c\u3070\u308c\u3066\u3044\u3066\u3001\u6587\u5b57\u5217\u306e\u4f4d\u7f6e\u3068\u6587\u5b57\uff08\u5024\uff09\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\u3053\u308c\u3089\u306f\u3001\u30a2\u30af\u30bb\u30c3\u30b5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.action\n#=> \"!\"\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.old_position\n#=> 0\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.new_element\n#=> \"a\"\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u53d6\u308a\u51fa\u305b\u308b\u3002\n\u69cb\u6210\u306f [action, [old_position, old_element], [new_position, new_element]] \u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u5dee\u5206\u304c\u3042\u308b\u6587\u5b57\u3060\u3051\u53d6\u308a\u51fa\u3059\n\u4fbf\u5229\u306a\u4fbf\u5229\u306a Diff::LCS#sdiff \u306b\u306f\u3001\u30d6\u30ed\u30c3\u30af\u3082\u6e21\u305b\u308b\u307f\u305f\u3044\u3002\nDiff::LCS.sdiff('AbcDefGh', 'abefffh') {|context_change| context_change.old_element if context_change.action != '=' }\n#=> [\"A\", nil, \"c\", \"D\", nil, nil, \"G\", nil, nil]\n\n\u304a\u30fc\u53d6\u308a\u51fa\u305b\u305f\u3002\nDiff::LCS::Change#unchanged? \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\nDiff::LCS.sdiff('AbcDefGh', 'abefffh') {|context_change| context_change.old_element unless context_change.unchanged? }\n#=> [\"A\", nil, \"c\", \"D\", nil, nil, \"G\", nil, nil]\n\n\u3053\u308c\u3067 OK\n\nHTML \u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3055\u305b\u308b\n\u3082\u3046\u51fa\u6765\u305d\u3046\u306a\u96f0\u56f2\u6c17\u304c\u3057\u3066\u304d\u305f\u306e\u3067\u3001\u898b\u305f\u76ee\u304c\n\n\u3068\u306a\u308b\u3088\u3046\u306a HTML \u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3059\u308b Ruby \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\u3002\nrequire 'diff-lcs'\n\nstr1, str2 = *ARGV\n\ndef decorate_diff(str1, str2)\n  Diff::LCS.sdiff(str1, str2) {|context_change|\n    if context_change.unchanged?\n      context_change.old_element\n    elsif !context_change.old_element.nil?\n     \"<span>#{context_change.old_element}</span>\"\n    end\n  }.join('')\nend\n\nputs <<EOS\n<html>\n  <head>\n    <style type=\"text/css\">\n      span {\n        font-weight: bold;\n        color: crimson;\n      }\n    </style>\n  </head>\n  <body>\n    <ol>\n      <li>#{decorate_diff(str1, str2)}</li>\n      <li>#{decorate_diff(str2, str1)}</li>\n    <ol>\n  </body>\n</html>\nEOS\n\n\u3093\u30fc\u51fa\u6765\u305f\uff01\n\u305f\u3060\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3061\u3087\u3063\u3068\u5dee\u5206\u304c\u898b\u3065\u3089\u3044\u306e\u3067\u3001\u7247\u65b9\u306b\u3057\u304b\u306a\u3044\u6587\u5b57\u3092\u53d6\u308a\u6d88\u3057\u7dda\u3067\u6d88\u3059\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u3001\u3001\n...\ndef decorate_diff(str1, str2)\n  Diff::LCS.sdiff(str1, str2) {|context_change|\n    if context_change.unchanged?\n      context_change.old_element\n    elsif context_change.deleting?\n      \"<span class='delete'>#{context_change.old_element}</span>\"\n    elsif !context_change.adding?\n     \"<span>#{context_change.old_element}</span>\"\n    end\n  }.join('')\nend\n\n...\n    <style type=\"text/css\">\n      span.delete {\n        text-decoration: line-through;\n      }\n...\n\n\n\u51fa\u6765\u305f\uff01\uff01\n\u3082\u3046\u3061\u3087\u3063\u3068\u898b\u305f\u76ee\u306f\u5de5\u592b\u3057\u306a\u3044\u3068\u3060\u3051\u3069\u3001\u3001\u3001\u5f53\u521d\u306e\u76ee\u7684\u306f\u679c\u305f\u305b\u305f\uff01\uff01\n# \u3084\u308a\u305f\u3044\u4e8b\n\n\u4e8c\u3064\u306e\u5165\u529b\u3092\u6bd4\u8f03\u3057\u3066\u3001\u30de\u30c3\u30c1\u3057\u3066\u3044\u306a\u3044\u90e8\u5206\u3092\u5f37\u8abf\u3057\u3066\u8868\u793a\u3055\u305b\u305f\u3044\u3002\n\u4f8b\u3048\u3070\u3001\u300cAbcDefGh\u300d\u3068\u300cabeffh\u300d\u3068\u3044\u3046\u5165\u529b\u304c\u3042\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a4\u30e1\u30fc\u30b8\u3067\u8868\u793a\u3055\u305b\u305f\u3044\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/41416/ef465b0a-6cf9-729b-b09b-c3d50cdfe698.png)\n\n\u3053\u308c\u3067\u30d1\u30c3\u3068\u898b\u3067\u5dee\u5206\u304c\u308f\u304b\u308b\u3088\u3046\u306b\u3059\u308b\uff01\n\n# `diff-lcs` \u3067\u6587\u5b57\u5217\u3092\u6bd4\u8f03\u3059\u308b\n\n\u3069\u3046\u3084\u3063\u3066\u5dee\u5206\u3068\u308d\u3046\u304b\u306a\u3042\u3068\u8003\u3048\u3066\u3044\u305f\u3089\u3001[diff-lcs](https://github.com/halostatue/diff-lcs) \u3067\u7c21\u5358\u306b\u51fa\u6765\u305f\u3002\n\n```\ngem 'diff-lcs'\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n\n```rb\nDiff::LCS.sdiff('AbcDefGh', 'abefffh')\n\n=> [[\"!\", [0, \"A\"], [0, \"a\"]],\n [\"=\", [1, \"b\"], [1, \"b\"]],\n [\"-\", [2, \"c\"], [2, nil]],\n [\"-\", [3, \"D\"], [2, nil]],\n [\"=\", [4, \"e\"], [2, \"e\"]],\n [\"=\", [5, \"f\"], [3, \"f\"]],\n [\"!\", [6, \"G\"], [4, \"f\"]],\n [\"+\", [7, nil], [5, \"f\"]],\n [\"=\", [7, \"h\"], [6, \"h\"]]]\n```\n\n\u3093\u30fc\u4fbf\u5229\u3002\n\n\u305f\u3060\u306e\u591a\u6b21\u5143\u914d\u5217\u306b\u898b\u3048\u308b\u3051\u3069\u3001\u8981\u7d20\u4e00\u3064\u4e00\u3064\u304c `Diff::LCS::ContextChange` \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```rb\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first\n#=> [\"!\", [0, \"A\"], [0, \"a\"]]\n\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.class\n#=> Diff::LCS::ContextChange\n```\n\n\u6700\u521d\u306e `!` \u306f `Diff::LCS` \u5185\u3067 `action` \u3068\u547c\u3070\u308c\u3066\u3044\u3066\u3001\u30a2\u30f3\u30de\u30c3\u30c1\u3092\u8868\u3057\u3066\u3044\u308b\u3002\u4ed6\u306b\u3082 `=` \u306f\u30de\u30c3\u30c1\u3001`+` \u306f\u8ffd\u52a0\u3001`-` \u306f\u524a\u9664\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\u307e\u305f\u3001`0` \u306f `Diff::LCS` \u3067\u306f `position`\u3001`A` \u3068 `a` \u306f `element` \u3068\u547c\u3070\u308c\u3066\u3044\u3066\u3001\u6587\u5b57\u5217\u306e\u4f4d\u7f6e\u3068\u6587\u5b57\uff08\u5024\uff09\u3092\u8868\u3057\u3066\u3044\u308b\u3002\n\n\u3053\u308c\u3089\u306f\u3001\u30a2\u30af\u30bb\u30c3\u30b5\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001\n\n```rb\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.action\n#=> \"!\"\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.old_position\n#=> 0\nDiff::LCS.sdiff('AbcDefGh', 'abefffh').first.new_element\n#=> \"a\"\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u53d6\u308a\u51fa\u305b\u308b\u3002\n\u69cb\u6210\u306f `[action, [old_position, old_element], [new_position, new_element]]` \u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n# \u5dee\u5206\u304c\u3042\u308b\u6587\u5b57\u3060\u3051\u53d6\u308a\u51fa\u3059\n\n\u4fbf\u5229\u306a\u4fbf\u5229\u306a `Diff::LCS#sdiff` \u306b\u306f\u3001\u30d6\u30ed\u30c3\u30af\u3082\u6e21\u305b\u308b\u307f\u305f\u3044\u3002\n\n```rb\nDiff::LCS.sdiff('AbcDefGh', 'abefffh') {|context_change| context_change.old_element if context_change.action != '=' }\n#=> [\"A\", nil, \"c\", \"D\", nil, nil, \"G\", nil, nil]\n```\n\n\u304a\u30fc\u53d6\u308a\u51fa\u305b\u305f\u3002\n`Diff::LCS::Change#unchanged?` \u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\n\n```rb\nDiff::LCS.sdiff('AbcDefGh', 'abefffh') {|context_change| context_change.old_element unless context_change.unchanged? }\n#=> [\"A\", nil, \"c\", \"D\", nil, nil, \"G\", nil, nil]\n```\n\n\u3053\u308c\u3067 OK\n\n# HTML \u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3055\u305b\u308b\n\n\u3082\u3046\u51fa\u6765\u305d\u3046\u306a\u96f0\u56f2\u6c17\u304c\u3057\u3066\u304d\u305f\u306e\u3067\u3001\u898b\u305f\u76ee\u304c\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/41416/ef465b0a-6cf9-729b-b09b-c3d50cdfe698.png)\n\n\u3068\u306a\u308b\u3088\u3046\u306a HTML \u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3059\u308b Ruby \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\u3002\n\n```rb\nrequire 'diff-lcs'\n\nstr1, str2 = *ARGV\n\ndef decorate_diff(str1, str2)\n  Diff::LCS.sdiff(str1, str2) {|context_change|\n    if context_change.unchanged?\n      context_change.old_element\n    elsif !context_change.old_element.nil?\n     \"<span>#{context_change.old_element}</span>\"\n    end\n  }.join('')\nend\n\nputs <<EOS\n<html>\n  <head>\n    <style type=\"text/css\">\n      span {\n        font-weight: bold;\n        color: crimson;\n      }\n    </style>\n  </head>\n  <body>\n    <ol>\n      <li>#{decorate_diff(str1, str2)}</li>\n      <li>#{decorate_diff(str2, str1)}</li>\n    <ol>\n  </body>\n</html>\nEOS\n```\n\n\u3093\u30fc\u51fa\u6765\u305f\uff01\n\u305f\u3060\u3001\u3053\u308c\u3060\u3051\u3060\u3068\u3061\u3087\u3063\u3068\u5dee\u5206\u304c\u898b\u3065\u3089\u3044\u306e\u3067\u3001\u7247\u65b9\u306b\u3057\u304b\u306a\u3044\u6587\u5b57\u3092\u53d6\u308a\u6d88\u3057\u7dda\u3067\u6d88\u3059\u3088\u3046\u306b\u3059\u308b\u3068\u3001\u3001\u3001\n\n```rb\n...\ndef decorate_diff(str1, str2)\n  Diff::LCS.sdiff(str1, str2) {|context_change|\n    if context_change.unchanged?\n      context_change.old_element\n    elsif context_change.deleting?\n      \"<span class='delete'>#{context_change.old_element}</span>\"\n    elsif !context_change.adding?\n     \"<span>#{context_change.old_element}</span>\"\n    end\n  }.join('')\nend\n\n...\n    <style type=\"text/css\">\n      span.delete {\n        text-decoration: line-through;\n      }\n...\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/41416/4d8b4c53-82dd-1915-c3fa-7353d6e8916d.png)\n\n\u51fa\u6765\u305f\uff01\uff01\n\u3082\u3046\u3061\u3087\u3063\u3068\u898b\u305f\u76ee\u306f\u5de5\u592b\u3057\u306a\u3044\u3068\u3060\u3051\u3069\u3001\u3001\u3001\u5f53\u521d\u306e\u76ee\u7684\u306f\u679c\u305f\u305b\u305f\uff01\uff01\n"}