{"context": "\n\n\u306f\u3058\u3081\u306b\nDockerfile\u6652\u3059\nFROM gliderlabs/alpine:latest\n\nENV BUILD_PACKAGES bash wget curl tar make gcc alpine-sdk zlib zlib-dev readline \nENV GEM_PACKAGES openssl openssl-dev libxml2-dev libxslt-dev mysql mariadb-dev imagemagick imagemagick-dev imagemagick-c++ ruby-rmagick\n\nRUN apk update && \\\n    apk upgrade && \\\n    apk --no-cache add tzdata \\\n    $BUILD_PACKAGES $GEM_PACKAGES && \\\n  cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime && \\\n  apk del tzdata \n\n# build ruby\nRUN wget -q -O ruby-1.8.7-p374.tar.gz http://cache.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p374.tar.gz && \\\n    tar -zxvf ruby-1.8.7-p374.tar.gz && \\\n    rm ruby-1.8.7-p374.tar.gz\n\nWORKDIR ruby-1.8.7-p374\nRUN ./configure --with-openssl-dir=/usr/bin\nRUN make\nRUN make install\n\n# install rubygems\nWORKDIR /\nRUN wget http://production.cf.rubygems.org/rubygems/rubygems-1.3.7.tgz && \\\n    tar -zxvf rubygems-1.3.7.tgz && \\\n    rm rubygems-1.3.7.tgz\nWORKDIR rubygems-1.3.7\nRUN ruby setup.rb\n\n# install bundler\nRUN gem install bundler\n\nWORKDIR /app\nCOPY Gemfile /app/\n\n# bundle install\nRUN bundle install\nCOPY . /home/app\n\n\n\u4f55\u304c\u3057\u305f\u304b\u3063\u305f\u306e\u304b\n\u53e4\u306erails\u30a2\u30d7\u30ea\u306e\u958b\u767a\u306b\u95a2\u308f\u308b\u3053\u3068\u306b\u306a\u3063\u305f\u306e\u3067\u3001docker\u5316\u3067\u304d\u308b\u304b\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f \n(docker\u6b746\u30f6\u6708\u3001ruby/rails\u6b740\u30f6\u6708)\n\n\u74b0\u5883\n\nruby 1.8.7\ngem 1.3.7\nrails 2.3.5\n\n\n\u30dd\u30a4\u30f3\u30c8 aka \u306f\u307e\u308a\u30dd\u30a4\u30f3\u30c8\n\nruby\u3092\u30bd\u30fc\u30b9\u304b\u3089make\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u3060\u3063\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f$BUILD_PACKAGES\u306b\u307e\u3068\u3081\u305f\nruby\u3092./configure\u3059\u308b\u3068\u304d\u306b--with-openssl-dir\u30aa\u30d7\u30b7\u30e7\u30f3\u3067openssl\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001\"bundle install\"\u3059\u308b\u3068\u304d\u306b https://rubygems.org \u306a\u3069https\u30b5\u30a4\u30c8\u304b\u3089\u53d6\u5f97\u3067\u304d\u306a\u3044\n\u304b\u3068\u3044\u3063\u3066Gemfile\u306e\u307b\u3046\u3067https\u3092http\u306b\u3057\u3066\u3082install\u304c\u9032\u307e\u306a\u3044\u306e\u3067\u89e3\u6c7a\u306b\u306f\u306a\u3089\u306a\u3044\ngem\u5468\u308a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5fc5\u8981\u3060\u3063\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f$GEM_PACKAGES\u306b\u307e\u3068\u3081\u305f(\"mysql\"gem\u3060\u3063\u305f\u3089 mysql, mariadb-dev\u3068\u304b\u3001\"rmagick\"gem \u3060\u3063\u305f\u3089 imagemagick\u3068imagemagick-dev\u3068\u304b)\nrmagick 2.13.1\u306fimagemagick\u3068imagemagick-dev\u5165\u308c\u3066\u3082install\u5931\u6557\u3059\u308b\u306e\u30672.13.2\u306b\u4e0a\u3052\u305f\n\n\nTODO\n\n\u3053\u306e\u307e\u307e\u3060\u3068root\u5b9f\u884c\u306b\u306a\u308a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u3088\u308d\u3057\u304f\u306a\u3044\u306e\u3067adduser\u3057\u3066USER\u6307\u5b9a\u3057\u305f\u307b\u3046\u304c\u3088\u3044\n\u4eca\u306f\u7279\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3057\u304b\u4f7f\u3063\u3066\u3044\u306a\u3044\u304c\u3001\u4eca\u5f8c\u6bb5\u968e\u7684\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u308b\u3001\u7b49\u306e\u30b1\u30fc\u30b9\u3092\u60f3\u5b9a\u3059\u308b\u3068rvm\u3084\u3089rbenv\u306a\u3069\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u3063\u305f\u307b\u3046\u304c\u3088\u3044\u306e\u304b\u3082\n\u305d\u306e\u4ed6passenger\u3068\u304b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5468\u308a\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u672a\u5bfe\u5fdc\n\n\ndocker-compose\n\u3053\u3093\u306a\u611f\u3058\u3067docker-compose\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u3001\u3053\u308c\u307e\u3067VM\u3084\u958b\u767a\u7528\u306eDB\u30b5\u30fc\u30d0\u30fc\u306b\u4f9d\u5b58\u3057\u3066\u305f\u958b\u767a\u74b0\u5883\u304c\u5168\u90e8\u30ed\u30fc\u30ab\u30eb\u3067\u5b8c\u7d50\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\n\ndocker-compose.yml\nversion: '2'\nservices:\n    rails:\n        build:\n            context: /path/to/\n            dockerfile: DockerfileName\n        ports:\n            - \"3000:3000\"\n        depends_on:\n            - db \n        networks:\n            - app\n            - datastore\n    db:\n        image: mysql:5.6\n        ports:\n            - \"3306:3306\"\n        environment:\n            - TZ=JST-9\n            - MYSQL_USER=required\n            - MYSQL_PASSWORD=required\n            - MYSQL_ROOT_PASSWORD=required\n            - MYSQL_DATABASE=required\n        volumes:\n            - /path/to/mysql/dump/:/docker-entrypoint-initdb.d/\n            - /path/to/mysql/conf/:/etc/mysql/conf.d\n        privileged: true\n        networks:\n            - datastore\nnetworks:\n    app:\n    datastore:\n\n\n\u4fbf\u5229\n# \u306f\u3058\u3081\u306b\n\nDockerfile\u6652\u3059\n\n``` Dockerfile\nFROM gliderlabs/alpine:latest\n\nENV BUILD_PACKAGES bash wget curl tar make gcc alpine-sdk zlib zlib-dev readline \nENV GEM_PACKAGES openssl openssl-dev libxml2-dev libxslt-dev mysql mariadb-dev imagemagick imagemagick-dev imagemagick-c++ ruby-rmagick\n\nRUN apk update && \\\n    apk upgrade && \\\n    apk --no-cache add tzdata \\\n    $BUILD_PACKAGES $GEM_PACKAGES && \\\n  cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime && \\\n  apk del tzdata \n\n# build ruby\nRUN wget -q -O ruby-1.8.7-p374.tar.gz http://cache.ruby-lang.org/pub/ruby/1.8/ruby-1.8.7-p374.tar.gz && \\\n    tar -zxvf ruby-1.8.7-p374.tar.gz && \\\n    rm ruby-1.8.7-p374.tar.gz\n\nWORKDIR ruby-1.8.7-p374\nRUN ./configure --with-openssl-dir=/usr/bin\nRUN make\nRUN make install\n\n# install rubygems\nWORKDIR /\nRUN wget http://production.cf.rubygems.org/rubygems/rubygems-1.3.7.tgz && \\\n    tar -zxvf rubygems-1.3.7.tgz && \\\n    rm rubygems-1.3.7.tgz\nWORKDIR rubygems-1.3.7\nRUN ruby setup.rb\n\n# install bundler\nRUN gem install bundler\n\nWORKDIR /app\nCOPY Gemfile /app/\n\n# bundle install\nRUN bundle install\nCOPY . /home/app\n```\n\n# \u4f55\u304c\u3057\u305f\u304b\u3063\u305f\u306e\u304b\n\n\u53e4\u306erails\u30a2\u30d7\u30ea\u306e\u958b\u767a\u306b\u95a2\u308f\u308b\u3053\u3068\u306b\u306a\u3063\u305f\u306e\u3067\u3001docker\u5316\u3067\u304d\u308b\u304b\u8a66\u3057\u3066\u307f\u305f\u304b\u3063\u305f \n(docker\u6b746\u30f6\u6708\u3001ruby/rails\u6b740\u30f6\u6708)\n\n# \u74b0\u5883\n\n* ruby 1.8.7\n* gem 1.3.7\n* rails 2.3.5\n\n# \u30dd\u30a4\u30f3\u30c8 aka \u306f\u307e\u308a\u30dd\u30a4\u30f3\u30c8\n\n* ruby\u3092\u30bd\u30fc\u30b9\u304b\u3089make\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u3060\u3063\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f$BUILD_PACKAGES\u306b\u307e\u3068\u3081\u305f\n* ruby\u3092./configure\u3059\u308b\u3068\u304d\u306b--with-openssl-dir\u30aa\u30d7\u30b7\u30e7\u30f3\u3067openssl\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001\"bundle install\"\u3059\u308b\u3068\u304d\u306b https://rubygems.org \u306a\u3069https\u30b5\u30a4\u30c8\u304b\u3089\u53d6\u5f97\u3067\u304d\u306a\u3044\n* \u304b\u3068\u3044\u3063\u3066Gemfile\u306e\u307b\u3046\u3067https\u3092http\u306b\u3057\u3066\u3082install\u304c\u9032\u307e\u306a\u3044\u306e\u3067\u89e3\u6c7a\u306b\u306f\u306a\u3089\u306a\u3044\n* gem\u5468\u308a\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5fc5\u8981\u3060\u3063\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f$GEM_PACKAGES\u306b\u307e\u3068\u3081\u305f(\"mysql\"gem\u3060\u3063\u305f\u3089 mysql, mariadb-dev\u3068\u304b\u3001\"rmagick\"gem \u3060\u3063\u305f\u3089 imagemagick\u3068imagemagick-dev\u3068\u304b)\n* rmagick 2.13.1\u306fimagemagick\u3068imagemagick-dev\u5165\u308c\u3066\u3082install\u5931\u6557\u3059\u308b\u306e\u30672.13.2\u306b\u4e0a\u3052\u305f\n\n# TODO\n\n* \u3053\u306e\u307e\u307e\u3060\u3068root\u5b9f\u884c\u306b\u306a\u308a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u3088\u308d\u3057\u304f\u306a\u3044\u306e\u3067adduser\u3057\u3066USER\u6307\u5b9a\u3057\u305f\u307b\u3046\u304c\u3088\u3044\n* \u4eca\u306f\u7279\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3057\u304b\u4f7f\u3063\u3066\u3044\u306a\u3044\u304c\u3001\u4eca\u5f8c\u6bb5\u968e\u7684\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u308b\u3001\u7b49\u306e\u30b1\u30fc\u30b9\u3092\u60f3\u5b9a\u3059\u308b\u3068rvm\u3084\u3089rbenv\u306a\u3069\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u3063\u305f\u307b\u3046\u304c\u3088\u3044\u306e\u304b\u3082\n* \u305d\u306e\u4ed6passenger\u3068\u304b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u5468\u308a\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u672a\u5bfe\u5fdc\n\n# docker-compose\n\n\u3053\u3093\u306a\u611f\u3058\u3067docker-compose\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u3001\u3053\u308c\u307e\u3067VM\u3084\u958b\u767a\u7528\u306eDB\u30b5\u30fc\u30d0\u30fc\u306b\u4f9d\u5b58\u3057\u3066\u305f\u958b\u767a\u74b0\u5883\u304c\u5168\u90e8\u30ed\u30fc\u30ab\u30eb\u3067\u5b8c\u7d50\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\n\n``` docker-compose.yml\nversion: '2'\nservices:\n    rails:\n        build:\n            context: /path/to/\n            dockerfile: DockerfileName\n        ports:\n            - \"3000:3000\"\n        depends_on:\n            - db \n        networks:\n            - app\n            - datastore\n    db:\n        image: mysql:5.6\n        ports:\n            - \"3306:3306\"\n        environment:\n            - TZ=JST-9\n            - MYSQL_USER=required\n            - MYSQL_PASSWORD=required\n            - MYSQL_ROOT_PASSWORD=required\n            - MYSQL_DATABASE=required\n        volumes:\n            - /path/to/mysql/dump/:/docker-entrypoint-initdb.d/\n            - /path/to/mysql/conf/:/etc/mysql/conf.d\n        privileged: true\n        networks:\n            - datastore\nnetworks:\n    app:\n    datastore:\n```\n\n\u4fbf\u5229\n", "tags": ["docker", "alpine", "Ruby", "Rails"]}