{"context": "\n\nPython\u306eselenium\u30e9\u30a4\u30d6\u30e9\u30ea\u304b\u3089phantomjs\u3092\u4f7f\u3063\u305f\u3089zombie\u306b\u306a\u3063\u305f\n\u3053\u306e\u8a18\u4e8b\u306f \u30af\u30ed\u30fc\u30e9\u30fc\uff0fWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0 Advent Calendar 2016 11\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n2016\u5e743\u6708\u306b Python\u306b\u3088\u308bWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0 \u3068\u3044\u3046\u66f8\u7c4d\u304c\u51fa\u7248\u3055\u308c\u307e\u3057\u305f\u3002\n\u5fae\u529b\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u79c1\u3082\u304a\u624b\u4f1d\u3044\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nPython\u306b\u3088\u308bWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u306e\u4e2d\u3067\u3082\u7d39\u4ecb\u3057\u3066\u3044\u308b\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u30c4\u30fc\u30eb\u3067\u3042\u308bselenium\u3068phantomjs\u3067\u3059\u304c\u3001\n\u30b9\u30af\u30ec\u30a4\u30d1\u30fc\u306e\u4f5c\u6210\u6642\u306b\u74b0\u5883\u306b\u3088\u3063\u3066\u306fphantomjs\u3092\u7d42\u4e86\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u305d\u306e\u4e8b\u4f8b\u3068\u3044\u3046\u304b\u554f\u984c\u3092\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nphatomjs\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u306a\u305c\u304b\u6b8b\u3063\u3066\u3057\u307e\u3046\n\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3059\u3067\u306bPython, Node, selenium, phantomjs\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u74b0\u5883\u3092\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\nrun.py\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver()\nbrowser.close()\nbrowser.quit()\nprint('Finished')\n\n\u3053\u306erun.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ python run.py\nFinished\n\n\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u304c\u3042\u308c\u3070\u6a19\u6e96\u51fa\u529b\u306bFinished\u3068\u51fa\u529b\u3057\u3066\u7d42\u4e86\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067phantomjs\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3066\u898b\u307e\u3059\u3002\n\u554f\u984c\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u5834\u5408\u306fphantomjs\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n$ ps aux | grep phantomjs\nsximada          74272 100.0  0.0  2432804   2004 s006  S+    4:41PM   0:00.01 grep --color phantomjs\nsximada          74267   0.0  0.7  3647068  59976 s006  S     4:41PM   0:02.01 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp2vmrand3 --webdriver=50599\n\n\u60b2\u3057\u3044\u3067\u3059\u306d\u3002\n\u203b\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u6b8b\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u3002\u826f\u304b\u3063\u305f\u3067\u3059\u306d\u3002\u554f\u984c\u3092\u8e0f\u3093\u3067\u3044\u306a\u3044\u3067\u3059\u3002\n\u3053\u306e\u554f\u984c\u306fstackoverflow\u306b\u3082\u540c\u69d8\u306e\u6295\u7a3f\u304c\u3044\u304f\u3064\u304b\u3042\u3063\u3066\u3001\u56de\u7b54\u306e\u4e2d\u306b\u306f pkill phantomjs\u3057\u308d \u307f\u305f\u3044\u306a\u56de\u7b54\u3082\u3042\u308a\u307e\u3059\u3002\n\u30de\u30b8\u304b\u3088\u3001\u3001\u3063\u3066\u611f\u3058\u3067\u3059\u3002\n\n\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u74b0\u5883\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\u4e0a\u8a18\u306e\u52d5\u4f5c\u74b0\u5883\u306f\u6b21\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\nOS: macOS 10.12.1\uff0816B2657\uff09\nPython: 3.5.2\nselenium: 2.53.6\nNode.js: v6.7.0\nphantomjs: 2.1.7\n\nOS, Python, Node\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u672c\u8cea\u304b\u3089\u96e2\u308c\u308b\u306e\u3067\u89e3\u8aac\u306f\u98db\u3070\u3057\u307e\u3059\u3002\nselenium\u306f\u666e\u901a\u306bpip install selenium \u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u554f\u984c\u306fphantomjs\u3067\u3059\u3002node\u3060\u304b\u3089 npm install phantomjs \u3057\u305f\u3044\u306a\u3042\u3068\u601d\u3044\u307e\u3059\u3002\nphantomjs\u306e\u672c\u5bb6\u306f https://github.com/ariya/phantomjs \u3067\u3059\u3002\u3057\u304b\u3057\u3053\u308c\u306fnpm\u3067\u5165\u308c\u3089\u308c\u308b\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\nnpm install phantomjs \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u306e\u306f https://github.com/Medium/phantomjs \u3067\u3059\u3002\n\u3053\u308c\u306f\u30ea\u30dd\u30b8\u30c8\u30ea\u306edescription\u306b\u3082\u3042\u308b\u901a\u308a NPM wrapper for installing phantomjs \u3067\u3001\nphantomjs\u3092npm\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u30e9\u30c3\u30d1\u30fc\u3067\u3059\u3002\n\u5b9f\u969b\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308b\u3068\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u3068\u601d\u308f\u308c\u307e\u3059(\u3082\u3057\u304b\u3057\u305f\u3089\u767a\u751f\u3057\u306a\u3044\u30b1\u30fc\u30b9\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c)\u3002\npackage.json\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ npm init .\n\nphantomjs(github.com/Medium/phantomjs)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ npm install phantomjs\n\nzombie1.py:\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='./node_modules/.bin/phantomjs')  # MODIFIED\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n\nzombie1.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ python zombie1.py\nFinished\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n(py3.5.2) $ ps aux | grep phantomjs\nsximada           2426   0.0  0.0  2423392    408 s002  R+    5:51PM   0:00.00 grep --color phantomjs\nsximada           2421   0.0  0.6  3645988  46780 s002  S     5:51PM   0:01.56 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp8nobgxn7 --webdriver=50641\n\n\u6b8b\u3063\u3066\u3044\u307e\u3059\u306d\u3048\u3002\n\nhomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fphatomjs\u3060\u3068\u767a\u751f\u3057\u306a\u3044\nhomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fphantomjs\u3060\u3068\u3069\u3046\u3067\u3057\u3087\u3046\u304b\u3002\n$ brew install phantomjs\n\n\u203bversion\u3092\u5408\u308f\u305b\u308b\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u4eca\u5165\u3063\u3066\u3044\u308b\u3082\u306e\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002(phantomjs-2.1.1)\nzombie2.py:\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='/usr/local/bin/phantomjs')\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n\nzombie2.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ python zombie2.py\nFinished\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ps aux | grep phantomjs\nsximada           3530   0.0  0.0  2432804    796 s002  R+    6:11PM   0:00.00 grep --color phantomjs\n$\n\n\u6b8b\u3063\u3066\u3044\u306a\u3044\u3067\u3059\u306d\u3048\u3002\u4f55\u304c\u9055\u3046\u3093\u3067\u3057\u3087\u3046\u3002\n\nhomebrew\u3067\u5165\u308c\u305fphantomjs\u306f\u5b9f\u884c\u53ef\u80fd\u306a\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\nfile\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068homebrew\u3067\u5165\u308c\u305fphantomjs /usr/local/bin/phantomjs \u306f\u5b9f\u884c\u53ef\u80fd\u306a\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u4fbf\u5b9c\u4e0a\u3001\u3053\u3061\u3089\u306e\u76f4\u63a5\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3092\u30d0\u30a4\u30ca\u30ea\u7248\u3068\u3057\u307e\u3059\u3002\n$ file /usr/local/bin/phantomjs\n/usr/local/bin/phantomjs: Mach-O 64-bit executable x86_64\n\n\nnpm\u3067\u5165\u308c\u305fphantomjs\u306fnodejs script\n\u4e00\u65b9npm\u3067\u5165\u308c\u305fphantomjs\u3092file\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u4fbf\u5b9c\u4e0a\u3001\u3053\u3061\u3089\u306e\u76f4\u63a5\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3092npm\u7248\u3068\u3057\u307e\u3059\u3002\n$ file node_modules/.bin/phantomjs\nnode_modules/.bin/phantomjs: a /usr/bin/env node script text executable, ASCII text\n\n\u4e2d\u8eab\u306fnodejs\u306escript\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n#!/usr/bin/env node\n\n/**\n * Script that will execute the downloaded phantomjs binary.  stdio are\n * forwarded to and from the child process.\n *\n * The following is for an ugly hack to avoid a problem where the installer\n * finds the bin script npm creates during global installation.\n *\n * {NPM_INSTALL_MARKER}\n */\n\nvar path = require('path')\nvar spawn = require('child_process').spawn\n\nvar binPath = require(path.join(__dirname, '..', 'lib', 'phantomjs')).path\n\nvar args = process.argv.slice(2)\n\n// For Node 0.6 compatibility, pipe the streams manually, instead of using\n// `{ stdio: 'inherit' }`.\nvar cp = spawn(binPath, args)\ncp.stdout.pipe(process.stdout)\ncp.stderr.pipe(process.stderr)\nprocess.stdin.pipe(cp.stdin)\n\ncp.on('error', function (err) {\n  console.error('Error executing phantom at', binPath)\n  console.error(err.stack)\n})\n\ncp.on('exit', function(code){\n  // Wait few ms for error to be printed.\n  setTimeout(function(){\n    process.exit(code)\n  }, 20)\n});\n\nprocess.on('SIGTERM', function() {\n  cp.kill('SIGTERM')\n  process.exit(1)\n})\n\n\nvar cp = spawn(binPath, args) \u3067\u30d0\u30a4\u30ca\u30ea\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u5b9f\u884c\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u6700\u5f8c\u306e\u65b9\u3067 SIGTERM \u306b\u5bfe\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u3066\u3001SIGTERM\u304c\u6765\u308b\u3068\u5b50\u30d7\u30ed\u30bb\u30b9\u306b SIGTERM \u3092\u9001\u4fe1\u3057\u3066\u7d42\u4e86\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30d0\u30a4\u30ca\u30ea\u7248\u306f2\u6bb5\u3001npm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7248\u306f3\u6bb5\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\n\u30d0\u30a4\u30ca\u30ea\u7248\u3068npm\u7248\u3092\u4f7f\u3063\u3066selenium\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u30d7\u30ed\u30bb\u30b9\u306f\u6b21\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u306a\u308a\u307e\u3059\u3002\n\u30d0\u30a4\u30ca\u30ea\u7248:\n$ pstree 3812\n-+= 03812 sximada python zombie2.py\n \\--- 03815 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpu8trzjh0 --webdriver=50761\n\nnpm\u7248:\n$ pstree 3701\n-+= 03701 sximada python zombie1.py\n \\-+- 03704 sximada node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp9c0y1sj7 --webdriver=50747\n   \\--- 03705 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp9c0y1sj7 --webdriver=50747\n\n\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u3053\u306e\u4e00\u756a\u4e0b\u306b\u3076\u3089\u4e0b\u304c\u3063\u3066\u3044\u308b\u5b6b\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n$ pstree 4537\n-+= 04537 sximada python zombie1.py\n \\-+- 04540 sximada node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n   \\--- 04541 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n$ ps aux | grep phantomjs\nsximada           4554   0.0  0.0  2432804    632 s003  R+    6:50PM   0:00.00 grep --color phantomjs\nsximada           4541   0.0  0.6  3646488  47532 s002  S     6:49PM   0:05.84 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n\n\n\u624b\u52d5\u3067\u73fe\u8c61\u3092\u518d\u73fe\u3055\u305b\u308b\nnode ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406 \u3092\u5b9f\u884c\u3057\u305f\u5f8c\u3067\n\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u3092kill -KILL \u3057\u3066\u307f\u307e\u3059\u3002\n$ node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n[INFO  - 2016-12-10T09:57:42.829Z] GhostDriver - Main - running on port 51448\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u305f\u3089SIGKILL\u3067kill\u3057\u307e\u3059\u3002\n$ ps -ef | grep phantom\n  501  4662   763   0  6:57PM ttys002    0:00.12 node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4663  4662   0  6:57PM ttys002    0:01.73 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4666   764   0  6:57PM ttys003    0:00.00 grep --color phantom\n$ kill -KILL 4662\n$ ps -ef | grep phantom\n  501  4663     1   0  6:57PM ttys002    0:03.63 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4670   764   0  6:58PM ttys003    0:00.00 grep --color phantom\n\n\u518d\u73fe\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306e\u305b\u3044\u3067\u3059\u306d\u3002selenium\u306fshutdown\u6642\u306bSIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\nselenium.webdriver.phantomjs.webdriver.Webdriver.close()\u306e\u6319\u52d5\n\u3053\u3053\u304b\u3089\u306fpdb.set_trace()\u3067\u30c7\u30d0\u30c3\u30ac\u3092\u4f7f\u3063\u3066Python\u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u8abf\u3079\u3066\u3044\u304d\u307e\u3059\u3002\nzombie1.py\u306bpdb\u3092\u4ed5\u8fbc\u3093\u3067\u52d5\u304d\u3092\u898b\u307e\u3057\u3087\u3046\u3002\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='./node_modules/.bin/phantomjs')\nimport pdb; pdb.set_trace()\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n\n\u52d5\u4f5c\u3092\u898b\u3066\u307f\u308b\u3068 selenium/webdriver/remote/remote_connection.py(470)_request() \u7b87\u6240\u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n464                 if password_manager:\n465                     opener = url_request.build_opener(url_request.HTTPRedirectHandler(),\n466                                                       HttpErrorHandler(),\n467                                                       url_request.HTTPBasicAuthHandler(password_manager))\n468                 else:\n469                     opener = url_request.build_opener(url_request.HTTPRedirectHandler(),\n470                                                       HttpErrorHandler())\n471  ->             resp = opener.open(request, timeout=self._timeout)\n472                 statuscode = resp.code\n\n\u9001\u3063\u3066\u3044\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u6b21\u306e\u3088\u3046\u306arequest\u3067\u3059\u3002\n-> request = Request(url, data=body.encode('utf-8'), method=method)\n(Pdb) p url\n'http://127.0.0.1:51524/wd/hub/session/57277cb0-bec1-11e6-a0b1-31edd9b29650/window'\n(Pdb) p body\n'{\"sessionId\": \"57277cb0-bec1-11e6-a0b1-31edd9b29650\"}'\n(Pdb) p method\n'DELETE'\n(Pdb)\n\n\u305d\u308c\u4ee5\u5916\u306f\u7279\u306b\u4f55\u3082\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\nselenium.webdriver.phantomjs.webdriver.Webdriver.quit()\u306e\u6319\u52d5\nquit()\u306e\u65b9\u306f\u3069\u3046\u3067\u3057\u3087\u3046\u304b\u3002\nselenium/webdriver/phantomjs/webdriver.py(76)quit()\u306e self.service.stop() \u306e\u51e6\u7406\u306e\u4e2d\u3067SIGTERM\u3084SIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308a\u307e\u3057\u305f\u3002\nselenium/webdriver/common/service.py(154)stop():\n(Pdb) list\n149                             stream.close()\n150                         except AttributeError:\n151                             pass\n152                     self.process.terminate()\n153                     self.process.kill()\n154  ->                 self.process.wait()\n155                     self.process = None\n156             except OSError:\n157                 # kill may not be available under windows environment\n158                 pass\n159\n\n\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u9650\u308aSIGTERM\u3092\u9001\u4fe1\u3057\u305f\u5f8c\u3067SIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057npm\u7248\u306b\u306fSIGTERM\u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u305d\u3082\u305d\u3082\u3053\u306eSIGKILL\u306f\u5fc5\u8981\u306a\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\u8a66\u3057\u306b self.process.kill() \u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u5b9f\u884c\u3057\u3066\u898b\u307e\u3059\u3002\nselenium/webdriver/common/service.py:\n                self.process.terminate()\n                # self.process.kill()   ## \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n                self.process.wait()\n\n\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ python  zombie1.py\nFinished\n$ ps aux | grep phantomjs\nsximada           5270   0.0  0.0  2424612    500 s002  R+    7:34PM   0:00.00 grep --color phantomjs\n$\n\n\u30d7\u30ed\u30bb\u30b9\u306f\u6b8b\u3063\u3066\u3044\u307e\u305b\u3093\u3002self.process.kill() \u306e\u305b\u3044\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u304ckill\u3055\u308c\u3066\u5b6b\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u5b50\u30d7\u30ed\u30bb\u30b9\u306eSIGTERM\u30cf\u30f3\u30c9\u30e9\u51e6\u7406\u5b8c\u4e86\u524d\u306bSIGKILL\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u306e\u304c\u539f\u56e0\n\u3069\u3046\u3084\u3089self.process.terminate()\u3067\u9001\u3089\u308c\u305fSIGTERM\u3092npm\u7248\u306ephantomjs\u304c\u3001\n\u30cf\u30f3\u30c9\u30e9\u3067\u5b6b\u30d7\u30ed\u30bb\u30b9\u306bSIGTERM\u3092\u9001\u4fe1\u3059\u308b\u524d\u306bSIGKILL\u3067kill\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u306a\u3093\u304b\u5883\u754c\u306e\u306f\u3056\u307e\u306b\u306f\u307e\u308a\u3053\u3093\u3060\u6c17\u5206\u3067\u3059\u3002\n\nnpm\u3092\u4f7f\u308f\u305aphantomjs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u56de\u907f\u3067\u304d\u308b\nnpm\u3092\u4ecb\u3055\u306a\u3051\u308c\u3070\u826f\u3055\u305d\u3046\u306a\u306e\u3067\u3001npm install phantomjs \u305b\u305a\u3001\nhomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304b\u3001http://phantomjs.org/download.html \u304b\u3089\u843d\u3068\u3057\u3066\u5165\u308c\u308b\u3068\u304b\u3059\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\u306a\u3093\u3060\u304b\u3068\u3063\u3066\u3082\u9060\u56de\u308a\u3057\u3066\u3057\u307e\u3063\u305f\u6c17\u5206\u3067\u3059\u3002\n\u540c\u3058\u9060\u56de\u308a\u3092\u8ab0\u304b\u304c\u3057\u306a\u3044\u3053\u3068\u3092\u7948\u308a\u307e\u3059\u3002\n# Python\u306eselenium\u30e9\u30a4\u30d6\u30e9\u30ea\u304b\u3089phantomjs\u3092\u4f7f\u3063\u305f\u3089zombie\u306b\u306a\u3063\u305f\n\n\u3053\u306e\u8a18\u4e8b\u306f [\u30af\u30ed\u30fc\u30e9\u30fc\uff0fWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0 Advent Calendar 2016](http://qiita.com/advent-calendar/2016/crawler) 11\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n2016\u5e743\u6708\u306b [Python\u306b\u3088\u308bWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0](https://www.oreilly.co.jp/books/9784873117614/) \u3068\u3044\u3046\u66f8\u7c4d\u304c\u51fa\u7248\u3055\u308c\u307e\u3057\u305f\u3002\n\u5fae\u529b\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u79c1\u3082\u304a\u624b\u4f1d\u3044\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n[Python\u306b\u3088\u308bWeb\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0](https://www.oreilly.co.jp/books/9784873117614/)\u306e\u4e2d\u3067\u3082\u7d39\u4ecb\u3057\u3066\u3044\u308b\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u30c4\u30fc\u30eb\u3067\u3042\u308bselenium\u3068phantomjs\u3067\u3059\u304c\u3001\n\u30b9\u30af\u30ec\u30a4\u30d1\u30fc\u306e\u4f5c\u6210\u6642\u306b\u74b0\u5883\u306b\u3088\u3063\u3066\u306fphantomjs\u3092\u7d42\u4e86\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u305d\u306e\u4e8b\u4f8b\u3068\u3044\u3046\u304b\u554f\u984c\u3092\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## phatomjs\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u306a\u305c\u304b\u6b8b\u3063\u3066\u3057\u307e\u3046\n\n\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3059\u3067\u306bPython, Node, selenium, phantomjs\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u74b0\u5883\u3092\u524d\u63d0\u3068\u3057\u307e\u3059\u3002\n\nrun.py\n\n```\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver()\nbrowser.close()\nbrowser.quit()\nprint('Finished')\n```\n\n\u3053\u306erun.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ python run.py\nFinished\n```\n\n\u5b9f\u884c\u3067\u304d\u308b\u74b0\u5883\u304c\u3042\u308c\u3070\u6a19\u6e96\u51fa\u529b\u306bFinished\u3068\u51fa\u529b\u3057\u3066\u7d42\u4e86\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067phantomjs\u30d7\u30ed\u30bb\u30b9\u304c\u5b58\u5728\u3059\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3057\u3066\u898b\u307e\u3059\u3002\n\u554f\u984c\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u5834\u5408\u306fphantomjs\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n```\n$ ps aux | grep phantomjs\nsximada          74272 100.0  0.0  2432804   2004 s006  S+    4:41PM   0:00.01 grep --color phantomjs\nsximada          74267   0.0  0.7  3647068  59976 s006  S     4:41PM   0:02.01 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp2vmrand3 --webdriver=50599\n```\n\n\u60b2\u3057\u3044\u3067\u3059\u306d\u3002\n\u203b\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u6b8b\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u3082\u3042\u308a\u307e\u3059\u3002\u826f\u304b\u3063\u305f\u3067\u3059\u306d\u3002\u554f\u984c\u3092\u8e0f\u3093\u3067\u3044\u306a\u3044\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u306fstackoverflow\u306b\u3082\u540c\u69d8\u306e\u6295\u7a3f\u304c\u3044\u304f\u3064\u304b\u3042\u3063\u3066\u3001\u56de\u7b54\u306e\u4e2d\u306b\u306f `pkill phantomjs\u3057\u308d` \u307f\u305f\u3044\u306a\u56de\u7b54\u3082\u3042\u308a\u307e\u3059\u3002\n\u30de\u30b8\u304b\u3088\u3001\u3001\u3063\u3066\u611f\u3058\u3067\u3059\u3002\n\n## \u554f\u984c\u304c\u767a\u751f\u3059\u308b\u74b0\u5883\u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\n\u4e0a\u8a18\u306e\u52d5\u4f5c\u74b0\u5883\u306f\u6b21\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n- OS: macOS 10.12.1\uff0816B2657\uff09\n- Python: 3.5.2\n- selenium: 2.53.6\n- Node.js: v6.7.0\n- phantomjs: 2.1.7\n\nOS, Python, Node\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u672c\u8cea\u304b\u3089\u96e2\u308c\u308b\u306e\u3067\u89e3\u8aac\u306f\u98db\u3070\u3057\u307e\u3059\u3002\nselenium\u306f\u666e\u901a\u306b`pip install selenium` \u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u554f\u984c\u306fphantomjs\u3067\u3059\u3002node\u3060\u304b\u3089 `npm install phantomjs` \u3057\u305f\u3044\u306a\u3042\u3068\u601d\u3044\u307e\u3059\u3002\n\nphantomjs\u306e\u672c\u5bb6\u306f https://github.com/ariya/phantomjs \u3067\u3059\u3002\u3057\u304b\u3057\u3053\u308c\u306fnpm\u3067\u5165\u308c\u3089\u308c\u308b\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n`npm install phantomjs` \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u306e\u306f https://github.com/Medium/phantomjs \u3067\u3059\u3002\n\u3053\u308c\u306f\u30ea\u30dd\u30b8\u30c8\u30ea\u306edescription\u306b\u3082\u3042\u308b\u901a\u308a `NPM wrapper for installing phantomjs` \u3067\u3001\nphantomjs\u3092npm\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u30e9\u30c3\u30d1\u30fc\u3067\u3059\u3002\n\n\u5b9f\u969b\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308b\u3068\u554f\u984c\u304c\u767a\u751f\u3059\u308b\u3068\u601d\u308f\u308c\u307e\u3059(\u3082\u3057\u304b\u3057\u305f\u3089\u767a\u751f\u3057\u306a\u3044\u30b1\u30fc\u30b9\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c)\u3002\npackage.json\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ npm init .\n```\n\nphantomjs(github.com/Medium/phantomjs)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ npm install phantomjs\n```\n\nzombie1.py:\n\n```\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='./node_modules/.bin/phantomjs')  # MODIFIED\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n```\n\nzombie1.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ python zombie1.py\nFinished\n```\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n(py3.5.2) $ ps aux | grep phantomjs\nsximada           2426   0.0  0.0  2423392    408 s002  R+    5:51PM   0:00.00 grep --color phantomjs\nsximada           2421   0.0  0.6  3645988  46780 s002  S     5:51PM   0:01.56 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp8nobgxn7 --webdriver=50641\n```\n\n\u6b8b\u3063\u3066\u3044\u307e\u3059\u306d\u3048\u3002\n\n## homebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fphatomjs\u3060\u3068\u767a\u751f\u3057\u306a\u3044\n\nhomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fphantomjs\u3060\u3068\u3069\u3046\u3067\u3057\u3087\u3046\u304b\u3002\n\n```\n$ brew install phantomjs\n```\n\u203bversion\u3092\u5408\u308f\u305b\u308b\u306e\u304c\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u4eca\u5165\u3063\u3066\u3044\u308b\u3082\u306e\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002(phantomjs-2.1.1)\n\nzombie2.py:\n\n```\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='/usr/local/bin/phantomjs')\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n```\n\nzombie2.py\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ python zombie2.py\nFinished\n```\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ps aux | grep phantomjs\nsximada           3530   0.0  0.0  2432804    796 s002  R+    6:11PM   0:00.00 grep --color phantomjs\n$\n```\n\n\u6b8b\u3063\u3066\u3044\u306a\u3044\u3067\u3059\u306d\u3048\u3002\u4f55\u304c\u9055\u3046\u3093\u3067\u3057\u3087\u3046\u3002\n\n## homebrew\u3067\u5165\u308c\u305fphantomjs\u306f\u5b9f\u884c\u53ef\u80fd\u306a\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\n\nfile\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068homebrew\u3067\u5165\u308c\u305fphantomjs `/usr/local/bin/phantomjs` \u306f\u5b9f\u884c\u53ef\u80fd\u306a\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u4fbf\u5b9c\u4e0a\u3001\u3053\u3061\u3089\u306e\u76f4\u63a5\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3092\u30d0\u30a4\u30ca\u30ea\u7248\u3068\u3057\u307e\u3059\u3002\n\n```\n$ file /usr/local/bin/phantomjs\n/usr/local/bin/phantomjs: Mach-O 64-bit executable x86_64\n```\n\n## npm\u3067\u5165\u308c\u305fphantomjs\u306fnodejs script\n\n\u4e00\u65b9npm\u3067\u5165\u308c\u305fphantomjs\u3092file\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\u4fbf\u5b9c\u4e0a\u3001\u3053\u3061\u3089\u306e\u76f4\u63a5\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3092npm\u7248\u3068\u3057\u307e\u3059\u3002\n\n```\n$ file node_modules/.bin/phantomjs\nnode_modules/.bin/phantomjs: a /usr/bin/env node script text executable, ASCII text\n```\n\n\u4e2d\u8eab\u306fnodejs\u306escript\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\n#!/usr/bin/env node\n\n/**\n * Script that will execute the downloaded phantomjs binary.  stdio are\n * forwarded to and from the child process.\n *\n * The following is for an ugly hack to avoid a problem where the installer\n * finds the bin script npm creates during global installation.\n *\n * {NPM_INSTALL_MARKER}\n */\n\nvar path = require('path')\nvar spawn = require('child_process').spawn\n\nvar binPath = require(path.join(__dirname, '..', 'lib', 'phantomjs')).path\n\nvar args = process.argv.slice(2)\n\n// For Node 0.6 compatibility, pipe the streams manually, instead of using\n// `{ stdio: 'inherit' }`.\nvar cp = spawn(binPath, args)\ncp.stdout.pipe(process.stdout)\ncp.stderr.pipe(process.stderr)\nprocess.stdin.pipe(cp.stdin)\n\ncp.on('error', function (err) {\n  console.error('Error executing phantom at', binPath)\n  console.error(err.stack)\n})\n\ncp.on('exit', function(code){\n  // Wait few ms for error to be printed.\n  setTimeout(function(){\n    process.exit(code)\n  }, 20)\n});\n\nprocess.on('SIGTERM', function() {\n  cp.kill('SIGTERM')\n  process.exit(1)\n})\n\n```\n\n`var cp = spawn(binPath, args)` \u3067\u30d0\u30a4\u30ca\u30ea\u3092\u5b50\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u5b9f\u884c\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u6700\u5f8c\u306e\u65b9\u3067 `SIGTERM` \u306b\u5bfe\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u3066\u3001SIGTERM\u304c\u6765\u308b\u3068\u5b50\u30d7\u30ed\u30bb\u30b9\u306b `SIGTERM` \u3092\u9001\u4fe1\u3057\u3066\u7d42\u4e86\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n## \u30d0\u30a4\u30ca\u30ea\u7248\u306f2\u6bb5\u3001npm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7248\u306f3\u6bb5\u306e\u30d7\u30ed\u30bb\u30b9\u306e\u69cb\u9020\u306b\u306a\u3063\u3066\u3044\u308b\n\n\u30d0\u30a4\u30ca\u30ea\u7248\u3068npm\u7248\u3092\u4f7f\u3063\u3066selenium\u3092\u8d77\u52d5\u3057\u305f\u5834\u5408\u30d7\u30ed\u30bb\u30b9\u306f\u6b21\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30d0\u30a4\u30ca\u30ea\u7248:\n\n```\n$ pstree 3812\n-+= 03812 sximada python zombie2.py\n \\--- 03815 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpu8trzjh0 --webdriver=50761\n```\n\nnpm\u7248:\n\n```\n$ pstree 3701\n-+= 03701 sximada python zombie1.py\n \\-+- 03704 sximada node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp9c0y1sj7 --webdriver=50747\n   \\--- 03705 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmp9c0y1sj7 --webdriver=50747\n```\n\n\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u3053\u306e\u4e00\u756a\u4e0b\u306b\u3076\u3089\u4e0b\u304c\u3063\u3066\u3044\u308b\u5b6b\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\n$ pstree 4537\n-+= 04537 sximada python zombie1.py\n \\-+- 04540 sximada node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n   \\--- 04541 sximada /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n$ ps aux | grep phantomjs\nsximada           4554   0.0  0.0  2432804    632 s003  R+    6:50PM   0:00.00 grep --color phantomjs\nsximada           4541   0.0  0.6  3646488  47532 s002  S     6:49PM   0:05.84 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406\n```\n\n## \u624b\u52d5\u3067\u73fe\u8c61\u3092\u518d\u73fe\u3055\u305b\u308b\n\n`node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpg1eq1xst --webdriver=51406` \u3092\u5b9f\u884c\u3057\u305f\u5f8c\u3067\n\u305d\u306e\u30d7\u30ed\u30bb\u30b9\u3092`kill -KILL` \u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n[INFO  - 2016-12-10T09:57:42.829Z] GhostDriver - Main - running on port 51448\n```\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u305f\u3089SIGKILL\u3067kill\u3057\u307e\u3059\u3002\n\n```\n$ ps -ef | grep phantom\n  501  4662   763   0  6:57PM ttys002    0:00.12 node ./node_modules/.bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4663  4662   0  6:57PM ttys002    0:01.73 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4666   764   0  6:57PM ttys003    0:00.00 grep --color phantom\n$ kill -KILL 4662\n$ ps -ef | grep phantom\n  501  4663     1   0  6:57PM ttys002    0:03.63 /usr/local/bin/phantomjs --cookies-file=/var/folders/hx/xp4thw0x7rj15r_2w57_wvfh0000gn/T/tmpoazqtmx7 --webdriver=51448\n  501  4670   764   0  6:58PM ttys003    0:00.00 grep --color phantom\n```\n\n\u518d\u73fe\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306e\u305b\u3044\u3067\u3059\u306d\u3002selenium\u306fshutdown\u6642\u306bSIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\n## selenium.webdriver.phantomjs.webdriver.Webdriver.close()\u306e\u6319\u52d5\n\n\u3053\u3053\u304b\u3089\u306fpdb.set_trace()\u3067\u30c7\u30d0\u30c3\u30ac\u3092\u4f7f\u3063\u3066Python\u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u8abf\u3079\u3066\u3044\u304d\u307e\u3059\u3002\nzombie1.py\u306bpdb\u3092\u4ed5\u8fbc\u3093\u3067\u52d5\u304d\u3092\u898b\u307e\u3057\u3087\u3046\u3002\n\n```\nfrom selenium.webdriver.phantomjs.webdriver import WebDriver\n\nbrowser = WebDriver(executable_path='./node_modules/.bin/phantomjs')\nimport pdb; pdb.set_trace()\nbrowser.close()\nbrowser.quit()\n\nprint('Finished')\n```\n\n\u52d5\u4f5c\u3092\u898b\u3066\u307f\u308b\u3068 selenium/webdriver/remote/remote_connection.py(470)_request() \u7b87\u6240\u3067HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\n464                 if password_manager:\n465                     opener = url_request.build_opener(url_request.HTTPRedirectHandler(),\n466                                                       HttpErrorHandler(),\n467                                                       url_request.HTTPBasicAuthHandler(password_manager))\n468                 else:\n469                     opener = url_request.build_opener(url_request.HTTPRedirectHandler(),\n470                                                       HttpErrorHandler())\n471  ->             resp = opener.open(request, timeout=self._timeout)\n472                 statuscode = resp.code\n```\n\n\u9001\u3063\u3066\u3044\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u6b21\u306e\u3088\u3046\u306arequest\u3067\u3059\u3002\n\n```\n-> request = Request(url, data=body.encode('utf-8'), method=method)\n(Pdb) p url\n'http://127.0.0.1:51524/wd/hub/session/57277cb0-bec1-11e6-a0b1-31edd9b29650/window'\n(Pdb) p body\n'{\"sessionId\": \"57277cb0-bec1-11e6-a0b1-31edd9b29650\"}'\n(Pdb) p method\n'DELETE'\n(Pdb)\n```\n\n\u305d\u308c\u4ee5\u5916\u306f\u7279\u306b\u4f55\u3082\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n## selenium.webdriver.phantomjs.webdriver.Webdriver.quit()\u306e\u6319\u52d5\n\nquit()\u306e\u65b9\u306f\u3069\u3046\u3067\u3057\u3087\u3046\u304b\u3002\n\nselenium/webdriver/phantomjs/webdriver.py(76)quit()\u306e `self.service.stop()` \u306e\u51e6\u7406\u306e\u4e2d\u3067SIGTERM\u3084SIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\nselenium/webdriver/common/service.py(154)stop():\n\n```\n(Pdb) list\n149                             stream.close()\n150                         except AttributeError:\n151                             pass\n152                     self.process.terminate()\n153                     self.process.kill()\n154  ->                 self.process.wait()\n155                     self.process = None\n156             except OSError:\n157                 # kill may not be available under windows environment\n158                 pass\n159\n```\n\n\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u9650\u308aSIGTERM\u3092\u9001\u4fe1\u3057\u305f\u5f8c\u3067SIGKILL\u3092\u9001\u4fe1\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057npm\u7248\u306b\u306fSIGTERM\u306e\u30b7\u30b0\u30ca\u30eb\u30cf\u30f3\u30c9\u30e9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u305d\u3082\u305d\u3082\u3053\u306eSIGKILL\u306f\u5fc5\u8981\u306a\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\u8a66\u3057\u306b `self.process.kill()` \u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\u5b9f\u884c\u3057\u3066\u898b\u307e\u3059\u3002\n\n\nselenium/webdriver/common/service.py:\n\n```\n                self.process.terminate()\n                # self.process.kill()   ## \u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n                self.process.wait()\n```\n\n\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ python  zombie1.py\nFinished\n$ ps aux | grep phantomjs\nsximada           5270   0.0  0.0  2424612    500 s002  R+    7:34PM   0:00.00 grep --color phantomjs\n$\n```\n\n\u30d7\u30ed\u30bb\u30b9\u306f\u6b8b\u3063\u3066\u3044\u307e\u305b\u3093\u3002`self.process.kill()` \u306e\u305b\u3044\u3067\u5b50\u30d7\u30ed\u30bb\u30b9\u304ckill\u3055\u308c\u3066\u5b6b\u30d7\u30ed\u30bb\u30b9\u304c\u6b8b\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n## \u5b50\u30d7\u30ed\u30bb\u30b9\u306eSIGTERM\u30cf\u30f3\u30c9\u30e9\u51e6\u7406\u5b8c\u4e86\u524d\u306bSIGKILL\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u306e\u304c\u539f\u56e0\n\n\u3069\u3046\u3084\u3089`self.process.terminate()`\u3067\u9001\u3089\u308c\u305fSIGTERM\u3092npm\u7248\u306ephantomjs\u304c\u3001\n\u30cf\u30f3\u30c9\u30e9\u3067\u5b6b\u30d7\u30ed\u30bb\u30b9\u306bSIGTERM\u3092\u9001\u4fe1\u3059\u308b\u524d\u306bSIGKILL\u3067kill\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u306a\u3093\u304b\u5883\u754c\u306e\u306f\u3056\u307e\u306b\u306f\u307e\u308a\u3053\u3093\u3060\u6c17\u5206\u3067\u3059\u3002\n\n## npm\u3092\u4f7f\u308f\u305aphantomjs\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u56de\u907f\u3067\u304d\u308b\n\nnpm\u3092\u4ecb\u3055\u306a\u3051\u308c\u3070\u826f\u3055\u305d\u3046\u306a\u306e\u3067\u3001`npm install phantomjs` \u305b\u305a\u3001\nhomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304b\u3001http://phantomjs.org/download.html \u304b\u3089\u843d\u3068\u3057\u3066\u5165\u308c\u308b\u3068\u304b\u3059\u308c\u3070\u826f\u3044\u3067\u3059\u3002\n\n\u306a\u3093\u3060\u304b\u3068\u3063\u3066\u3082\u9060\u56de\u308a\u3057\u3066\u3057\u307e\u3063\u305f\u6c17\u5206\u3067\u3059\u3002\n\u540c\u3058\u9060\u56de\u308a\u3092\u8ab0\u304b\u304c\u3057\u306a\u3044\u3053\u3068\u3092\u7948\u308a\u307e\u3059\u3002\n", "tags": ["Python", "Selenium", "PhantomJS"]}