{"context": " More than 1 year has passed since last update.\u524d\u56de\u306fvyatta\u3092\u7528\u3044\u3066AWS VPC\u3068SoftLayer\u3092IPsec VPN\u3067\u63a5\u7d9a\u3057\u305f\u304c\u3001\u8a2d\u5b9a\u304c\u975e\u5e38\u306b\u7169\u96d1\u3060\u3063\u305f\u3002\n\u305d\u3053\u3067\u4eca\u56de\u306f\u3001AWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u3068vyatta\u3092\u7528\u3044\u3001\u5404\u62e0\u70b9\u306e\u7d4c\u8def\u60c5\u5831\u3092BGP\u3092\u7528\u3044\u3066\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001\u306a\u308b\u3079\u304f\u7c21\u5358\u306a\u624b\u9806\u3067AWS\u3068SoftLayer\u3092\u591a\u62e0\u70b9\u9593VPN\u63a5\u7d9a\u3059\u308b\u3002\n\n\nSoftLayer\u3067vyatta\u8d77\u52d5\nSoftLayer\u306evyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u78ba\u5b9a\u3059\u308b\u305f\u3081\u306b\u3001\u6700\u521d\u306bSoftLayer\u306e\u6771\u4eacDC\u3068\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3067vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nOS: Vyatta 6.6 Community Edision (64bit)\nCPU: 2.0GHz 1core\nRAM: 1GB RAM\n\n\n\n\nDC\n\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\n\n\n\n\n\u6771\u4eac\n161.202.114.70\n161.202.114.64/28\n10.132.182.81\n10.132.182.64/26\n\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\n161.202.24.85\n161.202.24.80/28\n10.117.212.51\n10.117.212.0/26\n\n\n\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067Elastic IP\u78ba\u4fdd\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u7acb\u3061\u4e0a\u3052\u308b\u4e88\u5b9a\u306evyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306b\u3001\u4f7f\u7528\u7b87\u6240\u304cVPC\u306eElastic IP\u3092\u4e00\u3064\u78ba\u4fdd\u3059\u308b\u3002\n\u4eca\u56de\u306f52.76.38.181\u304c\u78ba\u4fdd\u3055\u308c\u305f\u3002\n\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u63a5\u7d9a\u3092\u7acb\u3061\u4e0a\u3052\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067VPC\u3092\u4f5c\u6210\u3057\u3066\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u5272\u308a\u5f53\u3066\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3001SoftLayer\u6771\u4eacDC\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u306eVPN\u63a5\u7d9a\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nVPC\u4f5c\u6210\nVPC\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f192.168.0.0/17\u3068\u3059\u308b\u3002\n\n\n\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u5272\u308a\u5f53\u3066\n\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fVPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n\n\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u4f5c\u6210\nVPN\u63a5\u7d9a\u5148\u306e\u30a2\u30f3\u30ab\u30fc\u3068\u306a\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u3001SoftLayer\u6771\u4eacDC\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306e3\u62e0\u70b9\u5206\u4f5c\u6210\u3059\u308b\u3002BGP\u306b\u3088\u308b\u52d5\u7684\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3046\u304c\u3001AS\u756a\u53f7\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u9818\u57df\uff0864512\uff5e65535\uff09\u304b\u3089\u91cd\u8907\u305b\u305a\u306b\u9078\u3076\u3002\n\n\n\n\u62e0\u70b9\n\u30d1\u30d6\u30ea\u30c3\u30afIP\nAS\u756a\u53f7\n\n\n\n\nSoftLayer\u6771\u4eacDC\n161.202.114.70\n65001\n\n\nSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\n161.202.24.85\n65002\n\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\n52.76.38.181\n65003\n\n\n\n\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u7528\u306e\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f8b\u3002\n\n\nVPN\u63a5\u7d9a\u306e\u7acb\u3061\u4e0a\u3052\n\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\uff13\u3064\u306e\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u7d50\u3073\u3064\u3051\u3066\u3001AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u4e2d\u5fc3\u3068\u3057\u305f3\u3064\u306eVPN\u63a5\u7d9a\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u3068\u306eVPN\u63a5\u7d9a\u306e\u4f8b\u3002\n\nAWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u306f\u6700\u521d\u304b\u3089\u5197\u9577\u5316\u3055\u308c\u3066\u304a\u308a\u3001VPN\u30c8\u30f3\u30cd\u30eb\u306f\u81ea\u52d5\u7684\u306b\u4e8c\u3064\u4f5c\u6210\u3055\u308c\u308b\u3002\u305f\u3060\u3057\u3053\u306e\u6bb5\u968e\u3067\u306f\u5bfe\u5411\u306eVPN\u30eb\u30fc\u30bf\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u3001VPN\u30c8\u30f3\u30cd\u30eb\u306fDOWN\u3057\u305f\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u5404VPN\u63a5\u7d9a\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u3001vyatta\u306e\u30b3\u30de\u30f3\u30c9\u5f62\u5f0f\u3067\u305d\u308c\u305e\u308c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067vyatta\u8d77\u52d5\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067VPC\u3068\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u78ba\u4fdd\u3057\u3066\u304a\u3044\u305fElastic IP\u3092\u5272\u308a\u5f53\u3066\u308b\u3002\n\nVPC\u4f5c\u6210\nVPC\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f192.168.128.0/17\u3068\u3059\u308b\u3002\n\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n\u5148\u307b\u3069\u4f5c\u3063\u305fVPC\u5185\u306eap-southeast-1a\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f192.168.128.0/24\u3068\u3059\u308b\u3002\n\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f5c\u6210\u3068\u30a2\u30bf\u30c3\u30c1\n\u5148\u307b\u3069\u4f5c\u3063\u305fVPC\u5185\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3001VPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30010.0.0.0/0\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\nvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nami: Vyatta Core 6.6 R1 x86_64 rev1 - ami-d2b0ff80\ntype: t1.micro\nIP\u30a2\u30c9\u30ec\u30b9: 192.168.128.10\n\n\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u4f5c\u6210\u3057\u305fVPN\u63a5\u7d9a\u306e\u30c8\u30f3\u30cd\u30eb\u7aef\u70b9\u306eIP\u30a2\u30c9\u30ec\u30b9\uff08103.246.151.29\u3068103.246.151.39\uff09\u304b\u3089\u306eESP\uff08IP\u30d7\u30ed\u30c8\u30b3\u30eb50\uff09\u3068IKE\uff08UDP\u30dd\u30fc\u30c8500\uff09\u3092\u53d7\u3051\u5165\u308c\u308b\u3002\u307e\u305fAWS\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3082\u53d7\u3051\u5165\u308c\u308b\u3002\n\n\nENI\u306e\u8a2d\u5b9a\u5909\u66f4\n\u4f5c\u6210\u3057\u305fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306e\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u3092\u7121\u52b9\u5316\u3057\u3001\u30d1\u30b1\u30c3\u30c8\u3092\u8ee2\u9001\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\n\nElastic IP\u5272\u308a\u5f53\u3066\n\u78ba\u4fdd\u3057\u3066\u304a\u3044\u305fElastic IP\u3092\u7acb\u3061\u4e0a\u3052\u305fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306b\u5272\u308a\u5f53\u3066\u308b\u3002\n\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u8a2d\u5b9a\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fvyatta\u7528\u8a2d\u5b9a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5143\u306b\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u305f\u3060\u3057\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044\u3002BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3001\u53ca\u3073\u5404\u30c8\u30f3\u30cd\u30eb\u3092\u30d4\u30a2\u30ea\u30f3\u30b0\u3059\u308blocal address\u3092\u9069\u5207\u306b\u5909\u66f4\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n\u5171\u901a\u306e\u8a2d\u5b9a\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\n\u552f\u4e00\u306eNIC\u3067\u3042\u308beth0\u3092\u6307\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta# set vpn ipsec ipsec-interfaces interface 'eth0'\n[edit]\n\n\n\nIKE\u306e\u8a2d\u5b9a\nIKE\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nIKE\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec ike-group AWS lifetime '28800'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 dh-group '2'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 hash 'sha1'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection action 'restart'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection interval '15'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection timeout '30'\n[edit]\n\n\n\nESP\u306e\u8a2d\u5b9a\nESP\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nESP\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec esp-group AWS compression 'disable'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS lifetime '3600'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS mode 'tunnel'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS pfs 'enable'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS proposal 1 hash 'sha1'\n[edit]\n\n\n\nBGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306f\u5168\u3066\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff080.0.0.0/0\uff09\u3092VPN\u306b\u5411\u3051\u308b\u3088\u3046\u306b\u5e83\u5831\u3059\u308b\u8a2d\u5b9a\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u3092\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306eVPC\u306e\u30a2\u30c9\u30ec\u30b9\uff08192.168.128.0/17\uff09\u3092\u5e83\u5831\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\n\u306a\u304avyatta\u304c\u6240\u5c5e\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\uff08192.168.128.0/24\uff09\u3060\u3051\u3092\u5e83\u5831\u3059\u308b\u306a\u3089\u3070\u4e0d\u8981\u306a\u306e\u3060\u304c\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evpc\u5168\u57df\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u3053\u3061\u3089\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u9759\u7684\u30eb\u30fc\u30c8\u3068next hop\u3082\u6307\u5b9a\u3059\u308b\u3002\n\nBGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 network 192.168.128.0/17\n[edit]\nvyatta@vyatta# set protocols static route 192.168.128.0/17 next-hop 192.168.128.1\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u8a2d\u5b9a\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u30c8\u30f3\u30cd\u30eb 1\u3078\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306flocal-adderss\u3068\u3057\u3066vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eElastic IP\uff0852.76.38.181\uff09\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u3092vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30e9\u4e00\u30d9\u30fc\u30c8IP\uff08192.168.128.10\uff09\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 ike-group 'AWS'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 local-address '192.168.128.10'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 vti bind 'vti0'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 vti esp-group 'AWS'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta# set interfaces vti vti0 address '169.254.252.42/30'\n[edit]\nvyatta@vyatta# set interfaces vti vti0 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta# set interfaces vti vti0 mtu '1436'\n[edit]\n\n\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u5bfe\u5411\u3068\u306a\u308bBGP\u30d4\u30a2\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 remote-as '10124'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 timers holdtime '30'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 timers keepalive '30'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb 2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u3068\u540c\u69d8\u3001local address\u306e\u5909\u66f4\u306b\u6ce8\u610f\u3057\u3066\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 ike-group 'AWS'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 local-address '192.168.128.10'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 vti bind 'vti1'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 vti esp-group 'AWS'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta# set interfaces vti vti1 address '169.254.252.46/30'\n[edit]\nvyatta@vyatta# set interfaces vti vti1 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta# set interfaces vti vti1 mtu '1436'\n[edit]\n\n\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 remote-as '10124'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 timers holdtime '30'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 timers keepalive '30'\n[edit]\n\n\n\n\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\n\u3053\u3053\u307e\u3067\u3067AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u78ba\u5b9a\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\nvyatta@vyatta# commit\n[edit]\nvyatta@vyatta# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n\n\n\nIPSec\u63a5\u7d9a\u306e\u78ba\u8a8d\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u304f\u3068\u3001IPSec\u63a5\u7d9a\u304c\u78ba\u7acb\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nike\u3068ipsec\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\nIPsec\u63a5\u7d9a\u306e\u78ba\u8a8d\nvyatta@vyatta# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          192.168.128.10                         \n\n    Description: VPC tunnel 1\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     800     28800  \n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          192.168.128.10                         \n\n    Description: VPC tunnel 2\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1041    28800  \n\n\n[edit]\nvyatta@vyatta# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          192.168.128.10                         \n\n    Description: VPC tunnel 1\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     1.4K/1.2K      aes128   sha1  no     1033    3600    all\n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          192.168.128.10                         \n\n    Description: VPC tunnel 2\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     1.6K/1.6K      aes128   sha1  no     708     3600    all\n\n\n[edit]\n\n\n\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u30a2\u30f3\u30ab\u30fc\u3059\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304cUP\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\nSoftLayer\u306evyatta\u8a2d\u5b9a\n\u6b21\u306bSoftLayer\u306evyatta\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u3067\u306e\u8a2d\u5b9a\u3060\u304c\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3067\u3082\u540c\u69d8\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nAWS\u3068\u540c\u69d8\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044\u3002\u5909\u66f4\u3059\u3079\u304d\u30dd\u30a4\u30f3\u30c8\u306f\u3001BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3068\u3001IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u304ceth0\u3067\u306f\u306a\u304feth1\u3067\u3042\u308b\u3053\u3068\u3002\n\n\u5171\u901a\u306e\u8a2d\u5b9a\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nSoftLayer\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u306b\u3064\u306a\u304c\u3063\u3066\u3044\u308bNIC\u306feth1\u306a\u306e\u3067\u3001IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306feth1\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nIPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec ipsec-interfaces interface 'eth1'\n[edit]\n\n\n\nIKE\u306e\u8a2d\u5b9a\nIKE\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nIKE\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS lifetime '28800'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 dh-group '2'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 hash 'sha1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection action 'restart'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection interval '15'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection timeout '30'\n[edit]\n\n\n\nESP\u306e\u8a2d\u5b9a\nESP\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS compression 'disable'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS lifetime '3600'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS mode 'tunnel'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS pfs 'enable'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS proposal 1 hash 'sha1'\n[edit]\n\n\n\nBGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nSoftLayer\u6771\u4eacDC\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\uff0810.132.182.64/26\uff09\u3092\u5e83\u5831\u3059\u308b\u3002SoftLayer\u306e\u5834\u5408\u3053\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u307f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308c\u3070\u826f\u3044\u306e\u3067\u3001\u660e\u793a\u7684\u306a\u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u306f\u4e0d\u8981\u3002\n\nBGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 network 10.132.182.64/26\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u8a2d\u5b9a\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u30c8\u30f3\u30cd\u30eb 1\u3078\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 ike-group 'AWS'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 local-address '161.202.114.70'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 vti bind 'vti0'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 vti esp-group 'AWS'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set interfaces vti vti0 address '169.254.252.26/30'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti0 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti0 mtu '1436'\n[edit]\n\n\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u5bfe\u5411\u3068\u306a\u308bBGP\u30d4\u30a2\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 remote-as '10124'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 timers holdtime '30'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 timers keepalive '30'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb 2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u3068\u540c\u69d8\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306f\u7121\u3044\u3002\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\n\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 ike-group 'AWS'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 local-address '161.202.114.70'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 vti bind 'vti1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 vti esp-group 'AWS'\n[edit]\n\n\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set interfaces vti vti1 address '169.254.252.30/30'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti1 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti1 mtu '1436'\n[edit]\n\n\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\nBGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 remote-as '10124'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 timers holdtime '30'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 timers keepalive '30'\n[edit]\n\n\n\n\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\n\n\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\nvyatta@vyatta-sl-tok# commit\n[edit]\nvyatta@vyatta-sl-tok# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n\n\n\nIPSec\u63a5\u7d9a\u306e\u78ba\u8a8d\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u3044\u305f\u5f8c\u3001IPSec\u63a5\u7d9a\u304c\u78ba\u7acb\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nSoftLayer\u6771\u4eacDC\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nike\u3068ipsec\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\nIPsec\u63a5\u7d9a\u306e\u78ba\u8a8d\nvyatta@vyatta-sl-tok# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          161.202.114.70                         \n\n    Description: VPC tunnel 1\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1185    28800  \n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          161.202.114.70                         \n\n    Description: VPC tunnel 2\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1161    28800  \n\n\n[edit]\nvyatta@vyatta-sl-tok# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          161.202.114.70                         \n\n    Description: VPC tunnel 1\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     3.2K/3.1K      aes128   sha1  no     1163    3600    all\n\n\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          161.202.114.70                         \n\n    Description: VPC tunnel 2\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     2.9K/3.2K      aes128   sha1  no     845     3600    all\n\n\n[edit]\n\n\n\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nSoftLayer\u6771\u4eacDC\u3092\u30a2\u30f3\u30ab\u30fc\u3059\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304cUP\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\u3053\u3053\u307e\u3067\u3067\u5404\u62e0\u70b9\u304cIPsec VPN\u3067\u63a5\u7d9a\u3055\u308c\u305f\u3002\u6b21\u306b\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\n\n\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306b\u3001\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002ap-northeast-1b\u306b192.168.10.0/24\u3001ap-northeast-1c\u306b192.168.11.0/24\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057VPC\u306b\u30a2\u30bf\u30c3\u30c1\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5074\u304b\u3089SSH\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3066VPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u30a2\u30bf\u30c3\u30c1\n\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u660e\u793a\u7684\u306b\u5404\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u95a2\u9023\u4ed8\u3051\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30010.0.0.0/0\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u307e\u305f\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u304b\u3089\u306e\u30eb\u30fc\u30c8\u4f1d\u9054\uff08route propagation\uff09\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n\u3053\u308c\u306b\u3088\u308a\u3001BGP\u306b\u3088\u3063\u3066\u4ea4\u63db\u3055\u308c\u305f\u30eb\u30fc\u30c8\u60c5\u5831\u304c\u81ea\u52d5\u7684\u306b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u767b\u9332\u3055\u308c\u308b\u3002\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4f5c\u6210\u3057\u305f\u4e8c\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u305d\u308c\u305e\u308c\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nap-northeast-1b\n\n\nami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-936d9d93\ntype: t2.micro\nIP\u30a2\u30c9\u30ec\u30b9: 192.168.10.10\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n\n\nSSH: 0.0.0.0/0\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n\n\nElastic IP: 52.68.111.129\n\n\nap-northeast-1c\n\n\nami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-936d9d93\ntype: t2.micro\nIP\u30a2\u30c9\u30ec\u30b9: 192.168.11.10\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n\n\nSSH: 0.0.0.0/0\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n\n\nElastic IP: 52.68.136.205\n\n\n\n\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\n\n\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306b\u3001\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002ap-sourceeast-1a\u306b192.168.210.0/24\u3001ap-southeast-1b\u306b192.168.211.0/24\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\u3068\u30a2\u30bf\u30c3\u30c1\n\u65b0\u305f\u306b\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001\u5404\u3005\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u95a2\u9023\u4ed8\u3051\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30010.0.0.0/0\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u307e\u305f\u3053\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u306fBGP\u306e\u30eb\u30fc\u30c8\u60c5\u5831\u3092\u81ea\u52d5\u7684\u306b\u53cd\u6620\u3067\u304d\u306a\u3044\u305f\u3081\u300110.0.0.0/8\u3068192.168.0.0/17\u3092vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306b\u632f\u308a\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3082\u8ffd\u52a0\u3059\u308b\u3002\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4f5c\u6210\u3057\u305f\u4e8c\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u305d\u308c\u305e\u308c\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nap-southeast-1a\n\n\nami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-96f1c1c4\ntype: t2.micro\nIP\u30a2\u30c9\u30ec\u30b9: 192.168.210.10\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n\n\nSSH: 0.0.0.0/0\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n\n\nElastic IP: 52.74.32.95\n\n\nap-southeast-1b\n\n\nami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-96f1c1c4\ntype: t2.micro\nIP\u30a2\u30c9\u30ec\u30b9: 192.168.211.10\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n\n\nSSH: 0.0.0.0/0\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n\u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n\n\nElastic IP: 52.76.54.224\n\n\n\n\nSoftLayer\u6771\u4eacDC\u3068\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u5404DC\u3067\u3001vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u540c\u3058\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u6240\u5c5e\u3059\u308b\u3088\u3046\u306b\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\nOS: Ubuntu 14.04 LTS (64 bit)\nCPU: 2.0GHz 1core\nRAM: 1GB RAM\n\n\n\u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\n\u6b8b\u5ff5\u306a\u304c\u3089\u3001SoftLayer\u306b\u306fvyatta\u306eBGP\u304b\u3089\u5f97\u305f\u30eb\u30fc\u30c8\u60c5\u5831\u3092\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u81ea\u52d5\u53cd\u6620\u3059\u308b\u4ed5\u7d44\u307f\u304c\u7121\u3044\u305f\u3081\u3001AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3088\u3046\u306b\u9759\u7684\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u6771\u4eacDC\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-tok-01:~# ip route add 192.168.0.0/16 via 10.132.182.81 dev eth0\n\n\n\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sng-01:~# ip route add 192.168.0.0/16 via 10.117.212.51 dev eth0\n\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u3001\u4e0b\u8a18\u306eIP\u30a2\u30c9\u30ec\u30b9\u3067\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u3002\n\n\n\n\u30af\u30e9\u30a6\u30c9\nAZ\u307e\u305f\u306fDC\n\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\n\n\n\n\nAWS\nap-northeast-1b\n52.68.111.129\n192.168.10.10\n\n\nAWS\nap-northeast-1c\n52.68.136.205\n192.168.11.10\n\n\nAWS\nap-southeast-1a\n52.74.32.95\n192.168.210.10\n\n\nAWS\nap-southeast-1b\n52.76.54.224\n192.168.211.10\n\n\nSoftLayer\n\u6771\u4eacDC\n161.202.114.72\n10.132.182.82\n\n\nSoftLayer\n\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\n161.202.24.89\n10.117.212.62\n\n\n\n\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078ping\u3092\u6253\u3064\u3053\u3068\u3067\u3001\u304a\u4e92\u3044\u304cL3\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u4ee5\u4e0b\u306fSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089\u306e\u4f8b\u3002\n\nSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089\u306eping\u7d50\u679c\nroot@test-sl-sng-01:~# ping -c 2 192.168.10.10\nPING 192.168.10.10 (192.168.10.10) 56(84) bytes of data.\n64 bytes from 192.168.10.10: icmp_seq=1 ttl=61 time=69.4 ms\n64 bytes from 192.168.10.10: icmp_seq=2 ttl=61 time=68.7 ms\n\n--- 192.168.10.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 68.763/69.111/69.459/0.348 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.11.10\nPING 192.168.11.10 (192.168.11.10) 56(84) bytes of data.\n64 bytes from 192.168.11.10: icmp_seq=1 ttl=61 time=71.7 ms\n64 bytes from 192.168.11.10: icmp_seq=2 ttl=61 time=71.5 ms\n\n--- 192.168.11.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 71.578/71.676/71.775/0.285 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.210.10\nPING 192.168.210.10 (192.168.210.10) 56(84) bytes of data.\n64 bytes from 192.168.210.10: icmp_seq=1 ttl=61 time=143 ms\n64 bytes from 192.168.210.10: icmp_seq=2 ttl=61 time=143 ms\n\n--- 192.168.210.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 143.378/143.380/143.382/0.002 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.211.10\nPING 192.168.211.10 (192.168.211.10) 56(84) bytes of data.\n64 bytes from 192.168.211.10: icmp_seq=1 ttl=61 time=144 ms\n64 bytes from 192.168.211.10: icmp_seq=2 ttl=61 time=144 ms\n\n--- 192.168.211.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 144.083/144.259/144.436/0.418 ms\nroot@test-sl-sng-01:~# ping -c 2 10.132.182.82\nPING 10.132.182.82 (10.132.182.82) 56(84) bytes of data.\n64 bytes from 10.132.182.82: icmp_seq=1 ttl=56 time=158 ms\n64 bytes from 10.132.182.82: icmp_seq=2 ttl=56 time=75.0 ms\n\n--- 10.132.182.82 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 75.059/116.531/158.003/41.472 ms\nroot@test-sl-sng-01:~# ping -c 2 10.117.212.62\nPING 10.117.212.62 (10.117.212.62) 56(84) bytes of data.\n64 bytes from 10.117.212.62: icmp_seq=1 ttl=64 time=0.022 ms\n64 bytes from 10.117.212.62: icmp_seq=2 ttl=64 time=0.015 ms\n\n--- 10.117.212.62 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 999ms\nrtt min/avg/max/mdev = 0.015/0.018/0.022/0.005 ms\n\n\n\u307e\u305fSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089tracepath\u3067\u78ba\u8a8d\u3057\u305f\u3068\u3053\u308d\u3001AWS\u6771\u4eac\u3068\u306f3\u30db\u30c3\u30d7\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u306f4\u30db\u30c3\u30d7\u3068\u3001IPsec VPN\u306e\u30c8\u30f3\u30cd\u30eb\u7d4c\u7531\u3067\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\u4e00\u65b9SoftLayer\u6771\u4eacDC\u304b\u3089\u3068\u306f9\u30db\u30c3\u30d7\u3092\u8981\u3057\u3066\u304a\u308a\u3001SoftLayer\u306e\u5185\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7d4c\u7531\u3057\u3066\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u63a8\u6e2c\u3055\u308c\u308b\u3002\nroot@test-sl-sng-01:~# tracepath 192.168.10.10\n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.51                                         0.981ms \n 1:  10.117.212.51                                         0.207ms \n 2:  10.117.212.51                                         0.514ms pmtu 1436\n 2:  no reply\n 3:  192.168.10.10                                        70.033ms reached\n     Resume: pmtu 1436 hops 3 back 4 \nroot@test-sl-sng-01:~# tracepath 192.168.210.10\n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.51                                         0.553ms \n 1:  10.117.212.51                                         0.466ms \n 2:  10.117.212.51                                         0.498ms pmtu 1436\n 2:  no reply\n 3:  no reply\n 4:  192.168.210.10                                      143.685ms reached\n     Resume: pmtu 1436 hops 4 back 4 \nroot@test-sl-sng-01:~# tracepath 10.132.182.82 \n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.3                                          1.068ms \n 1:  10.117.212.3                                          0.578ms \n 2:  no reply\n 3:  10.0.30.214                                           1.055ms \n 4:  no reply\n 5:  no reply\n 6:  no reply\n 7:  no reply\n 8:  no reply\n 9:  10.132.182.82                                        69.235ms reached\n     Resume: pmtu 1500 hops 9 back 9 \n\n\nCDP:CloudHub\u30d1\u30bf\u30fc\u30f3\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3068SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306f\u76f4\u63a5\u63a5\u7d9a\u3055\u308c\u308c\u3044\u306a\u3044\u304c\u3001\u5404\u62e0\u70b9\u304cBGP\u306b\u3088\u3063\u3066\u7d4c\u8def\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u7d4c\u7531\u3067\u901a\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3044\u308b\u3002\n\u3053\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001Cloud Design Pattern\u306eCloudHub\u30d1\u30bf\u30fc\u30f3\u306e\u4e00\u7a2e\u3068\u8a00\u3063\u3066\u3082\u826f\u3044\u3060\u308d\u3046\u3002\n\n\u307e\u3068\u3081\n\u3053\u306e\u624b\u9806\u304c\u300c\u7c21\u5358\u300d\u304b\u3068\u8a00\u3046\u3068\u7591\u554f\u304c\u6b8b\u308b\u304c\u3001\u3068\u3082\u3042\u308cAWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u3068vyatta\u3092\u7528\u3044\u3001\u5404\u62e0\u70b9\u306e\u7d4c\u8def\u60c5\u5831\u3092BGP\u3092\u7528\u3044\u3066\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001AWS\u3068SoftLayer\u306e\u591a\u62e0\u70b9\u9593IPsec VPN\u63a5\u7d9a\u304c\u78ba\u7acb\u3067\u304d\u305f\u3002\n[\u524d\u56de](http://qiita.com/nmatsui/items/18080372752651fc36ba)\u306fvyatta\u3092\u7528\u3044\u3066AWS VPC\u3068SoftLayer\u3092IPsec VPN\u3067\u63a5\u7d9a\u3057\u305f\u304c\u3001\u8a2d\u5b9a\u304c\u975e\u5e38\u306b\u7169\u96d1\u3060\u3063\u305f\u3002\n\n\u305d\u3053\u3067\u4eca\u56de\u306f\u3001AWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u3068vyatta\u3092\u7528\u3044\u3001\u5404\u62e0\u70b9\u306e\u7d4c\u8def\u60c5\u5831\u3092BGP\u3092\u7528\u3044\u3066\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001\u306a\u308b\u3079\u304f\u7c21\u5358\u306a\u624b\u9806\u3067AWS\u3068SoftLayer\u3092\u591a\u62e0\u70b9\u9593VPN\u63a5\u7d9a\u3059\u308b\u3002\n![aws_sl_vpn.png](https://qiita-image-store.s3.amazonaws.com/0/37648/c23d2e61-12e4-3735-2a17-dae12da79375.png)\n\n# SoftLayer\u3067vyatta\u8d77\u52d5\nSoftLayer\u306evyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3092\u78ba\u5b9a\u3059\u308b\u305f\u3081\u306b\u3001\u6700\u521d\u306bSoftLayer\u306e\u6771\u4eacDC\u3068\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3067vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* OS: Vyatta 6.6 Community Edision (64bit)\n* CPU: 2.0GHz 1core\n* RAM: 1GB RAM\n\n|DC|\u30d1\u30d6\u30ea\u30c3\u30afIP|\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8|\n|:--|:--|:--|:--|:--|\n|\u6771\u4eac|161.202.114.70|161.202.114.64/28|10.132.182.81|10.132.182.64/26|\n|\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb|161.202.24.85|161.202.24.80/28|10.117.212.51|10.117.212.0/26|\n\n# AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067Elastic IP\u78ba\u4fdd\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u7acb\u3061\u4e0a\u3052\u308b\u4e88\u5b9a\u306evyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306b\u3001\u4f7f\u7528\u7b87\u6240\u304cVPC\u306eElastic IP\u3092\u4e00\u3064\u78ba\u4fdd\u3059\u308b\u3002\n\n\u4eca\u56de\u306f**52.76.38.181**\u304c\u78ba\u4fdd\u3055\u308c\u305f\u3002\n\n# AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u63a5\u7d9a\u3092\u7acb\u3061\u4e0a\u3052\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067VPC\u3092\u4f5c\u6210\u3057\u3066\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u5272\u308a\u5f53\u3066\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3001SoftLayer\u6771\u4eacDC\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3068\u306eVPN\u63a5\u7d9a\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n## VPC\u4f5c\u6210\nVPC\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f**192.168.0.0/17**\u3068\u3059\u308b\u3002\n\n![aws_softlayer_vpn01.png](https://qiita-image-store.s3.amazonaws.com/0/37648/1249d385-89b3-f7a4-b2b6-b9c98e909b85.png)\n\n## \u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u5272\u308a\u5f53\u3066\n\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n![aws_softlayer_vpn02.png](https://qiita-image-store.s3.amazonaws.com/0/37648/0ad83306-27b7-40eb-75c9-2b908e640de5.png)\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fVPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n![aws_softlayer_vpn03.png](https://qiita-image-store.s3.amazonaws.com/0/37648/c9ad7202-78e5-71c1-7af7-2dbe6de6f0f3.png)\n\n## \u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u4f5c\u6210\nVPN\u63a5\u7d9a\u5148\u306e\u30a2\u30f3\u30ab\u30fc\u3068\u306a\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u3001SoftLayer\u6771\u4eacDC\u3001SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306e3\u62e0\u70b9\u5206\u4f5c\u6210\u3059\u308b\u3002BGP\u306b\u3088\u308b\u52d5\u7684\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3046\u304c\u3001AS\u756a\u53f7\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u9818\u57df\uff0864512\uff5e65535\uff09\u304b\u3089\u91cd\u8907\u305b\u305a\u306b\u9078\u3076\u3002\n\n|\u62e0\u70b9|\u30d1\u30d6\u30ea\u30c3\u30afIP|AS\u756a\u53f7|\n|:--|:--|:--|\n|SoftLayer\u6771\u4eacDC|161.202.114.70|65001|\n|SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC|161.202.24.85|65002|\n|AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3|52.76.38.181|65003|\n\n\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u7528\u306e\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f8b\u3002\n\n![aws_softlayer_vpn04.png](https://qiita-image-store.s3.amazonaws.com/0/37648/b71d11b7-a8ab-7d88-29f8-02110124ce8b.png)\n\n## VPN\u63a5\u7d9a\u306e\u7acb\u3061\u4e0a\u3052\n\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\uff13\u3064\u306e\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u7d50\u3073\u3064\u3051\u3066\u3001AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u4e2d\u5fc3\u3068\u3057\u305f3\u3064\u306eVPN\u63a5\u7d9a\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u3068\u306eVPN\u63a5\u7d9a\u306e\u4f8b\u3002\n\n![aws_softlayer_vpn05.png](https://qiita-image-store.s3.amazonaws.com/0/37648/1ae53b59-5d7b-51af-de95-d3f46a64c168.png)\n\nAWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u306f\u6700\u521d\u304b\u3089\u5197\u9577\u5316\u3055\u308c\u3066\u304a\u308a\u3001VPN\u30c8\u30f3\u30cd\u30eb\u306f\u81ea\u52d5\u7684\u306b\u4e8c\u3064\u4f5c\u6210\u3055\u308c\u308b\u3002\u305f\u3060\u3057\u3053\u306e\u6bb5\u968e\u3067\u306f\u5bfe\u5411\u306eVPN\u30eb\u30fc\u30bf\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u3001VPN\u30c8\u30f3\u30cd\u30eb\u306fDOWN\u3057\u305f\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n![aws_softlayer_vpn06.png](https://qiita-image-store.s3.amazonaws.com/0/37648/693c4399-c820-e216-9db2-b04a2e335da2.png)\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u5404VPN\u63a5\u7d9a\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u3001vyatta\u306e\u30b3\u30de\u30f3\u30c9\u5f62\u5f0f\u3067\u305d\u308c\u305e\u308c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n![aws_softlayer_vpn07.png](https://qiita-image-store.s3.amazonaws.com/0/37648/07d14f6c-b58b-d685-36c5-2e69badf9d10.png)\n\n# AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067vyatta\u8d77\u52d5\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3067VPC\u3068\u30d1\u30d6\u30ea\u30c3\u30af\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3001vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u78ba\u4fdd\u3057\u3066\u304a\u3044\u305fElastic IP\u3092\u5272\u308a\u5f53\u3066\u308b\u3002\n\n## VPC\u4f5c\u6210\nVPC\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f**192.168.128.0/17**\u3068\u3059\u308b\u3002\n\n![aws_softlayer_vpn08.png](https://qiita-image-store.s3.amazonaws.com/0/37648/64b12f62-cd5f-e33d-c2e6-62312af08478.png)\n\n## \u30b5\u30d6\u30cd\u30c3\u30c8\u4f5c\u6210\n\u5148\u307b\u3069\u4f5c\u3063\u305fVPC\u5185\u306eap-southeast-1a\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002CIDR\u306f**192.168.128.0/24**\u3068\u3059\u308b\u3002\n\n![aws_softlayer_vpn09.png](https://qiita-image-store.s3.amazonaws.com/0/37648/0d7650f2-8144-ed1c-75fe-dbd3a051b665.png)\n\n## \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u4f5c\u6210\u3068\u30a2\u30bf\u30c3\u30c1\n\u5148\u307b\u3069\u4f5c\u3063\u305fVPC\u5185\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3001VPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n![aws_softlayer_vpn10.png](https://qiita-image-store.s3.amazonaws.com/0/37648/a80efcba-d80b-3875-3b87-761958ccb6b9.png)\n\n![aws_softlayer_vpn11.png](https://qiita-image-store.s3.amazonaws.com/0/37648/fe386aa9-0615-5b9c-bff5-95b757592507.png)\n\n## \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u3001**0.0.0.0/0**\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n![aws_softlayer_vpn12.png](https://qiita-image-store.s3.amazonaws.com/0/37648/db243247-0c51-fa2f-293f-a63e7facc403.png)\n\n## vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* ami: Vyatta Core 6.6 R1 x86_64 rev1 - ami-d2b0ff80\n* type: t1.micro\n* IP\u30a2\u30c9\u30ec\u30b9: **192.168.128.10**\n\n![aws_softlayer_vpn13.png](https://qiita-image-store.s3.amazonaws.com/0/37648/309bb3db-0a1c-f645-c3f7-20de9fd7e3a9.png)\n\n### \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u4f5c\u6210\u3057\u305fVPN\u63a5\u7d9a\u306e\u30c8\u30f3\u30cd\u30eb\u7aef\u70b9\u306eIP\u30a2\u30c9\u30ec\u30b9\uff08**103.246.151.29**\u3068**103.246.151.39**\uff09\u304b\u3089\u306eESP\uff08IP\u30d7\u30ed\u30c8\u30b3\u30eb50\uff09\u3068IKE\uff08UDP\u30dd\u30fc\u30c8500\uff09\u3092\u53d7\u3051\u5165\u308c\u308b\u3002\u307e\u305fAWS\u3068SoftLayer\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3082\u53d7\u3051\u5165\u308c\u308b\u3002\n\n![aws_softlayer_vpn14.png](https://qiita-image-store.s3.amazonaws.com/0/37648/c6b93594-31f4-41a2-6cea-e0ee47d8e3a0.png)\n\n## ENI\u306e\u8a2d\u5b9a\u5909\u66f4\n\u4f5c\u6210\u3057\u305fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306e\u300c\u9001\u4fe1\u5143/\u9001\u4fe1\u5148\u306e\u5909\u66f4\u30c1\u30a7\u30c3\u30af\u300d\u3092\u7121\u52b9\u5316\u3057\u3001\u30d1\u30b1\u30c3\u30c8\u3092\u8ee2\u9001\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n![aws_softlayer_vpn15.png](https://qiita-image-store.s3.amazonaws.com/0/37648/d6023d6b-5983-0c73-e0e7-09437b8d0436.png)\n\n![aws_softlayer_vpn16.png](https://qiita-image-store.s3.amazonaws.com/0/37648/1ea07181-1282-0e04-bd03-4f8782fc9c89.png)\n\n## Elastic IP\u5272\u308a\u5f53\u3066\n\u78ba\u4fdd\u3057\u3066\u304a\u3044\u305fElastic IP\u3092\u7acb\u3061\u4e0a\u3052\u305fvyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306b\u5272\u308a\u5f53\u3066\u308b\u3002\n\n![aws_softlayer_vpn17.png](https://qiita-image-store.s3.amazonaws.com/0/37648/285e8e2d-47e7-febf-ca26-98622eca00a8.png)\n\n# AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u8a2d\u5b9a\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fvyatta\u7528\u8a2d\u5b9a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5143\u306b\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u305f\u3060\u3057\u3001**\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044**\u3002BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3001\u53ca\u3073\u5404\u30c8\u30f3\u30cd\u30eb\u3092\u30d4\u30a2\u30ea\u30f3\u30b0\u3059\u308blocal address\u3092\u9069\u5207\u306b\u5909\u66f4\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n## \u5171\u901a\u306e\u8a2d\u5b9a\n### IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\n\u552f\u4e00\u306eNIC\u3067\u3042\u308beth0\u3092\u6307\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta# set vpn ipsec ipsec-interfaces interface 'eth0'\n[edit]\n```\n\n### IKE\u306e\u8a2d\u5b9a\nIKE\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:IKE\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec ike-group AWS lifetime '28800'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 dh-group '2'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS proposal 1 hash 'sha1'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection action 'restart'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection interval '15'\n[edit]\nvyatta@vyatta# set vpn ipsec ike-group AWS dead-peer-detection timeout '30'\n[edit]\n```\n\n### ESP\u306e\u8a2d\u5b9a\nESP\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec esp-group AWS compression 'disable'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS lifetime '3600'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS mode 'tunnel'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS pfs 'enable'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta# set vpn ipsec esp-group AWS proposal 1 hash 'sha1'\n[edit]\n```\n\n### BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306f\u5168\u3066\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff080.0.0.0/0\uff09\u3092VPN\u306b\u5411\u3051\u308b\u3088\u3046\u306b\u5e83\u5831\u3059\u308b\u8a2d\u5b9a\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u3092\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306eVPC\u306e\u30a2\u30c9\u30ec\u30b9\uff08**192.168.128.0/17**\uff09\u3092\u5e83\u5831\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u3002\n\n\u306a\u304avyatta\u304c\u6240\u5c5e\u3059\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\uff08**192.168.128.0/24**\uff09\u3060\u3051\u3092\u5e83\u5831\u3059\u308b\u306a\u3089\u3070\u4e0d\u8981\u306a\u306e\u3060\u304c\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evpc\u5168\u57df\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u3053\u3061\u3089\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3055\u305b\u305f\u3044\u306e\u3067\u3001\u9759\u7684\u30eb\u30fc\u30c8\u3068next hop\u3082\u6307\u5b9a\u3059\u308b\u3002\n\n```text:BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 network 192.168.128.0/17\n[edit]\nvyatta@vyatta# set protocols static route 192.168.128.0/17 next-hop 192.168.128.1\n[edit]\n```\n\n## \u30c8\u30f3\u30cd\u30eb 1\u306e\u8a2d\u5b9a\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u30c8\u30f3\u30cd\u30eb 1\u3078\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306flocal-adderss\u3068\u3057\u3066vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eElastic IP\uff08**52.76.38.181**\uff09\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u3092vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30d7\u30e9\u4e00\u30d9\u30fc\u30c8IP\uff08**192.168.128.10**\uff09\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\n\n```text:\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 ike-group 'AWS'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 local-address '192.168.128.10'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 vti bind 'vti0'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.29 vti esp-group 'AWS'\n[edit]\n```\n\n### \u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta# set interfaces vti vti0 address '169.254.252.42/30'\n[edit]\nvyatta@vyatta# set interfaces vti vti0 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta# set interfaces vti vti0 mtu '1436'\n[edit]\n```\n\n### BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u5bfe\u5411\u3068\u306a\u308bBGP\u30d4\u30a2\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 remote-as '10124'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 timers holdtime '30'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.41 timers keepalive '30'\n[edit]\n```\n\n## \u30c8\u30f3\u30cd\u30eb 2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u3068\u540c\u69d8\u3001local address\u306e\u5909\u66f4\u306b\u6ce8\u610f\u3057\u3066\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\n```text:\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 ike-group 'AWS'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 local-address '192.168.128.10'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 vti bind 'vti1'\n[edit]\nvyatta@vyatta# set vpn ipsec site-to-site peer 103.246.151.39 vti esp-group 'AWS'\n[edit]\n```\n\n### \u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n```text:\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta# set interfaces vti vti1 address '169.254.252.46/30'\n[edit]\nvyatta@vyatta# set interfaces vti vti1 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta# set interfaces vti vti1 mtu '1436'\n[edit]\n```\n\n### BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\n```text:BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 remote-as '10124'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 timers holdtime '30'\n[edit]\nvyatta@vyatta# set protocols bgp 65003 neighbor 169.254.252.45 timers keepalive '30'\n[edit]\n```\n\n## \u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\n\u3053\u3053\u307e\u3067\u3067AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306evyatta\u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u78ba\u5b9a\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n```text:\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\nvyatta@vyatta# commit\n[edit]\nvyatta@vyatta# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n```\n\n## IPSec\u63a5\u7d9a\u306e\u78ba\u8a8d\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u304f\u3068\u3001IPSec\u63a5\u7d9a\u304c\u78ba\u7acb\u3057\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n### AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nike\u3068ipsec\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```text:IPsec\u63a5\u7d9a\u306e\u78ba\u8a8d\nvyatta@vyatta# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          192.168.128.10                         \n\n    Description: VPC tunnel 1\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     800     28800  \n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          192.168.128.10                         \n\n    Description: VPC tunnel 2\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1041    28800  \n\n \n[edit]\nvyatta@vyatta# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          192.168.128.10                         \n\n    Description: VPC tunnel 1\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     1.4K/1.2K      aes128   sha1  no     1033    3600    all\n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          192.168.128.10                         \n\n    Description: VPC tunnel 2\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     1.6K/1.6K      aes128   sha1  no     708     3600    all\n\n \n[edit]\n```\n\n### AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u30a2\u30f3\u30ab\u30fc\u3059\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304cUP\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n![aws_softlayer_vpn18.png](https://qiita-image-store.s3.amazonaws.com/0/37648/07704521-4c5d-65cb-0354-16ed884e5e32.png)\n\n# SoftLayer\u306evyatta\u8a2d\u5b9a\n\u6b21\u306bSoftLayer\u306evyatta\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u4ee5\u4e0b\u306fSoftLayer\u6771\u4eacDC\u3067\u306e\u8a2d\u5b9a\u3060\u304c\u3001\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u3067\u3082\u540c\u69d8\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\nAWS\u3068\u540c\u69d8\u3001**\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044**\u3002\u5909\u66f4\u3059\u3079\u304d\u30dd\u30a4\u30f3\u30c8\u306f\u3001BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3068\u3001IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u304ceth0\u3067\u306f\u306a\u304feth1\u3067\u3042\u308b\u3053\u3068\u3002\n\n## \u5171\u901a\u306e\u8a2d\u5b9a\n### IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nSoftLayer\u306e\u30d1\u30d6\u30ea\u30c3\u30af\u306b\u3064\u306a\u304c\u3063\u3066\u3044\u308bNIC\u306feth1\u306a\u306e\u3067\u3001IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306feth1\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```text:IPsec\u3092\u8a2d\u5b9a\u3059\u308bNIC\u306e\u6307\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec ipsec-interfaces interface 'eth1'\n[edit]\n```\n\n### IKE\u306e\u8a2d\u5b9a\nIKE\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:IKE\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS lifetime '28800'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 dh-group '2'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS proposal 1 hash 'sha1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection action 'restart'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection interval '15'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec ike-group AWS dead-peer-detection timeout '30'\n[edit]\n```\n\n### ESP\u306e\u8a2d\u5b9a\nESP\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:ESP\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS compression 'disable'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS lifetime '3600'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS mode 'tunnel'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS pfs 'enable'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS proposal 1 encryption 'aes128'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec esp-group AWS proposal 1 hash 'sha1'\n[edit]\n```\n\n### BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nSoftLayer\u6771\u4eacDC\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\uff08**10.132.182.64/26**\uff09\u3092\u5e83\u5831\u3059\u308b\u3002SoftLayer\u306e\u5834\u5408\u3053\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u307f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308c\u3070\u826f\u3044\u306e\u3067\u3001\u660e\u793a\u7684\u306a\u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u306f\u4e0d\u8981\u3002\n\n```text:BGP\u3067\u5e83\u5831\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 network 10.132.182.64/26\n[edit]\n```\n\n## \u30c8\u30f3\u30cd\u30eb 1\u306e\u8a2d\u5b9a\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nAWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3 \u30c8\u30f3\u30cd\u30eb 1\u3078\u306e\u30d4\u30a2\u30ea\u30f3\u30b0\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 ike-group 'AWS'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 local-address '161.202.114.70'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 vti bind 'vti0'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.29 vti esp-group 'AWS'\n[edit]\n```\n\n### \u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set interfaces vti vti0 address '169.254.252.26/30'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti0 description 'VPC tunnel 1'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti0 mtu '1436'\n[edit]\n```\n\n### BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u306e\u5bfe\u5411\u3068\u306a\u308bBGP\u30d4\u30a2\u3092\u8a2d\u5b9a\u3059\u308b\uff08\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306a\u3057\uff09\u3002\n\n```text:BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 remote-as '10124'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 timers holdtime '30'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.25 timers keepalive '30'\n[edit]\n```\n\n## \u30c8\u30f3\u30cd\u30eb 2\u306e\u8a2d\u5b9a\n\u30c8\u30f3\u30cd\u30eb 1\u3068\u540c\u69d8\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u5909\u66f4\u70b9\u306f\u7121\u3044\u3002\n\n### \u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\n\n```text:\u30d4\u30a2\u30ea\u30f3\u30b0\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 authentication mode 'pre-shared-secret'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 authentication pre-shared-secret <\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u79d8\u5bc6\u306e\u9375>\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 ike-group 'AWS'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 local-address '161.202.114.70'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 vti bind 'vti1'\n[edit]\nvyatta@vyatta-sl-tok# set vpn ipsec site-to-site peer 103.246.151.39 vti esp-group 'AWS'\n[edit]\n```\n\n### \u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\n\n```text:\u30c8\u30f3\u30cd\u30eb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set interfaces vti vti1 address '169.254.252.30/30'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti1 description 'VPC tunnel 2'\n[edit]\nvyatta@vyatta-sl-tok# set interfaces vti vti1 mtu '1436'\n[edit]\n```\n\n### BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\n\n```text:BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 remote-as '10124'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 soft-reconfiguration 'inbound'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 timers holdtime '30'\n[edit]\nvyatta@vyatta-sl-tok# set protocols bgp 65001 neighbor 169.254.252.29 timers keepalive '30'\n[edit]\n```\n\n## \u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\n\n```text:\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u4fdd\u5b58\nvyatta@vyatta-sl-tok# commit\n[edit]\nvyatta@vyatta-sl-tok# save\nSaving configuration to '/config/config.boot'...\nDone\n[edit]\n```\n\n## IPSec\u63a5\u7d9a\u306e\u78ba\u8a8d\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u3044\u305f\u5f8c\u3001IPSec\u63a5\u7d9a\u304c\u78ba\u7acb\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n### SoftLayer\u6771\u4eacDC\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nike\u3068ipsec\u304cup\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```text:IPsec\u63a5\u7d9a\u306e\u78ba\u8a8d\nvyatta@vyatta-sl-tok# run show vpn ike sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          161.202.114.70                         \n\n    Description: VPC tunnel 1\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1185    28800  \n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          161.202.114.70                         \n\n    Description: VPC tunnel 2\n\n    State  Encrypt  Hash  D-H Grp  NAT-T  A-Time  L-Time\n    -----  -------  ----  -------  -----  ------  ------\n    up     aes128   sha1  2        no     1161    28800  \n\n \n[edit]\nvyatta@vyatta-sl-tok# run show vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.29                          161.202.114.70                         \n\n    Description: VPC tunnel 1\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     3.2K/3.1K      aes128   sha1  no     1163    3600    all\n\n \nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n103.246.151.39                          161.202.114.70                         \n\n    Description: VPC tunnel 2\n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash  NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----  -----  ------  ------  -----\n    vti     up     2.9K/3.2K      aes128   sha1  no     845     3600    all\n\n \n[edit]\n```\n\n### AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306eIPsec VPN\u63a5\u7d9a\u306e\u72b6\u614b\nSoftLayer\u6771\u4eacDC\u3092\u30a2\u30f3\u30ab\u30fc\u3059\u308b\u30ab\u30b9\u30bf\u30de\u30fc\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304cUP\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n![aws_softlayer_vpn19.png](https://qiita-image-store.s3.amazonaws.com/0/37648/c53be945-62d4-76a1-8b45-f87144fb0a04.png)\n\n# \u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\u3053\u3053\u307e\u3067\u3067\u5404\u62e0\u70b9\u304cIPsec VPN\u3067\u63a5\u7d9a\u3055\u308c\u305f\u3002\u6b21\u306b\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n## AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\n### \u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306b\u3001\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002ap-northeast-1b\u306b**192.168.10.0/24**\u3001ap-northeast-1c\u306b**192.168.11.0/24**\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n### \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057VPC\u306b\u30a2\u30bf\u30c3\u30c1\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5074\u304b\u3089SSH\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u4f5c\u6210\u3057\u3066VPC\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n### \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u30a2\u30bf\u30c3\u30c1\n\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u660e\u793a\u7684\u306b\u5404\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n![aws_softlayer_vpn20.png](https://qiita-image-store.s3.amazonaws.com/0/37648/1051bfcc-6cb9-478d-f66b-a3063811a017.png)\n\n### \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u95a2\u9023\u4ed8\u3051\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30010.0.0.0/0\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n![aws_softlayer_vpn21.png](https://qiita-image-store.s3.amazonaws.com/0/37648/b3722d65-8da4-6d66-b18e-a1a94dbace1f.png)\n\n\u307e\u305f\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u304b\u3089\u306e\u30eb\u30fc\u30c8\u4f1d\u9054\uff08route propagation\uff09\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n![aws_softlayer_vpn22.png](https://qiita-image-store.s3.amazonaws.com/0/37648/7afada30-3902-f822-a487-665f7b1c90e8.png)\n\n\u3053\u308c\u306b\u3088\u308a\u3001BGP\u306b\u3088\u3063\u3066\u4ea4\u63db\u3055\u308c\u305f\u30eb\u30fc\u30c8\u60c5\u5831\u304c\u81ea\u52d5\u7684\u306b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u767b\u9332\u3055\u308c\u308b\u3002\n\n![aws_softlayer_vpn23.png](https://qiita-image-store.s3.amazonaws.com/0/37648/a3753615-d21d-2274-103c-8c741bac1ce8.png)\n\n### \u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4f5c\u6210\u3057\u305f\u4e8c\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u305d\u308c\u305e\u308c\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* ap-northeast-1b\n    * ami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-936d9d93\n    * type: t2.micro\n    * IP\u30a2\u30c9\u30ec\u30b9: **192.168.10.10**\n    * \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n        * SSH: 0.0.0.0/0\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n    * Elastic IP: 52.68.111.129\n* ap-northeast-1c\n    * ami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-936d9d93\n    * type: t2.micro\n    * IP\u30a2\u30c9\u30ec\u30b9: **192.168.11.10**\n    * \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n        * SSH: 0.0.0.0/0\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n    * Elastic IP: 52.68.136.205\n\n## AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\n### \u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u4f5c\u6210\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u306b\u3001\u7570\u306a\u308bAZ\u3067\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002ap-sourceeast-1a\u306b**192.168.210.0/24**\u3001ap-southeast-1b\u306b**192.168.211.0/24**\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n### \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\u3068\u30a2\u30bf\u30c3\u30c1\n\u65b0\u305f\u306b\u4f5c\u6210\u3057\u305f\u30b5\u30d6\u30cd\u30c3\u30c8\u7528\u306b\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001\u5404\u3005\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3002\n\n![aws_softlayer_vpn24.png](https://qiita-image-store.s3.amazonaws.com/0/37648/511284f2-2add-9166-d6aa-0f568dbbdd65.png)\n\n![aws_softlayer_vpn25.png](https://qiita-image-store.s3.amazonaws.com/0/37648/7590b38c-4670-b897-3c00-81b373126c75.png)\n\n### \u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u95a2\u9023\u4ed8\u3051\u305f\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u30010.0.0.0/0\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u307e\u305f\u3053\u306e\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u306fBGP\u306e\u30eb\u30fc\u30c8\u60c5\u5831\u3092\u81ea\u52d5\u7684\u306b\u53cd\u6620\u3067\u304d\u306a\u3044\u305f\u3081\u300110.0.0.0/8\u3068192.168.0.0/17\u3092vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eENI\u306b\u632f\u308a\u5411\u3051\u308b\u30a8\u30f3\u30c8\u30ea\u3082\u8ffd\u52a0\u3059\u308b\u3002\n\n![aws_softlayer_vpn26.png](https://qiita-image-store.s3.amazonaws.com/0/37648/222df6a0-46a1-b000-e490-105278498125.png)\n\n### \u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u4f5c\u6210\u3057\u305f\u4e8c\u3064\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u305d\u308c\u305e\u308c\u306b\u3001\u4ee5\u4e0b\u306e\u30b9\u30da\u30c3\u30af\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* ap-southeast-1a\n    * ami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-96f1c1c4\n    * type: t2.micro\n    * IP\u30a2\u30c9\u30ec\u30b9: **192.168.210.10**\n    * \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n        * SSH: 0.0.0.0/0\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n    * Elastic IP: 52.74.32.95\n* ap-southeast-1b\n    * ami: ubuntu/images/hvm-ssd/ubuntu-trusty-14.04-amd64-server-20150325 - ami-96f1c1c4\n    * type: t2.micro\n    * IP\u30a2\u30c9\u30ec\u30b9: **192.168.211.10**\n    * \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: \n        * SSH: 0.0.0.0/0\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 10.0.0.0/8\n        * \u5168\u3066\u306e\u30c8\u30e9\u30d5\u30a3\u30c3\u30af: 192.168.0.0/16\n    * Elastic IP: 52.76.54.224\n\n## SoftLayer\u6771\u4eacDC\u3068\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\n### \u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\n\u5404DC\u3067\u3001vyatta\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u540c\u3058\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u6240\u5c5e\u3059\u308b\u3088\u3046\u306b\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\n* OS: Ubuntu 14.04 LTS (64 bit)\n* CPU: 2.0GHz 1core\n* RAM: 1GB RAM\n\n### \u9759\u7684\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\n\u6b8b\u5ff5\u306a\u304c\u3089\u3001SoftLayer\u306b\u306fvyatta\u306eBGP\u304b\u3089\u5f97\u305f\u30eb\u30fc\u30c8\u60c5\u5831\u3092\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u81ea\u52d5\u53cd\u6620\u3059\u308b\u4ed5\u7d44\u307f\u304c\u7121\u3044\u305f\u3081\u3001AWS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u5b9b\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u3001vyatta\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3059\u308b\u3088\u3046\u306b\u9759\u7684\u30eb\u30fc\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```text:\u6771\u4eacDC\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-tok-01:~# ip route add 192.168.0.0/16 via 10.132.182.81 dev eth0\n```\n\n```text:\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u9759\u7684\u30eb\u30fc\u30c8\u8ffd\u52a0\nroot@test-sl-sng-01:~# ip route add 192.168.0.0/16 via 10.117.212.51 dev eth0\n```\n\n# \u63a5\u7d9a\u30c6\u30b9\u30c8\n\u63a5\u7d9a\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u3001\u4e0b\u8a18\u306eIP\u30a2\u30c9\u30ec\u30b9\u3067\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u3002\n\n|\u30af\u30e9\u30a6\u30c9|AZ\u307e\u305f\u306fDC|\u30d1\u30d6\u30ea\u30c3\u30afIP|\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP|\n|:--|:--|:--|:--|\n|AWS|ap-northeast-1b|52.68.111.129|192.168.10.10|\n|AWS|ap-northeast-1c|52.68.136.205|192.168.11.10|\n|AWS|ap-southeast-1a|52.74.32.95|192.168.210.10|\n|AWS|ap-southeast-1b|52.76.54.224|192.168.211.10|\n|SoftLayer|\u6771\u4eacDC|161.202.114.72|10.132.182.82|\n|SoftLayer|\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC|161.202.24.89|10.117.212.62|\n\n\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u5225\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078ping\u3092\u6253\u3064\u3053\u3068\u3067\u3001\u304a\u4e92\u3044\u304cL3\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\u4ee5\u4e0b\u306fSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089\u306e\u4f8b\u3002\n\n```text:SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089\u306eping\u7d50\u679c\nroot@test-sl-sng-01:~# ping -c 2 192.168.10.10\nPING 192.168.10.10 (192.168.10.10) 56(84) bytes of data.\n64 bytes from 192.168.10.10: icmp_seq=1 ttl=61 time=69.4 ms\n64 bytes from 192.168.10.10: icmp_seq=2 ttl=61 time=68.7 ms\n\n--- 192.168.10.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 68.763/69.111/69.459/0.348 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.11.10\nPING 192.168.11.10 (192.168.11.10) 56(84) bytes of data.\n64 bytes from 192.168.11.10: icmp_seq=1 ttl=61 time=71.7 ms\n64 bytes from 192.168.11.10: icmp_seq=2 ttl=61 time=71.5 ms\n\n--- 192.168.11.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 71.578/71.676/71.775/0.285 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.210.10\nPING 192.168.210.10 (192.168.210.10) 56(84) bytes of data.\n64 bytes from 192.168.210.10: icmp_seq=1 ttl=61 time=143 ms\n64 bytes from 192.168.210.10: icmp_seq=2 ttl=61 time=143 ms\n\n--- 192.168.210.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 143.378/143.380/143.382/0.002 ms\nroot@test-sl-sng-01:~# ping -c 2 192.168.211.10\nPING 192.168.211.10 (192.168.211.10) 56(84) bytes of data.\n64 bytes from 192.168.211.10: icmp_seq=1 ttl=61 time=144 ms\n64 bytes from 192.168.211.10: icmp_seq=2 ttl=61 time=144 ms\n\n--- 192.168.211.10 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1000ms\nrtt min/avg/max/mdev = 144.083/144.259/144.436/0.418 ms\nroot@test-sl-sng-01:~# ping -c 2 10.132.182.82\nPING 10.132.182.82 (10.132.182.82) 56(84) bytes of data.\n64 bytes from 10.132.182.82: icmp_seq=1 ttl=56 time=158 ms\n64 bytes from 10.132.182.82: icmp_seq=2 ttl=56 time=75.0 ms\n\n--- 10.132.182.82 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1001ms\nrtt min/avg/max/mdev = 75.059/116.531/158.003/41.472 ms\nroot@test-sl-sng-01:~# ping -c 2 10.117.212.62\nPING 10.117.212.62 (10.117.212.62) 56(84) bytes of data.\n64 bytes from 10.117.212.62: icmp_seq=1 ttl=64 time=0.022 ms\n64 bytes from 10.117.212.62: icmp_seq=2 ttl=64 time=0.015 ms\n\n--- 10.117.212.62 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 999ms\nrtt min/avg/max/mdev = 0.015/0.018/0.022/0.005 ms\n```\n\n\u307e\u305fSoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u304b\u3089tracepath\u3067\u78ba\u8a8d\u3057\u305f\u3068\u3053\u308d\u3001AWS\u6771\u4eac\u3068\u306f3\u30db\u30c3\u30d7\u3001AWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u3068\u306f4\u30db\u30c3\u30d7\u3068\u3001IPsec VPN\u306e\u30c8\u30f3\u30cd\u30eb\u7d4c\u7531\u3067\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\u4e00\u65b9SoftLayer\u6771\u4eacDC\u304b\u3089\u3068\u306f9\u30db\u30c3\u30d7\u3092\u8981\u3057\u3066\u304a\u308a\u3001SoftLayer\u306e\u5185\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7d4c\u7531\u3057\u3066\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u63a8\u6e2c\u3055\u308c\u308b\u3002\n\n```\nroot@test-sl-sng-01:~# tracepath 192.168.10.10\n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.51                                         0.981ms \n 1:  10.117.212.51                                         0.207ms \n 2:  10.117.212.51                                         0.514ms pmtu 1436\n 2:  no reply\n 3:  192.168.10.10                                        70.033ms reached\n     Resume: pmtu 1436 hops 3 back 4 \nroot@test-sl-sng-01:~# tracepath 192.168.210.10\n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.51                                         0.553ms \n 1:  10.117.212.51                                         0.466ms \n 2:  10.117.212.51                                         0.498ms pmtu 1436\n 2:  no reply\n 3:  no reply\n 4:  192.168.210.10                                      143.685ms reached\n     Resume: pmtu 1436 hops 4 back 4 \nroot@test-sl-sng-01:~# tracepath 10.132.182.82 \n 1?: [LOCALHOST]                                         pmtu 1500\n 1:  10.117.212.3                                          1.068ms \n 1:  10.117.212.3                                          0.578ms \n 2:  no reply\n 3:  10.0.30.214                                           1.055ms \n 4:  no reply\n 5:  no reply\n 6:  no reply\n 7:  no reply\n 8:  no reply\n 9:  10.132.182.82                                        69.235ms reached\n     Resume: pmtu 1500 hops 9 back 9 \n```\n\n## CDP:CloudHub\u30d1\u30bf\u30fc\u30f3\nAWS\u30b7\u30f3\u30ac\u30dd\u30fc\u30eb\u30ea\u30fc\u30b8\u30e7\u30f3\u3068SoftLayer\u30b7\u30f3\u30ac\u30dd\u30fc\u30ebDC\u306f\u76f4\u63a5\u63a5\u7d9a\u3055\u308c\u308c\u3044\u306a\u3044\u304c\u3001\u5404\u62e0\u70b9\u304cBGP\u306b\u3088\u3063\u3066\u7d4c\u8def\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001AWS\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u7d4c\u7531\u3067\u901a\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3044\u308b\u3002\n\n\u3053\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001**Cloud Design Pattern**\u306e**[CloudHub\u30d1\u30bf\u30fc\u30f3](http://aws.clouddesignpattern.org/index.php/CDP:CloudHub%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3)**\u306e\u4e00\u7a2e\u3068\u8a00\u3063\u3066\u3082\u826f\u3044\u3060\u308d\u3046\u3002\n\n# \u307e\u3068\u3081\n\u3053\u306e\u624b\u9806\u304c\u300c\u7c21\u5358\u300d\u304b\u3068\u8a00\u3046\u3068\u7591\u554f\u304c\u6b8b\u308b\u304c\u3001\u3068\u3082\u3042\u308cAWS\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2VPN\u6a5f\u80fd\u3068vyatta\u3092\u7528\u3044\u3001\u5404\u62e0\u70b9\u306e\u7d4c\u8def\u60c5\u5831\u3092BGP\u3092\u7528\u3044\u3066\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3001AWS\u3068SoftLayer\u306e\u591a\u62e0\u70b9\u9593IPsec VPN\u63a5\u7d9a\u304c\u78ba\u7acb\u3067\u304d\u305f\u3002\n", "tags": ["AWS", "vyatta", "SoftLayer"]}