{"context": "New Relic\u306f\u30b5\u30a4\u30f3\u30a4\u30f3\u6e08\u306e\u524d\u63d0\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\n$ sudo yum update -y\n$ sudo yum install -y vim zsh git wget curl tmux bzip2\n\n\nNGINX\n$ sudo yum install -y nginx\n\nsudoedit /etc/nginx/conf.d/default.conf\n\n/etc/nginx/conf.d/default.conf\nserver {\n  listen \"8071\";\n  root /var/www/hoge/web;\n  location ~ \\.php.*$ {\n    fastcgi_split_path_info ^(.+\\.php)(.*)$;\n    fastcgi_pass unix:/var/run/php-fpm.sock;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param PATH_INFO $fastcgi_path_info;\n    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n    include fastcgi_params;\n  }\n}\n\n\n\nuser\n$ sudo useradd -g nginx -s /bin/bash www\n\n\nPHP\n\u5fc5\u8981\u306a\u30b3\u30f3\u30d1\u30a4\u30e9\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install -y gcc gcc-c++ libgcc cmake ncurses-devel re2c autoconf automake bison libxml2 libxml2-devel openssl-devel curl-devel libpng libpng-devel libmcrypt libmcrypt-devel readline-devel libtidy libtidy-devel libxslt libxslt-devel zlib-devel libjpeg-turbo libjpeg-turbo-devel libcurl-devel libicu-devel freetype freetype-devel\n\nintl\u306b\u5fc5\u8981\u306aicu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget http://download.icu-project.org/files/icu4c/58.2/icu4c-58_2-src.tgz\n$ tar xvzf icu4c-58_2-src.tgz\n$ cd ./icu/source\n$ ./configure --prefix=/opt/icu\n$ make\n$ sudo make install\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\nsudoedit /etc/ld.so.conf\n\n/etc/ld.so.conf\ninclude ld.so.conf.d/*.conf\n/usr/local/lib\n/usr/lib64\n\n\nsudo ldconfig\n\nphp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget -O php-7.1.2.tar.gz http://jp2.php.net/get/php-7.1.2.tar.gz/from/this/mirror\n$ tar xvzf php-7.1.2.tar.gz\n$ cd php-7.1.2\n$ ./configure \\\n--without-pear \\\n--with-gd \\\n--enable-sockets \\\n--with-jpeg-dir=/usr \\\n--with-png-dir=/usr \\\n--enable-exif \\\n--enable-zip \\\n--with-zlib \\\n--with-zlib-dir=/usr \\\n--with-kerberos \\\n--with-openssl \\\n--with-mcrypt=/usr \\\n--enable-soap \\\n--enable-xmlreader \\\n--with-xsl \\\n--enable-ftp \\\n--enable-cgi \\\n--with-curl=/usr \\\n--with-tidy \\\n--with-xmlrpc \\\n--enable-sysvsem \\\n--enable-sysvshm \\\n--enable-shmop \\\n--with-mysql=mysqlnd \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-pdo-sqlite \\\n--enable-pcntl \\\n--with-readline \\\n--enable-mbstring \\\n--disable-debug \\\n--enable-fpm \\\n--enable-bcmath \\\n--enable-phpdbg \\\n--enable-mbregex \\\n--enable-gd-native-ttf \\\n--with-freetype-dir=/usr/local/ \\\n--with-libdir=lib \\\n--enable-intl \\\n--with-icu-dir=/opt/icu \\\n--with-config-file-path=/etc/ \\\n--with-config-file-scan-dir=/etc/php.d\n$ make\n$ sudo make install\n$ sudo cp ./php.ini-production /etc/php.ini\n$ sudo cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\n$ sudo chmod 755 /etc/init.d/php-fpm\n$ sudo cp /usr/local/etc/php-fpm.d/www.conf.default /usr/local/etc/php-fpm.conf\n\n\nphp\u306e\u8a2d\u5b9a\nsudoedit /etc/php.ini\n\n/etc/php.ini\ndate.timezone = Asia/Tokyo\n[opcache]\nzend_extension=opcache.so\nopcache.enable=1\nopcache.enable_cli=1\nopcache.memory_consumption=128\nopcache.interned_strings_buffer=8\nopcache.max_accelerated_files=10000\nopcache.max_wasted_percentage=5\n\n\n\nPHP-FPM\u306e\u8a2d\u5b9a\nsudoedit /usr/local/etc/php-fpm.conf\n\n/usr/local/etc/php-fpm.conf\nlisten = /var/run/php-fpm.sock\npm = ondemand\npm.max_children = 5\nuser = www\ngroup = nginx\nlisten.owner = www\nlisten.group = nginx\n\n\n\ncomposer\n$ php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\n$ php -r \"if (hash_file('SHA384', 'composer-setup.php') === '669656bab3166a7aff8a7506b8cb2d1c292f042046c5a994c43155c0be6190fa0355160742ab2e1c88d40d5be660b410') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\n$ sudo /usr/local/bin/php composer-setup.php --install-dir=/usr/local/bin --filename=composer\n$ php -r \"unlink('composer-setup.php');\"\n\n\nNew Relic\n\nServers\n$ sudo rpm -Uvh http://yum.newrelic.com/pub/newrelic/el5/x86_64/newrelic-repo-5-3.noarch.rpm\n$ sudo yum -y install newrelic-sysmond\n$ sudo nrsysmond-config --set license_key=\"\u30e9\u30a4\u30bb\u30f3\u30b9\u30ad\u30fc\"\n$ sudo /etc/init.d/newrelic-sysmond start\n\n\nAPM\n$ sudo yum install newrelic-php5\n$ sudo newrelic-install\n\n\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30e2\u30fc\u30c9\u3067\u30e9\u30a4\u30bb\u30f3\u30b9\u30ad\u30fc\u3092\u767b\u9332\u3059\u308b\nsudoedit /etc/php.d/newrelic.ini\n\n/etc/php.d/newrelic.ini\nnewrelic.enabled=true\nnewrelic.appname=\"symfony3\"\nnewrelic.framework=\"symfony2\"\nnewrelic.transaction_tracer.detail=1\n\n\n\nSymfony3\n$ sudo mkdir -p /var/www\n$ sudo chown www.nginx /var/www\n$ sudo su - www\n$ cd /var/www\n$ composer create-project symfony/framework-standard-edition hoge \"3.2.*\"\n$ exit\n\n\nphp-fpm\u8d77\u52d5\n$ sudo /etc/init.d/php-fpm start\n\n\nnginx\u8d77\u52d5\n$ sudo /etc/init.d/nginx start\n\n\nNew Relic SERVERS\n\n\nNew Relic APM\n\n\nNew Relic\u306f\u30b5\u30a4\u30f3\u30a4\u30f3\u6e08\u306e\u524d\u63d0\n\n# \u5fc5\u8981\u306b\u5fdc\u3058\u3066\n\n```bash\n$ sudo yum update -y\n$ sudo yum install -y vim zsh git wget curl tmux bzip2\n```\n\n# NGINX\n\n```bash\n$ sudo yum install -y nginx\n```\n\nsudoedit /etc/nginx/conf.d/default.conf\n\n```/etc/nginx/conf.d/default.conf\nserver {\n  listen \"8071\";\n  root /var/www/hoge/web;\n  location ~ \\.php.*$ {\n    fastcgi_split_path_info ^(.+\\.php)(.*)$;\n    fastcgi_pass unix:/var/run/php-fpm.sock;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param PATH_INFO $fastcgi_path_info;\n    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n    include fastcgi_params;\n  }\n}\n```\n\n# user\n```bash\n$ sudo useradd -g nginx -s /bin/bash www\n```\n\n# PHP\n\n\u5fc5\u8981\u306a\u30b3\u30f3\u30d1\u30a4\u30e9\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo yum install -y gcc gcc-c++ libgcc cmake ncurses-devel re2c autoconf automake bison libxml2 libxml2-devel openssl-devel curl-devel libpng libpng-devel libmcrypt libmcrypt-devel readline-devel libtidy libtidy-devel libxslt libxslt-devel zlib-devel libjpeg-turbo libjpeg-turbo-devel libcurl-devel libicu-devel freetype freetype-devel\n```\n\nintl\u306b\u5fc5\u8981\u306aicu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ wget http://download.icu-project.org/files/icu4c/58.2/icu4c-58_2-src.tgz\n$ tar xvzf icu4c-58_2-src.tgz\n$ cd ./icu/source\n$ ./configure --prefix=/opt/icu\n$ make\n$ sudo make install\n```\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\n\nsudoedit /etc/ld.so.conf\n\n```/etc/ld.so.conf\ninclude ld.so.conf.d/*.conf\n/usr/local/lib\n/usr/lib64\n```\n\n```bash\nsudo ldconfig\n```\n\nphp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ wget -O php-7.1.2.tar.gz http://jp2.php.net/get/php-7.1.2.tar.gz/from/this/mirror\n$ tar xvzf php-7.1.2.tar.gz\n$ cd php-7.1.2\n$ ./configure \\\n--without-pear \\\n--with-gd \\\n--enable-sockets \\\n--with-jpeg-dir=/usr \\\n--with-png-dir=/usr \\\n--enable-exif \\\n--enable-zip \\\n--with-zlib \\\n--with-zlib-dir=/usr \\\n--with-kerberos \\\n--with-openssl \\\n--with-mcrypt=/usr \\\n--enable-soap \\\n--enable-xmlreader \\\n--with-xsl \\\n--enable-ftp \\\n--enable-cgi \\\n--with-curl=/usr \\\n--with-tidy \\\n--with-xmlrpc \\\n--enable-sysvsem \\\n--enable-sysvshm \\\n--enable-shmop \\\n--with-mysql=mysqlnd \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-pdo-sqlite \\\n--enable-pcntl \\\n--with-readline \\\n--enable-mbstring \\\n--disable-debug \\\n--enable-fpm \\\n--enable-bcmath \\\n--enable-phpdbg \\\n--enable-mbregex \\\n--enable-gd-native-ttf \\\n--with-freetype-dir=/usr/local/ \\\n--with-libdir=lib \\\n--enable-intl \\\n--with-icu-dir=/opt/icu \\\n--with-config-file-path=/etc/ \\\n--with-config-file-scan-dir=/etc/php.d\n$ make\n$ sudo make install\n$ sudo cp ./php.ini-production /etc/php.ini\n$ sudo cp ./sapi/fpm/init.d.php-fpm /etc/init.d/php-fpm\n$ sudo chmod 755 /etc/init.d/php-fpm\n$ sudo cp /usr/local/etc/php-fpm.d/www.conf.default /usr/local/etc/php-fpm.conf\n```\n\n## php\u306e\u8a2d\u5b9a\n\nsudoedit /etc/php.ini\n\n```/etc/php.ini\ndate.timezone = Asia/Tokyo\n[opcache]\nzend_extension=opcache.so\nopcache.enable=1\nopcache.enable_cli=1\nopcache.memory_consumption=128\nopcache.interned_strings_buffer=8\nopcache.max_accelerated_files=10000\nopcache.max_wasted_percentage=5\n```\n\n## PHP-FPM\u306e\u8a2d\u5b9a\n\nsudoedit /usr/local/etc/php-fpm.conf\n\n```/usr/local/etc/php-fpm.conf\nlisten = /var/run/php-fpm.sock\npm = ondemand\npm.max_children = 5\nuser = www\ngroup = nginx\nlisten.owner = www\nlisten.group = nginx\n```\n\n# composer\n\n```bash\n$ php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\"\n$ php -r \"if (hash_file('SHA384', 'composer-setup.php') === '669656bab3166a7aff8a7506b8cb2d1c292f042046c5a994c43155c0be6190fa0355160742ab2e1c88d40d5be660b410') { echo 'Installer verified'; } else { echo 'Installer corrupt'; unlink('composer-setup.php'); } echo PHP_EOL;\"\n$ sudo /usr/local/bin/php composer-setup.php --install-dir=/usr/local/bin --filename=composer\n$ php -r \"unlink('composer-setup.php');\"\n```\n\n# New Relic\n\n## Servers\n\n```bash\n$ sudo rpm -Uvh http://yum.newrelic.com/pub/newrelic/el5/x86_64/newrelic-repo-5-3.noarch.rpm\n$ sudo yum -y install newrelic-sysmond\n$ sudo nrsysmond-config --set license_key=\"\u30e9\u30a4\u30bb\u30f3\u30b9\u30ad\u30fc\"\n$ sudo /etc/init.d/newrelic-sysmond start\n```\n\n## APM\n\n```bash\n$ sudo yum install newrelic-php5\n$ sudo newrelic-install\n```\n\n\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30e2\u30fc\u30c9\u3067\u30e9\u30a4\u30bb\u30f3\u30b9\u30ad\u30fc\u3092\u767b\u9332\u3059\u308b\n\nsudoedit /etc/php.d/newrelic.ini\n\n```/etc/php.d/newrelic.ini\nnewrelic.enabled=true\nnewrelic.appname=\"symfony3\"\nnewrelic.framework=\"symfony2\"\nnewrelic.transaction_tracer.detail=1\n```\n\n# Symfony3\n\n```bash\n$ sudo mkdir -p /var/www\n$ sudo chown www.nginx /var/www\n$ sudo su - www\n$ cd /var/www\n$ composer create-project symfony/framework-standard-edition hoge \"3.2.*\"\n$ exit\n```\n\n# php-fpm\u8d77\u52d5\n\n```bash\n$ sudo /etc/init.d/php-fpm start\n```\n\n# nginx\u8d77\u52d5\n\n```bash\n$ sudo /etc/init.d/nginx start\n```\n\n# New Relic SERVERS\n\n<img width=\"1098\" alt=\"nrs.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/45760/7e241830-c3fd-483c-f6ed-d4dbed7f88f3.png\">\n\n# New Relic APM\n\n<img width=\"1297\" alt=\"nrapm1.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/45760/34106f43-3710-be5f-7770-e87f4e64cc74.png\">\n\n<img width=\"1290\" alt=\"nrapm2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/45760/4ac256a4-d0bf-2bdf-b751-97b7404a5e51.png\">\n", "tags": ["Symfony", "nginx", "newrelic", "PHP"]}