{"context": "\u958b\u767a\u3057\u3066\u3044\u3066\u60a9\u307f\u306a\u306e\u304cGithub\u304b\u3089\u30e1\u30f3\u30b7\u30e7\u30f3\u3055\u308c\u305f\u30b3\u30df\u30c3\u30c8\u3092\u30b9\u30eb\u30fc\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u3002\n\u306a\u306e\u3067hubot\u3001hubot-slack\u3092\u4f7f\u3063\u3066Github\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u3092\u62fe\u3046\u3053\u3068\u306b\u3059\u308b\n\u524d\u63d0\u3068\u3057\u3066\u306fhubot\u3001hubot-slack\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u72b6\u614b\u3067\u65e2\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3067\u304d\u308b\u72b6\u614b\u3067\u3042\u308b\u3053\u3068\n\u6ce8\u610f\u70b9\uff1ahubot-slack\u306fversion4.0\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u306e\u3067version3\u3092\u4f7f\u3063\u3066\u304a\u308a\u307e\u3059\nissue\u3068pull\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\n\n\uff11.scripts\u30d5\u30a9\u30eb\u30c0\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3001.github_id_history\u30d5\u30a1\u30a4\u30eb\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30eb\u30fc\u30c8\u30d1\u30b9\u306b\u8ffd\u52a0\nrobot.router.post\u306b\u3042\u308b\u30d1\u30b9\u306f\u81ea\u7531\u306b\u6c7a\u3081\u3066\u3044\u305f\u3060\u3044\u3066\u304b\u307e\u3044\u307e\u305b\u3093\nUSER_NAME\u306b\u5165\u308b\u540d\u524d\u306f\u5de6\u306fgithub\u306b\u4f7f\u308f\u308c\u3066\u308b\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\u3001\u53f3\u306fslack\u3067\u4f7f\u308f\u308c\u3066\u308b\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\u3092\u5148\u982d\u306b@\u3092\u3064\u3051\u3066\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n\ngithub.coffee\n\nUSER_NAME = {\n  \"@\u3042\u306a\u305f\u306eguthub\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\": \"@\u3042\u306a\u305f\u306eslack\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\"\n}\n\nmodule.exports = (robot) ->\n  robot.router.post \"/github/webhook\", (req, res) ->\n    request = req.body\n    if !hasGithubID(request)\n      IdFileWrite(request)\n      robot.send {room: \"#channel\u540d\"}, parentMessage(request)\n    robot.send {room: \"#channel\u540d\"}, childrenMessage(request)\n\nparentMessage = (request) ->\n  type = \"\"\n  user = \"\"\n  body = \"\"\n  comment_url = \"\"\n  if request.issue\n    type = \"issue\"\n    user = request.issue.user.login\n    body = request.issue.body\n    comment_url = request.issue.html_url\n  else if request.pull_request\n    type = \"pull_request\"\n    user = request.pull_request.user.login\n    body = request.pull_request.body\n    comment_url = request.pull_request.html_url\n  messageFormat(request, type, user, comment_url, body)\n\nchildrenMessage = (request) ->\n  type = \"\"\n  user = \"\"\n  body = \"\"\n  comment_url = \"\"\n  if request.issue\n    type = \"issue\"\n  else if request.pull_request\n    type = \"pull_request\"\n  body = request.comment.body\n  comment_url = request.comment.html_url\n  user = request.comment.user.login\n  messageFormat(request, type, user, comment_url, body)\n\nmessageFormat = (request, type, user, comment_url, body) ->\n  username = mentionsSearch(body)\n  if username\n    msg = \"\"\n    msg += username\n    msg += \"[#{request.repository.name}] #{request.action}: ##{request[type].number} #{request[type].title} by #{user}\\n\"\n    msg += \"#{comment_url}\\n\"\n    msg += \"```\" + \"\\n\" + \"#{body}\" + \"\\n\" + \"```\"\n    msg\n\n# \u30b3\u30e1\u30f3\u30c8\u672c\u6587\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\nmentionsSearch = (body) ->\n  mentions = []\n  regexp_str = body.match /(^|\\s)(@[\\w\\-\\/]+)/g\n  if regexp_str\n    for mention in regexp_str\n      mentions.push(mention.trim())\n    userNameSearch(mentions)\n  else\n    null\n\n# \u30e6\u30fc\u30b6\u30fc\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nuserNameSearch = (mentions) ->\n  username = \"\"\n  for mention in mentions\n    if USER_NAME[mention]\n      username += USER_NAME[mention] + \" \"\n  if username\n    username\n  else\n    null\n\n# GitHub\u306eissue, pull_request\u306eid\u3092\u78ba\u8a8d\u3059\u308b\nhasGithubID = (request) ->\n  fs = require('fs')\n  path = fs.realpathSync('./')\n  fileName = path + \"/.github_id_history\"\n  contents = fs.readFileSync(fileName)\n  lines = contents.toString().trim().split('\\n')\n  type = \"\"\n  if request.issue\n    type = request.issue\n  else if request.pull_request\n    type = request.pull_request\n  else\n    return false\n  for line in lines\n    if Number(line) == type.id\n      return true\n  false\n\n# .github_id_history\u30d5\u30a1\u30a4\u30eb\u306bID\u304c\u306a\u3051\u308c\u3070\u66f8\u304d\u8fbc\u3080\nIdFileWrite = (request) ->\n  fs = require('fs')\n  path = fs.realpathSync('./')\n  fileName = path + \"/.github_id_history\"\n  id = ''\n  if request.issue\n    id = request.issue.id\n  else if request.pull_request\n    id = request.pull_request.id\n  if id\n    fs.appendFile(fileName, id + '\\n', 'utf8')\n\n\n\u5916\u90e8\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u4e0a\u3052\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067ngrok\u3068\u3044\u3046\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\n\n2.ngrok\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nngrok\u306flocalhost\u3067\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3092\u5916\u90e8\uff08LAN\u5916\uff09\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30ea\u30ec\u30fc\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\u3067\u3059\nngrok\u306e\u4f7f\u7528\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002ngrok\u3092\u5b9f\u884c\u3057\u305f\u6642\u306eURL\u3092Webhooks\u306b\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\n\n3.ngrok\u306eURL\u3092github\u306eWebhooks\u306b\u767b\u9332\u3059\u308b\nWebhooks\u306e\u767b\u9332\u65b9\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\n4.slack\u306bhubot\u3092integrate\u3057\u3066\u767a\u884c\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u767b\u9332\nbin/hubot\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u8a18\nexport HUBOT_SLACK_TOKEN=\u767a\u884c\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\n\nslack\u306bhubot\u306e\u7d71\u5408\u65b9\u6cd5\u3001\u30c8\u30fc\u30af\u30f3\u306e\u78ba\u8a8d\u65b9\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\u6700\u5f8c\u306b\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\n\u958b\u767a\u3057\u3066\u3044\u3066\u60a9\u307f\u306a\u306e\u304cGithub\u304b\u3089\u30e1\u30f3\u30b7\u30e7\u30f3\u3055\u308c\u305f\u30b3\u30df\u30c3\u30c8\u3092\u30b9\u30eb\u30fc\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u3002\n\u306a\u306e\u3067hubot\u3001hubot-slack\u3092\u4f7f\u3063\u3066Github\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u3092\u62fe\u3046\u3053\u3068\u306b\u3059\u308b\n\n\u524d\u63d0\u3068\u3057\u3066\u306fhubot\u3001hubot-slack\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u72b6\u614b\u3067\u65e2\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3067\u304d\u308b\u72b6\u614b\u3067\u3042\u308b\u3053\u3068\n\n**\u6ce8\u610f\u70b9**\uff1ahubot-slack\u306fversion4.0\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u306e\u3067version3\u3092\u4f7f\u3063\u3066\u304a\u308a\u307e\u3059\n\nissue\u3068pull\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\n\n\n\n##\uff11.scripts\u30d5\u30a9\u30eb\u30c0\u306b\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u3001.github_id_history\u30d5\u30a1\u30a4\u30eb\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30eb\u30fc\u30c8\u30d1\u30b9\u306b\u8ffd\u52a0\n\nrobot.router.post\u306b\u3042\u308b\u30d1\u30b9\u306f\u81ea\u7531\u306b\u6c7a\u3081\u3066\u3044\u305f\u3060\u3044\u3066\u304b\u307e\u3044\u307e\u305b\u3093\nUSER_NAME\u306b\u5165\u308b\u540d\u524d\u306f\u5de6\u306fgithub\u306b\u4f7f\u308f\u308c\u3066\u308b\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\u3001\u53f3\u306fslack\u3067\u4f7f\u308f\u308c\u3066\u308b\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\u3092\u5148\u982d\u306b@\u3092\u3064\u3051\u3066\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\n\n```:github.coffee\n\nUSER_NAME = {\n  \"@\u3042\u306a\u305f\u306eguthub\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\": \"@\u3042\u306a\u305f\u306eslack\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u540d\"\n}\n\nmodule.exports = (robot) ->\n  robot.router.post \"/github/webhook\", (req, res) ->\n    request = req.body\n    if !hasGithubID(request)\n      IdFileWrite(request)\n      robot.send {room: \"#channel\u540d\"}, parentMessage(request)\n    robot.send {room: \"#channel\u540d\"}, childrenMessage(request)\n\nparentMessage = (request) ->\n  type = \"\"\n  user = \"\"\n  body = \"\"\n  comment_url = \"\"\n  if request.issue\n    type = \"issue\"\n    user = request.issue.user.login\n    body = request.issue.body\n    comment_url = request.issue.html_url\n  else if request.pull_request\n    type = \"pull_request\"\n    user = request.pull_request.user.login\n    body = request.pull_request.body\n    comment_url = request.pull_request.html_url\n  messageFormat(request, type, user, comment_url, body)\n\nchildrenMessage = (request) ->\n  type = \"\"\n  user = \"\"\n  body = \"\"\n  comment_url = \"\"\n  if request.issue\n    type = \"issue\"\n  else if request.pull_request\n    type = \"pull_request\"\n  body = request.comment.body\n  comment_url = request.comment.html_url\n  user = request.comment.user.login\n  messageFormat(request, type, user, comment_url, body)\n\nmessageFormat = (request, type, user, comment_url, body) ->\n  username = mentionsSearch(body)\n  if username\n    msg = \"\"\n    msg += username\n    msg += \"[#{request.repository.name}] #{request.action}: ##{request[type].number} #{request[type].title} by #{user}\\n\"\n    msg += \"#{comment_url}\\n\"\n    msg += \"```\" + \"\\n\" + \"#{body}\" + \"\\n\" + \"```\"\n    msg\n\n# \u30b3\u30e1\u30f3\u30c8\u672c\u6587\u306e\u30e1\u30f3\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\nmentionsSearch = (body) ->\n  mentions = []\n  regexp_str = body.match /(^|\\s)(@[\\w\\-\\/]+)/g\n  if regexp_str\n    for mention in regexp_str\n      mentions.push(mention.trim())\n    userNameSearch(mentions)\n  else\n    null\n\n# \u30e6\u30fc\u30b6\u30fc\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\nuserNameSearch = (mentions) ->\n  username = \"\"\n  for mention in mentions\n    if USER_NAME[mention]\n      username += USER_NAME[mention] + \" \"\n  if username\n    username\n  else\n    null\n\n# GitHub\u306eissue, pull_request\u306eid\u3092\u78ba\u8a8d\u3059\u308b\nhasGithubID = (request) ->\n  fs = require('fs')\n  path = fs.realpathSync('./')\n  fileName = path + \"/.github_id_history\"\n  contents = fs.readFileSync(fileName)\n  lines = contents.toString().trim().split('\\n')\n  type = \"\"\n  if request.issue\n    type = request.issue\n  else if request.pull_request\n    type = request.pull_request\n  else\n    return false\n  for line in lines\n    if Number(line) == type.id\n      return true\n  false\n\n# .github_id_history\u30d5\u30a1\u30a4\u30eb\u306bID\u304c\u306a\u3051\u308c\u3070\u66f8\u304d\u8fbc\u3080\nIdFileWrite = (request) ->\n  fs = require('fs')\n  path = fs.realpathSync('./')\n  fileName = path + \"/.github_id_history\"\n  id = ''\n  if request.issue\n    id = request.issue.id\n  else if request.pull_request\n    id = request.pull_request.id\n  if id\n    fs.appendFile(fileName, id + '\\n', 'utf8')\n```\n\n\u5916\u90e8\u306b\u30b5\u30fc\u30d0\u30fc\u3092\u4e0a\u3052\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067[ngrok](https://ngrok.com/)\u3068\u3044\u3046\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\n\n##2.ngrok\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nngrok\u306flocalhost\u3067\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3092\u5916\u90e8\uff08LAN\u5916\uff09\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30ea\u30ec\u30fc\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\u3067\u3059\n\nngrok\u306e\u4f7f\u7528\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002ngrok\u3092\u5b9f\u884c\u3057\u305f\u6642\u306eURL\u3092Webhooks\u306b\u767b\u9332\u3057\u3066\u304f\u3060\u3055\u3044\n\n##3.ngrok\u306eURL\u3092github\u306eWebhooks\u306b\u767b\u9332\u3059\u308b\nWebhooks\u306e\u767b\u9332\u65b9\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\n##4.slack\u306bhubot\u3092integrate\u3057\u3066\u767a\u884c\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u767b\u9332\nbin/hubot\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u8a18\n\n```\nexport HUBOT_SLACK_TOKEN=\u767a\u884c\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\n```\n\nslack\u306bhubot\u306e\u7d71\u5408\u65b9\u6cd5\u3001\u30c8\u30fc\u30af\u30f3\u306e\u78ba\u8a8d\u65b9\u6cd5\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\n\u6700\u5f8c\u306b\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\n", "tags": ["GitHub", "Hubot", "Slack"]}