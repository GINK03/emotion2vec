{"tags": ["capistrano", "deploy", "Ruby"], "context": " More than 1 year has passed since last update.\n\n\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002 \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\nRuby\u88fd\u306e\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30ebCapistrano\u306f\u4f55\u304b\u3068\u4fbf\u5229\u3067\u3088\u304f\u3064\u304b\u3046\u3002Rails\u306b\u304b\u304e\u3089\u305a\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u304b\u3089\u4f55\u304b\u3092\u6301\u3063\u3066\u304f\u308b\u7528\u9014\u306b\u5411\u3044\u3066\u3044\u308b\u3002\ncap\u30b3\u30de\u30f3\u30c9\u304b\u3089\u5b9f\u884c\u3059\u308b\u306e\u3082\u3044\u3044\u304c\u3001\u9069\u5f53\u306aSinatra\u30a2\u30d7\u30ea\u306b\u7d44\u307f\u8fbc\u3093\u3060\u308a\u3067\u304d\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u601d\u3044\u3001\u611f\u89e6\u3092\u3064\u304b\u3080\u305f\u3081irb\u306a\u3093\u304b\u3067\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u53e9\u3044\u3066\u307f\u305f\u3002\n\u5358\u7d14\u306bCapistrano\u306eWEB-UI\u304c\u5fc5\u8981\u306a\u3089rails\u3067\u4f5c\u3089\u308c\u305fWebistrano\u3068\u3044\u3046\u306e\u304c\u3042\u308b\u3002\u5143\u306f\u53e4\u3044\u3051\u3069\u5e7e\u3064\u304b\u306e\u30d5\u30a9\u30fc\u30af\u3055\u308c\u305f\u3082\u306e\u306f\u65b0\u3057\u3081\u306e\u74b0\u5883\u3067\u3082\u52d5\u4f5c\u3059\u308b\u3088\u3046\u3060\u3002\nCapistrano\u30bd\u30fc\u30b9\u306e\u30c1\u30a7\u30c3\u30af\u306b\u306f\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0Ruby\u3092\u304b\u306a\u308a\u53c2\u8003\u306b\u3057\u305f\u3002\n\n\u307e\u305a\u306f Capistrano::Configuration.new\n\u4eca\u56de\u306fRuby\u306e\u5b9f\u884c\u306bPry\u3092\u4f7f\u3046\u3002\n\u3069\u3046\u3084\u3089Capistrano\u306e\u3059\u3079\u3066\u306fCapistrano::Configuration\u30af\u30e9\u30b9\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u96c6\u307e\u308b\u6a21\u69d8\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nPry-Console\n> require 'capistrano'\n=> true\n\n> config = Capistrano::Configuration.new\n=> #<Capistrano::Configuration:0x00000001f26678\n @callbacks={},\n @debug=false,\n @dry_run=false,\n @load_paths=\n  [\".\",\n   \"/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/recipes\"],\n @loaded_features=[],\n @logger=\n  #<Capistrano::Logger:0x00000001f264c0\n   @device=#<IO:<STDERR>>,\n   @disable_formatters=nil,\n   @level=0,\n   @options={}>,\n @name=nil,\n @namespaces={},\n @original_procs={},\n @parent=nil,\n @preserve_roles=false,\n @roles={},\n @tasks={},\n @variable_locks=\n  {:ssh_options=>%<8d5c2f16Mutex:0x00000001f26150>,\n   :logger=>#<Mutex:0x00000001f25fc0>,\n   :default_environment=>#<Mutex:0x00000001f25368>,\n   :default_run_options=>#<Mutex:0x00000001f251b0>},\n @variables=\n  {:ssh_options=>{},\n   :logger=>\n    #<Capistrano::Logger:0x00000001f264c0\n     @device=#<IO:<STDERR>>,\n     @disable_formatters=nil,\n     @level=0,\n     @options={}>,\n   :default_environment=>{},\n   :default_run_options=>{}}>\n\n\nCapistrano\u306eCapfile, deploy.rb\u306a\u3069\u306b\u51fa\u3066\u304f\u308b\u5358\u8a9e\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5909\u6570\u3068\u3057\u3066\u305f\u304f\u3055\u3093\u51fa\u3066\u304f\u308b\u3002\n\n\u7d99\u627f\u30c1\u30a7\u30c3\u30af\n\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u3084\u30af\u30e9\u30b9\u304b\u3089\u3001CLI\u30c4\u30fc\u30eb\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u6642\u306eCapitrano\u306e\u5404\u6319\u52d5\u304c\u57a3\u9593\u898b\u308c\u308b\u3002\n\nPry-Console\n> config.class.ancestors\n=> [Capistrano::Configuration,\n Capistrano::Configuration::Callbacks,\n Capistrano::Configuration::Actions::FileTransfer,\n Capistrano::Configuration::Actions::Inspect,\n Capistrano::Configuration::Actions::Invocation,\n Capistrano::Configuration::AliasTask,\n Capistrano::Configuration::Connections,\n Capistrano::Configuration::Execution,\n Capistrano::Configuration::Loading,\n Capistrano::Configuration::LogFormatters,\n Capistrano::Configuration::Namespaces,\n Capistrano::Configuration::Roles,\n Capistrano::Configuration::Servers,\n Capistrano::Configuration::Variables,\n Object,\n PP::ObjectMixin,\n Kernel,\n BasicObject]\n\n\n\n\u51fa\u529b\u3092\u8a73\u7d30\u306b\u5909\u66f4\n\u3053\u3053\u3067@logger\u3092TRACE\u30ec\u30d9\u30eb\u306b\u3057\u3066\u3001Capistrano\u304c\u5b9f\u884c\u3059\u308b\u5185\u5bb9\u3092\u9010\u4e00\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\nPry-Console\n> Capistrano::Logger.constants\n=> [:IMPORTANT, :INFO, :DEBUG, :TRACE, :MAX_LEVEL, :COLORS, :STYLES]\n\n> config.logger.level = Capistrano::Logger::TRACE\n=> 3\n\n\n\nNamespace\u3068\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u30bf\u30b9\u30af\u306f\u4f55\u3082\u306a\u3044\u3002\nconfing\u306b\u3064\u3044\u305f#namespace\u306f\u30bf\u30b9\u30af\u3092\u52d5\u7684\u306b\u5b9a\u7fa9\u3059\u308b\u3001\u3053\u308c\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\u3002\n\nPry-Console\n> config.namespace :hello do\n*   task :world do\n*     run \"echo Hello World ?\"\n*   end  \n* end  \n=> #<Proc:0x000000022dadf0@/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/configuration/namespaces.rb:83 (lambda)>\n\n\nProc\u3060\u3063\u305f\u3001\u3069\u3053\u304b\u3067call\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u30bf\u30b9\u30afProc\u306e\u683c\u7d0d\u5148\nconfig\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305f\u3069\u3063\u3066\u3044\u304f\u3002\n\nPry-Console\n> config.namespaces.keys\n=> [:hello]\n\n> config.namespaces[:hello].tasks.keys\n=> [:world]\n\n> config.namespaces[:hello].tasks[:world].body\n=> #<Proc:0x000000022db110@(pry):9>\n\n\n\u3042\u3063\u305f\u3001#call\u3092\u53e9\u3044\u3066\u307f\u3088\u3046\u3002\u4e2d\u8eab\u306erun\u304c\u547c\u3070\u308c\u308b\u3002\n\nPry-Console\n> config.namespaces[:hello].tasks[:world].body.call\n  * executing \"echo Hello World ?\"\nCapistrano::NoMatchingServersError: no servers found to match {:eof=>true}\nfrom /usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/configuration/connections.rb:174:in `execute_on_servers'\n\n\nrun\u306f\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u3092\u5fc5\u8981\u3068\u3059\u308b\u306e\u3067\u30b5\u30fc\u30d0\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nRole(server)\u306e\u8ffd\u52a0\nnamespace\u306e\u65b9\u6cd5\u304b\u3089\u63a8\u6e2c\u3067\u304d\u308b\u304c\u3001\u3053\u308c\u3082\u30ec\u30b7\u30d4\u901a\u308a\u306b\u5b9a\u7fa9\u51fa\u6765\u308b\u3002config.\u3092\u9664\u3051\u3070Capistrano\u4f7f\u3044\u306b\u306f\u304a\u306a\u3058\u307f\u306e\u5185\u5bb9\u3002\n\u3053\u3046\u3044\u3046\u5185\u90e8DSL\u306e\u5b9f\u88c5\u306f\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0Ruby\u3092\u307f\u305f\u3089\u4f55\u3068\u306a\u304f\u308f\u304b\u308b\u3002\n\nPry-Console\n> config.server \"localhost\", :web\n=> [:web]\n\n\n\u7a7a\u3060\u3063\u305f@roles\u306b\u30b5\u30fc\u30d0\u30ea\u30b9\u30c8\u304c\u4ee3\u5165\u3055\u308c\u305f\u3002\n\nPry-Console\n> config.roles          \n=> {:web=>\n  #<Capistrano::Role:0x00000002427870\n   @dynamic_servers=[],\n   @static_servers=[localhost]>}\n\n\n\n\u30bf\u30b9\u30af\u306e\u5b9f\u884c\u30922\u901a\u308a\u306e\u66f8\u5f0f\u3067\n\u307e\u305a\u5148\u307b\u3069\u30b3\u30b1\u305f#call\u3002\n\nPry-Console\n> config.namespaces[:hello].tasks[:world].body.call\n  * executing \"echo Hello World ?\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n ** [out :: localhost] Hello World ?\n    command finished in 171ms\n=> nil\n\n\n\u3053\u308c\u306f\u6b21\u306e\u66f8\u5f0f\u3067\u3082\u4e00\u7dd2\u306b\u306a\u308b\u3001\u8981\u306fCapistrano\u30ec\u30b7\u30d4\u3068\u4e00\u7dd2\u3060\u3002\n\nPry-Console\n> config.hello.world \n  * 2012-11-07 09:12:24 executing `hello:world'\n  * executing \"echo Hello World ?\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n ** [out :: localhost] Hello World ?\n    command finished in 7ms\n=> nil\n\n\nnamespace\u306b\u3088\u3063\u3066\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u308b\u306e\u3067config\u304b\u3089\u547c\u3079\u308b\u3002\n\nPry-Console\n> config.methods(false)\n=> [:hello,\n :_cset,\n :scm_default,\n :depend,\n :with_env,\n :run_locally,\n :try_sudo,\n :try_runner]\n\n\n\u3053\u308c\u3067\u3072\u3068\u307e\u305aRole\u3078\u306e\u30bf\u30b9\u30af\u5b9f\u884c\u304c\u51fa\u6765\u305f\u3002\n\n\u3044\u3064\u3082\u306e cap deploy \u3092load\u3057\u3066\u307f\u308b\n@load_paths\u306b\u306f\u7d44\u8fbc\u307f\u30ec\u30b7\u30d4\u3078\u306e\u30d1\u30b9\u304c\u3042\u308b\u3002\n\nPry-Console\n> config.load_paths\n=> [\".\", \"/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/recipes\"]\n\n\n#load\u3092\u4f7f\u3046\u3068\u7d44\u307f\u8fbc\u3081\u308b\u3001\u3053\u308c\u3067\u3044\u3064\u3082\u306edeploy\u7cfb\u30bf\u30b9\u30af\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002\n\nPry-Console\n> config.load \"deploy\"\n=> [\"deploy\"]\n\n> config.namespaces.keys\n=> [:hello, :deploy]\n\n\nCLI\u5b9f\u884c\u3092\u88dc\u8db3\u3059\u308b\u3068capify\u3067\u4f5c\u6210\u3057\u305fCapfile\u306b\u3042\u308bload \"deploy\"\u3067\u3053\u308c\u3068\u540c\u3058\u3053\u3068\u3092\u884c\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n\u7d44\u307f\u8fbc\u307f\u306eDeploy\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\u30ed\u30fc\u30c9\u3057\u305fdeploy\u30ec\u30b7\u30d4\u306e\u30bf\u30b9\u30af\u4e00\u89a7\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u304a\u306a\u3058\u307f\u306e\u9762\u3005\u304c\u4e26\u3093\u3067\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n\nPry-Console\n> config.namespaces[:deploy].tasks.keys\n=> [:default,\n :setup,\n :update,\n :update_code,\n :finalize_update,\n :symlink,\n :create_symlink,\n :upload,\n :restart,\n :migrate,\n :migrations,\n :cleanup,\n :check,\n :cold,\n :start,\n :stop]\n\n\n\n\u8efd\u305d\u3046\u306adeploy:setup\u304b\u3089\n\u3082\u3061\u308d\u3093#set \u304c\u4f7f\u3048\u308b\u306e\u3067\u3001setup\u306b\u5fc5\u9808\u306e\u30d1\u30e9\u30e1\u30fc\u30bf:deploy_to\u3092\u5b9a\u7fa9\u3057\u305f\u3089setup\u5b9f\u884c\u3002\n\nPry-Console\n> config.set :deploy_to, \"/opt/deploy/hello\"\n=> \"/opt/deploy/hello\"\n\n\n> config.deploy.setup\n  * 2012-11-07 09:34:17 executing `deploy:setup'\n  * executing \"sudo -p 'sudo password: ' mkdir -p /opt/deploy/hello /opt/deploy/hello/releases /opt/deploy/hello/shared /opt/deploy/hello/shared/system /opt/deploy/hello/shared/log /opt/deploy/hello/shared/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 14ms\n  * executing \"sudo -p 'sudo password: ' chmod g+w /opt/deploy/hello /opt/deploy/hello/releases /opt/deploy/hello/shared /opt/deploy/hello/shared/system /opt/deploy/hello/shared/log /opt/deploy/hello/shared/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 11ms\n=> nil\n\n\n> Dir.glob(\"/opt/deploy/hello/**/\")\n=> [\"/opt/deploy/hello/\",\n \"/opt/deploy/hello/shared/\",\n \"/opt/deploy/hello/shared/system/\",\n \"/opt/deploy/hello/shared/log/\",\n \"/opt/deploy/hello/shared/pids/\",\n \"/opt/deploy/hello/releases/\"]\n\n\nCapistrano\u307d\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30c4\u30ea\u30fc\u304c\u51fa\u6765\u305f\u3002\n\n\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b(update_code, create_symlink)\ndeploy\u30ec\u30b7\u30d4\u3092\u7d44\u307f\u8fbc\u3093\u3060\u3053\u3068\u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305fAttribute\u3092\u30c1\u30a7\u30c3\u30af\u3002\n\nPry-Console\n> config.namespaces[:deploy].variables.keys\n=> [:ssh_options,\n :logger,\n :default_environment,\n :default_run_options,\n :application,\n :repository,\n :scm,\n :deploy_via,\n :deploy_to,\n :revision,\n :rails_env,\n :rake,\n :source,\n :real_revision,\n :strategy,\n :release_name,\n :version_dir,\n :shared_dir,\n :shared_children,\n :current_dir,\n :releases_path,\n :shared_path,\n :current_path,\n :release_path,\n :releases,\n :current_release,\n :previous_release,\n :current_revision,\n :latest_revision,\n :previous_revision,\n :run_method,\n :latest_release]\n\n\n\u8981\u308b\u3082\u306e\u3060\u3051\u4e0a\u66f8\u304d\uff06\u5b9a\u7fa9\u3059\u308b\u3001\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u306e\u60c5\u5831\u304c\u3042\u308c\u3070OK\u3002\n\nPry-Console\n> config.set :scm, 'git'\n=> \"git\"\n\n> config.set :repository, 'https://github.com/higanworks/Files_and_Tasks.git'\n=> \"https://github.com/higanworks/Files_and_Tasks.git\"\n\n\n> config.deploy.check          \n  * 2012-11-07 10:27:26 executing `deploy:check'\n  * executing \"test -d /opt/deploy/hello/releases\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 7ms\n  * executing \"test -w /opt/deploy/hello\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 5ms\n  * executing \"test -w /opt/deploy/hello/releases\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 5ms\n  * executing \"which git\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 7ms\nYou appear to have all necessary dependencies installed\n=> nil\n\n\n\nupdate_code\nGithub\u304b\u3089\u30b3\u30fc\u30c9\u3092\u8a2d\u7f6e\u3002\n\nPry-Console\n> config.deploy.update_code\n  * 2012-11-07 10:11:19 executing `deploy:update_code'\n  * executing \"git clone -q https://github.com/higanworks/Files_and_Tasks.git /opt/deploy/hello/releases/20121107100343 && cd /opt/deploy/hello/releases/20121107100343 && git checkout -q -b deploy ea5f5e0f9e782305dcd3c27a091fe6c8387760c6 && (echo ea5f5e0f9e782305dcd3c27a091fe6c8387760c6 > /opt/deploy/hello/releases/20121107100343/REVISION)\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 6293ms\n  * 2012-11-07 10:11:26 executing `deploy:finalize_update'\n  * executing \"chmod -R -- g+w /opt/deploy/hello/releases/20121107100343 && rm -rf -- /opt/deploy/hello/releases/20121107100343/public/system && mkdir -p -- /opt/deploy/hello/releases/20121107100343/public/ && ln -s -- /opt/deploy/hello/shared/system /opt/deploy/hello/releases/20121107100343/public/system && rm -rf -- /opt/deploy/hello/releases/20121107100343/log && ln -s -- /opt/deploy/hello/shared/log /opt/deploy/hello/releases/20121107100343/log && rm -rf -- /opt/deploy/hello/releases/20121107100343/tmp/pids && mkdir -p -- /opt/deploy/hello/releases/20121107100343/tmp/ && ln -s -- /opt/deploy/hello/shared/pids /opt/deploy/hello/releases/20121107100343/tmp/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 22ms\n  * executing \"find /opt/deploy/hello/releases/20121107100343/public/images\\\\ /opt/deploy/hello/releases/20121107100343/public/stylesheets\\\\ /opt/deploy/hello/releases/20121107100343/public/javascripts -exec touch -t -- 201211071011.26 {} ';'; true\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n*** [err :: localhost] find: `/opt/deploy/hello/releases/20121107100343/public/images /opt/deploy/hello/releases/20121107100343/public/stylesheets /opt/deploy/hello/releases/20121107100343/public/javascripts': No such file or directory\n    command finished in 17ms\n=> nil\n\n\n\ncreate_symlink\nload \"deploy\"\u3067\u81ea\u52d5\u7684\u306b\u5b9a\u7fa9\u3055\u308c\u305fattribute\u306f\u3001\u5404\u30bf\u30b9\u30af\u3067\u4f7f\u3044\u56de\u3055\u308c\u3066\u3044\u308b\u3002\n\nPry-Console\n> config.release_name\n=> \"20121107100343\"\n\n> config.release_path      \n=> \"/opt/deploy/hello/releases/20121107100343\"\n\n\n\nPry-Console\n> config.deploy.create_symlink \n  * 2012-11-07 10:22:00 executing `deploy:create_symlink'\n  * executing \"rm -f /opt/deploy/hello/current && ln -s /opt/deploy/hello/releases/20121107100343 /opt/deploy/hello/current\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 11ms\n=> nil\n\n\n\n\u307e\u3068\u3081\nCapistrano::Configuration\u3092\u3046\u307e\u3044\u3053\u3068\u64cd\u4f5c\u3067\u304d\u308c\u3070\u3001Dev\u5411\u3051\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u5171\u6709\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3092\u4f5c\u308c\u305d\u3046\u306a\u6c17\u304c\u3059\u308b\u3002\n<!-- too_old -->\n> **\u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u304b\u30891\u5e74\u4ee5\u4e0a\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002** \u6c17\u3092\u3064\u3051\u3066\u306d\u3002\n\n\nRuby\u88fd\u306e\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30ebCapistrano\u306f\u4f55\u304b\u3068\u4fbf\u5229\u3067\u3088\u304f\u3064\u304b\u3046\u3002Rails\u306b\u304b\u304e\u3089\u305a\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u304b\u3089\u4f55\u304b\u3092\u6301\u3063\u3066\u304f\u308b\u7528\u9014\u306b\u5411\u3044\u3066\u3044\u308b\u3002\n\ncap\u30b3\u30de\u30f3\u30c9\u304b\u3089\u5b9f\u884c\u3059\u308b\u306e\u3082\u3044\u3044\u304c\u3001\u9069\u5f53\u306aSinatra\u30a2\u30d7\u30ea\u306b\u7d44\u307f\u8fbc\u3093\u3060\u308a\u3067\u304d\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u601d\u3044\u3001\u611f\u89e6\u3092\u3064\u304b\u3080\u305f\u3081irb\u306a\u3093\u304b\u3067\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u53e9\u3044\u3066\u307f\u305f\u3002\n\n\u5358\u7d14\u306bCapistrano\u306eWEB-UI\u304c\u5fc5\u8981\u306a\u3089rails\u3067\u4f5c\u3089\u308c\u305f[Webistrano](https://github.com/peritor/webistrano)\u3068\u3044\u3046\u306e\u304c\u3042\u308b\u3002\u5143\u306f\u53e4\u3044\u3051\u3069\u5e7e\u3064\u304b\u306e\u30d5\u30a9\u30fc\u30af\u3055\u308c\u305f\u3082\u306e\u306f\u65b0\u3057\u3081\u306e\u74b0\u5883\u3067\u3082\u52d5\u4f5c\u3059\u308b\u3088\u3046\u3060\u3002\n\nCapistrano\u30bd\u30fc\u30b9\u306e\u30c1\u30a7\u30c3\u30af\u306b\u306f[\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0Ruby](http://www.amazon.co.jp/dp/4048687158)\u3092\u304b\u306a\u308a\u53c2\u8003\u306b\u3057\u305f\u3002\n\n## \u307e\u305a\u306f Capistrano::Configuration.new\n\n\u4eca\u56de\u306fRuby\u306e\u5b9f\u884c\u306b[Pry](http://pryrepl.org/)\u3092\u4f7f\u3046\u3002\n\n\u3069\u3046\u3084\u3089Capistrano\u306e\u3059\u3079\u3066\u306f`Capistrano::Configuration`\u30af\u30e9\u30b9\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u96c6\u307e\u308b\u6a21\u69d8\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```ruby:Pry-Console\n> require 'capistrano'\n=> true\n\n> config = Capistrano::Configuration.new\n=> #<Capistrano::Configuration:0x00000001f26678\n @callbacks={},\n @debug=false,\n @dry_run=false,\n @load_paths=\n  [\".\",\n   \"/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/recipes\"],\n @loaded_features=[],\n @logger=\n  #<Capistrano::Logger:0x00000001f264c0\n   @device=#<IO:<STDERR>>,\n   @disable_formatters=nil,\n   @level=0,\n   @options={}>,\n @name=nil,\n @namespaces={},\n @original_procs={},\n @parent=nil,\n @preserve_roles=false,\n @roles={},\n @tasks={},\n @variable_locks=\n  {:ssh_options=>%<8d5c2f16Mutex:0x00000001f26150>,\n   :logger=>#<Mutex:0x00000001f25fc0>,\n   :default_environment=>#<Mutex:0x00000001f25368>,\n   :default_run_options=>#<Mutex:0x00000001f251b0>},\n @variables=\n  {:ssh_options=>{},\n   :logger=>\n    #<Capistrano::Logger:0x00000001f264c0\n     @device=#<IO:<STDERR>>,\n     @disable_formatters=nil,\n     @level=0,\n     @options={}>,\n   :default_environment=>{},\n   :default_run_options=>{}}>\n```\n\nCapistrano\u306e`Capfile, deploy.rb`\u306a\u3069\u306b\u51fa\u3066\u304f\u308b\u5358\u8a9e\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5909\u6570\u3068\u3057\u3066\u305f\u304f\u3055\u3093\u51fa\u3066\u304f\u308b\u3002\n\n### \u7d99\u627f\u30c1\u30a7\u30c3\u30af\n\n\u5404\u30e2\u30b8\u30e5\u30fc\u30eb\u3084\u30af\u30e9\u30b9\u304b\u3089\u3001CLI\u30c4\u30fc\u30eb\u3067\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u6642\u306eCapitrano\u306e\u5404\u6319\u52d5\u304c\u57a3\u9593\u898b\u308c\u308b\u3002\n\n```ruby:Pry-Console\n> config.class.ancestors\n=> [Capistrano::Configuration,\n Capistrano::Configuration::Callbacks,\n Capistrano::Configuration::Actions::FileTransfer,\n Capistrano::Configuration::Actions::Inspect,\n Capistrano::Configuration::Actions::Invocation,\n Capistrano::Configuration::AliasTask,\n Capistrano::Configuration::Connections,\n Capistrano::Configuration::Execution,\n Capistrano::Configuration::Loading,\n Capistrano::Configuration::LogFormatters,\n Capistrano::Configuration::Namespaces,\n Capistrano::Configuration::Roles,\n Capistrano::Configuration::Servers,\n Capistrano::Configuration::Variables,\n Object,\n PP::ObjectMixin,\n Kernel,\n BasicObject]\n```\n\n### \u51fa\u529b\u3092\u8a73\u7d30\u306b\u5909\u66f4\n\n\u3053\u3053\u3067`@logger`\u3092TRACE\u30ec\u30d9\u30eb\u306b\u3057\u3066\u3001Capistrano\u304c\u5b9f\u884c\u3059\u308b\u5185\u5bb9\u3092\u9010\u4e00\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n```ruby:Pry-Console\n> Capistrano::Logger.constants\n=> [:IMPORTANT, :INFO, :DEBUG, :TRACE, :MAX_LEVEL, :COLORS, :STYLES]\n\n> config.logger.level = Capistrano::Logger::TRACE\n=> 3\n```\n\n\n## Namespace\u3068\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\n\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u30bf\u30b9\u30af\u306f\u4f55\u3082\u306a\u3044\u3002\nconfing\u306b\u3064\u3044\u305f`#namespace`\u306f\u30bf\u30b9\u30af\u3092\u52d5\u7684\u306b\u5b9a\u7fa9\u3059\u308b\u3001\u3053\u308c\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\u3002\n\n```ruby:Pry-Console\n> config.namespace :hello do\n*   task :world do\n*     run \"echo Hello World ?\"\n*   end  \n* end  \n=> #<Proc:0x000000022dadf0@/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/configuration/namespaces.rb:83 (lambda)>\n```\n\nProc\u3060\u3063\u305f\u3001\u3069\u3053\u304b\u3067call\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n### \u30bf\u30b9\u30afProc\u306e\u683c\u7d0d\u5148\n\nconfig\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305f\u3069\u3063\u3066\u3044\u304f\u3002\n\n```ruby:Pry-Console\n> config.namespaces.keys\n=> [:hello]\n\n> config.namespaces[:hello].tasks.keys\n=> [:world]\n\n> config.namespaces[:hello].tasks[:world].body\n=> #<Proc:0x000000022db110@(pry):9>\n```\n\n\u3042\u3063\u305f\u3001`#call`\u3092\u53e9\u3044\u3066\u307f\u3088\u3046\u3002\u4e2d\u8eab\u306e`run`\u304c\u547c\u3070\u308c\u308b\u3002\n\n```ruby:Pry-Console\n> config.namespaces[:hello].tasks[:world].body.call\n  * executing \"echo Hello World ?\"\nCapistrano::NoMatchingServersError: no servers found to match {:eof=>true}\nfrom /usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/configuration/connections.rb:174:in `execute_on_servers'\n```\n\n`run`\u306f\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u3092\u5fc5\u8981\u3068\u3059\u308b\u306e\u3067\u30b5\u30fc\u30d0\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\n## Role(server)\u306e\u8ffd\u52a0\n\nnamespace\u306e\u65b9\u6cd5\u304b\u3089\u63a8\u6e2c\u3067\u304d\u308b\u304c\u3001\u3053\u308c\u3082\u30ec\u30b7\u30d4\u901a\u308a\u306b\u5b9a\u7fa9\u51fa\u6765\u308b\u3002`config.`\u3092\u9664\u3051\u3070Capistrano\u4f7f\u3044\u306b\u306f\u304a\u306a\u3058\u307f\u306e\u5185\u5bb9\u3002\n\u3053\u3046\u3044\u3046\u5185\u90e8DSL\u306e\u5b9f\u88c5\u306f[\u30e1\u30bf\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0Ruby](http://www.amazon.co.jp/dp/4048687158)\u3092\u307f\u305f\u3089\u4f55\u3068\u306a\u304f\u308f\u304b\u308b\u3002\n\n```ruby:Pry-Console\n> config.server \"localhost\", :web\n=> [:web]\n```\n\n\u7a7a\u3060\u3063\u305f`@roles`\u306b\u30b5\u30fc\u30d0\u30ea\u30b9\u30c8\u304c\u4ee3\u5165\u3055\u308c\u305f\u3002\n\n```ruby:Pry-Console\n> config.roles          \n=> {:web=>\n  #<Capistrano::Role:0x00000002427870\n   @dynamic_servers=[],\n   @static_servers=[localhost]>}\n```\n\n### \u30bf\u30b9\u30af\u306e\u5b9f\u884c\u30922\u901a\u308a\u306e\u66f8\u5f0f\u3067\n\n\u307e\u305a\u5148\u307b\u3069\u30b3\u30b1\u305f`#call`\u3002\n\n```ruby:Pry-Console\n> config.namespaces[:hello].tasks[:world].body.call\n  * executing \"echo Hello World ?\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n ** [out :: localhost] Hello World ?\n    command finished in 171ms\n=> nil\n```\n\n\u3053\u308c\u306f\u6b21\u306e\u66f8\u5f0f\u3067\u3082\u4e00\u7dd2\u306b\u306a\u308b\u3001\u8981\u306fCapistrano\u30ec\u30b7\u30d4\u3068\u4e00\u7dd2\u3060\u3002\n\n```ruby:Pry-Console\n> config.hello.world \n  * 2012-11-07 09:12:24 executing `hello:world'\n  * executing \"echo Hello World ?\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n ** [out :: localhost] Hello World ?\n    command finished in 7ms\n=> nil\n```\n\nnamespace\u306b\u3088\u3063\u3066\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066\u5b9a\u7fa9\u3055\u308c\u3066\u308b\u306e\u3067config\u304b\u3089\u547c\u3079\u308b\u3002\n\n```ruby:Pry-Console\n> config.methods(false)\n=> [:hello,\n :_cset,\n :scm_default,\n :depend,\n :with_env,\n :run_locally,\n :try_sudo,\n :try_runner]\n```\n\n\u3053\u308c\u3067\u3072\u3068\u307e\u305aRole\u3078\u306e\u30bf\u30b9\u30af\u5b9f\u884c\u304c\u51fa\u6765\u305f\u3002\n\n\n## \u3044\u3064\u3082\u306e cap deploy \u3092load\u3057\u3066\u307f\u308b\n\n`@load_paths`\u306b\u306f\u7d44\u8fbc\u307f\u30ec\u30b7\u30d4\u3078\u306e\u30d1\u30b9\u304c\u3042\u308b\u3002\n\n```ruby:Pry-Console\n> config.load_paths\n=> [\".\", \"/usr/local/rvm/gems/ruby-1.9.3-p286@cap/gems/capistrano-2.13.5/lib/capistrano/recipes\"]\n```\n\n`#load`\u3092\u4f7f\u3046\u3068\u7d44\u307f\u8fbc\u3081\u308b\u3001\u3053\u308c\u3067\u3044\u3064\u3082\u306e`deploy`\u7cfb\u30bf\u30b9\u30af\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002\n\n```ruby:Pry-Console\n> config.load \"deploy\"\n=> [\"deploy\"]\n\n> config.namespaces.keys\n=> [:hello, :deploy]\n```\n\nCLI\u5b9f\u884c\u3092\u88dc\u8db3\u3059\u308b\u3068capify\u3067\u4f5c\u6210\u3057\u305fCapfile\u306b\u3042\u308b`load \"deploy\"`\u3067\u3053\u308c\u3068\u540c\u3058\u3053\u3068\u3092\u884c\u306a\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n### \u7d44\u307f\u8fbc\u307f\u306eDeploy\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\n\n\u30ed\u30fc\u30c9\u3057\u305f`deploy`\u30ec\u30b7\u30d4\u306e\u30bf\u30b9\u30af\u4e00\u89a7\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u304a\u306a\u3058\u307f\u306e\u9762\u3005\u304c\u4e26\u3093\u3067\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n\n```ruby:Pry-Console\n> config.namespaces[:deploy].tasks.keys\n=> [:default,\n :setup,\n :update,\n :update_code,\n :finalize_update,\n :symlink,\n :create_symlink,\n :upload,\n :restart,\n :migrate,\n :migrations,\n :cleanup,\n :check,\n :cold,\n :start,\n :stop]\n```\n\n#### \u8efd\u305d\u3046\u306adeploy:setup\u304b\u3089\n\n\u3082\u3061\u308d\u3093`#set` \u304c\u4f7f\u3048\u308b\u306e\u3067\u3001setup\u306b\u5fc5\u9808\u306e\u30d1\u30e9\u30e1\u30fc\u30bf`:deploy_to`\u3092\u5b9a\u7fa9\u3057\u305f\u3089`setup`\u5b9f\u884c\u3002\n\n```ruby:Pry-Console\n> config.set :deploy_to, \"/opt/deploy/hello\"\n=> \"/opt/deploy/hello\"\n\n\n> config.deploy.setup\n  * 2012-11-07 09:34:17 executing `deploy:setup'\n  * executing \"sudo -p 'sudo password: ' mkdir -p /opt/deploy/hello /opt/deploy/hello/releases /opt/deploy/hello/shared /opt/deploy/hello/shared/system /opt/deploy/hello/shared/log /opt/deploy/hello/shared/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 14ms\n  * executing \"sudo -p 'sudo password: ' chmod g+w /opt/deploy/hello /opt/deploy/hello/releases /opt/deploy/hello/shared /opt/deploy/hello/shared/system /opt/deploy/hello/shared/log /opt/deploy/hello/shared/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 11ms\n=> nil\n\n\n> Dir.glob(\"/opt/deploy/hello/**/\")\n=> [\"/opt/deploy/hello/\",\n \"/opt/deploy/hello/shared/\",\n \"/opt/deploy/hello/shared/system/\",\n \"/opt/deploy/hello/shared/log/\",\n \"/opt/deploy/hello/shared/pids/\",\n \"/opt/deploy/hello/releases/\"]\n```\n\nCapistrano\u307d\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30c4\u30ea\u30fc\u304c\u51fa\u6765\u305f\u3002\n\n### \u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b(update_code, create_symlink)\n\n`deploy`\u30ec\u30b7\u30d4\u3092\u7d44\u307f\u8fbc\u3093\u3060\u3053\u3068\u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305fAttribute\u3092\u30c1\u30a7\u30c3\u30af\u3002\n\n```ruby:Pry-Console\n> config.namespaces[:deploy].variables.keys\n=> [:ssh_options,\n :logger,\n :default_environment,\n :default_run_options,\n :application,\n :repository,\n :scm,\n :deploy_via,\n :deploy_to,\n :revision,\n :rails_env,\n :rake,\n :source,\n :real_revision,\n :strategy,\n :release_name,\n :version_dir,\n :shared_dir,\n :shared_children,\n :current_dir,\n :releases_path,\n :shared_path,\n :current_path,\n :release_path,\n :releases,\n :current_release,\n :previous_release,\n :current_revision,\n :latest_revision,\n :previous_revision,\n :run_method,\n :latest_release]\n```\n\n\u8981\u308b\u3082\u306e\u3060\u3051\u4e0a\u66f8\u304d\uff06\u5b9a\u7fa9\u3059\u308b\u3001\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u306e\u60c5\u5831\u304c\u3042\u308c\u3070OK\u3002\n\n```ruby:Pry-Console\n> config.set :scm, 'git'\n=> \"git\"\n\n> config.set :repository, 'https://github.com/higanworks/Files_and_Tasks.git'\n=> \"https://github.com/higanworks/Files_and_Tasks.git\"\n\n\n> config.deploy.check          \n  * 2012-11-07 10:27:26 executing `deploy:check'\n  * executing \"test -d /opt/deploy/hello/releases\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 7ms\n  * executing \"test -w /opt/deploy/hello\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 5ms\n  * executing \"test -w /opt/deploy/hello/releases\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 5ms\n  * executing \"which git\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 7ms\nYou appear to have all necessary dependencies installed\n=> nil\n```\n\n#### update_code\n\n`Github`\u304b\u3089\u30b3\u30fc\u30c9\u3092\u8a2d\u7f6e\u3002\n\n```ruby:Pry-Console\n> config.deploy.update_code\n  * 2012-11-07 10:11:19 executing `deploy:update_code'\n  * executing \"git clone -q https://github.com/higanworks/Files_and_Tasks.git /opt/deploy/hello/releases/20121107100343 && cd /opt/deploy/hello/releases/20121107100343 && git checkout -q -b deploy ea5f5e0f9e782305dcd3c27a091fe6c8387760c6 && (echo ea5f5e0f9e782305dcd3c27a091fe6c8387760c6 > /opt/deploy/hello/releases/20121107100343/REVISION)\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 6293ms\n  * 2012-11-07 10:11:26 executing `deploy:finalize_update'\n  * executing \"chmod -R -- g+w /opt/deploy/hello/releases/20121107100343 && rm -rf -- /opt/deploy/hello/releases/20121107100343/public/system && mkdir -p -- /opt/deploy/hello/releases/20121107100343/public/ && ln -s -- /opt/deploy/hello/shared/system /opt/deploy/hello/releases/20121107100343/public/system && rm -rf -- /opt/deploy/hello/releases/20121107100343/log && ln -s -- /opt/deploy/hello/shared/log /opt/deploy/hello/releases/20121107100343/log && rm -rf -- /opt/deploy/hello/releases/20121107100343/tmp/pids && mkdir -p -- /opt/deploy/hello/releases/20121107100343/tmp/ && ln -s -- /opt/deploy/hello/shared/pids /opt/deploy/hello/releases/20121107100343/tmp/pids\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 22ms\n  * executing \"find /opt/deploy/hello/releases/20121107100343/public/images\\\\ /opt/deploy/hello/releases/20121107100343/public/stylesheets\\\\ /opt/deploy/hello/releases/20121107100343/public/javascripts -exec touch -t -- 201211071011.26 {} ';'; true\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n*** [err :: localhost] find: `/opt/deploy/hello/releases/20121107100343/public/images /opt/deploy/hello/releases/20121107100343/public/stylesheets /opt/deploy/hello/releases/20121107100343/public/javascripts': No such file or directory\n    command finished in 17ms\n=> nil\n```\n\n#### create_symlink\n\n`load \"deploy\"`\u3067\u81ea\u52d5\u7684\u306b\u5b9a\u7fa9\u3055\u308c\u305fattribute\u306f\u3001\u5404\u30bf\u30b9\u30af\u3067\u4f7f\u3044\u56de\u3055\u308c\u3066\u3044\u308b\u3002\n\n```ruby:Pry-Console\n> config.release_name\n=> \"20121107100343\"\n\n> config.release_path      \n=> \"/opt/deploy/hello/releases/20121107100343\"\n```\n\n\n```ruby:Pry-Console\n> config.deploy.create_symlink \n  * 2012-11-07 10:22:00 executing `deploy:create_symlink'\n  * executing \"rm -f /opt/deploy/hello/current && ln -s /opt/deploy/hello/releases/20121107100343 /opt/deploy/hello/current\"\n    servers: [\"localhost\"]\n    [localhost] executing command\n    command finished in 11ms\n=> nil\n```\n\n\n## \u307e\u3068\u3081\n`Capistrano::Configuration`\u3092\u3046\u307e\u3044\u3053\u3068\u64cd\u4f5c\u3067\u304d\u308c\u3070\u3001Dev\u5411\u3051\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u5171\u6709\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3092\u4f5c\u308c\u305d\u3046\u306a\u6c17\u304c\u3059\u308b\u3002\n\n"}