{"tags": ["boot2docker", "vps", "CloudatCost"], "context": " More than 1 year has passed since last update.\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nReleases \u00b7 boot2docker/boot2docker \u00b7 GitHub\u304b\u3089boot2docker.iso\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\ndd if=boot2docker.iso of=/dev/sda bs=1M;sync;sync;sync;reboot\n\n\n\u30c7\u30fc\u30bf\u4fdd\u5b58\u9818\u57df\nfdisk /dev/sda\n\n\n500M\u306eswap\u3068\u3001\u6b8b\u308a\u3092sda3\u306b\u5272\u308a\u5f53\u3066\n\nmkswap /dev/sda2\nmkfs.ext4 -L boot2docker-data /dev/sda3\n\n\nreboot\n\n\n/var/lib/boot2docker/bootlocal.sh\n\nOS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\n\n/var/lib/boot2docker/bootlocal.sh\nip addr add 192.168.58.220/24 dev eth0\nip route add default via 192.168.58.1\necho nameserver 8.8.8.8 >> /etc/resolv.conf\n\necho 'TZ=\"JST-9\"' > /etc/sysconfig/timezone\n\nmount -o bind /var/lib/boot2docker/home /home/docker\nsh /home/docker/bin/iptables.sh\nsh /home/docker/bin/startup.sh\n\n\n\n\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\n\n/var/lib/boot2docker/.ssh \u306bdocker\u30e6\u30fc\u30b6\u7528\u9375\u3092\u7f6e\u304f\n\n\nsshd\u8a2d\u5b9a\n\n/mnt/sda3/var/lib/boot2docker/ssh/sshd_config\nUseDNS no\nPort 23421\nPasswordAuthentication no\nPermitRootLogin no\n\n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u7121\u52b9\u306b\u3057\u3066\u3001ssh\u30dd\u30fc\u30c8\u3092\u9069\u5f53\u306b\u5909\u3048\u308b\u3002\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306f\u4ee5\u4e0b\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n\n\n/usr/local/etc/ssh -> /var/lib/boot2docker/ssh/\n\n\n\n\n/home/docker\u306e\u6c38\u7d9a\u5316\nmkdir -p /var/lib/boot2docker/home\nchown -R docker:staff /var/lib/boot2docker/home\nmount -o bind /var/lib/boot2docker/home /home/docker\n\n\n\niptables\n\n\nCentOS - iptables\u306e\u8a2d\u5b9a\u3010\u6700\u5c0f\u69cb\u6210\u3011 - Qiita\u3092\u53c2\u8003\n\n\n/home/docker/bin/iptables.sh\n#!/bin/sh\n\n# iptables \u521d\u671f\u5316\niptables -F INPUT\niptables -F OUTPUT\niptables -F FORWARD\n\n# \u53d7\u4fe1\u3092\u7834\u68c4 / \u9001\u4fe1\u3092\u8a31\u53ef / \u901a\u904e\u3092\u62d2\u5426\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n\n# \u81ea\u30db\u30b9\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u3059\u3079\u3066\u8a31\u53ef\niptables -A INPUT -i lo -j ACCEPT\niptables -A OUTPUT -o lo -j ACCEPT\n\n# \u5185\u90e8\u304b\u3089\u884c\u3063\u305f\u30a2\u30af\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u5916\u90e8\u304b\u3089\u306e\u8fd4\u7b54\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# ping(icmp)\u8a31\u53ef\niptables -I INPUT -p icmp --icmp-type 0 -j ACCEPT\niptables -I INPUT -p icmp --icmp-type 8 -j ACCEPT\n\n#-----------\n# \u30dd\u30fc\u30c8\u958b\u653e\n#-----------\nfor i in 22 80\ndo\n  iptables -A INPUT -p tcp --dport $i -j ACCEPT\ndone\n\n# \u4e0a\u8a18\u306e\u30eb\u30fc\u30eb\u306b\u30de\u30c3\u30c1\u3057\u306a\u304b\u3063\u305f\u30a2\u30af\u30bb\u30b9\u306f\u30ed\u30b0\u3092\u8a18\u9332\u3057\u3066\u7834\u68c4\niptables -A INPUT -m limit --limit 1/s -j LOG --log-prefix '[IPTABLES INPUT] : '\niptables -A INPUT -j DROP\niptables -A FORWARD -m limit --limit 1/s -j LOG --log-prefix '[IPTABLES FORWARD] : '\niptables -A FORWARD -j DROP\n\n\n\nPATH\u306e\u8ffd\u52a0\n\n/home/docker/.profile\nexport PATH=$PATH:~/bin/\n\n\n\nX\u8ee2\u9001\u53ef\u80fd\u306b\u3059\u308b\n\nhttp://tinycorelinux.net/6.x/x86_64/tcz/\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nBASE=http://tinycorelinux.net/6.x/x86_64/tcz\nfor i in \\\n  Xorg-7.7-bin libXinerama libGL libXcursor libXext libX11 libxcb libXau libXdmcp libXdamage libXfixes libxshmfence libXxf86vm libdrm libXrender fontconfig freetype libSM libICE harfbuzz libpng \\\n  libXmu Xorg-fonts\ndo\n  wget $BASE/$i.tcz\n  tce-load -i $i.tcz\ndone\n\n\n\n/usr/local/etc/ssh/sshd_config\nX11Forwarding yes\nX11DisplayOffset 10\n\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n* [Releases \u00b7 boot2docker/boot2docker \u00b7 GitHub](https://github.com/boot2docker/boot2docker/releases)\u304b\u3089boot2docker.iso\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash:\ndd if=boot2docker.iso of=/dev/sda bs=1M;sync;sync;sync;reboot\n```\n\n## \u30c7\u30fc\u30bf\u4fdd\u5b58\u9818\u57df\n\n```bash:\nfdisk /dev/sda\n```\n\n* 500M\u306eswap\u3068\u3001\u6b8b\u308a\u3092sda3\u306b\u5272\u308a\u5f53\u3066\n\n```bash:\nmkswap /dev/sda2\nmkfs.ext4 -L boot2docker-data /dev/sda3\n```\n\n* reboot\n\n\n## /var/lib/boot2docker/bootlocal.sh\n\n* OS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\n```bash:/var/lib/boot2docker/bootlocal.sh\nip addr add 192.168.58.220/24 dev eth0\nip route add default via 192.168.58.1\necho nameserver 8.8.8.8 >> /etc/resolv.conf\n\necho 'TZ=\"JST-9\"' > /etc/sysconfig/timezone\n\nmount -o bind /var/lib/boot2docker/home /home/docker\nsh /home/docker/bin/iptables.sh\nsh /home/docker/bin/startup.sh\n```\n\n# \u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u7f6e\n\n* /var/lib/boot2docker/.ssh \u306bdocker\u30e6\u30fc\u30b6\u7528\u9375\u3092\u7f6e\u304f\n\n## sshd\u8a2d\u5b9a\n\n```bash:/mnt/sda3/var/lib/boot2docker/ssh/sshd_config\nUseDNS no\nPort 23421\nPasswordAuthentication no\nPermitRootLogin no\n```\n\n* \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u7121\u52b9\u306b\u3057\u3066\u3001ssh\u30dd\u30fc\u30c8\u3092\u9069\u5f53\u306b\u5909\u3048\u308b\u3002\n* \u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306f\u4ee5\u4e0b\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n    * `/usr/local/etc/ssh -> /var/lib/boot2docker/ssh/`\n\n### /home/docker\u306e\u6c38\u7d9a\u5316\n\n```bash:\nmkdir -p /var/lib/boot2docker/home\nchown -R docker:staff /var/lib/boot2docker/home\nmount -o bind /var/lib/boot2docker/home /home/docker\n```\n\n----\n\n## iptables\n\n* [CentOS - iptables\u306e\u8a2d\u5b9a\u3010\u6700\u5c0f\u69cb\u6210\u3011 - Qiita](http://qiita.com/asmin/items/59044cd8918afbda1b1e)\u3092\u53c2\u8003\n\n```bash:/home/docker/bin/iptables.sh\n#!/bin/sh\n\n# iptables \u521d\u671f\u5316\niptables -F INPUT\niptables -F OUTPUT\niptables -F FORWARD\n\n# \u53d7\u4fe1\u3092\u7834\u68c4 / \u9001\u4fe1\u3092\u8a31\u53ef / \u901a\u904e\u3092\u62d2\u5426\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n\n# \u81ea\u30db\u30b9\u30c8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u3059\u3079\u3066\u8a31\u53ef\niptables -A INPUT -i lo -j ACCEPT\niptables -A OUTPUT -o lo -j ACCEPT\n\n# \u5185\u90e8\u304b\u3089\u884c\u3063\u305f\u30a2\u30af\u30bb\u30b9\u306b\u5bfe\u3059\u308b\u5916\u90e8\u304b\u3089\u306e\u8fd4\u7b54\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\niptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# ping(icmp)\u8a31\u53ef\niptables -I INPUT -p icmp --icmp-type 0 -j ACCEPT\niptables -I INPUT -p icmp --icmp-type 8 -j ACCEPT\n\n#-----------\n# \u30dd\u30fc\u30c8\u958b\u653e\n#-----------\nfor i in 22 80\ndo\n  iptables -A INPUT -p tcp --dport $i -j ACCEPT\ndone\n\n# \u4e0a\u8a18\u306e\u30eb\u30fc\u30eb\u306b\u30de\u30c3\u30c1\u3057\u306a\u304b\u3063\u305f\u30a2\u30af\u30bb\u30b9\u306f\u30ed\u30b0\u3092\u8a18\u9332\u3057\u3066\u7834\u68c4\niptables -A INPUT -m limit --limit 1/s -j LOG --log-prefix '[IPTABLES INPUT] : '\niptables -A INPUT -j DROP\niptables -A FORWARD -m limit --limit 1/s -j LOG --log-prefix '[IPTABLES FORWARD] : '\niptables -A FORWARD -j DROP\n```\n\n### PATH\u306e\u8ffd\u52a0\n\n```bash:/home/docker/.profile\nexport PATH=$PATH:~/bin/\n```\n\n## X\u8ee2\u9001\u53ef\u80fd\u306b\u3059\u308b\n\n* http://tinycorelinux.net/6.x/x86_64/tcz/\n\n```bash:\u30d1\u30c3\u30b1\u30fc\u30b8\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nBASE=http://tinycorelinux.net/6.x/x86_64/tcz\nfor i in \\\n  Xorg-7.7-bin libXinerama libGL libXcursor libXext libX11 libxcb libXau libXdmcp libXdamage libXfixes libxshmfence libXxf86vm libdrm libXrender fontconfig freetype libSM libICE harfbuzz libpng \\\n  libXmu Xorg-fonts\ndo\n  wget $BASE/$i.tcz\n  tce-load -i $i.tcz\ndone\n```\n\n```bash:/usr/local/etc/ssh/sshd_config \nX11Forwarding yes\nX11DisplayOffset 10\n```\n"}