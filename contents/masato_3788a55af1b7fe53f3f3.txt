{"context": " More than 1 year has passed since last update.Mesublu\u306f\u8907\u6570\u306e\u30c8\u30e9\u30f3\u30dd\u30fc\u30c8\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002REST API\u3067POST\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092MQTT\u3067subscribe\u3057\u3066\u53d7\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30af\u30e9\u30a6\u30c9\u4e0a\u306eDocker\u30db\u30b9\u30c8\u306bMeshblu\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u3042\u3068\u3001localhost\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u3068\u30c7\u30fc\u30bf\u4fdd\u5b58\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\nMeshblu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nMeshblu\u3068Redis\u3001MongoDB\u3001OpenResty\u3001CLI\u30c4\u30fc\u30eb\u306a\u3069\u4e00\u5f0f\u3092Docker Compose\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n$ sudo apt-get update && sudo apt-get install -y git\n$ mkdir ~/iot_apps && cd ~/iot_apps\n$ git clone https://github.com/IDCFChannel/meshblu-compose\n$ cd meshblu-compose\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30d7\u30ea\u30af\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068Meshblu\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ ./bootstrap.sh\n...\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 80/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n\n\ncurl\u3068Mosquitto\nREST\u306fcurl\u3092\u4f7f\u3044\u3001MQTT\u306fMosquitto\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3092\u3057\u307e\u3059\u3002\n$ sudo apt-get install curl mosquitto-clients\n\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u6e96\u5099\nMeshblu\u3067\u306fREST API\u3084MQTT\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092pubsub\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u300c\u30c7\u30d0\u30a4\u30b9\u300d\u3068\u3057\u3066\u7ba1\u7406\u3057\u307e\u3059\u3002\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306f\u30c7\u30d0\u30a4\u30b9\u306f\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u6700\u521d\u306bdocker-compose.yml\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308bCLI\u3092\u4f7f\u3044\u30d7\u30ea\u30bb\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n$ cd ~/iot_apps/meshblu-compose\n$ docker-compose run --rm iotutil register\n\n> iotutil@0.0.1 start /app\n> node app.js \"register\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 8ec3992b           \u2502 ed311cd7-dc09-459b-9aaf-7d1c08186bdd \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001trigger-[1-5]\u3068action-[1-5]\u3068owner\u3092\u3042\u308f\u305b\u3066\u5408\u8a0811\u500b\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u767b\u9332\u3055\u308c\u307e\u3059\u3002\u6a19\u6e96\u51fa\u529b\u3055\u308c\u308bowner\u306e\u30c7\u30d0\u30a4\u30b9\u306f\u4f5c\u6210\u3057\u305f11\u500b\u306e\u30c7\u30d0\u30a4\u30b9\u3059\u3079\u3066\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001trigger-[1-5]\u304b\u3089action-[1-5]\u3078\u672b\u5c3e\u304c\u540c\u3058\u6570\u5b57\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u4e00\u89a7\n\u767b\u9332\u3057\u305f\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002uuid\u3068token\u306fMeshblu\u306e\u30d6\u30ed\u30fc\u30ab\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a8d\u8a3c\u60c5\u5831\u3068\u3057\u3066\u3082\u5229\u7528\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil list\n\n> iotutil@0.0.1 start /app\n> node app.js \"list\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 6e8e63fe \u2502 71a24381-02e2-47f3-bfa6-8174545f2261 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-2 \u2502 85a97be4 \u2502 561bc67b-0c0c-4ad4-a6ec-f1a6163f02b0 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-3 \u2502 ede956b8 \u2502 6a21c6b7-2a1c-40e3-a26c-96b52f48c586 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-4 \u2502 4e120995 \u2502 9f109642-efa9-4973-9bb4-4bc48987e5ec \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-5 \u2502 190ade78 \u2502 12cdc02d-f1ac-43ef-936a-a44565a58f2f \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1  \u2502 a02222d2 \u2502 4dbe71d3-ad32-45e5-99fc-88c225bf11b8 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-2  \u2502 4cb06821 \u2502 6244ee9c-203c-478a-992b-5fe1c5f782cb \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-3  \u2502 54c454e5 \u2502 b3b4cee4-2f19-4c05-904e-1fa139f531bc \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-4  \u2502 6b80470a \u2502 c2986c27-e751-47d1-b655-d1750e3ecb71 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-5  \u2502 3aefc667 \u2502 fd9f1a40-fa99-44f4-a405-49f360c175aa \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\nMesublu\u306e\u72b6\u614b\u78ba\u8a8d\n\nAPI\u306e\u4ed5\u69d8\nMeshblu\u306eREST API\u3084MQTT\u306e\u4f7f\u3044\u65b9\u306fDocumentation\u306e\u30b5\u30a4\u30c8\u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\nSSL\u901a\u4fe1\u306einsecure\u30d5\u30e9\u30b0\u306b\u3064\u3044\u3066\nDocker Compose\u3067Meshbu\u3092\u8d77\u52d5\u3059\u308b\u3068\u30d5\u30ed\u30f3\u30c8\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066OpenResty\u304c\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002Docker\u30db\u30b9\u30c8\u306e80\u3068443\u306b\u30de\u30c3\u30d7\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ docker-compose  ps openresty\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\n\nhttp(80)\u306f\u3059\u3079\u3066https(443)\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3044\u307e\u3059\u3002./bootstrap.sh\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u81ea\u5df1\u7f72\u540d\u306eSSL\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001curl\u30b3\u30de\u30f3\u30c9\u304b\u3089HTTPS\u3092\u4f7f\u3046\u5834\u5408\u306f--insecure\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n~/iot_apps/meshblu-compose/nginx/conf/nginx.conf\nhttp {\n    server {\n        listen 80;\n        server_name localhost;\n        underscores_in_headers on;\n        return 301 https://$host$request_uri;\n    }\n\n\n\nGET /status\ncurl\u304b\u3089Meshblu\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304bstatus\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ curl -X GET \\\n  \"https://localhost/status\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: ed311cd7-dc09-459b-9aaf-7d1c08186bdd\" \\\n  --header \"meshblu_auth_token: 8ec3992b\"\n\n\u7d50\u679c\n{\"meshblu\":\"online\"}\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u3066\u3001\u3059\u3050\u306b\u53d7\u4fe1\u3059\u308b\nMQTT\u30d6\u30ed\u30fc\u30ab\u30fc\u3092\u4f7f\u3063\u305f\u4e00\u756a\u57fa\u672c\u7684\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u304b\u3089\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u30c6\u30b9\u30c8\u7528\u306e\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066trigger-1\u3068action-1\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1: trigger-1\n\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1: action-1\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306ftrigger-1\u3067\u3059\u3002token\u3068uuid\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil show -- -k trigger-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"-k\" \"trigger-1\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 6e8e63fe \u2502 71a24381-02e2-47f3-bfa6-8174545f2261 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306faction-1\u3067\u3059\u3002token\u3068uuid\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil show -- -k action-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"-k\" \"action-1\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword  \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1 \u2502 a02222d2 \u2502 4dbe71d3-ad32-45e5-99fc-88c225bf11b8 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\nMQTT subscribe uuid\n\u6700\u521d\u306bmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u3001action-1\u304cMQTT\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002Meshblu\u3067\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3059\u308b\u30c8\u30d4\u30c3\u30af\u540d\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306euuid\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305fusername\u3068password\u3082\u5fc5\u9808\u9805\u76ee\u3067\u3059\u3002\u305d\u308c\u305e\u308cuuid\u3068token\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ mosquitto_sub \\\n    -h localhost  \\\n    -p 1883  \\\n    -t 4dbe71d3-ad32-45e5-99fc-88c225bf11b8  \\\n    -u 4dbe71d3-ad32-45e5-99fc-88c225bf11b8  \\\n    -P a02222d2 \\\n    -d\n\n\nMQTT publish message\ntrigger-1\u304b\u3089action-1\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002mosquitto_sub\u3068\u540c\u69d8\u306busername\u3068password\u306ftrigger-1\u306euuid\u3068token\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30c8\u30d4\u30c3\u30af\u540d\u306fmessage\u304c\u56fa\u5b9a\u306a\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u9001\u4fe1\u5148\u306fJSON\u5f62\u5f0f\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u306bdevices\u30ad\u30fc\u306e\u5024\u3068\u3057\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002action-1\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u306e\u3067\u3001action-1\u306euuid\u306e4dbe71d3-ad32-45e5-99fc-88c225bf11b8\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u672c\u6587\u306fpayload\u30ad\u30fc\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306e\u4f8b\u3067\u306fJSON\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6587\u5b57\u5217\u3082\u4f7f\u3048\u307e\u3059\u3002\u307e\u305fpayload\u30ad\u30fc\u3068\u5024\u304c\u306a\u304f\u3066\u3082\u7a7a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u65b0\u3057\u3044\u30b7\u30a7\u30eb\u3092\u958b\u304d\u3001mosquitto_pub\u30b3\u30de\u30f3\u30c9\u304b\u3089publish\u3057\u307e\u3059\u3002\n$ mosquitto_pub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\"], \"payload\": {\"led\":\"on\"}}' \\\n  -u 71a24381-02e2-47f3-bfa6-8174545f2261 \\\n  -P 6e8e63fe \\\n  -d\n\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"data\":{\"led\":\"on\"}}\n\n\nHTTP POST /messages\nMQTT\u306esubscriber\u306bREST API\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3057\u3066\u307f\u307e\u3059\u3002REST\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fcurl\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002MQTT\u306epublish\u3068\u540c\u69d8\u306bURL\u306f/messages\u304c\u56fa\u5b9a\u3067\u3059\u3002\u30c8\u30d4\u30c3\u30af\u540d\u3068\u9055\u3044URL\u306e\u65b9\u306f/messages\u3068\u8907\u6570\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306fJSON\u5f62\u5f0f\u306a\u306e\u3067Content-Type: application/json\u304c\u5fc5\u8981\u3067\u3059\u3002\u307e\u305f\u3001trigger-1\u306euuid\u3068token\u306f\u8a8d\u8a3c\u60c5\u5831\u3068\u3057\u3066HTTP\u30d8\u30c3\u30c0\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u5148\u307b\u3069\u306emosquitto_sub\u30b3\u30de\u30f3\u30c9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3001\u65b0\u3057\u3044\u30b7\u30a7\u30eb\u3092\u958b\u304dcurl\u30b3\u30de\u30f3\u30c9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3057\u307e\u3059\u3002\n$ curl -X POST \\\n  \"https://localhost/messages\" \\\n  --insecure  \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"devices\": \"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\", \"payload\": {\"led\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: 71a24381-02e2-47f3-bfa6-8174545f2261\"  \\\n  --header \"meshblu_auth_token: 6e8e63fe\"\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306ePOST\u306b\u6210\u529f\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n{\"devices\":\"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\",\"payload\":{\"led\":\"on\"}}\n\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n{\"data\":{\"led\":\"on\"}}\n\n\n\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u3001\u3042\u3068\u3067\u53d6\u308a\u51fa\u3059\nRaspberry Pi\u3068\u74b0\u5883\u30bb\u30f3\u30b5\u30fc\u304c\u8a08\u6e2c\u3057\u305f\u6e7f\u5ea6\u304c70%\u3092\u8d85\u3048\u305f\u3068\u304d\u306a\u3069\u3001\u7279\u5b9a\u306e\u95be\u5024\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u9001\u4fe1\u3057\u305f\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u304cMQTT\u3084WebSocket\u3067subscribe\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0a\u8a18\u3067\u78ba\u8a8d\u3057\u305f\u3088\u3046\u306bMQTT publish\u3084HTTP POST /messages\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u304cHTTP\u306e\u5834\u5408\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u540c\u671f\u3067\u53d7\u4fe1\u3059\u308b\u306e\u304c\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\nMQTT\u306e\u5834\u5408\u306fdata\u30c8\u30d4\u30c3\u30af\u306b\u3001HTTP\u306e\u5834\u5408\u306f/data/uuid\u306b\u9001\u4fe1\u3057\u3066\u4e00\u5ea6MongoDB\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u306fMongoDB\u306b\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u306eAPI\u3092\u4f7f\u3044\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u30dd\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\nMQTT publish data\ntrigger-1\u304b\u3089\u95be\u5024\u8d8a\u3048\u306e\u30c7\u30fc\u30bf\u3092data\u30c8\u30d4\u30c3\u30af\u306b\u9001\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\u7279\u5b9a\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u305f\u3068\u304d\u306emessage\u30c8\u30d4\u30c3\u30af\u3068\u306f\u7570\u306a\u308a\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u306fdata\u30c8\u30d4\u30c3\u30af\u3092\u56fa\u5b9a\u3067\u4f7f\u3044\u307e\u3059\u3002devices\u30ad\u30fc\u306f\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308buuid\u306a\u306e\u3067trigger-1\u81ea\u8eab\u306euuid\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n$ mosquitto_pub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t data \\\n  -m '{\"devices\": [\"71a24381-02e2-47f3-bfa6-8174545f2261\"], \"payload\": \"trigger on\"}' \\\n  -u 71a24381-02e2-47f3-bfa6-8174545f2261 \\\n  -P 6e8e63fe \\\n  -d\n\n\nMongoDB\u306e\u30c7\u30fc\u30bf\nMondoDB\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002MondoDB\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306fskynet\u3067\u3059\u3002\n$ cd ~/iot_apps/meshblu_compose\n$ docker exec -it meshblucompose_mongo_1 mongo skynet\n\ntrigger-1\u304cmosquitto_pub\u3057\u305f\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n> db.data.find().sort({ $natural: -1 }).limit(1);\n{ \"_id\" : ObjectId(\"55b212f5ac81f6100042b353\"), \"devices\" : [ \"71a24381-02e2-47f3-bfa6-8174545f2261\" ], \"payload\" : \"trigger on\", \"fromUuid\" : \"71a24381-02e2-47f3-bfa6-8174545f2261\", \"uuid\" : \"71a24381-02e2-47f3-bfa6-8174545f2261\", \"timestamp\" : \"2015-07-24T10:27:01.766Z\" }\n\n\nHTTP GET /data/uuid\n\u3053\u306e\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306euuid\u3068token\u306f\u3059\u3079\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u308bowner\u30c7\u30d0\u30a4\u30b9\u306euuid\u3068token\u3092\u8a8d\u8a3c\u60c5\u5831\u306b\u4f7f\u3044\u307e\u3059\u3002\n$ docker-compose run --rm iotutil owner\n\n> iotutil@0.0.1 start /app\n> node app.js \"owner\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 8ec3992b           \u2502 ed311cd7-dc09-459b-9aaf-7d1c08186bdd \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u4e00\u5b9a\u9593\u9694\u3067\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u306estart\u3068finish\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3057\u3066\u3001MongoDB\u306b\u95be\u5024\u8d8a\u3048\u306e\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c2015-07-24T10:27:01.766Z\u3067\u3059\u3002\u30c6\u30b9\u30c8\u306e\u305f\u3081start\u3068finish\u3067\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u306f\u3055\u3080\u3088\u3046\u306b\u30af\u30a8\u30ea\u3057\u307e\u3059\u3002\n$ curl -X GET  \\\n  \"https://localhost/data/71a24381-02e2-47f3-bfa6-8174545f2261?start=2015-07-24T10:25:01.766Z&finish=2015-07-24T10:40:01.766Z&limit=1\"  \\\n  --insecure  \\\n  --header \"meshblu_auth_uuid: ed311cd7-dc09-459b-9aaf-7d1c08186bdd\" \\\n  --header \"meshblu_auth_token: 8ec3992b\"\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306btrigger-1\u304cmosquitto_pub\u304b\u3089\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n{\"data\":[{\"devices\":[\"71a24381-02e2-47f3-bfa6-8174545f2261\"],\"payload\":\"trigger on\",\"fromUuid\":\"71a24381-02e2-47f3-bfa6-8174545f2261\",\"uuid\":\"71a24381-02e2-47f3-bfa6-8174545f2261\",\"timestamp\":\"2015-07-24T10:27:01.766Z\"}]}\n\n[Mesublu](https://developer.octoblu.com/)\u306f\u8907\u6570\u306e\u30c8\u30e9\u30f3\u30dd\u30fc\u30c8\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002REST API\u3067POST\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092MQTT\u3067subscribe\u3057\u3066\u53d7\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30af\u30e9\u30a6\u30c9\u4e0a\u306eDocker\u30db\u30b9\u30c8\u306bMeshblu\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u305f\u3042\u3068\u3001localhost\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u3068\u30c7\u30fc\u30bf\u4fdd\u5b58\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n## Meshblu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nMeshblu\u3068Redis\u3001MongoDB\u3001OpenResty\u3001CLI\u30c4\u30fc\u30eb\u306a\u3069\u4e00\u5f0f\u3092Docker Compose\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[\u3053\u3061\u3089](https://github.com/IDCFChannel/meshblu-compose)\u3067\u3059\u3002\n\n```bash\n$ sudo apt-get update && sudo apt-get install -y git\n$ mkdir ~/iot_apps && cd ~/iot_apps\n$ git clone https://github.com/IDCFChannel/meshblu-compose\n$ cd meshblu-compose\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30d7\u30ea\u30af\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068Meshblu\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ ./bootstrap.sh\n...\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 80/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n```\n\n\n### curl\u3068Mosquitto\n\nREST\u306fcurl\u3092\u4f7f\u3044\u3001MQTT\u306f[Mosquitto](http://mosquitto.org/)\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3092\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo apt-get install curl mosquitto-clients\n```\n\n\n## \u30c7\u30d0\u30a4\u30b9\u306e\u6e96\u5099\n\nMeshblu\u3067\u306fREST API\u3084MQTT\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092pubsub\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u300c\u30c7\u30d0\u30a4\u30b9\u300d\u3068\u3057\u3066\u7ba1\u7406\u3057\u307e\u3059\u3002\n\n### \u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306f\u30c7\u30d0\u30a4\u30b9\u306f\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u6700\u521d\u306bdocker-compose.yml\u306b\u4ed8\u5c5e\u3057\u3066\u3044\u308bCLI\u3092\u4f7f\u3044\u30d7\u30ea\u30bb\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```bash\n$ cd ~/iot_apps/meshblu-compose\n$ docker-compose run --rm iotutil register\n\n> iotutil@0.0.1 start /app\n> node app.js \"register\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 8ec3992b           \u2502 ed311cd7-dc09-459b-9aaf-7d1c08186bdd \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001`trigger-[1-5]`\u3068`action-[1-5]`\u3068owner\u3092\u3042\u308f\u305b\u3066\u5408\u8a0811\u500b\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u767b\u9332\u3055\u308c\u307e\u3059\u3002\u6a19\u6e96\u51fa\u529b\u3055\u308c\u308bowner\u306e\u30c7\u30d0\u30a4\u30b9\u306f\u4f5c\u6210\u3057\u305f11\u500b\u306e\u30c7\u30d0\u30a4\u30b9\u3059\u3079\u3066\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001`trigger-[1-5]`\u304b\u3089`action-[1-5]`\u3078\u672b\u5c3e\u304c\u540c\u3058\u6570\u5b57\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\n\n### \u30c7\u30d0\u30a4\u30b9\u306e\u4e00\u89a7\n\n\u767b\u9332\u3057\u305f\u30c7\u30d0\u30a4\u30b9\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002uuid\u3068token\u306fMeshblu\u306e\u30d6\u30ed\u30fc\u30ab\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u8a8d\u8a3c\u60c5\u5831\u3068\u3057\u3066\u3082\u5229\u7528\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose run --rm iotutil list\n\n> iotutil@0.0.1 start /app\n> node app.js \"list\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 6e8e63fe \u2502 71a24381-02e2-47f3-bfa6-8174545f2261 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-2 \u2502 85a97be4 \u2502 561bc67b-0c0c-4ad4-a6ec-f1a6163f02b0 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-3 \u2502 ede956b8 \u2502 6a21c6b7-2a1c-40e3-a26c-96b52f48c586 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-4 \u2502 4e120995 \u2502 9f109642-efa9-4973-9bb4-4bc48987e5ec \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-5 \u2502 190ade78 \u2502 12cdc02d-f1ac-43ef-936a-a44565a58f2f \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1  \u2502 a02222d2 \u2502 4dbe71d3-ad32-45e5-99fc-88c225bf11b8 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-2  \u2502 4cb06821 \u2502 6244ee9c-203c-478a-992b-5fe1c5f782cb \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-3  \u2502 54c454e5 \u2502 b3b4cee4-2f19-4c05-904e-1fa139f531bc \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-4  \u2502 6b80470a \u2502 c2986c27-e751-47d1-b655-d1750e3ecb71 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-5  \u2502 3aefc667 \u2502 fd9f1a40-fa99-44f4-a405-49f360c175aa \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\n## Mesublu\u306e\u72b6\u614b\u78ba\u8a8d\n\n### API\u306e\u4ed5\u69d8\n\nMeshblu\u306eREST API\u3084MQTT\u306e\u4f7f\u3044\u65b9\u306f[Documentation](http://meshblu-http.readme.io/docs)\u306e\u30b5\u30a4\u30c8\u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n### SSL\u901a\u4fe1\u306einsecure\u30d5\u30e9\u30b0\u306b\u3064\u3044\u3066\n\nDocker Compose\u3067Meshbu\u3092\u8d77\u52d5\u3059\u308b\u3068\u30d5\u30ed\u30f3\u30c8\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066OpenResty\u304c\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002Docker\u30db\u30b9\u30c8\u306e80\u3068443\u306b\u30de\u30c3\u30d7\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n```bash\n$ docker-compose  ps openresty\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\n```\n\nhttp(80)\u306f\u3059\u3079\u3066https(443)\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3044\u307e\u3059\u3002`./bootstrap.sh`\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u81ea\u5df1\u7f72\u540d\u306eSSL\u8a3c\u660e\u66f8\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001curl\u30b3\u30de\u30f3\u30c9\u304b\u3089HTTPS\u3092\u4f7f\u3046\u5834\u5408\u306f`--insecure`\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```bash:~/iot_apps/meshblu-compose/nginx/conf/nginx.conf\nhttp {\n    server {\n        listen 80;\n        server_name localhost;\n        underscores_in_headers on;\n        return 301 https://$host$request_uri;\n    }\n```\n\n### GET /status\n\ncurl\u304b\u3089Meshblu\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b`status`\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -X GET \\\n  \"https://localhost/status\" \\\n  --insecure \\\n  --header \"meshblu_auth_uuid: ed311cd7-dc09-459b-9aaf-7d1c08186bdd\" \\\n  --header \"meshblu_auth_token: 8ec3992b\"\n```\n\n\u7d50\u679c\n\n```json\n{\"meshblu\":\"online\"}\n```\n\n## \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u3066\u3001\u3059\u3050\u306b\u53d7\u4fe1\u3059\u308b\n\nMQTT\u30d6\u30ed\u30fc\u30ab\u30fc\u3092\u4f7f\u3063\u305f\u4e00\u756a\u57fa\u672c\u7684\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u304b\u3089\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\u30c6\u30b9\u30c8\u7528\u306e\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066`trigger-1`\u3068`action-1`\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1: trigger-1\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1: action-1\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306ftrigger-1\u3067\u3059\u3002token\u3068uuid\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose run --rm iotutil show -- -k trigger-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"-k\" \"trigger-1\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 6e8e63fe \u2502 71a24381-02e2-47f3-bfa6-8174545f2261 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306faction-1\u3067\u3059\u3002token\u3068uuid\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose run --rm iotutil show -- -k action-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"-k\" \"action-1\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword  \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1 \u2502 a02222d2 \u2502 4dbe71d3-ad32-45e5-99fc-88c225bf11b8 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\n### MQTT subscribe uuid\n\n\u6700\u521d\u306bmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u3001action-1\u304cMQTT\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3057\u307e\u3059\u3002Meshblu\u3067\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092subscribe\u3059\u308b\u30c8\u30d4\u30c3\u30af\u540d\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306euuid\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305fusername\u3068password\u3082\u5fc5\u9808\u9805\u76ee\u3067\u3059\u3002\u305d\u308c\u305e\u308cuuid\u3068token\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```bash\n$ mosquitto_sub \\\n    -h localhost  \\\n    -p 1883  \\\n    -t 4dbe71d3-ad32-45e5-99fc-88c225bf11b8  \\\n    -u 4dbe71d3-ad32-45e5-99fc-88c225bf11b8  \\\n    -P a02222d2 \\\n    -d\n```\n\n### MQTT publish message\n\ntrigger-1\u304b\u3089action-1\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002mosquitto_sub\u3068\u540c\u69d8\u306busername\u3068password\u306ftrigger-1\u306euuid\u3068token\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30c8\u30d4\u30c3\u30af\u540d\u306f`message`\u304c\u56fa\u5b9a\u306a\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\u9001\u4fe1\u5148\u306fJSON\u5f62\u5f0f\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4e2d\u306b`devices`\u30ad\u30fc\u306e\u5024\u3068\u3057\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002action-1\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u306e\u3067\u3001action-1\u306euuid\u306e`4dbe71d3-ad32-45e5-99fc-88c225bf11b8`\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u672c\u6587\u306f`payload`\u30ad\u30fc\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306e\u4f8b\u3067\u306fJSON\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6587\u5b57\u5217\u3082\u4f7f\u3048\u307e\u3059\u3002\u307e\u305f`payload`\u30ad\u30fc\u3068\u5024\u304c\u306a\u304f\u3066\u3082\u7a7a\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n\u65b0\u3057\u3044\u30b7\u30a7\u30eb\u3092\u958b\u304d\u3001mosquitto_pub\u30b3\u30de\u30f3\u30c9\u304b\u3089publish\u3057\u307e\u3059\u3002\n\n```bash\n$ mosquitto_pub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t message \\\n  -m '{\"devices\": [\"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\"], \"payload\": {\"led\":\"on\"}}' \\\n  -u 71a24381-02e2-47f3-bfa6-8174545f2261 \\\n  -P 6e8e63fe \\\n  -d\n```\n\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n```bash\n{\"data\":{\"led\":\"on\"}}\n```\n\n### HTTP POST /messages\n\nMQTT\u306esubscriber\u306bREST API\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3057\u3066\u307f\u307e\u3059\u3002REST\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fcurl\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002MQTT\u306epublish\u3068\u540c\u69d8\u306bURL\u306f`/messages`\u304c\u56fa\u5b9a\u3067\u3059\u3002\u30c8\u30d4\u30c3\u30af\u540d\u3068\u9055\u3044URL\u306e\u65b9\u306f`/messages`\u3068\u8907\u6570\u5f62\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u30e1\u30c3\u30bb\u30fc\u30b8\u306fJSON\u5f62\u5f0f\u306a\u306e\u3067`Content-Type: application/json`\u304c\u5fc5\u8981\u3067\u3059\u3002\u307e\u305f\u3001trigger-1\u306euuid\u3068token\u306f\u8a8d\u8a3c\u60c5\u5831\u3068\u3057\u3066HTTP\u30d8\u30c3\u30c0\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\u5148\u307b\u3069\u306emosquitto_sub\u30b3\u30de\u30f3\u30c9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u72b6\u614b\u3067\u3001\u65b0\u3057\u3044\u30b7\u30a7\u30eb\u3092\u958b\u304dcurl\u30b3\u30de\u30f3\u30c9\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3057\u307e\u3059\u3002\n\n```bash\n$ curl -X POST \\\n  \"https://localhost/messages\" \\\n  --insecure  \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"devices\": \"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\", \"payload\": {\"led\":\"on\"}}' \\\n  --header \"meshblu_auth_uuid: 71a24381-02e2-47f3-bfa6-8174545f2261\"  \\\n  --header \"meshblu_auth_token: 6e8e63fe\"\n```\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306ePOST\u306b\u6210\u529f\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```bash\n{\"devices\":\"4dbe71d3-ad32-45e5-99fc-88c225bf11b8\",\"payload\":{\"led\":\"on\"}}\n```\n\nmosquitto_sub\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\n\n```bash\n{\"data\":{\"led\":\"on\"}}\n```\n\n## \u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u3001\u3042\u3068\u3067\u53d6\u308a\u51fa\u3059\n\nRaspberry Pi\u3068\u74b0\u5883\u30bb\u30f3\u30b5\u30fc\u304c\u8a08\u6e2c\u3057\u305f\u6e7f\u5ea6\u304c70%\u3092\u8d85\u3048\u305f\u3068\u304d\u306a\u3069\u3001\u7279\u5b9a\u306e\u95be\u5024\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u9001\u4fe1\u3057\u305f\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u304cMQTT\u3084WebSocket\u3067subscribe\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0a\u8a18\u3067\u78ba\u8a8d\u3057\u305f\u3088\u3046\u306bMQTT publish\u3084HTTP POST /messages\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u304cHTTP\u306e\u5834\u5408\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u540c\u671f\u3067\u53d7\u4fe1\u3059\u308b\u306e\u304c\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\n\nMQTT\u306e\u5834\u5408\u306f`data`\u30c8\u30d4\u30c3\u30af\u306b\u3001HTTP\u306e\u5834\u5408\u306f`/data/uuid`\u306b\u9001\u4fe1\u3057\u3066\u4e00\u5ea6MongoDB\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u9001\u4fe1\u5148\u306fMongoDB\u306b\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u306eAPI\u3092\u4f7f\u3044\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u30dd\u30fc\u30ea\u30f3\u30b0\u3057\u3066\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\n### MQTT publish data\n\ntrigger-1\u304b\u3089\u95be\u5024\u8d8a\u3048\u306e\u30c7\u30fc\u30bf\u3092`data`\u30c8\u30d4\u30c3\u30af\u306b\u9001\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\u7279\u5b9a\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u305f\u3068\u304d\u306e`message`\u30c8\u30d4\u30c3\u30af\u3068\u306f\u7570\u306a\u308a\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u306f`data`\u30c8\u30d4\u30c3\u30af\u3092\u56fa\u5b9a\u3067\u4f7f\u3044\u307e\u3059\u3002`devices`\u30ad\u30fc\u306f\u3001\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308buuid\u306a\u306e\u3067trigger-1\u81ea\u8eab\u306euuid\u306b\u306a\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```bash\n$ mosquitto_pub \\\n  -h localhost  \\\n  -p 1883 \\\n  -t data \\\n  -m '{\"devices\": [\"71a24381-02e2-47f3-bfa6-8174545f2261\"], \"payload\": \"trigger on\"}' \\\n  -u 71a24381-02e2-47f3-bfa6-8174545f2261 \\\n  -P 6e8e63fe \\\n  -d\n```\n\n### MongoDB\u306e\u30c7\u30fc\u30bf\n\nMondoDB\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308a\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002MondoDB\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306f`skynet`\u3067\u3059\u3002\n\n```bash\n$ cd ~/iot_apps/meshblu_compose\n$ docker exec -it meshblucompose_mongo_1 mongo skynet\n```\n\ntrigger-1\u304cmosquitto_pub\u3057\u305f\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n> db.data.find().sort({ $natural: -1 }).limit(1);\n{ \"_id\" : ObjectId(\"55b212f5ac81f6100042b353\"), \"devices\" : [ \"71a24381-02e2-47f3-bfa6-8174545f2261\" ], \"payload\" : \"trigger on\", \"fromUuid\" : \"71a24381-02e2-47f3-bfa6-8174545f2261\", \"uuid\" : \"71a24381-02e2-47f3-bfa6-8174545f2261\", \"timestamp\" : \"2015-07-24T10:27:01.766Z\" }\n```\n\n### HTTP GET /data/uuid\n\n\u3053\u306e\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30d0\u30a4\u30b9\u306euuid\u3068token\u306f\u3059\u3079\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u308bowner\u30c7\u30d0\u30a4\u30b9\u306euuid\u3068token\u3092\u8a8d\u8a3c\u60c5\u5831\u306b\u4f7f\u3044\u307e\u3059\u3002\n\n```bash\n$ docker-compose run --rm iotutil owner\n\n> iotutil@0.0.1 start /app\n> node app.js \"owner\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 8ec3992b           \u2502 ed311cd7-dc09-459b-9aaf-7d1c08186bdd \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\u4e00\u5b9a\u9593\u9694\u3067\u30ec\u30f3\u30b8\u30af\u30a8\u30ea\u306estart\u3068finish\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3057\u3066\u3001MongoDB\u306b\u95be\u5024\u8d8a\u3048\u306e\u30c7\u30fc\u30bf\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c`2015-07-24T10:27:01.766Z`\u3067\u3059\u3002\u30c6\u30b9\u30c8\u306e\u305f\u3081`start`\u3068`finish`\u3067\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u306f\u3055\u3080\u3088\u3046\u306b\u30af\u30a8\u30ea\u3057\u307e\u3059\u3002\n\n\n```bash\n$ curl -X GET  \\\n  \"https://localhost/data/71a24381-02e2-47f3-bfa6-8174545f2261?start=2015-07-24T10:25:01.766Z&finish=2015-07-24T10:40:01.766Z&limit=1\"  \\\n  --insecure  \\\n  --header \"meshblu_auth_uuid: ed311cd7-dc09-459b-9aaf-7d1c08186bdd\" \\\n  --header \"meshblu_auth_token: 8ec3992b\"\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306btrigger-1\u304cmosquitto_pub\u304b\u3089\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n```json\n{\"data\":[{\"devices\":[\"71a24381-02e2-47f3-bfa6-8174545f2261\"],\"payload\":\"trigger on\",\"fromUuid\":\"71a24381-02e2-47f3-bfa6-8174545f2261\",\"uuid\":\"71a24381-02e2-47f3-bfa6-8174545f2261\",\"timestamp\":\"2015-07-24T10:27:01.766Z\"}]}\n```\n", "tags": ["IoT", "Meshblu1.3", "mqtt", "IDCF\u30af\u30e9\u30a6\u30c9", "rest"]}