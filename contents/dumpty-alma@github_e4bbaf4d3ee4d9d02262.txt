{"tags": ["Bash", "history", "Perl", "script"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u304a\u4ed5\u4e8b\u3092\u3084\u3063\u3066\u3044\u308b\u3068\u304a\u5ba2\u3055\u3093\u306e\u8981\u671b\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u5c65\u6b74\u3084\u305d\u306e\u7d50\u679c\u306a\u3069\u3092\u30ed\u30b0\u306a\u3069\u306b\u4fdd\u7ba1\u3067\u304d\u306a\u3044\u304b\uff1f\u3068\u304a\u8a71\u304c\u51fa\u3066\u304f\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\u79c1\u306e\u7d4c\u9a13\u4e0a\u3001\u3060\u3044\u305f\u3044\u305d\u306e\u8981\u671b\u306f\u904b\u7528\u304c\u958b\u59cb\u3055\u308c\u305f\u5f8c\u3068\u304b\u3001\u4f55\u304b\u3057\u3089\u306e\u554f\u984c\u304c\u3042\u3063\u305f\u6642\u306b\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\u5225\u9014\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5c0e\u5165\u3059\u308b\u624b\u6bb5\u3042\u308b\u304c\u3001\u300c\u306a\u306b\u304b\u3001\u3044\u3044\u611f\u3058\u306e\u65b9\u6cd5\u3067\u306a\u3093\u3068\u304b\u306a\u308a\u307e\u305b\u3093\u304b\uff1f\u300d\u3068\u304b\u3068\u304b\u30e6\u30fc\u30b6\u306e\u8981\u671b\u306f\u5922\u304c\u3042\u308b\u3002\n\u305d\u3093\u306a\u3068\u304d\u3001\u304a\u624b\u88fd\u306e\u65b9\u6cd5\u3067\u305d\u308c\u3063\u307d\u3044\u3053\u3068\u3092\u3084\u308d\u3046\u3063\u3066\u3053\u3068\u3002\n\n\u524d\u63d0\n\nOS\u74b0\u5883\n\nCentOS release 6.7 (Final)\nLinux dumpty-server 2.6.32-573.3.1.el6.x86_64 #1 SMP Thu Aug 13 22:55:16 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n\n\u5229\u7528\u3059\u308b\u30b3\u30de\u30f3\u30c9\n\nbash GNU bash, version 4.1.2(1)-release-(x86_64-redhat-linux-gnu)\nscript\nhistory (sh builtin commands)\nperl v5.10.1 (*) built for x86_64-linux-thread-multi\n\n\n\u4fee\u6b63\u3059\u308b\u30d5\u30a1\u30a4\u30eb\n\n/etc/profile\n/etc/bashrc\n~/.bash_profile\n~/.bash_logout\n~/.bashrc\n\n\n\u624b\u9806\n\nhistory\u30b3\u30de\u30f3\u30c9\u306e\u8868\u793a\u5f62\u5f0f\u3084\u5c65\u6b74\u6570\u3092\u4fee\u6b63\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306ehistory\u30b3\u30de\u30f3\u30c9\u3060\u3068\u3001\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u7528\u306e\u756a\u53f7\u3068\u5b9f\u969b\u6253\u3063\u305f\u30b3\u30de\u30f3\u30c9\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\u3053\u308c\u3067\u306f\u3001history\u30b3\u30de\u30f3\u30c9\u3092\u4fdd\u7ba1\u3057\u3066\u3044\u3066\u3082\u5f79\u306b\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u6295\u4e0b\u6642\u306e\u65e5\u4ed8\u3068\u6642\u9593\u3092\u57cb\u3081\u8fbc\u3080\u3002\n\n/etc/profile\nHISTSIZE=2000\nHISTTIMEFORMAT='%F %T '\nunset HISTCONTROL\nexport HISTSIZE HISTTIMEFORMAT\n\n\n/etc/profile \u306e\u672b\u5c3e\u8fba\u308a\u306b\u300cunset\u300d\u306e\u8a18\u8f09\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3088\u308a\u524d\u306b\u8a18\u8f09\u3059\u308b\u3002\n/etc/profile \u306f\u30e6\u30fc\u30b6\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u306e\u3067\u3001\u4e00\u5ea6\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u8868\u793a\u3092\u78ba\u8a8d\u3057\u3088\u3046\u3002\n\u3061\u306a\u307f\u306b\u3001\u3053\u3053\u306b\u8a18\u8f09\u3057\u3066\u3082script\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306f\u3001\u6709\u52b9\u306b\u306a\u308a\u307e\u305b\u3093\u3002\nscript\u307e\u3067\u74b0\u5883\u5909\u6570\u3092\u9069\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u3001bashrc\u306b\u8a18\u8f09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nhistory_format_view\n 2002  2015-10-04 13:53:40 cat /etc/redhat-release \n 2003  2015-10-04 13:53:52 uname -a\n 2004  2015-10-04 13:54:19 bash -v\n 2005  2015-10-04 13:54:44 bash --help\n 2006  2015-10-04 13:55:04 bash -c help\n 2007  2015-10-04 13:55:20 perl -v\n 2008  2015-10-04 13:55:38 script -v\n 2009  2015-10-04 13:55:42 script --help\n 2010  2015-10-04 13:59:06 vi /etc/profile\n 2011  2015-10-04 14:01:03 history\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3002\n\u3061\u306a\u307f\u306b\u3001history\u306f ~/.bash_history \u306b\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3002\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u3001\u300c#\u300d\u3067\u306f\u3058\u307e\u308b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3002Unix\u30bf\u30a4\u30e0\u306e\u884c\u3002\n\u305d\u3057\u3066\u3001\u5b9f\u969b\u6253\u3063\u305f\u30b3\u30de\u30f3\u30c9\u884c\u3002\n\n.bash_history\n#1443934420\ncat /etc/redhat-release \n#1443934432\nuname -a\n#1443934459\nbash -v\n#1443934484\nbash --help\n#1443934504\nbash -c help\n#1443934520\nperl -v\n#1443934538\nscript -v\n#1443934542\nscript --help\n#1443934746\nvi /etc/profile\n#1443934863\nhistory\n#1443934951\ncd\n#1443934955\ncat ./.bash_history \n\n\n\u3042\u3068\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u5c65\u6b74\u3092\u53d6\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nscript\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u64cd\u4f5c\u5c65\u6b74\u3092\u53d6\u308b\nscript\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u64cd\u4f5c\u5c65\u6b74\u3092\u53d6\u308b\u308f\u3051\u3060\u304c\u3002\n\u6bce\u56de\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u5f8c\u306b\u3001script\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u306e\u306f\u9762\u5012\u3002\n\u306a\u306e\u3067\u3001\u6307\u5b9a\u30e6\u30fc\u30b6\u306e ~/.bash_profile \u306bscript\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8f09\u3059\u308b\u3002\n\n.bash_profile\n# commands script start.\nmkdir -p ~/.cmdarch/script/logs/`date \"+%Y%m\"` && script -q -f ~/.cmdarch/script/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.script.log;\n# commands script end.\nexit 0;\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u4fee\u6b63\u3092\u3057\u305f\u3089\u3001\u518d\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u3053\u306e\u64cd\u4f5c\u306f\u6700\u521d\u306f\u6368\u3066ID\u3067\u3084\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\u6700\u60aa\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3082\u3059\u3050\u306bexit\u3057\u3066\u3057\u307e\u3046\u60b2\u5287\u306e\u7d50\u672b\u3092\u8fce\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3046\u307e\u304f\u3044\u3051\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\nfile_list\n.\n./.cmdarch\n./.cmdarch/script\n./.cmdarch/script/logs\n./.cmdarch/script/logs/201510\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004142549.script.log\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004142602.script.log\n./.zshrc\n./.bash_history\n./.viminfo\n./.bash_logout\n./.bash_profile\n./.bashrc\n\n\n\u3053\u308c\u3067\u3001script\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u5c65\u6b74\u306e\u53d6\u5f97\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u6b21\u306f\u3001history\u30b3\u30de\u30f3\u30c9\u306e\u4fdd\u7ba1\u3092\u884c\u3044\u307e\u3059\u3002\n\nhistory\u30b3\u30de\u30f3\u30c9\u3092.bash_logout\u6642\u306b\u9000\u907f\n\u6700\u521d\u306f\u3001\u5358\u7d14\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u65b9\u6cd5\u3092\u53d6\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n.bash_logout\nmkdir -p ~/.cmdarch/history/logs/`date \"+%Y%m\"` && history > ~/.cmdarch/history/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.history.log;\n\n\n\u3053\u308c\u3060\u3051\u3092\u5b9f\u88c5\u3057\u3066\u3044\u305f\u6642\u306f\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u5148\u307b\u3069\u306escript\u3092\u7d44\u307f\u8fbc\u3093\u3060\u8fba\u308a\u304b\u3089\u3001logout\u304c\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n./bash_profile\u3067\u6700\u5f8c\u306bexit\u3057\u3066\u3044\u308b\u304b\u3089\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3069\u3046\u3082\u9055\u3046\u307f\u305f\u3044\u3002\nhistory\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u304c\u7a7a\u306e\u307e\u307e\u3067\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u2026\u3053\u3053\u306f\u3001\u5b9f\u306f\u539f\u56e0\u3092\u7279\u5b9a\u3067\u304d\u305a\u3001\u7d50\u5c40\u304a\u624b\u88fd\u306eperl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6e96\u5099\u3057\u3066\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001\u6700\u521d\u306b\u3084\u3063\u305fhistory\u7cfb\u306e\u5909\u6570\u3082\u901a\u7528\u3057\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u305f\u3081\u3001/etc/bashrc \u3082\u3057\u304f\u306f ~/.bashrc \u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nbashrc\n#\nHISTSIZE=2000\nHISTTIMEFORMAT='%F %T '\nunset HISTCONTROL\nexport HISTSIZE HISTTIMEFORMAT\n# vim:ts=4:sw=4\n\n\nbashrc\u306e\u672b\u5c3e\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\u4f59\u8ac7\u3067\u3059\u304c\u3001PS1\u3067\u30d7\u30ed\u30f3\u30d7\u30c8\u8868\u793a\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u3082profile\u8a18\u8f09\u3067\u306f\u306a\u304f\u3001bashrc\u306b\u8a18\u8f09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nscript\u306f\u3001\u8d77\u52d5\u6642\u306bSHELL\u5909\u6570\u306b\u3042\u308b\u6307\u5b9a\u306esh\u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u3069\u3046\u3084\u3089\u4e88\u3081\u6301\u3063\u3066\u3044\u305f\u5909\u6570\u306a\u3069\u306f\u7d99\u627f\u3057\u306a\u3044\u305f\u3081\u3001profile\u3067\u8ffd\u52a0\u3057\u305f\u3082\u306e\u306f\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\nSHELL\u5909\u6570\u306b\u305d\u308c\u3092\u8e0f\u307e\u3048\u305f\u8a18\u8f09\u3059\u308c\u3070\u3044\u3044\u3093\u304b\u306a\uff1f\u3068\u304b\u3082\u601d\u3044\u307e\u3057\u305f\u30b1\u30c9\u3002\n\u3055\u3066\u3001\u304a\u8a71\u306f\u5143\u306b\u623b\u3063\u3066\u3001\u304a\u624b\u88fd\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\nhistory_file_convert.pl\n#!/usr/bin/perl\n#+---------------------------------------------------------------+#\n# LinuxOS (CentOS 6.7) Bash buildin command history attach logs\n# +\n#  create : 2015/10/04 Nakashima Keisuke\n#\n# rule:\n#  set /etc/profile\n#   #^ HISTSIZE=2000\n#   #^ HISTTIMEFORMAT='%F %T '\n#   #^ unset HISTCONTROL\n#   #^ export HISTSIZE HISTTIMEFORMAT\n#\n#  usage)\n#     history_file_convert.pl [ .bash_history ]\n#     history_file_convert    [ .bash_history ]\n#\n#+---------------------------------------------------------------+#\n\nsub message {\n    my ($value) = @_;\n    print \"$value \\n\";\n}\n\nsub message_number {\n    my ($value) = @_;\n    print \"$value \";\n}\n\nsub unixtime_to_datetime {\n    my ($unixtime) = @_;\n    my ($sec,$min,$hh,$dd,$mm,$yy,$weak,$yday,$opt) = localtime($unixtime);\n    $yy = $yy + 1900;\n    $mm = $mm + 1;\n    $mm  = 10 > $mm  ? \"0$mm\"  : \"$mm\";\n    $dd  = 10 > $dd  ? \"0$dd\"  : \"$dd\";\n    $hh  = 10 > $hh  ? \"0$hh\"  : \"$hh\";\n    $min = 10 > $min ? \"0$min\" : \"$min\";\n    $sec = 10 > $sec ? \"0$sec\" : \"$sec\";\n    $yyyymmdd       = \"$yy/$mm/$dd\";\n    $hhmmss         = \"$hh:$min:$sec\";\n    $yyyymmddhhmmss = \"$yy/$mm/$dd $hh:$min:$sec\";\n    return $yyyymmddhhmmss;\n}\n\nmy $file = shift;\nif ( ! -f $file ) {\n    exit 9;\n}\nopen(my $fh, \"<\", $file);\nmy $ret = \"\";\nwhile(my $line = readline $fh){\n    chomp $line;\n    if ($line =~ /^#([0-9]+)$/) {\n        $ret = unixtime_to_datetime $1;\n        message_number $ret;\n    } else {\n        message $line;\n    }\n}\nclose $fh;\n\nexit;\n#+---------------------------------------------------------------+#\n\n\n\u4e0a\u8a18\u306eperl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u9069\u5f53\u306a\u5834\u6240\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\u308f\u305f\u3057\u306f\u3001 /usr/local/bin/history_file_convert \u306b\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4f5c\u6210\u5f8c\u306f\u3001chmod+x\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u3055\u3066\u3001.bash_logout\u306b\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n.bash_logout\n# ~/.bash_logout\nmkdir -p ~/.cmdarch/history/logs/`date \"+%Y%m\"` && /usr/local/bin/history_file_convert ~/.bash_history > ~/.cmdarch/history/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.history.log;\n\n\n\u3053\u308c\u3067\u5b8c\u6210\u3067\u3059\u3002\n~/.cmdarch \u306e\u4e2d\u8eab\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nfile_list2\n[minerva@dumpty-server 15:00:25 ~]$ find .\n.\n./.cmdarch\n./.cmdarch/history\n./.cmdarch/history/logs\n./.cmdarch/history/logs/201510\n./.cmdarch/history/logs/201510/dumpty-server.minerva.20151004145455.history.log\n./.cmdarch/script\n./.cmdarch/script/logs\n./.cmdarch/script/logs/201510\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004145502.script.log\n./.zshrc\n./.bash_history\n./.viminfo\n./.bash_logout\n./.bash_profile\n./.bashrc\n[minerva@dumpty-server 15:00:26 ~]$ \n\n\n\u51fa\u6765\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u3042\u3068\u304c\u304d\n\u4eca\u56de\u306f\u3001\u30e6\u30fc\u30b6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u304a\u3044\u3066\u3044\u307e\u3059\u304c\u3001\uff11\u304b\u6240\u306b\u3042\u3064\u3081\u308b\u306e\u3082\u3044\u3044\u3067\u3059\u306d\u3002\n\u3042\u3068\u306f\u3001\u305d\u308c\u3092logrotate\u3059\u308b\u3068\u304b\u3002\n# \u306f\u3058\u3081\u306b\n\u304a\u4ed5\u4e8b\u3092\u3084\u3063\u3066\u3044\u308b\u3068\u304a\u5ba2\u3055\u3093\u306e\u8981\u671b\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u5c65\u6b74\u3084\u305d\u306e\u7d50\u679c\u306a\u3069\u3092\u30ed\u30b0\u306a\u3069\u306b\u4fdd\u7ba1\u3067\u304d\u306a\u3044\u304b\uff1f\u3068\u304a\u8a71\u304c\u51fa\u3066\u304f\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\u79c1\u306e\u7d4c\u9a13\u4e0a\u3001\u3060\u3044\u305f\u3044\u305d\u306e\u8981\u671b\u306f\u904b\u7528\u304c\u958b\u59cb\u3055\u308c\u305f\u5f8c\u3068\u304b\u3001\u4f55\u304b\u3057\u3089\u306e\u554f\u984c\u304c\u3042\u3063\u305f\u6642\u306b\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\u5225\u9014\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5c0e\u5165\u3059\u308b\u624b\u6bb5\u3042\u308b\u304c\u3001\u300c\u306a\u306b\u304b\u3001\u3044\u3044\u611f\u3058\u306e\u65b9\u6cd5\u3067\u306a\u3093\u3068\u304b\u306a\u308a\u307e\u305b\u3093\u304b\uff1f\u300d\u3068\u304b\u3068\u304b\u30e6\u30fc\u30b6\u306e\u8981\u671b\u306f\u5922\u304c\u3042\u308b\u3002\n\u305d\u3093\u306a\u3068\u304d\u3001\u304a\u624b\u88fd\u306e\u65b9\u6cd5\u3067\u305d\u308c\u3063\u307d\u3044\u3053\u3068\u3092\u3084\u308d\u3046\u3063\u3066\u3053\u3068\u3002\n\n# \u524d\u63d0\n\n## OS\u74b0\u5883\n\n- CentOS release 6.7 (Final)\n- Linux dumpty-server 2.6.32-573.3.1.el6.x86_64 #1 SMP Thu Aug 13 22:55:16 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n## \u5229\u7528\u3059\u308b\u30b3\u30de\u30f3\u30c9\n\n- bash GNU bash, version 4.1.2(1)-release-(x86_64-redhat-linux-gnu)\n- script\n- history (sh builtin commands)\n- perl v5.10.1 (*) built for x86_64-linux-thread-multi\n\n## \u4fee\u6b63\u3059\u308b\u30d5\u30a1\u30a4\u30eb\n\n- /etc/profile\n- /etc/bashrc\n- ~/.bash_profile\n- ~/.bash_logout\n- ~/.bashrc\n\n# \u624b\u9806\n\n## history\u30b3\u30de\u30f3\u30c9\u306e\u8868\u793a\u5f62\u5f0f\u3084\u5c65\u6b74\u6570\u3092\u4fee\u6b63\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306ehistory\u30b3\u30de\u30f3\u30c9\u3060\u3068\u3001\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u7528\u306e\u756a\u53f7\u3068\u5b9f\u969b\u6253\u3063\u305f\u30b3\u30de\u30f3\u30c9\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\u3053\u308c\u3067\u306f\u3001history\u30b3\u30de\u30f3\u30c9\u3092\u4fdd\u7ba1\u3057\u3066\u3044\u3066\u3082\u5f79\u306b\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u6295\u4e0b\u6642\u306e\u65e5\u4ed8\u3068\u6642\u9593\u3092\u57cb\u3081\u8fbc\u3080\u3002\n\n```bash:/etc/profile\nHISTSIZE=2000\nHISTTIMEFORMAT='%F %T '\nunset HISTCONTROL\nexport HISTSIZE HISTTIMEFORMAT\n```\n\n/etc/profile \u306e\u672b\u5c3e\u8fba\u308a\u306b\u300cunset\u300d\u306e\u8a18\u8f09\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3088\u308a\u524d\u306b\u8a18\u8f09\u3059\u308b\u3002\n/etc/profile \u306f\u30e6\u30fc\u30b6\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u8aad\u307f\u8fbc\u307e\u308c\u308b\u306e\u3067\u3001\u4e00\u5ea6\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u8868\u793a\u3092\u78ba\u8a8d\u3057\u3088\u3046\u3002\n**\u3061\u306a\u307f\u306b\u3001\u3053\u3053\u306b\u8a18\u8f09\u3057\u3066\u3082script\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306f\u3001\u6709\u52b9\u306b\u306a\u308a\u307e\u305b\u3093\u3002**\n**script\u307e\u3067\u74b0\u5883\u5909\u6570\u3092\u9069\u7528\u3057\u305f\u3044\u5834\u5408\u306f\u3001bashrc\u306b\u8a18\u8f09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002**\n\n```text:history_format_view\n 2002  2015-10-04 13:53:40 cat /etc/redhat-release \n 2003  2015-10-04 13:53:52 uname -a\n 2004  2015-10-04 13:54:19 bash -v\n 2005  2015-10-04 13:54:44 bash --help\n 2006  2015-10-04 13:55:04 bash -c help\n 2007  2015-10-04 13:55:20 perl -v\n 2008  2015-10-04 13:55:38 script -v\n 2009  2015-10-04 13:55:42 script --help\n 2010  2015-10-04 13:59:06 vi /etc/profile\n 2011  2015-10-04 14:01:03 history\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3002\n\u3061\u306a\u307f\u306b\u3001history\u306f ~/.bash_history \u306b\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u308b\u3002\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u3001\u300c#\u300d\u3067\u306f\u3058\u307e\u308b\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3002Unix\u30bf\u30a4\u30e0\u306e\u884c\u3002\n\u305d\u3057\u3066\u3001\u5b9f\u969b\u6253\u3063\u305f\u30b3\u30de\u30f3\u30c9\u884c\u3002\n\n```text:.bash_history\n#1443934420\ncat /etc/redhat-release \n#1443934432\nuname -a\n#1443934459\nbash -v\n#1443934484\nbash --help\n#1443934504\nbash -c help\n#1443934520\nperl -v\n#1443934538\nscript -v\n#1443934542\nscript --help\n#1443934746\nvi /etc/profile\n#1443934863\nhistory\n#1443934951\ncd\n#1443934955\ncat ./.bash_history \n```\n\n\u3042\u3068\u3067\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u5c65\u6b74\u3092\u53d6\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n## script\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u64cd\u4f5c\u5c65\u6b74\u3092\u53d6\u308b\n\nscript\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u64cd\u4f5c\u5c65\u6b74\u3092\u53d6\u308b\u308f\u3051\u3060\u304c\u3002\n\u6bce\u56de\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u5f8c\u306b\u3001script\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u306e\u306f\u9762\u5012\u3002\n\u306a\u306e\u3067\u3001\u6307\u5b9a\u30e6\u30fc\u30b6\u306e ~/.bash_profile \u306bscript\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8f09\u3059\u308b\u3002\n\n```bash:.bash_profile\n# commands script start.\nmkdir -p ~/.cmdarch/script/logs/`date \"+%Y%m\"` && script -q -f ~/.cmdarch/script/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.script.log;\n# commands script end.\nexit 0;\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u4fee\u6b63\u3092\u3057\u305f\u3089\u3001\u518d\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u3053\u306e\u64cd\u4f5c\u306f\u6700\u521d\u306f\u6368\u3066ID\u3067\u3084\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n**\u6700\u60aa\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3082\u3059\u3050\u306bexit\u3057\u3066\u3057\u307e\u3046\u60b2\u5287\u306e\u7d50\u672b\u3092\u8fce\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002**\n\n\u3046\u307e\u304f\u3044\u3051\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n```text:file_list\n.\n./.cmdarch\n./.cmdarch/script\n./.cmdarch/script/logs\n./.cmdarch/script/logs/201510\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004142549.script.log\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004142602.script.log\n./.zshrc\n./.bash_history\n./.viminfo\n./.bash_logout\n./.bash_profile\n./.bashrc\n```\n\n\u3053\u308c\u3067\u3001script\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u5c65\u6b74\u306e\u53d6\u5f97\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u6b21\u306f\u3001history\u30b3\u30de\u30f3\u30c9\u306e\u4fdd\u7ba1\u3092\u884c\u3044\u307e\u3059\u3002\n\n## history\u30b3\u30de\u30f3\u30c9\u3092.bash_logout\u6642\u306b\u9000\u907f\n\n\u6700\u521d\u306f\u3001\u5358\u7d14\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u65b9\u6cd5\u3092\u53d6\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n```bash:.bash_logout\nmkdir -p ~/.cmdarch/history/logs/`date \"+%Y%m\"` && history > ~/.cmdarch/history/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.history.log;\n```\n\n\u3053\u308c\u3060\u3051\u3092\u5b9f\u88c5\u3057\u3066\u3044\u305f\u6642\u306f\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u5148\u307b\u3069\u306escript\u3092\u7d44\u307f\u8fbc\u3093\u3060\u8fba\u308a\u304b\u3089\u3001logout\u304c\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n./bash_profile\u3067\u6700\u5f8c\u306bexit\u3057\u3066\u3044\u308b\u304b\u3089\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3069\u3046\u3082\u9055\u3046\u307f\u305f\u3044\u3002\nhistory\u30b3\u30de\u30f3\u30c9\u81ea\u4f53\u304c\u7a7a\u306e\u307e\u307e\u3067\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u2026\u3053\u3053\u306f\u3001\u5b9f\u306f\u539f\u56e0\u3092\u7279\u5b9a\u3067\u304d\u305a\u3001\u7d50\u5c40\u304a\u624b\u88fd\u306eperl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6e96\u5099\u3057\u3066\u5bfe\u5fdc\u3057\u307e\u3057\u305f\u3002\n\n**\u307e\u305f\u3001\u6700\u521d\u306b\u3084\u3063\u305fhistory\u7cfb\u306e\u5909\u6570\u3082\u901a\u7528\u3057\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002**\n\u3053\u306e\u305f\u3081\u3001/etc/bashrc \u3082\u3057\u304f\u306f ~/.bashrc \u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```bash:bashrc\n#\nHISTSIZE=2000\nHISTTIMEFORMAT='%F %T '\nunset HISTCONTROL\nexport HISTSIZE HISTTIMEFORMAT\n# vim:ts=4:sw=4\n```\n\nbashrc\u306e\u672b\u5c3e\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n**\u4f59\u8ac7\u3067\u3059\u304c\u3001PS1\u3067\u30d7\u30ed\u30f3\u30d7\u30c8\u8868\u793a\u5909\u66f4\u3057\u3066\u3044\u308b\u5834\u5408\u3082profile\u8a18\u8f09\u3067\u306f\u306a\u304f\u3001bashrc\u306b\u8a18\u8f09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002**\nscript\u306f\u3001\u8d77\u52d5\u6642\u306bSHELL\u5909\u6570\u306b\u3042\u308b\u6307\u5b9a\u306esh\u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u3069\u3046\u3084\u3089\u4e88\u3081\u6301\u3063\u3066\u3044\u305f\u5909\u6570\u306a\u3069\u306f\u7d99\u627f\u3057\u306a\u3044\u305f\u3081\u3001profile\u3067\u8ffd\u52a0\u3057\u305f\u3082\u306e\u306f\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\nSHELL\u5909\u6570\u306b\u305d\u308c\u3092\u8e0f\u307e\u3048\u305f\u8a18\u8f09\u3059\u308c\u3070\u3044\u3044\u3093\u304b\u306a\uff1f\u3068\u304b\u3082\u601d\u3044\u307e\u3057\u305f\u30b1\u30c9\u3002\n\n\u3055\u3066\u3001\u304a\u8a71\u306f\u5143\u306b\u623b\u3063\u3066\u3001\u304a\u624b\u88fd\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\n```perl:history_file_convert.pl\n#!/usr/bin/perl\n#+---------------------------------------------------------------+#\n# LinuxOS (CentOS 6.7) Bash buildin command history attach logs\n# +\n#  create : 2015/10/04 Nakashima Keisuke\n#\n# rule:\n#  set /etc/profile\n#   #^ HISTSIZE=2000\n#   #^ HISTTIMEFORMAT='%F %T '\n#   #^ unset HISTCONTROL\n#   #^ export HISTSIZE HISTTIMEFORMAT\n#\n#  usage)\n#     history_file_convert.pl [ .bash_history ]\n#     history_file_convert    [ .bash_history ]\n#\n#+---------------------------------------------------------------+#\n\nsub message {\n    my ($value) = @_;\n    print \"$value \\n\";\n}\n\nsub message_number {\n    my ($value) = @_;\n    print \"$value \";\n}\n\nsub unixtime_to_datetime {\n    my ($unixtime) = @_;\n    my ($sec,$min,$hh,$dd,$mm,$yy,$weak,$yday,$opt) = localtime($unixtime);\n    $yy = $yy + 1900;\n    $mm = $mm + 1;\n    $mm  = 10 > $mm  ? \"0$mm\"  : \"$mm\";\n    $dd  = 10 > $dd  ? \"0$dd\"  : \"$dd\";\n    $hh  = 10 > $hh  ? \"0$hh\"  : \"$hh\";\n    $min = 10 > $min ? \"0$min\" : \"$min\";\n    $sec = 10 > $sec ? \"0$sec\" : \"$sec\";\n    $yyyymmdd       = \"$yy/$mm/$dd\";\n    $hhmmss         = \"$hh:$min:$sec\";\n    $yyyymmddhhmmss = \"$yy/$mm/$dd $hh:$min:$sec\";\n    return $yyyymmddhhmmss;\n}\n\nmy $file = shift;\nif ( ! -f $file ) {\n    exit 9;\n}\nopen(my $fh, \"<\", $file);\nmy $ret = \"\";\nwhile(my $line = readline $fh){\n    chomp $line;\n    if ($line =~ /^#([0-9]+)$/) {\n        $ret = unixtime_to_datetime $1;\n        message_number $ret;\n    } else {\n        message $line;\n    }\n}\nclose $fh;\n\nexit;\n#+---------------------------------------------------------------+#\n```\n\n\u4e0a\u8a18\u306eperl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u9069\u5f53\u306a\u5834\u6240\u306b\u914d\u7f6e\u3057\u307e\u3059\u3002\n\u308f\u305f\u3057\u306f\u3001 /usr/local/bin/history_file_convert \u306b\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u4f5c\u6210\u5f8c\u306f\u3001chmod+x\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3055\u3066\u3001.bash_logout\u306b\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```bash:.bash_logout\n# ~/.bash_logout\nmkdir -p ~/.cmdarch/history/logs/`date \"+%Y%m\"` && /usr/local/bin/history_file_convert ~/.bash_history > ~/.cmdarch/history/logs/`date \"+%Y%m\"`/`hostname`.`whoami`.`date \"+%Y%m%d%H%M%S\"`.history.log;\n```\n\n\u3053\u308c\u3067\u5b8c\u6210\u3067\u3059\u3002\n~/.cmdarch \u306e\u4e2d\u8eab\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```text:file_list2\n[minerva@dumpty-server 15:00:25 ~]$ find .\n.\n./.cmdarch\n./.cmdarch/history\n./.cmdarch/history/logs\n./.cmdarch/history/logs/201510\n./.cmdarch/history/logs/201510/dumpty-server.minerva.20151004145455.history.log\n./.cmdarch/script\n./.cmdarch/script/logs\n./.cmdarch/script/logs/201510\n./.cmdarch/script/logs/201510/dumpty-server.minerva.20151004145502.script.log\n./.zshrc\n./.bash_history\n./.viminfo\n./.bash_logout\n./.bash_profile\n./.bashrc\n[minerva@dumpty-server 15:00:26 ~]$ \n```\n\n\u51fa\u6765\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n# \u3042\u3068\u304c\u304d\n\u4eca\u56de\u306f\u3001\u30e6\u30fc\u30b6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u304a\u3044\u3066\u3044\u307e\u3059\u304c\u3001\uff11\u304b\u6240\u306b\u3042\u3064\u3081\u308b\u306e\u3082\u3044\u3044\u3067\u3059\u306d\u3002\n\u3042\u3068\u306f\u3001\u305d\u308c\u3092logrotate\u3059\u308b\u3068\u304b\u3002\n"}