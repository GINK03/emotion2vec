{"tags": ["CakePHP2.x", "Yii2.x", "MySQL5.6"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nCakePHP 2.x \u3068 Yii 2.x \u3067 MySQL \u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3057\u3066 MySQL \u306e\u30b5\u30a4\u30c8\u306b\u3042\u308b Example Databases \u306e world database (InnoDB version) \u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\n\nPHP 5.4.38\nMySQL 5.6.23\nYii 2.0.3\nCakePHP 2.6.2\n\n\n\u30b5\u30f3\u30d7\u30eb\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c6\u30fc\u30d6\u30eb\u306e\u8a73\u7d30\nmysql> show tables;\n+--------------------+\n| Tables_in_subquery |\n+--------------------+\n| City               |\n| Country            |\n| CountryLanguage    |\n+--------------------+\n\n\u4eca\u56de\u30b5\u30d6\u30af\u30a8\u30ea\u306e\u7d44\u307f\u7acb\u3066\u306b\u4f7f\u3046\u306e\u306f City \u3068 Country \u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3067\u3059:\nmysql> SHOW CREATE TABLE City\\G\n*************************** 1. row ***************************\n       Table: City\nCreate Table: CREATE TABLE `City` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT,\n  `Name` char(35) NOT NULL DEFAULT '',\n  `CountryCode` char(3) NOT NULL DEFAULT '',\n  `District` char(20) NOT NULL DEFAULT '',\n  `Population` int(11) NOT NULL DEFAULT '0',\n  PRIMARY KEY (`ID`),\n  KEY `CountryCode` (`CountryCode`),\n  CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `Country` (`Code`)\n) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1\n1 row in set (0.00 sec)\n\nmysql> SHOW CREATE TABLE Country\\G\n*************************** 1. row ***************************\n       Table: Country\nCreate Table: CREATE TABLE `Country` (\n  `Code` char(3) NOT NULL DEFAULT '',\n  `Name` char(52) NOT NULL DEFAULT '',\n  `Continent` enum('Asia','Europe','North America','Africa','Oceania','Antarctica','South America') NOT NULL DEFAULT 'Asia',\n  `Region` char(26) NOT NULL DEFAULT '',\n  `SurfaceArea` float(10,2) NOT NULL DEFAULT '0.00',\n  `IndepYear` smallint(6) DEFAULT NULL,\n  `Population` int(11) NOT NULL DEFAULT '0',\n  ... \u7701\u7565 ...\n  PRIMARY KEY (`Code`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1\n\n\n\u3069\u3046\u3044\u3046\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3059\u308b\u304b\n\u3069\u3046\u3044\u3046\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3059\u308b\u304b\u306f \u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b \u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u300c\u4eba\u53e3\u304c\u7279\u5b9a\u306e\u90fd\u5e02\u306b\u534a\u5206\u4ee5\u4e0a\u304c\u5bc6\u96c6\u3057\u3066\u3044\u308b\u30a2\u30b8\u30a2\u306e\u56fd\u300d\u3092\u6761\u4ef6\u3068\u3057\u3066\u3001\u305d\u306e\u56fd\u540d\u3092\u5f15\u3063\u5f35\u3063\u3066\u304f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\u76f4\u63a5\u66f8\u3044\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059:\nSELECT Name FROM Country WHERE Continent = 'Asia' AND Code IN (SELECT CountryCode FROM City WHERE Population > Country.Population / 2);\n\n\nCakePHP \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\n\u3068\u308a\u3042\u3048\u305a Country \u3068 City \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059:\n\nCountry.php\nApp::uses('AppModel', 'Model');\n\nclass Country extends AppModel {\n    public $useTable = 'Country';\n    public $primaryKey = 'Code';\n}\n\n\n\nCity.php\nApp::uses('AppModel', 'Model');\n\nclass City extends AppModel {\n    public $useTable = 'City';\n    public $primaryKey = 'ID';\n}\n\n\n\u7d9a\u3044\u3066 CountryController.php \u3092\u4f5c\u6210\u3002\u7c21\u6613\u3067\u306f\u3042\u308a\u307e\u3059\u304c index \u30a2\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066\u3001\u305d\u3053\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u306e\u7d50\u679c\u3092 var_dump() \u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002CakePHP 2.x \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\u306f Cookbook 2.x \u306e Model > Retrieving Your Data > Sub-queries \u306b\u66f8\u304d\u65b9\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059:\n\nCountryController.php\nApp::uses('AppController', 'Controller');\n\nclass CountryController extends AppController {\n\n    public function index() {\n        $db = $this->Country->getDataSource();\n        $this->loadModel('City');\n\n        $subQuery = $db->buildStatement(array(\n            'fields' => array('City.CountryCode'),\n            'table' => $db->fullTableName($this->City),\n            'alias' => 'City',\n            'conditions' => array('City.Population > Country.Population / 2'),\n        ), $this->Country);\n\n        $data = $this->Country->find('all', array(\n            'fields' => array('Country.name'),\n            'conditions' => array(\n                'Country.Continent' => 'Asia',\n                $db->expression('Country.Code IN (' . $subQuery . ')'),\n            ),\n        ));\n\n        var_dump($data);\n        exit;\n    }\n}\n\n\n\u30af\u30a8\u30ea\u306f\u4ee5\u4e0b:\nSELECT `Country`.`name` FROM `subquery`.`Country` AS `Country` WHERE `Country`.`Continent` = 'Asia' AND Country.Code IN (SELECT City.CountryCode FROM `subquery`.`City` AS `City` WHERE `City`.`Population` > `Country`.`Population` / 2)\n\n\u6b63\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059:\narray (size=3)\n  0 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Macao' (length=5)\n  1 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Qatar' (length=5)\n  2 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Singapore' (length=9)\n\n\nYii 2 \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\n\u3053\u308c\u3082\u3068\u308a\u3042\u3048\u305a Gii \u3067 Country, City \u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u307e\u3059:\n\nCountry.php\nnamespace app\\models;\n\nuse Yii;\n\nclass Country extends \\yii\\db\\ActiveRecord\n{\n    public static function tableName()\n    {\n        return 'Country';\n    }\n    ...\n}\n\n\n\nCity.php\nnamespace app\\models;\n\nuse Yii;\n\nclass City extends \\yii\\db\\ActiveRecord\n{\n    public static function tableName()\n    {\n        return 'City';\n    }\n    ...\n}\n\n\n\u7d9a\u3044\u3066 CakePHP \u306e\u4f8b\u3068\u540c\u69d8\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u304a\u90aa\u9b54\u3057\u3066 actionIndex() \u306b\u3066 var_dump() \u3057\u3066\u307f\u307e\u3059\u3002Yii 2.x \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u95a2\u9023\u306e\u60c5\u5831\u306f Guide \u306e Query Builder \u8fba\u308a\u3067\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059:\n\nCountryController.php\nnamespace app\\controllers;\n\nuse yii\\db\\Query;\nuse app\\models\\Country;\n\nclass CountryController extends \\yii\\web\\Controller\n{\n    public function actionIndex()\n    {\n        $subQuery = (new Query)\n            ->select(['CountryCode'])\n            ->from('City')\n            ->where('Population > Country.Population / 2');\n\n        $query = Country::find()\n            ->select(['Name'])\n            ->where(['Continent' => 'Asia', 'Code' => $subQuery])\n            ->createCommand();\n\n        var_dump($query->sql, $query->params);\n        var_dump($query->queryAll());\n        exit;\n    }\n}\n\n\nSQL\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3001\u30af\u30a8\u30ea\u7d50\u679c\u306a\u3069\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059:\nstring 'SELECT `Name` FROM `Country` WHERE (`Continent`=:qp0) AND (`Code` IN (SELECT `CountryCode` FROM `City` WHERE Population > Country.Population / 2))' (length=146)\n\narray (size=1)\n  ':qp0' => string 'Asia' (length=4)\n\narray (size=3)\n  0 => \n    array (size=1)\n      'Name' => string 'Macao' (length=5)\n  1 => \n    array (size=1)\n      'Name' => string 'Qatar' (length=5)\n  2 => \n    array (size=1)\n      'Name' => string 'Singapore' (length=9)\n\nCakePHP, Yii \u3068\u3082\u306b\u30ab\u30e9\u30e0\u306e\u30af\u30aa\u30fc\u30c8\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u304c\u82e5\u5e72\u8352\u3044\u66f8\u304d\u65b9\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u3089\u3078\u3093\u3082\u3046\u3059\u3053\u3057\u8abf\u6574\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nMySQL \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\n\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u3044\u308b\u3068 MySQL 5.6 \u4ee5\u524d\u307e\u3067\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u91cd\u3044\u3060\u3068\u304b\u9045\u3044\u3060\u3068\u304b\u66f8\u304b\u308c\u3066\u3044\u308b\u8a18\u4e8b\u304c\u3051\u3063\u3053\u3046\u3042\u3063\u305f\u3093\u3067\u3059\u304c\u30015.6 \u4ee5\u964d\u3060\u3068\u3001\u4f53\u611f\u7684\u306b\u306f\u5168\u304f\u9045\u3055\u3092\u611f\u3058\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u307e\u305f \u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b \u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306a EXPLAIN \u3067\u5b9f\u884c\u8a08\u753b\u3092\u8abf\u3079\u305f\u969b\u306e select_type \u3082 5.1 \u3068 5.6 \u3067\u306f\u5024\u304c\u7570\u306a\u3063\u3066\u3044\u305f\u308a\u3082\u3057\u307e\u3057\u305f\u3002\n\u9045\u3044\u304b\u3089\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u8cbc\u308d\u3046\u3068\u304b\u3001\u30b5\u30d6\u30af\u30a8\u30ea\u3058\u3083\u306a\u304f\u3066 JOIN \u3067\u3084\u308d\u3046\u3068\u304b\u3092\u8003\u3048\u308b\u5834\u5408\u3001MySQL \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u3061\u3083\u3093\u3068\u8abf\u3079\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u7121\u99c4\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306a\u3069\u304c\u8cbc\u3089\u308c\u3063\u3071\u306a\u3057\u3060\u3063\u305f\u308a\u3059\u308b\u6050\u308c\u3082\u3042\u308b\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nCakePHP Cookbook 2.x Model > Retrieving Your Data > Sub-queries\nYii 2 Guide > Query Builder\n\u6f22(\u30aa\u30c8\u30b3)\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053: \u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b\n\u6f22(\u30aa\u30c8\u30b3)\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053: \u958b\u767a\u30b9\u30d4\u30fc\u30c9\u30a2\u30af\u30bb\u30eb\u5168\u958b\u3076\u3063\u3061\u304e\u308a\uff01\u65e5\u672c\u3088\u3001\u3053\u308c\u304cMySQL 5.6\u3060\u30c3\uff01\uff01\n\n## \u306f\u3058\u3081\u306b\nCakePHP 2.x \u3068 Yii 2.x \u3067 MySQL \u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u3057\u3066 MySQL \u306e\u30b5\u30a4\u30c8\u306b\u3042\u308b [Example Databases](http://dev.mysql.com/doc/index-other.html) \u306e world database (InnoDB version) \u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n## \u74b0\u5883\n* PHP 5.4.38\n* MySQL 5.6.23\n* Yii 2.0.3\n* CakePHP 2.6.2\n\n## \u30b5\u30f3\u30d7\u30eb\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30c6\u30fc\u30d6\u30eb\u306e\u8a73\u7d30\n\n```sql\nmysql> show tables;\n+--------------------+\n| Tables_in_subquery |\n+--------------------+\n| City               |\n| Country            |\n| CountryLanguage    |\n+--------------------+\n```\n\n\u4eca\u56de\u30b5\u30d6\u30af\u30a8\u30ea\u306e\u7d44\u307f\u7acb\u3066\u306b\u4f7f\u3046\u306e\u306f City \u3068 Country \u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3067\u3059:\n\n```\nmysql> SHOW CREATE TABLE City\\G\n*************************** 1. row ***************************\n       Table: City\nCreate Table: CREATE TABLE `City` (\n  `ID` int(11) NOT NULL AUTO_INCREMENT,\n  `Name` char(35) NOT NULL DEFAULT '',\n  `CountryCode` char(3) NOT NULL DEFAULT '',\n  `District` char(20) NOT NULL DEFAULT '',\n  `Population` int(11) NOT NULL DEFAULT '0',\n  PRIMARY KEY (`ID`),\n  KEY `CountryCode` (`CountryCode`),\n  CONSTRAINT `city_ibfk_1` FOREIGN KEY (`CountryCode`) REFERENCES `Country` (`Code`)\n) ENGINE=InnoDB AUTO_INCREMENT=4080 DEFAULT CHARSET=latin1\n1 row in set (0.00 sec)\n\nmysql> SHOW CREATE TABLE Country\\G\n*************************** 1. row ***************************\n       Table: Country\nCreate Table: CREATE TABLE `Country` (\n  `Code` char(3) NOT NULL DEFAULT '',\n  `Name` char(52) NOT NULL DEFAULT '',\n  `Continent` enum('Asia','Europe','North America','Africa','Oceania','Antarctica','South America') NOT NULL DEFAULT 'Asia',\n  `Region` char(26) NOT NULL DEFAULT '',\n  `SurfaceArea` float(10,2) NOT NULL DEFAULT '0.00',\n  `IndepYear` smallint(6) DEFAULT NULL,\n  `Population` int(11) NOT NULL DEFAULT '0',\n  ... \u7701\u7565 ...\n  PRIMARY KEY (`Code`)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1\n```\n\n## \u3069\u3046\u3044\u3046\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3059\u308b\u304b\n\u3069\u3046\u3044\u3046\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3059\u308b\u304b\u306f [\u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b](http://nippondanji.blogspot.jp/2009/03/mysql_25.html) \u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u300c\u4eba\u53e3\u304c\u7279\u5b9a\u306e\u90fd\u5e02\u306b\u534a\u5206\u4ee5\u4e0a\u304c\u5bc6\u96c6\u3057\u3066\u3044\u308b\u30a2\u30b8\u30a2\u306e\u56fd\u300d\u3092\u6761\u4ef6\u3068\u3057\u3066\u3001\u305d\u306e\u56fd\u540d\u3092\u5f15\u3063\u5f35\u3063\u3066\u304f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\u76f4\u63a5\u66f8\u3044\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059:\n\n```sql\nSELECT Name FROM Country WHERE Continent = 'Asia' AND Code IN (SELECT CountryCode FROM City WHERE Population > Country.Population / 2);\n```\n\n## CakePHP \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\n\n\u3068\u308a\u3042\u3048\u305a Country \u3068 City \u30e2\u30c7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059:\n\n```php:Country.php\nApp::uses('AppModel', 'Model');\n\nclass Country extends AppModel {\n\tpublic $useTable = 'Country';\n\tpublic $primaryKey = 'Code';\n}\n```\n\n```php:City.php\nApp::uses('AppModel', 'Model');\n\nclass City extends AppModel {\n\tpublic $useTable = 'City';\n\tpublic $primaryKey = 'ID';\n}\n```\n\n\u7d9a\u3044\u3066 CountryController.php \u3092\u4f5c\u6210\u3002\u7c21\u6613\u3067\u306f\u3042\u308a\u307e\u3059\u304c index \u30a2\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066\u3001\u305d\u3053\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u306e\u7d50\u679c\u3092 var_dump() \u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002CakePHP 2.x \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\u306f Cookbook 2.x \u306e [Model > Retrieving Your Data > Sub-queries](http://book.cakephp.org/2.0/en/models/retrieving-your-data.html#sub-queries) \u306b\u66f8\u304d\u65b9\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059:\n\n```php:CountryController.php\nApp::uses('AppController', 'Controller');\n\nclass CountryController extends AppController {\n\n\tpublic function index() {\n\t\t$db = $this->Country->getDataSource();\n\t\t$this->loadModel('City');\n\n\t\t$subQuery = $db->buildStatement(array(\n\t\t\t'fields' => array('City.CountryCode'),\n\t\t\t'table' => $db->fullTableName($this->City),\n\t\t\t'alias' => 'City',\n\t\t\t'conditions' => array('City.Population > Country.Population / 2'),\n\t\t), $this->Country);\n\n\t\t$data = $this->Country->find('all', array(\n\t\t\t'fields' => array('Country.name'),\n\t\t\t'conditions' => array(\n\t\t\t\t'Country.Continent' => 'Asia',\n\t\t\t\t$db->expression('Country.Code IN (' . $subQuery . ')'),\n\t\t\t),\n\t\t));\n\n\t\tvar_dump($data);\n\t\texit;\n\t}\n}\n```\n\n\u30af\u30a8\u30ea\u306f\u4ee5\u4e0b:\n\n```sql\nSELECT `Country`.`name` FROM `subquery`.`Country` AS `Country` WHERE `Country`.`Continent` = 'Asia' AND Country.Code IN (SELECT City.CountryCode FROM `subquery`.`City` AS `City` WHERE `City`.`Population` > `Country`.`Population` / 2)\n```\n\n\u6b63\u3057\u304f\u66f8\u304b\u308c\u3066\u3044\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308b\u304b\u3068\u601d\u3044\u307e\u3059:\n\n```\narray (size=3)\n  0 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Macao' (length=5)\n  1 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Qatar' (length=5)\n  2 => \n    array (size=1)\n      'Country' => \n        array (size=1)\n          'name' => string 'Singapore' (length=9)\n```\n\n## Yii 2 \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\n\n\u3053\u308c\u3082\u3068\u308a\u3042\u3048\u305a Gii \u3067 Country, City \u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u307e\u3059:\n\n```php:Country.php\nnamespace app\\models;\n\nuse Yii;\n\nclass Country extends \\yii\\db\\ActiveRecord\n{\n    public static function tableName()\n    {\n        return 'Country';\n    }\n    ...\n}\n```\n\n```php:City.php\nnamespace app\\models;\n\nuse Yii;\n\nclass City extends \\yii\\db\\ActiveRecord\n{\n    public static function tableName()\n    {\n        return 'City';\n    }\n    ...\n}\n```\n\n\u7d9a\u3044\u3066 CakePHP \u306e\u4f8b\u3068\u540c\u69d8\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b\u304a\u90aa\u9b54\u3057\u3066 actionIndex() \u306b\u3066 var_dump() \u3057\u3066\u307f\u307e\u3059\u3002Yii 2.x \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u95a2\u9023\u306e\u60c5\u5831\u306f Guide \u306e [Query Builder](http://www.yiiframework.com/doc-2.0/guide-db-query-builder.html) \u8fba\u308a\u3067\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059:\n\n```php:CountryController.php\nnamespace app\\controllers;\n\nuse yii\\db\\Query;\nuse app\\models\\Country;\n\nclass CountryController extends \\yii\\web\\Controller\n{\n    public function actionIndex()\n    {\n        $subQuery = (new Query)\n            ->select(['CountryCode'])\n            ->from('City')\n            ->where('Population > Country.Population / 2');\n\n        $query = Country::find()\n            ->select(['Name'])\n            ->where(['Continent' => 'Asia', 'Code' => $subQuery])\n            ->createCommand();\n\n        var_dump($query->sql, $query->params);\n        var_dump($query->queryAll());\n        exit;\n    }\n}\n```\n\nSQL\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3001\u30af\u30a8\u30ea\u7d50\u679c\u306a\u3069\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059:\n\n```\nstring 'SELECT `Name` FROM `Country` WHERE (`Continent`=:qp0) AND (`Code` IN (SELECT `CountryCode` FROM `City` WHERE Population > Country.Population / 2))' (length=146)\n\narray (size=1)\n  ':qp0' => string 'Asia' (length=4)\n\narray (size=3)\n  0 => \n    array (size=1)\n      'Name' => string 'Macao' (length=5)\n  1 => \n    array (size=1)\n      'Name' => string 'Qatar' (length=5)\n  2 => \n    array (size=1)\n      'Name' => string 'Singapore' (length=9)\n```\n\nCakePHP, Yii \u3068\u3082\u306b\u30ab\u30e9\u30e0\u306e\u30af\u30aa\u30fc\u30c8\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u304c\u82e5\u5e72\u8352\u3044\u66f8\u304d\u65b9\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u3053\u3089\u3078\u3093\u3082\u3046\u3059\u3053\u3057\u8abf\u6574\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## MySQL \u3067\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\n\n\u3044\u308d\u3044\u308d\u8abf\u3079\u3066\u3044\u308b\u3068 MySQL 5.6 \u4ee5\u524d\u307e\u3067\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u91cd\u3044\u3060\u3068\u304b\u9045\u3044\u3060\u3068\u304b\u66f8\u304b\u308c\u3066\u3044\u308b\u8a18\u4e8b\u304c\u3051\u3063\u3053\u3046\u3042\u3063\u305f\u3093\u3067\u3059\u304c\u30015.6 \u4ee5\u964d\u3060\u3068\u3001\u4f53\u611f\u7684\u306b\u306f\u5168\u304f\u9045\u3055\u3092\u611f\u3058\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u307e\u305f [\u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b](http://nippondanji.blogspot.jp/2009/03/mysql_25.html) \u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306a EXPLAIN \u3067\u5b9f\u884c\u8a08\u753b\u3092\u8abf\u3079\u305f\u969b\u306e select_type \u3082 5.1 \u3068 5.6 \u3067\u306f\u5024\u304c\u7570\u306a\u3063\u3066\u3044\u305f\u308a\u3082\u3057\u307e\u3057\u305f\u3002\n\n\u9045\u3044\u304b\u3089\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u8cbc\u308d\u3046\u3068\u304b\u3001\u30b5\u30d6\u30af\u30a8\u30ea\u3058\u3083\u306a\u304f\u3066 JOIN \u3067\u3084\u308d\u3046\u3068\u304b\u3092\u8003\u3048\u308b\u5834\u5408\u3001MySQL \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u3061\u3083\u3093\u3068\u8abf\u3079\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u7121\u99c4\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306a\u3069\u304c\u8cbc\u3089\u308c\u3063\u3071\u306a\u3057\u3060\u3063\u305f\u308a\u3059\u308b\u6050\u308c\u3082\u3042\u308b\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u53c2\u8003\u30ea\u30f3\u30af\n\n* [CakePHP Cookbook 2.x Model > Retrieving Your Data > Sub-queries](http://book.cakephp.org/2.0/en/models/retrieving-your-data.html#sub-queries)\n* [Yii 2 Guide > Query Builder](http://www.yiiframework.com/doc-2.0/guide-db-query-builder.html)\n* [\u6f22(\u30aa\u30c8\u30b3)\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053: \u306a\u305cMySQL\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u306f\u9045\u3044\u306e\u304b](http://nippondanji.blogspot.jp/2009/03/mysql_25.html)\n* [\u6f22(\u30aa\u30c8\u30b3)\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u9053: \u958b\u767a\u30b9\u30d4\u30fc\u30c9\u30a2\u30af\u30bb\u30eb\u5168\u958b\u3076\u3063\u3061\u304e\u308a\uff01\u65e5\u672c\u3088\u3001\u3053\u308c\u304cMySQL 5.6\u3060\u30c3\uff01\uff01](http://nippondanji.blogspot.jp/2012/10/mysql-56.html)\n"}