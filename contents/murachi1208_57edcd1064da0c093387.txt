{"context": " More than 1 year has passed since last update.\n\n\u3044\u307e\u3055\u3089 fluentd v1 \u306f\u3058\u3081\u3066\u307f\u308b\n\u300cfluentd + Kibana + elasticsearch\u300d \u3084\u3089 \u300cfluentd + MongoDB\u300d\u3068\u30ed\u30b0\u89e3\u6790\u3057\u3066DB\u306b\u5165\u308c\u3064\u3064\u30b0\u30e9\u30d5\u5316\u3057\u3061\u3083\u3046\u306a\u3093\u3066\u5df7\u3067\u6d41\u884c\u3063\u3066\u3044\u308b\u306a\uff5e\uff5e\u3068\u6307\u3092\u304f\u308f\u3048\u3066\u307f\u3066\u305f\u3093\u3067\u3059\u3002\u305d\u3057\u3066\uff11\u5e74\u7d4c\u904e\u30fb\u30fb\u30fb\u305d\u308d\u305d\u308d\u3084\u3089\u306d\u3070\uff01\u3068\u91cd\u3044\u8170\u3092\u3042\u3052\u3066\u307f\u307e\u3057\u305f\u3002\u305d\u3057\u3066\u307e\u305f\u30cf\u30de\u3063\u305f\uff57\n\u203bfluentd v2\u304c\u3067\u3066\u304a\u308a\u307e\u3059\uff5e\n\nfluentd \u3063\u3066\n\u30b7\u30b9\u30c6\u30e0\u69cb\u7bc9\u3057\u305f\u3053\u3068\u3042\u308b\u4eba\u306a\u3089\u7d4c\u9a13\u304c\u3042\u308b\u3088\u3046\u306b\u5404\u30b7\u30b9\u30c6\u30e0\u306b\u6563\u3089\u3070\u3063\u305f\u30ed\u30b0\u3092\u53ce\u96c6\uff06\u89e3\u6790\u3001\u30b0\u30e9\u30d5\u5316\u3059\u308b\u306e\u3063\u3066\u7c21\u5358\u305d\u3046\u3067\u7d50\u69cb\u5927\u5909\u306a\u4f5c\u696d\u3067\u3059\u3088\u306d\u3002fluentd \u306f\u3001ruby \u3067\u66f8\u304b\u308c\u305f\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\uff08\u30ed\u30b0\u53ce\u96c6\u7ba1\u7406\u30c4\u30fc\u30eb\uff1f\uff09\u3067\u3001\u3053\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u7c21\u5358\u306b\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u591a\u5f69\u306a\u5165\u51fa\u529b\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3057\u3001\u3053\u3093\u306a\u306e\u306a\u3044\u304b\u306a\uff1f\u3068\u601d\u3046\u3068\u5225\u9014\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u308a\u3068\u6b86\u3069\u81ea\u5206\u3067\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u4f4d\u306b\u5145\u5b9f\u3057\u3066\u3044\u307e\u3059\u3002\n\nfluentd\u306b\u3088\u308b\u30ed\u30b0\u53ce\u96c6\u30b7\u30b9\u30c6\u30e0\u306e\u69cb\u7bc9\uff5e\u57fa\u672c\u7de8\nFluentd\u306b\u304a\u3051\u308b\u30ed\u30b0\u904b\u7528\n\n\n\u30cf\u30de\u3063\u305f\n\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u5ac1\u3001\u3068\u3044\u308f\u308c\u305d\u3046\u3067\u3059\u304c\u30fb\u30fb\u30fb\u3002fluentd \u3067\u306ein/out\u306f\u3059\u3079\u3066 json \u3067\u51e6\u7406\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u3002\n\u305d\u306e\u305f\u3081\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306b\u5bfe\u3057\u5165\u529b\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3068\u3060\u3081\uff57\u3002\u304b\u3068\u3044\u3063\u3066\u3082\u6b63\u898f\u8868\u73fe\u3092\u5c11\u3057\u52c9\u5f37\u3059\u308c\u3070\u5bfe\u5fdc\u53ef\u80fd\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u521d\u5fc3\u8005\u3089\u3057\u304f\u304b\u308b\uff5e\u304f\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\n\u300cnginx \u21d2 fluentd \u21d2 MongoDB\u300d\u306e\u8a18\u4e8b\u304c\u591a\u304f\u30d2\u30c3\u30c8\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u306f\u521d\u5fc3\u8005\u3063\u307d\u3044\u3068\u3053\u304b\u3089\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\u69cb\u6210\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\uff08vm \u3092\uff13\u3064\u7528\u610f\u3057\u3066\u306d\uff09\u3002\n\u3042\u3068\u5165\u529b\u3059\u308b\u30ed\u30b0\uff08aa.log/bb.log\uff09\u306f\u3001\u52c9\u5f37\u7528\u306e\u305f\u3081\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u3060\u3063\u3066 apache \u3084\u3089 nginx \u3060\u3068\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u308b\u306e\u3067\u30fb\u30fb\u30fb\n\n\nfluentd \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\uff08\u9001\u4fe1\u5074\u3001\u53d7\u4fe1\u5074\uff09\u306b fluentd \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u74b0\u5883\u306b\u3088\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806\u306f\u9055\u3048\u3069\u3082\u57fa\u672c\u7684\u306b\u7c21\u5358\u306b\u5c0e\u5165\u3067\u304d\u307e\u3059\u3002\n\u203bsh\u3092\u898b\u308b\u3068\u308f\u304b\u308b\u3051\u3051\u3069 /etc/yum.repos.d/td.repo \u306b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\ncommand\n$ sudo su\n# curl -L http://toolbelt.treasuredata.com/sh/install-redhat.sh | sh\n\n\n\n\u9001\u4fe1\u5074\u306e\u8a2d\u5b9a\n/tmp/aa.log \u306b\u884c\u304c\u8ffd\u52a0\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u3067 td-agent \u304c\u52d5\u4f5c\u3057\u3001\u30ed\u30b0\u53ce\u96c6\u30b5\u30fc\u30d0\u306b http \u3067\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\uff08/tmp/bb.log \u3082\u540c\u3058\uff09\u3002\n\n/etc/td-agent/td-agent.conf\n<source>\n  type tail\n  path /tmp/aa.log\n  pos_file /tmp/access.pos\n  format /^(?<date>[^\\]]*) (?<host>[^ ]*)$/\n  time_format %d/%b/%Y:%H:%M:%S\n  tag test.access\n</source>\n\n<match test.access>\n  type forward\n  buffer_chunk_limit 256m\n  buffer_queue_limit 128\n  flush_interval 5s\n  <server>\n    host 192.168.11.106\n    port 24224\n  </server>\n</match>\n\n\n\u3053\u3053\u3067\u7279\u7b46\u3059\u3079\u304d\u70b9\u306f\u3001source\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 \u306e \u300cformat\u300d\u3067\u3059\u3002\u6b63\u898f\u8868\u73fe\u3067\u6307\u5b9a\u3057\u307e\u3059\u304c\u7279\u6b8a\u306a\u8a18\u8ff0\u306e\u65b9\u6cd5\u306a\u306e\u3067\u72ec\u81ea\u30ed\u30b0\u3092\u89e3\u6790\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u5834\u5408\u306f\u5c11\u3057\u624b\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u3001Fluentular \u30b5\u30a4\u30c8\u3067\u8a66\u884c\u932f\u8aa4\u3057\u306a\u304c\u3089\u4f5c\u6210\u3059\u308b\u306e\u304c\u697d\u30c1\u30f3\u3067\u3059\u3002\n\nfluentd\u306eformat(\u6b63\u898f\u8868\u73fe)\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u8a66\u884c\u932f\u8aa4\u4e2d\n\n\n\u53d7\u4fe1\u5074\u306e\u8a2d\u5b9a\n\u30c7\u30fc\u30bf\u3092 http \u3067\u53d7\u4fe1\u3057 /var/log/td_log/td_access \u306b\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n/etc/td-agent/td-agent.conf\n<source>\n  type forward\n  port 24224\n</source>\n\n<match test.access>\n  type file\n  time_slice_format %Y%m%d_%H%M\n  time_slice_wait 1m\n  path /var/log/td_log/td_access\n  time_format %Y%m%dT%H%M%S%z\n</match>\n\n\ntype file \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3001\u30b0\u30b0\u3068\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067 td_access.log \u304c\u3067\u304d\u308b\u304a\uff01\u3068\u66f8\u3044\u3066\u3042\u308b\u3051\u3069\u5b9f\u969b\u306b\u306f\u300c td_access.log + time_slice_format + 0.log\u300d\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u307e\u305f tdaccess.20140622_1413.b4fc65c8fe4bf524b \u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u306f\u3001fluentd \u304c\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u78ba\u5b9a\u3059\u308b\u524d\u6bb5\u968e\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u304b\u3089\u3067\u3059\uff08timeslice_format \u306e\u5f62\u5f0f\u3067\u307e\u3068\u307e\u308b\u3089\u3057\u3044\uff09\u3002\n\nfluentd\u3067TimeSlicedOutput\u3092\u4f7f\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u305f\n\n\n\u30c6\u30b9\u30c8\u65b9\u6cd5\nfluentd \u304c\u52d5\u4f5c\u3057\u3066\u72b6\u614b\u3092\u307f\u308b\u3053\u3068\u306b\u3088\u308a\u30a4\u30d9\u30f3\u30c8\u306e\u6d41\u308c\u304c\u5224\u308b\u3068\u601d\u3046\u306e\u3067\u6700\u521d\u306f\u3001td-agent -vv \u30b3\u30de\u30f3\u30c9\u3092\u9001\u53d7\u4fe1\u5074\u3067\u8d77\u52d5\u3057\u3044\u305f\u307b\u3046\u304c\u3088\u3044\u3002\u69cb\u6587\u30a8\u30e9\u30fc\u306e\u5834\u5408\u3082\u8d77\u52d5\u305b\u305a\u6b62\u307e\u308b\u306e\u3067\u539f\u56e0\u304c\u8ffd\u7a76\u3057\u3084\u3059\u3044\u3002\n$ sudo td-agent -vv\n\n\u9001\u4fe1\u5074\n$ echo \"22/Jun/2014:09:14:05 aaaa\" >> /tmp/aa.log          # \u30ed\u30b0\u3068\u3057\u3066\u6709\u52b9\u306a\u3053\u3068\u3092\u78ba\u8a8d\n$ echo \"22/Jun/2014:09:14:05 aaaa ddd fff\" >> /tmp/aa.log  # \u30ed\u30b0\u3068\u3057\u3066\u7121\u52b9\u306a\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\u3055\u3066\u904b\u7528\u3057\u3066\u307f\u308b\u304b\n\u5b9f\u969b\u306b\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002 \u304c \u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\u72b6\u614b\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u3057\u304b\u3082\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3082 [OK] \u3063\u3066\u8868\u793a\u3055\u308c\u308c\u3066\u3044\u308b\u30fb\u30fb\u30fb\u3002\n\u305d\u3093\u306a\u3068\u304d\u306f\u3001fluentd \u306e\u8d77\u52d5\u30ed\u30b0 /var/log/td-agent/td-agent.log \u3092\u898b\u307e\u3057\u3087\u3046\u3002\u3053\u3053\u306b\u3059\u3079\u3066\u304c\u66f8\u3044\u3066\u3042\u308b\uff57\n\u203btd-agent \u30e6\u30fc\u30b6\u3067 td-agent \u3092\u8d77\u52d5\u3059\u308b\u306e\u3067 \u300c:EACCES: Permission denied\u300d\u306b\u306a\u3063\u3066\u308b\u3068\u304d\u3082\u3042\u308b\u3002\n# /etc/init.d/td-agent restart\nStarting td-agent:                                         [  OK  ]\n\n\n\u6b21\u306f\nltsv \u30d7\u30e9\u30b0\u30f3\u3092\u4f7f\u3063\u305f\u65b9\u6cd5\u3092\u52c9\u5f37\u3057\u3066\u307f\u308b\uff08\u305d\u306e\uff12\uff09\u306e\u4e88\u5b9a\u3067\u3059\uff57\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\ntd-agent(fluentd)\u306epos\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u30bf\u30a4\u30df\u30f3\u30b0\u3068\u304b\u305d\u306e\u4ed6\u3082\u308d\u3082\u308d\u3082\u30e1\u30e2\n\u3010fluentd\u521d\u5fc3\u8005\u3011td-agent\u306b\u8d77\u52d5\u507d\u88c5\u3055\u308c\u305f\u4ef6\u306b\u3064\u3044\u3066\nfluentd\u306e\u7c21\u5358\u306a\u4f7f\u3044\u65b9\u3001\u8a2d\u5b9a\u65b9\u6cd5\u4e00\u89a7\n\n# \u3044\u307e\u3055\u3089 fluentd v1 \u306f\u3058\u3081\u3066\u307f\u308b\n\u300c[fluentd](http://www.fluentd.org/) + [Kibana](Kibana) + [elasticsearch](http://www.elasticsearch.org/)\u300d \u3084\u3089 \u300cfluentd + [MongoDB](http://www.mongodb.org/)\u300d\u3068\u30ed\u30b0\u89e3\u6790\u3057\u3066DB\u306b\u5165\u308c\u3064\u3064\u30b0\u30e9\u30d5\u5316\u3057\u3061\u3083\u3046\u306a\u3093\u3066\u5df7\u3067\u6d41\u884c\u3063\u3066\u3044\u308b\u306a\uff5e\uff5e\u3068\u6307\u3092\u304f\u308f\u3048\u3066\u307f\u3066\u305f\u3093\u3067\u3059\u3002\u305d\u3057\u3066\uff11\u5e74\u7d4c\u904e\u30fb\u30fb\u30fb\u305d\u308d\u305d\u308d\u3084\u3089\u306d\u3070\uff01\u3068\u91cd\u3044\u8170\u3092\u3042\u3052\u3066\u307f\u307e\u3057\u305f\u3002\u305d\u3057\u3066\u307e\u305f\u30cf\u30de\u3063\u305f\uff57\n\u203bfluentd v2\u304c\u3067\u3066\u304a\u308a\u307e\u3059\uff5e\n\n# fluentd \u3063\u3066\n\u30b7\u30b9\u30c6\u30e0\u69cb\u7bc9\u3057\u305f\u3053\u3068\u3042\u308b\u4eba\u306a\u3089\u7d4c\u9a13\u304c\u3042\u308b\u3088\u3046\u306b\u5404\u30b7\u30b9\u30c6\u30e0\u306b\u6563\u3089\u3070\u3063\u305f\u30ed\u30b0\u3092\u53ce\u96c6\uff06\u89e3\u6790\u3001\u30b0\u30e9\u30d5\u5316\u3059\u308b\u306e\u3063\u3066\u7c21\u5358\u305d\u3046\u3067\u7d50\u69cb\u5927\u5909\u306a\u4f5c\u696d\u3067\u3059\u3088\u306d\u3002[fluentd](http://www.fluentd.org/) \u306f\u3001ruby \u3067\u66f8\u304b\u308c\u305f\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\uff08\u30ed\u30b0\u53ce\u96c6\u7ba1\u7406\u30c4\u30fc\u30eb\uff1f\uff09\u3067\u3001\u3053\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u306b\u3088\u308a\u7c21\u5358\u306b\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u591a\u5f69\u306a[\u5165\u51fa\u529b\u30d7\u30e9\u30b0\u30a4\u30f3](http://docs.fluentd.org/ja/articles/)\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3057\u3001\u3053\u3093\u306a\u306e\u306a\u3044\u304b\u306a\uff1f\u3068\u601d\u3046\u3068[\u5225\u9014\u516c\u958b](http://www.fluentd.org/datasources)\u3055\u308c\u3066\u3044\u305f\u308a\u3068\u6b86\u3069\u81ea\u5206\u3067\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\u4f4d\u306b\u5145\u5b9f\u3057\u3066\u3044\u307e\u3059\u3002\n\n> [fluentd\u306b\u3088\u308b\u30ed\u30b0\u53ce\u96c6\u30b7\u30b9\u30c6\u30e0\u306e\u69cb\u7bc9\uff5e\u57fa\u672c\u7de8](http://success.tracpath.com/blog/2014/04/22/fluentd_opensource_log_management-2/)\n> [Fluentd\u306b\u304a\u3051\u308b\u30ed\u30b0\u904b\u7528](http://qiita.com/kenzan100/items/9891a24263de77af6f31)\n\n## \u30cf\u30de\u3063\u305f\n\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u5ac1\u3001\u3068\u3044\u308f\u308c\u305d\u3046\u3067\u3059\u304c\u30fb\u30fb\u30fb\u3002fluentd \u3067\u306ein/out\u306f\u3059\u3079\u3066 json \u3067\u51e6\u7406\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u3002\n\u305d\u306e\u305f\u3081\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306b\u5bfe\u3057\u5165\u529b\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3068\u3060\u3081\uff57\u3002\u304b\u3068\u3044\u3063\u3066\u3082\u6b63\u898f\u8868\u73fe\u3092\u5c11\u3057\u52c9\u5f37\u3059\u308c\u3070\u5bfe\u5fdc\u53ef\u80fd\u3002\n\n# \u3068\u308a\u3042\u3048\u305a\u521d\u5fc3\u8005\u3089\u3057\u304f\u304b\u308b\uff5e\u304f\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\n\u300c[nginx](http://nginx.org/ja/) \u21d2 fluentd \u21d2 MongoDB\u300d\u306e\u8a18\u4e8b\u304c\u591a\u304f\u30d2\u30c3\u30c8\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u306f\u521d\u5fc3\u8005\u3063\u307d\u3044\u3068\u3053\u304b\u3089\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\u69cb\u6210\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\uff08[vm \u3092\uff13\u3064\u7528\u610f\u3057\u3066\u306d](http://qiita.com/murachi1208/items/99daa3ca069d907a7b50)\uff09\u3002\n\u3042\u3068\u5165\u529b\u3059\u308b\u30ed\u30b0\uff08aa.log/bb.log\uff09\u306f\u3001\u52c9\u5f37\u7528\u306e\u305f\u3081\u72ec\u81ea\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u3060\u3063\u3066 apache \u3084\u3089 nginx \u3060\u3068\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u308b\u306e\u3067\u30fb\u30fb\u30fb\n\n![fluentd_1.png](https://qiita-image-store.s3.amazonaws.com/0/44540/8bed8d51-5a1e-7f94-2e86-d51763ce17cc.png)\n\n## fluentd \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\uff08\u9001\u4fe1\u5074\u3001\u53d7\u4fe1\u5074\uff09\u306b fluentd \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u74b0\u5883\u306b\u3088\u3063\u3066[\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u624b\u9806](http://docs.fluentd.org/articles/install-by-rpm-v1)\u306f\u9055\u3048\u3069\u3082\u57fa\u672c\u7684\u306b\u7c21\u5358\u306b\u5c0e\u5165\u3067\u304d\u307e\u3059\u3002\n\u203bsh\u3092\u898b\u308b\u3068\u308f\u304b\u308b\u3051\u3051\u3069 /etc/yum.repos.d/td.repo \u306b\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```text:command\n$ sudo su\n# curl -L http://toolbelt.treasuredata.com/sh/install-redhat.sh | sh\n```\n\n## \u9001\u4fe1\u5074\u306e\u8a2d\u5b9a\n/tmp/aa.log \u306b\u884c\u304c\u8ffd\u52a0\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u3067 td-agent \u304c\u52d5\u4f5c\u3057\u3001\u30ed\u30b0\u53ce\u96c6\u30b5\u30fc\u30d0\u306b http \u3067\u30c7\u30fc\u30bf\u3092\u8ee2\u9001\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\uff08/tmp/bb.log \u3082\u540c\u3058\uff09\u3002\n\n```/etc/td-agent/td-agent.conf\n<source>\n  type tail\n  path /tmp/aa.log\n  pos_file /tmp/access.pos\n  format /^(?<date>[^\\]]*) (?<host>[^ ]*)$/\n  time_format %d/%b/%Y:%H:%M:%S\n  tag test.access\n</source>\n\n<match test.access>\n  type forward\n  buffer_chunk_limit 256m\n  buffer_queue_limit 128\n  flush_interval 5s\n  <server>\n    host 192.168.11.106\n    port 24224\n  </server>\n</match>\n```\n\n\u3053\u3053\u3067\u7279\u7b46\u3059\u3079\u304d\u70b9\u306f\u3001source\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6 \u306e \u300cformat\u300d\u3067\u3059\u3002\u6b63\u898f\u8868\u73fe\u3067\u6307\u5b9a\u3057\u307e\u3059\u304c\u7279\u6b8a\u306a\u8a18\u8ff0\u306e\u65b9\u6cd5\u306a\u306e\u3067\u72ec\u81ea\u30ed\u30b0\u3092\u89e3\u6790\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u5834\u5408\u306f\u5c11\u3057\u624b\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u3001[Fluentular](http://fluentular.herokuapp.com/parse?regexp=%5E%28%3F%3Cdate%3E%5B%5E%5C%5D%5D*%29+%28%3F%3Chost%3E%5B%5E+%5D*%29&input=21%2FJun%2F2014%3A03%3A05%3A43+aaaa&time_format=%25d%2F%25b%2F%25Y%3A%25H%3A%25M%3A%25S) \u30b5\u30a4\u30c8\u3067\u8a66\u884c\u932f\u8aa4\u3057\u306a\u304c\u3089\u4f5c\u6210\u3059\u308b\u306e\u304c\u697d\u30c1\u30f3\u3067\u3059\u3002\n> [fluentd\u306eformat(\u6b63\u898f\u8868\u73fe)\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u8a66\u884c\u932f\u8aa4\u4e2d](http://blog.glidenote.com/blog/2012/07/15/fluentd-regex-debug/)\n\n## \u53d7\u4fe1\u5074\u306e\u8a2d\u5b9a\n\u30c7\u30fc\u30bf\u3092 http \u3067\u53d7\u4fe1\u3057 /var/log/td_log/td_access \u306b\u7d50\u679c\u3092\u51fa\u529b\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```/etc/td-agent/td-agent.conf\n<source>\n  type forward\n  port 24224\n</source>\n\n<match test.access>\n  type file\n  time_slice_format %Y%m%d_%H%M\n  time_slice_wait 1m\n  path /var/log/td_log/td_access\n  time_format %Y%m%dT%H%M%S%z\n</match>\n```\n\ntype file \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3001\u30b0\u30b0\u3068\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067 **td_access.log** \u304c\u3067\u304d\u308b\u304a\uff01\u3068\u66f8\u3044\u3066\u3042\u308b\u3051\u3069\u5b9f\u969b\u306b\u306f\u300c **td_access.log** + time_slice_format + _0.log\u300d\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u307e\u305f td__access.20140622_1413.b4fc65c8fe4bf524b \u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u306f\u3001fluentd \u304c\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u78ba\u5b9a\u3059\u308b\u524d\u6bb5\u968e\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u304b\u3089\u3067\u3059\uff08time_slice_format \u306e\u5f62\u5f0f\u3067\u307e\u3068\u307e\u308b\u3089\u3057\u3044\uff09\u3002\n> [fluentd\u3067TimeSlicedOutput\u3092\u4f7f\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u305f](http://erukiti.hatenablog.com/entry/20120208/1328719264)\n\n## \u30c6\u30b9\u30c8\u65b9\u6cd5\nfluentd \u304c\u52d5\u4f5c\u3057\u3066\u72b6\u614b\u3092\u307f\u308b\u3053\u3068\u306b\u3088\u308a\u30a4\u30d9\u30f3\u30c8\u306e\u6d41\u308c\u304c\u5224\u308b\u3068\u601d\u3046\u306e\u3067\u6700\u521d\u306f\u3001```td-agent -vv``` \u30b3\u30de\u30f3\u30c9\u3092\u9001\u53d7\u4fe1\u5074\u3067\u8d77\u52d5\u3057\u3044\u305f\u307b\u3046\u304c\u3088\u3044\u3002\u69cb\u6587\u30a8\u30e9\u30fc\u306e\u5834\u5408\u3082\u8d77\u52d5\u305b\u305a\u6b62\u307e\u308b\u306e\u3067\u539f\u56e0\u304c\u8ffd\u7a76\u3057\u3084\u3059\u3044\u3002\n\n```command\n$ sudo td-agent -vv\n```\n\n\u9001\u4fe1\u5074\n\n```command\n$ echo \"22/Jun/2014:09:14:05 aaaa\" >> /tmp/aa.log          # \u30ed\u30b0\u3068\u3057\u3066\u6709\u52b9\u306a\u3053\u3068\u3092\u78ba\u8a8d\n$ echo \"22/Jun/2014:09:14:05 aaaa ddd fff\" >> /tmp/aa.log  # \u30ed\u30b0\u3068\u3057\u3066\u7121\u52b9\u306a\u3053\u3068\u3092\u78ba\u8a8d\n```\n\n# \u3055\u3066\u904b\u7528\u3057\u3066\u307f\u308b\u304b \n\u5b9f\u969b\u306b\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\u3002 **\u304c** \u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\u72b6\u614b\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u3057\u304b\u3082\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3082 [OK] \u3063\u3066\u8868\u793a\u3055\u308c\u308c\u3066\u3044\u308b\u30fb\u30fb\u30fb\u3002\n\u305d\u3093\u306a\u3068\u304d\u306f\u3001fluentd \u306e\u8d77\u52d5\u30ed\u30b0 /var/log/td-agent/td-agent.log \u3092\u898b\u307e\u3057\u3087\u3046\u3002\u3053\u3053\u306b\u3059\u3079\u3066\u304c\u66f8\u3044\u3066\u3042\u308b\uff57\n\u203btd-agent \u30e6\u30fc\u30b6\u3067 td-agent \u3092\u8d77\u52d5\u3059\u308b\u306e\u3067 \u300c:EACCES: Permission denied\u300d\u306b\u306a\u3063\u3066\u308b\u3068\u304d\u3082\u3042\u308b\u3002\n\n```\n# /etc/init.d/td-agent restart\nStarting td-agent:                                         [  OK  ]\n``` \n\n# \u6b21\u306f\n[ltsv](http://d.hatena.ne.jp/naoya/20130209/1360381374) \u30d7\u30e9\u30b0\u30f3\u3092\u4f7f\u3063\u305f\u65b9\u6cd5\u3092\u52c9\u5f37\u3057\u3066\u307f\u308b\uff08[\u305d\u306e\uff12](http://qiita.com/murachi1208/items/734915c8539995bdfe39)\uff09\u306e\u4e88\u5b9a\u3067\u3059\uff57\n\n## \u53c2\u8003\u30b5\u30a4\u30c8\n> [td-agent(fluentd)\u306epos\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u30bf\u30a4\u30df\u30f3\u30b0\u3068\u304b\u305d\u306e\u4ed6\u3082\u308d\u3082\u308d\u3082\u30e1\u30e2](http://tweeeety.hateblo.jp/entry/20131211/1386728410)\n> [\u3010fluentd\u521d\u5fc3\u8005\u3011td-agent\u306b\u8d77\u52d5\u507d\u88c5\u3055\u308c\u305f\u4ef6\u306b\u3064\u3044\u3066](http://qiita.com/jumbOS5/items/c7ae01f1456ef61f66a8)\n> [fluentd\u306e\u7c21\u5358\u306a\u4f7f\u3044\u65b9\u3001\u8a2d\u5b9a\u65b9\u6cd5\u4e00\u89a7](http://hivecolor.com/id/37)\n", "tags": ["fluentd", "vagrant"]}