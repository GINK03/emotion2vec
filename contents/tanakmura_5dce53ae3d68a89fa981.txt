{"tags": ["avx512"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u30023\u9805\u8ad6\u7406\u6f14\u7b97\u3057\u307e\u3059\u3002\n3\u5165\u529b\u30011\u51fa\u529b\u306eLUT\u304c\u3042\u308c\u3070\u30013\u5165\u529b\u306e\u8ad6\u7406\u6f14\u7b97\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002(\u3053\u308c\u3092\u5fdc\u7528\u3057\u305f\u306e\u304cFPGA\u3068\u8a00\u3048\u308b)\n\u4f8b\u3048\u3070\u3001 (A | B) & C \u306f\u3001\n\n\n\nA\nB\nC\n(A or B) &C\n\n\n\n\n0\n0\n0\n0\n\n\n0\n0\n1\n0\n\n\n0\n1\n0\n0\n\n\n0\n1\n1\n1\n\n\n1\n0\n0\n0\n\n\n1\n0\n1\n1\n\n\n1\n1\n0\n0\n\n\n1\n1\n1\n1\n\n\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u306d\u3002\n\u3053\u308c\u3092\u5b9f\u73fe\u3059\u308b\u306e\u304c\u3001vpternlogd (intrinsic \u306f _mm512_ternarylogic_epi32) \u7b49\u3067\u3059\u3002\n3\u3064\u306e\u30d9\u30af\u30bf\u30ec\u30b8\u30b9\u30bf\u3068\u30018bit\u306e\u5373\u5024\u3092\u5165\u529b\u306b\u3068\u308a\u307e\u3059\u3002\n\u5404\u30d9\u30af\u30bf\u30ec\u30b8\u30b9\u30bf\u304b\u3089 1bit \u305a\u3064\u3068\u3063\u3066\u304d\u3066\u30013bit \u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u308a\u307e\u3059\u30028bit\u306e\u5373\u5024\u304b\u3089\u3001\u305d\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3059\u308b\u30d3\u30c3\u30c8\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u3068\u3001\u8907\u6570\u306e\u8ad6\u7406\u6f14\u7b97\u3092\u4e00\u547d\u4ee4\u3067\u5b9f\u73fe\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n#include <immintrin.h>\n#include <stdio.h>\n\nunsigned int data1[16] = {0x00000fff};\nunsigned int data2[16] = {0x0000faaa};\nunsigned int data3[16] = {0x000000ff};\n\nunsigned int out[16];\n\nstatic inline unsigned int __attribute__((always_inline))\ntest(const unsigned int table)\n{\n    __m512i a = _mm512_loadu_si512(data1);\n    __m512i b = _mm512_loadu_si512(data2);\n    __m512i c = _mm512_loadu_si512(data3);\n    __m512i d;\n\n    d = _mm512_ternarylogic_epi32(a,b,c,table); // 4\u756a\u76ee\u306e\u5f15\u6570\u306f\u5b9a\u6570\u5fc5\u9808\u306a\u306e\u3067-O2\u3068\u304b\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\n    _mm512_storeu_si512(out, d);\n\n    for (int i=0; i<8; i++) {\n        printf(\"table[%d] = %d\\n\", i, (table>>i)&1);\n    }\n\n    for (int i=0; i<16; i++) {\n        unsigned int bit1 = (data1[0]>>i)&1;\n        unsigned int bit2 = (data2[0]>>i)&1;\n        unsigned int bit3 = (data3[0]>>i)&1;\n\n        unsigned int bit4 = (out[0]>>i)&1;\n\n        printf(\"0b%d%d%d = %d\\n\", bit1, bit2, bit3, bit4);\n    }\n\n}\n\nint\nmain()\n{\n    test(0b01010101);\n    puts(\"--\");\n    test(0b00001111);\n}\n\n$ ./sde -- ./a.out\ntable[0] = 1\ntable[1] = 0\ntable[2] = 1\ntable[3] = 0\ntable[4] = 1\ntable[5] = 0\ntable[6] = 1\ntable[7] = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b100 = 1\n0b110 = 1\n0b100 = 1\n0b110 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n--\ntable[0] = 1\ntable[1] = 1\ntable[2] = 1\ntable[3] = 1\ntable[4] = 0\ntable[5] = 0\ntable[6] = 0\ntable[7] = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b100 = 0\n0b110 = 0\n0b100 = 0\n0b110 = 0\n0b010 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n\n\u660e\u65e5\u304b\u3089\u306f @tanakmura \u304c\u307f\u3093\u306a\u5927\u597d\u304d\u30b7\u30e3\u30c3\u30d5\u30eb\u547d\u4ee4\u3092\u4e00\u500b\u305a\u3064\u8aac\u660e\u3057\u3066\u3044\u304f\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n3\u9805\u8ad6\u7406\u6f14\u7b97\u3057\u307e\u3059\u3002\n\n\n3\u5165\u529b\u30011\u51fa\u529b\u306eLUT\u304c\u3042\u308c\u3070\u30013\u5165\u529b\u306e\u8ad6\u7406\u6f14\u7b97\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002(\u3053\u308c\u3092\u5fdc\u7528\u3057\u305f\u306e\u304cFPGA\u3068\u8a00\u3048\u308b)\n\n\n\u4f8b\u3048\u3070\u3001 (A | B) & C \u306f\u3001\n\n\n| A | B | C | (A or B) &C |\n|---|---|---|-----------|\n| 0 | 0 | 0 |     0     |\n| 0 | 0 | 1 |     0     |\n| 0 | 1 | 0 |     0     |\n| 0 | 1 | 1 |     1     |\n| 1 | 0 | 0 |     0     |\n| 1 | 0 | 1 |     1     |\n| 1 | 1 | 0 |     0     |\n| 1 | 1 | 1 |     1     |\n\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u306d\u3002\n\n\n\u3053\u308c\u3092\u5b9f\u73fe\u3059\u308b\u306e\u304c\u3001vpternlogd (intrinsic \u306f \\_mm512_ternarylogic_epi32) \u7b49\u3067\u3059\u3002\n\n3\u3064\u306e\u30d9\u30af\u30bf\u30ec\u30b8\u30b9\u30bf\u3068\u30018bit\u306e\u5373\u5024\u3092\u5165\u529b\u306b\u3068\u308a\u307e\u3059\u3002\n\n\u5404\u30d9\u30af\u30bf\u30ec\u30b8\u30b9\u30bf\u304b\u3089 1bit \u305a\u3064\u3068\u3063\u3066\u304d\u3066\u30013bit \u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u308a\u307e\u3059\u30028bit\u306e\u5373\u5024\u304b\u3089\u3001\u305d\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3059\u308b\u30d3\u30c3\u30c8\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068\u3001\u8907\u6570\u306e\u8ad6\u7406\u6f14\u7b97\u3092\u4e00\u547d\u4ee4\u3067\u5b9f\u73fe\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\n```cpp\n#include <immintrin.h>\n#include <stdio.h>\n\nunsigned int data1[16] = {0x00000fff};\nunsigned int data2[16] = {0x0000faaa};\nunsigned int data3[16] = {0x000000ff};\n                   \nunsigned int out[16];\n\nstatic inline unsigned int __attribute__((always_inline))\ntest(const unsigned int table)\n{\n    __m512i a = _mm512_loadu_si512(data1);\n    __m512i b = _mm512_loadu_si512(data2);\n    __m512i c = _mm512_loadu_si512(data3);\n    __m512i d;\n\n    d = _mm512_ternarylogic_epi32(a,b,c,table); // 4\u756a\u76ee\u306e\u5f15\u6570\u306f\u5b9a\u6570\u5fc5\u9808\u306a\u306e\u3067-O2\u3068\u304b\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3053\u3068\n    _mm512_storeu_si512(out, d);\n\n    for (int i=0; i<8; i++) {\n        printf(\"table[%d] = %d\\n\", i, (table>>i)&1);\n    }\n\n    for (int i=0; i<16; i++) {\n        unsigned int bit1 = (data1[0]>>i)&1;\n        unsigned int bit2 = (data2[0]>>i)&1;\n        unsigned int bit3 = (data3[0]>>i)&1;\n\n        unsigned int bit4 = (out[0]>>i)&1;\n\n        printf(\"0b%d%d%d = %d\\n\", bit1, bit2, bit3, bit4);\n    }\n\n}\n\nint\nmain()\n{\n    test(0b01010101);\n    puts(\"--\");\n    test(0b00001111);\n}\n```\n\n```\n$ ./sde -- ./a.out\ntable[0] = 1\ntable[1] = 0\ntable[2] = 1\ntable[3] = 0\ntable[4] = 1\ntable[5] = 0\ntable[6] = 1\ntable[7] = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b100 = 1\n0b110 = 1\n0b100 = 1\n0b110 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n--\ntable[0] = 1\ntable[1] = 1\ntable[2] = 1\ntable[3] = 1\ntable[4] = 0\ntable[5] = 0\ntable[6] = 0\ntable[7] = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b101 = 0\n0b111 = 0\n0b100 = 0\n0b110 = 0\n0b100 = 0\n0b110 = 0\n0b010 = 1\n0b010 = 1\n0b010 = 1\n0b010 = 1\n```\n\n\u660e\u65e5\u304b\u3089\u306f @tanakmura \u304c\u307f\u3093\u306a\u5927\u597d\u304d\u30b7\u30e3\u30c3\u30d5\u30eb\u547d\u4ee4\u3092\u4e00\u500b\u305a\u3064\u8aac\u660e\u3057\u3066\u3044\u304f\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n"}