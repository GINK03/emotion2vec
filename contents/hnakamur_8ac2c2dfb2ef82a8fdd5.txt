{"tags": ["Node.js0.10.26", "CSV", "iconv"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nThe Pragmatic Bookshelf | Node.js the Right Way\u3092\u8aad\u3093\u3067\u3044\u308b\u6642\u306b\u30c4\u30fc\u30eb\u4f5c\u6210\u306e\u4f9d\u983c\u304c\u6765\u305f\u306e\u3067\u3001\u52c9\u5f37\u304c\u3066\u3089Node.js\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nHTML\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3068\u3053\u308d\u306fSlideShare\u306b\u3042\u3063\u305f\u96fb\u7b97\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8b1b\u5ea703\u306e\u30d7\u30ec\u30bc\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\nhttps\nvar baseDir = process.argv[2],\n    baseURL = process.argv[3],\n    outFile = process.argv[4],\n    _ = require('underscore'),\n    fs = require('fs'),\n    path = require('path'),\n    Q = require('q'),\n    jschardet = require('jschardet'),\n    Iconv = require('iconv').Iconv,\n    cheerio = require('cheerio'),\n    recursive_readdir = require('recursive-readdir'),\n    csv = require('csv'),\n    htmlFileExpr = /\\.html?$/i;\n\nif (!baseDir) {\n  throw new Error('A directory of site contents must be specified!');\n}\nif (!fs.existsSync(baseDir)) {\n  throw new Error('A directory specified does not exist!');\n}\nif (!baseURL) {\n  throw new Error('A base URL must be specified!');\n}\nif (!outFile) {\n  throw new Error('A output file must be specified!');\n}\n\nfunction readHtml(filename) {\n  return Q.nfcall(fs.readFile, filename)\n  .then(function(text) {\n    var encoding = jschardet.detect(text).encoding,\n        iconv,\n        $,\n        getText,\n        getMetaContent,\n        directory,\n        title,\n        keywords,\n        description;\n\n    if (encoding !== 'ascii' && encoding !== 'utf-8') {\n      iconv = new Iconv(encoding, 'UTF-8//TRANSLIT//IGNORE');\n      text = iconv.convert(text);\n    }\n\n    $ = cheerio.load(text);\n    getText = function(selector) {\n      var el = $(selector);\n      return el ? el.text() : '';\n    };\n    getMetaContent = function(name) {\n      var el = $('meta[name=' + name + ']');\n          content = el ? el.attr('content') : '';\n      return content ? content : '';\n    };\n\n    filename = filename.substr(baseDir.length);\n    directory = path.dirname(filename);\n    title = getText('title');\n    keywords = getMetaContent('keywords');\n    description = getMetaContent('description');\n    return {\n      directory: directory,\n      title: title,\n      keywords: keywords,\n      description: description,\n      URL: baseURL + filename\n    };\n  });\n}\n\nfunction writeCSV(results) {\n  return Q.fcall(function() {\n    var columns = [\n          'directory',\n          'title',\n          'keywords',\n          'description',\n          'URL'\n        ],\n        rows = results.map(function(result) {\n          return [\n            result.directory,\n            result.title,\n            result.keywords,\n            result.description,\n            result.URL\n          ];\n        }),\n        iconv = new Iconv('UTF-8', 'Shift_JIS//TRANSLIT//IGNORE');\n\n    iconv.pipe(fs.createWriteStream(outFile));\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv, { header: true });\n  });\n}\n\nif (baseDir.substr(-1) === '/' && baseDir !== '/') {\n  baseDir = baseDir.substr(0, baseDir.length - 1);\n}\nQ.nfcall(recursive_readdir, baseDir)\n.then(function(files) {\n  var htmlFiles = _.filter(files, function(file) {\n        return htmlFileExpr.test(file);\n      }),\n      promises = _.map(htmlFiles, function(file) {\n        return readHtml(file);\n      });\n\n  return Q.all(promises);\n})\n.then(writeCSV)\n.done();\n\n\nLICENSE\u306fMIT\u3067\u3059\u3002\n\n\u4f7f\u3063\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u89e3\u8aac\n\nrecursive-readdir\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u518d\u5e30\u7684\u306b\u305f\u3069\u3063\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\u4f7f\u3044\u65b9\u306f\u4e0a\u8a18\u306e\u30ea\u30f3\u30af\u5148\u306eUsage\u3092\u898b\u308c\u3070\u4e00\u76ee\u77ad\u7136\u3067\u3059\u3002\nNode.js\u306e\u6a19\u6e96API\u3067\u5b9f\u73fe\u3059\u308b\u306b\u306f\u3001fs.readdir(path, callback)\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea1\u6bb5\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3001fs.fstat(fd, callback)\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3069\u3046\u304b\u5224\u65ad\u3057\u3066\u518d\u5e30\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3093\u3067\u3057\u3087\u3046\u304c\u3001\u975e\u540c\u671f\u3067\u3084\u308b\u306e\u5927\u5909\u305d\u3046\u3060\u306a\u3068\u601d\u3063\u305f\u6240\u3067\u691c\u7d22\u3057\u305f\u3089\u898b\u3064\u3051\u305f\u306e\u3067\u4eca\u56de\u306f\u3053\u308c\u3067\u3002\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u6570\u304c\u81a8\u5927\u306b\u306a\u308b\u5834\u5408\u306f\u3001Stream\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067Readable\u3068\u3057\u3066\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nq\n\nPromises\u306e\u5b9f\u88c5\u306f\u305f\u304f\u3055\u3093\u3042\u3063\u3066\u3069\u308c\u4f7f\u3048\u3070\u3044\u3044\u306e\u304b\u60a9\u307f\u307e\u3059\u3002ComplexityMaze \u00bb Blog Archive \u00bb JavaScript Promises \u2013 a comparison of libraries\u306b\u3088\u3044\u6bd4\u8f03\u8a18\u4e8b\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001\u5192\u982d\u306e\u672c\u3067\u3082\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305fQ\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nNode.js\u306eAPI\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u7b2c1\u5f15\u6570\u306b\u30a8\u30e9\u30fcerr\u304c\u6765\u3066\u3001\u7b2c2\u5f15\u6570\u4ee5\u4e0b\u306b\u7d50\u679c\u306e\u30c7\u30fc\u30bf\u304c\u6765\u308b\u3082\u306e\u304c\u591a\u3044\u3067\u3059\u304c\u3001Adapting Mode\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bQ.nfcall()\u3068\u304bQ.nfapply()\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306bPromise\u5316\u3067\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001\u8907\u6570\u306ePromise\u3092\u5b9f\u884c\u3057\u3066\u5b8c\u4e86\u3092\u5f85\u3064Q.all()\u306a\u3069\u3082\u3042\u308a\u307e\u3059\u3002\n\njschardet\n\n\u6587\u5b57\u5217\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u81ea\u52d5\u5224\u5b9a\u3057\u3066\u304f\u308c\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\u51e6\u7406\u5bfe\u8c61\u306eHTML\u30d5\u30a1\u30a4\u30eb\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304cutf-8\u3067\u306f\u306a\u304feuc-jp\u3084shift_jis\u3067\u3082\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u81ea\u52d5\u5224\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\niconv\n\n\u6587\u5b57\u5217\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u5909\u63db\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002C++\u3068JavaScript\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nC++\u306e\u30bd\u30fc\u30b9node-iconv/src/binding.cc at master \u00b7 bnoordhuis/node-iconv\n\nJavaScript\u306e\u30bd\u30fc\u30b9node-iconv/lib/iconv.js at master \u00b7 bnoordhuis/node-iconv\n\n\niconv\u306fStream\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001readable.pipe(destination, [options])\u3067\u7e4b\u3044\u3067\u7c21\u5358\u306b\u4f7f\u3048\u307e\u3059\u3002\n\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001\u8aad\u307f\u8fbc\u307f\u6642\u306fjschardet\u3067\u5165\u529b\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u81ea\u52d5\u5224\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067pipe()\u3092\u4f7f\u308f\u305a\u306b\u3001convert()\u3067\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\u3082\u3057\u3001\u5165\u529b\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304ceuc-jp\u56fa\u5b9a\u306a\u3089\u3001fs.readFile(filename, [options], callback)\u3067\u306f\u306a\u304ffs.createReadStream(path, [options])\u3092\u4f7f\u3063\u3066\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u3001pipe()\u3067iconv\u306b\u3064\u306a\u3052\u308c\u3070\u3059\u3063\u304d\u308a\u66f8\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n  iconv = new Iconv('EUC-JP', 'UTF-8//TRANSLIT//IGNORE');\n  fs.createReadStream(inputFile).pipe(iconv)\n\n\ncheerio\n\n\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3046\u3068jQuery\u3063\u307d\u304fHTML\u306e\u8981\u7d20\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001$\u306fjQuery\u306e\u3088\u3046\u306b\u56fa\u5b9a\u3067\u306f\u306a\u304fHTML\u3092\u8aad\u307f\u8fbc\u3093\u3060\u7d50\u679c\u3092$\u306b\u8a2d\u5b9a\u3057\u3066\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u305f\u308a\u3001\u3044\u308d\u3044\u308d\u9055\u3044\u306f\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u3001JavaScript\u3092\u89e3\u91c8\u3057\u3066DOM\u8981\u7d20\u3092\u66f4\u65b0\u3057\u305f\u308a\u306f\u3057\u306a\u3044\u3088\u3046\u3067\u3001\u7d14\u7c8b\u306bHTML\u3092\u8aad\u307f\u8fbc\u3093\u3060\u7d50\u679c\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\ncsv\n\nCSV\u3092\u5165\u51fa\u529b\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002Stream\u5bfe\u5fdc\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u5165\u529b\u3084\u51fa\u529b\u306b\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u6e21\u3059\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\nreadable.pipe(destination, [options])\u3092\u4f7f\u3046\u3068\u304d\u306e\u6ce8\u610f\n\u4eca\u56de\u4e00\u756a\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\u306f\u3001CSV\u306b\u51fa\u529b\u3059\u308b\u3068\u304d\u306bpipe()\u3092\u4f7f\u7528\u3057\u3066SJIS\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3067\u3059\u3002\n\n\u6b63\u3057\u3044\u5b9f\u88c5\n    iconv.pipe(fs.createWriteStream(outFile));\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv, { header: true });\n\n\n\u6700\u521d\u3053\u308c\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3001\u51fa\u529b\u3055\u308c\u305fCSV\u30d5\u30a1\u30a4\u30eb\u304cSJIS\u3067\u306f\u306a\u304fUTF-8\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n\u9593\u9055\u3063\u305f\u5b9f\u88c5\u4f8b\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv.pipe(fs.createWriteStream(outFile)), { header: true });\n\n\nreadable.pipe(destination, [options])\u306b\u304d\u3061\u3093\u3068\u8aac\u660e\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001pipe()\u306e\u623b\u308a\u5024\u306f\u5165\u529breadable\u3067\u306f\u306a\u304f\u51fa\u529bdestination\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306fr.pipe(z).pipe(w)\u3068\u8907\u6570\u306e\u30d1\u30a4\u30d7\u3092\u7e4b\u3052\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\u4e0a\u306e\u9593\u9055\u3063\u305f\u4f8b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3068csv()\u304b\u3089\u306e\u51fa\u529b\u306ficonv\u3067\u306f\u306a\u304ffs.createWriteStream(outFile)\u306b\u6e21\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\n[The Pragmatic Bookshelf | Node.js the Right Way](http://pragprog.com/book/jwnode/node-js-the-right-way)\u3092\u8aad\u3093\u3067\u3044\u308b\u6642\u306b\u30c4\u30fc\u30eb\u4f5c\u6210\u306e\u4f9d\u983c\u304c\u6765\u305f\u306e\u3067\u3001\u52c9\u5f37\u304c\u3066\u3089Node.js\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nHTML\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u3068\u3053\u308d\u306fSlideShare\u306b\u3042\u3063\u305f[\u96fb\u7b97\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8b1b\u5ea703](http://www.slideshare.net/ww24jp/03-27441078)\u306e\u30d7\u30ec\u30bc\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n# \u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\n```js:https://github.com/hnakamur/nodejs-html-filelist-csv-example/blob/2e1eebadf81b46eb017e3a0c471e04ffa56cb41f/index.js\nvar baseDir = process.argv[2],\n    baseURL = process.argv[3],\n    outFile = process.argv[4],\n    _ = require('underscore'),\n    fs = require('fs'),\n    path = require('path'),\n    Q = require('q'),\n    jschardet = require('jschardet'),\n    Iconv = require('iconv').Iconv,\n    cheerio = require('cheerio'),\n    recursive_readdir = require('recursive-readdir'),\n    csv = require('csv'),\n    htmlFileExpr = /\\.html?$/i;\n\nif (!baseDir) {\n  throw new Error('A directory of site contents must be specified!');\n}\nif (!fs.existsSync(baseDir)) {\n  throw new Error('A directory specified does not exist!');\n}\nif (!baseURL) {\n  throw new Error('A base URL must be specified!');\n}\nif (!outFile) {\n  throw new Error('A output file must be specified!');\n}\n\nfunction readHtml(filename) {\n  return Q.nfcall(fs.readFile, filename)\n  .then(function(text) {\n    var encoding = jschardet.detect(text).encoding,\n        iconv,\n        $,\n        getText,\n        getMetaContent,\n        directory,\n        title,\n        keywords,\n        description;\n\n    if (encoding !== 'ascii' && encoding !== 'utf-8') {\n      iconv = new Iconv(encoding, 'UTF-8//TRANSLIT//IGNORE');\n      text = iconv.convert(text);\n    }\n\n    $ = cheerio.load(text);\n    getText = function(selector) {\n      var el = $(selector);\n      return el ? el.text() : '';\n    };\n    getMetaContent = function(name) {\n      var el = $('meta[name=' + name + ']');\n          content = el ? el.attr('content') : '';\n      return content ? content : '';\n    };\n\n    filename = filename.substr(baseDir.length);\n    directory = path.dirname(filename);\n    title = getText('title');\n    keywords = getMetaContent('keywords');\n    description = getMetaContent('description');\n    return {\n      directory: directory,\n      title: title,\n      keywords: keywords,\n      description: description,\n      URL: baseURL + filename\n    };\n  });\n}\n\nfunction writeCSV(results) {\n  return Q.fcall(function() {\n    var columns = [\n          'directory',\n          'title',\n          'keywords',\n          'description',\n          'URL'\n        ],\n        rows = results.map(function(result) {\n          return [\n            result.directory,\n            result.title,\n            result.keywords,\n            result.description,\n            result.URL\n          ];\n        }),\n        iconv = new Iconv('UTF-8', 'Shift_JIS//TRANSLIT//IGNORE');\n\n    iconv.pipe(fs.createWriteStream(outFile));\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv, { header: true });\n  });\n}\n\nif (baseDir.substr(-1) === '/' && baseDir !== '/') {\n  baseDir = baseDir.substr(0, baseDir.length - 1);\n}\nQ.nfcall(recursive_readdir, baseDir)\n.then(function(files) {\n  var htmlFiles = _.filter(files, function(file) {\n        return htmlFileExpr.test(file);\n      }),\n      promises = _.map(htmlFiles, function(file) {\n        return readHtml(file);\n      });\n\n  return Q.all(promises);\n})\n.then(writeCSV)\n.done();\n```\n\n[LICENSE](https://github.com/hnakamur/nodejs-html-filelist-csv-example/blob/master/LICENSE)\u306fMIT\u3067\u3059\u3002\n\n\n# \u4f7f\u3063\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u89e3\u8aac\n\n## [recursive-readdir](https://www.npmjs.org/package/recursive-readdir)\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u518d\u5e30\u7684\u306b\u305f\u3069\u3063\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3057\u3066\u304f\u308c\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\u4f7f\u3044\u65b9\u306f\u4e0a\u8a18\u306e\u30ea\u30f3\u30af\u5148\u306eUsage\u3092\u898b\u308c\u3070\u4e00\u76ee\u77ad\u7136\u3067\u3059\u3002\n\nNode.js\u306e\u6a19\u6e96API\u3067\u5b9f\u73fe\u3059\u308b\u306b\u306f\u3001[fs.readdir(path, callback)](http://nodejs.org/api/fs.html#fs_fs_readdir_path_callback)\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea1\u6bb5\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3001[fs.fstat(fd, callback)](http://nodejs.org/api/fs.html#fs_fs_fstat_fd_callback)\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304b\u3069\u3046\u304b\u5224\u65ad\u3057\u3066\u518d\u5e30\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3093\u3067\u3057\u3087\u3046\u304c\u3001\u975e\u540c\u671f\u3067\u3084\u308b\u306e\u5927\u5909\u305d\u3046\u3060\u306a\u3068\u601d\u3063\u305f\u6240\u3067\u691c\u7d22\u3057\u305f\u3089\u898b\u3064\u3051\u305f\u306e\u3067\u4eca\u56de\u306f\u3053\u308c\u3067\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u6570\u304c\u81a8\u5927\u306b\u306a\u308b\u5834\u5408\u306f\u3001[Stream\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://nodejs.org/api/stream.html#stream_api_for_stream_implementors)\u3092\u8aad\u3093\u3067Readable\u3068\u3057\u3066\u5b9f\u88c5\u3057\u305f\u307b\u3046\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## [q](https://www.npmjs.org/package/q)\n\n[Promises](http://www.promisejs.org/)\u306e\u5b9f\u88c5\u306f\u305f\u304f\u3055\u3093\u3042\u3063\u3066\u3069\u308c\u4f7f\u3048\u3070\u3044\u3044\u306e\u304b\u60a9\u307f\u307e\u3059\u3002[ComplexityMaze \u00bb Blog Archive \u00bb JavaScript Promises \u2013 a comparison of libraries](http://complexitymaze.com/2014/03/03/javascript-promises-a-comparison-of-libraries/)\u306b\u3088\u3044\u6bd4\u8f03\u8a18\u4e8b\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306f\u3001\u5192\u982d\u306e\u672c\u3067\u3082\u7d39\u4ecb\u3055\u308c\u3066\u3044\u305fQ\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nNode.js\u306eAPI\u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u7b2c1\u5f15\u6570\u306b\u30a8\u30e9\u30fcerr\u304c\u6765\u3066\u3001\u7b2c2\u5f15\u6570\u4ee5\u4e0b\u306b\u7d50\u679c\u306e\u30c7\u30fc\u30bf\u304c\u6765\u308b\u3082\u306e\u304c\u591a\u3044\u3067\u3059\u304c\u3001[Adapting Mode](https://www.npmjs.org/package/q#adapting-node)\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bQ.nfcall()\u3068\u304bQ.nfapply()\u3092\u4f7f\u3046\u3068\u7c21\u5358\u306bPromise\u5316\u3067\u304d\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u8907\u6570\u306ePromise\u3092\u5b9f\u884c\u3057\u3066\u5b8c\u4e86\u3092\u5f85\u3064Q.all()\u306a\u3069\u3082\u3042\u308a\u307e\u3059\u3002\n\n## [jschardet](https://www.npmjs.org/package/jschardet)\n\n\u6587\u5b57\u5217\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u81ea\u52d5\u5224\u5b9a\u3057\u3066\u304f\u308c\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\u51e6\u7406\u5bfe\u8c61\u306eHTML\u30d5\u30a1\u30a4\u30eb\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304cutf-8\u3067\u306f\u306a\u304feuc-jp\u3084shift_jis\u3067\u3082\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u81ea\u52d5\u5224\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n## [iconv](https://www.npmjs.org/package/iconv)\n\n\u6587\u5b57\u5217\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u5909\u63db\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002C++\u3068JavaScript\u3067\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* C++\u306e\u30bd\u30fc\u30b9[node-iconv/src/binding.cc at master \u00b7 bnoordhuis/node-iconv](https://github.com/bnoordhuis/node-iconv/blob/master/src/binding.cc)\n* JavaScript\u306e\u30bd\u30fc\u30b9[node-iconv/lib/iconv.js at master \u00b7 bnoordhuis/node-iconv](https://github.com/bnoordhuis/node-iconv/blob/master/lib/iconv.js)\n\niconv\u306f[Stream](http://nodejs.org/api/stream.html#stream_class_stream_transform)\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001[readable.pipe(destination, [options])](http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options)\u3067\u7e4b\u3044\u3067\u7c21\u5358\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001\u8aad\u307f\u8fbc\u307f\u6642\u306fjschardet\u3067\u5165\u529b\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u81ea\u52d5\u5224\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067pipe()\u3092\u4f7f\u308f\u305a\u306b\u3001convert()\u3067\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3082\u3057\u3001\u5165\u529b\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u304ceuc-jp\u56fa\u5b9a\u306a\u3089\u3001[fs.readFile(filename, [options], callback)](http://nodejs.org/api/fs.html#fs_fs_readfile_filename_options_callback)\u3067\u306f\u306a\u304f[fs.createReadStream(path, [options])](http://nodejs.org/api/fs.html#fs_fs_createreadstream_path_options)\u3092\u4f7f\u3063\u3066\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u3001pipe()\u3067iconv\u306b\u3064\u306a\u3052\u308c\u3070\u3059\u3063\u304d\u308a\u66f8\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```js\n  iconv = new Iconv('EUC-JP', 'UTF-8//TRANSLIT//IGNORE');\n  fs.createReadStream(inputFile).pipe(iconv)\n```\n\n## [cheerio](https://www.npmjs.org/package/cheerio)\n\n\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3046\u3068jQuery\u3063\u307d\u304fHTML\u306e\u8981\u7d20\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001```$```\u306fjQuery\u306e\u3088\u3046\u306b\u56fa\u5b9a\u3067\u306f\u306a\u304fHTML\u3092\u8aad\u307f\u8fbc\u3093\u3060\u7d50\u679c\u3092$\u306b\u8a2d\u5b9a\u3057\u3066\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u305f\u308a\u3001\u3044\u308d\u3044\u308d\u9055\u3044\u306f\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u3001JavaScript\u3092\u89e3\u91c8\u3057\u3066DOM\u8981\u7d20\u3092\u66f4\u65b0\u3057\u305f\u308a\u306f\u3057\u306a\u3044\u3088\u3046\u3067\u3001\u7d14\u7c8b\u306bHTML\u3092\u8aad\u307f\u8fbc\u3093\u3060\u7d50\u679c\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002\n\n## [csv](https://www.npmjs.org/package/csv)\n\nCSV\u3092\u5165\u51fa\u529b\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002[Stream](http://nodejs.org/api/stream.html#stream_class_stream_transform)\u5bfe\u5fdc\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u5165\u529b\u3084\u51fa\u529b\u306b\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u6e21\u3059\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n# [readable.pipe(destination, [options])](http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options)\u3092\u4f7f\u3046\u3068\u304d\u306e\u6ce8\u610f\n\n\u4eca\u56de\u4e00\u756a\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\u306f\u3001CSV\u306b\u51fa\u529b\u3059\u308b\u3068\u304d\u306bpipe()\u3092\u4f7f\u7528\u3057\u3066SJIS\u306b\u5909\u63db\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3067\u3059\u3002\n\n```js:\u6b63\u3057\u3044\u5b9f\u88c5\n    iconv.pipe(fs.createWriteStream(outFile));\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv, { header: true });\n```\n\n\u6700\u521d\u3053\u308c\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3001\u51fa\u529b\u3055\u308c\u305fCSV\u30d5\u30a1\u30a4\u30eb\u304cSJIS\u3067\u306f\u306a\u304fUTF-8\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n```js:\u9593\u9055\u3063\u305f\u5b9f\u88c5\u4f8b\n    csv().from([columns].concat(rows), { columns: true })\n    .to(iconv.pipe(fs.createWriteStream(outFile)), { header: true });\n```\n\n[readable.pipe(destination, [options])](http://nodejs.org/api/stream.html#stream_readable_pipe_destination_options)\u306b\u304d\u3061\u3093\u3068\u8aac\u660e\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001pipe()\u306e\u623b\u308a\u5024\u306f\u5165\u529breadable\u3067\u306f\u306a\u304f\u51fa\u529bdestination\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f```r.pipe(z).pipe(w)```\u3068\u8907\u6570\u306e\u30d1\u30a4\u30d7\u3092\u7e4b\u3052\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\n\u4e0a\u306e\u9593\u9055\u3063\u305f\u4f8b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3057\u307e\u3046\u3068```csv()```\u304b\u3089\u306e\u51fa\u529b\u306f```iconv```\u3067\u306f\u306a\u304f```fs.createWriteStream(outFile)```\u306b\u6e21\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002"}