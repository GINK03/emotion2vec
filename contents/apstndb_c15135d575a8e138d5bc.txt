{"context": "\n\n\u8981\u7d04\n\nGoogle Cloud SQL Second Generation \u304c\u30ea\u30ea\u30fc\u30b9\nGCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u63a5\u7d9a\u3059\u308b\u306b\u306f Cloud SQL Proxy \u3092\u4f7f\u7528\u3059\u308b\n\n\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u5b89\u5168\n\n\nGCE \u30c7\u30d5\u30a9\u30eb\u30c8\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u4f7f\u3048\u308b\n\n\n2\u7a2e\u985e\u306e\u63a5\u7d9a\u65b9\u6cd5\u306b\u5bfe\u5fdc\n\n\nUnix Domain Socket\nTCP Socket\n\n\n\n\n\n\n\u306f\u3058\u3081\u306b\nBeta \u3060\u3063\u305f Google Cloud SQL Second Generation \u304c 2016/8/16 \u306b GA \u306b\u306a\u3063\u305f\u3002\nGoogle Cloud Platform \u3067\u306f\u9577\u3089\u304f\u30de\u30cd\u30fc\u30b8\u30c9\u306a RDBMS \u3092\u63d0\u4f9b\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u304c AWS \u306e RDS \u3068\u6bd4\u3079\u3066\u5f31\u304b\u3063\u305f\u304c\u3001 Google Cloud SQL \u306e Second Generation \u306f RDS/MySQL \u3084 GCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306e MySQL \u304b\u3089\u306e\u4e57\u308a\u63db\u3048\u308b\u9078\u629e\u80a2\u306b\u306a\u308a\u3046\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u306a\u3063\u3066\u3044\u308b\u3002\u4eca\u56de\u306f Google Cloud SQL \u306b\u5bfe\u3059\u308b GCE \u304b\u3089\u306e\u63a5\u7d9a\u65b9\u6cd5\u3092\u307e\u3068\u3081\u308b\u3002\n\n\u74b0\u5883\u60c5\u5831\nClient: OS X El Capitan (10.11.5)\nGoogle Cloud SDK: 121.0.0\nCloud SQL Proxy: 1.05\n\u4eca\u56de\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3092 cloud-sql-test \u3068\u3059\u308b\u3002 gcloud config \u306f\u9069\u5207\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u9032\u3081\u308b\u3002\u307e\u305f\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089 Google Compute Engine API, Google Cloud SQL API \u3092\u305d\u308c\u305e\u308c\u6709\u52b9\u306b\u3059\u308b\u3002\n\n\u74b0\u5883\u69cb\u7bc9\n\nCloud SQL \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nGoogle Cloud SDK \u306b\u542b\u307e\u308c\u308b gcloud \u30b3\u30de\u30f3\u30c9\u304b\u3089 Cloud SQL \u3092\u4f7f\u7528\u3059\u308b\u306b\u306f gcloud sql \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3002\nSecond Generation \u3067\u306f --activation-policy \u306e\u6307\u5b9a\u306f\u5fc5\u9808\u3060\u304c\u3001Second Generation \u306f\u4f7f\u7528\u306b\u5bfe\u3059\u308b\u5f93\u91cf\u8ab2\u91d1\u306a\u306e\u3067\u5e38\u306b ALWAYS \u3092\u6307\u5b9a\u3057\u3066\u826f\u3044\u3060\u308d\u3046\u3002( \u53c2\u7167 Which activation policy should I use? )\ngcloud beta sql instances create sql-instance --database-version=MYSQL_5_7 --tier=db-f1-micro --activation-policy=ALWAYS --region=asia-east1\n\n( \u6ce8: 2016/8/17 \u73fe\u5728\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u308b Cloud SDK 121.0.0 \u3067\u306f gcloud sql \u306f --database-version=MYSQL_5_7 \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081 gcloud beta sql \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002)\n\n\u63a5\u7d9a\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066\u306e GCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\nCloud SQL \u306b\u63a5\u7d9a\u3059\u308b\u306b\u306f \u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9\u306b\u3088\u308b\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u304b Cloud SQL Proxy \u304c\u5fc5\u8981\u3068\u306a\u308b\u3002\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306a\u3069\u3092\u8003\u616e\u3059\u308b\u3068\u63a5\u7d9a\u5143\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u306f\u4e00\u822c\u7684\u306b\u96e3\u3057\u3044\u3053\u3068\u3082\u3042\u308a\u3001Cloud SQL Proxy \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002Cloud SQL Proxy \u306e\u4f7f\u7528\u306b\u306f\u9069\u5207\u306a\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3042\u308b\u3002\u4eca\u56de\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b GCE \u30c7\u30d5\u30a9\u30eb\u30c8\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e sql-admin \u30b9\u30b3\u30fc\u30d7\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3059\u308b\u3002\ngcloud compute instances create sql-client --scopes=sql-admin --machine-type=f1-micro\n\n\n\u63a5\u7d9a\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b SSH \u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3002\u4eca\u56de\u306f debian \u30e6\u30fc\u30b6\u3092\u7528\u3044\u308b\u3002\ngcloud compute ssh debian@sql-client\n\ncloud_sql_proxy \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u53ef\u80fd\u306a\u72b6\u614b\u306b\u3059\u308b\u3002\ncurl https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -o cloud_sql_proxy\nchmod +x cloud_sql_proxy\nsudo mkdir /cloudsql; sudo chmod 777 /cloudsql\n\n\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081 mysql \u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nsudo apt-get install mysql-client\n\n\u63a5\u7d9a\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u5927\u304d\u304f\u5206\u3051\u3066 Unix Domain Socket \u3068 TCP Socket \u306e2\u901a\u308a\u304c\u3042\u308b\u3002\n\u4eca\u56de\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u3082\u306e\u3082\u542b\u3080\u63a5\u7d9a\u60c5\u5831\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\nhttps://cloud.google.com/sql/docs/sql-proxy#instances-options\n\u63a5\u7d9a\u5148\u60c5\u5831\u306f [PROJECT]:[REGION]:[INSTANCE_ID] \u306e\u5f62\u5f0f\u3068\u306a\u308b\u3002\u4ee5\u4e0b\u3067\u306f cloud-sql-test:asia-east1:sql-instance \u3068\u3057\u3066\u8aac\u660e\u3059\u308b\u3002\n\nUnix Domain Socket \u3092\u4f7f\u3063\u305f\u63a5\u7d9a\nMySQL \u306f localhost \u3078\u306e\u63a5\u7d9a\u65b9\u6cd5\u3068\u3057\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Unix Domain Socket \u3092\u4f7f\u7528\u3059\u308b\u3002TCP Socket \u3088\u308a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5c11\u306a\u3044\u305f\u3081\u6027\u80fd\u306b\u3082\u512a\u308c\u308b\u3068\u3055\u308c\u3066\u3044\u308b\u3002Unix Domain Socket \u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u4eca\u56de\u306f -fuse \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3002\nsudo apt-get install fuse\n\nsudo ./cloud_sql_proxy -dir=/cloudsql -fuse\n\nmysql --user root --socket /cloudsql/cloud-sql-test:asia-east1:sql-instance\n\nfuse \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u30e1\u30ea\u30c3\u30c8\u306f Unix Domain Socket \u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u958b\u3053\u3046\u3068\u3059\u308b\u307e\u3067\u63a5\u7d9a\u5148\u306e\u6307\u5b9a\u3092\u9045\u5ef6\u3067\u304d\u308b\u3053\u3068\u3067\u3042\u308b\u3002\u3053\u308c\u306f cloud_sql_proxy \u30b3\u30de\u30f3\u30c9\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u306f\u306a\u304f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306b\u63a5\u7d9a\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u96c6\u7d04\u3067\u304d\u308b\u3068\u3044\u3046\u70b9\u3067\u512a\u4f4d\u6027\u304c\u3042\u308b\u3002\n\nTCP Socket\u3092\u4f7f\u3063\u305f\u63a5\u7d9a\nUnix Domain Socket \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u3057\u304f\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089 MySQL \u306b\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f TCP Socket\u3092\u901a\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nTCP Socket\u3092 listen \u3059\u308b\u6bb5\u968e\u3067 cloud_sql_proxy \u306b\u63a5\u7d9a\u60c5\u5831\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nsudo ./cloud_sql_proxy -dir=/cloudsql -instances='cloud-sql-test:asia-east1:sql-instance=tcp:3306'\n\nmysql --user root --host 127.0.0.1\n\n# localhost \u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f protocol \u3092 TCP \u306b\u5f37\u5236\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002(--port 3306 \u3068\u3057\u3066\u3082 unix socket \u306b\u7e4b\u3052\u306b\u3044\u304f\u306e\u306f\u5909\u308f\u3089\u306a\u3044)\n\nmysql --user root --host localhost --protocol TCP\n\n\n\n\u4eca\u56de\u306e\u69cb\u6210\u306e Deployment Manager \u7248\n\u4eca\u56de\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\u306b gcloud \u30b3\u30de\u30f3\u30c9\u3067\u69cb\u6210\u3057\u305f\u74b0\u5883\u306f\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3067\u69cb\u6210\u3067\u304d\u308b\u3002\n\ncloudsql.yaml\nresources:\n- type: sqladmin.v1beta4.instance\n  name: sql-instance\n  properties:\n    region: asia-east1\n    databaseVersion: MYSQL_5_7\n    settings:\n      tier: db-f1-micro\n      activationPolicy: ALWAYS\n- type: compute.v1.instance\n  name: sql-client\n  properties:\n    zone: asia-east1-a\n    machineType: zones/asia-east1-a/machineTypes/f1-micro\n    serviceAccounts:\n    # email of Compute Engine default service account\n    - email: XXXXXXXXXXXX-compute@developer.gserviceaccount.com\n      scopes:\n      - https://www.googleapis.com/auth/sqlservice.admin\n    disks:\n    - deviceName: boot\n      type: PERSISTENT\n      boot: true\n      autoDelete: true\n      initializeParams:\n        sourceImage: projects/debian-cloud/global/images/family/debian-8\n    networkInterfaces:\n    - network: global/networks/default\n      accessConfigs:\n      - name: External NAT\n        type: ONE_TO_ONE_NAT\n\n\nXXXXXXXXXXXX-compute@developer.gserviceaccount.com \u306f\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u305f Compute Engine default service account \u306e\u30a2\u30c9\u30ec\u30b9\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\ngcloud iam service-accounts list\n\n\u4e0b\u8a18\u306e\u4f8b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3067\u304d\u308b\u3002\ngcloud deployment-manager deployments create --config cloudsql.yaml cloudsql\n\n\n## \u8981\u7d04\n\n- Google Cloud SQL Second Generation \u304c\u30ea\u30ea\u30fc\u30b9\n- GCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u63a5\u7d9a\u3059\u308b\u306b\u306f Cloud SQL Proxy \u3092\u4f7f\u7528\u3059\u308b\n\t- \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u5b89\u5168\n\t\t- GCE \u30c7\u30d5\u30a9\u30eb\u30c8\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u4f7f\u3048\u308b\n\t- 2\u7a2e\u985e\u306e\u63a5\u7d9a\u65b9\u6cd5\u306b\u5bfe\u5fdc\n\t\t- Unix Domain Socket\n\t\t- TCP Socket\n\n## \u306f\u3058\u3081\u306b\n\nBeta \u3060\u3063\u305f Google Cloud SQL Second Generation \u304c 2016/8/16 \u306b GA \u306b\u306a\u3063\u305f\u3002\n\nGoogle Cloud Platform \u3067\u306f\u9577\u3089\u304f\u30de\u30cd\u30fc\u30b8\u30c9\u306a RDBMS \u3092\u63d0\u4f9b\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u304c AWS \u306e RDS \u3068\u6bd4\u3079\u3066\u5f31\u304b\u3063\u305f\u304c\u3001 Google Cloud SQL \u306e Second Generation \u306f RDS/MySQL \u3084 GCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u306e MySQL \u304b\u3089\u306e\u4e57\u308a\u63db\u3048\u308b\u9078\u629e\u80a2\u306b\u306a\u308a\u3046\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u306a\u3063\u3066\u3044\u308b\u3002\u4eca\u56de\u306f Google Cloud SQL \u306b\u5bfe\u3059\u308b GCE \u304b\u3089\u306e\u63a5\u7d9a\u65b9\u6cd5\u3092\u307e\u3068\u3081\u308b\u3002\n\n## \u74b0\u5883\u60c5\u5831\n\nClient: OS X El Capitan (10.11.5)\nGoogle Cloud SDK: 121.0.0\nCloud SQL Proxy: 1.05\n\n\u4eca\u56de\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3092 cloud-sql-test \u3068\u3059\u308b\u3002 gcloud config \u306f\u9069\u5207\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u9032\u3081\u308b\u3002\u307e\u305f\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089 Google Compute Engine API, Google Cloud SQL API \u3092\u305d\u308c\u305e\u308c\u6709\u52b9\u306b\u3059\u308b\u3002\n\n## \u74b0\u5883\u69cb\u7bc9\n\n### Cloud SQL \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\nGoogle Cloud SDK \u306b\u542b\u307e\u308c\u308b `gcloud` \u30b3\u30de\u30f3\u30c9\u304b\u3089 Cloud SQL \u3092\u4f7f\u7528\u3059\u308b\u306b\u306f `gcloud sql` \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3002\nSecond Generation \u3067\u306f `--activation-policy` \u306e\u6307\u5b9a\u306f\u5fc5\u9808\u3060\u304c\u3001Second Generation \u306f\u4f7f\u7528\u306b\u5bfe\u3059\u308b\u5f93\u91cf\u8ab2\u91d1\u306a\u306e\u3067\u5e38\u306b `ALWAYS` \u3092\u6307\u5b9a\u3057\u3066\u826f\u3044\u3060\u308d\u3046\u3002( \u53c2\u7167 [Which activation policy should I use?](https://cloud.google.com/sql/faq#activation_policy) )\n\n```bash:\ngcloud beta sql instances create sql-instance --database-version=MYSQL_5_7 --tier=db-f1-micro --activation-policy=ALWAYS --region=asia-east1\n```\n\n( \u6ce8: 2016/8/17 \u73fe\u5728\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u308b Cloud SDK 121.0.0 \u3067\u306f `gcloud sql` \u306f `--database-version=MYSQL_5_7` \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u305f\u3081 `gcloud beta sql` \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002)\n\n\n### \u63a5\u7d9a\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066\u306e GCE \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\nCloud SQL \u306b\u63a5\u7d9a\u3059\u308b\u306b\u306f \u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9\u306b\u3088\u308b\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u304b Cloud SQL Proxy \u304c\u5fc5\u8981\u3068\u306a\u308b\u3002\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306a\u3069\u3092\u8003\u616e\u3059\u308b\u3068\u63a5\u7d9a\u5143\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u306f\u4e00\u822c\u7684\u306b\u96e3\u3057\u3044\u3053\u3068\u3082\u3042\u308a\u3001Cloud SQL Proxy \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u3066\u3044\u308b\u3002Cloud SQL Proxy \u306e\u4f7f\u7528\u306b\u306f\u9069\u5207\u306a\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3042\u308b\u3002\u4eca\u56de\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b GCE \u30c7\u30d5\u30a9\u30eb\u30c8\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e sql-admin \u30b9\u30b3\u30fc\u30d7\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3059\u308b\u3002\n\n```bash:\ngcloud compute instances create sql-client --scopes=sql-admin --machine-type=f1-micro\n```\n\n\n## \u63a5\u7d9a\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b SSH \u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3002\u4eca\u56de\u306f debian \u30e6\u30fc\u30b6\u3092\u7528\u3044\u308b\u3002\n\n```bash:\ngcloud compute ssh debian@sql-client\n```\n\ncloud_sql_proxy \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u53ef\u80fd\u306a\u72b6\u614b\u306b\u3059\u308b\u3002\n\n```bash:\ncurl https://dl.google.com/cloudsql/cloud_sql_proxy.linux.amd64 -o cloud_sql_proxy\nchmod +x cloud_sql_proxy\nsudo mkdir /cloudsql; sudo chmod 777 /cloudsql\n```\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081 mysql \u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```bash:\nsudo apt-get install mysql-client\n```\n\n\u63a5\u7d9a\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u5927\u304d\u304f\u5206\u3051\u3066 Unix Domain Socket \u3068 TCP Socket \u306e2\u901a\u308a\u304c\u3042\u308b\u3002\n\n\u4eca\u56de\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u3082\u306e\u3082\u542b\u3080\u63a5\u7d9a\u60c5\u5831\u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\nhttps://cloud.google.com/sql/docs/sql-proxy#instances-options\n\n\u63a5\u7d9a\u5148\u60c5\u5831\u306f `[PROJECT]:[REGION]:[INSTANCE_ID]` \u306e\u5f62\u5f0f\u3068\u306a\u308b\u3002\u4ee5\u4e0b\u3067\u306f `cloud-sql-test:asia-east1:sql-instance` \u3068\u3057\u3066\u8aac\u660e\u3059\u308b\u3002\n\n### Unix Domain Socket \u3092\u4f7f\u3063\u305f\u63a5\u7d9a\n\nMySQL \u306f localhost \u3078\u306e\u63a5\u7d9a\u65b9\u6cd5\u3068\u3057\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Unix Domain Socket \u3092\u4f7f\u7528\u3059\u308b\u3002TCP Socket \u3088\u308a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5c11\u306a\u3044\u305f\u3081\u6027\u80fd\u306b\u3082\u512a\u308c\u308b\u3068\u3055\u308c\u3066\u3044\u308b\u3002Unix Domain Socket \u306e\u4f7f\u7528\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u304c\u3001\u4eca\u56de\u306f -fuse \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3002\n\n```bash:\nsudo apt-get install fuse\n\nsudo ./cloud_sql_proxy -dir=/cloudsql -fuse\n\nmysql --user root --socket /cloudsql/cloud-sql-test:asia-east1:sql-instance\n```\n\nfuse \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u30e1\u30ea\u30c3\u30c8\u306f Unix Domain Socket \u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u958b\u3053\u3046\u3068\u3059\u308b\u307e\u3067\u63a5\u7d9a\u5148\u306e\u6307\u5b9a\u3092\u9045\u5ef6\u3067\u304d\u308b\u3053\u3068\u3067\u3042\u308b\u3002\u3053\u308c\u306f cloud_sql_proxy \u30b3\u30de\u30f3\u30c9\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u306f\u306a\u304f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5074\u306b\u63a5\u7d9a\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u96c6\u7d04\u3067\u304d\u308b\u3068\u3044\u3046\u70b9\u3067\u512a\u4f4d\u6027\u304c\u3042\u308b\u3002\n\n### TCP Socket\u3092\u4f7f\u3063\u305f\u63a5\u7d9a\n\nUnix Domain Socket \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u3057\u304f\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089 MySQL \u306b\u63a5\u7d9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f TCP Socket\u3092\u901a\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nTCP Socket\u3092 listen \u3059\u308b\u6bb5\u968e\u3067 cloud_sql_proxy \u306b\u63a5\u7d9a\u60c5\u5831\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```bash\nsudo ./cloud_sql_proxy -dir=/cloudsql -instances='cloud-sql-test:asia-east1:sql-instance=tcp:3306'\n\nmysql --user root --host 127.0.0.1\n\n# localhost \u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f protocol \u3092 TCP \u306b\u5f37\u5236\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002(--port 3306 \u3068\u3057\u3066\u3082 unix socket \u306b\u7e4b\u3052\u306b\u3044\u304f\u306e\u306f\u5909\u308f\u3089\u306a\u3044)\n\nmysql --user root --host localhost --protocol TCP\n\n```\n\n\n## \u4eca\u56de\u306e\u69cb\u6210\u306e Deployment Manager \u7248\n\n\u4eca\u56de\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\u306b gcloud \u30b3\u30de\u30f3\u30c9\u3067\u69cb\u6210\u3057\u305f\u74b0\u5883\u306f\u4e0b\u8a18\u30d5\u30a1\u30a4\u30eb\u3067\u69cb\u6210\u3067\u304d\u308b\u3002\n\n```yaml:cloudsql.yaml\nresources:\n- type: sqladmin.v1beta4.instance\n  name: sql-instance\n  properties:\n    region: asia-east1\n    databaseVersion: MYSQL_5_7\n    settings:\n      tier: db-f1-micro\n      activationPolicy: ALWAYS\n- type: compute.v1.instance\n  name: sql-client\n  properties:\n    zone: asia-east1-a\n    machineType: zones/asia-east1-a/machineTypes/f1-micro\n    serviceAccounts:\n    # email of Compute Engine default service account\n    - email: XXXXXXXXXXXX-compute@developer.gserviceaccount.com\n      scopes:\n      - https://www.googleapis.com/auth/sqlservice.admin\n    disks:\n    - deviceName: boot\n      type: PERSISTENT\n      boot: true\n      autoDelete: true\n      initializeParams:\n        sourceImage: projects/debian-cloud/global/images/family/debian-8\n    networkInterfaces:\n    - network: global/networks/default\n      accessConfigs:\n      - name: External NAT\n        type: ONE_TO_ONE_NAT\n```\n\n`XXXXXXXXXXXX-compute@developer.gserviceaccount.com` \u306f\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u305f `Compute Engine default service account` \u306e\u30a2\u30c9\u30ec\u30b9\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```\ngcloud iam service-accounts list\n```\n\n\u4e0b\u8a18\u306e\u4f8b\u306e\u3088\u3046\u306b\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n```bash\ngcloud deployment-manager deployments create --config cloudsql.yaml cloudsql\n```\n", "tags": ["googlecomputeengine", "GoogleCloudPlatform", "gcp", "GoogleCloudSQL", "gce"]}