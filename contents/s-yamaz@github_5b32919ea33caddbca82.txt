{"context": " More than 1 year has passed since last update.\n\n0. \u524d\u63d0\u6761\u4ef6\nruby\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306f\u524d\u63d0\u3068\u3057\u3066\u8a18\u8f09\u3059\u308b\u3002\n\u4f5c\u696d\u306froot\u3067\u5b9f\u65bd\u3002\n\n1. MySQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nRedmine\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306bMySQL\u3092\u5229\u7528\u3057\u305f\u3044\u305f\u3081\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u3053\u3053\u3067\u306f 5.5\u7cfb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306eMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bremi\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\nrpm -ivh http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel/6/x86_64/epel-release-6-7.noarch.rpm\nrpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n* remi\u30d1\u30c3\u30b1\u30fc\u30b8\u306fepel\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081epel\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u5148\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\u4f5c\u6210\u3055\u308c\u305f/etc/yum.repos.d/remi.repo\u3092vim\u306a\u3069\u3067\u958b\u304denable=1\u306b\u5909\u66f4\u3059\u308b\u3002\nyum install -y mysql mysql-lib mysql-devel mysql-server\n\n\u3067MySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092/etc/my.cnf\u306b\u30b3\u30d4\u30fc\u3059\u308b\ncp -af /usr/share/mysql/my-medium.cnf /etc/my.cnf\n\nchkconfig\u3067\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066mysql\u3092\u8d77\u52d5\u3059\u308b\u8a2d\u5b9a\u3092\u3057\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\nchkconfig mysqld on\nservice mysqld start\n\n\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f\nmysql -u root -e 'select user,host from mysql.user'\n\n\u306a\u3069\u3067\u884c\u3048\u3070OK.\n\n2. Redmine\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092MySQL\u306b\u8ffd\u52a0\nMySQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6e08\u3093\u3060\u3089\u3001Redmine\u7528\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u307e\u305a\u3001DB\u306echarset\u3092utf8\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n/etc/my.cnf\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n/etc/my.cnf\n[mysqld]\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\nuser=mysql\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\ncharacter-set-server=utf8 #=> \u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n[mysqld_safe]\nlog-error=/var/log/mysqld.log\npid-file=/var/run/mysqld/mysqld.pid\n\n[mysql]\ndefault-character-set=utf8 #=>\u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n\n\u6587\u5b57\u30bb\u30c3\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u305f\u3089\u3001MySQL\u3092\u8d77\u52d5\u3059\u308b\u3002\nservice mysqld start\n\n\u8d77\u52d5\u3057\u305f\u3089\u3001Redmine\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3059\u308b\u3002\nmysql -uroot\n\nmysql> CREATE DATABASE redmine DEFAULT CHARACTER SET utf8;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> SHOW DATABASES;\u3067\u78ba\u8a8d\u3059\u308b\u3068redmine\u3068\u3044\u3046DB\u304c\u3067\u304d\u3066\u3044\u308b\u306f\u305a\u3002\n\u6b21\u306b\u3001redmine\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u6301\u3064\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\nmysql> GRANT ALL ON redmine.* TO redmine@'localhost' IDENTIFIED BY 'hogehoge';\n\nmysql> FLUSH PRIVILEGES;\n\nhogehoge\u306e\u90e8\u5206\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3002\n\n3. Redmine\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30bd\u30fc\u30b9\u306f\u3069\u306e\u3088\u3046\u306a\u65b9\u6cd5\u3067\u624b\u306b\u5165\u308c\u3066\u3082\u826f\u3044\u3068\u601d\u3046\u304c\u3001\u4eca\u56de\u306fGithub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092clone\u3057\u3066\u5229\u7528\u3059\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306fRedmine\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30ac\u30a4\u30c9\u306b\u5f93\u3044\u3001/var/lib\u4e0b\u306b\u3059\u308b\u3002\ncd /var/lib/\n\ngit clone https://github.com/redmine/redmine.git redmine\n\ncd redmine\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30d6\u30e9\u30f3\u30c1\u3078\u5207\u308a\u66ff\u3048\u308b\u3002\ngit checkout -b 2.1-stable remotes/origin/2.1-stable\n\nbundler\u3067\u4f9d\u5b58gem\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002develop\u30b0\u30eb\u30fc\u30d7\u3084test\u30b0\u30eb\u30fc\u30d7\u3001\u5229\u7528\u3057\u306a\u3044postgresql\u3068sqlite3\u306e\u30a2\u30c0\u30d7\u30bf\u7b49\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u3044\u3002\nbundle exec install --path vendor/bundle --without development test postgresql sqlite\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u306e\u6697\u53f7\u5316\u9375\u3092\u751f\u6210\u3059\u308b\u3002\nbundle exec rake generate_secret_token\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u69cb\u7bc9\nRAILS_ENV=production bundle exec rake db:migrate\n\n\u3053\u3053\u307e\u3067\u3067\u4e00\u5ea6\u3001Webrick\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\n(iptables\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30dd\u30fc\u30c83000\u756a\u3092\u3042\u3051\u3066\u304a\u304f\u3002)\nbundle exec rails s -e production\n\n\n4. Unicorn\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nunicorn\u306fbundler\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nGemfile.local\u3092\u4f5c\u6210\u3057\u4ee5\u4e0b\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\nGemfile.local\ngem 'unicorn'\n\n\nGemfile.local\u3092\u7de8\u96c6\u3057\u7d42\u3048\u305f\u3089bundle install\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n5. Unicorn\u306e\u8a2d\u5b9a & \u30b5\u30fc\u30d3\u30b9\u5316\nunicorn\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\u8a2d\u5b9a\u306fgithub\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304d\u3001\u5fc5\u8981\u306a\u90e8\u5206\u3092\u5909\u66f4\u3059\u308b\u3002(\u3082\u3061\u308d\u3093\u3001\u81ea\u5206\u3067\u66f8\u3044\u3066\u3082OK)\ncd /var/lib/redmine/config/\nwget -O unicorn_redmine.rb https://raw.github.com/defunkt/unicorn/master/examples/unicorn.conf.rb\nvim unicorn_redmine.rb\n\n\u4eca\u56de\u306fhttp://\u30db\u30b9\u30c8\u540d/redmine\u3068\u3044\u3046\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u306e\u904b\u7528\u3092\u8003\u3048\u3066\u3044\u308b\u305f\u3081\u3001\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7528\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n/var/lib/redmine/config.ru\u3092\u4ee5\u4e0b\u306e\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\n/var/lib/redmine/config.ru\nif ENV['RAILS_RELATIVE_URL_ROOT'] #=> \u8ffd\u52a0\n  map ENV['RAILS_RELATIVE_URL_ROOT'] do #=>\u8ffd\u52a0\n    run RedmineApp::Application #=> \u8ffd\u52a0\n  end #=> \u8ffd\u52a0\nelse #=> \u8ffd\u52a0\n  run RedmineApp::Application\nend #=> \u8ffd\u52a0\n\n\n\u3067\u3001unicorn\u8d77\u52d5\u6642\u306b --path /redmine\u3092\u4ed8\u52a0\u3059\u308b\u3068\u3001ENV['RAILS_RELATIVE_URL_ROOT']\u306b/redmine\u304c\u5165\u3063\u3066\u304d\u3066\u3001\nhttp://\u30db\u30b9\u30c8\u540d/redmine\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u5bf8\u6cd5\u3002\n\u6b21\u306b\u3001\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3059\u308b\u3002Web\u4e0a\u306b\u3042\u308b\u30b5\u30f3\u30d7\u30eb\u7b49\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u3044\u3066\u4f5c\u6210\u3059\u308c\u3070\u826f\u3044\u3068\u601d\u3046\u3002\u4eca\u56de\u306f\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u904b\u7528\u3092\u8003\u3048\u3066\u3044\u308b\u306e\u3067\u3001unicorn\u8d77\u52d5\u6642\u306b\u4e0a\u8ff0\u306e--path /redmine\u3092\u4ed8\u52a0\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n/etc/init.d/redmine\n#!/bin/bash\n#\n# redmine Startup script for unicorn.\n#\n# chkconfig: - 86 15\n# description: redmine on unicorn start/stop script.\n\n#\n# set rbenv environment valiables\n#\nexport PATH=/usr/local/bin:/usr/bin:/usr/local/rbenv/versions/1.9.3-p327/bin\nexport RUBY_HOME=/usr/local/rbenv/versions/1.9.3-p327\n\nset -u\nset -e\n\nAPP_NAME=redmine\nAPP_ROOT=\"/var/lib/$APP_NAME\"\nCONFIGS=\"$APP_ROOT/config/unicorn_redmine.rb\"\nPID=\"$APP_ROOT/config/shared/pids/unicorn.pid\"\nENV=production\n\nUNICORN_OPTS=\"-D -E $ENV -c $CONFIGS --path /redmine -p 8080\"\n\nold_pid=\"$PID.oldbin\"\n\ncd $APP_ROOT || exit 1\n\nsig(){\n  test -s \"$PID\" && kill -$1 `cat $PID`\n}\n\noldsig(){\n  test -s $old_pid && kill -$1 `cat $old_pid`\n}\n\ncase $1 in\nstart)\n  sig 0 && echo >&2 \"Already running\" && exit 0\n  cd $APP_ROOT ; bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nstop)\n  sig QUIT && exit 0\n  echo >&2 \"Not running\"\n  ;;\nforce-stop)\n  sig TERM && exit 0\n  echo >&2 \"Not running.\"\n  ;;\nrestart|reload)\n  sig HUP && echo reloaded OK && exit 0\n  echo >&2 \"Couldn't reload, starting instead\"\n  bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nupgrade)\n  sig USR2 && exit 0\n  echo >&2 \"Couldn't upgrade, starting instead\"\n  bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nrotate)\n  sig USR1 && echo rotated logs OK && exit 0\n  echo >&2 \"Couldn't rotate logs\" && exit 1\n  ;;\n*)\n  echo >&2 \"Usage: $0 <start|stop|restart|upgrade|rotate|force-stop>\"\n  exit 1\n  ;;\nesac\n\n\n\u8a18\u8f09\u3057\u305f\u3089\u3001chmod 755 /etc/init.d/redmine\u3067\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3066\u304a\u304f\u3002\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u305f\u306e\u3067chkconfig\u306b\u8ffd\u52a0\u3057\u3066\u304a\u304f\u3002\nchkconfig --add redmine\nchkconfig redmine on\nchkconfig --list redmine\nredmine         0:off   1:off   2:on    3:on    4:on    5:on    6:off\n\n\u5b9f\u969b\u306b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\nservice redmine start\n\n\n6.nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb & \u8a2d\u5b9a\nnginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u306e\u3082\u3042\u308a\u3060\u3068\u601d\u3046\u304c\u3001\u4eca\u56de\u306fepel\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\u3002\nyum install -y nginx\n\n/etc/nginx\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u306e\u3067\u3001/etc/nginx/conf.d/\u306bredmine\u7528\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3059\u308b\u3002(\u5f8c\u3067\u5225\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5225\u306b\u3057\u3066\u540c\u4e00\u306e\u30b5\u30fc\u30d0\u4e0a\u3067\u52d5\u304b\u3059\u4e88\u5b9a\u3067\u3042\u308b\u306e\u3067\u3001\u4eca\u56de\u306fdevelopment.conf\u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210\u3059\u308b\u3002)\n\n/etc/nginx/conf.d/development.conf\nupstream redmine {\n  server hostname:8080;#hostname\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\n}\n\nserver {\n  listen 80;\n  server_name hostname; #hostname\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\n  root /var/www;\n\n  location /redmine {\n    try_files $uri $uri.html $uri/index.html @redmine;\n  }\n\n  location @redmine{\n    #error_log /var/www/redmine/log/error.log;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_pass http://redmine;\n  }\n}\n\n\nnginx\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092/var/www\u306b\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001redmine\u306epublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n(\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306fnginx\u306b\u8fd4\u3057\u3066\u307b\u3057\u3044\u304b\u3089)\nln -s /var/lib/redmine/public redmine\n\n\u3042\u3068\u306fnginx -t\u3067\u554f\u984c\u306a\u3051\u308c\u3070service nginx restart\u3067nginx\u3092\u518d\u8d77\u52d5\u3057\u3066http://\u30db\u30b9\u30c8\u540d/redmine\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002(iptables\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f80\u30dd\u30fc\u30c8\u3092\u7a7a\u3051\u3066\u304a\u304f\u306e\u3092\u5fd8\u308c\u305a\u306b\u3002)\n\u304b\u306a\u308a\u3001\u5927\u6025\u304e\u3067\u66f8\u3044\u305f\u306e\u3067\u9593\u9055\u3044\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# 0. \u524d\u63d0\u6761\u4ef6\nruby\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306f\u524d\u63d0\u3068\u3057\u3066\u8a18\u8f09\u3059\u308b\u3002\n\u4f5c\u696d\u306froot\u3067\u5b9f\u65bd\u3002\n\n# 1. MySQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nRedmine\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306bMySQL\u3092\u5229\u7528\u3057\u305f\u3044\u305f\u3081\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u3053\u3053\u3067\u306f 5.5\u7cfb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306eMySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bremi\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```\nrpm -ivh http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel/6/x86_64/epel-release-6-7.noarch.rpm\nrpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n```\n\n\\* remi\u30d1\u30c3\u30b1\u30fc\u30b8\u306fepel\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081epel\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u5148\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\n\u4f5c\u6210\u3055\u308c\u305f`/etc/yum.repos.d/remi.repo`\u3092vim\u306a\u3069\u3067\u958b\u304d`enable=1`\u306b\u5909\u66f4\u3059\u308b\u3002\n\n```\nyum install -y mysql mysql-lib mysql-devel mysql-server\n```\n\n\u3067MySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092/etc/my.cnf\u306b\u30b3\u30d4\u30fc\u3059\u308b\n\n```\ncp -af /usr/share/mysql/my-medium.cnf /etc/my.cnf\n```\n\n`chkconfig`\u3067\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066mysql\u3092\u8d77\u52d5\u3059\u308b\u8a2d\u5b9a\u3092\u3057\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nchkconfig mysqld on\nservice mysqld start\n```\n\n\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f\n\n```\nmysql -u root -e 'select user,host from mysql.user'\n```\n\u306a\u3069\u3067\u884c\u3048\u3070OK.\n\n## 2. Redmine\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092MySQL\u306b\u8ffd\u52a0\n\nMySQL\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6e08\u3093\u3060\u3089\u3001Redmine\u7528\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u307e\u305a\u3001DB\u306echarset\u3092utf8\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n`/etc/my.cnf`\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n```/etc/my.cnf\n[mysqld]\ndatadir=/var/lib/mysql\nsocket=/var/lib/mysql/mysql.sock\nuser=mysql\n# Disabling symbolic-links is recommended to prevent assorted security risks\nsymbolic-links=0\ncharacter-set-server=utf8 #=> \u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n[mysqld_safe]\nlog-error=/var/log/mysqld.log\npid-file=/var/run/mysqld/mysqld.pid\n\n[mysql]\ndefault-character-set=utf8 #=>\u3053\u306e\u884c\u3092\u8ffd\u52a0\n```\n\n\u6587\u5b57\u30bb\u30c3\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u305f\u3089\u3001MySQL\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nservice mysqld start\n```\n\n\u8d77\u52d5\u3057\u305f\u3089\u3001Redmine\u7528\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```\nmysql -uroot\n\nmysql> CREATE DATABASE redmine DEFAULT CHARACTER SET utf8;\nQuery OK, 1 row affected (0.00 sec)\n```\n\n`mysql> SHOW DATABASES;`\u3067\u78ba\u8a8d\u3059\u308b\u3068redmine\u3068\u3044\u3046DB\u304c\u3067\u304d\u3066\u3044\u308b\u306f\u305a\u3002\n\n\u6b21\u306b\u3001redmine\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u6301\u3064\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```\nmysql> GRANT ALL ON redmine.* TO redmine@'localhost' IDENTIFIED BY 'hogehoge';\n\nmysql> FLUSH PRIVILEGES;\n```\n\n`hogehoge`\u306e\u90e8\u5206\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3002\n\n## 3. Redmine\u672c\u4f53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30bd\u30fc\u30b9\u306f\u3069\u306e\u3088\u3046\u306a\u65b9\u6cd5\u3067\u624b\u306b\u5165\u308c\u3066\u3082\u826f\u3044\u3068\u601d\u3046\u304c\u3001\u4eca\u56de\u306fGithub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092clone\u3057\u3066\u5229\u7528\u3059\u308b\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f[Redmine\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30ac\u30a4\u30c9](http://blog.redmine.jp/articles/redmine-2_1-installation_centos/)\u306b\u5f93\u3044\u3001/var/lib\u4e0b\u306b\u3059\u308b\u3002\n\n```\ncd /var/lib/\n\ngit clone https://github.com/redmine/redmine.git redmine\n\ncd redmine\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30d6\u30e9\u30f3\u30c1\u3078\u5207\u308a\u66ff\u3048\u308b\u3002\n\n```\ngit checkout -b 2.1-stable remotes/origin/2.1-stable\n```\n\n`bundler`\u3067\u4f9d\u5b58gem\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002develop\u30b0\u30eb\u30fc\u30d7\u3084test\u30b0\u30eb\u30fc\u30d7\u3001\u5229\u7528\u3057\u306a\u3044postgresql\u3068sqlite3\u306e\u30a2\u30c0\u30d7\u30bf\u7b49\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u3044\u3002\n\n```\nbundle exec install --path vendor/bundle --without development test postgresql sqlite\n```\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u306e\u6697\u53f7\u5316\u9375\u3092\u751f\u6210\u3059\u308b\u3002\n\n```\nbundle exec rake generate_secret_token\n```\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u69cb\u7bc9\n\n```\nRAILS_ENV=production bundle exec rake db:migrate\n```\n\n\u3053\u3053\u307e\u3067\u3067\u4e00\u5ea6\u3001Webrick\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\n(iptables\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30dd\u30fc\u30c83000\u756a\u3092\u3042\u3051\u3066\u304a\u304f\u3002)\n\n```\nbundle exec rails s -e production\n```\n\n## 4. Unicorn\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nunicorn\u306fbundler\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nGemfile.local\u3092\u4f5c\u6210\u3057\u4ee5\u4e0b\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n```Gemfile.local\ngem 'unicorn'\n```\n\nGemfile.local\u3092\u7de8\u96c6\u3057\u7d42\u3048\u305f\u3089`bundle install`\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n## 5. Unicorn\u306e\u8a2d\u5b9a & \u30b5\u30fc\u30d3\u30b9\u5316\n\nunicorn\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n\u8a2d\u5b9a\u306fgithub\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304d\u3001\u5fc5\u8981\u306a\u90e8\u5206\u3092\u5909\u66f4\u3059\u308b\u3002(\u3082\u3061\u308d\u3093\u3001\u81ea\u5206\u3067\u66f8\u3044\u3066\u3082OK)\n\n```\ncd /var/lib/redmine/config/\nwget -O unicorn_redmine.rb https://raw.github.com/defunkt/unicorn/master/examples/unicorn.conf.rb\nvim unicorn_redmine.rb\n```\n\n\u4eca\u56de\u306fhttp://\u30db\u30b9\u30c8\u540d/redmine\u3068\u3044\u3046\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u306e\u904b\u7528\u3092\u8003\u3048\u3066\u3044\u308b\u305f\u3081\u3001\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7528\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n/var/lib/redmine/config.ru\u3092\u4ee5\u4e0b\u306e\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\n```/var/lib/redmine/config.ru\nif ENV['RAILS_RELATIVE_URL_ROOT'] #=> \u8ffd\u52a0\n  map ENV['RAILS_RELATIVE_URL_ROOT'] do #=>\u8ffd\u52a0\n    run RedmineApp::Application #=> \u8ffd\u52a0\n  end #=> \u8ffd\u52a0\nelse #=> \u8ffd\u52a0\n  run RedmineApp::Application\nend #=> \u8ffd\u52a0\n```\n\n\u3067\u3001unicorn\u8d77\u52d5\u6642\u306b `--path /redmine`\u3092\u4ed8\u52a0\u3059\u308b\u3068\u3001`ENV['RAILS_RELATIVE_URL_ROOT']`\u306b`/redmine`\u304c\u5165\u3063\u3066\u304d\u3066\u3001\nhttp://\u30db\u30b9\u30c8\u540d/redmine\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u5bf8\u6cd5\u3002\n\n\u6b21\u306b\u3001\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3059\u308b\u3002Web\u4e0a\u306b\u3042\u308b\u30b5\u30f3\u30d7\u30eb\u7b49\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u3044\u3066\u4f5c\u6210\u3059\u308c\u3070\u826f\u3044\u3068\u601d\u3046\u3002\u4eca\u56de\u306f\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u904b\u7528\u3092\u8003\u3048\u3066\u3044\u308b\u306e\u3067\u3001unicorn\u8d77\u52d5\u6642\u306b\u4e0a\u8ff0\u306e`--path /redmine`\u3092\u4ed8\u52a0\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n```/etc/init.d/redmine\n#!/bin/bash\n#\n# redmine Startup script for unicorn.\n#\n# chkconfig: - 86 15\n# description: redmine on unicorn start/stop script.\n\n#\n# set rbenv environment valiables\n#\nexport PATH=/usr/local/bin:/usr/bin:/usr/local/rbenv/versions/1.9.3-p327/bin\nexport RUBY_HOME=/usr/local/rbenv/versions/1.9.3-p327\n\nset -u\nset -e\n\nAPP_NAME=redmine\nAPP_ROOT=\"/var/lib/$APP_NAME\"\nCONFIGS=\"$APP_ROOT/config/unicorn_redmine.rb\"\nPID=\"$APP_ROOT/config/shared/pids/unicorn.pid\"\nENV=production\n\nUNICORN_OPTS=\"-D -E $ENV -c $CONFIGS --path /redmine -p 8080\"\n\nold_pid=\"$PID.oldbin\"\n\ncd $APP_ROOT || exit 1\n\nsig(){\n  test -s \"$PID\" && kill -$1 `cat $PID`\n}\n\noldsig(){\n  test -s $old_pid && kill -$1 `cat $old_pid`\n}\n\ncase $1 in\nstart)\n  sig 0 && echo >&2 \"Already running\" && exit 0\n  cd $APP_ROOT ; bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nstop)\n  sig QUIT && exit 0\n  echo >&2 \"Not running\"\n  ;;\nforce-stop)\n  sig TERM && exit 0\n  echo >&2 \"Not running.\"\n  ;;\nrestart|reload)\n  sig HUP && echo reloaded OK && exit 0\n  echo >&2 \"Couldn't reload, starting instead\"\n  bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nupgrade)\n  sig USR2 && exit 0\n  echo >&2 \"Couldn't upgrade, starting instead\"\n  bundle exec unicorn_rails $UNICORN_OPTS\n  ;;\nrotate)\n  sig USR1 && echo rotated logs OK && exit 0\n  echo >&2 \"Couldn't rotate logs\" && exit 1\n  ;;\n*)\n  echo >&2 \"Usage: $0 <start|stop|restart|upgrade|rotate|force-stop>\"\n  exit 1\n  ;;\nesac\n```\n\n\u8a18\u8f09\u3057\u305f\u3089\u3001`chmod 755 /etc/init.d/redmine`\u3067\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3066\u304a\u304f\u3002\n\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u305f\u306e\u3067chkconfig\u306b\u8ffd\u52a0\u3057\u3066\u304a\u304f\u3002\n\n```\nchkconfig --add redmine\nchkconfig redmine on\nchkconfig --list redmine\nredmine        \t0:off\t1:off\t2:on\t3:on\t4:on\t5:on\t6:off\n```\n\n\u5b9f\u969b\u306b\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nservice redmine start\n```\n\n## 6.nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb & \u8a2d\u5b9a\n\nnginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u306e\u3082\u3042\u308a\u3060\u3068\u601d\u3046\u304c\u3001\u4eca\u56de\u306fepel\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\u3002\n\n```\nyum install -y nginx\n```\n/etc/nginx\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u306e\u3067\u3001/etc/nginx/conf.d/\u306bredmine\u7528\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3059\u308b\u3002(\u5f8c\u3067\u5225\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5225\u306b\u3057\u3066\u540c\u4e00\u306e\u30b5\u30fc\u30d0\u4e0a\u3067\u52d5\u304b\u3059\u4e88\u5b9a\u3067\u3042\u308b\u306e\u3067\u3001\u4eca\u56de\u306fdevelopment.conf\u3068\u3044\u3046\u540d\u524d\u3067\u4f5c\u6210\u3059\u308b\u3002)\n\n```/etc/nginx/conf.d/development.conf\nupstream redmine {\n  server hostname:8080;#hostname\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\n}\n\nserver {\n  listen 80;\n  server_name hostname; #hostname\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\n  root /var/www;\n\n  location /redmine {\n    try_files $uri $uri.html $uri/index.html @redmine;\n  }\n\n  location @redmine{\n    #error_log /var/www/redmine/log/error.log;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_pass http://redmine;\n  }\n}\n```\n\nnginx\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092/var/www\u306b\u8a2d\u5b9a\u3057\u305f\u306e\u3067\u3001redmine\u306epublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n(\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306fnginx\u306b\u8fd4\u3057\u3066\u307b\u3057\u3044\u304b\u3089)\n\n```\nln -s /var/lib/redmine/public redmine\n```\n\n\u3042\u3068\u306f`nginx -t`\u3067\u554f\u984c\u306a\u3051\u308c\u3070`service nginx restart`\u3067nginx\u3092\u518d\u8d77\u52d5\u3057\u3066http://\u30db\u30b9\u30c8\u540d/redmine\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002(iptables\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f80\u30dd\u30fc\u30c8\u3092\u7a7a\u3051\u3066\u304a\u304f\u306e\u3092\u5fd8\u308c\u305a\u306b\u3002)\n\n\u304b\u306a\u308a\u3001\u5927\u6025\u304e\u3067\u66f8\u3044\u305f\u306e\u3067\u9593\u9055\u3044\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n\n\n\n\n\n\n", "tags": ["Redmine"]}