{"context": "iOS 9 \u307e\u3067\u3001CoreText \u306e CTLineDraw \u306a\u3069\u3067\u6587\u5b57\u3092\u63cf\u753b\u3059\u308b\u3068\u304d\u3001\u5fc5\u8981\u3042\u3089\u3070\u624b\u52d5\u3067\u5225\u3005\u306b\u80cc\u666f\u8272\u3092\u63cf\u3044\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001iOS 10 \u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u7dd2\u306b\u80cc\u666f\u304c\u63cf\u753b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nCoreText Changes for Objective-C \u3092\u898b\u308b\u3068\u3001\u65b0\u3057\u304f kCTBackgroundColorAttributeName \u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\n\u5358\u7d14\u306b NSAttributedString \u3092 CTTypesetterCreateWithAttributedString \u306b\u6e21\u3057\u3066\u3001CTLine \u3092\u4f5c\u3063\u3066\u63cf\u753b\u3057\u3066\u307f\u307e\u3059\u3002\n\nPlayground\nimport UIKit\n\nvar attributedText = NSMutableAttributedString(string: \"\u3042\u3044\u3046\u3048\u304a\", attributes: [\n    NSForegroundColorAttributeName: UIColor.red,\n    NSBackgroundColorAttributeName: UIColor.blue\n])\n\nlet typesetter = CTTypesetterCreateWithAttributedString(attributedText)  // NSAttribtedString \u304c CFAttributedString \u306b\u30d6\u30ea\u30c3\u30b8\u3057\u3066\u6e21\u3055\u308c\u308b\nlet ctline = CTTypesetterCreateLine(typesetter, CFRangeMake(0, attributedText.length))\n\nclass TestView: UIView {\n    override init(frame: CGRect) {\n        super.init(frame: frame)\n        self.backgroundColor = UIColor.white\n    }\n\n    override func draw(_ rect: CGRect) {\n        guard let context = UIGraphicsGetCurrentContext() else { return }\n        context.textPosition = CGPoint(x: 0, y: 20)\n        context.translateBy(x: 20, y: 20)\n        CTLineDraw(ctline, context)\n    }\n\n    required init?(coder aDecoder: NSCoder) {}\n}\nlet testView = TestView(frame: CGRect(x: 0, y: 0, width: 100, height: 100))\ntestView\n\n\n\n\u9752\u3044\u80cc\u666f\u8272\u304c\u63cf\u753b\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u5f0a\u5bb3\u3068\u5bfe\u5fdc\u7b56\nCoreText (CoreGraphics) \u3068 UIKit \u3067\u306f\u5ea7\u6a19\u7cfb\u304c\u7570\u306a\u308b (y\u8ef8\u304c\u9006) \u305f\u3081\u3001\u30e6\u30fc\u30b6\u30fc\u306b\u3068\u3063\u3066\u8aad\u307f\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u63cf\u753b\u5bfe\u8c61\u3092\u4e0a\u4e0b\u53cd\u8ee2\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\uff08\u3053\u308c\u306f\u4eca\u307e\u3067\u3068\u540c\u69d8\u3067\u3059\uff09\noverride func draw(_ rect: CGRect) {\n    guard let context = UIGraphicsGetCurrentContext() else { return }\n    context.textMatrix = CGAffineTransform(scaleX: 1, y: -1)  // \u2190\u30c6\u30ad\u30b9\u30c8\u3092\u4e0a\u4e0b\u53cd\u8ee2\n    context.textPosition = CGPoint(x: 0, y: 20)\n    context.translateBy(x: 20, y: 20) \n    CTLineDraw(ctline, context)\n}\n\n\u3053\u3046\u3059\u308b\u3068\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u6587\u5b57\u5217\u306f\u4e0a\u4e0b\u53cd\u8ee2\u3057\u307e\u3059\u304c\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u80cc\u666f\u306f\u53cd\u8ee2\u3057\u306a\u3044\u7f60\u304c\u3042\u308a\u307e\u3059\ud83d\ude31\n\u2192\n\u80cc\u666f\u306f\u30c6\u30ad\u30b9\u30c8\u3068\u7d10\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u540c\u3058\u3088\u3046\u306b\u52d5\u304f\u6319\u52d5\u3092\u3059\u308b\u306e\u304c\u81ea\u7136\u3060\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3001context \u3092 scaleBy \u3067\u307e\u308b\u3054\u3068\u53cd\u8ee2\u3059\u308b\u3053\u3068\u3067\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\noverride func draw(_ rect: CGRect) {\n    guard let context = UIGraphicsGetCurrentContext() else { return }\n    context.textPosition = CGPoint(x: 0, y: -20)\n    context.translateBy(x: 20, y: 20)\n    context.scaleBy(x: 1, y: -1)\n    CTLineDraw(ctline, context)\n}\n\n\n\u4e0a\u624b\u306b\u63cf\u3051\u307e\u3057\u305f \niOS 9 \u307e\u3067\u3001CoreText \u306e CTLineDraw \u306a\u3069\u3067\u6587\u5b57\u3092\u63cf\u753b\u3059\u308b\u3068\u304d\u3001\u5fc5\u8981\u3042\u3089\u3070\u624b\u52d5\u3067\u5225\u3005\u306b\u80cc\u666f\u8272\u3092\u63cf\u3044\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001iOS 10 \u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u7dd2\u306b\u80cc\u666f\u304c\u63cf\u753b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n[CoreText Changes for Objective\\-C](https://developer.apple.com/library/prerelease/content/releasenotes/General/iOS10APIDiffs/Objective-C/CoreText.html) \u3092\u898b\u308b\u3068\u3001\u65b0\u3057\u304f `kCTBackgroundColorAttributeName` \u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n## \u4f8b\n\n\u5358\u7d14\u306b NSAttributedString \u3092 CTTypesetterCreateWithAttributedString \u306b\u6e21\u3057\u3066\u3001CTLine \u3092\u4f5c\u3063\u3066\u63cf\u753b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```swift:Playground\nimport UIKit\n\nvar attributedText = NSMutableAttributedString(string: \"\u3042\u3044\u3046\u3048\u304a\", attributes: [\n    NSForegroundColorAttributeName: UIColor.red,\n    NSBackgroundColorAttributeName: UIColor.blue\n])\n\nlet typesetter = CTTypesetterCreateWithAttributedString(attributedText)  // NSAttribtedString \u304c CFAttributedString \u306b\u30d6\u30ea\u30c3\u30b8\u3057\u3066\u6e21\u3055\u308c\u308b\nlet ctline = CTTypesetterCreateLine(typesetter, CFRangeMake(0, attributedText.length))\n\nclass TestView: UIView {\n    override init(frame: CGRect) {\n        super.init(frame: frame)\n        self.backgroundColor = UIColor.white\n    }\n\n    override func draw(_ rect: CGRect) {\n        guard let context = UIGraphicsGetCurrentContext() else { return }\n        context.textPosition = CGPoint(x: 0, y: 20)\n        context.translateBy(x: 20, y: 20)\n        CTLineDraw(ctline, context)\n    }\n    \n    required init?(coder aDecoder: NSCoder) {}\n}\nlet testView = TestView(frame: CGRect(x: 0, y: 0, width: 100, height: 100))\ntestView\n```\n\n<img width=\"181\" alt=\"Screen Shot 2016-09-13 at 14.56.13.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14941/5c857828-cdf1-f5b5-4bc2-49caf50fc10b.png\">\n\n\u9752\u3044\u80cc\u666f\u8272\u304c\u63cf\u753b\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n## \u5f0a\u5bb3\u3068\u5bfe\u5fdc\u7b56\n\nCoreText (CoreGraphics) \u3068 UIKit \u3067\u306f\u5ea7\u6a19\u7cfb\u304c\u7570\u306a\u308b (y\u8ef8\u304c\u9006) \u305f\u3081\u3001\u30e6\u30fc\u30b6\u30fc\u306b\u3068\u3063\u3066\u8aad\u307f\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u63cf\u753b\u5bfe\u8c61\u3092\u4e0a\u4e0b\u53cd\u8ee2\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\uff08\u3053\u308c\u306f\u4eca\u307e\u3067\u3068\u540c\u69d8\u3067\u3059\uff09\n\n```swift\noverride func draw(_ rect: CGRect) {\n    guard let context = UIGraphicsGetCurrentContext() else { return }\n    context.textMatrix = CGAffineTransform(scaleX: 1, y: -1)  // \u2190\u30c6\u30ad\u30b9\u30c8\u3092\u4e0a\u4e0b\u53cd\u8ee2\n    context.textPosition = CGPoint(x: 0, y: 20)\n    context.translateBy(x: 20, y: 20) \n    CTLineDraw(ctline, context)\n}\n```\n\u3053\u3046\u3059\u308b\u3068\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u6587\u5b57\u5217\u306f\u4e0a\u4e0b\u53cd\u8ee2\u3057\u307e\u3059\u304c\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u80cc\u666f\u306f\u53cd\u8ee2\u3057\u306a\u3044\u7f60\u304c\u3042\u308a\u307e\u3059\ud83d\ude31\n\n<img width=\"100\" alt=\"Screen Shot 2016-09-13 at 15.01.50.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14941/7cc23309-f468-852d-814e-d8f80e504561.png\">\u2192<img width=\"100\" alt=\"Screen Shot 2016-09-13 at 15.01.29.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14941/511f2e9c-9881-585d-9ae6-6fd1a1dec7bb.png\">\n\n\u80cc\u666f\u306f\u30c6\u30ad\u30b9\u30c8\u3068\u7d10\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u540c\u3058\u3088\u3046\u306b\u52d5\u304f\u6319\u52d5\u3092\u3059\u308b\u306e\u304c\u81ea\u7136\u3060\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3001context \u3092 scaleBy \u3067\u307e\u308b\u3054\u3068\u53cd\u8ee2\u3059\u308b\u3053\u3068\u3067\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\n\n```swift\noverride func draw(_ rect: CGRect) {\n    guard let context = UIGraphicsGetCurrentContext() else { return }\n    context.textPosition = CGPoint(x: 0, y: -20)\n    context.translateBy(x: 20, y: 20)\n    context.scaleBy(x: 1, y: -1)\n    CTLineDraw(ctline, context)\n}\n```\n<img width=\"100\" alt=\"Screen Shot 2016-09-13 at 15.08.25.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/14941/ec77946e-53d9-a1e9-55b9-b88d07085c8a.png\">\n\n\u4e0a\u624b\u306b\u63cf\u3051\u307e\u3057\u305f :tada:\n", "tags": ["ios10", "CoreText", "iOS"]}