{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u7ba1\u7406\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff08\u81ea\u5206\u306e\u5834\u5408\u306f\u81ea\u5b85\uff09\u3067DNS\u304c\u3069\u306e\u3088\u3046\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u304b\u3001\u307e\u305f\u554f\u3044\u5408\u308f\u305b\u306a\u3069\u304c\u6b63\u5e38\u306b\u5b9f\u65bd\u3067\u304d\u3066\u3044\u308b\u304b\u306e\u76e3\u8996\u306e\u305f\u3081\u306e\u69cb\u6210\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u4ee5\u4e0b\u306e\u69d8\u306a\u30b0\u30e9\u30d5\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6bce\u306e\u554f\u3044\u5408\u308f\u305b\u6570\u63a8\u79fb\n\n\u30af\u30a8\u30ea\u306e\u5fdc\u7b54\u6642\u9593\u5185\u8a33\uff08100ms\u672a\u6e80\u30011000ms\u672a\u6e80\u30011000ms\u4ee5\u4e0a\uff09\n\n\u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7\u306e\u5185\u8a33\uff08A\u30ec\u30b3\u30fc\u30c9\u3001MX\u30ec\u30b3\u30fc\u30c9\u3001\u306a\u3069\uff09\n\n\n\u69cb\u6210\nDevourer\uff08\u81ea\u4f5c\u30c4\u30fc\u30eb\uff09\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d1\u30b1\u30c3\u30c8\u3092\u3059\u3044\u3068\u308a\u3001Fluentd\u306b\u8ee2\u9001\u3001\u305d\u3053\u304b\u3089influxDB\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066Grafana\u3067\u53ef\u8996\u5316\u3057\u307e\u3059\u3002\n\n\n\u8a2d\u5b9a\u65b9\u6cd5\n\nInfluxDB\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u57fa\u672c\u306fInfluxDB\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u624b\u9806\u901a\u308a\u3067\u3059\u304c\u3001\u4f8b\u3048\u3070Ubuntu 64bit\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff06\u8d77\u52d5\u3057\u307e\u3059\u3002\nwget http://s3.amazonaws.com/influxdb/influxdb_latest_amd64.deb\nsudo dpkg -i influxdb_latest_amd64.deb\nsudo service influxdb start\n\n\u8d77\u52d5\u3057\u305f\u3089 http://<server>:8083/ \u3067\u63a5\u7d9a\u3059\u308b\u3068\u7ba1\u7406\u753b\u9762\u304c\u3067\u3066\u304f\u308b\u306e\u3067\u3001user: root\u3001password: root\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001devourer\u3068grafana\u306e2\u3064\u306eDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u524d\u8005\u306f\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u7528\u3001\u5f8c\u8005\u306fgrafana\u306e\u8a2d\u5b9a\u60c5\u5831\u4fdd\u5b58\u7528\u306b\u306a\u308a\u307e\u3059\u3002\n\nFluentd\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u8a2d\u5b9a\u74b0\u5883\u306bRuby\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u3066\u3001gem\u304c\u4f7f\u3048\u308b\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\ngem install fluentd fluent-plugin-influxdb\nfluentd --setup ./fluent\n\nfluent/fluent.conf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n<source>\n  type forward\n  port 24224\n  bind 0.0.0.0\n</source>\n\n<match devourer.**>\n  type copy\n  <store>\n    type stdout\n  </store>\n\n  <store>\n    type influxdb\n    host localhost\n    port 8086\n    dbname devourer\n    user root\n    password root\n    time_precision s\n    flush_interval 1s\n  </store>\n</match>\n\n\u305d\u306e\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n% fluentd -c fluent/fluent.conf\n\n\nDevourer\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u591a\u76ee\u7684\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u76e3\u8996\u30c4\u30fc\u30eb\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\uff08\u81ea\u4f5c\u54c1\u3067\u3059\uff09swarm\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u3001libpcap\u3001libev\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u30b3\u30f3\u30d1\u30a4\u30eb\u51fa\u6765\u308b\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u69cb\u6210\u56f3\u306b\u306fport mirroring\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001PC\u30eb\u30fc\u30bf\u4e0a\u306a\u3069\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u3002\n% git clone https://github.com/m-mizutani/swarm.git\n% cd swarm\n% cmake . && make\n% cd ..\n% git clone https://github.com/m-mizutani/devourer.git\n% cd devourer\n% cmake -DINC_DIR=../swarm/src -DLIB_DIR=../swarm/lib .\n% make\n% sudo make install\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n% sudo devourer -i eth0 -f localhost:24224\n\n\u76e3\u8996\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u6307\u5b9a\uff08\u4f8b\u3067\u306feth0\uff09\u3068fluentd\u306e\u5b9b\u5148\u30db\u30b9\u30c8\uff08\u4f8b\u3067\u306flocalhost\uff09\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nGrafana\u306e\u8a2d\u5b9a\n\u5b89\u5b9a\u7248\uff082014\u5e7410\u670830\u65e5\u306e\u6642\u70b9\u3067\u306f1.8.1\uff09\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n% wget wget http://grafanarel.s3.amazonaws.com/grafana-1.8.1.zip\n% unzip grafana-1.8.1.zip\n% cd grafana-1.8.1\n% cp config.sample.js config.js\n\nconfig.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\ndefine(['settings'],\nfunction (Settings) {\n  return new Settings({\n    datasources: {\n      influxdb: {\n        type: 'influxdb',\n        url: \"http://10.0.0.1:8086/db/devourer\",\n        username: 'root',\n        password: 'root',\n      },\n      grafana: {\n        type: 'influxdb',\n        url: \"http://10.0.0.1:8086/db/grafana\",\n        username: 'root',\n        password: 'root',\n        grafanaDB: true\n      },\n    },\n\n    search: {\n      max_results: 20\n    },\n    default_route: '/dashboard/file/default.json',\n    unsaved_changes_warning: true,\n    playlist_timespan: \"1m\",\n    admin: {\n      password: ''\n    },\n\n    window_title_prefix: 'Grafana - ',\n\n    plugins: {\n      panels: [],\n      dependencies: [],\n    }\n  });\n});\n\nApache\u306a\u3069\u3067\u8868\u793a\u3055\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u304a\u624b\u8efd\u306bpython\u306eCLI\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\n% python -m SimpleHTTPServer 9000\n\nhttp://<server>:9000 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066Grafana\u306e\u753b\u9762\u304c\u3067\u3066\u304d\u305f\u3089\u8a2d\u5b9a\u6210\u529f\u3067\u3059\u3002\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u8a2d\u5b9a\u306a\u3069\u306fWeb UI\u304b\u3089\u5b9f\u65bd\u3067\u304d\u307e\u3059\u304c\u3001influxdb\u306e\u30af\u30a8\u30ea\u306a\u3069\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u6709\u308b\u305f\u3081\u3001Gist\u306b\u8a2d\u5b9a\u3092export\u3057\u305fjson\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u753b\u9762\u4e0a\u90e8\u306e\u30d5\u30a9\u30eb\u30c0\u306e\u30a2\u30a4\u30b3\u30f3\u2192Import\u3067\u8a2d\u5b9a\u3092\u53d6\u308a\u8fbc\u3081\u307e\u3059\u3002\n\u80cc\u666f\n----------\n\n\u7ba1\u7406\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff08\u81ea\u5206\u306e\u5834\u5408\u306f\u81ea\u5b85\uff09\u3067DNS\u304c\u3069\u306e\u3088\u3046\u306b\u4f7f\u308f\u308c\u3066\u3044\u308b\u304b\u3001\u307e\u305f\u554f\u3044\u5408\u308f\u305b\u306a\u3069\u304c\u6b63\u5e38\u306b\u5b9f\u65bd\u3067\u304d\u3066\u3044\u308b\u304b\u306e\u76e3\u8996\u306e\u305f\u3081\u306e\u69cb\u6210\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u4ee5\u4e0b\u306e\u69d8\u306a\u30b0\u30e9\u30d5\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6bce\u306e\u554f\u3044\u5408\u308f\u305b\u6570\u63a8\u79fb\n![Screenshot 2014-10-30 10.02.50.png](https://qiita-image-store.s3.amazonaws.com/0/27627/8eaf2463-8e3d-b9ab-eb45-fd2ce33c950d.png)\n\n\u30af\u30a8\u30ea\u306e\u5fdc\u7b54\u6642\u9593\u5185\u8a33\uff08100ms\u672a\u6e80\u30011000ms\u672a\u6e80\u30011000ms\u4ee5\u4e0a\uff09\n![Screenshot 2014-10-30 10.02.35.png](https://qiita-image-store.s3.amazonaws.com/0/27627/525af7f9-05c9-e379-7e73-5f3ac664d718.png)\n\n\u30ec\u30b3\u30fc\u30c9\u30bf\u30a4\u30d7\u306e\u5185\u8a33\uff08A\u30ec\u30b3\u30fc\u30c9\u3001MX\u30ec\u30b3\u30fc\u30c9\u3001\u306a\u3069\uff09\n![Screenshot 2014-10-30 10.02.43.png](https://qiita-image-store.s3.amazonaws.com/0/27627/bcb15a41-8823-9696-4351-0a47d081b95c.png)\n\n\u69cb\u6210\n---------\n\nDevourer\uff08\u81ea\u4f5c\u30c4\u30fc\u30eb\uff09\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30d1\u30b1\u30c3\u30c8\u3092\u3059\u3044\u3068\u308a\u3001Fluentd\u306b\u8ee2\u9001\u3001\u305d\u3053\u304b\u3089influxDB\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066Grafana\u3067\u53ef\u8996\u5316\u3057\u307e\u3059\u3002\n\n![devourer.png](https://qiita-image-store.s3.amazonaws.com/0/27627/ab17fcf5-b099-55fc-8804-b67e837ebc28.png)\n\n\u8a2d\u5b9a\u65b9\u6cd5\n--------\n\n### InfluxDB\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u57fa\u672c\u306f[InfluxDB\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u624b\u9806](http://influxdb.com/docs/v0.6/introduction/installation.html)\u901a\u308a\u3067\u3059\u304c\u3001\u4f8b\u3048\u3070Ubuntu 64bit\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff06\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    wget http://s3.amazonaws.com/influxdb/influxdb_latest_amd64.deb\n    sudo dpkg -i influxdb_latest_amd64.deb\n    sudo service influxdb start\n\n\u8d77\u52d5\u3057\u305f\u3089 `http://<server>:8083/` \u3067\u63a5\u7d9a\u3059\u308b\u3068\u7ba1\u7406\u753b\u9762\u304c\u3067\u3066\u304f\u308b\u306e\u3067\u3001user: `root`\u3001password: `root`\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001`devourer`\u3068`grafana`\u306e2\u3064\u306eDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u524d\u8005\u306f\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u7528\u3001\u5f8c\u8005\u306fgrafana\u306e\u8a2d\u5b9a\u60c5\u5831\u4fdd\u5b58\u7528\u306b\u306a\u308a\u307e\u3059\u3002\n\n### Fluentd\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u8a2d\u5b9a\u74b0\u5883\u306bRuby\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u3066\u3001gem\u304c\u4f7f\u3048\u308b\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\n\n    gem install fluentd fluent-plugin-influxdb\n    fluentd --setup ./fluent\n\nfluent/fluent.conf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n    <source>\n      type forward\n      port 24224\n      bind 0.0.0.0\n    </source>\n\n    <match devourer.**>\n      type copy\n      <store>\n        type stdout\n      </store>\n\n      <store>\n        type influxdb\n        host localhost\n        port 8086\n        dbname devourer\n        user root\n        password root\n        time_precision s\n        flush_interval 1s\n      </store>\n    </match>\n\n\u305d\u306e\u5f8c\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\n    % fluentd -c fluent/fluent.conf\n\n### Devourer\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u591a\u76ee\u7684\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u76e3\u8996\u30c4\u30fc\u30eb\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\uff08\u81ea\u4f5c\u54c1\u3067\u3059\uff09`swarm`\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3082\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u3001libpcap\u3001libev\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30b0\u30e9\u30e0\u304c\u30b3\u30f3\u30d1\u30a4\u30eb\u51fa\u6765\u308b\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u69cb\u6210\u56f3\u306b\u306fport mirroring\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001PC\u30eb\u30fc\u30bf\u4e0a\u306a\u3069\u3067\u3082\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n    % git clone https://github.com/m-mizutani/swarm.git\n    % cd swarm\n    % cmake . && make\n    % cd ..\n    % git clone https://github.com/m-mizutani/devourer.git\n    % cd devourer\n    % cmake -DINC_DIR=../swarm/src -DLIB_DIR=../swarm/lib .\n    % make\n    % sudo make install\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    % sudo devourer -i eth0 -f localhost:24224\n\n\u76e3\u8996\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u6307\u5b9a\uff08\u4f8b\u3067\u306feth0\uff09\u3068fluentd\u306e\u5b9b\u5148\u30db\u30b9\u30c8\uff08\u4f8b\u3067\u306flocalhost\uff09\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### Grafana\u306e\u8a2d\u5b9a\n\n\u5b89\u5b9a\u7248\uff082014\u5e7410\u670830\u65e5\u306e\u6642\u70b9\u3067\u306f1.8.1\uff09\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n    % wget wget http://grafanarel.s3.amazonaws.com/grafana-1.8.1.zip\n    % unzip grafana-1.8.1.zip\n    % cd grafana-1.8.1\n    % cp config.sample.js config.js\n\nconfig.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n    define(['settings'],\n    function (Settings) {\n      return new Settings({\n        datasources: {\n          influxdb: {\n            type: 'influxdb',\n            url: \"http://10.0.0.1:8086/db/devourer\",\n            username: 'root',\n            password: 'root',\n          },\n          grafana: {\n            type: 'influxdb',\n            url: \"http://10.0.0.1:8086/db/grafana\",\n            username: 'root',\n            password: 'root',\n            grafanaDB: true\n          },\n        },\n\n        search: {\n          max_results: 20\n        },\n        default_route: '/dashboard/file/default.json',\n        unsaved_changes_warning: true,\n        playlist_timespan: \"1m\",\n        admin: {\n          password: ''\n        },\n\n        window_title_prefix: 'Grafana - ',\n\n        plugins: {\n          panels: [],\n          dependencies: [],\n        }\n      });\n    });\n\nApache\u306a\u3069\u3067\u8868\u793a\u3055\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u304a\u624b\u8efd\u306bpython\u306eCLI\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    % python -m SimpleHTTPServer 9000\n\n`http://<server>:9000` \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066Grafana\u306e\u753b\u9762\u304c\u3067\u3066\u304d\u305f\u3089\u8a2d\u5b9a\u6210\u529f\u3067\u3059\u3002\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u8a2d\u5b9a\u306a\u3069\u306fWeb UI\u304b\u3089\u5b9f\u65bd\u3067\u304d\u307e\u3059\u304c\u3001influxdb\u306e\u30af\u30a8\u30ea\u306a\u3069\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u6709\u308b\u305f\u3081\u3001Gist\u306b[\u8a2d\u5b9a\u3092export\u3057\u305fjson\u30d5\u30a1\u30a4\u30eb](https://gist.github.com/m-mizutani/0d37de1595b7b2f441a4)\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u753b\u9762\u4e0a\u90e8\u306e\u30d5\u30a9\u30eb\u30c0\u306e\u30a2\u30a4\u30b3\u30f3\u2192Import\u3067\u8a2d\u5b9a\u3092\u53d6\u308a\u8fbc\u3081\u307e\u3059\u3002\n\n", "tags": ["influxdb", "fluentd", "dns", "grafana"]}