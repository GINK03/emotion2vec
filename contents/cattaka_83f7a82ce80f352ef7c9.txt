{"context": "\u3053\u308c\u306f\u300cDevFest Tokyo 2016 \u79cb\u306e\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u796d\u308a\uff01\u300d\u306e\u767a\u8868\u8cc7\u6599\u3067\u3059\u3002\n\n\u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u5185\u5bb9\nDroidKaigi2016\u306eAndroid\u30a2\u30d7\u30ea\u306b\u3064\u3044\u3066Espresso\u3092\u4f7f\u3063\u3066UI\u5468\u308a\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\nhttps://play.google.com/store/apps/details?id=io.github.droidkaigi.confsched\n\nStep 0\uff1a\u6e96\u5099\u7de8\n\nclone\u3059\u308b\nhttps://github.com/cattaka/droidkaigi2016 \u3092clone\u3057\u307e\u3059\u3002\n\nShell\u304b\u3089clone\u3059\u308b\u5834\u5408\n$ cd <\u4f5c\u696d\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea>\n$ git clone https://github.com/cattaka/droidkaigi2016.git\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u958b\u304d\u3001\u30d3\u30eb\u30c9\u3068\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\nStep 1\uff1a\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u78ba\u8a8d\u3059\u308b\n\u4f7f\u7528\u3059\u308b\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u6b21\u306e\u3082\u306e\u3067\u3059\u3002\n\nJUnit\n\n\n\u3044\u308f\u305a\u3068\u3057\u308c\u305fJava\u7528\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\n\nMockito\n\n\n\u30c6\u30b9\u30c8\u6642\u306b\u5404\u30af\u30e9\u30b9\u3092Mock\u53ef\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u901a\u4fe1\u51e6\u7406\u306e\u3088\u3046\u306b\u3001\u30c6\u30b9\u30c8\u4e2d\u306b\u672c\u756a\u306e\u52d5\u304d\u3092\u3055\u308c\u305f\u3089\u56f0\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u52d5\u304d\u3092\u5dee\u3057\u66ff\u3048\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\n\nEspresso\n\nAndroid\u7528\u306eUI\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\nJUnit\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u4e2d\u3067\u3001Activity\u3092\u8d77\u52d5\u3057\u305f\u308a\u3001View\u3092\u64cd\u4f5c\uff08\u30af\u30ea\u30c3\u30af\u3084\u30b9\u30ef\u30a4\u30d7\u306a\u3069\uff09\u3057\u305f\u308a\u3001\u8868\u793a\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\n\napp/build.gradle \u306e\u8a2d\u5b9a\uff08\u5c0e\u5165\u6e08\u307f\uff09\napp/build.gradle \u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ndependencies {\n    androidTestCompile('com.android.support.test:runner:0.4.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test:rules:0.4.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-contrib:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n        exclude group: 'com.android.support', module: 'support-v4'\n        exclude group: 'com.android.support', module: 'recyclerview-v7'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-intents:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile 'org.mockito:mockito-core:1.9.5'\n    androidTestCompile 'com.google.dexmaker:dexmaker-mockito:1.2'\n}\n\nexclude\u306e\u8a18\u8ff0\u306f\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u3001\u30c6\u30b9\u30c8\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u98df\u3044\u9055\u3063\u3066\u3044\u308b\u3068\u304d\u3001\u305d\u308c\u306b\u5f15\u304d\u3065\u3089\u308c\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5909\u308f\u3063\u305f\u308a\u3001\u30d3\u30eb\u30c9\u306b\u5931\u6557\u3059\u308b\u306e\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3059\u3002\n\n\u53c2\u8003\uff1a\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f9d\u5b58\u95a2\u4fc2\n$ ./gradlew :app:dependencies\n## \u7701\u7565 ##\nandroidTestCompile - Classpath for compiling the androidTest sources.\n+--- com.android.support.test:runner:0.4.1\n|    +--- com.android.support.test:exposed-instrumentation-api-publish:0.4.1\n|    \\--- junit:junit:4.12\n|         \\--- org.hamcrest:hamcrest-core:1.3\n+--- com.android.support.test:rules:0.4.1\n|    \\--- com.android.support.test:runner:0.4.1 (*)\n+--- com.android.support.test.espresso:espresso-core:2.2.1\n|    +--- com.squareup:javawriter:2.1.1\n|    +--- com.android.support.test:runner:0.4.1 (*)\n|    +--- com.android.support.test:rules:0.4.1 (*)\n|    +--- javax.inject:javax.inject:1\n|    +--- org.hamcrest:hamcrest-library:1.3\n|    |    \\--- org.hamcrest:hamcrest-core:1.3\n|    +--- org.hamcrest:hamcrest-integration:1.3\n|    |    \\--- org.hamcrest:hamcrest-library:1.3 (*)\n|    +--- com.google.code.findbugs:jsr305:2.0.1\n|    +--- javax.annotation:javax.annotation-api:1.2\n|    \\--- com.android.support.test.espresso:espresso-idling-resource:2.2.1\n+--- com.android.support.test.espresso:espresso-contrib:2.2.1\n|    +--- com.android.support.test.espresso:espresso-core:2.2.1 (*)\n|    \\--- com.google.android.apps.common.testing.accessibility.framework:accessibility-test-framework:2.0\n|         \\--- org.hamcrest:hamcrest-core:1.3\n+--- com.android.support.test.espresso:espresso-intents:2.2.1\n|    \\--- com.android.support.test.espresso:espresso-core:2.2.1 (*)\n+--- org.mockito:mockito-core:1.9.5\n|    +--- org.hamcrest:hamcrest-core:1.1 -> 1.3\n|    \\--- org.objenesis:objenesis:1.0\n\\--- com.google.dexmaker:dexmaker-mockito:1.2\n     +--- com.google.dexmaker:dexmaker:1.2\n     \\--- org.mockito:mockito-core:1.9.5 (*)\n## \u7701\u7565 ##\n\n\nStep 2\uff1aActivity\u3092\u8d77\u52d5\u3057\u3088\u3046\n\u307e\u305a\u306f\u5358\u7d14\u306bMainActivity\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u30c6\u30b9\u30c8\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n\u306f\u3058\u3081\u304b\u305f\n$ git checkout devfest/step_1\n\n\n\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\napp/src/androidTest/ \u306e\u4e0b\u306bMainActivityTest\u3068\u3044\u3046\u30c6\u30b9\u30c8\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30b9\u306b@RunWith(AndroidJUnit4.class)\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3092\u3069\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308b\u304b\u3092\u6c7a\u3081\u308b\u3082\u306e\u3067\u3059\u3002\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u73fe\u5728\u306eAndroid\u306e\u5834\u5408\u306fAndroidJUnit4\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n\nMainActivityTest.java\n@RunWith(AndroidJUnit4.class)\npublic class MainActivityTest {\n\n}\n\n\n\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3059\u308b\n\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\npublic\u306a\u30e1\u30bd\u30c3\u30c9\u306b@Test\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n    @Test\n    public void check_start_activity() {\n        /* \u3053\u3053\u306b\u30c6\u30b9\u30c8\u3059\u308b\u5185\u5bb9\u3092\u66f8\u304f */\n    }\n\n\nMainActivity\u3092\u8d77\u52d5\u3055\u305b\u308b\nActivity\u3092\u8d77\u52d5\u3055\u305b\u308b\u306b\u306fActivityTestRule\u3068\u3044\u3046\u3001JUnit4\u306eRule\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u306f@Rule\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066public\u306a\u30e1\u30f3\u30d0\u5909\u6570\u3068\u3057\u3066\u3001\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n    @Rule\n    public ActivityTestRule<MainActivity> activityTestRule = new ActivityTestRule<>(MainActivity.class, false, false);\n\n    @Test\n    public void check_start_activity() {\n        MainActivity activity = activityTestRule.launchActivity(null);\n        /* \u3053\u3053\u306b\u30c6\u30b9\u30c8\u3059\u308b\u5185\u5bb9\u3092\u66f8\u304f */\n    }\n\n\n\u5b9f\u884c\u3057\u3066MainActivity\u304c\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nActivity\u304c\u5b9f\u884c\u72b6\u614b\u306b\u306a\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\u78ba\u8a8d\u306b\u306fActivity#isFinishing()\u304cfalse\u3067\u3042\u308b\u3053\u3068\u3067\u5224\u65ad\u3057\u307e\u3059\u3002\n\u5224\u5b9a\u306b\u306fJUnit\u306e\u6a5f\u80fd\u3067\u3042\u308bassertThat\u3068\u3044\u3046static\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n    @Test\n    public void check_start_activity() {\n        MainActivity activity = activityTestRule.launchActivity(null);\n        assertThat(\n                \"MainActivity is running\",\n                activity.isFinishing(),\n                Matchers.is(false)\n        );\n    }\n\nStep 2\u306e\u5909\u66f4\u70b9\n\nStep 3\uff1a\u30c6\u30b9\u30c8\u6642\u306b\u74b0\u5883\u3092\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\n\u306f\u3058\u3081\u304b\u305f\n$ git checkout devfest/step_2\n\n\u30c6\u30b9\u30c8\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u5b9f\u969b\u306b\u30b5\u30fc\u30d0\u30fc\u306b\u901a\u4fe1\u3057\u3066\u3044\u305f\u308a\u3001\u901a\u5e38\u5b9f\u884c\u6642\u306b\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\uff08SQLite\u3084SharedPreferences\uff09\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3067\u6319\u52d5\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3044\u3001\u6b63\u3057\u304f\u30c6\u30b9\u30c8\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u3046\u3044\u3063\u305f\u554f\u984c\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u30c6\u30b9\u30c8\u4e2d\u306f\u305d\u308c\u3089\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u307e\u3057\u3087\u3046\u3002\n\n\u5dee\u3057\u66ff\u3048\u304c\u5fc5\u8981\u306a\u3082\u306e\nDroidKaigi2016\u30a2\u30d7\u30ea\u3067\u8a72\u5f53\u3059\u308b\u3082\u306e\u306f\u6b21\u306e\uff13\u3064\u3067\u3059\u3002\n- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff08OrmaDatabase\u30af\u30e9\u30b9\u304c\u8a72\u5f53\uff09\n- SharedPreferences\n- \u901a\u4fe1\u51e6\u7406\uff08DroidKaigiClient\u30af\u30e9\u30b9\u304c\u8a72\u5f53\uff09\n\n\n\u5dee\u3057\u66ff\u3048\u306e\u624b\u6bb5\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u308b\u306b\u306f\u30a2\u30d7\u30ea\u5185\u3067\u5b9f\u884c\u72b6\u614b\u306b\u5fdc\u3058\u3066\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u611a\u76f4\u306b\u3084\u308b\u3068if\u6587\u306a\u3069\u3067\u90fd\u5ea6\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306b\u306a\u308a\u30b3\u30fc\u30c9\u304c\u7169\u96d1\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u3092\u56de\u907f\u3059\u308b\u306b\u306fDI(dependency injection)\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3044\u307e\u3059\u3002\nDroidKaigi2016\u30a2\u30d7\u30ea\u3067\u306fDagger2\u304c\u4f7f\u7528\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3089\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u5168\u3066Dagger2\u3092\u4ecb\u3057\u3066Activity\u3084Fragment\u304b\u3089\u6271\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u305f\u3081\u3001\u30c6\u30b9\u30c8\u6642\u306fDagger2\u306e\u8a2d\u5b9a\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5dee\u3057\u66ff\u3048\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\nMainApplication\u30af\u30e9\u30b9\u306eAppComponent\u3092\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306fMainApplication\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u5909\u6570\u306eAppComponent\u304b\u3089\u63d0\u4f9b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002AppComponent\u306fAppModule\u30af\u30e9\u30b9\u304b\u3089\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u30c6\u30b9\u30c8\u6642\u306b\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001setter\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nMainApplication.java\npublic class MainApplication extends Application {\n    /* \u4ed6\u306f\u7701\u7565 */\n\n    @VisibleForTesting\n    public void setAppComponent(AppComponent appComponent) {\n        this.appComponent = appComponent;\n    }\n}\n\n\n\u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3092\u4f5c\u308b\n\u30c6\u30b9\u30c8\u6642\u306bAppComponent\u306e\u4ee3\u308f\u308a\u306b\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u63d0\u4f9b\u3059\u308bTestAppComponent\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSharedPreferences\u3068OrmaDatabase\u306f\u672c\u756a\u5b9f\u884c\u6642\u3068\u7570\u306a\u308b\u5834\u6240\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u308a\u3001reset\u30e1\u30bd\u30c3\u30c9\u3067\u521d\u671f\u5316\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u901a\u4fe1\u51e6\u7406\u3092\u53f8\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3042\u308bDroidKaigiClient\u306b\u3064\u3044\u3066\u306f\u3001\u30c6\u30b9\u30c8\u7528\u306b\u507d\u7269\u306e\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\u3088\u3046\u306b\u4f5c\u3089\u308c\u305fTestDroidKaigiClient\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\napp/src/androidTest/java/io/github/droidkaigi/test/TestAppModule.java\npublic class TestAppModule extends AppModule {\n    static final String TEST_SHARED_PREF_NAME = \"test_preferences\";\n\n    private Context context;\n    private RenamingDelegatingContext rdContext;\n\n    public Tracker tracker;\n    public SharedPreferences sharedPreferences;\n    public OrmaDatabase ormaDatabase;\n    public DroidKaigiClient droidKaigiClient;\n\n    public TestAppModule(Application app) {\n        super(app);\n        context = app;\n        rdContext = new RenamingDelegatingContext(context, \"test_\");\n\n        GoogleAnalytics ga = GoogleAnalytics.getInstance(context);\n        ga.setDryRun(true);\n        tracker = ga.newTracker(BuildConfig.GA_TRACKING_ID);\n        tracker.enableAdvertisingIdCollection(true);\n        tracker.enableExceptionReporting(true);\n\n        sharedPreferences = context.getSharedPreferences(TEST_SHARED_PREF_NAME, Context.MODE_PRIVATE);\n        ormaDatabase = super.provideOrmaDatabase(rdContext);\n\n        AssetManager assets = InstrumentationRegistry.getContext().getAssets();\n        droidKaigiClient = new TestDroidKaigiClient(assets);\n    }\n\n    public void reset() {\n        sharedPreferences.edit().clear().apply();\n        rdContext.deleteDatabase(OrmaDatabaseBuilderBase.getDefaultDatabaseName(context));\n    }\n\n    public void shutdown() {\n    }\n\n    @Override\n    public Tracker provideGoogleAnalyticsTracker(Context context) {\n        return tracker;\n    }\n\n    @Override\n    public SharedPreferences provideSharedPreferences(Context context) {\n        return sharedPreferences;\n    }\n\n    @Override\n    public OrmaDatabase provideOrmaDatabase(Context context) {\n        return ormaDatabase;\n    }\n\n    @Provides\n    public DroidKaigiClient provideDroidKaigiClient(OkHttpClient client) {\n        return droidKaigiClient;\n    }\n}\n\n\nTestDroidKaigiClient\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\nDroidKaigiClient \u3068 TestDroidKaigiClient \u306e\u69cb\u6210\u306e\u9055\u3044\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nDroidKaigiClient\u306f\u305d\u308c\u305e\u308c\u672c\u7269\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3068\u901a\u4fe1\u3057\u307e\u3059\u3002\nTestDroidKaigiClient \u306f\u30c6\u30b9\u30c8\u5074\u306eAssets\u3067\u3042\u308b app/src/androidTest/assets/ \u306b\u5165\u308c\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u64ec\u4f3c\u7684\u306a\u901a\u4fe1\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002\n\n\n\nTestDroidKaigiClient\u306e\u5b9f\u88c5\u306f\u3053\u3061\u3089\n\u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\n\n\napp/src/androidTest/assets/DroidKaigiService/sessions_ja.json\napp/src/androidTest/assets/GithubService/contributors.json\n\n\nDroidKaigiClient\u30af\u30e9\u30b9\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u7121\u3044\u305f\u3081\u3001@VisibleForTesting\u3092\u3064\u3051\u305f\u3082\u306e\u3092\u8ffd\u52a0\u3057\u307e\u3059\n\npublic class DroidKaigiClient {\n    /* \u7701\u7565 */\n    @VisibleForTesting\n    public DroidKaigiClient() {\n        service = null;\n        googleFormService = null;\n        githubService = null;\n    }\n    /* \u7701\u7565 */\n}\n\n\n\u5dee\u3057\u66ff\u3048\u308b\u305f\u3081\u306eJUnit4\u306eRule\u3092\u4f5c\u308b\nJUnit4\u306eRule\u306f\u4f5c\u6210\u3057\u3066\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306b\u9069\u7528\u3059\u308b\u3068\u3001\u5404\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u884c\u306e\u958b\u59cb\u3084\u7d42\u4e86\u306b\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\u6642\u306bMainApplication\u306eAppComponent\u3092\u5dee\u3057\u66ff\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\napp/src/androidTest/java/io/github/droidkaigi/test/IsolateEnvRule.java\npublic class IsolateEnvRule implements TestRule {\n    public TestAppModule appModule;\n\n    @Override\n    public Statement apply(Statement base, Description description) {\n        return statement(base, description);\n    }\n\n    private Statement statement(final Statement base, final Description desc) {\n        return new Statement() {\n            @Override\n            public void evaluate() throws Throwable {\n                before();\n                try {\n                    base.evaluate();\n                } finally {\n                    after();\n                }\n            }\n        };\n    }\n    private void before() {\n        MainApplication application = (MainApplication) InstrumentationRegistry.getTargetContext().getApplicationContext();\n        appModule = new TestAppModule(application);\n        appModule.reset();\n        AppComponent testAppComponent = DaggerAppComponent.builder()\n                .appModule(appModule)\n                .build();\n        application.setAppComponent(testAppComponent);\n    }\n    private void after() {\n        appModule.shutdown();\n    }\n}\n\nStep 3\u306e\u5909\u66f4\u70b9\n\nStep4\uff1aSessionFeedbackActivity\u3067\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u3092\u9001\u4fe1\u3059\u308b\u30c6\u30b9\u30c8\n\n\u306f\u3058\u3081\u304b\u305f\n$ git checkout devfest/step_3\n\n\n\nSessionFeedbackActivityTest\u30af\u30e9\u30b9\u3092\u4f5c\u308b\n\nSessionFeedbackActivityTest\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\nIsolateEnvRule\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\nActivityTestRule\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\n\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u308b\n\n\nSessionFeedbackActivity\u306e\u8d77\u52d5\u306b\u8b1b\u6f14\u60c5\u5831\u304c\u5fc5\u8981\u306a\u306e\u3067\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u304b\u3089\u53d6\u5f97\u3059\u308b\nIntent\u3092\u751f\u6210\u3059\u308b\nSessionFeedbackActivity#createIntent\u30e1\u30bd\u30c3\u30c9\u3092public\u306b\u3059\u308b\nSessionFeedbackActivity\u3092\u8d77\u52d5\u3059\u308b\n\n\n\npublic class SessionFeedbackActivityTest {\n    @Rule\n    public IsolateEnvRule isolateEnvRule = new IsolateEnvRule();\n\n    public ActivityTestRule<SessionFeedbackActivity> activityTestRule = new ActivityTestRule<>(SessionFeedbackActivity.class, false, false);\n\n    @Test\n    public void check_request_on_click() {\n        Session session;\n        {   // \u507d\u7269\u306e\u8b1b\u6f14\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n            List<Session> sessions = isolateEnvRule.appModule.droidKaigiClient.getSessions(\"ja\").toBlocking().first();\n            session = sessions.get(0);\n        }\n\n        Context targetContext = InstrumentationRegistry.getTargetContext();\n        Intent intent = SessionFeedbackActivity.createIntent(targetContext, session);\n        SessionFeedbackActivity activity = activityTestRule.launchActivity(intent);\n    }\n}\n\n\n\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3066\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\nEditText\u306b\u5165\u529b\u3057\u305f\u308a\u3001View\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u308a\u3068\u3044\u3063\u305fUI\u306e\u64cd\u4f5c\u306b\u306fEspresso\u306e\u6a5f\u80fd\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Espresso\u3067\u306fonView\u304b\u3089\u59cb\u307e\u308b\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3092\u7528\u3044\u3066\u6b21\u306e\u3088\u3046\u306b\u64cd\u4f5c\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\nEditText\u307e\u3067\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3066\u6587\u5b57\u3092\u5165\u529b\u3059\u308b\n\nSessionFeedbackActivity\u306b\u306fR.id.other_comments_feedback_text\u3068\u3044\u3046EditText\u304c\u5b58\u5728\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eEditText\u307e\u3067\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3001\u6587\u5b57\u3092\u5165\u529b\u3055\u305b\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u3002\nEspresso.onView(ViewMatchers.withId(R.id.other_comments_feedback_text))\n                .perform(\n                        ViewActions.scrollTo(),\n                        ViewActions.replaceText(\"Hogehoge Fugafuga\"));\n\n\u88dc\u8db3\uff1areplaceText\u306b\u3088\u304f\u4f3c\u305ftypeText\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u8a18\u53f7\u306a\u3069\u3092\u5165\u529b\u3057\u305f\u969b\u306b\u6a5f\u7a2e\u306b\u3088\u3063\u3066\u6587\u5b57\u304c\u5316\u3051\u308b\u3053\u3068\u304c\u3042\u308b\u305f\u3081\u79c1\u306f\u4f7f\u7528\u3092\u907f\u3051\u3066\u3044\u307e\u3059\u3002\nonView\u3084withId\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u3068\u983b\u7e41\u306b\u4f7f\u3046\u305f\u3081\u3001\u3044\u3061\u3044\u3061\u30af\u30e9\u30b9\u540d\u3092\u3064\u3051\u3066\u3044\u308b\u3068\u8aad\u307f\u306b\u304f\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u5e78\u3044Espresson\u3084JUnit\u306f\u307b\u3068\u3093\u3069\u304cstatic\u30e1\u30bd\u30c3\u30c9\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30af\u30e9\u30b9\u540d\u306fJava\u8a00\u8a9e\u306estatic imports\u306e\u6a5f\u80fd\u3092\u4f7f\u3046\u3053\u3068\u3067\u7701\u7565\u3059\u308b\u3068\u8aad\u307f\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n        onView(withId(R.id.other_comments_feedback_text))\n                .perform(\n                        scrollTo(),\n                        replaceText(\"Hogehoge Fugafuga\"));\n\nAndroid Studio\u3067\u306f\u30e1\u30bd\u30c3\u30c9\u306b\u30ab\u30fc\u30bd\u30eb\u3092\u5f53\u3066\u3066Intention Actions\uff08Alt+Enter\uff09\u3092\u5b9f\u884c\u3059\u308b\u3068\u7c21\u5358\u306bstatic imports\u306b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\nonView\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n        onView(withId(R.id.submit_feedback_button))\n                .perform(scrollTo(), click());\n\n\n\uff15\u6bb5\u968e\u8a55\u4fa1\u306e\u64cd\u4f5c\u3092\u884c\u3046\n\u3053\u306e\u30a2\u30d7\u30ea\u3067\u306f5\u6bb5\u968e\u8a55\u4fa1\u306eNumberRatingBar\u3068\u3044\u3046SeekBar\u3092\u7d99\u627f\u3057\u305f\u30ab\u30b9\u30bf\u30e0View\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u6b8b\u5ff5\u306a\u304c\u3089Espresso\u306e\u6a19\u6e96\u306e\u6a5f\u80fd\u3067\u306f\u3053\u308c\u3092\u64cd\u4f5c\u3059\u308bViewAction\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u3057\u304b\u3057\u6b21\u306esetProgress\u30e1\u30bd\u30c3\u30c9\u306e\u3088\u3046\u306b\u3001\u30ab\u30b9\u30bf\u30e0\u306eViewAction\u3092\u751f\u6210\u3059\u308b\u3082\u306e\u3092\u4f5c\u308b\u3053\u3068\u3067\u7c21\u5358\u306b\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\napp/src/androidTest/java/io/github/droidkaigi/test/CustomViewAction.java\npublic class CustomViewAction {\n    public static ViewAction setProgress(final int progress) {\n        return new ViewAction() {\n            @Override\n            public void perform(UiController uiController, View view) {\n                ((SeekBar) view).setProgress(progress);\n                //or ((SeekBar) view).setProgress(progress);\n            }\n\n            @Override\n            public String getDescription() {\n                return \"Set a progress\";\n            }\n\n            @Override\n            public Matcher<View> getConstraints() {\n                return ViewMatchers.isAssignableFrom(SeekBar.class);\n            }\n        };\n    }\n}\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068\uff15\u6bb5\u968e\u8a55\u4fa1\u306e\u51e6\u7406\u306fonView\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n        onView(withId(R.id.relevant_feedback_bar))\n                .perform(scrollTo(), setProgress(1));\n        onView(withId(R.id.as_expected_feedback_bar))\n                .perform(scrollTo(), setProgress(2));\n        onView(withId(R.id.difficulty_feedback_bar))\n                .perform(scrollTo(), setProgress(3));\n        onView(withId(R.id.knowledgeable_feedback_bar))\n                .perform(scrollTo(), setProgress(4));\n\n\n\u9001\u4fe1\u3057\u3088\u3046\u3068\u3057\u305f\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\n\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u6642\u3001\u30a2\u30d7\u30ea\u306f\u901a\u4fe1\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u304cUI\u64cd\u4f5c\u306b\u6cbf\u3063\u305f\u3082\u306e\u3067\u3042\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\u3053\u306e\u3068\u304d\u306bDroidKaigiClient#submitSessionFeedback\u30e1\u30bd\u30c3\u30c9\u304c\u53e9\u304b\u308c\u308b\u306e\u3067\u3001\u305d\u306e\u5f15\u6570\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n\u624b\u9806\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n- IsolateEnvRule\u304c\u6301\u3064droidKaigiClient\u3092\u3001Mockito\u306e\u6a5f\u80fd\u3092\u4f7f\u3057\u3001\u5f15\u6570\u3092\u5f8c\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n- UI\u64cd\u4f5c\u5f8c\u3001IsolateEnvRule\u304c\u6301\u3064droidKaigiClient\u304b\u3089\u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u308a\u51fa\u3059\n- \u53d6\u308a\u51fa\u3057\u305f\u5f15\u6570\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\n\ndroidKaigiClient\u306e\u5f15\u6570\u3092\u5f8c\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n        DroidKaigiClient droidKaigiClient = Mockito.mock(\n                DroidKaigiClient.class,\n                new ForwardsInvocations(isolateEnvRule.appModule.droidKaigiClient)\n        );\n        isolateEnvRule.appModule.droidKaigiClient = droidKaigiClient;\n\n\n\u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u308a\u51fa\u3059\n        ArgumentCaptor<SessionFeedback> captor = ArgumentCaptor.forClass(SessionFeedback.class);\n        Mockito.verify(droidKaigiClient)\n                .submitSessionFeedback(captor.capture());\n        SessionFeedback value = captor.getValue();\n\n\n\u53d6\u308a\u51fa\u3057\u305f\u5f15\u6570\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\n        assertThat(value.relevancy, Matchers.is(1));\n        assertThat(value.asExpected, Matchers.is(2));\n        assertThat(value.difficulty, Matchers.is(3));\n        assertThat(value.knowledgeable, Matchers.is(4));\n        assertThat(value.comment, Matchers.is(\"Hogehoge Fugafuga\"));\n\nStep 4\u306e\u5909\u66f4\u70b9\n\nStep 5\uff1aMainActivity\u304b\u3089\u8b1b\u6f14\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\u64cd\u4f5c\u306e\u30c6\u30b9\u30c8\nMainActivity\u306b\u306f\u8b1b\u6f14\u306e\u30ea\u30b9\u30c8\u304c\u3042\u308a\u3001\u305d\u308c\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068SessionDetailActivity\u306b\u9077\u79fb\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u30c6\u30b9\u30c8\u3059\u308b\u306b\u306fActivityMonitor\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u304b\u305f\n$ git checkout devfest/step_4\n\n\n\nRecyclerView\u306e\uff11\u3064\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\nonView\u3092\u4f7f\u3063\u3066\u66f8\u3051\u307e\u3059\u304c\u3001\uff12\u3064\u8ab2\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30af\u30ea\u30c3\u30af\u3057\u305f\u3044\u306e\u306fRecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u306a\u306e\u3067\u3001\u30af\u30ea\u30c3\u30af\u3057\u305f\u3044View\u3092withId\u3067\u6307\u5b9a\u3067\u304d\u306a\u3044\nMainActivity\u4e0a\u306b\u306fR.id.recycler_view\u304c\u8907\u6570\u3042\u308b\u305f\u3081\u3001\u300c\u3069\u306e\u300dRecyclerView\u306a\u306e\u304b\u3092withId\u3067\u6307\u5b9a\u3067\u304d\u306a\u3044\n\n\nRecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u306b\u306f\nEspresso\u3067RecyclerView\u3092\u64cd\u4f5c\u3059\u308b\u306e\u306b\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u6ce5\u81ed\u3044\u3053\u3068\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u5e78\u3044\u305d\u306e\u305f\u3081\u306eespresso-contrib\u3068\u3044\u3046\u8ffd\u52a0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3068RecyclerView\u306e\u7279\u5b9a\u306e\u8981\u7d20\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u305f\u308a\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u304c\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n            onView(<\u3053\u3053\u306bRecyclerView\u3092\u6307\u5b9a\u3059\u308b>)\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n            onView(<\u3053\u3053\u306bRecyclerView\u3092\u6307\u5b9a\u3059\u308b>)\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n\n\u95a2\u9023\u60c5\u5831\uff1aRecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u306e\u5185\u90e8\u306eView\u3078\u306eperform\u3084check\u3092\u884c\u3046\u65b9\u6cd5\n\n\u7279\u5b9a\u306eRecyclerView\u3092\u6307\u5b9a\u3059\u308b\n\u76ee\u7684\u306eRecyclerView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u53d6\u5f97\u3067\u304d\u308c\u3070\u3001withId\u306e\u4ee3\u308f\u308a\u306bMatchers.equalTo\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u3053\u308c\u3092\u4f7f\u3046\u3068RecyclerView\u306e\u7279\u5b9a\u306e\u8981\u7d20\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u305f\u308a\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u304c\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n        View recyclerView;\n        {   // \u5c11\u3005\u5f37\u5f15\u3060\u304cRecyclerView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\n            ViewPager viewPager = (ViewPager) activity.findViewById(R.id.view_pager);\n            FragmentStatePagerAdapter adapter = (FragmentStatePagerAdapter) viewPager.getAdapter();\n            Fragment sessionsTabFragment = adapter.getItem(0);\n            recyclerView = sessionsTabFragment.getView();\n        }\n\n        onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n        onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n\n\nSessionDetailActivity\u304c\u8d77\u52d5\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\nActivity\u304c\u8d77\u52d5\u3057\u305f\u304b\u5426\u304b\u306fActivityMonitor\u3092\u4f7f\u3046\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308bActivity\u7528\u306eActivityMonitor\u3092\u4f5c\u6210\u3057\u3001Instrumentation#addMonitor()\u3067\u767b\u9332\u3059\u308b\u3068\u3001\u305d\u308c\u3088\u308a\u5f8c\u306b\u8d77\u52d5\u3057\u305fActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nActivityMonitor\u306e\u4f5c\u6210\u3068\u767b\u9332\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n        Instrumentation.ActivityMonitor monitor = new Instrumentation.ActivityMonitor(SessionDetailActivity.class.getCanonicalName(), null, false);\n        InstrumentationRegistry.getInstrumentation().addMonitor(monitor);\n\n\u305d\u3057\u3066UI\u306e\u64cd\u4f5c\u5f8c\u306b\u8d77\u52d5\u3057\u305f\u304b\u3069\u3046\u304b\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n            Activity nextActivity = monitor.waitForActivityWithTimeout(5000);\n            assertThat(nextActivity, Matchers.is(Matchers.notNullValue()));\n            nextActivity.finish();\n\n\u3053\u308c\u3089\u3092\u7e4b\u3052\u308b\u3068\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n        Instrumentation.ActivityMonitor monitor = new Instrumentation.ActivityMonitor(SessionDetailActivity.class.getCanonicalName(), null, false);\n        InstrumentationRegistry.getInstrumentation().addMonitor(monitor);\n        try {\n            onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n            onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n\n            Activity nextActivity = monitor.waitForActivityWithTimeout(5000);\n            assertThat(nextActivity, Matchers.is(Matchers.notNullValue()));\n            nextActivity.finish();\n        } finally {\n            InstrumentationRegistry.getInstrumentation().removeMonitor(monitor);\n        }\n\nStep 5\u306e\u5909\u66f4\u70b9\n\nStep 6\uff1agradle\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\n\u306f\u3058\u3081\u304b\u305f\n$ git checkout devfest/step_5\n\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u300c$ ./gradlew \\connected[BuildVariant\u540d]AndroidTest\u300d\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fBuildVariant\u306b\u300cDevelopDebug\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u306e\u3067\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n$ ./gradlew connectedDevelopDebugAndroidTest\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u30ec\u30dd\u30fc\u30c8\u306exml\u3084html\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\napp/build/outputs/androidTest-results/connected/flavors/DEVELOP/TEST-Nexus 4 - 5.1.1-app-DEVELOP.xml\napp/build/reports/androidTests/connected/flavors/DEVELOP/index.html\n\n\n\n\n\n\n\n\u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u751f\u6210\u3059\u308b\n\u30c6\u30b9\u30c8\u6642\u306e\u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u8a08\u6e2c\u3059\u308b\u306b\u306fapp/build.gradle\u306b\u6b21\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\napp/build.gradle\nandroid {\n    /* \u7701\u7565 */\n    buildTypes {\n        debug {\n            /* \u7701\u7565 */\n            testCoverageEnabled true\n        }\n        /* \u7701\u7565 */\n    }\n    /* \u7701\u7565 */\n}\n\n\u305d\u3057\u3066\u300c./gradlew create[BuildVariant\u540d]CoverageReport\u300d\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ ./gradlew createDevelopDebugCoverageReport\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u306e\u30ec\u30dd\u30fc\u30c8\u306eec\u30d5\u30a1\u30a4\u30eb\u3084html\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\napp/build/outputs/code-coverage/connected/flavors/DEVELOP\napp/build/reports/coverage/develop/debug/index.html\n\n\n\n\n\n\n\n\n\u307e\u3068\u3081\n\n\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306b\u306f\u30a2\u30d7\u30ea\u306e\u72b6\u614b\u3092\u4f5c\u308a\u51fa\u3059\u3053\u3068\u304c\u5927\u4e8b\n\n\n\u5185\u90e8\u7684\u306a\u72b6\u614b\uff1a\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3001SharedPreferences \n\u5916\u90e8\u306b\u4f9d\u5b58\u3059\u308b\u72b6\u614b\uff1a\u901a\u4fe1\u51e6\u7406\n\n\nDagger2\u3092\u4f7f\u3048\u3070\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\nEspresso\u3092\u4f7f\u3046\u3068UI\u64cd\u4f5c\u306e\u51e6\u7406\u304c\u7c21\u6f54\u306b\u66f8\u3051\u308b\n\n\n\u95a2\u9023\u66f8\u7c4d\n\n\u30a2\u30f3\u30c9\u30ed\u30a4\u30c9\u30a2\u30ab\u30c7\u30df\u30a2 - TechBooster\n\n\n\n\n\u300cAndroid\u30c6\u30b9\u30c8\u30ec\u30b7\u30d4\u300d\u306bAndroid\u306e\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u306e\u30ce\u30a6\u30cf\u30a6\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n\nAndroid\u6539\u5584\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 - TechBooster\n\n\n\n- \u300cEspresso\u306f\u30a2\u30d7\u30ea\u304c\u9577\u751f\u304d\u3059\u308b\u79d8\u8a23\u300d\u306bEspresso\u306e\u4f7f\u3044\u65b9\u3084\u6a5f\u80fd\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\u3053\u308c\u306f[\u300cDevFest Tokyo 2016 \u79cb\u306e\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u796d\u308a\uff01\u300d](http://gdg-tokyo.connpass.com/event/38927/)\u306e\u767a\u8868\u8cc7\u6599\u3067\u3059\u3002\n\n\n## \u672c\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u5185\u5bb9\nDroidKaigi2016\u306eAndroid\u30a2\u30d7\u30ea\u306b\u3064\u3044\u3066Espresso\u3092\u4f7f\u3063\u3066UI\u5468\u308a\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/55138/a2fadb66-4a57-eda4-39bc-5c060c4f594a.png)\n\nhttps://play.google.com/store/apps/details?id=io.github.droidkaigi.confsched\n\n\n## Step 0\uff1a\u6e96\u5099\u7de8\n### clone\u3059\u308b\nhttps://github.com/cattaka/droidkaigi2016 \u3092clone\u3057\u307e\u3059\u3002\n\n#### Shell\u304b\u3089clone\u3059\u308b\u5834\u5408\n```bash\n$ cd <\u4f5c\u696d\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea>\n$ git clone https://github.com/cattaka/droidkaigi2016.git\n```\n\n### \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u958b\u304d\u3001\u30d3\u30eb\u30c9\u3068\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n<img width=\"30%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/bef23698-326c-7960-af40-31c08668c778.png\">\n\n\n### Step 1\uff1a\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u78ba\u8a8d\u3059\u308b\n\u4f7f\u7528\u3059\u308b\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u6b21\u306e\u3082\u306e\u3067\u3059\u3002\n\n- JUnit\n - \u3044\u308f\u305a\u3068\u3057\u308c\u305fJava\u7528\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n- Mockito\n - \u30c6\u30b9\u30c8\u6642\u306b\u5404\u30af\u30e9\u30b9\u3092Mock\u53ef\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n - \u5177\u4f53\u7684\u306b\u306f\u901a\u4fe1\u51e6\u7406\u306e\u3088\u3046\u306b\u3001\u30c6\u30b9\u30c8\u4e2d\u306b\u672c\u756a\u306e\u52d5\u304d\u3092\u3055\u308c\u305f\u3089\u56f0\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u52d5\u304d\u3092\u5dee\u3057\u66ff\u3048\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n- [Espresso](https://google.github.io/android-testing-support-library/docs/espresso/)\n - Android\u7528\u306eUI\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n - JUnit\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u4e2d\u3067\u3001Activity\u3092\u8d77\u52d5\u3057\u305f\u308a\u3001View\u3092\u64cd\u4f5c\uff08\u30af\u30ea\u30c3\u30af\u3084\u30b9\u30ef\u30a4\u30d7\u306a\u3069\uff09\u3057\u305f\u308a\u3001\u8868\u793a\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n\n#### app/build.gradle \u306e\u8a2d\u5b9a\uff08\u5c0e\u5165\u6e08\u307f\uff09\napp/build.gradle \u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```groovy\ndependencies {\n    androidTestCompile('com.android.support.test:runner:0.4.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test:rules:0.4.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-contrib:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n        exclude group: 'com.android.support', module: 'support-v4'\n        exclude group: 'com.android.support', module: 'recyclerview-v7'\n    }\n    androidTestCompile('com.android.support.test.espresso:espresso-intents:2.2.1') {\n        exclude group: 'com.android.support', module: 'support-annotations'\n    }\n    androidTestCompile 'org.mockito:mockito-core:1.9.5'\n    androidTestCompile 'com.google.dexmaker:dexmaker-mockito:1.2'\n}\n```\n\nexclude\u306e\u8a18\u8ff0\u306f\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u3001\u30c6\u30b9\u30c8\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u98df\u3044\u9055\u3063\u3066\u3044\u308b\u3068\u304d\u3001\u305d\u308c\u306b\u5f15\u304d\u3065\u3089\u308c\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5909\u308f\u3063\u305f\u308a\u3001\u30d3\u30eb\u30c9\u306b\u5931\u6557\u3059\u308b\u306e\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3059\u3002\n\n### \u53c2\u8003\uff1a\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4f9d\u5b58\u95a2\u4fc2\n```\n$ ./gradlew :app:dependencies\n## \u7701\u7565 ##\nandroidTestCompile - Classpath for compiling the androidTest sources.\n+--- com.android.support.test:runner:0.4.1\n|    +--- com.android.support.test:exposed-instrumentation-api-publish:0.4.1\n|    \\--- junit:junit:4.12\n|         \\--- org.hamcrest:hamcrest-core:1.3\n+--- com.android.support.test:rules:0.4.1\n|    \\--- com.android.support.test:runner:0.4.1 (*)\n+--- com.android.support.test.espresso:espresso-core:2.2.1\n|    +--- com.squareup:javawriter:2.1.1\n|    +--- com.android.support.test:runner:0.4.1 (*)\n|    +--- com.android.support.test:rules:0.4.1 (*)\n|    +--- javax.inject:javax.inject:1\n|    +--- org.hamcrest:hamcrest-library:1.3\n|    |    \\--- org.hamcrest:hamcrest-core:1.3\n|    +--- org.hamcrest:hamcrest-integration:1.3\n|    |    \\--- org.hamcrest:hamcrest-library:1.3 (*)\n|    +--- com.google.code.findbugs:jsr305:2.0.1\n|    +--- javax.annotation:javax.annotation-api:1.2\n|    \\--- com.android.support.test.espresso:espresso-idling-resource:2.2.1\n+--- com.android.support.test.espresso:espresso-contrib:2.2.1\n|    +--- com.android.support.test.espresso:espresso-core:2.2.1 (*)\n|    \\--- com.google.android.apps.common.testing.accessibility.framework:accessibility-test-framework:2.0\n|         \\--- org.hamcrest:hamcrest-core:1.3\n+--- com.android.support.test.espresso:espresso-intents:2.2.1\n|    \\--- com.android.support.test.espresso:espresso-core:2.2.1 (*)\n+--- org.mockito:mockito-core:1.9.5\n|    +--- org.hamcrest:hamcrest-core:1.1 -> 1.3\n|    \\--- org.objenesis:objenesis:1.0\n\\--- com.google.dexmaker:dexmaker-mockito:1.2\n     +--- com.google.dexmaker:dexmaker:1.2\n     \\--- org.mockito:mockito-core:1.9.5 (*)\n## \u7701\u7565 ##\n```\n\n\n## Step 2\uff1aActivity\u3092\u8d77\u52d5\u3057\u3088\u3046\n\u307e\u305a\u306f\u5358\u7d14\u306bMainActivity\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u30c6\u30b9\u30c8\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n### \u306f\u3058\u3081\u304b\u305f\n```bash\n$ git checkout devfest/step_1\n```\n\n### \u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\napp/src/androidTest/ \u306e\u4e0b\u306bMainActivityTest\u3068\u3044\u3046\u30c6\u30b9\u30c8\u7528\u306e\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30b9\u306b@RunWith(AndroidJUnit4.class)\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u3092\u3069\u306e\u3088\u3046\u306b\u5b9f\u884c\u3059\u308b\u304b\u3092\u6c7a\u3081\u308b\u3082\u306e\u3067\u3059\u3002\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u73fe\u5728\u306eAndroid\u306e\u5834\u5408\u306fAndroidJUnit4\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n![\u7bc4\u56f2\u3092\u9078\u629e_003.png](https://qiita-image-store.s3.amazonaws.com/0/55138/78ba34bb-56b7-7ce4-db5f-6a8f571faa07.png)\n\n#### MainActivityTest.java\n```java\n@RunWith(AndroidJUnit4.class)\npublic class MainActivityTest {\n\n}\n```\n\n### \u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3059\u308b\n\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\npublic\u306a\u30e1\u30bd\u30c3\u30c9\u306b@Test\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n```java\n    @Test\n    public void check_start_activity() {\n        /* \u3053\u3053\u306b\u30c6\u30b9\u30c8\u3059\u308b\u5185\u5bb9\u3092\u66f8\u304f */\n    }\n```\n\n### MainActivity\u3092\u8d77\u52d5\u3055\u305b\u308b\nActivity\u3092\u8d77\u52d5\u3055\u305b\u308b\u306b\u306fActivityTestRule\u3068\u3044\u3046\u3001JUnit4\u306eRule\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u306f@Rule\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066public\u306a\u30e1\u30f3\u30d0\u5909\u6570\u3068\u3057\u3066\u3001\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```java\n    @Rule\n    public ActivityTestRule<MainActivity> activityTestRule = new ActivityTestRule<>(MainActivity.class, false, false);\n\n    @Test\n    public void check_start_activity() {\n        MainActivity activity = activityTestRule.launchActivity(null);\n        /* \u3053\u3053\u306b\u30c6\u30b9\u30c8\u3059\u308b\u5185\u5bb9\u3092\u66f8\u304f */\n    }\n```\n\n### \u5b9f\u884c\u3057\u3066MainActivity\u304c\u8d77\u52d5\u3067\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nActivity\u304c\u5b9f\u884c\u72b6\u614b\u306b\u306a\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\u78ba\u8a8d\u306b\u306fActivity#isFinishing()\u304cfalse\u3067\u3042\u308b\u3053\u3068\u3067\u5224\u65ad\u3057\u307e\u3059\u3002\n\u5224\u5b9a\u306b\u306fJUnit\u306e\u6a5f\u80fd\u3067\u3042\u308bassertThat\u3068\u3044\u3046static\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```java\n    @Test\n    public void check_start_activity() {\n        MainActivity activity = activityTestRule.launchActivity(null);\n        assertThat(\n                \"MainActivity is running\",\n                activity.isFinishing(),\n                Matchers.is(false)\n        );\n    }\n```\n\n[Step 2\u306e\u5909\u66f4\u70b9](https://github.com/cattaka/droidkaigi2016/compare/devfest/step_1...devfest/step_2)\n\n\n## Step 3\uff1a\u30c6\u30b9\u30c8\u6642\u306b\u74b0\u5883\u3092\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\n### \u306f\u3058\u3081\u304b\u305f\n```bash\n$ git checkout devfest/step_2\n```\n\n\u30c6\u30b9\u30c8\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u5b9f\u969b\u306b\u30b5\u30fc\u30d0\u30fc\u306b\u901a\u4fe1\u3057\u3066\u3044\u305f\u308a\u3001\u901a\u5e38\u5b9f\u884c\u6642\u306b\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\uff08SQLite\u3084SharedPreferences\uff09\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3067\u6319\u52d5\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3044\u3001\u6b63\u3057\u304f\u30c6\u30b9\u30c8\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u3046\u3044\u3063\u305f\u554f\u984c\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u30c6\u30b9\u30c8\u4e2d\u306f\u305d\u308c\u3089\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u307e\u3057\u3087\u3046\u3002\n\n### \u5dee\u3057\u66ff\u3048\u304c\u5fc5\u8981\u306a\u3082\u306e\nDroidKaigi2016\u30a2\u30d7\u30ea\u3067\u8a72\u5f53\u3059\u308b\u3082\u306e\u306f\u6b21\u306e\uff13\u3064\u3067\u3059\u3002\n- \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff08OrmaDatabase\u30af\u30e9\u30b9\u304c\u8a72\u5f53\uff09\n- SharedPreferences\n- \u901a\u4fe1\u51e6\u7406\uff08DroidKaigiClient\u30af\u30e9\u30b9\u304c\u8a72\u5f53\uff09\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/55138/17b3cc61-44d1-5923-526b-a2720c028af8.png)\n\n\n### \u5dee\u3057\u66ff\u3048\u306e\u624b\u6bb5\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u308b\u306b\u306f\u30a2\u30d7\u30ea\u5185\u3067\u5b9f\u884c\u72b6\u614b\u306b\u5fdc\u3058\u3066\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u611a\u76f4\u306b\u3084\u308b\u3068if\u6587\u306a\u3069\u3067\u90fd\u5ea6\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306b\u306a\u308a\u30b3\u30fc\u30c9\u304c\u7169\u96d1\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u3092\u56de\u907f\u3059\u308b\u306b\u306fDI(dependency injection)\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3044\u307e\u3059\u3002\nDroidKaigi2016\u30a2\u30d7\u30ea\u3067\u306fDagger2\u304c\u4f7f\u7528\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3089\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u5168\u3066Dagger2\u3092\u4ecb\u3057\u3066Activity\u3084Fragment\u304b\u3089\u6271\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u305f\u3081\u3001\u30c6\u30b9\u30c8\u6642\u306fDagger2\u306e\u8a2d\u5b9a\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5dee\u3057\u66ff\u3048\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n#### MainApplication\u30af\u30e9\u30b9\u306eAppComponent\u3092\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306fMainApplication\u30af\u30e9\u30b9\u306e\u30e1\u30f3\u30d0\u5909\u6570\u306eAppComponent\u304b\u3089\u63d0\u4f9b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002AppComponent\u306fAppModule\u30af\u30e9\u30b9\u304b\u3089\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u30c6\u30b9\u30c8\u6642\u306b\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001setter\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n[MainApplication.java](https://github.com/cattaka/droidkaigi2016/blob/devfest/step_3/app/src/main/java/io/github/droidkaigi/confsched/MainApplication.java)\n\n```java\npublic class MainApplication extends Application {\n    /* \u4ed6\u306f\u7701\u7565 */\n\n    @VisibleForTesting\n    public void setAppComponent(AppComponent appComponent) {\n        this.appComponent = appComponent;\n    }\n}\n```\n\n#### \u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3092\u4f5c\u308b\n\u30c6\u30b9\u30c8\u6642\u306bAppComponent\u306e\u4ee3\u308f\u308a\u306b\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u63d0\u4f9b\u3059\u308bTestAppComponent\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nSharedPreferences\u3068OrmaDatabase\u306f\u672c\u756a\u5b9f\u884c\u6642\u3068\u7570\u306a\u308b\u5834\u6240\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u308a\u3001reset\u30e1\u30bd\u30c3\u30c9\u3067\u521d\u671f\u5316\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u901a\u4fe1\u51e6\u7406\u3092\u53f8\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3042\u308bDroidKaigiClient\u306b\u3064\u3044\u3066\u306f\u3001\u30c6\u30b9\u30c8\u7528\u306b\u507d\u7269\u306e\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\u3088\u3046\u306b\u4f5c\u3089\u308c\u305fTestDroidKaigiClient\u3092\u8fd4\u3059\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\napp/src/androidTest/java/io/github/droidkaigi/test/TestAppModule.java\n\n```java\npublic class TestAppModule extends AppModule {\n    static final String TEST_SHARED_PREF_NAME = \"test_preferences\";\n\n    private Context context;\n    private RenamingDelegatingContext rdContext;\n\n    public Tracker tracker;\n    public SharedPreferences sharedPreferences;\n    public OrmaDatabase ormaDatabase;\n    public DroidKaigiClient droidKaigiClient;\n\n    public TestAppModule(Application app) {\n        super(app);\n        context = app;\n        rdContext = new RenamingDelegatingContext(context, \"test_\");\n\n        GoogleAnalytics ga = GoogleAnalytics.getInstance(context);\n        ga.setDryRun(true);\n        tracker = ga.newTracker(BuildConfig.GA_TRACKING_ID);\n        tracker.enableAdvertisingIdCollection(true);\n        tracker.enableExceptionReporting(true);\n\n        sharedPreferences = context.getSharedPreferences(TEST_SHARED_PREF_NAME, Context.MODE_PRIVATE);\n        ormaDatabase = super.provideOrmaDatabase(rdContext);\n\n        AssetManager assets = InstrumentationRegistry.getContext().getAssets();\n        droidKaigiClient = new TestDroidKaigiClient(assets);\n    }\n\n    public void reset() {\n        sharedPreferences.edit().clear().apply();\n        rdContext.deleteDatabase(OrmaDatabaseBuilderBase.getDefaultDatabaseName(context));\n    }\n\n    public void shutdown() {\n    }\n\n    @Override\n    public Tracker provideGoogleAnalyticsTracker(Context context) {\n        return tracker;\n    }\n\n    @Override\n    public SharedPreferences provideSharedPreferences(Context context) {\n        return sharedPreferences;\n    }\n\n    @Override\n    public OrmaDatabase provideOrmaDatabase(Context context) {\n        return ormaDatabase;\n    }\n\n    @Provides\n    public DroidKaigiClient provideDroidKaigiClient(OkHttpClient client) {\n        return droidKaigiClient;\n    }\n}\n```\n\n#### TestDroidKaigiClient\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\nDroidKaigiClient \u3068 TestDroidKaigiClient \u306e\u69cb\u6210\u306e\u9055\u3044\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n- DroidKaigiClient\u306f\u305d\u308c\u305e\u308c\u672c\u7269\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3068\u901a\u4fe1\u3057\u307e\u3059\u3002\n- TestDroidKaigiClient \u306f\u30c6\u30b9\u30c8\u5074\u306eAssets\u3067\u3042\u308b app/src/androidTest/assets/ \u306b\u5165\u308c\u305f\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u64ec\u4f3c\u7684\u306a\u901a\u4fe1\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/55138/e19097ec-b457-47e1-844d-01c5ba9a18bd.png)\n\n- [TestDroidKaigiClient\u306e\u5b9f\u88c5\u306f\u3053\u3061\u3089](https://github.com/cattaka/droidkaigi2016/blob/devfest/step_3/app/src/androidTest/java/io/github/droidkaigi/test/TestDroidKaigiClient.java)\n- \u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\n - [app/src/androidTest/assets/DroidKaigiService/sessions_ja.json](https://github.com/cattaka/droidkaigi2016/blob/devfest/step_3/app/src/androidTest/assets/DroidKaigiService/sessions_ja.json)\n - [app/src/androidTest/assets/GithubService/contributors.json](https://github.com/cattaka/droidkaigi2016/blob/devfest/step_3/app/src/androidTest/assets/GithubService/contributors.json)\n- DroidKaigiClient\u30af\u30e9\u30b9\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u7121\u3044\u305f\u3081\u3001@VisibleForTesting\u3092\u3064\u3051\u305f\u3082\u306e\u3092\u8ffd\u52a0\u3057\u307e\u3059\n\n```java\npublic class DroidKaigiClient {\n    /* \u7701\u7565 */\n    @VisibleForTesting\n    public DroidKaigiClient() {\n        service = null;\n        googleFormService = null;\n        githubService = null;\n    }\n    /* \u7701\u7565 */\n}\n```\n\n#### \u5dee\u3057\u66ff\u3048\u308b\u305f\u3081\u306eJUnit4\u306eRule\u3092\u4f5c\u308b\nJUnit4\u306eRule\u306f\u4f5c\u6210\u3057\u3066\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306b\u9069\u7528\u3059\u308b\u3068\u3001\u5404\u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u884c\u306e\u958b\u59cb\u3084\u7d42\u4e86\u306b\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u30c6\u30b9\u30c8\u6642\u306bMainApplication\u306eAppComponent\u3092\u5dee\u3057\u66ff\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\napp/src/androidTest/java/io/github/droidkaigi/test/IsolateEnvRule.java\n\n```java\npublic class IsolateEnvRule implements TestRule {\n    public TestAppModule appModule;\n\n    @Override\n    public Statement apply(Statement base, Description description) {\n        return statement(base, description);\n    }\n\n    private Statement statement(final Statement base, final Description desc) {\n        return new Statement() {\n            @Override\n            public void evaluate() throws Throwable {\n                before();\n                try {\n                    base.evaluate();\n                } finally {\n                    after();\n                }\n            }\n        };\n    }\n    private void before() {\n        MainApplication application = (MainApplication) InstrumentationRegistry.getTargetContext().getApplicationContext();\n        appModule = new TestAppModule(application);\n        appModule.reset();\n        AppComponent testAppComponent = DaggerAppComponent.builder()\n                .appModule(appModule)\n                .build();\n        application.setAppComponent(testAppComponent);\n    }\n    private void after() {\n        appModule.shutdown();\n    }\n}\n```\n\n[Step 3\u306e\u5909\u66f4\u70b9](https://github.com/cattaka/droidkaigi2016/compare/devfest/step_2...devfest/step_3)\n\n\n## Step4\uff1aSessionFeedbackActivity\u3067\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u3092\u9001\u4fe1\u3059\u308b\u30c6\u30b9\u30c8\n\n### \u306f\u3058\u3081\u304b\u305f\n```bash\n$ git checkout devfest/step_3\n```\n<img width=\"30%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/d35fed42-6675-552f-f5a5-9e1e6e040449.png\"/>\n\n### SessionFeedbackActivityTest\u30af\u30e9\u30b9\u3092\u4f5c\u308b\n- SessionFeedbackActivityTest\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3059\u308b\n- IsolateEnvRule\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\n- ActivityTestRule\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\n- \u30c6\u30b9\u30c8\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u308b\n - SessionFeedbackActivity\u306e\u8d77\u52d5\u306b\u8b1b\u6f14\u60c5\u5831\u304c\u5fc5\u8981\u306a\u306e\u3067\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u304b\u3089\u53d6\u5f97\u3059\u308b\n - Intent\u3092\u751f\u6210\u3059\u308b\n - SessionFeedbackActivity#createIntent\u30e1\u30bd\u30c3\u30c9\u3092public\u306b\u3059\u308b\n - SessionFeedbackActivity\u3092\u8d77\u52d5\u3059\u308b\n\n```java\npublic class SessionFeedbackActivityTest {\n    @Rule\n    public IsolateEnvRule isolateEnvRule = new IsolateEnvRule();\n\n    public ActivityTestRule<SessionFeedbackActivity> activityTestRule = new ActivityTestRule<>(SessionFeedbackActivity.class, false, false);\n\n    @Test\n    public void check_request_on_click() {\n        Session session;\n        {   // \u507d\u7269\u306e\u8b1b\u6f14\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n            List<Session> sessions = isolateEnvRule.appModule.droidKaigiClient.getSessions(\"ja\").toBlocking().first();\n            session = sessions.get(0);\n        }\n\n        Context targetContext = InstrumentationRegistry.getTargetContext();\n        Intent intent = SessionFeedbackActivity.createIntent(targetContext, session);\n        SessionFeedbackActivity activity = activityTestRule.launchActivity(intent);\n    }\n}\n```\n\n\n### \u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u3066\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\nEditText\u306b\u5165\u529b\u3057\u305f\u308a\u3001View\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u308a\u3068\u3044\u3063\u305fUI\u306e\u64cd\u4f5c\u306b\u306fEspresso\u306e\u6a5f\u80fd\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Espresso\u3067\u306fonView\u304b\u3089\u59cb\u307e\u308b\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3092\u7528\u3044\u3066\u6b21\u306e\u3088\u3046\u306b\u64cd\u4f5c\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![espresso_onview.png](https://qiita-image-store.s3.amazonaws.com/0/55138/c1605b54-b7ee-e514-0c6f-9dc56029081d.png)\n\n#### EditText\u307e\u3067\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3066\u6587\u5b57\u3092\u5165\u529b\u3059\u308b\n\n<img width=\"30%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/50e063d0-0f03-57e5-2939-e4c717ccd547.png\"/>\n\nSessionFeedbackActivity\u306b\u306fR.id.other_comments_feedback_text\u3068\u3044\u3046EditText\u304c\u5b58\u5728\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eEditText\u307e\u3067\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u3001\u6587\u5b57\u3092\u5165\u529b\u3055\u305b\u308b\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u3002\n\n```java        \nEspresso.onView(ViewMatchers.withId(R.id.other_comments_feedback_text))\n                .perform(\n                        ViewActions.scrollTo(),\n                        ViewActions.replaceText(\"Hogehoge Fugafuga\"));\n```\n\n\u88dc\u8db3\uff1areplaceText\u306b\u3088\u304f\u4f3c\u305ftypeText\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u8a18\u53f7\u306a\u3069\u3092\u5165\u529b\u3057\u305f\u969b\u306b\u6a5f\u7a2e\u306b\u3088\u3063\u3066\u6587\u5b57\u304c\u5316\u3051\u308b\u3053\u3068\u304c\u3042\u308b\u305f\u3081\u79c1\u306f\u4f7f\u7528\u3092\u907f\u3051\u3066\u3044\u307e\u3059\u3002\n\nonView\u3084withId\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u3068\u983b\u7e41\u306b\u4f7f\u3046\u305f\u3081\u3001\u3044\u3061\u3044\u3061\u30af\u30e9\u30b9\u540d\u3092\u3064\u3051\u3066\u3044\u308b\u3068\u8aad\u307f\u306b\u304f\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u5e78\u3044Espresson\u3084JUnit\u306f\u307b\u3068\u3093\u3069\u304cstatic\u30e1\u30bd\u30c3\u30c9\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30af\u30e9\u30b9\u540d\u306fJava\u8a00\u8a9e\u306estatic imports\u306e\u6a5f\u80fd\u3092\u4f7f\u3046\u3053\u3068\u3067\u7701\u7565\u3059\u308b\u3068\u8aad\u307f\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n```java\n        onView(withId(R.id.other_comments_feedback_text))\n                .perform(\n                        scrollTo(),\n                        replaceText(\"Hogehoge Fugafuga\"));\n```\n\n\nAndroid Studio\u3067\u306f\u30e1\u30bd\u30c3\u30c9\u306b\u30ab\u30fc\u30bd\u30eb\u3092\u5f53\u3066\u3066Intention Actions\uff08Alt+Enter\uff09\u3092\u5b9f\u884c\u3059\u308b\u3068\u7c21\u5358\u306bstatic imports\u306b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/55138/9638fbf4-1189-7846-79a2-113b93c51222.png)\n\n\n#### \u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\nonView\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n        onView(withId(R.id.submit_feedback_button))\n                .perform(scrollTo(), click());\n```\n\n#### \uff15\u6bb5\u968e\u8a55\u4fa1\u306e\u64cd\u4f5c\u3092\u884c\u3046\n\u3053\u306e\u30a2\u30d7\u30ea\u3067\u306f5\u6bb5\u968e\u8a55\u4fa1\u306eNumberRatingBar\u3068\u3044\u3046SeekBar\u3092\u7d99\u627f\u3057\u305f\u30ab\u30b9\u30bf\u30e0View\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u6b8b\u5ff5\u306a\u304c\u3089Espresso\u306e\u6a19\u6e96\u306e\u6a5f\u80fd\u3067\u306f\u3053\u308c\u3092\u64cd\u4f5c\u3059\u308bViewAction\u306f\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u3057\u304b\u3057\u6b21\u306esetProgress\u30e1\u30bd\u30c3\u30c9\u306e\u3088\u3046\u306b\u3001\u30ab\u30b9\u30bf\u30e0\u306eViewAction\u3092\u751f\u6210\u3059\u308b\u3082\u306e\u3092\u4f5c\u308b\u3053\u3068\u3067\u7c21\u5358\u306b\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n[app/src/androidTest/java/io/github/droidkaigi/test/CustomViewAction.java](https://github.com/cattaka/droidkaigi2016/blob/devfest/step_4/app/src/androidTest/java/io/github/droidkaigi/test/CustomViewAction.java)\n\n```java\npublic class CustomViewAction {\n    public static ViewAction setProgress(final int progress) {\n        return new ViewAction() {\n            @Override\n            public void perform(UiController uiController, View view) {\n                ((SeekBar) view).setProgress(progress);\n                //or ((SeekBar) view).setProgress(progress);\n            }\n\n            @Override\n            public String getDescription() {\n                return \"Set a progress\";\n            }\n\n            @Override\n            public Matcher<View> getConstraints() {\n                return ViewMatchers.isAssignableFrom(SeekBar.class);\n            }\n        };\n    }\n}\n```\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068\uff15\u6bb5\u968e\u8a55\u4fa1\u306e\u51e6\u7406\u306fonView\u3092\u4f7f\u3063\u3066\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n        onView(withId(R.id.relevant_feedback_bar))\n                .perform(scrollTo(), setProgress(1));\n        onView(withId(R.id.as_expected_feedback_bar))\n                .perform(scrollTo(), setProgress(2));\n        onView(withId(R.id.difficulty_feedback_bar))\n                .perform(scrollTo(), setProgress(3));\n        onView(withId(R.id.knowledgeable_feedback_bar))\n                .perform(scrollTo(), setProgress(4));\n```\n\n### \u9001\u4fe1\u3057\u3088\u3046\u3068\u3057\u305f\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\n\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u6642\u3001\u30a2\u30d7\u30ea\u306f\u901a\u4fe1\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u304cUI\u64cd\u4f5c\u306b\u6cbf\u3063\u305f\u3082\u306e\u3067\u3042\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\u3053\u306e\u3068\u304d\u306bDroidKaigiClient#submitSessionFeedback\u30e1\u30bd\u30c3\u30c9\u304c\u53e9\u304b\u308c\u308b\u306e\u3067\u3001\u305d\u306e\u5f15\u6570\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u624b\u9806\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n- IsolateEnvRule\u304c\u6301\u3064droidKaigiClient\u3092\u3001Mockito\u306e\u6a5f\u80fd\u3092\u4f7f\u3057\u3001\u5f15\u6570\u3092\u5f8c\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n- UI\u64cd\u4f5c\u5f8c\u3001IsolateEnvRule\u304c\u6301\u3064droidKaigiClient\u304b\u3089\u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u308a\u51fa\u3059\n- \u53d6\u308a\u51fa\u3057\u305f\u5f15\u6570\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\n\n#### droidKaigiClient\u306e\u5f15\u6570\u3092\u5f8c\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n```java\n        DroidKaigiClient droidKaigiClient = Mockito.mock(\n                DroidKaigiClient.class,\n                new ForwardsInvocations(isolateEnvRule.appModule.droidKaigiClient)\n        );\n        isolateEnvRule.appModule.droidKaigiClient = droidKaigiClient;\n```\n\n#### \u6e21\u3055\u308c\u305f\u5f15\u6570\u3092\u53d6\u308a\u51fa\u3059\n```java\n        ArgumentCaptor<SessionFeedback> captor = ArgumentCaptor.forClass(SessionFeedback.class);\n        Mockito.verify(droidKaigiClient)\n                .submitSessionFeedback(captor.capture());\n        SessionFeedback value = captor.getValue();\n```\n\n#### \u53d6\u308a\u51fa\u3057\u305f\u5f15\u6570\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\u3059\u308b\n```java\n        assertThat(value.relevancy, Matchers.is(1));\n        assertThat(value.asExpected, Matchers.is(2));\n        assertThat(value.difficulty, Matchers.is(3));\n        assertThat(value.knowledgeable, Matchers.is(4));\n        assertThat(value.comment, Matchers.is(\"Hogehoge Fugafuga\"));\n```\n\n[Step 4\u306e\u5909\u66f4\u70b9](https://github.com/cattaka/droidkaigi2016/compare/devfest/step_3...devfest/step_4)\n\n\n## Step 5\uff1aMainActivity\u304b\u3089\u8b1b\u6f14\u60c5\u5831\u3092\u8868\u793a\u3059\u308b\u64cd\u4f5c\u306e\u30c6\u30b9\u30c8\nMainActivity\u306b\u306f\u8b1b\u6f14\u306e\u30ea\u30b9\u30c8\u304c\u3042\u308a\u3001\u305d\u308c\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068SessionDetailActivity\u306b\u9077\u79fb\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u30c6\u30b9\u30c8\u3059\u308b\u306b\u306fActivityMonitor\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n### \u306f\u3058\u3081\u304b\u305f\n```bash\n$ git checkout devfest/step_4\n```\n\n<img width=\"60%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/4529fcde-258c-def1-078d-fd8b2d3ca146.png\"/>\n\n\n### RecyclerView\u306e\uff11\u3064\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\nonView\u3092\u4f7f\u3063\u3066\u66f8\u3051\u307e\u3059\u304c\u3001\uff12\u3064\u8ab2\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\n- \u30af\u30ea\u30c3\u30af\u3057\u305f\u3044\u306e\u306fRecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u306a\u306e\u3067\u3001\u30af\u30ea\u30c3\u30af\u3057\u305f\u3044View\u3092withId\u3067\u6307\u5b9a\u3067\u304d\u306a\u3044\n- MainActivity\u4e0a\u306b\u306fR.id.recycler_view\u304c\u8907\u6570\u3042\u308b\u305f\u3081\u3001\u300c\u3069\u306e\u300dRecyclerView\u306a\u306e\u304b\u3092withId\u3067\u6307\u5b9a\u3067\u304d\u306a\u3044\n\n#### RecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u306b\u306f\nEspresso\u3067RecyclerView\u3092\u64cd\u4f5c\u3059\u308b\u306e\u306b\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u6ce5\u81ed\u3044\u3053\u3068\u3092\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u5e78\u3044\u305d\u306e\u305f\u3081\u306eespresso-contrib\u3068\u3044\u3046\u8ffd\u52a0\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3046\u3068RecyclerView\u306e\u7279\u5b9a\u306e\u8981\u7d20\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u305f\u308a\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u304c\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n            onView(<\u3053\u3053\u306bRecyclerView\u3092\u6307\u5b9a\u3059\u308b>)\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n            onView(<\u3053\u3053\u306bRecyclerView\u3092\u6307\u5b9a\u3059\u308b>)\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n```\n\n\u95a2\u9023\u60c5\u5831\uff1a[RecyclerView\u306e\uff11\u3064\u306e\u9805\u76ee\u306e\u5185\u90e8\u306eView\u3078\u306eperform\u3084check\u3092\u884c\u3046\u65b9\u6cd5](http://qiita.com/cattaka/items/b13368561b8ad43e014c)\n\n#### \u7279\u5b9a\u306eRecyclerView\u3092\u6307\u5b9a\u3059\u308b\n\u76ee\u7684\u306eRecyclerView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u53d6\u5f97\u3067\u304d\u308c\u3070\u3001withId\u306e\u4ee3\u308f\u308a\u306bMatchers.equalTo\u304c\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068RecyclerView\u306e\u7279\u5b9a\u306e\u8981\u7d20\u306b\u30b9\u30af\u30ed\u30fc\u30eb\u3057\u305f\u308a\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u304c\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n        View recyclerView;\n        {   // \u5c11\u3005\u5f37\u5f15\u3060\u304cRecyclerView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\n            ViewPager viewPager = (ViewPager) activity.findViewById(R.id.view_pager);\n            FragmentStatePagerAdapter adapter = (FragmentStatePagerAdapter) viewPager.getAdapter();\n            Fragment sessionsTabFragment = adapter.getItem(0);\n            recyclerView = sessionsTabFragment.getView();\n        }\n\n        onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n        onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n```\n\n### SessionDetailActivity\u304c\u8d77\u52d5\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\nActivity\u304c\u8d77\u52d5\u3057\u305f\u304b\u5426\u304b\u306fActivityMonitor\u3092\u4f7f\u3046\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u5bfe\u8c61\u3068\u306a\u308bActivity\u7528\u306eActivityMonitor\u3092\u4f5c\u6210\u3057\u3001Instrumentation#addMonitor()\u3067\u767b\u9332\u3059\u308b\u3068\u3001\u305d\u308c\u3088\u308a\u5f8c\u306b\u8d77\u52d5\u3057\u305fActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nActivityMonitor\u306e\u4f5c\u6210\u3068\u767b\u9332\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n        Instrumentation.ActivityMonitor monitor = new Instrumentation.ActivityMonitor(SessionDetailActivity.class.getCanonicalName(), null, false);\n        InstrumentationRegistry.getInstrumentation().addMonitor(monitor);\n```\n\n\u305d\u3057\u3066UI\u306e\u64cd\u4f5c\u5f8c\u306b\u8d77\u52d5\u3057\u305f\u304b\u3069\u3046\u304b\u306f\u6b21\u306e\u3088\u3046\u306b\u66f8\u3051\u307e\u3059\u3002\n\n```java\n            Activity nextActivity = monitor.waitForActivityWithTimeout(5000);\n            assertThat(nextActivity, Matchers.is(Matchers.notNullValue()));\n            nextActivity.finish();\n```\n\n\u3053\u308c\u3089\u3092\u7e4b\u3052\u308b\u3068\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```java\n        Instrumentation.ActivityMonitor monitor = new Instrumentation.ActivityMonitor(SessionDetailActivity.class.getCanonicalName(), null, false);\n        InstrumentationRegistry.getInstrumentation().addMonitor(monitor);\n        try {\n            onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.scrollToPosition(5));\n            onView(Matchers.equalTo(recyclerView))\n                    .perform(RecyclerViewActions.actionOnItemAtPosition(5, click()));\n\n            Activity nextActivity = monitor.waitForActivityWithTimeout(5000);\n            assertThat(nextActivity, Matchers.is(Matchers.notNullValue()));\n            nextActivity.finish();\n        } finally {\n            InstrumentationRegistry.getInstrumentation().removeMonitor(monitor);\n        }\n```\n\n\n[Step 5\u306e\u5909\u66f4\u70b9](https://github.com/cattaka/droidkaigi2016/compare/devfest/step_4...devfest/step_5)\n\n\n\n## Step 6\uff1agradle\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\n### \u306f\u3058\u3081\u304b\u305f\n```bash\n$ git checkout devfest/step_5\n```\n\n### \u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u300c$ ./gradlew \\connected[BuildVariant\u540d]AndroidTest\u300d\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fBuildVariant\u306b\u300cDevelopDebug\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u306e\u3067\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```bash\n$ ./gradlew connectedDevelopDebugAndroidTest\n```\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u30ec\u30dd\u30fc\u30c8\u306exml\u3084html\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n- app/build/outputs/androidTest-results/connected/flavors/DEVELOP/TEST-Nexus 4 - 5.1.1-app-DEVELOP.xml\n- app/build/reports/androidTests/connected/flavors/DEVELOP/index.html\n - ![image](https://qiita-image-store.s3.amazonaws.com/0/55138/a3febfaf-aa83-def5-c0cd-f329d0199a9a.png)\n\n### \u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u751f\u6210\u3059\u308b\n\u30c6\u30b9\u30c8\u6642\u306e\u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u8a08\u6e2c\u3059\u308b\u306b\u306fapp/build.gradle\u306b\u6b21\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\napp/build.gradle\n\n```groovy\nandroid {\n    /* \u7701\u7565 */\n    buildTypes {\n        debug {\n            /* \u7701\u7565 */\n            testCoverageEnabled true\n        }\n        /* \u7701\u7565 */\n    }\n    /* \u7701\u7565 */\n}\n```\n\n\u305d\u3057\u3066\u300c./gradlew create[BuildVariant\u540d]CoverageReport\u300d\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ ./gradlew createDevelopDebugCoverageReport\n```\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30b3\u30fc\u30c9\u30ab\u30d0\u30ec\u30c3\u30b8\u306e\u30ec\u30dd\u30fc\u30c8\u306eec\u30d5\u30a1\u30a4\u30eb\u3084html\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n- app/build/outputs/code-coverage/connected/flavors/DEVELOP\n- app/build/reports/coverage/develop/debug/index.html\n - ![image](https://qiita-image-store.s3.amazonaws.com/0/55138/9832b25f-cb88-2734-3574-c7c8f1c713ff.png)\n - ![image](https://qiita-image-store.s3.amazonaws.com/0/55138/221297b5-c599-8d48-670e-3c761d36e787.png)\n\n\n## \u307e\u3068\u3081\n- \u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306b\u306f\u30a2\u30d7\u30ea\u306e\u72b6\u614b\u3092\u4f5c\u308a\u51fa\u3059\u3053\u3068\u304c\u5927\u4e8b\n - \u5185\u90e8\u7684\u306a\u72b6\u614b\uff1a\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3001SharedPreferences \n - \u5916\u90e8\u306b\u4f9d\u5b58\u3059\u308b\u72b6\u614b\uff1a\u901a\u4fe1\u51e6\u7406\n- Dagger2\u3092\u4f7f\u3048\u3070\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5dee\u3057\u66ff\u3048\u3089\u308c\u308b\n- Espresso\u3092\u4f7f\u3046\u3068UI\u64cd\u4f5c\u306e\u51e6\u7406\u304c\u7c21\u6f54\u306b\u66f8\u3051\u308b\n\n## \u95a2\u9023\u66f8\u7c4d\n\n### \u30a2\u30f3\u30c9\u30ed\u30a4\u30c9\u30a2\u30ab\u30c7\u30df\u30a2 - TechBooster\n<a href=\"https://booth.pm/ja/items/299593\">\n<img width=\"20%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/1a68f0b3-81b0-7bd7-12a5-7a656ac7be36.png\">\n</a>\n\n- \u300cAndroid\u30c6\u30b9\u30c8\u30ec\u30b7\u30d4\u300d\u306bAndroid\u306e\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u306e\u30ce\u30a6\u30cf\u30a6\u3092\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n### Android\u6539\u5584\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 - TechBooster\n<a href=\"https://booth.pm/ja/items/126671\">\n<img width=\"20%\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55138/aebf0488-fc01-093a-3dc3-ae8a3aa319cf.png\">\n</a>\n- \u300cEspresso\u306f\u30a2\u30d7\u30ea\u304c\u9577\u751f\u304d\u3059\u308b\u79d8\u8a23\u300d\u306bEspresso\u306e\u4f7f\u3044\u65b9\u3084\u6a5f\u80fd\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n", "tags": ["Android", "Espresso", "JUnit"]}