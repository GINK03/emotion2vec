{"context": "Microsoft\u306eCognitive Services\u306e\u8868\u60c5\u8a8d\u8b58API\u3092\u4f7f\u3063\u3066\u307f\u305f\n\u30d6\u30ed\u30b0\u5ba3\u4f1d\uff1ahttp://jotarout.hatenablog.com/\n\n\u9854\u306f\u5fc3\u306e\u7a93\uff1f\n\u4eba\u306e\u8868\u60c5\u3092\u77e5\u308b\u3053\u3068\u3067\u3001\u305d\u306e\u4eba\u306e\u751f\u7406\u7684\u30fb\u5185\u90e8\u7684\u72b6\u614b\u3092\u63a8\u5b9a\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002 \u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306e\u529b\u3092\u501f\u308a\u3066\u3001\u3042\u3089\u3086\u308b\u4eba\u306e\u8868\u60c5\u3092\u8a8d\u8b58\u3057\u3066\u307f\u3088\u3046\u3002\nMicrosoft\u306e\u8868\u60c5\u8a8d\u8b58API\u3092\u4f7f\u3046\u3002\n\u2191\u306e\u30b5\u30a4\u30c8\u304b\u3089\u767b\u9332\u3057\u3066\u3001API\u30ad\u30fc\u3092\u5f97\u305f\u3089\u3001 \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bapi_key.txt\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\u30b3\u30fc\u30c9\u306f\u3053\u308c\u3002\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bAPI\u30ad\u30fc\u3068\u597d\u304d\u306a\u753b\u50cf\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3002 \u3072\u3068\u307e\u305a\u306f\u3001\u8868\u60c5\u306e\u6a2a\u3063\u3061\u3087\u306b5\u3064\u611f\u60c5\u3068\u30ec\u30d9\u30eb\u3092\u8868\u793a\u3059\u308bUI\u3092\u5f15\u3063\u4ed8\u3051\u308b\u3001\u307f\u305f\u3044\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002\n\nms_emotion.py\n# Calling Emotion APIs is\n# restricted to 20 transactions per minute\n# and 30,000 transactions per month.\n# 20 transactions per 60 seconds\n# 1 transaction per 3 seconds\n\nimport httplib\nimport urllib\nimport base64\nimport os\nimport sys\nimport cv2\nimport numpy as np\nimport json\nimport math\n\ndef get_emotion(file_path, headers):\n    try:\n        conn = httplib.HTTPSConnection('api.projectoxford.ai')\n        conn.request(\"POST\", \"/emotion/v1.0/recognize?\",\n                     open(file_path, 'rb'), headers)\n        response = conn.getresponse()\n        data = response.read()\n        conn.close()\n        return data\n    except Exception as e:\n        print(\"[Errno {0}] {1}\".format(e.errno, e.strerror))\n        print(e.message)\n\ndef display_expression(data,img):\n    font = cv2.FONT_HERSHEY_PLAIN\n    text = \"test cyber\"\n    font_size = 1\n    data = json.loads(data)\n    for face in data:\n        f_rec  =  face['faceRectangle']\n        width  =  f_rec['width']\n        height =  f_rec['height']\n        left   =  f_rec['left']\n        top    =  f_rec['top']\n        f_rec  =  face['scores']\n        f_rec = sorted(f_rec.items(), key=lambda x:x[1],reverse = True)\n        cv2.rectangle(img,(left,top),(left+width,top+height),(130,130,130),2)\n        cv2.rectangle(img,(left+width,top),(left+width+150,top+50),(130,130,130),-1)\n\n        for i in range(0,5):\n            val = round(f_rec[i][1],3)\n            emo = f_rec[i][0]\n            cv2.rectangle(img,(left+width,top+10*i),(left+width+int(val*150),top+10*(i+1)),(180,180,180),-1)\n            cv2.putText(img, emo+\" \"+str(val),(left+width,top+10*(i+1)),font, font_size,(255,255,255),1)\n\nif __name__ == '__main__':\n    if len(sys.argv) != 2:\n        print 'Usage: # python %s /path/to/image' % sys.argv[0]\n        quit()\n\n    with open('api_key.txt', 'r') as f:\n        key = f.read().rstrip('\\n')\n    f.close()\n    headers = {\n        'Content-Type': 'application/octet-stream',\n        'Ocp-Apim-Subscription-Key': key,\n    }\n\n    data = get_emotion(sys.argv[1], headers)\n    img = cv2.imread(sys.argv[1],-1)\n\n    display_expression(data,img)\n\n    cv2.imshow('image',img)\n    cv2.waitKey(0)\n    cv2.destroyAllWindows()\n\n\npython ms_emotion.py your_image.png \u3067\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n\n\n\n\u7d50\u69cb\u7cbe\u5ea6\u304c\u3044\u3044\u3068\u601d\u3046(\u5c0f\u3055\u3044\u9854\u306f\u3042\u3093\u307e\u308a\u53d6\u308c\u306a\u3044)\u3002 \u8868\u60c5\u306f10\u7a2e\u985e\u3050\u3089\u3044\u30ab\u30c6\u30b4\u30ea\u5206\u3051\u3055\u308c\u308b\u306e\u3067\u3001\u8272\u3005\u904a\u3093\u3067\u307f\u308b\u3068\u697d\u3057\u305d\u3046\u3002\n\u52d5\u753b\u50cf\u89e3\u6790\u306b\u3082\u4f7f\u3048\u305d\u3046\u3067\u3059\u306d\uff01API\u304c\u8a31\u3057\u3066\u304f\u308c\u308b\u9650\u308a\u30fb\u30fb\u30fb\u3002\n\nMicrosoft\u306eCognitive Services\u306e\u8868\u60c5\u8a8d\u8b58API\u3092\u4f7f\u3063\u3066\u307f\u305f\n\n\u30d6\u30ed\u30b0\u5ba3\u4f1d\uff1ahttp://jotarout.hatenablog.com/\n\n##\u9854\u306f\u5fc3\u306e\u7a93\uff1f\n\u4eba\u306e\u8868\u60c5\u3092\u77e5\u308b\u3053\u3068\u3067\u3001\u305d\u306e\u4eba\u306e\u751f\u7406\u7684\u30fb\u5185\u90e8\u7684\u72b6\u614b\u3092\u63a8\u5b9a\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002 \u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u306e\u529b\u3092\u501f\u308a\u3066\u3001\u3042\u3089\u3086\u308b\u4eba\u306e\u8868\u60c5\u3092\u8a8d\u8b58\u3057\u3066\u307f\u3088\u3046\u3002\n\n[Microsoft\u306e\u8868\u60c5\u8a8d\u8b58API](https://www.microsoft.com/cognitive-services/en-us/emotion-api \"Microsoft\u306e\u8868\u60c5\u8a8d\u8b58API\")\u3092\u4f7f\u3046\u3002\n\n\n\u2191\u306e\u30b5\u30a4\u30c8\u304b\u3089\u767b\u9332\u3057\u3066\u3001API\u30ad\u30fc\u3092\u5f97\u305f\u3089\u3001 __\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bapi_key.txt\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002__\n\n\u30b3\u30fc\u30c9\u306f\u3053\u308c\u3002\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306bAPI\u30ad\u30fc\u3068\u597d\u304d\u306a\u753b\u50cf\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3002 \u3072\u3068\u307e\u305a\u306f\u3001\u8868\u60c5\u306e\u6a2a\u3063\u3061\u3087\u306b5\u3064\u611f\u60c5\u3068\u30ec\u30d9\u30eb\u3092\u8868\u793a\u3059\u308bUI\u3092\u5f15\u3063\u4ed8\u3051\u308b\u3001\u307f\u305f\u3044\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002\n\n\n```py:ms_emotion.py\n# Calling Emotion APIs is\n# restricted to 20 transactions per minute\n# and 30,000 transactions per month.\n# 20 transactions per 60 seconds\n# 1 transaction per 3 seconds\n\nimport httplib\nimport urllib\nimport base64\nimport os\nimport sys\nimport cv2\nimport numpy as np\nimport json\nimport math\n\ndef get_emotion(file_path, headers):\n    try:\n        conn = httplib.HTTPSConnection('api.projectoxford.ai')\n        conn.request(\"POST\", \"/emotion/v1.0/recognize?\",\n                     open(file_path, 'rb'), headers)\n        response = conn.getresponse()\n        data = response.read()\n        conn.close()\n        return data\n    except Exception as e:\n        print(\"[Errno {0}] {1}\".format(e.errno, e.strerror))\n        print(e.message)\n\ndef display_expression(data,img):\n    font = cv2.FONT_HERSHEY_PLAIN\n    text = \"test cyber\"\n    font_size = 1\n    data = json.loads(data)\n    for face in data:\n        f_rec  =  face['faceRectangle']\n        width  =  f_rec['width']\n        height =  f_rec['height']\n        left   =  f_rec['left']\n        top    =  f_rec['top']\n        f_rec  =  face['scores']\n        f_rec = sorted(f_rec.items(), key=lambda x:x[1],reverse = True)\n        cv2.rectangle(img,(left,top),(left+width,top+height),(130,130,130),2)\n        cv2.rectangle(img,(left+width,top),(left+width+150,top+50),(130,130,130),-1)\n\n        for i in range(0,5):\n            val = round(f_rec[i][1],3)\n            emo = f_rec[i][0]\n            cv2.rectangle(img,(left+width,top+10*i),(left+width+int(val*150),top+10*(i+1)),(180,180,180),-1)\n            cv2.putText(img, emo+\" \"+str(val),(left+width,top+10*(i+1)),font, font_size,(255,255,255),1)\n\nif __name__ == '__main__':\n    if len(sys.argv) != 2:\n        print 'Usage: # python %s /path/to/image' % sys.argv[0]\n        quit()\n\n    with open('api_key.txt', 'r') as f:\n        key = f.read().rstrip('\\n')\n    f.close()\n    headers = {\n        'Content-Type': 'application/octet-stream',\n        'Ocp-Apim-Subscription-Key': key,\n    }\n\n    data = get_emotion(sys.argv[1], headers)\n    img = cv2.imread(sys.argv[1],-1)\n\n    display_expression(data,img)\n\n    cv2.imshow('image',img)\n    cv2.waitKey(0)\n    cv2.destroyAllWindows()\n```\n`python ms_emotion.py your_image.png` \u3067\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n![20160517002308.png](https://qiita-image-store.s3.amazonaws.com/0/86040/93ec3ce0-a29e-de67-fbf8-c2fa36114ba4.png)\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-25 21.06.06.png](https://qiita-image-store.s3.amazonaws.com/0/86040/a03dfb78-859c-efdc-e666-848e0690568e.png)\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-25 21.08.03.png](https://qiita-image-store.s3.amazonaws.com/0/86040/0c86755e-98f5-0d1f-3ddc-347404758b75.png)\n\n![Screenshot from 2016-08-21 02-58-00.png](https://qiita-image-store.s3.amazonaws.com/0/86040/6a9d7a98-e99d-67b5-ed90-cf5678a1c055.png)\n\n\u7d50\u69cb\u7cbe\u5ea6\u304c\u3044\u3044\u3068\u601d\u3046(\u5c0f\u3055\u3044\u9854\u306f\u3042\u3093\u307e\u308a\u53d6\u308c\u306a\u3044)\u3002 \u8868\u60c5\u306f10\u7a2e\u985e\u3050\u3089\u3044\u30ab\u30c6\u30b4\u30ea\u5206\u3051\u3055\u308c\u308b\u306e\u3067\u3001\u8272\u3005\u904a\u3093\u3067\u307f\u308b\u3068\u697d\u3057\u305d\u3046\u3002\n\n\u52d5\u753b\u50cf\u89e3\u6790\u306b\u3082\u4f7f\u3048\u305d\u3046\u3067\u3059\u306d\uff01API\u304c\u8a31\u3057\u3066\u304f\u308c\u308b\u9650\u308a\u30fb\u30fb\u30fb\u3002\n", "tags": ["Azure", "Cognitive", "Microsoft", "Python", "services"]}