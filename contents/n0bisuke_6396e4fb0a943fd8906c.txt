{"context": " More than 1 year has passed since last update.\n\u203b \u5206\u304b\u308a\u306b\u304f\u3044\u30bf\u30a4\u30c8\u30eb\u3067\u3059\u304c\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\n\n\u306f\u3058\u3081\u306b\n\u79c1\u306fNode.js\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u306e\u30c4\u30fc\u30eb\u3068\u3057\u3066(\u306a\u3093\u3068\u306a\u304f\u9ad8\u6a5f\u80fd\u3068\u3044\u3046\u5642\u306a\u306e\u3067)pm2\u3092\u5229\u7528\u3057\u3066\u307e\u3059\u3002\npm2\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u51fa\u6765\u308b\u306e\u3067\u4eca\u56de\u306f\u3053\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001pm2\u30d7\u30ed\u30bb\u30b9\u3092\u5b9a\u671f\u7684\u306b\u518d\u8d77\u52d5\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u3093\u3067\u307f\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u6a5f\u80fd\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3063\u3066\u7121\u3044\u306e\u304b\u306a...?\n\u53c2\u8003: Using PM2 programmatically\n\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u3042\u308b\u30b3\u30fc\u30c9\n\npm2kick.js\nvar pm2 = require('pm2');\n\n// Connect or launch PM2\npm2.connect(function(err) {\n\n  // Start a script on the current folder\n  pm2.start('test.js', { name: 'test' }, function(err, proc) {\n    if (err) throw new Error('err');\n\n    // Get all processes running\n    pm2.list(function(err, process_list) {\n      console.log(process_list);\n\n      // Disconnect to PM2\n      pm2.disconnect(function() { process.exit(0) });\n    });\n  });\n})\n\n\n\u3053\u308c\u3092pm2kick.js\u3068\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\n$ node pm2kick.js\n\ntest.js\u304cpm2\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002pm2 list\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n$ pm2 list\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 App name           \u2502 id \u2502 mode \u2502 PID  \u2502 status \u2502 restarted \u2502 uptime \u2502      memory \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 test               \u2502 0  \u2502 fork \u2502 6545 \u2502 online \u2502         1 \u2502 15s    \u2502 18.648 MB   \u2502 disabled \u2502\n\n\nnode-cron\u3092\u5229\u7528\u3057\u3066pm2\u3092\u518d\u8d77\u52d5\u3055\u305b\u308b\n\n\u6e96\u5099\npm2,time,cron\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ npm i --save pm2 time cron\n\n\n\u30b3\u30fc\u30c9\n\u30d7\u30ed\u30bb\u30b9\u306e\u30ea\u30b9\u30bf\u30fc\u30c8\u306frestart();\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3055\u305b\u305f\u3044\u306e\u3067\u7b2c\u4e00\u5f15\u6570\u306ball\u3092\u6e21\u3057\u3066\npm2.restart('all', callback);\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\npm2restart.js\nvar pm2 = require('pm2');\nvar cronJob = require('cron').CronJob;\nvar cronTime = \"0 0 6 * * *\"; // \u6bce\u65e5\u671d6\u6642\u306b\u5b9f\u884c\n\n//\u30d7\u30ed\u30bb\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u7d42\u4e86\u3055\u305b\u308b\nfunction showAndDone(){\n  pm2.list(function(err, process_list) {\n    console.log(process_list);\n    // Disconnect to PM2\n    pm2.disconnect(function(){\n      process.exit(0);\n    });\n  });\n}\n\n//\u5168\u3066\u518d\u8d77\u52d5\nfunction restartAll(){\n  pm2.restart('all', function(err, proc){\n    showAndDone();\n  });\n}\n\nvar job = new cronJob({\n  cronTime: cronTime,\n  onTick: function(){ //\u6307\u5b9a\u6642\u306b\u5b9f\u884c\u3057\u305f\u3044\u95a2\u6570\n    console.log('onTick!', new Date()); //\u6642\u9593\u8868\u793a\n\n    //pm2\u95a2\u9023\u3092\u5b9f\u884c\n    pm2.connect(function(err) {\n      restartAll();\n    });\n\n  },\n  onComplete: function() { //\u30b8\u30e7\u30d6\u306e\u5b8c\u4e86\u307e\u305f\u306f\u505c\u6b62\u6642\u306b\u5b9f\u884c\u3059\u308b\u95a2\u6570\n    console.log('onComplete!');\n  },\n  start: false // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u7d42\u3059\u308b\u524d\u306b\u30b8\u30e7\u30d6\u3092\u958b\u59cb\u3059\u308b\u304b\u3069\u3046\u304b\n  // timeZone: \"Japan/Tokyo\" //\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\n});\n\njob.start();\n\n\n\n\u78ba\u8a8d\n\u5148\u307b\u3069\u4f5c\u3063\u305f pm2\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u7528\u306epm2restart.js\u81ea\u4f53\u3082pm2\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002 \u5206\u304b\u308a\u306b\u304f\u3044\u3067\u3059\u306d\u6c57\n$ pm2 start pm2restart.js\n\n\ncron\u304c\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u304f\u308c\u308c\u3070\u6307\u5b9a\u6642\u9593\u304c\u304f\u308c\u3070pm2restart\u3082\u542b\u3081\u3066\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u518d\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n\u2193\u6307\u5b9a\u6642\u9593\u5f8c\u2193\n\n\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u518d\u8d77\u52d5\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nhttp://matomater.com/16991/\nhttp://liginc.co.jp/web/programming/node-js/123719\n\n\n> \u203b \u5206\u304b\u308a\u306b\u304f\u3044\u30bf\u30a4\u30c8\u30eb\u3067\u3059\u304c\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\n##\u306f\u3058\u3081\u306b\n\u79c1\u306fNode.js\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u306e\u30c4\u30fc\u30eb\u3068\u3057\u3066(\u306a\u3093\u3068\u306a\u304f\u9ad8\u6a5f\u80fd\u3068\u3044\u3046\u5642\u306a\u306e\u3067)[pm2](https://github.com/Unitech/pm2)\u3092\u5229\u7528\u3057\u3066\u307e\u3059\u3002\npm2\u306f\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u547c\u3073\u51fa\u3059\u3053\u3068\u3082\u51fa\u6765\u308b\u306e\u3067\u4eca\u56de\u306f\u3053\u306e\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001pm2\u30d7\u30ed\u30bb\u30b9\u3092\u5b9a\u671f\u7684\u306b\u518d\u8d77\u52d5\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u3093\u3067\u307f\u307e\u3059\u3002\n **\u30c7\u30d5\u30a9\u30eb\u30c8\u6a5f\u80fd\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3063\u3066\u7121\u3044\u306e\u304b\u306a...?**\n\n\u53c2\u8003: [Using PM2 programmatically](https://github.com/Unitech/PM2/blob/development/ADVANCED_README.md#programmatic-example)\n\n###\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u3042\u308b\u30b3\u30fc\u30c9\n\n```pm2kick.js\nvar pm2 = require('pm2');\n\n// Connect or launch PM2\npm2.connect(function(err) {\n\n  // Start a script on the current folder\n  pm2.start('test.js', { name: 'test' }, function(err, proc) {\n    if (err) throw new Error('err');\n\n    // Get all processes running\n    pm2.list(function(err, process_list) {\n      console.log(process_list);\n\n      // Disconnect to PM2\n      pm2.disconnect(function() { process.exit(0) });\n    });\n  });\n})\n```\n\n\u3053\u308c\u3092pm2kick.js\u3068\u3057\u3066\u5b9f\u884c\u3059\u308b\u3068\n\n```\n$ node pm2kick.js\n```\n\ntest.js\u304cpm2\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002pm2 list\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\n$ pm2 list\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 App name           \u2502 id \u2502 mode \u2502 PID  \u2502 status \u2502 restarted \u2502 uptime \u2502      memory \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 test               \u2502 0  \u2502 fork \u2502 6545 \u2502 online \u2502         1 \u2502 15s    \u2502 18.648 MB   \u2502 disabled \u2502\n```\n\n## node-cron\u3092\u5229\u7528\u3057\u3066pm2\u3092\u518d\u8d77\u52d5\u3055\u305b\u308b\n\n###\u6e96\u5099\npm2,time,cron\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ npm i --save pm2 time cron\n```\n\n###\u30b3\u30fc\u30c9\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u30ea\u30b9\u30bf\u30fc\u30c8\u306f`restart();`\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3092\u518d\u8d77\u52d5\u3055\u305b\u305f\u3044\u306e\u3067\u7b2c\u4e00\u5f15\u6570\u306ball\u3092\u6e21\u3057\u3066\n`pm2.restart('all', callback);`\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```pm2restart.js\nvar pm2 = require('pm2');\nvar cronJob = require('cron').CronJob;\nvar cronTime = \"0 0 6 * * *\"; // \u6bce\u65e5\u671d6\u6642\u306b\u5b9f\u884c\n\n//\u30d7\u30ed\u30bb\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u7d42\u4e86\u3055\u305b\u308b\nfunction showAndDone(){\n  pm2.list(function(err, process_list) {\n    console.log(process_list);\n    // Disconnect to PM2\n    pm2.disconnect(function(){\n      process.exit(0);\n    });\n  });\n}\n\n//\u5168\u3066\u518d\u8d77\u52d5\nfunction restartAll(){\n  pm2.restart('all', function(err, proc){\n    showAndDone();\n  });\n}\n\nvar job = new cronJob({\n  cronTime: cronTime,\n  onTick: function(){ //\u6307\u5b9a\u6642\u306b\u5b9f\u884c\u3057\u305f\u3044\u95a2\u6570\n    console.log('onTick!', new Date()); //\u6642\u9593\u8868\u793a\n\n\t//pm2\u95a2\u9023\u3092\u5b9f\u884c\n    pm2.connect(function(err) {\n      restartAll();\n    });\n\n  },\n  onComplete: function() { //\u30b8\u30e7\u30d6\u306e\u5b8c\u4e86\u307e\u305f\u306f\u505c\u6b62\u6642\u306b\u5b9f\u884c\u3059\u308b\u95a2\u6570\n    console.log('onComplete!');\n  },\n  start: false // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u7d42\u3059\u308b\u524d\u306b\u30b8\u30e7\u30d6\u3092\u958b\u59cb\u3059\u308b\u304b\u3069\u3046\u304b\n  // timeZone: \"Japan/Tokyo\" //\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\n});\n \njob.start();\n```\n\n##\u78ba\u8a8d\n\n\u5148\u307b\u3069\u4f5c\u3063\u305f **pm2\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u7528\u306epm2restart.js\u81ea\u4f53\u3082pm2\u30d7\u30ed\u30bb\u30b9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002** \u5206\u304b\u308a\u306b\u304f\u3044\u3067\u3059\u306d\u6c57\n\n```\n$ pm2 start pm2restart.js\n```\n\n![](http://i.gyazo.com/2bcc19d0b7fc124eace91779573ab41d.png)\n\ncron\u304c\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u304f\u308c\u308c\u3070\u6307\u5b9a\u6642\u9593\u304c\u304f\u308c\u3070pm2restart\u3082\u542b\u3081\u3066\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u518d\u8d77\u52d5\u3055\u308c\u307e\u3059\u3002\n\n**\u2193\u6307\u5b9a\u6642\u9593\u5f8c\u2193**\n\n![](http://i.gyazo.com/e9b601e9b5881c368fc2d4d21e906cdd.png)\n\n\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u518d\u8d77\u52d5\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\n## \u53c2\u8003\u30ea\u30f3\u30af\n* http://matomater.com/16991/\n* http://liginc.co.jp/web/programming/node-js/123719\n", "tags": ["pm2", "Node.js", "cron"]}