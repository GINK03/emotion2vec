{"tags": ["Linux", "KVM"], "context": " More than 1 year has passed since last update.\n\n\u524d\u306e\u8a18\u4e8b\nKVM \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nhttp://qiita.com/TsutomuNakamura/items/bb5cd1bcbf1b998941ed\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066\nKVM \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3001virbr0 \u3068\u3044\u3046\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b2\u30b9\u30c8OS \u304b\u3089\u306e\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u901a\u4fe1\u306e\u307f\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n# ifconfig virbr0\nvirbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500\n        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255\n        ether a2:37:db:38:ac:89  txqueuelen 0  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n\n\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u72b6\u614b\u306e\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u6b21\u306e\u3088\u3046\u306a\u6761\u4ef6\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n* KVM \u30db\u30b9\u30c8OS \u304b\u3089\u30b2\u30b9\u30c8OS \u3078\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\n* KVM \u30b2\u30b9\u30c8OS \u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\n\n\u4e0a\u8a18\u306e\u8981\u4ef6\u4ee5\u5916\u306b\u3001\u5916\u90e8\u306e\u30db\u30b9\u30c8\u304b\u3089\u30b2\u30b9\u30c8OS \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u305f\u308a\u3001\u30b2\u30b9\u30c8OS \u306eIP \u30a2\u30c9\u30ec\u30b9\u3092\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u306b\u306f\u3001\u30d6\u30ea\u30c3\u30b8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\nbridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\n(\u6ce8)bridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u306fwireless \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\nbridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u524d\u306b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nFedora\n# #\u203b \u30d5\u30a1\u30a4\u30eb\u540d(\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d)\u306f\u4efb\u610f\n# cp /etc/sysconfig/network-scripts/ifcfg-eno16777736 /root\n\n\n\nUbuntu\n$ sudo cp /etc/network/interfaces /root\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\nbridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nFedora\u306e\u5834\u5408\n# cp /etc/sysconfig/network-scripts/ifcfg-eno16777736 /etc/sysconfig/network-scripts/ifcfg-br0\n# mv /etc/sysconfig/network-scripts/ifcfg-eno16777736 /etc/sysconfig/network-scripts/ifcfg-eth0\n# vim /etc/sysconfig/network-scripts/ifcfg-eth0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"ifcfg-eth0\"\nTYPE=\"Ethernet\"\nHWADDR=\"00:0C:29:40:A7:3F\"\nONBOOT=\"yes\"\nNW_CONTROLLED=\"no\"\nBRIDGE=\"br0\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\n# vim /etc/sysconfig/network-scripts/ifcfg-br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"br0\"\nTYPE=\"Bridge\"\nNM_CONTROLLED=\"no\"\nBOOTPROTO=\"static\"\nIPADDR=\"192.168.1.21\"\nNETMASK=\"255.255.255.0\"\nGATEWAY=\"192.168.1.1\"\nONBOOT=\"yes\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"br0\"\nTYPE=\"Bridge\"\nNM_CONTROLLED=\"no\"\nBOOTPROTO=\"dhcp\"\nONBOOT=\"yes\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\n\n\u203b\u4e0a\u8a18\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001eth0 \u3068\u3044\u3046\u540d\u524d\u3067\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u4f5c\u308a\u76f4\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\"ifcfg-eno16777736\" \u3068\u3044\u3046\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u305d\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u30fb\u30fb\u30fb\n\nUbuntu\u306e\u5834\u5408\n# sudo cp /etc/network/interfaces /root/\n# vim /etc/network/interfaces\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet manual\n\niface br0 inet static\naddress 192.168.1.104\nnetwork 192.168.1.0\nnetmask 255.255.255.0\nbroadcast 192.168.1.255\ngateway 192.168.1.1\ndns-nameservers 192.168.1.1 8.8.8.8\nbridge_ports eth0\nbridge_stp off\nauto br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet manual\n\niface br0 inet dhcp\nbridge_ports eth0\nbridge_stp off\nauto br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nFedora\n# service network restart\n\n\n\nUbuntu\n$ sudo ifdown eth0 && sudo ifup eth0\n$ sudo ifup br0\n\u203b\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306fOS \u3054\u3068\u518d\u8d77\u52d5\n\n\n\nbridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306eNetfilter \u3092\u7121\u52b9\u5316\u3059\u308b\nbridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306eNetfilter \u6a5f\u80fd\u3092\u7121\u52b9\u5316\u3059\u308b\u305f\u3081\u306b/etc/sysctl.conf \u30d5\u30a1\u30a4\u30eb\u306b\u6b21\u306e\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nnet.bridge.bridge-nf-call-ip6tables = 0\nnet.bridge.bridge-nf-call-iptables = 0\nnet.bridge.bridge-nf-call-arptables = 0\n\n\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n# sysctl -p\nnet.bridge.bridge-nf-call-ip6tables = 0\nnet.bridge.bridge-nf-call-iptables = 0\nnet.bridge.bridge-nf-call-arptables = 0\n\n\nbridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7121\u52b9\u5316\u3059\u308b\u7406\u7531\u306b\u3064\u3044\u3066\n\u4e0b\u8a18URL \u306b\u82f1\u6587\u3067\u8a18\u8f09\u3042\u308a\u3002\nhttp://www-01.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatkvmsecnetfilter.htm?lang=ja\n\n\n\u629c\u7c8b\nBridged networking and Netfilter\nIt is important to note that, by default, Linux enables Netfilter processing even in bridged traffic.\n\nNetfilter, although allowing the use of iptables to create layer 3 filtering rules, is also seen as a security risk for guest isolation because Netfilter processing sometimes occurs on a global context (without distinction of a source layer 2 port).\nIn practice, with Netfilter processing enabled, an attacker in a compromised guest might mix malicious IP traffic with legitimate ones from other guests.\nThis processing can also result in a minor performance impact.\nTherefore it is recommended that Netfilter processing is disabled.\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b3\u30f3\u30d5\u30a3\u30b0\u306e\u78ba\u8a8d\nifconfig \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nbr0 \u3068eth0 \u304c\u3042\u308a\u307e\u3059\u304c\u3001br0 \u306feth0 \u3068\u3057\u3066\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nbr0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.1.21  netmask 255.255.255.0  broadcast 192.168.1.255\n        inet6 fe80::20c:29ff:fe40:a73f  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:40:a7:3f  txqueuelen 0  (Ethernet)\n        RX packets 2155  bytes 484270 (472.9 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 720  bytes 133865 (130.7 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet6 fe80::20c:29ff:fe40:a73f  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:40:a7:3f  txqueuelen 1000  (Ethernet)\n        RX packets 148888  bytes 104945553 (100.0 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 755  bytes 175031 (170.9 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\uff5e\uff5e\uff5e\n\nbrctl show \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u6b21\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n# brctl show\nbridge name bridge id       STP enabled interfaces\nbr0     8000.000c29dc2afe   no      eth0\nvirbr0      8000.000000000000   yes\n\n\u3053\u308c\u3067\u3001\u30d6\u30ea\u30c3\u30b8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f7f\u7528\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n# \u524d\u306e\u8a18\u4e8b\nKVM \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nhttp://qiita.com/TsutomuNakamura/items/bb5cd1bcbf1b998941ed\n\n# \u30c7\u30d5\u30a9\u30eb\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3064\u3044\u3066 \nKVM \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3068\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3001`virbr0` \u3068\u3044\u3046\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30b2\u30b9\u30c8OS \u304b\u3089\u306e\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9\u901a\u4fe1\u306e\u307f\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```text\n# ifconfig virbr0\nvirbr0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500\n        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255\n        ether a2:37:db:38:ac:89  txqueuelen 0  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\n```\n\n\n\n\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u72b6\u614b\u306e\u4eee\u60f3\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u6b21\u306e\u3088\u3046\u306a\u6761\u4ef6\u3067\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```text\n* KVM \u30db\u30b9\u30c8OS \u304b\u3089\u30b2\u30b9\u30c8OS \u3078\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\n* KVM \u30b2\u30b9\u30c8OS \u304b\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\n```\n\n\u4e0a\u8a18\u306e\u8981\u4ef6\u4ee5\u5916\u306b\u3001\u5916\u90e8\u306e\u30db\u30b9\u30c8\u304b\u3089\u30b2\u30b9\u30c8OS \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u305f\u308a\u3001\u30b2\u30b9\u30c8OS \u306eIP \u30a2\u30c9\u30ec\u30b9\u3092\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u306b\u306f\u3001\u30d6\u30ea\u30c3\u30b8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\u3092\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n# bridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210 \n(\u6ce8)bridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u306fwireless \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7 \nbridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u524d\u306b\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```text:Fedora\n# #\u203b \u30d5\u30a1\u30a4\u30eb\u540d(\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d)\u306f\u4efb\u610f\n# cp /etc/sysconfig/network-scripts/ifcfg-eno16777736 /root\n```\n\n\n\n```text:Ubuntu\n$ sudo cp /etc/network/interfaces /root\n```\n\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a \nbridge \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```text:Fedora\u306e\u5834\u5408\n# cp /etc/sysconfig/network-scripts/ifcfg-eno16777736 /etc/sysconfig/network-scripts/ifcfg-br0\n# mv /etc/sysconfig/network-scripts/ifcfg-eno16777736 /etc/sysconfig/network-scripts/ifcfg-eth0\n# vim /etc/sysconfig/network-scripts/ifcfg-eth0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"ifcfg-eth0\"\nTYPE=\"Ethernet\"\nHWADDR=\"00:0C:29:40:A7:3F\"\nONBOOT=\"yes\"\nNW_CONTROLLED=\"no\"\nBRIDGE=\"br0\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\n# vim /etc/sysconfig/network-scripts/ifcfg-br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"br0\"\nTYPE=\"Bridge\"\nNM_CONTROLLED=\"no\"\nBOOTPROTO=\"static\"\nIPADDR=\"192.168.1.21\"\nNETMASK=\"255.255.255.0\"\nGATEWAY=\"192.168.1.1\"\nONBOOT=\"yes\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nDEVICE=\"br0\"\nTYPE=\"Bridge\"\nNM_CONTROLLED=\"no\"\nBOOTPROTO=\"dhcp\"\nONBOOT=\"yes\"\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n```\n\n\u203b\u4e0a\u8a18\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001eth0 \u3068\u3044\u3046\u540d\u524d\u3067\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u4f5c\u308a\u76f4\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\"ifcfg-eno16777736\" \u3068\u3044\u3046\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u305d\u306e\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u30fb\u30fb\u30fb\n\n\n```text:Ubuntu\u306e\u5834\u5408\n# sudo cp /etc/network/interfaces /root/\n# vim /etc/network/interfaces\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet manual\n\niface br0 inet static\naddress 192.168.1.104\nnetwork 192.168.1.0\nnetmask 255.255.255.0\nbroadcast 192.168.1.255\ngateway 192.168.1.1\ndns-nameservers 192.168.1.1 8.8.8.8\nbridge_ports eth0\nbridge_stp off\nauto br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u304b\u3089 \uff5e\uff5e\uff5e\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet manual\n\niface br0 inet dhcp\nbridge_ports eth0\nbridge_stp off\nauto br0\n\uff5e\uff5e\uff5e \u8a2d\u5b9a(DHCP\u306e\u5834\u5408)\u30fb\u3053\u3053\u307e\u3067 \uff5e\uff5e\uff5e\n```\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```text:Fedora\n# service network restart\n```\n\n\n```text:Ubuntu\n$ sudo ifdown eth0 && sudo ifup eth0\n$ sudo ifup br0\n\u203b\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u5834\u5408\u306fOS \u3054\u3068\u518d\u8d77\u52d5\n```\n\n## bridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306eNetfilter \u3092\u7121\u52b9\u5316\u3059\u308b \nbridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u306eNetfilter \u6a5f\u80fd\u3092\u7121\u52b9\u5316\u3059\u308b\u305f\u3081\u306b`/etc/sysctl.conf` \u30d5\u30a1\u30a4\u30eb\u306b\u6b21\u306e\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```text\nnet.bridge.bridge-nf-call-ip6tables = 0\nnet.bridge.bridge-nf-call-iptables = 0\nnet.bridge.bridge-nf-call-arptables = 0\n```\n\n\n\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n```text\n# sysctl -p\nnet.bridge.bridge-nf-call-ip6tables = 0\nnet.bridge.bridge-nf-call-iptables = 0\nnet.bridge.bridge-nf-call-arptables = 0\n```\n\n\n### bridge \u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u7121\u52b9\u5316\u3059\u308b\u7406\u7531\u306b\u3064\u3044\u3066 \n\u4e0b\u8a18URL \u306b\u82f1\u6587\u3067\u8a18\u8f09\u3042\u308a\u3002\n\n```text\nhttp://www-01.ibm.com/support/knowledgecenter/linuxonibm/liaat/liaatkvmsecnetfilter.htm?lang=ja\n```\n\n```text:\u629c\u7c8b\nBridged networking and Netfilter\nIt is important to note that, by default, Linux enables Netfilter processing even in bridged traffic.\n\nNetfilter, although allowing the use of iptables to create layer 3 filtering rules, is also seen as a security risk for guest isolation because Netfilter processing sometimes occurs on a global context (without distinction of a source layer 2 port).\nIn practice, with Netfilter processing enabled, an attacker in a compromised guest might mix malicious IP traffic with legitimate ones from other guests.\nThis processing can also result in a minor performance impact.\nTherefore it is recommended that Netfilter processing is disabled.\n```\n\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b3\u30f3\u30d5\u30a3\u30b0\u306e\u78ba\u8a8d \n`ifconfig` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n`br0` \u3068`eth0` \u304c\u3042\u308a\u307e\u3059\u304c\u3001br0 \u306feth0 \u3068\u3057\u3066\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text\nbr0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet 192.168.1.21  netmask 255.255.255.0  broadcast 192.168.1.255\n        inet6 fe80::20c:29ff:fe40:a73f  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:40:a7:3f  txqueuelen 0  (Ethernet)\n        RX packets 2155  bytes 484270 (472.9 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 720  bytes 133865 (130.7 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\neth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500\n        inet6 fe80::20c:29ff:fe40:a73f  prefixlen 64  scopeid 0x20<link>\n        ether 00:0c:29:40:a7:3f  txqueuelen 1000  (Ethernet)\n        RX packets 148888  bytes 104945553 (100.0 MiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 755  bytes 175031 (170.9 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\uff5e\uff5e\uff5e\n```\n\n\n`brctl show` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u6b21\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```text\n# brctl show\nbridge name\tbridge id\t\tSTP enabled\tinterfaces\nbr0\t\t8000.000c29dc2afe\tno\t\teth0\nvirbr0\t\t8000.000000000000\tyes\n```\n\n\n\u3053\u308c\u3067\u3001\u30d6\u30ea\u30c3\u30b8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f7f\u7528\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n"}