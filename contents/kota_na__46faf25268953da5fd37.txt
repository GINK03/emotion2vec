{"context": " More than 1 year has passed since last update.\n\n\u521d\u3081\u306b\u3002\n\u4eca\u307e\u3067ALMinium\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001CentOS7\u3067\u30b3\u30de\u30f3\u30c9\u3084\u3089\u30df\u30c9\u30eb\u3084\u3089\u8272\u3005\u5909\u66f4\u3068\u306a\u3063\u305f\u305f\u3081\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u6a21\u69d8\u3002\u3002\u3002\n\u65b0\u3057\u3044\u30e2\u30ce\u597d\u304d\u3068\u3057\u3066\u306f\u3069\u3046\u3057\u3066\u3082CentOS7\u3067\u74b0\u5883\u3092\u6574\u3048\u3066\u307f\u305f\u3044\uff01\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u521d\u3081\u3066Redmine\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u305d\u3057\u3066\u521d\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u3002\u3002\n\u74b0\u5883\nCentOS7 on VirtualBox\nRedmine3.0.2\netc...\n\n\u53c2\u8003\u5143\n\u74b0\u5883\u69cb\u7bc9\u306b\u5f53\u305f\u3063\u3066\u306f\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u3060\u3051\u3067\u3001Redmine\u3001jenkins\u304c\u5229\u7528\u3067\u304d\u3001https\u3060\u3063\u305f\u308a\u3001nginx\u3060\u3063\u305f\u308a\u3068\u3001\u3068\u3066\u3082\u826f\u3044\u611f\u3058\u306e\u74b0\u5883\u304c\u4ed5\u4e0a\u304c\u308a\u307e\u3059\u3002\n\nRedmine\u3092CentOS 7\u4e0a\u3067\u52d5\u304b\u3059\u30fcUnicorn\u3068Nginx\u7de8 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk\n\u30e9\u30d5\u306a\u3072\u3068\u3053\u3068: nginx\u3068Jenkins\u3067 CI \u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b\nRedmine\u3067\u30bb\u30ad\u30e5\u30a2\u306a\u30ed\u30b0\u30a4\u30f3 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk\nnginx \u3067 http \u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8 - Qiita\nRedmine\u3068Subversion\u30fbGit\u30fbMercurial\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\uff08\u3068\u3082\u306b\u540c\u3058CentOS\u30b5\u30fc\u30d0\u4e0a\uff09\u306e\u9023\u643a\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u4f5c\u6210\u3068\u30a2\u30af\u30bb\u30b9\u30fb\u8a8d\u8a3c\uff09 | misty-magic.h\n\n\nSCM\u9023\u643a\u3067\u8e93\u3044\u305f\u8a71(\u672c\u984c)\n\u305b\u3063\u304b\u304f\u4e0a\u8a18\u306e\u30b5\u30a4\u30c8\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3067\u304d\u305f\u306e\u3067\u3059\u304c\u3001SCM\u9023\u643a\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3068\u3001\u8a2d\u5b9a\u753b\u9762\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3084\u3089\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u5f8c\u30a8\u30e9\u30fc\u753b\u9762\u306b\u306a\u308b\u3084\u3089\u3067\u3001\u9023\u643a\u304c\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3002\u3002\n\n1.Redmine\u306e\u300eSCM Creator (+Github)\u300fPlugin\u304c\u4e0a\u624b\u304f\u52d5\u304b\u306a\u3044\uff01\n\u672c\u6765\u306e\u76ee\u7684\u306fRedmine\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a8d\u8a3c\u3067\u3059\u304c\u3001\u3084\u306f\u308a\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u6642\u306b\u52dd\u624b\u306b\u4f5c\u3089\u308c\u3066\u6b32\u3057\u3044\u3067\u3059\u3002\n\u4eca\u56deRedmine3\u3067\u74b0\u5883\u69cb\u7bc9\u3057\u307e\u3057\u305f\u304c\u3001Redmine3\u3067\u306frails4\u3092\u63a1\u7528\u3057\u305f\u305f\u3081\u3001\u6b63\u898f\u8868\u73fe\u306e\u6587\u6cd5\u304c\u5f93\u6765\u3088\u308a\u3082\u53b3\u3057\u304f\u306a\u3063\u3066\u3044\u308b\u3068\u306e\u4e8b\u3002\n\u30ed\u30b0\u3092\u898b\u308b\u3068\u6b63\u898f\u8868\u73fe\u306e\u5f0f\u3092\u4fee\u6b63\u3059\u308b\u304b\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308c\u3070\u826f\u3044\u69d8\u3067\u3059\u304c\u3001\u30ed\u30b0\u304b\u3089\u4fee\u6b63\u7b87\u6240\u3092\u63a2\u305d\u3046\u306b\u3082\u3001java\u611f\u899a\u3067\u898b\u305f\u5834\u5408\u3001\u30a8\u30e9\u30fc\u306e\u5834\u6240\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u611f\u3058\u3067\u306f\u306a\u304f\u3001\u81ea\u529b\u3067\u306e\u4fee\u6b63\u306f\u307b\u307c\u4e0d\u53ef\u80fd\u3067\u3057\u305f\u3002\n\u3053\u308c\u5b9f\u306f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30da\u30fc\u30b8\u306b\u3042\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u306f\u306a\u304f\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308c\u3070\u554f\u984c\u7121\u304f\u52d5\u304d\u307e\u3059\u3002\n\u3069\u3046\u3084\u3089rev.141\u3067redmine3.x\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u305f\u3088\u3046\u3067\u3059\u3002\nsvn export -r 142 http://subversion.andriylesyuk.com/scm-creator redmine_scm\n\n\n2.Redmine\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a8d\u8a3c\u304c\u4e0a\u624b\u304f\u51fa\u6765\u306a\u3044\uff01\n\u3053\u308c\u306fmod_perl\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u306a\u304f\u306a\u3063\u3066\u3044\u305f\u70b9\u3068\u3001\u8a8d\u8a3c\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u70b9\u3067\u8e93\u304d\u307e\u3057\u305f\u3002\nmod_perl\u306b\u3064\u3044\u3066\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u306a\u3044\u65b9\u6cd5\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3069\u3046\u3084\u3089epel\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3068yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n# yum install epel-release\n# yum install mod_perl per\n\n\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306b\u3064\u3044\u3066\u306f\u3001AuthUserFile\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u3002Redmine\u306eDB\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u8a18\u8f09\u306e\u7121\u3044\u3068\u3053\u308d\u304c\u591a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u5fc5\u8981\u3067\u3057\u305f\u3002\n# Subversion\n<Location /repos/svn>\n  DAV svn\n  SVNParentPath \"/var/www/repos/svn\"\n\n  AuthType Basic\n  AuthName \"Redmine SVN Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n\n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n\n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"password\"\n</Location>\n\n\n\u69cb\u7bc9\u624b\u9806(\u304a\u307e\u3051)\n\u6700\u5f8c\u306b\u81ea\u5206\u304c\u5b9f\u65bd\u3057\u305f\u624b\u9806\u3092\u30e1\u30e2\u7a0b\u5ea6\u306b\u4e57\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u8a73\u7d30\u306a\u8aac\u660e\u306f\u53c2\u8003\u5143\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nVirtualBox\u7528\nVirtualBox GuestAdditions\u53ca\u3073\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u9808\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6e08\u307f\n# yum install -y gcc make kernel-headers kernel-devel bzip2\n# yum update kernel*\n\n\nMariaDB\nMariaDB\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n# yum groupinstall \"Development Tools\"\n# yum install openssl-devel readline-devel zlib-devel curl-devel libyaml-devel ImageMagick ImageMagick-devel\n# yum install mariadb-server mariadb-devel\n\n\n/etc/my.cnf.d/server.cnf\n[mysqld]\n+   character-set-server = utf8\n\n\n\n/etc/my.cnf.d/mysql-clients.cnf\n[mysql]\n+   default-character-set = utf8\n+   show-warnings\n\n\nMariaDB\u306e\u8d77\u52d5\u30fb\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n# systemctl start mariadb.service\n# systemctl enable mariadb.service\n\nMariaDB\u306e\u30e6\u30fc\u30b6\u8a2d\u5b9a\n# mysql -uroot \u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u6e08\u307f\u306e\u5834\u5408\u306f# mysql -uroot -p\nMariaDB [(none)]> SELECT user,host,password FROM mysql.user;\n+---------+-----------------------+----------+\n| user    | host                  | password |\n+---------+-----------------------+----------+\n| root    | localhost             |          |\n| root    | localhost.localdomain |          |\n| root    | 127.0.0.1             |          |\n| root    | ::1                   |          |\n|         | localhost             |          |\n|         | localhost.localdomain |          |\n+---------+-----------------------+----------+\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'localhost.localdomain' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'127.0.0.1' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'::1' = PASSWORD('password');\nMariaDB [(none)]> SELECT user,host,password FROM mysql.user;\nMariaDB [(none)]> quit;\n\n\nRedmine\nRedmine\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n# yum install ruby ruby-devel\n\nRedmine\u516c\u5f0f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30da\u30fc\u30b8\u3088\u308aRedmine\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002(\u4eca\u56de\u306f3.0.2)\n# wget http://www.redmine.org/releases/redmine-3.0.2.tar.gz\n# cd /var/lib\n# tar zxf ~/redmine-3.0.2.tar.gz\n# ln -s redmine-3.0.2/ redmine\n\nRedmine\u306eMariaDB\u63a5\u7d9a\u8a2d\u5b9a\n\n/var/lib/redmine/config/database.yml\nproduction:\n  adapter: mysql2\n  database: redmine\n  host: localhost\n  username: redmine\n  password: password\n  encoding: utf8\n\n\n# chmod 600 /var/lib/redmine/config/database.yml\n\nMariaDB\u306eRedmine\u63a5\u7d9a\u8a2d\u5b9a\n# mysql -uroot -p\nMariaDB [(none)]> CREATE DATABASE redmine;\nMariaDB [(none)]> SHOW DATABASES;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| redmine            |\n| test               |\n+--------------------+\nMariaDB [(none)]> GRANT ALL ON redmine.* TO 'redmine'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;\nMariaDB [(none)]> quit;\n\nRedmine\u306e\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a\n\n/var/lib/redmine/config/configuration.yml\nproduction:\n  email_delivery:\n    delivery_method: :smtp\n    smtp_settings:\n      address: \"localhost\" \n      port: 25\n\n\n# chmod 600 /var/lib/redmine/config/configuration.yml\n# useradd redmine\n# passwd redmine\n# cd /var/lib/redmine\n# chown -R redmine.redmine .\n\nRuby\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n# gem list\n# gem install bundler --no-rdoc --no-ri\n# su redmine\n$ cd /var/lib/redmine\n$ bundle install --path vendor/bundler --without development test\n\nRedmine\u306e\u521d\u671f\u8a2d\u5b9a\n$ bundle exec rake generate_secret_token\n$ bundle exec rake db:migrate RAILS_ENV=production\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002script/rails\u306f\u4f7f\u7528\u51fa\u6765\u306a\u3044\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u306e\u3067\n$ ruby bin/rails server webrick -e production\n\n\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u30a2\u30c9\u30ec\u30b9\u3067Listen\u3057\u3066\u3044\u308b\u6319\u52d5\u306a\u306e\u3067\u3001# wget http://127.0.0.1:3000\u7b49\u3067\u52d5\u3044\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3001Ctrl + C\u3067\u7d42\u4e86\u3002\nUnicorn\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n/var/lib/redmine/Gemfile.local\ngem \"unicorn\"\n\n\n$ bundle update\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002\u4ee5\u4e0b\u3092\u5b9f\u884c\u5f8c\u3001\u4ed6\u30de\u30b7\u30f3\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089http://IP\u30a2\u30c9\u30ec\u30b9:3000/\u306b\u30a2\u30af\u30bb\u30b9\u3002Ctrl + C\u3067\u7d42\u4e86\u3002\n$ su\n# firewall-cmd --add-port=3000/tcp\n# su redmine\n$ bundle exec unicorn_rails -l 3000 -E production\n\nunicorn\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u53c2\u8003\u5143\uff1aRedmine\u3092CentOS 6\u4e0a\u3067\u52d5\u304b\u3059\u30fcUnicorn\u3068Nginx\u7de8 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n$ su\n# cd /var/lib/redmine/config/\n# wget http://www.torutk.com/attachments/download/299/unicorn.rb\n# chown redmine.redmine unicorn.rb\n\n\u76f8\u5bfe\u30d1\u30b9\u3067\u306f\u52d5\u304b\u306a\u3044\u306e\u3067\u7d76\u5bfe\u30d1\u30b9\u3067\u6307\u5b9a\n\n/var/lib/redmine/config/unicorn.rb\n-   listen \"/tmp/unicorn_redmine.sock\", :backlog => 32\n+   listen \"/var/lib/redmine/tmp/sockets/unicorn.sock\", :backlog => 32\n\n\n\n/etc/systemd/system/redmine-unicorn.service\n[Unit]\nDescription=Redmine Unicorn Server\n\n[Service]\nWorkingDirectory=/var/lib/redmine\nEnvironment=RAILS_ENV=production\nSyslogIdentifier=redmine-unicorn\nPIDFile=/var/lib/redmine/tmp/pids/unicorn.pid\n\nExecStart=/usr/local/bin/bundle exec \"unicorn_rails -c config/unicorn.rb -E production\" \nExecStop=/usr/bin/kill -QUIT $MAINPID\nExecReload=/bin/kill -USR2 $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002\u4ee5\u4e0b\u3092\u5b9f\u884c\u5f8c\u3001\u4ed6\u30de\u30b7\u30f3\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089http://IP\u30a2\u30c9\u30ec\u30b9:8282/\u306b\u30a2\u30af\u30bb\u30b9\u3002\n# systemctl start redmine-unicorn.service\n# systemctl status redmine-unicorn.service\n# firewall-cmd --add-port=8282/tcp\n\nunicorn\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n# systemctl enable redmine-unicorn.service\n\n\nnginx\nnginx\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n/etc/yum.repos.d/nginx.repo\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n\n\n# yum install nginx\n\nRedmine\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n# cd /etc/nginx/conf.d\n# mv default.conf default.conf.orig\n\n\n/etc/nginx/conf.d/redmine.conf\nupstream unicorn-redmine {\n    server unix:/var/lib/redmine/tmp/sockets/unicorn.sock;\n}\n\nserver {\n    listen 80;\n    server_name _;\n\n    root /var/lib/redmine/public;\n    client_max_body_size 1G;\n\n    location / {\n        try_files $uri/index.html $uri.html $uri @app;\n    }\n\n    location @app {\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_connect_timeout 60;\n        proxy_read_timeout 60;\n        proxy_send_timeout 600;\n        proxy_pass http://unicorn-redmine;\n    }\n\n    error_page 500 502 503 504 /500.html;\n}\n\n\nnginx\u306e\u8d77\u52d5\n# restorecon redmine.conf\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# firewall-cmd --add-service http --zone=public --permanent\n# firewall-cmd --reload\n# systemctl enable nginx.service\n# systemctl start nginx.service\n\nSELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n# cd ~\n# cat /var/log/audit/audit.log | grep nginx | audit2allow\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n# systemctl start nginx.service\n\nRedmine\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067Redminehttp://IP\u30a2\u30c9\u30ec\u30b9/\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n2\u56de\u3050\u3089\u3044\u7e70\u308a\u8fd4\u3059\u3068\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u308b\u3002(\u7e70\u308a\u8fd4\u3059\u5ea6\u306b\u30d6\u30e9\u30a6\u30b6\u3067Internal error\u3092\u8868\u793a\u3055\u305b\u306a\u3044\u3068\u8a2d\u5b9a\u51fa\u6765\u307e\u305b\u3093\u3002)\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n# systemctl restart redmine-unicorn.service\n# systemctl restart nginx.service\n\n\njenkins\njava\u3068jenkins\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n# yum install java\n# cd /etc/yum.repos.d\n# curl -O http://pkg.jenkins-ci.org/redhat/jenkins.repo\n# rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key\n# yum install --enablerepo=jenkins jenkins\n\n\n/etc/sysconfig/jenkins\n#\n# Options to pass to java when running Jenkins.\n#\n-   JENKINS_JAVA_OPTIONS=\"-Djava.awt.headless=true\"\n+   JENKINS_JAVA_OPTIONS=\"-Djava.awt.headless=true -Dhudson.util.ProcessTree.disable=true -Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Tokyo\"\n\n#\n# Port Jenkins is listening on.\n# Set to -1 to disable\n#\nJENKINS_PORT=\"8080\"\n\n#\n# Pass arbitrary arguments to Jenkins.\n# Full option list: java -jar jenkins.war --help\n#\n-   JENKINS_ARGS=\"\"\n+   JENKINS_ARGS=\"--prefix=/jenkins\"\n\n\njenkins\u306e\u8d77\u52d5\u30fb\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n# systemctl start jenkins.service\n# chkconfig jenkins on\n\nnginx\u306ejenkins\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u30fb\u8ee2\u9001\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n/etc/nginx/conf.d/jenkins.conf\nupstream jenkins_server {\n    server 127.0.0.1:8080 fail_timeout=0;\n}\n\n\n\n/etc/nginx/conf.d/redmine.conf\n+       location ~ /jenkins {\n+           proxy_redirect     off;\n+           proxy_set_header   X-Forwarded-Proto $scheme;\n+           proxy_set_header   Host              $http_host;\n+           proxy_set_header   X-Real-IP         $remote_addr;\n+           proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n+           proxy_set_header   Host $host;\n+   \n+           proxy_pass         http://jenkins_server;\n+       }\n\n\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n# systemctl status nginx.service\n\nnginx\u3068\u540c\u69d8\u306b\u3001SELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067jenkinshttp://IP\u30a2\u30c9\u30ec\u30b9/jenkins/\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n\n\nhttps\u5316\n\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\n# openssl req -new -newkey rsa:2048 -sha1 -x509 -nodes -set_serial 1 -days 10950 -subj \"/C=JP/ST=Tokyo/CN=www.example.com\" -out /etc/pki/tls/certs/www.example.com.crt -keyout /etc/pki/tls/private/www.example.com.key\n# cd /etc/nginx/conf.d/\n# mv /etc/nginx/conf.d/redmine.conf /etc/nginx/conf.d/redmine_SSL.conf\n\nnginx\u306e\u8a2d\u5b9a\n\n/etc/nginx/conf.d/redmine_SSL.conf\nserver {\n-       listen 80;\n+       listen 443;\n        server_name _;\n\n+       ssl on;\n+       ssl_certificate /etc/pki/tls/certs/www.example.com.crt;\n+       ssl_certificate_key /etc/pki/tls/private/www.example.com.key;\n+   #    ssl_session_timeout 5m;\n+   #    ssl_protocols SSLv2 SSLv3 TLSv1;\n+   #    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\n+   #    ssl_prefer_server_ciphers on;\n\n\n\n/etc/nginx/conf.d/http.conf\nserver {\n    listen 80;\n    server_name example.com;\n    return 301 https://$host$request_uri;\n}\n\n\nfirewall\u306e\u8a2d\u5b9a\n# firewall-cmd --list-services --zone=public\n# firewall-cmd --add-service https --zone=public --permanent\n# firewall-cmd --reload\n# firewall-cmd --list-services --zone=public\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n# systemctl status nginx.service\n\nhttp\u3067\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306f\u81ea\u52d5\u3067https\u306b\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002\n\nSCM\u9023\u643a\n\u30ea\u30dd\u30b8\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u7528\u306bapache\u306e\u5c0e\u5165\u30fb\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5c0e\u5165\n# yum install httpd\n# yum install epel-release\n# yum install mod_perl perl-DBI perl-Digest-SHA1 perl-Digest-SHA perl-DBD-MySQL mod_dav_svn\n\nRedmine\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n# mkdir -p /var/www/repos/{svn,git,hg}\n# chown -R redmine:redmine /var/www/repos\n# cd ~\n# svn export -r 142 http://subversion.andriylesyuk.com/scm-creator redmine_scm\n# mv redmine_scm /var/lib/redmine/plugins/\n\n\n/var/lib/redmine/config/scm.yml\nproduction:\n  deny_delete: false\n  auto_create: true\n  svn:\n    path: /var/www/repos/svn\n    svnadmin: /usr/bin/svnadmin\n    url: https://www.example.com/repos/svn\n  git:\n    path: /var/www/repos/git\n    git: /usr/bin/git\n    options: --bare\n    url: https://www.example.com/repos/git\n    update_server_info: true\n    git_ext: true\n  mercurial:\n    path: /var/www/repos/hg\n    hg: /usr/bin/hg\n    url: https://www.example.com/repos/hg\ndevelopment:\n\n\n\n/var/lib/redmine/Gemfile.local\n+   gem \"rails-observers\"\n\n\n# cd /var/lib/redmine\n# bundle update\n# bundle exec rake db:migrate:plugin RAILS_ENV=production\n# bundle exec rake tmp:cache:clear\n# bundle exec rake tmp:sessions:clear\n# systemctl restart nginx.service\n# systemctl restart redmine-unicorn.service\n\nnginx\u306e\u8a2d\u5b9a\n\n/etc/nginx/conf.d/apache.conf\nupstream apache_server {\n    server 127.0.0.1:8086 fail_timeout=0;\n}\n\n\n\n/etc/nginx/conf.d/redmine_SSL.conf\n+       location ~ /repos/ {\n+           proxy_redirect     off;\n+           proxy_set_header   X-Forwarded-Proto $scheme;\n+           proxy_set_header   Host              $http_host;\n+           proxy_set_header   X-Real-IP         $remote_addr;\n+           proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n+           proxy_set_header   Host $host;\n\n+           proxy_pass         http://apache_server$request_uri;\n+       }\n\n\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u8a8d\u8a3c\u7528\u306e\u8a2d\u5b9a\n# mkdir -p /usr/lib64/perl5/vendor_perl/Apache/Authn\n# ln -s /var/lib/redmine/extra/svn/Redmine.pm /usr/lib64/perl5/vendor_perl/Apache/Authn/Redmine.pm\n\n\n/etc/httpd/conf/httpd.conf\n-   Listen 80\n+   Listen 8086\n\n-   User apache\n-   Group apache\n+   User redmine\n+   Group redmine\n\n\n\n/etc/httpd/conf.d/redmine.conf\nLoadModule dav_svn_module     modules/mod_dav_svn.so\nLoadModule authz_svn_module   modules/mod_authz_svn.so\n\nPerlLoadModule Apache::Authn::Redmine\n\n# Subversion\n<Location /repos/svn>\n  DAV svn\n  SVNAdvertiseV2Protocol Off\n  SVNParentPath \"/var/www/repos/svn\"\n\n  AuthType Basic\n  AuthName \"Redmine SVN Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n\n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n\n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"password\"\n</Location>\n\n# Git\nSetEnv GIT_PROJECT_ROOT /var/www/repos/git\nSetEnv GIT_HTTP_EXPORT_ALL\nScriptAlias /repos/git/ /usr/libexec/git-core/git-http-backend/\n<Location /repos/git>\n  AuthType Basic\n  AuthName \"Redmine Git Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n\n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n\n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"pasword\"\n  RedmineGitSmartHttp yes\n</Location>\n\n\nnginx\u3001jenkins\u3068\u540c\u69d8\u306b\u3001SELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n# service httpd start\n# cat /var/log/audit/audit.log | grep httpd | audit2allow -m httpd\n# grep httpd /var/log/audit/audit.log | audit2allow -M httpd\n# semodule -i httpd.pp\n# service httpd start\n# chkconfig httpd on\n\napache\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u53c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30eahttp://IP\u30a2\u30c9\u30ec\u30b9/repos\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u3044\u3063\u305f\u8868\u793a\u304c\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n\napache\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\nRedmine\u306b\u521d\u671f\u7ba1\u7406\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u7ba1\u7406\u30da\u30fc\u30b8\u304b\u3089\u8a2d\u5b9a\u3092\u30ed\u30fc\u30c9\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u753b\u9762\u3067SCM\u3067svn\u3092\u9078\u629e\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u521d\u671f\u7ba1\u7406\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u30d6\u30e9\u30a6\u30b6\u53c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30eahttp://IP\u30a2\u30c9\u30ec\u30b9/repos/svn/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/\u306b\u30a2\u30af\u30bb\u30b9\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u3001Could not open the requested SVN filesystem\u3068\u8868\u793a\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n# cat /var/log/audit/audit.log | grep httpd | audit2allow -m httpd\n# grep httpd /var/log/audit/audit.log | audit2allow -M httpd\n# semodule -i httpd.pp\n\n#\u521d\u3081\u306b\u3002\n\u4eca\u307e\u3067ALMinium\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001CentOS7\u3067\u30b3\u30de\u30f3\u30c9\u3084\u3089\u30df\u30c9\u30eb\u3084\u3089\u8272\u3005\u5909\u66f4\u3068\u306a\u3063\u305f\u305f\u3081\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u6a21\u69d8\u3002\u3002\u3002\n\u65b0\u3057\u3044\u30e2\u30ce\u597d\u304d\u3068\u3057\u3066\u306f\u3069\u3046\u3057\u3066\u3082CentOS7\u3067\u74b0\u5883\u3092\u6574\u3048\u3066\u307f\u305f\u3044\uff01\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u521d\u3081\u3066Redmine\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n<font color=\"e0e0e0\">\u305d\u3057\u3066\u521d\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u3002\u3002</font>\n\n**\u74b0\u5883**\nCentOS7 on VirtualBox\nRedmine3.0.2\netc...\n\n##\u53c2\u8003\u5143\n\u74b0\u5883\u69cb\u7bc9\u306b\u5f53\u305f\u3063\u3066\u306f\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u308c\u3060\u3051\u3067\u3001Redmine\u3001jenkins\u304c\u5229\u7528\u3067\u304d\u3001https\u3060\u3063\u305f\u308a\u3001nginx\u3060\u3063\u305f\u308a\u3068\u3001\u3068\u3066\u3082\u826f\u3044\u611f\u3058\u306e\u74b0\u5883\u304c\u4ed5\u4e0a\u304c\u308a\u307e\u3059\u3002\n\n* [Redmine\u3092CentOS 7\u4e0a\u3067\u52d5\u304b\u3059\u30fcUnicorn\u3068Nginx\u7de8 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk](http://www.torutk.com/projects/swe/wiki/Redmine%E3%82%92CentOS_7%E4%B8%8A%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99%E3%83%BCUnicorn%E3%81%A8Nginx%E7%B7%A8)\n* [\u30e9\u30d5\u306a\u3072\u3068\u3053\u3068: nginx\u3068Jenkins\u3067 CI \u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b](http://rough-and-ready-co-jp.blogspot.jp/2015/04/nginxjenkins-ci.html)\n* [Redmine\u3067\u30bb\u30ad\u30e5\u30a2\u306a\u30ed\u30b0\u30a4\u30f3 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk](http://www.torutk.com/projects/swe/wiki/Redmine%E3%81%A7%E3%82%BB%E3%82%AD%E3%83%A5%E3%82%A2%E3%81%AA%E3%83%AD%E3%82%B0%E3%82%A4%E3%83%B3)\n* [nginx \u3067 http \u3067\u306e\u30a2\u30af\u30bb\u30b9\u3092 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8 - Qiita](http://qiita.com/kga/items/e30d668ec1ac5e30025b)\n* [Redmine\u3068Subversion\u30fbGit\u30fbMercurial\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\uff08\u3068\u3082\u306b\u540c\u3058CentOS\u30b5\u30fc\u30d0\u4e0a\uff09\u306e\u9023\u643a\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u4f5c\u6210\u3068\u30a2\u30af\u30bb\u30b9\u30fb\u8a8d\u8a3c\uff09 | misty-magic.h](https://mistymagich.wordpress.com/2011/10/19/redmine_and_subversion-git-mercurial-repository/)\n\n#SCM\u9023\u643a\u3067\u8e93\u3044\u305f\u8a71(\u672c\u984c)\n\n\u305b\u3063\u304b\u304f\u4e0a\u8a18\u306e\u30b5\u30a4\u30c8\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3067\u304d\u305f\u306e\u3067\u3059\u304c\u3001SCM\u9023\u643a\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3068\u3001\u8a2d\u5b9a\u753b\u9762\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3084\u3089\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u5f8c\u30a8\u30e9\u30fc\u753b\u9762\u306b\u306a\u308b\u3084\u3089\u3067\u3001\u9023\u643a\u304c\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3002\u3002\n\n\n##1.Redmine\u306e\u300e[SCM Creator (+Github)](http://www.redmine.org/plugins/redmine_scm)\u300fPlugin\u304c\u4e0a\u624b\u304f\u52d5\u304b\u306a\u3044\uff01\n\u672c\u6765\u306e\u76ee\u7684\u306fRedmine\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a8d\u8a3c\u3067\u3059\u304c\u3001\u3084\u306f\u308a\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u6642\u306b\u52dd\u624b\u306b\u4f5c\u3089\u308c\u3066\u6b32\u3057\u3044\u3067\u3059\u3002\n\u4eca\u56deRedmine3\u3067\u74b0\u5883\u69cb\u7bc9\u3057\u307e\u3057\u305f\u304c\u3001Redmine3\u3067\u306frails4\u3092\u63a1\u7528\u3057\u305f\u305f\u3081\u3001\u6b63\u898f\u8868\u73fe\u306e\u6587\u6cd5\u304c\u5f93\u6765\u3088\u308a\u3082\u53b3\u3057\u304f\u306a\u3063\u3066\u3044\u308b\u3068\u306e\u4e8b\u3002\n\u30ed\u30b0\u3092\u898b\u308b\u3068\u6b63\u898f\u8868\u73fe\u306e\u5f0f\u3092\u4fee\u6b63\u3059\u308b\u304b\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308c\u3070\u826f\u3044\u69d8\u3067\u3059\u304c\u3001\u30ed\u30b0\u304b\u3089\u4fee\u6b63\u7b87\u6240\u3092\u63a2\u305d\u3046\u306b\u3082\u3001java\u611f\u899a\u3067\u898b\u305f\u5834\u5408\u3001\u30a8\u30e9\u30fc\u306e\u5834\u6240\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u611f\u3058\u3067\u306f\u306a\u304f\u3001\u81ea\u529b\u3067\u306e\u4fee\u6b63\u306f\u307b\u307c\u4e0d\u53ef\u80fd\u3067\u3057\u305f\u3002\n\n\u3053\u308c\u5b9f\u306f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30da\u30fc\u30b8\u306b\u3042\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u306f\u306a\u304f\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308c\u3070\u554f\u984c\u7121\u304f\u52d5\u304d\u307e\u3059\u3002\n\u3069\u3046\u3084\u3089rev.141\u3067redmine3.x\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u305f\u3088\u3046\u3067\u3059\u3002\n\n```\nsvn export -r 142 http://subversion.andriylesyuk.com/scm-creator redmine_scm\n```\n\n##2.Redmine\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8a8d\u8a3c\u304c\u4e0a\u624b\u304f\u51fa\u6765\u306a\u3044\uff01\n\u3053\u308c\u306fmod_perl\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u306a\u304f\u306a\u3063\u3066\u3044\u305f\u70b9\u3068\u3001\u8a8d\u8a3c\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u70b9\u3067\u8e93\u304d\u307e\u3057\u305f\u3002\nmod_perl\u306b\u3064\u3044\u3066\u306f\u3053\u308c\u3092\u5229\u7528\u3057\u306a\u3044\u65b9\u6cd5\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u4e0a\u624b\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3069\u3046\u3084\u3089epel\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3068yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\n# yum install epel-release\n# yum install mod_perl per\n```\n\n\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306b\u3064\u3044\u3066\u306f\u3001AuthUserFile\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u3002Redmine\u306eDB\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u8a18\u8f09\u306e\u7121\u3044\u3068\u3053\u308d\u304c\u591a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u5fc5\u8981\u3067\u3057\u305f\u3002\n\n```text:\n# Subversion\n<Location /repos/svn>\n  DAV svn\n  SVNParentPath \"/var/www/repos/svn\"\n\n  AuthType Basic\n  AuthName \"Redmine SVN Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n\n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n\n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"password\"\n</Location>\n```\n\n#\u69cb\u7bc9\u624b\u9806(\u304a\u307e\u3051)\n\u6700\u5f8c\u306b\u81ea\u5206\u304c\u5b9f\u65bd\u3057\u305f\u624b\u9806\u3092\u30e1\u30e2\u7a0b\u5ea6\u306b\u4e57\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u8a73\u7d30\u306a\u8aac\u660e\u306f\u53c2\u8003\u5143\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## VirtualBox\u7528\nVirtualBox GuestAdditions\u53ca\u3073\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u5fc5\u9808\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u6e08\u307f\n\n```\n# yum install -y gcc make kernel-headers kernel-devel bzip2\n# yum update kernel*\n```\n\n##MariaDB\nMariaDB\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```\n# yum groupinstall \"Development Tools\"\n# yum install openssl-devel readline-devel zlib-devel curl-devel libyaml-devel ImageMagick ImageMagick-devel\n# yum install mariadb-server mariadb-devel\n```\n\n```diff:/etc/my.cnf.d/server.cnf\n[mysqld]\n+   character-set-server = utf8\n```\n\n```diff:/etc/my.cnf.d/mysql-clients.cnf\n[mysql]\n+   default-character-set = utf8\n+   show-warnings\n```\n\nMariaDB\u306e\u8d77\u52d5\u30fb\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n```\n# systemctl start mariadb.service\n# systemctl enable mariadb.service\n```\n\nMariaDB\u306e\u30e6\u30fc\u30b6\u8a2d\u5b9a\n```# mysql -uroot``` \u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u6e08\u307f\u306e\u5834\u5408\u306f```# mysql -uroot -p```\n\n```\nMariaDB [(none)]> SELECT user,host,password FROM mysql.user;\n+---------+-----------------------+----------+\n| user    | host                  | password |\n+---------+-----------------------+----------+\n| root    | localhost             |          |\n| root    | localhost.localdomain |          |\n| root    | 127.0.0.1             |          |\n| root    | ::1                   |          |\n|         | localhost             |          |\n|         | localhost.localdomain |          |\n+---------+-----------------------+----------+\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'localhost' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'localhost.localdomain' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'127.0.0.1' = PASSWORD('password');\nMariaDB [(none)]> SET PASSWORD FOR 'root'@'::1' = PASSWORD('password');\nMariaDB [(none)]> SELECT user,host,password FROM mysql.user;\nMariaDB [(none)]> quit;\n```\n\n##Redmine\nRedmine\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```\n# yum install ruby ruby-devel\n```\n\n[Redmine\u516c\u5f0f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30da\u30fc\u30b8](http://www.redmine.org/projects/redmine/wiki/Download \"Download - Redmine\")\u3088\u308aRedmine\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002(\u4eca\u56de\u306f3.0.2)\n\n```\n# wget http://www.redmine.org/releases/redmine-3.0.2.tar.gz\n# cd /var/lib\n# tar zxf ~/redmine-3.0.2.tar.gz\n# ln -s redmine-3.0.2/ redmine\n```\n\nRedmine\u306eMariaDB\u63a5\u7d9a\u8a2d\u5b9a\n\n```diff:/var/lib/redmine/config/database.yml\nproduction:\n  adapter: mysql2\n  database: redmine\n  host: localhost\n  username: redmine\n  password: password\n  encoding: utf8\n```\n\n```\n# chmod 600 /var/lib/redmine/config/database.yml\n```\n\nMariaDB\u306eRedmine\u63a5\u7d9a\u8a2d\u5b9a\n\n```\n# mysql -uroot -p\nMariaDB [(none)]> CREATE DATABASE redmine;\nMariaDB [(none)]> SHOW DATABASES;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| redmine            |\n| test               |\n+--------------------+\nMariaDB [(none)]> GRANT ALL ON redmine.* TO 'redmine'@'localhost' IDENTIFIED BY 'password' WITH GRANT OPTION;\nMariaDB [(none)]> quit;\n```\n\nRedmine\u306e\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a\n\n```diff:/var/lib/redmine/config/configuration.yml\nproduction:\n  email_delivery:\n    delivery_method: :smtp\n    smtp_settings:\n      address: \"localhost\" \n      port: 25\n```\n\n```\n# chmod 600 /var/lib/redmine/config/configuration.yml\n# useradd redmine\n# passwd redmine\n# cd /var/lib/redmine\n# chown -R redmine.redmine .\n```\n\nRuby\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```\n# gem list\n# gem install bundler --no-rdoc --no-ri\n# su redmine\n$ cd /var/lib/redmine\n$ bundle install --path vendor/bundler --without development test\n```\n\nRedmine\u306e\u521d\u671f\u8a2d\u5b9a\n\n```\n$ bundle exec rake generate_secret_token\n$ bundle exec rake db:migrate RAILS_ENV=production\n```\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002script/rails\u306f\u4f7f\u7528\u51fa\u6765\u306a\u3044\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u308b\u306e\u3067\n\n```\n$ ruby bin/rails server webrick -e production\n```\n\n\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u30a2\u30c9\u30ec\u30b9\u3067Listen\u3057\u3066\u3044\u308b\u6319\u52d5\u306a\u306e\u3067\u3001```# wget http://127.0.0.1:3000```\u7b49\u3067\u52d5\u3044\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3001```Ctrl + C```\u3067\u7d42\u4e86\u3002\n\nUnicorn\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```text:/var/lib/redmine/Gemfile.local\ngem \"unicorn\"\n```\n\n```\n$ bundle update\n```\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002\u4ee5\u4e0b\u3092\u5b9f\u884c\u5f8c\u3001\u4ed6\u30de\u30b7\u30f3\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089```http://IP\u30a2\u30c9\u30ec\u30b9:3000/```\u306b\u30a2\u30af\u30bb\u30b9\u3002```Ctrl + C```\u3067\u7d42\u4e86\u3002\n\n```\n$ su\n# firewall-cmd --add-port=3000/tcp\n# su redmine\n$ bundle exec unicorn_rails -l 3000 -E production\n```\n\nunicorn\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u53c2\u8003\u5143\uff1a[Redmine\u3092CentOS 6\u4e0a\u3067\u52d5\u304b\u3059\u30fcUnicorn\u3068Nginx\u7de8 - \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 - Torutk](http://www.torutk.com/projects/swe/wiki/Redmine%E3%82%92CentOS_6%E4%B8%8A%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99%E3%83%BCUnicorn%E3%81%A8Nginx%E7%B7%A8#Unicorn%E3%81%AE%E8%A8%AD%E5%AE%9A) \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n```\n$ su\n# cd /var/lib/redmine/config/\n# wget http://www.torutk.com/attachments/download/299/unicorn.rb\n# chown redmine.redmine unicorn.rb\n```\n\n\u76f8\u5bfe\u30d1\u30b9\u3067\u306f\u52d5\u304b\u306a\u3044\u306e\u3067\u7d76\u5bfe\u30d1\u30b9\u3067\u6307\u5b9a\n\n```diff:/var/lib/redmine/config/unicorn.rb\n-   listen \"/tmp/unicorn_redmine.sock\", :backlog => 32\n+   listen \"/var/lib/redmine/tmp/sockets/unicorn.sock\", :backlog => 32\n```\n\n```text:/etc/systemd/system/redmine-unicorn.service\n[Unit]\nDescription=Redmine Unicorn Server\n\n[Service]\nWorkingDirectory=/var/lib/redmine\nEnvironment=RAILS_ENV=production\nSyslogIdentifier=redmine-unicorn\nPIDFile=/var/lib/redmine/tmp/pids/unicorn.pid\n\nExecStart=/usr/local/bin/bundle exec \"unicorn_rails -c config/unicorn.rb -E production\" \nExecStop=/usr/bin/kill -QUIT $MAINPID\nExecReload=/bin/kill -USR2 $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n```\n\nRedmine\u306e\u8d77\u52d5\u78ba\u8a8d\u3002\u4ee5\u4e0b\u3092\u5b9f\u884c\u5f8c\u3001\u4ed6\u30de\u30b7\u30f3\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089```http://IP\u30a2\u30c9\u30ec\u30b9:8282/```\u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n```\n# systemctl start redmine-unicorn.service\n# systemctl status redmine-unicorn.service\n# firewall-cmd --add-port=8282/tcp\n```\n\nunicorn\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n```\n# systemctl enable redmine-unicorn.service\n```\n\n#nginx\n\nnginx\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```text:/etc/yum.repos.d/nginx.repo\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=1\n```\n\n```\n# yum install nginx\n```\n\nRedmine\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```\n# cd /etc/nginx/conf.d\n# mv default.conf default.conf.orig\n```\n\n```text:/etc/nginx/conf.d/redmine.conf\nupstream unicorn-redmine {\n    server unix:/var/lib/redmine/tmp/sockets/unicorn.sock;\n}\n\nserver {\n    listen 80;\n    server_name _;\n\n    root /var/lib/redmine/public;\n    client_max_body_size 1G;\n\n    location / {\n        try_files $uri/index.html $uri.html $uri @app;\n    }\n\n    location @app {\n        proxy_redirect off;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header Host $http_host;\n        proxy_connect_timeout 60;\n        proxy_read_timeout 60;\n        proxy_send_timeout 600;\n        proxy_pass http://unicorn-redmine;\n    }\n\n    error_page 500 502 503 504 /500.html;\n}\n```\n\nnginx\u306e\u8d77\u52d5\n\n```\n# restorecon redmine.conf\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# firewall-cmd --add-service http --zone=public --permanent\n# firewall-cmd --reload\n# systemctl enable nginx.service\n# systemctl start nginx.service\n```\n\nSELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\n```\n# cd ~\n# cat /var/log/audit/audit.log | grep nginx | audit2allow\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n# systemctl start nginx.service\n```\n\nRedmine\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067Redmine```http://IP\u30a2\u30c9\u30ec\u30b9/```\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n2\u56de\u3050\u3089\u3044\u7e70\u308a\u8fd4\u3059\u3068\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u308b\u3002(\u7e70\u308a\u8fd4\u3059\u5ea6\u306b\u30d6\u30e9\u30a6\u30b6\u3067Internal error\u3092\u8868\u793a\u3055\u305b\u306a\u3044\u3068\u8a2d\u5b9a\u51fa\u6765\u307e\u305b\u3093\u3002)\n\n```\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n# systemctl restart redmine-unicorn.service\n# systemctl restart nginx.service\n```\n\n#jenkins\n\njava\u3068jenkins\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```\n# yum install java\n# cd /etc/yum.repos.d\n# curl -O http://pkg.jenkins-ci.org/redhat/jenkins.repo\n# rpm --import http://pkg.jenkins-ci.org/redhat/jenkins-ci.org.key\n# yum install --enablerepo=jenkins jenkins\n```\n\n```diff:/etc/sysconfig/jenkins\n#\n# Options to pass to java when running Jenkins.\n#\n-   JENKINS_JAVA_OPTIONS=\"-Djava.awt.headless=true\"\n+   JENKINS_JAVA_OPTIONS=\"-Djava.awt.headless=true -Dhudson.util.ProcessTree.disable=true -Dorg.apache.commons.jelly.tags.fmt.timeZone=Asia/Tokyo\"\n\n#\n# Port Jenkins is listening on.\n# Set to -1 to disable\n#\nJENKINS_PORT=\"8080\"\n\n#\n# Pass arbitrary arguments to Jenkins.\n# Full option list: java -jar jenkins.war --help\n#\n-   JENKINS_ARGS=\"\"\n+   JENKINS_ARGS=\"--prefix=/jenkins\"\n```\n\njenkins\u306e\u8d77\u52d5\u30fb\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n```\n# systemctl start jenkins.service\n# chkconfig jenkins on\n```\n\nnginx\u306ejenkins\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u30fb\u8ee2\u9001\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n```text:/etc/nginx/conf.d/jenkins.conf\nupstream jenkins_server {\n    server 127.0.0.1:8080 fail_timeout=0;\n}\n```\n\n```diff:/etc/nginx/conf.d/redmine.conf\n+       location ~ /jenkins {\n+           proxy_redirect     off;\n+           proxy_set_header   X-Forwarded-Proto $scheme;\n+           proxy_set_header   Host              $http_host;\n+           proxy_set_header   X-Real-IP         $remote_addr;\n+           proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n+           proxy_set_header   Host $host;\n+   \n+           proxy_pass         http://jenkins_server;\n+       }\n```\n\n```\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n# systemctl status nginx.service\n```\n\nnginx\u3068\u540c\u69d8\u306b\u3001SELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u3067jenkins```http://IP\u30a2\u30c9\u30ec\u30b9/jenkins/```\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n\n```\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n```\n\n#https\u5316\n\u8a3c\u660e\u66f8\u306e\u4f5c\u6210\n\n```\n# openssl req -new -newkey rsa:2048 -sha1 -x509 -nodes -set_serial 1 -days 10950 -subj \"/C=JP/ST=Tokyo/CN=www.example.com\" -out /etc/pki/tls/certs/www.example.com.crt -keyout /etc/pki/tls/private/www.example.com.key\n# cd /etc/nginx/conf.d/\n# mv /etc/nginx/conf.d/redmine.conf /etc/nginx/conf.d/redmine_SSL.conf\n```\n\nnginx\u306e\u8a2d\u5b9a\n\n```diff:/etc/nginx/conf.d/redmine_SSL.conf\nserver {\n-       listen 80;\n+       listen 443;\n        server_name _;\n\n+       ssl on;\n+       ssl_certificate /etc/pki/tls/certs/www.example.com.crt;\n+       ssl_certificate_key /etc/pki/tls/private/www.example.com.key;\n+   #    ssl_session_timeout 5m;\n+   #    ssl_protocols SSLv2 SSLv3 TLSv1;\n+   #    ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;\n+   #    ssl_prefer_server_ciphers on;\n```\n\n```text:/etc/nginx/conf.d/http.conf\nserver {\n    listen 80;\n    server_name example.com;\n    return 301 https://$host$request_uri;\n}\n```\n\nfirewall\u306e\u8a2d\u5b9a\n\n```\n# firewall-cmd --list-services --zone=public\n# firewall-cmd --add-service https --zone=public --permanent\n# firewall-cmd --reload\n# firewall-cmd --list-services --zone=public\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n# systemctl status nginx.service\n```\n\nhttp\u3067\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306f\u81ea\u52d5\u3067https\u306b\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002\n\n#SCM\u9023\u643a\n\u30ea\u30dd\u30b8\u30c8\u30ea\u30a2\u30af\u30bb\u30b9\u7528\u306bapache\u306e\u5c0e\u5165\u30fb\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5c0e\u5165\n\n```\n# yum install httpd\n# yum install epel-release\n# yum install mod_perl perl-DBI perl-Digest-SHA1 perl-Digest-SHA perl-DBD-MySQL mod_dav_svn\n```\n\nRedmine\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5c0e\u5165\u30fb\u8a2d\u5b9a\n\n```\n# mkdir -p /var/www/repos/{svn,git,hg}\n# chown -R redmine:redmine /var/www/repos\n# cd ~\n# svn export -r 142 http://subversion.andriylesyuk.com/scm-creator redmine_scm\n# mv redmine_scm /var/lib/redmine/plugins/\n```\n\n```text:/var/lib/redmine/config/scm.yml\nproduction:\n  deny_delete: false\n  auto_create: true\n  svn:\n    path: /var/www/repos/svn\n    svnadmin: /usr/bin/svnadmin\n    url: https://www.example.com/repos/svn\n  git:\n    path: /var/www/repos/git\n    git: /usr/bin/git\n    options: --bare\n    url: https://www.example.com/repos/git\n    update_server_info: true\n    git_ext: true\n  mercurial:\n    path: /var/www/repos/hg\n    hg: /usr/bin/hg\n    url: https://www.example.com/repos/hg\ndevelopment:\n```\n\n```diff:/var/lib/redmine/Gemfile.local\n+   gem \"rails-observers\"\n```\n\n```\n# cd /var/lib/redmine\n# bundle update\n# bundle exec rake db:migrate:plugin RAILS_ENV=production\n# bundle exec rake tmp:cache:clear\n# bundle exec rake tmp:sessions:clear\n# systemctl restart nginx.service\n# systemctl restart redmine-unicorn.service\n```\n\nnginx\u306e\u8a2d\u5b9a\n\n```text:/etc/nginx/conf.d/apache.conf\nupstream apache_server {\n    server 127.0.0.1:8086 fail_timeout=0;\n}\n```\n\n```diff:/etc/nginx/conf.d/redmine_SSL.conf\n+       location ~ /repos/ {\n+           proxy_redirect     off;\n+           proxy_set_header   X-Forwarded-Proto $scheme;\n+           proxy_set_header   Host              $http_host;\n+           proxy_set_header   X-Real-IP         $remote_addr;\n+           proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;\n+           proxy_set_header   Host $host;\n\n+           proxy_pass         http://apache_server$request_uri;\n+       }\n```\n\n```\n# nginx -t\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n# systemctl restart nginx.service\n```\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u8a8d\u8a3c\u7528\u306e\u8a2d\u5b9a\n\n```\n# mkdir -p /usr/lib64/perl5/vendor_perl/Apache/Authn\n# ln -s /var/lib/redmine/extra/svn/Redmine.pm /usr/lib64/perl5/vendor_perl/Apache/Authn/Redmine.pm\n```\n\n```diff:/etc/httpd/conf/httpd.conf\n-   Listen 80\n+   Listen 8086\n\n-   User apache\n-   Group apache\n+   User redmine\n+   Group redmine\n```\n\n```text:/etc/httpd/conf.d/redmine.conf\nLoadModule dav_svn_module     modules/mod_dav_svn.so\nLoadModule authz_svn_module   modules/mod_authz_svn.so\n\nPerlLoadModule Apache::Authn::Redmine\n\n# Subversion\n<Location /repos/svn>\n  DAV svn\n  SVNAdvertiseV2Protocol Off\n  SVNParentPath \"/var/www/repos/svn\"\n  \n  AuthType Basic\n  AuthName \"Redmine SVN Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n  \n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n  \n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"password\"\n</Location>\n\n# Git\nSetEnv GIT_PROJECT_ROOT /var/www/repos/git\nSetEnv GIT_HTTP_EXPORT_ALL\nScriptAlias /repos/git/ /usr/libexec/git-core/git-http-backend/\n<Location /repos/git>\n  AuthType Basic\n  AuthName \"Redmine Git Repository\"\n  AuthUserFile /dev/null\n  Require valid-user\n  \n  #PerlAccessHandler Apache::Authn::Redmine::access_handler\n  PerlAuthenHandler Apache::Authn::Redmine::authen_handler\n  \n  RedmineDSN \"DBI:mysql:database=redmine;host=localhost\"\n  RedmineDbUser \"redmine\"\n  RedmineDbPass \"pasword\"\n  RedmineGitSmartHttp yes\n</Location>\n```\n\nnginx\u3001jenkins\u3068\u540c\u69d8\u306b\u3001SELinux\u306b\u963b\u307e\u308c\u3066\u8d77\u52d5\u51fa\u6765\u306a\u3044\u305f\u3081\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\n```\n# service httpd start\n# cat /var/log/audit/audit.log | grep httpd | audit2allow -m httpd\n# grep httpd /var/log/audit/audit.log | audit2allow -M httpd\n# semodule -i httpd.pp\n# service httpd start\n# chkconfig httpd on\n```\n\napache\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\n\u30d6\u30e9\u30a6\u30b6\u53c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea```http://IP\u30a2\u30c9\u30ec\u30b9/repos```\u306b\u30a2\u30af\u30bb\u30b9\u3002Internal error\u3068\u3044\u3063\u305f\u8868\u793a\u304c\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n\n```\n# cat /var/log/audit/audit.log | grep nginx | audit2allow -m nginx\n# grep nginx /var/log/audit/audit.log | audit2allow -M nginx\n# semodule -i nginx.pp\n```\n\napache\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002SELinux\u304cEnforcing\u306a\u306e\u3067\u3001\u76e3\u67fb\u30ed\u30b0\u304b\u3089\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u9069\u7528\u3059\u308b\nRedmine\u306b\u521d\u671f\u7ba1\u7406\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u5f8c\u3001\u7ba1\u7406\u30da\u30fc\u30b8\u304b\u3089\u8a2d\u5b9a\u3092\u30ed\u30fc\u30c9\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u753b\u9762\u3067SCM\u3067svn\u3092\u9078\u629e\u3057\u3066\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30f3\u30d0\u30fc\u306b\u521d\u671f\u7ba1\u7406\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u30d6\u30e9\u30a6\u30b6\u53c8\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u30ea\u30dd\u30b8\u30c8\u30ea```http://IP\u30a2\u30c9\u30ec\u30b9/repos/svn/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/```\u306b\u30a2\u30af\u30bb\u30b9\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u5834\u5408\u3001Could not open the requested SVN filesystem\u3068\u8868\u793a\u306e\u3092\u78ba\u8a8d\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n\n```\n# cat /var/log/audit/audit.log | grep httpd | audit2allow -m httpd\n# grep httpd /var/log/audit/audit.log | audit2allow -M httpd\n# semodule -i httpd.pp\n```\n", "tags": ["Redmine3.0.2", "SCM,Subversion,Git", "nginx", "CentOS7"]}