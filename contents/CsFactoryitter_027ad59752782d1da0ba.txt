{"context": "\u5f53\u8a18\u4e8b\u306f\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u306e\u9023\u8f09\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u76ee\u6b21\u306f\u3010\u3053\u3061\u3089\u3011\u3067\u3059\u3002\n\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3010GitHub\u3011\u3067\u516c\u958b\u4e2d\u3067\u3059\u3002\n\u30b5\u30fc\u30d0\u306e\u8cac\u52d9\u306f\u3053\u3061\u3089\u3067\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n\n1.JDK\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u6982\u8981\nJDK\u3068TOMCAT\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n    JDK\u3068TOMCAT(\u6700\u65b0\u306f)yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u7121\u3044\u70ba\n    \u4e8b\u524d\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066manageterm\u7aef\u672b\u3088\u308acopy\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\n    adminserv01\u30b5\u30fc\u30d0\u306b\u9001\u4fe1\u3057NFS\u7d4c\u7531\u3067JDK/TOMCAT\u3092\u53d6\u5f97\u3057\u305f\u5f8c\n    \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5f62\u5f0f\u3092\u3068\u308a\u307e\u3059\u3002\n        manageterm\u7aef\u672b\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u9001\u4fe1\u306f\nhttp://qiita.com/CsFactoryitter/items/1ecf579bcb4f4c6e987e\n        NFS\u306b\u95a2\u3057\u3066\u306f\nhttp://qiita.com/CsFactoryitter/items/f951549c9beb962badcb\n        \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203boracleJDK\u306f\n    wget --no-check-certificate --no-cookies --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/8u65-b17/jdk-8u65-linux-x64.rpm\n    \u3092\u4f7f\u7528\u3059\u308c\u3070\u53d6\u5f97\u53ef\u80fd\u306a\u306e\u3067get_url\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308c\u3070\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9/\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u53ef\u80fd\u3067\u3059\u304c\n    \u4eca\u56de\u306fURL\u5909\u66f4\u3084Cookie\u306e\u5909\u66f4\u306b\u5f71\u97ff\u3092\u53d7\u3051\u3066ansible\u5b9f\u884c\u304c\u5931\u6557\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n2.playbook\u30d5\u30a1\u30a4\u30eb\u306e\u76f8\u95a2\n\n\n3.playbook(site.yml)\n${ANSIBLE_HOME}/site.yml\n\u30e1\u30a4\u30f3\u3068\u306a\u308bplaybook(site.yml)\u53c2\u7167\n\n4.JDK\u30fbTOMCAT\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u306eplaybook(/operations/1021_javatomcat.yml)\n${ANSIBLE_HOME}/operations/1021_javatomcat.yml\nplaybook\u4e2d\u306e\u30b3\u30e1\u30f3\u30c8\u306e\u88dc\u8db3\u306b\u95a2\u3057\u3066\u306f\u300c6.\u88dc\u8db3\u8aac\u660e\u300d\u3092\u53c2\u7167\u3002\n# ========================================================\n# Java\u3068Tomcat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u8a2d\u5b9a(javatomcat.yml)\n# ========================================================\n---\n- hosts: ap_admin\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n  remote_user: root\n  tasks:\n    # ========================================================\n    # Java\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\n    # ========================================================\n    - name: java\u306e\u5b58\u5728\u78ba\u8a8d\n      shell: which java\n      register: java_which\n      failed_when: java_which.rc not in [0, 1]\n\n    # ========================================================\n    # java\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408Java\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    # ========================================================\n    - name: Java \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=/var/opt/data/nfs/java/installer/jdk-7u79-linux-x64.rpm state=present\n      when: java_which.rc == 1\n\n\n    # ========================================================\n    # tag\u306breinstall\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306fTomcat\u3092\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n    # ========================================================\n    - name: \u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308btags\u304c\"reinstall\"\u306e\u5834\u5408\u518d\u5b9f\u884c\u3059\u308b\u70ba\u4e00\u5ea6\u524a\u9664\u3059\u308b\n      shell: rm -f /opt/tomcat/bin/startup.sh\n      when: target == 'reinstall'\n\n   # ========================================================\n    # /opt/tomcat/bin/startup.sh\u30d5\u30a1\u30a4\u30eb\u304c\n    # \u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d42\u4e86\u3068\u3059\u308b(\u51aa\u7b49\u6027\u306f\u5f53\u8a72\u30d5\u30a1\u30a4\u30eb\u3067\u62c5\u4fdd)\n    # ========================================================\n    - name: tomcat\u306e\u5b58\u5728\u78ba\u8a8d(\u4ee5\u4e0b\u3059\u3079\u3066\u5b58\u5728\u3057\u3066\u306a\u3044\u5834\u5408\u306e\u307f\u5b9f\u884c)\n      stat: path=/opt/tomcat/bin/startup.sh\n      register: tomcatexists\n\n    # ========================================================\n    # tar.gz\u5727\u7e2e\u3055\u308c\u305ftomat\u3092/tmp\u306b\u5c55\u958b\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n      command: tar zxvf /var/opt/data/nfs/tomcat/installer/apache-tomcat-7.0.65.tar.gz -C /tmp/.\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # /tmp\u914d\u4e0b\u306b\u3042\u308btomat7\u3092/opt\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5c55\u958b\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092/opt/tomcat\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\n      command: \"cp -r /tmp/apache-tomcat-7.0.65/. /opt/tomcat/.\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # tomcat\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308bsetenv\u30d5\u30a1\u30a4\u30eb\u3092/opt/tomcat/bin\u306b\u30b3\u30d4\u30fc\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1aenv\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n      command: \"cp -r /var/opt/data/nfs/tomcat/settings/setenv.sh /opt/tomcat/bin/setenv.sh\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # systemd\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308btomcatenviroment\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1asystemd\u306eenviroment\u30d5\u30a1\u30a4\u30eb\n      command: \"cp  /var/opt/data/nfs/tomcat/settings/tomcatenviroment /etc/sysconfig/tomcatenviroment\"\n      when: not tomcatexists.stat.exists\n\n\n    # ========================================================\n    # \u4e0d\u8981\u306b\u306a\u3063\u305f/tmp\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\u3059\u308b\n      command: rm -rf /tmp/apache-tomcat-7.0.65\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # /opt/tomcat\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u518d\u8a2d\u5b9aTOMCAT\u30e6\u30fc\u30b6\u30fc 755\u3092\u8a2d\u5b9a\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3068\u30e6\u30fc\u30b6\u30fc\u306e\u5909\u66f4\n      file:\n          recurse=yes\n          group={{path.dir.tomcat_home.group}}\n          mode={{path.dir.tomcat_home.permision}}\n          owner={{path.dir.tomcat_home.user}}\n          path={{path.dir.tomcat_home.path}}\n          state={{path.dir.tomcat_home.state}}\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305ftomcat\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1aSYSTEMD\u306e\u30e6\u30cb\u30c3\u30c8\u30d5\u30a1\u30a4\u30ebsystemDIR\u306b\u30b3\u30d4\u30fc\u3059\u308b\n      command: \"cp /var/opt/data/nfs/tomcat/settings/tomcat_systemd.template /usr/lib/systemd/system/tomcat.service\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305fserver.xml\u3092\u914d\u7f6e\u3059\u308b\n    # ========================================================\n    - name: server.xml\u306e\u30b3\u30d4\u30fc\n      command: \"cp /var/opt/data/nfs/tomcat/settings/server.xml /opt/tomcat/conf/server.xml\"\n      when: not tomcatexists.stat.exists\n\n\n#==================================================================\n#adminserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n#==================================================================\n- hosts: adminserv01\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n    - ../vars/enviroment.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      #adminserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n      #==================================================================\n    - name: server.xml\u306eIP\u30a2\u30c9\u30ec\u30b9\u90e8\u5206\u3092\u4fee\u6b63\n      replace: dest=\"/opt/tomcat/conf/server.xml\" regexp=\"<<SERVER_GLOBAL_IP>>\" replace=\"{{tomcat.bindip_admin}}\"\n      when: not tomcatexists.stat.exists\n#==================================================================\n#apserv01\u7528\u306b\u30b5\u30fc\u30d0XML\u3092\u7de8\u96c6\n#==================================================================\n- hosts: apserv01\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n    - ../vars/enviroment.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      #apserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n      #==================================================================\n    - name: server.xml\u306eIP\u30a2\u30c9\u30ec\u30b9\u90e8\u5206\u3092\u4fee\u6b63\n      replace: dest=\"/opt/tomcat/conf/server.xml\" regexp=\"<<SERVER_GLOBAL_IP>>\" replace=\"{{tomcat.bindip_ap}}\"\n      when: not tomcatexists.stat.exists\n\n\n\n#==================================================================\n#apserv01,adminserv01\u306eTOMCAT\u3092\u30ea\u30ed\u30fc\u30c9\n#==================================================================\n- hosts: ap_admin\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305ftomcat\u306e\u30e6\u30fc\u30b6\u30fc\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\n      #==================================================================\n    - name: tomcat-users.xml\u306e\u30b3\u30d4\u30fc\n      command: \"cp /var/opt/data/nfs/tomcat/settings/tomcat-users.xml /opt/tomcat/conf/tomcat-users.xml\"\n      when: not tomcatexists.stat.exists\n\n      #==================================================================\n      # TOMCAT\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\n      #==================================================================\n    - name: TOMCAT\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\n      service: name=tomcat enabled=yes state=restarted\n      ignore_errors: True\n\n\n\n5 \u5909\u6570\u8a2d\u5b9a\n\n5.a \u5909\u6570\u8a2d\u5b9a Playbook(${ANSIBLE_HOME}/operations/firledir.yml)\n---\n  path:\n    dir:\n      data_root:\n        path: /var/opt/data\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      tomcat_home:\n        path: /opt/tomcat\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      selenium_home:\n        path: /opt/selenium\n        user: selenium\n        group: selenium\n        state: directory\n        permision: 755\n      selenium_log:\n        path: /var/log/selenium\n        user: selenium\n        group: selenium\n        state: directory\n        permision: 755\n\n      mysql_data_home:\n        path: /var/opt/data/mysql\n        user: mysql\n        group: mysql\n        state: directory\n        permision: 755\n      tomcat_data_webapps:\n        path: /var/opt/data/tomcat/webapps\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      tomcat_data_work:\n        path: /var/opt/data/tomcat/work\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      nfs_root:\n        path: /var/opt/data/nfs\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_installer:\n        path: /var/opt/data/nfs/installer\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_work:\n        path: /var/opt/data/nfs/work\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_settings:\n        path: /var/opt/data/nfs/settings\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      jenkins_root:\n        path: /var/opt/data/jenkins\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      ssl_root:\n        path: /etc/ssl/apserv_cets\n        user: root\n        group: root\n        state: directory\n        permision: 755\n  file:\n      tomcat:\n        install_check_file: /opt/tomcat/bin/startup.sh\n        installer: /var/opt/data/nfs/installer/tomcat7.tar.gz\n        unzip_ch_path: /tmp/.\n        unzip_after_file: /tmp/apache-tomcat-7.0.65\n      nmon:\n        install_check_file: /bin/nmon\n        installer: /var/opt/data/nfs/installer/centos7.tar.gz\n        unzip_ch_path: /bin\n        unzip_after_file: /bin/nmon_x86_64_centos7\n      java:\n        install_check_cmd: which java\n        installer: /var/opt/data/nfs/installer/jdk-7u79-linux-x64.rpm\n\n\n\n\n5.b \u5909\u6570\u8a2d\u5b9a Playbook(${ANSIBLE_HOME}/operations/enviroment.yml)\n---\nnfs:\n  exportnetwork: 192.168.134.0\napache:\n  user01:\n    name: user01\n    password: user01\n  user02:\n    name: user02\n    password: user02\n  user03:\n    name: user03\n    password: user03\n\nopenvpn:\n  client_route: 192.168.102.0\n  vpn_network: 10.99.0.0\n\ntomcat:\n  bindip_admin: 192.168.134.198\n  bindip_ap: 192.168.134.196\n\nmysql:\n  password: password\n\nnic:\n  vpn: tun0\n  lo: lo\n  outer: enp0s9\n  inner: enp0s8\n\n\n\n6 \u8aac\u660e\n\n6.a \u51e6\u7406\u9806\u8aac\u660e\n\nJava/Tomcat\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002\n1. Java\u304c\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3002(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u4ee5\u964d\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3057\u306a\u3044(\u51aa\u7b49\u6027\u62c5\u4fdd)\n2. NFS\u4e0a\u306b\u5b58\u5728\u3059\u308bJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306erpm\u3092\u4f7f\u7528\u3057\u3066Java\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n3. NFS\u60c5\u5831TOMACAT\u306etar\u30dc\u30fc\u30eb\u3092\u5c55\u958b\u3059\u308b\n4. TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092/opt\u914d\u4e0b\u306b\u79fb\u52d5\n5. TOMCAT\u8d77\u52d5\u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb(sentenv.sh)\u3092NFS\u4e0a\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\n6. SYSTEMD\u304b\u3089\u8d77\u52d5\u3059\u308b\u969b\u306eTOMCAT\u7528\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb(tomcatenviroment)\u3092NFS\u4e0a\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\n7. TOMCAT\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3/\u30aa\u30fc\u30ca\u30fc\u8a2d\u5b9a\n8. SystemD\u3067\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306bSYSTEMD\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n9. TOMCAT\u306eserver.xml\u3092NFS\u304b\u3089\u30b3\u30d4\u30fc\n10. server.xml\u306b\u306fadminserv01\u3068apserv01\u3067\u305d\u308c\u305e\u308c\u56fa\u6709\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8ff0\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u70baserver.xml\u5185\u306e\u6587\u5b57\u5217\u3092\u7f6e\u63db11. TOMCAT\u306eWEB\u30c7\u30d7\u30ed\u30a4\u30b3\u30f3\u30bd\u30fc\u30eb\u304c\u5229\u7528\u3067\u304d\u308b\u7528\u306b\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092NFS\u304b\u3089\u30b3\u30d4\u30fc\n12. SystemD\u3067\u518d\u30b9\u30bf\u30fc\u30c8\n\n\u203b\u4eca\u56de\u306ejava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u95a2\u3057\u3066\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u306f\n\u30fbwhich java\u304c\u5b9f\u884c\u51fa\u6765\u305f\u5834\u5408\u306b\u306fJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51e6\u7406\u306f\u884c\u308f\u306a\u3044\u3002\n\u30fbtomcat\u306e\u8d77\u52d5\u30b7\u30a7\u30eb\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306b\u306fTOMCAT\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u51e6\u7406\u306f\u884c\u308f\u306a\u3044\u3002\n\u3068\u3061\u3087\u3063\u3068\u5927\u96d1\u628a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3084\u4fee\u6b63\u3057\u305f\u3044\u5834\u5408\u306b\u306f\n\u518d\u5ea6\u5b9f\u884c\u3067\u304d\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u70ba\u3001\u3082\u3046\u5c11\u3057\u8003\u616e\u304c\u5fc5\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u7c21\u5358\u306a\u65b9\u6cd5\u306ftag\u306btomate_reinstall\u3084java_reinstall\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\n\u30fb\u6307\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3084remove\u3092\u884c\u3046\u3002\n\u7b49\u306estat\u30e2\u30b8\u30e5\u30fc\u30eb\u3068register\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\n\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u3092\u884c\u3046\u7b49\u306e\u4f59\u5730\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n6.b. \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u88dc\u8db3\u8aac\u660e\n\u4e0a\u8a18\u306b\u304b\u304d\u307e\u3057\u305f\u304c\u4e8b\u524d\u306bJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebrpm\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u3082\u306e\u3092\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u76f4\u63a5ansible\u306b\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9/\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u3082\u53ef\u80fd\u3067\u3059\n(\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3093\u304b\u306f\u6c17\u306b\u3057\u3066\u304f\u3060\u3055\u3044)\n\nget_url\u30e2\u30b8\u30e5\u30fc\u30eb,yum\u30e2\u30b8\u30e5\u30fc\u30eb\nget_url: url=http://download.oracle.com/otn-pub/java/jdk/8u65-b17/jdk-8u65-linux-x64.rpm dest=/tmp/jdk.rpm  headers=\"Cookie: oraclelicense=accept-securebackup-cookie\"\nyum: name=/tmp.jdk.rpm state=present\n\n\ntar\u306e\u89e3\u51cd,\u6240\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc(shell/command\u30e2\u30b8\u30e5\u30fc\u30eb)\nAnsible\u306b\u306f\u4f55\u6545\u304bansbile\u5b9f\u884c\u7aef\u672b\u304b\u3089\u30ea\u30e2\u30fc\u30c8\u3078\u306e\u30b3\u30d4\u30fc\u3084\u3089\u306f\u3042\u308a\u307e\u3059\u304c\n\u64cd\u4f5c\u3057\u3066\u3044\u308b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u5185\u3067\u306ecp\u3084\u3089mv\u3092\u5b9f\u884c\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002\ntar\u30b3\u30de\u30f3\u30c9\u3092\u304a\u3053\u306a\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\u306a\u306e\u3067\u4eca\u56de\u306fshell\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nshell/command\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u4ed6\u306eansible\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u9055\u3044\n\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u3092\u81ea\u5206\u3067\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nregister\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u5909\u6570\u306b\u767b\u9332\u3057\u305f\u4e0awhen\u3092\u4f7f\u3063\u3066\u78ba\u8a8d\u5f8c\u5b9f\u884c\n\u3068\u3059\u308b\u306e\u304c\u51aa\u7b49\u6027\u3092\u62c5\u4fdd\u3059\u308b\u3046\u3048\u3067\u3082\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n# ========================================================\n# stat\u3092\u4f7f\u7528\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u7d50\u679c\u3092XXXXExists\u306b\u767b\u9332\u3059\u308b\n# ========================================================\n  stat: path=/tmp/XXXXX\n  register: XXXXexists\n\n# ========================================================\n# XXXXExists\u306b\u4fdd\u5b58\u3057\u305f\u60c5\u5831\u304b\u3089/tmp/XXXXX\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3060\u3051tar\u30b3\u30de\u30f3\u30c9\u3092\n#\u5b9f\u884c\u3059\u308b\n# ========================================================\n  command: tar zxvf /tmp/XXXXX -C /tmp/YYYY/.\n  when: not tomcatexists.stat.exists\n\n\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3/\u30aa\u30fc\u30ca\u30fc\u306e\u8a2d\u5b9a (file\u30e2\u30b8\u30e5\u30fc\u30eb)\n\u4eca\u307e\u3067\u3082\u6ca2\u5c71\u51fa\u3066\u304d\u3066\u3044\u307e\u3059\u304c\u3001file\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u884c\u3044\u307e\u3059\u3002\nfile:\n        recurse = %YES=\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5834\u5408\u518d\u5e30\u7684\u306b\u8a2d\u5b9a%\n        group   = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u30b0\u30eb\u30fc\u30d7\u540d%\n        mode    = %\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3%\n        owner   = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005%\n        path    = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9%\n        state   = %file=\u30d5\u30a1\u30a4\u30eb , directory=\u30c7\u30a3\u30ec\u30af\u30c8\u30ea , absent-\u524a\u9664 , hard/link=\u30ea\u30f3\u30af , touch=touch%\n\nfile\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3044\u3046\u540d\u524d\u3067\u3059\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5bfe\u3057\u3066\u3082\u5b9f\u884c\u53ef\u80fd\u3067\u3059\u3002\n\u3053\u3053\u304c\u5f79\u306b\u7acb\u3061\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb(\u65e5\u672c\u8a9e)\n\u6b21\u56de\u306f\u300c[216.selenium\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u914d\u7f6e]\u300d\u306b\u3064\u3044\u3066\u3002\n\u9023\u8f09\u306e\u76ee\u6b21\u306f\u3010\u3053\u3061\u3089\u3011\u3067\u3059\u3002\n<b><font color=\"#ff6633\">\u5f53\u8a18\u4e8b\u306f\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u306e\u9023\u8f09\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u76ee\u6b21\u306f[\u3010\u3053\u3061\u3089\u3011](http://qiita.com/CsFactoryitter/items/6b8308b96afafd61ce5f\n)\u3067\u3059\u3002</font></b>\n<b><font color=\"#ff6633\">\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f[\u3010GitHub\u3011](https://github.com/csfactorygihubblog001/blogansible)\u3067\u516c\u958b\u4e2d\u3067\u3059\u3002</font></b>\n\u30b5\u30fc\u30d0\u306e\u8cac\u52d9\u306f<b>[\u3053\u3061\u3089](http://qiita.com/CsFactoryitter/items/032cc339048e52ee3586)</b>\u3067\u78ba\u8a8d\u304f\u3060\u3055\u3044\u3002\n\n##1.JDK\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u6982\u8981\nJDK\u3068TOMCAT\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\tJDK\u3068TOMCAT(\u6700\u65b0\u306f)yum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u7121\u3044\u70ba\n\t\u4e8b\u524d\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066manageterm\u7aef\u672b\u3088\u308acopy\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\n\tadminserv01\u30b5\u30fc\u30d0\u306b\u9001\u4fe1\u3057NFS\u7d4c\u7531\u3067JDK/TOMCAT\u3092\u53d6\u5f97\u3057\u305f\u5f8c\n\t\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5f62\u5f0f\u3092\u3068\u308a\u307e\u3059\u3002\n\t\tmanageterm\u7aef\u672b\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u9001\u4fe1\u306f\n\t\thttp://qiita.com/CsFactoryitter/items/1ecf579bcb4f4c6e987e\n\t\tNFS\u306b\u95a2\u3057\u3066\u306f\n\t\thttp://qiita.com/CsFactoryitter/items/f951549c9beb962badcb\n\t\t\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\t\n\u203boracleJDK\u306f\n\twget --no-check-certificate --no-cookies --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/8u65-b17/jdk-8u65-linux-x64.rpm\n\t\u3092\u4f7f\u7528\u3059\u308c\u3070\u53d6\u5f97\u53ef\u80fd\u306a\u306e\u3067get_url\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308c\u3070\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9/\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u53ef\u80fd\u3067\u3059\u304c\n\t\u4eca\u56de\u306fURL\u5909\u66f4\u3084Cookie\u306e\u5909\u66f4\u306b\u5f71\u97ff\u3092\u53d7\u3051\u3066ansible\u5b9f\u884c\u304c\u5931\u6557\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/98085/4f91c635-f175-cafd-9aa5-93dcd494cd26.png)\n\n##2.playbook\u30d5\u30a1\u30a4\u30eb\u306e\u76f8\u95a2\n![image](https://qiita-image-store.s3.amazonaws.com/0/98085/5ca0ba47-900f-b389-bff7-d327601ffee0.png)\n\n\n##3.playbook(site.yml)\n${ANSIBLE_HOME}/site.yml\n[\u30e1\u30a4\u30f3\u3068\u306a\u308bplaybook(site.yml)](http://qiita.com/CsFactoryitter/items/3112c6d504d3b5a58011#3%E3%83%A1%E3%82%A4%E3%83%B3%E3%81%A8%E3%81%AA%E3%82%8Bplaybooksiteyml)\u53c2\u7167\n\n\n##4.JDK\u30fbTOMCAT\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u306eplaybook(/operations/1021_javatomcat.yml)\n\n${ANSIBLE_HOME}/operations/1021_javatomcat.yml\n\nplaybook\u4e2d\u306e\u30b3\u30e1\u30f3\u30c8\u306e\u88dc\u8db3\u306b\u95a2\u3057\u3066\u306f\u300c[6.\u88dc\u8db3\u8aac\u660e](#5%E8%A3%9C%E8%B6%B3%E8%AA%AC%E6%98%8E)\u300d\u3092\u53c2\u7167\u3002\n\n```yaml:\n# ========================================================\n# Java\u3068Tomcat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u8a2d\u5b9a(javatomcat.yml)\n# ========================================================\n---\n- hosts: ap_admin\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n  remote_user: root\n  tasks:\n    # ========================================================\n    # Java\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d\n    # ========================================================\n    - name: java\u306e\u5b58\u5728\u78ba\u8a8d\n      shell: which java\n      register: java_which\n      failed_when: java_which.rc not in [0, 1]\n\n    # ========================================================\n    # java\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408Java\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    # ========================================================\n    - name: Java \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=/var/opt/data/nfs/java/installer/jdk-7u79-linux-x64.rpm state=present\n      when: java_which.rc == 1\n\n\n    # ========================================================\n    # tag\u306breinstall\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306fTomcat\u3092\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n    # ========================================================\n    - name: \u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308btags\u304c\"reinstall\"\u306e\u5834\u5408\u518d\u5b9f\u884c\u3059\u308b\u70ba\u4e00\u5ea6\u524a\u9664\u3059\u308b\n      shell: rm -f /opt/tomcat/bin/startup.sh\n      when: target == 'reinstall'\n\n   # ========================================================\n    # /opt/tomcat/bin/startup.sh\u30d5\u30a1\u30a4\u30eb\u304c\n    # \u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d42\u4e86\u3068\u3059\u308b(\u51aa\u7b49\u6027\u306f\u5f53\u8a72\u30d5\u30a1\u30a4\u30eb\u3067\u62c5\u4fdd)\n    # ========================================================\n    - name: tomcat\u306e\u5b58\u5728\u78ba\u8a8d(\u4ee5\u4e0b\u3059\u3079\u3066\u5b58\u5728\u3057\u3066\u306a\u3044\u5834\u5408\u306e\u307f\u5b9f\u884c)\n      stat: path=/opt/tomcat/bin/startup.sh\n      register: tomcatexists\n\n    # ========================================================\n    # tar.gz\u5727\u7e2e\u3055\u308c\u305ftomat\u3092/tmp\u306b\u5c55\u958b\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n      command: tar zxvf /var/opt/data/nfs/tomcat/installer/apache-tomcat-7.0.65.tar.gz -C /tmp/.\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # /tmp\u914d\u4e0b\u306b\u3042\u308btomat7\u3092/opt\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5c55\u958b\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092/opt/tomcat\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3059\u308b\n      command: \"cp -r /tmp/apache-tomcat-7.0.65/. /opt/tomcat/.\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # tomcat\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308bsetenv\u30d5\u30a1\u30a4\u30eb\u3092/opt/tomcat/bin\u306b\u30b3\u30d4\u30fc\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1aenv\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n      command: \"cp -r /var/opt/data/nfs/tomcat/settings/setenv.sh /opt/tomcat/bin/setenv.sh\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # systemd\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308btomcatenviroment\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1asystemd\u306eenviroment\u30d5\u30a1\u30a4\u30eb\n      command: \"cp  /var/opt/data/nfs/tomcat/settings/tomcatenviroment /etc/sysconfig/tomcatenviroment\"\n      when: not tomcatexists.stat.exists\n\n\n    # ========================================================\n    # \u4e0d\u8981\u306b\u306a\u3063\u305f/tmp\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664\u3059\u308b\n      command: rm -rf /tmp/apache-tomcat-7.0.65\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # /opt/tomcat\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u518d\u8a2d\u5b9aTOMCAT\u30e6\u30fc\u30b6\u30fc 755\u3092\u8a2d\u5b9a\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1a\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3068\u30e6\u30fc\u30b6\u30fc\u306e\u5909\u66f4\n      file:\n          recurse=yes\n          group={{path.dir.tomcat_home.group}}\n          mode={{path.dir.tomcat_home.permision}}\n          owner={{path.dir.tomcat_home.user}}\n          path={{path.dir.tomcat_home.path}}\n          state={{path.dir.tomcat_home.state}}\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305ftomcat\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\n    # ========================================================\n    - name: \u672a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u5834\u5408\uff1aSYSTEMD\u306e\u30e6\u30cb\u30c3\u30c8\u30d5\u30a1\u30a4\u30ebsystemDIR\u306b\u30b3\u30d4\u30fc\u3059\u308b\n      command: \"cp /var/opt/data/nfs/tomcat/settings/tomcat_systemd.template /usr/lib/systemd/system/tomcat.service\"\n      when: not tomcatexists.stat.exists\n\n    # ========================================================\n    # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305fserver.xml\u3092\u914d\u7f6e\u3059\u308b\n    # ========================================================\n    - name: server.xml\u306e\u30b3\u30d4\u30fc\n      command: \"cp /var/opt/data/nfs/tomcat/settings/server.xml /opt/tomcat/conf/server.xml\"\n      when: not tomcatexists.stat.exists\n\n\n#==================================================================\n#adminserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n#==================================================================\n- hosts: adminserv01\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n    - ../vars/enviroment.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      #adminserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n      #==================================================================\n    - name: server.xml\u306eIP\u30a2\u30c9\u30ec\u30b9\u90e8\u5206\u3092\u4fee\u6b63\n      replace: dest=\"/opt/tomcat/conf/server.xml\" regexp=\"<<SERVER_GLOBAL_IP>>\" replace=\"{{tomcat.bindip_admin}}\"\n      when: not tomcatexists.stat.exists\n#==================================================================\n#apserv01\u7528\u306b\u30b5\u30fc\u30d0XML\u3092\u7de8\u96c6\n#==================================================================\n- hosts: apserv01\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n    - ../vars/enviroment.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      #apserv01\u306eserver.xml\u306e\u5909\u6570\u3092\u7f6e\u63db\u3059\u308b\n      #==================================================================\n    - name: server.xml\u306eIP\u30a2\u30c9\u30ec\u30b9\u90e8\u5206\u3092\u4fee\u6b63\n      replace: dest=\"/opt/tomcat/conf/server.xml\" regexp=\"<<SERVER_GLOBAL_IP>>\" replace=\"{{tomcat.bindip_ap}}\"\n      when: not tomcatexists.stat.exists\n\n\n\n#==================================================================\n#apserv01,adminserv01\u306eTOMCAT\u3092\u30ea\u30ed\u30fc\u30c9\n#==================================================================\n- hosts: ap_admin\n  sudo: no\n  vars_files:\n    - ../vars/filedir.yml\n  remote_user: root\n  tasks:\n      #==================================================================\n      # \u4e8b\u524d\u306b\u7528\u610f\u3057\u305ftomcat\u306e\u30e6\u30fc\u30b6\u30fc\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\n      #==================================================================\n    - name: tomcat-users.xml\u306e\u30b3\u30d4\u30fc\n      command: \"cp /var/opt/data/nfs/tomcat/settings/tomcat-users.xml /opt/tomcat/conf/tomcat-users.xml\"\n      when: not tomcatexists.stat.exists\n\n      #==================================================================\n      # TOMCAT\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\n      #==================================================================\n    - name: TOMCAT\u30b5\u30fc\u30d3\u30b9\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\n      service: name=tomcat enabled=yes state=restarted\n      ignore_errors: True\n\t\n```\n\n\n\n\n\n##5 \u5909\u6570\u8a2d\u5b9a\n###5.a \u5909\u6570\u8a2d\u5b9a Playbook(${ANSIBLE_HOME}/operations/firledir.yml)\n\n```yaml:\n---\n  path:\n    dir:\n      data_root:\n        path: /var/opt/data\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      tomcat_home:\n        path: /opt/tomcat\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      selenium_home:\n        path: /opt/selenium\n        user: selenium\n        group: selenium\n        state: directory\n        permision: 755\n      selenium_log:\n        path: /var/log/selenium\n        user: selenium\n        group: selenium\n        state: directory\n        permision: 755\n\n      mysql_data_home:\n        path: /var/opt/data/mysql\n        user: mysql\n        group: mysql\n        state: directory\n        permision: 755\n      tomcat_data_webapps:\n        path: /var/opt/data/tomcat/webapps\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      tomcat_data_work:\n        path: /var/opt/data/tomcat/work\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      nfs_root:\n        path: /var/opt/data/nfs\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_installer:\n        path: /var/opt/data/nfs/installer\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_work:\n        path: /var/opt/data/nfs/work\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      nfs_settings:\n        path: /var/opt/data/nfs/settings\n        user: infra\n        group: infra\n        state: directory\n        permision: 755\n      jenkins_root:\n        path: /var/opt/data/jenkins\n        user: tomcat\n        group: tomcat\n        state: directory\n        permision: 755\n      ssl_root:\n        path: /etc/ssl/apserv_cets\n        user: root\n        group: root\n        state: directory\n        permision: 755\n  file:\n      tomcat:\n        install_check_file: /opt/tomcat/bin/startup.sh\n        installer: /var/opt/data/nfs/installer/tomcat7.tar.gz\n        unzip_ch_path: /tmp/.\n        unzip_after_file: /tmp/apache-tomcat-7.0.65\n      nmon:\n        install_check_file: /bin/nmon\n        installer: /var/opt/data/nfs/installer/centos7.tar.gz\n        unzip_ch_path: /bin\n        unzip_after_file: /bin/nmon_x86_64_centos7\n      java:\n        install_check_cmd: which java\n        installer: /var/opt/data/nfs/installer/jdk-7u79-linux-x64.rpm\n\t\n\n```\n\n###5.b \u5909\u6570\u8a2d\u5b9a Playbook(${ANSIBLE_HOME}/operations/enviroment.yml)\n\n```yaml:\n---\nnfs:\n  exportnetwork: 192.168.134.0\napache:\n  user01:\n    name: user01\n    password: user01\n  user02:\n    name: user02\n    password: user02\n  user03:\n    name: user03\n    password: user03\n\nopenvpn:\n  client_route: 192.168.102.0\n  vpn_network: 10.99.0.0\n\ntomcat:\n  bindip_admin: 192.168.134.198\n  bindip_ap: 192.168.134.196\n\nmysql:\n  password: password\n\nnic:\n  vpn: tun0\n  lo: lo\n  outer: enp0s9\n  inner: enp0s8\n\n```\n##6 \u8aac\u660e\n\n##6.a \u51e6\u7406\u9806\u8aac\u660e\n\n<dl>\n<dt>Java/Tomcat\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002</dt>\n<dd>1. Java\u304c\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3002(\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u4ee5\u964d\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3057\u306a\u3044(\u51aa\u7b49\u6027\u62c5\u4fdd)</dd>\n<dd>2. NFS\u4e0a\u306b\u5b58\u5728\u3059\u308bJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306erpm\u3092\u4f7f\u7528\u3057\u3066Java\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb</dd>\n<dd>3. NFS\u60c5\u5831TOMACAT\u306etar\u30dc\u30fc\u30eb\u3092\u5c55\u958b\u3059\u308b</dd>\n<dd>4. TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092/opt\u914d\u4e0b\u306b\u79fb\u52d5</dd>\n<dd>5. TOMCAT\u8d77\u52d5\u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb(sentenv.sh)\u3092NFS\u4e0a\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30b3\u30d4\u30fc</dd>\n<dd>6. SYSTEMD\u304b\u3089\u8d77\u52d5\u3059\u308b\u969b\u306eTOMCAT\u7528\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb(tomcatenviroment)\u3092NFS\u4e0a\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066TOMCAT\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30b3\u30d4\u30fc</dd>\n<dd>7. TOMCAT\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3/\u30aa\u30fc\u30ca\u30fc\u8a2d\u5b9a</dd>\n<dd>8. SystemD\u3067\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306bSYSTEMD\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e</dd>\n<dd>9. TOMCAT\u306eserver.xml\u3092NFS\u304b\u3089\u30b3\u30d4\u30fc</dd>\n<dd>10. server.xml\u306b\u306fadminserv01\u3068apserv01\u3067\u305d\u308c\u305e\u308c\u56fa\u6709\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8ff0\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u70baserver.xml\u5185\u306e\u6587\u5b57\u5217\u3092\u7f6e\u63db<dd>11. TOMCAT\u306eWEB\u30c7\u30d7\u30ed\u30a4\u30b3\u30f3\u30bd\u30fc\u30eb\u304c\u5229\u7528\u3067\u304d\u308b\u7528\u306b\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092NFS\u304b\u3089\u30b3\u30d4\u30fc</dd>\n<dd>12. SystemD\u3067\u518d\u30b9\u30bf\u30fc\u30c8</dd>\n</dl>\n\n\u203b\u4eca\u56de\u306ejava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u95a2\u3057\u3066\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u306f\n\u30fb_which java\u304c\u5b9f\u884c\u51fa\u6765\u305f\u5834\u5408\u306b\u306fJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51e6\u7406\u306f\u884c\u308f\u306a\u3044\u3002_\n\u30fb_tomcat\u306e\u8d77\u52d5\u30b7\u30a7\u30eb\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306b\u306fTOMCAT\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u51e6\u7406\u306f\u884c\u308f\u306a\u3044\u3002_\n\u3068\u3061\u3087\u3063\u3068\u5927\u96d1\u628a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3084\u4fee\u6b63\u3057\u305f\u3044\u5834\u5408\u306b\u306f\n\u518d\u5ea6\u5b9f\u884c\u3067\u304d\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u70ba\u3001\u3082\u3046\u5c11\u3057\u8003\u616e\u304c\u5fc5\u8981\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u7c21\u5358\u306a\u65b9\u6cd5\u306ftag\u306btomate_reinstall\u3084java_reinstall\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\n\u30fb_\u6307\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b_\n\u30fb_\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308c\u3070\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u3084remove\u3092\u884c\u3046\u3002_\n\u7b49\u306estat\u30e2\u30b8\u30e5\u30fc\u30eb\u3068register\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\n\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u3092\u884c\u3046\u7b49\u306e\u4f59\u5730\u304c\u3042\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\n####6.b. \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u88dc\u8db3\u8aac\u660e\n\n\u4e0a\u8a18\u306b\u304b\u304d\u307e\u3057\u305f\u304c\u4e8b\u524d\u306bJava\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebrpm\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u3082\u306e\u3092\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u76f4\u63a5ansible\u306b\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9/\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u3082\u53ef\u80fd\u3067\u3059\n(\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3093\u304b\u306f\u6c17\u306b\u3057\u3066\u304f\u3060\u3055\u3044)\n\n#####get_url\u30e2\u30b8\u30e5\u30fc\u30eb,yum\u30e2\u30b8\u30e5\u30fc\u30eb\n```yaml:\nget_url: url=http://download.oracle.com/otn-pub/java/jdk/8u65-b17/jdk-8u65-linux-x64.rpm dest=/tmp/jdk.rpm  headers=\"Cookie: oraclelicense=accept-securebackup-cookie\"\nyum: name=/tmp.jdk.rpm state=present\n```\n\n\n#####tar\u306e\u89e3\u51cd,\u6240\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u30b3\u30d4\u30fc(shell/command\u30e2\u30b8\u30e5\u30fc\u30eb)\nAnsible\u306b\u306f\u4f55\u6545\u304bansbile\u5b9f\u884c\u7aef\u672b\u304b\u3089\u30ea\u30e2\u30fc\u30c8\u3078\u306e\u30b3\u30d4\u30fc\u3084\u3089\u306f\u3042\u308a\u307e\u3059\u304c\n\u64cd\u4f5c\u3057\u3066\u3044\u308b\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u5185\u3067\u306ecp\u3084\u3089mv\u3092\u5b9f\u884c\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002\ntar\u30b3\u30de\u30f3\u30c9\u3092\u304a\u3053\u306a\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\u306a\u306e\u3067\u4eca\u56de\u306fshell\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nshell/command\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u4ed6\u306eansible\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u9055\u3044\n\u51aa\u7b49\u6027\u306e\u62c5\u4fdd\u3092\u81ea\u5206\u3067\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nregister\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u5909\u6570\u306b\u767b\u9332\u3057\u305f\u4e0awhen\u3092\u4f7f\u3063\u3066\u78ba\u8a8d\u5f8c\u5b9f\u884c\n\u3068\u3059\u308b\u306e\u304c\u51aa\u7b49\u6027\u3092\u62c5\u4fdd\u3059\u308b\u3046\u3048\u3067\u3082\u826f\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```yaml:\n# ========================================================\n# stat\u3092\u4f7f\u7528\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u7d50\u679c\u3092XXXXExists\u306b\u767b\u9332\u3059\u308b\n# ========================================================\n  stat: path=/tmp/XXXXX\n  register: XXXXexists\n```\n\n```yaml:\n# ========================================================\n# XXXXExists\u306b\u4fdd\u5b58\u3057\u305f\u60c5\u5831\u304b\u3089/tmp/XXXXX\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u3060\u3051tar\u30b3\u30de\u30f3\u30c9\u3092\n#\u5b9f\u884c\u3059\u308b\n# ========================================================\n  command: tar zxvf /tmp/XXXXX -C /tmp/YYYY/.\n  when: not tomcatexists.stat.exists\n```\n\n\n#####\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3/\u30aa\u30fc\u30ca\u30fc\u306e\u8a2d\u5b9a (file\u30e2\u30b8\u30e5\u30fc\u30eb)\n\u4eca\u307e\u3067\u3082\u6ca2\u5c71\u51fa\u3066\u304d\u3066\u3044\u307e\u3059\u304c\u3001file\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u884c\u3044\u307e\u3059\u3002\n\n```yaml:\nfile:\n        recurse = %YES=\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5834\u5408\u518d\u5e30\u7684\u306b\u8a2d\u5b9a%\n        group   = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u30b0\u30eb\u30fc\u30d7\u540d%\n        mode    = %\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3%\n        owner   = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005%\n        path    = %\u30d5\u30a1\u30a4\u30eb/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9%\n        state   = %file=\u30d5\u30a1\u30a4\u30eb , directory=\u30c7\u30a3\u30ec\u30af\u30c8\u30ea , absent-\u524a\u9664 , hard/link=\u30ea\u30f3\u30af , touch=touch%\n```\nfile\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3044\u3046\u540d\u524d\u3067\u3059\u304c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5bfe\u3057\u3066\u3082\u5b9f\u884c\u53ef\u80fd\u3067\u3059\u3002\n\u3053\u3053\u304c\u5f79\u306b\u7acb\u3061\u307e\u3059\u3002[\u30d5\u30a1\u30a4\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb(\u65e5\u672c\u8a9e)](http://qiita.com/moiwasaki/items/e2c843e255c81a65746c)\n\n\n\u6b21\u56de\u306f\u300c[216.selenium\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u914d\u7f6e]\u300d\u306b\u3064\u3044\u3066\u3002\n\n<b><font color=\"#ff6633\">\u9023\u8f09\u306e\u76ee\u6b21\u306f[\u3010\u3053\u3061\u3089\u3011](http://qiita.com/CsFactoryitter/items/6b8308b96afafd61ce5f)\u3067\u3059\u3002</font></b>\n", "tags": ["Ansible", "YAML", "Java", "Tomcat", "vagrant"]}