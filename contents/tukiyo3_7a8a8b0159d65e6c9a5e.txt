{"tags": ["Terraform", "AWS"], "context": " More than 1 year has passed since last update.\n\n\u53c2\u8003\n\nChange Infrastructure - Terraform by HashiCorp\nterraform\u3067ssh\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b - Qiita\n\n\n\u305d\u306e\u4ed6\u30ea\u30f3\u30af\u96c6\n\nHeroku\n\n\nTerraform \u3067 Ruboty-Gacha \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u3092 Heroku \u306b\u69cb\u7bc9 - Qiita\n\n\nDigitalOcean\n\n\nTerraform \u3092 Digital Ocean \u3067\u89e6\u3063\u3066\u307f\u305f (\u521d\u7d1a\u7de8) - Qiita\n\n\nGCE\n\n\nTerraform 0.2.2 \u3067 GCE + Ansible \u3092\u8a66\u3057\u3066\u307f\u305f - Qiita\nTerraform 0.2 \u3067 Google Compute Engine \u3092\u8a66\u3057\u3066\u307f\u305f (\u521d\u7d1a\u7de8) - Qiita\n\n\nAWS\n\n\nTerraform\u3067AWS(EC2)\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u7ba1\u7406 - Qiita\nTerraform\u3067AWS S3\u30d0\u30b1\u30c3\u30c8\u3092\u64cd\u4f5c - Qiita\n\n\n\n\n\nterraform\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nhttp://www.terraform.io/downloads.html\nv0.6.0 (2015/7/11)\n\n\nterraform\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\naccess_key\u3068secret_key\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\n\n\nEC2\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 -> \u53f3\u4e0a\u306eAWS\u306b\u3088\u3046\u3053\u305d -> \u8a8d\u8a3c\u60c5\u5831 -> \u30e6\u30fc\u30b6 -> \u30e6\u30fc\u30b6\u64cd\u4f5c -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u7ba1\u7406 -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u4f5c\u6210 -> \u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID, \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n\n\n\n\nexample.et\nprovider \"aws\" {\n    access_key = \"XXXXXXXXXXXXXXXXXXXX\"\n    secret_key = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\"\n    region = \"ap-northeast-1\"\n}\n\nresource \"aws_instance\" \"example\" {\n    ami = \"ami-cbf90ecb\" #AmazonLinux\n    #ami = \"ami-936d9d93\" #Ubuntu\n    instance_type = \"t2.micro\"\n    key_name = \"aws_key1\"\n    security_groups = [\"${aws_security_group.default.name}\"]\n}\n\n# SSH access from anywhere\nresource \"aws_security_group\" \"default\" {\n    name = \"terraform_example\"\n    description = \"Used in the terraform\"\n    ingress {\n        from_port = 22 #\u9069\u5b9c\u5909\u66f4\n        to_port = 22\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n\n\n\nremote-exe\u3067\u30b3\u30de\u30f3\u30c9\u767a\u884c\u3084file\u3067\u30d5\u30a1\u30a4\u30eb\u8ee2\u9001\u304c\u3067\u304d\u308b\u3088\u3046\u3060\u304c\u81ea\u5206\u306f\u6210\u529f\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u5225\u306e\u65b9\u6cd5(itamae\u3068\u304b)\u3067\u5b9f\u65bd\u3059\u308b\u3002\n\n\nterraform\u30b3\u30de\u30f3\u30c9\n\n\u9069\u7528\n./terraform apply\n\n\n\napply\u3059\u308b\u3068\u3001\u73fe\u5728\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cterminated\u306b\u306a\u308a\u3001\u65b0\u898f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304crunning\u306b\u306a\u308b\u3002\n\n\n\u5909\u66f4\u70b9\u78ba\u8a8d\n./terraform plan\n\n\n\n\u73fe\u72b6\u78ba\u8a8d\n./terraform show\n\n\n\n\u524a\u9664\n./terraform play -destroy\n./terraform destroy\n# yes \u3092\u5165\u529b\u3002\u4e00\u5fdcEC2\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u524a\u9664(=terminated\u72b6\u614b)\u304b\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n\n\n\u8a73\u7d30\u306a\u30ed\u30b0\u3092\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\nTF_LOG=1 ./terraform show\u306a\u3069\n\n\nssh\u63a5\u7d9a\n\nGlobalIP\u78ba\u8a8d\n$ ./terraform show | grep public_ip\n  public_ip = 52.69.110.23\n\n\nAmazonLinux(ami-cbf90ecb)\u306e\u5834\u5408\nssh -i aws_key1.pem ec2-user@52.69.110.23\n\n\nUbuntu(ami-936d9d93)\u306e\u5834\u5408\nssh -i aws_key1.pem ubuntu@52.69.110.23\n\n\n\u8a2d\u5b9a\u306e\u5206\u5272\n\nterraform\u4f7f\u3044\u65b9(\u8d85\u57fa\u790e\u7de8) - Qiita\n\n\nexample.tf\nprovider \"aws\" {\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n  region = \"${var.region}\"\n}\n\nresource \"aws_instance\" \"example\" {\n    ami = \"${lookup(var.amis, var.region)}\"\n    instance_type = \"${var.instance_type}\"\n    key_name = \"aws\"\n    security_groups = [\"${aws_security_group.default.name}\"]\n}\n\nresource \"aws_security_group\" \"default\" {\n    name = \"terraform_example\"\n    description = \"Used in the terraform\"\n\n    # SSH access from anywhere\n    ingress {\n        from_port = 22\n        to_port = 22\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n\n\n\nvariables.tf\nvariable \"access_key\" {\n  description = \"AWS access key\"\n  default     = \"XXXXXXXXXXXXXXXXXXXX\"\n}\n\nvariable \"secret_key\" {\n  description = \"AWS secret access key\"\n  default     = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n\nvariable \"region\" {\n  description = \"AWS region to host your network\"\n  default     = \"ap-northeast-1\"\n}\n\nvariable \"instance_type\" {\n  default = \"t2.micro\"\n}\n\nvariable \"amis\" {\n  default = {\n    \"ap-northeast-1\" = \"ami-cbf90ecb\" #AmazonLinux\n    #\"ap-northeast-1\" = \"ami-936d9d93\" #Ubuntu14.04\n  }\n}\n\n\n\n\u5b9f\u884c\u65b9\u6cd5\u306f\u4eca\u307e\u3067\u3068\u5909\u308f\u3089\u306a\u3044(Enter\u3092\u4f55\u5ea6\u304b\u62bc\u3059\u5fc5\u8981\u306f\u3042\u308b)\n./terraform apply\n\n\n## \u53c2\u8003\n\n* [Change Infrastructure - Terraform by HashiCorp](https://www.terraform.io/intro/getting-started/change.html)\n* [terraform\u3067ssh\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b - Qiita](http://qiita.com/tjinjin/items/8ef3ce60bd0a1524c0dc)\n\n### \u305d\u306e\u4ed6\u30ea\u30f3\u30af\u96c6\n\n* Heroku\n  * [Terraform \u3067 Ruboty-Gacha \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u3092 Heroku \u306b\u69cb\u7bc9 - Qiita](http://qiita.com/tbpgr/items/0e2487af7bd698153994)\n* DigitalOcean\n  * [Terraform \u3092 Digital Ocean \u3067\u89e6\u3063\u3066\u307f\u305f (\u521d\u7d1a\u7de8) - Qiita](Terraform \u3092 Digital Ocean \u3067\u89e6\u3063\u3066\u307f\u305f (\u521d\u7d1a\u7de8) - Qiita)\n* GCE\n  * [Terraform 0.2.2 \u3067 GCE + Ansible \u3092\u8a66\u3057\u3066\u307f\u305f - Qiita](http://qiita.com/voluntas/items/2d1971c434447d935aee)\n  * [Terraform 0.2 \u3067 Google Compute Engine \u3092\u8a66\u3057\u3066\u307f\u305f (\u521d\u7d1a\u7de8) - Qiita](qiita.com/voluntas/items/3e245200f48f053a1334)\n* AWS\n  * [Terraform\u3067AWS(EC2)\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u7ba1\u7406 - Qiita](http://qiita.com/zembutsu/items/5de875ed99ac8a56a998)\n  * [Terraform\u3067AWS S3\u30d0\u30b1\u30c3\u30c8\u3092\u64cd\u4f5c - Qiita](http://qiita.com/zembutsu/items/8a8f2b6b8d74e7b8fee5)\n\n----\n\n## terraform\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n* http://www.terraform.io/downloads.html\n* v0.6.0 (2015/7/11)\n\n## terraform\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n* access_key\u3068secret_key\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\n  * EC2\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9 -> \u53f3\u4e0a\u306eAWS\u306b\u3088\u3046\u3053\u305d -> \u8a8d\u8a3c\u60c5\u5831 -> \u30e6\u30fc\u30b6 -> \u30e6\u30fc\u30b6\u64cd\u4f5c -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u7ba1\u7406 -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u4f5c\u6210 -> \u30e6\u30fc\u30b6\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a -> \u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID, \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n\n\n```js:example.et\nprovider \"aws\" {\n    access_key = \"XXXXXXXXXXXXXXXXXXXX\"\n    secret_key = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\"\n    region = \"ap-northeast-1\"\n}\n\nresource \"aws_instance\" \"example\" {\n    ami = \"ami-cbf90ecb\" #AmazonLinux\n    #ami = \"ami-936d9d93\" #Ubuntu\n    instance_type = \"t2.micro\"\n    key_name = \"aws_key1\"\n    security_groups = [\"${aws_security_group.default.name}\"]\n}\n\n# SSH access from anywhere\nresource \"aws_security_group\" \"default\" {\n    name = \"terraform_example\"\n    description = \"Used in the terraform\"\n    ingress {\n        from_port = 22 #\u9069\u5b9c\u5909\u66f4\n        to_port = 22\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n```\n\n* remote-exe\u3067\u30b3\u30de\u30f3\u30c9\u767a\u884c\u3084file\u3067\u30d5\u30a1\u30a4\u30eb\u8ee2\u9001\u304c\u3067\u304d\u308b\u3088\u3046\u3060\u304c\u81ea\u5206\u306f\u6210\u529f\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u5225\u306e\u65b9\u6cd5(itamae\u3068\u304b)\u3067\u5b9f\u65bd\u3059\u308b\u3002\n\n## terraform\u30b3\u30de\u30f3\u30c9\n\n```bash:\u9069\u7528\n./terraform apply\n```\n\n* apply\u3059\u308b\u3068\u3001\u73fe\u5728\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cterminated\u306b\u306a\u308a\u3001\u65b0\u898f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304crunning\u306b\u306a\u308b\u3002\n\n```bash:\u5909\u66f4\u70b9\u78ba\u8a8d\n./terraform plan\n```\n\n```bash:\u73fe\u72b6\u78ba\u8a8d\n./terraform show\n```\n\n```bash:\u524a\u9664\n./terraform play -destroy\n./terraform destroy\n# yes \u3092\u5165\u529b\u3002\u4e00\u5fdcEC2\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u524a\u9664(=terminated\u72b6\u614b)\u304b\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3053\u3068\u3002\n```\n\n\u8a73\u7d30\u306a\u30ed\u30b0\u3092\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\n\n```bash:\nTF_LOG=1 ./terraform show\u306a\u3069\n```\n\n# ssh\u63a5\u7d9a\n\n## GlobalIP\u78ba\u8a8d\n\n```bash:\n$ ./terraform show | grep public_ip\n  public_ip = 52.69.110.23\n```\n\n## AmazonLinux(ami-cbf90ecb)\u306e\u5834\u5408\n\n```bash:\nssh -i aws_key1.pem ec2-user@52.69.110.23\n```\n\n## Ubuntu(ami-936d9d93)\u306e\u5834\u5408\n\n```bash:\nssh -i aws_key1.pem ubuntu@52.69.110.23\n```\n\n# \u8a2d\u5b9a\u306e\u5206\u5272\n\n* [terraform\u4f7f\u3044\u65b9(\u8d85\u57fa\u790e\u7de8) - Qiita](http://qiita.com/kohey18/items/38400d8c498baa0a0ed8)\n\n```js:example.tf\nprovider \"aws\" {\n  access_key = \"${var.access_key}\"\n  secret_key = \"${var.secret_key}\"\n  region = \"${var.region}\"\n}\n\nresource \"aws_instance\" \"example\" {\n    ami = \"${lookup(var.amis, var.region)}\"\n    instance_type = \"${var.instance_type}\"\n    key_name = \"aws\"\n    security_groups = [\"${aws_security_group.default.name}\"]\n}\n\nresource \"aws_security_group\" \"default\" {\n    name = \"terraform_example\"\n    description = \"Used in the terraform\"\n\n    # SSH access from anywhere\n    ingress {\n        from_port = 22\n        to_port = 22\n        protocol = \"tcp\"\n        cidr_blocks = [\"0.0.0.0/0\"]\n    }\n}\n```\n\n```js:variables.tf\nvariable \"access_key\" {\n  description = \"AWS access key\"\n  default     = \"XXXXXXXXXXXXXXXXXXXX\"\n}\n\nvariable \"secret_key\" {\n  description = \"AWS secret access key\"\n  default     = \"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\"\n}\n\nvariable \"region\" {\n  description = \"AWS region to host your network\"\n  default     = \"ap-northeast-1\"\n}\n\nvariable \"instance_type\" {\n  default = \"t2.micro\"\n}\n\nvariable \"amis\" {\n  default = {\n    \"ap-northeast-1\" = \"ami-cbf90ecb\" #AmazonLinux\n    #\"ap-northeast-1\" = \"ami-936d9d93\" #Ubuntu14.04\n  }\n}\n```\n\n```bash:\u5b9f\u884c\u65b9\u6cd5\u306f\u4eca\u307e\u3067\u3068\u5909\u308f\u3089\u306a\u3044(Enter\u3092\u4f55\u5ea6\u304b\u62bc\u3059\u5fc5\u8981\u306f\u3042\u308b)\n./terraform apply\n```\n"}