{"context": " More than 1 year has passed since last update.\n\nCentOS7 + Apache2 \u3067\u7279\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u306f\u307e\u308b\n\n\u307e\u3068\u3081\nSELinux\u306e\u305b\u3044\u3067\u3059\uff0e\n\u8a2d\u5b9a\u3092\u5909\u3048\u308b\u304b\u7121\u52b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\uff08\u53c2\u8003\uff1a http://www.hoge256.net/2014/10/1200.html \uff09\nmod_security \u3092\u5c0e\u5165\u3057\u3066\u3044\u308b\u65b9\u306f\u305d\u3061\u3089\u306e\u8a2d\u5b9a\u3082\u5ff5\u306e\u305f\u3081\u898b\u76f4\u3055\u308c\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\uff0e\n\n\n\u80cc\u666f\n\u3068\u3042\u308bCMS\u3092\u5c0e\u5165\u3059\u308b\u969b\uff0c\n\u3075\u3068\u601d\u3044\u7acb\u3063\u3066\u666e\u6bb5\u306fXAMPP\u306a\u3069\u3067\u624b\u8efd\u306b\u74b0\u5883\u69cb\u7bc9\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3092\uff0c\nyum\u3067Apache\u306a\u3069\u3092\u305d\u308c\u305e\u308c\u5165\u308c\u3066\u8a2d\u5b9a\u3057\u3066\u307f\u3088\u3046\u3068\u3057\u305f\u3068\u3053\u308d\uff0c\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30c7\u30fc\u30bf\u306e\u66f8\u304d\u8fbc\u307f\u304c\u3067\u304d\u305a\u306f\u307e\u308b\uff0e\n\n\u73fe\u8c61\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306f777\u306b\u3082\u95a2\u308f\u3089\u305a\uff0c\nCMS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u300c\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u300d\u3068\u6012\u308b\uff0e\nphp\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u3093\u3067\u307f\u3066\u3082\u66f8\u304d\u8fbc\u307f\u306f\u3067\u304d\u306a\u3044\n\nsample.php\n<?php\n$fname = \"dummy\";\ntry{\n    $fp = fopen( $fname, \"w\" );\n} catch (ErrorException $e) {\n    print($e);\n}\nif( $fp ){\necho __LINE__.\": OK\".PHP_EOL;\n    fputs($fp, date(\"Ymd H:i:s\"));\n    fclose( $fp );\n}\necho __LINE__.\": OK\".PHP_EOL;\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u304f\u308b\nWarning: fopen(dummy): failed to open stream: Permission denied in /var/www/html/sample.php on line 4\nmod_security \u3092\u5165\u308c\u3066\u3044\u305f\u306e\u3067\u3053\u308c\u304c\u60aa\u3055\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u306a\uff1f\n\u3068\u601d\u3063\u3066\u5207\u3063\u3066\u307f\u305f\u308a\u3059\u308b\u304c\u5909\u5316\u306a\u3057\uff0e\n\n\u5bfe\u7b56\n\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\uff08 http://www.hoge256.net/2014/10/1200.html \uff09\u3092\u53c2\u8003\u306b\uff0c\nSELinux\u306e\u8a2d\u5b9a\u3092\u898b\u76f4\u3059\uff0e\n\n/var/www/html/tmp \n\u306b\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u3057\u305f\u3044\u3068\u3057\u3066\uff0c\n# semanage fcontext -a -t httpd_sys_rw_content_t \"/var/www/html/tmp(/.*)?\"\n# restorecon -R /var/www/html/tmp\n\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u884c\u3046\uff0e\n\n\u3082\u3057\u304f\u306f\u5358\u7d14\u306bSELinux\u3092\u505c\u6b62\u3059\u308b\uff0e\n# setenforce 0\n# CentOS7 + Apache2 \u3067\u7279\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3057\u3066\u306f\u307e\u308b\n\n## \u307e\u3068\u3081\nSELinux\u306e\u305b\u3044\u3067\u3059\uff0e\n\u8a2d\u5b9a\u3092\u5909\u3048\u308b\u304b\u7121\u52b9\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\uff08\u53c2\u8003\uff1a http://www.hoge256.net/2014/10/1200.html \uff09\n\nmod_security \u3092\u5c0e\u5165\u3057\u3066\u3044\u308b\u65b9\u306f\u305d\u3061\u3089\u306e\u8a2d\u5b9a\u3082\u5ff5\u306e\u305f\u3081\u898b\u76f4\u3055\u308c\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\uff0e\n\n---\n## \u80cc\u666f\n\u3068\u3042\u308bCMS\u3092\u5c0e\u5165\u3059\u308b\u969b\uff0c\n\u3075\u3068\u601d\u3044\u7acb\u3063\u3066\u666e\u6bb5\u306fXAMPP\u306a\u3069\u3067\u624b\u8efd\u306b\u74b0\u5883\u69cb\u7bc9\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u3092\uff0c\nyum\u3067Apache\u306a\u3069\u3092\u305d\u308c\u305e\u308c\u5165\u308c\u3066\u8a2d\u5b9a\u3057\u3066\u307f\u3088\u3046\u3068\u3057\u305f\u3068\u3053\u308d\uff0c\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30c7\u30fc\u30bf\u306e\u66f8\u304d\u8fbc\u307f\u304c\u3067\u304d\u305a\u306f\u307e\u308b\uff0e\n\n## \u73fe\u8c61\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306f777\u306b\u3082\u95a2\u308f\u3089\u305a\uff0c\nCMS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u300c\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u300d\u3068\u6012\u308b\uff0e\n\nphp\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u3093\u3067\u307f\u3066\u3082\u66f8\u304d\u8fbc\u307f\u306f\u3067\u304d\u306a\u3044\n\n```php:sample.php\n<?php\n$fname = \"dummy\";\ntry{\n\t$fp = fopen( $fname, \"w\" );\n} catch (ErrorException $e) {\n\tprint($e);\n}\nif( $fp ){\necho __LINE__.\": OK\".PHP_EOL;\n\tfputs($fp, date(\"Ymd H:i:s\"));\n\tfclose( $fp );\n}\necho __LINE__.\": OK\".PHP_EOL;\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u304f\u308b\n`Warning: fopen(dummy): failed to open stream: Permission denied in /var/www/html/sample.php on line 4`\n\nmod_security \u3092\u5165\u308c\u3066\u3044\u305f\u306e\u3067\u3053\u308c\u304c\u60aa\u3055\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u306a\uff1f\n\u3068\u601d\u3063\u3066\u5207\u3063\u3066\u307f\u305f\u308a\u3059\u308b\u304c\u5909\u5316\u306a\u3057\uff0e\n\n## \u5bfe\u7b56\n\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\uff08 http://www.hoge256.net/2014/10/1200.html \uff09\u3092\u53c2\u8003\u306b\uff0c\nSELinux\u306e\u8a2d\u5b9a\u3092\u898b\u76f4\u3059\uff0e\n\n> `/var/www/html/tmp` \n> \u306b\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u3057\u305f\u3044\u3068\u3057\u3066\uff0c\n> `# semanage fcontext -a -t httpd_sys_rw_content_t \"/var/www/html/tmp(/.*)?\"`\n> `# restorecon -R /var/www/html/tmp`\n> \u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092\u884c\u3046\uff0e\n\n\u3082\u3057\u304f\u306f\u5358\u7d14\u306bSELinux\u3092\u505c\u6b62\u3059\u308b\uff0e\n`# setenforce 0`\n", "tags": ["CentOS", "Apache", "SELinux", "PHP"]}