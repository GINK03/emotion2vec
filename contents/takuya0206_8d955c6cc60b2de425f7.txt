{"tags": ["Node.js", "TwitterAPI"], "context": "passport\u3092\u4f7f\u3063\u3066twitter\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306e\u8a8d\u8a3c\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u3089\uff13\u6642\u9593\u307b\u3069\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u65e5\u672c\u8a9e\u306e\u60c5\u5831\u304c\u3042\u307e\u308a\u51fa\u3066\u3053\u306a\u304b\u3063\u305f\u306e\u3067\u81ea\u5206\u7528\u306b\u30e1\u30e2\u3002\u5c1a\u3001Node.js\u306eExpress\u3092\u4f7f\u3063\u3066\u958b\u767a\u4e2d\u3067\u3059\u3002\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\n\nexpress\npassport\npassport-twitter\nexpress-session\n\n\u307e\u3059\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30fb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002passport\u306f\u624b\u8efd\u306bSNS\u8a8d\u8a3c\u3092\u5b9f\u88c5\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u3054\u3068\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n\nTwitter Apps\u306b\u767b\u9332\n\u8a8d\u8a3c\u306b\u306fkey\u3068access token\u304c\u5fc5\u8981\u306a\u306e\u3067\u3053\u3053\u304b\u3089\u767b\u9332\u3057\u307e\u3059\u3002\u958b\u767a\u7528\u3067\u3042\u308c\u3070\u3001URL\u3068callback URL\u306b http://localhost:8000 \u306a\u3069\u3068\u66f8\u304d\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\u3053\u308c\u3060\u3068\u5f3e\u304b\u308c\u307e\u3059\u3002http://127.0.0.1:8000/ \u3068\u66f8\u304d\u307e\u3057\u3087\u3046\u3002\u305d\u306e\u5f8c\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u8a8d\u8a3c\u3092\u8a66\u3059\u3068\u304d\u306f\u3001localhost\u3067\u306f\u306a\u304f\u3001127.0.0.1\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u79c1\u306f\u524d\u8005\u3067\u3084\u3063\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u304c\u51fa\u7d9a\u3051\u3066\u82e6\u3057\u307f\u307e\u3057\u305f\u3002\n\nAdditional Permissions\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\u3057\u305f\u3089\u3001Permission\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Additional Permissions\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u307e\u3057\u3087\u3046\u3002\u305d\u306e\u969b\u3001Privacy Policy URL\u3068Terms of Service URL\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306fURL\u5148\u306e\u4e2d\u8eab\u306f\u7cbe\u67fb\u3055\u308c\u307e\u305b\u3093\uff08\u304a\u305d\u3089\u304f\uff09\u3002\u50d5\u306e\u5834\u5408\u306f\u3059\u3050\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u627f\u8a8d\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u30b3\u30fc\u30c9\n\u6e96\u5099\u304c\u51fa\u6765\u305f\u3089\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u30b3\u30fc\u30c9\u306e\u89e3\u8aac\u306f\u7279\u306b\u3057\u307e\u305b\u3093\u3002\n\napp.js\n// \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u3080\nvar session = require('express-session');\nvar passport = require('passport');\nvar TwitterStrategy = require('passport-twitter').Strategy;\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u3078\u306e\u4fdd\u5b58\u3068\u8aad\u307f\u51fa\u3057\npassport.serializeUser(function (user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function (obj, done) {\n  done(null, obj);\n});\n\n// \u8a8d\u8a3c\u306e\u8a2d\u5b9a\npassport.use(new TwitterStrategy({\n  consumerKey: info.TWITTER_API_KEY,\n  consumerSecret: info.TWITTER_API_SECRET,\n  callbackURL: \"http://127.0.0.1:8000/auth/twitter/callback\",\n  includeEmail: true // \u3053\u308c\u5927\u4e8b\uff01\u3053\u308c\u304c\u306a\u3044\u3068Email\u306f\u51fa\u529b\u3055\u308c\u306a\u3044\uff01\n},\n// \u8a8d\u8a3c\u5f8c\u306e\u30a2\u30af\u30b7\u30e7\u30f3\nfunction(accessToken, refreshToken, profile, done){\n  process.nextTick(function(){\n    console.log(profile); //\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\n    return done(null, profile);\n  });\n}\n));\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\napp.use(session({\n  secret: info.SESSION_SECRET,\n  resave: false,\n  saveUninitialized: false\n}));\napp.use(passport.initialize());\napp.use(passport.session());\n\n// \u6307\u5b9a\u306epath\u3067\u8a8d\u8a3c\napp.get('/auth/twitter',\n  passport.authenticate('twitter'));\n\n// callback\u5f8c\u306e\u8a2d\u5b9a\napp.get('/auth/twitter/callback',\n  passport.authenticate('twitter', {failureRedirect: '/login' }),\n  function(req, res) {\n    res.redirect('/'); \n  });\n\n\n\nnew TwitterStrategy\u3067 \"includeEmail: true\"\u3068\u3059\u308b\u306e\u304c\u91cd\u8981\u3067\u3059\u3002Github\u3068\u304b\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u8a8d\u8a3c\u3092\u4f5c\u308b\u3068\u304d\u306f\u3001\u30b5\u30af\u30c3\u3068email\u304c\u53d6\u308c\u308b\u306e\u3067\u3059\u304c\u3001Twitter\u3067\u306f\u8a18\u8f09\u3057\u305f\u3088\u3046\u306a\u9762\u5012\u306a\u624b\u9806\u304c\u8981\u308a\u307e\u3059\u3002Twitter Developer\u3067\u30a2\u30d7\u30ea\u306e\u767b\u9332\u3060\u3051\u3067\u306a\u304f\u3001additional request\u306e\u7533\u8acb\u3068includeEmail\u3092true\u306b\u3059\u308b\u3053\u3068\u3001\u50d5\u306f\u3053\u3053\u3067\uff13\u6642\u9593\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u540c\u3058\u3088\u3046\u306a\u4eba\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u53c2\u8003\n\njaredhanson/passport-twitter\nGet user email #67\nTwitter Developer Documentation/GET account/verify_credentials\n\n[passport](http://passportjs.org/)\u3092\u4f7f\u3063\u3066twitter\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306e\u8a8d\u8a3c\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u3089\uff13\u6642\u9593\u307b\u3069\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u65e5\u672c\u8a9e\u306e\u60c5\u5831\u304c\u3042\u307e\u308a\u51fa\u3066\u3053\u306a\u304b\u3063\u305f\u306e\u3067\u81ea\u5206\u7528\u306b\u30e1\u30e2\u3002\u5c1a\u3001Node.js\u306eExpress\u3092\u4f7f\u3063\u3066\u958b\u767a\u4e2d\u3067\u3059\u3002\n\n## \u30e9\u30a4\u30d6\u30e9\u30ea\n- express\n- passport\n- passport-twitter\n- express-session\n\n\u307e\u3059\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30fb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002passport\u306f\u624b\u8efd\u306bSNS\u8a8d\u8a3c\u3092\u5b9f\u88c5\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u3054\u3068\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n## Twitter Apps\u306b\u767b\u9332\n\u8a8d\u8a3c\u306b\u306fkey\u3068access token\u304c\u5fc5\u8981\u306a\u306e\u3067[\u3053\u3053](https://apps.twitter.com/)\u304b\u3089\u767b\u9332\u3057\u307e\u3059\u3002\u958b\u767a\u7528\u3067\u3042\u308c\u3070\u3001URL\u3068callback URL\u306b http://localhost:8000 \u306a\u3069\u3068\u66f8\u304d\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3001\u3053\u308c\u3060\u3068\u5f3e\u304b\u308c\u307e\u3059\u3002http://127.0.0.1:8000/ \u3068\u66f8\u304d\u307e\u3057\u3087\u3046\u3002\u305d\u306e\u5f8c\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u8a8d\u8a3c\u3092\u8a66\u3059\u3068\u304d\u306f\u3001localhost\u3067\u306f\u306a\u304f\u3001127.0.0.1\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u79c1\u306f\u524d\u8005\u3067\u3084\u3063\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u304c\u51fa\u7d9a\u3051\u3066\u82e6\u3057\u307f\u307e\u3057\u305f\u3002\n\n### Additional Permissions\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u767b\u9332\u3057\u305f\u3089\u3001Permission\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Additional Permissions\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u307e\u3057\u3087\u3046\u3002\u305d\u306e\u969b\u3001Privacy Policy URL\u3068Terms of Service URL\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306fURL\u5148\u306e\u4e2d\u8eab\u306f\u7cbe\u67fb\u3055\u308c\u307e\u305b\u3093\uff08\u304a\u305d\u3089\u304f\uff09\u3002\u50d5\u306e\u5834\u5408\u306f\u3059\u3050\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u627f\u8a8d\u3055\u308c\u307e\u3057\u305f\u3002\n\n## \u30b3\u30fc\u30c9\n\u6e96\u5099\u304c\u51fa\u6765\u305f\u3089\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u30b3\u30fc\u30c9\u306e\u89e3\u8aac\u306f\u7279\u306b\u3057\u307e\u305b\u3093\u3002\n\n```app.js\n// \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8aad\u307f\u8fbc\u3080\nvar session = require('express-session');\nvar passport = require('passport');\nvar TwitterStrategy = require('passport-twitter').Strategy;\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u3078\u306e\u4fdd\u5b58\u3068\u8aad\u307f\u51fa\u3057\npassport.serializeUser(function (user, done) {\n  done(null, user);\n});\n\npassport.deserializeUser(function (obj, done) {\n  done(null, obj);\n});\n\n// \u8a8d\u8a3c\u306e\u8a2d\u5b9a\npassport.use(new TwitterStrategy({\n  consumerKey: info.TWITTER_API_KEY,\n  consumerSecret: info.TWITTER_API_SECRET,\n  callbackURL: \"http://127.0.0.1:8000/auth/twitter/callback\",\n  includeEmail: true // \u3053\u308c\u5927\u4e8b\uff01\u3053\u308c\u304c\u306a\u3044\u3068Email\u306f\u51fa\u529b\u3055\u308c\u306a\u3044\uff01\n},\n// \u8a8d\u8a3c\u5f8c\u306e\u30a2\u30af\u30b7\u30e7\u30f3\nfunction(accessToken, refreshToken, profile, done){\n  process.nextTick(function(){\n    console.log(profile); //\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\n    return done(null, profile);\n  });\n}\n));\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\napp.use(session({\n  secret: info.SESSION_SECRET,\n  resave: false,\n  saveUninitialized: false\n}));\napp.use(passport.initialize());\napp.use(passport.session());\n\n// \u6307\u5b9a\u306epath\u3067\u8a8d\u8a3c\napp.get('/auth/twitter',\n  passport.authenticate('twitter'));\n\n// callback\u5f8c\u306e\u8a2d\u5b9a\napp.get('/auth/twitter/callback',\n  passport.authenticate('twitter', {failureRedirect: '/login' }),\n  function(req, res) {\n    res.redirect('/'); \n  });\n\n```\n\nnew TwitterStrategy\u3067 \"includeEmail: true\"\u3068\u3059\u308b\u306e\u304c\u91cd\u8981\u3067\u3059\u3002Github\u3068\u304b\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u8a8d\u8a3c\u3092\u4f5c\u308b\u3068\u304d\u306f\u3001\u30b5\u30af\u30c3\u3068email\u304c\u53d6\u308c\u308b\u306e\u3067\u3059\u304c\u3001Twitter\u3067\u306f\u8a18\u8f09\u3057\u305f\u3088\u3046\u306a\u9762\u5012\u306a\u624b\u9806\u304c\u8981\u308a\u307e\u3059\u3002Twitter Developer\u3067\u30a2\u30d7\u30ea\u306e\u767b\u9332\u3060\u3051\u3067\u306a\u304f\u3001additional request\u306e\u7533\u8acb\u3068includeEmail\u3092true\u306b\u3059\u308b\u3053\u3068\u3001\u50d5\u306f\u3053\u3053\u3067\uff13\u6642\u9593\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u540c\u3058\u3088\u3046\u306a\u4eba\u306e\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n## \u53c2\u8003\n1. [jaredhanson/passport-twitter](https://github.com/jaredhanson/passport-twitter)\n2. [Get user email #67](https://github.com/jaredhanson/passport-twitter/issues/67)\n3. [Twitter Developer Documentation/GET account/verify_credentials] (https://dev.twitter.com/rest/reference/get/account/verify_credentials)\n\n \n"}