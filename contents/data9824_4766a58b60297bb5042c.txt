{"context": " More than 1 year has passed since last update.PRML\u56f310.2(a)\u3068\u540c\u69d8\u306b\u3001\u76f8\u95a2\u306e\u3042\u308b2\u3064\u306e\u5909\u6570z=(z1,z2)Tz=(z1,z2)T\\mathbf{z}=(z_1,z_2)^T\u306b\u3064\u3044\u3066\u306e\u30ac\u30a6\u30b9\u5206\u5e03\np(\\mathbf{z})=N(\\mathbf{z}|\\mathbf{\\mu},\\mathbf{\\Lambda}^{-1}),\\ \n\\mathbf{\\mu}=\\left(\\begin{array}{c}\n\\mu_1 \\\\\n\\mu_2\n\\end{array}\\right),\\ \n\\mathbf{\\Lambda}=\\left(\\begin{array}{cc}\n\\Lambda_{11} & \\Lambda_{12} \\\\\n\\Lambda_{12} & \\Lambda_{22}\n\\end{array}\\right)\n\np(z)=N(z|\u03bc,\u039b\u22121),\u00a0\u03bc=(\u03bc1\u03bc2),\u00a0\u039b=(\u039b11\u039b12\u039b12\u039b22)p(z)=N(z|\u03bc,\u039b\u22121),\u00a0\u03bc=(\u03bc1\u03bc2),\u00a0\u039b=(\u039b11\u039b12\u039b12\u039b22){p(\\mathbf{z})=N(\\mathbf{z}|\\mathbf{\\mu},\\mathbf{\\Lambda}^{-1}),\\ \n\\mathbf{\\mu}=\\left(\\begin{array}{c}\n\\mu_1 \\\\\n\\mu_2\n\\end{array}\\right),\\ \n\\mathbf{\\Lambda}=\\left(\\begin{array}{cc}\n\\Lambda_{11} & \\Lambda_{12} \\\\\n\\Lambda_{12} & \\Lambda_{22}\n\\end{array}\\right)\n\n}\n\u3092\u3001\u5206\u89e3\u3057\u305f\u30ac\u30a6\u30b9\u5206\u5e03q(z)=q1(z1)q2(z2)q(z)=q1(z1)q2(z2)q(\\mathbf{z})=q_1(z_1)q_2(z_2)\u3067\u5909\u5206\u8fd1\u4f3c\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u5143\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u3068\u8fd1\u4f3c\u3057\u305f\u5206\u5e03\u305d\u308c\u305e\u308c\u306b\u3064\u3044\u3066\u3001\u6a19\u6e96\u504f\u5dee\u306e1,2,3\u500d\u306e\u7b49\u9ad8\u7dda\u3092\u63cf\u753b\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u5909\u5206\u8fd1\u4f3c\u306b\u3088\u308a\u6700\u9069\u306a\u56e0\u5b50q\u22c61(z1),q\u22c62(z2)q\u22c61(z1),q\u22c62(z2)q_1^\\star(z_1), q_2^\\star(z_2)\u3092\u6c42\u3081\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nq_1^\\star(z_1)=N(z_1|m_1,\\Lambda_{11}^{-1}),\\ \nm_1=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nq_2^\\star(z_2)=N(z_2|m_2,\\Lambda_{22}^{-1}),\\ \nm_2=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\n\nq\u22c61(z1)=N(z1|m1,\u039b\u2212111),\u00a0m1=\u03bc1\u2212\u039b\u2212111\u039b12(Ez2[z2]\u2212\u03bc2)q\u22c62(z2)=N(z2|m2,\u039b\u2212122),\u00a0m2=\u03bc2\u2212\u039b\u2212122\u039b12(Ez1[z1]\u2212\u03bc1)q\u22c61(z1)=N(z1|m1,\u039b\u2212111),\u00a0m1=\u03bc1\u2212\u039b\u2212111\u039b12(Ez2[z2]\u2212\u03bc2)q\u22c62(z2)=N(z2|m2,\u039b\u2212122),\u00a0m2=\u03bc2\u2212\u039b\u2212122\u039b12(Ez1[z1]\u2212\u03bc1){q_1^\\star(z_1)=N(z_1|m_1,\\Lambda_{11}^{-1}),\\ \nm_1=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nq_2^\\star(z_2)=N(z_2|m_2,\\Lambda_{22}^{-1}),\\ \nm_2=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\n\n}\nEz1[z1],Ez2[z2]Ez1[z1],Ez2[z2]E_{z_1}[z_1], E_{z_2}[z_2]\u306f\u3001\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u4e0e\u3048\u3089\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nE_{z_1}[z_1]=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nE_{z_2}[z_2]=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\nEz1[z1]=\u03bc1\u2212\u039b\u2212111\u039b12(Ez2[z2]\u2212\u03bc2)Ez2[z2]=\u03bc2\u2212\u039b\u2212122\u039b12(Ez1[z1]\u2212\u03bc1)Ez1[z1]=\u03bc1\u2212\u039b\u2212111\u039b12(Ez2[z2]\u2212\u03bc2)Ez2[z2]=\u03bc2\u2212\u039b\u2212122\u039b12(Ez1[z1]\u2212\u03bc1){E_{z_1}[z_1]=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nE_{z_2}[z_2]=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\n}\n\u3053\u306e\u5834\u5408\u3001PRML\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001q\u22c61(z1),q\u22c62(z2)q\u22c61(z1),q\u22c62(z2)q_1^\\star(z_1), q_2^\\star(z_2)\u306f\u89e3\u6790\u7684\u306b\u6c42\u307e\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u9069\u5f53\u306a\u521d\u671f\u5024\u304b\u3089\u521d\u3081\u3066\u3001q\u22c61(z1)q_1^\\star(z_1)\u3068q\u22c62(z2)q_2^\\star(z_2)\u3092\u4ea4\u4e92\u306b\u66f4\u65b0\u3057\u3066\u3044\u304f\u624b\u6cd5\u3067q(z)q(\\mathbf{z})\u3092\u6c42\u3081\u3066\u3044\u307e\u3059\u3002\n\nlibrary(plotrix)\nframe()\nset.seed(0)\npar(mfrow=c(3, 3))\npar(mar=c(2.3, 2.5, 1, 0.1))\npar(mgp=c(1.3, .5, 0))\ncolors <- hsv(seq(0.3, 1, 0.01), 0.2, 1)\nz1range <- c(0, 1)\nz2range <- c(0, 1)\nz1 <- seq(z1range[1], z1range[2], 0.01)\nz2 <- seq(z2range[1], z2range[2], 0.01)\n\n# \u771f\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\nmu <- c(.5, .5)\nL11 <- 420\nL12 <- -400\nL22 <- 420\nL <- matrix(c(L11, L12, L12, L22), 2)\nsigma <- solve(L)\n\n# E[z2]\u3092\u9069\u5f53\u306a\u521d\u671f\u5024\u306b\u8a2d\u5b9a\u3059\u308b\nEz2 <- 1\n\nfor (iteration in 0:40) {\n    # \u56e0\u5b50 q1(z1)=N(z1|m1,L11^-1) \u3092\u6c42\u3081\u308b\n    m1 <- mu[1] - L12 / L11 * (Ez2 - mu[2])\n    Ez1 <- m1  # E[N(z|u,s^2)] = u\n\n    # \u56e0\u5b50 q2(z2)=N(z2|m2,L22^-1) \u3092\u6c42\u3081\u308b\n    m2 <- mu[2] - L12 / L22 * (Ez1 - mu[1])\n    Ez2 <- m2  # E[N(z|u,s^2)] = u\n\n    cat(paste(\"m1=\", m1, \" m2=\", m2, \"\\n\"))\n    if (iteration %% 5 == 0) {\n        # \u8fd1\u4f3c\u3057\u305f\u5206\u5e03\u3092\u63cf\u753b\u3059\u308b\n        q <- outer(z1, z2, function(z1, z2) {\n            dnorm(z1, m1, sqrt(L11 ^ -1)) * dnorm(z2, m2, sqrt(L22 ^ -1))\n            });\n        image(z1, z2, q, xlim=z1range, ylim=z2range, col=colors)\n        for (i in 1:3) {\n            draw.ellipse(m1, m2, sqrt(L11 ^ -1) * i, sqrt(L22 ^ -1) * i, 0,\n                border=4)\n        }\n\n        # \u771f\u306e\u5206\u5e03\u3092\u63cf\u753b\u3059\u308b\n        e <- eigen(sigma)\n        for (i in 1:3) {\n            draw.ellipse(mu[1], mu[2], sqrt(e$values[1]) * i, sqrt(e$values[2]) * i,\n                atan2(e$vectors[2, 1], e$vectors[1, 1]) / pi * 180,\n                border=3)\n        }\n\n        legend(\"bottomright\", c(\n            expression(p(bold(z))), \n            expression(q(bold(z)))\n            ), col=c(3, 4), lty=1, bg=\"gray\")\n        title(paste0(\"#\", iteration))\n    }\n\n}\n\nPRML\u56f310.2(a)\u3068\u540c\u69d8\u306b\u3001\u76f8\u95a2\u306e\u3042\u308b2\u3064\u306e\u5909\u6570$\\mathbf{z}=(z_1,z_2)^T$\u306b\u3064\u3044\u3066\u306e\u30ac\u30a6\u30b9\u5206\u5e03\n\n```math\np(\\mathbf{z})=N(\\mathbf{z}|\\mathbf{\\mu},\\mathbf{\\Lambda}^{-1}),\\ \n\\mathbf{\\mu}=\\left(\\begin{array}{c}\n\\mu_1 \\\\\n\\mu_2\n\\end{array}\\right),\\ \n\\mathbf{\\Lambda}=\\left(\\begin{array}{cc}\n\\Lambda_{11} & \\Lambda_{12} \\\\\n\\Lambda_{12} & \\Lambda_{22}\n\\end{array}\\right)\n\n```\n\n\u3092\u3001\u5206\u89e3\u3057\u305f\u30ac\u30a6\u30b9\u5206\u5e03$q(\\mathbf{z})=q_1(z_1)q_2(z_2)$\u3067\u5909\u5206\u8fd1\u4f3c\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u5143\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u3068\u8fd1\u4f3c\u3057\u305f\u5206\u5e03\u305d\u308c\u305e\u308c\u306b\u3064\u3044\u3066\u3001\u6a19\u6e96\u504f\u5dee\u306e1,2,3\u500d\u306e\u7b49\u9ad8\u7dda\u3092\u63cf\u753b\u3057\u307e\u3059\u3002\n\n\n\u307e\u305a\u3001\u5909\u5206\u8fd1\u4f3c\u306b\u3088\u308a\u6700\u9069\u306a\u56e0\u5b50$q_1^\\star(z_1), q_2^\\star(z_2)$\u3092\u6c42\u3081\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```math\nq_1^\\star(z_1)=N(z_1|m_1,\\Lambda_{11}^{-1}),\\ \nm_1=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nq_2^\\star(z_2)=N(z_2|m_2,\\Lambda_{22}^{-1}),\\ \nm_2=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\n\n```\n\n$E_{z_1}[z_1], E_{z_2}[z_2]$\u306f\u3001\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u5e73\u5747\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u4e0e\u3048\u3089\u308c\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```math\nE_{z_1}[z_1]=\\mu_1-\\Lambda_{11}^{-1}\\Lambda_{12}(E_{z_2}[z_2]-\\mu_2) \\\\\nE_{z_2}[z_2]=\\mu_2-\\Lambda_{22}^{-1}\\Lambda_{12}(E_{z_1}[z_1]-\\mu_1)\n```\n\n\u3053\u306e\u5834\u5408\u3001PRML\u306b\u8a18\u8f09\u306e\u901a\u308a\u3001$q_1^\\star(z_1), q_2^\\star(z_2)$\u306f\u89e3\u6790\u7684\u306b\u6c42\u307e\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u9069\u5f53\u306a\u521d\u671f\u5024\u304b\u3089\u521d\u3081\u3066\u3001$q_1^\\star(z_1)$\u3068$q_2^\\star(z_2)$\u3092\u4ea4\u4e92\u306b\u66f4\u65b0\u3057\u3066\u3044\u304f\u624b\u6cd5\u3067$q(\\mathbf{z})$\u3092\u6c42\u3081\u3066\u3044\u307e\u3059\u3002\n\n![27.GaussianVariationalInference.png](https://qiita-image-store.s3.amazonaws.com/0/12670/6bd9d1bd-e394-3b0a-9fa2-ccad672aad36.png)\n\n```r\nlibrary(plotrix)\nframe()\nset.seed(0)\npar(mfrow=c(3, 3))\npar(mar=c(2.3, 2.5, 1, 0.1))\npar(mgp=c(1.3, .5, 0))\ncolors <- hsv(seq(0.3, 1, 0.01), 0.2, 1)\nz1range <- c(0, 1)\nz2range <- c(0, 1)\nz1 <- seq(z1range[1], z1range[2], 0.01)\nz2 <- seq(z2range[1], z2range[2], 0.01)\n\n# \u771f\u306e\u30ac\u30a6\u30b9\u5206\u5e03\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\nmu <- c(.5, .5)\nL11 <- 420\nL12 <- -400\nL22 <- 420\nL <- matrix(c(L11, L12, L12, L22), 2)\nsigma <- solve(L)\n\n# E[z2]\u3092\u9069\u5f53\u306a\u521d\u671f\u5024\u306b\u8a2d\u5b9a\u3059\u308b\nEz2 <- 1\n\nfor (iteration in 0:40) {\n\t# \u56e0\u5b50 q1(z1)=N(z1|m1,L11^-1) \u3092\u6c42\u3081\u308b\n\tm1 <- mu[1] - L12 / L11 * (Ez2 - mu[2])\n\tEz1 <- m1  # E[N(z|u,s^2)] = u\n\n\t# \u56e0\u5b50 q2(z2)=N(z2|m2,L22^-1) \u3092\u6c42\u3081\u308b\n\tm2 <- mu[2] - L12 / L22 * (Ez1 - mu[1])\n\tEz2 <- m2  # E[N(z|u,s^2)] = u\n\n\tcat(paste(\"m1=\", m1, \" m2=\", m2, \"\\n\"))\n\tif (iteration %% 5 == 0) {\n\t\t# \u8fd1\u4f3c\u3057\u305f\u5206\u5e03\u3092\u63cf\u753b\u3059\u308b\n\t\tq <- outer(z1, z2, function(z1, z2) {\n\t\t\tdnorm(z1, m1, sqrt(L11 ^ -1)) * dnorm(z2, m2, sqrt(L22 ^ -1))\n\t\t\t});\n\t\timage(z1, z2, q, xlim=z1range, ylim=z2range, col=colors)\n\t\tfor (i in 1:3) {\n\t\t\tdraw.ellipse(m1, m2, sqrt(L11 ^ -1) * i, sqrt(L22 ^ -1) * i, 0,\n\t\t\t\tborder=4)\n\t\t}\n\n\t\t# \u771f\u306e\u5206\u5e03\u3092\u63cf\u753b\u3059\u308b\n\t\te <- eigen(sigma)\n\t\tfor (i in 1:3) {\n\t\t\tdraw.ellipse(mu[1], mu[2], sqrt(e$values[1]) * i, sqrt(e$values[2]) * i,\n\t\t\t\tatan2(e$vectors[2, 1], e$vectors[1, 1]) / pi * 180,\n\t\t\t\tborder=3)\n\t\t}\n\n\t\tlegend(\"bottomright\", c(\n\t\t\texpression(p(bold(z))), \n\t\t\texpression(q(bold(z)))\n\t\t\t), col=c(3, 4), lty=1, bg=\"gray\")\n\t\ttitle(paste0(\"#\", iteration))\n\t}\n\n}\n```\n", "tags": ["R", "PRML"]}