{"tags": ["docker", "KVM"], "context": " More than 1 year has passed since last update.\n\nKVM\u2192Docker\u79fb\u884c\n\n\u4eca\u56de\u3084\u3063\u305f\u30a4\u30e1\u30fc\u30b8\n\nqemu-kvm\u306eraw\u306e\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092Docker\u306b\u79fb\u884c\u307e\u3067\u306e\u30e1\u30e2\uff08NW\u306f\u6c17\u306b\u3057\u306a\u3044\uff09\nLVM\u3067 /\uff08LogVol00\uff09 \u3068 /var\uff08LogVol02\uff09 \u3092\u5207\u3063\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\nOS\u306fCentOS6.2\u3067\u6614\u4f5c\u3063\u305f\u3044\u308d\u3044\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u3084\u3064\uff08KVM\u3067\u73fe\u5f79\uff09\n\u4f59\u8a08\u306a\u3082\u306e\u3082\u3064\u3044\u3066\u304f\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\uff08\u52d5\u3051\u3070\u3044\u3044\uff09\n\n\nmemo\n$ qemu-img info node.img \nimage: node.img\nfile format: raw\nvirtual size: 20G (21474836480 bytes)\ndisk size: 20G \n\n\n\u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8\uff08\u9069\u5f53\u306a\u30c4\u30fc\u30eb\u3067\u3082\u3044\u3044\uff09\n\n$ losetup /dev/loop0 node.img\n$ kpartx -a /dev/loop0\n$ vgchange -ay\n$ lvscan\nActive 'hogehoge'\n$ mkdir -p LogVol00 LogVol02\n$ mount /dev/VolGroup00/LogVol00 LogVol00\n$ mount /dev/VolGroup00/LogVol02 LogVol02\n\n\n\u30de\u30a6\u30f3\u30c8\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u30b3\u30d4\n\n$ mkdir images\n$ rsync -a LogVol00/* images/\n$ rsync -a LogVol02/* images/var/\n$ cd images/dev\n$ mknod -m 666 null c 1 3\n$ mknod -m 666 zero c 1 5\n$ mknod -m 666 random c 1 8\n$ mknod -m 666 urandom c 1 9\n$ mkdir -m 755 pts\n$ mkdir -m 1777 shm\n$ mknod -m 666 tty c 5 0\n$ mknod -m 666 tty0 c 4 0\n$ mknod -m 666 tty1 c 4 1\n$ mknod -m 666 tty2 c 4 2\n$ mknod -m 666 tty3 c 4 3\n$ mknod -m 666 tty4 c 4 4\n$ mknod -m 600 console c 5 1\n$ mknod -m 666 full c 1 7\n$ mknod -m 600 initctl p\n$ mknod -m 666 ptmx c 5 2\n\n\ntar \u306b\u56fa\u3081\u308b\n\n$ tar --numeric-owner -Jcpf centos_base.tar.xz -C images .\n\n\nDokcer Import\n\n$ cat centos_base.tar.xz | docker import - mycentos:1\n\n\n\u78ba\u8a8d\n\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\nmycentos            1                   47bd9b4521ba        About a minute ago   788.2 MB\n$ docker run -it mycentos:1 /bin/bash \n\n# KVM\u2192Docker\u79fb\u884c\n\n## \u4eca\u56de\u3084\u3063\u305f\u30a4\u30e1\u30fc\u30b8\n\n* qemu-kvm\u306eraw\u306e\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092Docker\u306b\u79fb\u884c\u307e\u3067\u306e\u30e1\u30e2\uff08NW\u306f\u6c17\u306b\u3057\u306a\u3044\uff09\n* LVM\u3067 /\uff08LogVol00\uff09 \u3068 /var\uff08LogVol02\uff09 \u3092\u5207\u3063\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\n* OS\u306fCentOS6.2\u3067\u6614\u4f5c\u3063\u305f\u3044\u308d\u3044\u308d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u3084\u3064\uff08KVM\u3067\u73fe\u5f79\uff09\n* \u4f59\u8a08\u306a\u3082\u306e\u3082\u3064\u3044\u3066\u304f\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\uff08\u52d5\u3051\u3070\u3044\u3044\uff09\n\n## memo\n\n```bash\n$ qemu-img info node.img \nimage: node.img\nfile format: raw\nvirtual size: 20G (21474836480 bytes)\ndisk size: 20G \n```\n\n* \u30a4\u30e1\u30fc\u30b8\u3092\u30de\u30a6\u30f3\u30c8\uff08\u9069\u5f53\u306a\u30c4\u30fc\u30eb\u3067\u3082\u3044\u3044\uff09\n\n```bash\n$ losetup /dev/loop0 node.img\n$ kpartx -a /dev/loop0\n$ vgchange -ay\n$ lvscan\nActive 'hogehoge'\n$ mkdir -p LogVol00 LogVol02\n$ mount /dev/VolGroup00/LogVol00 LogVol00\n$ mount /dev/VolGroup00/LogVol02 LogVol02\n```\n\n* \u30de\u30a6\u30f3\u30c8\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u30b3\u30d4\n\n```bash\n$ mkdir images\n$ rsync -a LogVol00/* images/\n$ rsync -a LogVol02/* images/var/\n$ cd images/dev\n$ mknod -m 666 null c 1 3\n$ mknod -m 666 zero c 1 5\n$ mknod -m 666 random c 1 8\n$ mknod -m 666 urandom c 1 9\n$ mkdir -m 755 pts\n$ mkdir -m 1777 shm\n$ mknod -m 666 tty c 5 0\n$ mknod -m 666 tty0 c 4 0\n$ mknod -m 666 tty1 c 4 1\n$ mknod -m 666 tty2 c 4 2\n$ mknod -m 666 tty3 c 4 3\n$ mknod -m 666 tty4 c 4 4\n$ mknod -m 600 console c 5 1\n$ mknod -m 666 full c 1 7\n$ mknod -m 600 initctl p\n$ mknod -m 666 ptmx c 5 2\n```\n\n* tar \u306b\u56fa\u3081\u308b\n\n```bash\n$ tar --numeric-owner -Jcpf centos_base.tar.xz -C images .\n```\n\n* Dokcer Import\n\n```bash\n$ cat centos_base.tar.xz | docker import - mycentos:1\n```\n\n* \u78ba\u8a8d\n \n```bash\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\nmycentos            1                   47bd9b4521ba        About a minute ago   788.2 MB\n$ docker run -it mycentos:1 /bin/bash \n```\n"}