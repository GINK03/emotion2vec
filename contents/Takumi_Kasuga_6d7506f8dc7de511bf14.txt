{"tags": ["PHPCake", "PHP", "Backbone.js", "AWS", "amazonEC2"], "context": " More than 1 year has passed since last update. T\u00f4i \u0111\u00e3 th\u00eam m\u1ed9t table t\u00ean l\u00e0 users \u1edf b\u00e0i 5.\n\n Ch\u00e0o m\u1eebng c\u00e1c b\u1ea1n tr\u1edf l\u1ea1i\nCh\u01b0\u01a1ng 6 n\u00e0y \u0111\u01b0\u1ee3c m\u00ecnh d\u1ecbch t\u1eeb b\u00e0i vi\u1ebft CakePHP\u3067\u30c7\u30fc\u30bf\u64cd\u4f5c\u301c\u62c5\u5f53\u8005\u30a2\u30b5\u30a4\u30f3\u6a5f\u80fd\u306e\u5b9f\u88c5 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e\u3010\u7b2c6\u56de\u3011\u30de\u30cb\u30e5\u30a2\u30eb c\u1ee7a t\u00e1c gi\u1ea3 @k_shimoji , m\u00ecnh v\u1eeba d\u1ecbch v\u1eeba l\u00e0m theo n\u00ean s\u1ebd ch\u1ec9nh s\u1eeda kh\u00e1 nhi\u1ec1u sau khi m\u00ecnh hi\u1ec3u h\u01a1n v\u1ec1 b\u00e0i h\u1ecdc, r\u1ea5t mong nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 g\u00f3p \u00fd c\u1ee7a t\u1ea5t c\u1ea3 c\u00e1c b\u1ea1n.\n K\u1ebf ho\u1ea1ch b\u00e0i h\u1ecdc\n\u1ede b\u00e0i n\u00e0y ch\u00fang ta s\u1ebd th\u00eam kh\u1ea3 n\u0103ng assign nhi\u1ec7m v\u1ee5 cho c\u00e1 nh\u00e2n v\u00e0o app TODO list.\nV\u1edbi vi\u1ec7c \u0111\u00e3 th\u00eam ch\u1ee9c n\u0103ng login \u1edf b\u00e0i tr\u01b0\u1edbc, ch\u00fang ta s\u1ebd cho ph\u00e9p \u1ee9ng d\u1ee5ng n\u00e0y \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng v\u1edbi nhi\u1ec1u user.\nV\u00e0 qua \u0111\u00e2y b\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c h\u1ecdc v\u1ec1 \"association\" trong CakePHP.\n\n \"association\" trong CakePHP\nTheo b\u00e0i vi\u1ebft tr\u01b0\u1edbc th\u00ec ch\u00fang ta s\u1ebd x\u1eed l\u00fd tr\u00ean 2 table\n\nusers\ntodo_lists\n\nTuy nhi\u00ean kh\u00f4ng ph\u1ea3i ch\u1ec9 ch\u1ecdn 1 table \u0111\u1ec3 x\u1eed l\u00fd trong m\u1ed7i l\u1ea7n l\u00e0m vi\u1ec7c.\nT\u1ea1i \u1ee9ng d\u1ee5ng m\u00e0 ch\u00fang ta \u0111\u00e3 vi\u1ebft th\u1eddi \u0111i\u1ec3m n\u00e0y, b\u1ea1n c\u1ea7n Sellect b\u1eb1ng c\u00e1ch ch\u1ecdn c\u1ea3 users v\u00e0 todo_lists, s\u1ebd hay h\u01a1n n\u1ebfu m\u00ecnh kh\u00f4ng vi\u1ebft SQL tr\u1ef1c ti\u1ebfp m\u00e0 x\u1eed l\u00fd b\u1eb1ng c\u00e1ch c\u1ee7a CakePHP, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng c\u00e1c c\u01a1 ch\u1ebf \"association\".\nB\u1ea1n c\u00f3 th\u1ec3 join c\u00e1c table b\u1eb1ng code SQL.\n\nT\u00ecm hi\u1ec3u v\u1ec1 association\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u00ecm hi\u1ec3u v\u1ec1 3 association sau\n\nbelongsTo\nhasOne\nhasMany\n\n \u300chasAndBelongsToMany\u300dN\u00f3 \u0111\u00e3 c\u00f3 s\u1eb5n n\u00ean t\u1ea5t nhi\u00ean s\u1ebd b\u1ecb b\u1ecf qua\nGi\u1ea3i th\u00edch m\u1ed7i association\n\nbelongsTo\nA belongsTo B, hay n\u00f3i c\u00e1ch kh\u00e1c, A c\u00f3 m\u1ed9t m\u1ed1i quan h\u1ec7 v\u1edbi m\u1ed9t table m\u00e0 table n\u00f3 thu\u1ed9c v\u1ec1 B, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng belongsTo association.\nV\u00ed d\u1ee5, th\u00e0nh ph\u1ea7n user trong table users, s\u1ebd c\u1ea7n c\u00f3 m\u1ed9t qu\u1ed1c t\u1ecbch \"nationality\", n\u00f3 s\u1ebd c\u00f3 m\u1ed9t table l\u00e0 \"nationality master (countries)\".\nM\u00ecnh s\u1ebd th\u00eam table countries ( ph\u1ea7n m\u1edf ngo\u1eb7c l\u00e0 c\u00e1c field trong table \u0111\u00f3 )\n- countries(id, name)\nB\u1edfi v\u00ec m\u1ed7i user s\u1ebd c\u00f3 m\u1ed9t qu\u1ed1c t\u1ecbch n\u1eb1m trong danh s\u00e1ch c\u00e1c nationality, table users s\u1ebd nh\u01b0 sau\n\nusers(id, username, country_id)\n\nB\u1ea1n c\u00f3 th\u1ec3 Sellect d\u1eef li\u1ec7u b\u1eb1ng c\u00e1ch join users.country_id v\u1edbi countries.id b\u1eb1ng c\u00e1ch vi\u1ebft \u0111o\u1ea1n SQL sau:\nselect users.id, users.username, countries.name as country_name\nfrom users inner join countries on users.country_id = countries.id\n\n\u0110\u00e2y l\u00e0 association \"belongsTo\".\nCode th\u00ec ch\u00fang ta s\u1ebd xem sau.\n\nhasOne\nhasOne l\u00e0 c\u00e1i table th\u1ee9 2 trong m\u1ed1i quan h\u1ec7 belongsTo m\u00e0 m\u00ecnh \u0111\u00e3 n\u00f3i \u1edf tr\u00ean, \u1ede v\u00ed d\u1ee5 c\u1ee7a belongsTo th\u00ec ph\u00eda users ph\u1ea3i show gi\u00e1 tr\u1ecb c\u1ee7a countries country_id, tr\u01b0\u1eddng h\u1ee3p hasOne l\u00e0 ng\u01b0\u1ee3c l\u1ea1i c\u1ee7a belongsTo, nh\u01b0 ki\u1ec3u th\u1eb1ng B ch\u1ee9a 1 th\u00e0nh ph\u1ea7n c\u1ee7a th\u1eb3ng A th\u00ec th\u1eb1ng A belongTo th\u1eb1ng B, c\u00f2n th\u1eb1ng B hasOne th\u1eb1ng A \u1ea5y.\nV\u00ed d\u1ee5 b\u1ea1n c\u00f3 1 table m\u00e0 ch\u1ee9a profile c\u1ee7a user t\u00ean l\u00e0 profiles ch\u1eb3ng h\u1ea1n.\n\nprofiles(id, user_id, description, hobbies, etc...)\n\n\u1ede tr\u01b0\u1eddng h\u1ee3p n\u00e0y, ch\u00fang ta c\u00f3 user_id \u1edf ph\u00eda profiles, qua \u0111\u00f3 m\u00ecnh c\u00f3 th\u1ec3 Sellect b\u1eb1ng c\u00e1ch join users.id v\u00e0 profiles.user_id.\n\u0110\u00e2y l\u00e0 association \"hasOne\".\n Ph\u00eda user c\u0169ng c\u00f3 th\u1ec3 c\u00f3 m\u1ed9t gi\u00e1 tr\u1ecb profile_id, nh\u01b0ng s\u1ebd c\u00f3 tr\u01b0\u1eddng h\u1ee3p c\u00f3 \"non-registered profile.\"\n\nset cho users.profile_id ch\u1ea5p nh\u1eadn gi\u00e1 tr\u1ecb null\nusers.id = profies.user_id m\u00ecnh kh\u00f4ng c\u1ea7n quan t\u00e2m.\n\u0110\u00e2y l\u00e0 t\u00f9y theo tri\u1ebft l\u00fd thi\u1ebft k\u1ebf database c\u1ee7a m\u1ed7i ng\u01b0\u1eddi, t\u1ea5t c\u1ea3 \u0111\u1ec1u ok.\n\nKhi vi\u1ebft l\u1ec7nh SQL n\u00f3 s\u1ebd nh\u01b0 th\u1ebf n\u00e0y.\nsql\nselect users.id, profiles.introduce, profiles.hobbies\nfrom users inner join profiles on users.id = profiles.user_id\n\nV\u1ec1 code th\u00ec ch\u00fang ta s\u1ebd xem sau\n\nhasMany\nhasMany s\u1eed d\u1ee5ng \u0111\u1ec3 bi\u1ec3u \u0111\u1ea1t m\u1ed1i quan h\u1ec7 m\u00e0 table n\u00e0y ch\u1ee9a n th\u00e0nh ph\u1ea7n c\u1ee7a m\u1ed9t table kh\u00e1c.\nV\u00ed d\u1ee5, b\u1ea1n c\u00f3 m\u1ed9t table ch\u1ee9a ngh\u1ec1 nghi\u1ec7p c\u1ee7a user (careers).\n\ncareers(id, user_id, introduce, name, etc...)\n\n\u1ede tr\u01b0\u1eddng h\u1ee3p n\u00e0y, c\u00f3 th\u1ec3 nhi\u1ec1u user chung ngh\u1ec1 nghi\u1ec7p (career) ,\nB\u1ea1n c\u00f3 th\u1ec3 Select b\u1eb1ng c\u00e1ch join v\u1edbi \u0111i\u1ec1u ki\u1ec7n users.id tr\u00f9ng v\u1edbi careers.user_id.\nS\u1ef1 kh\u00e1c bi\u1ec7t c\u1ee7a n\u00f3 v\u1edbi hasOne ch\u1ec9 l\u00e0 s\u1ebd l\u1ea5y nhi\u1ec1u record h\u01a1n trong m\u1ed9t l\u1ea7n.\nL\u1ec7nh SQL nh\u01b0 sau\nselect users.id, careers.introduce, careers.name\nfrom users inner join careers on users.id = careers.user_id\n\n S\u1ef1 th\u1eadt l\u00e0 trong CakePHP, m\u1ed9t khi select users v\u00e0 select careers, ngh\u0129a l\u00e0 ch\u00fang ta \u0111ang select t\u1ed5ng c\u1ed9ng t\u01b0\u01a1ng \u1ee9ng 2 l\u1ea7n.\nCode ch\u00fang ta s\u1ebd xem sau\n\n \u0110i v\u00e0o b\u00e0i h\u1ecdc\nSau khi ho\u00e0n th\u00e0nh b\u00e0i h\u1ecdc n\u00e0y th\u00ec ch\u00fang ta c\u00f3 th\u1ec3 ho\u00e0n t\u1ea5t c\u00e1c ch\u1ee9c n\u0103ng sau\n\n\u0110\u1eb7c t\u1ea3 ch\u1ee9c n\u0103ng\n\nTh\u00eam Todo\n\n\nB\u00e2y gi\u1edd th\u00ec khi th\u00eam TODO s\u1ebd c\u00f3 th\u00eam ch\u1ee9c n\u0103ng \"Ph\u00e2n c\u00f4ng nhi\u1ec7m v\u1ee5 ai s\u1ebd ph\u1ea3i l\u00e0m TODO n\u00e0y\" trong list t\u1ea5t c\u1ea3 c\u00e1c user\nDanh s\u00e1ch user, logged-in user trong danh s\u00e1ch l\u1ef1a ch\u1ecdn m\u1eb7c \u0111\u1ecbnh.\n\n\nHi\u1ec3n th\u1ecb TODO list\n\n\nHi\u1ec3n th\u1ecb \"owner\" t\u1ee9c l\u00e0 ng\u01b0\u1eddi \u0111\u00e3 th\u00eam TODO n\u00e0y , v\u00e0 hi\u1ec3n th\u1ecb ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh s\u1ebd ph\u1ea3i l\u00e0m todo n\u00e0y \u1edf c\u1ed9t \"assignee\".\n\n\nNgo\u00e0i ra ch\u00fang ta s\u1ebd th\u00eam v\u00e0o m\u1ed9t v\u00e0i gi\u1edbi h\u1ea1n sau\nCh\u1ec9 ng\u01b0\u1eddi owner m\u1edbi \u0111\u01b0\u1ee3c d\u00f9ng ch\u1ee9c n\u0103ng \"Delete\". N\u00fat \"Delete\" s\u1ebd kh\u00f4ng hi\u1ec7n v\u1edbi nh\u1eefng ng\u01b0\u1eddi kh\u00e1c.\n    - Hi\u1ec3n th\u1ecb \"details\" cho owner v\u00e0 ng\u01b0\u1eddi responsible. Kh\u00f4ng hi\u1ec3n th\u1ecb link \"Details\" cho nh\u1eefng ng\u01b0\u1eddi kh\u00e1c.\n\n\n\n\nTODO details\n\n\nM\u1ed9t v\u00e0i thay \u0111\u1ed5i c\u00e1 nh\u00e2n\n\n\n\n\nM\u00e0n h\u00ecnh\n\nM\u00e0n h\u00ecnh TODO list ( Giao di\u1ec7n h\u01a1i kh\u00e1c v\u00ec m\u00ecnh c\u00f3 v\u1ecdc v\u1ea1ch d\u00f9ng th\u00eam bootstrap v\u00e0 t\u1ef1 vi\u1ebft th\u00eam v\u00e0i ch\u1ee9c n\u0103ng m\u1edbi, \u1edf m\u1ed9t b\u00e0i vi\u1ebft t\u1edbi s\u1ebd c\u00f3 h\u01b0\u1edbng d\u1eabn v\u1ec1 bootstrap, c\u00e1c b\u1ea1n y\u00ean t\u00e2m, c\u00f2n c\u00e1c ch\u1ee9c n\u0103ng \u1ea9n vi\u1ec7c \u0111\u00e3 l\u00e0m, x\u00f3a t\u1ea5t c\u1ea3... th\u00ec c\u00e1c b\u1ea1n c\u00f3 th\u1ec3 t\u1ef1 l\u00e0m \u1edf nh\u00e0 v\u1edbi nh\u1eefng ki\u1ebfn th\u1ee9c \u0111\u00e3 h\u1ecdc )\n\n\n\nM\u00e0n h\u00ecnh TODO detail \n\n\n\n Chu\u1ea9n b\u1ecb\nPh\u1ea7n chu\u1ea9n b\u1ecb s\u1ebd gi\u1ed1ng nhau \u1edf m\u1ed7i b\u00e0i, v\u00ec v\u1eady t\u00f4i \u0111\u00e3 t\u1ed5ng h\u1ee3p n\u00f3 \u1edf m\u1ed9t entry ri\u00eang. C\u00e1c b\u1ea1n vui l\u00f2ng xem \u1edf link n\u00e0y All 12 times of study sessions in do I have use of Git - RESTful application workshops will be built on AWS ~ Web development workshop ~ - Qiita \u0111\u1ec3 chu\u1ea9n b\u1ecb .\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u1ea1o v\u00e0 l\u00e0m vi\u1ec7c tr\u00ean branch t\u00ean vol/06 tr\u01b0\u1edbc \u0111\u00e3.\n\nC\u00f2n \u0111\u00e2y l\u00e0 nh\u1eefng table v\u00e0 gi\u00e1 tr\u1ecb m\u00e0 ch\u00fang t\u00f4i \u0111\u00e3 add \u1edf b\u00e0i tr\u01b0\u1edbc, c\u00e1c b\u1ea1n ch\u01b0a xem b\u00e0i vi\u1ebft tr\u01b0\u1edbc c\u00f3 th\u1ec3 xem v\u00e0 t\u1ea1o T\u1ea1i \u0111\u00e2y.\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd th\u00eam 2 tr\u01b0\u1eddng n\u1eefa cho b\u1ea3ng todo_lists.\n\nownerID(owner)\nassignerID(assignee)\n\n\nTh\u00eam c\u1ed9t cho b\u1ea3ng TODO list\n\u0110\u1ea7u tien ch\u00fang ta \u0111\u0103ng nh\u1eadp v\u00e0o phpMyAdmin\nURL nh\u01b0 c\u0169 th\u00f4i: http://(PublicIP)/phpMyAdmin/.\nN\u1ebfu b\u1ea1n ch\u01b0a thay \u0111\u1ed5i g\u00ec th\u00ec username v\u00e0 password \u0111\u0103ng nh\u1eadp \u0111\u1ec1u l\u00e0 study.\n\nC\u1ea5u h\u00ecnh cho m\u1ed7i collum\n\n\n\nName\nData type\nlength / value\ndefault value\ncollation\nattribute\nNULL\nIndex\nA_I (AutoIncrement)\nComments\n\n\n\n\nowner\nINT\n10\nno\n\u3000\nUNSIGNED\n\u3000\n\u3000\n\u3000\nowner\n\n\nassignee\nINT\n10\nno\n\u3000\nUNSIGNED\n\u3000\n\u3000\n\u3000\nassigner\n\n\n\n\nChu\u1ea9n b\u1ecb\nB\u1eaft \u0111\u1ea7u chu\u1ea9n b\u1ecb n\u00e0o!\n- Nh\u01b0 \u0111\u00e3 n\u00f3i \u1edf tr\u00ean m\u00ecnh s\u1ebd t\u1ea1o branch vol/06 cho Git.\n- Th\u00eam m\u1ed9t column cho TODO list (todo_lists) table.\nKhi \u0111\u00e3 s\u1eb5n s\u00e0ng, ch\u00fang ta b\u1eaft \u0111\u1ea7u v\u00e0o B\u00e0i 1.\n\n B\u00e0i 1: server side\n\u1ede b\u00e0i 1, ch\u00fang ta s\u1ebd th\u1ef1c hi\u1ec7n nh\u1eefng thao t\u00e1c li\u00ean quan \u0111\u1ebfn server side c\u1ee7a \u1ee9ng d\u1ee5ng.\n\u0110\u1ec3 test ch\u01b0\u01a1ng tr\u00ecnh, s\u1eed d\u1ee5ng \"POSTMAN\" m\u00e0 ch\u00fang ta \u0111\u00e3 c\u00e0i \u0111\u1eb7t \u1edf nh\u1eefng b\u00e0i \u0111\u1ea7u ti\u00ean.\n\nPoints\nM\u1eb7c d\u00f9 c\u00f3 3 \"association\" m\u00e0 m\u00ecnh \u0111\u00e3 li\u1ec7t k\u00ea, nh\u01b0ng th\u1ef1c t\u1ebf m\u00ecnh ch\u1ec9 c\u1ea7n s\u1eed d\u1ee5ng duy nh\u1ea5t \"belongsTo\", b\u1ea1n s\u1ebd nh\u1eadn ra \u0111i\u1ec1u n\u00e0y.\nC\u01a1 m\u00e0 nh\u01b0 v\u1eady th\u00ec kh\u00f4ng th\u00fa v\u1ecb l\u1eafm, h\u00e3y c\u0169ng th\u1eed v\u1edbi c\u1ea3  \"hasMany\" v\u00e0 \"hasOne\" n\u1eefa nh\u00e9.\n\u0110\u1ea7u ti\u00ean, m\u00ecnh s\u1eed d\u1ee5ng belognsTo, v\u00e0 b\u1eaft \u0111\u1ea7u code.\n\nDanh s\u00e1ch nh\u1eefng file c\u1ea7n ch\u1ec9nh s\u1eeda\n\n\n\nThao t\u00e1c\nfile\nM\u00f4 t\u1ea3\n\n\n\n\nS\u1eeda\napp/Controller/TodoListsController.php\nSetting the find parameters\n\n\nS\u1eeda\napp/Model/TodoList.php\nAssociation settings\n\n\nS\u1eeda\napp/Controller/UsersController.php\nl\u1ea5y user-list\n\n\n\n\nTodoListsController.php\nM\u00ecnh s\u1ebd set c\u00e1c th\u00f4ng s\u1ed1 c\u1ee7a h\u00e0m find gi\u1ed1ng nh\u01b0 TodoList model.\n\nTodoListsController.php\n\u301c\u7565\u301c\n class TodoListsController extends AppController {\n\n    public function index() {\n-       $res = $this->TodoList->find('all');\n+       $query = array (\n+           'fields' => array (\n+               'TodoList.id',\n+               'TodoList.todo',\n+               'TodoList.status',\n+               'Owner.id',\n+               'Owner.name',\n+               'Assignee.id',\n+               'Assignee.name'\n+           ),\n+           'order' => \"TodoList.id\"\n+       );\n+       $res = $this->TodoList->find('all', $query);\n+       // \u6574\u5f62\n+       if (count($res) > 0) {\n+           $loginUserId = $this->Auth->user()['id'];\n+           foreach ( $res as $key => $row ) {\n+               //truong hop \u300cLogin user l\u00e0 owner\u300d\n+               $res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n+               //Truong hop\u300clogin user la Assignee\u300d\n+               $res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n+           }\n+       }\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n    public function view($id = null) {\n        $res = $this->TodoList->findById($id);\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n    public function add() {\n        $data = $this->request->data;\n+       $data['owner'] = $this->Auth->user()['id'];\n        $res = $this->TodoList->save($data);\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nTh\u00eam argument cho h\u00e0m find\n\n\nB\u1ea1n c\u1ea7n th\u00eam 2 argument $query. $Query l\u00e0 m\u1ed9t m\u1ea3ng, b\u1ea1n c\u1ea7n set nh\u01b0 sau.\n\n\n\nfields\n\n\u0110\u1ec3 get column c\u1ee7a table. B\u1ea1n kh\u00f4ng c\u1ea7n x\u00e1c \u0111\u1ecbnh c\u1ee5 th\u1ec3 n\u00f3, v\u00ec n\u00f3 s\u1ebd l\u01b0u tr\u1eef m\u1eadt kh\u1ea9u c\u1ee7a user v\u00e0 v\u00e0i th\u1ee9 kh\u00e1c, ch\u00fang ta ch\u1ec9 set nh\u1eefng th\u1ee9 c\u1ea7n thi\u1ebft.\n\n\n\norder\n\nHi\u1ec7n t\u1ea1i data \u0111ang \u0111\u01b0\u1ee3c s\u1eafp x\u1ebfp ng\u1eabu nhi\u00ean theo th\u1ee9 t\u1ef1 \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh, tuy nhi\u00ean todo_lists s\u1ebd l\u00e0 th\u1ee9 t\u1ef1 gi\u1ea3m d\u1ea7n ID trong b\u1ea3ng \u0111\u1ec3 hi\u1ec3n th\u1ecb nh\u1eefng TODO m\u1edbi nh\u1ea5t.\n\n\n\n\n\n\nX\u00e2y d\u1ef1ng data thu \u0111\u01b0\u1ee3c\n\nNh\u1eefng data m\u00ecnh thu \u0111\u01b0\u1ee3c trong b\u00e0i 1 g\u1ed3m\n\n\nN\u1ebfu ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp l\u00e0 owner, set owned = true, tr\u01b0\u1eddng h\u1ee3p ng\u01b0\u1ee3c l\u1ea1i set owned = false.\nN\u1ebfu ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp l\u00e0 assigner, set assigned = true, n\u1ebfu kh\u00f4ng ph\u1ea3i th\u00ec assigned = false.\n\n\n\n\nTodoList.php\nAssociation setting.\n\nTodoList.php\n class TodoList extends AppModel {\n+   public $belongsTo = array (\n+       'Owner' => array (\n+           'className' => 'User',\n+           'foreignKey' => 'owner',\n+       ),\n+       'Assignee' => array (\n+           'className' => 'User',\n+           'foreignKey' => 'assignee'\n+       )\n+   );\n }\n\n\n\nbelongsTo association\n\nCho m\u1ed7i l\u1ea7n xem TODO,\n\n\nTh\u00f4ng tin c\u1ee7a owner User\nTh\u00f4ng tin c\u1ee7a Assignee user\n\n\n\nCh\u00fang ta s\u1ebd setting nh\u01b0 sau.\n\nModel c\u1ee7a bi\u1ebfn s\u1ebd t\u1ea1o n\u00ean m\u1ed9t m\u1ea3ng bi\u1ebfn t\u00ean l\u00e0  $belongsTo.\n\n\nT\u00f4i \u0111\u00e3 \u0111\u1eb7t t\u00ean t\u01b0\u01a1ng \u1ee9ng trong table l\u00e0 Owner(Owner), Assignee(ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng) \nTh\u00f4ng s\u1ed1 chi ti\u1ebft c\u1ee7a (Owner) nh\u01b0 sau\n\n\n\nclassName -> T\u00ean model(User)\nTh\u00eam Foreign key cho users (C\u1ee5 th\u1ec3 l\u00e0 todo_lists.owner)\n\n\nTh\u00f4ng s\u1ed1 chi ti\u1ebft c\u1ee7a (Assignee) nh\u01b0 sau\n\n\n\nclassName -> T\u00ean model(User)\nTh\u00eam Foreign key  cho users (C\u1ee5 th\u1ec3 l\u00e0 todo_lists.assignee)\n\n\n\n\n\n\nCh\u1ee9c n\u0103ng Th\u00eam TODO\n\nB\u1ea1n ph\u1ea3i set ID c\u1ee7a ng\u01b0\u1eddi \u0111\u00f3 v\u00e0o owner.\n\n\nB\u00e2y gi\u1edd, user \u0111\u00e3 login n\u00e0o th\u1ef1c hi\u1ec7n l\u1ec7nh th\u00eam TODO s\u1ebd \u0111\u01b0\u1ee3c set l\u00e0 owner c\u1ee7a TODO \u0111\u00f3\n\n\n\n\nUsersController.php\nCh\u1ee9a c\u00e1c ch\u1ee9c n\u0103ng Login, ki\u1ec3m tra login, log out, \u0111\u0103ng k\u00fd.\n\nUsersController.php\n class UsersController extends AppController {\n\n+   public function index() {\n+       $res = $this->User->find('all', array (\n+           'fields' => array (\n+               'User.id',\n+               'User.username',\n+               'User.name'\n+           )\n+       ));\n+       $this->set(compact('res'));\n+       $this->set('_serialize', 'res');\n+   }\n+\n    public function login() {\n        $user = $this->Auth->user();\n        $res = array();\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nH\u00e0m index\n\n\nC\u00f9ng m\u1ed9t kh\u1ea3 n\u0103ng v\u1edbi TodoListController.php, b\u1ea1n c\u1ea7n c\u1ed1 \u0111\u1ecbnh field \u0111\u1ec3 hi\u1ec3u h\u00e0m find.\n\n\n\u3000Ki\u1ec3m tra k\u1ebft qu\u1ea3\nS\u1eed d\u1ee5ng POSTMAN, L\u1ea5y danh s\u00e1ch TODO list b\u1eb1ng URL (http://(PublicIP)/rest-study/todo_lists.json).\nN\u1ebfu \u0111\u01b0\u1ee3c k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1 v\u1edbi c\u1ea5u tr\u00fac t\u01b0\u01a1ng t\u1ef1 d\u01b0\u1edbi \u0111\u00e2y l\u00e0 OK.\nbelongsTo \u0111\u00e3 l\u00e0m vi\u1ec7c.\n[\n    {\n        \"TodoList\": {\n            \"id\": \"68\",\n            \"todo\": \"1 ne hihi aaaa\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"69\",\n            \"todo\": \"1 ne hihi aaaa b\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"70\",\n            \"todo\": \"1 ne hihi aaaa1213\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    }\n]\n\nNh\u01b0 k\u1ebft qu\u1ea3 c\u1ee7a t\u00f4i khi l\u00e0m theo h\u01b0\u1edbng d\u1eabn tr\u00ean:\n\n\nT\u1ed5ng k\u1ebft\nC\u00e1c b\u01b0\u1edbc thao t\u00e1c nh\u01b0 sau\n\n\n app/Controller/TodoListsController.php s\u1eeda nh\u01b0 tr\u00ean.\n\n app/Model/TodoList.php s\u1eeda nh\u01b0 tr\u00ean.\n\n app/Controller/UsersController.php s\u1eeda nh\u01b0 tr\u00ean.\n\n Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n\n Commit l\u00ean G\u1ec9t\n\nT\u00e0i li\u1ec7u tham kh\u1ea3o tr\u00ean GitHub v\u1edbi hi\u1ec3n th\u1ecb Diff\nCh\u01b0\u01a1ng 6 - B\u00e0i 1 \u00b7 suzukishouten-study/rest-study@d4fe1a4\nSang b\u00e0i 1.5 n\u00e0o.\n\n B\u00e0i 1.5. Th\u1eed s\u1eed d\u1ee5ng c\u00e1c association kh\u00e1c.\nM\u1ecdi th\u1ee9 \u0111\u00e3 ok v\u1edbi c\u00e1ch th\u1ef1c hi\u1ec7n nh\u01b0 b\u00e0i 1.\nTuy nhi\u00ean tr\u01b0\u1edbc khi sang b\u00e0i 2, c\u00e1c b\u1ea1n c\u00f3 th\u1ec3 th\u1eed s\u1eed d\u1ee5ng hasOne v\u00e0 hasMany xem sao, \u0111\u1ec3 n\u00e2ng cao tay ngh\u1ec1 t\u00ed th\u00f4i m\u00e0, hehe.\nSau khi s\u1eeda code v\u00e0 ki\u1ec3m tra x\u00e1c nh\u1eadn k\u1ebft qu\u1ea3, h\u00e3y sang b\u00e0i 2 v\u1edbi code c\u0169.\n\u1ede ph\u1ea7n test, m\u1ee5c ti\u00eau c\u1ee7a m\u00ecnh s\u1ebd l\u00e0 ch\u1ee9c n\u0103ng nh\u01b0 trong \u1ea3nh d\u01b0\u1edbi \u0111\u00e2y.\n\n user l\u00e0\n\nXuanTai\nTest5\nTest2\n\n\u0110\u00e2y l\u00e0 nh\u1eefng user \u0111\u00e3 \u0111\u01b0\u1ee3c \u0111\u0103ng k\u00fd, tuy nhi\u00ean XuanTai kh\u00f4ng th\u1ec3, xem, x\u00f3a, s\u1eeda tr\u1ea1ng th\u00e1i TODO th\u1ee9 4 ( v\u00ec anh ta kh\u00f4ng ph\u1ea3i owner c\u0169ng kh\u00f4ng ph\u1ea3i ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng), anh ta c\u00f3 to\u00e0n qy\u1ec1n \u0111\u1ed1i v\u1edbi TODO 1,2,3,7, v\u00e0 ch\u1ec9 c\u00f3 quy\u1ec1n v\u00e0o trang detail ( \u0111\u1ec3 s\u1eeda, x\u00f3a, assign ng\u01b0\u1eddi kh\u00e1c ) c\u1ee7a TODO 5 v\u00e0 TODO 6 .\n\nKi\u1ec3m tra hasOne\nCh\u00fang ta c\u1ea7n t\u1ef1 \u0111\u1eb7t \u0111i\u1ec1u ki\u1ec7n user n\u00e0o th\u00eam TODO ch\u00ednh l\u00e0 owner.\n user : todo s\u1ebd ph\u1ea3i tr\u1edf th\u00e0nh 1 : n n\u1ebfu b\u1ea1n mu\u1ed1n chuy\u1ec3n th\u00e0nh quan h\u1ec7 hasMany.\n\nChi ti\u1ebft c\u00e1c thay \u0111\u1ed5i c\u1ee7a source\n\ns\u1eeda h\u00e0m index c\u1ee7a app/Controller/UsersController.php\n\n\napp/Controller/UsersController.php\n    public function index() {\n        $res = $this->User->find('all');    //X\u00f3a nh\u1eefng field \u0111\u00e3 x\u00e1c \u0111\u1ecbnh, chuy\u1ec3n n\u00f3 th\u00e0nh comment nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y.\n//      $res = $this->User->find('all', array (\n//          'fields' => array (\n//              'User.id',\n//              'User.username',\n//              'User.name'\n//          )\n//      ));\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n\n\nset association cho app/Model/User.php\n\n\n\napp/Model/User.php\nclass User extends AppModel {\n    public $hasOne = array (\n        'TodoList' => array (\n            'className' => 'TodoList',\n            'foreignKey' => 'owner'\n        )\n    );\n}\n\n\n\u1ed4n r\u1ed3i, h\u00e3y ki\u1ec3m tra k\u1ebft qu\u1ea3 \u1edf (http://(PublicIP)/rest-study/users.json)\n\nresult\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"67\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owner\": \"68\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": null,\n            \"todo\": null,\n            \"status\": null,\n            \"owner\": null,\n            \"assignee\": null\n        }\n    }\n]\n\n\nM\u1ed7i todo s\u1ebd \u0111i k\u00e8m th\u00f4ng tin c\u00e1 nh\u00e2n c\u1ee7a m\u1ed9t user.\nN\u1ebfu ai \u0111\u00f3 kh\u00f4ng c\u00f3 TODO n\u00e0o th\u00ec m\u1ed7i th\u00e0nh ph\u1ea7n c\u1ee7a m\u1ea3ng c\u00f3 th\u1ec3 l\u00e0 null.\nCode SQL nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y, ch\u00fang ta ch\u1ea1y 2 l\u1ea7n hasMany.\nSELECT\n    `User`.`id`,\n    `User`.`username`, \n    `User`.`password`, \n    `User`.`name`, \n    `TodoList`.`id`, \n    `TodoList`.`todo`, \n    `TodoList`.`status`, \n    `TodoList`.`owner`, \n    `TodoList`.`assignee` \nFROM `study`.`users` AS `User` \n        LEFT JOIN `study`.`todo_lists` AS `TodoList` ON (`TodoList`.`owner` = `User`.`id`)  \nWHERE 1 = 1\n\nGi\u1ea3i th\u00edch v\u1ec1 l\u00fd do m\u00ecnh s\u1eed d\u1ee5ng WHERE 1 = 1 th\u00ec b\u1ea1n kh\u00f4ng c\u1ea7n quan t\u00e2m, n\u00f3 l\u00e0 m\u1ed9t ki\u1ec3u SQL, b\u1ea1n ch\u1ec9 c\u1ea7n JOIN m\u00e0 th\u00f4i.\n\nTest hasMany\nuser : todo s\u1ebd tr\u1edf th\u00e0nh 1 : n khi s\u1eed d\u1ee5ng hasMany.\n\nC\u00e1c ph\u1ea7n c\u1ea7n s\u1eeda trong source\napp/Controller/UsersController.php m\u00ecnh s\u1ebd th\u00eam m\u1ed9t state c\u1ed1 \u0111\u1ecbnh v\u1edbi hasOne.\nset association cho app/Model/User.php.\n\napp/Model/User.php\nclass User extends AppModel {\n    public $hasMany = array (\n        'TodoList' => array (\n            'className' => 'TodoList',\n            'foreignKey' => 'owner'\n        )\n    );\n}\n\n\nhasOne t\u00f4i s\u1ebd s\u1eeda th\u00e0nh hasMany\nK\u1ebft qu\u1ea3 s\u1ebd nh\u01b0 sau\n\nresult\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"Yamada\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"62\",\n                \"todo\": \"walking\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"67\"\n            },\n            {\n                \"id\": \"78\",\n                \"todo\": \"studying\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"Tanaka\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"83\",\n                \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n                \"status\": \"1\",\n                \"owner\": \"68\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"Sato\"\n        },\n        \"TodoList\": []\n    }\n]\n\n\nV\u1eady l\u00e0 b\u1eb1ng c\u00e1ch n\u00e0y, TODO \u0111\u00e3 hi\u1ec3n th\u1ecb \u0111\u00fang v\u1edbi nhi\u1ec1u TODO cho m\u1ed7i user.\n\u0110\u00e2y g\u1ecdi l\u00e0 hasMany.\nTh\u1eddi \u0111i\u1ec3m n\u00e0y th\u00ec SQL s\u1ebd ch\u1ea1y 2 l\u1ec7nh sau. M\u1ed7i l\u1ea7n ch\u1ea1y SQL th\u00ec hasMany ch\u1ea1y 2 l\u1ea7n.\n\nLan1\nSELECT `User`.`id`, `User`.`username`, `User`.`password`, `User`.`name` FROM `study`.`users` AS `User`   WHERE 1 = 1\n\n\n\nLan2\nSELECT `TodoList`.`id`, `TodoList`.`todo`, `TodoList`.`status`, `TodoList`.`owner`, `TodoList`.`assignee` FROM `study`.`todo_lists` AS `TodoList`   WHERE `TodoList`.`owner` IN (67, 68, 69)\n\n\n\u1ede l\u1ea7n 2 b\u1ea1n ph\u1ea3i select TodoList v\u1edbi owner l\u00e0 ID c\u1ee7a user m\u00e0 b\u1ea1n nh\u1eadn \u0111\u01b0\u1ee3c \u1edf l\u1ea7n 1 .\nNh\u01b0ng m\u00ecnh \u0111\u00e3 ch\u1ea1y xong r\u1ed3i n\u00ean h\u00e3y tr\u1edf l\u1ea1i ch\u1ed7 c\u0169 n\u01a1i b\u1ea1n \u0111\u00e3 s\u1eeda \u0111\u1ec3 \u0111\u1ebfn v\u1edbi b\u00e0i 2, h\u00e3y t\u1ea1o m\u1ed9t trang m\u1edbi\n\n B\u00e0i 2: Client side\n\u1ede b\u00e0i 2 n\u00e0y, m\u00ecnh s\u1ebd code ph\u1ea7n client side c\u1ee7a \u1ee9ng d\u1ee5ng.\n\nCh\u00fa\nB\u1ea1n c\u00f3 th\u1ec3 t\u1ef1 l\u00e0m h\u1ea7u h\u1ebft v\u1edbi nh\u1eefng ki\u1ebfn th\u1ee9c m\u00e0 b\u1ea1n \u0111\u00e3 c\u00f3 t\u1eeb b\u00e0i tr\u01b0\u1edbc, tuy nhi\u00ean \u1edf th\u1eddi \u0111i\u1ec3m n\u00e0y, \u0111\u1ec3 \"nh\u1eadn v\u00e0 hi\u1ec3n th\u1ecb danh s\u00e1ch user\" \u1edf ph\u1ea7n sau s\u1ebd c\u1ea7n m\u1ed9t v\u00e0i comment nh\u1ecf.\n\nDanh s\u00e1ch user \u1edf trang TODO list\n\n\n\nDanh s\u00e1ch user \u1edf trang TODO Detail\n\n\n\nB\u1eaft \u0111\u1ea7u th\u1ef1c hi\u1ec7n\n\u1ede Backbone, n\u1ebfu b\u1ea1n c\u00f3 th\u1ec3 t\u1eadn d\u1ee5ng h\u1ebft th\u1ebf m\u1ea1nh c\u1ee7a Marionette, \u0111\u1ea7u ti\u00ean th\u00ec user list s\u1ebd hi\u1ec3n th\u1ecb \u1edf View, \"Behavior\" kh\u00e1 t\u1ed1t, nh\u01b0ng t\u00f4i s\u1ebd chia s\u1ebb qua v\u00ed d\u1ee5 s\u1eed d\u1ee5ng h\u00e0m, v\u00e0 \u0111\u00e2y l\u00e0 th\u1eddi \u0111i\u1ec3m d\u00f9ng \"CakePHP Associations\" l\u00e0 ch\u00ednh, h\u00e3y nh\u1edb r\u1eb1ng s\u1ebd r\u1ea5t d\u1ec5 d\u00e0ng \u0111\u1ec3 implement n\u00f3.\nC\u1ee5 th\u1ec3\n\nNh\u1eadp URL c\u1ee7a API (http://(PublicIP)/rest-study/users.json) \u0111\u1ec3 l\u1ea5y collection c\u1ee7a user list.\nCollecton n\u00e0y \u0111\u01b0\u1ee3c d\u00f9ng v\u1edbi v\u00f2ng l\u1eb7p, N\u00f3 s\u1ebd n\u1eb1m trong tag <select> </select> trong template, Ph\u1ea7n th\u1ebb <option value =\"user id\"> user's name </ option> s\u1ebd \u0111\u01b0\u1ee3c l\u1ecdc b\u1eb1ng c\u00e1ch s\u1eed d\u1ee5ng JQuery.\n\n\u0110\u00e2y l\u00e0 c\u00e1ch l\u00e0m\nHi\u1ec7n t\u1ea1i th\u00ec t\u00f4i \u0111\u00e3 \"copy v\u00e0 paste\" \u0111\u1ec3 d\u00f9ng \u1edf c\u1ea3 TODO lists v\u00e0 TODO detail.\n(V\u00e0 n\u00f3 kh\u00f4ng DRY v\u00ec ch\u00fang ta \u0111\u00e3 vi ph\u1ea1m Don't Repeat Yourself, nh\u01b0ng th\u1eddi \u0111i\u1ec3m n\u00e0y m\u00ecnh s\u1ebd l\u00e0m nhanh \u0111\u1ec3 v\u00ed d\u1ee5 th\u00f4i !)\nV\u00e0 \u0111\u00e2y l\u00e0 ch\u00fa th\u00edch v\u1ec1 ch\u1ec9nh s\u1eeda.\n\nC\u00e1c file c\u1ea7n thay \u0111\u1ed5i\n\n\n\nThao t\u00e1c\nfile\nM\u00f4 t\u1ea3\n\n\n\n\nS\u1eeda\napp/View/Layouts/default.ctp\nS\u1eeda template\n\n\nS\u1eeda\napp/webroot/js/collections/user-collection.js\nuser collection\n\n\nS\u1eeda\napp/webroot/js/models/todo-model.js\nparse\n\n\nS\u1eeda\napp/webroot/js/views/todo-layout-view.js\n\u0110\u1ec3 \u0111\u1ecdc userlist\n\n\nS\u1eeda\napp/webroot/js/views/todo-composite-view.js\nUser list\n\n\nS\u1eeda\napp/webroot/js/views/todo-item-view.js\nHi\u1ec3n th\u1ecb c\u00e1c n\u00fat \u0111i\u1ec1u khi\u1ec3n nh\u01b0 detail, delete\n\n\nS\u1eeda\napp/webroot/js/views/todo-detail-layout-view.js\n\u0110\u1ecdc User List\n\n\nS\u1eeda\napp/webroot/js/views/todo-detail-item-view.js\nUser List\n\n\n\n\ndefault.ctp\nS\u1eeda template\n\ndefault.ctp\n\n\u301c\u3000\u7565\u3000\u301c\n  <title>\u30b7\u30f3\u30d7\u30ebTODO\u30a2\u30d7\u30ea</title>\n </head>\n <body>\n    <!-- \u30d8\u30c3\u30c0 -->\n    <div id=\"header\"></div>\n    <!-- \u30b3\u30f3\u30c6\u30f3\u30c4 -->\n    <div id=\"main\"></div>\n\n\u301c\u3000\u7565\u3000\u301c\n\n    <!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-composite-template\">\n    <textarea style=\"width:300px;height:50px\"id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n+   <select name=\"assignee\" id=\"user-list\">\n    <input type=\"button\" id=\"addTodo\" value=\"\u8ffd\u52a0\">\n    <hr>\n    <div>\n        <table border=\"1\" width=\"350px\">\n+           <thead>\n+               <tr>\n+                   <td>Status</td>\n+                   <td>ToDo</td>\n+                   <td>Owner</td>\n+                   <td>Assignee</td>\n+                   <td colspan=\"2\"></td>\n+               </tr>\n+           </thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    </script>\n\n    <!-- TODO\u4e00\u884c\u5206\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08\u4e0a\u306etbody\u90e8\u5206\u306b\u633f\u5165\u3055\u308c\u308b\uff09 -->\n    <script type=\"text/template\" id=\"todo-item-template\">\n    <td><input type=\"checkbox\" class=\"toggle\" <%- status === '1' ? 'checked' : '' %>></td>\n    <td style=\"margin:0px\">\n        <span class=\"todo-edit\" style=\"margin:0px\"><%- todo %></span>\n    </td>\n    <td>\n+       <span><%- Owner.name %></span>\n+   </td>\n+   <td>\n+       <span><%- Assignee.name %></span>\n+   </td>\n+   <td>\n        <a class=\"remove-link\" href=\"#\">Delete</a>\n+   </td>\n+   <td>\n        <a class=\"detail-link\" href=\"#todo-lists/<%- id %>\">Detail</a>\n    </td>\n    </script>\n\n    <!-- \u8a73\u7d30\u753b\u9762\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-detail-layout-template\">\n    <div id=\"todo-item\"></div>\n    </script>\n\n    <!-- \u8a73\u7d30\u753b\u9762\u306e\u8868\u793a\u5185\u5bb9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-detail-item-template\">\n    <h2>Todo #<%- id %></h2>\n    <div>\n    <textarea style=\"width:300px;height:50px\" id=\"edit-todo\" autofocus placeholder=\"Todo?\"><%- todo %></textarea>\n+   <select name=\"assignee\" id=\"user-list\">\n+   </select>\n    <input type=\"button\" id=\"updateTodo\" value=\"Update\"></input>\n    <input type=\"button\" id=\"updateCancel\" value=\"Cancel\"></input>\n    </div>\n    </script>\n\n\u301c\u3000\u7565\u3000\u301c\n\n\nGi\u1ea3i th\u00edch ch\u1ec9nh s\u1eeda\n\nTODO list screen\n\n\nTh\u00eam <select> </select> \u0111\u1ec3 hi\u1ec3n th\u1ecb danh s\u00e1ch user\n\n\nTh\u00eam <thead> </thead> v\u00e0o table (v\u00ec \u0111\u00e3 th\u00eam c\u00e1c c\u1ed9t m\u1edbi )\n[Delete] v\u00e0 [Details] c\u1ea7n chia th\u00eam <td> </td>\n\n\n\n\n\nTODO detail screen\n\n\nTh\u00eam <select> </select> \u0111\u1ec3 hi\u1ec3n th\u1ecb danh s\u00e1ch user.\n\n\n\n\nuser-collection.js\n\nuser-collection.js\n//User list collection\ndefine(function(require) {\n    var UserModel = require('models/user-model');\n\n    var UserCollection = Backbone.Collection.extend({\n        url : '/rest-study/users.json',\n        model : UserModel,\n\n        parse : function(response) {\n            return response;\n        }\n    });\n\n    return UserCollection;\n});\n\n\nRequired m\u00ecnh s\u1ebd require t\u1ed1i thi\u1ec3u m\u1ed9t collection.\nM\u00ecnh kh\u00f4ng c\u1ea7n gi\u1ea3i th\u00edch g\u00ec c\u1ea3.\n\ntodo-model.js\nCh\u00fang ta \u0111ang ph\u00e2n t\u00edch Owner v\u00e0 Assignee khi th\u00eam m\u1ed9t TODO m\u1edbi.\n\ntodo-model.js\n //Model representing County Todo data 1\n define(function() {\n    var TodoModel = Backbone.Model.extend({\n        urlRoot : '/rest-study/todo_lists',\n        parse : function(response) {\n            //\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\n            console.log(\"\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\");\n            console.log(response);\n-           return response.TodoList;\n+           var parsed = response.TodoList;\n+           if (response.Owner) {\n+               parsed.Owner = response.Owner;\n+               parsed.Assignee = response.Assignee;\n+           }\n+           return parsed;\n        },\n        toggle : function() {\n            this.set('status', this.get(\"status\") === '1' ? '0' : '1');\n            this.save();\n        }\n    });\n    return TodoModel;\n });\n\n\nKhi chuy\u1ec3n th\u00e0nh JSON th\u00ec TODO1 s\u1ebd theo format sau, tr\u1ea3 v\u1ec1 t\u1eeb server b\u1eb1ng CakePHP,\n\nServerResponseJSON\n{\n    \"TodoList\": {\n        \"id\": \"62\",\n        \"todo\": \"Watching TV\",\n        \"status\": \"0\",\n        \"owned\": false,\n        \"assigned\": false\n    },\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\n    }\n}\n\n\nN\u00f3 s\u1ebd thay \u0111\u1ed5i sang format sau\n\nServerResponseJSON\n{\n    \"id\": \"62\",\n    \"todo\": \"Watching TV\",\n    \"status\": \"0\",\n    \"owned\": false,\n    \"assigned\": false,\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    }\n}\n\n\n\ntodo-layout-view.js\nB\u1ea1n c\u1ea7n th\u00eam m\u1ed9t ti\u1ebfn tr\u00ecnh \u0111\u1ec3 \u0111\u1ecdc danh s\u00e1ch user.\n\ntodo-layout-view.js\n define(function(require){\n    var TodoCompositeView = require('views/todo-composite-view');\n    var TodoCollection = require('collections/todo-collection');\n+   var UserCollection = require('collections/user-collection');\n\n    var TodoLayoutView = Marionette.LayoutView.extend({\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template: '#todo-layout-template',\n\n        regions : {\n            listRegion : '#todo-lists',\n        },\n\n-       onRender : function(){\n+       onRender : function() {\n+           this.userCollection = new UserCollection();\n+           this.listenTo(this.userCollection, 'reset', this.onLoadUsers, this);\n+           this.userCollection.fetch({reset : true});\n+       },\n+\n+       onLoadUsers : function(userCollection) {\n            var todoCollection = new TodoCollection();\n            this.listenTo(todoCollection , 'reset', this.showTodoList, this);\n            todoCollection.fetch({reset : true});\n        },\n\n        showTodoList : function(todoCollection){\n            this.listRegion.show( new TodoCompositeView({\n-               collection : todoCollection\n+               collection : todoCollection,\n+               userList : this.userCollection.models\n            }));\n        },\n\n    });\n    return TodoLayoutView;\n });\n\n\n\n\u0110\u1ecdc collections/user-collection b\u1eb1ng require\n\nCh\u1ec9 trong h\u00e0m onRender, m\u00ecnh s\u1ebd l\u1ea5y v\u1ec1 danh s\u00e1ch user t\u1eeb server b\u1eb1ng this.userCollection.fetch().\nKhi \u0111\u00e3 \u0111\u1ed5 d\u1eef li\u1ec7u v\u1ec1 xong (ListenTo \u0111\u00e3 ho\u1ea1t \u0111\u1ed9ng), Ch\u1ea1y h\u00e0m onLoadUsers, v\u00e0 k\u00e9o theo \u0111\u00f3 l\u00e0 showTodoList c\u0169ng \u0111\u01b0\u1ee3c th\u1ef1c thi\n\u1ede h\u00e0m showTodoList, trong khi kh\u1edfi t\u1ea1o TodoCompositeView, ch\u00fang ta c\u1ea7n l\u1ea5y collection c\u1ee7a user list.\nCh\u00fang ta kh\u00f4ng xem user list collection trong ti\u1ebfn tr\u00ecnh c\u1ee7a TodoCompositeView.\n\n\ntodo-composite-view.js\n\nN\u00f3 s\u1ebd hi\u1ec3n th\u1ecb danh s\u00e1ch user\n\ntodo-composite-view.js\n //View c\u1ee7a TODO list\n define(function(require) {\n    var TodoItemView = require('views/todo-item-view');\n\n    var TodoCompositeView = Marionette.CompositeView.extend({\n        template: '#todo-composite-template',\n\n        childView : TodoItemView,\n\n        childViewContainer : 'tbody',\n\n        ui : {\n            addTodo : '#addTodo',\n-           newTodo : '#new-todo'\n+           newTodo : '#new-todo',\n+           userList : '#user-list'\n        },\n\n        events : {\n            'click @ui.addTodo' : 'onCreateTodo',\n        },\n\n-       initialize: function(){\n+       initialize: function(options){\n            _.bindAll( this, 'onCreatedSuccess' );\n+           this.userList = options.userList;\n        },\n\n+       onRender : function() {\n+           //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+           this.showUserList(this.ui.userList, this.userList);\n+           //\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+           this.ui.userList.val(window.application.loginUser.id);\n+       },\n+                   \n+       //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+       showUserList : function($list, userList){\n+           $.each(userList, function(index, userModel) {\n+               $list.append(\n+                   \"<option value='\" \n+                   + userModel.attributes.id + \"'>\"\n+                   + userModel.attributes.name + \"</option>\");\n+           });\n+       },\n+           \n        onCreateTodo : function() {\n            this.collection.create(this.newAttributes(), {\n                  silent:  true ,\n                  success: this.onCreatedSuccess\n            });\n            this.ui.newTodo.val('');\n        },\n\n        newAttributes : function() {\n            return {\n                todo : this.ui.newTodo.val().trim(),\n-               status : 0\n+               status : 0,\n+               assignee : this.ui.userList.val()\n            };\n        },\n\n        onCreatedSuccess : function(){\n            this.collection.fetch({ reset : true });\n        },\n\n    });\n    return TodoCompositeView;\n });\n\n\n\nTh\u00eam userList v\u00e0o bi\u1ebfn ui\u0111\u1ec3 x\u1eed l\u00fd select box c\u1ee7a user list.\n\u1ede trong h\u00e0m initialize, t\u1ea1i todo-layout-view t\u1eeb collection danh s\u00e1ch user \u0111\u00e3 l\u1ea5y v\u1ec1 (\u0111\u1ed5 v\u00e0o options.userList) c\u1ee7a ch\u00ednh n\u00f3 (v\u00e0 truy\u1ec1n v\u00e0o this.userList)\n\u1ede trong h\u00e0m onRender, hi\u1ec3n th\u1ecb danh s\u00e1ch user b\u1eb1ng c\u00e1ch ch\u1ea1y h\u00e0m showUserList.\nSau khi c\u00f3 user list, \u0111\u1ec3 l\u1ea5y ID t\u1eeb th\u00f4ng tin user c\u1ee7a user \u0111\u00e3 login th\u00ec m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng h\u00e0m window.application.loginUser l\u00fac login, V\u00e0 ng\u01b0\u1eddi \u0111\u00f3 (login user) s\u1ebd \u0111\u01b0\u1ee3c ch\u1ecdn m\u1eb7c \u0111\u1ecbnh \u1edf user list. \nT\u1ea1i h\u00e0m showUserList, m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng jquery, ch\u00fang ta s\u1ebd s\u1eed d\u1ee5ng tag <option> </ option> v\u00e0 tag <select> </ select> \u0111\u1ec3 ch\u1ee9a nh\u1eefng th\u00e0nh ph\u1ea7n \u0111\u01b0\u1ee3c g\u1ecdi trong bi\u1ebfn ui.\nKhi m\u1ed9t TODO \u0111\u01b0\u1ee3c th\u00eam v\u00e0o  ( H\u00e0m newAttributes), m\u00ecnh s\u1ebd set ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ch\u1ecdn trong user list v\u00e0o (assignee).\n\n\ntodo-item-view.js\nCh\u00fang ta c\u1ea7n th\u00eam ph\u1ea7n qu\u1ea3n l\u00fd s\u1ef1 hi\u1ec3n th\u1ecb c\u00e1c button Delete-detail.\n\ntodo-item-view.js\n //View c\u1ee7a m\u1ed7i TODO\n define(function(){\n    var TodoItemView = Marionette.ItemView.extend({\n        //Tag name c\u1ee7a th\u00e0nh ph\u1ea7n trong DOM\n        tagName : 'tr',\n\n        //Tamplate\n        template : '#todo-item-template',\n\n        ui : {\n            checkBox : '.toggle',\n-           removeLink : '.remove-link'\n+           removeLink : '.remove-link',\n+           detailLink : '.detail-link'\n        },\n\n        //Cac su kien o DOM\n        events : {\n            //Khi click vao Checkbox\n            'click @ui.checkBox' : 'onStatusToggleClick',\n            //Khi click button Delete\n            'click @ui.removeLink' : 'onRemoveClick',\n        },\n\n        onStatusToggleClick : function() {\n            this.model.toggle();\n        },\n\n        onRemoveClick : function() {\n            this.model.destroy({\n                wait : true\n            });\n        },\n\n+       onRender : function() {\n+           if (!this.model.attributes.owned) {\n+               //Neu khong phai Owner thi hide nut delete\n+               this.ui.removeLink.css({\n+                   display : 'none' \n+                   //hoac dung visibility : hidden cung duoc\n+               });\n+               if (!this.model.attributes.assigned) {\n+                   //truong hop khong ph\u1ea3i assignee\n+                   //hide link vao detail\n+                   this.ui.detailLink.css({\n+                       display : 'none'\n+                       //hoac dung visibility : hidden cung duoc\n+                   });\n+                   //khong cho thay doi trang thai checkbox\n+                   this.ui.checkBox.prop('disabled', true);\n+               }\n+           }\n+       }\n    });\n    return TodoItemView;\n }); \n\n\n\nTh\u00eam bi\u1ebfn detailLink v\u00e0 Delete link v\u00e0o ui.\nTrong h\u00e0m onRender, m\u00ecnh s\u1ebd qu\u1ea3n l\u00fd s\u1ef1 hi\u1ec3n th\u1ecb hay kh\u00f4ng c\u1ee7a c\u00e1c link x\u00f3a v\u00e0 detail theo quy t\u1eafc sau.\n\n\n\u1ea8n Delete link n\u1ebfu \u0111\u00e2y kh\u00f4ng ph\u1ea3i owner\n\n\nTrong tr\u01b0\u1eddng h\u1ee3p \u0111\u00e2y kh\u00f4ng ph\u1ea3i l\u00e0 ng\u01b0\u1eddi \u0111\u01b0\u1ee3c giao l\u00e0m TODO n\u00e0y\n\n\nV\u1eabn hi\u1ec7n link detail\nCheckbox s\u1ebd b\u1ecb c\u1ed1 \u0111\u1ecbnh v\u00e0 kh\u00f4ng th\u1ec3 thay \u0111\u1ed5i\n\n\n\n\n\n\n\n\u203bC\u00e1ch th\u1ef1c hi\u1ec7n vi\u1ec7c qu\u1ea3n l\u00fd \u1ea9n hi\u1ec7n.\n\n\u1ea2n link\n\n\nTh\u00eam css b\u1eb1ng jquery, th\u00eam v\u00e0o style display : 'none'\n\n\n\nCheck box c\u1ed1 \u0111\u1ecbnh\n\n\nTh\u00eam h\u00e0m prop b\u1eb1ng jquery, disabled chuy\u1ec3n th\u00e0nh true.\n\n\n\n\ntodo-detail-layout-view.js\nB\u1ea1n ph\u1ea3i th\u00eam m\u1ed9t ti\u1ebfn tr\u00ecnh \u0111\u1ecdc user list.\nNh\u1eefng th\u1ee9 b\u1ea1n \u0111ang l\u00e0m g\u1ea7n nh\u01b0 gi\u1ed1ng v\u1edbi todo-layout-view.js.\n\ntodo-detail-layout-view.js\n define(function(require) {\n     var TodoDetailItemView = require('views/todo-detail-item-view');\n     var TodoModel = require('models/todo-model');\n+    var UserCollection = require('collections/user-collection');\n\n    var TodoDetailLayoutView = Marionette.LayoutView.extend({\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template : '#todo-detail-layout-template',\n\n        regions : {\n            itemRegion : '#todo-item',\n        },\n\n        onRender : function() {\n-           var todoModel = new TodoModel({\n-               id : this.options.modelId\n-           });\n-           //\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n-           this.listenTo(todoModel, 'sync', this.showItem, this);\n-           //\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n-           todoModel.fetch({\n-               wait : true\n+           this.userCollection = new UserCollection();\n+           this.listenToOnce(this.userCollection, 'reset', this.onLoadUsers, this);\n+           this.userCollection.fetch({\n+               reset : true\n            });\n        },\n\n-       showItem : function(todoModel) {\n-           this.itemRegion.show( new TodoDetailItemView({\n-               model : todoModel\n-           }));\n-       },\n+       onLoadUsers : function(userCollection){\n+           var todoModel = new TodoModel({\n+               id : this.options.modelId\n+           });\n+           //\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n+           this.listenToOnce(todoModel, 'sync', this.showItem, this);\n+           //\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n+           todoModel.fetch({\n+               wait : true\n+           });\n+       },\n+\n+       showItem : function(todoModel) {\n+           this.itemRegion.show(new TodoDetailItemView({\n+               model : todoModel,\n+               userList : this.userCollection.models\n+           }));\n+       },\n\n    });\n    return TodoDetailLayoutView;\n });\n\n\n\n\u0110\u1ecdc collections/user-collection th\u00f4ng qua require\n\nTrong h\u00e0m onRender, Ch\u1ea1y h\u00e0m this.userCollection.fetch() \u0111\u1ec3 \u0111\u1ed5 d\u1eef li\u1ec7u danh s\u00e1ch user v\u1ec1 t\u1eeb server.\n\u0110\u01b0\u1ee3c th\u1ef1c hi\u1ec7n t\u1eeb onRender, ti\u1ebfn tr\u00ecnh nh\u1eadn d\u1eef li\u1ec7u \u1edf model th\u1ee9 1 t\u1eeb server, b\u1ea1n \u0111\u00e3 \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ebfn onLoadUsers.\nKhi qu\u00e1 tr\u00ecnh \u0111\u1ed5 d\u1eef li\u1ec7u ho\u00e0n t\u1ea5t (ListenTo \u0111\u00e3 ch\u1ea1y), Ch\u1ea1y h\u00e0m onLoadUsers,todoModel.fetch() \u0111\u1ec3 l\u1ea5y d\u1eef li\u1ec7u c\u1ee7a TODO 1.\nTrong h\u00e0m showItem, trong ph\u1ea7n initialization c\u1ee7a TodoDetailItemView, m\u00ecnh c\u1ea7n truy\u1ec1n collection c\u1ee7a user list\nHi\u1ec3n th\u1ecb user list collection trong c\u00e1c ti\u1ebfn tr\u00ecnh c\u1ee7a TodoDetailItemView.\n\n\ntodo-detail-item-view.js\n\nHi\u1ec3n th\u1ecb todo list\n\ntodo-detail-item-view.js\n //\u8a73\u7d30\u30d3\u30e5\u30fc\n define(function() {\n    var TodoDetailItemView = Marionette.ItemView.extend({\n\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template: \"#todo-detail-item-template\",\n\n        ui : {\n            todoStatus   : '#edit-todo',\n            updateButton : '#updateTodo',\n-           cancelButton : '#updateCancel'\n+           cancelButton : '#updateCancel',\n+           userList     : '#user-list'\n        },\n\n        //DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n        events : {\n            //\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.updateButton' : 'onUpdateClick',\n            //\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.cancelButton' : 'onCancelClick',\n        },\n\n        //\u521d\u671f\u5316\n-       initialize: function(){\n+       initialize: function(options){\n            _.bindAll( this, 'onSaveSuccess' );\n+           this.userList = options.userList;\n+       },\n+\n+       onRender : function() {\n+           //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+           this.showUserList(this.ui.userList, this.userList);\n+           //\u62c5\u5f53\u8005\u3092\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+           this.ui.userList.val(this.model.attributes.assignee);\n+       },\n+\n+       //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+       showUserList : function($list, userList){\n+           $.each(userList, function(index, userModel) {\n+           $list.append(\n+               \"<option value='\" \n+               + userModel.attributes.id + \"'>\"\n+               + userModel.attributes.name + \"</option>\");\n+           });\n        },\n\n        //\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n        onUpdateClick : function() {\n            //\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u6587\u5b57\u3092\u53d6\u5f97\n-           var todoString = this.ui.todoStatus.val();\n+           var todoString = this.ui.todoStatus.val();  // Todo\n+           var assigneeId = this.ui.userList.val();    // \u62c5\u5f53\u8005\n            this.model.save({\n-               todo : todoString\n+               todo : todoString,\n+               assignee : assigneeId\n            }, {\n                silent : true,\n                success : this.onSaveSuccess,\n            });\n        },\n\n        //\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n        onCancelClick : function() {\n            this.backTodoLists();\n        },\n\n        //\u66f4\u65b0\u6210\u529f\n        onSaveSuccess : function() {\n            this.backTodoLists();\n        },\n\n        //TODO\u30ea\u30b9\u30c8\u753b\u9762\u306b\u623b\u308b\n        backTodoLists : function() {\n            Backbone.history.navigate('#todo-lists', true);\n        }\n\n    });\n    return TodoDetailItemView;\n });\n\n\n\u0110\u1ec3 hi\u1ec3n th\u1ecb user list, t\u01b0\u01a1ng t\u1ef1 nh\u01b0 \u0111\u00e3 l\u00e0m v\u1edbi todo-composite-view.js.\n\nTh\u00eam userList v\u00e0o bi\u1ebfn ui \u0111\u1ec3 x\u1eed l\u00fd select box c\u1ee7a user list.\nTrong h\u00e0m initialize, t\u1ea1i todo-layout-view \u0111\u01b0\u1ee3c truy\u1ec1n t\u1eeb user list collection ( v\u00e0o options.userList) c\u1ee7a ch\u00ednh n\u00f3 (n\u00ean \u0111\u01b0\u1ee3c l\u01b0u \u1edf this.userList)\nTrong h\u00e0m onRender, hi\u1ec3n th\u1ecb userlist b\u1eb1ng c\u00e1ch ch\u1ea1y h\u00e0m showUserList.\nSau user list m\u00ecnh set v\u00e0o state \u0111\u01b0\u1ee3c ch\u1ecdn ( l\u1ea5y t\u1eeb assignee c\u1ee7a model) user ID c\u1ee7a TODO c\u1ee7a m\u1ed7i c\u00e1 nh\u00e2n s\u1ebd \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb.\nH\u00e0m ShowUserList l\u00e0 vi\u1ec7c copy v\u00e0 paste c\u1ee7a c\u00f9ng 1 h\u00e0m t\u1eeb todo-composite-view.js! ( C\u00e1c b\u1ea1n c\u00f3 th\u1ec3 xem gi\u1ea3i th\u00edch \u1edf tr\u00ean kia!)\nTrong ti\u1ebfn tr\u00ecnh c\u1ee7a vi\u1ec7c click button Update (onUpdateClick function), m\u00ecnh s\u1ebd s\u1ebd cho ph\u00e9p ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c ch\u1ecdn \u1edf danh s\u00e1ch user \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng (assignee).\n\n\nT\u1ed5ng k\u1ebft b\u00e0i h\u1ecdc\nC\u00e1c b\u01b0\u1edbc th\u1ef1c hi\u1ec7n c\u1ee7a ta nh\u01b0 sau.\n\n\n app/View/Layouts/default.ctp s\u1eeda nh\u01b0 tr\u00ean.\n\n app/webroot/js/collections/user-collection.js s\u1eeda nh\u01b0 tr\u00ean.\n\n app/webroot/js/models/todo-model.js s\u1eeda nh\u01b0 tr\u00ean.\n\n app/webroot/js/views/todo-layout-view.js s\u1eeda nh\u01b0 tr\u00ean.\n\n app/webroot/js/views/todo-composite-view.js s\u1eeda nh\u01b0 tr\u00ean.\n\n app/webroot/js/views/todo-item-view.js truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n\n app/webroot/js/views/todo-detail-layout-view.js truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n\n app/webroot/js/views/todo-detail-item-view.js truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n\n Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n\n Commit l\u00ean Git\n\nTham kh\u1ea3o Diff ho\u00e0n ch\u1ec9nh tr\u00ean Github\n\u7b2c6\u56de Lesson1 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@f1623dc\n\u0110\u00f3 l\u00e0 t\u1ea5t c\u1ea3 b\u00e0i h\u1ecdc n\u00e0y.\n\nT\u00f4i r\u1ea5t mong nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 ph\u1ea3n h\u1ed3i / g\u00f3p \u00fd c\u1ee7a c\u00e1c b\u1ea1n\nC\u1ea3m \u01a1n c\u00e1c b\u1ea1n \u0111\u00e3 quan t\u00e2m theo d\u00f5i series, r\u1ea5t c\u1ea3 c\u00e1c b\u00e0i h\u1ecdc t\u00f4i s\u1ebd \u0111\u1ec1u ch\u1ec9nh s\u1eeda sau khi hi\u1ec3u th\u00eam k\u1ef9 h\u01a1n v\u1ea5n \u0111\u1ec1 g\u00ec, ho\u1eb7c nh\u1eadn ra sai s\u00f3t, r\u1ea5t mong lu\u00f4n nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 g\u00f3p \u00fd t\u1eeb c\u00e1c b\u1ea1n.\n\n\n:warning: T\u00f4i \u0111\u00e3 th\u00eam m\u1ed9t table t\u00ean l\u00e0 `users` \u1edf b\u00e0i 5.\n\n## :large_blue_circle: Ch\u00e0o m\u1eebng c\u00e1c b\u1ea1n tr\u1edf l\u1ea1i\nCh\u01b0\u01a1ng 6 n\u00e0y \u0111\u01b0\u1ee3c m\u00ecnh d\u1ecbch t\u1eeb b\u00e0i vi\u1ebft [CakePHP\u3067\u30c7\u30fc\u30bf\u64cd\u4f5c\u301c\u62c5\u5f53\u8005\u30a2\u30b5\u30a4\u30f3\u6a5f\u80fd\u306e\u5b9f\u88c5 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e\u3010\u7b2c6\u56de\u3011\u30de\u30cb\u30e5\u30a2\u30eb](http://qiita.com/k_shimoji/items/174e0f2ee9b726a68994) c\u1ee7a t\u00e1c gi\u1ea3 @k_shimoji , m\u00ecnh v\u1eeba d\u1ecbch v\u1eeba l\u00e0m theo n\u00ean s\u1ebd ch\u1ec9nh s\u1eeda kh\u00e1 nhi\u1ec1u sau khi m\u00ecnh hi\u1ec3u h\u01a1n v\u1ec1 b\u00e0i h\u1ecdc, r\u1ea5t mong nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 g\u00f3p \u00fd c\u1ee7a t\u1ea5t c\u1ea3 c\u00e1c b\u1ea1n.\n\n:warning: K\u1ebf ho\u1ea1ch b\u00e0i h\u1ecdc\n\n\u1ede b\u00e0i n\u00e0y ch\u00fang ta s\u1ebd th\u00eam kh\u1ea3 n\u0103ng assign nhi\u1ec7m v\u1ee5 cho c\u00e1 nh\u00e2n v\u00e0o app TODO list.\nV\u1edbi vi\u1ec7c \u0111\u00e3 th\u00eam ch\u1ee9c n\u0103ng login \u1edf b\u00e0i tr\u01b0\u1edbc, ch\u00fang ta s\u1ebd cho ph\u00e9p \u1ee9ng d\u1ee5ng n\u00e0y \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng v\u1edbi nhi\u1ec1u user.\n\nV\u00e0 qua \u0111\u00e2y b\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c h\u1ecdc v\u1ec1 \"association\" trong CakePHP.\n\n\n## :large_blue_circle: \"association\" trong CakePHP\n\nTheo b\u00e0i vi\u1ebft tr\u01b0\u1edbc th\u00ec ch\u00fang ta s\u1ebd x\u1eed l\u00fd tr\u00ean 2 table\n\n- users\n- todo_lists\n\nTuy nhi\u00ean kh\u00f4ng ph\u1ea3i ch\u1ec9 ch\u1ecdn 1 table \u0111\u1ec3 x\u1eed l\u00fd trong m\u1ed7i l\u1ea7n l\u00e0m vi\u1ec7c.\nT\u1ea1i \u1ee9ng d\u1ee5ng m\u00e0 ch\u00fang ta \u0111\u00e3 vi\u1ebft th\u1eddi \u0111i\u1ec3m n\u00e0y, b\u1ea1n c\u1ea7n Sellect b\u1eb1ng c\u00e1ch ch\u1ecdn c\u1ea3 users v\u00e0 todo_lists, s\u1ebd hay h\u01a1n n\u1ebfu m\u00ecnh kh\u00f4ng vi\u1ebft SQL tr\u1ef1c ti\u1ebfp m\u00e0 x\u1eed l\u00fd b\u1eb1ng c\u00e1ch c\u1ee7a CakePHP, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng c\u00e1c c\u01a1 ch\u1ebf \"association\".\nB\u1ea1n c\u00f3 th\u1ec3 join c\u00e1c table b\u1eb1ng code SQL.\n### T\u00ecm hi\u1ec3u v\u1ec1 association\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u00ecm hi\u1ec3u v\u1ec1 3 association sau\n\n- belongsTo\n- hasOne\n- hasMany\n\n:warning: \u300chasAndBelongsToMany\u300dN\u00f3 \u0111\u00e3 c\u00f3 s\u1eb5n n\u00ean t\u1ea5t nhi\u00ean s\u1ebd b\u1ecb b\u1ecf qua\n\nGi\u1ea3i th\u00edch m\u1ed7i association\n\n### belongsTo\n\nA belongsTo B, hay n\u00f3i c\u00e1ch kh\u00e1c, A c\u00f3 m\u1ed9t m\u1ed1i quan h\u1ec7 v\u1edbi m\u1ed9t table m\u00e0 table n\u00f3 thu\u1ed9c v\u1ec1 B, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng belongsTo association.\nV\u00ed d\u1ee5, th\u00e0nh ph\u1ea7n user trong table `users`, s\u1ebd c\u1ea7n c\u00f3 m\u1ed9t qu\u1ed1c t\u1ecbch \"nationality\", n\u00f3 s\u1ebd c\u00f3 m\u1ed9t table l\u00e0 \"nationality master (countries)\".\n\nM\u00ecnh s\u1ebd th\u00eam table countries ( ph\u1ea7n m\u1edf ngo\u1eb7c l\u00e0 c\u00e1c field trong table \u0111\u00f3 )\n- countries(id, name)\n\nB\u1edfi v\u00ec m\u1ed7i user s\u1ebd c\u00f3 m\u1ed9t qu\u1ed1c t\u1ecbch n\u1eb1m trong danh s\u00e1ch c\u00e1c nationality, table `users` s\u1ebd nh\u01b0 sau\n\n- users(id, username, country_id)\n\nB\u1ea1n c\u00f3 th\u1ec3 Sellect d\u1eef li\u1ec7u b\u1eb1ng c\u00e1ch join users.country_id v\u1edbi countries.id b\u1eb1ng c\u00e1ch vi\u1ebft \u0111o\u1ea1n SQL sau:\n\n```sql\nselect users.id, users.username, countries.name as country_name\nfrom users inner join countries on users.country_id = countries.id\n```\n\n\u0110\u00e2y l\u00e0 association \"belongsTo\".\nCode th\u00ec ch\u00fang ta s\u1ebd xem sau.\n\n### hasOne\n\nhasOne l\u00e0 c\u00e1i table th\u1ee9 2 trong m\u1ed1i quan h\u1ec7 belongsTo m\u00e0 m\u00ecnh \u0111\u00e3 n\u00f3i \u1edf tr\u00ean, \u1ede v\u00ed d\u1ee5 c\u1ee7a belongsTo th\u00ec ph\u00eda users ph\u1ea3i show gi\u00e1 tr\u1ecb c\u1ee7a countries `country_id`, tr\u01b0\u1eddng h\u1ee3p hasOne l\u00e0 ng\u01b0\u1ee3c l\u1ea1i c\u1ee7a belongsTo, nh\u01b0 ki\u1ec3u th\u1eb1ng B ch\u1ee9a 1 th\u00e0nh ph\u1ea7n c\u1ee7a th\u1eb3ng A th\u00ec th\u1eb1ng A belongTo th\u1eb1ng B, c\u00f2n th\u1eb1ng B hasOne th\u1eb1ng A \u1ea5y.\nV\u00ed d\u1ee5 b\u1ea1n c\u00f3 1 table m\u00e0 ch\u1ee9a profile c\u1ee7a user t\u00ean l\u00e0 `profiles` ch\u1eb3ng h\u1ea1n.\n\n- profiles(id, user_id, description, hobbies, etc...)\n\n\u1ede tr\u01b0\u1eddng h\u1ee3p n\u00e0y, ch\u00fang ta c\u00f3 user_id \u1edf ph\u00eda profiles, qua \u0111\u00f3 m\u00ecnh c\u00f3 th\u1ec3 Sellect b\u1eb1ng c\u00e1ch join users.id v\u00e0 profiles.user_id.\n\u0110\u00e2y l\u00e0 association \"hasOne\".\n\n:warning: Ph\u00eda user c\u0169ng c\u00f3 th\u1ec3 c\u00f3 m\u1ed9t gi\u00e1 tr\u1ecb profile_id, nh\u01b0ng s\u1ebd c\u00f3 tr\u01b0\u1eddng h\u1ee3p c\u00f3 \"non-registered profile.\"\n\n- set cho users.profile_id ch\u1ea5p nh\u1eadn gi\u00e1 tr\u1ecb null\n- users.id = profies.user_id m\u00ecnh kh\u00f4ng c\u1ea7n quan t\u00e2m.\n\u0110\u00e2y l\u00e0 t\u00f9y theo tri\u1ebft l\u00fd thi\u1ebft k\u1ebf database c\u1ee7a m\u1ed7i ng\u01b0\u1eddi, t\u1ea5t c\u1ea3 \u0111\u1ec1u ok.\n\nKhi vi\u1ebft l\u1ec7nh SQL n\u00f3 s\u1ebd nh\u01b0 th\u1ebf n\u00e0y.\n```sql\nselect users.id, profiles.introduce, profiles.hobbies\nfrom users inner join profiles on users.id = profiles.user_id\n```\n\nV\u1ec1 code th\u00ec ch\u00fang ta s\u1ebd xem sau\n\n### hasMany\n\nhasMany s\u1eed d\u1ee5ng \u0111\u1ec3 bi\u1ec3u \u0111\u1ea1t m\u1ed1i quan h\u1ec7 m\u00e0 table n\u00e0y ch\u1ee9a n th\u00e0nh ph\u1ea7n c\u1ee7a m\u1ed9t table kh\u00e1c.\nV\u00ed d\u1ee5, b\u1ea1n c\u00f3 m\u1ed9t table ch\u1ee9a ngh\u1ec1 nghi\u1ec7p c\u1ee7a user (careers).\n\n- careers(id, user_id, introduce, name, etc...)\n\n\u1ede tr\u01b0\u1eddng h\u1ee3p n\u00e0y, c\u00f3 th\u1ec3 nhi\u1ec1u user chung ngh\u1ec1 nghi\u1ec7p (career) ,\nB\u1ea1n c\u00f3 th\u1ec3 Select b\u1eb1ng c\u00e1ch join v\u1edbi \u0111i\u1ec1u ki\u1ec7n users.id tr\u00f9ng v\u1edbi careers.user_id.\nS\u1ef1 kh\u00e1c bi\u1ec7t c\u1ee7a n\u00f3 v\u1edbi hasOne ch\u1ec9 l\u00e0 s\u1ebd l\u1ea5y nhi\u1ec1u record h\u01a1n trong m\u1ed9t l\u1ea7n.\n\nL\u1ec7nh SQL nh\u01b0 sau\n\n```sql\nselect users.id, careers.introduce, careers.name\nfrom users inner join careers on users.id = careers.user_id\n```\n\n:warning: S\u1ef1 th\u1eadt l\u00e0 trong CakePHP, m\u1ed9t khi select users v\u00e0 select careers, ngh\u0129a l\u00e0 ch\u00fang ta \u0111ang select t\u1ed5ng c\u1ed9ng t\u01b0\u01a1ng \u1ee9ng 2 l\u1ea7n.\n\nCode ch\u00fang ta s\u1ebd xem sau\n\n\n## :large_blue_circle: \u0110i v\u00e0o b\u00e0i h\u1ecdc\n\nSau khi ho\u00e0n th\u00e0nh b\u00e0i h\u1ecdc n\u00e0y th\u00ec ch\u00fang ta c\u00f3 th\u1ec3 ho\u00e0n t\u1ea5t c\u00e1c ch\u1ee9c n\u0103ng sau\n\n### \u0110\u1eb7c t\u1ea3 ch\u1ee9c n\u0103ng\n\n- Th\u00eam Todo\n\t- B\u00e2y gi\u1edd th\u00ec khi th\u00eam TODO s\u1ebd c\u00f3 th\u00eam ch\u1ee9c n\u0103ng \"Ph\u00e2n c\u00f4ng nhi\u1ec7m v\u1ee5 ai s\u1ebd ph\u1ea3i l\u00e0m TODO n\u00e0y\" trong list t\u1ea5t c\u1ea3 c\u00e1c user\n\t- Danh s\u00e1ch user, logged-in user trong danh s\u00e1ch l\u1ef1a ch\u1ecdn m\u1eb7c \u0111\u1ecbnh.\n- Hi\u1ec3n th\u1ecb TODO list\n\t- Hi\u1ec3n th\u1ecb \"owner\" t\u1ee9c l\u00e0 ng\u01b0\u1eddi \u0111\u00e3 th\u00eam TODO n\u00e0y , v\u00e0 hi\u1ec3n th\u1ecb ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ch\u1ec9 \u0111\u1ecbnh s\u1ebd ph\u1ea3i l\u00e0m todo n\u00e0y \u1edf c\u1ed9t \"assignee\".\n        - Ngo\u00e0i ra ch\u00fang ta s\u1ebd th\u00eam v\u00e0o m\u1ed9t v\u00e0i gi\u1edbi h\u1ea1n sau\n\t\t- Ch\u1ec9 ng\u01b0\u1eddi `owner` m\u1edbi \u0111\u01b0\u1ee3c d\u00f9ng ch\u1ee9c n\u0103ng \"Delete\". N\u00fat \"Delete\" s\u1ebd kh\u00f4ng hi\u1ec7n v\u1edbi nh\u1eefng ng\u01b0\u1eddi kh\u00e1c.\n                - Hi\u1ec3n th\u1ecb \"details\" cho owner v\u00e0 ng\u01b0\u1eddi responsible. Kh\u00f4ng hi\u1ec3n th\u1ecb link \"Details\" cho nh\u1eefng ng\u01b0\u1eddi kh\u00e1c.\n- TODO details\n   - M\u1ed9t v\u00e0i thay \u0111\u1ed5i c\u00e1 nh\u00e2n\n\n\n### M\u00e0n h\u00ecnh\n\n- M\u00e0n h\u00ecnh TODO list ( Giao di\u1ec7n h\u01a1i kh\u00e1c v\u00ec m\u00ecnh c\u00f3 v\u1ecdc v\u1ea1ch d\u00f9ng th\u00eam bootstrap v\u00e0 t\u1ef1 vi\u1ebft th\u00eam v\u00e0i ch\u1ee9c n\u0103ng m\u1edbi, \u1edf m\u1ed9t b\u00e0i vi\u1ebft t\u1edbi s\u1ebd c\u00f3 h\u01b0\u1edbng d\u1eabn v\u1ec1 bootstrap, c\u00e1c b\u1ea1n y\u00ean t\u00e2m, c\u00f2n c\u00e1c ch\u1ee9c n\u0103ng \u1ea9n vi\u1ec7c \u0111\u00e3 l\u00e0m, x\u00f3a t\u1ea5t c\u1ea3... th\u00ec c\u00e1c b\u1ea1n c\u00f3 th\u1ec3 t\u1ef1 l\u00e0m \u1edf nh\u00e0 v\u1edbi nh\u1eefng ki\u1ebfn th\u1ee9c \u0111\u00e3 h\u1ecdc )\n\n![demo.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/fb872c53-0130-9eb3-4c56-e1a75cf4004a.png)\n\n- M\u00e0n h\u00ecnh TODO detail \n\n![0.1.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/d89a835c-dbfa-7fe8-50b6-e0159255d94e.png)\n\n\n## :large_blue_circle: Chu\u1ea9n b\u1ecb\n\nPh\u1ea7n chu\u1ea9n b\u1ecb s\u1ebd gi\u1ed1ng nhau \u1edf m\u1ed7i b\u00e0i, v\u00ec v\u1eady t\u00f4i \u0111\u00e3 t\u1ed5ng h\u1ee3p n\u00f3 \u1edf m\u1ed9t entry ri\u00eang. C\u00e1c b\u1ea1n vui l\u00f2ng xem \u1edf link n\u00e0y [All 12 times of study sessions in do I have use of Git - RESTful application workshops will be built on AWS ~ Web development workshop ~ - Qiita](http://qiita.com/k_shimoji/items/6a66dbb93b0553fa7c7f) \u0111\u1ec3 chu\u1ea9n b\u1ecb .\n\n\n- B\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u1ea1o v\u00e0 l\u00e0m vi\u1ec7c tr\u00ean branch t\u00ean `vol/06` tr\u01b0\u1edbc \u0111\u00e3.\n\n\n***C\u00f2n \u0111\u00e2y l\u00e0 nh\u1eefng table v\u00e0 gi\u00e1 tr\u1ecb m\u00e0 ch\u00fang t\u00f4i \u0111\u00e3 add \u1edf b\u00e0i tr\u01b0\u1edbc, c\u00e1c b\u1ea1n ch\u01b0a xem b\u00e0i vi\u1ebft tr\u01b0\u1edbc c\u00f3 th\u1ec3 xem v\u00e0 t\u1ea1o [T\u1ea1i \u0111\u00e2y](http://qiita.com/k_shimoji/items/ae5a02bd0c7e03feae52#%E3%83%A6%E3%83%BC%E3%82%B6%E7%99%BB%E9%8C%B2%E7%94%A8%E3%81%AE%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E4%BD%9C%E6%88%90).***\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd th\u00eam 2 tr\u01b0\u1eddng n\u1eefa cho b\u1ea3ng todo_lists.\n\n- ownerID(owner)\n- assignerID(assignee)\n\n\n### Th\u00eam c\u1ed9t cho b\u1ea3ng TODO list\n\n\n\u0110\u1ea7u tien ch\u00fang ta \u0111\u0103ng nh\u1eadp v\u00e0o phpMyAdmin\n\nURL nh\u01b0 c\u0169 th\u00f4i: `http://(PublicIP)/phpMyAdmin/`.\nN\u1ebfu b\u1ea1n ch\u01b0a thay \u0111\u1ed5i g\u00ec th\u00ec username v\u00e0 password \u0111\u0103ng nh\u1eadp \u0111\u1ec1u l\u00e0 `study`.\n\n\n##### C\u1ea5u h\u00ecnh cho m\u1ed7i collum\n\n| Name | Data type | length / value | default value | collation | attribute | NULL | Index | A_I (AutoIncrement) | Comments |\n|:--|:--|:--|:--|:--|:--|:--|:--|:--|:--\n| owner |INT|10|no|\u3000|UNSIGNED|\u3000|\u3000| \u3000|owner\n| assignee |INT|10|no|\u3000|UNSIGNED|\u3000|\u3000|\u3000|assigner\n\n#### Chu\u1ea9n b\u1ecb\n\nB\u1eaft \u0111\u1ea7u chu\u1ea9n b\u1ecb n\u00e0o!\n\n-:white_check_mark: Nh\u01b0 \u0111\u00e3 n\u00f3i \u1edf tr\u00ean m\u00ecnh s\u1ebd t\u1ea1o branch `vol/06` cho Git.\n-:white_check_mark: Th\u00eam m\u1ed9t column cho TODO list (todo_lists) table.\n\nKhi \u0111\u00e3 s\u1eb5n s\u00e0ng, ch\u00fang ta b\u1eaft \u0111\u1ea7u v\u00e0o B\u00e0i 1.\n\n\n## :large_blue_circle: B\u00e0i 1: server side\n\n\u1ede b\u00e0i 1, ch\u00fang ta s\u1ebd th\u1ef1c hi\u1ec7n nh\u1eefng thao t\u00e1c li\u00ean quan \u0111\u1ebfn server side c\u1ee7a \u1ee9ng d\u1ee5ng.\n\u0110\u1ec3 test ch\u01b0\u01a1ng tr\u00ecnh, s\u1eed d\u1ee5ng \"POSTMAN\" m\u00e0 ch\u00fang ta \u0111\u00e3 c\u00e0i \u0111\u1eb7t \u1edf nh\u1eefng b\u00e0i \u0111\u1ea7u ti\u00ean.\n\n### Points\n\nM\u1eb7c d\u00f9 c\u00f3 3 \"association\" m\u00e0 m\u00ecnh \u0111\u00e3 li\u1ec7t k\u00ea, nh\u01b0ng th\u1ef1c t\u1ebf m\u00ecnh ch\u1ec9 c\u1ea7n s\u1eed d\u1ee5ng duy nh\u1ea5t \"belongsTo\", b\u1ea1n s\u1ebd nh\u1eadn ra \u0111i\u1ec1u n\u00e0y.\nC\u01a1 m\u00e0 nh\u01b0 v\u1eady th\u00ec kh\u00f4ng th\u00fa v\u1ecb l\u1eafm, h\u00e3y c\u0169ng th\u1eed v\u1edbi c\u1ea3  \"hasMany\" v\u00e0 \"hasOne\" n\u1eefa nh\u00e9.\n\u0110\u1ea7u ti\u00ean, m\u00ecnh s\u1eed d\u1ee5ng belognsTo, v\u00e0 b\u1eaft \u0111\u1ea7u code.\n\n### Danh s\u00e1ch nh\u1eefng file c\u1ea7n ch\u1ec9nh s\u1eeda\n\n|Thao t\u00e1c|file|M\u00f4 t\u1ea3|\n|---|:----------------------------------|:----------------------|\n|S\u1eeda| app/Controller/TodoListsController.php |Setting the find parameters\n|S\u1eeda| app/Model/TodoList.php |Association settings\n|S\u1eeda| app/Controller/UsersController.php   |l\u1ea5y user-list\n\n\n#### TodoListsController.php\n\nM\u00ecnh s\u1ebd set c\u00e1c th\u00f4ng s\u1ed1 c\u1ee7a h\u00e0m find gi\u1ed1ng nh\u01b0 TodoList model.\n\n```diff:TodoListsController.php\n\u301c\u7565\u301c\n class TodoListsController extends AppController {\n \n \tpublic function index() {\n-\t\t$res = $this->TodoList->find('all');\n+\t\t$query = array (\n+\t\t\t'fields' => array (\n+\t\t\t\t'TodoList.id',\n+\t\t\t\t'TodoList.todo',\n+\t\t\t\t'TodoList.status',\n+\t\t\t\t'Owner.id',\n+\t\t\t\t'Owner.name',\n+\t\t\t\t'Assignee.id',\n+\t\t\t\t'Assignee.name'\n+\t\t\t),\n+\t\t\t'order' => \"TodoList.id\"\n+\t\t);\n+\t\t$res = $this->TodoList->find('all', $query);\n+\t\t// \u6574\u5f62\n+\t\tif (count($res) > 0) {\n+\t\t    $loginUserId = $this->Auth->user()['id'];\n+\t\t\tforeach ( $res as $key => $row ) {\n+\t\t\t    //truong hop \u300cLogin user l\u00e0 owner\u300d\n+\t\t\t\t$res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n+\t\t\t    //Truong hop\u300clogin user la Assignee\u300d\n+\t\t\t\t$res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n+\t\t\t}\n+\t\t}\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n \n \tpublic function view($id = null) {\n \t\t$res = $this->TodoList->findById($id);\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n \n \tpublic function add() {\n \t\t$data = $this->request->data;\n+\t\t$data['owner'] = $this->Auth->user()['id'];\n \t\t$res = $this->TodoList->save($data);\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n```\n\n#### Th\u00eam argument cho h\u00e0m `find`\n\n- B\u1ea1n c\u1ea7n th\u00eam 2 argument `$query`. `$Query` l\u00e0 m\u1ed9t m\u1ea3ng, b\u1ea1n c\u1ea7n set nh\u01b0 sau.\n\t- `fields`\n\t\t- \u0110\u1ec3 get column c\u1ee7a table. B\u1ea1n kh\u00f4ng c\u1ea7n x\u00e1c \u0111\u1ecbnh c\u1ee5 th\u1ec3 n\u00f3, v\u00ec n\u00f3 s\u1ebd l\u01b0u tr\u1eef m\u1eadt kh\u1ea9u c\u1ee7a user v\u00e0 v\u00e0i th\u1ee9 kh\u00e1c, ch\u00fang ta ch\u1ec9 set nh\u1eefng th\u1ee9 c\u1ea7n thi\u1ebft.\n\t- `order`\n\t\t- Hi\u1ec7n t\u1ea1i data \u0111ang \u0111\u01b0\u1ee3c s\u1eafp x\u1ebfp ng\u1eabu nhi\u00ean theo th\u1ee9 t\u1ef1 \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh, tuy nhi\u00ean todo_lists s\u1ebd l\u00e0 th\u1ee9 t\u1ef1 gi\u1ea3m d\u1ea7n ID trong b\u1ea3ng \u0111\u1ec3 hi\u1ec3n th\u1ecb nh\u1eefng TODO m\u1edbi nh\u1ea5t.\n\n#### X\u00e2y d\u1ef1ng data thu \u0111\u01b0\u1ee3c\n\n- Nh\u1eefng data m\u00ecnh thu \u0111\u01b0\u1ee3c trong b\u00e0i 1 g\u1ed3m\n\t- N\u1ebfu ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp l\u00e0 owner, set `owned = true`, tr\u01b0\u1eddng h\u1ee3p ng\u01b0\u1ee3c l\u1ea1i set `owned = false`.\n\t- N\u1ebfu ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp l\u00e0 assigner, set `assigned = true`, n\u1ebfu kh\u00f4ng ph\u1ea3i th\u00ec `assigned = false`.\n\n#### TodoList.php\n\nAssociation setting.\n\n```diff:TodoList.php\n class TodoList extends AppModel {\n+\tpublic $belongsTo = array (\n+\t\t'Owner' => array (\n+\t\t\t'className' => 'User',\n+\t\t\t'foreignKey' => 'owner',\n+\t\t),\n+\t\t'Assignee' => array (\n+\t\t\t'className' => 'User',\n+\t\t\t'foreignKey' => 'assignee'\n+\t\t)\n+\t);\n }\n```\n\n#### belongsTo association\n\n- Cho m\u1ed7i l\u1ea7n xem TODO,\n   - Th\u00f4ng tin c\u1ee7a owner User\n   - Th\u00f4ng tin c\u1ee7a Assignee user\n   \nCh\u00fang ta s\u1ebd setting nh\u01b0 sau.\n\n- Model c\u1ee7a bi\u1ebfn s\u1ebd t\u1ea1o n\u00ean m\u1ed9t m\u1ea3ng bi\u1ebfn t\u00ean l\u00e0  `$belongsTo`.\n\t- T\u00f4i \u0111\u00e3 \u0111\u1eb7t t\u00ean t\u01b0\u01a1ng \u1ee9ng trong table l\u00e0 `Owner`(Owner), `Assignee`(ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng) \n\t- Th\u00f4ng s\u1ed1 chi ti\u1ebft c\u1ee7a (`Owner`) nh\u01b0 sau\n\t\t- `className` -> T\u00ean model(User)\n\t\t- Th\u00eam Foreign key cho users (C\u1ee5 th\u1ec3 l\u00e0 `todo_lists.owner`)\n\t- Th\u00f4ng s\u1ed1 chi ti\u1ebft c\u1ee7a (`Assignee`) nh\u01b0 sau\n\t\t- `className` -> T\u00ean model(User)\n\t\t- Th\u00eam Foreign key  cho users (C\u1ee5 th\u1ec3 l\u00e0 `todo_lists.assignee`)\n\n#### Ch\u1ee9c n\u0103ng Th\u00eam TODO\n\n- B\u1ea1n ph\u1ea3i set ID c\u1ee7a ng\u01b0\u1eddi \u0111\u00f3 v\u00e0o `owner`.\n\t- B\u00e2y gi\u1edd, user \u0111\u00e3 login n\u00e0o th\u1ef1c hi\u1ec7n l\u1ec7nh th\u00eam TODO s\u1ebd \u0111\u01b0\u1ee3c set l\u00e0 owner c\u1ee7a TODO \u0111\u00f3\n\n### UsersController.php\n\nCh\u1ee9a c\u00e1c ch\u1ee9c n\u0103ng Login, ki\u1ec3m tra login, log out, \u0111\u0103ng k\u00fd.\n\n```diff:UsersController.php\n class UsersController extends AppController {\n \n+\tpublic function index() {\n+\t\t$res = $this->User->find('all', array (\n+\t\t\t'fields' => array (\n+\t\t\t\t'User.id',\n+\t\t\t\t'User.username',\n+\t\t\t\t'User.name'\n+\t\t\t)\n+\t\t));\n+\t\t$this->set(compact('res'));\n+\t\t$this->set('_serialize', 'res');\n+\t}\n+\n \tpublic function login() {\n \t\t$user = $this->Auth->user();\n \t\t$res = array();\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n```\n\n#### H\u00e0m `index`\n\n- C\u00f9ng m\u1ed9t kh\u1ea3 n\u0103ng v\u1edbi `TodoListController.php`, b\u1ea1n c\u1ea7n c\u1ed1 \u0111\u1ecbnh field \u0111\u1ec3 hi\u1ec3u h\u00e0m `find`.\n\n###\u3000Ki\u1ec3m tra k\u1ebft qu\u1ea3\n\nS\u1eed d\u1ee5ng POSTMAN, L\u1ea5y danh s\u00e1ch TODO list b\u1eb1ng URL (`http://(PublicIP)/rest-study/todo_lists.json`).\nN\u1ebfu \u0111\u01b0\u1ee3c k\u1ebft qu\u1ea3 tr\u1ea3 v\u1ec1 v\u1edbi c\u1ea5u tr\u00fac t\u01b0\u01a1ng t\u1ef1 d\u01b0\u1edbi \u0111\u00e2y l\u00e0 OK.\nbelongsTo \u0111\u00e3 l\u00e0m vi\u1ec7c.\n\n```json\n[\n    {\n        \"TodoList\": {\n            \"id\": \"68\",\n            \"todo\": \"1 ne hihi aaaa\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"69\",\n            \"todo\": \"1 ne hihi aaaa b\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"70\",\n            \"todo\": \"1 ne hihi aaaa1213\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        },\n        \"Assignee\": {\n            \"id\": \"1\",\n            \"name\": \"XuanTai\"\n        }\n    }\n]\n```\n\nNh\u01b0 k\u1ebft qu\u1ea3 c\u1ee7a t\u00f4i khi l\u00e0m theo h\u01b0\u1edbng d\u1eabn tr\u00ean:\n![Capture.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/a73356e7-e96a-9ad8-3b63-5717c7ee501e.png)\n\n\n### T\u1ed5ng k\u1ebft\n\nC\u00e1c b\u01b0\u1edbc thao t\u00e1c nh\u01b0 sau\n\n- :white_check_mark: `app/Controller/TodoListsController.php` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/Model/TodoList.php` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/Controller/UsersController.php` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n- :white_check_mark: Commit l\u00ean G\u1ec9t\n\n\n**T\u00e0i li\u1ec7u tham kh\u1ea3o tr\u00ean GitHub v\u1edbi hi\u1ec3n th\u1ecb Diff**\n[Ch\u01b0\u01a1ng 6 - B\u00e0i 1 \u00b7 suzukishouten-study/rest-study@d4fe1a4](https://github.com/suzukishouten-study/rest-study/commit/d4fe1a4c8428b6cf9ecf6b29256537e2741210ca)\n\nSang b\u00e0i 1.5 n\u00e0o.\n\n## :large_blue_circle: B\u00e0i 1.5. Th\u1eed s\u1eed d\u1ee5ng c\u00e1c association kh\u00e1c.\n\nM\u1ecdi th\u1ee9 \u0111\u00e3 ok v\u1edbi c\u00e1ch th\u1ef1c hi\u1ec7n nh\u01b0 b\u00e0i 1.\nTuy nhi\u00ean tr\u01b0\u1edbc khi sang b\u00e0i 2, c\u00e1c b\u1ea1n c\u00f3 th\u1ec3 th\u1eed s\u1eed d\u1ee5ng `hasOne` v\u00e0 `hasMany` xem sao, \u0111\u1ec3 n\u00e2ng cao tay ngh\u1ec1 t\u00ed th\u00f4i m\u00e0, hehe.\n\nSau khi s\u1eeda code v\u00e0 ki\u1ec3m tra x\u00e1c nh\u1eadn k\u1ebft qu\u1ea3, h\u00e3y sang b\u00e0i 2 v\u1edbi code c\u0169.\n\n\u1ede ph\u1ea7n test, m\u1ee5c ti\u00eau c\u1ee7a m\u00ecnh s\u1ebd l\u00e0 ch\u1ee9c n\u0103ng nh\u01b0 trong \u1ea3nh d\u01b0\u1edbi \u0111\u00e2y.\n![vl.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/58713523-ee17-eb0a-327f-fef2597b6eca.png)\n\n\n\n:warning: user l\u00e0\n\n- XuanTai\n- Test5\n- Test2\n\n\u0110\u00e2y l\u00e0 nh\u1eefng user \u0111\u00e3 \u0111\u01b0\u1ee3c \u0111\u0103ng k\u00fd, tuy nhi\u00ean XuanTai kh\u00f4ng th\u1ec3, xem, x\u00f3a, s\u1eeda tr\u1ea1ng th\u00e1i TODO th\u1ee9 4 ( v\u00ec anh ta kh\u00f4ng ph\u1ea3i owner c\u0169ng kh\u00f4ng ph\u1ea3i ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng), anh ta c\u00f3 to\u00e0n qy\u1ec1n \u0111\u1ed1i v\u1edbi TODO 1,2,3,7, v\u00e0 ch\u1ec9 c\u00f3 quy\u1ec1n v\u00e0o trang detail ( \u0111\u1ec3 s\u1eeda, x\u00f3a, assign ng\u01b0\u1eddi kh\u00e1c ) c\u1ee7a TODO 5 v\u00e0 TODO 6 .\n\n### Ki\u1ec3m tra hasOne \n\nCh\u00fang ta c\u1ea7n t\u1ef1 \u0111\u1eb7t \u0111i\u1ec1u ki\u1ec7n user n\u00e0o th\u00eam TODO ch\u00ednh l\u00e0 owner.\n:warning: `user : todo` s\u1ebd ph\u1ea3i tr\u1edf th\u00e0nh `1 : n` n\u1ebfu b\u1ea1n mu\u1ed1n chuy\u1ec3n th\u00e0nh quan h\u1ec7 `hasMany`.\n\n#### Chi ti\u1ebft c\u00e1c thay \u0111\u1ed5i c\u1ee7a source\n\n##### s\u1eeda h\u00e0m `index` c\u1ee7a `app/Controller/UsersController.php`\n\n```php:app/Controller/UsersController.php\n\tpublic function index() {\n\t    $res = $this->User->find('all');\t//X\u00f3a nh\u1eefng field \u0111\u00e3 x\u00e1c \u0111\u1ecbnh, chuy\u1ec3n n\u00f3 th\u00e0nh comment nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y.\n// \t    $res = $this->User->find('all', array (\n// \t\t\t'fields' => array (\n// \t\t\t\t'User.id',\n// \t\t\t\t'User.username',\n// \t\t\t\t'User.name'\n// \t\t\t)\n// \t\t));\n\t\t$this->set(compact('res'));\n\t\t$this->set('_serialize', 'res');\n\t}\n```\n\n\n\n- set association cho `app/Model/User.php `\n\n```php:app/Model/User.php\nclass User extends AppModel {\n\tpublic $hasOne = array (\n\t\t'TodoList' => array (\n\t\t\t'className' => 'TodoList',\n\t\t\t'foreignKey' => 'owner'\n\t\t)\n\t);\n}\n```\n\n\u1ed4n r\u1ed3i, h\u00e3y ki\u1ec3m tra k\u1ebft qu\u1ea3 \u1edf (`http://(PublicIP)/rest-study/users.json`)\n\n```json:result\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"67\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owner\": \"68\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": null,\n            \"todo\": null,\n            \"status\": null,\n            \"owner\": null,\n            \"assignee\": null\n        }\n    }\n]\n```\n\nM\u1ed7i todo s\u1ebd \u0111i k\u00e8m th\u00f4ng tin c\u00e1 nh\u00e2n c\u1ee7a m\u1ed9t user.\nN\u1ebfu ai \u0111\u00f3 kh\u00f4ng c\u00f3 TODO n\u00e0o th\u00ec m\u1ed7i th\u00e0nh ph\u1ea7n c\u1ee7a m\u1ea3ng c\u00f3 th\u1ec3 l\u00e0 null.\n\nCode SQL nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y, ch\u00fang ta ch\u1ea1y 2 l\u1ea7n `hasMany`.\n\n```sql\nSELECT\n\t`User`.`id`,\n\t`User`.`username`, \n\t`User`.`password`, \n\t`User`.`name`, \n\t`TodoList`.`id`, \n\t`TodoList`.`todo`, \n\t`TodoList`.`status`, \n\t`TodoList`.`owner`, \n\t`TodoList`.`assignee` \nFROM `study`.`users` AS `User` \n\t\tLEFT JOIN `study`.`todo_lists` AS `TodoList` ON (`TodoList`.`owner` = `User`.`id`)  \nWHERE 1 = 1\n```\n\nGi\u1ea3i th\u00edch v\u1ec1 l\u00fd do m\u00ecnh s\u1eed d\u1ee5ng `WHERE 1 = 1` th\u00ec b\u1ea1n kh\u00f4ng c\u1ea7n quan t\u00e2m, n\u00f3 l\u00e0 m\u1ed9t ki\u1ec3u SQL, b\u1ea1n ch\u1ec9 c\u1ea7n JOIN m\u00e0 th\u00f4i.\n\n\n### Test hasMany\n\n`user : todo` s\u1ebd tr\u1edf th\u00e0nh `1 : n` khi s\u1eed d\u1ee5ng `hasMany`.\n\n### C\u00e1c ph\u1ea7n c\u1ea7n s\u1eeda trong source\n\n`app/Controller/UsersController.php` m\u00ecnh s\u1ebd th\u00eam m\u1ed9t state c\u1ed1 \u0111\u1ecbnh v\u1edbi hasOne.\n\nset association cho `app/Model/User.php`.\n\n```php:app/Model/User.php\nclass User extends AppModel {\n\tpublic $hasMany = array (\n\t\t'TodoList' => array (\n\t\t\t'className' => 'TodoList',\n\t\t\t'foreignKey' => 'owner'\n\t\t)\n\t);\n}\n```\n\nhasOne t\u00f4i s\u1ebd s\u1eeda th\u00e0nh hasMany\nK\u1ebft qu\u1ea3 s\u1ebd nh\u01b0 sau\n\n```json:result\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"Yamada\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"62\",\n                \"todo\": \"walking\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"67\"\n            },\n            {\n                \"id\": \"78\",\n                \"todo\": \"studying\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"Tanaka\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"83\",\n                \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n                \"status\": \"1\",\n                \"owner\": \"68\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"Sato\"\n        },\n        \"TodoList\": []\n    }\n]\n```\n\nV\u1eady l\u00e0 b\u1eb1ng c\u00e1ch n\u00e0y, TODO \u0111\u00e3 hi\u1ec3n th\u1ecb \u0111\u00fang v\u1edbi nhi\u1ec1u TODO cho m\u1ed7i user.\n\u0110\u00e2y g\u1ecdi l\u00e0 hasMany.\nTh\u1eddi \u0111i\u1ec3m n\u00e0y th\u00ec SQL s\u1ebd ch\u1ea1y 2 l\u1ec7nh sau. M\u1ed7i l\u1ea7n ch\u1ea1y SQL th\u00ec hasMany ch\u1ea1y 2 l\u1ea7n.\n\n```sql:Lan1\nSELECT `User`.`id`, `User`.`username`, `User`.`password`, `User`.`name` FROM `study`.`users` AS `User`   WHERE 1 = 1\n```\n\n```sql:Lan2\nSELECT `TodoList`.`id`, `TodoList`.`todo`, `TodoList`.`status`, `TodoList`.`owner`, `TodoList`.`assignee` FROM `study`.`todo_lists` AS `TodoList`   WHERE `TodoList`.`owner` IN (67, 68, 69)\n```\n\n\u1ede l\u1ea7n 2 b\u1ea1n ph\u1ea3i select TodoList v\u1edbi owner l\u00e0 ID c\u1ee7a user m\u00e0 b\u1ea1n nh\u1eadn \u0111\u01b0\u1ee3c \u1edf l\u1ea7n 1 .\nNh\u01b0ng m\u00ecnh \u0111\u00e3 ch\u1ea1y xong r\u1ed3i n\u00ean h\u00e3y tr\u1edf l\u1ea1i ch\u1ed7 c\u0169 n\u01a1i b\u1ea1n \u0111\u00e3 s\u1eeda \u0111\u1ec3 \u0111\u1ebfn v\u1edbi b\u00e0i 2, h\u00e3y t\u1ea1o m\u1ed9t trang m\u1edbi\n\n\n## :large_blue_circle: B\u00e0i 2: Client side\n\n\u1ede b\u00e0i 2 n\u00e0y, m\u00ecnh s\u1ebd code ph\u1ea7n client side c\u1ee7a \u1ee9ng d\u1ee5ng.\n\n### Ch\u00fa\n\nB\u1ea1n c\u00f3 th\u1ec3 t\u1ef1 l\u00e0m h\u1ea7u h\u1ebft v\u1edbi nh\u1eefng ki\u1ebfn th\u1ee9c m\u00e0 b\u1ea1n \u0111\u00e3 c\u00f3 t\u1eeb b\u00e0i tr\u01b0\u1edbc, tuy nhi\u00ean \u1edf th\u1eddi \u0111i\u1ec3m n\u00e0y, \u0111\u1ec3 \"nh\u1eadn v\u00e0 hi\u1ec3n th\u1ecb danh s\u00e1ch user\" \u1edf ph\u1ea7n sau s\u1ebd c\u1ea7n m\u1ed9t v\u00e0i comment nh\u1ecf.\n\n- Danh s\u00e1ch user \u1edf trang TODO list\n\n![1.png](https://qiita-image-store.s3.amazonaws.com/0/94375/cbfdf727-e871-e616-80ab-3402f276f1bd.png)\n\n\n- Danh s\u00e1ch user \u1edf trang TODO Detail\n\n\n![0.1.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/d89a835c-dbfa-7fe8-50b6-e0159255d94e.png)\n\n\n#### B\u1eaft \u0111\u1ea7u th\u1ef1c hi\u1ec7n\n\n\u1ede Backbone, n\u1ebfu b\u1ea1n c\u00f3 th\u1ec3 t\u1eadn d\u1ee5ng h\u1ebft th\u1ebf m\u1ea1nh c\u1ee7a Marionette, \u0111\u1ea7u ti\u00ean th\u00ec user list s\u1ebd hi\u1ec3n th\u1ecb \u1edf View, \"Behavior\" kh\u00e1 t\u1ed1t, nh\u01b0ng t\u00f4i s\u1ebd chia s\u1ebb qua v\u00ed d\u1ee5 s\u1eed d\u1ee5ng h\u00e0m, v\u00e0 \u0111\u00e2y l\u00e0 th\u1eddi \u0111i\u1ec3m d\u00f9ng \"CakePHP Associations\" l\u00e0 ch\u00ednh, h\u00e3y nh\u1edb r\u1eb1ng s\u1ebd r\u1ea5t d\u1ec5 d\u00e0ng \u0111\u1ec3 implement n\u00f3.\n\nC\u1ee5 th\u1ec3\n\n- Nh\u1eadp URL c\u1ee7a API (`http://(PublicIP)/rest-study/users.json`) \u0111\u1ec3 l\u1ea5y collection c\u1ee7a user list.\n- Collecton n\u00e0y \u0111\u01b0\u1ee3c d\u00f9ng v\u1edbi v\u00f2ng l\u1eb7p, N\u00f3 s\u1ebd n\u1eb1m trong tag `<select> </select>` trong template, Ph\u1ea7n th\u1ebb `<option value =\"user id\"> user's name </ option>` s\u1ebd \u0111\u01b0\u1ee3c l\u1ecdc b\u1eb1ng c\u00e1ch s\u1eed d\u1ee5ng JQuery.\n\n\u0110\u00e2y l\u00e0 c\u00e1ch l\u00e0m\n\nHi\u1ec7n t\u1ea1i th\u00ec t\u00f4i \u0111\u00e3 \"copy v\u00e0 paste\" \u0111\u1ec3 d\u00f9ng \u1edf c\u1ea3 TODO lists v\u00e0 TODO detail.\n(V\u00e0 n\u00f3 kh\u00f4ng DRY v\u00ec ch\u00fang ta \u0111\u00e3 vi ph\u1ea1m Don't Repeat Yourself, nh\u01b0ng th\u1eddi \u0111i\u1ec3m n\u00e0y m\u00ecnh s\u1ebd l\u00e0m nhanh \u0111\u1ec3 v\u00ed d\u1ee5 th\u00f4i !)\n\nV\u00e0 \u0111\u00e2y l\u00e0 ch\u00fa th\u00edch v\u1ec1 ch\u1ec9nh s\u1eeda.\n\n\n### C\u00e1c file c\u1ea7n thay \u0111\u1ed5i\n\n|Thao t\u00e1c|file|M\u00f4 t\u1ea3|\n|---|:------------------------------------------------|:----------------------|\n|S\u1eeda|app/View/Layouts/default.ctp                    |S\u1eeda template\n|S\u1eeda|app/webroot/js/collections/user-collection.js   |user collection\n|S\u1eeda|app/webroot/js/models/todo-model.js             |parse\n|S\u1eeda|app/webroot/js/views/todo-layout-view.js        |\u0110\u1ec3 \u0111\u1ecdc userlist\n|S\u1eeda|app/webroot/js/views/todo-composite-view.js     |User list\n|S\u1eeda|app/webroot/js/views/todo-item-view.js          |Hi\u1ec3n th\u1ecb c\u00e1c n\u00fat \u0111i\u1ec1u khi\u1ec3n nh\u01b0 detail, delete\n|S\u1eeda|app/webroot/js/views/todo-detail-layout-view.js |\u0110\u1ecdc User List\n|S\u1eeda|app/webroot/js/views/todo-detail-item-view.js   |User List\n\n\n### default.ctp\n\nS\u1eeda template\n\n```diff:default.ctp\n\n\u301c\u3000\u7565\u3000\u301c\n  <title>\u30b7\u30f3\u30d7\u30ebTODO\u30a2\u30d7\u30ea</title>\n </head>\n <body>\n \t<!-- \u30d8\u30c3\u30c0 -->\n \t<div id=\"header\"></div>\n \t<!-- \u30b3\u30f3\u30c6\u30f3\u30c4 -->\n \t<div id=\"main\"></div>\n\n\u301c\u3000\u7565\u3000\u301c\n \n \t<!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-composite-template\">\n \t<textarea style=\"width:300px;height:50px\"id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n+\t<select name=\"assignee\" id=\"user-list\">\n \t<input type=\"button\" id=\"addTodo\" value=\"\u8ffd\u52a0\">\n \t<hr>\n \t<div>\n \t\t<table border=\"1\" width=\"350px\">\n+\t\t\t<thead>\n+\t\t\t\t<tr>\n+\t\t\t\t\t<td>Status</td>\n+\t\t\t\t\t<td>ToDo</td>\n+\t\t\t\t\t<td>Owner</td>\n+\t\t\t\t\t<td>Assignee</td>\n+\t\t\t\t\t<td colspan=\"2\"></td>\n+\t\t\t\t</tr>\n+\t\t\t</thead>\n \t\t\t<tbody></tbody>\n \t\t</table>\n \t</div>\n \t</script>\n \n \t<!-- TODO\u4e00\u884c\u5206\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08\u4e0a\u306etbody\u90e8\u5206\u306b\u633f\u5165\u3055\u308c\u308b\uff09 -->\n \t<script type=\"text/template\" id=\"todo-item-template\">\n \t<td><input type=\"checkbox\" class=\"toggle\" <%- status === '1' ? 'checked' : '' %>></td>\n \t<td style=\"margin:0px\">\n \t\t<span class=\"todo-edit\" style=\"margin:0px\"><%- todo %></span>\n \t</td>\n \t<td>\n+\t\t<span><%- Owner.name %></span>\n+\t</td>\n+\t<td>\n+\t\t<span><%- Assignee.name %></span>\n+\t</td>\n+\t<td>\n \t\t<a class=\"remove-link\" href=\"#\">Delete</a>\n+\t</td>\n+\t<td>\n \t\t<a class=\"detail-link\" href=\"#todo-lists/<%- id %>\">Detail</a>\n \t</td>\n \t</script>\n \n \t<!-- \u8a73\u7d30\u753b\u9762\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-detail-layout-template\">\n \t<div id=\"todo-item\"></div>\n \t</script>\n \n \t<!-- \u8a73\u7d30\u753b\u9762\u306e\u8868\u793a\u5185\u5bb9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-detail-item-template\">\n \t<h2>Todo #<%- id %></h2>\n \t<div>\n \t<textarea style=\"width:300px;height:50px\" id=\"edit-todo\" autofocus placeholder=\"Todo?\"><%- todo %></textarea>\n+\t<select name=\"assignee\" id=\"user-list\">\n+\t</select>\n \t<input type=\"button\" id=\"updateTodo\" value=\"Update\"></input>\n \t<input type=\"button\" id=\"updateCancel\" value=\"Cancel\"></input>\n \t</div>\n \t</script>\n \n\u301c\u3000\u7565\u3000\u301c\n```\n\nGi\u1ea3i th\u00edch ch\u1ec9nh s\u1eeda\n\n- TODO list screen\n\t- Th\u00eam `<select> </select>` \u0111\u1ec3 hi\u1ec3n th\u1ecb danh s\u00e1ch user\n        - Th\u00eam `<thead> </thead>` v\u00e0o table (v\u00ec \u0111\u00e3 th\u00eam c\u00e1c c\u1ed9t m\u1edbi )\n        - [Delete] v\u00e0 [Details] c\u1ea7n chia th\u00eam `<td> </td>`\n- TODO detail screen\n\t- Th\u00eam `<select> </select>` \u0111\u1ec3 hi\u1ec3n th\u1ecb danh s\u00e1ch user.\n\n### user-collection.js\n\n```js:user-collection.js\n//User list collection\ndefine(function(require) {\n\tvar UserModel = require('models/user-model');\n\n\tvar UserCollection = Backbone.Collection.extend({\n\t\turl : '/rest-study/users.json',\n\t\tmodel : UserModel,\n\n\t\tparse : function(response) {\n\t\t\treturn response;\n\t\t}\n\t});\n\t\n\treturn UserCollection;\n});\n```\n\nRequired m\u00ecnh s\u1ebd require t\u1ed1i thi\u1ec3u m\u1ed9t collection.\nM\u00ecnh kh\u00f4ng c\u1ea7n gi\u1ea3i th\u00edch g\u00ec c\u1ea3.\n\n\n### todo-model.js\n\nCh\u00fang ta \u0111ang ph\u00e2n t\u00edch `Owner` v\u00e0 `Assignee` khi th\u00eam m\u1ed9t TODO m\u1edbi.\n\n```diff:todo-model.js\n //Model representing County Todo data 1\n define(function() {\n \tvar TodoModel = Backbone.Model.extend({\n \t\turlRoot : '/rest-study/todo_lists',\n \t\tparse : function(response) {\n \t\t\t//\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\n \t\t\tconsole.log(\"\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\");\n \t\t\tconsole.log(response);\n-\t\t\treturn response.TodoList;\n+\t\t\tvar parsed = response.TodoList;\n+\t\t\tif (response.Owner) {\n+\t\t\t\tparsed.Owner = response.Owner;\n+\t\t\t\tparsed.Assignee = response.Assignee;\n+\t\t\t}\n+\t\t\treturn parsed;\n \t\t},\n \t\ttoggle : function() {\n \t\t\tthis.set('status', this.get(\"status\") === '1' ? '0' : '1');\n \t\t\tthis.save();\n \t\t}\n \t});\n \treturn TodoModel;\n });\n```\n\nKhi chuy\u1ec3n th\u00e0nh JSON th\u00ec TODO1 s\u1ebd theo format sau, tr\u1ea3 v\u1ec1 t\u1eeb server b\u1eb1ng CakePHP,\n\n```json:ServerResponseJSON\n{\n    \"TodoList\": {\n        \"id\": \"62\",\n        \"todo\": \"Watching TV\",\n        \"status\": \"0\",\n        \"owned\": false,\n        \"assigned\": false\n    },\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\n    }\n}\n```\n\nN\u00f3 s\u1ebd thay \u0111\u1ed5i sang format sau\n\n```json:ServerResponseJSON\n{\n    \"id\": \"62\",\n    \"todo\": \"Watching TV\",\n    \"status\": \"0\",\n    \"owned\": false,\n    \"assigned\": false,\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"Yamada\"\n    }\n}\n```\n\n### todo-layout-view.js\n\nB\u1ea1n c\u1ea7n th\u00eam m\u1ed9t ti\u1ebfn tr\u00ecnh \u0111\u1ec3 \u0111\u1ecdc danh s\u00e1ch user.\n\n```diff:todo-layout-view.js\n define(function(require){\n \tvar TodoCompositeView = require('views/todo-composite-view');\n \tvar TodoCollection = require('collections/todo-collection');\n+\tvar UserCollection = require('collections/user-collection');\n \n \tvar TodoLayoutView = Marionette.LayoutView.extend({\n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate: '#todo-layout-template',\n \n \t\tregions : {\n \t\t\tlistRegion : '#todo-lists',\n \t\t},\n \n-\t\tonRender : function(){\n+\t\tonRender : function() {\n+\t\t\tthis.userCollection = new UserCollection();\n+\t\t\tthis.listenTo(this.userCollection, 'reset', this.onLoadUsers, this);\n+\t\t\tthis.userCollection.fetch({reset : true});\n+\t\t},\n+\n+\t\tonLoadUsers : function(userCollection) {\n \t\t\tvar todoCollection = new TodoCollection();\n \t\t\tthis.listenTo(todoCollection , 'reset', this.showTodoList, this);\n \t\t\ttodoCollection.fetch({reset : true});\n \t\t},\n \n \t\tshowTodoList : function(todoCollection){\n \t\t\tthis.listRegion.show( new TodoCompositeView({\n-\t\t\t\tcollection : todoCollection\n+\t\t\t\tcollection : todoCollection,\n+\t\t\t\tuserList : this.userCollection.models\n \t\t\t}));\n \t\t},\n \n \t});\n \treturn TodoLayoutView;\n });\n```\n\n- \u0110\u1ecdc `collections/user-collection` b\u1eb1ng `require`\n- Ch\u1ec9 trong h\u00e0m `onRender`, m\u00ecnh s\u1ebd l\u1ea5y v\u1ec1 danh s\u00e1ch user t\u1eeb server b\u1eb1ng `this.userCollection.fetch()`.\n- Khi \u0111\u00e3 \u0111\u1ed5 d\u1eef li\u1ec7u v\u1ec1 xong (ListenTo \u0111\u00e3 ho\u1ea1t \u0111\u1ed9ng), Ch\u1ea1y h\u00e0m `onLoadUsers`, v\u00e0 k\u00e9o theo \u0111\u00f3 l\u00e0 `showTodoList` c\u0169ng \u0111\u01b0\u1ee3c th\u1ef1c thi\n- \u1ede h\u00e0m `showTodoList`, trong khi kh\u1edfi t\u1ea1o `TodoCompositeView`, ch\u00fang ta c\u1ea7n l\u1ea5y collection c\u1ee7a user list.\n- Ch\u00fang ta kh\u00f4ng xem user list collection trong ti\u1ebfn tr\u00ecnh c\u1ee7a `TodoCompositeView`.\n\n### `todo-composite-view.js`\n\nN\u00f3 s\u1ebd hi\u1ec3n th\u1ecb danh s\u00e1ch user\n\n```diff:todo-composite-view.js\n //View c\u1ee7a TODO list\n define(function(require) {\n \tvar TodoItemView = require('views/todo-item-view');\n \n \tvar TodoCompositeView = Marionette.CompositeView.extend({\n \t\ttemplate: '#todo-composite-template',\n \n \t\tchildView : TodoItemView,\n \n \t\tchildViewContainer : 'tbody',\n \n \t\tui : {\n \t\t\taddTodo : '#addTodo',\n-\t\t\tnewTodo : '#new-todo'\n+\t\t\tnewTodo : '#new-todo',\n+\t\t\tuserList : '#user-list'\n \t\t},\n \n \t\tevents : {\n \t\t\t'click @ui.addTodo' : 'onCreateTodo',\n \t\t},\n \n-\t\tinitialize: function(){\n+\t\tinitialize: function(options){\n \t\t\t_.bindAll( this, 'onCreatedSuccess' );\n+\t\t\tthis.userList = options.userList;\n \t\t},\n \n+\t\tonRender : function() {\n+\t\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\t\tthis.showUserList(this.ui.userList, this.userList);\n+\t\t\t//\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+\t\t\tthis.ui.userList.val(window.application.loginUser.id);\n+\t\t},\n+\t\t\t\t\t\n+\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\tshowUserList : function($list, userList){\n+\t\t\t$.each(userList, function(index, userModel) {\n+\t\t\t\t$list.append(\n+\t\t\t\t\t\"<option value='\" \n+\t\t\t\t\t+ userModel.attributes.id + \"'>\"\n+\t\t\t\t\t+ userModel.attributes.name + \"</option>\");\n+\t\t\t});\n+\t\t},\n+\t\t\t\n \t\tonCreateTodo : function() {\n \t\t\tthis.collection.create(this.newAttributes(), {\n \t\t          silent:  true ,\n \t\t          success: this.onCreatedSuccess\n \t\t\t});\n \t\t\tthis.ui.newTodo.val('');\n \t\t},\n \n \t\tnewAttributes : function() {\n \t\t\treturn {\n \t\t\t\ttodo : this.ui.newTodo.val().trim(),\n-\t\t\t\tstatus : 0\n+\t\t\t\tstatus : 0,\n+\t\t\t\tassignee : this.ui.userList.val()\n \t\t\t};\n \t\t},\n \n \t\tonCreatedSuccess : function(){\n \t\t\tthis.collection.fetch({ reset : true });\n \t\t},\n \n \t});\n \treturn TodoCompositeView;\n });\n```\n\n\n- Th\u00eam `userList` v\u00e0o bi\u1ebfn `ui`\u0111\u1ec3 x\u1eed l\u00fd select box c\u1ee7a user list.\n- \u1ede trong h\u00e0m `initialize`, t\u1ea1i todo-layout-view t\u1eeb collection danh s\u00e1ch user \u0111\u00e3 l\u1ea5y v\u1ec1 (\u0111\u1ed5 v\u00e0o `options.userList`) c\u1ee7a ch\u00ednh n\u00f3 (v\u00e0 truy\u1ec1n v\u00e0o this.userList)\n- \u1ede trong h\u00e0m `onRender`, hi\u1ec3n th\u1ecb danh s\u00e1ch user b\u1eb1ng c\u00e1ch ch\u1ea1y h\u00e0m `showUserList`.\n- Sau khi c\u00f3 user list, \u0111\u1ec3 l\u1ea5y ID t\u1eeb th\u00f4ng tin user c\u1ee7a user \u0111\u00e3 login th\u00ec m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng h\u00e0m `window.application.loginUser` l\u00fac login, V\u00e0 ng\u01b0\u1eddi \u0111\u00f3 (login user) s\u1ebd \u0111\u01b0\u1ee3c ch\u1ecdn m\u1eb7c \u0111\u1ecbnh \u1edf user list. \n- T\u1ea1i h\u00e0m `showUserList`, m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng jquery, ch\u00fang ta s\u1ebd s\u1eed d\u1ee5ng tag `<option> </ option>` v\u00e0 tag `<select> </ select>` \u0111\u1ec3 ch\u1ee9a nh\u1eefng th\u00e0nh ph\u1ea7n \u0111\u01b0\u1ee3c g\u1ecdi trong bi\u1ebfn `ui`.\n- Khi m\u1ed9t TODO \u0111\u01b0\u1ee3c th\u00eam v\u00e0o  ( H\u00e0m `newAttributes`), m\u00ecnh s\u1ebd set ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ch\u1ecdn trong user list v\u00e0o (`assignee`).\n\n### todo-item-view.js\n\nCh\u00fang ta c\u1ea7n th\u00eam ph\u1ea7n qu\u1ea3n l\u00fd s\u1ef1 hi\u1ec3n th\u1ecb c\u00e1c button Delete-detail.\n\n```diff:todo-item-view.js\n //View c\u1ee7a m\u1ed7i TODO\n define(function(){\n \tvar TodoItemView = Marionette.ItemView.extend({\n \t\t//Tag name c\u1ee7a th\u00e0nh ph\u1ea7n trong DOM\n \t\ttagName : 'tr',\n \n \t\t//Tamplate\n \t\ttemplate : '#todo-item-template',\n \n \t\tui : {\n \t\t\tcheckBox : '.toggle',\n-\t\t\tremoveLink : '.remove-link'\n+\t\t\tremoveLink : '.remove-link',\n+\t\t\tdetailLink : '.detail-link'\n \t\t},\n \n \t\t//Cac su kien o DOM\n \t\tevents : {\n \t\t\t//Khi click vao Checkbox\n \t\t\t'click @ui.checkBox' : 'onStatusToggleClick',\n \t\t\t//Khi click button Delete\n \t\t\t'click @ui.removeLink' : 'onRemoveClick',\n \t\t},\n \n \t\tonStatusToggleClick : function() {\n \t\t\tthis.model.toggle();\n \t\t},\n \n \t\tonRemoveClick : function() {\n \t\t\tthis.model.destroy({\n \t\t\t\twait : true\n \t\t\t});\n \t\t},\n \n+\t\tonRender : function() {\n+\t\t\tif (!this.model.attributes.owned) {\n+\t\t\t\t//Neu khong phai Owner thi hide nut delete\n+\t\t\t\tthis.ui.removeLink.css({\n+\t\t\t\t\tdisplay : 'none' \n+\t\t\t\t\t//hoac dung visibility : hidden cung duoc\n+\t\t\t\t});\n+\t\t\t\tif (!this.model.attributes.assigned) {\n+\t\t\t\t\t//truong hop khong ph\u1ea3i assignee\n+\t\t\t\t\t//hide link vao detail\n+\t\t\t\t\tthis.ui.detailLink.css({\n+\t\t\t\t\t\tdisplay : 'none'\n+\t\t\t\t\t\t//hoac dung visibility : hidden cung duoc\n+\t\t\t\t\t});\n+\t\t\t\t\t//khong cho thay doi trang thai checkbox\n+\t\t\t\t\tthis.ui.checkBox.prop('disabled', true);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n \t});\n \treturn TodoItemView;\n }); \n```\n\n- Th\u00eam bi\u1ebfn `detailLink` v\u00e0 Delete link v\u00e0o `ui`.\n- Trong h\u00e0m `onRender`, m\u00ecnh s\u1ebd qu\u1ea3n l\u00fd s\u1ef1 hi\u1ec3n th\u1ecb hay kh\u00f4ng c\u1ee7a c\u00e1c link x\u00f3a v\u00e0 detail theo quy t\u1eafc sau.\n\t- \u1ea8n Delete link n\u1ebfu \u0111\u00e2y kh\u00f4ng ph\u1ea3i owner\n\t\t- Trong tr\u01b0\u1eddng h\u1ee3p \u0111\u00e2y kh\u00f4ng ph\u1ea3i l\u00e0 ng\u01b0\u1eddi \u0111\u01b0\u1ee3c giao l\u00e0m TODO n\u00e0y\n\t\t\t- V\u1eabn hi\u1ec7n link detail\n\t\t\t- Checkbox s\u1ebd b\u1ecb c\u1ed1 \u0111\u1ecbnh v\u00e0 kh\u00f4ng th\u1ec3 thay \u0111\u1ed5i\n\n\u203bC\u00e1ch th\u1ef1c hi\u1ec7n vi\u1ec7c qu\u1ea3n l\u00fd \u1ea9n hi\u1ec7n.\n\n- \u1ea2n link\n\t- Th\u00eam css b\u1eb1ng jquery, th\u00eam v\u00e0o style `display : 'none'`\n- Check box c\u1ed1 \u0111\u1ecbnh\n\t- Th\u00eam h\u00e0m `prop` b\u1eb1ng jquery, `disabled` chuy\u1ec3n th\u00e0nh `true`.\n\n### todo-detail-layout-view.js\n\nB\u1ea1n ph\u1ea3i th\u00eam m\u1ed9t ti\u1ebfn tr\u00ecnh \u0111\u1ecdc user list.\nNh\u1eefng th\u1ee9 b\u1ea1n \u0111ang l\u00e0m g\u1ea7n nh\u01b0 gi\u1ed1ng v\u1edbi `todo-layout-view.js`.\n\n```diff:todo-detail-layout-view.js\n define(function(require) {\n     var TodoDetailItemView = require('views/todo-detail-item-view');\n     var TodoModel = require('models/todo-model');\n+    var UserCollection = require('collections/user-collection');\n \n \tvar TodoDetailLayoutView = Marionette.LayoutView.extend({\n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate : '#todo-detail-layout-template',\n \n \t\tregions : {\n \t\t\titemRegion : '#todo-item',\n \t\t},\n \n \t\tonRender : function() {\n-\t\t\tvar todoModel = new TodoModel({\n-\t\t\t\tid : this.options.modelId\n-\t\t\t});\n-\t\t\t//\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n-\t\t\tthis.listenTo(todoModel, 'sync', this.showItem, this);\n-\t\t\t//\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n-\t\t\ttodoModel.fetch({\n-\t\t\t\twait : true\n+\t\t\tthis.userCollection = new UserCollection();\n+\t\t\tthis.listenToOnce(this.userCollection, 'reset', this.onLoadUsers, this);\n+\t\t\tthis.userCollection.fetch({\n+\t\t\t\treset : true\n \t\t\t});\n \t\t},\n \n-\t\tshowItem : function(todoModel) {\n-\t\t\tthis.itemRegion.show( new TodoDetailItemView({\n-\t\t\t\tmodel : todoModel\n-\t\t\t}));\n-\t\t},\n+\t\tonLoadUsers : function(userCollection){\n+ \t\t\tvar todoModel = new TodoModel({\n+ \t\t\t\tid : this.options.modelId\n+ \t\t\t});\n+ \t\t\t//\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n+\t\t\tthis.listenToOnce(todoModel, 'sync', this.showItem, this);\n+ \t\t\t//\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n+ \t\t\ttodoModel.fetch({\n+ \t\t\t\twait : true\n+ \t\t\t});\n+ \t\t},\n+\n+ \t\tshowItem : function(todoModel) {\n+ \t\t\tthis.itemRegion.show(new TodoDetailItemView({\n+ \t\t\t\tmodel : todoModel,\n+ \t\t\t\tuserList : this.userCollection.models\n+ \t\t\t}));\n+ \t\t},\n \n \t});\n \treturn TodoDetailLayoutView;\n });\n```\n\n- \u0110\u1ecdc `collections/user-collection` th\u00f4ng qua `require`\n- Trong h\u00e0m `onRender`, Ch\u1ea1y h\u00e0m `this.userCollection.fetch()` \u0111\u1ec3 \u0111\u1ed5 d\u1eef li\u1ec7u danh s\u00e1ch user v\u1ec1 t\u1eeb server.\n- \u0110\u01b0\u1ee3c th\u1ef1c hi\u1ec7n t\u1eeb `onRender`, ti\u1ebfn tr\u00ecnh nh\u1eadn d\u1eef li\u1ec7u \u1edf model th\u1ee9 1 t\u1eeb server, b\u1ea1n \u0111\u00e3 \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ebfn `onLoadUsers`.\n- Khi qu\u00e1 tr\u00ecnh \u0111\u1ed5 d\u1eef li\u1ec7u ho\u00e0n t\u1ea5t (ListenTo \u0111\u00e3 ch\u1ea1y), Ch\u1ea1y h\u00e0m `onLoadUsers`,`todoModel.fetch()` \u0111\u1ec3 l\u1ea5y d\u1eef li\u1ec7u c\u1ee7a TODO 1.\n- Trong h\u00e0m `showItem`, trong ph\u1ea7n initialization c\u1ee7a `TodoDetailItemView`, m\u00ecnh c\u1ea7n truy\u1ec1n collection c\u1ee7a user list\n- Hi\u1ec3n th\u1ecb user list collection trong c\u00e1c ti\u1ebfn tr\u00ecnh c\u1ee7a `TodoDetailItemView`.\n\n### `todo-detail-item-view.js`\n\nHi\u1ec3n th\u1ecb todo list\n\n```diff:todo-detail-item-view.js\n //\u8a73\u7d30\u30d3\u30e5\u30fc\n define(function() {\n \tvar TodoDetailItemView = Marionette.ItemView.extend({\n \n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate: \"#todo-detail-item-template\",\n \n \t\tui : {\n \t\t\ttodoStatus   : '#edit-todo',\n \t\t\tupdateButton : '#updateTodo',\n-\t\t\tcancelButton : '#updateCancel'\n+\t\t\tcancelButton : '#updateCancel',\n+\t\t\tuserList     : '#user-list'\n \t\t},\n \n \t\t//DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n \t\tevents : {\n \t\t\t//\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.updateButton' : 'onUpdateClick',\n \t\t\t//\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.cancelButton' : 'onCancelClick',\n \t\t},\n \n \t\t//\u521d\u671f\u5316\n-\t\tinitialize: function(){\n+\t\tinitialize: function(options){\n \t\t\t_.bindAll( this, 'onSaveSuccess' );\n+\t\t\tthis.userList = options.userList;\n+\t\t},\n+\n+\t\tonRender : function() {\n+\t\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\t\tthis.showUserList(this.ui.userList, this.userList);\n+\t\t\t//\u62c5\u5f53\u8005\u3092\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+\t\t\tthis.ui.userList.val(this.model.attributes.assignee);\n+\t\t},\n+\n+\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\tshowUserList : function($list, userList){\n+\t\t\t$.each(userList, function(index, userModel) {\n+\t\t\t$list.append(\n+\t\t\t\t\"<option value='\" \n+\t\t\t\t+ userModel.attributes.id + \"'>\"\n+\t\t\t\t+ userModel.attributes.name + \"</option>\");\n+\t\t\t});\n \t\t},\n \n \t\t//\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n \t\tonUpdateClick : function() {\n \t\t\t//\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u6587\u5b57\u3092\u53d6\u5f97\n-\t\t\tvar todoString = this.ui.todoStatus.val();\n+\t\t\tvar todoString = this.ui.todoStatus.val();  // Todo\n+\t\t\tvar assigneeId = this.ui.userList.val();\t// \u62c5\u5f53\u8005\n \t\t\tthis.model.save({\n-\t\t\t\ttodo : todoString\n+\t\t\t\ttodo : todoString,\n+\t\t\t\tassignee : assigneeId\n \t\t\t}, {\n \t\t\t\tsilent : true,\n \t\t\t\tsuccess : this.onSaveSuccess,\n \t\t\t});\n \t\t},\n \n \t\t//\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n \t\tonCancelClick : function() {\n \t\t\tthis.backTodoLists();\n \t\t},\n \n \t\t//\u66f4\u65b0\u6210\u529f\n \t\tonSaveSuccess : function() {\n \t\t\tthis.backTodoLists();\n \t\t},\n \n \t\t//TODO\u30ea\u30b9\u30c8\u753b\u9762\u306b\u623b\u308b\n \t\tbackTodoLists : function() {\n \t\t\tBackbone.history.navigate('#todo-lists', true);\n \t\t}\n \n \t});\n \treturn TodoDetailItemView;\n });\n```\n\n\u0110\u1ec3 hi\u1ec3n th\u1ecb user list, t\u01b0\u01a1ng t\u1ef1 nh\u01b0 \u0111\u00e3 l\u00e0m v\u1edbi `todo-composite-view.js`.\n\n\n- Th\u00eam `userList` v\u00e0o bi\u1ebfn `ui` \u0111\u1ec3 x\u1eed l\u00fd select box c\u1ee7a user list.\n- Trong h\u00e0m `initialize`, t\u1ea1i todo-layout-view \u0111\u01b0\u1ee3c truy\u1ec1n t\u1eeb user list collection ( v\u00e0o `options.userList`) c\u1ee7a ch\u00ednh n\u00f3 (n\u00ean \u0111\u01b0\u1ee3c l\u01b0u \u1edf this.userList)\n- Trong h\u00e0m `onRender`, hi\u1ec3n th\u1ecb userlist b\u1eb1ng c\u00e1ch ch\u1ea1y h\u00e0m `showUserList`.\n- Sau user list m\u00ecnh set v\u00e0o state \u0111\u01b0\u1ee3c ch\u1ecdn ( l\u1ea5y t\u1eeb `assignee` c\u1ee7a model) user ID c\u1ee7a TODO c\u1ee7a m\u1ed7i c\u00e1 nh\u00e2n s\u1ebd \u0111\u01b0\u1ee3c hi\u1ec3n th\u1ecb.\n- H\u00e0m `ShowUserList` l\u00e0 vi\u1ec7c copy v\u00e0 paste c\u1ee7a c\u00f9ng 1 h\u00e0m t\u1eeb `todo-composite-view.js`! ( C\u00e1c b\u1ea1n c\u00f3 th\u1ec3 xem gi\u1ea3i th\u00edch \u1edf tr\u00ean kia!)\n- Trong ti\u1ebfn tr\u00ecnh c\u1ee7a vi\u1ec7c click button Update (`onUpdateClick` function), m\u00ecnh s\u1ebd s\u1ebd cho ph\u00e9p ng\u01b0\u1eddi d\u00f9ng \u0111\u01b0\u1ee3c ch\u1ecdn \u1edf danh s\u00e1ch user \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng (`assignee`).\n\n\n\n### T\u1ed5ng k\u1ebft b\u00e0i h\u1ecdc\n\nC\u00e1c b\u01b0\u1edbc th\u1ef1c hi\u1ec7n c\u1ee7a ta nh\u01b0 sau.\n\n\n- :white_check_mark: `app/View/Layouts/default.ctp` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/collections/user-collection.js` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/models/todo-model.js` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-layout-view.js` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-composite-view.js` s\u1eeda nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-item-view.js` truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-detail-layout-view.js` truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-detail-item-view.js` truy\u1ec1n th\u00eam nh\u1eefng gi\u00e1 tr\u1ecb m\u1edbi nh\u01b0 tr\u00ean.\n- :white_check_mark: Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n- :white_check_mark: Commit l\u00ean Git\n\n\n**Tham kh\u1ea3o Diff ho\u00e0n ch\u1ec9nh tr\u00ean Github**\n\n[\u7b2c6\u56de Lesson1 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@f1623dc](https://github.com/suzukishouten-study/rest-study/commit/f1623dce75cbd2d38a4b971ffcb5b48ca6d4b91b)\n\n\u0110\u00f3 l\u00e0 t\u1ea5t c\u1ea3 b\u00e0i h\u1ecdc n\u00e0y.\n\n\n## T\u00f4i r\u1ea5t mong nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 ph\u1ea3n h\u1ed3i / g\u00f3p \u00fd c\u1ee7a c\u00e1c b\u1ea1n\n\nC\u1ea3m \u01a1n c\u00e1c b\u1ea1n \u0111\u00e3 quan t\u00e2m theo d\u00f5i series, r\u1ea5t c\u1ea3 c\u00e1c b\u00e0i h\u1ecdc t\u00f4i s\u1ebd \u0111\u1ec1u ch\u1ec9nh s\u1eeda sau khi hi\u1ec3u th\u00eam k\u1ef9 h\u01a1n v\u1ea5n \u0111\u1ec1 g\u00ec, ho\u1eb7c nh\u1eadn ra sai s\u00f3t, r\u1ea5t mong lu\u00f4n nh\u1eadn \u0111\u01b0\u1ee3c s\u1ef1 g\u00f3p \u00fd t\u1eeb c\u00e1c b\u1ea1n.\n"}