{"context": "\n\n\u524d\u66f8\u304d\n\u4ee5\u524d\u3001ntpd \u306e monlist \u6a5f\u80fd\u3092\u4f7f\u3063\u305f DDoS \u653b\u6483\u306b\u95a2\u3059\u308b\u6ce8\u610f\u559a\u8d77(CVE-2013-5211)\u304c\u3042\u3063\u305f\u306e\u3067 monlist \u3092\u7121\u52b9\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c Qiita \u3092\u307c\u30fc\u3063\u3068\u898b\u306a\u304c\u3089\u300cchrony \u304c\u3042\u308b\u3093\u3060\u306a\u3041\u300d\u3068\u3044\u3046\u3053\u3068\u3068\u300c\u3084\u3063\u3071\u308a pool.ntp \u306b\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u308b\u3057\u3069\u3053\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3055\u308c\u3066\u308b\u304b\u898b\u3066\u307f\u305f\u3044\u306a\u3041\uff01\u300d\u3068\u3044\u3046\u6b32\u6c42\u306b\u304b\u3089\u308c\u3066\u3069\u3046\u306b\u304b\u3057\u305f\u8a71\u3067\u3059\u3002\n\u3082\u3061\u308d\u3093\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306a\u3069\u3067\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u3082\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u300c\u3053\u3093\u306a\u3053\u3068\u3057\u3066\u308b\u3093\u3060\u306a\u3001\u3078\u3047\u30fc\u300d\u3068\u601d\u3044\u306a\u304c\u3089\u898b\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\nMachine Spec\n\nFreeBSD(10.1-RELEASE amd64)\nChrony(2.2 / by ports)\n\n\nInstall\nFreeBSD ports \u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3067 IPv6 \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u6c17\u306b\u305b\u305a\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\nConfig\n\nchrony.conf\ninclude /usr/local/*** \u79d8\u5bc6\u306e\u30b5\u30fc\u30d0\u30fc\u30ea\u30b9\u30c8\u7f6e\u304d\u5834 ***/*.conf\n\npeer *** \u30af\u30e9\u30b9\u30bf\u306b\u3057\u3066\u3044\u308b\u3082\u30461\u53f0\u306e\u30b5\u30fc\u30d0\u30fc ***\n\ndriftfile /var/db/chrony/drift\n\n#keyfile /usr/local/etc/chrony.keys\n#commandkey 10\n#generatecommandkey\n\n! dumponexit\n! dumpdir /var/db/chrony\n\n! pidfile /var/run/chronyd.pid\n\n! makestep 1.0 3\n\nlogdir /var/log/chrony\nlog measurements statistics tracking rtc \n\nallow allow 0.0.0.0/0\ncmdallow 127.0.0.1\n\n;ratelimit interval 4 burst 4\n\nbindaddress 0.0.0.0\nbindcmdaddress 127.0.0.1\n\nbroadcast 60 172.16.255.255\n\nclientloglimit 0\n\n\u57fa\u672c\u7684\u306b\u306f\u3069\u3053\u304b\u3089\u3067\u3082\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002(\u3053\u3053\u306b\u306f\u8a18\u8f09\u3057\u307e\u305b\u3093\u304c)ntp.conf \u306b\u3042\u308b server, pool, peer \u3082\u4f7f\u3048\u307e\u3059\u3002\nratelimit \u306f ports \u306b\u3042\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 2.2 \u3067\u4f7f\u3048\u306a\u3044\u306e\u3067 2.3 \u306b\u306a\u3063\u305f\u3089\u4f7f\u3048\u308b\u3088\u3046\u306b\u30b3\u30e1\u30f3\u30c8\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\nchronyc Config\n\u30d0\u30fc\u30b8\u30e7\u30f3 2.2 \u304b\u3089\u901a\u5e38\u306e ntpd / ntpdc \u3092\u4f7f\u3063\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002 \nSince version 2.2, the password command doesn\u2019t do anything and chronyc needs to run locally under the root or chrony user, which are allowed to access the chronyd's Unix domain command socket.\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 clients \u306e\u30ea\u30b9\u30c8\u3092\u898b\u308b\u305f\u3081\u306b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u3001 SSH \u3068 sudo \u3092\u4f7f\u3063\u3066\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u3067\u3082\u898b\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u3052\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u51fa\u6765\u308b\u306e\u3067\u3059\u3063\u98db\u3070\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u304b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u3069\u3046\u306a\u306e\u3068\u7a81\u3063\u8fbc\u307e\u308c\u305d\u3046\u306a\u306e\u3067\u3042\u3048\u3066\u3053\u3053\u3067\u66f8\u304d\u307e\u305b\u3093\u3051\u3069\u3082\u3046\u3061\u306f\u305d\u3046\u3057\u3066\u307e\u3059\u3002\n\nbonus section \u301cwhen viewed actually looking at the \"clients\" log\u301c\npool.ntp \u306b\u30dc\u30e9\u30f3\u30c6\u30a3\u30a2\u3068\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u304c\u6211\u304c\u5bb6\u306b\u3084\u3063\u3066\u304f\u308b\u65b9\u3005\u306f\u300c\u8fd1\u304f\u306b\u3082\u3063\u3068\u3044\u3044\u30b5\u30fc\u30d0\u30fc\uff71\uff99\uff96\uff70\u300d\u3068\u3044\u3046\u3053\u3068\u3092\u77e5\u3089\u305a\u306b\u4f7f\u3063\u3066\u3044\u308b\u306e\u304b\u3042\u3048\u3066\u3053\u3053\u3092\u4f7f\u3063\u3066\u308b\u3068\u3044\u3046\u65b9\u306a\u3093\u3060\u308d\u3046\u306a\u30fc\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u305c\u3072\u3053\u306e wiki \u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30ea\u30b9\u30c8\u3092\u898b\u3066\u9802\u3044\u3066\u300c\u304a\u30fc\u3001\u3046\u3061\u3068\u3080\u3061\u3083\u304f\u3061\u3083\u8fd1\u3044\u3068\u3053\u3042\u3093\u3058\u3083\u3093\uff01\uff01\u300d\u3068\u8208\u596e\u3057\u306a\u304c\u3089\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\u7279\u306b\u5927\u624b ISP \u3084\u5927\u5b66\u306a\u3069\u300c\u81ea\u5206\u306e\u3068\u3053\u306b\u3082 NTP \u30b5\u30fc\u30d0\u30fc\u304c\u3042\u308b\u300d\u3068\u3053\u308d\u3067\u300c\u5225\u306b pool.ntp \u3058\u3083\u306a\u304f\u3066\u3082\u3044\u3044\u304b\u306a\u30fc\u300d\u3068\u3044\u3046\u65b9\u306f\u304d\u3063\u3068\u4eba\u751f\u5909\u308f\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\uff57\n\u672c\u5f53\u306f NTP \u30b5\u30fc\u30d0\u30fc\u3092\u904b\u7528\u3057\u3066\u3044\u308b ISP \u3084\u5927\u5b66\u306e\u4e2d\u306e\u4eba\u304c\u300c\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u4f7f\u3063\u3066\u4f7f\u3063\u3066\u301c\u300d\u3068\u3082\u3063\u3068\u5ba3\u4f1d\u3057\u3066\u6b32\u3057\u3044\u3068\u3053\u308d\u306a\u3093\u3067\u3059\u304c\uff57\n# \u524d\u66f8\u304d\n\u4ee5\u524d\u3001[ntpd \u306e monlist \u6a5f\u80fd\u3092\u4f7f\u3063\u305f DDoS \u653b\u6483\u306b\u95a2\u3059\u308b\u6ce8\u610f\u559a\u8d77](https://www.jpcert.or.jp/at/2014/at140001.html)(CVE-2013-5211)\u304c\u3042\u3063\u305f\u306e\u3067 monlist \u3092\u7121\u52b9\u306b\u3057\u3066\u3044\u307e\u3057\u305f\u304c Qiita \u3092\u307c\u30fc\u3063\u3068\u898b\u306a\u304c\u3089\u300cchrony \u304c\u3042\u308b\u3093\u3060\u306a\u3041\u300d\u3068\u3044\u3046\u3053\u3068\u3068\u300c\u3084\u3063\u3071\u308a pool.ntp \u306b\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u308b\u3057\u3069\u3053\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3055\u308c\u3066\u308b\u304b\u898b\u3066\u307f\u305f\u3044\u306a\u3041\uff01\u300d\u3068\u3044\u3046\u6b32\u6c42\u306b\u304b\u3089\u308c\u3066\u3069\u3046\u306b\u304b\u3057\u305f\u8a71\u3067\u3059\u3002\n\n\u3082\u3061\u308d\u3093\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306a\u3069\u3067\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u3082\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u300c\u3053\u3093\u306a\u3053\u3068\u3057\u3066\u308b\u3093\u3060\u306a\u3001\u3078\u3047\u30fc\u300d\u3068\u601d\u3044\u306a\u304c\u3089\u898b\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n# Machine Spec\n* FreeBSD(10.1-RELEASE amd64)\n* Chrony(2.2 / by ports)\n\n# Install\nFreeBSD ports \u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3067 IPv6 \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u6c17\u306b\u305b\u305a\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n# Config\n## chrony.conf\n```\ninclude /usr/local/*** \u79d8\u5bc6\u306e\u30b5\u30fc\u30d0\u30fc\u30ea\u30b9\u30c8\u7f6e\u304d\u5834 ***/*.conf\n\npeer *** \u30af\u30e9\u30b9\u30bf\u306b\u3057\u3066\u3044\u308b\u3082\u30461\u53f0\u306e\u30b5\u30fc\u30d0\u30fc ***\n\ndriftfile /var/db/chrony/drift\n\n#keyfile /usr/local/etc/chrony.keys\n#commandkey 10\n#generatecommandkey\n\n! dumponexit\n! dumpdir /var/db/chrony\n\n! pidfile /var/run/chronyd.pid\n\n! makestep 1.0 3\n\nlogdir /var/log/chrony\nlog measurements statistics tracking rtc \n\nallow allow 0.0.0.0/0\ncmdallow 127.0.0.1\n\n;ratelimit interval 4 burst 4\n\nbindaddress 0.0.0.0\nbindcmdaddress 127.0.0.1\n\nbroadcast 60 172.16.255.255\n\nclientloglimit 0\n```\n\u57fa\u672c\u7684\u306b\u306f\u3069\u3053\u304b\u3089\u3067\u3082\u53d7\u3051\u4ed8\u3051\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002(\u3053\u3053\u306b\u306f\u8a18\u8f09\u3057\u307e\u305b\u3093\u304c)ntp.conf \u306b\u3042\u308b server, pool, peer \u3082\u4f7f\u3048\u307e\u3059\u3002\nratelimit \u306f ports \u306b\u3042\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 2.2 \u3067\u4f7f\u3048\u306a\u3044\u306e\u3067 2.3 \u306b\u306a\u3063\u305f\u3089\u4f7f\u3048\u308b\u3088\u3046\u306b\u30b3\u30e1\u30f3\u30c8\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n## chronyc Config\n[\u30d0\u30fc\u30b8\u30e7\u30f3 2.2 \u304b\u3089\u901a\u5e38\u306e ntpd / ntpdc \u3092\u4f7f\u3063\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002](https://chrony.tuxfamily.org/faq.html#_i_keep_getting_the_error_code_501_not_authorised_code) \n\n```\nSince version 2.2, the password command doesn\u2019t do anything and chronyc needs to run locally under the root or chrony user, which are allowed to access the chronyd's Unix domain command socket.\n```\n\u3068\u3044\u3046\u3053\u3068\u3067\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 clients \u306e\u30ea\u30b9\u30c8\u3092\u898b\u308b\u305f\u3081\u306b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u3001 SSH \u3068 sudo \u3092\u4f7f\u3063\u3066\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u3067\u3082\u898b\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3042\u3052\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u76e3\u8996\u30b5\u30fc\u30d0\u30fc\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u51fa\u6765\u308b\u306e\u3067\u3059\u3063\u98db\u3070\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u304b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u3069\u3046\u306a\u306e\u3068\u7a81\u3063\u8fbc\u307e\u308c\u305d\u3046\u306a\u306e\u3067\u3042\u3048\u3066\u3053\u3053\u3067\u66f8\u304d\u307e\u305b\u3093\u3051\u3069\u3082\u3046\u3061\u306f\u305d\u3046\u3057\u3066\u307e\u3059\u3002\n\n# bonus section \u301cwhen viewed actually looking at the \"clients\" log\u301c\npool.ntp \u306b\u30dc\u30e9\u30f3\u30c6\u30a3\u30a2\u3068\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u304c\u6211\u304c\u5bb6\u306b\u3084\u3063\u3066\u304f\u308b\u65b9\u3005\u306f\u300c\u8fd1\u304f\u306b\u3082\u3063\u3068\u3044\u3044\u30b5\u30fc\u30d0\u30fc\uff71\uff99\uff96\uff70\u300d\u3068\u3044\u3046\u3053\u3068\u3092\u77e5\u3089\u305a\u306b\u4f7f\u3063\u3066\u3044\u308b\u306e\u304b\u3042\u3048\u3066\u3053\u3053\u3092\u4f7f\u3063\u3066\u308b\u3068\u3044\u3046\u65b9\u306a\u3093\u3060\u308d\u3046\u306a\u30fc\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u305c\u3072[\u3053\u306e wiki \u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30ea\u30b9\u30c8](http://wiki.nothing.sh/page/NTP)\u3092\u898b\u3066\u9802\u3044\u3066\u300c\u304a\u30fc\u3001\u3046\u3061\u3068\u3080\u3061\u3083\u304f\u3061\u3083\u8fd1\u3044\u3068\u3053\u3042\u3093\u3058\u3083\u3093\uff01\uff01\u300d\u3068\u8208\u596e\u3057\u306a\u304c\u3089\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\u7279\u306b\u5927\u624b ISP \u3084\u5927\u5b66\u306a\u3069\u300c\u81ea\u5206\u306e\u3068\u3053\u306b\u3082 NTP \u30b5\u30fc\u30d0\u30fc\u304c\u3042\u308b\u300d\u3068\u3053\u308d\u3067\u300c\u5225\u306b pool.ntp \u3058\u3083\u306a\u304f\u3066\u3082\u3044\u3044\u304b\u306a\u30fc\u300d\u3068\u3044\u3046\u65b9\u306f\u304d\u3063\u3068\u4eba\u751f\u5909\u308f\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\uff57\n~~\u672c\u5f53\u306f NTP \u30b5\u30fc\u30d0\u30fc\u3092\u904b\u7528\u3057\u3066\u3044\u308b ISP \u3084\u5927\u5b66\u306e\u4e2d\u306e\u4eba\u304c\u300c\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u4f7f\u3063\u3066\u4f7f\u3063\u3066\u301c\u300d\u3068\u3082\u3063\u3068\u5ba3\u4f1d\u3057\u3066\u6b32\u3057\u3044\u3068\u3053\u308d\u306a\u3093\u3067\u3059\u304c\uff57~~\n", "tags": ["FreeBSD", "ntp", "chrony"]}