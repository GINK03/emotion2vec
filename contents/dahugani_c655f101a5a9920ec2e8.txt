{"context": " More than 1 year has passed since last update.fluentd(td-agent)\u3092\u4f7f\u3063\u3066apache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u52d5\u7684\u306bmongoDB\u306b\u767b\u9332\u3057\u3066\u3044\u304f\u3002\nWEB\u30a2\u30d7\u30ea\u3068\u30ed\u30b0\u96c6\u8a08\u306e\u30b5\u30fc\u30d0\u30fc\uff12\u53f0\u69cb\u6210\u3002\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\uff1a\n\u3000appache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3002\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\uff1a\n\u3000mongoDB\u3067\u30ed\u30b0\u3092\u96c6\u8a08\u3059\u308b\u30b5\u30fc\u30d0\u30fc\u3002\n\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u6e96\u5099\n\ntd-agent\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bURL\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u305d\u306e\u5f8c\u3067yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\nsudo vi /etc/yum.repos.d/td.repo\n\n\ntd.repo\n[treasuredata]name=TreasureDatabaseurl=http://packages.treasure-data.com/redhat/$basearchgpgcheck=0\n\n\nsudo yum install -y td-agent\n\n\ntd-agent\u306e\u8a2d\u5b9a\ntd-agent.conf\u3092\u66f8\u304d\u63db\u3048\u308b\u3002\n\u203b\u5143\u3042\u308b\u5185\u5bb9\u306f\u5168\u3066\u6d88\u3057\u3066\u66f8\u304d\u63db\u3048\u3066\u3057\u307e\u3063\u3066\u3088\u3044\u3002\nvi /etc/td-agent/td-agent.conf\n\n\ntd-agent.conf\n<source>  type tail  format apache  path /var/log/httpd/httpd_access_log  tag mongo.apache</source><match mongo.apache>  type forward  flush_interval 10s  <server>    host \u30db\u30b9\u30c8\u540d    port 24224  </server></match>```\n\n#\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\u6e96\u5099\n##fluentd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngem\u304b\u3089fluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u203b\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\u306b\u306fruby1.9\u4ee5\u4e0a\u304c\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3002\n\n\n\ngem install fluentdgem install bson_extgem install fluent-plugin-mongo\n```\n\nmongoDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bURL\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u305d\u306e\u5f8c\u3067yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\nvi /etc/yum.repos.d/10gen.repo\n\n\n10gen.repo\n[10gen]name=10gen Repositorybaseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64gpgcheck=0enabled=1\n\n\nyum install mongo-10gen-server mongo-10gen\n\n\n\u30ed\u30b0\u53ce\u96c6\u306e\u958b\u59cb\n\nmongoDB\u306e\u8d77\u52d5\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067mongoDB\u3092\u8d77\u52d5\u3059\u308b\u3002\n/etc/init.d/mongod start\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067fluentd\u3092\u8d77\u52d5\u3059\u308b\u3002\nfluentd -c /etc/fluentd/fluent.conf -vv -o /var/log/fluentd/fluentd.log &\n\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067td-agent\u3092\u8d77\u52d5\u3059\u308b\u3002\nsudo /etc/init.d/td-agent start\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u624b\u52d5\u3067\u66f8\u304d\u8fbc\u3080\u3002\nsudo vi /var/log/httpd/httpd_access_log\n\n127.0.0.1 - - [10/Jun/2013:20:30:39 +0900] \"GET /favicon.ico HTTP/1.1\" 404 288 \"-\" \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.110 Safari/537.36\"127.0.0.1 - - [10/Jun/2013:20:46:07 +0900] \"GET / HTTP/1.1\" 403 5044 \"-\" \"Mozilla/5.0 (Windows NT 6.1; rv:21.0) Gecko/20100101 Firefox/21.0\"127.0.0.1 - - [10/Jun/2013:20:46:07 +0900] \"GET /favicon.ico HTTP/1.1\" 404 288 \"-\" \"Mozilla/5.0 (Windows NT 6.1; rv:21.0) Gecko/20100101 Firefox/21.0\"\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067mongoDB\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u3002\nmongo httpd\n>db.accesslog.count()\n3\n>db.accesslog.find\n\n\nmongoDB\u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u8a2d\u5b9a\u5b8c\u4e86\u3002\n\n\u304a\u307e\u3051\n\n\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\ntd-agent\u306e\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3002\ntail -f -n 100 /var/log/td-agent/td-agent.log\n\n\u3053\u308c\u3067\u30a8\u30e9\u30fc\u3092\u78ba\u8a8d\u3057\u5bfe\u5fdc\u3059\u308b\u3002\n\nfluentd(td-agent)\u3092\u4f7f\u3063\u3066apache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u52d5\u7684\u306bmongoDB\u306b\u767b\u9332\u3057\u3066\u3044\u304f\u3002\nWEB\u30a2\u30d7\u30ea\u3068\u30ed\u30b0\u96c6\u8a08\u306e\u30b5\u30fc\u30d0\u30fc\uff12\u53f0\u69cb\u6210\u3002\n\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\uff1a\n\u3000appache\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3002\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\uff1a\n\u3000mongoDB\u3067\u30ed\u30b0\u3092\u96c6\u8a08\u3059\u308b\u30b5\u30fc\u30d0\u30fc\u3002\n\n#\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u6e96\u5099\n##td-agent\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bURL\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u305d\u306e\u5f8c\u3067yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\n\n\n```\nsudo vi /etc/yum.repos.d/td.repo\n```\n\n```td.repo\n[treasuredata]name=TreasureDatabaseurl=http://packages.treasure-data.com/redhat/$basearchgpgcheck=0\n```\n\n```\nsudo yum install -y td-agent\n```\n\n##td-agent\u306e\u8a2d\u5b9a\ntd-agent.conf\u3092\u66f8\u304d\u63db\u3048\u308b\u3002\n\u203b\u5143\u3042\u308b\u5185\u5bb9\u306f\u5168\u3066\u6d88\u3057\u3066\u66f8\u304d\u63db\u3048\u3066\u3057\u307e\u3063\u3066\u3088\u3044\u3002\n\n```\nvi /etc/td-agent/td-agent.conf\n```\n\n```td-agent.conf\n<source>  type tail  format apache  path /var/log/httpd/httpd_access_log  tag mongo.apache</source><match mongo.apache>  type forward  flush_interval 10s  <server>    host \u30db\u30b9\u30c8\u540d    port 24224  </server></match>```\n\n#\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\u6e96\u5099\n##fluentd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngem\u304b\u3089fluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u203b\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\u306b\u306fruby1.9\u4ee5\u4e0a\u304c\u5165\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3002\n\n```\ngem install fluentdgem install bson_extgem install fluent-plugin-mongo\n```\n\n##mongoDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306bURL\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u305d\u306e\u5f8c\u3067yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u3002\n\n```\nvi /etc/yum.repos.d/10gen.repo\n```\n\n```10gen.repo\n[10gen]name=10gen Repositorybaseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64gpgcheck=0enabled=1\n```\n\n```\nyum install mongo-10gen-server mongo-10gen\n```\n\n#\u30ed\u30b0\u53ce\u96c6\u306e\u958b\u59cb\n##mongoDB\u306e\u8d77\u52d5\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067mongoDB\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\n/etc/init.d/mongod start\n```\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067fluentd\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nfluentd -c /etc/fluentd/fluent.conf -vv -o /var/log/fluentd/fluentd.log &\n```\n\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067td-agent\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\nsudo /etc/init.d/td-agent start\n```\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\n\u9001\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u624b\u52d5\u3067\u66f8\u304d\u8fbc\u3080\u3002\n\n```\nsudo vi /var/log/httpd/httpd_access_log\n```\n\n```httpd_access_log\n127.0.0.1 - - [10/Jun/2013:20:30:39 +0900] \"GET /favicon.ico HTTP/1.1\" 404 288 \"-\" \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.110 Safari/537.36\"127.0.0.1 - - [10/Jun/2013:20:46:07 +0900] \"GET / HTTP/1.1\" 403 5044 \"-\" \"Mozilla/5.0 (Windows NT 6.1; rv:21.0) Gecko/20100101 Firefox/21.0\"127.0.0.1 - - [10/Jun/2013:20:46:07 +0900] \"GET /favicon.ico HTTP/1.1\" 404 288 \"-\" \"Mozilla/5.0 (Windows NT 6.1; rv:21.0) Gecko/20100101 Firefox/21.0\"\n```\n\n\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u3067mongoDB\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```\nmongo httpd\n>db.accesslog.count()\n3\n>db.accesslog.find\n\n```\n\nmongoDB\u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u8a2d\u5b9a\u5b8c\u4e86\u3002\n\n#\u304a\u307e\u3051\n##\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u53d7\u4fe1\u5074\u30b5\u30fc\u30d0\u30fc\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\ntd-agent\u306e\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```\ntail -f -n 100 /var/log/td-agent/td-agent.log\n```\n\n\u3053\u308c\u3067\u30a8\u30e9\u30fc\u3092\u78ba\u8a8d\u3057\u5bfe\u5fdc\u3059\u308b\u3002\n\n", "tags": ["fluentd", "td-agent", "Apache", "MongoDB"]}