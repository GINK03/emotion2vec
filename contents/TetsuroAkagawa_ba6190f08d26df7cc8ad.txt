{"context": "\n\nET\u30ed\u30dc\u30b3\u30f3\u306b\u304a\u3051\u308b\u8a08\u6e2c\u5668\u306e\u6d3b\u7528\n\u3000\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u3068\u306f\u3001\u8d70\u884c\u4f53\u306e\u79fb\u52d5\u8ddd\u96e2\u3084\u65cb\u56de\u65b9\u4f4d\u306a\u3069\u3092\u9010\u6b21\u8a08\u6e2c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u300c\u8d70\u884c\u4f53\u304c\u30b3\u30fc\u30b9\u4e0a\u306e\u4eca\u3069\u3053\u306b\u3044\u308b\u306e\u304b\u300d\u3092\u5224\u5225\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u306f\u300c\u30a8\u30ea\u30a2\u8d70\u884c\u300d\u3001\u300c\u901f\u5ea6\u8a08\u300d\u306a\u3069\u306e\u4ed6\u306e\u8981\u7d20\u6280\u8853\u306b\u3082\u5fc5\u8981\u3068\u306a\u308b\u571f\u53f0\u3068\u3082\u8a00\u3048\u308b\u8981\u7d20\u6280\u8853\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u51fa\u5834\u30c1\u30fc\u30e0\u3054\u3068\u306b\u3088\u3063\u3066\u3001\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u306e\u624b\u6cd5\u3084\u8a08\u7b97\u5f0f\u306f\u82e5\u5e72\u306e\u5dee\u7570\u304c\u3042\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\uff09\n\u3000\u4ee5\u4e0b\u306b\u7528\u610f\u3057\u3066\u3044\u308b\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001ET\u30ed\u30dc\u30b3\u30f32016\u30a2\u30c9\u30d0\u30f3\u30b9\u30c8\u30af\u30e9\u30b9\u8d70\u884c\u4f53 \u300cHackEV\u300d \u306e\u30c8\u30ec\u30c3\u30c9\u5e45\u306b\u5408\u308f\u305b\u305f\u5b9f\u88c5\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u3061\u3089\u306e\u5199\u771f\u304c\u3001\u305d\u306e\u300cHackEV\u300d\u306b\u306a\u308a\u307e\u3059\u3002\n[\u5229\u7528\u958b\u767a\u74b0\u5883]\n\u30fbOS\uff1aWindows7\n\u30fb\u74b0\u5883\uff1aTOPPERS/EV3RT\n\u30fb\u8a00\u8a9e\uff1aC\u8a00\u8a9e\n\n\u8ddd\u96e2\u8a08\n\n\u8ddd\u96e2\u8a08\u306e\u6982\u8981\n\u3000\u307e\u305a\u306f\u300c\u8ddd\u96e2\u8a08\u300d\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u8ddd\u96e2\u8a08\u306f\u300c\u8d70\u884c\u4f53\u306e\u79fb\u52d5\u306b\u5bfe\u3057\u3066\u3001\u8eca\u8f2a\u304c\u3069\u308c\u307b\u3069\u56de\u8ee2\u3057\u305f\u304b\u300d\u3068\u3044\u3046\u60c5\u5831\u3092\u57fa\u306b\u3001\u8d70\u884c\u4f53\u304c\u79fb\u52d5\u3057\u305f\u8ddd\u96e2\u3092\u8a08\u6e2c\u3059\u308b\u6280\u8853\u3067\u3059\u3002\u3082\u3063\u3068\u5177\u4f53\u7684\u306a\u8a00\u3044\u65b9\u3092\u3057\u307e\u3059\u3068\u300c\u8eca\u8f2a\u306e\u5186\u5468\u306b\u56de\u8ee2\u91cf\uff08\u56de\u8ee2\u89d2\u5ea6\uff09\u3092\u4e57\u7b97\u3057\u305f\u7d50\u679c\u304c\u8d70\u884c\u8ddd\u96e2\u306b\u306a\u308b\u300d\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\u3000\u7d0d\u8c46\u5dfb\u304d\u306e\u6d77\u82d4\u3092\u5265\u304c\u3057\u306a\u304c\u3089\u30b3\u30ed\u30b3\u30ed\u8ee2\u304c\u3057\u3066\u3044\u304f\u611f\u3058\u3092\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u7d0d\u8c46\u5dfb\u304d\u306e\u6d77\u82d4\u304c\u5168\u3066\u5265\u304c\u308c\u305f\u6642\u3001\u7d0d\u8c46\u5dfb\u304d\u304c\u8ee2\u304c\u3063\u3066\u79fb\u52d5\u3057\u305f\u8ddd\u96e2\u306f\u5dfb\u304b\u308c\u3066\u3044\u308b\u6d77\u82d4\u306e\u5e45\u306b\u7b49\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u7d0d\u8c46\u5dfb\u304d\u3092\u8eca\u8f2a\u306b\u7f6e\u304d\u63db\u3048\u3066\u8003\u3048\u307e\u3059\u3068\u3001\u305d\u306e\u300c\u6d77\u82d4\u306e\u5e45\u300d\u3053\u305d\u304c\u8eca\u8f2a\u306e\u5186\u5468\u306b\u306a\u308b\u306e\u3067\u3059\u3002\n\n\u3000\u8981\u3059\u308b\u306b\u3001\u8eca\u8f2a\u306e\u5186\u5468\u3068\u56de\u8ee2\u89d2\u5ea6\u3055\u3048\u5206\u304b\u308c\u3070\u3001\u79fb\u52d5\u8ddd\u96e2\u3092\u8a08\u6e2c\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u306e\u3067\u3059\u3002\u5186\u5468\u306f\u8eca\u8f2a\u306e\u76f4\u5f84\u3092\u5b9f\u969b\u306b\u6e2c\u308b\u3053\u3068\u3067\u8a08\u7b97\u3057\u3066\u51fa\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u306e\u3088\u3046\u306b\u30ce\u30ae\u30b9\u306a\u3069\u3067\u8eca\u8f2a\u306e\u76f4\u5f84\u3092\u6e2c\u308a\u307e\u3057\u3087\u3046\u3002\u3082\u3061\u308d\u3093\u5b9a\u898f\u3067\u3082\u305d\u308c\u306a\u308a\u306e\u7cbe\u5ea6\u3067\u8ddd\u96e2\u8a08\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u8ddd\u96e2\u8a08\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\n\u3000\u4ee5\u4e0b\u306b\u8ddd\u96e2\u8a08\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3001\u8ddd\u96e2\u306e\u8a08\u6e2c\u5024\u3092\u66f4\u65b0\u3059\u308b\u95a2\u6570 Distance_update() \u30924ms\u5468\u671f\u3067\u547c\u3073\u51fa\u3059\u524d\u63d0\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u3057\u30664ms\u9593\u306e\u79fb\u52d5\u8ddd\u96e2[mm]\u3092\u6bce\u56de\u8db3\u3057\u5408\u308f\u305b\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u308c\u307e\u3067\u306e\u79fb\u52d5\u8ddd\u96e2\u3092\u8a08\u6e2c\u3057\u3066\u3044\u307e\u3059\u30024ms\u9593\u9694\u3054\u3068\u306b\u7d0d\u8c46\u5dfb\u304d\u304b\u3089\u5265\u304c\u308c\u305f\u6d77\u82d4\u3092\u7d30\u304b\u304f\u5343\u5207\u3063\u3066\u3044\u3063\u3066\u3001\u6700\u5f8c\u306b\u5168\u90e8\u7e4b\u3052\u3066\u3044\u308b\u611f\u3058\u3068\u306a\u308a\u307e\u3059\u3002.........\u305d\u308d\u305d\u308d\u8eca\u8f2a\u304c\u7d0d\u8c46\u5dfb\u304d\u306b\u898b\u3048\u3066\u304d\u305f\u9803\u3060\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u306e\u4f8b\u3048\u306f\u3053\u3053\u307e\u3067\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u3000\u3053\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u30e2\u30fc\u30bf\u306e\u89d2\u5ea6\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3053\u3068\u306a\u304f\uff08API\u306e ev3_motor_reset_counts \u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u306a\u304f\uff09\u3001\u8ddd\u96e2\u8a08\u306e\u8a08\u6e2c\u5024\u306e\u30ea\u30bb\u30c3\u30c8\u306a\u3069\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5229\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u5229\u7528\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n1.\u30d7\u30ed\u30b0\u30e9\u30e0\u8d77\u52d5\u6642\u306b\u3001\u521d\u671f\u5316\u95a2\u6570 Distance_init() \u3092\u547c\u3073\u51fa\u3059\uff081\u56de\u306e\u307f\u547c\u3073\u51fa\u3057\uff09\n2.\u30bf\u30b9\u30af\u306e\u5148\u982d\u306b\u66f4\u65b0\u95a2\u6570 Distance_update() \u3092\u547c\u3073\u51fa\u3059\uff08\u30bf\u30b9\u30af\u5468\u671f\u6bce\u306b\u547c\u3073\u51fa\u3057\uff09\n3.\u73fe\u5728\u306e\u8d70\u884c\u8ddd\u96e2\u3092\u5f97\u305f\u3044\u3068\u304d\u306b\u3001\u8ddd\u96e2\u53d6\u5f97\u95a2\u6570 Distance_getDistance() \u3092\u547c\u3073\u51fa\u3059\n\u4ee5\u4e0a\u304c\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\u3042\u3068\u3001\u5de6\u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570\uff08Distance_getDistance4msRight()\uff0cDistance_getDistance4msLeft() \uff09\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u6b21\u8a18\u4e8b\u3067\u8aac\u660e\u3059\u308b\u300c\u65b9\u4f4d\u8a08\u6e2c\u300d\u3067\u7528\u3044\u308b\u95a2\u6570\u3067\u3059\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\n\nDistance.c\n#include \"Distance.h\"\n\n#define TIRE_DIAMETER 81.0  //\u30bf\u30a4\u30e4\u76f4\u5f84\uff0881mm\uff09\n\nstatic float distance = 0.0;     //\u8d70\u884c\u8ddd\u96e2\nstatic float distance4msL = 0.0; //\u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\nstatic float distance4msR = 0.0; //\u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\nstatic float pre_angleL, pre_angleR; // \u5de6\u53f3\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u904e\u53bb\u5024\n\n/* \u521d\u671f\u5316\u95a2\u6570 */\nvoid Distance_init() {\n    //\u5404\u5909\u6570\u306e\u5024\u306e\u521d\u671f\u5316\n    distance = 0.0;\n    distance4msR = 0.0;\n    distance4msL = 0.0;\n    //\u30e2\u30fc\u30bf\u89d2\u5ea6\u306e\u904e\u53bb\u5024\u306b\u73fe\u5728\u5024\u3092\u4ee3\u5165\n    pre_angleL = ev3_motor_get_counts(left_motor);\n    pre_angleR = ev3_motor_get_counts(right_motor);\n}\n\n/* \u8ddd\u96e2\u66f4\u65b0\uff084ms\u9593\u306e\u79fb\u52d5\u8ddd\u96e2\u3092\u6bce\u56de\u52a0\u7b97\u3057\u3066\u3044\u308b\uff09 */\nvoid Distance_update(){\n    float cur_angleL = ev3_motor_get_counts(left_motor); //\u5de6\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u73fe\u5728\u5024\n    float cur_angleR = ev3_motor_get_counts(right_motor);//\u53f3\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u73fe\u5728\u5024\n    float distance4ms = 0.0;        //4ms\u306e\u8ddd\u96e2\n\n    // 4ms\u9593\u306e\u8d70\u884c\u8ddd\u96e2 = ((\u5186\u5468\u7387 * \u30bf\u30a4\u30e4\u306e\u76f4\u5f84) / 360) * (\u30e2\u30fc\u30bf\u89d2\u5ea6\u904e\u53bb\u5024\u3000- \u30e2\u30fc\u30bf\u89d2\u5ea6\u73fe\u5728\u5024)\n    distance4msL = ((PI * TIRE_DIAMETER) / 360.0) * (cur_angleL - pre_angleL);  // 4ms\u9593\u306e\u5de6\u30e2\u30fc\u30bf\u8ddd\u96e2\n    distance4msR = ((PI * TIRE_DIAMETER) / 360.0) * (cur_angleR - pre_angleR);  // 4ms\u9593\u306e\u53f3\u30e2\u30fc\u30bf\u8ddd\u96e2\n    distance4ms = (distance4msL + distance4msR) / 2.0; //\u5de6\u53f3\u30bf\u30a4\u30e4\u306e\u8d70\u884c\u8ddd\u96e2\u3092\u8db3\u3057\u3066\u5272\u308b\n    distance += distance4ms;\n\n    //\u30e2\u30fc\u30bf\u306e\u56de\u8ee2\u89d2\u5ea6\u306e\u904e\u53bb\u5024\u3092\u66f4\u65b0\n    pre_angleL = cur_angleL;\n    pre_angleR = cur_angleR;\n}\n\n/* \u8d70\u884c\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance(){\n    return distance;\n}\n\n/* \u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msRight(){\n    return distance4msR;\n}\n\n/* \u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msLeft(){\n    return distance4msL;\n}\n\n\n\nDistance.h\n#ifndef _DISTANCE_H_\n#define _DISTANCE_H_\n\n#include \"ev3api.h\"\n#include \"parameter.h\"\n\n/* \u5186\u5468\u7387 */\n#define PI 3.14159265358\n\n/* \u521d\u671f\u5316\u95a2\u6570 */\nvoid Distance_init();\n\n/* \u8ddd\u96e2\u3092\u66f4\u65b0 */\nvoid Distance_update();\n\n/* \u8d70\u884c\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance();\n\n/* \u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msRight();\n\n/* \u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msLeft();\n#endif\n\n\n\n\u8ddd\u96e2\u8a08\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c\u4f8b\uff08\u52d5\u753b\uff09\n400mm\u524d\u9032\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u304c\u3001\u305d\u306e\u5b9f\u884c\u30b3\u30fc\u30c9\uff08\u4e00\u90e8\u629c\u7c8b\uff09\u3068\u306a\u308a\u307e\u3059\u3002\ntypedef enum {\n    AHEAD,\n    END\n} RUN_STATE;\n\nvoid main_task(intptr_t unused) {\n    static RUN_STATE state = AHEAD;\n\n    /* \u30e2\u30fc\u30bf\u30fc\u51fa\u529b\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a */\n    ev3_motor_config(left_motor, LARGE_MOTOR);\n    ev3_motor_config(right_motor, LARGE_MOTOR);\n\n    /* \u8a08\u6e2c\u5668\u521d\u671f\u5316 */\n    Distance_init();\n    Direction_init();\n\n    while(1) {\n        /* \u8ddd\u96e2\u8a08\uff0c\u65b9\u4f4d\u8a08 \u66f4\u65b0 */\n        Distance_update();\n        Direction_update();\n\n        switch(state) {\n        case AHEAD:\n            //\u5de6\u53f3\u8eca\u8f2a\u99c6\u52d5\n            ev3_motor_set_power(left_motor, 30);\n            ev3_motor_set_power(right_motor, 30);\n            //400mm\u4ee5\u4e0a\u524d\u9032\u3057\u305f\u3089\uff0c\u6b21\u72b6\u614b\u9077\u79fb\n            if(Distance_getDistance() > 400.0) {\n                state = END;\n            }\n            break;\n        case END:\n            //\u5de6\u53f3\u8eca\u8f2a\u505c\u6b62\n            ev3_motor_stop(left_motor, true);\n            ev3_motor_stop(right_motor, true);\n            break;\n        default:\n            break;\n        }\n    }\n}\n\n# ET\u30ed\u30dc\u30b3\u30f3\u306b\u304a\u3051\u308b\u8a08\u6e2c\u5668\u306e\u6d3b\u7528\n\u3000\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u3068\u306f\u3001\u8d70\u884c\u4f53\u306e\u79fb\u52d5\u8ddd\u96e2\u3084\u65cb\u56de\u65b9\u4f4d\u306a\u3069\u3092\u9010\u6b21\u8a08\u6e2c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u300c\u8d70\u884c\u4f53\u304c\u30b3\u30fc\u30b9\u4e0a\u306e\u4eca\u3069\u3053\u306b\u3044\u308b\u306e\u304b\u300d\u3092\u5224\u5225\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u306f\u300c\u30a8\u30ea\u30a2\u8d70\u884c\u300d\u3001\u300c\u901f\u5ea6\u8a08\u300d\u306a\u3069\u306e\u4ed6\u306e\u8981\u7d20\u6280\u8853\u306b\u3082\u5fc5\u8981\u3068\u306a\u308b\u571f\u53f0\u3068\u3082\u8a00\u3048\u308b\u8981\u7d20\u6280\u8853\u306a\u306e\u3067\u3001\u3053\u3053\u3067\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u51fa\u5834\u30c1\u30fc\u30e0\u3054\u3068\u306b\u3088\u3063\u3066\u3001\u81ea\u5df1\u4f4d\u7f6e\u8a08\u6e2c\u306e\u624b\u6cd5\u3084\u8a08\u7b97\u5f0f\u306f\u82e5\u5e72\u306e\u5dee\u7570\u304c\u3042\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\uff09\n\u3000\u4ee5\u4e0b\u306b\u7528\u610f\u3057\u3066\u3044\u308b\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u3001ET\u30ed\u30dc\u30b3\u30f32016\u30a2\u30c9\u30d0\u30f3\u30b9\u30c8\u30af\u30e9\u30b9\u8d70\u884c\u4f53 \u300cHackEV\u300d \u306e\u30c8\u30ec\u30c3\u30c9\u5e45\u306b\u5408\u308f\u305b\u305f\u5b9f\u88c5\u306b\u306a\u308a\u307e\u3059\u3002\n\n![IMG_1128.jpg](https://qiita-image-store.s3.amazonaws.com/0/153774/6ae9af51-8cf2-194c-deb3-c7f18dcd8961.jpeg)\n\u3053\u3061\u3089\u306e\u5199\u771f\u304c\u3001\u305d\u306e\u300cHackEV\u300d\u306b\u306a\u308a\u307e\u3059\u3002\n\n[\u5229\u7528\u958b\u767a\u74b0\u5883]\n\u30fbOS\uff1aWindows7\n\u30fb\u74b0\u5883\uff1aTOPPERS/EV3RT\n\u30fb\u8a00\u8a9e\uff1aC\u8a00\u8a9e\n# \u8ddd\u96e2\u8a08\n## \u8ddd\u96e2\u8a08\u306e\u6982\u8981\n\u3000\u307e\u305a\u306f\u300c\u8ddd\u96e2\u8a08\u300d\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u8ddd\u96e2\u8a08\u306f\u300c\u8d70\u884c\u4f53\u306e\u79fb\u52d5\u306b\u5bfe\u3057\u3066\u3001\u8eca\u8f2a\u304c\u3069\u308c\u307b\u3069\u56de\u8ee2\u3057\u305f\u304b\u300d\u3068\u3044\u3046\u60c5\u5831\u3092\u57fa\u306b\u3001\u8d70\u884c\u4f53\u304c\u79fb\u52d5\u3057\u305f\u8ddd\u96e2\u3092\u8a08\u6e2c\u3059\u308b\u6280\u8853\u3067\u3059\u3002\u3082\u3063\u3068\u5177\u4f53\u7684\u306a\u8a00\u3044\u65b9\u3092\u3057\u307e\u3059\u3068\u300c\u8eca\u8f2a\u306e\u5186\u5468\u306b\u56de\u8ee2\u91cf\uff08\u56de\u8ee2\u89d2\u5ea6\uff09\u3092\u4e57\u7b97\u3057\u305f\u7d50\u679c\u304c\u8d70\u884c\u8ddd\u96e2\u306b\u306a\u308b\u300d\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n\u3000\u7d0d\u8c46\u5dfb\u304d\u306e\u6d77\u82d4\u3092\u5265\u304c\u3057\u306a\u304c\u3089\u30b3\u30ed\u30b3\u30ed\u8ee2\u304c\u3057\u3066\u3044\u304f\u611f\u3058\u3092\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u7d0d\u8c46\u5dfb\u304d\u306e\u6d77\u82d4\u304c\u5168\u3066\u5265\u304c\u308c\u305f\u6642\u3001\u7d0d\u8c46\u5dfb\u304d\u304c\u8ee2\u304c\u3063\u3066\u79fb\u52d5\u3057\u305f\u8ddd\u96e2\u306f\u5dfb\u304b\u308c\u3066\u3044\u308b\u6d77\u82d4\u306e\u5e45\u306b\u7b49\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u7d0d\u8c46\u5dfb\u304d\u3092\u8eca\u8f2a\u306b\u7f6e\u304d\u63db\u3048\u3066\u8003\u3048\u307e\u3059\u3068\u3001\u305d\u306e\u300c\u6d77\u82d4\u306e\u5e45\u300d\u3053\u305d\u304c\u8eca\u8f2a\u306e\u5186\u5468\u306b\u306a\u308b\u306e\u3067\u3059\u3002\n\n![W_info.png](https://qiita-image-store.s3.amazonaws.com/0/153774/d481cb39-4618-3767-6127-1c2b2c1f0af4.png)\n\n\u3000\u8981\u3059\u308b\u306b\u3001\u8eca\u8f2a\u306e\u5186\u5468\u3068\u56de\u8ee2\u89d2\u5ea6\u3055\u3048\u5206\u304b\u308c\u3070\u3001\u79fb\u52d5\u8ddd\u96e2\u3092\u8a08\u6e2c\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u306e\u3067\u3059\u3002\u5186\u5468\u306f\u8eca\u8f2a\u306e\u76f4\u5f84\u3092\u5b9f\u969b\u306b\u6e2c\u308b\u3053\u3068\u3067\u8a08\u7b97\u3057\u3066\u51fa\u3057\u307e\u3057\u3087\u3046\u3002\n\n![IMG_1127.jpg](https://qiita-image-store.s3.amazonaws.com/0/153774/ee538256-c5c0-c7ad-c8b6-bae5f3a157f4.jpeg)\n\u3053\u306e\u3088\u3046\u306b\u30ce\u30ae\u30b9\u306a\u3069\u3067\u8eca\u8f2a\u306e\u76f4\u5f84\u3092\u6e2c\u308a\u307e\u3057\u3087\u3046\u3002\u3082\u3061\u308d\u3093\u5b9a\u898f\u3067\u3082\u305d\u308c\u306a\u308a\u306e\u7cbe\u5ea6\u3067\u8ddd\u96e2\u8a08\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## \u8ddd\u96e2\u8a08\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\n\u3000\u4ee5\u4e0b\u306b\u8ddd\u96e2\u8a08\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3001\u8ddd\u96e2\u306e\u8a08\u6e2c\u5024\u3092\u66f4\u65b0\u3059\u308b\u95a2\u6570 Distance_update() \u30924ms\u5468\u671f\u3067\u547c\u3073\u51fa\u3059\u524d\u63d0\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u3057\u30664ms\u9593\u306e\u79fb\u52d5\u8ddd\u96e2[mm]\u3092\u6bce\u56de\u8db3\u3057\u5408\u308f\u305b\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u308c\u307e\u3067\u306e\u79fb\u52d5\u8ddd\u96e2\u3092\u8a08\u6e2c\u3057\u3066\u3044\u307e\u3059\u30024ms\u9593\u9694\u3054\u3068\u306b\u7d0d\u8c46\u5dfb\u304d\u304b\u3089\u5265\u304c\u308c\u305f\u6d77\u82d4\u3092\u7d30\u304b\u304f\u5343\u5207\u3063\u3066\u3044\u3063\u3066\u3001\u6700\u5f8c\u306b\u5168\u90e8\u7e4b\u3052\u3066\u3044\u308b\u611f\u3058\u3068\u306a\u308a\u307e\u3059\u3002.........\u305d\u308d\u305d\u308d\u8eca\u8f2a\u304c\u7d0d\u8c46\u5dfb\u304d\u306b\u898b\u3048\u3066\u304d\u305f\u9803\u3060\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u3053\u306e\u4f8b\u3048\u306f\u3053\u3053\u307e\u3067\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n![\u8ddd\u96e2\u8a08.png](https://qiita-image-store.s3.amazonaws.com/0/153774/af1bff2a-3025-60ff-3a80-0ef35b4223ff.png)\n\n\n\u3000\u3053\u306e\u3088\u3046\u306a\u69cb\u9020\u306b\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u30e2\u30fc\u30bf\u306e\u89d2\u5ea6\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3053\u3068\u306a\u304f\uff08API\u306e ev3_motor_reset_counts \u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u306a\u304f\uff09\u3001\u8ddd\u96e2\u8a08\u306e\u8a08\u6e2c\u5024\u306e\u30ea\u30bb\u30c3\u30c8\u306a\u3069\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5229\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u5229\u7528\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n1.\u30d7\u30ed\u30b0\u30e9\u30e0\u8d77\u52d5\u6642\u306b\u3001\u521d\u671f\u5316\u95a2\u6570 Distance_init() \u3092\u547c\u3073\u51fa\u3059\uff081\u56de\u306e\u307f\u547c\u3073\u51fa\u3057\uff09\n2.\u30bf\u30b9\u30af\u306e\u5148\u982d\u306b\u66f4\u65b0\u95a2\u6570 Distance_update() \u3092\u547c\u3073\u51fa\u3059\uff08\u30bf\u30b9\u30af\u5468\u671f\u6bce\u306b\u547c\u3073\u51fa\u3057\uff09\n3.\u73fe\u5728\u306e\u8d70\u884c\u8ddd\u96e2\u3092\u5f97\u305f\u3044\u3068\u304d\u306b\u3001\u8ddd\u96e2\u53d6\u5f97\u95a2\u6570 Distance_getDistance() \u3092\u547c\u3073\u51fa\u3059\n\n\u4ee5\u4e0a\u304c\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\u3042\u3068\u3001\u5de6\u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570\uff08Distance_getDistance4msRight()\uff0cDistance_getDistance4msLeft() \uff09\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u6b21\u8a18\u4e8b\u3067\u8aac\u660e\u3059\u308b\u300c\u65b9\u4f4d\u8a08\u6e2c\u300d\u3067\u7528\u3044\u308b\u95a2\u6570\u3067\u3059\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\n\n```Distance.c\n#include \"Distance.h\"\n\n#define TIRE_DIAMETER 81.0  //\u30bf\u30a4\u30e4\u76f4\u5f84\uff0881mm\uff09\n\nstatic float distance = 0.0;     //\u8d70\u884c\u8ddd\u96e2\nstatic float distance4msL = 0.0; //\u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\nstatic float distance4msR = 0.0; //\u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\nstatic float pre_angleL, pre_angleR; // \u5de6\u53f3\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u904e\u53bb\u5024\n\n/* \u521d\u671f\u5316\u95a2\u6570 */\nvoid Distance_init() {\n\t//\u5404\u5909\u6570\u306e\u5024\u306e\u521d\u671f\u5316\n\tdistance = 0.0;\n\tdistance4msR = 0.0;\n\tdistance4msL = 0.0;\n\t//\u30e2\u30fc\u30bf\u89d2\u5ea6\u306e\u904e\u53bb\u5024\u306b\u73fe\u5728\u5024\u3092\u4ee3\u5165\n\tpre_angleL = ev3_motor_get_counts(left_motor);\n\tpre_angleR = ev3_motor_get_counts(right_motor);\n}\n\n/* \u8ddd\u96e2\u66f4\u65b0\uff084ms\u9593\u306e\u79fb\u52d5\u8ddd\u96e2\u3092\u6bce\u56de\u52a0\u7b97\u3057\u3066\u3044\u308b\uff09 */\nvoid Distance_update(){\n\tfloat cur_angleL = ev3_motor_get_counts(left_motor); //\u5de6\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u73fe\u5728\u5024\n\tfloat cur_angleR = ev3_motor_get_counts(right_motor);//\u53f3\u30e2\u30fc\u30bf\u56de\u8ee2\u89d2\u5ea6\u306e\u73fe\u5728\u5024\n\tfloat distance4ms = 0.0;\t\t//4ms\u306e\u8ddd\u96e2\n\n\t// 4ms\u9593\u306e\u8d70\u884c\u8ddd\u96e2 = ((\u5186\u5468\u7387 * \u30bf\u30a4\u30e4\u306e\u76f4\u5f84) / 360) * (\u30e2\u30fc\u30bf\u89d2\u5ea6\u904e\u53bb\u5024\u3000- \u30e2\u30fc\u30bf\u89d2\u5ea6\u73fe\u5728\u5024)\n\tdistance4msL = ((PI * TIRE_DIAMETER) / 360.0) * (cur_angleL - pre_angleL);\t// 4ms\u9593\u306e\u5de6\u30e2\u30fc\u30bf\u8ddd\u96e2\n\tdistance4msR = ((PI * TIRE_DIAMETER) / 360.0) * (cur_angleR - pre_angleR);\t// 4ms\u9593\u306e\u53f3\u30e2\u30fc\u30bf\u8ddd\u96e2\n\tdistance4ms = (distance4msL + distance4msR) / 2.0; //\u5de6\u53f3\u30bf\u30a4\u30e4\u306e\u8d70\u884c\u8ddd\u96e2\u3092\u8db3\u3057\u3066\u5272\u308b\n\tdistance += distance4ms;\n\t\n\t//\u30e2\u30fc\u30bf\u306e\u56de\u8ee2\u89d2\u5ea6\u306e\u904e\u53bb\u5024\u3092\u66f4\u65b0\n\tpre_angleL = cur_angleL;\n\tpre_angleR = cur_angleR;\n}\n\n/* \u8d70\u884c\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance(){\n\treturn distance;\n}\n\n/* \u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msRight(){\n\treturn distance4msR;\n}\n\n/* \u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msLeft(){\n\treturn distance4msL;\n}\n```\n\n```Distance.h\n#ifndef _DISTANCE_H_\n#define _DISTANCE_H_\n\n#include \"ev3api.h\"\n#include \"parameter.h\"\n\n/* \u5186\u5468\u7387 */\n#define PI 3.14159265358\n\n/* \u521d\u671f\u5316\u95a2\u6570 */\nvoid Distance_init();\n\n/* \u8ddd\u96e2\u3092\u66f4\u65b0 */\nvoid Distance_update();\n\n/* \u8d70\u884c\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance();\n\n/* \u53f3\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msRight();\n\n/* \u5de6\u30bf\u30a4\u30e4\u306e4ms\u9593\u306e\u8ddd\u96e2\u3092\u53d6\u5f97 */\nfloat Distance_getDistance4msLeft();\n#endif\n```\n\n## \u8ddd\u96e2\u8a08\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5b9f\u884c\u4f8b\uff08\u52d5\u753b\uff09\n400mm\u524d\u9032\u3057\u307e\u3059\u3002\n[![IMAGE ALT TEXT HERE](http://img.youtube.com/vi/rVEOAQJJ1KU/0.jpg)](http://www.youtube.com/watch?v=rVEOAQJJ1KU)\n\n\u4ee5\u4e0b\u304c\u3001\u305d\u306e\u5b9f\u884c\u30b3\u30fc\u30c9\uff08\u4e00\u90e8\u629c\u7c8b\uff09\u3068\u306a\u308a\u307e\u3059\u3002\n\n```\ntypedef enum {\n\tAHEAD,\n\tEND\n} RUN_STATE;\n\nvoid main_task(intptr_t unused) {\n\tstatic RUN_STATE state = AHEAD;\n\n\t/* \u30e2\u30fc\u30bf\u30fc\u51fa\u529b\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a */\n\tev3_motor_config(left_motor, LARGE_MOTOR);\n\tev3_motor_config(right_motor, LARGE_MOTOR);\n\n\t/* \u8a08\u6e2c\u5668\u521d\u671f\u5316 */\n\tDistance_init();\n\tDirection_init();\n\n\twhile(1) {\n\t\t/* \u8ddd\u96e2\u8a08\uff0c\u65b9\u4f4d\u8a08 \u66f4\u65b0 */\n\t\tDistance_update();\n\t\tDirection_update();\n\n\t\tswitch(state) {\n\t\tcase AHEAD:\n\t\t\t//\u5de6\u53f3\u8eca\u8f2a\u99c6\u52d5\n\t\t\tev3_motor_set_power(left_motor, 30);\n\t\t\tev3_motor_set_power(right_motor, 30);\n\t\t\t//400mm\u4ee5\u4e0a\u524d\u9032\u3057\u305f\u3089\uff0c\u6b21\u72b6\u614b\u9077\u79fb\n\t\t\tif(Distance_getDistance() > 400.0) {\n\t\t\t\tstate = END;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase END:\n\t\t\t//\u5de6\u53f3\u8eca\u8f2a\u505c\u6b62\n\t\t\tev3_motor_stop(left_motor, true);\n\t\t\tev3_motor_stop(right_motor, true);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n```\n", "tags": ["ET\u30ed\u30dc\u30b3\u30f3", "EV3", "EV3RT", "TOPPERS"]}