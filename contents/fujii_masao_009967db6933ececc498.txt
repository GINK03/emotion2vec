{"context": "\u300c\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u306e GROUP BY\u300d \u3092 \u300cLATERAL\u300d \u306b\u66f8\u304d\u63db\u3048\u308b\u3053\u3068\u3067\u3001\u30af\u30a8\u30ea\u3092\u6027\u80fd\u6539\u5584\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u66f8\u304d\u63db\u3048\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u6e96\u5099\n\u307e\u305a\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u300c\u90e8\u7f72\u300d\u3001\u300c\u66f8\u7c4d\u300d\u3001\u300c\u90e8\u7f72\u3054\u3068\u306e\u66f8\u7c4d\u5728\u5eab\u6570\u300d\u3092\u7ba1\u7406\u3059\u308b3\u3064\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u300c\u66f8\u7c4d\u300d\u30c6\u30fc\u30d6\u30eb\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u72b6\u6cc1\u3092\u30a4\u30e1\u30fc\u30b8\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u7528\u610f\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3001\u4ee5\u964d\u306e\u30af\u30a8\u30ea\u66f8\u304d\u63db\u3048\u3067\u306f\u7279\u306b\u4f7f\u3044\u307e\u305b\u3093\u3002\n-- \u90e8\u7f72\u306eID\u3068\u540d\u524d\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb department \u3092\u4f5c\u6210\nCREATE TABLE department (dept_id INTEGER PRIMARY KEY, name TEXT);\n\n-- \u90e8\u7f72\u306e\u60c5\u5831\u30925\u4ef6\u767b\u9332\nCOPY department (dept_id, name) FROM stdin;\n1   \u7dcf\u52d9\u90e8\n2   \u958b\u767a\u90e8\n3   \u8ca1\u52d9\u90e8\n4   \u4f01\u753b\u90e8\n5   \u8cfc\u8cb7\u90e8\n\\.\n\n-- \u66f8\u7c4d\u306eID\u3068\u540d\u524d\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb book \u3092\u4f5c\u6210\nCREATE TABLE book (book_id INTEGER PRIMARY KEY, name TEXT);\n\n-- \u66f8\u7c4d\u306e\u60c5\u5831\u30926\u4ef6\u767b\u9332\nCOPY book (book_id, name) FROM stdin;\n1   AAA\n2   BBB\n3   CCC\n4   DDD\n5   EEE\n6   FFF\n\\.\n\n-- \u90e8\u7f72\u3054\u3068\u306e\u66f8\u7c4d\u306e\u5728\u5eab\u6570\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb book \u3092\u4f5c\u6210\nCREATE TABLE book_stock (\n    dept_id INTEGER REFERENCES department(dept_id),\n    book_id INTEGER REFERENCES book(book_id),\n    stock_num INTEGER,\n    PRIMARY KEY(dept_id, book_id)\n);\n\n-- \u66f8\u7c4d\u306e\u5728\u5eab\u60c5\u5831\u309220\u4ef6\u767b\u9332 (\u7dcf\u52d9\u90e82\u4ef6\u3001\u958b\u767a\u90e84\u4ef6\u3001\u8ca1\u52d9\u90e84\u4ef6\u3001\u4f01\u753b\u90e86\u4ef6\u3001\u8cfc\u8cb7\u90e84\u4ef6)\nCOPY book_stock (dept_id, book_id, stock_num) FROM stdin;\n1   2   7\n1   3   3\n2   5   2\n2   4   7\n2   3   3\n2   2   8\n3   4   10\n3   2   10\n3   1   1\n3   6   4\n4   1   5\n4   2   7\n4   3   10\n4   4   10\n4   5   5\n4   6   4\n5   3   6\n5   5   5\n5   2   8\n5   1   10\n\\.\n\n\n\u30af\u30a8\u30ea\u306e\u66f8\u304d\u63db\u3048\u4f8b\n\u3053\u3053\u3067\u306f\u3001\u300c\u90e8\u7f72\u3054\u3068\u306e\u7dcf\u5728\u5eab\u6570\u300d\u3092\u53d6\u5f97\u3059\u308b\u30af\u30a8\u30ea\u3092\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\n\u3053\u306e\u30af\u30a8\u30ea\u306f\u3001\u90e8\u7f72\u306eID\u3092\u30ad\u30fc\u306b GROUP BY \u3067\u5b9f\u73fe\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3060\u3068\u601d\u3044\u307e\u3059\u3002\nSELECT\n    d.name \u90e8\u7f72\u540d,\n    sum(bs.stock_num) \u7dcf\u5728\u5eab\u6570\nFROM\n    department d,\n    book_stock bs\nWHERE\n    d.dept_id = bs.dept_id\nGROUP BY\n    d.dept_id;\n\n\u3053\u306e\u300c\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u306e GROUP BY\u300d \u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a \u300cLATERAL\u300d \u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\nSELECT\n    d.name \u90e8\u7f72\u540d,\n    hoge.sum \u7dcf\u5728\u5eab\u6570\nFROM\n    department d,\n    LATERAL (\n        SELECT sum(bs.stock_num) sum\n        FROM book_stock bs\n        WHERE d.dept_id = bs.dept_id\n    ) hoge;\n\n\u30c7\u30fc\u30bf\u4ef6\u6570\u304c\u5c11\u306a\u3044\u3068\u304d\u306f\u3001GROUP BY \u3067\u3082 LATERAL \u3067\u3082\u6027\u80fd\u306b\u5927\u5dee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3057\u304b\u3057\u3001\u30c7\u30fc\u30bf\u4ef6\u6570 (\u7279\u306b LATERAL \u5185\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u4ef6\u6570) \u304c\u591a\u304f\u306a\u308b\u3068\u3001\n\u3053\u306e\u66f8\u304d\u63db\u3048\u306b\u3088\u308a\u5927\u5e45\u306b\u6027\u80fd\u3092\u6539\u5584\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u300c\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u306e GROUP BY\u300d \u3092 \u300cLATERAL\u300d \u306b\u66f8\u304d\u63db\u3048\u308b\u3053\u3068\u3067\u3001\u30af\u30a8\u30ea\u3092\u6027\u80fd\u6539\u5584\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u66f8\u304d\u63db\u3048\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n### \u30c6\u30fc\u30d6\u30eb\u306e\u6e96\u5099\n\u307e\u305a\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u300c\u90e8\u7f72\u300d\u3001\u300c\u66f8\u7c4d\u300d\u3001\u300c\u90e8\u7f72\u3054\u3068\u306e\u66f8\u7c4d\u5728\u5eab\u6570\u300d\u3092\u7ba1\u7406\u3059\u308b3\u3064\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u6e96\u5099\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u300c\u66f8\u7c4d\u300d\u30c6\u30fc\u30d6\u30eb\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u72b6\u6cc1\u3092\u30a4\u30e1\u30fc\u30b8\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u7528\u610f\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3001\u4ee5\u964d\u306e\u30af\u30a8\u30ea\u66f8\u304d\u63db\u3048\u3067\u306f\u7279\u306b\u4f7f\u3044\u307e\u305b\u3093\u3002\n\n```plpgsql\n-- \u90e8\u7f72\u306eID\u3068\u540d\u524d\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb department \u3092\u4f5c\u6210\nCREATE TABLE department (dept_id INTEGER PRIMARY KEY, name TEXT);\n\n-- \u90e8\u7f72\u306e\u60c5\u5831\u30925\u4ef6\u767b\u9332\nCOPY department (dept_id, name) FROM stdin;\n1\t\u7dcf\u52d9\u90e8\n2\t\u958b\u767a\u90e8\n3\t\u8ca1\u52d9\u90e8\n4\t\u4f01\u753b\u90e8\n5\t\u8cfc\u8cb7\u90e8\n\\.\n\n-- \u66f8\u7c4d\u306eID\u3068\u540d\u524d\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb book \u3092\u4f5c\u6210\nCREATE TABLE book (book_id INTEGER PRIMARY KEY, name TEXT);\n\n-- \u66f8\u7c4d\u306e\u60c5\u5831\u30926\u4ef6\u767b\u9332\nCOPY book (book_id, name) FROM stdin;\n1\tAAA\n2\tBBB\n3\tCCC\n4\tDDD\n5\tEEE\n6\tFFF\n\\.\n\n-- \u90e8\u7f72\u3054\u3068\u306e\u66f8\u7c4d\u306e\u5728\u5eab\u6570\u3092\u7ba1\u7406\u3059\u308b\u30c6\u30fc\u30d6\u30eb book \u3092\u4f5c\u6210\nCREATE TABLE book_stock (\n    dept_id INTEGER REFERENCES department(dept_id),\n    book_id INTEGER REFERENCES book(book_id),\n    stock_num INTEGER,\n    PRIMARY KEY(dept_id, book_id)\n);\n\n-- \u66f8\u7c4d\u306e\u5728\u5eab\u60c5\u5831\u309220\u4ef6\u767b\u9332 (\u7dcf\u52d9\u90e82\u4ef6\u3001\u958b\u767a\u90e84\u4ef6\u3001\u8ca1\u52d9\u90e84\u4ef6\u3001\u4f01\u753b\u90e86\u4ef6\u3001\u8cfc\u8cb7\u90e84\u4ef6)\nCOPY book_stock (dept_id, book_id, stock_num) FROM stdin;\n1\t2\t7\n1\t3\t3\n2\t5\t2\n2\t4\t7\n2\t3\t3\n2\t2\t8\n3\t4\t10\n3\t2\t10\n3\t1\t1\n3\t6\t4\n4\t1\t5\n4\t2\t7\n4\t3\t10\n4\t4\t10\n4\t5\t5\n4\t6\t4\n5\t3\t6\n5\t5\t5\n5\t2\t8\n5\t1\t10\n\\.\n```\n\n### \u30af\u30a8\u30ea\u306e\u66f8\u304d\u63db\u3048\u4f8b\n\u3053\u3053\u3067\u306f\u3001\u300c\u90e8\u7f72\u3054\u3068\u306e\u7dcf\u5728\u5eab\u6570\u300d\u3092\u53d6\u5f97\u3059\u308b\u30af\u30a8\u30ea\u3092\u53d6\u308a\u4e0a\u3052\u307e\u3059\u3002\n\u3053\u306e\u30af\u30a8\u30ea\u306f\u3001\u90e8\u7f72\u306eID\u3092\u30ad\u30fc\u306b GROUP BY \u3067\u5b9f\u73fe\u3059\u308b\u306e\u304c\u4e00\u822c\u7684\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n```plpgsql\nSELECT\n    d.name \u90e8\u7f72\u540d,\n    sum(bs.stock_num) \u7dcf\u5728\u5eab\u6570\nFROM\n    department d,\n    book_stock bs\nWHERE\n    d.dept_id = bs.dept_id\nGROUP BY\n    d.dept_id;\n```\n\n\u3053\u306e\u300c\u30e6\u30cb\u30fc\u30af\u30ad\u30fc\u306e GROUP BY\u300d \u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a \u300cLATERAL\u300d \u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\n\n```plpgsql\nSELECT\n    d.name \u90e8\u7f72\u540d,\n    hoge.sum \u7dcf\u5728\u5eab\u6570\nFROM\n    department d,\n    LATERAL (\n        SELECT sum(bs.stock_num) sum\n        FROM book_stock bs\n        WHERE d.dept_id = bs.dept_id\n    ) hoge;\n```\n\n\u30c7\u30fc\u30bf\u4ef6\u6570\u304c\u5c11\u306a\u3044\u3068\u304d\u306f\u3001GROUP BY \u3067\u3082 LATERAL \u3067\u3082\u6027\u80fd\u306b\u5927\u5dee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u3057\u304b\u3057\u3001\u30c7\u30fc\u30bf\u4ef6\u6570 (\u7279\u306b LATERAL \u5185\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u4ef6\u6570) \u304c\u591a\u304f\u306a\u308b\u3068\u3001\n\u3053\u306e\u66f8\u304d\u63db\u3048\u306b\u3088\u308a\u5927\u5e45\u306b\u6027\u80fd\u3092\u6539\u5584\u3067\u304d\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n", "tags": ["PostgreSQL", "SQL", "performance"]}