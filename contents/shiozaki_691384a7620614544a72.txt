{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u79c1\u306e\u6240\u5c5e\u3057\u3066\u3044\u308bVASILY\u3067\u306f\u975e\u540c\u671f\u51e6\u7406\u3092\u884c\u3046\u305f\u3081\u306bsidekiq(http://sidekiq.org/ )\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nsidekiq\u3067\u306f\u975e\u540c\u671f\u51e6\u7406\u7528\u306e\u30b8\u30e7\u30d6\u3092Redis\u4e0a\u306e\u30ad\u30e5\u30fc\u3067\u7ba1\u7406\u3057\u307e\u3059\u3002\n\u3053\u306e\u30ad\u30e5\u30fc\u306b\u3069\u306e\u304f\u3089\u3044\u306e\u6570\u306e\u30b8\u30e7\u30d6\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u304b\u3068\u3044\u3046\u60c5\u5831\u3092mackerel\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u3068\u3057\u3066\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u305f\u306e\u3067\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\nmackerel-agent\u306fgo\u3067\u66f8\u304b\u308c\u3066\u304a\u308a\u3001\u305d\u306e\u5f71\u97ff\u304b\u516c\u5f0f\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3082go\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/mackerelio/mackerel-agent-plugins\n\u516c\u5f0f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5e7e\u3064\u304b\u898b\u308b\u3068go\u306e\u7df4\u7fd2\u306b\u3061\u3087\u3046\u3069\u3088\u3055\u305d\u3046\u306a\u96e3\u6613\u5ea6\u3067\u3057\u305f\u306e\u3067\u3001go\u306e\u52c9\u5f37\u3082\u517c\u306d\u3066mackerel\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306fhttps://github.com/vasilyjp/mackerel-plugin-sidekiq \u306b\u3001\n\u30d0\u30a4\u30ca\u30ea\u306fhttps://bintray.com/shio-phys/mackerel-plugin-sidekiq/mackerel-plugin-sidekiq/view#files \u306b\u914d\u7f6e\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u306e\u306b\u4fbf\u5229\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u305f\u3061\n\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u6295\u7a3f\u3059\u308b\u65b9\u6cd5\u306fmackerel\u306e\u516c\u5f0f\u30d8\u30eb\u30d7\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/advanced/custom-metrics\n\u305d\u308c\u306b\u3088\u308b\u3068\u3001\u6a19\u6e96\u51fa\u529b\u306b\u4ee5\u4e0b\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30671\u30e1\u30c8\u30ea\u30af\u30b91\u884c\u3067\u51fa\u529b\u3059\u308c\u3070\u3044\u3044\u305d\u3046\u3067\u3059\u3002\n{metric name}\\t{metric value}\\t{epoch seconds}\n(\\t\u306f\u30bf\u30d6\u6587\u5b57)\n\u307e\u305f\u3001\u74b0\u5883\u5909\u6570MACKEREL_AGENT_PLUGIN_META\u304c1\u306e\u6642\u306b\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068mackerel\u5074\u304c\u30b0\u30e9\u30d5\u306e\u30bf\u30a4\u30c8\u30eb\u3084\u51e1\u4f8b\u3092\u81ea\u52d5\u7684\u306b\u30bb\u30c3\u30c8\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306f\u5148\u982d\u884c\u3092# mackerel-agent-plugin\u304b\u3089\u59cb\u3081\u3066\u305d\u306e\u5f8c\u306b\u30b0\u30e9\u30d5\u5b9a\u7fa9\u672c\u4f53\u306eJSON\u3092\u7d9a\u3051\u307e\u3059\u3002\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u4ed5\u69d8\u306fmackerel API\u4ed5\u69d8\u306e\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6295\u7a3f\u306e\u90e8\u5206\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/spec/api/v0#graphdef-post\n\u3053\u308c\u3089\u306e\u6a5f\u80fd\u3092\u5168\u90e8\u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u305f\u3081\u306e\u30d8\u30eb\u30d1\u30fc\u30e9\u30a4\u30d6\u30e9\u30ea\u304cmackerel\u516c\u5f0f\u304b\u3089\u51fa\u3066\u3044\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nhttps://github.com/mackerelio/go-mackerel-plugin\n\u307e\u305f\u3001go\u306eRedis\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066redigo\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/garyburd/redigo\n\u3053\u308c\u3089\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fgo\u8a00\u8a9e\u306b\u6a19\u6e96\u6dfb\u4ed8\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3092\u5229\u7528\u3057\u3066\u884c\u3044\u307e\u3057\u305f\u3002\n# \u4e8b\u524d\u306b\u74b0\u5883\u5909\u6570GOPATH\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u3042\u308a\n#   https://golang.org/doc/install#testing\ngo get github.com/mackerelio/go-mackerel-plugin\ngo get github.com/garyburd/redigo/redis\n\n\n\u30b0\u30e9\u30d5\u306e\u5b9a\u7fa9\n\u307e\u305a\u306f\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8868\u3059\u69cb\u9020\u4f53\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\ntype SidekiqPlugin struct {\n    Target    string\n    Database  string\n    Namespace string\n}\n\n\u3053\u306e\u69cb\u9020\u4f53\u306e\u5404\u30d5\u30a3\u30fc\u30eb\u30c9(Target, Database, Namespace)\u306fRedis\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3067\u3059\u3002\n\u8a73\u7d30\u306b\u3064\u3044\u3066\u306fRedis\u306b\u63a5\u7d9a\u3092\u3059\u308b\u90e8\u5206\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\u6b21\u306b\u3053\u306e\u69cb\u9020\u4f53\u306bPlugin\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nPlugin\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306fgo-mackerel-plugin\u306e\u4e2d\u3067\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002\n// mackerel-plugin.go:28\ntype Plugin interface {\n    FetchMetrics() (map[string]float64, error)\n    GraphDefinition() map[string]Graphs\n}\n\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u8fd4\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9GraphDefinition\u3068\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u60c5\u5831\u3092\u8fd4\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9FetchMetrics\u304c\u3042\u308a\u307e\u3059\u3002\n\u6700\u521d\u306bGraphDefinition\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u8fd4\u308a\u5024\u306f\u30b0\u30e9\u30d5\u540d\u3068\u3092\u30ad\u30fc\u3068\u3057\u3066\u3001\u305d\u306e\u30b0\u30e9\u30d5\u306e\u5b9a\u7fa9(Graphs\u69cb\u9020\u4f53)\u3092\u30d0\u30ea\u30e5\u30fc\u3068\u3059\u308bmap\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\n\u30b0\u30e9\u30d5\u540d\u306f\u30b0\u30e9\u30d5\u5185\u306e\u5404\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u306e\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u306b\u306a\u308a\u307e\u3059\u3002\nGraphs\u69cb\u9020\u4f53\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\ntype Graphs struct {\n    Label   string    `json:\"label\"`\n    Unit    string    `json:\"unit\"`\n    Metrics []Metrics `json:\"metrics\"`\n}\n\nLabel\u30d5\u30a3\u30fc\u30eb\u30c9\u3067Mackerel\u3067\u8868\u793a\u3055\u308c\u308b\u30b0\u30e9\u30d5\u306e\u30bf\u30a4\u30c8\u30eb(\u4e0b\u56f3)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nUnit\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3053\u306e\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5358\u4f4d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nWeb UI\u304b\u3089\u30b0\u30e9\u30d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3068\u304d\u306e\u300c\u5358\u4f4d\u300d\u306b\u76f8\u5f53\u3057\u307e\u3059\u3002\n\nMetrics\u3067\u3053\u306e\u30b0\u30e9\u30d5\u306b\u8868\u793a\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4e00\u89a7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nMetrics\u69cb\u9020\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n//mackerel-plugin.go:14\ntype Metrics struct {\n    Name    string  `json:\"name\"`\n    Label   string  `json:\"label\"`\n    Diff    bool    `json:\"diff\"`\n    Stacked bool    `json:\"stacked\"`\n    Scale   float64 `json:\"scale\"`\n}\n\nName\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u306e\u5f8c\u308d\u534a\u5206\u3092\u793a\u3057\u3001Graphs\u69cb\u9020\u4f53\u306e\u4e2d\u306eName\u3068\u5408\u308f\u305b\u3066\u5b8c\u5168\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u3068\u306a\u308a\u307e\u3059\u3002\nLabel\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u51e1\u4f8b\u306e\u540d\u524d\u3092\u793a\u3057\u307e\u3059\u3002\n\nDiff\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3053\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u3092\u5dee\u5206\u5024\u3068\u3057\u3066\u6271\u3046\u304b\u5426\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306btrue\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u524d\u56de\u306e\u5024\u3068\u306e\u5dee\u5206\u304c\u6295\u7a3f\u3055\u308c\u307e\u3059\u3002\nStacked\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3053\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u304b\u5426\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\ntrue\u3092\u6307\u5b9a\u3059\u308b\u3068\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3001false\u3092\u6307\u5b9a\u3059\u308b\u3068\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\nScale\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b9\u30b1\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u306b\u50240\u4ee5\u5916\u306e\u5024\u3092\u6307\u5b9a\u3059\u308b\u3068FetchMetrics\u30e1\u30bd\u30c3\u30c9\u3067\u53d6\u5f97\u3057\u305f\u5024\u306bScale\u306e\u5024\u3092\u4e57\u3058\u305f\u5024\u304c\u6295\u7a3f\u3055\u308c\u307e\u3059\u3002\n\u3067\u306f\u5b9f\u969b\u306b\u3001Sidekiq\u7528\u306e\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nsidekiq\u306e\u30ad\u30e5\u30fc\u3068\u3057\u3066\u3001queue1\u301cqueue3\u304c\u3042\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nimport (\n    mp \"github.com/mackerelio/go-mackerel-plugin\"\n)\n\nfunc (s SidekiqPlugin) GraphDefinition() map[string](mp.Graphs) {\n    return map[string](mp.Graphs){\n        \"sidekiq.enqueued\": mp.Graphs{\n            Label:   \"Sidekiq enqueued\",\n            Unit:    \"integer\",\n            Metrics: [](mp.Metrics){\n                mp.Metrics{Name: \"queue1\", Label: \"queue1\", Diff: false, Stacked: true},\n                mp.Metrics{Name: \"queue2\", Label: \"queue2\", Diff: false, Stacked: true},\n                mp.Metrics{Name: \"queue3\", Label: \"queue3\", Diff: false, Stacked: true},\n            },\n        },\n    }\n}\n\n\u3053\u3053\u3067\u306f1\u3064\u306e\u30b0\u30e9\u30d5(Sidekiq enqueued)\u3068\u305d\u3053\u306b\u5bfe\u5fdc\u3059\u308b3\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9(queue1, queue2, queue3)\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u305d\u308c\u3089\u306e\u5024\u3092\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u304c\u524d\u3082\u3063\u3066\u5206\u304b\u3063\u3066\u3044\u308b\u306e\u306a\u3089\u3070\u3053\u306e\u307e\u307e\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092Redis\u304b\u3089\u53d6\u5f97\u3057\u3001\u305d\u3053\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u3082\u52d5\u7684\u306b\u751f\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u306fRedis\u306equeues\u306b\u30bb\u30c3\u30c8\u578b\u3068\u3057\u3066\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u3063\u3066\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u3053\u3053\u3067s.Target\u306b\u306f\u63a5\u7d9a\u5148\u306eRedis\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u3001s.Database\u306b\u306fsidekiq\u306e\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308bDB\u756a\u53f7\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001s.Namespace\u306b\u306fsidekiq\u306e\u60c5\u5831\u306e\u30ad\u30fc\u306eprefix\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002RedisNamespace(https://rubygems.org/gems/redis-namespace/ )\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nfunc (s SidekiqPlugin) GetQueues() ([](string), error) {\n    c, err := redis.Dial(\"tcp\", s.Target)\n    if err != nil {\n        return nil, err\n    }\n    defer c.Close()\n\n    prefix := \"\"\n    if s.Namespace != \"\" {\n        prefix = s.Namespace + \":\"\n    }\n\n    _, err = c.Do(\"SELECT\", s.Database)\n    if err != nil {\n        return nil, err\n    }\n\n    queues, err := redis.Strings(c.Do(\"SMEMBERS\", prefix+\"queues\"))\n    if err != nil {\n        return nil, err\n    }\n    return queues, nil\n}\n\n\u3053\u3053\u304b\u3089Metrics\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eslice\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\nfunc (s SidekiqPlugin) GetEnqueuedMetrics() ([](mp.Metrics), error) {\n    metrics := make([](mp.Metrics), 0)\n    queues, err := s.GetQueues()\n    if err != nil {\n        return nil, err\n    }\n\n    for _, queue := range queues {\n        metrics = append(metrics, mp.Metrics{Name: \"queue.\" + queue, Label: queue, Diff: false, Stacked: true})\n    }\n    return metrics, nil\n}\n\n\u3053\u308c\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u5148\u307b\u3069\u306eGraphDefinition\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\nfunc (s SidekiqPlugin) GraphDefinition() map[string](mp.Graphs) {\n    enqueued_metrics, err := s.GetEnqueuedMetrics()\n    if err != nil {\n        return nil\n    }\n\n    return map[string](mp.Graphs){\n        \"sidekiq.enqueued\": mp.Graphs{\n            Label:   \"Sidekiq enqueued\",\n            Unit:    \"integer\",\n            Metrics: enqueued_metrics,\n            },\n        },\n    }\n}\n\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u53d6\u5f97\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u306e\u6295\u7a3f\u306e\u305f\u3081\u306bFetchMetrics\u30e1\u30bd\u30c3\u30c9\u3092SidekiqPlugin\u69cb\u9020\u4f53\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\nFetchMetrics\u30e1\u30bd\u30c3\u30c9\u306f\u8907\u6570\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3057\u3066\u305d\u306e\u5024\u3092map[string]float64\u578b\u3067\u8fd4\u3059\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\u8fd4\u308a\u5024\u306emap\u306e\u30ad\u30fc\u540d\u306fGraphDefinition\u30e1\u30bd\u30c3\u30c9\u3067\u6307\u5b9a\u3057\u305f\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306fqueue.<\u30ad\u30e5\u30fc\u540d>\u306b\u306a\u308a\u307e\u3059\u3002\nGraphDefinition\u3068\u540c\u69d8\u306b\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092\u52d5\u7684\u306b\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u305d\u308c\u3089\u306e\u30ad\u30e5\u30fc\u3054\u3068\u306b\u3001\u30a8\u30f3\u30ad\u30e5\u30fc\u3055\u308c\u3066\u3044\u308bJOB\u306e\u6570\u3092\u53d6\u5f97\u3057\u3066metrics\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\u3002\nfunc (s SidekiqPlugin) FetchMetrics() (map[string]float64, error) {\n    c, err := redis.Dial(\"tcp\", s.Target)\n    if err != nil {\n        return nil, err\n    }\n    defer c.Close()\n\n    prefix := \"\"\n    if s.Namespace != \"\" {\n        prefix = s.Namespace + \":\"\n    }\n\n    _, err = c.Do(\"SELECT\", s.Database)\n    if err != nil {\n        return nil, err\n    }\n\n    queues, err := redis.Strings(c.Do(\"SMEMBERS\", prefix+\"queues\"))\n    if err != nil {\n        return nil, err\n    }\n\n    metrics := make(map[string]float64)\n\n    for _, queue := range queues {\n        enqueued, err := redis.Int(c.Do(\"LLEN\", prefix+\"queue:\"+queue))\n        if err != nil {\n            return nil, err\n        }\n        metrics[\"queue.\"+queue] = float64(enqueued)\n    }\n\n    return metrics, nil\n}\n\n\n\u30e1\u30a4\u30f3\u95a2\u6570\n\u3042\u3068\u306f\u3001\u4e0a\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u30d1\u30fc\u30b9\u3059\u308b\u51e6\u7406\u3084\u3001MackerelPlugin\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5b8c\u6210\u3067\u3059\u3002\n\u63a5\u7d9a\u5148\u306eRedis\u306e\u60c5\u5831\u3084\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5229\u7528\u3059\u308b\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u6a19\u6e96\u51fa\u529b\u306b\u5bfe\u3057\u3066\u51fa\u529b\u3092\u884c\u3046\u6642\u306b\u306f\u74b0\u5883\u5909\u6570MACKEREL_AGENT_PLUGIN_META\u306e\u5024\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u51fa\u529b\u304b\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u306e\u51fa\u529b\u304b\u3092\u5207\u308a\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\npackage main\n\nimport (\n    \"flag\"\n    \"os\"\n)\n\nfunc main() {\n    optHost := flag.String(\"host\", \"127.0.0.1\", \"Hostname\")\n    optPort := flag.String(\"port\", \"6379\", \"port\")\n    optTempfile := flag.String(\"tempfile\", \"\", \"Temp file name\")\n    optDB := flag.String(\"db\", \"0\", \"Database\")\n    optNamespace := flag.String(\"namespace\", \"\", \"Namespace\")\n    flag.Parse()\n\n    var sidekiq SidekiqPlugin\n    sidekiq.Target = *optHost + \":\" + *optPort\n    sidekiq.Database = *optDB\n    sidekiq.Namespace = *optNamespace\n    helper := mp.NewMackerelPlugin(sidekiq)\n\n    if *optTempfile != \"\" {\n        helper.Tempfile = *optTempfile\n    } else {\n        helper.Tempfile = \"/tmp/mackerel-plugin-sidekiq-\" + *optHost + \"-\" + *optPort\n    }\n\n    if os.Getenv(\"MACKEREL_AGENT_PLUGIN_META\") != \"\" {\n        helper.OutputDefinitions()\n    } else {\n        helper.OutputValues()\n    }\n}\n\n\nmackerel-agent\u3078\u306e\u7d44\u307f\u8fbc\u307f\n\u3042\u3068\u306f\u3001\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092mackerel-agent\u306b\u7d44\u307f\u8fbc\u3081\u3070\u3001WEB UI\u304b\u3089\u30b0\u30e9\u30d5\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n/etc/mackerel-agent/mackerel-agent.conf\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[plugin.metrics.sidekiq]\ncommand = \"/path/to/mackerel-plugin-sidekiq -port=6379 -db=0\"\n\n\u305d\u306e\u5f8c\u3001mackerel-agent\u306e\u518d\u8d77\u52d5\u3092\u884c\u3046\u3068\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3001\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u6295\u7a3f\u304c\u59cb\u307e\u308a\u307e\u3059\u3002\n\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6642\u306bStacked: true\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u30d0\u30a4\u30ca\u30ea\u306e\u914d\u5e03(\u304a\u307e\u3051)\ngo\u306f\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u5bb9\u6613\u306a\u306e\u3067\u3001\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u3057\u3066\u30d0\u30a4\u30ca\u30ea\u3092\u914d\u5e03\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u6ce8\uff1amackerel-plugin\u306e\u4f5c\u6210\u3092\u884c\u3046\u305f\u3081\u306b\u306f\u3053\u306e\u4f5c\u696d\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\nmackerel-agent\u306fLinux\u3068Windows\u306e32/64\u30d3\u30c3\u30c8\u74b0\u5883\u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u74b0\u5883\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/overview#support-environments\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u74b0\u5883\u5909\u6570GOOS\u3068GOARCH\u3092\u9069\u5207\u306a\u3082\u306e\u306b\u8a2d\u5b9a\u3057\u305f\u306e\u3061\u306bgo build\u3092\u884c\u3048\u3070\u3088\u3046\u3067\u3059\u3002\n\u8907\u6570\u74b0\u5883\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u81ea\u5206\u3067\u66f8\u3044\u3066\u3082\u3044\u3044\u3067\u3059\u304c\u3001\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u7c21\u5358\u306b\u884c\u3046\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3042\u308bgox\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\ngox\u81ea\u8eab\u3082go\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306fgo\u6a19\u6e96\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3092\u4f7f\u3044\u307e\u3059\u3002\ngo get github.com/mitchellh/gox\n\n\u3042\u3068\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3060\u3051\u3067\u8907\u6570\u74b0\u5883\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u751f\u6210\u3067\u304d\u307e\u3059\u3002\ngox -os=\"linux windows\" -arch=\"386 amd64\"\n\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306e\u30d0\u30a4\u30ca\u30ea\u306fbintray\u306b\u914d\u7f6e\u3057\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nbintray\u306fcurl\u3067REST API\u3092\u53e9\u304f\u3060\u3051\u3067\u30d0\u30a4\u30ca\u30ea\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001CUI\u3060\u3051\u3067\u5168\u3066\u306e\u64cd\u4f5c\u3092\u5b8c\u7d50\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u4fbf\u5229\u3067\u3059\u3002\nhttps://bintray.com/docs/api/#_content_uploading_publishing\n\n\u307e\u3068\u3081\n\u308f\u305a\u304b200\u884c\u8db3\u3089\u305a\u306e\u30b3\u30fc\u30c9\u3067mackerel\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u6295\u7a3f\u304c\u3067\u304d\u307e\u3057\u305f\u3002\ngo tutorial\u3092\u7d42\u3048\u305f\u76f4\u5f8c\u306b\u3084\u308b\u3068\u4e01\u5ea6\u826f\u3044\u304f\u3089\u3044\u306e\u96e3\u6613\u5ea6\u306a\u306e\u3067\u3001go\u306e\u7df4\u7fd2\u554f\u984c\u3068\u3057\u3066\u3082\u6700\u9069\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u3082\u3046\u5c11\u3057\u5145\u5b9f\u3055\u305b\u305f\u3089\u516c\u5f0f\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u96c6\u306b\u305f\u3044\u3057\u3066PR\u3092\u6295\u3052\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u660e\u65e5\u306f @mackee_w\u3055\u3093\u3067\u3059\n\n\u53c2\u7167\nhttp://help-ja.mackerel.io/entry/advanced/custom-metrics\nhttps://github.com/mperham/sidekiq/wiki\nhttps://bintray.com/docs/api/\n\n# \u306f\u3058\u3081\u306b\n\u79c1\u306e\u6240\u5c5e\u3057\u3066\u3044\u308bVASILY\u3067\u306f\u975e\u540c\u671f\u51e6\u7406\u3092\u884c\u3046\u305f\u3081\u306bsidekiq(http://sidekiq.org/ )\u3068\u3044\u3046\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-15 14.50.08.png](https://qiita-image-store.s3.amazonaws.com/0/74551/5ab97505-8668-8b3c-6f98-5b3d6b8d516b.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-15 14.50.08.png\")\n\n\nsidekiq\u3067\u306f\u975e\u540c\u671f\u51e6\u7406\u7528\u306e\u30b8\u30e7\u30d6\u3092Redis\u4e0a\u306e\u30ad\u30e5\u30fc\u3067\u7ba1\u7406\u3057\u307e\u3059\u3002\n\u3053\u306e\u30ad\u30e5\u30fc\u306b\u3069\u306e\u304f\u3089\u3044\u306e\u6570\u306e\u30b8\u30e7\u30d6\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u304b\u3068\u3044\u3046\u60c5\u5831\u3092mackerel\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u3068\u3057\u3066\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u305f\u306e\u3067\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nmackerel-agent\u306fgo\u3067\u66f8\u304b\u308c\u3066\u304a\u308a\u3001\u305d\u306e\u5f71\u97ff\u304b\u516c\u5f0f\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3082go\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/mackerelio/mackerel-agent-plugins\n\u516c\u5f0f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5e7e\u3064\u304b\u898b\u308b\u3068go\u306e\u7df4\u7fd2\u306b\u3061\u3087\u3046\u3069\u3088\u3055\u305d\u3046\u306a\u96e3\u6613\u5ea6\u3067\u3057\u305f\u306e\u3067\u3001go\u306e\u52c9\u5f37\u3082\u517c\u306d\u3066mackerel\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306fhttps://github.com/vasilyjp/mackerel-plugin-sidekiq \u306b\u3001\n\u30d0\u30a4\u30ca\u30ea\u306fhttps://bintray.com/shio-phys/mackerel-plugin-sidekiq/mackerel-plugin-sidekiq/view#files \u306b\u914d\u7f6e\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u306e\u306b\u4fbf\u5229\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u305f\u3061\n\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u6295\u7a3f\u3059\u308b\u65b9\u6cd5\u306fmackerel\u306e\u516c\u5f0f\u30d8\u30eb\u30d7\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/advanced/custom-metrics\n\n\u305d\u308c\u306b\u3088\u308b\u3068\u3001\u6a19\u6e96\u51fa\u529b\u306b\u4ee5\u4e0b\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30671\u30e1\u30c8\u30ea\u30af\u30b91\u884c\u3067\u51fa\u529b\u3059\u308c\u3070\u3044\u3044\u305d\u3046\u3067\u3059\u3002\n`{metric name}\\t{metric value}\\t{epoch seconds}`\n(\\t\u306f\u30bf\u30d6\u6587\u5b57)\n\n\u307e\u305f\u3001\u74b0\u5883\u5909\u6570`MACKEREL_AGENT_PLUGIN_META`\u304c`1`\u306e\u6642\u306b\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3068mackerel\u5074\u304c\u30b0\u30e9\u30d5\u306e\u30bf\u30a4\u30c8\u30eb\u3084\b\u51e1\u4f8b\u3092\u81ea\u52d5\u7684\u306b\u30bb\u30c3\u30c8\u3057\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306f\u5148\u982d\u884c\u3092`# mackerel-agent-plugin`\u304b\u3089\u59cb\u3081\u3066\u305d\u306e\u5f8c\u306b\u30b0\u30e9\u30d5\u5b9a\u7fa9\u672c\u4f53\u306eJSON\u3092\u7d9a\u3051\u307e\u3059\u3002\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u4ed5\u69d8\u306fmackerel API\u4ed5\u69d8\u306e\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6295\u7a3f\u306e\u90e8\u5206\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/spec/api/v0#graphdef-post\n\n\u3053\u308c\u3089\u306e\u6a5f\u80fd\u3092\u5168\u90e8\u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u305f\u3081\u306e\u30d8\u30eb\u30d1\u30fc\u30e9\u30a4\u30d6\u30e9\u30ea\u304cmackerel\u516c\u5f0f\u304b\u3089\u51fa\u3066\u3044\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nhttps://github.com/mackerelio/go-mackerel-plugin\n\n\u307e\u305f\u3001go\u306eRedis\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u3057\u3066redigo\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\nhttps://github.com/garyburd/redigo\n\n\u3053\u308c\u3089\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fgo\u8a00\u8a9e\u306b\u6a19\u6e96\u6dfb\u4ed8\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3092\u5229\u7528\u3057\u3066\u884c\u3044\u307e\u3057\u305f\u3002\n\n```bash\n# \u4e8b\u524d\u306b\u74b0\u5883\u5909\u6570GOPATH\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u3042\u308a\n#   https://golang.org/doc/install#testing\ngo get github.com/mackerelio/go-mackerel-plugin\ngo get github.com/garyburd/redigo/redis\n```\n\n# \u30b0\u30e9\u30d5\u306e\u5b9a\u7fa9\n\u307e\u305a\u306f\u3053\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8868\u3059\u69cb\u9020\u4f53\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```go\ntype SidekiqPlugin struct {\n\tTarget    string\n\tDatabase  string\n\tNamespace string\n}\n```\n\n\u3053\u306e\u69cb\u9020\u4f53\u306e\u5404\u30d5\u30a3\u30fc\u30eb\u30c9(Target, Database, Namespace)\u306fRedis\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u3067\u3059\u3002\n\u8a73\u7d30\u306b\u3064\u3044\u3066\u306fRedis\u306b\u63a5\u7d9a\u3092\u3059\u308b\u90e8\u5206\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u6b21\u306b\u3053\u306e\u69cb\u9020\u4f53\u306bPlugin\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nPlugin\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306fgo-mackerel-plugin\u306e\u4e2d\u3067\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002\n\n```go\n// mackerel-plugin.go:28\ntype Plugin interface {\n\tFetchMetrics() (map[string]float64, error)\n\tGraphDefinition() map[string]Graphs\n}\n```\n\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u8fd4\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9`GraphDefinition `\u3068\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u60c5\u5831\u3092\u8fd4\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9`FetchMetrics`\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6700\u521d\u306b`GraphDefinition`\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u8fd4\u308a\u5024\u306f\u30b0\u30e9\u30d5\u540d\u3068\u3092\u30ad\u30fc\u3068\u3057\u3066\u3001\u305d\u306e\u30b0\u30e9\u30d5\u306e\u5b9a\u7fa9(`Graphs`\u69cb\u9020\u4f53)\u3092\u30d0\u30ea\u30e5\u30fc\u3068\u3059\u308bmap\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\n\u30b0\u30e9\u30d5\u540d\u306f\u30b0\u30e9\u30d5\u5185\u306e\u5404\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u306e\u30d7\u30ea\u30d5\u30a3\u30c3\u30af\u30b9\u306b\u306a\u308a\u307e\u3059\u3002\n`Graphs`\u69cb\u9020\u4f53\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\ntype Graphs struct {\n\tLabel   string    `json:\"label\"`\n\tUnit    string    `json:\"unit\"`\n\tMetrics []Metrics `json:\"metrics\"`\n}\n```\n\nLabel\u30d5\u30a3\u30fc\u30eb\u30c9\u3067Mackerel\u3067\u8868\u793a\u3055\u308c\u308b\u30b0\u30e9\u30d5\u306e\u30bf\u30a4\u30c8\u30eb(\u4e0b\u56f3)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_18_42_46.png](https://qiita-image-store.s3.amazonaws.com/0/74551/6bcf82bf-f7c7-92be-be17-f71ec9d98a94.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_18_42_46.png\")\n\n\nUnit\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3053\u306e\u30b0\u30e9\u30d5\u3067\u8868\u793a\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5358\u4f4d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nWeb UI\u304b\u3089\u30b0\u30e9\u30d5\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3068\u304d\u306e\u300c\u5358\u4f4d\u300d\u306b\u76f8\u5f53\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_18_48_27.png](https://qiita-image-store.s3.amazonaws.com/0/74551/ca411c33-8707-53f7-8829-dfa42d2f136f.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_18_48_27.png\")\n\n\nMetrics\u3067\u3053\u306e\u30b0\u30e9\u30d5\u306b\u8868\u793a\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4e00\u89a7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nMetrics\u69cb\u9020\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```go\n//mackerel-plugin.go:14\ntype Metrics struct {\n\tName    string  `json:\"name\"`\n\tLabel   string  `json:\"label\"`\n\tDiff    bool    `json:\"diff\"`\n\tStacked bool    `json:\"stacked\"`\n\tScale   float64 `json:\"scale\"`\n}\n```\n\nName\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u306e\u5f8c\u308d\u534a\u5206\u3092\u793a\u3057\u3001`Graphs`\u69cb\u9020\u4f53\u306e\u4e2d\u306eName\u3068\u5408\u308f\u305b\u3066\u5b8c\u5168\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u3068\u306a\u308a\u307e\u3059\u3002\n\nLabel\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u51e1\u4f8b\u306e\u540d\u524d\u3092\u793a\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_19_33_25.png](https://qiita-image-store.s3.amazonaws.com/0/74551/51e1444d-6d77-4818-0d32-8bb865c30ac3.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_2015-12-15_19_33_25.png\")\n\nDiff\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3053\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u3092\u5dee\u5206\u5024\u3068\u3057\u3066\u6271\u3046\u304b\u5426\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306btrue\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u524d\u56de\u306e\u5024\u3068\u306e\u5dee\u5206\u304c\u6295\u7a3f\u3055\u308c\u307e\u3059\u3002\n\nStacked\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u3053\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u304b\u5426\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\ntrue\u3092\u6307\u5b9a\u3059\u308b\u3068\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3001false\u3092\u6307\u5b9a\u3059\u308b\u3068\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\nScale\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b9\u30b1\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u306b\u50240\u4ee5\u5916\u306e\u5024\u3092\u6307\u5b9a\u3059\u308b\u3068`FetchMetrics`\u30e1\u30bd\u30c3\u30c9\u3067\u53d6\u5f97\u3057\u305f\u5024\u306bScale\u306e\u5024\u3092\u4e57\u3058\u305f\u5024\u304c\u6295\u7a3f\u3055\u308c\u307e\u3059\u3002\n\n\u3067\u306f\u5b9f\u969b\u306b\u3001Sidekiq\u7528\u306e\u30b0\u30e9\u30d5\u5b9a\u7fa9\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nsidekiq\u306e\u30ad\u30e5\u30fc\u3068\u3057\u3066\u3001queue1\u301cqueue3\u304c\u3042\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```go\nimport (\n\tmp \"github.com/mackerelio/go-mackerel-plugin\"\n)\n\nfunc (s SidekiqPlugin) GraphDefinition() map[string](mp.Graphs) {\n\treturn map[string](mp.Graphs){\n\t\t\"sidekiq.enqueued\": mp.Graphs{\n\t\t\tLabel:   \"Sidekiq enqueued\",\n\t\t\tUnit:    \"integer\",\n\t\t\tMetrics: [](mp.Metrics){\n\t\t\t\tmp.Metrics{Name: \"queue1\", Label: \"queue1\", Diff: false, Stacked: true},\n\t\t\t\tmp.Metrics{Name: \"queue2\", Label: \"queue2\", Diff: false, Stacked: true},\n\t\t\t\tmp.Metrics{Name: \"queue3\", Label: \"queue3\", Diff: false, Stacked: true},\n\t\t\t},\n\t\t},\n\t}\n}\n```\n\n\u3053\u3053\u3067\u306f1\u3064\u306e\u30b0\u30e9\u30d5(Sidekiq enqueued)\u3068\u305d\u3053\u306b\u5bfe\u5fdc\u3059\u308b3\u3064\u306e\u30e1\u30c8\u30ea\u30af\u30b9(queue1, queue2, queue3)\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u305d\u308c\u3089\u306e\u5024\u3092\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u304c\u524d\u3082\u3063\u3066\u5206\u304b\u3063\u3066\u3044\u308b\u306e\u306a\u3089\u3070\u3053\u306e\u307e\u307e\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092Redis\u304b\u3089\u53d6\u5f97\u3057\u3001\u305d\u3053\u304b\u3089\u30e1\u30c8\u30ea\u30af\u30b9\u3082\u52d5\u7684\u306b\u751f\u6210\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u306fRedis\u306equeues\u306b\u30bb\u30c3\u30c8\u578b\u3068\u3057\u3066\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u3092\u4f5c\u3063\u3066\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u3053\u3053\u3067`s.Target`\u306b\u306f\u63a5\u7d9a\u5148\u306eRedis\u306eIP\u30a2\u30c9\u30ec\u30b9\u304c\u3001`s.Database`\u306b\u306fsidekiq\u306e\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308bDB\u756a\u53f7\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001`s.Namespace`\u306b\u306fsidekiq\u306e\u60c5\u5831\u306e\u30ad\u30fc\u306eprefix\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002RedisNamespace(https://rubygems.org/gems/redis-namespace/ )\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```go\nfunc (s SidekiqPlugin) GetQueues() ([](string), error) {\n\tc, err := redis.Dial(\"tcp\", s.Target)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer c.Close()\n\n\tprefix := \"\"\n\tif s.Namespace != \"\" {\n\t\tprefix = s.Namespace + \":\"\n\t}\n\n\t_, err = c.Do(\"SELECT\", s.Database)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tqueues, err := redis.Strings(c.Do(\"SMEMBERS\", prefix+\"queues\"))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn queues, nil\n}\n```\n\n\u3053\u3053\u304b\u3089Metrics\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eslice\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3057\u305f\u3002\n\n```go\nfunc (s SidekiqPlugin) GetEnqueuedMetrics() ([](mp.Metrics), error) {\n\tmetrics := make([](mp.Metrics), 0)\n\tqueues, err := s.GetQueues()\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tfor _, queue := range queues {\n\t\tmetrics = append(metrics, mp.Metrics{Name: \"queue.\" + queue, Label: queue, Diff: false, Stacked: true})\n\t}\n\treturn metrics, nil\n}\n```\n\n\u3053\u308c\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u5148\u307b\u3069\u306e`GraphDefinition`\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\n\n```go\nfunc (s SidekiqPlugin) GraphDefinition() map[string](mp.Graphs) {\n\tenqueued_metrics, err := s.GetEnqueuedMetrics()\n\tif err != nil {\n\t\treturn nil\n\t}\n\n\treturn map[string](mp.Graphs){\n\t\t\"sidekiq.enqueued\": mp.Graphs{\n\t\t\tLabel:   \"Sidekiq enqueued\",\n\t\t\tUnit:    \"integer\",\n\t\t\tMetrics: enqueued_metrics,\n\t\t\t},\n\t\t},\n\t}\n}\n```\n\n# \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u53d6\u5f97\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u306e\u6295\u7a3f\u306e\u305f\u3081\u306b`FetchMetrics`\u30e1\u30bd\u30c3\u30c9\u3092SidekiqPlugin\u69cb\u9020\u4f53\u306b\u5b9f\u88c5\u3057\u307e\u3059\u3002\n`FetchMetrics`\u30e1\u30bd\u30c3\u30c9\u306f\u8907\u6570\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53d6\u5f97\u3057\u3066\u305d\u306e\u5024\u3092`map[string]float64`\u578b\u3067\u8fd4\u3059\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\n\u8fd4\u308a\u5024\u306emap\u306e\u30ad\u30fc\u540d\u306f`GraphDefinition`\u30e1\u30bd\u30c3\u30c9\u3067\u6307\u5b9a\u3057\u305f\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u3067\u306f`queue.<\u30ad\u30e5\u30fc\u540d>`\u306b\u306a\u308a\u307e\u3059\u3002\n\n`GraphDefinition`\u3068\u540c\u69d8\u306b\u30ad\u30e5\u30fc\u306e\u7a2e\u985e\u3092\u52d5\u7684\u306b\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u3057\u3066\u305d\u308c\u3089\u306e\u30ad\u30e5\u30fc\u3054\u3068\u306b\u3001\u30a8\u30f3\u30ad\u30e5\u30fc\u3055\u308c\u3066\u3044\u308bJOB\u306e\u6570\u3092\u53d6\u5f97\u3057\u3066metrics\u306b\u683c\u7d0d\u3057\u3066\u3044\u307e\u3059\u3002\n\n```go\nfunc (s SidekiqPlugin) FetchMetrics() (map[string]float64, error) {\n\tc, err := redis.Dial(\"tcp\", s.Target)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tdefer c.Close()\n\n\tprefix := \"\"\n\tif s.Namespace != \"\" {\n\t\tprefix = s.Namespace + \":\"\n\t}\n\n\t_, err = c.Do(\"SELECT\", s.Database)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tqueues, err := redis.Strings(c.Do(\"SMEMBERS\", prefix+\"queues\"))\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tmetrics := make(map[string]float64)\n\n\tfor _, queue := range queues {\n\t\tenqueued, err := redis.Int(c.Do(\"LLEN\", prefix+\"queue:\"+queue))\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\tmetrics[\"queue.\"+queue] = float64(enqueued)\n\t}\n\n\treturn metrics, nil\n}\n```\n\n# \u30e1\u30a4\u30f3\u95a2\u6570\n\u3042\u3068\u306f\u3001\u4e0a\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u30d1\u30fc\u30b9\u3059\u308b\u51e6\u7406\u3084\u3001MackerelPlugin\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308c\u3070\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5b8c\u6210\u3067\u3059\u3002\n\u63a5\u7d9a\u5148\u306eRedis\u306e\u60c5\u5831\u3084\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5229\u7528\u3059\u308b\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6a19\u6e96\u51fa\u529b\u306b\u5bfe\u3057\u3066\u51fa\u529b\u3092\u884c\u3046\u6642\u306b\u306f\u74b0\u5883\u5909\u6570`MACKEREL_AGENT_PLUGIN_META`\u306e\u5024\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3001\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u51fa\u529b\u304b\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5024\u306e\u51fa\u529b\u304b\u3092\u5207\u308a\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\n\n```go\npackage main\n\nimport (\n\t\"flag\"\n\t\"os\"\n)\n\nfunc main() {\n\toptHost := flag.String(\"host\", \"127.0.0.1\", \"Hostname\")\n\toptPort := flag.String(\"port\", \"6379\", \"port\")\n\toptTempfile := flag.String(\"tempfile\", \"\", \"Temp file name\")\n\toptDB := flag.String(\"db\", \"0\", \"Database\")\n\toptNamespace := flag.String(\"namespace\", \"\", \"Namespace\")\n\tflag.Parse()\n\n\tvar sidekiq SidekiqPlugin\n\tsidekiq.Target = *optHost + \":\" + *optPort\n\tsidekiq.Database = *optDB\n\tsidekiq.Namespace = *optNamespace\n\thelper := mp.NewMackerelPlugin(sidekiq)\n\n\tif *optTempfile != \"\" {\n\t\thelper.Tempfile = *optTempfile\n\t} else {\n\t\thelper.Tempfile = \"/tmp/mackerel-plugin-sidekiq-\" + *optHost + \"-\" + *optPort\n\t}\n\n\tif os.Getenv(\"MACKEREL_AGENT_PLUGIN_META\") != \"\" {\n\t\thelper.OutputDefinitions()\n\t} else {\n\t\thelper.OutputValues()\n\t}\n}\n```\n\n# mackerel-agent\u3078\u306e\u7d44\u307f\u8fbc\u307f\n\u3042\u3068\u306f\u3001\u4f5c\u6210\u3057\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092mackerel-agent\u306b\u7d44\u307f\u8fbc\u3081\u3070\u3001WEB UI\u304b\u3089\u30b0\u30e9\u30d5\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n`/etc/mackerel-agent/mackerel-agent.conf`\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```ini\n[plugin.metrics.sidekiq]\ncommand = \"/path/to/mackerel-plugin-sidekiq -port=6379 -db=0\"\n```\n\n\u305d\u306e\u5f8c\u3001mackerel-agent\u306e\u518d\u8d77\u52d5\u3092\u884c\u3046\u3068\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3001\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u6295\u7a3f\u304c\u59cb\u307e\u308a\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-16 18.19.22.png](https://qiita-image-store.s3.amazonaws.com/0/74551/f2bbf229-5cf9-f8ee-e1ae-427771b5b4a0.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-16 18.19.22.png\")\n\n\u30b0\u30e9\u30d5\u5b9a\u7fa9\u306e\u6642\u306b`Stacked: true`\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u7a4d\u307f\u4e0a\u3052\u30b0\u30e9\u30d5\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n# \u30d0\u30a4\u30ca\u30ea\u306e\u914d\u5e03(\u304a\u307e\u3051)\ngo\u306f\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u5bb9\u6613\u306a\u306e\u3067\u3001\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u3057\u3066\u30d0\u30a4\u30ca\u30ea\u3092\u914d\u5e03\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u6ce8\uff1amackerel-plugin\u306e\u4f5c\u6210\u3092\u884c\u3046\u305f\u3081\u306b\u306f\u3053\u306e\u4f5c\u696d\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\nmackerel-agent\u306fLinux\u3068Windows\u306e32/64\u30d3\u30c3\u30c8\u74b0\u5883\u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u74b0\u5883\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nhttp://help-ja.mackerel.io/entry/overview#support-environments\n\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u74b0\u5883\u5909\u6570`GOOS`\u3068`GOARCH`\u3092\u9069\u5207\u306a\u3082\u306e\u306b\u8a2d\u5b9a\u3057\u305f\u306e\u3061\u306b`go build`\u3092\u884c\u3048\u3070\u3088\u3046\u3067\u3059\u3002\n\u8907\u6570\u74b0\u5883\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u81ea\u5206\u3067\u66f8\u3044\u3066\u3082\u3044\u3044\u3067\u3059\u304c\u3001\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u7c21\u5358\u306b\u884c\u3046\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3042\u308bgox\u3092\u5229\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\ngox\u81ea\u8eab\u3082go\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306fgo\u6a19\u6e96\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```shell\ngo get github.com/mitchellh/gox\n```\n\n\u3042\u3068\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53e9\u304f\u3060\u3051\u3067\u8907\u6570\u74b0\u5883\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u751f\u6210\u3067\u304d\u307e\u3059\u3002\n\n```shell\ngox -os=\"linux windows\" -arch=\"386 amd64\"\n```\n\n\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306e\u30d0\u30a4\u30ca\u30ea\u306fbintray\u306b\u914d\u7f6e\u3057\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nbintray\u306fcurl\u3067REST API\u3092\u53e9\u304f\u3060\u3051\u3067\u30d0\u30a4\u30ca\u30ea\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001CUI\u3060\u3051\u3067\u5168\u3066\u306e\u64cd\u4f5c\u3092\u5b8c\u7d50\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u4fbf\u5229\u3067\u3059\u3002\nhttps://bintray.com/docs/api/#_content_uploading_publishing\n\n# \u307e\u3068\u3081\n\u308f\u305a\u304b200\u884c\u8db3\u3089\u305a\u306e\u30b3\u30fc\u30c9\u3067mackerel\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u6295\u7a3f\u304c\u3067\u304d\u307e\u3057\u305f\u3002\ngo tutorial\u3092\u7d42\u3048\u305f\u76f4\u5f8c\u306b\u3084\u308b\u3068\u4e01\u5ea6\u826f\u3044\u304f\u3089\u3044\u306e\u96e3\u6613\u5ea6\u306a\u306e\u3067\u3001go\u306e\u7df4\u7fd2\u554f\u984c\u3068\u3057\u3066\u3082\u6700\u9069\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u3082\u3046\u5c11\u3057\u5145\u5b9f\u3055\u305b\u305f\u3089\u516c\u5f0f\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u96c6\u306b\u305f\u3044\u3057\u3066PR\u3092\u6295\u3052\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u660e\u65e5\u306f @mackee_w\u3055\u3093\u3067\u3059\n\n# \u53c2\u7167\nhttp://help-ja.mackerel.io/entry/advanced/custom-metrics\nhttps://github.com/mperham/sidekiq/wiki\nhttps://bintray.com/docs/api/\n", "tags": ["Go", "Ruby", "Rails", "Mackerel", "sidekiq"]}