{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nfluentd + elasticsearch + kibana\u3092\u7528\u3044\u3066\u3001\u30eb\u30fc\u30bf\u30fc\u306e\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u3067\u843d\u3068\u3057\u305fIP\u306e\u30ed\u30b0\u306a\u3069\u3092\u53ef\u8996\u5316\u3057\u3066\u307f\u305f\u3002\nfluentd\u306e\u30d7\u30e9\u30b0\u30a4\u30f3(fluent-plugin-geoip)\u3092\u4f7f\u3063\u3066IP\u304b\u3089\u4f4d\u7f6e\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u305f\u3002\n\n\n\n\u8a2d\u5b9a\n\n\u524d\u63d0\u6761\u4ef6\n\n\u30eb\u30fc\u30bf\uff08RTX1100\uff09IP: 192.168.1.1\n\u30b5\u30fc\u30d0\n\n\nOS: Ubuntu 14.04.3 LTS Trusty\nIP: 192.168.1.100\nkibana, fluentd, elasticsearch\u3092\u52d5\u304b\u3059\nLAN\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u60f3\u5b9a\u6545\u3001\u30b5\u30fc\u30d0\u306eFW\u306f\u30ac\u30e9\u7a7a\u304d\n\n\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0f\u624b\u9806\u53c2\u8003\n\nfluentd\nelasticsearch\n\nkibana\n\n\u305f\u3060\u3057\u3001OS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u8d77\u52d5\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001init.d\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3069\u3063\u304b\u304b\u3089\u62fe\u3063\u3066\u304f\u308b\u5fc5\u8981\u304c\u3042\u308b\n\n\nKibana Beta init script\nkibana4_init\n\n\n\n\n\n\nApache2\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\nelasticsearch\u3068kibana\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001\u305d\u308c\u305e\u308c5601\u756a\u30689200\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u3061\u53d7\u3051\u308b\u306e\u3067\u3001\u4fbf\u5b9c\u4e0a\u3001\u9069\u5f53\u306b\u30ea\u30d0\u30d7\u30ed\u8a2d\u5b9a\u3002\n<Location /kibana>\n        Require ip 127 192.168.1\n        ProxyPass http://localhost:5601\n        ProxyPassReverse http://localhost:5601\n</Location>\n\n<Location /elasticsearch>\n        Require ip 127 192.168.1\n        ProxyPass http://localhost:9200\n        ProxyPassReverse http://localhost:9200\n</Location>\n\n\nRTX1100\u30b3\u30f3\u30d5\u30a3\u30b0\u5909\u66f4\n\u30b5\u30fc\u30d0\u306b\u30eb\u30fc\u30bf\u306esyslog\u3092\u3076\u3063\u98db\u3070\u3059\u8a2d\u5b9a\u3092\u8ffd\u52a0\n#\n# SYSLOG configuration\n#\nsyslog local address 192.168.1.1\nsyslog host 192.168.1.100\nsyslog info on\nsyslog notice on\n\n\nelasticsearch\u8a2d\u5b9a\nelasticsearch\u304c\u81ea\u52d5\u7684\u306b\u6587\u5b57\u5217\u3092\u8981\u7d20\u89e3\u6790\u3059\u308b\u3089\u3057\u304f\u3001\nkibana\u3067\u53ef\u8996\u5316\u3059\u308b\u969b\u306b\u300cnot analyzed\u306b\u3057\u306a\u3044\u3068\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u60aa\u304f\u306a\u308b\u305c\u300d\u3068\u304b\u4ef0\u308b\u306e\u3067\u3001not analyzed\u306afield\u3082\u7528\u610f\u3059\u308b\u3002\n\u3042\u3068\u3001\u5730\u7406\u60c5\u5831\u3092\u5165\u308c\u308b\u30d5\u30a3\u30fc\u30eb\u30c9(geo_location)\u306e\u578b\u3092geo_point\u306b\u3057\u3066\u304a\u304f\u3002\n$ curl -XPUT 192.168.1.100:9200/rtx1100-*/ -d \"`cat elasticsearch_default_template.json`\"\n\n# lasticsearch_default_template.json\n{\n    \"template\": \"rtx1100-*\",\n    \"mappings\": {\n        \"_default_\": {\n            \"dynamic_templates\": [\n                {\n                    \"string_template\" : {\n                        \"match\" : \"*\",\n                        \"mapping\": {\n                            \"type\": \"string\",\n                            \"fields\": {\n                                \"full\": {\n                                    \"type\": \"string\",\n                                    \"index\": \"not_analyzed\"\n                                }\n                            }\n                        },\n                        \"match_mapping_type\": \"string\"\n                    }\n                }\n            ],\n            \"properties\": {\n                \"@timestamp\": { \"type\": \"date\", \"index\": \"not_analyzed\" },\n                \"geo_location\": {\"type\" : \"geo_point\" }\n            }\n        }\n    }\n}\n\n\n\nfluentd\u8a2d\u5b9a\n\nfluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4ee5\u4e0b\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3002\n\n\nfluent/fluent-plugin-rewrite-tag-filter\n\nrecord\u5185\u306efield\u3092\u7528\u3044\u3066tag\u3092\u66f8\u304d\u63db\u3048\u3089\u308c\u305f\u308a\u3067\u304d\u308b\u30d5\u30a3\u30eb\u30bf\u30fc\n\n\n\nuken/fluent-plugin-elasticsearch\n\nfluentd\u304b\u3089elasticsearch\u306b\u6d41\u3057\u3053\u3081\u308b\n\n\n\ny-ken/fluent-plugin-geoip \n\nIP\u304b\u3089\u5730\u7406\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3059\u3054\u3044\u3084\u3064\n\n\n\nrepeatedly/fluent-plugin-multi-format-parser\n\n\u8907\u6570\u306e\u30d1\u30fc\u30b5\u30fc\u3092\u9806\u756a\u306b\u8a66\u3057\u3066\u304f\u308c\u308b\u30d1\u30fc\u30b5\u30fc\n\n\n\u901a\u5e38\u3060\u3068\u30d1\u30fc\u30b5\u30fc\u306f\u4e00\u3064\u3057\u304b\u6307\u5b9a\u3067\u304d\u306a\u3044\n\n\n\n\n\ntagomoris/fluent-plugin-parser\n\n\n<source>\u3058\u3083\u306a\u304f\u3066<match>\u306e\u4e2d\u3067\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3084\u3064\n\n\n\nhiraro/fluent-plugin-with-extra-fields-parser\n\n\u30d1\u30fc\u30b9\u3057\u305f\u5185\u5bb9\u3068\u306f\u5225\u306b\u3001\u6307\u5b9a\u3057\u305f\u4f59\u8a08\u306a\u30d5\u30a3\u30fc\u30eb\u30c9\u3092record\u306b\u3076\u3063\u8fbc\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30fc\u30b5\u30fc\n\u3044\u3044\u611f\u3058\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u4f5c\u3063\u305f\n\n\n\n\nfluentd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\nRTX1100\u304b\u3089\u6d41\u308c\u3066\u304d\u305fsyslog\u3092\u6b63\u898f\u8868\u73fe\u3067\u30de\u30c3\u30c1\u3055\u305b\u3066\u5206\u89e3\n\n\n\u30de\u30c3\u30c1\u3057\u306a\u304b\u3063\u305f\u305d\u308c\u4ee5\u5916\u306e\u5f62\u5f0f\u306e\u30ed\u30b0\u306f\u3001\u5206\u89e3\u3057\u306a\u3044\n\n\n\u30ed\u30b0\u306e\u7a2e\u985e\u3054\u3068\u306b(elasticsearch\u306e)index\u3092\u5206\u3051\u3066\u683c\u7d0d\n\n# \u52d5\u7684\u30d5\u30a3\u30eb\u30bf => index: rtx1100-inspect\n- [INSPECT] PP[01][out][105] TCP xxx.xxx.xxx.xxx:xxxxx > yyy.yyy.yyy.yyy:yyyyy (yyyy/MM/dd hh:mm:ss)\n\n# \u30d5\u30a3\u30eb\u30bf\u30ea\u30b8\u30a7\u30af\u30c8 => index: rtx1100-reject\n# \u30ea\u30b8\u30a7\u30af\u30c8\u7cfb\u3060\u3051\u306ffluent-plugin-geoip\u3067\u767a\u4fe1\u6e90\u306e\u5730\u7406\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n- PP[01] Rejected at IN(xxxx) filter: TCP xxx.xxx.xxx.xxx:xxxxx > yyy.yyy.yyy.yyy:yyyyy\n\n# \u30b3\u30f3\u30bd\u30fc\u30eb\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8 => index: rtx1100-console\n- Login succeeded for TELNET: xxx.xxx.xxx.xxx\n- Logout from TELNET: xxx.xxx.xxx.xxx\n\n# VPN\u63a5\u7d9a/\u5207\u65ad => index: rtx1100-tunnel\n- [L2TP] TUNNEL[1] connected from xxx.xxx.xxx.xxx\n- [L2TP] TUNNEL[1] disconnect tunnel xxxxx complete\n\n# \u305d\u306e\u4ed6 => rtx1100-other\n\n# /etc/td-agent/td-agent.conf\n\n####\n## Source descriptions:\n##\n\n## syslog\n<source>\n  type syslog\n  tag raw.rtx1100\n  format none\n</source>\n\n####\n## Output descriptions:\n##\n\n<match raw.rtx1100.**>\n  type parser\n  format multi_format\n  key_name message\n  remove_prefix raw\n  add_prefix parsed\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[INSPECT\\]\\s+(?<target>.+)\\[(?<direction>.+)\\]\\[(?<filter_num>\\d+)\\]\\s+(?<proto>.+)\\s+(?<src_ip>.+):(?<src_port>.+)\\s+>\\s+(?<dest_ip>.+):(?<dest_port>.+)\\s+\\((?<time>.+)\\)$/\n      time_format '%Y/%m/%d %H:%M:%S'\n      extra_fields { \"log_type\": \"inspect\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^(?<target>.+)\\s+Rejected\\s+at\\s+(?<direction>.+)\\((?<filter_num>\\d+)\\)\\s+filter:\\s+(?<proto>.+)\\s+(?<src_ip>.+):(?<src_port>.+)\\s+>\\s+(?<dest_ip>.+):(?<dest_port>.+)$/ \n      extra_fields { \"log_type\": \"reject\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^Logout\\s+from\\s+(?<proto>.+):\\s+(?<ip>.+)$/\n      extra_fields { \"log_type\": \"console_logout\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^Login\\s+succeeded\\s+for\\s+(?<proto>.+):\\s+(?<ip>.+)$/ \n      extra_fields { \"log_type\": \"console_login\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[(?<proto>.+)\\]\\s+(?<tunnel>.+)\\s+connected\\s+from\\s+(?<src_ip>.+)$/ \n      extra_fields { \"log_type\": \"tunnel_connect\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[(?<proto>.+)\\]\\s+(?<tunnel>.+)\\s+disconnect\\s+tunnel\\s+\\d+\\s+complete$/ \n      extra_fields { \"log_type\": \"tunnel_disconnect\" }\n  </pattern>  \n  <pattern>\n      format with_extra_fields\n      base_format /^(?<msg>.+)$/\n      extra_fields { \"log_type\": \"other\" }\n  </pattern>  \n</match>\n\n<match parsed.rtx1100.**>\n  type rewrite_tag_filter\n  rewriterule1 log_type   ^inspect$       rtx1100.inspect\n  rewriterule2 log_type   ^reject$        temp.rtx1100.reject\n  rewriterule3 log_type   ^console_(.+)$  rtx1100.console.$1\n  rewriterule4 log_type   ^tunnel_(.+)$   rtx1100.tunnel.$1\n  rewriterule5 log_type   ^other$         rtx1100.other\n</match>\n\n<match rtx1100.inspect.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-inspect\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match temp.rtx1100.reject.**>\n  type  geoip\n  geoip_lookup_key src_ip\n  <record>\n    geo_location  '{ \"lat\" : ${latitude[\"src_ip\"]}, \"lon\" : ${longitude[\"src_ip\"]} }'\n    country_code  ${country_code[\"src_ip\"]}\n  </record>\n  remove_tag_prefix temp.\n  skip_adding_null_record  true\n  flush_interval 1s\n</match>\n<match rtx1100.reject.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-reject\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.console.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-console\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.tunnel.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-tunnel\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.other.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-other\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n\n\n\u53c2\u8003\u6587\u732e\n\n\u4eca\u65e5\u304b\u3089\u59cb\u3081\u308bfluentd \u00d7 Elasticsearch \u00d7 kibana - \u30ab\u30b8\u30e5\u30a2\u30eb\u306a\u89e3\u6790\u30fb\u9ad8\u901f\u5316 - \u682a\u5f0f\u4f1a\u793e\u30a8\u30a6\u30ec\u30ab\nFluentd\u3001ElasticSearch\u3001Kibana4\u306b\u3088\u308b\u30ed\u30b0\u5206\u6790\u74b0\u5883\u306e\u69cb\u7bc9 | hrendoh's memo\nKibana+Elasticsearch\u3067\u6587\u5b57\u5217\u306e\u5b8c\u5168\u4e00\u81f4\u3068\u90e8\u5206\u4e00\u81f4\u691c\u7d22\u306e\u4e21\u65b9\u3092\u5b9f\u73fe\u3059\u308b - Qiita\n\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3067Elasticsearch+kibana(fluentd)\u3067\u30ed\u30b0\u53ef\u8996\u5316\u904b\u7528\u3092\u3057\u3066\u307f\u3066\u308f\u304b\u3063\u305f\u4e8b - shnagai\u306e\u30a4\u30f3\u30d5\u30e9\u5099\u5fd8\u9332\n\n\n# \u6982\u8981\n\nfluentd + elasticsearch + kibana\u3092\u7528\u3044\u3066\u3001\u30eb\u30fc\u30bf\u30fc\u306e\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u3067\u843d\u3068\u3057\u305fIP\u306e\u30ed\u30b0\u306a\u3069\u3092\u53ef\u8996\u5316\u3057\u3066\u307f\u305f\u3002\nfluentd\u306e\u30d7\u30e9\u30b0\u30a4\u30f3(fluent-plugin-geoip)\u3092\u4f7f\u3063\u3066IP\u304b\u3089\u4f4d\u7f6e\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u305f\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/6379/4e8b5c38-3360-b1ab-4d04-ccd9ea21174f.png)\n\n\n![\u8cbc\u308a\u4ed8\u3051\u305f\u753b\u50cf_2016_02_25_2_35.jpg](https://qiita-image-store.s3.amazonaws.com/0/6379/c1104955-e053-5e37-3db2-0e128406bb1c.jpeg \"\u8cbc\u308a\u4ed8\u3051\u305f\u753b\u50cf_2016_02_25_2_35.jpg\")\n\n\n\n# \u8a2d\u5b9a\n\n## \u524d\u63d0\u6761\u4ef6\n\n- \u30eb\u30fc\u30bf\uff08RTX1100\uff09IP: 192.168.1.1\n- \u30b5\u30fc\u30d0\n\t- OS: Ubuntu 14.04.3 LTS Trusty\n\t- IP: 192.168.1.100\n\t- kibana, fluentd, elasticsearch\u3092\u52d5\u304b\u3059\n\t- LAN\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u306e\u307f\u60f3\u5b9a\u6545\u3001\u30b5\u30fc\u30d0\u306eFW\u306f\u30ac\u30e9\u7a7a\u304d\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u516c\u5f0f\u624b\u9806\u53c2\u8003\n\n- [fluentd](http://docs.fluentd.org/articles/install-by-deb)\n- [elasticsearch](https://www.elastic.co/downloads/elasticsearch)\n- [kibana](https://www.elastic.co/downloads/kibana)\n\t- \u305f\u3060\u3057\u3001OS\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u8d77\u52d5\u3055\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001init.d\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3069\u3063\u304b\u304b\u3089\u62fe\u3063\u3066\u304f\u308b\u5fc5\u8981\u304c\u3042\u308b\n\t\t- [Kibana Beta init script](https://github.com/pbamba/kibana-beta-daemon)\n\t\t- [kibana4_init](https://github.com/akabdog/scripts/blob/master/kibana4_init)\n\n\n## Apache2\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u8a2d\u5b9a\nelasticsearch\u3068kibana\u3092\u8d77\u52d5\u3059\u308b\u3068\u3001\u305d\u308c\u305e\u308c5601\u756a\u30689200\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u3061\u53d7\u3051\u308b\u306e\u3067\u3001\u4fbf\u5b9c\u4e0a\u3001\u9069\u5f53\u306b\u30ea\u30d0\u30d7\u30ed\u8a2d\u5b9a\u3002\n\n```\n<Location /kibana>\n        Require ip 127 192.168.1\n        ProxyPass http://localhost:5601\n        ProxyPassReverse http://localhost:5601\n</Location>\n\n<Location /elasticsearch>\n        Require ip 127 192.168.1\n        ProxyPass http://localhost:9200\n        ProxyPassReverse http://localhost:9200\n</Location>\n```\n\n## RTX1100\u30b3\u30f3\u30d5\u30a3\u30b0\u5909\u66f4\n\n\u30b5\u30fc\u30d0\u306b\u30eb\u30fc\u30bf\u306esyslog\u3092\u3076\u3063\u98db\u3070\u3059\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n```\n#\n# SYSLOG configuration\n#\nsyslog local address 192.168.1.1\nsyslog host 192.168.1.100\nsyslog info on\nsyslog notice on\n```\n\n## elasticsearch\u8a2d\u5b9a\n\nelasticsearch\u304c\u81ea\u52d5\u7684\u306b\u6587\u5b57\u5217\u3092\u8981\u7d20\u89e3\u6790\u3059\u308b\u3089\u3057\u304f\u3001\nkibana\u3067\u53ef\u8996\u5316\u3059\u308b\u969b\u306b\u300cnot analyzed\u306b\u3057\u306a\u3044\u3068\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u60aa\u304f\u306a\u308b\u305c\u300d\u3068\u304b\u4ef0\u308b\u306e\u3067\u3001not analyzed\u306afield\u3082\u7528\u610f\u3059\u308b\u3002\n\u3042\u3068\u3001\u5730\u7406\u60c5\u5831\u3092\u5165\u308c\u308b\u30d5\u30a3\u30fc\u30eb\u30c9(```geo_location```)\u306e\u578b\u3092```geo_point ```\u306b\u3057\u3066\u304a\u304f\u3002\n\n\n```\n$ curl -XPUT 192.168.1.100:9200/rtx1100-*/ -d \"`cat elasticsearch_default_template.json`\"\n\n# lasticsearch_default_template.json\n{\n    \"template\": \"rtx1100-*\",\n    \"mappings\": {\n        \"_default_\": {\n            \"dynamic_templates\": [\n                {\n                    \"string_template\" : {\n                        \"match\" : \"*\",\n                        \"mapping\": {\n                            \"type\": \"string\",\n                            \"fields\": {\n                                \"full\": {\n                                    \"type\": \"string\",\n                                    \"index\": \"not_analyzed\"\n                                }\n                            }\n                        },\n                        \"match_mapping_type\": \"string\"\n                    }\n                }\n            ],\n            \"properties\": {\n                \"@timestamp\": { \"type\": \"date\", \"index\": \"not_analyzed\" },\n                \"geo_location\": {\"type\" : \"geo_point\" }\n            }\n        }\n    }\n}\n\n```\n\n\n## fluentd\u8a2d\u5b9a\n### fluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4ee5\u4e0b\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u7528\u3002\n\n- [fluent/fluent-plugin-rewrite-tag-filter](https://github.com/fluent/fluent-plugin-rewrite-tag-filter)\n\t- record\u5185\u306efield\u3092\u7528\u3044\u3066tag\u3092\u66f8\u304d\u63db\u3048\u3089\u308c\u305f\u308a\u3067\u304d\u308b\u30d5\u30a3\u30eb\u30bf\u30fc\n- [uken/fluent-plugin-elasticsearch](https://github.com/uken/fluent-plugin-elasticsearch)\n\t- fluentd\u304b\u3089elasticsearch\u306b\u6d41\u3057\u3053\u3081\u308b\n- [y-ken/fluent-plugin-geoip ](https://github.com/y-ken/fluent-plugin-geoip)\n\t- IP\u304b\u3089\u5730\u7406\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3059\u3054\u3044\u3084\u3064\n- [repeatedly/fluent-plugin-multi-format-parser](https://github.com/repeatedly/fluent-plugin-multi-format-parser)\n\t- \u8907\u6570\u306e\u30d1\u30fc\u30b5\u30fc\u3092\u9806\u756a\u306b\u8a66\u3057\u3066\u304f\u308c\u308b\u30d1\u30fc\u30b5\u30fc\n\t\t- \u901a\u5e38\u3060\u3068\u30d1\u30fc\u30b5\u30fc\u306f\u4e00\u3064\u3057\u304b\u6307\u5b9a\u3067\u304d\u306a\u3044\n- [tagomoris/fluent-plugin-parser](https://github.com/tagomoris/fluent-plugin-parser)\n\t- ```<source>```\u3058\u3083\u306a\u304f\u3066```<match>```\u306e\u4e2d\u3067\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3084\u3064\n- [hiraro/fluent-plugin-with-extra-fields-parser](https://github.com/hiraro/fluent-plugin-with-extra-fields-parser) \n\t- \u30d1\u30fc\u30b9\u3057\u305f\u5185\u5bb9\u3068\u306f\u5225\u306b\u3001\u6307\u5b9a\u3057\u305f\u4f59\u8a08\u306a\u30d5\u30a3\u30fc\u30eb\u30c9\u3092record\u306b\u3076\u3063\u8fbc\u3081\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30fc\u30b5\u30fc\n\t- \u3044\u3044\u611f\u3058\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u4f5c\u3063\u305f\n\n\n### fluentd\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb \n\n- RTX1100\u304b\u3089\u6d41\u308c\u3066\u304d\u305fsyslog\u3092\u6b63\u898f\u8868\u73fe\u3067\u30de\u30c3\u30c1\u3055\u305b\u3066\u5206\u89e3\n\t- \u30de\u30c3\u30c1\u3057\u306a\u304b\u3063\u305f\u305d\u308c\u4ee5\u5916\u306e\u5f62\u5f0f\u306e\u30ed\u30b0\u306f\u3001\u5206\u89e3\u3057\u306a\u3044\n- \u30ed\u30b0\u306e\u7a2e\u985e\u3054\u3068\u306b(elasticsearch\u306e)index\u3092\u5206\u3051\u3066\u683c\u7d0d\n\n\n```\n# \u52d5\u7684\u30d5\u30a3\u30eb\u30bf => index: rtx1100-inspect\n- [INSPECT] PP[01][out][105] TCP xxx.xxx.xxx.xxx:xxxxx > yyy.yyy.yyy.yyy:yyyyy (yyyy/MM/dd hh:mm:ss)\n\n# \u30d5\u30a3\u30eb\u30bf\u30ea\u30b8\u30a7\u30af\u30c8 => index: rtx1100-reject\n# \u30ea\u30b8\u30a7\u30af\u30c8\u7cfb\u3060\u3051\u306ffluent-plugin-geoip\u3067\u767a\u4fe1\u6e90\u306e\u5730\u7406\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\n- PP[01] Rejected at IN(xxxx) filter: TCP xxx.xxx.xxx.xxx:xxxxx > yyy.yyy.yyy.yyy:yyyyy\n\n# \u30b3\u30f3\u30bd\u30fc\u30eb\u30ed\u30b0\u30a4\u30f3/\u30ed\u30b0\u30a2\u30a6\u30c8 => index: rtx1100-console\n- Login succeeded for TELNET: xxx.xxx.xxx.xxx\n- Logout from TELNET: xxx.xxx.xxx.xxx\n\n# VPN\u63a5\u7d9a/\u5207\u65ad => index: rtx1100-tunnel\n- [L2TP] TUNNEL[1] connected from xxx.xxx.xxx.xxx\n- [L2TP] TUNNEL[1] disconnect tunnel xxxxx complete\n\n# \u305d\u306e\u4ed6 => rtx1100-other\n```\n\n```\n# /etc/td-agent/td-agent.conf\n\n####\n## Source descriptions:\n##\n\n## syslog\n<source>\n  type syslog\n  tag raw.rtx1100\n  format none\n</source>\n\n####\n## Output descriptions:\n##\n\n<match raw.rtx1100.**>\n  type parser\n  format multi_format\n  key_name message\n  remove_prefix raw\n  add_prefix parsed\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[INSPECT\\]\\s+(?<target>.+)\\[(?<direction>.+)\\]\\[(?<filter_num>\\d+)\\]\\s+(?<proto>.+)\\s+(?<src_ip>.+):(?<src_port>.+)\\s+>\\s+(?<dest_ip>.+):(?<dest_port>.+)\\s+\\((?<time>.+)\\)$/\n      time_format '%Y/%m/%d %H:%M:%S'\n      extra_fields { \"log_type\": \"inspect\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^(?<target>.+)\\s+Rejected\\s+at\\s+(?<direction>.+)\\((?<filter_num>\\d+)\\)\\s+filter:\\s+(?<proto>.+)\\s+(?<src_ip>.+):(?<src_port>.+)\\s+>\\s+(?<dest_ip>.+):(?<dest_port>.+)$/ \n      extra_fields { \"log_type\": \"reject\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^Logout\\s+from\\s+(?<proto>.+):\\s+(?<ip>.+)$/\n      extra_fields { \"log_type\": \"console_logout\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^Login\\s+succeeded\\s+for\\s+(?<proto>.+):\\s+(?<ip>.+)$/ \n      extra_fields { \"log_type\": \"console_login\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[(?<proto>.+)\\]\\s+(?<tunnel>.+)\\s+connected\\s+from\\s+(?<src_ip>.+)$/ \n      extra_fields { \"log_type\": \"tunnel_connect\" }\n  </pattern>\n  <pattern>\n      format with_extra_fields\n      base_format /^\\[(?<proto>.+)\\]\\s+(?<tunnel>.+)\\s+disconnect\\s+tunnel\\s+\\d+\\s+complete$/ \n      extra_fields { \"log_type\": \"tunnel_disconnect\" }\n  </pattern>  \n  <pattern>\n      format with_extra_fields\n      base_format /^(?<msg>.+)$/\n      extra_fields { \"log_type\": \"other\" }\n  </pattern>  \n</match>\n\n<match parsed.rtx1100.**>\n  type rewrite_tag_filter\n  rewriterule1 log_type   ^inspect$       rtx1100.inspect\n  rewriterule2 log_type   ^reject$        temp.rtx1100.reject\n  rewriterule3 log_type   ^console_(.+)$  rtx1100.console.$1\n  rewriterule4 log_type   ^tunnel_(.+)$   rtx1100.tunnel.$1\n  rewriterule5 log_type   ^other$         rtx1100.other\n</match>\n\n<match rtx1100.inspect.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-inspect\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match temp.rtx1100.reject.**>\n  type  geoip\n  geoip_lookup_key src_ip\n  <record>\n    geo_location  '{ \"lat\" : ${latitude[\"src_ip\"]}, \"lon\" : ${longitude[\"src_ip\"]} }'\n    country_code  ${country_code[\"src_ip\"]}\n  </record>\n  remove_tag_prefix temp.\n  skip_adding_null_record  true\n  flush_interval 1s\n</match>\n<match rtx1100.reject.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-reject\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.console.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-console\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.tunnel.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-tunnel\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n<match rtx1100.other.**>\n  type elasticsearch\n  logstash_format true\n  logstash_prefix rtx1100-other\n  include_tag_key true\n  tag_key @log_name\n  hosts localhost:9200\n  buffer_type memory\n  num_threads 1\n  flush_interval 60\n  retry_wait 1.0\n  retry_limit 17\n</match>\n\n```\n\n\n\n\n# \u53c2\u8003\u6587\u732e\n\n- [\u4eca\u65e5\u304b\u3089\u59cb\u3081\u308bfluentd \u00d7 Elasticsearch \u00d7 kibana - \u30ab\u30b8\u30e5\u30a2\u30eb\u306a\u89e3\u6790\u30fb\u9ad8\u901f\u5316 - \u682a\u5f0f\u4f1a\u793e\u30a8\u30a6\u30ec\u30ab](http://eure.jp/blog/fluentd_elasticsearch_kibana/)\n- [Fluentd\u3001ElasticSearch\u3001Kibana4\u306b\u3088\u308b\u30ed\u30b0\u5206\u6790\u74b0\u5883\u306e\u69cb\u7bc9 | hrendoh's memo](http://blog.hrendoh.com/how-to-install-fluentd-elasticsearch-and-kibana4/)\n- [Kibana+Elasticsearch\u3067\u6587\u5b57\u5217\u306e\u5b8c\u5168\u4e00\u81f4\u3068\u90e8\u5206\u4e00\u81f4\u691c\u7d22\u306e\u4e21\u65b9\u3092\u5b9f\u73fe\u3059\u308b - Qiita](http://qiita.com/harukasan/items/4ec517d8d96f557367e1)\n- [\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3067Elasticsearch+kibana(fluentd)\u3067\u30ed\u30b0\u53ef\u8996\u5316\u904b\u7528\u3092\u3057\u3066\u307f\u3066\u308f\u304b\u3063\u305f\u4e8b - shnagai\u306e\u30a4\u30f3\u30d5\u30e9\u5099\u5fd8\u9332](http://kobitosan.hatenablog.com/entry/2014/12/22/131306)\n", "tags": ["fluentd", "Elasticsearch", "kibana", "RTX1100"]}