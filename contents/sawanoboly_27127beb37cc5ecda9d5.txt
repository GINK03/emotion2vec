{"tags": ["CloudWatch", "ECS", "AWS"], "context": " More than 1 year has passed since last update.\u6700\u8fd1\u3001Amazon ECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b \n\nECS now supports Docker 1.9 ...\n\n\u3063\u3066\u51fa\u307e\u3059\u3002\nDocker\u306f1.9\u3067log-driver\u306bAWS\u306eCloudWatch Logs\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u305f\u3060ECS\u306f1.7\u7cfb\u3060\u3063\u305f\u306e\u3067\u3001\u3057\u3070\u3089\u304f\u6b21\u306e\u3088\u3046\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u9006\u8ee2\u73fe\u8c61\u3067\u4f7f\u3063\u3066\u3044\u305f\u3093\u3067\u3059\u3002\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9(\u7b49)\u306b\u304a\u3044\u3066\u3042\u308bDocker-Machine: Docker\u306elog-driver\u3067awslogs\u6307\u5b9a\u3002\n\n\n=> CloudWatch Logs\u3068\u306e\u9023\u643a\u697d\u3061\u3093\n\n\nAmazon ECS\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9: syslog\u7d4c\u7531\u3067logs\u30b3\u30f3\u30c6\u30ca\u304b\u3089awslogs\u3078\u3002\n\n\n=> \u9023\u643a\u304c\u306a\u3093\u304b\u3081\u3093\u3069\u3063\u3061\u3044\n\n\n\n\u30d9\u30fc\u30b9AMI\u306eDocker1.9\u3078\u306e\u66f4\u65b0\u3067\u3001\u5c02\u7528\u306elogs\u30b3\u30f3\u30c6\u30ca\u3082\u3046\u3044\u3089\u306a\u304f\u306a\u3063\u305f\u306f\u305a\u3060\u3068\u601d\u3046\u306e\u3067\u5c11\u3057\u8abf\u3079\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\nECS\u3067\u4f7f\u308f\u308c\u308bAMI\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\nECS\u7528\u306eAMI\u306f\u30de\u30fc\u30b1\u30c3\u30c8\u30d7\u30ec\u30a4\u30b9\u306b\u3044\u308b\u306e\u3067\u3001\u9078\u3093\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u3064\u3044\u3067\u306b\u6b21\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305fInstance Role\u3067\u884c\u304d\u307e\u3057\u3087\u3046\u3002\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3001\u53d6\u308a\u6025\u304e\u9001\u4fe1\u306e\u78ba\u8a8d\n$ yum -y install awscli awslogs\n\n...\n\nComplete!\n\nlog_group\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u3042\u305f\u308a\u3092\u7de8\u96c6\u3057\u3066\u3001\n# service awslogs start\nStarting awslogs:                                          [  OK  ]\n\n# logger -p local1.info LOGGER\n\n\u3061\u3087\u3044\u9023\u6253\u3057\u3066\u3057\u307e\u3063\u305f\u3002\n\n\u307e\u305a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u306b\u306f\u554f\u984c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\nDocker\u30c7\u30fc\u30e2\u30f3\u304b\u3089\u76f4\u63a5CloudWatch Logs\u3078\nDocker\u3068CloudWatch Logs\u306e\u9023\u643a\u3001(AWS\u5916\u304b\u3089\u9001\u4fe1\u3059\u308b\u5834\u5408)\u901a\u5e38\u306f/etc/(sysconfig|default)/docker\u306a\u3069\u306b\u74b0\u5883\u8a2d\u5b9a\u3001AWS\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306a\u3069\u3092\u7f6e\u3044\u3066\u304b\u3089Docker\u30c7\u30fc\u30e2\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u4ed5\u8fbc\u307f\u304c\u5fc5\u8981\u3060\u3002\n\u4eca\u56de\u306f\u305d\u306e\u6bb5\u53d6\u308a\u3092\u307e\u308b\u3063\u3068\u7121\u8996\u3057\u3066\u304a\u3082\u3080\u308d\u306blog-driver\u6307\u5b9a\u306edocker run\u3057\u3066\u307f\u308b\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u304c\u4f7f\u308f\u308c\u308b\u306a\u3089\u3053\u308c\u3067\u3044\u3044\u306f\u305a\u3002\n\u3056\u3063\u304f\u308aDockerfile\u3092\u4f5c\u3063\u3066\u30d3\u30eb\u30c9\u3002\nFROM ubuntu\n\nRUN apt-get -y update && apt-get install -y nginx\n\nCMD ['/bin/bash']\n\n\u305d\u306e\u5f8c\u3001log-driver,log-opt\u3067\u30b0\u30eb\u30fc\u30d7\u7b49\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u308f\u305f\u3057\u3066run\u3002\n$ sudo docker run -it --rm --log-driver=awslogs --log-opt awslogs-region=ap-northeast-1 --log-opt awslogs-group=ecs-test --log-opt awslogs-stream=ecs nginx nginx -V\n\n## \u4ee5\u4e0b\u51fa\u529b\n\nnginx version: nginx/1.4.6 (Ubuntu)\nbuilt by gcc 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04) \nTLS SNI support enabled\nconfigure arguments: --with-cc-opt='-g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_spdy_module --with-http_sub_module --with-http_xslt_module --with-mail --with-mail_ssl_module\n\n\u2193\u304a\u3001\u30a4\u30b1\u308b\u3058\u3083\u306a\u3044\u306e\u3002\n\n\n\u7d50\u8ad6\nAmazon ECS\u3067\u3082(log-driver=awslogs\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6e21\u308a\u3055\u3048\u3059\u308c\u3070)Logs\u9023\u643a\u304c\u3044\u3051\u308b\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u3067OK\u3002\n\n\u6700\u8fd1\u3001Amazon ECS\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b \n\n> ECS now supports Docker 1.9 ...\n\n\u3063\u3066\u51fa\u307e\u3059\u3002\n\nDocker\u306f1.9\u3067log-driver\u306bAWS\u306e[CloudWatch Logs](https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/DeveloperGuide/CWL_GettingStarted.html)\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\n\u305f\u3060ECS\u306f1.7\u7cfb\u3060\u3063\u305f\u306e\u3067\u3001\u3057\u3070\u3089\u304f\u6b21\u306e\u3088\u3046\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u9006\u8ee2\u73fe\u8c61\u3067\u4f7f\u3063\u3066\u3044\u305f\u3093\u3067\u3059\u3002\n\n\n- \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9(\u7b49)\u306b\u304a\u3044\u3066\u3042\u308bDocker-Machine: Docker\u306elog-driver\u3067awslogs\u6307\u5b9a\u3002\n    - => CloudWatch Logs\u3068\u306e\u9023\u643a\u697d\u3061\u3093\n- Amazon ECS\u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9: syslog\u7d4c\u7531\u3067logs\u30b3\u30f3\u30c6\u30ca\u304b\u3089awslogs\u3078\u3002\n    - => \u9023\u643a\u304c\u306a\u3093\u304b\u3081\u3093\u3069\u3063\u3061\u3044\n\n\n\u30d9\u30fc\u30b9AMI\u306eDocker1.9\u3078\u306e\u66f4\u65b0\u3067\u3001\u5c02\u7528\u306elogs\u30b3\u30f3\u30c6\u30ca\u3082\u3046\u3044\u3089\u306a\u304f\u306a\u3063\u305f\u306f\u305a\u3060\u3068\u601d\u3046\u306e\u3067\u5c11\u3057\u8abf\u3079\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\n\n## ECS\u3067\u4f7f\u308f\u308c\u308bAMI\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\n\nECS\u7528\u306eAMI\u306f\u30de\u30fc\u30b1\u30c3\u30c8\u30d7\u30ec\u30a4\u30b9\u306b\u3044\u308b\u306e\u3067\u3001\u9078\u3093\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n![EC2_Management_Console.jpg](https://qiita-image-store.s3.amazonaws.com/0/7454/484e4ed8-e356-34d4-d33d-243d9c005ac7.jpeg \"EC2_Management_Console.jpg\")\n\n\u3064\u3044\u3067\u306b\u6b21\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305fInstance Role\u3067\u884c\u304d\u307e\u3057\u3087\u3046\u3002\n\n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n\n## EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3001\u53d6\u308a\u6025\u304e\u9001\u4fe1\u306e\u78ba\u8a8d\n\n```\n$ yum -y install awscli awslogs\n\n...\n\nComplete!\n```\n\nlog_group\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u3042\u305f\u308a\u3092\u7de8\u96c6\u3057\u3066\u3001\n\n```\n# service awslogs start\nStarting awslogs:                                          [  OK  ]\n```\n\n```\n# logger -p local1.info LOGGER\n```\n\n\u3061\u3087\u3044\u9023\u6253\u3057\u3066\u3057\u307e\u3063\u305f\u3002\n\n![CloudWatch_Management_Console.jpg](https://qiita-image-store.s3.amazonaws.com/0/7454/1b627b6a-7741-41cd-a969-06a7ec4a3515.jpeg \"CloudWatch_Management_Console.jpg\")\n\n\u307e\u305a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u306b\u306f\u554f\u984c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\n## Docker\u30c7\u30fc\u30e2\u30f3\u304b\u3089\u76f4\u63a5CloudWatch Logs\u3078\n\nDocker\u3068CloudWatch Logs\u306e\u9023\u643a\u3001(AWS\u5916\u304b\u3089\u9001\u4fe1\u3059\u308b\u5834\u5408)\u901a\u5e38\u306f`/etc/(sysconfig|default)/docker`\u306a\u3069\u306b\u74b0\u5883\u8a2d\u5b9a\u3001AWS\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306a\u3069\u3092\u7f6e\u3044\u3066\u304b\u3089Docker\u30c7\u30fc\u30e2\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u4ed5\u8fbc\u307f\u304c\u5fc5\u8981\u3060\u3002\n\n\u4eca\u56de\u306f\u305d\u306e\u6bb5\u53d6\u308a\u3092\u307e\u308b\u3063\u3068\u7121\u8996\u3057\u3066\u304a\u3082\u3080\u308d\u306blog-driver\u6307\u5b9a\u306edocker run\u3057\u3066\u307f\u308b\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u304c\u4f7f\u308f\u308c\u308b\u306a\u3089\u3053\u308c\u3067\u3044\u3044\u306f\u305a\u3002\n\n\u3056\u3063\u304f\u308aDockerfile\u3092\u4f5c\u3063\u3066\u30d3\u30eb\u30c9\u3002\n\n```Dockerfile \nFROM ubuntu\n\nRUN apt-get -y update && apt-get install -y nginx\n\nCMD ['/bin/bash']\n```\n\n\u305d\u306e\u5f8c\u3001`log-driver`,`log-opt`\u3067\u30b0\u30eb\u30fc\u30d7\u7b49\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u308f\u305f\u3057\u3066run\u3002\n\n```\n$ sudo docker run -it --rm --log-driver=awslogs --log-opt awslogs-region=ap-northeast-1 --log-opt awslogs-group=ecs-test --log-opt awslogs-stream=ecs nginx nginx -V\n\n## \u4ee5\u4e0b\u51fa\u529b\n\nnginx version: nginx/1.4.6 (Ubuntu)\nbuilt by gcc 4.8.4 (Ubuntu 4.8.4-2ubuntu1~14.04) \nTLS SNI support enabled\nconfigure arguments: --with-cc-opt='-g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2' --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-debug --with-pcre-jit --with-ipv6 --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_dav_module --with-http_geoip_module --with-http_gzip_static_module --with-http_image_filter_module --with-http_spdy_module --with-http_sub_module --with-http_xslt_module --with-mail --with-mail_ssl_module\n```\n\n\u2193\u304a\u3001\u30a4\u30b1\u308b\u3058\u3083\u306a\u3044\u306e\u3002\n\n![CloudWatch_Management_Console.jpg](https://qiita-image-store.s3.amazonaws.com/0/7454/85c5b887-c13e-1cd6-ba90-5b36b9514d5f.jpeg \"CloudWatch_Management_Console.jpg\")\n\n\n## \u7d50\u8ad6\n\nAmazon ECS\u3067\u3082(log-driver=awslogs\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6e21\u308a\u3055\u3048\u3059\u308c\u3070)Logs\u9023\u643a\u304c\u3044\u3051\u308b\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ed\u30fc\u30eb\u3067OK\u3002\n"}