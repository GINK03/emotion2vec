{"tags": ["vagrant", "Berkshelf", "chef", "EC2"], "context": " More than 1 year has passed since last update.\n\n\u30b4\u30fc\u30eb\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u30b7\u30f3\u30d7\u30eb\u306bnginx\u304c\u52d5\u304fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u69cb\u7bc9\u3092\u76ee\u6307\u3059\u3002\n\nVagrant\u5b9f\u884c\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nINSTALLING VAGRANT\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u74b0\u5883\n\n\nCentOS release 6.4 (Final)\nLinux 2.6.32-358.11.1.el6.i686\n\n\n\n$ sudo yum groupinstall \"Development Tools\"\n$ sudo yum install libxml2-devel libxslt-devel\n$ sudo rpm -ivh http://files.vagrantup.com/packages/7e400d00a3c5a0fdf2809c8b5001a035415a607b/vagrant_1.2.2_x86_64.rpm\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nvagrant-aws\n\nVagrant\u3067AWS EC2\u3092\u7ba1\u7406\u30fb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5c0e\u5165\n\n\n\nvagrant-omnibus\n\nChef\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5c0e\u5165\n\u305d\u306e\u4ed6\u3001CloudInit\u3084Shell Provisioner\u3092\u4f7f\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u308b\n\n\n\nvagrant-berkshelf\n\nVagrant\u3067\u3001Cookbook\u306e\u7ba1\u7406\u30fb\u4f9d\u5b58\u89e3\u6c7a\u3092\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30ebBerkshelf\u3092\u4f7f\u3046\u305f\u3081\u306b\u5c0e\u5165\n\n\n\n$ vagrant plugin install vagrant-aws\n$ vagrant plugin install vagrant-omnibus\n$ vagrant plugin install vagrant-berkshelf\n\n\nBox\u8ffd\u52a0\nAWS EC2\u7528\u306b\u30c0\u30df\u30fc\u306eBox\u3092\u8ffd\u52a0\u3059\u308b\n$ vagrant box add dummy https://github.com/mitchellh/vagrant-aws/raw/master/dummy.box\n\n\nCookbook\u6e96\u5099\n\nBerkshelf\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ gem install berkshelf\n\n\n\u96db\u5f62\u751f\u6210\nberks\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u96db\u5f62\u3092\u751f\u6210\u3059\u308b\u3002\n$ gem install berkshelf\n$ berks init\n      create  Berksfile\n      create  Thorfile\n      create  .gitignore\n         run  git init from \".\"\n      create  Gemfile\n      create  Vagrantfile\nSuccessfully initialized\n\n\nBerksfile\u7de8\u96c6\ncookbook'nginx'\u3092\u8ffd\u52a0\u3059\u308b\u3002\necho \"cookbook 'nginx'\" >> Berksfile \n\n\nVegrantfile\u7de8\u96c6\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  config.vm.hostname = \"test-berkshelf\"\n  config.vm.box      = \"dummy\"\n\n  config.ssh.username         = \"ec2-user\"\n  config.ssh.private_key_path = ENV[\"SSH_PRIVATE_KEY_PATH\"]\n  config.ssh.max_tries        = 40\n  config.ssh.timeout          = 120\n\n  config.vm.provider :aws do |aws, override|\n    aws.access_key_id     = ENV[\"AWS_ACCESS_KEY_ID\"]\n    aws.secret_access_key = ENV[\"AWS_SECRET_ACCESS_KEY\"]\n    aws.region            = \"ap-northeast-1\"\n    aws.instance_type     = \"t1.micro\"\n    aws.ami               = \"ami-39b23d38\"\n    aws.keypair_name      = ENV[\"AWS_KEYPAIR_NAME\"]\n    aws.security_groups   = [\"sandbox\"]\n    aws.tags = {\n      'Name' => 'sandbox',\n    }\n    aws.user_data = <<-USER_DATA\n#!/bin/bash\necho 'Defaults:root !requiretty\\nDefaults:ec2-user !requiretty' > /etc/sudoers.d/999-vagrant-cloud-init-requiretty\nchmod 440 /etc/sudoers.d/999-vagrant-cloud-init-requiretty\n    USER_DATA\n  end\n\n  config.omnibus.chef_version = :latest\n\n  config.berkshelf.berksfile_path = \"./Berksfile\"\n  config.berkshelf.enabled        = true\n\n  config.vm.provision :chef_solo do |chef|\n    chef.run_list = [\n      \"recipe[nginx]\"\n    ]\n  end\nend\n\n\n\nVagrant\u5b9f\u884c\n$ vagrant up --provider=aws\nBringing machine 'default' up with 'aws' provider...\n[Berkshelf] This version of the Berkshelf plugin has not been fully tested on this version of Vagrant.\n[Berkshelf] You should check for a newer version of vagrant-berkshelf.\n[Berkshelf] If you encounter any errors with this version, please report them at https://github.com/RiotGames/vagrant-berkshelf/issues\n[Berkshelf] You can also join the discussion in #berkshelf on Freenode.\n[Berkshelf] Updating Vagrant's berkshelf: '/home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default'\n[Berkshelf] Using nginx (1.7.0)\n[Berkshelf] Using build-essential (1.4.0)\n[Berkshelf] Using yum (2.3.0)\n[Berkshelf] Using apt (2.0.0)\n[Berkshelf] Using runit (1.1.6)\n[Berkshelf] Using ohai (1.1.10)\n[default] Warning! The AWS provider doesn't support any of the Vagrant\nhigh-level network configurations (`config.vm.network`). They\nwill be silently ignored.\n[default] Launching an instance with the following settings...\n[default]  -- Type: t1.micro\n[default]  -- AMI: ami-39b23d38\n[default]  -- Region: ap-northeast-1\n[default]  -- Keypair: vagrant\n[default]  -- Security Groups: [\"sandbox\"]\n[default] Waiting for instance to become \"ready\"...\n[default] Waiting for SSH to become available...\n[default] Machine is booted and ready for use!\n[default] Rsyncing folder: /home/vagrant/vagrant/sandbox/ => /vagrant\nThe following SSH command responded with a non-zero exit status.\nVagrant assumes that this means the command failed!\n\nmkdir -p '/vagrant'\n\nCloudInit\u3092\u4f7f\u3063\u3066requiretty\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u308b\u304c\u3001CloudInit\u5b9f\u884c\u5b8c\u4e86\u3092\u5f85\u305f\u306a\u3044\u305f\u3081\u5931\u6557\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3002\u6210\u529f\u3059\u308b\u3068\u304d\u3082\u3042\u308b\u3002\nrequiretty\u89e3\u6c7a\u6e08\u307f\u306eAMI\u3092\u4e8b\u524d\u4f5c\u6210\u3057\u3066\u305d\u308c\u3092\u4f7f\u3048\u3070\u3088\u3055\u305d\u3046\u3060\u304c\u3001provision\u518d\u5b9f\u884c\u3067\u89e3\u6c7a\u3059\u308b\u306e\u3067\u4fdd\u7559\u3002\n$ vagrant provision\n[Berkshelf] This version of the Berkshelf plugin has not been fully tested on this version of Vagrant.\n[Berkshelf] You should check for a newer version of vagrant-berkshelf.\n[Berkshelf] If you encounter any errors with this version, please report them at https://github.com/RiotGames/vagrant-berkshelf/issues\n[Berkshelf] You can also join the discussion in #berkshelf on Freenode.\n[Berkshelf] Updating Vagrant's berkshelf: '/home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default'\n[Berkshelf] Using nginx (1.7.0)\n[Berkshelf] Using build-essential (1.4.0)\n[Berkshelf] Using yum (2.3.0)\n[Berkshelf] Using apt (2.0.0)\n[Berkshelf] Using runit (1.1.6)\n[Berkshelf] Using ohai (1.1.10)\n[default] Rsyncing folder: /home/vagrant/vagrant/sandbox/ => /vagrant\n[default] Rsyncing folder: /home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default/ => /tmp/vagrant-chef-1/chef-solo-1/cookbooks\n[default] Installing Chef 11.4.4 Omnibus package...\n[default] Running provisioner: chef_solo...\nGenerating chef JSON and uploading...\nRunning chef-solo...\n[2013-06-23T08:10:37+00:00] INFO: *** Chef 11.4.4 ***\n[2013-06-23T08:10:39+00:00] INFO: Setting the run_list to [\"recipe[nginx]\"] from JSON\n[2013-06-23T08:10:39+00:00] INFO: Run List is [recipe[nginx]]\n[2013-06-23T08:10:39+00:00] INFO: Run List expands to [nginx]\n[2013-06-23T08:10:39+00:00] INFO: Starting Chef Run for ip-10-132-203-202.ap-northeast-1.compute.internal\n\uff08\u7565\uff09\n[2013-06-23T08:11:04+00:00] INFO: service[nginx] started\n[2013-06-23T08:11:04+00:00] INFO: template[nginx.conf] sending reload action to service[nginx] (delayed)\n[2013-06-23T08:11:04+00:00] INFO: Processing service[nginx] action reload (nginx::default line 49)\n[2013-06-23T08:11:05+00:00] INFO: service[nginx] reloaded\n[2013-06-23T08:11:05+00:00] INFO: Chef Run complete in 25.103777793 seconds\n[2013-06-23T08:11:05+00:00] INFO: Running report handlers\n[2013-06-23T08:11:05+00:00] INFO: Report handlers complete\n\n\n\u78ba\u8a8d\n$ vagrant ssh\n$ sudo /etc/init.d/nginx status\nnginx (pid  2140) \u3092\u5b9f\u884c\u4e2d...\n\n#\u30b4\u30fc\u30eb\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u30b7\u30f3\u30d7\u30eb\u306bnginx\u304c\u52d5\u304fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u69cb\u7bc9\u3092\u76ee\u6307\u3059\u3002\n\n#Vagrant\u5b9f\u884c\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n[INSTALLING VAGRANT](http://docs.vagrantup.com/v2/installation/index.html)\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* \u74b0\u5883\n * CentOS release 6.4 (Final)\n * Linux 2.6.32-358.11.1.el6.i686\n\n```bash:\n$ sudo yum groupinstall \"Development Tools\"\n$ sudo yum install libxml2-devel libxslt-devel\n$ sudo rpm -ivh http://files.vagrantup.com/packages/7e400d00a3c5a0fdf2809c8b5001a035415a607b/vagrant_1.2.2_x86_64.rpm\n```\n\n##\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* [vagrant-aws](https://github.com/mitchellh/vagrant-aws)\n * Vagrant\u3067AWS EC2\u3092\u7ba1\u7406\u30fb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5c0e\u5165\n* [vagrant-omnibus](https://github.com/schisamo/vagrant-omnibus)\n * Chef\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5c0e\u5165\n * \u305d\u306e\u4ed6\u3001[CloudInit](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AESDG-chapter-instancedata.html)\u3084[Shell Provisioner](http://docs.vagrantup.com/v2/provisioning/shell.html)\u3092\u4f7f\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u308b\n* [vagrant-berkshelf](https://github.com/riotgames/vagrant-berkshelf)\n * Vagrant\u3067\u3001Cookbook\u306e\u7ba1\u7406\u30fb\u4f9d\u5b58\u89e3\u6c7a\u3092\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb[Berkshelf](http://berkshelf.com/)\u3092\u4f7f\u3046\u305f\u3081\u306b\u5c0e\u5165\n\n```bash:\n$ vagrant plugin install vagrant-aws\n$ vagrant plugin install vagrant-omnibus\n$ vagrant plugin install vagrant-berkshelf\n```\n\n##Box\u8ffd\u52a0\nAWS EC2\u7528\u306b\u30c0\u30df\u30fc\u306eBox\u3092\u8ffd\u52a0\u3059\u308b\n\n```bash:\n$ vagrant box add dummy https://github.com/mitchellh/vagrant-aws/raw/master/dummy.box\n```\n\n#Cookbook\u6e96\u5099\n\n##Berkshelf\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash:\n$ gem install berkshelf\n```\n\n##\u96db\u5f62\u751f\u6210\nberks\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u96db\u5f62\u3092\u751f\u6210\u3059\u308b\u3002\n\n```bash:\n$ gem install berkshelf\n$ berks init\n      create  Berksfile\n      create  Thorfile\n      create  .gitignore\n         run  git init from \".\"\n      create  Gemfile\n      create  Vagrantfile\nSuccessfully initialized\n```\n\n##Berksfile\u7de8\u96c6\ncookbook'nginx'\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```bash:\necho \"cookbook 'nginx'\" >> Berksfile \n```\n\n#Vegrantfile\u7de8\u96c6\n\n```rb:Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  config.vm.hostname = \"test-berkshelf\"\n  config.vm.box      = \"dummy\"\n\n  config.ssh.username         = \"ec2-user\"\n  config.ssh.private_key_path = ENV[\"SSH_PRIVATE_KEY_PATH\"]\n  config.ssh.max_tries        = 40\n  config.ssh.timeout          = 120\n\n  config.vm.provider :aws do |aws, override|\n    aws.access_key_id     = ENV[\"AWS_ACCESS_KEY_ID\"]\n    aws.secret_access_key = ENV[\"AWS_SECRET_ACCESS_KEY\"]\n    aws.region            = \"ap-northeast-1\"\n    aws.instance_type     = \"t1.micro\"\n    aws.ami               = \"ami-39b23d38\"\n    aws.keypair_name      = ENV[\"AWS_KEYPAIR_NAME\"]\n    aws.security_groups   = [\"sandbox\"]\n    aws.tags = {\n      'Name' => 'sandbox',\n    }\n    aws.user_data = <<-USER_DATA\n#!/bin/bash\necho 'Defaults:root !requiretty\\nDefaults:ec2-user !requiretty' > /etc/sudoers.d/999-vagrant-cloud-init-requiretty\nchmod 440 /etc/sudoers.d/999-vagrant-cloud-init-requiretty\n    USER_DATA\n  end\n\n  config.omnibus.chef_version = :latest\n\n  config.berkshelf.berksfile_path = \"./Berksfile\"\n  config.berkshelf.enabled        = true\n\n  config.vm.provision :chef_solo do |chef|\n    chef.run_list = [\n      \"recipe[nginx]\"\n    ]\n  end\nend\n```\n\n#Vagrant\u5b9f\u884c\n```bash:\n$ vagrant up --provider=aws\nBringing machine 'default' up with 'aws' provider...\n[Berkshelf] This version of the Berkshelf plugin has not been fully tested on this version of Vagrant.\n[Berkshelf] You should check for a newer version of vagrant-berkshelf.\n[Berkshelf] If you encounter any errors with this version, please report them at https://github.com/RiotGames/vagrant-berkshelf/issues\n[Berkshelf] You can also join the discussion in #berkshelf on Freenode.\n[Berkshelf] Updating Vagrant's berkshelf: '/home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default'\n[Berkshelf] Using nginx (1.7.0)\n[Berkshelf] Using build-essential (1.4.0)\n[Berkshelf] Using yum (2.3.0)\n[Berkshelf] Using apt (2.0.0)\n[Berkshelf] Using runit (1.1.6)\n[Berkshelf] Using ohai (1.1.10)\n[default] Warning! The AWS provider doesn't support any of the Vagrant\nhigh-level network configurations (`config.vm.network`). They\nwill be silently ignored.\n[default] Launching an instance with the following settings...\n[default]  -- Type: t1.micro\n[default]  -- AMI: ami-39b23d38\n[default]  -- Region: ap-northeast-1\n[default]  -- Keypair: vagrant\n[default]  -- Security Groups: [\"sandbox\"]\n[default] Waiting for instance to become \"ready\"...\n[default] Waiting for SSH to become available...\n[default] Machine is booted and ready for use!\n[default] Rsyncing folder: /home/vagrant/vagrant/sandbox/ => /vagrant\nThe following SSH command responded with a non-zero exit status.\nVagrant assumes that this means the command failed!\n\nmkdir -p '/vagrant'\n```\nCloudInit\u3092\u4f7f\u3063\u3066requiretty\u306e\u89e3\u6c7a\u3092\u3057\u3066\u3044\u308b\u304c\u3001CloudInit\u5b9f\u884c\u5b8c\u4e86\u3092\u5f85\u305f\u306a\u3044\u305f\u3081\u5931\u6557\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3002\u6210\u529f\u3059\u308b\u3068\u304d\u3082\u3042\u308b\u3002\nrequiretty\u89e3\u6c7a\u6e08\u307f\u306eAMI\u3092\u4e8b\u524d\u4f5c\u6210\u3057\u3066\u305d\u308c\u3092\u4f7f\u3048\u3070\u3088\u3055\u305d\u3046\u3060\u304c\u3001provision\u518d\u5b9f\u884c\u3067\u89e3\u6c7a\u3059\u308b\u306e\u3067\u4fdd\u7559\u3002\n\n```bash:\n$ vagrant provision\n[Berkshelf] This version of the Berkshelf plugin has not been fully tested on this version of Vagrant.\n[Berkshelf] You should check for a newer version of vagrant-berkshelf.\n[Berkshelf] If you encounter any errors with this version, please report them at https://github.com/RiotGames/vagrant-berkshelf/issues\n[Berkshelf] You can also join the discussion in #berkshelf on Freenode.\n[Berkshelf] Updating Vagrant's berkshelf: '/home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default'\n[Berkshelf] Using nginx (1.7.0)\n[Berkshelf] Using build-essential (1.4.0)\n[Berkshelf] Using yum (2.3.0)\n[Berkshelf] Using apt (2.0.0)\n[Berkshelf] Using runit (1.1.6)\n[Berkshelf] Using ohai (1.1.10)\n[default] Rsyncing folder: /home/vagrant/vagrant/sandbox/ => /vagrant\n[default] Rsyncing folder: /home/vagrant/.berkshelf/default/vagrant/berkshelf-20130623-5880-pd1dya-default/ => /tmp/vagrant-chef-1/chef-solo-1/cookbooks\n[default] Installing Chef 11.4.4 Omnibus package...\n[default] Running provisioner: chef_solo...\nGenerating chef JSON and uploading...\nRunning chef-solo...\n[2013-06-23T08:10:37+00:00] INFO: *** Chef 11.4.4 ***\n[2013-06-23T08:10:39+00:00] INFO: Setting the run_list to [\"recipe[nginx]\"] from JSON\n[2013-06-23T08:10:39+00:00] INFO: Run List is [recipe[nginx]]\n[2013-06-23T08:10:39+00:00] INFO: Run List expands to [nginx]\n[2013-06-23T08:10:39+00:00] INFO: Starting Chef Run for ip-10-132-203-202.ap-northeast-1.compute.internal\n\uff08\u7565\uff09\n[2013-06-23T08:11:04+00:00] INFO: service[nginx] started\n[2013-06-23T08:11:04+00:00] INFO: template[nginx.conf] sending reload action to service[nginx] (delayed)\n[2013-06-23T08:11:04+00:00] INFO: Processing service[nginx] action reload (nginx::default line 49)\n[2013-06-23T08:11:05+00:00] INFO: service[nginx] reloaded\n[2013-06-23T08:11:05+00:00] INFO: Chef Run complete in 25.103777793 seconds\n[2013-06-23T08:11:05+00:00] INFO: Running report handlers\n[2013-06-23T08:11:05+00:00] INFO: Report handlers complete\n```\n\n##\u78ba\u8a8d\n```bash:\n$ vagrant ssh\n$ sudo /etc/init.d/nginx status\nnginx (pid  2140) \u3092\u5b9f\u884c\u4e2d...\n```"}