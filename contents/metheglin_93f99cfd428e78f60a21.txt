{"tags": ["Sensu"], "context": " More than 1 year has passed since last update.\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u306f\u767b\u5834\u4eba\u7269\u304c\u591a\u304f\u306a\u308b\u306e\u3067\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3068\u304d\u306b\u3069\u3053\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u304b\u30d1\u30c3\u3068\u898b\u308f\u304b\u308a\u3065\u3089\u3044.\n\u3069\u3046\u3044\u3046\u9023\u643a\u3067\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u304c\u52d5\u3044\u3066\u3044\u308b\u306e\u304b\u5168\u4f53\u69cb\u6210\u3092\u628a\u63e1\u3059\u308b\u3053\u3068\u3068\u3001\u30b5\u30fc\u30d3\u30b9\u5358\u4f53\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u3001\u30ed\u30b0\u306e\u898b\u65b9\u306a\u3069\u3092\u304a\u3055\u3048\u308b\u3053\u3068\u304c\u5927\u4e8b\u3068\u601d\u3046.\ncurl\u3067sensu-api\u305f\u305f\u304f\u3001jq\u3067json\u306esyntax\u30c1\u30a7\u30c3\u30af\u3059\u308b\u306a\u3069\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3082\u91cd\u8981.\n\u25a0\u30b5\u30fc\u30d3\u30b9 \u30dd\u30fc\u30c8\n\u203b\u81ea\u5206\u306e\u74b0\u5883\u306e\u60c5\u5831\u3067\u3059\n\n\n\nservice\ndefault port\n\n\n\n\nsensu-client\n3030\n\n\nsensu-api\n4567\n\n\nuchiwa\n3000\n\n\nrabbitmq-server\n5672\n\n\nredis-server\n6379\n\n\n\n\u25a0\u30ed\u30b0\n\u203b\u81ea\u5206\u306e\u74b0\u5883\u306e\u60c5\u5831\u3067\u3059\n\n\n\nservice\nlog path\n\n\n\n\nsensu-server\n/var/log/sensu/sensu-server.log\n\n\nsensu-client\n/var/log/sensu/sensu-client.log\n\n\nsensu-api\n/var/log/sensu/sensu-api.log\n\n\nuchiwa\n/var/log/uchiwa.{log,err}\n\n\nrabbitmq\n/var/log/rabbitmq\n\n\n\n\u25a0sensu check\u30b9\u30c6\u30fc\u30bf\u30b9\n\n\n\nstatus\ndescription\n\n\n\n\n0\nOK\n\n\n1\nWARNING\n\n\n2\nCRITICAL\n\n\n3\u4ee5\u4e0a\nUNKNOWN or CUSTOM\n\n\n\n\u25a0jq install\nhttp://stedolan.github.io/jq/download/\n## \n## RHEL\u7cfb\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n## \ncd /usr/local/src\nwget \"http://stedolan.github.io/jq/download/linux64/jq\"\nchmod +x jq\n\necho '{\"test\": \"test\"}' | ./jq .\n  # json parse test\nmv -i jq  /usr/bin/\n\n\u25a0sensu server <=> sensu-client\u306e\u9023\u643a\nsensu-client\u3068sensu-server\u306e\u76e3\u8996\u696d\u52d9\u306e\u6982\u8981\u3092\u3064\u304b\u3093\u3067\u304a\u304f\u3068\u3044\u3044\u3068\u601d\u3046.\nhttp://qiita.com/metheglin/items/edd332d577b6e167ac67\n\nsensu-server,sensu-client <=> rabbitmq\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\nrabbitmq\u3068\u901a\u4fe1\u3067\u304d\u306a\u3044\u3068sensu\u306f\u7a3c\u50cd\u3057\u306a\u3044.\nrabbitmq\u3068\u758e\u901a\u3067\u304d\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u308b.\n\n/var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-04-23T00:27:23.907604+0900\",\"level\":\"error\",\"message\":\"[amqp] Detected TCP connection failure\"}\n\n\n@sensu-server\nnetstat -ln | grep 5672\n  # rabbitmq\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u3066port 5672\u3092LISTEN\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\nrabbitmq\u30c7\u30fc\u30e2\u30f3\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u306b\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\u5834\u5408\u3001\n* /etc/sensu/config.json\u306b\u8a18\u8ff0\u306erabbitmq\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\n* rabbitmq\u3068sensu-server\u304c\u5225\u30b5\u30fc\u30d0\u306a\u3089\u3001aws\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7, iptables, firewall\u306a\u3069\u3092\u7591\u3046\n* rabbitmq ACL\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\n    * https://sensuapp.org/docs/0.19/install-rabbitmq\n    * Configure RabbitMQ\n\n\n\nprotocol\ndaemon\nport\ndescription\n\n\n\n\ntcp\nrabbitmq\n5672\n\u958b\u653e\u5fc5\u8981(sensu-client\u306b\u5411\u3051\u3066)\n\n\nudp\nrabbitmq\n5672\n\u958b\u653e\u4e0d\u8981\u3063\u307d\u3044(tcpdump\u3067\u78ba\u8a8d\u3057\u305f)\n\n\n\n\nuchiwa/dashboard\u3067client\u304c\u8868\u793a\u3055\u308c\u306a\u3044\n\nsensu-api\u304cclient\u3092\u8a8d\u8b58\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nhttp://(sensu-api\u306e\u30db\u30b9\u30c8\u540d/IP):4567/clients\n\nsensu-client\u8d77\u52d5\u3067\u304d\u3066\u306f\u3044\u308b\u306e\u306b\u3001sensu-api\u3067client\u304c\u3068\u308c\u306a\u3044\u5834\u5408\u306f\u3001rabbitmq\u3068\u306e\u758e\u901a\u306b\u5931\u6557\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044.\n\u4e00\u3064\u524d\u306e\u624b\u9806\u306b\u3057\u305f\u304c\u3063\u3066\u3001rabbitmq\u306eport\u958b\u653e\u3084ACL\u3092\u78ba\u8a8d\u3059\u308b.\n\u4e00\u56derabbitmq\u306evhost\u6d88\u3057\u3066\u304b\u3089\u4f5c\u308a\u306a\u304a\u3057\u3066\u3082\u3088\u3055\u305d\u3046.\n\nuchiwa/dashboard\u3067client\u306e\u60c5\u5831\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\nsensu-client\u306eclient.json\u5909\u66f4\u3057\u305f\u3060\u3051\u3067\u306fsensu-server\u306eredis\u306e\u5024\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044.\nsensu-client\u518d\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b.\n# @sensu-client\nsudo service sensu-client restart\n\n\nsensu client\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u304b\u5358\u4f53\u30c1\u30a7\u30c3\u30af\n/dev/tcp\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u304bnc\u30b3\u30de\u30f3\u30c9\u306e\u3044\u305a\u308c\u304b\u3067sensu-client\u3078\u76f4\u63a5\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5c4a\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b.\n\u53c2\u8003):\nhttp://sensuapp.org/docs/0.17/clients#what-are-sensu-clients\n# @sensu-client\n\necho '{\"name\": \"sensu-client-check\", \"output\": \"sensu-client-check\", \"status\": 1}' > /dev/tcp/localhost/3030\necho '{\"name\": \"sensu-client-check\", \"output\": \"sensu-client-check\", \"status\": 1}' | nc localhost 3030\n\ntail -F  /var/log/sensu/sensu-client.log\n  # \u30ed\u30b0\u304c\u51fa\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\u4e00\u5ea6\u767b\u9332\u3057\u305fsensu check\u3092\u524a\u9664\u3059\u308b\nredis\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066flushall\u3059\u308b.\n\u203bsensu\u4ee5\u5916\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u3057\u3066redis\u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u304b\u6ce8\u610f\u3057\u3066\u304a\u3053\u306a\u3063\u3066\u304f\u3060\u3055\u3044\n\u203b\u3082\u3063\u3068\u6b63\u3057\u3044\u3084\u308a\u304b\u305f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u77e5\u3063\u3066\u3044\u308b\u304b\u305f\u3044\u305f\u3089\u6559\u3048\u3066\u304f\u3060\u3055\u3044\uff01\n\nuchiwa/dashboard\u3067sensu check\u304c\u8a8d\u8b58\u3055\u308c\u306a\u3044\nuchiwa\u3084dashboard\u306fsensu-api\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u306e\u3067\u3001sensu-api\u304csensu check\u306e\u8ffd\u52a0\u3092\u8a8d\u8b58\u3067\u304d\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b.\nsensu-api\u306fredis\u304b\u3089\u60c5\u5831\u3092\u3068\u3063\u3066\u304d\u3066\u3044\u308b\u306e\u3067\u3001redis\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b.\n\nsensu-api\u304csensu check\u3092\u8a8d\u8b58\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nhttp://(sensu-api\u306e\u30db\u30b9\u30c8\u540d/IP):4567/checks\n\n1-2. sensu-server\u3092\u518d\u8d77\u52d5\u3059\u308b\n# @sensu-server\nsudo service sensu-server restart\n# @sensu-api\nsudo service sensu-api restart\n\n1-3. \u8a8d\u8b58\u3055\u308c\u306a\u3044sensu check\u306ejson\u306bsyntax error\u306a\u3069\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\n@sensu-server\ncat vmstat_metrics.json  | jq '.'\nparse error: Expected separator between values at line 7, column 16\n\n/var/log/sensu/sensu-server.log\u3092\u3088\u304f\u898b\u308b\u3068\u3001sensu-server\u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u308b.\nsensu check json\u30d5\u30a1\u30a4\u30eb\u540d\u3067grep\u3057\u3066\u3001message\u67a0\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b.\n\n/var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-04-19T16:41:27.241425+0900\",\"level\":\"warn\",\"message\":\"config file must be valid json\",\"file\":\"/etc/sensu/conf.d/vmstat_metrics.json\",\"error\":\"parse error: after key and value, inside map, I expect ',' or '}'\\n          eme stats.:::name:::\\\"       \\\"interval\\\": 60,       \\\"subscribe\\n                     (right here) ------^\\n\"}\n\n\njson parse error\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u304d\u306esensu-server.log\n\nsensu check\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u304c\u60f3\u5b9a\u5916\u306e\u52d5\u304d\n\u3053\u3093\u306a\u4eba\u306f\u3042\u307e\u308a\u3044\u306a\u3044\u3068\u601d\u3046\u3051\u3069\u3001\u6ed1\u7a3d\u306a\u306f\u307e\u308a\u304b\u305f\u3092\u3057\u305f\u306e\u3067\u5171\u6709.\nsensu check\u306e\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u3067cron\u30c7\u30fc\u30e2\u30f3\u306e\u76e3\u8996\u3092\u3057\u304b\u3051\u305f.\n\u8a66\u3057\u306bcron\u30c7\u30fc\u30e2\u30f3\u3092\u843d\u3068\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u304c\u4e0a\u304c\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u305f\u304c\u3001\u30a2\u30e9\u30fc\u30c8\u304c\u6765\u306a\u3044...\n\u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u3066\u3001check\u30b3\u30de\u30f3\u30c9\u3092\u76f4\u63a5\u6253\u3064\u3068\u3001\u3042\u308b\u3068\u304d\u306fCRITICAL\u306b\u306a\u308a\u3001\u3042\u308b\u3068\u304d\u306fOK\u306b\u306a\u308a\u3001\u5168\u304f\u4e88\u671f\u3067\u304d\u306a\u3044\u52d5\u304d\u3092\u3057\u305f.\n\u539f\u56e0\u306f\u3001\u30c7\u30d0\u30c3\u30b0\u306e\u305f\u3081\u306b\u5225\u7a93\u3067\u5b9f\u884c\u3057\u3066\u3044\u305ftail -F /var/log/sensu/sensu-client.log | grep cron\u30b3\u30de\u30f3\u30c9\u3060\u3063\u305fw tail -F\u306f\u5e38\u99d0\u3059\u308b\u306e\u3067\u30d7\u30ed\u30bb\u30b9\u4e00\u89a7\u51fa\u3057\u305f\u3068\u304d\u306bgrep cron\u306e\u3068\u3053\u308d\u306bcron\u6587\u5b57\u5217\u304c\u30d2\u30c3\u30c8\u3059\u308b\u305f\u3081cron\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u3066\u3044\u308b\u3068\u5224\u65ad\u3055\u308c\u3066\u3057\u307e\u3046.\n\u30d7\u30ed\u30bb\u30b9\u540d\u3092\u542b\u3080\u30d0\u30c3\u30c1\u3092\u52d5\u304b\u3059\u3068\u304d\u3082\u554f\u984c\u306b\u306a\u308b\u304b\u3082.\n\nhandler\u304c\u6a5f\u80fd\u3057\u3066\u3044\u306a\u3044\u6c17\u304c\u3059\u308b\n\nhandler\u306e\u6587\u6cd5\u78ba\u8a8d\u3059\u308b\n\nhttps://sensuapp.org/docs/latest/checks\n\u3088\u304f\u3042\u308b\u554f\u984c\u3060\u3051\u3069\u3001handlers\u8907\u6570\u5f62\u306e\u5834\u5408\u306f\u914d\u5217\u5f62\u5f0f\u3067\u8907\u6570\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u6307\u5b9a\u3067\u304d\u308b\u3051\u3069\u3001handler\u5358\u6570\u5f62\u306e\u5834\u5408\u306f\u6587\u5b57\u5217\u5f62\u5f0f\u3067\u4e00\u3064\u3060\u3051\u6307\u5b9a\u3067\u304d\u308b.\n1-2. \u5bfe\u5fdc\u3059\u308bhandler\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\u3059\u308b\ngrep -r \"graphite\" /etc/sensu/conf.d/\n  # \"graphite\"\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308bhandler\u306ejson\u8a2d\u5b9a\u304c\u3042\u308b\u304b\u63a2\u3059\n  # \u4ee5\u4e0b\u306e\u5f62\u5f0f\u306ejson\u304c\u5b58\u5728\u3057\u3066\u3001sensu\u30e6\u30fc\u30b6\u306bread\u6a29\u9650\u3042\u308c\u3070\u554f\u984c\u306a\u3057.\n  # {\"handlers\", {\n  #   \"graphite\": {...\n  # \n\n1-3. handler\u3092\u914d\u5217\u5f62\u5f0f\u3067\u8907\u6570\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u4e00\u3064\u3067\u3082\u7121\u52b9\u306ahandler\u304c\u3042\u308b\u3068\u3059\u3079\u3066\u306ehandler\u304c\u8a8d\u8b58\u3055\u308c\u306a\u3044\nhandlers: [\"debug\", \"graphite\"]\n\u3068\u66f8\u3044\u3066\u3044\u305f\u304c\u3001debug handler\u304c\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u305f\u3081\u304b\u3001graphite handler\u307e\u3067\u304c\u7121\u52b9\u3068\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b.\ndebug\u3092\u5916\u3059\u3068\u3046\u307e\u304f\u3044\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bsensu-server.log\u306b\u51fa\u308b\u3088\u3046\u306b\u306a\u308b.\n\u25a0\u4fee\u6b63\u524d\nhandlers: [\"debug\", \"graphite\"]\u3068\u8a2d\u5b9a\u3057\u305f\u304cdebug handler\u304c\u5b58\u5728\u3057\u306a\u3044.\n\nsensu-server.log\n{\"timestamp\":\"2015-04-22T14:25:53.997086+0900\",\"level\":\"warn\",\"message\":\"loading config file\",\"file\":\"/etc/sensu/conf.d/cpu_metrics.json\"}\n\n\n\u2191handlers\u304cjson\u306b\u51fa\u3066\u3053\u306a\u3044\u305f\u3081\u8a2d\u5b9a\u304c\u304a\u304b\u3057\u3044.\n\u25a0\u4fee\u6b63\u5f8c\nhandlers: [\"graphite\"]\n\nsensu-server.log\n{\"timestamp\":\"2015-04-22T14:25:53.997096+0900\",\"level\":\"warn\",\"message\":\"config file applied changes\",\"file\":\"/etc/sensu/conf.d/cpu_metrics.json\",\"changes\":{\"checks\":{\"cpu_metrics\":[null,{\"type\":\"metric\",\"command\":\"/etc/sensu/plugins/cpu-metrics.rb\",\"subscribers\":[\"all\"],\"interval\":10,\"handlers\":[\"graphite\"]}]}}}\n\n\n\u2191handlers\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\n\n2\u56de\u76ee\u4ee5\u964d\u306ehandler\u304c\u5b9f\u884c\u3055\u308c\u306a\u3044\uff1f\n1\u5206\u9593\u9694\u3067\u6b7b\u6d3b\u76e3\u8996\u3057\u3066\u3044\u308b\u3068\u3001\u30d7\u30ed\u30bb\u30b9\u843d\u3068\u3057\u305f\u3068\u304d\u306b1\u5206\u9593\u9694\u3067\u30a2\u30e9\u30fc\u30c8\u304c\u6765\u3066\u304b\u306a\u308a\u3046\u308b\u3055\u3044.\n\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u3001\u969c\u5bb3\u767a\u751f\u6642\u306ehandler\u306f\u3044\u3044\u611f\u3058\u306b\u9593\u9694\u3092\u3042\u3051\u3066\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3064\u3044\u3066\u3044\u308b.\nhttps://github.com/sensu-plugins/sensu-plugin/blob/master/lib/sensu-handler.rb\n\n\n\n\ndefault\nmemo\n\n\n\n\nrefresh\n1800\n\u3069\u306e\u9593\u9694\u3067handler\u3092\u5b9f\u884c\u3059\u308b\u304b\u8abf\u6574\u3067\u304d\u308b\n\n\ninteval\n60\nsensu check json\u306b\u8a18\u8ff0\u3057\u305fcheck\u5b9f\u884c\u9593\u9694\n\n\n\n\u30a4\u30d9\u30f3\u30c8\u7d99\u7d9a\u56de\u6570\u304crefresh / interval\u3067\u5272\u308a\u5207\u308c\u308b\u6570\u306e\u3068\u304d\u306e\u307fhandler\u304c\u5b9f\u884c\u3055\u308c\u308b.\nsensu handler\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u3044\u308b\u3068\u304d\u306f\u3053\u306e\u6a5f\u80fd\u304c\u3042\u308b\u3068\u3001\u9577\u3044\u6642\u9593\u5f85\u305f\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306e\u3067\u9006\u306b\u90aa\u9b54\u306b\u306a\u308b.\nuchiwa\u3067event\u3092\u9078\u629e\u3057\u3066\u3001resolv\u3092\u62bc\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u89e3\u6c7a\u3057\u3066\u3057\u307e\u3048\u3070\u30a4\u30d9\u30f3\u30c8\u7d99\u7d9a\u56de\u6570\u304c0\u306b\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\u518d\u5ea6handler\u3092\u5b9f\u884c\u3067\u304d\u308b.\n\u307e\u305f\u306f\u3001Events API\u306eresolve\u3092\u5b9f\u884c\u3057\u3066\u3082\u3088\u3044.\nhttps://sensuapp.org/docs/latest/api-events\n\nsensu events\u306eresolve\u304c\u3067\u304d\u306a\u3044\n\nuchiwa\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\nuchiwa\u3067resolve\u64cd\u4f5c\u3057\u305f\u3068\u304d\u306bresolve\u64cd\u4f5c\u306e\u30ed\u30b0\u304c\u51fa\u308b\u3053\u3068\u3092\u78ba\u8a8d\n{\"timestamp\":\"2015-04-23T12:23:23.585168+0900\",\"level\":\"info\",\"message\":\"POST /resolve\",\"remote_address\":\"127.0.0.1\",\"user_agent\":\"Go 1.1 package http\",\"request_method\":\"POST\",\"request_uri\":\"/resolve\",\"request_body\":\"{\\\"check\\\":\\\"cron\\\",\\\"client\\\":\\\"stg-wsaneys201\\\"}\\n\\n\"}\n\n\nsensu-api\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\nsensu-api\u3067resolve\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u30ed\u30b0\n\nsensu-api.log\n{\"timestamp\":\"2015-04-23T14:10:50.937077+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"stg-wsaneys201\",\"check\":{\"command\":\"/etc/sensu/plugins/check-procs.rb -p cron\",\"subscribers\":[\"production\"],\"interval\":60,\"name\":\"cron\",\"issued\":1429765850,\"executed\":1429765850,\"duration\":0.051,\"output\":\"Resolving on request of the API\",\"status\":0,\"total_state_change\":0,\"force_resolve\":true}}}\n\n\nsensu\u306e\u9014\u4e2d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u5fae\u5999\u306bresolve api\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304b\u308f\u3063\u3066\u308b\u306e\u3067\u3001\u6700\u65b0\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff08\u307e\u305f\u306f\u305d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09\u3092\u78ba\u8a8d\u3059\u308b.\nhttps://sensuapp.org/docs/latest/api-events\nresolve api\u3092curl\u3067\u78ba\u8a8d\u3059\u308b\u4f8b.\n--dump-header -\u3092\u3064\u3051\u3066\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u3092\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u3044\u3044.\ncurl --dump-header - -X POST -d '{\"check\":\"cron\",\"client\":\"sensu-client\"}' http://(sensu-api\u306e\u30db\u30b9\u30c8):4567/resolve\n\n  # event\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u304d\n  # HTTP/1.1 404 Not Found\n\n  # event\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\n  # HTTP/1.1 202 Accepted\n  # {\"issued\":1433564961}\n\n\nrabbitmq\u3068\u306e\u758e\u901a\u3092\u78ba\u8a8d\n\nsensu-api\u3082\u7570\u5e38\u306a\u3055\u305d\u3046\u3060\u3063\u305f\u3089\u3001rabbitmq\u3068\u306e\u758e\u901a\u3092\u78ba\u8a8d\u3059\u308b.\nresolve\u3059\u308b\u3068\u3001sensu-api\u304credis\u3092\u76f4\u63a5\u64cd\u4f5c\u3059\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u3001rabbitmq\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u3001\u305d\u308c\u3092\u53d7\u4fe1\u3057\u305fsensu-server\u304c\u30a4\u30d9\u30f3\u30c8\u89e3\u6c7a\u51e6\u7406\u3092\u304a\u3053\u306a\u3046.\n\u4e00\u756a\u4e0a\u8a18\u8f09\u306erabbitmq\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8abf\u67fb\u3059\u308b.\n\nEnvironment\nsensu version 0.17\n\n$ cat /etc/issue\nAmazon Linux AMI release 2015.03\nKernel \\r on an \\m\n\n$ uname -a\nLinux *** 3.14.35-28.38.amzn1.x86_64 #1 SMP Wed Mar 11 22:50:37 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n\n\n\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u306f\u767b\u5834\u4eba\u7269\u304c\u591a\u304f\u306a\u308b\u306e\u3067\u3001\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3068\u304d\u306b\u3069\u3053\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u304b\u30d1\u30c3\u3068\u898b\u308f\u304b\u308a\u3065\u3089\u3044.\n\u3069\u3046\u3044\u3046\u9023\u643a\u3067\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u304c\u52d5\u3044\u3066\u3044\u308b\u306e\u304b\u5168\u4f53\u69cb\u6210\u3092\u628a\u63e1\u3059\u308b\u3053\u3068\u3068\u3001\u30b5\u30fc\u30d3\u30b9\u5358\u4f53\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u3001\u30ed\u30b0\u306e\u898b\u65b9\u306a\u3069\u3092\u304a\u3055\u3048\u308b\u3053\u3068\u304c\u5927\u4e8b\u3068\u601d\u3046.\ncurl\u3067sensu-api\u305f\u305f\u304f\u3001jq\u3067json\u306esyntax\u30c1\u30a7\u30c3\u30af\u3059\u308b\u306a\u3069\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3082\u91cd\u8981.\n\n\u25a0\u30b5\u30fc\u30d3\u30b9 \u30dd\u30fc\u30c8\n\n\u203b\u81ea\u5206\u306e\u74b0\u5883\u306e\u60c5\u5831\u3067\u3059\n\n|service|default port|\n|:-------:|:-------:|\n|sensu-client|3030|\n|sensu-api|4567|\n|uchiwa|3000|\n|rabbitmq-server|5672|\n|redis-server|6379|\n\n\u25a0\u30ed\u30b0\n\n\u203b\u81ea\u5206\u306e\u74b0\u5883\u306e\u60c5\u5831\u3067\u3059\n\n|service|log path|\n|:-------:|:-------|\n|sensu-server|/var/log/sensu/sensu-server.log|\n|sensu-client|/var/log/sensu/sensu-client.log|\n|sensu-api|/var/log/sensu/sensu-api.log|\n|uchiwa|/var/log/uchiwa.{log,err}|\n|rabbitmq|/var/log/rabbitmq|\n\n\u25a0sensu check\u30b9\u30c6\u30fc\u30bf\u30b9\n\n|status|description|\n|:-------:|:-------|\n|0|OK|\n|1|WARNING|\n|2|CRITICAL|\n|3\u4ee5\u4e0a|UNKNOWN or CUSTOM|\n\n\u25a0jq install\n\nhttp://stedolan.github.io/jq/download/\n\n```bash\n## \n## RHEL\u7cfb\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n## \ncd /usr/local/src\nwget \"http://stedolan.github.io/jq/download/linux64/jq\"\nchmod +x jq\n\necho '{\"test\": \"test\"}' | ./jq .\n  # json parse test\nmv -i jq  /usr/bin/\n```\n\n\u25a0sensu server <=> sensu-client\u306e\u9023\u643a\n\nsensu-client\u3068sensu-server\u306e\u76e3\u8996\u696d\u52d9\u306e\u6982\u8981\u3092\u3064\u304b\u3093\u3067\u304a\u304f\u3068\u3044\u3044\u3068\u601d\u3046.\nhttp://qiita.com/metheglin/items/edd332d577b6e167ac67\n\n## sensu-server,sensu-client <=> rabbitmq\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\n\nrabbitmq\u3068\u901a\u4fe1\u3067\u304d\u306a\u3044\u3068sensu\u306f\u7a3c\u50cd\u3057\u306a\u3044.\nrabbitmq\u3068\u758e\u901a\u3067\u304d\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u308b.\n\n```json:/var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-04-23T00:27:23.907604+0900\",\"level\":\"error\",\"message\":\"[amqp] Detected TCP connection failure\"}\n```\n\n```bash\n@sensu-server\nnetstat -ln | grep 5672\n  # rabbitmq\u30d7\u30ed\u30bb\u30b9\u304c\u8d77\u52d5\u3057\u3066port 5672\u3092LISTEN\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n```\n\nrabbitmq\u30c7\u30fc\u30e2\u30f3\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u306b\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\u5834\u5408\u3001\n* `/etc/sensu/config.json`\u306b\u8a18\u8ff0\u306erabbitmq\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\n* rabbitmq\u3068sensu-server\u304c\u5225\u30b5\u30fc\u30d0\u306a\u3089\u3001aws\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7, iptables, firewall\u306a\u3069\u3092\u7591\u3046\n* rabbitmq ACL\u8a2d\u5b9a\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\n\t* https://sensuapp.org/docs/0.19/install-rabbitmq\n\t* Configure RabbitMQ\n\n|protocol|daemon|port|description|\n|:----:|:----:|:----:|:----:|\n|tcp|rabbitmq|5672|\u958b\u653e\u5fc5\u8981(sensu-client\u306b\u5411\u3051\u3066)|\n|udp|rabbitmq|5672|\u958b\u653e\u4e0d\u8981\u3063\u307d\u3044(tcpdump\u3067\u78ba\u8a8d\u3057\u305f)|\n\n## uchiwa/dashboard\u3067client\u304c\u8868\u793a\u3055\u308c\u306a\u3044\n\n1. sensu-api\u304cclient\u3092\u8a8d\u8b58\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nhttp://(sensu-api\u306e\u30db\u30b9\u30c8\u540d/IP):4567/clients\n\nsensu-client\u8d77\u52d5\u3067\u304d\u3066\u306f\u3044\u308b\u306e\u306b\u3001sensu-api\u3067client\u304c\u3068\u308c\u306a\u3044\u5834\u5408\u306f\u3001rabbitmq\u3068\u306e\u758e\u901a\u306b\u5931\u6557\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044.\n\u4e00\u3064\u524d\u306e\u624b\u9806\u306b\u3057\u305f\u304c\u3063\u3066\u3001rabbitmq\u306eport\u958b\u653e\u3084ACL\u3092\u78ba\u8a8d\u3059\u308b.\n\u4e00\u56derabbitmq\u306evhost\u6d88\u3057\u3066\u304b\u3089\u4f5c\u308a\u306a\u304a\u3057\u3066\u3082\u3088\u3055\u305d\u3046.\n\n## uchiwa/dashboard\u3067client\u306e\u60c5\u5831\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044\n\nsensu-client\u306eclient.json\u5909\u66f4\u3057\u305f\u3060\u3051\u3067\u306fsensu-server\u306eredis\u306e\u5024\u304c\u66f4\u65b0\u3055\u308c\u306a\u3044.\nsensu-client\u518d\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b.\n\n```bash\n# @sensu-client\nsudo service sensu-client restart\n```\n\n## sensu client\u304c\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u304b\u5358\u4f53\u30c1\u30a7\u30c3\u30af\n\n/dev/tcp\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u304bnc\u30b3\u30de\u30f3\u30c9\u306e\u3044\u305a\u308c\u304b\u3067sensu-client\u3078\u76f4\u63a5\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5c4a\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u308b.\n\n\u53c2\u8003):\nhttp://sensuapp.org/docs/0.17/clients#what-are-sensu-clients\n\n```bash\n# @sensu-client\n\necho '{\"name\": \"sensu-client-check\", \"output\": \"sensu-client-check\", \"status\": 1}' > /dev/tcp/localhost/3030\necho '{\"name\": \"sensu-client-check\", \"output\": \"sensu-client-check\", \"status\": 1}' | nc localhost 3030\n\ntail -F  /var/log/sensu/sensu-client.log\n  # \u30ed\u30b0\u304c\u51fa\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```\n\n## \u4e00\u5ea6\u767b\u9332\u3057\u305fsensu check\u3092\u524a\u9664\u3059\u308b\n\nredis\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066flushall\u3059\u308b.\n\u203bsensu\u4ee5\u5916\u306e\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u3068\u3057\u3066redis\u3092\u4f7f\u3063\u3066\u3044\u306a\u3044\u304b\u6ce8\u610f\u3057\u3066\u304a\u3053\u306a\u3063\u3066\u304f\u3060\u3055\u3044\n\u203b\u3082\u3063\u3068\u6b63\u3057\u3044\u3084\u308a\u304b\u305f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u77e5\u3063\u3066\u3044\u308b\u304b\u305f\u3044\u305f\u3089\u6559\u3048\u3066\u304f\u3060\u3055\u3044\uff01\n\n## uchiwa/dashboard\u3067sensu check\u304c\u8a8d\u8b58\u3055\u308c\u306a\u3044\n\nuchiwa\u3084dashboard\u306fsensu-api\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u306e\u3067\u3001sensu-api\u304csensu check\u306e\u8ffd\u52a0\u3092\u8a8d\u8b58\u3067\u304d\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b.\nsensu-api\u306fredis\u304b\u3089\u60c5\u5831\u3092\u3068\u3063\u3066\u304d\u3066\u3044\u308b\u306e\u3067\u3001redis\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b.\n\n1. sensu-api\u304csensu check\u3092\u8a8d\u8b58\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\nhttp://(sensu-api\u306e\u30db\u30b9\u30c8\u540d/IP):4567/checks\n\n1-2. sensu-server\u3092\u518d\u8d77\u52d5\u3059\u308b\n\n```bash\n# @sensu-server\nsudo service sensu-server restart\n# @sensu-api\nsudo service sensu-api restart\n```\n\n1-3. \u8a8d\u8b58\u3055\u308c\u306a\u3044sensu check\u306ejson\u306bsyntax error\u306a\u3069\u304c\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b\n\n\n```bash\n@sensu-server\ncat vmstat_metrics.json  | jq '.'\nparse error: Expected separator between values at line 7, column 16\n```\n\n`/var/log/sensu/sensu-server.log`\u3092\u3088\u304f\u898b\u308b\u3068\u3001sensu-server\u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u308b.\nsensu check json\u30d5\u30a1\u30a4\u30eb\u540d\u3067grep\u3057\u3066\u3001message\u67a0\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u306a\u3044\u304b\u78ba\u8a8d\u3059\u308b.\n\n```json:/var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-04-19T16:41:27.241425+0900\",\"level\":\"warn\",\"message\":\"config file must be valid json\",\"file\":\"/etc/sensu/conf.d/vmstat_metrics.json\",\"error\":\"parse error: after key and value, inside map, I expect ',' or '}'\\n          eme stats.:::name:::\\\"       \\\"interval\\\": 60,       \\\"subscribe\\n                     (right here) ------^\\n\"}\n```\njson parse error\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u304d\u306e`sensu-server.log`\n\n## sensu check\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u304c\u60f3\u5b9a\u5916\u306e\u52d5\u304d\n\n\u3053\u3093\u306a\u4eba\u306f\u3042\u307e\u308a\u3044\u306a\u3044\u3068\u601d\u3046\u3051\u3069\u3001\u6ed1\u7a3d\u306a\u306f\u307e\u308a\u304b\u305f\u3092\u3057\u305f\u306e\u3067\u5171\u6709.\nsensu check\u306e\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u3067cron\u30c7\u30fc\u30e2\u30f3\u306e\u76e3\u8996\u3092\u3057\u304b\u3051\u305f.\n\u8a66\u3057\u306bcron\u30c7\u30fc\u30e2\u30f3\u3092\u843d\u3068\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u304c\u4e0a\u304c\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u305f\u304c\u3001\u30a2\u30e9\u30fc\u30c8\u304c\u6765\u306a\u3044...\n\u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u3066\u3001check\u30b3\u30de\u30f3\u30c9\u3092\u76f4\u63a5\u6253\u3064\u3068\u3001\u3042\u308b\u3068\u304d\u306fCRITICAL\u306b\u306a\u308a\u3001\u3042\u308b\u3068\u304d\u306fOK\u306b\u306a\u308a\u3001\u5168\u304f\u4e88\u671f\u3067\u304d\u306a\u3044\u52d5\u304d\u3092\u3057\u305f.\n\n\u539f\u56e0\u306f\u3001\u30c7\u30d0\u30c3\u30b0\u306e\u305f\u3081\u306b\u5225\u7a93\u3067\u5b9f\u884c\u3057\u3066\u3044\u305f`tail -F /var/log/sensu/sensu-client.log | grep cron`\u30b3\u30de\u30f3\u30c9\u3060\u3063\u305fw `tail -F`\u306f\u5e38\u99d0\u3059\u308b\u306e\u3067\u30d7\u30ed\u30bb\u30b9\u4e00\u89a7\u51fa\u3057\u305f\u3068\u304d\u306b`grep cron`\u306e\u3068\u3053\u308d\u306bcron\u6587\u5b57\u5217\u304c\u30d2\u30c3\u30c8\u3059\u308b\u305f\u3081cron\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u3066\u3044\u308b\u3068\u5224\u65ad\u3055\u308c\u3066\u3057\u307e\u3046.\n\n\u30d7\u30ed\u30bb\u30b9\u540d\u3092\u542b\u3080\u30d0\u30c3\u30c1\u3092\u52d5\u304b\u3059\u3068\u304d\u3082\u554f\u984c\u306b\u306a\u308b\u304b\u3082.\n\n## handler\u304c\u6a5f\u80fd\u3057\u3066\u3044\u306a\u3044\u6c17\u304c\u3059\u308b\n\n1. handler\u306e\u6587\u6cd5\u78ba\u8a8d\u3059\u308b\n\nhttps://sensuapp.org/docs/latest/checks\n\u3088\u304f\u3042\u308b\u554f\u984c\u3060\u3051\u3069\u3001`handlers`\u8907\u6570\u5f62\u306e\u5834\u5408\u306f\u914d\u5217\u5f62\u5f0f\u3067\u8907\u6570\u306e\u30cf\u30f3\u30c9\u30e9\u3092\u6307\u5b9a\u3067\u304d\u308b\u3051\u3069\u3001`handler`\u5358\u6570\u5f62\u306e\u5834\u5408\u306f\u6587\u5b57\u5217\u5f62\u5f0f\u3067\u4e00\u3064\u3060\u3051\u6307\u5b9a\u3067\u304d\u308b.\n\n1-2. \u5bfe\u5fdc\u3059\u308bhandler\u304c\u5b58\u5728\u3059\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n```\ngrep -r \"graphite\" /etc/sensu/conf.d/\n  # \"graphite\"\u3068\u3044\u3046\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308bhandler\u306ejson\u8a2d\u5b9a\u304c\u3042\u308b\u304b\u63a2\u3059\n  # \u4ee5\u4e0b\u306e\u5f62\u5f0f\u306ejson\u304c\u5b58\u5728\u3057\u3066\u3001sensu\u30e6\u30fc\u30b6\u306bread\u6a29\u9650\u3042\u308c\u3070\u554f\u984c\u306a\u3057.\n  # {\"handlers\", {\n  #   \"graphite\": {...\n  # \n```\n1-3. handler\u3092\u914d\u5217\u5f62\u5f0f\u3067\u8907\u6570\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u4e00\u3064\u3067\u3082\u7121\u52b9\u306ahandler\u304c\u3042\u308b\u3068\u3059\u3079\u3066\u306ehandler\u304c\u8a8d\u8b58\u3055\u308c\u306a\u3044\n\n`handlers: [\"debug\", \"graphite\"]`\n\u3068\u66f8\u3044\u3066\u3044\u305f\u304c\u3001debug handler\u304c\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u305f\u3081\u304b\u3001graphite handler\u307e\u3067\u304c\u7121\u52b9\u3068\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u308b.\ndebug\u3092\u5916\u3059\u3068\u3046\u307e\u304f\u3044\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b`sensu-server.log`\u306b\u51fa\u308b\u3088\u3046\u306b\u306a\u308b.\n\n\u25a0\u4fee\u6b63\u524d\n\n`handlers: [\"debug\", \"graphite\"]`\u3068\u8a2d\u5b9a\u3057\u305f\u304cdebug handler\u304c\u5b58\u5728\u3057\u306a\u3044.\n\n```json:sensu-server.log\n{\"timestamp\":\"2015-04-22T14:25:53.997086+0900\",\"level\":\"warn\",\"message\":\"loading config file\",\"file\":\"/etc/sensu/conf.d/cpu_metrics.json\"}\n```\n\u2191handlers\u304cjson\u306b\u51fa\u3066\u3053\u306a\u3044\u305f\u3081\u8a2d\u5b9a\u304c\u304a\u304b\u3057\u3044.\n\n\u25a0\u4fee\u6b63\u5f8c\n\n`handlers: [\"graphite\"]`\n\n```json:sensu-server.log\n{\"timestamp\":\"2015-04-22T14:25:53.997096+0900\",\"level\":\"warn\",\"message\":\"config file applied changes\",\"file\":\"/etc/sensu/conf.d/cpu_metrics.json\",\"changes\":{\"checks\":{\"cpu_metrics\":[null,{\"type\":\"metric\",\"command\":\"/etc/sensu/plugins/cpu-metrics.rb\",\"subscribers\":[\"all\"],\"interval\":10,\"handlers\":[\"graphite\"]}]}}}\n```\n\u2191handlers\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\n\n## 2\u56de\u76ee\u4ee5\u964d\u306ehandler\u304c\u5b9f\u884c\u3055\u308c\u306a\u3044\uff1f\n\n1\u5206\u9593\u9694\u3067\u6b7b\u6d3b\u76e3\u8996\u3057\u3066\u3044\u308b\u3068\u3001\u30d7\u30ed\u30bb\u30b9\u843d\u3068\u3057\u305f\u3068\u304d\u306b1\u5206\u9593\u9694\u3067\u30a2\u30e9\u30fc\u30c8\u304c\u6765\u3066\u304b\u306a\u308a\u3046\u308b\u3055\u3044.\n\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u3001\u969c\u5bb3\u767a\u751f\u6642\u306ehandler\u306f\u3044\u3044\u611f\u3058\u306b\u9593\u9694\u3092\u3042\u3051\u3066\u5b9f\u884c\u3057\u3066\u304f\u308c\u308b\u6a5f\u80fd\u304c\u3064\u3044\u3066\u3044\u308b.\n\nhttps://github.com/sensu-plugins/sensu-plugin/blob/master/lib/sensu-handler.rb\n\n|      |default|memo|\n|:----:|:-----:|:----:|\n|refresh|1800|\u3069\u306e\u9593\u9694\u3067handler\u3092\u5b9f\u884c\u3059\u308b\u304b\u8abf\u6574\u3067\u304d\u308b|\n|inteval|60|sensu check json\u306b\u8a18\u8ff0\u3057\u305fcheck\u5b9f\u884c\u9593\u9694|\n\n\u30a4\u30d9\u30f3\u30c8\u7d99\u7d9a\u56de\u6570\u304c`refresh / interval`\u3067\u5272\u308a\u5207\u308c\u308b\u6570\u306e\u3068\u304d\u306e\u307fhandler\u304c\u5b9f\u884c\u3055\u308c\u308b.\n\nsensu handler\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u3044\u308b\u3068\u304d\u306f\u3053\u306e\u6a5f\u80fd\u304c\u3042\u308b\u3068\u3001\u9577\u3044\u6642\u9593\u5f85\u305f\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306e\u3067\u9006\u306b\u90aa\u9b54\u306b\u306a\u308b.\nuchiwa\u3067event\u3092\u9078\u629e\u3057\u3066\u3001resolv\u3092\u62bc\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u89e3\u6c7a\u3057\u3066\u3057\u307e\u3048\u3070\u30a4\u30d9\u30f3\u30c8\u7d99\u7d9a\u56de\u6570\u304c0\u306b\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u3067\u3001\u518d\u5ea6handler\u3092\u5b9f\u884c\u3067\u304d\u308b.\n\u307e\u305f\u306f\u3001Events API\u306eresolve\u3092\u5b9f\u884c\u3057\u3066\u3082\u3088\u3044.\nhttps://sensuapp.org/docs/latest/api-events\n\n## sensu events\u306eresolve\u304c\u3067\u304d\u306a\u3044\n\n1. uchiwa\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\nuchiwa\u3067resolve\u64cd\u4f5c\u3057\u305f\u3068\u304d\u306bresolve\u64cd\u4f5c\u306e\u30ed\u30b0\u304c\u51fa\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n```\n{\"timestamp\":\"2015-04-23T12:23:23.585168+0900\",\"level\":\"info\",\"message\":\"POST /resolve\",\"remote_address\":\"127.0.0.1\",\"user_agent\":\"Go 1.1 package http\",\"request_method\":\"POST\",\"request_uri\":\"/resolve\",\"request_body\":\"{\\\"check\\\":\\\"cron\\\",\\\"client\\\":\\\"stg-wsaneys201\\\"}\\n\\n\"}\n```\n\n2. sensu-api\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\nsensu-api\u3067resolve\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u30ed\u30b0\n\n```sensu-api.log\n{\"timestamp\":\"2015-04-23T14:10:50.937077+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"stg-wsaneys201\",\"check\":{\"command\":\"/etc/sensu/plugins/check-procs.rb -p cron\",\"subscribers\":[\"production\"],\"interval\":60,\"name\":\"cron\",\"issued\":1429765850,\"executed\":1429765850,\"duration\":0.051,\"output\":\"Resolving on request of the API\",\"status\":0,\"total_state_change\":0,\"force_resolve\":true}}}\n```\n\nsensu\u306e\u9014\u4e2d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304b\u3089\u5fae\u5999\u306bresolve api\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u304b\u308f\u3063\u3066\u308b\u306e\u3067\u3001\u6700\u65b0\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff08\u307e\u305f\u306f\u305d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff09\u3092\u78ba\u8a8d\u3059\u308b.\nhttps://sensuapp.org/docs/latest/api-events\n\nresolve api\u3092curl\u3067\u78ba\u8a8d\u3059\u308b\u4f8b.\n`--dump-header -`\u3092\u3064\u3051\u3066\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u3092\u78ba\u8a8d\u3057\u305f\u307b\u3046\u304c\u3044\u3044.\n\n```bash\ncurl --dump-header - -X POST -d '{\"check\":\"cron\",\"client\":\"sensu-client\"}' http://(sensu-api\u306e\u30db\u30b9\u30c8):4567/resolve\n\n  # event\u304c\u5b58\u5728\u3057\u306a\u3044\u3068\u304d\n  # HTTP/1.1 404 Not Found\n\n  # event\u304c\u5b58\u5728\u3059\u308b\u3068\u304d\n  # HTTP/1.1 202 Accepted\n  # {\"issued\":1433564961}\n```\n\n3. rabbitmq\u3068\u306e\u758e\u901a\u3092\u78ba\u8a8d\n\nsensu-api\u3082\u7570\u5e38\u306a\u3055\u305d\u3046\u3060\u3063\u305f\u3089\u3001rabbitmq\u3068\u306e\u758e\u901a\u3092\u78ba\u8a8d\u3059\u308b.\nresolve\u3059\u308b\u3068\u3001sensu-api\u304credis\u3092\u76f4\u63a5\u64cd\u4f5c\u3059\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u3001rabbitmq\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308a\u3001\u305d\u308c\u3092\u53d7\u4fe1\u3057\u305fsensu-server\u304c\u30a4\u30d9\u30f3\u30c8\u89e3\u6c7a\u51e6\u7406\u3092\u304a\u3053\u306a\u3046.\n\u4e00\u756a\u4e0a\u8a18\u8f09\u306erabbitmq\u901a\u4fe1\u306b\u5931\u6557\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8abf\u67fb\u3059\u308b.\n\n\n# Environment\n\n```\nsensu version 0.17\n```\n\n```\n$ cat /etc/issue\nAmazon Linux AMI release 2015.03\nKernel \\r on an \\m\n\n$ uname -a\nLinux *** 3.14.35-28.38.amzn1.x86_64 #1 SMP Wed Mar 11 22:50:37 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\n```\n"}