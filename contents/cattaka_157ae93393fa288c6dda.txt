{"tags": ["Android", "JUnit"], "context": " More than 1 year has passed since last update.Android\u3067ActivityInstrumentationTestCase2\u3092\u4f7f\u3063\u3066JUnit\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3055\u305b\u308b\u3068\u304d\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af(\u30ad\u30fc\u30ac\u30fc\u30c9)\u304c\u639b\u304b\u3063\u3066\u3044\u3066Activity\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u3068\u304d\u306e\u5bfe\u51e6\u6cd5\u3067\u3059\u3002\n\u305f\u3060\u3057\u3001PIN\u30ed\u30c3\u30af\u3084\u30d1\u30bf\u30fc\u30f3\u30ed\u30c3\u30af\u304c\u639b\u304b\u3063\u3066\u3044\u308b\u3068\u304d\u306f\u3053\u306e\u624b\u6cd5\u3067\u306f\u5916\u305b\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\u307e\u305a\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3059\u308b\u3060\u3051\u306eActivity\u3092\u30c6\u30b9\u30c8\u5074\u306e\u30b3\u30fc\u30c9\u306b\u4f5c\u308a\u307e\u3059\u3002\npublic class UnlockKeyguardActivity extends Activity {\n    private static Handler sHandler = new Handler();\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_unlock_keyguard);\n\n        Window window = this.getWindow();\n        window.addFlags(WindowManager.LayoutParams.FLAG_DISMISS_KEYGUARD);\n        window.addFlags(WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED);\n        window.addFlags(WindowManager.LayoutParams.FLAG_TURN_SCREEN_ON);\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        sHandler.postDelayed(new Runnable() {\n            @Override\n            public void run() {\n                checkUnlocked();\n            }\n        }, 100);\n    }\n\n    private void checkUnlocked() {\n        KeyguardManager km = (KeyguardManager) getSystemService(KEYGUARD_SERVICE);\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\n        if (!km.inKeyguardRestrictedInputMode() && pm.isScreenOn()) {\n            finish();\n        } else {\n            sHandler.postDelayed(new Runnable() {\n                @Override\n                public void run() {\n                    checkUnlocked();\n                }\n            }, 100);\n        }\n    }\n}\n\n\u6b21\u306bUnlockKeyguardActivity\u3092\u30c6\u30b9\u30c8\u5074\u306eAndroidManifest.xml\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\u3053\u306e\u3068\u304d\u306bandroid:exported=\"true\"\u306b\u3057\u3066\u304a\u304f\u306e\u304c\u5927\u4e8b\u3002\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"net.cattaka.android.fastchecklist.test\"\n    >\n    <application>\n        <activity\n            android:name=\"net.cattaka.android.fastchecklist.test.UnlockKeyguardActivity\"\n            android:exported=\"true\"/>\n    </application>\n\n</manifest>\n\n\u305d\u3057\u3066\u30c6\u30b9\u30c8\u306e\u958b\u59cb\u6642(setUp\u306a\u3069)\u306b\u30ad\u30fc\u30ac\u30fc\u30c9\u304c\u639b\u304b\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u639b\u304b\u3063\u3066\u3044\u305f\u3089UnlockKeyguardActivity\u3092\u8d77\u52d5\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3002\n    protected void setUp() throws Exception {\n        super.setUp();\n        {   // Unlock keyguard and screen on\n            KeyguardManager km = (KeyguardManager) getInstrumentation()\n                .getTargetContext().getSystemService(Context.KEYGUARD_SERVICE);\n            PowerManager pm = (PowerManager) getInstrumentation()\n                .getTargetContext().getSystemService(Context.POWER_SERVICE);\n            if (km.inKeyguardRestrictedInputMode() || !pm.isScreenOn()) {\n                Intent intent = new Intent(getInstrumentation().getContext(),\n                    UnlockKeyguardActivity.class);\n                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n                getInstrumentation().getTargetContext().startActivity(intent);\n                while (km.inKeyguardRestrictedInputMode()) {\n                    SystemClock.sleep(100);\n                }\n            }\n        }\n    }\n\nActivityInstrumentationTestCase2\u304b\u3089\u6d3e\u751f\u3055\u305b\u305f\u30af\u30e9\u30b9\u306b\u5b9f\u88c5\u3057\u3001\u305d\u306eActivity\u306e\u30c6\u30b9\u30c8\u3067\u306f\u305d\u306e\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u66f8\u304f\u3088\u3046\u306b\u3059\u308c\u3070\u81ea\u52d5\u3067\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3057\u3066\u958b\u59cb\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\nAndroid\u3067ActivityInstrumentationTestCase2\u3092\u4f7f\u3063\u3066JUnit\u306e\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3055\u305b\u308b\u3068\u304d\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af(\u30ad\u30fc\u30ac\u30fc\u30c9)\u304c\u639b\u304b\u3063\u3066\u3044\u3066Activity\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u3068\u304d\u306e\u5bfe\u51e6\u6cd5\u3067\u3059\u3002\n\u305f\u3060\u3057\u3001PIN\u30ed\u30c3\u30af\u3084\u30d1\u30bf\u30fc\u30f3\u30ed\u30c3\u30af\u304c\u639b\u304b\u3063\u3066\u3044\u308b\u3068\u304d\u306f\u3053\u306e\u624b\u6cd5\u3067\u306f\u5916\u305b\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n[\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8](https://github.com/cattaka/FastCheckList)\n\n\u307e\u305a\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3059\u308b\u3060\u3051\u306eActivity\u3092\u30c6\u30b9\u30c8\u5074\u306e\u30b3\u30fc\u30c9\u306b\u4f5c\u308a\u307e\u3059\u3002\n\n```java\npublic class UnlockKeyguardActivity extends Activity {\n    private static Handler sHandler = new Handler();\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_unlock_keyguard);\n\n        Window window = this.getWindow();\n        window.addFlags(WindowManager.LayoutParams.FLAG_DISMISS_KEYGUARD);\n        window.addFlags(WindowManager.LayoutParams.FLAG_SHOW_WHEN_LOCKED);\n        window.addFlags(WindowManager.LayoutParams.FLAG_TURN_SCREEN_ON);\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        sHandler.postDelayed(new Runnable() {\n            @Override\n            public void run() {\n                checkUnlocked();\n            }\n        }, 100);\n    }\n\n    private void checkUnlocked() {\n        KeyguardManager km = (KeyguardManager) getSystemService(KEYGUARD_SERVICE);\n        PowerManager pm = (PowerManager) getSystemService(Context.POWER_SERVICE);\n        if (!km.inKeyguardRestrictedInputMode() && pm.isScreenOn()) {\n            finish();\n        } else {\n            sHandler.postDelayed(new Runnable() {\n                @Override\n                public void run() {\n                    checkUnlocked();\n                }\n            }, 100);\n        }\n    }\n}\n```\n\n\u6b21\u306bUnlockKeyguardActivity\u3092\u30c6\u30b9\u30c8\u5074\u306eAndroidManifest.xml\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\u3053\u306e\u3068\u304d\u306bandroid:exported=\"true\"\u306b\u3057\u3066\u304a\u304f\u306e\u304c\u5927\u4e8b\u3002\n\n```xml\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"net.cattaka.android.fastchecklist.test\"\n    >\n    <application>\n        <activity\n            android:name=\"net.cattaka.android.fastchecklist.test.UnlockKeyguardActivity\"\n            android:exported=\"true\"/>\n    </application>\n\n</manifest>\n```\n\n\u305d\u3057\u3066\u30c6\u30b9\u30c8\u306e\u958b\u59cb\u6642(setUp\u306a\u3069)\u306b\u30ad\u30fc\u30ac\u30fc\u30c9\u304c\u639b\u304b\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u639b\u304b\u3063\u3066\u3044\u305f\u3089UnlockKeyguardActivity\u3092\u8d77\u52d5\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```java\n    protected void setUp() throws Exception {\n        super.setUp();\n        {   // Unlock keyguard and screen on\n            KeyguardManager km = (KeyguardManager) getInstrumentation()\n                .getTargetContext().getSystemService(Context.KEYGUARD_SERVICE);\n            PowerManager pm = (PowerManager) getInstrumentation()\n                .getTargetContext().getSystemService(Context.POWER_SERVICE);\n            if (km.inKeyguardRestrictedInputMode() || !pm.isScreenOn()) {\n                Intent intent = new Intent(getInstrumentation().getContext(),\n                    UnlockKeyguardActivity.class);\n                intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n                getInstrumentation().getTargetContext().startActivity(intent);\n                while (km.inKeyguardRestrictedInputMode()) {\n                    SystemClock.sleep(100);\n                }\n            }\n        }\n    }\n```\n\nActivityInstrumentationTestCase2\u304b\u3089\u6d3e\u751f\u3055\u305b\u305f\u30af\u30e9\u30b9\u306b\u5b9f\u88c5\u3057\u3001\u305d\u306eActivity\u306e\u30c6\u30b9\u30c8\u3067\u306f\u305d\u306e\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u66f8\u304f\u3088\u3046\u306b\u3059\u308c\u3070\u81ea\u52d5\u3067\u30b9\u30af\u30ea\u30fc\u30f3\u30ed\u30c3\u30af\u3092\u89e3\u9664\u3057\u3066\u958b\u59cb\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n"}