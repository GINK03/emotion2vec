{"context": " More than 1 year has passed since last update.#+sbcl\n(defmacro mymacrolet ((name (&rest args) &body def) &body body &environment env)\n  (let ((expander (gensym (format nil \"~A-expander-\" name)))\n        (newenv (gensym \"ENV-\")) )\n    `(flet ((,expander (form lenv)\n              (declare (ignore lenv))\n              (cl:destructuring-bind (name ,@args) form\n                (declare (ignore name))\n                ,@def )))\n       (sb-walker::with-augmented-environment (,newenv ,env :macros `((,',name ,#',expander)))\n         (sb-walker:walk-form '(progn ,@body)\n                              ,newenv\n                              (lambda (form context env)\n                                (declare (ignore context))\n                                (macroexpand form env)))))))\n\n(macrolet ((foo (&rest args) `(list ,@args)))\n  (mymacrolet (bar (n) `(foo ,n ,n))\n    (bar 8)))\n;=>  (PROGN (LIST 8 8)) ; \u3082\u3046\u4e00\u6bb5\u8a55\u4fa1\u3055\u308c\u308c\u3070OK (8 8)\u3068\u306a\u3063\u3066\u6b32\u3057\u3044\n\n```cl\n#+sbcl\n(defmacro mymacrolet ((name (&rest args) &body def) &body body &environment env)\n  (let ((expander (gensym (format nil \"~A-expander-\" name)))\n        (newenv (gensym \"ENV-\")) )\n    `(flet ((,expander (form lenv)\n              (declare (ignore lenv))\n              (cl:destructuring-bind (name ,@args) form\n                (declare (ignore name))\n                ,@def )))\n       (sb-walker::with-augmented-environment (,newenv ,env :macros `((,',name ,#',expander)))\n         (sb-walker:walk-form '(progn ,@body)\n                              ,newenv\n                              (lambda (form context env)\n                                (declare (ignore context))\n                                (macroexpand form env)))))))\n\n(macrolet ((foo (&rest args) `(list ,@args)))\n  (mymacrolet (bar (n) `(foo ,n ,n))\n    (bar 8)))\n;=>  (PROGN (LIST 8 8)) ; \u3082\u3046\u4e00\u6bb5\u8a55\u4fa1\u3055\u308c\u308c\u3070OK (8 8)\u3068\u306a\u3063\u3066\u6b32\u3057\u3044\n```\n", "tags": ["common-lisp"]}