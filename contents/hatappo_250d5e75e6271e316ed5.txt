{"context": " More than 1 year has passed since last update.Luminus\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306edeployment\u306e\u7bc0\uff08 http://www.luminusweb.net/docs/deployment.md \uff09\u306e\u52dd\u624b\u306a\u548c\u8a33\u3002\n2016\u5e7402\u670828\u65e5\u6642\u70b9\u306e\u5185\u5bb9\u306b\u57fa\u3044\u3066\u3044\u307e\u3059\u3002\n\u539f\u6587\u306e\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u306f\uff1a https://github.com/luminus-framework/luminus/blob/master/resources/md/deployment.md\n\n\nDeployment\n\nContents\n\nRunning Standalone\nDeploying on Immutant App Server\nDeploying to Tomcat\nVPS Deployment\nApplication deployment\nFronting with Nginx\nSetting up SSL\nHeroku Deployment\nEnabling nREPL\n\n\nRunning Standalone\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30fc\u30f3\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001\u5358\u7d14\u306b\u3053\u3046\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002\nlein uberjar\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fjar\u306ftarget\u30d5\u30a9\u30eb\u30c0\u306b\u3042\u308a\u307e\u3059\u3002\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\njava -jar myapp.jar\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30fc\u30f3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u8d77\u52d5\u306b\u7d44\u307f\u8fbc\u307f\u306eImmutant\u30b5\u30fc\u30d0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u4f8b\u3048\u3070+jetty\u306a\u3069\u306eprofile\u3092\u4f7f\u3063\u305f\u3068\u3057\u305f\u3089\u3001\u4ee3\u308f\u308a\u306b\u5225\u306e\u30b5\u30fc\u30d0\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\u72ec\u81ea\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f$PORT\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4f8b\u3092\u3042\u3052\u308b\u3068:\nexport PORT=8080\njava -jar myapp.jar\n\n\nDeploying on Immutant App Server\nImmutant\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u3064\u3044\u3066\u306f\u3001Immutant\u306e\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u6982\u7565\u3055\u308c\u3066\u3044\u308b\u30b9\u30c6\u30c3\u30d7\u3092\u306a\u305e\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002Linode\u306b\u3082\u3001Ubuntu14.04\u4e0a\u3067Immutant\u3068WildFly\u3092\u4f7f\u3063\u305fLuminus\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u306e\u4ed5\u65b9\u306b\u3064\u3044\u3066\u306e\u624b\u5f15\u304d\u304c\u3042\u308a\u307e\u3059\u3002\n\nDeploying to Tomcat\nApache Tomcat \u306e\u3088\u3046\u306a\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u305f\u3081\u306b\u306fWAR\u5f62\u5f0f\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001+warprofile\u3092\u4f7f\u7528\u3059\u308b\u3068\u540c\u68b1\u3055\u308c\u308blein-uberwar\u30d7\u30e9\u30b0\u30a4\u30f3\u3060\u3051\u304c\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nlein-uberwar\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6709\u52b9\u306b\u3059\u308b\u306b\u306f\u3001project.clj\u30d5\u30a1\u30a4\u30eb\u306b\u6b21\u306e\u8a2d\u5b9a\u3092\u624b\u52d5\u3067\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n:plugins [...\n          [lein-uberwar \"0.1.0\"]]\n\n  :uberwar {:handler <app>.handler/app\n            :init <app>.handler/init\n            :destroy <app>.handler/destroy\n            :name \"<app>.war\"}\n\nWAR\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3046\u5b9f\u884c\u3057\u307e\u3059\u3002\nlein uberwar\n\n\u6b21\u306b\u3001\u751f\u6210\u3055\u308c\u305f<app>.war\u3092\u5358\u7d14\u306bTomcat\u306ewebapps\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3059\u308c\u3070OK\u3067\u3059\u3002\u4f8b\u3048\u3070:\ncp target/<app>.war ~/tomcat/webapps/\n\n\u3059\u308b\u3068\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fTomcat\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\u306b/<app>\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30eb\u30fc\u30c8\u30fb\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u304b\u3063\u305f\u3089\u3001\u5358\u306bwebapp\u914d\u4e0b\u306bWAR\u3092ROOT.war\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308c\u3070OK\u3067\u3059\u3002\n\nVPS Deployment\nDigitalOcean\u306e\u3088\u3046\u306a\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30fb\u30b5\u30fc\u30d0\uff08VPS\uff09\u306f\u3001Clojure\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5411\u3051\u306e\u5b89\u4fa1\u306a\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30fb\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u3042\u306a\u305f\u306eDigitalOcean\u30b5\u30fc\u30d0\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u306b\u306f\u3053\u306e\u624b\u5f15\u304d\u306b\u3068\u304a\u308a\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u3044\u3063\u305f\u3093\u30b5\u30fc\u30d0\u304c\u4f5c\u6210\u3055\u308c\u308b\u3068\u3001\u3053\u3053\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306bUbuntu\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u6700\u7d42\u7684\u306b\u3001\u3053\u306e\u624b\u9806\u306b\u5f93\u3063\u3066\u3042\u306a\u305f\u306eUbuntu\u306bjava\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4ee5\u964d\u3067\u793a\u3059\u624b\u9806\u306f\u3001Ubuntu15.04\u304b\u305d\u308c\u3088\u308a\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\nApplication deployment\n\u3053\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u306f\u3001\u30b5\u30fc\u30d0\u306b\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3001\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\u3068\u81ea\u52d5\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u958b\u59cb\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u5b9f\u73fe\u3059\u308b\u306e\u306bsystemd\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308bdeploy\u30e6\u30fc\u30b6\u3092\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nsudo adduser -m deploy\nsudo passwd -l deploy\n\n\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306b\u3001\u30b5\u30fc\u30d0\u4e0a\u306b/var/myapp\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305d\u3057\u3066\u3001scp\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ scp myapp.jar user@<domain>:/var/myapp/\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8d77\u52d5\u53ef\u80fd\u304b\u4e00\u5ea6\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b\u3079\u304d\u3067\u3059\u3002ssh\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\njava -jar /var/myapp/myapp.jar\n\n\u3082\u3057\u5168\u3066\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u671f\u5f85\u901a\u308a\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncurl http://127.0.0.1:3000/\n\n\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u4eca\u3084\u30b5\u30fc\u30d0\u4e0a\u3067http://<domain>:3000\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u3082\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u304b\u3063\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30e4\u30fc\u30a6\u30a9\u30fc\u30eb\u304c\u3053\u306e\u30dd\u30fc\u30c8\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u306a\u305f\u304c\u5229\u7528\u3057\u3066\u3044\u308bVPS\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u306b\u3088\u3063\u3066\u306f\u30013000\u756a\u30dd\u30fc\u30c8\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nAzure \u3067\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\nAmazon EC2 \u3067\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\n\u3053\u3053\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u5ea6\u505c\u6b62\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u7ba1\u7406\u3059\u308bsystemd\u306e\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u3068\u308a\u308f\u3051\u3001\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u958b\u59cb\u3059\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002/lib/systemd/system/myapp.service\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u4e2d\u8eab\u3092\u6b21\u306e\u3068\u304a\u308a\u306b\u3057\u307e\u3059\u3002\n[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nWorkingDirectory=/var/myapp\nEnvironmentFile=-/var/myapp/env\nEnvironment=\"DATABASE_URL=jdbc:postgresql://localhost/app?user=app_user&password=secret\"\nExecStart=/usr/bin/java -jar /var/myapp/myapp.jar\nUser=deploy\n\n[Install]\nWantedBy=multi-user.target\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306eJVM\u306f\u304b\u306a\u308a\u30a2\u30b0\u30ec\u30c3\u30b7\u30d6\u306a\u30e1\u30e2\u30ea\u306e\u4f7f\u3044\u65b9\u3092\u3059\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3057JVM\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u306e\u91cf\u3092\u6e1b\u3089\u3057\u305f\u304b\u3063\u305f\u3089\u3001 \u6b21\u306e1\u884c\u3092[Service]\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n[Service]\n...\n_JAVA_OPTIONS=\"-Xmx256m\"\nExecStart=/usr/bin/java -jar /var/myapp/myapp.jar\n\n\u3053\u306e\u8a2d\u5b9a\u306f\u3001JVM\u306b\u4f7f\u7528\u3092\u8a31\u53ef\u3059\u308b\u30e1\u30e2\u30ea\u306e\u6700\u5927\u91cf\u3092\u5236\u9650\u3057\u307e\u3059\u3002\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u518d\u8d77\u52d5\u304c\u304b\u304b\u308b\u305f\u3073\u306b\u6bce\u56de\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3059\u308b\u3088\u3046\u306bsystemd\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nsudo systemctl daemon-reload\nsudo systemctl enable myapp.service\n\n\u30b7\u30b9\u30c6\u30e0\u304c\u518d\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u958b\u59cb\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u6e96\u5099\u304c\u6574\u3044\u307e\u3059\u3002\u30c6\u30b9\u30c8\u3057\u305f\u304f\u306a\u308b\u3093\u3058\u3083\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5358\u7d14\u306b\u3042\u306a\u305f\u306e\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3057\u3001\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nps -ef | grep java\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4f55\u304b\u3053\u3093\u306a\u611f\u3058\u306e\u3092\u8fd4\u3057\u307e\u3059\u3002UID\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u304cdeploy\u306b\u306a\u3063\u3066\u3044\u308b\u3079\u304d\u3067\u3059\u3002root\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u305f\u3089\u91cd\u5927\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u30ea\u30b9\u30af\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3067\u3057\u3087\u3046\u3002\ndeploy     730     1  1 06:45 ?        00:00:42 /usr/bin/java -jar /var/mysite/mysite.jar\n\n\nFronting with Nginx\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ sudo apt-get install nginx\n\n\u6b21\u306b\u3001/etc/nginx/sites-available/default\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u884c\u3063\u3066\u3001\u305d\u308c\u3092\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u72ec\u81ea\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u4f8b\u3048\u3070\u3053\u3093\u306a\u3075\u3046\u306b:\nserver{\n  listen 80 default_server;\n  listen [::]:80 default_server ipv6only=on;\n  server_name localhost mydomain.com www.mydomain.com;\n\n  access_log /var/log/myapp_access.log;\n  error_log /var/log/myapp_error.log;\n\n  location / {\n    proxy_pass http://localhost:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_redirect  off;\n  }\n}\n\n\u3053\u3046\u5b9f\u884c\u3057\u3066Nginx\u3092\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nsudo service nginx restart\n\n\u305d\u308c\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304chttp://<domain>\u3067\u5229\u7528\u53ef\u80fd\u306a\u3053\u3068\u3092\u30c6\u30b9\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u8ffd\u52a0\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u3092Nginx\u306b\u914d\u5e03\u3055\u305b\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u3084\u308b\u306b\u306f\u3001\u5168\u3066\u306e\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u304cstatic\u306a\u3069\u306e\u5171\u901a\u306e\u63a5\u982d\u8f9e\u3092\u4f7f\u3063\u3066\u914d\u4fe1\u3055\u308c\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u6b21\u306b\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a9\u30eb\u30c0\u3067\u6b21\u306e\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001resources/public/static\u30d5\u30a9\u30eb\u30c0\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u30b5\u30fc\u30d0\u4e0a\u306e/var/myapp/static\u306a\u3069\u306e\u5834\u6240\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nscp -r resources/public/static user@<domain>:/var/myapp/static\n\n\u6b21\u306e\u8ffd\u52a0\u8a2d\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3001Nginx\u306e\u8a2d\u5b9a\u306eserver\u30bb\u30af\u30b7\u30e7\u30f3\u4ee5\u4e0b\u306b\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nlocation /static/ {\n    alias /var/myapp/static/;\n  }\n\nhttp://<domain>/static\u3078\u306e\u3042\u3089\u3086\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u3064\u3044\u3066\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8fc2\u56de\u3057\u305d\u306e\u4ee3\u308f\u308a\u306b\u76f4\u63a5\u914d\u4fe1\u3059\u308b\u3088\u3046\u306bNginx\u3055\u305b\u307e\u3059\u3002\n\u5727\u7e2e\u3092\u6709\u52b9\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u6b21\u306e\u8a2d\u5b9a\u304c\u3042\u306a\u305f\u306e/etc/nginx/nginx.conf\u306b\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002\ngzip on;\ngzip_disable \"msie6\";\n\ngzip_vary on;\ngzip_proxied any;\ngzip_comp_level 6;\ngzip_buffers 16 8k;\ngzip_http_version 1.1;\ngzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\">\n\n\nSetting up SSL\n\u3082\u3057\u3042\u306a\u305f\u306e\u30b5\u30a4\u30c8\u304c\u306a\u3093\u3089\u304b\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3092\u884c\u3046\u306a\u3089\u3001HTTPS\u3092\u4f7f\u3044\u305f\u3044\u3067\u3057\u3087\u3046\u3002\u307e\u305a\u5fc5\u8981\u306a\u306e\u306f\u3001SSL\u8a3c\u660e\u66f8\u3068\u305d\u306e\u9375\u3067\u3059\u3002\u3053\u306e2\u3064\u3092\u305d\u308c\u305e\u308ccert.crt\u3068cert.key\u3068\u547c\u3073\u307e\u3059\u3002\n\nSetting up SSL Certificate using Let's Encrypt\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30c4\u30fc\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ngit clone https://github.com/letsencrypt/letsencrypt\ncd letsencrypt\n/letsencrypt-auto certonly --email <you@email.com> -d <yoursite.com> -d <www.yoursite.com> --webroot --webroot-path /var/www/html\n\n\u8ffd\u52a0\u3067\u3001\u8a3c\u660e\u66f8\u3092\u81ea\u52d5\u3067\u66f4\u65b0\u3059\u308b\u305f\u3081\u306bCron\u306e\u30b8\u30e7\u30d6\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002root\u3067\u3053\u3046\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067crontab\u304c\u66f4\u65b0\u3067\u304d\u307e\u3059\u3002\nsu\ncrontab -e\n\n\u6b21\u306e1\u884c\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n0 0 1,15 * * /path-to-letsencrypt/letsencrypt-auto certonly --keep-until-expiring --email <you@email.com> -d <yoursite.com> -d <www.yoursite.com> --webroot --webroot-path /var/www/html\n\nOpenSSL\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u4f7f\u7528\u3059\u308b\u4ee3\u308f\u308a\u306b\u3001\u3088\u308a\u5f37\u529b\u306aDHE\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u3053\u308c\u306f\u3001\u9375\u4ea4\u63db\u306b1024-bit\u306e\u9375\u3092\u8fbc\u3081\u307e\u3059\u3002\ncd /etc/ssl/certs\nopenssl dhparam -out dhparam.pem 4096\n\n\u6b21\u306b\u3001/etc/nginx/sites-available/default\u5185\u306e\u8a2d\u5b9a\u3092\u6b21\u306e\u3088\u3046\u306b\u66f4\u65b0\u3057\u305f\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\nserver {\n    listen 80;\n    return 301 https://$host$request_uri;\n}\n\nserver {\n\n    listen 443;\n    server_name localhost mydomain.com www.mydomain.com;\n\n    ssl_certificate           /etc/letsencrypt/live/<yoursite.com>/fullchain.pem;\n    ssl_certificate_key       /etc/letsencrypt/live/<yoursite.com>/privkey.pem;\n\n    ssl on;\n    ssl_prefer_server_ciphers  on;\n    ssl_session_timeout        180m;\n    ssl_session_cache  builtin:1000  shared:SSL:10m;\n    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers 'AES256+EECDH:AES256+EDH';\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n    add_header Strict-Transport-Security 'max-age=31536000';\n\n    access_log /var/log/myapp_access.log;\n    error_log /var/log/myapp_error.log;\n\n    location / {\n\n      proxy_set_header        Host $host;\n      proxy_set_header        X-Real-IP $remote_addr;\n      proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header        X-Forwarded-Proto $scheme;\n\n      # Fix the \u201cIt appears that your reverse proxy set up is broken\" error.\n      proxy_pass          http://localhost:3000;\n      proxy_read_timeout  90;\n\n      proxy_redirect      http://localhost:3000 https://mydomain.com;\n    }\n  }\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u306fNginx\u306b\u3001HTTP\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092HTTPS\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3001\u914d\u4fe1\u3067\u3055\u3063\u304d\u306e\u8a3c\u660e\u66f8\u3092\u4f7f\u7528\u3059\u308b\u306b\u3088\u3046\u306b\u3055\u305b\u307e\u3059\u3002\n\u6700\u7d42\u7684\u306b\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u7279\u5b9a\u306e\u30dd\u30fc\u30c8\u3060\u3051\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30e4\u30fc\u30fb\u30a6\u30a9\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$ sudo ufw allow ssh\n$ sudo ufw allow http\n$ sudo ufw allow https\n$ sudo ufw enable\n\nSSL Server Test\u3092\u4f7f\u7528\u3059\u308c\u3070\u3001SSL\u306e\u8a2d\u5b9a\u3092\u30c6\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nHeroku Deployment\n\u307e\u305a\u3001Git\u3068Heroku toolbelt\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3001\u4ee5\u4e0b\u306e\u30b9\u30c6\u30c3\u30d7\u306b\u5f93\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u3084\u308a\u305f\u304b\u3063\u305f\u3089\u3067\u826f\u3044\u3067\u3059\u304c\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u30c6\u30b9\u30c8\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3046\u3059\u308c\u3070OK\u3067\u3059\u3002\nheroku local\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u3001\u3042\u306a\u3089\u306egit\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u521d\u671f\u5316\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30df\u30c3\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ngit init\ngit add .\ngit commit -m \"init\"\n\nHeroku\u306b\u3042\u306a\u305f\u306eapp\u3092\u4f5c\u6210\nheroku create\n\n\u4efb\u610f\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\nheroku addons:create heroku-postgresql\n\n\u63a5\u7d9a\u8a2d\u5b9a\u306f\u3001app\u306eadd-ons\u914d\u4e0b\u306eHeroku dashboard\u306b\u3042\u308a\u307e\u3059\u3002\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\ngit push heroku master\n\n\u3053\u308c\u3067\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fHeroku\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u306f\u305a\u3060\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u66f4\u65b0\u307e\u305f\u306f\u521d\u671f\u5316\u3059\u308b\u305f\u3081\u306b\nheroku run lein run migrate\n\n\u3055\u3089\u306a\u308b\u624b\u9806\u306f\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\nEnabling nREPL\nLuminus\u306f\u30b5\u30fc\u30d0\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u3053\u3068\u3092\u53ef\u80fd\u306b\u3059\u308bnREPL\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u306f\u3001\u7a3c\u50cd\u4e2d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092hotfix\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u30c7\u30d0\u30c3\u30b0\u5168\u822c\u306b\u4fbf\u5229\u3067\u3059\u3002nREPL\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\u306b\u306f\u3001NREPL_PORT\u74b0\u5883\u5909\u6570\u306b\u5229\u7528\u3057\u305f\u3044\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nexport NREPL_PORT=7000\n\nREPL\u306e\u63a5\u7d9a\u3092\u30c6\u30b9\u30c8\u3059\u308b\u306a\u3089\u3001\u5358\u306b\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nlein repl :connect 7001\n\n\u30ed\u30fc\u30ab\u30eb\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u306e\u3068\u5168\u304f\u540c\u3058\u3088\u3046\u306b\u3057\u3066\u3001\u597d\u304d\u306aIDE\u304b\u3089\u30ea\u30e2\u30fc\u30c8\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u30ea\u30e2\u30fc\u30c8\u306e\u30b5\u30fc\u30d0\u3067nREPL\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001SSH\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u30fb\u30de\u30b7\u30f3\u306bREPL\u306e\u30dd\u30fc\u30c8\u3092\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\nssh -L 7001:localhost:7001 remotehost\n\nLuminus\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306edeployment\u306e\u7bc0\uff08 http://www.luminusweb.net/docs/deployment.md \uff09\u306e\u52dd\u624b\u306a\u548c\u8a33\u3002\n**2016\u5e7402\u670828\u65e5\u6642\u70b9\u306e\u5185\u5bb9\u306b\u57fa\u3044\u3066**\u3044\u307e\u3059\u3002  \n\u539f\u6587\u306e\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u306f\uff1a https://github.com/luminus-framework/luminus/blob/master/resources/md/deployment.md\n\n\n----\n\n# Deployment\n\n## Contents\n\n0. [Running Standalone](#running-standalone)\n0. [Deploying on Immutant App Server](#deploying-on-immutant-app-server)\n0. [Deploying to Tomcat](#deploying-to-tomcat)\n0. [VPS Deployment](#vps-deployment)\n0. [Application deployment](#application-deployment)\n0. [Fronting with Nginx](#fronting-with-nginx)\n0. [Setting up SSL](#setting-up-ssl)\n0. [Heroku Deployment](#heroku-deployment)\n0. [Enabling nREPL](#enabling-nrepl)\n\n## Running Standalone\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30fc\u30f3\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001\u5358\u7d14\u306b\u3053\u3046\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n```\nlein uberjar\n```\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305f`jar`\u306f`target`\u30d5\u30a9\u30eb\u30c0\u306b\u3042\u308a\u307e\u3059\u3002\u6b21\u306e\u3088\u3046\u306b\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\n```\njava -jar myapp.jar\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30b9\u30bf\u30f3\u30c9\u30a2\u30ed\u30fc\u30f3\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u8d77\u52d5\u306b\u7d44\u307f\u8fbc\u307f\u306eImmutant\u30b5\u30fc\u30d0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001\u4f8b\u3048\u3070`+jetty`\u306a\u3069\u306eprofile\u3092\u4f7f\u3063\u305f\u3068\u3057\u305f\u3089\u3001\u4ee3\u308f\u308a\u306b\u5225\u306e\u30b5\u30fc\u30d0\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\u72ec\u81ea\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f`$PORT`\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4f8b\u3092\u3042\u3052\u308b\u3068:\n\n```\nexport PORT=8080\njava -jar myapp.jar\n```\n\n## Deploying on Immutant App Server\n\nImmutant\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u3064\u3044\u3066\u306f\u3001[Immutant\u306e\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://immutant.org/documentation/2.0.2/apidoc/guide-installation.html)\u3067\u6982\u7565\u3055\u308c\u3066\u3044\u308b\u30b9\u30c6\u30c3\u30d7\u3092\u306a\u305e\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002[Linode](http://linode.com/)\u306b\u3082\u3001[Ubuntu14.04\u4e0a\u3067Immutant\u3068WildFly\u3092\u4f7f\u3063\u305fLuminus\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u306e\u4ed5\u65b9](https://linode.com/docs/applications/development/clojure-deployment-with-immutant-and-wildfly-on-ubuntu-14-04)\u306b\u3064\u3044\u3066\u306e\u624b\u5f15\u304d\u304c\u3042\u308a\u307e\u3059\u3002\n\n## Deploying to Tomcat\n\nApache Tomcat \u306e\u3088\u3046\u306a\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u305f\u3081\u306b\u306fWAR\u5f62\u5f0f\u306e\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001`+war`profile\u3092\u4f7f\u7528\u3059\u308b\u3068\u540c\u68b1\u3055\u308c\u308b[lein-uberwar](https://github.com/luminus-framework/lein-uberwar)\u30d7\u30e9\u30b0\u30a4\u30f3\u3060\u3051\u304c\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n`lein-uberwar`\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6709\u52b9\u306b\u3059\u308b\u306b\u306f\u3001`project.clj`\u30d5\u30a1\u30a4\u30eb\u306b\u6b21\u306e\u8a2d\u5b9a\u3092\u624b\u52d5\u3067\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```clojure\n:plugins [...\n          [lein-uberwar \"0.1.0\"]]\n\n  :uberwar {:handler <app>.handler/app\n            :init <app>.handler/init\n            :destroy <app>.handler/destroy\n            :name \"<app>.war\"}\n```\n\nWAR\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u3046\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nlein uberwar\n```\n\n\u6b21\u306b\u3001\u751f\u6210\u3055\u308c\u305f`<app>.war`\u3092\u5358\u7d14\u306bTomcat\u306e`webapps`\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3059\u308c\u3070OK\u3067\u3059\u3002\u4f8b\u3048\u3070:\n\n```\ncp target/<app>.war ~/tomcat/webapps/\n```\n\n\u3059\u308b\u3068\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fTomcat\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\u306b`/<app>`\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30eb\u30fc\u30c8\u30fb\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u304b\u3063\u305f\u3089\u3001\u5358\u306b`webapp`\u914d\u4e0b\u306bWAR\u3092`ROOT.war`\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u30b3\u30d4\u30fc\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n## VPS Deployment\n\n[DigitalOcean](https://www.digitalocean.com/)\u306e\u3088\u3046\u306a\u4eee\u60f3\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30fb\u30b5\u30fc\u30d0\uff08VPS\uff09\u306f\u3001Clojure\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5411\u3051\u306e\u5b89\u4fa1\u306a\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u30fb\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u3042\u306a\u305f\u306eDigitalOcean\u30b5\u30fc\u30d0\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u306b\u306f[\u3053\u306e\u624b\u5f15\u304d](https://www.digitalocean.com/community/tutorials/how-to-create-your-first-digitalocean-droplet-virtual-server)\u306b\u3068\u304a\u308a\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u3044\u3063\u305f\u3093\u30b5\u30fc\u30d0\u304c\u4f5c\u6210\u3055\u308c\u308b\u3068\u3001[\u3053\u3053\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3088\u3046\u306b](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-12-04)Ubuntu\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u6700\u7d42\u7684\u306b\u3001[\u3053\u306e\u624b\u9806](https://help.ubuntu.com/community/Java)\u306b\u5f93\u3063\u3066\u3042\u306a\u305f\u306eUbuntu\u306bjava\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4ee5\u964d\u3067\u793a\u3059\u624b\u9806\u306f\u3001Ubuntu15.04\u304b\u305d\u308c\u3088\u308a\u65b0\u3057\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n### Application deployment\n\n\u3053\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u306f\u3001\u30b5\u30fc\u30d0\u306b\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3001\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\u3068\u81ea\u52d5\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u958b\u59cb\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u5b9f\u73fe\u3059\u308b\u306e\u306b`systemd`\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3059\u308b`deploy`\u30e6\u30fc\u30b6\u3092\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nsudo adduser -m deploy\nsudo passwd -l deploy\n```\n\n\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306b\u3001\u30b5\u30fc\u30d0\u4e0a\u306b`/var/myapp`\u306e\u3088\u3046\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305d\u3057\u3066\u3001`scp`\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ scp myapp.jar user@<domain>:/var/myapp/\n```\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u8d77\u52d5\u53ef\u80fd\u304b\u4e00\u5ea6\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b\u3079\u304d\u3067\u3059\u3002`ssh`\u3092\u4f7f\u3063\u3066\u30b5\u30fc\u30d0\u306b\u63a5\u7d9a\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\njava -jar /var/myapp/myapp.jar\n```\n\n\u3082\u3057\u5168\u3066\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u671f\u5f85\u901a\u308a\u52d5\u3044\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\ncurl http://127.0.0.1:3000/\n```\n\n\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u4eca\u3084\u30b5\u30fc\u30d0\u4e0a\u3067`http://<domain>:3000`\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u3082\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u304b\u3063\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30e4\u30fc\u30a6\u30a9\u30fc\u30eb\u304c\u3053\u306e\u30dd\u30fc\u30c8\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u306a\u305f\u304c\u5229\u7528\u3057\u3066\u3044\u308bVPS\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u306b\u3088\u3063\u3066\u306f\u30013000\u756a\u30dd\u30fc\u30c8\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n* [Azure \u3067\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b](https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-set-up-endpoints/)\n* [Amazon EC2 \u3067\u30a2\u30af\u30bb\u30b9\u30fb\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html#adding-security-group-rule)\n\n\u3053\u3053\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u5ea6\u505c\u6b62\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u7ba1\u7406\u3059\u308b`systemd`\u306e\u8a2d\u5b9a\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u3068\u308a\u308f\u3051\u3001\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u958b\u59cb\u3059\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002`/lib/systemd/system/myapp.service`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001\u4e2d\u8eab\u3092\u6b21\u306e\u3068\u304a\u308a\u306b\u3057\u307e\u3059\u3002\n\n```\n[Unit]\nDescription=My Application\nAfter=network.target\n\n[Service]\nWorkingDirectory=/var/myapp\nEnvironmentFile=-/var/myapp/env\nEnvironment=\"DATABASE_URL=jdbc:postgresql://localhost/app?user=app_user&password=secret\"\nExecStart=/usr/bin/java -jar /var/myapp/myapp.jar\nUser=deploy\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306eJVM\u306f\u304b\u306a\u308a\u30a2\u30b0\u30ec\u30c3\u30b7\u30d6\u306a\u30e1\u30e2\u30ea\u306e\u4f7f\u3044\u65b9\u3092\u3059\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3057JVM\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u306e\u91cf\u3092\u6e1b\u3089\u3057\u305f\u304b\u3063\u305f\u3089\u3001\t\u6b21\u306e1\u884c\u3092`[Service]`\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n[Service]\n...\n_JAVA_OPTIONS=\"-Xmx256m\"\nExecStart=/usr/bin/java -jar /var/myapp/myapp.jar\n```\n\n\u3053\u306e\u8a2d\u5b9a\u306f\u3001JVM\u306b\u4f7f\u7528\u3092\u8a31\u53ef\u3059\u308b\u30e1\u30e2\u30ea\u306e\u6700\u5927\u91cf\u3092\u5236\u9650\u3057\u307e\u3059\u3002\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u518d\u8d77\u52d5\u304c\u304b\u304b\u308b\u305f\u3073\u306b\u6bce\u56de\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u958b\u59cb\u3059\u308b\u3088\u3046\u306b`systemd`\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\nsudo systemctl daemon-reload\nsudo systemctl enable myapp.service\n```\n\n\u30b7\u30b9\u30c6\u30e0\u304c\u518d\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u958b\u59cb\u3057\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u51e6\u7406\u3059\u308b\u6e96\u5099\u304c\u6574\u3044\u307e\u3059\u3002\u30c6\u30b9\u30c8\u3057\u305f\u304f\u306a\u308b\u3093\u3058\u3083\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\u5358\u7d14\u306b\u3042\u306a\u305f\u306e\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3057\u3001\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nps -ef | grep java\n```\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4f55\u304b\u3053\u3093\u306a\u611f\u3058\u306e\u3092\u8fd4\u3057\u307e\u3059\u3002`UID`\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u304c`deploy`\u306b\u306a\u3063\u3066\u3044\u308b\u3079\u304d\u3067\u3059\u3002`root`\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u305f\u3089\u91cd\u5927\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fb\u30ea\u30b9\u30af\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3067\u3057\u3087\u3046\u3002\n\n```\ndeploy     730     1  1 06:45 ?        00:00:42 /usr/bin/java -jar /var/mysite/mysite.jar\n```\n\n### Fronting with Nginx\n\n\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067Nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ sudo apt-get install nginx\n```\n\n\u6b21\u306b\u3001`/etc/nginx/sites-available/default`\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u884c\u3063\u3066\u3001\u305d\u308c\u3092\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u72ec\u81ea\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u4f8b\u3048\u3070\u3053\u3093\u306a\u3075\u3046\u306b:\n\n```\nserver{\n  listen 80 default_server;\n  listen [::]:80 default_server ipv6only=on;\n  server_name localhost mydomain.com www.mydomain.com;\n\n  access_log /var/log/myapp_access.log;\n  error_log /var/log/myapp_error.log;\n\n  location / {\n    proxy_pass http://localhost:3000/;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_redirect  off;\n  }\n}\n```\n\n\u3053\u3046\u5b9f\u884c\u3057\u3066Nginx\u3092\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nsudo service nginx restart\n```\n\n\u305d\u308c\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c`http://<domain>`\u3067\u5229\u7528\u53ef\u80fd\u306a\u3053\u3068\u3092\u30c6\u30b9\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u8ffd\u52a0\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u3092Nginx\u306b\u914d\u5e03\u3055\u305b\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u3084\u308b\u306b\u306f\u3001\u5168\u3066\u306e\u9759\u7684\u30ea\u30bd\u30fc\u30b9\u304c`static`\u306a\u3069\u306e\u5171\u901a\u306e\u63a5\u982d\u8f9e\u3092\u4f7f\u3063\u3066\u914d\u4fe1\u3055\u308c\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\u6b21\u306b\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a9\u30eb\u30c0\u3067\u6b21\u306e\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001`resources/public/static`\u30d5\u30a9\u30eb\u30c0\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u30b5\u30fc\u30d0\u4e0a\u306e`/var/myapp/static`\u306a\u3069\u306e\u5834\u6240\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nscp -r resources/public/static user@<domain>:/var/myapp/static\n```\n\n\u6b21\u306e\u8ffd\u52a0\u8a2d\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3001Nginx\u306e\u8a2d\u5b9a\u306e`server`\u30bb\u30af\u30b7\u30e7\u30f3\u4ee5\u4e0b\u306b\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nlocation /static/ {\n    alias /var/myapp/static/;\n  }\n```\n\n`http://<domain>/static`\u3078\u306e\u3042\u3089\u3086\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u3064\u3044\u3066\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8fc2\u56de\u3057\u305d\u306e\u4ee3\u308f\u308a\u306b\u76f4\u63a5\u914d\u4fe1\u3059\u308b\u3088\u3046\u306bNginx\u3055\u305b\u307e\u3059\u3002\n\n\u5727\u7e2e\u3092\u6709\u52b9\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u6b21\u306e\u8a2d\u5b9a\u304c\u3042\u306a\u305f\u306e`/etc/nginx/nginx.conf`\u306b\u5b58\u5728\u3059\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\ngzip on;\ngzip_disable \"msie6\";\n\ngzip_vary on;\ngzip_proxied any;\ngzip_comp_level 6;\ngzip_buffers 16 8k;\ngzip_http_version 1.1;\ngzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\">\n```\n\n### Setting up SSL\n\n\u3082\u3057\u3042\u306a\u305f\u306e\u30b5\u30a4\u30c8\u304c\u306a\u3093\u3089\u304b\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u3092\u884c\u3046\u306a\u3089\u3001HTTPS\u3092\u4f7f\u3044\u305f\u3044\u3067\u3057\u3087\u3046\u3002\u307e\u305a\u5fc5\u8981\u306a\u306e\u306f\u3001SSL\u8a3c\u660e\u66f8\u3068\u305d\u306e\u9375\u3067\u3059\u3002\u3053\u306e2\u3064\u3092\u305d\u308c\u305e\u308c`cert.crt`\u3068`cert.key`\u3068\u547c\u3073\u307e\u3059\u3002\n\n#### Setting up SSL Certificate using Let's Encrypt\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u30c4\u30fc\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\ngit clone https://github.com/letsencrypt/letsencrypt\ncd letsencrypt\n/letsencrypt-auto certonly --email <you@email.com> -d <yoursite.com> -d <www.yoursite.com> --webroot --webroot-path /var/www/html\n```\n\n\u8ffd\u52a0\u3067\u3001\u8a3c\u660e\u66f8\u3092\u81ea\u52d5\u3067\u66f4\u65b0\u3059\u308b\u305f\u3081\u306bCron\u306e\u30b8\u30e7\u30d6\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u304f\u3060\u3055\u3044\u3002`root`\u3067\u3053\u3046\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067crontab\u304c\u66f4\u65b0\u3067\u304d\u307e\u3059\u3002\n\n```\nsu\ncrontab -e\n```\n\n\u6b21\u306e1\u884c\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n0 0 1,15 * * /path-to-letsencrypt/letsencrypt-auto certonly --keep-until-expiring --email <you@email.com> -d <yoursite.com> -d <www.yoursite.com> --webroot --webroot-path /var/www/html\n```\n\nOpenSSL\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u4f7f\u7528\u3059\u308b\u4ee3\u308f\u308a\u306b\u3001\u3088\u308a\u5f37\u529b\u306aDHE\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u3053\u308c\u306f\u3001\u9375\u4ea4\u63db\u306b1024-bit\u306e\u9375\u3092\u8fbc\u3081\u307e\u3059\u3002\n\n```\ncd /etc/ssl/certs\nopenssl dhparam -out dhparam.pem 4096\n```\n\n\u6b21\u306b\u3001`/etc/nginx/sites-available/default`\u5185\u306e\u8a2d\u5b9a\u3092\u6b21\u306e\u3088\u3046\u306b\u66f4\u65b0\u3057\u305f\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\n```\nserver {\n    listen 80;\n    return 301 https://$host$request_uri;\n}\n\nserver {\n\n    listen 443;\n    server_name localhost mydomain.com www.mydomain.com;\n\n    ssl_certificate           /etc/letsencrypt/live/<yoursite.com>/fullchain.pem;\n    ssl_certificate_key       /etc/letsencrypt/live/<yoursite.com>/privkey.pem;\n\n    ssl on;\n    ssl_prefer_server_ciphers  on;\n    ssl_session_timeout        180m;\n    ssl_session_cache  builtin:1000  shared:SSL:10m;\n    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers 'AES256+EECDH:AES256+EDH';\n    ssl_dhparam /etc/ssl/certs/dhparam.pem;\n    add_header Strict-Transport-Security 'max-age=31536000';\n\n    access_log /var/log/myapp_access.log;\n    error_log /var/log/myapp_error.log;\n\n    location / {\n\n      proxy_set_header        Host $host;\n      proxy_set_header        X-Real-IP $remote_addr;\n      proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header        X-Forwarded-Proto $scheme;\n\n      # Fix the \u201cIt appears that your reverse proxy set up is broken\" error.\n      proxy_pass          http://localhost:3000;\n      proxy_read_timeout  90;\n\n      proxy_redirect      http://localhost:3000 https://mydomain.com;\n    }\n  }\n```\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u306fNginx\u306b\u3001HTTP\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092HTTPS\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3001\u914d\u4fe1\u3067\u3055\u3063\u304d\u306e\u8a3c\u660e\u66f8\u3092\u4f7f\u7528\u3059\u308b\u306b\u3088\u3046\u306b\u3055\u305b\u307e\u3059\u3002\n\n\u6700\u7d42\u7684\u306b\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u7279\u5b9a\u306e\u30dd\u30fc\u30c8\u3060\u3051\u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30e4\u30fc\u30fb\u30a6\u30a9\u30fc\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ sudo ufw allow ssh\n$ sudo ufw allow http\n$ sudo ufw allow https\n$ sudo ufw enable\n```\n\n[SSL Server Test](https://www.ssllabs.com/ssltest/)\u3092\u4f7f\u7528\u3059\u308c\u3070\u3001SSL\u306e\u8a2d\u5b9a\u3092\u30c6\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## Heroku Deployment\n\n\u307e\u305a\u3001[Git](http://git-scm.com/downloads)\u3068[Heroku toolbelt](https://toolbelt.heroku.com/)\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3001\u4ee5\u4e0b\u306e\u30b9\u30c6\u30c3\u30d7\u306b\u5f93\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3084\u308a\u305f\u304b\u3063\u305f\u3089\u3067\u826f\u3044\u3067\u3059\u304c\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3092\u30c6\u30b9\u30c8\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3046\u3059\u308c\u3070OK\u3067\u3059\u3002\n\n```\nheroku local\n```\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u3001\u3042\u306a\u3089\u306egit\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u521d\u671f\u5316\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30df\u30c3\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\ngit init\ngit add .\ngit commit -m \"init\"\n```\n\nHeroku\u306b\u3042\u306a\u305f\u306eapp\u3092\u4f5c\u6210\n\n```\nheroku create\n```\n\n\u4efb\u610f\u3067\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u4f7f\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\n\n```\nheroku addons:create heroku-postgresql\n```\n\n\u63a5\u7d9a\u8a2d\u5b9a\u306f\u3001app\u306eadd-ons\u914d\u4e0b\u306e[Heroku dashboard](https://dashboard.heroku.com/apps/)\u306b\u3042\u308a\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30c7\u30d7\u30ed\u30a4\n\n```\ngit push heroku master\n```\n\n\u3053\u308c\u3067\u3001\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306fHeroku\u306b\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u306f\u305a\u3060\u3002\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u66f4\u65b0\u307e\u305f\u306f\u521d\u671f\u5316\u3059\u308b\u305f\u3081\u306b\n\n```\nheroku run lein run migrate\n```\n\n\u3055\u3089\u306a\u308b\u624b\u9806\u306f\u3001[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://devcenter.heroku.com/articles/clojure)\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\n## Enabling nREPL\n\nLuminus\u306f\u30b5\u30fc\u30d0\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u3053\u3068\u3092\u53ef\u80fd\u306b\u3059\u308b[nREPL](https://github.com/clojure/tools.nrepl)\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u306f\u3001\u7a3c\u50cd\u4e2d\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092hotfix\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u30c7\u30d0\u30c3\u30b0\u5168\u822c\u306b\u4fbf\u5229\u3067\u3059\u3002nREPL\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\u306b\u306f\u3001`NREPL_PORT`\u74b0\u5883\u5909\u6570\u306b\u5229\u7528\u3057\u305f\u3044\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\nexport NREPL_PORT=7000\n```\n\nREPL\u306e\u63a5\u7d9a\u3092\u30c6\u30b9\u30c8\u3059\u308b\u306a\u3089\u3001\u5358\u306b\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nlein repl :connect 7001\n```\n\n\u30ed\u30fc\u30ab\u30eb\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u306e\u3068\u5168\u304f\u540c\u3058\u3088\u3046\u306b\u3057\u3066\u3001\u597d\u304d\u306aIDE\u304b\u3089\u30ea\u30e2\u30fc\u30c8\u306eREPL\u306b\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30ea\u30e2\u30fc\u30c8\u306e\u30b5\u30fc\u30d0\u3067nREPL\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001SSH\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u30fb\u30de\u30b7\u30f3\u306bREPL\u306e\u30dd\u30fc\u30c8\u3092\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b\u3053\u3068\u3092\u304a\u3059\u3059\u3081\u3057\u307e\u3059\u3002\n\n```\nssh -L 7001:localhost:7001 remotehost\n```\n", "tags": ["Clojure", "Luminus"]}