{"tags": ["AWS", "CloudWatch-Logs", "CloudWatchLogs", "Cloudtrail", "CloudWatch"], "context": "\n\n0. \u306f\u3058\u3081\u306b\n\nAmazon CloudWatch Logs \u30b5\u30fc\u30d3\u30b9\u3092\u7406\u89e3\u3001\u6d3b\u7528\u3059\u308b\u305f\u3081\u306b\u3001Amazon CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9 \u3092\u4e00\u8aad\u3057\u3066\u3001\u500b\u4eba\u7528\u306b\u6982\u8981\u3068\u6700\u4f4e\u9650\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3079\u304d\u3053\u3068\u3092\u307e\u3068\u3081\u308b\u3002\n\u88dc\u8db3\u306f\u3001Amazon CloudWatch \u306e \u3088\u304f\u3042\u308b\u8cea\u554f \u306e \u3088\u304f\u3042\u308b\u8cea\u554f\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u308b\u3002\n\n\n0.1 \u6982\u8981\u3001\u6ce8\u610f\u70b9\u306a\u3069\n(1) CloudWatch Logs\n\n\u7279\u5fb4\n\n(2) IAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb\n\nIAM\u30ed\u30fc\u30eb\u306e\u6ce8\u610f\u70b9\n\n(3) CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001Amazon Linux \u307e\u305f\u306f Ubuntu \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u81ea\u52d5\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u63d0\u4f9b\u3059\u308b\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u505c\u6b62\u3055\u305b\u305f\u5834\u5408\u306e\u6319\u52d5\n\n(4) \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4\n\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u4fdd\u6301\u671f\u9593\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u671f\u9650\u5207\u308c\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u308b\u3002\n\n(5) \u30ed\u30b0\u30c7\u30fc\u30bf\u9001\u4fe1\u30bf\u30a4\u30df\u30f3\u30b0\n\u521d\u56de\u6642\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068awslogs.conf \u306e\u8a2d\u5b9a\u3092\u8aad\u307f\u8fbc\u3093\u3067\u81ea\u52d5\u7684\u306b CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u308b\u3002\nCloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u300cfile\u300d\u306b\u8a2d\u5b9a\u3059\u308b\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u3069\u306e\u4f4d\u7f6e\u304b\u3089\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u3092\u958b\u59cb\u3059\u308b\u304b\u3092\u300cinitial_position\u300d\u306b\u8a2d\u5b9a\u3059\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u5148\u982d(start_of_file))\u3002\n\u306a\u306e\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u3059\u3079\u3066\u306e\u5185\u5bb9\u304c\u9001\u4fe1\u3055\u308c\u308b\u3002\n\n\u4ee5\u964d\n\n\n\u6b21\u306e\u6761\u4ef6\u306e\u3044\u305a\u308c\u304b\u304c\u6e80\u305f\u3055\u308c\u308b\u5834\u5408\u306b\u30d0\u30c3\u30c1\u304c\u30d5\u30eb\u306b\u306a\u308a\u3001\u30c7\u30fc\u30bf\u304cPUSH\u3055\u308c\u308b(\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u9001\u4fe1\u3067\u306f\u306a\u3044\uff09\u3002\n\n\n\u6700\u521d\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304b\u3089\u3001[buffer_duration] \u306e\u6642\u9593\u304c\u7d4c\u904e\u3057\u305f(\u30c7\u30d5\u30a9\u30eb\u30c8 5000ms=5\u79d2)\u3002\n\u7d2f\u7a4d\u3055\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e [batch_size] \u672a\u6e80\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 [batch_size] \u3092\u8d85\u904e\u3057\u307e\u3059(\u30c7\u30d5\u30a9\u30eb\u30c8\u300032768 \u30d0\u30a4\u30c8)\u3002\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u6570\u306f [batch_count] \u306b\u9054\u3057\u307e\u3057\u305f(\u30c7\u30d5\u30a9\u30eb\u30c8 1000)\u3002\n\u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f 24 \u6642\u9593\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u305b\u3093\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 24 \u6642\u9593\u306e\u5236\u7d04\u3092\u8d85\u904e\u3057\u307e\u3059\u3002\n\n\n\n(6) \u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3001\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u307e\u305f\u306f\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u539f\u56e0\n(7) \u30e1\u30c8\u30ea\u30af\u30b9\n\u203b\u3088\u304f\u3042\u308b\u8cea\u554f\u304b\u3089\n\nAmazon CloudWatch \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3067\u306f\u4f55\u3092\u6e2c\u5b9a\u3067\u304d\u308b\u306e\u3067\u3059\u304b?\n\n\nAmazon CloudWatch \u3067\u306f\u3001AWS \u306e\u30af\u30e9\u30a6\u30c9\u30ea\u30bd\u30fc\u30b9\u3084\u3001\u304a\u5ba2\u69d8\u304c AWS \u3067\u5b9f\u884c\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nAWS \u306e\u591a\u6570\u306e\u88fd\u54c1\u3068\u30b5\u30fc\u30d3\u30b9\u306b\u3064\u3044\u3066\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u81ea\u52d5\u7684\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n\n\n\n\u3059\u3079\u3066\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u306f\u3069\u3046\u306a\u3063\u3066\u3044\u307e\u3059\u304b?\n\n\n2016 \u5e74 11 \u6708 1 \u65e5\u3001CloudWatch \u306f\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u306e\u5ef6\u9577\u3092\u767a\u8868\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u304a\u5ba2\u69d8\u306e\u3059\u3079\u3066\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u304c\u3001\u5f93\u6765\u306e 14 \u65e5\u9593\u304b\u3089 15 \u304b\u6708\u9593\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nCloudWatch Metrics \u3067\u9078\u629e\u3067\u304d\u308b\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306f\u3001\u6b21\u306e 3 \u7a2e\u985e\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n1 \u5206\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 15 \u65e5\u9593\u4fdd\u5b58\n5 \u5206\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 63 \u65e5\u9593\u4fdd\u5b58\n1 \u6642\u9593\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 455 \u65e5\u9593\u4fdd\u5b58\n\n\n\n\n\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u524a\u9664\u3067\u304d\u307e\u3059\u304b?\n\n\n\nCloudWatch \u3067\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u524a\u9664\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u305b\u3093\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u4e0a\u8a18\u306e\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u57fa\u3065\u3044\u3066\u6709\u52b9\u671f\u9593\u304c\u5207\u308c\u307e\u3059\u3002\n\u3000\n\n\n\nAmazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u7121\u52b9\u306b\u3057\u305f\u5834\u5408\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u3092\u5931\u3044\u307e\u3059\u304b?\n\n\n\u3044\u3044\u3048\u3002\u3059\u3079\u3066\u306e\u30a2\u30de\u30be\u30f3 EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u30c7\u30fc\u30bf\u306f\u3001\u4e0a\u8a18\u306e\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u57fa\u3065\u3044\u3066\u5e38\u306b\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u305f\u3060\u3057\u3001\u540d\u524d\u7a7a\u9593\u3067\u6700\u65b0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u691c\u7d22\u306f\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u6700\u5f8c\u306b\u53d6\u308a\u8fbc\u307e\u308c\u3066\u304b\u3089 2 \u9031\u9593\u306b\u5236\u9650\u3055\u308c\u307e\u3059\u3002\n\n\n\n\n\u7d42\u4e86\u3057\u305f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3084\u524a\u9664\u3055\u308c\u305f Elastic Load Balancer \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u304b?\n\n\n\u306f\u3044\u3002Amazon CloudWatch \u306f\u3001\u7d42\u4e86\u3057\u305f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u307e\u305f\u306f\u524a\u9664\u3055\u308c\u305f Elastic Load Balancing \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092 15 \u304b\u6708\u9593\u683c\u7d0d\u3057\u307e\u3059\u3002\n\n\n\n\n0.2 \u8a2d\u5b9a\u4f8b\n\n0.2.1 CloudWatch Logs \u3092\u65b0\u898f\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u57fa\u672c\u8a2d\u5b9a\u306e\u624b\u9806\u4f8b\n[1] CloudWatch Logs \u306e\u5229\u7528\u3092\u8a31\u53ef\u3059\u308bIAM\u30dd\u30ea\u30b7\u30fc\u3092\u4ed8\u52a0\u3057\u305fIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\n\n\u53c2\u8003\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 1\n3.2 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8\n\n\n\n\n1) \u7ba1\u7406\u8005\u6a29\u9650\u30dd\u30ea\u30b7\u30fc\u304c\u4ed8\u52a0\u3055\u308c\u305fIAM\u30e6\u30fc\u30b6 \u3067AWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u3066\u3001IAM\u30b5\u30fc\u30d3\u30b9\u3078\u9077\u79fb\u3059\u308b\u3002(\u53c2\u8003:IAM \u7ba1\u7406\u8005\u306e\u30e6\u30fc\u30b6\u30fc\u304a\u3088\u3073\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210)\n\u3000https://console.aws.amazon.com/iam\n2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30dd\u30ea\u30b7\u30fc\u300d\n\n\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210 \u21d2 \u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210 \u21d2 \u9078\u629e\n\n\u30fb\u30dd\u30ea\u30b7\u30fc\u540d\nCloudWatchLogs\n\u30fb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n\n\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogStreams\"\n    ],\n      \"Resource\": [\n        \"arn:aws:logs:*:*:*\"\n    ]\n  }\n ]\n}\n\n\n\n\n\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\n\n3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30fc\u30eb\u300d\n\n\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u30fb\u30ed\u30fc\u30eb\u540d\nec2role\n\n\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\n\n\u30fbAWS \u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n\u300cAmazon EC2\u300d \u3092\u9078\u629e\n\n\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\n\n\u30fb\u4f5c\u6210\u3057\u305f\u3000CloudWatchLogs\u3000\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\n\n[2] \u4e0a\u8a18\u306eIAM\u30ed\u30fc\u30eb\u3092\u5272\u308a\u5f53\u3066\u305f EC2 \u3092\u4f5c\u6210\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306e\u3001\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a73\u7d30\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u306e\u300cIAM \u30ed\u30fc\u30eb\u300d\u306b\u4f5c\u6210\u3057\u305f ec2role \u3092\u9078\u629e\u3059\u308b\n\n\n[3] \u4e0a\u8a18\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u53c2\u8003\n\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2\n\n\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum update\n$ sudo yum install awslogs\n\n\u30fb\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ yum info aws-cli-plugin-cloudwatch-logs\n\n\n\n\n\n[4] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\n\n\u53c2\u8003\n\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2\n \n/etc/awslogs/awscli.conf\n[plugins]\ncwlogs = cwlogs\n[default]\nregion = ap-northeast-1\n\n\n\n\n\n[5] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u9001\u4fe1\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\n\n\u53c2\u8003\n\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2\n\n\n3.8 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\n/etc/awslogs/awscli.conf\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a[general]\nstate_file = /var/lib/awslogs/agent-state\n\u3000\u3000\u3000\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n\n\n\n\n\n[6] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\u3068\u3001\u52d5\u4f5c\u78ba\u8a8d\n\n\u53c2\u8003\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2\n3.6 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u958b\u59cb\n\n3.5 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059\n\n\u30fb\u8d77\u52d5\n$ sudo service awslogs start\n$ sudo chkconfig awslogs on\n\n\u30fb\u30d7\u30ed\u30bb\u30b9\u52d5\u4f5c\u78ba\u8a8d\n$ sudo service awslogs status\nawslogs (pid  8281) is running...\n\n\u30fb/var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u3001\u8b66\u544a\u3001\u554f\u984c\u7b49\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\n[7] CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n\n\u53c2\u8003\n\n\n3.9 \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u8868\u793a \n\n\n\nlogger \u30b3\u30de\u30f3\u30c9\u3067\u3001/var/log/messages \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u529b\u3057\u3066\u3001CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u30025\u79d2\u4ee5\u5185(buffer_duration = 5000)\u306b\u306f\u3001\u9001\u4fe1\u3055\u308c\u308b\u3002\n\n$ logger test\n\n\n\n[8] \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4\n\n\u53c2\u8003\n\n\n3.10 \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4\n\n\n\n\n1) CloudWatch \u30b5\u30fc\u30d3\u30b9\u3078\u9077\u79fb\u3059\u308b\n\u3000https://console.aws.amazon.com/cloudwatch\n2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n\n3) \u5bfe\u8c61\u306e\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e \"\u6b21\u306e\u671f\u9593\u7d4c\u904e\u5f8c\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5931\u52b9\" \u306e \"\u5931\u52b9\u3057\u306a\u3044\" \u3092\u30af\u30ea\u30c3\u30af\n\n4) \u304a\u597d\u307f\u306e\u4fdd\u6301\u671f\u9593\u3078\u5909\u66f4\u3059\u308b\n\n\n0.2.2 \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u8a2d\u5b9a\u4f8b\n\n\u4f8b: \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8\n\u4f8b: \u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n\u4f8b: HTTP 404 \u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ab\u30a6\u30f3\u30c8\n\u4f8b: 400 \u30ec\u30d9\u30eb\u3092\u898b\u3064\u3051\u3066 4xx \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n\u4f8b: Apache \u30ed\u30b0\u304b\u3089\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u306e\u62bd\u51fa\n\n\n0.2.3 CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon Elasticsearch Service \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\n\nCloudTrail \u30ed\u30b0\u3092 Amazon ES \u3078\u9001\u308b\n\n\nAmazon CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9\n\n\n1. Amazon CloudWatch Logs \u3068\u306f?\n\nAmazon CloudWatch Logs \u3092\u4f7f\u7528\u3057\u3066\u3001Amazon Elastic Compute Cloud (Amazon EC2) \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3001AWS CloudTrail\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u30bd\u30fc\u30b9\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u76e3\u8996\u3001\u4fdd\u5b58\u3001\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u307e\u3059\u3002 \u305d\u306e\u5f8c\u3001CloudWatch Logs \u304b\u3089\u3001\u95a2\u9023\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u7279\u5fb4\n\n\nAmazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\n\n\nCloudWatch Logs \u3067\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30b9\u30c6\u30e0\u3092\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306b\u5b58\u5728\u3059\u308b\u30a8\u30e9\u30fc\u306e\u6570\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3001\u30a8\u30e9\u30fc\u7387\u304c\u6307\u5b9a\u306e\u3057\u304d\u3044\u5024\u3092\u8d85\u3048\u305f\u3068\u304d\u306b\u7ba1\u7406\u8005\u306b\u901a\u77e5\u3092\u9001\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \n\n\u304a\u5ba2\u69d8\u306e\u30ed\u30b0\u304c CloudWatch Logs \u306b\u3088\u308b\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u306b\u4f7f\u7528\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30fc\u30c9\u306e\u5909\u66f4\u306f\u4e0d\u8981\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306e\u7279\u5b9a\u306e\u30ea\u30c6\u30e9\u30eb\u30bf\u30fc\u30e0\uff08\u4f8b:\u300cNullReferenceException\u300d\uff09\u3092\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3057\u305f\u308a\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u7279\u5b9a\u306e\u5834\u6240\u3067\u30ea\u30c6\u30e9\u30eb\u30bf\u30fc\u30e0\uff08\u4f8b: Apache \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u300c404\u300d\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\uff09\u306e\u767a\u751f\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002\n\n\u691c\u7d22\u3057\u305f\u8a9e\u53e5\u304c\u898b\u3064\u304b\u308b\u3068\u3001CloudWatch Logs \u306f\u6307\u5b9a\u3055\u308c\u305f CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u3001\u8ee2\u9001\u6642\u3084\u4fdd\u7ba1\u6642\u306b\u6697\u53f7\u5316\u3055\u308c\u307e\u3059\u3002\n\n\n\n\n\nAWS CloudTrail \u306e\u30ed\u30b0\u306b\u8a18\u9332\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\n\n\nCloudWatch \u306b\u30a2\u30e9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3001CloudTrail \u304c\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u7279\u5b9a\u306e API \u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u306e\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308a\u3001\u901a\u77e5\u3092\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9f\u884c\u306b\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\n\n\n\n\n\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b\n\nCloudWatch Logs \u3092\u4f7f\u7528\u3057\u3066\u8010\u4e45\u6027\u304c\u9ad8\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u3059\u3002\u30ed\u30b0\u306e\u4fdd\u6301\u8a2d\u5b9a\u306f\u3001\u305d\u306e\u8a2d\u5b9a\u3088\u308a\u3082\u53e4\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u81ea\u52d5\u7684\u306b\u524a\u9664\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308a\u3001\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u3082\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3057\u306a\u3044\u30ed\u30b0\u30c7\u30fc\u30bf\u3082\u3001\u30db\u30b9\u30c8\u304b\u3089\u30ed\u30b0\u30b5\u30fc\u30d3\u30b9\u306b\u7c21\u5358\u306b\u3059\u3070\u3084\u304f\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u5f8c\u306f\u3001\u5fc5\u8981\u306a\u3068\u304d\u306b\u751f\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n\n\n\n1.1 CloudWatch Logs \u7528\u8a9e\u3001\u6982\u5ff5\n\n\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\n\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\n\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\n\u4fdd\u6301\u8a2d\u5b9a\n\n\n1.2 CloudWatch Logs \u306e\u5236\u9650\n\n\n2. \u6e96\u5099\u4f5c\u696d\n\n\n2.1 \u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9\uff08AWS\uff09\u306b\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\n\n2.2 Amazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\u3059\u308b\n\n2.3 \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\n\n3. \u306f\u3058\u3081\u306b\n\n\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f Amazon Linux\u3001Ubuntu Server\u3001CentOS\u3001Red Hat Enterprise Linux \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u524d\u63d0\u6761\u4ef6\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u306f\u3001Python \u30d0\u30fc\u30b8\u30e7\u30f3 2.6\u30012.7\u30013.0\u3001\u307e\u305f\u306f 3.3\u3001\u304a\u3088\u3073\u6b21\u306e\u3044\u305a\u308c\u304b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Linux \u304c\u5fc5\u8981\u3067\u3059\u3002\n\nAmazon Linux \u30d0\u30fc\u30b8\u30e7\u30f3 2014.03.02 \u4ee5\u964d\nUbuntu Server \u30d0\u30fc\u30b8\u30e7\u30f3 12.04 \u307e\u305f\u306f 14.04\nCentOS \u30d0\u30fc\u30b8\u30e7\u30f3 6\u30016.3\u30016.4\u30016.5\u3001\u307e\u305f\u306f 7.0\nRed Hat Enterprise Linux (RHEL) \u30d0\u30fc\u30b8\u30e7\u30f3 6.5 \u307e\u305f\u306f 7.0\nDebian 8.0\n\n\n3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: \u65e2\u5b58\u306e Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b\n\nIAM\u30ed\u30fc\u30eb\u306e\u6ce8\u610f\u70b9\n\nEC2 \u5185\u3067\u7a3c\u50cd\u3057\u3066\u3044\u308b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304b\u3089 CloudWatch Logs \u3078\u30ed\u30b0\u3092\u9001\u4fe1\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u3092\u8a31\u53ef\u3059\u308b\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u305f IAM\u30dd\u30ea\u30b7\u30fc \u304c\u3001EC2 \u306e IAM\u30ed\u30fc\u30eb \u306b\u767b\u9332\u3057\u3066\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nEC2 \u306b IAM\u30ed\u30fc\u30eb \u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u306f\u3001EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3057\u304b\u51fa\u6765\u306a\u3044\u3002\u305d\u306e\u305f\u3081\u3001\u65e2\u5b58\u306e EC2 \u3067 CloudWatch Logs \u3092\u5229\u7528\u3057\u305f\u3044\u304c\u3001\u305d\u306e EC2 \u306b IAM\u30ed\u30fc\u30eb \u304c\u4f55\u3082\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u65b0\u898f\u306b EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u30b9\u30c6\u30c3\u30d7 1: IAM \u30ed\u30fc\u30eb\u307e\u305f\u306f CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u3053\u306e \u30b9\u30c6\u30c3\u30d7 1 \u3067\u306f\u3001\u65e2\u5b58\u306e\u8d77\u52d5\u4e2d EC2 \u306b\u3059\u3067\u306b IAM\u30ed\u30fc\u30eb\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u3066\u3001\u305d\u306e IAM\u30ed\u30fc\u30eb \u306b \u6b21\u306e IAM\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u3057\u3066\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\n\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogStreams\"\n    ],\n      \"Resource\": [\n        \"arn:aws:logs:*:*:*\"\n    ]\n  }\n ]\n}\n\n\u30b9\u30c6\u30c3\u30d7 2: \u65e2\u5b58\u306e Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b\n\nAmazon Linux AMI 2014.09 \u304b\u3089\u3001awslogs \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u305f RPM \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002\n\u624b\u9806\n\n\n1) \u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6700\u65b0\u306e\u5909\u66f4\u3092\u53d6\u5f97\n\n$ sudo yum update\n\n2) awslogs \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo yum install awslogs\n\n3) /etc/awslogs/awscli.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3001[default] \u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3057\u8a8d\u8a3c\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30fb region \u306f\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3(ap-northeast-1)\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u30fb \u8a8d\u8a3c\u60c5\u5831(aws_access_key_id, aws_secret_access_key)\u306f\u4e0d\u8981\u3002\n\n[plugins]\ncwlogs = cwlogs\n[default]\nregion = ap-northeast-1\n\n\n4) /etc/awslogs/awslogs.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u8ffd\u8de1\u3059\u308b\u30ed\u30b0\u3092\u8a2d\u5b9a\n\n\u30fb \u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u3001/var/log/messages \u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u305f\u30ed\u30b0\u3092 CloudWatch Logs \u306e \u300c/var/log/messages\u300d \u3068\u3044\u3046\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3078\u9001\u4fe1\u3059\u308b\u3002\n\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n\n\n5) awslogs \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\n\n$ sudo service awslogs start\n\n6) \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\u3001\u52d5\u4f5c\u78ba\u8a8d\n\u30fb /var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u6642\u306b\u8a18\u9332\u3055\u308c\u305f\u30a8\u30e9\u30fc\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\n\u30fb \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u5b9f\u884c\u3055\u308c\u3066\u3057\u3070\u3089\u304f\u3057\u305f\u3089\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u65b0\u3057\u304f\u4f5c\u6210\u3055\u308c\u305f\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3068\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u78ba\u8a8d\n\n\n\n3.2 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: \u65b0\u898f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b\n\n\u3053\u306e\u7ae0\u3067\u884c\u3063\u3066\u3044\u308b\u3053\u3068\n\n/etc/awslogs/awslogs.conf \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3001S3 \u3078\u7f6e\u3044\u3066\u3044\u308b\n\n\nIAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\n\n\nIAM\u30dd\u30ea\u30b7\u30fc\u306b\u306f\u3001EC2\u304b\u3089S3\u306e\u30d0\u30b1\u30c3\u30c8\u3078\u306eGetObject\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u3066\u3044\u308b\nEC2 \u304b\u3089 S3\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u3042\u308b\u3000/awslogs.conf \u3092\u53d6\u308a\u306b\u884c\u304f\u305f\u3081\n\n\n\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u3092\u4f5c\u6210\u3001\u8d77\u52d5\u3059\u308b\n\n\n\u3053\u306e\u3068\u304d\u306b\u3001\u5148\u306b\u4f5c\u6210\u3057\u305f\u3000IAM\u30ed\u30fc\u30eb \u3092\u5272\u308a\u5f53\u3066\u308b\n\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3067\u3001CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b3\u30fc\u30c9\u3092\u5165\u308c\u3066\u3044\u308b\n#!/bin/bash\ncurl https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py -O\nchmod +x ./awslogs-agent-setup.py\n./awslogs-agent-setup.py -n -r us-east-1 -c s3://myawsbucket/my-config-file\n\n\n\n\n\n\n3.3 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: AWS OpsWorks \u304a\u3088\u3073 Chef \u3092\u4f7f\u7528\u3057\u3066 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\n3.4 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: AWS CloudFormation \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u9001\u4fe1\u3059\u308b\n\n\n3.5 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059\n\n\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u305d\u306e\uff11 - \u30b3\u30de\u30f3\u30c9\u3067\n\n$ sudo service awslogs status\nawslogs (pid  8281) is running...\n\n\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u305d\u306e\uff12 - \u30ed\u30b0\u304b\u3089\n\n/var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3067 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u3001\u8b66\u544a\u3001\u554f\u984c\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\n\n3.6 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u958b\u59cb\n\n$ sudo service awslogs start\n\n\n3.7 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u505c\u6b62\n\n$ sudo service awslogs stop\n\n\n\n3.8 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001Amazon Linux \u307e\u305f\u306f Ubuntu \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u81ea\u52d5\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u6b21\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b AWS CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3002\nCloudWatch Logs \u306b\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b CloudWatch Logs aws logs push \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8 (\u30c7\u30fc\u30e2\u30f3)\u3002\n\u30c7\u30fc\u30e2\u30f3\u304c\u5e38\u306b\u5b9f\u884c\u4e2d\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b cron \u30b8\u30e7\u30d6\u3002\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u3001 aws logs push \u30b3\u30de\u30f3\u30c9\u304c\u5fc5\u8981\u3068\u3059\u308b\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\n/etc/awslogs/awslogs.conf\n\n[general]\nstate_file = /var/lib/awslogs/agent-state\n\u3000\u3000\u3000\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n\n\n\ndatetime_format\n\n\u30ed\u30b0\u304b\u3089\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u5165\u624b\u3059\u308b\u65b9\u6cd5\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n\n\n\nfile\n\n\nCloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u7279\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u307e\u305f\u306f\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08/var/log/system.log* \u306e\u3088\u3046\u306b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3092\u4f7f\u7528\uff09\u3002\n\naccess_log.2014-06-01-01 \u3068 access_log.2014-06-01-02 \u306a\u3069\u540c\u3058\u5f62\u5f0f\u306e\u4e00\u9023\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u306e\u4f7f\u7528\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u3001access_log_80 \u3068 access_log_443 \u306e\u3088\u3046\u306b\u7a2e\u985e\u304c\u7570\u306a\u308b\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4f7f\u7528\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u7a2e\u985e\u304c\u7570\u306a\u308b\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5225\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u30ed\u30b0\u306e\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u3001\u5404\u7a2e\u985e\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u7570\u306a\u308b\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u884c\u304f\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u6642\u9593\u306b\u57fa\u3065\u3044\u3066\u3001\u6700\u65b0\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u304c CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3059\u3002\n\n\n\nbuffer_duration\n\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30d0\u30c3\u30c1\u671f\u9593\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f\u5024\u306f 5000ms \u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 5000ms \u3067\u3059\u3002\n5000ms = 5\u79d2\n\n\n\nlog_stream_name\n\n\u9001\u4fe1\u5148\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\n\ninitial_position\n\n\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u3092\u3069\u3053\u304b\u3089\u958b\u59cb\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\uff08start_of_file \u307e\u305f\u306f end_of_file\uff09\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306f start_of_file \u3067\u3059\u3002\n\u305d\u306e\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u304c\u306a\u3044\u5834\u5408\u306b\u306e\u307f\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n\n\n\nlog_group_name\n\n\u9001\u4fe1\u5148\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u306f\u3001\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n\n\nbatch_count\n\n\u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u6700\u5927\u5024\u3092 10000 \u307e\u3067\u306e\u5024\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 1000 \u3067\u3059\u3002\n\n\n\nbatch_size\n\n\u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u6700\u5927\u5024\u3092 1048576 \u30d0\u30a4\u30c8\u307e\u3067\u306e\u30d0\u30a4\u30c8\u5024\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 32768 \u30d0\u30a4\u30c8\u3067\u3059\u3002 \u3053\u306e\u30b5\u30a4\u30ba\u306f\u3001UTF-8 \u306e\u3059\u3079\u3066\u306e\u30a4\u30d9\u30f3\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5408\u8a08\u306b\u5404\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306b\u3064\u304d 26 \u30d0\u30a4\u30c8\u3092\u52a0\u7b97\u3057\u3066\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002\n\n\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u3088\u304f\u3042\u308b\u8cea\u554f\n\u3069\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3002\n\n\n\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u65e2\u5b58\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6570\u5b57\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u3064\u3051\u305f\u540d\u524d\u306b\u5909\u66f4\u3057\u3001\u305d\u306e\u5f8c\u3001\u5143\u306e\u540d\u524d\u306e\u7a7a\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u76f4\u3057\u307e\u3059\u3002 \u305f\u3068\u3048\u3070\u3001/var/log/syslog.log \u304c /var/log/syslog.log.1 \u3068\u3044\u3046\u540d\u524d\u306b\u5909\u66f4\u3055\u308c\u307e\u3059\u3002/var/log/syslog.log.1 \u304c\u524d\u56de\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308a\u65e2\u306b\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001/var/log/syslog.log.2 \u3068\u3044\u3046\u540d\u524d\u306b\u5909\u66f4\u3055\u308c\u307e\u3059\u3002\n\u5143\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u30b3\u30d4\u30fc\u3092\u4f5c\u6210\u3057\u305f\u5f8c\u5207\u308a\u6368\u3066\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001/var/log/syslog.log \u3092 /var/log/syslog.log.1 \u306b\u30b3\u30d4\u30fc\u3057\u3001/var/log/syslog.log \u3092\u5207\u308a\u6368\u3066\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u30c7\u30fc\u30bf\u3092\u640d\u5931\u3059\u308b\u6050\u308c\u304c\u3042\u308b\u305f\u3081\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u306e\u4f7f\u7528\u306b\u306f\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3068\u5171\u901a\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u6301\u3064\u65b0\u3057\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070 /var/log/syslog.log.2014-01-01 \u3092\u305d\u306e\u307e\u307e\u6b8b\u3057\u3001/var/log/syslog.log.2014-01-02 \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n\n\u4f7f\u7528\u3057\u3066\u3044\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\n\n\nyum \u304b\u3089 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\n$ yum info aws-cli-plugin-cloudwatch-logs\n\u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u30d1\u30c3\u30b1\u30fc\u30b8\n\u540d\u524d                : aws-cli-plugin-cloudwatch-logs\n\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc    : noarch\n\u30d0\u30fc\u30b8\u30e7\u30f3          : 1.3.3\n...\n\n\n\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u3069\u306e\u3088\u3046\u306b\u30d0\u30c3\u30c1\u3055\u308c\u3066\u3044\u307e\u3059\u304b\n\n\u6b21\u306e\u6761\u4ef6\u306e\u3044\u305a\u308c\u304b\u304c\u6e80\u305f\u3055\u308c\u308b\u5834\u5408\u3001\u30d0\u30c3\u30c1\u304c\u30d5\u30eb\u306b\u306a\u308a\u767a\u884c\u3055\u308c\u307e\u3059\u3002\n\n\n\u6700\u521d\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304b\u3089\u3001[buffer_duration] \u306e\u6642\u9593\u304c\u7d4c\u904e\u3057\u305f\u3002\n\u7d2f\u7a4d\u3055\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e [batch_size] \u672a\u6e80\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 [batch_size] \u3092\u8d85\u904e\u3057\u307e\u3059\u3002\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u6570\u306f [batch_count] \u306b\u9054\u3057\u307e\u3057\u305f\u3002\n\u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f 24 \u6642\u9593\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u305b\u3093\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 24 \u6642\u9593\u306e\u5236\u7d04\u3092\u8d85\u904e\u3057\u307e\u3059\u3002\n\n\n\n\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3001\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u307e\u305f\u306f\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u306e\u306f\u3069\u306e\u3088\u3046\u306a\u539f\u56e0\u304c\u3042\u308a\u307e\u3059\u304b\u3002\n\n\nPutLogEvents \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5236\u7d04\u306b\u5f93\u3063\u3066\u3001\u6b21\u306e\u554f\u984c\u306b\u3088\u308a\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30b5\u30a4\u30ba\u304c 256 KB \u3092\u8d85\u904e\u3057\u305f\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u5b8c\u5168\u306b\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c 2 \u6642\u9593\u4ee5\u4e0a\u672a\u6765\u306e\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c 14 \u65e5\u4ee5\u4e0a\u904e\u53bb\u306e\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e\u4fdd\u6301\u671f\u9593\u3088\u308a\u3082\u53e4\u3044\u5834\u5408\u3001\u30d0\u30c3\u30c1\u306f\u3059\u3079\u3066\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\u5358\u4e00\u306e PutLogEvents \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30d0\u30c3\u30c1\u304c 24 \u6642\u9593\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001PutLogEvents \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306f\u5931\u6557\u3057\u307e\u3059\u3002\n\n\n\n\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u505c\u6b62\u3055\u305b\u305f\u5834\u5408\u3001\u30c7\u30fc\u30bf\u640d\u5931\u3084\u91cd\u8907\u304c\u767a\u751f\u3057\u307e\u3059\u304b\u3002\n\n\n\u72b6\u614b\u30d5\u30a1\u30a4\u30eb\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3042\u308a\u3001\u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u305f\u6642\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u767a\u751f\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u767a\u751f\u3057\u307e\u305b\u3093\u3002 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u505c\u6b62\u3057\u305f\u5834\u6240\u304b\u3089\u518d\u958b\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30d7\u30c3\u30b7\u30e5\u3092\u7d9a\u884c\u3067\u304d\u307e\u3059\u3002\n\n\n\n3.9 \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u8868\u793a\n\n\n\n3.10 \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u6c38\u7d9a\u7684\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002 \u305f\u3060\u3057\u3001\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u671f\u9593\u3092\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\u73fe\u5728\u306e\u4fdd\u6301\u8a2d\u5b9a\u3088\u308a\u53e4\u3044\u30c7\u30fc\u30bf\u306f\u3059\u3079\u3066\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u5404\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e\u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306f\u3001\u3044\u3064\u3067\u3082\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\n\u6b21\u306e\u671f\u9593\u7d4c\u904e\u5f8c\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5931\u52b9\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u300c\u5931\u52b9\u3057\u306a\u3044\u300d\u30fb\u30fb\u30fb\u6c38\u7d9a\u7684\u306b\u4fdd\u5b58\n\n\n\n\n4. \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u691c\u7d22\u304a\u3088\u3073\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c Amazon CloudWatch \u3078\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u767a\u884c\u3092\u958b\u59cb\u3057\u305f\u5f8c\u30011 \u3064\u4ee5\u4e0a\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u691c\u7d22\u304a\u3088\u3073\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3092\u958b\u59cb\u3067\u304d\u307e\u3059\u3002\n\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f CloudWatch Logs \u306b\u9001\u4fe1\u3055\u308c\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u691c\u7d22\u3059\u308b\u305f\u3081\u306e\u8a9e\u53e5\u3068\u30d1\u30bf\u30fc\u30f3\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002CloudWatch Logs \u306f\u3053\u308c\u3089\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u30b0\u30e9\u30d5\u306e\u4f5c\u6210\u3084\u30a2\u30e9\u30fc\u30e0\u306e\u8a2d\u5b9a\u306b\u5229\u7528\u3067\u304d\u308b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\u5404\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f\u4ee5\u4e0b\u306e\u30ad\u30fc\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\n\n\u5404\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u304c\u3069\u306e\u3088\u3046\u306b\u89e3\u91c8\u3059\u308b\u304b\u306b\u3064\u3044\u3066\u306e\u8a18\u53f7\u306b\u3088\u308b\u8aac\u660e\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3001IP \u30a2\u30c9\u30ec\u30b9\u3001\u6587\u5b57\u5217\u306a\u3069\u304c\u542b\u307e\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u7d22\u5bfe\u8c61\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u540d\n\n\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3055\u308c\u305f\u30ed\u30b0\u60c5\u5831\u304c\u767a\u884c\u3055\u308c\u308b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u540d\u524d\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001ErrorCount \u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u767a\u884c\u3067\u304d\u307e\u3059\u3002\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593\n\n\u65b0\u3057\u3044 CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u9001\u4fe1\u5148\u540d\u524d\u7a7a\u9593\u3067\u3059\u3002\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u5024\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u767a\u884c\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300cError\u300d\u306a\u3069\u7279\u5b9a\u306e\u8a9e\u53e5\u306e\u767a\u751f\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u5024\u306f\u767a\u751f\u3059\u308b\u3054\u3068\u306b\u300c1\u300d\u306b\u306a\u308a\u307e\u3059\u3002\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u306f\u3001\u767a\u884c\u3055\u308c\u308b\u5024\u306f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u5024\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n4.1 \u30d5\u30a3\u30eb\u30bf\u3068\u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u6587\n\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u6307\u5b9a\u3055\u308c\u305f\u3082\u306e\u306b\u4e00\u81f4\u3059\u308b\u8a9e\u53e5\u3084\u5024\u304c\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u4e2d\u3067\u691c\u7d22\u3055\u308c\u307e\u3059\u3002\n\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3067\u8a9e\u53e5\u3001\u30d5\u30ec\u30fc\u30ba\u3001\u5024\u3092 1 \u3064\u898b\u3064\u3051\u308b\u305f\u3073\u306b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u3067\u30ab\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u4e2d\u3067 ERROR \u3068\u3044\u3046\u5358\u8a9e\u3092\u691c\u7d22\u3057\u3066\u51fa\u73fe\u56de\u6570\u3092\u6570\u3048\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306b\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3067\u533a\u5207\u3089\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304b\u3089\u5024\u3092\u62bd\u51fa\u3059\u308b\u6a5f\u80fd\u3082\u3042\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001\u30a6\u30a7\u30d6\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ec\u30a4\u30c6\u30f3\u30b7\u30fc\u3067\u3059\u3002\u6761\u4ef6\u6f14\u7b97\u5b50\u3084\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5b8c\u5168\u4e00\u81f4\u3092\u898b\u3064\u3051\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3059\u308b\u524d\u306b\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u691c\u7d22\u30d1\u30bf\u30fc\u30f3\u3092\u30c6\u30b9\u30c8\u3067\u304d\u307e\u3059\u3002\n\n4.2 \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\n\n(1) \u4f8b: \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8\n\n/var/log/messages \u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8\u8a2d\u5b9a\u4f8b\n\n\n1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n4) \u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30a4\u30f3\u3067\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u300d\n\n5) \u30ed\u30b0\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u5b9a\u7fa9\n\n\u30fb\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\n\u3000\u7a7a\u306e\u307e\u307e\n\u30fb\u30c6\u30b9\u30c8\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u9078\u629e\n\u3000\u305d\u306e\u307e\u307e\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n6) \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n\u30fb\u30d5\u30a3\u30eb\u30bf\u306e\u540d\u524d\n\u3000VarLogMessagesCount\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593\n\u3000Test1NameSpace\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\n\u3000VarLogMessagesEventCount\n\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\n\n\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u304c\u300c1\u30d5\u30a3\u30eb\u30bf\u300d\u3068\u306a\u308b\n\n\n\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u72b6\u614b\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\n\n\u4eca\u56de\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u306f\u3001\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\u3092\u7a7a\u306b\u3057\u305f\u305f\u3081\u3001/var/log/messages \u306e\u884c\u306b\u30de\u30c3\u30c1\u3059\u308b\u3002\n\u30e1\u30c8\u30ea\u30af\u30b9\u5024\u304c\uff11\u306a\u306e\u3067\u3001\uff11\u884c\u51fa\u529b\u3057\u305f\u3089\uff11\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u308b\u3002\n\n\n\n\n1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u300d\n4) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593(Test1NameSpace)\u3092\u9078\u629e\n5) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d(VarLogMessagesEventCount)\u3092\u9078\u629e\n\n6) \u300c\u30b0\u30e9\u30d5\u5316\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9(1)\u300d\u30bf\u30d6\u3092\u9078\u629e\n\n\n\u300c\u7d71\u8a08\u300d\u3092 \u5e73\u5747 \u304b\u3089 \u5408\u8a08 \u3078\u5909\u66f4\u3059\u308b\n\n/var/log/messages \u306b\u51fa\u529b\u3055\u308c\u305f\u884c\u306e\u5408\u8a08\u30b0\u30e9\u30d5\uff08\u671f\u9593:\uff15\u5206\uff09\n\nlogger \u30b3\u30de\u30f3\u30c9\u3067\u3001/var/log/messages \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u529b\u3057\u3066\u30b0\u30e9\u30d5\u3092\u78ba\u8a8d\n\n(2) \u4f8b: \u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n\n/var/log/messages \u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u305f\u3001\u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n\n\n1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n4) \u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30a4\u30f3\u3067\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u300d\n5) \u30ed\u30b0\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u5b9a\u7fa9\n\n\u30fb\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\uff08\u30d1\u30bf\u30fc\u30f3\u306f\u5927\u6587\u5b57\u3068\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3059\u308b)\n\u3000Error\n\u30d5\u30a3\u30eb\u30bf\u30fc\u30c6\u30b9\u30c8\u3092\u884c\u3046\u5834\u5408\n\u30fb\u30c6\u30b9\u30c8\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u9078\u629e\n\u3000- \u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30c7\u30fc\u30bf -\n\u30fb\u30d1\u30bf\u30fc\u30f3\u30c6\u30b9\u30c8\n\u3000\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u30c6\u30b9\u30c8\u3057\u305f\u3044\u30ed\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3059\u308b\n\u3000\u203blogger\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u305f\u308a\u306a\u3093\u304b\u3057\u3066\u305d\u308c\u3089\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u305f\u3082\u306e\n\nDec 23 04:58:01 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 117980ms.\nDec 23 04:59:22 ip-10-0-0-144 ec2-user: This is a test error messages.\nDec 23 04:59:53 ip-10-0-0-144 ec2-user: This is a test Error messages.\nDec 23 04:59:59 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 110540ms.\nDec 23 05:01:50 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 115710ms.\nDec 23 05:02:01 ip-10-0-0-144 ec2-user: error\nDec 23 05:02:04 ip-10-0-0-144 ec2-user: Error\n\n\u30d1\u30bf\u30fc\u30f3\u306e\u30c6\u30b9\u30c8 \u3092\u5b9f\u65bd\u3059\u308b \u21d2 \u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n6) \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n\u30fb\u30d5\u30a3\u30eb\u30bf\u306e\u540d\u524d\n\u3000VarLogMessagesErrorCount\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593\n\u3000Test1NameSpace\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\n\u3000VarLogMessagesEventErrorCount\n\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\n\n\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u304c\u300c2\u30d5\u30a3\u30eb\u30bf\u300d\u3068\u306a\u308b\n\n\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u72b6\u614b\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\n\n\n\u4eca\u56de\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u306f\u3001/var/log/messages \u30d5\u30a1\u30a4\u30eb\u5185\u306b \u5358\u8a9e\u300cError\u300d\u304c\u3042\u308b\u884c\u306b\u30de\u30c3\u30c1\u3059\u308b\u3002\n\u30e1\u30c8\u30ea\u30af\u30b9\u5024\u304c\uff11\u306a\u306e\u3067\u3001\u30de\u30c3\u30c1\u3059\u308b\u884c\u304c\u3042\u3063\u305f\u3089\uff11\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u308b\u3002\n\n\n\n\n1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u300d\n4) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593(Test1NameSpace)\u3092\u9078\u629e\n\n\u3053\u306e\u3068\u304d\u3001/var/log/messages \u306b\u307e\u3060 \u5358\u8a9e\u300cError\u300d\u306e\u3042\u308b\u884c\u304c\u306a\u3044\u5834\u5408\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u300cVarLogMessagesEventErrorCount\u300d\u306f\u306a\u3044\u3002\n\u30c6\u30b9\u30c8\u3068\u3057\u3066\u3001logger\u30b3\u30de\u30f3\u30c9\u3067 /var/log/messages \u306b \u5358\u8a9e\u300cError\u300d\u3092\u51fa\u529b\u3055\u305b\u308b\u3002\n\n$ logger \"This is a test error messages.\"\n$ logger \"This is a test Error messages.\"\n$ logger error\n$ logger Error\n\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u300cVarLogMessagesEventErrorCount\u300d\u304c\u8868\u793a\u3055\u308c\u308b\n\n\n\n5) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d(VarLogMessagesEventErrorCount)\u3092\u9078\u629e\n6) \u300c\u30b0\u30e9\u30d5\u5316\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9(1)\u300d\u30bf\u30d6\u3092\u9078\u629e\n\n\u300c\u7d71\u8a08\u300d\u3092 \u5e73\u5747 \u304b\u3089 \u5408\u8a08 \u3078\u5909\u66f4\u3059\u308b\n\n/var/log/messages \u30d5\u30a1\u30a4\u30eb\u5185\u306b \u5358\u8a9e\u300cError\u300d\u304c\u3042\u308b\u884c\u306e\u5408\u8a08\u30b0\u30e9\u30d5\uff08\u671f\u9593:\uff15\u5206\uff09\n\n\n(3) \u4f8b: HTTP 404 \u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ab\u30a6\u30f3\u30c8\n(4) \u4f8b: 400 \u30ec\u30d9\u30eb\u3092\u898b\u3064\u3051\u3066 4xx \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n(5) \u4f8b: Apache \u30ed\u30b0\u304b\u3089\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u306e\u62bd\u51fa\n\n4.3 \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4e00\u89a7\u8868\u793a\n\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4e00\u89a7\u8868\u793a\n\n4.4 \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u524a\u9664\n\n\u203b\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u524a\u9664\u306b\u3064\u3044\u3066\n\n4.5 \u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u691c\u7d22\n\nAmazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306e \u30d5\u30a3\u30eb\u30bf\u3068\u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u6587 \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u691c\u7d22\u3067\u304d\u307e\u3059\u3002\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u3059\u3079\u3066\u306e\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u691c\u7d22\u3059\u308b\u304b\u3001\u3053\u306e\u30c7\u30fc\u30bf\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\u3092\u691c\u7d22\u3067\u304d\u307e\u3059\u3002\n\n5. \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u51e6\u7406\n\n\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066 CloudWatch Logs \u304b\u3089\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d5\u30a3\u30fc\u30c9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u51e6\u7406\u3001\u5206\u6790\u3001\u4ed6\u306e\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u30ed\u30fc\u30c9\u3092\u884c\u3046\u305f\u3081\u306b\u3001Amazon Kinesis \u30b9\u30c8\u30ea\u30fc\u30e0\u3084 AWS Lambda \u306a\u3069\u306e\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u914d\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nCloudWatch \u30ed\u30b0\u306f\u3001Lambda \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 Amazon Elasticsearch Service \u306b\u914d\u4fe1\u3059\u308b\u3002\n\u21d27. Amazon ES \u3078\u306e \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30ed\u30b0 \u30c7\u30fc\u30bf\n\n6. \u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067 Amazon S3 \u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b\n\n\n7. Amazon ES \u3078\u306e \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30ed\u30b0 \u30c7\u30fc\u30bf\n\nCloudWatch Logs \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u901a\u3057\u3066\u3001\u307b\u307c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067Amazon Elasticsearch Service (Amazon ES) \u30af\u30e9\u30b9\u30bf\u30fc\u3067\u53d7\u3051\u53d6\u308bCloudWatch Logs \u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u30b9\u30c8\u30ea\u30fc\u30e0\u30c7\u30fc\u30bf\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 CloudWatch\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u3088\u308a\u3053\u306e\u8a2d\u5b9a\u3092\u88dc\u52a9\u3059\u308b\u305f\u3081\u306e\u7c21\u5358\u306a\u30a6\u30a3\u30b6\u30fc\u30c9\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059 (Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3082\u81ea\u52d5\u751f\u6210\u3057\u3066\u304f\u308c\u308b)\u3002\n\u5927\u91cf\u306e CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon ES \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3059\u308b\u3068\u3001AWS \u8acb\u6c42\u66f8\u306e\u5229\u7528\u6599\u91d1\u304c\u9ad8\u984d\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4e88\u60f3\u3088\u308a\u9ad8\u3044\u91d1\u984d\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3001AWS \u8acb\u6c42\u66f8\u3092\u76e3\u8996\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\nCloudTrail \u30ed\u30b0\u3092 Amazon ES \u3078\u9001\u308b\u8a2d\u5b9a\u624b\u9806\n\n\u6ce8\u610f\n\n\n\nCloudTrail \u30ed\u30b0\u3092 CloudTrail\u30ed\u30b0\u3092CloudWatch Logs\u3078\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a\u304c\u6e08\u3093\u3067\u3044\u308b\u3053\u3068\nAmazon ES \u6599\u91d1\u304c\u767a\u751f\u3059\u308b\n\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30d5\u30ed\u30fc \u300cCloudTrail \u2192 CloudWatch Logs \u2192 Amazon Lambda \u2192 Amazon ES\u300d\n\n\n\n[1] Amazon ES \u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\n1) Amazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n3) Get started\n4) Define domain\n\n\u30fbElasticsearch domain name\n\u3000cloudtrail\n\u30fbElasticsearch version\n\u30002.3\n\n5) Configure cluster (\u4eca\u56de\u306f\u30c6\u30b9\u30c8\u7528\u306a\u306e\u3067\u306a\u308b\u3079\u304f\u6700\u5c0f\u69cb\u6210)\n\nNode configuration\n\n\u30fbInstance count\n\u30001\n\u30fbInstance type\n\u3000t2/micro\n\nStorage configuration\n\n\u30fbStorage type\n\u3000EBS\n\n\n6) Set up access policy\n\u3000\u4eca\u56de\u306f\u3001\u63a5\u7d9a\u5143IP\u30a2\u30c9\u30ec\u30b9\u5236\u9650\n\n\u30fbSet the domain access policy to\n\u3000Allow access to the domain from specific IP(s)\n\u3000\u2193\n\u3000\u4eca\u56de\u306f\u3001\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u56de\u7dda\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\n\n7) Review\n\n8) Domain status \u304c Loading \u2192 Active \u306b\u306a\u308b\u307e\u3067\u66ab\u304f\u5f85\u3064\n\n\u2193\n\n\n[2] CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon ES \u3078Amazon ES \u3078\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3059\u308b\n\n1) Amazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n\ncloudtrail \u306e\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e \u21d2 \u30a2\u30af\u30b7\u30e7\u30f3 \u21d2 Amazon Elasticsearch Service \u3078\u306e\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u306e\u958b\u59cb\n\n3) Amazon Elasticsearch Service \u3078\u306e CloudTrail/test-logs \u306e\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3092\u958b\u59cb\u3059\u308b\n\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u9078\u629e\n\u3000\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\u30fbAmazon ES \u30af\u30e9\u30b9\u30bf\u30fc\n\u3000cloudtrail \uff08[1]\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e)\n\u30fbLambda IAM \u5b9f\u884c\u30ed\u30fc\u30eb\n\u3000\u65b0\u3057\u3044IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u8a31\u53ef\n\n4) \u30ed\u30b0\u5f62\u5f0f\u3068\u30d5\u30a3\u30eb\u30bf\u306e\u8a2d\u5b9a\n\n\u30fb\u30ed\u30b0\u306e\u5f62\u5f0f\n\u3000AWS \u00c7loudTrail\n\n5) \u78ba\u8a8d\n\n\n\u2193\n\n\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u306e\u958b\u59cb\n\u203bLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3(LogsToElasticsearch_cloudtrail)\u304c\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\n\u203bCloundWatch Logs (/aws/lambda/LogsToElasticsearch_cloudtrail) \u304c\u81ea\u52d5\u751f\u6210\u3055\u308c\u308b\n\n\n[3] Kibana4 \u3067 CloudTrail \u30ed\u30b0\u3092\u53ef\u8996\u5316\n\n1) Amazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n\n2) Indices \u78ba\u8a8d\n\n[1] \u3067\u4f5c\u6210\u3057\u305fAmazon ES \u30c9\u30e1\u30a4\u30f3\u300ccloudtrail\u300d\u3092\u30af\u30ea\u30c3\u30af\n\nIndices \u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\n\n\n3) Kibana \u30b5\u30a4\u30c8\u3078\n\nAmazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n[1] \u3067\u4f5c\u6210\u3057\u305fAmazon ES \u30c9\u30e1\u30a4\u30f3\u300ccloudtrail\u300d\u3092\u30af\u30ea\u30c3\u30af\n\nKibana \u306eURL\u3092\u30af\u30ea\u30c3\u30af\n\n4) Kibana \u521d\u671f\u8a2d\u5b9a\n\n\u30fbConfigure an index pattern\n\u3000Index contains time-based events\uff1a\u30c1\u30a7\u30c3\u30af\n\u3000Index name or pattern\uff1a cwl-*\n\u3000Time-field name: @timestamp\n\nCreate\n\u2193\n\n\u2193\nDiscover\n\n\n\n\n8. \u8a8d\u8a3c\u3068\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\n\n\n9. AWS CloudTrail \u3067\u306e Amazon CloudWatch Logs API \u547c\u3073\u51fa\u3057\u306e\u30ed\u30b0\u4f5c\u6210\n\n#0. \u306f\u3058\u3081\u306b\n* Amazon CloudWatch Logs \u30b5\u30fc\u30d3\u30b9\u3092\u7406\u89e3\u3001\u6d3b\u7528\u3059\u308b\u305f\u3081\u306b\u3001[Amazon CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html) \u3092\u4e00\u8aad\u3057\u3066\u3001\u500b\u4eba\u7528\u306b\u6982\u8981\u3068\u6700\u4f4e\u9650\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3079\u304d\u3053\u3068\u3092\u307e\u3068\u3081\u308b\u3002\n* \u88dc\u8db3\u306f\u3001[Amazon CloudWatch \u306e \u3088\u304f\u3042\u308b\u8cea\u554f](https://aws.amazon.com/jp/cloudwatch/faqs/) \u306e \u3088\u304f\u3042\u308b\u8cea\u554f\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u308b\u3002\n\n##0.1 \u6982\u8981\u3001\u6ce8\u610f\u70b9\u306a\u3069\n**(1) CloudWatch Logs**\n\n* [\u7279\u5fb4](#characteristic)\n\n**(2) IAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb**\n\n* [IAM\u30ed\u30fc\u30eb\u306e\u6ce8\u610f\u70b9](#IAMRoleNote)\n\n**(3) CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8**\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001Amazon Linux \u307e\u305f\u306f Ubuntu \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u81ea\u52d5\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u63d0\u4f9b\u3059\u308b\u3002\n\n * [\u524d\u63d0\u6761\u4ef6](#agentprerequisite)\n * [\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](#agentreference)\n * [\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u30ed\u30b0\u30ed\u30fc\u30c6\u30fc\u30c8](#logrotate)\n * [\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u505c\u6b62\u3055\u305b\u305f\u5834\u5408\u306e\u6319\u52d5](#agentstop)\n\n**(4) [\u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4](#retentionperiod)**\n\n * \u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u4fdd\u6301\u671f\u9593\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n * \u671f\u9650\u5207\u308c\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u308b\u3002\n\n**(5) \u30ed\u30b0\u30c7\u30fc\u30bf\u9001\u4fe1\u30bf\u30a4\u30df\u30f3\u30b0**\n\n\u521d\u56de\u6642\n\n* CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u8d77\u52d5\u3059\u308b\u3068[awslogs.conf \u306e\u8a2d\u5b9a](#38-cloudwatch-logs-%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9)\u3092\u8aad\u307f\u8fbc\u3093\u3067\u81ea\u52d5\u7684\u306b CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u308b\u3002\n* CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u300cfile\u300d\u306b\u8a2d\u5b9a\u3059\u308b\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u3069\u306e\u4f4d\u7f6e\u304b\u3089\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u3092\u958b\u59cb\u3059\u308b\u304b\u3092\u300cinitial_position\u300d\u306b\u8a2d\u5b9a\u3059\u308b\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u5148\u982d(start_of_file))\u3002\n* \u306a\u306e\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u3059\u3079\u3066\u306e\u5185\u5bb9\u304c\u9001\u4fe1\u3055\u308c\u308b\u3002\n\n\u4ee5\u964d\n\n* **[\u6b21\u306e\u6761\u4ef6\u306e\u3044\u305a\u308c\u304b\u304c\u6e80\u305f\u3055\u308c\u308b\u5834\u5408\u306b\u30d0\u30c3\u30c1\u304c\u30d5\u30eb\u306b\u306a\u308a](#batch)**\u3001\u30c7\u30fc\u30bf\u304cPUSH\u3055\u308c\u308b(\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u9001\u4fe1\u3067\u306f\u306a\u3044\uff09\u3002\n 1. \u6700\u521d\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304b\u3089\u3001[buffer_duration] \u306e\u6642\u9593\u304c\u7d4c\u904e\u3057\u305f(\u30c7\u30d5\u30a9\u30eb\u30c8 5000ms=5\u79d2)\u3002\n 2. \u7d2f\u7a4d\u3055\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e [batch_size] \u672a\u6e80\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 [batch_size] \u3092\u8d85\u904e\u3057\u307e\u3059(\u30c7\u30d5\u30a9\u30eb\u30c8\u300032768 \u30d0\u30a4\u30c8)\u3002\n 3. \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u6570\u306f [batch_count] \u306b\u9054\u3057\u307e\u3057\u305f(\u30c7\u30d5\u30a9\u30eb\u30c8 1000)\u3002\n 4. \u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f 24 \u6642\u9593\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u305b\u3093\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 24 \u6642\u9593\u306e\u5236\u7d04\u3092\u8d85\u904e\u3057\u307e\u3059\u3002\n\n\n**(6) [\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3001\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u307e\u305f\u306f\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u539f\u56e0](#batchskip)**\n\n<a name=\"cloudwatchlogs-metrics\">**(7) \u30e1\u30c8\u30ea\u30af\u30b9**\n\u203b[\u3088\u304f\u3042\u308b\u8cea\u554f](https://aws.amazon.com/jp/cloudwatch/faqs/#monitoring)\u304b\u3089\n\n* Amazon CloudWatch \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3067\u306f\u4f55\u3092\u6e2c\u5b9a\u3067\u304d\u308b\u306e\u3067\u3059\u304b?\n * *Amazon CloudWatch \u3067\u306f\u3001AWS \u306e\u30af\u30e9\u30a6\u30c9\u30ea\u30bd\u30fc\u30b9\u3084\u3001\u304a\u5ba2\u69d8\u304c AWS \u3067\u5b9f\u884c\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002*\n * AWS \u306e\u591a\u6570\u306e\u88fd\u54c1\u3068\u30b5\u30fc\u30d3\u30b9\u306b\u3064\u3044\u3066\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u81ea\u52d5\u7684\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n<br/><br/>\n* \u3059\u3079\u3066\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u306f\u3069\u3046\u306a\u3063\u3066\u3044\u307e\u3059\u304b?\n * *2016 \u5e74 11 \u6708 1 \u65e5\u3001CloudWatch \u306f\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u306e\u5ef6\u9577\u3092\u767a\u8868\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u304a\u5ba2\u69d8\u306e\u3059\u3079\u3066\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u306e\u4fdd\u5b58\u671f\u9593\u304c\u3001\u5f93\u6765\u306e 14 \u65e5\u9593\u304b\u3089 15 \u304b\u6708\u9593\u306b\u306a\u308a\u307e\u3057\u305f\u3002*\n * *CloudWatch Metrics \u3067\u9078\u629e\u3067\u304d\u308b\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306f\u3001\u6b21\u306e 3 \u7a2e\u985e\u306b\u306a\u308a\u307e\u3057\u305f\u3002*\n<pre>\n1 \u5206\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 15 \u65e5\u9593\u4fdd\u5b58\n5 \u5206\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 63 \u65e5\u9593\u4fdd\u5b58\n1 \u6642\u9593\u3054\u3068\u306e\u30c7\u30fc\u30bf\u30dd\u30a4\u30f3\u30c8\u3092 455 \u65e5\u9593\u4fdd\u5b58\n</pre>\n<br/>\n<a name=\"metricsdel\">\n* \u30e1\u30c8\u30ea\u30af\u30b9\u306f\u524a\u9664\u3067\u304d\u307e\u3059\u304b?\n * *CloudWatch \u3067\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u524a\u9664\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u307e\u305b\u3093\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u4e0a\u8a18\u306e\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u57fa\u3065\u3044\u3066\u6709\u52b9\u671f\u9593\u304c\u5207\u308c\u307e\u3059\u3002*\n\u3000<br/><br/>\n* Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092\u7121\u52b9\u306b\u3057\u305f\u5834\u5408\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u3092\u5931\u3044\u307e\u3059\u304b?\n * *\u3044\u3044\u3048\u3002\u3059\u3079\u3066\u306e\u30a2\u30de\u30be\u30f3 EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u30c7\u30fc\u30bf\u306f\u3001\u4e0a\u8a18\u306e\u4fdd\u5b58\u671f\u9593\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u57fa\u3065\u3044\u3066\u5e38\u306b\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002*\n * *\u305f\u3060\u3057\u3001\u540d\u524d\u7a7a\u9593\u3067\u6700\u65b0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u691c\u7d22\u306f\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u6700\u5f8c\u306b\u53d6\u308a\u8fbc\u307e\u308c\u3066\u304b\u3089 2 \u9031\u9593\u306b\u5236\u9650\u3055\u308c\u307e\u3059\u3002*\n<br/><br/>\n* \u7d42\u4e86\u3057\u305f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3084\u524a\u9664\u3055\u308c\u305f Elastic Load Balancer \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u304b?\n * *\u306f\u3044\u3002Amazon CloudWatch \u306f\u3001\u7d42\u4e86\u3057\u305f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u307e\u305f\u306f\u524a\u9664\u3055\u308c\u305f Elastic Load Balancing \u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092 15 \u304b\u6708\u9593\u683c\u7d0d\u3057\u307e\u3059\u3002*\n\n\n\n##0.2 \u8a2d\u5b9a\u4f8b\n\n###0.2.1 CloudWatch Logs \u3092\u65b0\u898f\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u57fa\u672c\u8a2d\u5b9a\u306e\u624b\u9806\u4f8b\n\n[1] CloudWatch Logs \u306e\u5229\u7528\u3092\u8a31\u53ef\u3059\u308bIAM\u30dd\u30ea\u30b7\u30fc\u3092\u4ed8\u52a0\u3057\u305fIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\n\n* \u53c2\u8003\n * [3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 1](#31quickstartstep1)\n * [3.2 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8](#32quickstart)\n\n>1) \u7ba1\u7406\u8005\u6a29\u9650\u30dd\u30ea\u30b7\u30fc\u304c\u4ed8\u52a0\u3055\u308c\u305fIAM\u30e6\u30fc\u30b6 \u3067AWS\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3078\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u3066\u3001IAM\u30b5\u30fc\u30d3\u30b9\u3078\u9077\u79fb\u3059\u308b\u3002(\u53c2\u8003:[IAM \u7ba1\u7406\u8005\u306e\u30e6\u30fc\u30b6\u30fc\u304a\u3088\u3073\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210](http://qiita.com/tonishy/items/9eb772b4a5a338ac6ee6#35-iam-%E7%AE%A1%E7%90%86%E8%80%85%E3%81%AE%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%8A%E3%82%88%E3%81%B3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%81%AE%E4%BD%9C%E6%88%90))\n\n>\u3000https://console.aws.amazon.com/iam\n\n>2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30dd\u30ea\u30b7\u30fc\u300d\n>>\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210 \u21d2 \u72ec\u81ea\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210 \u21d2 \u9078\u629e\n>>>\u30fb\u30dd\u30ea\u30b7\u30fc\u540d\nCloudWatchLogs\n>>>\n>>>\u30fb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogStreams\"\n    ],\n      \"Resource\": [\n        \"arn:aws:logs:*:*:*\"\n    ]\n  }\n ]\n}\n```\n\n>>>\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\n\n>3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30fc\u30eb\u300d\n>>\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n>>>\u30fb\u30ed\u30fc\u30eb\u540d\nec2role\n\n>>\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\n>>>\u30fbAWS \u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n\u300cAmazon EC2\u300d \u3092\u9078\u629e\n\n>>\u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\n>>>\u30fb\u4f5c\u6210\u3057\u305f\u3000CloudWatchLogs\u3000\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n>>\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n>\n![20161222-01.png](https://qiita-image-store.s3.amazonaws.com/0/148868/85de983c-9065-d57a-d08e-3661956c2ba7.png)\n\n[2] \u4e0a\u8a18\u306eIAM\u30ed\u30fc\u30eb\u3092\u5272\u308a\u5f53\u3066\u305f EC2 \u3092\u4f5c\u6210\n\n> EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306e\u3001\u300c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a73\u7d30\u306e\u8a2d\u5b9a\u300d\u753b\u9762\u306e\u300cIAM \u30ed\u30fc\u30eb\u300d\u306b\u4f5c\u6210\u3057\u305f ec2role \u3092\u9078\u629e\u3059\u308b\n\n>\n![20161222-02.png](https://qiita-image-store.s3.amazonaws.com/0/148868/54f7b003-4a63-9dff-93f1-3107ac3a3b0a.png)\n\n\n\n[3] \u4e0a\u8a18\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n* \u53c2\u8003\n * [3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2](#31quickstartstep2)\n<br/>\n\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n<pre>\n$ sudo yum update\n$ sudo yum install awslogs\n</pre>\n\u30fb\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n<pre>\n$ yum info aws-cli-plugin-cloudwatch-logs\n</pre>\n\n[4] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\n\n* \u53c2\u8003\n * [3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2](#31quickstartstep2)\n<br/><br/> \n/etc/awslogs/awscli.conf\n<pre>\n[plugins]\ncwlogs = cwlogs\n[default]\nregion = ap-northeast-1\n</pre>\n\n[5] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u9001\u4fe1\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\n\n* \u53c2\u8003\n * [3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2](#31quickstartstep2)<br/>\n * [3.8 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](#38-cloudwatch-logs-%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E3%83%AA%E3%83%95%E3%82%A1%E3%83%AC%E3%83%B3%E3%82%B9)\n<br/><br/>\n/etc/awslogs/awscli.conf\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a<pre>\n[general]\nstate_file = /var/lib/awslogs/agent-state\n\u3000\u3000\u3000\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n\n[6] CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8d77\u52d5\u3068\u3001\u52d5\u4f5c\u78ba\u8a8d\n\n* \u53c2\u8003\n * [3.1 \u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8 \u30b9\u30c6\u30c3\u30d7 2](#31quickstartstep2)\n * [3.6 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u958b\u59cb](#36-cloudwatch-logs-%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E9%96%8B%E5%A7%8B)\n * [3.5 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059](#35-cloudwatch-logs-%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%82%92%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%81%97%E3%81%BE%E3%81%99)\n<br/><br/>\n\u30fb\u8d77\u52d5\n<pre>\n$ sudo service awslogs start\n$ sudo chkconfig awslogs on\n</pre>\n\u30fb\u30d7\u30ed\u30bb\u30b9\u52d5\u4f5c\u78ba\u8a8d\n<pre>\n$ sudo service awslogs status\nawslogs (pid  8281) is running...\n</pre>\n\u30fb/var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3092\u958b\u304d\u3001CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u3001\u8b66\u544a\u3001\u554f\u984c\u7b49\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n[7] CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n* \u53c2\u8003\n * [3.9 \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u8868\u793a](#39-%E3%83%AD%E3%82%B0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E8%A1%A8%E7%A4%BA) \n\n* logger \u30b3\u30de\u30f3\u30c9\u3067\u3001/var/log/messages \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u529b\u3057\u3066\u3001CloudWatch Logs \u3078\u30ed\u30b0\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\u30025\u79d2\u4ee5\u5185(buffer_duration = 5000)\u306b\u306f\u3001\u9001\u4fe1\u3055\u308c\u308b\u3002\n<pre>\n$ logger test\n</pre>\n\n<a name=\"editperiod\">[8] \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4\n\n* \u53c2\u8003\n * [3.10 \u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4](#310-%E3%83%AD%E3%82%B0%E3%81%AE%E4%BF%9D%E6%8C%81%E6%9C%9F%E9%96%93%E3%81%AE%E5%A4%89%E6%9B%B4)\n\n>1) CloudWatch \u30b5\u30fc\u30d3\u30b9\u3078\u9077\u79fb\u3059\u308b\n>\u3000https://console.aws.amazon.com/cloudwatch\n\n>2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n>\n![20161222-03.png](https://qiita-image-store.s3.amazonaws.com/0/148868/747a1deb-c5cb-396f-bb42-42d5b5556bf3.png)\n\n>3) \u5bfe\u8c61\u306e\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e \"\u6b21\u306e\u671f\u9593\u7d4c\u904e\u5f8c\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5931\u52b9\" \u306e \"\u5931\u52b9\u3057\u306a\u3044\" \u3092\u30af\u30ea\u30c3\u30af\n>![20161222-04.png](https://qiita-image-store.s3.amazonaws.com/0/148868/23a43895-5786-cc07-db8f-92ae6bdb7118.png)\n\n>4) \u304a\u597d\u307f\u306e\u4fdd\u6301\u671f\u9593\u3078\u5909\u66f4\u3059\u308b\n\n###0.2.2 \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u8a2d\u5b9a\u4f8b\n\n1. [\u4f8b: \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8](#metricsfilter01)\n2. [\u4f8b: \u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b](#metricsfilter02)\n3. [\u4f8b: HTTP 404 \u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ab\u30a6\u30f3\u30c8](#metricsfilter03)\n4. [\u4f8b: 400 \u30ec\u30d9\u30eb\u3092\u898b\u3064\u3051\u3066 4xx \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30ab\u30a6\u30f3\u30c8\u3059\u308b](#metricsfilter04)\n5. [\u4f8b: Apache \u30ed\u30b0\u304b\u3089\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u306e\u62bd\u51fa](#metricsfilter05)\n\n###0.2.3 CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon Elasticsearch Service \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\n\n1. [CloudTrail \u30ed\u30b0\u3092 Amazon ES \u3078\u9001\u308b](#cloudtrailamazones)\n\n\n#**[Amazon CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u30ac\u30a4\u30c9](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html)**\n\n#1. [Amazon CloudWatch Logs \u3068\u306f?](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html)\n\n*Amazon CloudWatch Logs \u3092\u4f7f\u7528\u3057\u3066\u3001Amazon Elastic Compute Cloud (Amazon EC2) \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3001AWS CloudTrail\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u30bd\u30fc\u30b9\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u76e3\u8996\u3001\u4fdd\u5b58\u3001\u30a2\u30af\u30bb\u30b9\u304c\u3067\u304d\u307e\u3059\u3002 \u305d\u306e\u5f8c\u3001CloudWatch Logs \u304b\u3089\u3001\u95a2\u9023\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002*\n\n<a name=\"characteristic\">**\u7279\u5fb4**\n\n* *Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3059\u308b*\n * *CloudWatch Logs \u3067\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30b9\u30c6\u30e0\u3092\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001* ***\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306b\u5b58\u5728\u3059\u308b\u30a8\u30e9\u30fc\u306e\u6570\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3001\u30a8\u30e9\u30fc\u7387\u304c\u6307\u5b9a\u306e\u3057\u304d\u3044\u5024\u3092\u8d85\u3048\u305f\u3068\u304d\u306b\u7ba1\u7406\u8005\u306b\u901a\u77e5\u3092\u9001\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002*** \n * *\u304a\u5ba2\u69d8\u306e\u30ed\u30b0\u304c CloudWatch Logs \u306b\u3088\u308b\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u306b\u4f7f\u7528\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30fc\u30c9\u306e\u5909\u66f4\u306f\u4e0d\u8981\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001* ***[\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ed\u30b0\u306e\u7279\u5b9a\u306e\u30ea\u30c6\u30e9\u30eb\u30bf\u30fc\u30e0\uff08\u4f8b:\u300cNullReferenceException\u300d\uff09\u3092\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0](#metricsfilter02)\u3057\u305f\u308a\u3001[\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u7279\u5b9a\u306e\u5834\u6240\u3067\u30ea\u30c6\u30e9\u30eb\u30bf\u30fc\u30e0\uff08\u4f8b: Apache \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u306e\u300c404\u300d\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\uff09\u306e\u767a\u751f\u6570\u3092\u30ab\u30a6\u30f3\u30c8](#metricsfilter03)\u3057\u305f\u308a\u3067\u304d\u307e\u3059\u3002***\n * ***\u691c\u7d22\u3057\u305f\u8a9e\u53e5\u304c\u898b\u3064\u304b\u308b\u3068\u3001CloudWatch Logs \u306f\u6307\u5b9a\u3055\u308c\u305f CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002***\n * ***\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u3001\u8ee2\u9001\u6642\u3084\u4fdd\u7ba1\u6642\u306b\u6697\u53f7\u5316\u3055\u308c\u307e\u3059\u3002***\n<br/><br/>\n* *AWS CloudTrail \u306e\u30ed\u30b0\u306b\u8a18\u9332\u3055\u308c\u305f\u30a4\u30d9\u30f3\u30c8\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0*\n * ***CloudWatch \u306b\u30a2\u30e9\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3001CloudTrail \u304c\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u7279\u5b9a\u306e API \u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u306e\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308a\u3001\u901a\u77e5\u3092\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b9f\u884c\u306b\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002***\n<br/><br/>\n* *\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u30a2\u30fc\u30ab\u30a4\u30d6\u3059\u308b*\n * *CloudWatch Logs \u3092\u4f7f\u7528\u3057\u3066\u8010\u4e45\u6027\u304c\u9ad8\u3044\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3067\u304d\u307e\u3059\u3002\u30ed\u30b0\u306e\u4fdd\u6301\u8a2d\u5b9a\u306f\u3001\u305d\u306e\u8a2d\u5b9a\u3088\u308a\u3082\u53e4\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u81ea\u52d5\u7684\u306b\u524a\u9664\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3067\u304d\u307e\u3059\u3002*\n * *CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308a\u3001\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u3082\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3057\u306a\u3044\u30ed\u30b0\u30c7\u30fc\u30bf\u3082\u3001\u30db\u30b9\u30c8\u304b\u3089\u30ed\u30b0\u30b5\u30fc\u30d3\u30b9\u306b\u7c21\u5358\u306b\u3059\u3070\u3084\u304f\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u5f8c\u306f\u3001\u5fc5\u8981\u306a\u3068\u304d\u306b\u751f\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059*\u3002\n\n##1.1 [CloudWatch Logs \u7528\u8a9e\u3001\u6982\u5ff5](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CloudWatchLogsConcepts.html)\n\n* \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\n* \u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\n* \u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\n* \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\n* \u4fdd\u6301\u8a2d\u5b9a\n\n##1.2 [CloudWatch Logs \u306e\u5236\u9650](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/cloudwatch_limits_cwl.html)\n\n#2. [\u6e96\u5099\u4f5c\u696d](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/GettingSetup_cwl.html)\n##2.1 \u30a2\u30de\u30be\u30f3 \u30a6\u30a7\u30d6 \u30b5\u30fc\u30d3\u30b9\uff08AWS\uff09\u306b\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\n##2.2 Amazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\u3059\u308b\n##2.3 \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\n\n#3. [\u306f\u3058\u3081\u306b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CWL_GettingStarted.html)\n\n*\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f Amazon Linux\u3001Ubuntu Server\u3001CentOS\u3001Red Hat Enterprise Linux \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u3092\u8aac\u660e\u3057\u307e\u3059\u3002*\n\n<a name=\"agentprerequisite\">**CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u524d\u63d0\u6761\u4ef6**\n\n*CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u306f\u3001Python \u30d0\u30fc\u30b8\u30e7\u30f3 2.6\u30012.7\u30013.0\u3001\u307e\u305f\u306f 3.3\u3001\u304a\u3088\u3073\u6b21\u306e\u3044\u305a\u308c\u304b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e Linux \u304c\u5fc5\u8981\u3067\u3059\u3002*\n\n* Amazon Linux \u30d0\u30fc\u30b8\u30e7\u30f3 2014.03.02 \u4ee5\u964d\n* Ubuntu Server \u30d0\u30fc\u30b8\u30e7\u30f3 12.04 \u307e\u305f\u306f 14.04\n* CentOS \u30d0\u30fc\u30b8\u30e7\u30f3 6\u30016.3\u30016.4\u30016.5\u3001\u307e\u305f\u306f 7.0\n* Red Hat Enterprise Linux (RHEL) \u30d0\u30fc\u30b8\u30e7\u30f3 6.5 \u307e\u305f\u306f 7.0\n* Debian 8.0\n\n\n##3.1 [\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: \u65e2\u5b58\u306e Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/QuickStartEC2Instance.html)\n\n<a name=\"IAMRoleNote\">**IAM\u30ed\u30fc\u30eb\u306e\u6ce8\u610f\u70b9**\n\n* EC2 \u5185\u3067\u7a3c\u50cd\u3057\u3066\u3044\u308b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304b\u3089 CloudWatch Logs \u3078\u30ed\u30b0\u3092\u9001\u4fe1\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u3092\u8a31\u53ef\u3059\u308b\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u305f IAM\u30dd\u30ea\u30b7\u30fc \u304c\u3001EC2 \u306e [IAM\u30ed\u30fc\u30eb](http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/id_roles.html) \u306b\u767b\u9332\u3057\u3066\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n* EC2 \u306b IAM\u30ed\u30fc\u30eb \u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u306f\u3001EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u3057\u304b\u51fa\u6765\u306a\u3044\u3002\u305d\u306e\u305f\u3081\u3001\u65e2\u5b58\u306e EC2 \u3067 CloudWatch Logs \u3092\u5229\u7528\u3057\u305f\u3044\u304c\u3001\u305d\u306e EC2 \u306b IAM\u30ed\u30fc\u30eb \u304c\u4f55\u3082\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u65b0\u898f\u306b EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n<a name=\"31quickstartstep1\">**\u30b9\u30c6\u30c3\u30d7 1: IAM \u30ed\u30fc\u30eb\u307e\u305f\u306f CloudWatch Logs \u30e6\u30fc\u30b6\u30fc\u3092\u8a2d\u5b9a\u3059\u308b**\n\n* \u3053\u306e \u30b9\u30c6\u30c3\u30d7 1 \u3067\u306f\u3001\u65e2\u5b58\u306e\u8d77\u52d5\u4e2d EC2 \u306b\u3059\u3067\u306b IAM\u30ed\u30fc\u30eb\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u3066\u3001\u305d\u306e IAM\u30ed\u30fc\u30eb \u306b \u6b21\u306e IAM\u30dd\u30ea\u30b7\u30fc\u3092\u4f5c\u6210\u3057\u3066\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogStreams\"\n    ],\n      \"Resource\": [\n        \"arn:aws:logs:*:*:*\"\n    ]\n  }\n ]\n}\n```\n\n<a name=\"31quickstartstep2\">**\u30b9\u30c6\u30c3\u30d7 2: \u65e2\u5b58\u306e Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b**\n\n* Amazon Linux AMI 2014.09 \u304b\u3089\u3001awslogs \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u305f RPM \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002\n\n* \u624b\u9806\n\n>1) \u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6700\u65b0\u306e\u5909\u66f4\u3092\u53d6\u5f97\n<pre>\n$ sudo yum update\n</pre>\n\n>2) awslogs \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n<pre>\n$ sudo yum install awslogs\n</pre>\n\n>3) /etc/awslogs/awscli.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3001[default] \u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3057\u8a8d\u8a3c\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n>>\u30fb region \u306f\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3(ap-northeast-1)\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n>>\u30fb \u8a8d\u8a3c\u60c5\u5831(aws_access_key_id, aws_secret_access_key)\u306f\u4e0d\u8981\u3002\n<pre>\n[plugins]\ncwlogs = cwlogs\n[default]\nregion = ap-northeast-1\n</pre>\n\n>4) /etc/awslogs/awslogs.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u8ffd\u8de1\u3059\u308b\u30ed\u30b0\u3092\u8a2d\u5b9a\n>>\u30fb \u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u3001/var/log/messages \u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u305f\u30ed\u30b0\u3092 CloudWatch Logs \u306e \u300c/var/log/messages\u300d \u3068\u3044\u3046\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3078\u9001\u4fe1\u3059\u308b\u3002\n<pre>\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n</pre>\n\n\n\n>5) awslogs \u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\n<pre>\n$ sudo service awslogs start\n</pre>\n\n>6) [\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d](#35-cloudwatch-logs-%E3%82%A8%E3%83%BC%E3%82%B8%E3%82%A7%E3%83%B3%E3%83%88%E3%81%AE%E3%82%B9%E3%83%86%E3%83%BC%E3%82%BF%E3%82%B9%E3%82%92%E3%83%AC%E3%83%9D%E3%83%BC%E3%83%88%E3%81%97%E3%81%BE%E3%81%99)\u3001\u52d5\u4f5c\u78ba\u8a8d\n\u30fb /var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u6642\u306b\u8a18\u9332\u3055\u308c\u305f\u30a8\u30e9\u30fc\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\n\u30fb \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u5b9f\u884c\u3055\u308c\u3066\u3057\u3070\u3089\u304f\u3057\u305f\u3089\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u65b0\u3057\u304f\u4f5c\u6210\u3055\u308c\u305f\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3068\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u78ba\u8a8d\n\n<a name=\"32quickstart\">\n##3.2 [\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: \u65b0\u898f Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8a2d\u5b9a\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/EC2NewInstanceCWL.html)\n\n\u3053\u306e\u7ae0\u3067\u884c\u3063\u3066\u3044\u308b\u3053\u3068\n\n1. /etc/awslogs/awslogs.conf \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3001S3 \u3078\u7f6e\u3044\u3066\u3044\u308b\n<br/><br/>\n* IAM\u30dd\u30ea\u30b7\u30fc\u3001IAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\n * IAM\u30dd\u30ea\u30b7\u30fc\u306b\u306f\u3001EC2\u304b\u3089S3\u306e\u30d0\u30b1\u30c3\u30c8\u3078\u306eGetObject\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u3066\u3044\u308b\n * EC2 \u304b\u3089 S3\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u3042\u308b\u3000/awslogs.conf \u3092\u53d6\u308a\u306b\u884c\u304f\u305f\u3081\n<br/><br/>\n* EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u3092\u4f5c\u6210\u3001\u8d77\u52d5\u3059\u308b\n * \u3053\u306e\u3068\u304d\u306b\u3001\u5148\u306b\u4f5c\u6210\u3057\u305f\u3000IAM\u30ed\u30fc\u30eb \u3092\u5272\u308a\u5f53\u3066\u308b\n * \u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3067\u3001CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b3\u30fc\u30c9\u3092\u5165\u308c\u3066\u3044\u308b\n<pre>\n#!/bin/bash\ncurl https://s3.amazonaws.com/aws-cloudwatch/downloads/latest/awslogs-agent-setup.py -O\nchmod +x ./awslogs-agent-setup.py\n./awslogs-agent-setup.py -n -r us-east-1 -c s3://myawsbucket/my-config-file\n</pre>\n\n##3.3 [\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: AWS OpsWorks \u304a\u3088\u3073 Chef \u3092\u4f7f\u7528\u3057\u3066 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/QuickStartChef.html)\n\n##3.4 [\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: AWS CloudFormation \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u9001\u4fe1\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/QuickStartCloudFormation.html)\n\n##3.5 [CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30ec\u30dd\u30fc\u30c8\u3057\u307e\u3059](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/ReportCWLAgentStatus.html)\n\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u305d\u306e\uff11 - \u30b3\u30de\u30f3\u30c9\u3067\n<pre>\n$ sudo service awslogs status\nawslogs (pid  8281) is running...\n</pre>\n\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u305d\u306e\uff12 - \u30ed\u30b0\u304b\u3089\n * /var/log/awslogs.log \u30d5\u30a1\u30a4\u30eb\u3067 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30a8\u30e9\u30fc\u3001\u8b66\u544a\u3001\u554f\u984c\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n##3.6 [CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u958b\u59cb](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/StartTheCWLAgent.html)\n\n<pre>\n$ sudo service awslogs start\n</pre>\n\n\n##3.7 [CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u505c\u6b62](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/StopTheCWLAgent.html)\n\n<pre>\n$ sudo service awslogs stop\n</pre>\n<a name=\"agentreference\">\n##3.8 [CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/AgentReference.html)\n\n*CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u3001Amazon Linux \u307e\u305f\u306f Ubuntu \u3092\u5b9f\u884c\u3059\u308b Amazon EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u81ea\u52d5\u9001\u4fe1\u3059\u308b\u65b9\u6cd5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002*\n\n*\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u6b21\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002*\n\n* *\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b AWS CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3002*\n* *CloudWatch Logs \u306b\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b CloudWatch Logs aws logs push \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8 (\u30c7\u30fc\u30e2\u30f3)\u3002*\n* *\u30c7\u30fc\u30e2\u30f3\u304c\u5e38\u306b\u5b9f\u884c\u4e2d\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b cron \u30b8\u30e7\u30d6\u3002*\n\n**\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb**\n\n* *CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u3001 aws logs push \u30b3\u30de\u30f3\u30c9\u304c\u5fc5\u8981\u3068\u3059\u308b\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002*\n\n* \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\n/etc/awslogs/awslogs.conf\n<pre>\n[general]\nstate_file = /var/lib/awslogs/agent-state\n\u3000\u3000\u3000\n[/var/log/messages]\ndatetime_format = %b %d %H:%M:%S\nfile = /var/log/messages\nbuffer_duration = 5000\nlog_stream_name = {instance_id}\ninitial_position = start_of_file\nlog_group_name = /var/log/messages\n</pre>\n\n* datetime_format\n * *\u30ed\u30b0\u304b\u3089\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u5165\u624b\u3059\u308b\u65b9\u6cd5\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002*\n* file\n * *CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u7279\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u307e\u305f\u306f\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08/var/log/system.log** *\u306e\u3088\u3046\u306b\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3092\u4f7f\u7528\uff09\u3002*\n * *access_log.2014-06-01-01 \u3068 access_log.2014-06-01-02 \u306a\u3069\u540c\u3058\u5f62\u5f0f\u306e\u4e00\u9023\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u306e\u4f7f\u7528\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u3001access_log_80 \u3068 access_log_443 \u306e\u3088\u3046\u306b\u7a2e\u985e\u304c\u7570\u306a\u308b\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u4f7f\u7528\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u7a2e\u985e\u304c\u7570\u306a\u308b\u8907\u6570\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u5225\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u30ed\u30b0\u306e\u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u3001\u5404\u7a2e\u985e\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u304c\u7570\u306a\u308b\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u884c\u304f\u3088\u3046\u306b\u3057\u307e\u3059\u3002*\n * ***\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002***\n * ***\u30d5\u30a1\u30a4\u30eb\u306e\u5909\u66f4\u6642\u9593\u306b\u57fa\u3065\u3044\u3066\u3001\u6700\u65b0\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u304c CloudWatch Logs \u306b\u30d7\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3059\u3002***\n* buffer_duration\n * ***\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30d0\u30c3\u30c1\u671f\u9593\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u6700\u5c0f\u5024\u306f 5000ms \u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 5000ms \u3067\u3059\u3002***\n * 5000ms = 5\u79d2\n* log_stream_name\n * *\u9001\u4fe1\u5148\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002*\n* initial_position\n * *\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u51fa\u3057\u3092\u3069\u3053\u304b\u3089\u958b\u59cb\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\uff08start_of_file \u307e\u305f\u306f end_of_file\uff09\u3002*\n * *\u30c7\u30d5\u30a9\u30eb\u30c8\u306f start_of_file \u3067\u3059\u3002*\n * *\u305d\u306e\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u304c\u306a\u3044\u5834\u5408\u306b\u306e\u307f\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002*\n* log_group_name\n * *\u9001\u4fe1\u5148\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u306f\u3001\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002*\n* batch_count\n * \u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u6700\u5927\u5024\u3092 10000 \u307e\u3067\u306e\u5024\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 1000 \u3067\u3059\u3002\n* batch_size\n * \u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u6700\u5927\u5024\u3092 1048576 \u30d0\u30a4\u30c8\u307e\u3067\u306e\u30d0\u30a4\u30c8\u5024\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f 32768 \u30d0\u30a4\u30c8\u3067\u3059\u3002 \u3053\u306e\u30b5\u30a4\u30ba\u306f\u3001UTF-8 \u306e\u3059\u3079\u3066\u306e\u30a4\u30d9\u30f3\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5408\u8a08\u306b\u5404\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306b\u3064\u304d 26 \u30d0\u30a4\u30c8\u3092\u52a0\u7b97\u3057\u3066\u8a08\u7b97\u3055\u308c\u307e\u3059\u3002\n\n**CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u3088\u304f\u3042\u308b\u8cea\u554f**\n\n<a name=\"logrotate\">*\u3069\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u304b\u3002*\n\n* *\u6b21\u306e\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002*\n 1. *\u65e2\u5b58\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6570\u5b57\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u3064\u3051\u305f\u540d\u524d\u306b\u5909\u66f4\u3057\u3001\u305d\u306e\u5f8c\u3001\u5143\u306e\u540d\u524d\u306e\u7a7a\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u76f4\u3057\u307e\u3059\u3002 \u305f\u3068\u3048\u3070\u3001/var/log/syslog.log \u304c /var/log/syslog.log.1 \u3068\u3044\u3046\u540d\u524d\u306b\u5909\u66f4\u3055\u308c\u307e\u3059\u3002/var/log/syslog.log.1 \u304c\u524d\u56de\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308a\u65e2\u306b\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u3001/var/log/syslog.log.2 \u3068\u3044\u3046\u540d\u524d\u306b\u5909\u66f4\u3055\u308c\u307e\u3059\u3002*\n 2. *\u5143\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u30b3\u30d4\u30fc\u3092\u4f5c\u6210\u3057\u305f\u5f8c\u5207\u308a\u6368\u3066\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001/var/log/syslog.log \u3092 /var/log/syslog.log.1 \u306b\u30b3\u30d4\u30fc\u3057\u3001/var/log/syslog.log \u3092\u5207\u308a\u6368\u3066\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001\u30c7\u30fc\u30bf\u3092\u640d\u5931\u3059\u308b\u6050\u308c\u304c\u3042\u308b\u305f\u3081\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u306e\u4f7f\u7528\u306b\u306f\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002*\n 3. *\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3068\u5171\u901a\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u6301\u3064\u65b0\u3057\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070 /var/log/syslog.log.2014-01-01 \u3092\u305d\u306e\u307e\u307e\u6b8b\u3057\u3001/var/log/syslog.log.2014-01-02 \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002*\n\n*\u4f7f\u7528\u3057\u3066\u3044\u308b\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5*\n\n* *yum \u304b\u3089 CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408*\n<pre>\n$ yum info aws-cli-plugin-cloudwatch-logs\n\u8aad\u307f\u8fbc\u3093\u3060\u30d7\u30e9\u30b0\u30a4\u30f3:priorities, update-motd, upgrade-helper\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u30d1\u30c3\u30b1\u30fc\u30b8\n\u540d\u524d                : aws-cli-plugin-cloudwatch-logs\n\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc    : noarch\n\u30d0\u30fc\u30b8\u30e7\u30f3          : 1.3.3\n...\n</pre>\n\n<a name=\"batch\">*\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u3069\u306e\u3088\u3046\u306b\u30d0\u30c3\u30c1\u3055\u308c\u3066\u3044\u307e\u3059\u304b*\n\n* \u6b21\u306e\u6761\u4ef6\u306e\u3044\u305a\u308c\u304b\u304c\u6e80\u305f\u3055\u308c\u308b\u5834\u5408\u3001\u30d0\u30c3\u30c1\u304c\u30d5\u30eb\u306b\u306a\u308a\u767a\u884c\u3055\u308c\u307e\u3059\u3002\n 1. *\u6700\u521d\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304b\u3089\u3001[buffer_duration] \u306e\u6642\u9593\u304c\u7d4c\u904e\u3057\u305f\u3002*\n 2. *\u7d2f\u7a4d\u3055\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e [batch_size] \u672a\u6e80\u3067\u3059\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 [batch_size] \u3092\u8d85\u904e\u3057\u307e\u3059\u3002*\n 3. *\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u6570\u306f [batch_count] \u306b\u9054\u3057\u307e\u3057\u305f\u3002*\n 4. *\u30d0\u30c3\u30c1\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f 24 \u6642\u9593\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u305b\u3093\u304c\u3001\u65b0\u3057\u3044\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3068 24 \u6642\u9593\u306e\u5236\u7d04\u3092\u8d85\u904e\u3057\u307e\u3059\u3002*\n\n\n<a name=\"batchskip\">*\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3001\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u307e\u305f\u306f\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u306e\u306f\u3069\u306e\u3088\u3046\u306a\u539f\u56e0\u304c\u3042\u308a\u307e\u3059\u304b\u3002*\n\n* *PutLogEvents \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5236\u7d04\u306b\u5f93\u3063\u3066\u3001\u6b21\u306e\u554f\u984c\u306b\u3088\u308a\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u307e\u305f\u306f\u30d0\u30c3\u30c1\u304c\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002*<br/><br/>\n * *\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30b5\u30a4\u30ba\u304c 256 KB \u3092\u8d85\u904e\u3057\u305f\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u5b8c\u5168\u306b\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002*\n * *\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c 2 \u6642\u9593\u4ee5\u4e0a\u672a\u6765\u306e\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002*\n * *\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c 14 \u65e5\u4ee5\u4e0a\u904e\u53bb\u306e\u5834\u5408\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306f\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002*\n * *\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304c\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e\u4fdd\u6301\u671f\u9593\u3088\u308a\u3082\u53e4\u3044\u5834\u5408\u3001\u30d0\u30c3\u30c1\u306f\u3059\u3079\u3066\u30b9\u30ad\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002*\n * *\u5358\u4e00\u306e PutLogEvents \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30d0\u30c3\u30c1\u304c 24 \u6642\u9593\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001PutLogEvents \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u306f\u5931\u6557\u3057\u307e\u3059\u3002*\n\n<a name=\"agentstop\">*\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u505c\u6b62\u3055\u305b\u305f\u5834\u5408\u3001\u30c7\u30fc\u30bf\u640d\u5931\u3084\u91cd\u8907\u304c\u767a\u751f\u3057\u307e\u3059\u304b\u3002*\n\n* *\u72b6\u614b\u30d5\u30a1\u30a4\u30eb\u304c\u4f7f\u7528\u53ef\u80fd\u3067\u3042\u308a\u3001\u6700\u5f8c\u306b\u5b9f\u884c\u3055\u308c\u305f\u6642\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u767a\u751f\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u767a\u751f\u3057\u307e\u305b\u3093\u3002* ***CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306f\u505c\u6b62\u3057\u305f\u5834\u6240\u304b\u3089\u518d\u958b\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30d7\u30c3\u30b7\u30e5\u3092\u7d9a\u884c\u3067\u304d\u307e\u3059\u3002***\n\n##3.9 [\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u8868\u793a](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/ViewingLogData.html)\n<a name=\"retentionperiod\">\n##3.10 [\u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306e\u5909\u66f4](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/SettingLogRetention.html)\n\n***\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306f\u6c38\u7d9a\u7684\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002*** *\u305f\u3060\u3057\u3001\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306b\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u671f\u9593\u3092\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\u73fe\u5728\u306e\u4fdd\u6301\u8a2d\u5b9a\u3088\u308a\u53e4\u3044\u30c7\u30fc\u30bf\u306f\u3059\u3079\u3066\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u5404\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u306e\u30ed\u30b0\u306e\u4fdd\u6301\u671f\u9593\u306f\u3001\u3044\u3064\u3067\u3082\u5909\u66f4\u3067\u304d\u307e\u3059\u3002*\n\n* \u6b21\u306e\u671f\u9593\u7d4c\u904e\u5f8c\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5931\u52b9\n * \u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u300c\u5931\u52b9\u3057\u306a\u3044\u300d\u30fb\u30fb\u30fb\u6c38\u7d9a\u7684\u306b\u4fdd\u5b58\n\n\n#4. \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u691c\u7d22\u304a\u3088\u3073\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\n\n*CloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c Amazon CloudWatch \u3078\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u767a\u884c\u3092\u958b\u59cb\u3057\u305f\u5f8c\u30011 \u3064\u4ee5\u4e0a\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u691c\u7d22\u304a\u3088\u3073\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3092\u958b\u59cb\u3067\u304d\u307e\u3059\u3002\n\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f CloudWatch Logs \u306b\u9001\u4fe1\u3055\u308c\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u691c\u7d22\u3059\u308b\u305f\u3081\u306e\u8a9e\u53e5\u3068\u30d1\u30bf\u30fc\u30f3\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002CloudWatch Logs \u306f\u3053\u308c\u3089\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u30b0\u30e9\u30d5\u306e\u4f5c\u6210\u3084\u30a2\u30e9\u30fc\u30e0\u306e\u8a2d\u5b9a\u306b\u5229\u7528\u3067\u304d\u308b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u5909\u63db\u3057\u307e\u3059\u3002*\n\n*\u5404\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f\u4ee5\u4e0b\u306e\u30ad\u30fc\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002*\n\n***\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3***\n\n* *\u5404\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30c7\u30fc\u30bf\u3092 CloudWatch Logs \u304c\u3069\u306e\u3088\u3046\u306b\u89e3\u91c8\u3059\u308b\u304b\u306b\u3064\u3044\u3066\u306e\u8a18\u53f7\u306b\u3088\u308b\u8aac\u660e\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3001IP \u30a2\u30c9\u30ec\u30b9\u3001\u6587\u5b57\u5217\u306a\u3069\u304c\u542b\u307e\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u7d22\u5bfe\u8c61\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002*\n\n***\u30e1\u30c8\u30ea\u30af\u30b9\u540d***\n\n* *\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3055\u308c\u305f\u30ed\u30b0\u60c5\u5831\u304c\u767a\u884c\u3055\u308c\u308b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u540d\u524d\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001ErrorCount \u3068\u3044\u3046\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u767a\u884c\u3067\u304d\u307e\u3059\u3002*\n\n***\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593***\n\n* *\u65b0\u3057\u3044 CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u9001\u4fe1\u5148\u540d\u524d\u7a7a\u9593\u3067\u3059\u3002*\n\n***\u30e1\u30c8\u30ea\u30af\u30b9\u5024***\n\n* *\u30e1\u30c8\u30ea\u30af\u30b9\u306b\u767a\u884c\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300cError\u300d\u306a\u3069\u7279\u5b9a\u306e\u8a9e\u53e5\u306e\u767a\u751f\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u5024\u306f\u767a\u751f\u3059\u308b\u3054\u3068\u306b\u300c1\u300d\u306b\u306a\u308a\u307e\u3059\u3002\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\u5834\u5408\u306f\u3001\u767a\u884c\u3055\u308c\u308b\u5024\u306f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u5024\u306b\u306a\u308a\u307e\u3059\u3002*\n\n\n\n##4.1 \u30d5\u30a3\u30eb\u30bf\u3068\u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u6587\n\n***\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u6307\u5b9a\u3055\u308c\u305f\u3082\u306e\u306b\u4e00\u81f4\u3059\u308b\u8a9e\u53e5\u3084\u5024\u304c\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u4e2d\u3067\u691c\u7d22\u3055\u308c\u307e\u3059\u3002***\n***\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306f\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u3067\u8a9e\u53e5\u3001\u30d5\u30ec\u30fc\u30ba\u3001\u5024\u3092 1 \u3064\u898b\u3064\u3051\u308b\u305f\u3073\u306b CloudWatch \u30e1\u30c8\u30ea\u30af\u30b9\u3067\u30ab\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002***\n\u305f\u3068\u3048\u3070\u3001\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u4e2d\u3067 ERROR \u3068\u3044\u3046\u5358\u8a9e\u3092\u691c\u7d22\u3057\u3066\u51fa\u73fe\u56de\u6570\u3092\u6570\u3048\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306b\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3067\u533a\u5207\u3089\u308c\u305f\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u304b\u3089\u5024\u3092\u62bd\u51fa\u3059\u308b\u6a5f\u80fd\u3082\u3042\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001\u30a6\u30a7\u30d6\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ec\u30a4\u30c6\u30f3\u30b7\u30fc\u3067\u3059\u3002\u6761\u4ef6\u6f14\u7b97\u5b50\u3084\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5b8c\u5168\u4e00\u81f4\u3092\u898b\u3064\u3051\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4f5c\u6210\u3059\u308b\u524d\u306b\u3001CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u691c\u7d22\u30d1\u30bf\u30fc\u30f3\u3092\u30c6\u30b9\u30c8\u3067\u304d\u307e\u3059\u3002\n\n##4.2 [\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/MonitoringPolicyExamples.html)\n\n<a name=\"metricsfilter01\">**[(1) \u4f8b: \u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CountingLogEventsExample.html)**\n\n* /var/log/messages \u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ab\u30a6\u30f3\u30c8\u8a2d\u5b9a\u4f8b\n\n>1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n>\u3000https://console.aws.amazon.com/cloudwatch/\n\n>2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n\n>3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n\n>4) \u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30a4\u30f3\u3067\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u300d\n![20161223-01.png](https://qiita-image-store.s3.amazonaws.com/0/148868/693e59ae-495b-c614-73e6-2b961b7ef48e.png)\n\n>5) \u30ed\u30b0\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u5b9a\u7fa9\n>>\u30fb\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\n>>\u3000\u7a7a\u306e\u307e\u307e\n>>\u30fb\u30c6\u30b9\u30c8\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u9078\u629e\n>>\u3000\u305d\u306e\u307e\u307e\n>>\n>>\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n>6) \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n>>\u30fb\u30d5\u30a3\u30eb\u30bf\u306e\u540d\u524d\n>>\u3000VarLogMessagesCount\n>>\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593\n>>\u3000Test1NameSpace\n>>\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\n>>\u3000VarLogMessagesEventCount\n>>\n>>\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\n>>\n![20161223-02.png](https://qiita-image-store.s3.amazonaws.com/0/148868/150eb067-7e5f-5765-3af4-c745bf176716.png)\n>\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u304c\u300c1\u30d5\u30a3\u30eb\u30bf\u300d\u3068\u306a\u308b\n![20161223-03.png](https://qiita-image-store.s3.amazonaws.com/0/148868/3bbb7bf5-b563-e9cf-9e18-7218b95cade7.png)\n\n\n* \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u72b6\u614b\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\n\n  * \u4eca\u56de\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u306f\u3001\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\u3092\u7a7a\u306b\u3057\u305f\u305f\u3081\u3001/var/log/messages \u306e\u884c\u306b\u30de\u30c3\u30c1\u3059\u308b\u3002\n  * \u30e1\u30c8\u30ea\u30af\u30b9\u5024\u304c\uff11\u306a\u306e\u3067\u3001\uff11\u884c\u51fa\u529b\u3057\u305f\u3089\uff11\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u308b\u3002\n\n>1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n\n>2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n\n>3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u300d\n\n>4) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593(Test1NameSpace)\u3092\u9078\u629e\n\n>5) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d(VarLogMessagesEventCount)\u3092\u9078\u629e\n![20161223-04.png](https://qiita-image-store.s3.amazonaws.com/0/148868/ca13dba3-4aa2-18f7-579e-5c22941d7d9b.png)\n\n>6) \u300c\u30b0\u30e9\u30d5\u5316\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9(1)\u300d\u30bf\u30d6\u3092\u9078\u629e\n![20161223-05.png](https://qiita-image-store.s3.amazonaws.com/0/148868/c6a13187-187d-13c6-4ebc-112059614478.png)\n>\n>>\u300c\u7d71\u8a08\u300d\u3092 \u5e73\u5747 \u304b\u3089 \u5408\u8a08 \u3078\u5909\u66f4\u3059\u308b\n>\n>/var/log/messages \u306b\u51fa\u529b\u3055\u308c\u305f\u884c\u306e\u5408\u8a08\u30b0\u30e9\u30d5\uff08\u671f\u9593:\uff15\u5206\uff09\n![20161223-06.png](https://qiita-image-store.s3.amazonaws.com/0/148868/0a6d3f42-88c4-92b8-a2ba-45b1440a6bfa.png)\n>\n> logger \u30b3\u30de\u30f3\u30c9\u3067\u3001/var/log/messages \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u51fa\u529b\u3057\u3066\u30b0\u30e9\u30d5\u3092\u78ba\u8a8d\n\n<a name=\"metricsfilter02\">**[(2) \u4f8b: \u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CountOccurrencesExample.html)**\n\n* /var/log/messages \u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3055\u308c\u305f\u3001\u5358\u8a9e\u300cError\u300d\u306e\u51fa\u73fe\u56de\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\n\n>1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n\n>2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n\n>3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n\n>4) \u30b3\u30f3\u30c6\u30f3\u30c4\u30da\u30a4\u30f3\u3067\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u3092\u9078\u629e\u3057\u3066\u3001\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u300d\n\n>5) \u30ed\u30b0\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u5b9a\u7fa9\n>>\u30fb\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\uff08**\u30d1\u30bf\u30fc\u30f3\u306f\u5927\u6587\u5b57\u3068\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3059\u308b**)\n\u3000Error\n>>\n>>\u30d5\u30a3\u30eb\u30bf\u30fc\u30c6\u30b9\u30c8\u3092\u884c\u3046\u5834\u5408\n>>\u30fb\u30c6\u30b9\u30c8\u3059\u308b\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u9078\u629e\n\u3000- \u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30c7\u30fc\u30bf -\n>>\u30fb\u30d1\u30bf\u30fc\u30f3\u30c6\u30b9\u30c8\n>>\u3000\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u30c6\u30b9\u30c8\u3057\u305f\u3044\u30ed\u30b0\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3059\u308b\n>>\u3000\u203blogger\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u305f\u308a\u306a\u3093\u304b\u3057\u3066\u305d\u308c\u3089\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u305f\u3082\u306e\n<pre>\nDec 23 04:58:01 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 117980ms.\nDec 23 04:59:22 ip-10-0-0-144 ec2-user: This is a test error messages.\nDec 23 04:59:53 ip-10-0-0-144 ec2-user: This is a test Error messages.\nDec 23 04:59:59 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 110540ms.\nDec 23 05:01:50 ip-10-0-0-144 dhclient[2136]: XMT: Solicit on eth0, interval 115710ms.\nDec 23 05:02:01 ip-10-0-0-144 ec2-user: error\nDec 23 05:02:04 ip-10-0-0-144 ec2-user: Error\n</pre>\n>>\n>>\u30d1\u30bf\u30fc\u30f3\u306e\u30c6\u30b9\u30c8 \u3092\u5b9f\u65bd\u3059\u308b \u21d2 \u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\n>>\n![20161223-07.png](https://qiita-image-store.s3.amazonaws.com/0/148868/f06a6dc9-c3d9-ccd1-41d8-4a76a6338253.png)\n>>\n>>\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n\n>6) \u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\u3068\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u5272\u308a\u5f53\u3066\n>>\u30fb\u30d5\u30a3\u30eb\u30bf\u306e\u540d\u524d\n\u3000VarLogMessagesErrorCount\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593\n\u3000Test1NameSpace\n\u30fb\u30e1\u30c8\u30ea\u30af\u30b9\u540d\n\u3000VarLogMessagesEventErrorCount\n>>\n>>\u30d5\u30a3\u30eb\u30bf\u306e\u4f5c\u6210\n>>\n![20161223-08.png](https://qiita-image-store.s3.amazonaws.com/0/148868/b5a09d12-9595-53d4-d94d-c0f99c2e2558.png)\n>\n>\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u300c/var/log/mesages\u300d\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u304c\u300c2\u30d5\u30a3\u30eb\u30bf\u300d\u3068\u306a\u308b\n>\n![20161223-09.png](https://qiita-image-store.s3.amazonaws.com/0/148868/2ac3b5ce-d3ad-452f-e606-13ef3304c0bf.png)\n\n* \u30e1\u30c8\u30ea\u30af\u30b9\u306e\u72b6\u614b\u3092\u30b0\u30e9\u30d5\u3067\u78ba\u8a8d\u3059\u308b\n  * \u4eca\u56de\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3067\u306f\u3001/var/log/messages \u30d5\u30a1\u30a4\u30eb\u5185\u306b \u5358\u8a9e\u300cError\u300d\u304c\u3042\u308b\u884c\u306b\u30de\u30c3\u30c1\u3059\u308b\u3002\n  * \u30e1\u30c8\u30ea\u30af\u30b9\u5024\u304c\uff11\u306a\u306e\u3067\u3001\u30de\u30c3\u30c1\u3059\u308b\u884c\u304c\u3042\u3063\u305f\u3089\uff11\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3055\u308c\u308b\u3002\n\n>1) CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n\n>2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n\n>3) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30e1\u30c8\u30ea\u30af\u30b9\u300d\n\n>4) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u524d\u7a7a\u9593(Test1NameSpace)\u3092\u9078\u629e\n>>\u3053\u306e\u3068\u304d\u3001/var/log/messages \u306b\u307e\u3060 \u5358\u8a9e\u300cError\u300d\u306e\u3042\u308b\u884c\u304c\u306a\u3044\u5834\u5408\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d\u300cVarLogMessagesEventErrorCount\u300d\u306f\u306a\u3044\u3002\n>>\u30c6\u30b9\u30c8\u3068\u3057\u3066\u3001logger\u30b3\u30de\u30f3\u30c9\u3067 /var/log/messages \u306b \u5358\u8a9e\u300cError\u300d\u3092\u51fa\u529b\u3055\u305b\u308b\u3002\n<pre>\n$ logger \"This is a test error messages.\"\n$ logger \"This is a test Error messages.\"\n$ logger error\n$ logger Error\n</pre>\n>>\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u300cVarLogMessagesEventErrorCount\u300d\u304c\u8868\u793a\u3055\u308c\u308b\n>>\n![20161223-10.png](https://qiita-image-store.s3.amazonaws.com/0/148868/85bda63b-f146-36de-cd11-26fafa88b97b.png)\n\n>5) \u3055\u304d\u307b\u3069\u4f5c\u6210\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u540d(VarLogMessagesEventErrorCount)\u3092\u9078\u629e\n\n>6) \u300c\u30b0\u30e9\u30d5\u5316\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9(1)\u300d\u30bf\u30d6\u3092\u9078\u629e\n>>\u300c\u7d71\u8a08\u300d\u3092 \u5e73\u5747 \u304b\u3089 \u5408\u8a08 \u3078\u5909\u66f4\u3059\u308b\n\n>/var/log/messages \u30d5\u30a1\u30a4\u30eb\u5185\u306b \u5358\u8a9e\u300cError\u300d\u304c\u3042\u308b\u884c\u306e\u5408\u8a08\u30b0\u30e9\u30d5\uff08\u671f\u9593:\uff15\u5206\uff09\n>\n![20161223-11.png](https://qiita-image-store.s3.amazonaws.com/0/148868/8cc2f924-8618-33c8-47ed-5eea90bd8b5a.png)\n\n\n<a name=\"metricsfilter03\">**[(3) \u4f8b: HTTP 404 \u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ab\u30a6\u30f3\u30c8](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/Counting404Responses.html)**\n\n<a name=\"metricsfilter04\">**[(4) \u4f8b: 400 \u30ec\u30d9\u30eb\u3092\u898b\u3064\u3051\u3066 4xx \u30e1\u30c8\u30ea\u30af\u30b9\u306b\u30ab\u30a6\u30f3\u30c8\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/FindCountMetric.html)**\n\n<a name=\"metricsfilter04\">**[(5) \u4f8b: Apache \u30ed\u30b0\u304b\u3089\u8ee2\u9001\u3055\u308c\u305f\u30d0\u30a4\u30c8\u6570\u306e\u62bd\u51fa](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/ExtractBytesExample.html)**\n\n##4.3 [\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u4e00\u89a7\u8868\u793a](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/ListingMetricFilters.html)\n\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u3092\u4e00\u89a7\u8868\u793a\n\n##4.4 [\u30e1\u30c8\u30ea\u30af\u30b9\u30d5\u30a3\u30eb\u30bf\u306e\u524a\u9664](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/DeletingMetricFilter.html)\n\n\u203b[\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u524a\u9664\u306b\u3064\u3044\u3066](#metricsdel)\n\n##4.5 [\u30d5\u30a3\u30eb\u30bf\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u691c\u7d22](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/SearchDataFilterPattern.html)\n\n*Amazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\u306e \u30d5\u30a3\u30eb\u30bf\u3068\u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u6587 \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u691c\u7d22\u3067\u304d\u307e\u3059\u3002\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u3059\u3079\u3066\u306e\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u691c\u7d22\u3059\u308b\u304b\u3001\u3053\u306e\u30c7\u30fc\u30bf\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\u3092\u691c\u7d22\u3067\u304d\u307e\u3059\u3002*\n\n\n#5. [\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u305f\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u51e6\u7406](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/Subscriptions.html)\n*\u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066 CloudWatch Logs \u304b\u3089\u306e\u30ed\u30b0\u30a4\u30d9\u30f3\u30c8\u306e\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30d5\u30a3\u30fc\u30c9\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u51e6\u7406\u3001\u5206\u6790\u3001\u4ed6\u306e\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u30ed\u30fc\u30c9\u3092\u884c\u3046\u305f\u3081\u306b\u3001Amazon Kinesis \u30b9\u30c8\u30ea\u30fc\u30e0\u3084 AWS Lambda \u306a\u3069\u306e\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u914d\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002*\n\n**CloudWatch \u30ed\u30b0\u306f\u3001Lambda \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u30c7\u30fc\u30bf\u3092 Amazon Elasticsearch Service \u306b\u914d\u4fe1\u3059\u308b\u3002**\n\u21d2[7. Amazon ES \u3078\u306e \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30ed\u30b0 \u30c7\u30fc\u30bf](#7-amazon-es-%E3%81%B8%E3%81%AE-%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0-%E3%83%AD%E3%82%B0-%E3%83%87%E3%83%BC%E3%82%BF)\n\n#6. [\u30ed\u30b0\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067 Amazon S3 \u306b\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/S3Export.html)\n\n#7. [Amazon ES \u3078\u306e \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30ed\u30b0 \u30c7\u30fc\u30bf](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/CWL_ES_Stream.html)\n*[CloudWatch Logs \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/Subscriptions.html)\u3092\u901a\u3057\u3066\u3001\u307b\u307c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067Amazon Elasticsearch Service (Amazon ES) \u30af\u30e9\u30b9\u30bf\u30fc\u3067\u53d7\u3051\u53d6\u308bCloudWatch Logs \u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u30b9\u30c8\u30ea\u30fc\u30e0\u30c7\u30fc\u30bf\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002* ***CloudWatch\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u3088\u308a\u3053\u306e\u8a2d\u5b9a\u3092\u88dc\u52a9\u3059\u308b\u305f\u3081\u306e\u7c21\u5358\u306a\u30a6\u30a3\u30b6\u30fc\u30c9\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059*** (Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3082\u81ea\u52d5\u751f\u6210\u3057\u3066\u304f\u308c\u308b)\u3002\n\n*\u5927\u91cf\u306e CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon ES \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3059\u308b\u3068\u3001AWS \u8acb\u6c42\u66f8\u306e\u5229\u7528\u6599\u91d1\u304c\u9ad8\u984d\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4e88\u60f3\u3088\u308a\u9ad8\u3044\u91d1\u984d\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3001[AWS \u8acb\u6c42\u66f8\u3092\u76e3\u8996\u3059\u308b](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/Amazon%20CloudWatch%20%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%AC%E3%82%A4%E3%83%89gs_monitor_estimated_charges_with_cloudwatch.html)\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002*\n\n<a name=\"cloudtrailamazones\">**CloudTrail \u30ed\u30b0\u3092 Amazon ES \u3078\u9001\u308b\u8a2d\u5b9a\u624b\u9806**\n\n* \u6ce8\u610f\n * [CloudTrail \u30ed\u30b0\u3092 CloudTrail\u30ed\u30b0\u3092CloudWatch Logs\u3078\u9001\u4fe1\u3059\u308b\u8a2d\u5b9a](http://qiita.com/tonishy/items/bb5832c59d309fb1db4d#341-sending-cloudtrail-events-to-cloudwatch-logs)\u304c\u6e08\u3093\u3067\u3044\u308b\u3053\u3068\n * [Amazon ES \u6599\u91d1\u304c\u767a\u751f\u3059\u308b](https://aws.amazon.com/jp/elasticsearch-service/pricing/)\n * \u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u30d5\u30ed\u30fc \u300cCloudTrail \u2192 CloudWatch Logs \u2192 Amazon Lambda \u2192 Amazon ES\u300d\n\n[1] Amazon ES \u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\n>1) Amazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n\n>2) \u30ea\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d(\u4eca\u56de\u306f\u6771\u4eac)\n\n>3) Get started\n\n>4) Define domain\n>>\u30fbElasticsearch domain name\n\u3000cloudtrail\n>>\n>>\u30fbElasticsearch version\n\u30002.3\n\n>5) Configure cluster (\u4eca\u56de\u306f\u30c6\u30b9\u30c8\u7528\u306a\u306e\u3067\u306a\u308b\u3079\u304f\u6700\u5c0f\u69cb\u6210)\n>>Node configuration\n>>>\u30fbInstance count\n\u30001\n>>>\u30fbInstance type\n\u3000t2/micro\n\n>>Storage configuration\n>>>\u30fbStorage type\n\u3000EBS\n\n>6) Set up access policy\n\u3000\u4eca\u56de\u306f\u3001\u63a5\u7d9a\u5143IP\u30a2\u30c9\u30ec\u30b9\u5236\u9650\n>>\u30fbSet the domain access policy to\n\u3000Allow access to the domain from specific IP(s)\n\u3000\u2193\n\u3000\u4eca\u56de\u306f\u3001\u81ea\u5b85\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u56de\u7dda\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\n\n>7) Review\n![20161226-01.png](https://qiita-image-store.s3.amazonaws.com/0/148868/52804be0-1636-28ff-7275-99e9c28acc95.png)\n\n>8) Domain status \u304c Loading \u2192 Active \u306b\u306a\u308b\u307e\u3067\u66ab\u304f\u5f85\u3064\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-26 16.54.58.png](https://qiita-image-store.s3.amazonaws.com/0/148868/b84c3bbf-4acb-23a3-7e7d-c12e06262ab4.png)\n\u2193\n![20161226-03.png](https://qiita-image-store.s3.amazonaws.com/0/148868/ce0b32c7-93ab-b35e-79a4-e6fdb1248559.png)\n\n[2] CloudWatch Logs \u30c7\u30fc\u30bf\u3092 Amazon ES \u3078Amazon ES \u3078\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3059\u308b\n\n>1) Amazon CloudWatch \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/cloudwatch/\n\n>2) \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30da\u30a4\u30f3\u300c\u30ed\u30b0\u300d\n>>cloudtrail \u306e\u30ed\u30b0\u30b0\u30eb\u30fc\u30d7\u3092\u9078\u629e \u21d2 \u30a2\u30af\u30b7\u30e7\u30f3 \u21d2 Amazon Elasticsearch Service \u3078\u306e\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u306e\u958b\u59cb\n\n>3) Amazon Elasticsearch Service \u3078\u306e CloudTrail/test-logs \u306e\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3092\u958b\u59cb\u3059\u308b\n>>\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u9078\u629e\n\u3000\u3053\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n>>\u30fbAmazon ES \u30af\u30e9\u30b9\u30bf\u30fc\n\u3000cloudtrail \uff08[1]\u3067\u4f5c\u6210\u3057\u305f\u3082\u306e)\n>>\u30fbLambda IAM \u5b9f\u884c\u30ed\u30fc\u30eb\n\u3000\u65b0\u3057\u3044IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n>>\n![20161226-04.png](https://qiita-image-store.s3.amazonaws.com/0/148868/abfb2bf1-0f7e-7246-8af7-992467ad6e09.png)\n>>\n>>\u8a31\u53ef\n\n>4) \u30ed\u30b0\u5f62\u5f0f\u3068\u30d5\u30a3\u30eb\u30bf\u306e\u8a2d\u5b9a\n>>\u30fb\u30ed\u30b0\u306e\u5f62\u5f0f\n\u3000AWS \u00c7loudTrail\n\n>5) \u78ba\u8a8d\n>>\n![20161226-05.png](https://qiita-image-store.s3.amazonaws.com/0/148868/e523c4e8-f987-be95-6ee8-0631ac3c22e5.png)\n\u2193\n![20161226-06.png](https://qiita-image-store.s3.amazonaws.com/0/148868/d527d421-2c0a-8b1e-cbbe-6cbf9007af78.png)\n>>\n>>\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u306e\u958b\u59cb\n>>\n>>\u203bLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3(LogsToElasticsearch_cloudtrail)\u304c\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\n>>\u203bCloundWatch Logs (/aws/lambda/LogsToElasticsearch_cloudtrail) \u304c\u81ea\u52d5\u751f\u6210\u3055\u308c\u308b\n\n[3] Kibana4 \u3067 CloudTrail \u30ed\u30b0\u3092\u53ef\u8996\u5316\n\n>1) Amazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n\n>![20161226-07.png](https://qiita-image-store.s3.amazonaws.com/0/148868/22c1b0fe-6e69-8acf-a119-82f7791a661b.png)\n\n>2) Indices \u78ba\u8a8d\n>>\n>>[1] \u3067\u4f5c\u6210\u3057\u305fAmazon ES \u30c9\u30e1\u30a4\u30f3\u300ccloudtrail\u300d\u3092\u30af\u30ea\u30c3\u30af\n>>\n![20161226-08.png](https://qiita-image-store.s3.amazonaws.com/0/148868/20a19fc9-7771-9b5b-dd92-cb15958fb929.png)\n>> Indices \u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\n![20161226-09.png](https://qiita-image-store.s3.amazonaws.com/0/148868/2737be4f-cf46-7da0-6635-8304937cf642.png)\n\n\n>3) Kibana \u30b5\u30a4\u30c8\u3078\n\n>>Amazon Elasticsearch Service \u30b3\u30f3\u30bd\u30fc\u30eb\n\u3000https://console.aws.amazon.com/es/\n\n>>[1] \u3067\u4f5c\u6210\u3057\u305fAmazon ES \u30c9\u30e1\u30a4\u30f3\u300ccloudtrail\u300d\u3092\u30af\u30ea\u30c3\u30af\n>>\n![20161226-10.png](https://qiita-image-store.s3.amazonaws.com/0/148868/425ec246-52c2-7045-f621-c53a7fcba23c.png)\n>>\n>>Kibana \u306eURL\u3092\u30af\u30ea\u30c3\u30af\n\n>4) Kibana \u521d\u671f\u8a2d\u5b9a\n\n>>\u30fbConfigure an index pattern\n\u3000Index contains time-based events\uff1a\u30c1\u30a7\u30c3\u30af\n\u3000Index name or pattern\uff1a cwl-*\n\u3000Time-field name: @timestamp\n>>![20161226-11.png](https://qiita-image-store.s3.amazonaws.com/0/148868/0b757671-0a18-d023-d17e-395b53974fae.png)\n>>\n>>Create\n>>\u2193\n![20161226-12.png](https://qiita-image-store.s3.amazonaws.com/0/148868/11285eb6-2d72-f2ba-3928-3170ad3a85b7.png)\n>>\u2193\nDiscover\n![20161226-13.png](https://qiita-image-store.s3.amazonaws.com/0/148868/dd0d4eb3-1e2c-b56a-d412-75f7818eee09.png)\n\n\n\n\n#8. [\u8a8d\u8a3c\u3068\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/auth-and-access-control-cwl.html)\n\n\n#9. [AWS CloudTrail \u3067\u306e Amazon CloudWatch Logs API \u547c\u3073\u51fa\u3057\u306e\u30ed\u30b0\u4f5c\u6210](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/logs/logging_cw_api_calls_cwl.html)\n"}