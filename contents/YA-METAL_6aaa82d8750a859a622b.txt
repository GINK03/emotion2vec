{"context": "\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u6e96\u5099\n\nEXCEL\u3067\u4e0b\u306e\u5185\u5bb9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210(\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf)\nuxxx1:pxxx1::users::/home/uxxx1:/bin/bash\nuxxx2:pxxx2::users::/home/uxxx2:/bin/bash\nuxxx2:pxxx2::users::/home/uxxx2:/bin/bash\n\n\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9(main)\n\n#!/bin/sh\n\n/usr/sbin/newusers $1\nawk -F\":\" '{print $1\":\"$2 }' $1 |/usr/sbin/chpasswd\n./skel2 $1\nphp newdb.php <$1\n\n\n\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9(skel2)\n\n#!/bin/sh\n\nfor rec in `cat $1`\ndo\nIFS_OLD=IFS\nIFS=\":\"\nset -- $rec\nuser=$1\ngroup=$4\nIFS=IFS_OLD\necho $user\n(cd /etc/skel/;tar cf - .)|(cd /home/$user;tar xf -)\nchmod 755 /home/$user\nchown -R $user /home/$user\nchgrp -R $group /home/$user\ntouch /home/$user\ndone\n\n\nPHP\u30b9\u30af\u30ea\u30d7\u30c8(newdb.php)\n\n<?php\n\n$dsn = \"mysql:host=127.0.0.1\";\n$user = 'root';\n$pass = '\u30d1\u30b9\u30ef\u30fc\u30c9';\ntry {\n  $dbh = new PDO($dsn,$user,$pass);\n} catch(PDOException $e) {\n  echo 'Connection faild: '.$e->getMessage();\n}\n$fp = fopen(\"php://stdin\",\"r\");\n\nwhile($rec = fgets($fp)) {\n        list($user,$pass) = explode(\":\",$rec);\n        $sql = \"CREATE USER {$user}@localhost IDENTIFIED BY '{$pass}'\";\n        $dbh->query($sql);\n        $sql = \"GRANT USAGE ON * . * TO '{$user}'@'localhost' IDENTIFIED BY '{$pass}' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0\";\n        $dbh->query($sql);\n        $sql = \"CREATE DATABASE IF NOT EXISTS `{$user}`\" ;\n        $dbh->query($sql);\n        $sql = \"GRANT ALL PRIVILEGES ON  `{$user}` . * TO  '{$user}'@'localhost'\";\n        $dbh->query($sql);\n        print \"$user $pass\\n\";\n}\nfclose($fp);\n\n\n\n\n\u5b9f\u884c\n./main \u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\nskel2\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(/etc/skel)\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nnewdb.php\u306fMySQL\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u500b\u3005\u306e\u5229\u7528\u8005\u306b\uff11\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002\n#\u30d5\u30a1\u30a4\u30eb\u3092\u6e96\u5099\n<dl>\n<dt>EXCEL\u3067\u4e0b\u306e\u5185\u5bb9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210(\u30e6\u30fc\u30b6\u30c7\u30fc\u30bf)</dt>\n<dd><pre>\nuxxx1:pxxx1::users::/home/uxxx1:/bin/bash\nuxxx2:pxxx2::users::/home/uxxx2:/bin/bash\nuxxx2:pxxx2::users::/home/uxxx2:/bin/bash\n</pre></dd>\n<dt>\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9(main)</dt>\n<dd>\n<pre>\n#!/bin/sh\n\n/usr/sbin/newusers $1\nawk -F\":\" '{print $1\":\"$2 }' $1 |/usr/sbin/chpasswd\n./skel2 $1\nphp newdb.php &lt;$1\n</pre>\n</dd>\n<dt>\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9(skel2)</dt>\n<dd>\n<pre>\n#!/bin/sh\n\nfor rec in `cat $1`\ndo\nIFS_OLD=IFS\nIFS=\":\"\nset -- $rec\nuser=$1\ngroup=$4\nIFS=IFS_OLD\necho $user\n(cd /etc/skel/;tar cf - .)|(cd /home/$user;tar xf -)\nchmod 755 /home/$user\nchown -R $user /home/$user\nchgrp -R $group /home/$user\ntouch /home/$user\ndone\n</pre>\n</dd>\n<dt>PHP\u30b9\u30af\u30ea\u30d7\u30c8(newdb.php)</dt>\n<dd>\n<pre>\n&lt;?php\n\n$dsn = \"mysql:host=127.0.0.1\";\n$user = 'root';\n$pass = '\u30d1\u30b9\u30ef\u30fc\u30c9';\ntry {\n  $dbh = new PDO($dsn,$user,$pass);\n} catch(PDOException $e) {\n  echo 'Connection faild: '.$e->getMessage();\n}\n$fp = fopen(\"php://stdin\",\"r\");\n\nwhile($rec = fgets($fp)) {\n        list($user,$pass) = explode(\":\",$rec);\n        $sql = \"CREATE USER {$user}@localhost IDENTIFIED BY '{$pass}'\";\n        $dbh->query($sql);\n        $sql = \"GRANT USAGE ON * . * TO '{$user}'@'localhost' IDENTIFIED BY '{$pass}' WITH MAX_QUERIES_PER_HOUR 0 MAX_CONNECTIONS_PER_HOUR 0 MAX_UPDATES_PER_HOUR 0 MAX_USER_CONNECTIONS 0\";\n        $dbh->query($sql);\n        $sql = \"CREATE DATABASE IF NOT EXISTS `{$user}`\" ;\n        $dbh->query($sql);\n        $sql = \"GRANT ALL PRIVILEGES ON  `{$user}` . * TO  '{$user}'@'localhost'\";\n        $dbh->query($sql);\n        print \"$user $pass\\n\";\n}\nfclose($fp);</pre>\n</dd>\n</dl>\n#\u5b9f\u884c\n./main \u30e6\u30fc\u30b6\u30c7\u30fc\u30bf\nskel2\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(/etc/skel)\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nnewdb.php\u306fMySQL\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u500b\u3005\u306e\u5229\u7528\u8005\u306b\uff11\u3064\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n", "tags": ["Linux", "\u5229\u7528\u8005\u767b\u9332", "\u30b9\u30af\u30ea\u30d7\u30c8", "fedora", "MySQL"]}