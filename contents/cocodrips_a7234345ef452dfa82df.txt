{"context": "#ladiescpp \u306e\u4e3b\u50ac\u3057\u3066\u308b \u30aa\u30f3\u30e9\u30a4\u30f3SICP\u8aad\u66f8\u5973\u5b50\u4f1a #4 (1.2.4~1.2.6) - connpass\u306e\u307e\u3068\u3081\u3067\u3059\u301c\u3002\n\n\u6307\u6570\u8a08\u7b97\uff08\u524d\u56de\u7d9a\u304d\uff09\n\n\u7df4\u7fd2\u554f\u984c1.19\nfib(n+1)\u304b\u3089fib(n)\u304c\u308f\u304b\u308b\u306a\u3089\u3001\nfib(n+2)\u3082fib(n)\u304b\u3089\u6c42\u3081\u3089\u308c\u308b\u306f\u305a\uff01 \u307f\u305f\u3044\u306a\u554f\u984c\u3002\n\\begin{align}\na_{n+1} &= b_nq + a_nq + a_np \\\\\nb_{n+1} &= b_np + a_nq\n\\end{align}\nan+1=bnq+anq+anpbn+1=bnp+anqan+1bn+1=bnq+anq+anp=bnp+anq{\\begin{align}\na_{n+1} &= b_nq + a_nq + a_np \\\\\nb_{n+1} &= b_np + a_nq\n\\end{align}\n}\n\u3068\u304a\u304f\u3002\n\\begin{align}\na_{n+2} &= (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\nb_{n+2} &= (b_np + a_nq)p + (b_nq + a_nq + a_np)q\n\\end{align}\nan+2=(bnp+anq)q+(bnq+anq+anp)q+(bnq+anq+anp)pbn+2=(bnp+anq)p+(bnq+anq+anp)qan+2bn+2=(bnp+anq)q+(bnq+anq+anp)q+(bnq+anq+anp)p=(bnp+anq)p+(bnq+anq+anp)q{\\begin{align}\na_{n+2} &= (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\nb_{n+2} &= (b_np + a_nq)p + (b_nq + a_nq + a_np)q\n\\end{align}\n}\n\u306a\u306e\u3067\u3001\u5c55\u958b\u3057\u3066\u3044\u304f\u3068\n\\begin{align}\n\\qquad &a_{n+2} \\\\\n&\\quad = (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\n&\\quad = a_n(2pq + q^2) + b_n(2pq + q^2) + a_n(p^2 + q^2)\\\\\n\\\\\n\\qquad &b_{n+2}\\\\\n&\\quad = (b_np + a_nq)p + (b_nq + a_nq + a_np)q \\\\\n&\\quad = a_n(2pq + q^2) + b_n(p^2 + q^2)\n\\end{align}\nan+2=(bnp+anq)q+(bnq+anq+anp)q+(bnq+anq+anp)p=an(2pq+q2)+bn(2pq+q2)+an(p2+q2)bn+2=(bnp+anq)p+(bnq+anq+anp)q=an(2pq+q2)+bn(p2+q2)an+2=(bnp+anq)q+(bnq+anq+anp)q+(bnq+anq+anp)p=an(2pq+q2)+bn(2pq+q2)+an(p2+q2)bn+2=(bnp+anq)p+(bnq+anq+anp)q=an(2pq+q2)+bn(p2+q2){\\begin{align}\n\\qquad &a_{n+2} \\\\\n&\\quad = (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\n&\\quad = a_n(2pq + q^2) + b_n(2pq + q^2) + a_n(p^2 + q^2)\\\\\n\\\\\n\\qquad &b_{n+2}\\\\\n&\\quad = (b_np + a_nq)p + (b_nq + a_nq + a_np)q \\\\\n&\\quad = a_n(2pq + q^2) + b_n(p^2 + q^2)\n\\end{align}\n}\n\u6700\u521d\u306e\u5f0f\u3068\u898b\u6bd4\u3079\u3066\n\\begin{align}\np' &= p^2 + q^2 \\\\\nq' &= 2pq + q^2\n\\end{align}\np\u2032=p2+q2q\u2032=2pq+q2{\\begin{align}\np' &= p^2 + q^2 \\\\\nq' &= 2pq + q^2\n\\end{align}\n}\n\u5143\u306e\u95a2\u6570\u306b\u3053\u308c\u3092\u4ee3\u5165\n(define (fib n) (fib-iter 1 0 0 1 n))\n(define (fib-iter a b p q count)\n  (cond ((= count 0) b)\n    ((even? count)\n     (fib-iter a\n           b\n           (+ (* p p) (* q q))\n           (+ (* 2 p q) (* q q))\n           (/ count 2)))\n    (else (fib-iter\n           (+ (* b q) (* a q) (* a p))\n           (+ (* b p) (* a q))\n           p\n           q\n           (- count 1)))))\n\n(fib 10) ; 55 \u3042\u3063\u3066\u308b\uff01\n\n\n\u6700\u5927\u516c\u7d04\u6570\n\n\u7df4\u7fd2\u554f\u984c1.20\n\u4ee5\u4e0b@hio-harp \u3055\u3093\u306e\u89e3\u7b54\u5f15\u7528 \u5f15\u7528\u5143\u306f\u3053\u3061\u3089\n\u6b63\u898f\u9806\u5e8f\u8a55\u4fa1\u898f\u5247\u306e\u5834\u5408\n; [\u5165\u529b]\n(gcd 206 40)\n\n; [step 1]\n; a1=206, b1=40. <env:none>\n(if (= b1 0)\n    a1\n    (gcd b1 (remainder a1 b1)))\n; <eval b1> <env:a1=206, b1=40>\nb1\n40\n; pred ==> false.\nelse-clause\n(gcd b1 (remainder a1 b1))\n\n; [step 2]\n; a2=b1, b2=(remainder a1 b1) <env:a1=206, b1=40>\n(if (= b2 0)\n    a2\n    (gcd b2 (remainder a2 b2)))\n; <eval b2> <env:a1=206, b1=40; a2=b1, b2=(remainder a1 b1)>\nb2\n(remainder a1 b1)\n(remainder 206 40)\n; REMAINDER 1 \u56de\u76ee.\n6 ; <env:a1=206, b1=40, a2=b1, b2=6>\n; pred = false\nelse-clause\n(gcd b2 (remainder a2 b2))\n\n; [step 3]\n; a3=b2, b3=(remainder a2 b2) <env:a1=206, b1=40, a2=b1, b2=6>\n(if (= b3 0)\n    a3\n    (gcd b3 (remainder a3 b3)))\n; <eval b3> <env:a1=206, b1=40; a2=b1, b2=6; a3=b2, b3=(remainder a2 b2)>\nb3\n(remainder a2 b2)\n(remainder b1 6)\n(remainder 40 6) ; <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=(remainder a2 b2)>\n; REMAINDER 2 \u56de\u76ee.\n4 ; <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4>\n; pred = false\nelse-clause\n(gcd b3 (remainder a3 b3))\n\n; [step 4]\n; a4=b3, b4=(remainder a3 b3) <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4>\n(if (= b4 0)\n    a4\n    (gcd b4 (remainder a4 b4)))\n; <eval b4> <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4; a4=b3, b4=(remainder a3 b3)>\nb4\n(remainder a3 b3)\n(remainder b2 4)\n(remainder 6 4) ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=(remainder a3 b3)>\n; REMAINDER 3 \u56de\u76ee.\n2 ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=2>\n; pred = false\nelse-clause\n(gcd b4 (remainder a4 b4))\n\n; [step 5]\n; a5=b4, b5=(remainder a4 b4) <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=2>\n(if (= b5 0)\n    a5\n    (gcd b5 (remainder a5 b5)))\n; <eval b5> <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=b3; a5=b4, b5=(remainder a4 b4)>\nb5\n(remainder a4 b4)\n(remainder b3 2)\n(remainder 4 2) ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=(remainder a4 b4)>\n; REMAINDER 4 \u56de\u76ee.\n0 ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=0>\n; pred = true\nthen-clause\na5\n; <eval a5> <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=0>\na5\nb4\n2 ; answer.\n\n; remainder \u6f14\u7b97\u306f\u5408\u8a084\u56de.\n\n\u9069\u7528\u9806\u5e8f\u8a55\u4fa1\u898f\u5247\u306e\u5834\u5408\n; [\u5165\u529b]\n(gcd 206 40)\n\n; [step 1]\n; a1=206, b1=40. <env:none>\n(if (= b1 0)\n    a1\n    (gcd b1 (remainder a1 b1)))\n; <eval b1> <env:a1=206, b1=40>\nb1\n40\n; pred ==> false.\nelse-clause\n(gcd b1 (remainder a1 b1))\n(gcd 40 (remainder 206 40))\n; REMAINDER 1 \u56de\u76ee.\n(gcd 40 6)\n\n; [step 2]\n; a2=40, b2=6\n(if (= b2 0)\n    a2\n    (gcd b2 (remainder a2 b2)))\n; <eval b2> <env:a2=40, b2=6>\nb2\n6\n; pred ==> false.\nelse-clause\n(gcd b2 (remainder a2 b2))\n(gcd 6 (remainder  40 6))\n; REMAINDER 2 \u56de\u76ee.\n(gcd 6 4)\n\n; [step 3]\n; a3=6 b3=4\n(if (= b3 0)\n    a3\n    (gcd b3 (remainder a3 b3)))\n; <eval b3> <env:a3=6, b3=4>\nb3\n4\n; pred ==> false.\nelse-clause\n(gcd b3 (remainder a3 b3))\n(gcd 4 (remainder  6 4))\n; REMAINDER 3 \u56de\u76ee.\n(gcd 4 2)\n\n; [step 4]\n; a4=4 b4=2\n(if (= b4 0)\n    a4\n    (gcd b4 (remainder a4 b4)))\n; <eval b4> <env:a4=4, b4=2>\nb4\n2\n; pred ==> false.\nelse-clause\n(gcd b4 (remainder a4 b4))\n(gcd 2 (remainder  4 2))\n; REMAINDER 4 \u56de\u76ee.\n(gcd 2 0)\n\n; [step 5]\n; a5=2 b5=0\n(if (= b5 0)\n    a5\n    (gcd b5 (remainder a5 b5)))\n; <eval b5> <env:a5=2, b5=0>\nb5\n0\n; pred ==> true\nthen-clause\na5\n; <eval a5> <env:a5=2, b5=0>\na5\n2 ; answer.\n\n; \u3053\u3061\u3089\u306e\u5834\u5408\u3067\u3082 remainder \u6f14\u7b97\u306f\u5408\u8a084\u56de.\n\n\n\u7d20\u6570\u5224\u5b9a\n\u30d5\u30a7\u30eb\u30de\u30fc\u306e\u5c0f\u5b9a\u7406 \n\nn\u304c\u7d20\u6570, n < a (a\u306f\u6574\u6570)\na^n mod n = a mod n\n\n\u3092a\u304c\u7d20\u6570\u306e\u6642\u306b\u6e80\u305f\u3059\na\u304c\u7d20\u6570\u3058\u3083\u306a\u304f\u3066\u3082\u305f\u307e\u306b\u6e80\u305f\u3059\n\n1\u56de\u30d5\u30a7\u30eb\u30de\u30fc\u30c6\u30b9\u30c8(times=1)\u3059\u308b\u306e\u306e\u8a08\u7b97\u6642\u9593\u306f O(log(n))\n\n\u7df4\u7fd2\u554f\u984c1.21\n\nsmallest-divisor\u624b\u7d9a\u304d\u3092\u4f7f\u3063\u3066\u6b21\u306e\u6570\u5024\u306e\u6700\u5c0f\u306e\u7d04\u6570\u3092\u6c42\u3081\u3088\u3002199, 1999, 19999.\n\n;;smallest-divisor.scm\n(define (smallest-divisor n)\n  (find-divisor n 2))\n\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n    ((divides? test-divisor n) test-divisor)\n    (else (find-divisor  n (+ test-divisor 1)))))\n\n(define (divides? a b) (= (remainder b a) 0))\n\n(define (prime? n)\n  (= n (smallest-divisor n)))\n\n(load \"./smallest-divisor.scm\")\n\n(smallest-divisor 199) ;199\n(smallest-divisor 1999) ;1999\n(smallest-divisor 19999) ;7\n\n\n\u7df4\u7fd2\u554f\u984c1.22\n\nn~m\u307e\u3067\u306e\u6570\u5b57\u304c\u7d20\u6570\u304b\u3069\u3046\u304b\u307f\u3066\u3044\u3063\u3066\u3001\n\u7d20\u6570\u3060\u3063\u305f\u3089\u305d\u308c\u3092\u5224\u5b9a\u3059\u308b\u306e\u306b\u4f55\u30de\u30a4\u30af\u30ed\u79d2\u304b\u304b\u3063\u305f\u304b\u3092\u8abf\u3079\u308b\u95a2\u6570\nfermat\u30c6\u30b9\u30c8\u3092\u4f7f\u308f\u305a\u306b\u3001\u666e\u901a\u306bn\u306b\u5bfe\u3057\u3066\u221an\u307e\u3067\u3067\u5272\u308c\u308b\u304b\u3067\u7d20\u6570\u5224\u5b9a\u3092\u3059\u308b\u3002\n\n;; 1.22.scm\n(load \"./smallest-divisor.scm\")\n\n(define (timed-prime-test n)\n  (newline)\n  (display n)\n  (start-prime-test n (runtime)))\n\n(define (start-prime-test n start-time)\n  (if (prime? n)\n      (report-prime (- (runtime) start-time))))\n\n(define (report-prime elapsed-time)\n  (display \" *** \")\n  (display elapsed-time))\n\n(define (runtime)\n  (use srfi-11)\n  (let-values (((a b) (sys-gettimeofday)))\n    (+ (* a 1000000) b))) ;; gosh \u306bruntime\u5b9f\u88c5\u304c\u306a\u3044\n\n(define (search-for-primes n end)\n  (cond ((even? n) (search-for-primes (+ n 1) end))\n    ((> n end) (display \"end\"))\n    (else (timed-prime-test n) (search-for-primes (+ n 2) end))))\n\n(search-for-primes 1000 1050) ; 1009 1013 1019 \uff5c6\n(search-for-primes 10000 10100) ; 10007 10009 10037 \uff5c17\n(search-for-primes 100000 100100) ; 100003 100019 100043\uff5c 55 \n(search-for-primes 1000000 1000030) ; 395\n(search-for-primes 10000000 10000030) ; 797\n; \u221a10000          100: 17\n; \u221a1000000            1000: 395\n\nO(\u221an)\u306b\u5bfe\u3057\u3066 \u59a5\u5f53\u306a\u306e\u304b\u3069\u3046\u304b\u306f\u826f\u304f\u308f\u304b\u3089\u306a\u3044\n100:17 \u2252 1000: 395 \u3068\u3044\u3048\u308b\u304b\uff1f\n\u203b\u4f55\u5ea6\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3068\u3001\u5b9f\u884c\u6642\u95932\u500d\u4f4d\u8a08\u7b97\u6642\u9593\u306b\u3070\u3089\u3064\u304d\u304c\u3042\u308b\u306e\u3067\u602a\u3057\u3044\u3002\n\n\u7df4\u7fd2\u554f\u984c1.23\n\n1.22\u3067\u306f\u3001n\u306b\u5bfe\u3057\u30661 ~ \u221an\u307e\u3067\u3067\u5272\u308c\u308b\u304b\u8abf\u3079\u3066\u3044\u305f\u304c\u3001\n2\u4ee5\u4e0a\u306e\u5076\u6570\u3067\u5272\u3063\u3066\u3082\u4ed5\u65b9\u304c\u306a\u3044\u3002\u305d\u3053\u30672\u4ee5\u4e0a\u306e\u5076\u6570\u306f\u98db\u3070\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\u305d\u3046\u3059\u308b\u30682\u500d\u65e9\u304f\u306a\u308b\u306f\u305a\n\n\u305f\u3057\u304b\u306b2\u500d\u304f\u3089\u3044\u65e9\u304f\u306a\u3063\u305f\n(load \"./1.22.scm\")\n\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n    ((divides? test-divisor n) test-divisor)\n    (else (find-divisor  n (+ test-divisor 1)))))\n\n(search-for-primes 1000 1020) ; 1009 1013 1019 \uff5c9\u30de\u30a4\u30af\u30ed\u79d2\n(search-for-primes 10000 10138) ; 10007 10009 10037 \uff5c26\n(search-for-primes 100000 100044) ; 100003 100019 100043 \uff5c65 \n\n(define (next x) (if (= x 2) 3 (+ x 2)))\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n    ((divides? test-divisor n) test-divisor)\n    (else (find-divisor  n (next test-divisor)))))\n\n\n(search-for-primes 1000 1020) ; 1009 1013 1019 \uff5c4\n(search-for-primes 10000 10138) ; 10007 10009 10037 \uff5c11\n(search-for-primes 100000 100044) ; 100003 100019 100043 \uff5c36 \n\n\n\u7df4\u7fd2\u554f\u984c1.24\n\u30d5\u30a7\u30eb\u30de\u30fc\u306e\u5c0f\u5b9a\u7406\u3092\u4f7f\u3063\u3066\u7d20\u6570\u3092\u6c42\u3081\u3066\u307f\u308b\u3002\n(use srfi-27) ;; randam-integer\u304c\u5165\u3063\u3066\u308bmodule\n(load \"./1.22.scm\")\n\n;;\u3070\u3089\u3064\u304f\u306e\u30673\u56de\u305a\u3064\u5b9f\u884c\n(search-for-primes 1000 1020) ; 6, 8, 6\n(search-for-primes 10000 10040) ; 15, 26, 30\n(search-for-primes 100000 100043) ; 47, 65, 54\n(search-for-primes 1000032 1000033) ; 395, 185, 268\n(define (expmod base exp m)\n  (cond ((= exp 0) 1)\n    ((even? exp) (remainder (square (expmod base (/ exp 2) m)) m))\n    (else (remainder (* base (expmod base (- exp 1) m)) m))))\n\n(define (fermat-test n)\n  (define (try-it a) (= (expmod a n n) a))\n  (try-it (+ 1 (random-integer (- n 1)))))\n\n(define (fast-prime? n times)\n  (cond ((= times 0) #t)\n    ((fermat-test n) (fast-prime? n (- times 1))) (else #f)))\n\n(define fermet-time 3)\n(define (start-prime-test n start-time)\n  (if (fast-prime? n fermet-time)\n      (report-prime (- (runtime) start-time))))\n\n(search-for-primes 1000 1020) ; 10, 18, 29 (\u3075\u3048\u305f\uff01)\n(search-for-primes 10000 10040) ; 23, 20, 40\n(search-for-primes 100000 100043) ; 29, 27, 24\n\n(define fermet-time 10)\n(search-for-primes 1000 1020) ; 21, 15, 37\n(search-for-primes 10000 10040) ; 19, 22, 21\n(search-for-primes 100000 100043) ; 28, 29, 19\n;; \u3042\u3093\u307e\u308a\u5897\u3048\u306a\u3044\n(search-for-primes 1000032 1000033) ; 74, 52, 37\n;; \u5143\u306eprime?\u3088\u308a\u306f\u5927\u304d\u304f\u3057\u305f\u6642\u306b\u306f\u3084\u3044\n\nfermat\u30c6\u30b9\u30c8\u306fO(log(n))\u3067\u5897\u52a0\u3059\u308b\u306e\u3067\n>>> math.log(10000, 2)\n13.28771237954945\n>>> math.log(1000000, 2)\n19.931568569324174\n\n1.5\u500d\u304f\u3089\u3044\u304b\u304b\u308b\u306f\u305a\u3002\n\u5b9f\u969b\u306f\u4ee5\u4e0b\u306a\u306e\u3067\u3001\u59a5\u5f53\u306a\u7d50\u679c\uff1f\n1000\u306e\u3068\u304d(21, 15, 37) -> 1000000\u306e\u3068\u304d(74, 52, 37)\n\u3082\u3063\u3068\u5927\u304d\u3044\u5024\u3092\u307f\u3066\u307f\u308b\n(define fermet-time 10)\n(search-for-primes 10000 10040) ; 19, 22, 21 \u203blog(10000) = 13.287...\n\n(search-for-primes 1000000000 1000000033) ; 162, 111, 119 \u203blog(1000000000) = 26.57..\n;;10000\u306e2\u500d\u4ee5\u4e0a\u306f\u3042\u308b\n\nlog(n)\u306e\u5024\u306f2\u500d\u306a\u306e\u306b\u3001\u5b9f\u884c\u6642\u9593\u306f5\u500d\u304f\u3089\u3044\u6709\u308b\u306e\u304c\u6c17\u306b\u306a\u308b\u30fb\u30fb\u30fb\u3002\n\u539f\u56e0\u306f\u307e\u3060\u4e0d\u660e\u3002\n\n [#ladiescpp](http://ladiespp.connpass.com/) \u306e\u4e3b\u50ac\u3057\u3066\u308b [\u30aa\u30f3\u30e9\u30a4\u30f3SICP\u8aad\u66f8\u5973\u5b50\u4f1a #4 (1.2.4~1.2.6) - connpass](http://ladiespp.connpass.com/event/27322/)\u306e\u307e\u3068\u3081\u3067\u3059\u301c\u3002\n\n## \u6307\u6570\u8a08\u7b97\uff08\u524d\u56de\u7d9a\u304d\uff09\n### \u7df4\u7fd2\u554f\u984c1.19\n\nfib(n+1)\u304b\u3089fib(n)\u304c\u308f\u304b\u308b\u306a\u3089\u3001\nfib(n+2)\u3082fib(n)\u304b\u3089\u6c42\u3081\u3089\u308c\u308b\u306f\u305a\uff01 \u307f\u305f\u3044\u306a\u554f\u984c\u3002\n\n```math\n\\begin{align}\na_{n+1} &= b_nq + a_nq + a_np \\\\\nb_{n+1} &= b_np + a_nq\n\\end{align}\n```\n\u3068\u304a\u304f\u3002\n\n```math\n\\begin{align}\na_{n+2} &= (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\nb_{n+2} &= (b_np + a_nq)p + (b_nq + a_nq + a_np)q\n\\end{align}\n```\n\u306a\u306e\u3067\u3001\u5c55\u958b\u3057\u3066\u3044\u304f\u3068\n\n```math\n\\begin{align}\n\\qquad &a_{n+2} \\\\\n&\\quad = (b_np + a_nq)q + (b_nq + a_nq + a_np)q + (b_nq + a_nq + a_np)p \\\\\n&\\quad = a_n(2pq + q^2) + b_n(2pq + q^2) + a_n(p^2 + q^2)\\\\\n\\\\\n\\qquad &b_{n+2}\\\\\n&\\quad = (b_np + a_nq)p + (b_nq + a_nq + a_np)q \\\\\n&\\quad = a_n(2pq + q^2) + b_n(p^2 + q^2)\n\\end{align}\n```\n\n\u6700\u521d\u306e\u5f0f\u3068\u898b\u6bd4\u3079\u3066\n\n```math\n\\begin{align}\np' &= p^2 + q^2 \\\\\nq' &= 2pq + q^2\n\\end{align}\n```\n\n\u5143\u306e\u95a2\u6570\u306b\u3053\u308c\u3092\u4ee3\u5165\n\n```lisp\n(define (fib n) (fib-iter 1 0 0 1 n))\n(define (fib-iter a b p q count)\n  (cond ((= count 0) b)\n\t((even? count)\n\t (fib-iter a\n\t\t   b\n\t\t   (+ (* p p) (* q q))\n\t\t   (+ (* 2 p q) (* q q))\n\t\t   (/ count 2)))\n\t(else (fib-iter\n\t       (+ (* b q) (* a q) (* a p))\n\t       (+ (* b p) (* a q))\n\t       p\n\t       q\n\t       (- count 1)))))\n\n(fib 10) ; 55 \u3042\u3063\u3066\u308b\uff01\n```\n\n\n## \u6700\u5927\u516c\u7d04\u6570\n### \u7df4\u7fd2\u554f\u984c1.20\n\n\n\u4ee5\u4e0b@hio-harp \u3055\u3093\u306e\u89e3\u7b54\u5f15\u7528 [\u5f15\u7528\u5143\u306f\u3053\u3061\u3089](http://qiita.com/hio-harp/items/9d22d6a184abae152be9#ex-120)\n\n\u6b63\u898f\u9806\u5e8f\u8a55\u4fa1\u898f\u5247\u306e\u5834\u5408\n\n```lisp\n; [\u5165\u529b]\n(gcd 206 40)\n\n; [step 1]\n; a1=206, b1=40. <env:none>\n(if (= b1 0)\n    a1\n    (gcd b1 (remainder a1 b1)))\n; <eval b1> <env:a1=206, b1=40>\nb1\n40\n; pred ==> false.\nelse-clause\n(gcd b1 (remainder a1 b1))\n\n; [step 2]\n; a2=b1, b2=(remainder a1 b1) <env:a1=206, b1=40>\n(if (= b2 0)\n    a2\n    (gcd b2 (remainder a2 b2)))\n; <eval b2> <env:a1=206, b1=40; a2=b1, b2=(remainder a1 b1)>\nb2\n(remainder a1 b1)\n(remainder 206 40)\n; REMAINDER 1 \u56de\u76ee.\n6 ; <env:a1=206, b1=40, a2=b1, b2=6>\n; pred = false\nelse-clause\n(gcd b2 (remainder a2 b2))\n\n; [step 3]\n; a3=b2, b3=(remainder a2 b2) <env:a1=206, b1=40, a2=b1, b2=6>\n(if (= b3 0)\n    a3\n    (gcd b3 (remainder a3 b3)))\n; <eval b3> <env:a1=206, b1=40; a2=b1, b2=6; a3=b2, b3=(remainder a2 b2)>\nb3\n(remainder a2 b2)\n(remainder b1 6)\n(remainder 40 6) ; <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=(remainder a2 b2)>\n; REMAINDER 2 \u56de\u76ee.\n4 ; <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4>\n; pred = false\nelse-clause\n(gcd b3 (remainder a3 b3))\n\n; [step 4]\n; a4=b3, b4=(remainder a3 b3) <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4>\n(if (= b4 0)\n    a4\n    (gcd b4 (remainder a4 b4)))\n; <eval b4> <env:a1=206, b1=40; a2=40, b2=6; a3=b2, b3=4; a4=b3, b4=(remainder a3 b3)>\nb4\n(remainder a3 b3)\n(remainder b2 4)\n(remainder 6 4) ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=(remainder a3 b3)>\n; REMAINDER 3 \u56de\u76ee.\n2 ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=2>\n; pred = false\nelse-clause\n(gcd b4 (remainder a4 b4))\n\n; [step 5]\n; a5=b4, b5=(remainder a4 b4) <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=2>\n(if (= b5 0)\n    a5\n    (gcd b5 (remainder a5 b5)))\n; <eval b5> <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=b3, b4=b3; a5=b4, b5=(remainder a4 b4)>\nb5\n(remainder a4 b4)\n(remainder b3 2)\n(remainder 4 2) ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=(remainder a4 b4)>\n; REMAINDER 4 \u56de\u76ee.\n0 ; <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=0>\n; pred = true\nthen-clause\na5\n; <eval a5> <env:a1=206, b1=40; a2=40, b2=6; a3=6, b3=4; a4=2, b4=2; a5=b4, b5=0>\na5\nb4\n2 ; answer.\n\n; remainder \u6f14\u7b97\u306f\u5408\u8a084\u56de.\n```\n\n\u9069\u7528\u9806\u5e8f\u8a55\u4fa1\u898f\u5247\u306e\u5834\u5408\n\n```lisp\n; [\u5165\u529b]\n(gcd 206 40)\n\n; [step 1]\n; a1=206, b1=40. <env:none>\n(if (= b1 0)\n    a1\n    (gcd b1 (remainder a1 b1)))\n; <eval b1> <env:a1=206, b1=40>\nb1\n40\n; pred ==> false.\nelse-clause\n(gcd b1 (remainder a1 b1))\n(gcd 40 (remainder 206 40))\n; REMAINDER 1 \u56de\u76ee.\n(gcd 40 6)\n\n; [step 2]\n; a2=40, b2=6\n(if (= b2 0)\n    a2\n    (gcd b2 (remainder a2 b2)))\n; <eval b2> <env:a2=40, b2=6>\nb2\n6\n; pred ==> false.\nelse-clause\n(gcd b2 (remainder a2 b2))\n(gcd 6 (remainder  40 6))\n; REMAINDER 2 \u56de\u76ee.\n(gcd 6 4)\n\n; [step 3]\n; a3=6 b3=4\n(if (= b3 0)\n    a3\n    (gcd b3 (remainder a3 b3)))\n; <eval b3> <env:a3=6, b3=4>\nb3\n4\n; pred ==> false.\nelse-clause\n(gcd b3 (remainder a3 b3))\n(gcd 4 (remainder  6 4))\n; REMAINDER 3 \u56de\u76ee.\n(gcd 4 2)\n\n; [step 4]\n; a4=4 b4=2\n(if (= b4 0)\n    a4\n    (gcd b4 (remainder a4 b4)))\n; <eval b4> <env:a4=4, b4=2>\nb4\n2\n; pred ==> false.\nelse-clause\n(gcd b4 (remainder a4 b4))\n(gcd 2 (remainder  4 2))\n; REMAINDER 4 \u56de\u76ee.\n(gcd 2 0)\n\n; [step 5]\n; a5=2 b5=0\n(if (= b5 0)\n    a5\n    (gcd b5 (remainder a5 b5)))\n; <eval b5> <env:a5=2, b5=0>\nb5\n0\n; pred ==> true\nthen-clause\na5\n; <eval a5> <env:a5=2, b5=0>\na5\n2 ; answer.\n\n; \u3053\u3061\u3089\u306e\u5834\u5408\u3067\u3082 remainder \u6f14\u7b97\u306f\u5408\u8a084\u56de.\n```\n\n## \u7d20\u6570\u5224\u5b9a\n\n```\n\u30d5\u30a7\u30eb\u30de\u30fc\u306e\u5c0f\u5b9a\u7406 \n\nn\u304c\u7d20\u6570, n < a (a\u306f\u6574\u6570)\na^n mod n = a mod n\n\n\u3092a\u304c\u7d20\u6570\u306e\u6642\u306b\u6e80\u305f\u3059\na\u304c\u7d20\u6570\u3058\u3083\u306a\u304f\u3066\u3082\u305f\u307e\u306b\u6e80\u305f\u3059\n```\n1\u56de\u30d5\u30a7\u30eb\u30de\u30fc\u30c6\u30b9\u30c8(times=1)\u3059\u308b\u306e\u306e\u8a08\u7b97\u6642\u9593\u306f ```O(log(n))```\n\n### \u7df4\u7fd2\u554f\u984c1.21\n> smallest-divisor\u624b\u7d9a\u304d\u3092\u4f7f\u3063\u3066\u6b21\u306e\u6570\u5024\u306e\u6700\u5c0f\u306e\u7d04\u6570\u3092\u6c42\u3081\u3088\u3002199, 1999, 19999.\n\n```lisp\n;;smallest-divisor.scm\n(define (smallest-divisor n)\n  (find-divisor n 2))\n\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n\t((divides? test-divisor n) test-divisor)\n\t(else (find-divisor  n (+ test-divisor 1)))))\n\n(define (divides? a b) (= (remainder b a) 0))\n\n(define (prime? n)\n  (= n (smallest-divisor n)))\n```\n\n```lisp\n(load \"./smallest-divisor.scm\")\n\n(smallest-divisor 199) ;199\n(smallest-divisor 1999) ;1999\n(smallest-divisor 19999) ;7\n```\n\n### \u7df4\u7fd2\u554f\u984c1.22\n>n~m\u307e\u3067\u306e\u6570\u5b57\u304c\u7d20\u6570\u304b\u3069\u3046\u304b\u307f\u3066\u3044\u3063\u3066\u3001\n\u7d20\u6570\u3060\u3063\u305f\u3089\u305d\u308c\u3092\u5224\u5b9a\u3059\u308b\u306e\u306b\u4f55\u30de\u30a4\u30af\u30ed\u79d2\u304b\u304b\u3063\u305f\u304b\u3092\u8abf\u3079\u308b\u95a2\u6570\nfermat\u30c6\u30b9\u30c8\u3092\u4f7f\u308f\u305a\u306b\u3001\u666e\u901a\u306bn\u306b\u5bfe\u3057\u3066\u221an\u307e\u3067\u3067\u5272\u308c\u308b\u304b\u3067\u7d20\u6570\u5224\u5b9a\u3092\u3059\u308b\u3002\n\n```lisp\n;; 1.22.scm\n(load \"./smallest-divisor.scm\")\n\n(define (timed-prime-test n)\n  (newline)\n  (display n)\n  (start-prime-test n (runtime)))\n\n(define (start-prime-test n start-time)\n  (if (prime? n)\n      (report-prime (- (runtime) start-time))))\n\n(define (report-prime elapsed-time)\n  (display \" *** \")\n  (display elapsed-time))\n\n(define (runtime)\n  (use srfi-11)\n  (let-values (((a b) (sys-gettimeofday)))\n    (+ (* a 1000000) b))) ;; gosh \u306bruntime\u5b9f\u88c5\u304c\u306a\u3044\n\n(define (search-for-primes n end)\n  (cond ((even? n) (search-for-primes (+ n 1) end))\n\t((> n end) (display \"end\"))\n\t(else (timed-prime-test n) (search-for-primes (+ n 2) end))))\n\n(search-for-primes 1000 1050) ; 1009 1013 1019 \uff5c6\n(search-for-primes 10000 10100) ; 10007 10009 10037 \uff5c17\n(search-for-primes 100000 100100) ; 100003 100019 100043\uff5c 55 \n(search-for-primes 1000000 1000030) ; 395\n(search-for-primes 10000000 10000030) ; 797\n; \u221a10000 \t\t\t100: 17\n; \u221a1000000\t\t\t1000: 395\n```\n\nO(\u221an)\u306b\u5bfe\u3057\u3066 \u59a5\u5f53\u306a\u306e\u304b\u3069\u3046\u304b\u306f\u826f\u304f\u308f\u304b\u3089\u306a\u3044\n100:17 \u2252 1000: 395 \u3068\u3044\u3048\u308b\u304b\uff1f\n\n\u203b\u4f55\u5ea6\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3068\u3001\u5b9f\u884c\u6642\u95932\u500d\u4f4d\u8a08\u7b97\u6642\u9593\u306b\u3070\u3089\u3064\u304d\u304c\u3042\u308b\u306e\u3067\u602a\u3057\u3044\u3002\n\n### \u7df4\u7fd2\u554f\u984c1.23\n>1.22\u3067\u306f\u3001n\u306b\u5bfe\u3057\u30661 ~ \u221an\u307e\u3067\u3067\u5272\u308c\u308b\u304b\u8abf\u3079\u3066\u3044\u305f\u304c\u3001\n2\u4ee5\u4e0a\u306e\u5076\u6570\u3067\u5272\u3063\u3066\u3082\u4ed5\u65b9\u304c\u306a\u3044\u3002\u305d\u3053\u30672\u4ee5\u4e0a\u306e\u5076\u6570\u306f\u98db\u3070\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\u305d\u3046\u3059\u308b\u30682\u500d\u65e9\u304f\u306a\u308b\u306f\u305a\n\n\n\u305f\u3057\u304b\u306b2\u500d\u304f\u3089\u3044\u65e9\u304f\u306a\u3063\u305f\n\n```lisp\n(load \"./1.22.scm\")\n\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n\t((divides? test-divisor n) test-divisor)\n\t(else (find-divisor  n (+ test-divisor 1)))))\n\n(search-for-primes 1000 1020) ; 1009 1013 1019 \uff5c9\u30de\u30a4\u30af\u30ed\u79d2\n(search-for-primes 10000 10138) ; 10007 10009 10037 \uff5c26\n(search-for-primes 100000 100044) ; 100003 100019 100043 \uff5c65 \n\n(define (next x) (if (= x 2) 3 (+ x 2)))\n(define (find-divisor n test-divisor)\n  (cond ((> (square test-divisor) n) n)\n\t((divides? test-divisor n) test-divisor)\n\t(else (find-divisor  n (next test-divisor)))))\n\n\n(search-for-primes 1000 1020) ; 1009 1013 1019 \uff5c4\n(search-for-primes 10000 10138) ; 10007 10009 10037 \uff5c11\n(search-for-primes 100000 100044) ; 100003 100019 100043 \uff5c36 \n```\n\n### \u7df4\u7fd2\u554f\u984c1.24\n\n\u30d5\u30a7\u30eb\u30de\u30fc\u306e\u5c0f\u5b9a\u7406\u3092\u4f7f\u3063\u3066\u7d20\u6570\u3092\u6c42\u3081\u3066\u307f\u308b\u3002\n\n```lisp\n(use srfi-27) ;; randam-integer\u304c\u5165\u3063\u3066\u308bmodule\n(load \"./1.22.scm\")\n\n;;\u3070\u3089\u3064\u304f\u306e\u30673\u56de\u305a\u3064\u5b9f\u884c\n(search-for-primes 1000 1020) ; 6, 8, 6\n(search-for-primes 10000 10040) ; 15, 26, 30\n(search-for-primes 100000 100043) ; 47, 65, 54\n(search-for-primes 1000032 1000033) ; 395, 185, 268\n(define (expmod base exp m)\n  (cond ((= exp 0) 1)\n\t((even? exp) (remainder (square (expmod base (/ exp 2) m)) m))\n\t(else (remainder (* base (expmod base (- exp 1) m)) m))))\n\n(define (fermat-test n)\n  (define (try-it a) (= (expmod a n n) a))\n  (try-it (+ 1 (random-integer (- n 1)))))\n\n(define (fast-prime? n times)\n  (cond ((= times 0) #t)\n\t((fermat-test n) (fast-prime? n (- times 1))) (else #f)))\n\n(define fermet-time 3)\n(define (start-prime-test n start-time)\n  (if (fast-prime? n fermet-time)\n      (report-prime (- (runtime) start-time))))\n\n(search-for-primes 1000 1020) ; 10, 18, 29 (\u3075\u3048\u305f\uff01)\n(search-for-primes 10000 10040) ; 23, 20, 40\n(search-for-primes 100000 100043) ; 29, 27, 24\n\n(define fermet-time 10)\n(search-for-primes 1000 1020) ; 21, 15, 37\n(search-for-primes 10000 10040) ; 19, 22, 21\n(search-for-primes 100000 100043) ; 28, 29, 19\n;; \u3042\u3093\u307e\u308a\u5897\u3048\u306a\u3044\n(search-for-primes 1000032 1000033) ; 74, 52, 37\n;; \u5143\u306eprime?\u3088\u308a\u306f\u5927\u304d\u304f\u3057\u305f\u6642\u306b\u306f\u3084\u3044\n```\n\nfermat\u30c6\u30b9\u30c8\u306fO(log(n))\u3067\u5897\u52a0\u3059\u308b\u306e\u3067\n\n```\n>>> math.log(10000, 2)\n13.28771237954945\n>>> math.log(1000000, 2)\n19.931568569324174\n```\n1.5\u500d\u304f\u3089\u3044\u304b\u304b\u308b\u306f\u305a\u3002\n\u5b9f\u969b\u306f\u4ee5\u4e0b\u306a\u306e\u3067\u3001\u59a5\u5f53\u306a\u7d50\u679c\uff1f\n1000\u306e\u3068\u304d(21, 15, 37) -> 1000000\u306e\u3068\u304d(74, 52, 37)\n\n\n\u3082\u3063\u3068\u5927\u304d\u3044\u5024\u3092\u307f\u3066\u307f\u308b\n\n```lisp\n(define fermet-time 10)\n(search-for-primes 10000 10040) ; 19, 22, 21 \u203blog(10000) = 13.287...\n\n(search-for-primes 1000000000 1000000033) ; 162, 111, 119 \u203blog(1000000000) = 26.57..\n;;10000\u306e2\u500d\u4ee5\u4e0a\u306f\u3042\u308b\n```\n\nlog(n)\u306e\u5024\u306f2\u500d\u306a\u306e\u306b\u3001\u5b9f\u884c\u6642\u9593\u306f5\u500d\u304f\u3089\u3044\u6709\u308b\u306e\u304c\u6c17\u306b\u306a\u308b\u30fb\u30fb\u30fb\u3002\n\u539f\u56e0\u306f\u307e\u3060\u4e0d\u660e\u3002\n", "tags": ["SICP", "Scheme"]}