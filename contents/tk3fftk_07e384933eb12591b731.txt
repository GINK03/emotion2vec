{"tags": ["Linux", "CentOS", "VirtualBox", "openstack"], "context": " More than 1 year has passed since last update.\u74b0\u5883\u7de8\nIdentity\u7de8\nImage\u7de8\nCompute\u7de8\n\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u5f93\u3063\u3066\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u9014\u4e2d\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u30bb\u30eb\u30d5\u30b5\u30fc\u30d3\u30b9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u3069\u3061\u3089\u3092\u69cb\u7bc9\u3059\u308b\u304b\u306e\u5206\u5c90\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5358\u7d14\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u65b9\u3092\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u30bb\u30eb\u30d5\u30b5\u30fc\u30d3\u30b9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fOpenStack\u5185\u90e8\u3067\u3055\u3089\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7a7a\u9593\u3092\u5207\u308a\u5206\u3051\u3089\u308c\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002AWS\u306eVPC\u7684\u306a\uff1f\n\nOpenStack Networking\n\nOpenStack Networking (neutron) \u3092\u4f7f\u3046\u3068\u3001\u4ed6\u306e OpenStack \u30b5\u30fc\u30d3\u30b9\u306b\u3088\u308a\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30c7\u30d0\u30a4\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u63a5\u7d9a\u3067\u304d\u307e\u3059\u3002\u69d8\u3005\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u88c5\u7f6e\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306b\u5bfe\u5fdc\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001 OpenStack \u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3068\u74b0\u5883\u306b\u67d4\u8edf\u6027\u3092\u3082\u305f\u3089\u3057\u307e\u3059\u3002\nOpenStack Networking \u306f\u3001\u304a\u3082\u306b OpenStack Compute \u3092\u9023\u643a\u3057\u3066\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u63a5\u7d9a\u6027\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\n\nneutron\u306e\u6982\u5ff5: http://docs.openstack.org/liberty/ja/install-guide-rdo/neutron-concepts.html \n\u308f\u304b\u308a\u3084\u3059\u3044\u53c2\u8003\u8a18\u4e8b: http://labs.gree.jp/blog/2015/02/13598/ \n(\u30e1\u30e2)\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af: \u30c6\u30ca\u30f3\u30c8(\u30e6\u30fc\u30b6\u306e\u30b0\u30eb\u30fc\u30d7, \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u3082)\u306e\u901a\u4fe1\u3092\u5206\u96e2\u3059\u308b\u306e VLAN \u3082\u30c8\u30f3\u30cd\u30eb\u3082\u4f7f\u7528\u3057\u306a\u3044\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u65b9\u5f0f\u3002\u5404\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u3001\u4e00\u822c\u7684\u306b\u30d6\u30ea\u30c3\u30b8\u30de\u30c3\u30d4\u30f3\u30b0\u306b\u3088\u308a\u5b9a\u7fa9\u3055\u308c\u308b\u5c02\u7528\u306e\u7269\u7406\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5fc5\u8981\u3068\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u8907\u6570\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u3002\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a@\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30ce\u30fc\u30c9\n\nDB\u4f5c\u6210 mysql\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3002 NEUTRON_DBPASS\u306b\u306froot++\n\n  - `create database neutron;`\n  - `GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'NEUTRON_DBPASS';`\n  - `grant all privileges on neutron.* TO 'neutron'@'%' identified by 'NEUTRON_DBPASS';`\n\n\nneutron\u30e6\u30fc\u30b6\u4f5c\u6210\n\n\n\n# openstack user create --domain default --password-prompt neutron\n\nNEUTRON_PASS\u3068\u3057\u3066root++\u3092\u5165\u529b \n\n\n\n\nadmin\u30ed\u30fc\u30eb\u306bneutron\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\n\n\n\n# openstack role add --project service --user neutron admin\n\n\n\nneutron\u30b5\u30fc\u30d3\u30b9\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u4f5c\u6210\n\n\n\n# openstack service create --name neutron --description \"OpenStack Networking\" network - neutron\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4f5c\u6210\n\n# openstack endpoint create --region RegionOne network public http://controller:9696 \n# openstack endpoint create --region RegionOne network internal http://controller:9696\n\n# openstack endpoint create --region RegionOne network admin http://controller:9696 \n\n\n\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n# yum install openstack-neutron openstack-neutron-ml2   openstack-neutron-linuxbridge python-neutronclient ebtables ipset\n\n\n# vim /etc/neutron/neutron.conf \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n\n\n\nneutron.conf\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u30a2\u30af\u30bb\u30b9\u65b9\u6cd5\u3092\u5b9a\u7fa9\n[database]\nconnection = mysql://neutron:NEUTRON_DBPASS@controller/neutron # root++\n\n# ML2\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6709\u52b9\u306b\u3057\u3066\uff0c\u8ffd\u52a0\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u7121\u52b9\u306b\u3059\u308b\n[DEFAULT]\ncore_plugin = ml2\nservice_plugins =\n\n# Rabbit\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc\u306e\u8a2d\u5b9a\n[DEFAULT]\nrpc_backend = rabbit\n\n[oslo_messaging_rabbit]\nrabbit_host = controller\nrabbit_userid = openstack\nrabbit_password = RABBIT_PASS # root++\n\n# identify\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u63a5\u7d9a\n[DEFAULT]\nauth_strategy = keystone\n\n[keystone_authtoken]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n# \u4ed6\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n# Networking \u304c Compute \u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30dd\u30ed\u30b8\u30fc\u306e\u5909\u66f4\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u8a2d\u5b9a\n[DEFAULT]\nnotify_nova_on_port_status_changes = True\nnotify_nova_on_port_data_changes = True\nnova_url = http://controller:8774/v2\n\n[nova]\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = nova\npassword = NOVA_PASS # root++\n\n# \u30ed\u30c3\u30af\u30d1\u30b9\u306e\u8a2d\u5b9a\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\n\n\n\nML2\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\nML2 \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001Linux \u30d6\u30ea\u30c3\u30b8\u6a5f\u69cb\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306e L2 (\u30d6\u30ea\u30c3\u30b8\u3068\u30b9\u30a4\u30c3\u30c1) \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30d5\u30e9\u3092\u69cb\u7bc9\u3057\u307e\u3059\n\n\n\n# vi /etc/neutron/plugins/ml2/ml2_conf.ini \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n\nml2_conf.ini\n[ml2] \n# \u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff0cVLAN\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u6709\u52b9\u306b\u3059\u308b\ntype_drivers = flat,vlan\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8(\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8)\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\u306b\u3059\u308b\ntenant_network_types =\n\n# Linux\u30d6\u30ea\u30c3\u30b8\u6a5f\u69cb\u3092\u6709\u52b9\u306b\u3059\u308b\nmechanism_drivers = linuxbridge\n\n# \u30dd\u30fc\u30c8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u62e1\u5f35\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6709\u52b9\u306b\u3059\u308b\nextension_drivers = port_security\n\n# \u30d1\u30d6\u30ea\u30c3\u30af\u30d5\u30e9\u30c3\u30c8\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a2d\u5b9a\n[ml2_type_flat]\nflat_networks = public\n\n# ipset \u3092\u6709\u52b9\u306b\u3057\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u306e\u52b9\u7387\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002\n[ml2_type_flat]\nflat_networks = public\n\n\n\nLinux\u30d6\u30ea\u30c3\u30b8\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5411\u3051\u306e VXLAN \u30c8\u30f3\u30cd\u30eb\u306a\u3069\u306e\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306e L2 (\u30d6\u30ea\u30c3\u30b8\u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1) \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30d5\u30e9\u3092\u69cb\u7bc9\u3057\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\n\n\n\n# vi /etc/neutron/plugins/ml2/linuxbridge_agent.ini \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n\nlinuxbridge_agent.ini\n# \u4eee\u60f3\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7269\u7406\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u7d50\u3073\u3064\u3051\u308b\n[linux_bridge]\n# public:enp0s3\u3068\u3057\u305f\nphysical_interface_mappings = public:PUBLIC_INTERFACE_NAME\n\n# VXLAN\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\n[vxlan]\nenable_vxlan = False\n\n# ARP\u30b9\u30d7\u30fc\u30d5\u30a3\u30f3\u30b0\u306e\u4fdd\u8b77\u3092\u6709\u52b9\n[agent]\nprevent_arp_spoofing = True\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u6709\u52b9\u306b\u3057\u3001 Linux \u30d6\u30ea\u30c3\u30b8 iptables \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\n[securitygroup]\nenable_security_group = True\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\n\n\n\nDHCP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n\n# vi /etc/neutron/dhcp_agent.ini \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n\ndhcp_agent.ini\n# Linux \u30d6\u30ea\u30c3\u30b8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30c9\u30e9\u30a4\u30d0\u30fc\u3001Dnsmasq DHCP \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\u3057\u3066\u3001 isolated metadata \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3042\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u3067\u30e1\u30bf\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n[DEFAULT]\ninterface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver\ndhcp_driver = neutron.agent.linux.dhcp.Dnsmasq\nenable_isolated_metadata = True\n\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8 \u306f\u3001\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63d0\u4f9b\u3059\u308b\n\n\n# vi /etc/neutron/metadata_agent.ini\n\n\nmetadata_agent.ini\n# \u30a2\u30af\u30bb\u30b9\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\n[DEFAULT]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_region = RegionOne\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n\n# \u30e1\u30bf\u30c7\u30fc\u30bf\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\n[DEFAULT]\nnova_metadata_ip = controller\n\n# \u30e1\u30bf\u30c7\u30fc\u30bf\u30d7\u30ed\u30ad\u30b7\u30fc\u306e\u5171\u6709\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[DEFAULT]\nmetadata_proxy_shared_secret = METADATA_SECRET # meta++\n\n\n\nNetworking\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eCompute\u306e\u8a2d\u5b9a\n\n# vi /etc/nova/nova.conf\n\n\nnova.conf\n# \u30a2\u30af\u30bb\u30b9\u7528\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a2d\u5b9a\u3057\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u30d7\u30ed\u30ad\u30b7\u30fc\u3092\u6709\u52b9\u306b\u3057\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u8a2d\u5b9a\n[neutron]\nurl = http://controller:9696\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n\nservice_metadata_proxy = True\nmetadata_proxy_shared_secret = METADATA_SECRET # meta++\n\n\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\n\n# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini  /etc/neutron/plugin.ini\n\nll /etc/neutron/ \u3057\u3066 plugin.ini -> /etc/neutron/plugins/ml2/ml2_conf.ini \u306a\u3063\u3066\u3044\u308c\u3070\u304ak\n\n\nDB\u5c55\u958b\n\n\nsu -s /bin/sh -c \"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head\" neutron\n\n Failed to parse /etc/neutron/neutron.conf: at /etc/neutron/neutron.conf:3, Unexpected continuation line: ' verbose = True'\n\n\n\u3068\u3067\u305f\u306e\u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n\n\nFailed to parse /etc/neutron/neutron.conf: at /etc/neutron/neutron.conf:60, Unexpected continuation line: ' core_plugin = ml2' \n\n\n\u982d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u5165\u3063\u3066\u3044\u308b\u3068\u523a\u3055\u308b\u3063\u307d\u3044 \u523a\u3055\u3089\u306a\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u3042\u308b\u304c\uff0c\u524a\u9664\u3057\u3066\u304a\u3044\u305f\u65b9\u304c\u8eab\u306e\u305f\u3081\u304b\n\u591a\u5206\u2191\u306everbose\u3082\u540c\u3058\u539f\u56e0\n\u30d1\u30e9\u30e1\u30fc\u30bf\u524d\u306e\u30b9\u30da\u30fc\u30b9\u3092\u5168\u3066\u6d88\u3057\u305f\u5f8c\u518d\u5ea6\u5b9f\u884c -> \u3044\u3051\u305f\n\n\n\n\n\nCompute API \u30b5\u30fc\u30d3\u30b9\u3092\u518d\u5b9f\u884c\n\n# systemctl restart openstack-nova-api\n\n\n\n\u8d77\u52d5\u8a2d\u5b9a\n\n# systemctl enable neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent\n# systemctl start neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a@\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\n\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n# yum install openstack-neutron openstack-neutron-linuxbridge ebtables ipset\n\n\n# vi /etc/neutron/neutron.conf\n\n\nneutron.cong\n# Rabbit\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc\u306e\u8a2d\u5b9a\n[DEFAULT]\nrpc_backend = rabbit\n\n[oslo_messaging_rabbit]\nrabbit_host = controller\nrabbit_userid = openstack\nrabbit_password = RABBIT_PASS # root++\n\n# identify\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u63a5\u7d9a\n[DEFAULT]\nauth_strategy = keystone\n\n[keystone_authtoken]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n# \u4ed6\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n# \u30ed\u30c3\u30af\u30d1\u30b9\u306e\u8a2d\u5b9a\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\n\n\n\n\nLinux\u30d6\u30ea\u30c3\u30b8\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n\n# vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini \u3067\u4ee5\u4e0b\n\n\nlinuxbridge_agent.ini\n# \u4eee\u60f3\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7269\u7406\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u7d50\u3073\u3064\u3051\u308b\n[linux_bridge]\n# public:enp0s3\u3068\u3057\u305f\nphysical_interface_mappings = public:PUBLIC_INTERFACE_NAME\n\n# VXLAN\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\n[vxlan]\nenable_vxlan = False\n\n# ARP\u30b9\u30d7\u30fc\u30d5\u30a3\u30f3\u30b0\u306e\u4fdd\u8b77\u3092\u6709\u52b9\n[agent]\nprevent_arp_spoofing = True\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u6709\u52b9\u306b\u3057\u3001 Linux \u30d6\u30ea\u30c3\u30b8 iptables \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\n[securitygroup]\nenable_security_group = True\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\n\n\n\nNetworking\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eCompute\u306e\u8a2d\u5b9a\n\n# vim /etc/nova/nova.conf\n\n\nnova.conf\n# neutron\u30a2\u30af\u30bb\u30b9\u7528\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a2d\u5b9a\n[neutron]\nurl = http://controller:9696\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n\n\n\n\u8d77\u52d5\u8a2d\u5b9a\n\n\n# systemctl enable neutron-linuxbridge-agent\n# systemctl start neutron-linuxbridge-agent\n\n\n\n\n\u78ba\u8a8d\n\n\u30ed\u30fc\u30c9\u6e08\u62e1\u5f35\u6a5f\u80fd\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\uff0cneutron-server\u30d7\u30ed\u30bb\u30b9\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\n\nneutron ext-list\n\n\u30aa\u30d7\u30b7\u30e7\u30f31\u3092\u9078\u629e\u3057\u305f\u306e\u3067\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306e\u4f8b\u3088\u308a\u5c11\u306a\u3044\n\n\n\n\nneutron\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\uff0c\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u4e00\u89a7\u3092\u8868\u793a\n\n\n\nneutron agent-list\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30ce\u30fc\u30c9\u306b3\u3064\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\uff0c\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306b1\u3064\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\n\n\n\u3053\u3053\u307e\u3067\u7d42\u308f\u308c\u3070\uff0c\u57fa\u672c\u7684\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304cOpenStack\u74b0\u5883\u306b\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n[\u74b0\u5883\u7de8](http://qiita.com/tk3fftk/items/76d696a874d829ea9fe4)\n[Identity\u7de8](http://qiita.com/tk3fftk/items/546ab241ac7b89a1c3c2)\n[Image\u7de8](http://qiita.com/tk3fftk/items/7899758d14cde4a9b2db)\n[Compute\u7de8](http://qiita.com/tk3fftk/items/810e70533466c9307a93)\n\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\n[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.openstack.org/liberty/ja/install-guide-rdo/neutron.html)\u306b\u5f93\u3063\u3066\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u9014\u4e2d\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u30bb\u30eb\u30d5\u30b5\u30fc\u30d3\u30b9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u3069\u3061\u3089\u3092\u69cb\u7bc9\u3059\u308b\u304b\u306e\u5206\u5c90\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5358\u7d14\u306a\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u65b9\u3092\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u30bb\u30eb\u30d5\u30b5\u30fc\u30d3\u30b9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fOpenStack\u5185\u90e8\u3067\u3055\u3089\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7a7a\u9593\u3092\u5207\u308a\u5206\u3051\u3089\u308c\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002AWS\u306eVPC\u7684\u306a\uff1f\n\n# OpenStack Networking\n> OpenStack Networking (neutron) \u3092\u4f7f\u3046\u3068\u3001\u4ed6\u306e OpenStack \u30b5\u30fc\u30d3\u30b9\u306b\u3088\u308a\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30c7\u30d0\u30a4\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u63a5\u7d9a\u3067\u304d\u307e\u3059\u3002\u69d8\u3005\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u88c5\u7f6e\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306b\u5bfe\u5fdc\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001 OpenStack \u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3068\u74b0\u5883\u306b\u67d4\u8edf\u6027\u3092\u3082\u305f\u3089\u3057\u307e\u3059\u3002\n\n> OpenStack Networking \u306f\u3001\u304a\u3082\u306b OpenStack Compute \u3092\u9023\u643a\u3057\u3066\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u63a5\u7d9a\u6027\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\n- neutron\u306e\u6982\u5ff5: http://docs.openstack.org/liberty/ja/install-guide-rdo/neutron-concepts.html \n- \u308f\u304b\u308a\u3084\u3059\u3044\u53c2\u8003\u8a18\u4e8b: http://labs.gree.jp/blog/2015/02/13598/ \n- (\u30e1\u30e2)\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af: \u30c6\u30ca\u30f3\u30c8(\u30e6\u30fc\u30b6\u306e\u30b0\u30eb\u30fc\u30d7, \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u3082)\u306e\u901a\u4fe1\u3092\u5206\u96e2\u3059\u308b\u306e VLAN \u3082\u30c8\u30f3\u30cd\u30eb\u3082\u4f7f\u7528\u3057\u306a\u3044\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u65b9\u5f0f\u3002\u5404\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u3001\u4e00\u822c\u7684\u306b\u30d6\u30ea\u30c3\u30b8\u30de\u30c3\u30d4\u30f3\u30b0\u306b\u3088\u308a\u5b9a\u7fa9\u3055\u308c\u308b\u5c02\u7528\u306e\u7269\u7406\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5fc5\u8981\u3068\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u8907\u6570\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u3002\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a@\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30ce\u30fc\u30c9\n- DB\u4f5c\u6210 mysql\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3002 NEUTRON_DBPASS\u306b\u306froot++\n\n```mysql\n  - `create database neutron;`\n  - `GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' IDENTIFIED BY 'NEUTRON_DBPASS';`\n  - `grant all privileges on neutron.* TO 'neutron'@'%' identified by 'NEUTRON_DBPASS';`\n```\n\n- neutron\u30e6\u30fc\u30b6\u4f5c\u6210\n  - `# openstack user create --domain default --password-prompt neutron`\n      - NEUTRON_PASS\u3068\u3057\u3066root++\u3092\u5165\u529b \n- admin\u30ed\u30fc\u30eb\u306bneutron\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\n  - `# openstack role add --project service --user neutron admin`  \n- neutron\u30b5\u30fc\u30d3\u30b9\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u4f5c\u6210\n  - `# openstack service create --name neutron --description \"OpenStack Networking\" network` - neutron\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4f5c\u6210\n  - `# openstack endpoint create --region RegionOne network public http://controller:9696` \n  - `# openstack endpoint create --region RegionOne network internal http://controller:9696`\n  - `# openstack endpoint create --region RegionOne network admin http://controller:9696` \n\n### \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n  - `# yum install openstack-neutron openstack-neutron-ml2   openstack-neutron-linuxbridge python-neutronclient ebtables ipset`\n\n- `# vim /etc/neutron/neutron.conf` \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n```properties:neutron.conf\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u30a2\u30af\u30bb\u30b9\u65b9\u6cd5\u3092\u5b9a\u7fa9\n[database]\nconnection = mysql://neutron:NEUTRON_DBPASS@controller/neutron # root++\n\n# ML2\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u6709\u52b9\u306b\u3057\u3066\uff0c\u8ffd\u52a0\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u7121\u52b9\u306b\u3059\u308b\n[DEFAULT]\ncore_plugin = ml2\nservice_plugins =\n\n# Rabbit\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc\u306e\u8a2d\u5b9a\n[DEFAULT]\nrpc_backend = rabbit\n\n[oslo_messaging_rabbit]\nrabbit_host = controller\nrabbit_userid = openstack\nrabbit_password = RABBIT_PASS # root++\n\n# identify\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u63a5\u7d9a\n[DEFAULT]\nauth_strategy = keystone\n\n[keystone_authtoken]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n# \u4ed6\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n# Networking \u304c Compute \u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30dd\u30ed\u30b8\u30fc\u306e\u5909\u66f4\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u8a2d\u5b9a\n[DEFAULT]\nnotify_nova_on_port_status_changes = True\nnotify_nova_on_port_data_changes = True\nnova_url = http://controller:8774/v2\n\n[nova]\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = nova\npassword = NOVA_PASS # root++\n\n# \u30ed\u30c3\u30af\u30d1\u30b9\u306e\u8a2d\u5b9a\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\n```\n\n#### ML2\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\n\n> ML2 \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001Linux \u30d6\u30ea\u30c3\u30b8\u6a5f\u69cb\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306e L2 (\u30d6\u30ea\u30c3\u30b8\u3068\u30b9\u30a4\u30c3\u30c1) \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30d5\u30e9\u3092\u69cb\u7bc9\u3057\u307e\u3059\n\n  - `# vi /etc/neutron/plugins/ml2/ml2_conf.ini` \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n```properties:ml2_conf.ini\n[ml2] \n# \u30d5\u30e9\u30c3\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff0cVLAN\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u6709\u52b9\u306b\u3059\u308b\ntype_drivers = flat,vlan\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8(\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8)\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\u306b\u3059\u308b\ntenant_network_types =\n\n# Linux\u30d6\u30ea\u30c3\u30b8\u6a5f\u69cb\u3092\u6709\u52b9\u306b\u3059\u308b\nmechanism_drivers = linuxbridge\n\n# \u30dd\u30fc\u30c8\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u62e1\u5f35\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6709\u52b9\u306b\u3059\u308b\nextension_drivers = port_security\n\n# \u30d1\u30d6\u30ea\u30c3\u30af\u30d5\u30e9\u30c3\u30c8\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a2d\u5b9a\n[ml2_type_flat]\nflat_networks = public\n\n# ipset \u3092\u6709\u52b9\u306b\u3057\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u306e\u52b9\u7387\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002\n[ml2_type_flat]\nflat_networks = public\n```\n\n#### Linux\u30d6\u30ea\u30c3\u30b8\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n>\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5411\u3051\u306e VXLAN \u30c8\u30f3\u30cd\u30eb\u306a\u3069\u306e\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306e L2 (\u30d6\u30ea\u30c3\u30b8\u304a\u3088\u3073\u30b9\u30a4\u30c3\u30c1) \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30d5\u30e9\u3092\u69cb\u7bc9\u3057\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30fc\u30b0\u30eb\u30fc\u30d7\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\n\n- `# vi /etc/neutron/plugins/ml2/linuxbridge_agent.ini` \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n```properties:linuxbridge_agent.ini\n# \u4eee\u60f3\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7269\u7406\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u7d50\u3073\u3064\u3051\u308b\n[linux_bridge]\n# public:enp0s3\u3068\u3057\u305f\nphysical_interface_mappings = public:PUBLIC_INTERFACE_NAME\n\n# VXLAN\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\n[vxlan]\nenable_vxlan = False\n\n# ARP\u30b9\u30d7\u30fc\u30d5\u30a3\u30f3\u30b0\u306e\u4fdd\u8b77\u3092\u6709\u52b9\n[agent]\nprevent_arp_spoofing = True\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u6709\u52b9\u306b\u3057\u3001 Linux \u30d6\u30ea\u30c3\u30b8 iptables \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\n[securitygroup]\nenable_security_group = True\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\n```\n\n#### DHCP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n  - `# vi /etc/neutron/dhcp_agent.ini` \u3067\u4ee5\u4e0b\u3092\u7de8\u96c6\n\n```properties:dhcp_agent.ini\n# Linux \u30d6\u30ea\u30c3\u30b8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30c9\u30e9\u30a4\u30d0\u30fc\u3001Dnsmasq DHCP \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\u3057\u3066\u3001 isolated metadata \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u3042\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u3067\u30e1\u30bf\u30c7\u30fc\u30bf\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n[DEFAULT]\ninterface_driver = neutron.agent.linux.interface.BridgeInterfaceDriver\ndhcp_driver = neutron.agent.linux.dhcp.Dnsmasq\nenable_isolated_metadata = True\n```\n\n#### \u30e1\u30bf\u30c7\u30fc\u30bf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n\n>\u30e1\u30bf\u30c7\u30fc\u30bf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8 \u306f\u3001\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u63d0\u4f9b\u3059\u308b\n\n- `# vi /etc/neutron/metadata_agent.ini`\n\n```properties:metadata_agent.ini\n# \u30a2\u30af\u30bb\u30b9\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\n[DEFAULT]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_region = RegionOne\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n\n# \u30e1\u30bf\u30c7\u30fc\u30bf\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\n[DEFAULT]\nnova_metadata_ip = controller\n\n# \u30e1\u30bf\u30c7\u30fc\u30bf\u30d7\u30ed\u30ad\u30b7\u30fc\u306e\u5171\u6709\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n[DEFAULT]\nmetadata_proxy_shared_secret = METADATA_SECRET # meta++\n```\n\n#### Networking\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eCompute\u306e\u8a2d\u5b9a\n  - `# vi /etc/nova/nova.conf`\n\n```properties:nova.conf\n# \u30a2\u30af\u30bb\u30b9\u7528\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a2d\u5b9a\u3057\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u30d7\u30ed\u30ad\u30b7\u30fc\u3092\u6709\u52b9\u306b\u3057\u3001\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3092\u8a2d\u5b9a\n[neutron]\nurl = http://controller:9696\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n \nservice_metadata_proxy = True\nmetadata_proxy_shared_secret = METADATA_SECRET # meta++\n``` \n\n#### \u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306e\u4f5c\u6210\n  - `# ln -s /etc/neutron/plugins/ml2/ml2_conf.ini  /etc/neutron/plugin.ini`\n  - `ll /etc/neutron/` \u3057\u3066 `plugin.ini -> /etc/neutron/plugins/ml2/ml2_conf.ini` \u306a\u3063\u3066\u3044\u308c\u3070\u304ak\n\n#### DB\u5c55\u958b\n- `su -s /bin/sh -c \"neutron-db-manage --config-file /etc/neutron/neutron.conf --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head\" neutron`\n  -  Failed to parse /etc/neutron/neutron.conf: at /etc/neutron/neutron.conf:3, Unexpected continuation line: ' verbose = True'\n      - \u3068\u3067\u305f\u306e\u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n  - Failed to parse /etc/neutron/neutron.conf: at /etc/neutron/neutron.conf:60, Unexpected continuation line: ' core_plugin = ml2' \n      - \u982d\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9\u5165\u3063\u3066\u3044\u308b\u3068\u523a\u3055\u308b\u3063\u307d\u3044 \u523a\u3055\u3089\u306a\u3044\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u3042\u308b\u304c\uff0c\u524a\u9664\u3057\u3066\u304a\u3044\u305f\u65b9\u304c\u8eab\u306e\u305f\u3081\u304b\n      - \u591a\u5206\u2191\u306everbose\u3082\u540c\u3058\u539f\u56e0\n      - \u30d1\u30e9\u30e1\u30fc\u30bf\u524d\u306e\u30b9\u30da\u30fc\u30b9\u3092\u5168\u3066\u6d88\u3057\u305f\u5f8c\u518d\u5ea6\u5b9f\u884c -> \u3044\u3051\u305f\n\n- Compute API \u30b5\u30fc\u30d3\u30b9\u3092\u518d\u5b9f\u884c\n  - `# systemctl restart openstack-nova-api`\n\n- \u8d77\u52d5\u8a2d\u5b9a\n  - `# systemctl enable neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent`\n  - `# systemctl start neutron-server neutron-linuxbridge-agent neutron-dhcp-agent neutron-metadata-agent`\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a@\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\n- \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n  - `# yum install openstack-neutron openstack-neutron-linuxbridge ebtables ipset`\n\n- `# vi /etc/neutron/neutron.conf`\n\n```properties:neutron.cong\n# Rabbit\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc\u306e\u8a2d\u5b9a\n[DEFAULT]\nrpc_backend = rabbit\n\n[oslo_messaging_rabbit]\nrabbit_host = controller\nrabbit_userid = openstack\nrabbit_password = RABBIT_PASS # root++\n\n# identify\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u63a5\u7d9a\n[DEFAULT]\nauth_strategy = keystone\n\n[keystone_authtoken]\nauth_uri = http://controller:5000\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n# \u4ed6\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n\n# \u30ed\u30c3\u30af\u30d1\u30b9\u306e\u8a2d\u5b9a\n[oslo_concurrency]\nlock_path = /var/lib/neutron/tmp\n\n```\n\n#### Linux\u30d6\u30ea\u30c3\u30b8\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u8a2d\u5b9a\n  - `# vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini` \u3067\u4ee5\u4e0b\n\n```properties:linuxbridge_agent.ini\n# \u4eee\u60f3\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7269\u7406\u30d1\u30d6\u30ea\u30c3\u30af\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u7d50\u3073\u3064\u3051\u308b\n[linux_bridge]\n# public:enp0s3\u3068\u3057\u305f\nphysical_interface_mappings = public:PUBLIC_INTERFACE_NAME\n\n# VXLAN\u30aa\u30fc\u30d0\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u7121\u52b9\n[vxlan]\nenable_vxlan = False\n\n# ARP\u30b9\u30d7\u30fc\u30d5\u30a3\u30f3\u30b0\u306e\u4fdd\u8b77\u3092\u6709\u52b9\n[agent]\nprevent_arp_spoofing = True\n\n# \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u6709\u52b9\u306b\u3057\u3001 Linux \u30d6\u30ea\u30c3\u30b8 iptables \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u8a2d\u5b9a\n[securitygroup]\nenable_security_group = True\nfirewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver\n```\n\n#### Networking\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eCompute\u306e\u8a2d\u5b9a\n  - `# vim /etc/nova/nova.conf`\n\n```properties:nova.conf\n# neutron\u30a2\u30af\u30bb\u30b9\u7528\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a2d\u5b9a\n[neutron]\nurl = http://controller:9696\nauth_url = http://controller:35357\nauth_plugin = password\nproject_domain_id = default\nuser_domain_id = default\nregion_name = RegionOne\nproject_name = service\nusername = neutron\npassword = NEUTRON_PASS # root++\n```\n\n- \u8d77\u52d5\u8a2d\u5b9a\n  - `# systemctl enable neutron-linuxbridge-agent`\n  - `# systemctl start neutron-linuxbridge-agent`\n\n## \u78ba\u8a8d\n- \u30ed\u30fc\u30c9\u6e08\u62e1\u5f35\u6a5f\u80fd\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\uff0cneutron-server\u30d7\u30ed\u30bb\u30b9\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n  - `neutron ext-list`\n      - \u30aa\u30d7\u30b7\u30e7\u30f31\u3092\u9078\u629e\u3057\u305f\u306e\u3067\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306e\u4f8b\u3088\u308a\u5c11\u306a\u3044\n- neutron\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\uff0c\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u4e00\u89a7\u3092\u8868\u793a\n  - `neutron agent-list`\n      - \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30ce\u30fc\u30c9\u306b3\u3064\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\uff0c\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306b1\u3064\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n- \u3053\u3053\u307e\u3067\u7d42\u308f\u308c\u3070\uff0c\u57fa\u672c\u7684\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304cOpenStack\u74b0\u5883\u306b\u8ffd\u52a0\u3055\u308c\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n"}