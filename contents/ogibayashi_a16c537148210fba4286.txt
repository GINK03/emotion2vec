{"tags": ["Elasticsearch", "kibana3"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u8272\u3005\u306a\u7a2e\u985e\u306e\u30ed\u30b0\u3092ElasticSearch\u306b\u8caf\u3081\u308b\u5834\u5408\u306b\u3001index\u3092\u5206\u3051\u308b\u306e\u304b\u3001\u540c\u4e00index\u3067type\u3092\u5206\u3051\u308b\u306e\u304b\u3001\u3068\u3044\u3046\u70b9\u306b\u3064\u3044\u3066\u3001stackoverflow\u306e\u8a18\u4e8b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u500b\u3005\u306e\u30ed\u30b0\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u306e\u306a\u3089index\u3092\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u691c\u7d22\u3092\u52b9\u7387\u3088\u304f\u5b9f\u884c\u3067\u304d\u308b\n\u305d\u3046\u3067\u306a\u3044\u306a\u3089type\u3092\u5206\u3051\u308b\u3068\u3001\u6ca2\u5c71\u306eindex\u3092\u6301\u3064\u969b\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u5bb9\u91cf\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u907f\u3051\u308b\u4e8b\u304c\u3067\u304d\u308b\n\nindex\u3092\u5206\u3051\u308b\u3068\u3001\u540c\u3058\u3088\u3046\u306a\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u5bfe\u8c61index\u3092\u5909\u3048\u305f\u3082\u306e\u3092\u6ca2\u5c71\u4f5c\u308a\u305f\u304f\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u65b9\u6cd5\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\u3053\u3053\u3067\u306f\u3001\u984c\u6750\u3068\u3057\u3066Hadoop daemon\u306e\u30ed\u30b0\u3092\u5229\u7528\u3057\u3066\u304a\u308a\u3001NameNode, DataNode\u3068\u8a00\u3063\u305fdaemon\u3054\u3068\u306bindex\u3092\u5206\u3051\u308b\u30b1\u30fc\u30b9\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002(\u3061\u306a\u307f\u306b\u3001\u30ed\u30b0\u81ea\u4f53\u306ffluent-plugin-elasticsearch\u3067\u683c\u7d0d\u3057\u3066\u304a\u308a\u3001fluent-plugin-forest\u3068\u7d44\u307f\u5408\u308f\u305b\u3066logstash_prefix\u3092tag\u306b\u3057\u3066\u3044\u307e\u3059)\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u4fdd\u5b58\u578b\u5f0f\nKibana3\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u3001\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u5185(Local storage?)\n\u30d5\u30a1\u30a4\u30eb\nElasticSearch\n\nElasticSearch\u306b\u4fdd\u5b58\u3059\u308b\u3068\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4e00\u89a7\u304b\u3089\u9078\u629e\u3057\u305f\u308a\u691c\u7d22\u3057\u305f\u308a\u3067\u304d\u308b\u306e\u3067\u4fbf\u5229\u3067\u3059\u3002\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308b\n\u307e\u305a\u3001\u3069\u308c\u304b\u306eindex\u306b\u5bfe\u3057\u3066\u898b\u305f\u3044\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u3001\"save\"\u30dc\u30bf\u30f3\u306e\"Export to file\"\u3067JSON\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002JSON\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u5f62\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n{\n  \"title\": \"hadoop-namenode\",\n  \"services\": {\n    \"query\": {\n      \"idQueue\": [\n        3,\n        4\n      ],\n      \"list\": {\n        \"0\": {\n          \"query\": \"INFO\",\n          \"alias\": \"\",\n          \"color\": \"#7EB26D\",\n          \"id\": 0,\n          \"pin\": false,\n          \"type\": \"lucene\"\n        },\n        \"1\": {\n          \"id\": 1,\n          \"color\": \"#EAB839\",\n          \"query\": \"WARN\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\"\n        },\n        \"2\": {\n          \"id\": 2,\n          \"color\": \"#6ED0E0\",\n          \"query\": \"ERROR\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\"\n        }\n      },\n(snip)\n  \"editable\": true,\n  \"index\": {\n    \"interval\": \"day\",\n    \"pattern\": \"[txtlog.hadoop.daemonlog.namenode-]YYYY.MM.DD\",\n    \"default\": \"_all\"\n  },\n  \"style\": \"dark\",\n  \"failover\": false,\n  \"panel_hints\": true,\n  \"loader\": {\n    \"save_gist\": false,\n    \"save_elasticsearch\": true,\n    \"save_local\": true,\n    \"save_default\": true,\n    \"save_temp\": true,\n    \"save_temp_ttl_enable\": true,\n    \"save_temp_ttl\": \"30d\",\n    \"load_gist\": true,\n    \"load_elasticsearch\": true,\n    \"load_elasticsearch_size\": 20,\n    \"load_local\": true,\n    \"hide\": false\n  }\n}\n\n\u3053\u308c\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066title\u3068index.pattern\u3092\u5909\u3048\u305fJSON\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u305e\u308c\u3092ElasticSearch\u306b\u767b\u9332\u3057\u307e\u3059.\n\nElasticSearch\u3078\u306e\u4fdd\u5b58\u578b\u5f0f\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092ElasticSearch\u306b\u4fdd\u5b58\u3057\u305f\u5834\u5408\u3001kibana-int\u3068\u3044\u3046index\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u683c\u7d0d\u3055\u308c\u305f\u3082\u306e\u306fREST API\u3092\u5229\u7528\u3057\u3066\u53c2\u7167\u53ef\u80fd\u3067\u3059\u3002\ncurl -XGET 'http://10.29.254.31:9200/kibana-int/_search?q=*' | ruby -r json -e 'puts JSON.pretty_generate(JSON.parse(STDIN.read))'\n\u683c\u7d0d\u3055\u308c\u305f\u3082\u306e\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u308a\u3001dashboard\u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5148\u307b\u3069\u306eJSON\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u5165\u308c\u3066\u304a\u3051\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n     {\n        \"_index\": \"kibana-int\",\n        \"_type\": \"dashboard\",\n        \"_id\": \"hadoop-namenode\",\n        \"_score\": 1.0,\n        \"_source\": {\n          \"user\": \"guest\",\n          \"group\": \"guest\",\n          \"title\": \"hadoop-namenode\",\n          \"dashboard\": \"{\\\"title\\\":\\\"hadoop-namenode\\\",\\\"services\\\":{\\\"query\\\":{\\\"idQueue\\\":[3,4],\\\"list\\\":{\\\"0\\\":{\\\"query\\\":\\\"INFO\\\",\\\"alias\\\":\\\"\\\",\\\"color\\\":\\\"#7EB26D\\\",\\\"id\\\":0,\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"},\\\"1\\\":{\\\"id\\\":1,\\\"color\\\":\\\"#EAB839\\\",\\\"query\\\":\\\"WARN\\\",\\\"alias\\\":\\\"\\\",\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"},\\\"2\\\":{\\\"id\\\":2,\\\"color\\\":\\\"#6ED0E0\\\",\\\"query\\\":\\\"ERROR\\\",\\\"alias\\\":\\\"\\\",\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"}},\\\"ids\\\":[0,1,2]},\\\"filter\\\":{\\\"idQueue\\\":[1,2],\\\"list\\\":{\\\"0\\\":{\\\"from\\\":\\\"2013-10-05T07:59:43.832Z\\\",\\\"to\\\":\\\"2013-10-07T07:59:43.832Z\\\",\\\"field\\\":\\\"@timestamp\\\",\\\"type\\\":\\\"time\\\",\\\"mandate\\\":\\\"must\\\",\\\"active\\\":true,\\\"alias\\\":\\\"\\\",\\\"id\\\":0}},\\\"ids\\\":[0]}},\\\"rows\\\":[{\\\"title\\\":\\\"Options\\\",\\\"height\\\":\\\"50px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":\\\"\\\",\\\"span\\\":8,\\\"editable\\\":true,\\\"type\\\":\\\"timepicker\\\",\\\"loadingEditor\\\":false,\\\"status\\\":\\\"Stable\\\",\\\"mode\\\":\\\"relative\\\",\\\"time_options\\\":[\\\"5m\\\",\\\"15m\\\",\\\"1h\\\",\\\"6h\\\",\\\"12h\\\",\\\"24h\\\",\\\"2d\\\",\\\"7d\\\",\\\"30d\\\"],\\\"timespan\\\":\\\"2d\\\",\\\"timefield\\\":\\\"@timestamp\\\",\\\"timeformat\\\":\\\"\\\",\\\"refresh\\\":{\\\"enable\\\":false,\\\"interval\\\":30,\\\"min\\\":3},\\\"filter_id\\\":0,\\\"title\\\":\\\"Timepicker\\\"}]},{\\\"title\\\":\\\"Query\\\",\\\"height\\\":\\\"50px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":false,\\\"span\\\":12,\\\"editable\\\":true,\\\"group\\\":[\\\"default\\\"],\\\"type\\\":\\\"query\\\",\\\"label\\\":\\\"Search\\\",\\\"history\\\":[\\\"ERROR\\\",\\\"WARN\\\",\\\"INFO\\\",\\\"*\\\"],\\\"remember\\\":10,\\\"pinned\\\":true,\\\"query\\\":\\\"*\\\",\\\"title\\\":\\\"Search\\\"}]},{\\\"title\\\":\\\"Histogram\\\",\\\"height\\\":\\\"150px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"span\\\":8,\\\"editable\\\":true,\\\"type\\\":\\\"histogram\\\",\\\"loadingEditor\\\":false,\\\"mode\\\":\\\"count\\\",\\\"time_field\\\":\\\"@timestamp\\\",\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"value_field\\\":null,\\\"auto_int\\\":true,\\\"resolution\\\":100,\\\"interval\\\":\\\"30m\\\",\\\"intervals\\\":[\\\"auto\\\",\\\"1s\\\",\\\"1m\\\",\\\"5m\\\",\\\"10m\\\",\\\"30m\\\",\\\"1h\\\",\\\"3h\\\",\\\"12h\\\",\\\"1d\\\",\\\"1w\\\",\\\"1M\\\",\\\"1y\\\"],\\\"fill\\\":0,\\\"linewidth\\\":3,\\\"timezone\\\":\\\"browser\\\",\\\"spyable\\\":true,\\\"zoomlinks\\\":true,\\\"bars\\\":true,\\\"stack\\\":true,\\\"points\\\":false,\\\"lines\\\":false,\\\"legend\\\":true,\\\"x-axis\\\":true,\\\"y-axis\\\":true,\\\"percentage\\\":false,\\\"interactive\\\":true,\\\"options\\\":true,\\\"tooltip\\\":{\\\"value_type\\\":\\\"cumulative\\\",\\\"query_as_alias\\\":false}},{\\\"span\\\":4,\\\"editable\\\":true,\\\"type\\\":\\\"hits\\\",\\\"loadingEditor\\\":false,\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"style\\\":{\\\"font-size\\\":\\\"10pt\\\"},\\\"arrangement\\\":\\\"horizontal\\\",\\\"chart\\\":\\\"bar\\\",\\\"counter_pos\\\":\\\"above\\\",\\\"donut\\\":false,\\\"tilt\\\":false,\\\"labels\\\":true,\\\"spyable\\\":true,\\\"title\\\":\\\"Hits\\\"}]},{\\\"title\\\":\\\"Table\\\",\\\"height\\\":\\\"650px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":false,\\\"span\\\":12,\\\"editable\\\":true,\\\"type\\\":\\\"table\\\",\\\"loadingEditor\\\":false,\\\"status\\\":\\\"Stable\\\",\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"size\\\":100,\\\"pages\\\":5,\\\"offset\\\":0,\\\"sort\\\":[\\\"@timestamp\\\",\\\"desc\\\"],\\\"group\\\":\\\"default\\\",\\\"style\\\":{\\\"font-size\\\":\\\"9pt\\\"},\\\"overflow\\\":\\\"min-height\\\",\\\"fields\\\":[null,\\\"@timestamp\\\",\\\"host\\\",\\\"message\\\"],\\\"highlight\\\":[],\\\"sortable\\\":true,\\\"header\\\":true,\\\"paging\\\":true,\\\"field_list\\\":true,\\\"trimFactor\\\":300,\\\"normTimes\\\":true,\\\"spyable\\\":true,\\\"title\\\":\\\"Table\\\"}]}],\\\"editable\\\":true,\\\"index\\\":{\\\"interval\\\":\\\"day\\\",\\\"pattern\\\":\\\"[txtlog.hadoop.daemonlog.namenode-]YYYY.MM.DD\\\",\\\"default\\\":\\\"_all\\\"},\\\"style\\\":\\\"dark\\\",\\\"failover\\\":false,\\\"panel_hints\\\":true,\\\"loader\\\":{\\\"save_gist\\\":false,\\\"save_elasticsearch\\\":true,\\\"save_local\\\":true,\\\"save_default\\\":true,\\\"save_temp\\\":true,\\\"save_temp_ttl_enable\\\":true,\\\"save_temp_ttl\\\":\\\"30d\\\",\\\"load_gist\\\":true,\\\"load_elasticsearch\\\":true,\\\"load_elasticsearch_size\\\":20,\\\"load_local\\\":true,\\\"hide\\\":false}}\"\n        }\n      },\n\n\n\u307e\u3068\u3081\u3066\u4f5c\u308b\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3042\u3068\u306fElasticSearch\u5185\u306b\u5b58\u5728\u3059\u308b\u5404\u30ed\u30b0\u306eindex\u3068\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u91cf\u7523\u3057\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u306eTEMPLATE_FILE\u306b\u306f\u5148\u307b\u3069\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3057\u305fJSON\u306e\u5834\u6240\u3092\u3001INDEX_GLOB\u306b\u306fElasticSearch\u306eindex\u30d5\u30a1\u30a4\u30eb\u3092\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u578b\u5f0f\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306eglob\u306b\u30de\u30c3\u30c1\u3059\u308bindex\u306b\u5bfe\u3057\u3066\u305d\u308c\u305e\u308c\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066ElasticSearch\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\nkibana_dashboards.rb\n#!/usr/bin/env ruby\n\nrequire 'json'\nrequire 'net/http'\n\nTEMPLATE_FILE='/var/www/html/kibana-latest/app/dashboards/hadoop_daemonlog_template.json'\nINDEX_GLOB=\"/var/lib/elasticsearch/elasticsearch/nodes/*/indices/txtlog.hadoop.daemonlog.*\"\nES_HOST=\"192.168.1.1\"\n\ntemplate_json = JSON.parse(File.read(TEMPLATE_FILE))\nindices=Dir.glob(\"#{INDEX_GLOB}-#{Time.now.strftime(\"%Y.%m.%d\")}\").each{|index|\n  index_name = File.basename(index).gsub(/-\\d{4}\\.\\d{2}\\.\\d{2}$/,\"\")\n  template_json['title'] = index_name\n  template_json['index']['pattern'] = \"[#{index_name}-]YYYY.MM.DD\"\n  api = Net::HTTP.new(ES_HOST,9200)\n  doc = {\"user\"=>\"guest\",\"group\"=>\"guest\",\"title\"=>index_name, \"dashboard\" => template_json.to_json}\n  puts doc\n  res = api.put(\"/kibana-int/dashboard/#{index_name}\",doc.to_json)\n  puts res\n}\n\n\n\n\n\u3067\u304d\u3042\u304c\u308a\nKibana3\u306eLoad\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u767b\u9332\u3057\u305f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4e00\u89a7\u3067\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u691c\u7d22\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u4f5c\u308a\u307e\u304f\u3063\u3066\u3082\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n\n# \u306f\u3058\u3081\u306b\n\n\u8272\u3005\u306a\u7a2e\u985e\u306e\u30ed\u30b0\u3092ElasticSearch\u306b\u8caf\u3081\u308b\u5834\u5408\u306b\u3001index\u3092\u5206\u3051\u308b\u306e\u304b\u3001\u540c\u4e00index\u3067type\u3092\u5206\u3051\u308b\u306e\u304b\u3001\u3068\u3044\u3046\u70b9\u306b\u3064\u3044\u3066\u3001[stackoverflow\u306e\u8a18\u4e8b](http://stackoverflow.com/questions/14465668/elastic-search-multiple-indexes-vs-one-index-and-types-for-different-data-sets)\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\n- \u500b\u3005\u306e\u30ed\u30b0\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u306e\u306a\u3089index\u3092\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u691c\u7d22\u3092\u52b9\u7387\u3088\u304f\u5b9f\u884c\u3067\u304d\u308b\n- \u305d\u3046\u3067\u306a\u3044\u306a\u3089type\u3092\u5206\u3051\u308b\u3068\u3001\u6ca2\u5c71\u306eindex\u3092\u6301\u3064\u969b\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u5bb9\u91cf\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u907f\u3051\u308b\u4e8b\u304c\u3067\u304d\u308b\n\nindex\u3092\u5206\u3051\u308b\u3068\u3001\u540c\u3058\u3088\u3046\u306a\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u5bfe\u8c61index\u3092\u5909\u3048\u305f\u3082\u306e\u3092\u6ca2\u5c71\u4f5c\u308a\u305f\u304f\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u65b9\u6cd5\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3053\u3053\u3067\u306f\u3001\u984c\u6750\u3068\u3057\u3066Hadoop daemon\u306e\u30ed\u30b0\u3092\u5229\u7528\u3057\u3066\u304a\u308a\u3001NameNode, DataNode\u3068\u8a00\u3063\u305fdaemon\u3054\u3068\u306bindex\u3092\u5206\u3051\u308b\u30b1\u30fc\u30b9\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002(\u3061\u306a\u307f\u306b\u3001\u30ed\u30b0\u81ea\u4f53\u306ffluent-plugin-elasticsearch\u3067\u683c\u7d0d\u3057\u3066\u304a\u308a\u3001fluent-plugin-forest\u3068\u7d44\u307f\u5408\u308f\u305b\u3066logstash_prefix\u3092tag\u306b\u3057\u3066\u3044\u307e\u3059)\n\n# \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u4fdd\u5b58\u578b\u5f0f\n\nKibana3\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u3001\u4ee5\u4e0b\u306e\u3044\u305a\u308c\u304b\u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n- \u30d6\u30e9\u30a6\u30b6\u5185(Local storage?)\n- \u30d5\u30a1\u30a4\u30eb\n- ElasticSearch\n\nElasticSearch\u306b\u4fdd\u5b58\u3059\u308b\u3068\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4e00\u89a7\u304b\u3089\u9078\u629e\u3057\u305f\u308a\u691c\u7d22\u3057\u305f\u308a\u3067\u304d\u308b\u306e\u3067\u4fbf\u5229\u3067\u3059\u3002\n\n# \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308b\n\n\u307e\u305a\u3001\u3069\u308c\u304b\u306eindex\u306b\u5bfe\u3057\u3066\u898b\u305f\u3044\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u3001\"save\"\u30dc\u30bf\u30f3\u306e\"Export to file\"\u3067JSON\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002JSON\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u5f62\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\n```js\n{\n  \"title\": \"hadoop-namenode\",\n  \"services\": {\n    \"query\": {\n      \"idQueue\": [\n        3,\n        4\n      ],\n      \"list\": {\n        \"0\": {\n          \"query\": \"INFO\",\n          \"alias\": \"\",\n          \"color\": \"#7EB26D\",\n          \"id\": 0,\n          \"pin\": false,\n          \"type\": \"lucene\"\n        },\n        \"1\": {\n          \"id\": 1,\n          \"color\": \"#EAB839\",\n          \"query\": \"WARN\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\"\n        },\n        \"2\": {\n          \"id\": 2,\n          \"color\": \"#6ED0E0\",\n          \"query\": \"ERROR\",\n          \"alias\": \"\",\n          \"pin\": false,\n          \"type\": \"lucene\"\n        }\n      },\n(snip)\n  \"editable\": true,\n  \"index\": {\n    \"interval\": \"day\",\n    \"pattern\": \"[txtlog.hadoop.daemonlog.namenode-]YYYY.MM.DD\",\n    \"default\": \"_all\"\n  },\n  \"style\": \"dark\",\n  \"failover\": false,\n  \"panel_hints\": true,\n  \"loader\": {\n    \"save_gist\": false,\n    \"save_elasticsearch\": true,\n    \"save_local\": true,\n    \"save_default\": true,\n    \"save_temp\": true,\n    \"save_temp_ttl_enable\": true,\n    \"save_temp_ttl\": \"30d\",\n    \"load_gist\": true,\n    \"load_elasticsearch\": true,\n    \"load_elasticsearch_size\": 20,\n    \"load_local\": true,\n    \"hide\": false\n  }\n}\n```\n\n\u3053\u308c\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066`title`\u3068`index.pattern`\u3092\u5909\u3048\u305fJSON\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u305e\u308c\u3092ElasticSearch\u306b\u767b\u9332\u3057\u307e\u3059.\n\n# ElasticSearch\u3078\u306e\u4fdd\u5b58\u578b\u5f0f\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092ElasticSearch\u306b\u4fdd\u5b58\u3057\u305f\u5834\u5408\u3001kibana-int\u3068\u3044\u3046index\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u683c\u7d0d\u3055\u308c\u305f\u3082\u306e\u306fREST API\u3092\u5229\u7528\u3057\u3066\u53c2\u7167\u53ef\u80fd\u3067\u3059\u3002\n\n`curl -XGET 'http://10.29.254.31:9200/kibana-int/_search?q=*' | ruby -r json -e 'puts JSON.pretty_generate(JSON.parse(STDIN.read))'`\n\n\u683c\u7d0d\u3055\u308c\u305f\u3082\u306e\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u304a\u308a\u3001`dashboard`\u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u5148\u307b\u3069\u306eJSON\u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u5165\u308c\u3066\u304a\u3051\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n```js\n     {\n        \"_index\": \"kibana-int\",\n        \"_type\": \"dashboard\",\n        \"_id\": \"hadoop-namenode\",\n        \"_score\": 1.0,\n        \"_source\": {\n          \"user\": \"guest\",\n          \"group\": \"guest\",\n          \"title\": \"hadoop-namenode\",\n          \"dashboard\": \"{\\\"title\\\":\\\"hadoop-namenode\\\",\\\"services\\\":{\\\"query\\\":{\\\"idQueue\\\":[3,4],\\\"list\\\":{\\\"0\\\":{\\\"query\\\":\\\"INFO\\\",\\\"alias\\\":\\\"\\\",\\\"color\\\":\\\"#7EB26D\\\",\\\"id\\\":0,\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"},\\\"1\\\":{\\\"id\\\":1,\\\"color\\\":\\\"#EAB839\\\",\\\"query\\\":\\\"WARN\\\",\\\"alias\\\":\\\"\\\",\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"},\\\"2\\\":{\\\"id\\\":2,\\\"color\\\":\\\"#6ED0E0\\\",\\\"query\\\":\\\"ERROR\\\",\\\"alias\\\":\\\"\\\",\\\"pin\\\":false,\\\"type\\\":\\\"lucene\\\"}},\\\"ids\\\":[0,1,2]},\\\"filter\\\":{\\\"idQueue\\\":[1,2],\\\"list\\\":{\\\"0\\\":{\\\"from\\\":\\\"2013-10-05T07:59:43.832Z\\\",\\\"to\\\":\\\"2013-10-07T07:59:43.832Z\\\",\\\"field\\\":\\\"@timestamp\\\",\\\"type\\\":\\\"time\\\",\\\"mandate\\\":\\\"must\\\",\\\"active\\\":true,\\\"alias\\\":\\\"\\\",\\\"id\\\":0}},\\\"ids\\\":[0]}},\\\"rows\\\":[{\\\"title\\\":\\\"Options\\\",\\\"height\\\":\\\"50px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":\\\"\\\",\\\"span\\\":8,\\\"editable\\\":true,\\\"type\\\":\\\"timepicker\\\",\\\"loadingEditor\\\":false,\\\"status\\\":\\\"Stable\\\",\\\"mode\\\":\\\"relative\\\",\\\"time_options\\\":[\\\"5m\\\",\\\"15m\\\",\\\"1h\\\",\\\"6h\\\",\\\"12h\\\",\\\"24h\\\",\\\"2d\\\",\\\"7d\\\",\\\"30d\\\"],\\\"timespan\\\":\\\"2d\\\",\\\"timefield\\\":\\\"@timestamp\\\",\\\"timeformat\\\":\\\"\\\",\\\"refresh\\\":{\\\"enable\\\":false,\\\"interval\\\":30,\\\"min\\\":3},\\\"filter_id\\\":0,\\\"title\\\":\\\"Timepicker\\\"}]},{\\\"title\\\":\\\"Query\\\",\\\"height\\\":\\\"50px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":false,\\\"span\\\":12,\\\"editable\\\":true,\\\"group\\\":[\\\"default\\\"],\\\"type\\\":\\\"query\\\",\\\"label\\\":\\\"Search\\\",\\\"history\\\":[\\\"ERROR\\\",\\\"WARN\\\",\\\"INFO\\\",\\\"*\\\"],\\\"remember\\\":10,\\\"pinned\\\":true,\\\"query\\\":\\\"*\\\",\\\"title\\\":\\\"Search\\\"}]},{\\\"title\\\":\\\"Histogram\\\",\\\"height\\\":\\\"150px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"span\\\":8,\\\"editable\\\":true,\\\"type\\\":\\\"histogram\\\",\\\"loadingEditor\\\":false,\\\"mode\\\":\\\"count\\\",\\\"time_field\\\":\\\"@timestamp\\\",\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"value_field\\\":null,\\\"auto_int\\\":true,\\\"resolution\\\":100,\\\"interval\\\":\\\"30m\\\",\\\"intervals\\\":[\\\"auto\\\",\\\"1s\\\",\\\"1m\\\",\\\"5m\\\",\\\"10m\\\",\\\"30m\\\",\\\"1h\\\",\\\"3h\\\",\\\"12h\\\",\\\"1d\\\",\\\"1w\\\",\\\"1M\\\",\\\"1y\\\"],\\\"fill\\\":0,\\\"linewidth\\\":3,\\\"timezone\\\":\\\"browser\\\",\\\"spyable\\\":true,\\\"zoomlinks\\\":true,\\\"bars\\\":true,\\\"stack\\\":true,\\\"points\\\":false,\\\"lines\\\":false,\\\"legend\\\":true,\\\"x-axis\\\":true,\\\"y-axis\\\":true,\\\"percentage\\\":false,\\\"interactive\\\":true,\\\"options\\\":true,\\\"tooltip\\\":{\\\"value_type\\\":\\\"cumulative\\\",\\\"query_as_alias\\\":false}},{\\\"span\\\":4,\\\"editable\\\":true,\\\"type\\\":\\\"hits\\\",\\\"loadingEditor\\\":false,\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"style\\\":{\\\"font-size\\\":\\\"10pt\\\"},\\\"arrangement\\\":\\\"horizontal\\\",\\\"chart\\\":\\\"bar\\\",\\\"counter_pos\\\":\\\"above\\\",\\\"donut\\\":false,\\\"tilt\\\":false,\\\"labels\\\":true,\\\"spyable\\\":true,\\\"title\\\":\\\"Hits\\\"}]},{\\\"title\\\":\\\"Table\\\",\\\"height\\\":\\\"650px\\\",\\\"editable\\\":true,\\\"collapse\\\":false,\\\"collapsable\\\":true,\\\"panels\\\":[{\\\"error\\\":false,\\\"span\\\":12,\\\"editable\\\":true,\\\"type\\\":\\\"table\\\",\\\"loadingEditor\\\":false,\\\"status\\\":\\\"Stable\\\",\\\"queries\\\":{\\\"mode\\\":\\\"all\\\",\\\"ids\\\":[0,1,2]},\\\"size\\\":100,\\\"pages\\\":5,\\\"offset\\\":0,\\\"sort\\\":[\\\"@timestamp\\\",\\\"desc\\\"],\\\"group\\\":\\\"default\\\",\\\"style\\\":{\\\"font-size\\\":\\\"9pt\\\"},\\\"overflow\\\":\\\"min-height\\\",\\\"fields\\\":[null,\\\"@timestamp\\\",\\\"host\\\",\\\"message\\\"],\\\"highlight\\\":[],\\\"sortable\\\":true,\\\"header\\\":true,\\\"paging\\\":true,\\\"field_list\\\":true,\\\"trimFactor\\\":300,\\\"normTimes\\\":true,\\\"spyable\\\":true,\\\"title\\\":\\\"Table\\\"}]}],\\\"editable\\\":true,\\\"index\\\":{\\\"interval\\\":\\\"day\\\",\\\"pattern\\\":\\\"[txtlog.hadoop.daemonlog.namenode-]YYYY.MM.DD\\\",\\\"default\\\":\\\"_all\\\"},\\\"style\\\":\\\"dark\\\",\\\"failover\\\":false,\\\"panel_hints\\\":true,\\\"loader\\\":{\\\"save_gist\\\":false,\\\"save_elasticsearch\\\":true,\\\"save_local\\\":true,\\\"save_default\\\":true,\\\"save_temp\\\":true,\\\"save_temp_ttl_enable\\\":true,\\\"save_temp_ttl\\\":\\\"30d\\\",\\\"load_gist\\\":true,\\\"load_elasticsearch\\\":true,\\\"load_elasticsearch_size\\\":20,\\\"load_local\\\":true,\\\"hide\\\":false}}\"\n        }\n      },\n```\n\n# \u307e\u3068\u3081\u3066\u4f5c\u308b\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3042\u3068\u306fElasticSearch\u5185\u306b\u5b58\u5728\u3059\u308b\u5404\u30ed\u30b0\u306eindex\u3068\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u91cf\u7523\u3057\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u306e`TEMPLATE_FILE`\u306b\u306f\u5148\u307b\u3069\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3057\u305fJSON\u306e\u5834\u6240\u3092\u3001`INDEX_GLOB`\u306b\u306fElasticSearch\u306eindex\u30d5\u30a1\u30a4\u30eb\u3092\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u578b\u5f0f\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u306eglob\u306b\u30de\u30c3\u30c1\u3059\u308bindex\u306b\u5bfe\u3057\u3066\u305d\u308c\u305e\u308c\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066ElasticSearch\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n```rb:kibana_dashboards.rb\n#!/usr/bin/env ruby\n\nrequire 'json'\nrequire 'net/http'\n\nTEMPLATE_FILE='/var/www/html/kibana-latest/app/dashboards/hadoop_daemonlog_template.json'\nINDEX_GLOB=\"/var/lib/elasticsearch/elasticsearch/nodes/*/indices/txtlog.hadoop.daemonlog.*\"\nES_HOST=\"192.168.1.1\"\n\ntemplate_json = JSON.parse(File.read(TEMPLATE_FILE))\nindices=Dir.glob(\"#{INDEX_GLOB}-#{Time.now.strftime(\"%Y.%m.%d\")}\").each{|index|\n  index_name = File.basename(index).gsub(/-\\d{4}\\.\\d{2}\\.\\d{2}$/,\"\")\n  template_json['title'] = index_name\n  template_json['index']['pattern'] = \"[#{index_name}-]YYYY.MM.DD\"\n  api = Net::HTTP.new(ES_HOST,9200)\n  doc = {\"user\"=>\"guest\",\"group\"=>\"guest\",\"title\"=>index_name, \"dashboard\" => template_json.to_json}\n  puts doc\n  res = api.put(\"/kibana-int/dashboard/#{index_name}\",doc.to_json)\n  puts res\n}\n\n```\n\n# \u3067\u304d\u3042\u304c\u308a\n\nKibana3\u306eLoad\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001\u767b\u9332\u3057\u305f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4e00\u89a7\u3067\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u691c\u7d22\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u4f5c\u308a\u307e\u304f\u3063\u3066\u3082\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2013-10-10 15.50.58.png](https://qiita-image-store.s3.amazonaws.com/0/30516/9fc7849f-8f9e-88b8-0c92-9e1261bfab4f.png)\n"}