{"context": " More than 1 year has passed since last update.\n\n\u74b0\u5883\nCentOS 6.5\nApache 2.2.15\nphp 5.5.19\nsqlite3 3.6.20\n\n\u69cb\u6210\n\ndb\u30d5\u30a1\u30a4\u30eb\u306fdb\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u3063\u3066\u305d\u3053\u306b\u5165\u308c\u3066\u304a\u304f\n-- \u5404\u63b2\u793a\u677f\u60c5\u5831\u3092\u7ba1\u7406\u3059\u308bdb(list.db)\n-- \u3061\u306a\u307f\u306b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u6ce8\u610f\u3002db\u30d5\u30a9\u30eb\u30c0\u306f777,db\u30d5\u30a1\u30a4\u30eb\u306f\u305f\u3057\u304b755or766)\nphp\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n-- \u63b2\u793a\u677f\u30ea\u30b9\u30c8\u3092\u8868\u793a\u3059\u308b(list.php)\n-- \u5404\u63b2\u793a\u677f(bbs.php)\n-- \u30a2\u30f3\u30ab\u30fc\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u304d\u306e\u51e6\u7406(link.php)\n-- \u65b0\u898f\u6295\u7a3f\u51e6\u7406\u3001\u7d50\u679c(ins.php)\n-- \u63b2\u793a\u677f\u8ffd\u52a0\u51e6\u7406(build.php)\n-- \u63b2\u793a\u677f\u524a\u9664\u51e6\u7406\u3001\u7d50\u679c(del.php)\n\n\n\u4e88\u3081\u6e96\u5099\u3059\u308bDB\u306e\u5185\u5bb9\n\nlist.db\nCREATE TABLE list (\nid INTEGER PRIMARY KEY, \ndbname TEXT, \ndbnamekana TEXT, \nkensu INTEGER, \nupdtime TEXT DEFAULT (DATETIME('now', '+09:00:00')), \nflg INTEGER DEFAULT 0\n);\n\n// \u5177\u4f53\u7684\u306a\u5404\u63b2\u793a\u677f\u306eDB\u306f\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u306e\u3067\u4e88\u3081\u7528\u610f\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\n// dbname\u306f\u63b2\u793a\u677f\u751f\u6210\u6642\u306b\u81ea\u52d5\u7684\u306bbbs1,bbs2\u30fb\u30fb\u30fb\u3068\u540d\u4ed8\u3051\u3055\u308c\u308b\n// kensu\u306f\u5404\u63b2\u793a\u677f\u306b\u6295\u7a3f\u3055\u308c\u3066\u3044\u308b\u6295\u7a3f\u4ef6\u6570\u306e\u3053\u3068\n// updtime\u306f\u63b2\u793a\u677f\u66f4\u65b0\u65e5\u6642\u3067\u3001\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u3068\u304d\u306b\u3053\u306e\u9806\u756a\u3067\u4e26\u3079\u308b\n// flg\uff08\u30d5\u30e9\u30b0\uff09\u306f\u5c06\u6765\u7684\u306b\u904e\u53bb\u30b9\u30ec\u884c\u304d\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3068\u304b\u3067\u3059\u3002\n\n\n\n\n\u5177\u4f53\u7684\u306a\u30b3\u30fc\u30c9\n\nlist.php\n<?php\n$db = new PDO(\"sqlite:db/list.db\");\n\n// \u63b2\u793a\u677f\u306e\u6570\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\n$stmt = $db->query(\"SELECT COUNT(*) FROM list\");\n$listcount = $stmt->fetchColumn();\n$stmt->closeCursor();\n\n$i = 1;\n$html = \"\";\n\n// \u63b2\u793a\u677f\u304c1\u3064\u4ee5\u4e0a\u5b58\u5728\u3059\u308c\u3070\u30ea\u30b9\u30c8\u3092\u30ea\u30f3\u30af\u4ed8\u304d\u3067\u8868\u793a\u3059\u308b\nif ($listcount > 0) {\n  // \u65b0\u898f\u6295\u7a3f\u304c\u3042\u3063\u305f\u9806\u306b\u4e26\u3079\u308b\n  $stmt = $db->query(\"SELECT * FROM list WHERE flg=0 ORDER BY updtime DESC\");\n  $list = $stmt->fetchAll(PDO::FETCH_ASSOC);\n  foreach ($list as $row) {\n    $html .= \"<a href='bbs.php?dbname={$row[\"dbname\"]}&dbnamekana={$row[\"dbnamekana\"]}'>\".$i.\":\".$row[\"dbnamekana\"].\" (\".$row['kensu'].\") \".$row['updtime'].\"</a>\".\" <a href='del.php?dbname={$row[\"dbname\"]}'>\u524a\u9664\u3059\u308b</a><br><br>\";\n  $i++;\n  }\n}\n$db = null;\n\n// \u63b2\u793a\u677f\u306e\u6570\u304c10\u672a\u6e80\u3067\u3042\u308c\u3070\u65b0\u30b9\u30ec\u4f5c\u6210\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3059\u308b\u3002\nif ($listcount < 10) {\n  $listcount++;\n  $newdbname = \"bbs\".$listcount;\n  $build = <<< EOM\n  <form action=\"build.php\" method=\"post\">\n  <input type=\"hidden\" name=\"newdbname\" value=\"{$newdbname}\">\n  \u540d\u79f0\uff1a<input type=\"text\" name=\"newdbnamekana\" value=\"\">\n  <input type=\"submit\" name=\"newbbs\" value=\"\u65b0\u3057\u304f\u63b2\u793a\u677f\u3092\u7acb\u3066\u308b\uff08\u5236\u965010\u500b\uff09\">\n  </form>\nEOM;\n} else {\n  $build = \"\u3053\u308c\u4ee5\u4e0a\u63b2\u793a\u677f\u306f\u7acb\u3066\u3089\u308c\u307e\u305b\u3093\u3002\";\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meata charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<h2 style=\"color:#ff0000;\">\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</h1>\n<?php echo $html; ?>\n<?php echo $build; ?>\n</body>\n</html>\n\n\n\nbbs.php\n<?php\nif (isset($_GET[\"dbname\"]) && isset($_GET[\"dbnamekana\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"], ENT_QUOTES);\n  $dbnamekana = htmlspecialchars($_GET[\"dbnamekana\"], ENT_QUOTES);\n  if (isset($_GET[\"page\"])) {\n    $page = htmlspecialchars($_GET[\"page\"], ENT_QUOTES);\n  } else {\n    $page = \"\";\n  }\n} else {\n  header(\"Location: list.php\");\n}\n\n// \u30da\u30fc\u30b8\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u53d6\u5f97\u3001\u8a2d\u5b9a\n$name = \"sqlite:db/\".$dbname.\".db\";\n$db = new PDO($name);\n$stmt = $db->query(\"SELECT COUNT(*) FROM bbs\");\n$kensu = $stmt->fetchColumn(); // \u7dcf\u4ef6\u6570\n$hyouji = 3; // 1\u30da\u30fc\u30b8\u3042\u305f\u308a\u8868\u793a\u4ef6\u6570\n$pcount = ceil($kensu/$hyouji); // \u7dcf\u30da\u30fc\u30b8\u6570\n$plast = $kensu % $hyouji; // \u6700\u7d42\u30da\u30fc\u30b8\u306e\u4ef6\u6570\nif ($page == \"\") {\n  $page = $pcount;\n}\n\n// \u30da\u30fc\u30b8\u79fb\u52d5\u30ea\u30f3\u30af\n$link = \"\";\nfor ($i=1; $i<=$pcount; $i++) {\n  $link .= \"<a href=bbs.php?dbname=\".$dbname.\"&dbnamekana=\".$dbnamekana.\"&page=\".$i.\">\".$i.\"</a>&nbsp;&nbsp;\";\n}\n\n// \u30da\u30fc\u30b8\u8868\u793a\n$stmt = $db->query(\"SELECT * FROM bbs LIMIT ($page-1)*$hyouji, $hyouji\");\n$html = \"<h2 style='color:#ff0000;'>\".$dbnamekana.\"</h2>\";\n$list = $stmt->fetchAll(PDO::FETCH_ASSOC);\nforeach ($list as $row) {\n  $html .= $row[\"id\"].\" : \".$row[\"hiduke\"].\"<br>\";\n  $html .= \"<div id='commnet'>\".$row[\"comment\"].\"</div><br><br>\";\n}\n\n// \u30b3\u30e1\u30f3\u30c8\u306b\u30a2\u30f3\u30ab\u30fc\u304c\u3042\u308c\u3070\u30a2\u30f3\u30ab\u30fc\u306b\u5909\u63db\u3059\u308b\n$html = anchor($dbname, $html);\n$db = null;\n\n// \u7dcf\u4ef6\u6570\u304c10\u4ef6\u672a\u6e80\u3067\u3042\u308c\u3070\u6295\u7a3f\u753b\u9762\u3092\u8868\u793a\u3059\u308b\nif ($kensu < 10) {\n  $form = <<< EOM\n  <form action=\"ins.php\" method=\"post\">\n  <input type=\"hidden\" name=\"dbname\" value=\"{$dbname}\">\n  \u6295\u7a3f\u5185\u5bb9:<br>\n  <textarea name=\"comment\" cols=100 rows=10></textarea><br>\n  <input type=\"submit\" name=\"ins\" value=\"\u9001\u4fe1\">\n  </form>\n  <br>\nEOM;\n} else {\n  $form = \"10\u4ef6\u4ee5\u4e0a\u306f\u66f8\u304d\u8fbc\u3081\u307e\u305b\u3093\u3002<br><br>\";\n}\n\n// \u30b3\u30e1\u30f3\u30c8\u4e2d\u306b\u30a2\u30f3\u30ab\u30fc\u304c\u3042\u308c\u3070\u30a2\u30f3\u30ab\u30fc\u30ea\u30f3\u30af\u3092\u4ed8\u4e0e\u3059\u308b\nfunction anchor($dbname, $comment) {\n  $pattern = \"/&gt;&gt;([0-9])+/\";\n  $replace = '<a href=\"link.php?dbname='.$dbname.'&num=$0\">$0</a>';\n  $comment = preg_replace($pattern, $replace, $comment);\n  return $comment;\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title><?php echo $dbnamekana; ?></title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</haed>\n<body>\n<?php echo $html; ?>\n<?php echo $form; ?>\n<?php echo $link; ?>\n<br><br>\n<a href=\"list.php\">\u63b2\u793a\u677f\u306b\u623b\u308b</a>\n</body>\n</html>\n\n\n\nins.php\n<?php\n// \u6295\u7a3f\u65e5\u6642\u7b49\u3092\u53d6\u5f97\u3059\u308b\n$w = date(\"w\");\n$week_name = [\"\u65e5\", \"\u6708\", \"\u706b\", \"\u6c34\", \"\u6728\", \"\u91d1\", \"\u571f\"];\n$hiduke = date(\"Y-m-d H:i:s\").\"(\".$week_name[$w].\")\";\n\n$html = \"\";\n\n// \u30c7\u30fc\u30bf\u53d7\u53d6\u3001\u5909\u63db\u51e6\u7406\nif (isset($_POST[\"ins\"])) {\n  $dbname = htmlspecialchars($_POST[\"dbname\"], ENT_QUOTES);\n  $comment = nl2br(htmlspecialchars($_POST[\"comment\"], ENT_QUOTES));\n  $comment = anchor($comment);\n\n\u3000// \u8efd\u304f\u5236\u9650\u304b\u3051\u3066\u307f\u305f\n  if (check_br($comment) > 10) {\n    $html .= \"\u6539\u884c\u304c\u591a\u904e\u304e\u307e\u3059\u300210\u884c\u4ee5\u5185\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002<br><br>\";\n  } else if (check_strcount($comment) > 100) {\n    $html .= \"\u6587\u5b57\u6570\u304c\u591a\u904e\u304e\u307e\u3059\u3002100\u6587\u5b57\u4ee5\u5185\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002<br><br>\";\n  } else {\n\u3000\u3000\n\u3000\u3000// \u6295\u7a3f\u51e6\u7406\n    $name = \"sqlite:db/\".$dbname.\".db\";\n    $db = new PDO($name);\n    $db->exec(\"INSERT INTO bbs (hiduke, comment) VALUES ('$hiduke', '$comment')\");\n\n\u3000\u3000// \u4ef6\u6570\u3092\u53d6\u5f97\u3057\u76f4\u3059\n    $stmt = $db->query(\"SELECT COUNT(*) FROM bbs\");\n    $kensu = $stmt->fetchColumn();\n\n\u3000\u3000// list.db\u306e\u4ef6\u6570\u3001\u66f4\u65b0\u65e5\u6642\u3092\u66f4\u65b0\u3057\u3066\u304a\u304f\uff08\u3053\u308c\u3067\u63b2\u793a\u677f\u30ea\u30b9\u30c8\u753b\u9762\u3067\u4e00\u756a\u4e0a\u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\uff09\n\u3000\u3000$db = new PDO(\"sqlite:db/list.db\");\n\u3000\u3000$db->exec(\"UPDATE list SET kensu=$kensu, updtime=(SELECT datetime('now', '+09:00:00')) WHERE dbn\name='$dbname'\");\n    $db = null;\n    $html .= \"\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002<br><br>\";\n  }\n} else {\n  header(\"Location: list.php\");\n}\n\n// \u30a2\u30f3\u30ab\u30fc\u3092\u30ea\u30f3\u30af\u4ed8\u304d\u306b\u5909\u63db\u3059\u308b\nfunction anchor($comment) {\n  $pattern = \"/>>([0-9])+/\";\n  $replace = '<a href=\"link.php?num=$0\">$0</a>';\n  $comment = preg_replace($pattern, $replace, $comment);\n  return $comment;\n}\n\n// \u6539\u884c\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\nfunction check_br($comment) {\n  $brcount = mb_substr_count($comment, \"<br />\");\n  return $brcount;\n}\n\n// \u6587\u5b57\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\nfunction check_strcount($comment) {\n  $strcount = strlen($comment);\n  return $strcount;\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<?php echo $html; ?>\n<a href=list.php>\u63b2\u793a\u677f\u306b\u623b\u308b</a>\n</body>\n</html>\n\n\n\nlink.php\n// \u30a2\u30f3\u30ab\u30fc\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u304d\u306b\u305d\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5225\u30da\u30fc\u30b8\u306b\u8868\u793a\n<?php\nif (isset($_GET[\"dbname\"]) && isset($_GET[\"num\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"]);\n  $num = htmlspecialchars($_GET[\"num\"]);\n  $num = substr($num, 8);\n  $name = \"sqlite:db/\".$dbname.\".db\";\n  $db = new PDO($name);\n  $stmt = $db->query(\"SELECT * FROM bbs WHERE id=$num\");\n  $html = \"\";\n  while ($row = $stmt->fetch()) {\n    $html .= $row[\"id\"].\":\".$row[\"hiduke\"].\"<br>\".$row[\"comment\"];\n  }\n  $db = null;\n}\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<?php echo $html; ?>\n</body>\n</html>\n\n\n\nbuild.php\n// \u63b2\u793a\u677f\u306e\u8ffd\u52a0\u51e6\u7406\n<?php\nif (isset($_POST[\"newbbs\"])) {\n  $newdbname = htmlspecialchars($_POST[\"newdbname\"], ENT_QUOTES);\n  $newdbnamekana = htmlspecialchars($_POST[\"newdbnamekana\"], ENT_QUOTES);\n  $db = new PDO(\"sqlite:db/list.db\");\n  $db->exec(\"INSERT INTO list (dbname, dbnamekana) VALUES ('$newdbname', '$newdbnamekana')\");\n  $name = \"db/\".$newdbname.\".db\";\n  $db = new SQLite3($name);\n  $db->exec(\"CREATE TABLE bbs (id INTEGER PRIMARY KEY, hiduke TEXT, comment TEXT)\");\n  $db = null;\n  echo \"\u65b0\u3057\u3044\u63b2\u793a\u677f\u300c\".$newdbnamekana.\"\u300d\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002<br><br>\";\n  echo \"<a href='list.php'>\u63b2\u793a\u677f\u3078\u623b\u308b</a>\";\n}\n?>\n\n\n\ndel.php\n// \u63b2\u793a\u677f\u306e\u524a\u9664\u51e6\u7406\n<?php\nif (isset($_GET[\"dbname\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"], ENT_QUOTES);\n  $db = new PDO(\"sqlite:db/list.db\");\n  $db->exec(\"DELETE FROM list WHERE dbname='$dbname'\");\n  $name = \"db/\".$dbname.\".db\";\n  // \u30d5\u30a1\u30a4\u30eb\u3054\u3068\u306b\u30b9\u30ec\u304c\u3042\u308b\u306e\u3067\u30d5\u30a1\u30a4\u30eb\u3054\u3068\u6d88\u305b\u3070\u3044\u3044\n  unlink($name);\n  echo \"\u524a\u9664\u3057\u307e\u3057\u305f\u3002<br><br>\";\n  echo \"<a href='list.php'>\u63b2\u793a\u677f\u3078\u623b\u308b</a>\";\n}\n?>\n\n\n\nstyle.css\nbody {\n  // background-color: #D3D3D3;\n  background-color: #F5F5F5;\n}\n\n#comment {\n  margin-left: 35px;\n}\n\n\n\n\u6700\u5f8c\u306b\n\u3044\u308d\u3044\u308d\u3068\u8aac\u660e\u304c\u4e0b\u624b\u304f\u305d\u3067\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u3002\u3088\u308a\u672c\u683c\u7684\u306b\u4f5c\u308b\u305f\u3081\u306b\u306f\u30af\u30c3\u30ad\u30fc\u3084\u30bb\u30c3\u30b7\u30e7\u30f3\u3001\u6b63\u898f\u8868\u73fe\u306a\u3069\u3092\u99c6\u4f7f\u3057\u3066\u3042\u308b\u7a0b\u5ea6\u306e\u8352\u3089\u3057\u5bfe\u7b56\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u304f\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u74b0\u5883\nCentOS 6.5\nApache 2.2.15\nphp 5.5.19\nsqlite3 3.6.20\n\n# \u69cb\u6210\n- db\u30d5\u30a1\u30a4\u30eb\u306fdb\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u3063\u3066\u305d\u3053\u306b\u5165\u308c\u3066\u304a\u304f\n-- \u5404\u63b2\u793a\u677f\u60c5\u5831\u3092\u7ba1\u7406\u3059\u308bdb(list.db)\n-- \u3061\u306a\u307f\u306b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u6ce8\u610f\u3002db\u30d5\u30a9\u30eb\u30c0\u306f777,db\u30d5\u30a1\u30a4\u30eb\u306f\u305f\u3057\u304b755or766)\n\n- php\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n-- \u63b2\u793a\u677f\u30ea\u30b9\u30c8\u3092\u8868\u793a\u3059\u308b(list.php)\n-- \u5404\u63b2\u793a\u677f(bbs.php)\n-- \u30a2\u30f3\u30ab\u30fc\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u304d\u306e\u51e6\u7406(link.php)\n-- \u65b0\u898f\u6295\u7a3f\u51e6\u7406\u3001\u7d50\u679c(ins.php)\n-- \u63b2\u793a\u677f\u8ffd\u52a0\u51e6\u7406(build.php)\n-- \u63b2\u793a\u677f\u524a\u9664\u51e6\u7406\u3001\u7d50\u679c(del.php)\n\n\n# \u4e88\u3081\u6e96\u5099\u3059\u308bDB\u306e\u5185\u5bb9\n```list.db\nCREATE TABLE list (\nid INTEGER PRIMARY KEY, \ndbname TEXT, \ndbnamekana TEXT, \nkensu INTEGER, \nupdtime TEXT DEFAULT (DATETIME('now', '+09:00:00')), \nflg INTEGER DEFAULT 0\n);\n\n// \u5177\u4f53\u7684\u306a\u5404\u63b2\u793a\u677f\u306eDB\u306f\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u306e\u3067\u4e88\u3081\u7528\u610f\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\n// dbname\u306f\u63b2\u793a\u677f\u751f\u6210\u6642\u306b\u81ea\u52d5\u7684\u306bbbs1,bbs2\u30fb\u30fb\u30fb\u3068\u540d\u4ed8\u3051\u3055\u308c\u308b\n// kensu\u306f\u5404\u63b2\u793a\u677f\u306b\u6295\u7a3f\u3055\u308c\u3066\u3044\u308b\u6295\u7a3f\u4ef6\u6570\u306e\u3053\u3068\n// updtime\u306f\u63b2\u793a\u677f\u66f4\u65b0\u65e5\u6642\u3067\u3001\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u3068\u304d\u306b\u3053\u306e\u9806\u756a\u3067\u4e26\u3079\u308b\n// flg\uff08\u30d5\u30e9\u30b0\uff09\u306f\u5c06\u6765\u7684\u306b\u904e\u53bb\u30b9\u30ec\u884c\u304d\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u4f7f\u3046\u3068\u304b\u3067\u3059\u3002\n\n```\n# \u5177\u4f53\u7684\u306a\u30b3\u30fc\u30c9\n\n```list.php\n<?php\n$db = new PDO(\"sqlite:db/list.db\");\n\n// \u63b2\u793a\u677f\u306e\u6570\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\n$stmt = $db->query(\"SELECT COUNT(*) FROM list\");\n$listcount = $stmt->fetchColumn();\n$stmt->closeCursor();\n\n$i = 1;\n$html = \"\";\n\n// \u63b2\u793a\u677f\u304c1\u3064\u4ee5\u4e0a\u5b58\u5728\u3059\u308c\u3070\u30ea\u30b9\u30c8\u3092\u30ea\u30f3\u30af\u4ed8\u304d\u3067\u8868\u793a\u3059\u308b\nif ($listcount > 0) {\n  // \u65b0\u898f\u6295\u7a3f\u304c\u3042\u3063\u305f\u9806\u306b\u4e26\u3079\u308b\n  $stmt = $db->query(\"SELECT * FROM list WHERE flg=0 ORDER BY updtime DESC\");\n  $list = $stmt->fetchAll(PDO::FETCH_ASSOC);\n  foreach ($list as $row) {\n    $html .= \"<a href='bbs.php?dbname={$row[\"dbname\"]}&dbnamekana={$row[\"dbnamekana\"]}'>\".$i.\":\".$row[\"dbnamekana\"].\" (\".$row['kensu'].\") \".$row['updtime'].\"</a>\".\" <a href='del.php?dbname={$row[\"dbname\"]}'>\u524a\u9664\u3059\u308b</a><br><br>\";\n  $i++;\n  }\n}\n$db = null;\n\n// \u63b2\u793a\u677f\u306e\u6570\u304c10\u672a\u6e80\u3067\u3042\u308c\u3070\u65b0\u30b9\u30ec\u4f5c\u6210\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3059\u308b\u3002\nif ($listcount < 10) {\n  $listcount++;\n  $newdbname = \"bbs\".$listcount;\n  $build = <<< EOM\n  <form action=\"build.php\" method=\"post\">\n  <input type=\"hidden\" name=\"newdbname\" value=\"{$newdbname}\">\n  \u540d\u79f0\uff1a<input type=\"text\" name=\"newdbnamekana\" value=\"\">\n  <input type=\"submit\" name=\"newbbs\" value=\"\u65b0\u3057\u304f\u63b2\u793a\u677f\u3092\u7acb\u3066\u308b\uff08\u5236\u965010\u500b\uff09\">\n  </form>\nEOM;\n} else {\n  $build = \"\u3053\u308c\u4ee5\u4e0a\u63b2\u793a\u677f\u306f\u7acb\u3066\u3089\u308c\u307e\u305b\u3093\u3002\";\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meata charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<h2 style=\"color:#ff0000;\">\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</h1>\n<?php echo $html; ?>\n<?php echo $build; ?>\n</body>\n</html>\n```\n\n```bbs.php\n<?php\nif (isset($_GET[\"dbname\"]) && isset($_GET[\"dbnamekana\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"], ENT_QUOTES);\n  $dbnamekana = htmlspecialchars($_GET[\"dbnamekana\"], ENT_QUOTES);\n  if (isset($_GET[\"page\"])) {\n    $page = htmlspecialchars($_GET[\"page\"], ENT_QUOTES);\n  } else {\n    $page = \"\";\n  }\n} else {\n  header(\"Location: list.php\");\n}\n\n// \u30da\u30fc\u30b8\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u53d6\u5f97\u3001\u8a2d\u5b9a\n$name = \"sqlite:db/\".$dbname.\".db\";\n$db = new PDO($name);\n$stmt = $db->query(\"SELECT COUNT(*) FROM bbs\");\n$kensu = $stmt->fetchColumn(); // \u7dcf\u4ef6\u6570\n$hyouji = 3; // 1\u30da\u30fc\u30b8\u3042\u305f\u308a\u8868\u793a\u4ef6\u6570\n$pcount = ceil($kensu/$hyouji); // \u7dcf\u30da\u30fc\u30b8\u6570\n$plast = $kensu % $hyouji; // \u6700\u7d42\u30da\u30fc\u30b8\u306e\u4ef6\u6570\nif ($page == \"\") {\n  $page = $pcount;\n}\n\n// \u30da\u30fc\u30b8\u79fb\u52d5\u30ea\u30f3\u30af\n$link = \"\";\nfor ($i=1; $i<=$pcount; $i++) {\n  $link .= \"<a href=bbs.php?dbname=\".$dbname.\"&dbnamekana=\".$dbnamekana.\"&page=\".$i.\">\".$i.\"</a>&nbsp;&nbsp;\";\n}\n\n// \u30da\u30fc\u30b8\u8868\u793a\n$stmt = $db->query(\"SELECT * FROM bbs LIMIT ($page-1)*$hyouji, $hyouji\");\n$html = \"<h2 style='color:#ff0000;'>\".$dbnamekana.\"</h2>\";\n$list = $stmt->fetchAll(PDO::FETCH_ASSOC);\nforeach ($list as $row) {\n  $html .= $row[\"id\"].\" : \".$row[\"hiduke\"].\"<br>\";\n  $html .= \"<div id='commnet'>\".$row[\"comment\"].\"</div><br><br>\";\n}\n\n// \u30b3\u30e1\u30f3\u30c8\u306b\u30a2\u30f3\u30ab\u30fc\u304c\u3042\u308c\u3070\u30a2\u30f3\u30ab\u30fc\u306b\u5909\u63db\u3059\u308b\n$html = anchor($dbname, $html);\n$db = null;\n\n// \u7dcf\u4ef6\u6570\u304c10\u4ef6\u672a\u6e80\u3067\u3042\u308c\u3070\u6295\u7a3f\u753b\u9762\u3092\u8868\u793a\u3059\u308b\nif ($kensu < 10) {\n  $form = <<< EOM\n  <form action=\"ins.php\" method=\"post\">\n  <input type=\"hidden\" name=\"dbname\" value=\"{$dbname}\">\n  \u6295\u7a3f\u5185\u5bb9:<br>\n  <textarea name=\"comment\" cols=100 rows=10></textarea><br>\n  <input type=\"submit\" name=\"ins\" value=\"\u9001\u4fe1\">\n  </form>\n  <br>\nEOM;\n} else {\n  $form = \"10\u4ef6\u4ee5\u4e0a\u306f\u66f8\u304d\u8fbc\u3081\u307e\u305b\u3093\u3002<br><br>\";\n}\n\n// \u30b3\u30e1\u30f3\u30c8\u4e2d\u306b\u30a2\u30f3\u30ab\u30fc\u304c\u3042\u308c\u3070\u30a2\u30f3\u30ab\u30fc\u30ea\u30f3\u30af\u3092\u4ed8\u4e0e\u3059\u308b\nfunction anchor($dbname, $comment) {\n  $pattern = \"/&gt;&gt;([0-9])+/\";\n  $replace = '<a href=\"link.php?dbname='.$dbname.'&num=$0\">$0</a>';\n  $comment = preg_replace($pattern, $replace, $comment);\n  return $comment;\n}\n\n?>\n\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title><?php echo $dbnamekana; ?></title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</haed>\n<body>\n<?php echo $html; ?>\n<?php echo $form; ?>\n<?php echo $link; ?>\n<br><br>\n<a href=\"list.php\">\u63b2\u793a\u677f\u306b\u623b\u308b</a>\n</body>\n</html>\n```\n\n```ins.php\n<?php\n// \u6295\u7a3f\u65e5\u6642\u7b49\u3092\u53d6\u5f97\u3059\u308b\n$w = date(\"w\");\n$week_name = [\"\u65e5\", \"\u6708\", \"\u706b\", \"\u6c34\", \"\u6728\", \"\u91d1\", \"\u571f\"];\n$hiduke = date(\"Y-m-d H:i:s\").\"(\".$week_name[$w].\")\";\n\n$html = \"\";\n\n// \u30c7\u30fc\u30bf\u53d7\u53d6\u3001\u5909\u63db\u51e6\u7406\nif (isset($_POST[\"ins\"])) {\n  $dbname = htmlspecialchars($_POST[\"dbname\"], ENT_QUOTES);\n  $comment = nl2br(htmlspecialchars($_POST[\"comment\"], ENT_QUOTES));\n  $comment = anchor($comment);\n\n\u3000// \u8efd\u304f\u5236\u9650\u304b\u3051\u3066\u307f\u305f\n  if (check_br($comment) > 10) {\n    $html .= \"\u6539\u884c\u304c\u591a\u904e\u304e\u307e\u3059\u300210\u884c\u4ee5\u5185\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002<br><br>\";\n  } else if (check_strcount($comment) > 100) {\n    $html .= \"\u6587\u5b57\u6570\u304c\u591a\u904e\u304e\u307e\u3059\u3002100\u6587\u5b57\u4ee5\u5185\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002<br><br>\";\n  } else {\n\u3000\u3000\n\u3000\u3000// \u6295\u7a3f\u51e6\u7406\n    $name = \"sqlite:db/\".$dbname.\".db\";\n    $db = new PDO($name);\n    $db->exec(\"INSERT INTO bbs (hiduke, comment) VALUES ('$hiduke', '$comment')\");\n\n\u3000\u3000// \u4ef6\u6570\u3092\u53d6\u5f97\u3057\u76f4\u3059\n    $stmt = $db->query(\"SELECT COUNT(*) FROM bbs\");\n    $kensu = $stmt->fetchColumn();\n    \n\u3000\u3000// list.db\u306e\u4ef6\u6570\u3001\u66f4\u65b0\u65e5\u6642\u3092\u66f4\u65b0\u3057\u3066\u304a\u304f\uff08\u3053\u308c\u3067\u63b2\u793a\u677f\u30ea\u30b9\u30c8\u753b\u9762\u3067\u4e00\u756a\u4e0a\u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\uff09\n\u3000\u3000$db = new PDO(\"sqlite:db/list.db\");\n\u3000\u3000$db->exec(\"UPDATE list SET kensu=$kensu, updtime=(SELECT datetime('now', '+09:00:00')) WHERE dbn\name='$dbname'\");\n    $db = null;\n    $html .= \"\u6295\u7a3f\u3057\u307e\u3057\u305f\u3002<br><br>\";\n  }\n} else {\n  header(\"Location: list.php\");\n}\n\n// \u30a2\u30f3\u30ab\u30fc\u3092\u30ea\u30f3\u30af\u4ed8\u304d\u306b\u5909\u63db\u3059\u308b\nfunction anchor($comment) {\n  $pattern = \"/>>([0-9])+/\";\n  $replace = '<a href=\"link.php?num=$0\">$0</a>';\n  $comment = preg_replace($pattern, $replace, $comment);\n  return $comment;\n}\n\n// \u6539\u884c\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\nfunction check_br($comment) {\n  $brcount = mb_substr_count($comment, \"<br />\");\n  return $brcount;\n}\n\n// \u6587\u5b57\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3059\u308b\nfunction check_strcount($comment) {\n  $strcount = strlen($comment);\n  return $strcount;\n}\n\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<?php echo $html; ?>\n<a href=list.php>\u63b2\u793a\u677f\u306b\u623b\u308b</a>\n</body>\n</html>\n```\n\n\n```link.php\n// \u30a2\u30f3\u30ab\u30fc\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3068\u304d\u306b\u305d\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5225\u30da\u30fc\u30b8\u306b\u8868\u793a\n<?php\nif (isset($_GET[\"dbname\"]) && isset($_GET[\"num\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"]);\n  $num = htmlspecialchars($_GET[\"num\"]);\n  $num = substr($num, 8);\n  $name = \"sqlite:db/\".$dbname.\".db\";\n  $db = new PDO($name);\n  $stmt = $db->query(\"SELECT * FROM bbs WHERE id=$num\");\n  $html = \"\";\n  while ($row = $stmt->fetch()) {\n    $html .= $row[\"id\"].\":\".$row[\"hiduke\"].\"<br>\".$row[\"comment\"];\n  }\n  $db = null;\n}\n?>\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<title>\u30b5\u30f3\u30d7\u30eb\u63b2\u793a\u677f</title>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"initial-scale=1.0\">\n<link rel=\"stylesheet\" href=\"style.css\" media=\"all\">\n</head>\n<body>\n<?php echo $html; ?>\n</body>\n</html>\n```\n```build.php\n// \u63b2\u793a\u677f\u306e\u8ffd\u52a0\u51e6\u7406\n<?php\nif (isset($_POST[\"newbbs\"])) {\n  $newdbname = htmlspecialchars($_POST[\"newdbname\"], ENT_QUOTES);\n  $newdbnamekana = htmlspecialchars($_POST[\"newdbnamekana\"], ENT_QUOTES);\n  $db = new PDO(\"sqlite:db/list.db\");\n  $db->exec(\"INSERT INTO list (dbname, dbnamekana) VALUES ('$newdbname', '$newdbnamekana')\");\n  $name = \"db/\".$newdbname.\".db\";\n  $db = new SQLite3($name);\n  $db->exec(\"CREATE TABLE bbs (id INTEGER PRIMARY KEY, hiduke TEXT, comment TEXT)\");\n  $db = null;\n  echo \"\u65b0\u3057\u3044\u63b2\u793a\u677f\u300c\".$newdbnamekana.\"\u300d\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002<br><br>\";\n  echo \"<a href='list.php'>\u63b2\u793a\u677f\u3078\u623b\u308b</a>\";\n}\n?>\n```\n\n```del.php\n// \u63b2\u793a\u677f\u306e\u524a\u9664\u51e6\u7406\n<?php\nif (isset($_GET[\"dbname\"])) {\n  $dbname = htmlspecialchars($_GET[\"dbname\"], ENT_QUOTES);\n  $db = new PDO(\"sqlite:db/list.db\");\n  $db->exec(\"DELETE FROM list WHERE dbname='$dbname'\");\n  $name = \"db/\".$dbname.\".db\";\n  // \u30d5\u30a1\u30a4\u30eb\u3054\u3068\u306b\u30b9\u30ec\u304c\u3042\u308b\u306e\u3067\u30d5\u30a1\u30a4\u30eb\u3054\u3068\u6d88\u305b\u3070\u3044\u3044\n  unlink($name);\n  echo \"\u524a\u9664\u3057\u307e\u3057\u305f\u3002<br><br>\";\n  echo \"<a href='list.php'>\u63b2\u793a\u677f\u3078\u623b\u308b</a>\";\n}\n?>\n```\n```style.css\nbody {\n  // background-color: #D3D3D3;\n  background-color: #F5F5F5;\n}\n\n#comment {\n  margin-left: 35px;\n}\n```\n\n# \u6700\u5f8c\u306b\n\u3044\u308d\u3044\u308d\u3068\u8aac\u660e\u304c\u4e0b\u624b\u304f\u305d\u3067\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u3002\u3088\u308a\u672c\u683c\u7684\u306b\u4f5c\u308b\u305f\u3081\u306b\u306f\u30af\u30c3\u30ad\u30fc\u3084\u30bb\u30c3\u30b7\u30e7\u30f3\u3001\u6b63\u898f\u8868\u73fe\u306a\u3069\u3092\u99c6\u4f7f\u3057\u3066\u3042\u308b\u7a0b\u5ea6\u306e\u8352\u3089\u3057\u5bfe\u7b56\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u304f\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["PHP", "SQLite3", "\u63b2\u793a\u677f"]}