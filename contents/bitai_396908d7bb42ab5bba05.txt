{"context": " More than 1 year has passed since last update.\u524d\u56de\uff1a\u3010\u5165\u9580\u5411\u3051\u3011Node.js + Express4 + MongoDB + Vagrant + forever\u3067ChatWork\u3068\u9023\u52d5\u3059\u308bCRUD\u30a2\u30d7\u30ea\u3092\u958b\u767a\u3059\u308b\u3002(\uff12)\uff08\u74b0\u5883\u7de8\uff09\n\nMVC\u30d1\u30bf\u30fc\u30f3\u3092\u69cb\u6210\u3059\u308b\u3002\n\u3053\u3053\u304b\u3089\u306fExpress4\u306eMVC\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u5192\u982d\u306e\u8aac\u660e\u306e\u901a\u308a\u3001Controller\u3068View\u306f\u305d\u308c\u305e\u308croutes\u3068views\u304c\u62c5\u5f53\u3057\u3001Model\u306f\u958b\u767a\u8005\u304c\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nView\n\u307e\u305a\u306f\u4e00\u756a\u7c21\u5358\u306aView\u3067\u3059\u3002views\u30d5\u30a9\u30eb\u30c0\u76f4\u4e0b\u306eindex.ejs\u3092\u898b\u308b\u3068\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nviews/index.ejs\n<!DOCTYPE html>\n<html>\n<head>\n  <title><%= title %></title>\n  <link rel='stylesheet' href='/stylesheets/style.css' />\n</head>\n<body>\n  <h1><%= title %></h1>\n  <p>Welcome to <%= title %></p>\n</body>\n</html>\n\n\nstylesheet\u306e\u30ea\u30f3\u30af\u306fpublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306estylesheets/style.css\u3092\u6307\u3057\u307e\u3059\u3002\u4ed6\u306btitle\u3068\u3044\u3046\u5909\u6570\u306e\u5f0f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5f93\u6765\u306eMVC\u540c\u69d8\u3001Controller\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u5909\u6570\u3067\u3059\u3002\n\u52d8\u6240\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3067\u3001node.js\u3067\u306f\u591a\u304f\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u304b\u3089\u81ea\u5206\u304c\u597d\u304d\u306a\u66f8\u5f0f\u3092\u9078\u3076\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306e\u7a2e\u985e\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306e\u901f\u5ea6\u306b\u5dee\u304c\u3042\u308a\u3001node-bench\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nnode-bench\u3067js\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u3068\u3063\u3066\u307f\u305f\n\u4f7f\u3048\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306f\n\nejs\nect\njade(express\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3)\necho\ncoffeekup\nhaml-js\n\n\u306a\u3069\u3002\u5909\u66f4\u3057\u305f\u3051\u308c\u3070npm install {template\u30a8\u30f3\u30b8\u30f3\u540d}\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5f8c\u3001app.js\u3092\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\napp.js\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'ejs');//ejs\u3092\u5909\u3048\u308b\n\n\n\nController\nroutes/index.js\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nroutes/index.js\n var express = require('express');\n\n var router = express.Router();\n\n /* GET home page. */\n router.get('/', function(req, res) {\n   res.render('index', { title: 'Express' });\n });\n\n module.exports = router;\n\n\nGET\u30e1\u30bd\u30c3\u30c9\u3067http://<\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8>:3000/\u306b\u30a2\u30af\u30bb\u30b9\u304c\u3042\u308c\u3070\u3001res.render('index', { title: 'Express' });\u3001\u3064\u307e\u308aindex\u3068\u3044\u3046View\u3092title\u3068\u3044\u3046\u5909\u6570\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u3068\u3044\u3046\u610f\u5473\u306b\u306a\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300c/edit, /view, /delete\u300d\u306a\u3069\u3067\u6240\u5b9a\u306e\u52d5\u4f5c\u3092\u5b9f\u73fe\u3057\u305f\u3051\u308c\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nroutes/index.js\n /* edit (GET) */\n router.get(\u2018/view', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018view', { title: 'Express' }); //view.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n\n /* edit  (POST) */\n router.post(\u2018/edit', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018index', { title: 'Express' }); //index.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n\n /* delete (POST) */\n router.get(\u2018/delete', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018index', { title: 'Express' }); //index.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n\n\n\u3053\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u305f\u3089\u3001\u5fd8\u308c\u3066\u306a\u3089\u306a\u3044\u306e\u306fapp.js\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u8ffd\u8a18\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\nroutes/index.js\napp.js\napp.use('/', routes);\napp.use(\u2018/edit', routes);\napp.use(\u2018/delete', routes);\n\napp.use('/users', users);\n\n\n\u305f\u3060\u3057\u3001\u3053\u308c\u3060\u3051\u3060\u3068\n/edit/13\n\u306a\u3069\u306e\u3088\u3046\u306b\u30d1\u30b9\u306b\u4f55\u3089\u304b\u306e\u60c5\u5831\u3092\u542b\u307e\u305b\u305f\u6642\u306b\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u305d\u306e\u6642\u306froutes/index.js\u306eapp.get\u30e1\u30bd\u30c3\u30c9\u3092\u4ee5\u4e0b\u306e\u69d8\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\nroutes/index.js\napp.get(\u2018/edit/:id', function(req, res){\n    res.send('user ' + req.params.id);\n});\n\n\n\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a73\u3057\u3044\u5229\u7528\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\nhttp://hideyukisaito.github.io/expressjs-doc_ja/guide/#routing\n\nModel\n\u3044\u3088\u3044\u3088Model\u3067\u3059\u3002\n\u307e\u305a\u306fmongo\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$mongo\n> use testDB\n> exit\nbye\n\ntestDB\u3068\u3044\u3046DB\u304c\u7121\u3051\u308c\u3070\u81ea\u52d5\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u6b21\u306b\u3001mongo\u3092node.js\u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306bmongoose\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nnpm install mongoose\n...\nshell:\n\nmongoose\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089\u3001model\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u30c8\u30c3\u30d7\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b/model\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u3001\u305d\u3053\u306bposts.js\u3092\u4f5c\u6210\u3057\u3001Post\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```shell:\n$vim posts.js\n\n\nmodel/posts.js\nvar mongoose = require('mongoose');\nvar db = mongoose.connect('mongodb://localhost/testDB');\n\nfunction validator(v) {\n    return v.length > 0;\n}\n\nvar Post = new mongoose.Schema({\n  name   : {\n    type: String, validate: [validator, \"Empty Error\"]\n  },\n  price : {\n    type: Number,\n    default: 500\n  },\n  order_user : {\n    type: Array, //user_name\u306e\u914d\u5217\u3092\u683c\u7d0d\n    default: []\n  },\n  created: {\n    type: Date,\n    default: Date.now\n  }\n});\n\nexports.Post = db.model('Post', Post);\n\n\n1,2\u884c\u76ee\u304c\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306b\u3001\uff14\u884c\u76ee\u4ee5\u964d\u304c\u30e2\u30c7\u30eb\u306e\u5b9a\u7fa9\u306b\u8a72\u5f53\u3057\u307e\u3059\u3002\u6700\u5f8c\u306bapp.js\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nmodel/posts.js\n//mongoose\u306e\u8aad\u307f\u8fbc\u307f\n var mongoose = require( 'mongoose' );\n\n//Model\u306e\u8a2d\u5b9a\n var model = require('../model/posts');\n var Post = model.Post;\n\n\n\u62e1\u5f35\u5b50\u304c\u7121\u8996\u3055\u308c\u308b\u306e\u3067../model/posts\u3067../model/posts.js\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u6ce8\u610f\u3057\u3066\u9802\u304d\u305f\u3044\u306e\u304c\u300c./\u300d\u3067\u3001Express\u3067\u306f\u300c./\u300d\u306fapp.js\u304c\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u3057\u307e\u3059\u3002\nCannot find module in Nodejs\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308c\u3070\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306fExpress\u3068Mongoose\u304c\u4e0a\u624b\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002Controller\u3067Model\u3092\u53c2\u7167\u3057\u307e\u3057\u3087\u3046\u3002\u307e\u305a\u306f\u4eee\u30c7\u30fc\u30bf\u3092Mongo\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n$ mongo\n> use testDB\n> db.posts.insert({name:'test1', price: 400})\n> db.posts.insert({name:'test2', price: 500})\n> db.posts.insert({name:'test3', price: 500})\n> exit\n\n\u6b21\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9(routes)\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\nroutes/index.js\nvar model = require('../model/posts');\nvar Post = model.Post;\n\nrouter.get('/view', function(req, res){\n   Post.find({}, function(err, items){\n     res.render('index', { title: '\u30e1\u30cb\u30e5\u30fc\u306e\u8868\u793a', items:items})\n   });\n});\n\n\n\u3053\u308c\u3067items\u306b\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001view\u5074\u3067\u51fa\u529b\u3057\u307e\u3059\u3002\n\nviews/index.ejs\n<ul>\n     <% items.forEach(function(item){ %>\n          <li><%= item.name %>, <%= item.price %> <li>\n     <% }) %>\n</ul>\n\n\n\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ npm start\n\nhttp://192.168.33.17:3000\n\u30ea\u30b9\u30c8\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\nCRUD\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u3002\nMVC\u306e\u6d41\u308c\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u3001\u6b21\u306bMongoose\u3092\u4f7f\u3063\u305fCRUD\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nCreate\nCreate\u306fsave\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u30d5\u30a9\u30fc\u30e0\u306e\u30cd\u30fc\u30e0\u5024\u3068\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u3092\u53c2\u7167\u3057\u3001\u4e00\u81f4\u3057\u3066\u3044\u308c\u3070insert\u3057\u307e\u3059\u3002\nrouter.post('/create', function(req, res) {\n  var newPost = new Post(req.body);\n  newPost.save(function(err){\n    if (err) {\n      console.log(err);\n      res.redirect('back');\n    } else {\n      res.redirect(\u2018/');\n    }\n  })\n})\n\n\nRead\nRead\u306b\u306ffind\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\nrouter.post('/edit', function(req, res){\n  Post.find({}, function(err, items){\n    if (err) {\n       console.log(err);\n       res.redirect('back');\n     } else {\n        res.render(\u2018/\u2018, { title: \u2018\u30bf\u30a4\u30c8\u30eb\u2019, items: items});\n     }\n  });\n});\n\nfind\u30e1\u30bd\u30c3\u30c9\u306f\u7b2c\u4e00\u5f15\u6570\u3067\u691c\u7d22\u6761\u4ef6\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u4f8b\n{_id: 100} => where id = 100 \u3068\u540c\u3058\u610f\u5473\nDate\u578b\u306e\u691c\u7d22\u306e\u5834\u5408\u3001Date\u30af\u30e9\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u4f8b \u4eca\u65e5\u4ee5\u524d\u306e\u65e5\u4ed8\u304c\u6b32\u3057\u3044\u5834\u5408\nvar now = new Date(); //=> \u73fe\u5728\u306e\u6642\u9593\nvar today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); =>\u4eca\u65e5\u306e0:00\nPost.find({created: {$lte: today}}, function(err, items){ //=> lt = littler than, gt = greater than, e\u306fequal.\n     //\u51e6\u7406\n})\n\n\nUpdate\nupdate\u30e1\u30bd\u30c3\u30c9\u306fupdate\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u6ce8\u76ee\u3059\u3079\u304d\u306fupdate\u30e1\u30bd\u30c3\u30c9\u306e\u7b2c\u4e09\u5f15\u6570\u3067\u3001true\u306b\u3057\u3066\u304a\u304f\u3068upsert\uff08\u3042\u308c\u3070update\u3001\u7121\u3051\u308c\u3070insert\uff09\u306b\u306a\u308a\u307e\u3059\u3002\nrouter.post('/edit', function(req, res) {\n    Post.update({ _id: req.param(\"id\") }, { $set: {text: req.param(\"text\"), price: req.param(\"price\")}, false },\n      { upsert: false, multi: false }, function(err) {\n        if (err) {\n          console.log(err);\n          res.redirect('back');\n        } else {\n          res.redirect('/');\n        }\n      }\n    )\n})\n\n\nDelete\n\u6700\u5f8c\u306fremove\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\u3053\u308c\u306f\u7279\u306b\u8aac\u660e\u3057\u307e\u305b\u3093\u3002\nrouter.post('/delete', function(req, res) {\n    Post.remove({ _id: req.param(\"id\") }, function(err) {\n        if (err) {\n          console.log(err);\n          res.redirect('back');\n        } else {\n          res.redirect('/');\n        }\n    })\n})\n\n\nnode-request\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5916\u90e8API\u3092\u53e9\u304f\u3002\n\u5916\u90e8API\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u305f\u304f\u306a\u3063\u305f\u3089node-request\u3092\u4f7f\u3044\u307e\u3059\u3002\n$ npm install request\n\n\u3053\u3053\u3067\u306fChatworkAPI\u3092\u4f7f\u3044\u3001\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306bnode\u304b\u3089Chatwork\u306b\u300c\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3057\u305f\u3002\u300d\u3068\u30c1\u30e3\u30c3\u30c8\u6295\u7a3f\u3057\u307e\u3059\u3002\nvar request = require('request');\nvar room_id = \"------\"\nvar Token = \"-----\"\nvar options = {\n  url: 'https://api.chatwork.com/v1/rooms/' + room_id + 'messages',\n  method: 'POST',\n  headers: {\n  'X-ChatWorkToken': Token\n  },\n  form: {\n    body:messageBody\n  }\n};\nrequest(options, function(error, response, body) {\n     if(!error){\n         console.log(error);\n     }\n})\n\nChatWorkAPI \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttp://developer.chatwork.com/ja/\n\nnode-cron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067cron\u3092\u7a3c\u50cd\u3055\u305b\u308b\u3002\n\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u305f\u6642\u306b\u544a\u77e5\u3059\u308b\u3060\u3051\u3067\u306f\u30a2\u30d7\u30ea\u3068\u3057\u3066\u9762\u767d\u304f\u306a\u3044\u306e\u3067\u3001cron\u3092\u4f7f\u3063\u3066\u5b9a\u671f\u7684\u306bchatwork\u3092\u5de1\u56de\u3057\u3001\u7279\u5b9a\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308c\u3070\u6295\u7a3f\u3059\u308b\u7c21\u5358\u306aBot\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u8a18\u4e8b\u3067\u306f\u7d30\u304b\u304f\u8a00\u53ca\u306f\u3057\u307e\u305b\u3093\u304c\u3001\u3053\u306e\u3088\u3046\u306a\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u6642\u306b\u6d3b\u8e8d\u3059\u308b\u306e\u304c\u3001node\u306ecron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bnode-cron\u3067\u3059\u3002\nvar job = new myCron(\n  '* * 9-20 * * *', //\u4e00\u822c\u7684\u306acron\u306e\u66f8\u5f0f\n  function(){\n     //\u6210\u529f\u3057\u305f\u3068\u304d\u306e\u51e6\u7406\n  },\n  function(){\n     //This function is executed when the job stops\n  },\n  false, //new\u5ba3\u8a00\u3057\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\n  'Asia/Tokyo' //time zone\n);\njob.start();\n\n\u7b2c5\u5f15\u6570\u306etime zone\u306fnode-time\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u7121\u3051\u308c\u3070\u4f7f\u3048\u307e\u305b\u3093\u3002\u306a\u306e\u3067node-cron\u3067TimeZone\u3092\u8a2d\u7f6e\u3059\u308b\u3068\u304d\u306fnpm install\u3092\u5fd8\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\nforever\u3067\u30d7\u30ed\u30bb\u30b9\u306e\u30c7\u30fc\u30e2\u30f3\u5316\n\u6700\u5f8c\u306b\u3001forever\u306b\u3088\u308b\u30c7\u30fc\u30e2\u30f3\u7ba1\u7406\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\u30c7\u30fc\u30e2\u30f3\u3068\u306f\u30d7\u30ed\u30bb\u30b9\u3092\u76e3\u8996\u3057\u3001\u5909\u66f4\u3084\u30c8\u30e9\u30d6\u30eb\u304c\u3042\u308c\u3070\u81ea\u52d5\u3067\u518d\u8d77\u52d5\u306a\u3069\u3092\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6307\u3057\u307e\u3059\u3002\nnode.js\u3092\u4f7f\u3046\u969b\u3001\u826f\u304f\u4f7f\u308f\u308c\u308b\u306e\u304cforever\u3068\u3044\u3046\u30c4\u30fc\u30eb\u3067\u3059\u3002\u5148\u306e\u958b\u767a\u74b0\u5883\u6e96\u5099\u3067forever\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306a\u306e\u3067\u3001\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30d1\u30b9\u306b\u884c\u3063\u305f\u3089forever\u3067npm start\u3092\u76e3\u8996\u3055\u305b\u307e\u3059\u3002npm start\u306fpackage.json\u3092\u898b\u308b\u3068node ./bin/www\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n$ forever start  ./bin/www\nwarn:    --minUptime not set. Defaulting to: 1000ms\nwarn:    --spinSleepTime not set. Your script will exit if it does not stay up for at least 1000ms\ninfo:    Forever processing file: ./bin/www\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u51fa\u308c\u3070\u6210\u529f\u3067\u3059\u3002\nhttp://(-IPaddress-):3000/\n\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u7d42\u308f\u308a\u306b\n\u4eca\u56de\u306fExpress\u3092\u7528\u3044\u3066\u7c21\u6613\u7684\u306aCRUD\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306eExpress\u3060\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u5c11\u3057\u9762\u5012\u306aMVC\u306b\u306a\u308a\u307e\u3059\u304c\u3001Yeomon\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3048\u3070\u30b9\u30ab\u30d5\u30a9\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u304c\u3088\u308a\u53b3\u5bc6\u306b\u306a\u308a\u3001\u3088\u308a\u76f4\u611f\u7684\u306a\u8a18\u8ff0\u3067MVC\u30d1\u30bf\u30fc\u30f3\u3067\u306e\u30a2\u30d7\u30ea\u69cb\u7bc9\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u6b21\u56de\u4ee5\u964d\u3001\u6a5f\u4f1a\u304c\u3042\u308c\u3070\u6271\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u5b9c\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002(_ _)\n\ngithub\n\u4eca\u56de\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u306fgithub\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3082\u3057\u8208\u5473\u304c\u3042\u308c\u3070\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\nGithub\nhttps://github.com/uluru/bentoo\n\u524d\u56de\uff1a[\u3010\u5165\u9580\u5411\u3051\u3011Node.js + Express4 + MongoDB + Vagrant + forever\u3067ChatWork\u3068\u9023\u52d5\u3059\u308bCRUD\u30a2\u30d7\u30ea\u3092\u958b\u767a\u3059\u308b\u3002(\uff12)\uff08\u74b0\u5883\u7de8\uff09](http://qiita.com/bitai/items/26e63ddab3c44b5920e1)\n\n##MVC\u30d1\u30bf\u30fc\u30f3\u3092\u69cb\u6210\u3059\u308b\u3002\n\n\u3053\u3053\u304b\u3089\u306fExpress4\u306eMVC\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u5192\u982d\u306e\u8aac\u660e\u306e\u901a\u308a\u3001Controller\u3068View\u306f\u305d\u308c\u305e\u308croutes\u3068views\u304c\u62c5\u5f53\u3057\u3001Model\u306f\u958b\u767a\u8005\u304c\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n### View\n\u307e\u305a\u306f\u4e00\u756a\u7c21\u5358\u306aView\u3067\u3059\u3002views\u30d5\u30a9\u30eb\u30c0\u76f4\u4e0b\u306eindex.ejs\u3092\u898b\u308b\u3068\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```html:views/index.ejs\n<!DOCTYPE html>\n<html>\n<head>\n  <title><%= title %></title>\n  <link rel='stylesheet' href='/stylesheets/style.css' />\n</head>\n<body>\n  <h1><%= title %></h1>\n  <p>Welcome to <%= title %></p>\n</body>\n</html>\n```\n\nstylesheet\u306e\u30ea\u30f3\u30af\u306fpublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306estylesheets/style.css\u3092\u6307\u3057\u307e\u3059\u3002\u4ed6\u306btitle\u3068\u3044\u3046\u5909\u6570\u306e\u5f0f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u5f93\u6765\u306eMVC\u540c\u69d8\u3001Controller\u304b\u3089\u53d7\u3051\u53d6\u3063\u305f\u5909\u6570\u3067\u3059\u3002\n\n\u52d8\u6240\u306f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3067\u3001node.js\u3067\u306f\u591a\u304f\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u304b\u3089\u81ea\u5206\u304c\u597d\u304d\u306a\u66f8\u5f0f\u3092\u9078\u3076\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306e\u7a2e\u985e\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306e\u901f\u5ea6\u306b\u5dee\u304c\u3042\u308a\u3001node-bench\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n[node-bench\u3067js\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u3068\u3063\u3066\u307f\u305f](http://dev.classmethod.jp/server-side/language/node-bench-js-template-engine/)\n\n\u4f7f\u3048\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306f\n\n* ejs\n* ect\n* jade(express\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3)\n* echo\n* coffeekup\n* haml-js\n\n\u306a\u3069\u3002\u5909\u66f4\u3057\u305f\u3051\u308c\u3070npm install {template\u30a8\u30f3\u30b8\u30f3\u540d}\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5f8c\u3001app.js\u3092\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```js:app.js\n// view engine setup\napp.set('views', path.join(__dirname, 'views'));\napp.set('view engine', 'ejs');//ejs\u3092\u5909\u3048\u308b\n```\n\n###Controller\n\nroutes/index.js\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```js:routes/index.js\n var express = require('express');\n\n var router = express.Router();\n\n /* GET home page. */\n router.get('/', function(req, res) {\n   res.render('index', { title: 'Express' });\n });\n\n module.exports = router;\n```\n\nGET\u30e1\u30bd\u30c3\u30c9\u3067http://<\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8>:3000/\u306b\u30a2\u30af\u30bb\u30b9\u304c\u3042\u308c\u3070\u3001res.render('index', { title: 'Express' });\u3001\u3064\u307e\u308aindex\u3068\u3044\u3046View\u3092title\u3068\u3044\u3046\u5909\u6570\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u3068\u3044\u3046\u610f\u5473\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u300c/edit, /view, /delete\u300d\u306a\u3069\u3067\u6240\u5b9a\u306e\u52d5\u4f5c\u3092\u5b9f\u73fe\u3057\u305f\u3051\u308c\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```js:routes/index.js\n /* edit (GET) */\n router.get(\u2018/view', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018view', { title: 'Express' }); //view.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n\n /* edit  (POST) */\n router.post(\u2018/edit', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018index', { title: 'Express' }); //index.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n\n /* delete (POST) */\n router.get(\u2018/delete', function(req, res) {\n   //\u4f55\u304b\u306e\u51e6\u7406\n   res.render(\u2018index', { title: 'Express' }); //index.ejs\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n });\n```\n\n\u3053\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u305f\u3089\u3001\u5fd8\u308c\u3066\u306a\u3089\u306a\u3044\u306e\u306fapp.js\u306b\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u8ffd\u8a18\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\n```js:routes/index.js\napp.js\napp.use('/', routes);\napp.use(\u2018/edit', routes);\napp.use(\u2018/delete', routes);\n\napp.use('/users', users);\n```\n\n\u305f\u3060\u3057\u3001\u3053\u308c\u3060\u3051\u3060\u3068\n\n/edit/13\n\n\u306a\u3069\u306e\u3088\u3046\u306b\u30d1\u30b9\u306b\u4f55\u3089\u304b\u306e\u60c5\u5831\u3092\u542b\u307e\u305b\u305f\u6642\u306b\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u305d\u306e\u6642\u306froutes/index.js\u306eapp.get\u30e1\u30bd\u30c3\u30c9\u3092\u4ee5\u4e0b\u306e\u69d8\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```js:routes/index.js\napp.get(\u2018/edit/:id', function(req, res){\n    res.send('user ' + req.params.id);\n});\n```\n\n\u6b63\u898f\u8868\u73fe\u3092\u4f7f\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a73\u3057\u3044\u5229\u7528\u65b9\u6cd5\u306f\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\nhttp://hideyukisaito.github.io/expressjs-doc_ja/guide/#routing\n\n###Model\n\n\u3044\u3088\u3044\u3088Model\u3067\u3059\u3002\n\u307e\u305a\u306fmongo\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```shell:\n$mongo\n> use testDB\n> exit\nbye\n```\n\ntestDB\u3068\u3044\u3046DB\u304c\u7121\u3051\u308c\u3070\u81ea\u52d5\u3067\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u6b21\u306b\u3001mongo\u3092node.js\u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306b[mongoose](http://mongoosejs.com/)\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```shell:\nnpm install mongoose\n...\nshell:\n\nmongoose\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u3089\u3001model\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\u30c8\u30c3\u30d7\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b/model\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7528\u610f\u3057\u3001\u305d\u3053\u306bposts.js\u3092\u4f5c\u6210\u3057\u3001Post\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```shell:\n$vim posts.js\n```\n\n```js:model/posts.js\nvar mongoose = require('mongoose');\nvar db = mongoose.connect('mongodb://localhost/testDB');\n\nfunction validator(v) {\n    return v.length > 0;\n}\n\nvar Post = new mongoose.Schema({\n  name   : {\n    type: String, validate: [validator, \"Empty Error\"]\n  },\n  price : {\n    type: Number,\n    default: 500\n  },\n  order_user : {\n    type: Array, //user_name\u306e\u914d\u5217\u3092\u683c\u7d0d\n    default: []\n  },\n  created: {\n    type: Date,\n    default: Date.now\n  }\n});\n\nexports.Post = db.model('Post', Post);\n```\n\n1,2\u884c\u76ee\u304c\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u306b\u3001\uff14\u884c\u76ee\u4ee5\u964d\u304c\u30e2\u30c7\u30eb\u306e\u5b9a\u7fa9\u306b\u8a72\u5f53\u3057\u307e\u3059\u3002\u6700\u5f8c\u306bapp.js\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```js:model/posts.js\n//mongoose\u306e\u8aad\u307f\u8fbc\u307f\n var mongoose = require( 'mongoose' );\n\n//Model\u306e\u8a2d\u5b9a\n var model = require('../model/posts');\n var Post = model.Post;\n```\n\n\u62e1\u5f35\u5b50\u304c\u7121\u8996\u3055\u308c\u308b\u306e\u3067../model/posts\u3067../model/posts.js\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u6ce8\u610f\u3057\u3066\u9802\u304d\u305f\u3044\u306e\u304c\u300c./\u300d\u3067\u3001Express\u3067\u306f\u300c./\u300d\u306fapp.js\u304c\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u3057\u307e\u3059\u3002\n\n[Cannot find module in Nodejs](http://stackoverflow.com/questions/20446514/cannot-find-module-in-nodejs)\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3067\u304d\u308c\u3070\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306fExpress\u3068Mongoose\u304c\u4e0a\u624b\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002Controller\u3067Model\u3092\u53c2\u7167\u3057\u307e\u3057\u3087\u3046\u3002\u307e\u305a\u306f\u4eee\u30c7\u30fc\u30bf\u3092Mongo\u306b\u5165\u529b\u3057\u307e\u3059\u3002\n\n```shell:\n$ mongo\n> use testDB\n> db.posts.insert({name:'test1', price: 400})\n> db.posts.insert({name:'test2', price: 500})\n> db.posts.insert({name:'test3', price: 500})\n> exit\n```\n\n\u6b21\u306b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9(routes)\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```js:routes/index.js\nvar model = require('../model/posts');\nvar Post = model.Post;\n\nrouter.get('/view', function(req, res){\n   Post.find({}, function(err, items){\n     res.render('index', { title: '\u30e1\u30cb\u30e5\u30fc\u306e\u8868\u793a', items:items})\n   });\n});\n```\n\n\u3053\u308c\u3067items\u306b\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001view\u5074\u3067\u51fa\u529b\u3057\u307e\u3059\u3002\n\n```js:views/index.ejs\n<ul>\n     <% items.forEach(function(item){ %>\n          <li><%= item.name %>, <%= item.price %> <li>\n     <% }) %>\n</ul>\n```\n\n\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell:\n$ npm start\n```\n\nhttp://192.168.33.17:3000\n\n\u30ea\u30b9\u30c8\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n##CRUD\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nMVC\u306e\u6d41\u308c\u304c\u5206\u304b\u3063\u305f\u306e\u3067\u3001\u6b21\u306bMongoose\u3092\u4f7f\u3063\u305fCRUD\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n###Create\n\nCreate\u306fsave\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u30d5\u30a9\u30fc\u30e0\u306e\u30cd\u30fc\u30e0\u5024\u3068\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u3092\u53c2\u7167\u3057\u3001\u4e00\u81f4\u3057\u3066\u3044\u308c\u3070insert\u3057\u307e\u3059\u3002\n\n```js:\nrouter.post('/create', function(req, res) {\n  var newPost = new Post(req.body);\n  newPost.save(function(err){\n    if (err) {\n      console.log(err);\n      res.redirect('back');\n    } else {\n      res.redirect(\u2018/');\n    }\n  })\n})\n```\n###Read\nRead\u306b\u306ffind\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```js:\nrouter.post('/edit', function(req, res){\n  Post.find({}, function(err, items){\n    if (err) {\n       console.log(err);\n       res.redirect('back');\n     } else {\n        res.render(\u2018/\u2018, { title: \u2018\u30bf\u30a4\u30c8\u30eb\u2019, items: items});\n     }\n  });\n});\n```\n\nfind\u30e1\u30bd\u30c3\u30c9\u306f\u7b2c\u4e00\u5f15\u6570\u3067\u691c\u7d22\u6761\u4ef6\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n\u4f8b\n{_id: 100} => where id = 100 \u3068\u540c\u3058\u610f\u5473\n\nDate\u578b\u306e\u691c\u7d22\u306e\u5834\u5408\u3001Date\u30af\u30e9\u30b9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u4f8b \u4eca\u65e5\u4ee5\u524d\u306e\u65e5\u4ed8\u304c\u6b32\u3057\u3044\u5834\u5408\n\n```js:\nvar now = new Date(); //=> \u73fe\u5728\u306e\u6642\u9593\nvar today = new Date(now.getFullYear(), now.getMonth(), now.getDate()); =>\u4eca\u65e5\u306e0:00\nPost.find({created: {$lte: today}}, function(err, items){ //=> lt = littler than, gt = greater than, e\u306fequal.\n     //\u51e6\u7406\n})\n```\n\n###Update\nupdate\u30e1\u30bd\u30c3\u30c9\u306fupdate\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u6ce8\u76ee\u3059\u3079\u304d\u306fupdate\u30e1\u30bd\u30c3\u30c9\u306e\u7b2c\u4e09\u5f15\u6570\u3067\u3001true\u306b\u3057\u3066\u304a\u304f\u3068upsert\uff08\u3042\u308c\u3070update\u3001\u7121\u3051\u308c\u3070insert\uff09\u306b\u306a\u308a\u307e\u3059\u3002\n\n```js:\nrouter.post('/edit', function(req, res) {\n    Post.update({ _id: req.param(\"id\") }, { $set: {text: req.param(\"text\"), price: req.param(\"price\")}, false },\n      { upsert: false, multi: false }, function(err) {\n        if (err) {\n          console.log(err);\n          res.redirect('back');\n        } else {\n          res.redirect('/');\n        }\n      }\n    )\n})\n```\n\n###Delete\n\u6700\u5f8c\u306fremove\u30e1\u30bd\u30c3\u30c9\u3067\u3059\u3002\u3053\u308c\u306f\u7279\u306b\u8aac\u660e\u3057\u307e\u305b\u3093\u3002\n\n```js:\nrouter.post('/delete', function(req, res) {\n    Post.remove({ _id: req.param(\"id\") }, function(err) {\n        if (err) {\n          console.log(err);\n          res.redirect('back');\n        } else {\n          res.redirect('/');\n        }\n    })\n})\n```\n\n##node-request\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u5916\u90e8API\u3092\u53e9\u304f\u3002\n\n\u5916\u90e8API\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308a\u305f\u304f\u306a\u3063\u305f\u3089node-request\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```shell:\n$ npm install request\n```\n\n\u3053\u3053\u3067\u306fChatworkAPI\u3092\u4f7f\u3044\u3001\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306bnode\u304b\u3089Chatwork\u306b\u300c\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3057\u305f\u3002\u300d\u3068\u30c1\u30e3\u30c3\u30c8\u6295\u7a3f\u3057\u307e\u3059\u3002\n\n```shell:\nvar request = require('request');\nvar room_id = \"------\"\nvar Token = \"-----\"\nvar options = {\n  url: 'https://api.chatwork.com/v1/rooms/' + room_id + 'messages',\n  method: 'POST',\n  headers: {\n  'X-ChatWorkToken': Token\n  },\n  form: {\n    body:messageBody\n  }\n};\nrequest(options, function(error, response, body) {\n     if(!error){\n         console.log(error);\n     }\n})\n```\n\nChatWorkAPI \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttp://developer.chatwork.com/ja/\n\n##node-cron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067cron\u3092\u7a3c\u50cd\u3055\u305b\u308b\u3002\n\n\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u305f\u6642\u306b\u544a\u77e5\u3059\u308b\u3060\u3051\u3067\u306f\u30a2\u30d7\u30ea\u3068\u3057\u3066\u9762\u767d\u304f\u306a\u3044\u306e\u3067\u3001cron\u3092\u4f7f\u3063\u3066\u5b9a\u671f\u7684\u306bchatwork\u3092\u5de1\u56de\u3057\u3001\u7279\u5b9a\u306e\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308c\u3070\u6295\u7a3f\u3059\u308b\u7c21\u5358\u306aBot\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3053\u3068\u3068\u3057\u307e\u3059\u3002\u3053\u306e\u8a18\u4e8b\u3067\u306f\u7d30\u304b\u304f\u8a00\u53ca\u306f\u3057\u307e\u305b\u3093\u304c\u3001\u3053\u306e\u3088\u3046\u306a\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u6642\u306b\u6d3b\u8e8d\u3059\u308b\u306e\u304c\u3001node\u306ecron\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3042\u308bnode-cron\u3067\u3059\u3002\n\n```shell:\nvar job = new myCron(\n  '* * 9-20 * * *', //\u4e00\u822c\u7684\u306acron\u306e\u66f8\u5f0f\n  function(){\n     //\u6210\u529f\u3057\u305f\u3068\u304d\u306e\u51e6\u7406\n  },\n  function(){\n     //This function is executed when the job stops\n  },\n  false, //new\u5ba3\u8a00\u3057\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u304b\u5426\u304b\n  'Asia/Tokyo' //time zone\n);\njob.start();\n```\n\n\u7b2c5\u5f15\u6570\u306etime zone\u306fnode-time\u3068\u3044\u3046\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u7121\u3051\u308c\u3070\u4f7f\u3048\u307e\u305b\u3093\u3002\u306a\u306e\u3067node-cron\u3067TimeZone\u3092\u8a2d\u7f6e\u3059\u308b\u3068\u304d\u306fnpm install\u3092\u5fd8\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\n##forever\u3067\u30d7\u30ed\u30bb\u30b9\u306e\u30c7\u30fc\u30e2\u30f3\u5316\n\n\u6700\u5f8c\u306b\u3001forever\u306b\u3088\u308b\u30c7\u30fc\u30e2\u30f3\u7ba1\u7406\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\u30c7\u30fc\u30e2\u30f3\u3068\u306f\u30d7\u30ed\u30bb\u30b9\u3092\u76e3\u8996\u3057\u3001\u5909\u66f4\u3084\u30c8\u30e9\u30d6\u30eb\u304c\u3042\u308c\u3070\u81ea\u52d5\u3067\u518d\u8d77\u52d5\u306a\u3069\u3092\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u6307\u3057\u307e\u3059\u3002\n\nnode.js\u3092\u4f7f\u3046\u969b\u3001\u826f\u304f\u4f7f\u308f\u308c\u308b\u306e\u304cforever\u3068\u3044\u3046\u30c4\u30fc\u30eb\u3067\u3059\u3002\u5148\u306e\u958b\u767a\u74b0\u5883\u6e96\u5099\u3067forever\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306a\u306e\u3067\u3001\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30d1\u30b9\u306b\u884c\u3063\u305f\u3089forever\u3067npm start\u3092\u76e3\u8996\u3055\u305b\u307e\u3059\u3002npm start\u306fpackage.json\u3092\u898b\u308b\u3068node ./bin/www\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```shell:\n$ forever start  ./bin/www\nwarn:    --minUptime not set. Defaulting to: 1000ms\nwarn:    --spinSleepTime not set. Your script will exit if it does not stay up for at least 1000ms\ninfo:    Forever processing file: ./bin/www\n```\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u51fa\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\nhttp://(-IPaddress-):3000/\n\n\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n##\u7d42\u308f\u308a\u306b\n\n\u4eca\u56de\u306fExpress\u3092\u7528\u3044\u3066\u7c21\u6613\u7684\u306aCRUD\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306eExpress\u3060\u3068\u4e0a\u8a18\u306e\u3088\u3046\u306b\u5c11\u3057\u9762\u5012\u306aMVC\u306b\u306a\u308a\u307e\u3059\u304c\u3001Yeomon\u3068\u3044\u3046\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3048\u3070\u30b9\u30ab\u30d5\u30a9\u30fc\u30eb\u30c7\u30a3\u30f3\u30b0\u304c\u3088\u308a\u53b3\u5bc6\u306b\u306a\u308a\u3001\u3088\u308a\u76f4\u611f\u7684\u306a\u8a18\u8ff0\u3067MVC\u30d1\u30bf\u30fc\u30f3\u3067\u306e\u30a2\u30d7\u30ea\u69cb\u7bc9\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u6b21\u56de\u4ee5\u964d\u3001\u6a5f\u4f1a\u304c\u3042\u308c\u3070\u6271\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u5b9c\u3057\u304f\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002(_ _)\n\n##github\n\u4eca\u56de\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u306fgithub\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3082\u3057\u8208\u5473\u304c\u3042\u308c\u3070\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nGithub\nhttps://github.com/uluru/bentoo\n", "tags": ["Node.js", "MongoDB", "Express", "vagrant", "chatwork"]}