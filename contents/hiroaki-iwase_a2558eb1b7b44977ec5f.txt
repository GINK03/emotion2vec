{"tags": ["Ruby", "nosql", "Database", "KVS", "roma"], "context": " More than 1 year has passed since last update.\u30b5\u30fc\u30d0\u30a8\u30e9\u30fc\u306a\u3069\u3067instance\u304c\u843d\u3061\u3066\u5197\u9577\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3063\u305f\u6642\u306e\u5bfe\u51e6\u65b9\u6cd5\u3067\u3059\n\n\n\u6761\u4ef6\n\"localhost_10001\", \"localhost_10002\", \"localhost_10003\"\u306e3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7d44\u3093\u3067\u3044\u305f\u6642\u3001\"localhost_10001\"\u304c\u843d\u3061\u3066\u3057\u307e\u3063\u305f\u6642\u3092\u4f8b\u306b\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\n\n\u5197\u9577\u5ea6\u5fa9\u5e30\u624b\u9806(recover)\n\n1. \u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n\u307e\u305a\u306ftelnet\u3067\u751f\u304d\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001\u73fe\u5728\u306estatus\u3092\u78ba\u8a8d\u3057\u307e\u3059\n$ telnet telnet 10002\n> stat node\n.\nrouting.nodes.length 2 #=> 3\u304b\u30892\u3078\nrouting.nodes [\"localhost_10002\", \"localhost_10003\"]  #=> localhost_10001\u304c\u843d\u3061\u3066\u3044\u308b\n.\nrouting.short_vnodes 133 # \u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3057\u305fvnode\u306e\u6570\nrouting.lost_vnodes 0    # \u5197\u9577\u5ea6\u304c0\u306b\u306a\u3063\u305fvnode\u306e\u6570\n.\n.\n\n\nlocalhost_10001\u304c\u843d\u3061\u305f\u305f\u3081\u3001\u3053\u306einstance\u304c\u62c5\u5f53\u3057\u3066\u3044\u305fvnode\u306e\u5197\u9577\u5ea6\u304c\u843d\u3061\u3066\u3044\u307e\u3059\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5197\u9577\u5ea62\u306a\u306e\u30671instance\u843d\u3061\u3066\u3082\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u306f\u554f\u984c\u306a\u304f\u884c\u3048\u307e\u3059\n\n\n\u305f\u3060\u3057\u8a72\u5f53vnode\u306f\u5197\u9577\u5ea61\u306e\u72b6\u614b\n\n\n\n\n2. \u5197\u9577\u5ea6\u56de\u5fa9\n\n\u30b3\u30de\u30f3\u30c9\n> recover\n\n\n\u751f\u304d\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u3001\u5197\u9577\u304c\u843d\u3061\u3066\u3044\u308bvnode\u306e\u62c5\u5f53\u3092\u518d\u30a2\u30b5\u30a4\u30f3\u3001\u53ca\u3073\u30c7\u30fc\u30bf\u306e\u30b3\u30d4\u30fc\u3092\u884c\u3046\u3053\u3068\u3067\u5197\u9577\u5ea6\u306e\u56de\u5fa9\u3092\u884c\u3046\n\u3069\u308c\u304b1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\n\n\n\u5b9f\u884c\n> recover # recover\u5b9f\u884c\n\n> stat run_recover\n  stats.run_recover true # recover\u304c\u5b9f\u884c\u4e2d\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3057\u307e\u3059\n\n> stat short\n  routing.short_vnodes 127 # \u6bb5\u3005\u6e1b\u3063\u3066\u3044\u304d\u307e\u3059\n\n\nrecover\u30d7\u30ed\u30bb\u30b9\u304c\u9032\u3080\u306b\u3064\u308c\u3066\u3001routing.short_vnodes\u306e\u6570\u304c\u6e1b\u3063\u3066\u3044\u304d\u307e\u3059\n\n\n3. \u7d42\u4e86\u78ba\u8a8d\n> stat run_recover\n  stats.run_recover false # recover\u304c\u7d42\u4e86\u3059\u308b\u3068false\u306b\u623b\u308a\u307e\u3059\n\n> stat short\n  routing.short_vnodes 0 # \u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3057\u305fvnode\u304c0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\n\n\nrecover\u30d7\u30ed\u30bb\u30b9\u306b\u304b\u304b\u308b\u6642\u9593\u306f\u3001\u30c7\u30fc\u30bf\u91cf\u3084\u30b5\u30fc\u30d0\u30b9\u30da\u30c3\u30af\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\n\n\nAUTO RECOVER\u6a5f\u80fd\n\u4e0a\u8a18\u3067\u306f\u624b\u52d5\u3067recover\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5197\u9577\u5ea6\u304c\u843d\u3061\u305f\u969b\u306b\u81ea\u52d5\u3067recover\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\n\n\u30b3\u30de\u30f3\u30c9\n> set_auto_recover [ 'true' | 'false' ] <sec>\n\n\ntrue\u3067\u8d77\u52d5\u3001false\u3067\u505c\u6b62\u3057\u307e\u3059\n<sec>\u306f\u3001\u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3092\u691c\u77e5\u3057\u3066\u304b\u3089\u4f55\u79d2\u5f8c\u306brecover\u3092\u5b9f\u884c\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\n\n\n\u7336\u4e88\u671f\u9593\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001recover\u3067\u306f\u306a\u304f\u4ed6\u306e\u5bfe\u51e6\u6cd5\u3092\u3068\u308a\u305f\u304f\u306a\u3063\u305f\u5834\u5408\u306b\u306f\u3001\u3053\u306e\u6642\u9593\u5185\u306bset_auto_recover false\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067recover\u306e\u5b9f\u884c\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\n\n\n\n\n\u53c2\u7167URL\nROMA Recovery redundancy: http://roma-kvs.org/learn/recovery_redundancy.html\nROMA Commands Page: http://roma-kvs.org/commands.html\n\u30b5\u30fc\u30d0\u30a8\u30e9\u30fc\u306a\u3069\u3067instance\u304c\u843d\u3061\u3066\u5197\u9577\u5ea6\u304c\u4f4e\u4e0b\u3057\u3066\u3057\u307e\u3063\u305f\u6642\u306e\u5bfe\u51e6\u65b9\u6cd5\u3067\u3059\n![b363487c-bf8f-e597-9b75-3729a69a9141.png](https://qiita-image-store.s3.amazonaws.com/0/103558/52fafde2-4f5a-4d30-368c-158470d7eab5.png)\n\n# \u6761\u4ef6\n\"<b>localhost_10001</b>\", \"<b>localhost_10002</b>\", \"<b>localhost_10003</b>\"\u306e3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u7d44\u3093\u3067\u3044\u305f\u6642\u3001\"<font color='red'><b>localhost_10001</b></font>\"\u304c\u843d\u3061\u3066\u3057\u307e\u3063\u305f\u6642\u3092\u4f8b\u306b\u3057\u3066\u8aac\u660e\u3057\u307e\u3059\n\n# \u5197\u9577\u5ea6\u5fa9\u5e30\u624b\u9806(recover)\n## 1. \u30b9\u30c6\u30fc\u30bf\u30b9\u78ba\u8a8d\n\u307e\u305a\u306ftelnet\u3067\u751f\u304d\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001\u73fe\u5728\u306estatus\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n```bash\n$ telnet telnet 10002\n> stat node\n.\nrouting.nodes.length 2 #=> 3\u304b\u30892\u3078\nrouting.nodes [\"localhost_10002\", \"localhost_10003\"]  #=> localhost_10001\u304c\u843d\u3061\u3066\u3044\u308b\n.\nrouting.short_vnodes 133 # \u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3057\u305fvnode\u306e\u6570\nrouting.lost_vnodes 0    # \u5197\u9577\u5ea6\u304c0\u306b\u306a\u3063\u305fvnode\u306e\u6570\n.\n.\n```\n- localhost_10001\u304c\u843d\u3061\u305f\u305f\u3081\u3001\u3053\u306einstance\u304c\u62c5\u5f53\u3057\u3066\u3044\u305fvnode\u306e\u5197\u9577\u5ea6\u304c\u843d\u3061\u3066\u3044\u307e\u3059\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5197\u9577\u5ea62\u306a\u306e\u30671instance\u843d\u3061\u3066\u3082\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u306f\u554f\u984c\u306a\u304f\u884c\u3048\u307e\u3059\n  - \u305f\u3060\u3057\u8a72\u5f53vnode\u306f\u5197\u9577\u5ea61\u306e\u72b6\u614b\n\n## 2. \u5197\u9577\u5ea6\u56de\u5fa9\n### \u30b3\u30de\u30f3\u30c9\n```\n> recover\n```\n- \u751f\u304d\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u3001\u5197\u9577\u304c\u843d\u3061\u3066\u3044\u308bvnode\u306e\u62c5\u5f53\u3092\u518d\u30a2\u30b5\u30a4\u30f3\u3001\u53ca\u3073\u30c7\u30fc\u30bf\u306e\u30b3\u30d4\u30fc\u3092\u884c\u3046\u3053\u3068\u3067\u5197\u9577\u5ea6\u306e\u56de\u5fa9\u3092\u884c\u3046\n- \u3069\u308c\u304b1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5b9f\u884c\u3059\u308c\u3070OK\u3067\u3059\n\n### \u5b9f\u884c\n\n```bash\n> recover # recover\u5b9f\u884c\n\n> stat run_recover\n  stats.run_recover true # recover\u304c\u5b9f\u884c\u4e2d\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3057\u307e\u3059\n\n> stat short\n  routing.short_vnodes 127 # \u6bb5\u3005\u6e1b\u3063\u3066\u3044\u304d\u307e\u3059\n```\n- recover\u30d7\u30ed\u30bb\u30b9\u304c\u9032\u3080\u306b\u3064\u308c\u3066\u3001`routing.short_vnodes`\u306e\u6570\u304c\u6e1b\u3063\u3066\u3044\u304d\u307e\u3059\n\n## 3. \u7d42\u4e86\u78ba\u8a8d\n\n```bash\n> stat run_recover\n  stats.run_recover false # recover\u304c\u7d42\u4e86\u3059\u308b\u3068false\u306b\u623b\u308a\u307e\u3059\n\n> stat short\n  routing.short_vnodes 0 # \u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3057\u305fvnode\u304c0\u306b\u306a\u3063\u3066\u3044\u307e\u3059\n```\n- recover\u30d7\u30ed\u30bb\u30b9\u306b\u304b\u304b\u308b\u6642\u9593\u306f\u3001\u30c7\u30fc\u30bf\u91cf\u3084\u30b5\u30fc\u30d0\u30b9\u30da\u30c3\u30af\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\n\n# AUTO RECOVER\u6a5f\u80fd\n\u4e0a\u8a18\u3067\u306f\u624b\u52d5\u3067recover\u3092\u5b9f\u884c\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5197\u9577\u5ea6\u304c\u843d\u3061\u305f\u969b\u306b\u81ea\u52d5\u3067recover\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\n\n## \u30b3\u30de\u30f3\u30c9\n```\n> set_auto_recover [ 'true' | 'false' ] <sec>\n```\n- true\u3067\u8d77\u52d5\u3001false\u3067\u505c\u6b62\u3057\u307e\u3059\n- \\<sec>\u306f\u3001\u5197\u9577\u5ea6\u306e\u4f4e\u4e0b\u3092\u691c\u77e5\u3057\u3066\u304b\u3089\u4f55\u79d2\u5f8c\u306brecover\u3092\u5b9f\u884c\u3059\u308b\u304b\u3092\u6307\u5b9a\u3057\u307e\u3059\n  - \u7336\u4e88\u671f\u9593\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001recover\u3067\u306f\u306a\u304f\u4ed6\u306e\u5bfe\u51e6\u6cd5\u3092\u3068\u308a\u305f\u304f\u306a\u3063\u305f\u5834\u5408\u306b\u306f\u3001\u3053\u306e\u6642\u9593\u5185\u306b`set_auto_recover false`\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067recover\u306e\u5b9f\u884c\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\n\n# \u53c2\u7167URL\nROMA Recovery redundancy: http://roma-kvs.org/learn/recovery_redundancy.html\nROMA Commands Page: http://roma-kvs.org/commands.html\n"}