{"context": "FreeBSD \u306b OpenSMTPD 6.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n\u74b0\u5883\n\nFreeBSD 11.0 (VirtualBox)\n\n\n\u65b9\u91dd\n\n\nOpenSMTPD 6.0.2 \u304c\u51fa\u3066\u304b\u3089 2 \u30f6\u6708\u4ee5\u4e0a\u7d4c\u3063\u3066\u308b\u306e\u306b\u3001\nFreeBSD ports \u306e mail/opensmtpd \u306f 5.9.2p1 \u306e\u307e\u307e\u3002\n\u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067 Portable version \u3092\u81ea\u5206\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\n\nports/mail/opensmtpd \u3092\u53c2\u8003\u306b\u3002\n\n\nOpenSMTPD \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nlibevent 2.0.22_1, libressl 2.4.3, libasr 1.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n% sudo pkg install libevent2 libressl libasr\n\n\n\nlibasr \u306f OpenSMTPD \u306e asynchronous resolver library\n\n\n\nopensmtpd 6.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n% fetch --no-verify-peer https://www.opensmtpd.org/archives/opensmtpd-6.0.2p1.tar.gz\n% tar xzf opensmtpd-6.0.2p1.tar.gz\n% cd opensmtpd-6.0.2p1\n% ./configure --with-libasr=/usr/local --with-libssl=/usr/local --sysconfdir=/usr/local/etc/mail --mandir=/usr/local/man | & tee configure.log\n% make |& tee make.log\n% sudo make install |& tee make-install.log\n\n\nports/mail/opensmtpd \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306b\u3059\u308b\u305f\u3081\u306b --sysconfdir \u3068 --mandir \u3092\u6307\u5b9a\n\nconfigure \u51fa\u529b\u306e\u672b\u5c3e\nOpenSMTPD has been configured with the following options:\n             User binaries: /usr/local/bin\n           System binaries: /usr/local/sbin\n       Configuration files: /usr/local/etc/mail\n        mail.local program: /usr/local/libexec/opensmtpd/mail.local\n           encrypt program: /usr/local/libexec/opensmtpd/encrypt\n              Manual pages: /usr/local/man/manX\n            smtpd.sock dir: /var/run\nPrivilege separation chroot path: /var/empty\n            Manpage format: doc\n        Package libexecdir: ${exec_prefix}/libexec/opensmtpd\n               PAM support: no\n          BSD Auth support: no\n\n\n\n\n\n\n\n\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n% sudo pw useradd _smtpd -c \"SMTP Daemon\" -d /var/empty -s /sbin/nologin\n% sudo pw useradd _smtpq -c \"SMTPD Queue\" -d /var/empty -s /sbin/nologin\n\n\n\nmailwrapper \u8a2d\u5b9a\u3092\u5909\u66f4\n\n\nmail/opensmtpd/files/pkg-install.in \u3068\u540c\u69d8\u306b /etc/mail/mailer.conf \u306e\u5185\u5bb9\u3092\u4ee5\u4e0b\u3067\u4e0a\u66f8\u304d\n\nsendmail        /usr/local/sbin/smtpctl\nsend-mail       /usr/local/sbin/smtpctl\nmailq           /usr/local/sbin/smtpctl\nmakemap         /usr/local/libexec/opensmtpd/makemap\nnewaliases      /usr/local/libexec/opensmtpd/makemap\n\n\n\nsendmail \u3092\u7121\u52b9\u306b\n\n\n\u505c\u6b62\n% sudo service sendmail stop\n\n\nman rc.sendmail \u306b\u5f93\u3063\u3066 /etc/rc.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\n\nsendmail_enable=\"NO\"\nsendmail_submit_enable=\"NO\"\nsendmail_outbound_enable=\"NO\"\nsendmail_msp_queue_enable=\"NO\"\n\n\n\n\n\n\u8d77\u52d5\n\n\nports \u306e rc \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\n% sudo mkdir /usr/local/etc/rc.d\n% sudo sh -c \"sed 's/%%PREFIX%%/\\/usr\\/local/g' /usr/ports/mail/opensmtpd/files/smtpd.in > /usr/local/etc/rc.d/smtpd\"\n% sudo chmod +x /usr/local/etc/rc.d/smtpd\n\n\n\n%%PREFIX%% \u3092 /usr/local \u306b\u7f6e\u63db\n\n\n\n\u8d77\u52d5\n% sudo service smtpd start\n\n\n\nFreeBSD \u8d77\u52d5\u6642\u306b\u81ea\u52d5\u8d77\u52d5\n\n\n/etc/rc.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\nsmtpd_enable=\"YES\"\n\n\n\n\n\n\n\nFreeBSD \u306b OpenSMTPD 6.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n# \u74b0\u5883\n\n1. [FreeBSD 11.0 (VirtualBox)](http://qiita.com/ken1ma/items/86748d03c2e8c192dce6)\n\n# \u65b9\u91dd\n1. [OpenSMTPD 6.0.2](https://www.opensmtpd.org/) \u304c\u51fa\u3066\u304b\u3089 2 \u30f6\u6708\u4ee5\u4e0a\u7d4c\u3063\u3066\u308b\u306e\u306b\u3001\n2. FreeBSD ports \u306e mail/opensmtpd \u306f [5.9.2p1](https://svnweb.freebsd.org/ports/head/mail/opensmtpd/Makefile?revision=428066&view=markup) \u306e\u307e\u307e\u3002\n3. \u4ed5\u65b9\u304c\u306a\u3044\u306e\u3067 Portable version \u3092\u81ea\u5206\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\n4. [ports/mail/opensmtpd](https://svnweb.freebsd.org/ports/head/mail/opensmtpd/) \u3092\u53c2\u8003\u306b\u3002\n\n# OpenSMTPD \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n1. libevent 2.0.22_1, libressl 2.4.3, libasr 1.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n    ```\n% sudo pkg install libevent2 libressl libasr\n```\n    1. [libasr](https://github.com/OpenSMTPD/libasr) \u306f OpenSMTPD \u306e asynchronous resolver library\n\n2. opensmtpd 6.0.2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n    ```\n% fetch --no-verify-peer https://www.opensmtpd.org/archives/opensmtpd-6.0.2p1.tar.gz\n% tar xzf opensmtpd-6.0.2p1.tar.gz\n% cd opensmtpd-6.0.2p1\n% ./configure --with-libasr=/usr/local --with-libssl=/usr/local --sysconfdir=/usr/local/etc/mail --mandir=/usr/local/man | & tee configure.log\n% make |& tee make.log\n% sudo make install |& tee make-install.log\n```\n    1. ports/mail/opensmtpd \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306b\u3059\u308b\u305f\u3081\u306b `--sysconfdir` \u3068 `--mandir` \u3092\u6307\u5b9a\n    2. `configure` \u51fa\u529b\u306e\u672b\u5c3e\n\n        ```\nOpenSMTPD has been configured with the following options:\n                     User binaries: /usr/local/bin\n                   System binaries: /usr/local/sbin\n               Configuration files: /usr/local/etc/mail\n                mail.local program: /usr/local/libexec/opensmtpd/mail.local\n                   encrypt program: /usr/local/libexec/opensmtpd/encrypt\n                      Manual pages: /usr/local/man/manX\n                    smtpd.sock dir: /var/run\n  Privilege separation chroot path: /var/empty\n                    Manpage format: doc\n                Package libexecdir: ${exec_prefix}/libexec/opensmtpd\n                       PAM support: no\n                  BSD Auth support: no\n```\n\n3. \u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n\n    ```\n% sudo pw useradd _smtpd -c \"SMTP Daemon\" -d /var/empty -s /sbin/nologin\n% sudo pw useradd _smtpq -c \"SMTPD Queue\" -d /var/empty -s /sbin/nologin\n```\n\n4. mailwrapper \u8a2d\u5b9a\u3092\u5909\u66f4\n    1. [mail/opensmtpd/files/pkg-install.in](https://svnweb.freebsd.org/ports/head/mail/opensmtpd/files/pkg-install.in?view=markup) \u3068\u540c\u69d8\u306b /etc/mail/mailer.conf \u306e\u5185\u5bb9\u3092\u4ee5\u4e0b\u3067\u4e0a\u66f8\u304d\n\n    ```\nsendmail        /usr/local/sbin/smtpctl\nsend-mail       /usr/local/sbin/smtpctl\nmailq           /usr/local/sbin/smtpctl\nmakemap         /usr/local/libexec/opensmtpd/makemap\nnewaliases      /usr/local/libexec/opensmtpd/makemap\n```\n\n5. sendmail \u3092\u7121\u52b9\u306b\n    1. \u505c\u6b62\n\n        ```\n% sudo service sendmail stop\n```\n    2. `man rc.sendmail` \u306b\u5f93\u3063\u3066 /etc/rc.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\n\n    ```\nsendmail_enable=\"NO\"\nsendmail_submit_enable=\"NO\"\nsendmail_outbound_enable=\"NO\"\nsendmail_msp_queue_enable=\"NO\"\n```\n\n6. \u8d77\u52d5\n    1. ports \u306e rc \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\n\n        ```\n% sudo mkdir /usr/local/etc/rc.d\n% sudo sh -c \"sed 's/%%PREFIX%%/\\/usr\\/local/g' /usr/ports/mail/opensmtpd/files/smtpd.in > /usr/local/etc/rc.d/smtpd\"\n% sudo chmod +x /usr/local/etc/rc.d/smtpd\n```\n        1. `%%PREFIX%%` \u3092 `/usr/local` \u306b\u7f6e\u63db\n\n    2. \u8d77\u52d5\n\n        ```\n% sudo service smtpd start\n```\n\n    3. FreeBSD \u8d77\u52d5\u6642\u306b\u81ea\u52d5\u8d77\u52d5\n        1. /etc/rc.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\n\n            ```\nsmtpd_enable=\"YES\"\n```\n", "tags": ["FreeBSD", "OpenSMTPD"]}