{"context": " More than 1 year has passed since last update.\n\u30d6\u30ed\u30b0\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002\u5143\u306e\u8a18\u4e8b\u306f\u30b3\u30c1\u30e9\n\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30e6\u30fc\u30b6\u30fc\u306b\u304a\u77e5\u3089\u305b\u3092\u901a\u77e5\u3057\u305f\u3044\u3002\nFacebook\u306e\u300c\u25cb\u25cb\u3055\u3093\u304c\u3042\u306a\u305f\u306e\u6295\u7a3f\u3092Like\u3057\u307e\u3057\u305f\u300d\u307f\u305f\u3044\u306a\u3084\u3064\u3002\n\u3084\u3063\u3066\u307f\u305f\u3089\u610f\u5916\u3068\u3059\u3050\u3067\u304d\u305f\u3002\n\uff08heroku\u306eaddon\u306e\u304a\u304b\u3052\uff09\n\u3053\u3093\u306a\u306e\u3002\n\n\nPusher\nhttp://pusher.com/\n\u3081\u3093\u3069\u304f\u3055\u305d\u3046\u3060\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001Pushser\u3092\u4f7f\u3048\u3070\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3002\nWebsocket\u306e\u4ed5\u7d44\u307f\u306f\u5206\u304b\u3089\u306a\u3044\u3051\u3069\u3001\u610f\u8b58\u3057\u306a\u304f\u3066\u826f\u3044\u3002\nRails\u3068Heroku\u4f7f\u3063\u3066\u307e\u3059\u3002Heroku\u3058\u3083\u306a\u304f\u3066\u3082Pusher\u306f\u4f7f\u3048\u307e\u3059\u304c\u3002\n\nheroku\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nPusher | Heroku Dev Center\nAdding in-app notifications with Pusher | Heroku Dev Center\nheroku\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6cbf\u3063\u3066\u3084\u3063\u305f\u3093\u3067\u3059\u304c\u3001\nTurbolinks\u3068\u306e\u7d61\u307f\u304c\u3042\u308b\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u5909\u3048\u307e\u3057\u305f\u3002\n\u3000\u3000\nGemfile\n\ngem 'pusher'\n\n\nHeroku\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089Pusher\u3092\u8ffd\u52a0\u3002\n\u30ea\u30df\u30c3\u30c8\u306f\u3042\u308b\u3051\u3069\u7121\u6599\u3067\u4f7f\u3048\u308b\u3002\n\n\n\u8a2d\u5b9a\nAPI\u30ad\u30fc\u3068\u304b\u3092\u8ffd\u52a0\u3002Heroku\u306e\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306f\u4f55\u306b\u3082\u3057\u306a\u304f\u3066\u3082\u9762\u5012\u3092\u307f\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3002\nPusher.url \u3068\u304b Pusher.app_id \u3068\u304b\u306f\u81ea\u5206\u306e\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3068Heroku\u4e0a\u306e\u30a2\u30d7\u30ea\u3068\u3067\u306f\u9055\u3046\u3082\u306e\u306a\u306e\u3067\u6ce8\u610f\u3002\nconfig/environments/development.rb\n\n  # Real time notification\n  require 'pusher'\n  Pusher.url = \"http://7f115110ccdsxxxxxxxxx:f7b9a0f68dxxxxxxxxxx@api-eu.pusher.com/apps/100000\"\n  Pusher.logger = Rails.logger\n\n  # Lines below are needed only for development environment.\n  # In production, Pusher will automatically take care of this.\n  require 'pusher'\n  Pusher.app_id = '000000'\n  Pusher.key    = '7f1151xxxxxxxxxxxxxxxxxx'\n  Pusher.secret = 'f7b9a0f68dc6xxxxxxxxxxxxx'\n\n\n\n\nJavascript\u3092\u8aad\u307f\u8fbc\u307f\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066assets pipeline\u306b\u5165\u308c\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u30ea\u30f3\u30af\u304c\u304a\u3059\u3059\u3081\u3063\u3066\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u305d\u3046\u3057\u3042\u305f\u3002\n\nWe highly recommended that you link to our hosted version which is minified and served by a CDN. By linking to a minor version (e.g. 2.2) you will automatically receive patch updates.\n\nviews/layouts/application.html.erb\n\n  <!-- Pusher (Heroku addon) -->\n  <script src=\"//js.pusher.com/2.2/pusher.min.js\" type=\"text/javascript\"></script>\n\n\n\n\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\nJavascript\u3092\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u547c\u3073\u51fa\u3057\u305f\u3044\u306e\u3067\u3001Api_key\u3092\u74b0\u5883\u5909\u6570\u306b\u3057\u307e\u3057\u305f\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u306a\u3044\u3051\u3069\u3002api_key\u3092\u3069\u3046\u3084\u3063\u3066production/development\u3067\u5207\u308a\u66ff\u3048\u308b\u304b\u3060\u3051\u3069\u3001HTML\u306b\u57cb\u3081\u8fbc\u3093\u3058\u3083\u3044\u307e\u3057\u305f\u3002\u3064\u3044\u3067\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u306eID\u3082\u3002\n\u306a\u3093\u304b\u3044\u3044\u65b9\u6cd5\u306a\u3044\u304b\u306a\u3002\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\n\n$ vi ~/.bash_profile\nexport PUSHER_API_KEY=\"7b01788fd3cxxxxd05470\"\n\n\nHeroku\n\n$ heroku config:set YADOKALY_PUSHER_API_KEY=7b01788fdxxxxx05470\n\n\nHTML\uff08views/layouts/application.html.erb\u3068\u304b\u3069\u3053\u3067\u3082\uff09\n\n<span id=\"current_user_id\" data-value=\"<%= current_user.id %>\" style=\"display:none;\"></span>\n<span id=\"pusher_api_key\" data-value=\"<%= ENV['PUSHER_API_KEY'] %>\" style=\"display:none;\"></span>\n\n\n\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\ncurrent_user\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u3046\u3044\u524d\u63d0\u3067\u3059\u3002\n\u30c6\u30b9\u30c8\u3068\u3057\u3066push\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3092\u3064\u304f\u308a\u307e\u3057\u305f\u3002\n\n class PusherController < ApplicationController\n  protect_from_forgery :except => :auth # stop rails CSRF protection for this action\n\n  def auth\n    if current_user\n      response = Pusher[params[:channel_name]].authenticate(params[:socket_id])\n      render :json => response\n    else\n      render :text => \"Not authorized\", :status => '403'\n    end\n  end\n\n  def push\n    Pusher['private-'+current_user.id.to_s].trigger('new_message', {:sender => current_user.name, :link => \"/chatroom/123\"})\n    render nothing: true\n  end\n\nend\n\n\n\u5bfe\u5fdc\u3059\u308bRoute\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nconfig/routes.rb\n\n  post 'pusher/auth'\n  get 'pusher/push'\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n/pusher/push\u3092\u53e9\u304f\u30ea\u30f3\u30af\u3092View\u306e\u3069\u3053\u304b\u306b\u5165\u308c\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n<%= link_to \"push\", \"/pusher/push\", remote: true %>\n\n\nbody\u306e\u4e2d\u306b\u66f8\u304f\u3068Turbolinks\u3068\u8272\u3005\u3042\u3063\u3066\u30011\u56de\u30ce\u30fc\u30c6\u30a3\u30d5\u30a3\u30b1\u30fc\u30b7\u30e7\u30f3\u9001\u3063\u305f\u3064\u3082\u308a\u304c2\u500b\u30823\u500b\u3082\u8868\u793a\u3055\u308c\u308b\u3063\u3066\u72b6\u6cc1\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30da\u30fc\u30b8\u9077\u79fb\u3059\u308b\u305f\u3073\u306bPushrer instances\u3092\u30ab\u30e9\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nassets/javascripts/pusher.coffee\n\npusher_reset = ->\n    # Disconnect and remove all pusher instance\n    # to avoide multiple execution.\n    if Pusher\n        $.each(Pusher.instances, (index, instance) ->\n            instance.disconnect()\n        )\n        Pusher.instances = []\n        console.log 'pusher_reset fired.'\n\n\nready = ->\n\n    # Pusher notification\n    # Pusher['private-1'].trigger() in controller\n    current_user_id = $('#current_user_id').attr('data-value')\n    api_key = $('#pusher_api_key').attr('data-value')\n\n    if Pusher && current_user_id\n        pusher  = new Pusher(api_key, { cluster: 'eu' })\n        channel = pusher.subscribe('private-' + current_user_id)\n\n        channel.bind('new_message', (data) ->\n            console.log 'fire'\n            # Will be executed when the method in controller called.\n            if !$('.notify-wrap').length\n                $('body').prepend('<div class=\"notify-wrap\"></div>')\n            msg = data.sender + ' \u3055\u3093\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f\u3002'\n            msgDiv = '<div class=\"notify\">' + \n                                    '<span class=\"got-it\"><i class=\"fa fa-times-circle\"></i></span>' + \n                                    '<a href=\"' + data.link + '\">' + msg + '</a>' + \n                                '</div>'\n            $(msgDiv).prependTo('.notify-wrap').animate({ right: 0 }, 350)\n            ### if you want to hide it after some seconds\n            setTimeout( ->\n                $('#notify').fadeOut()\n            , 10000)\n            ###\n        )\n    $('body').on 'click', '.got-it', (e) ->\n        e.preventDefault()\n        $(this).closest('.notify').remove()\n\n# For turbolinks\n$(document).ready(ready)\n$(document).on 'page:load', ready\n$(document).on 'page:receive', pusher_reset\n\n\n\n\u898b\u305f\u76ee\n\u3061\u3087\u3063\u3068\u304b\u3063\u3053\u3088\u304f\u3057\u307e\u3059\u3002\n\u6a2a\u304b\u3089\u30b9\u30c3\u3068\u5165\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3001right: -300px;\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u3057\u3066\u304a\u3044\u3066\u3001\n\u524d\u8ff0\u306e.animate({ right: 0 }, 350) \u3067\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u3066\u307e\u3059\u3002\nassets/stylesheets/pusher.scss\n\n$c_light_gray: #F7F7F7;\n$c_blue: #114aa9;\n$c_gray: #666666;\n\n.notify-wrap {\n    z-index: 10;\n    position: fixed;\n    top: 10px;\n    right: 10px;\n    .notify {\n        position: relative;\n        right: -300px;\n        width: 200px;\n        border-radius: 5px;\n        font-size: 0.85em;\n        border: 3px solid $c_light_gray;\n        background-color: #fff; \n        box-shadow: 0 4px 10px #ddd;\n        margin-bottom: 10px;\n        &:hover {\n            border-color: lighten($c_blue, 42);\n        }\n        a {\n            height: 100%;\n            width: 100%;\n            display: block;\n            padding: 10px 15px;\n            &:hover {\n                text-decoration: none;\n                //color: #fff;\n            }\n        }\n        .got-it {\n            position: absolute;\n            top: -7px;\n            right: -7px;\n            font-size: 20px;\n            width: 24px;\n            height: 24px;\n            line-height: 20px;\n            border: 2px solid #fff;\n            background-color: #fff;\n            border-radius: 50%;\n            text-align: center;\n            cursor: pointer;\n            &:hover {\n                color: #fff;\n                border: 2px solid $c_gray;\n                background-color: $c_gray;\n            }\n        }\n    }\n}\n\n\n\u4ee5\u4e0a\u304b\u306a\u3002\n\u3053\u308c\u3067 push\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3089\u30b9\u30c3\u3068\u30ce\u30fc\u30c6\u30a3\u30d5\u30a3\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u73fe\u308c\u308b\u306f\u305a\u3002\n\u697d\u3057\u3044\uff01\n\n\u53c2\u8003\nPusher | Heroku Dev Center\nAdding in-app notifications with Pusher | Heroku Dev Center\nDocumentation | Pusher\nPusher connections stack up when using turbo links \u00b7 Issue #48 \u00b7 chrismccord/sync \u00b7 GitHub\nTurbolinks support for Pusher.js\nrails/turbolinks \u00b7 GitHub\n\u2192 http://workabroad.jp/posts/2127\n- - - - - - - - - - - \n\u30d6\u30ed\u30b0\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002<a href=\"http://workabroad.jp/posts/2127\">\u5143\u306e\u8a18\u4e8b\u306f\u30b3\u30c1\u30e9</a>\n- - - - - - - - - - - \n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30e6\u30fc\u30b6\u30fc\u306b\u304a\u77e5\u3089\u305b\u3092\u901a\u77e5\u3057\u305f\u3044\u3002\nFacebook\u306e\u300c\u25cb\u25cb\u3055\u3093\u304c\u3042\u306a\u305f\u306e\u6295\u7a3f\u3092Like\u3057\u307e\u3057\u305f\u300d\u307f\u305f\u3044\u306a\u3084\u3064\u3002\n\u3084\u3063\u3066\u307f\u305f\u3089\u610f\u5916\u3068\u3059\u3050\u3067\u304d\u305f\u3002\n\uff08heroku\u306eaddon\u306e\u304a\u304b\u3052\uff09\n\n<!-- extract -->\n\n\u3053\u3093\u306a\u306e\u3002\n![20150112-064343_capture](http://image.workabroad.jp/upload/2015/233/workabroad.jpg)\n\n###Pusher\n\nhttp://pusher.com/\n\u3081\u3093\u3069\u304f\u3055\u305d\u3046\u3060\u3068\u601d\u3063\u3066\u305f\u3051\u3069\u3001Pushser\u3092\u4f7f\u3048\u3070\u305d\u3093\u306a\u306b\u96e3\u3057\u304f\u306a\u3044\u3002\nWebsocket\u306e\u4ed5\u7d44\u307f\u306f\u5206\u304b\u3089\u306a\u3044\u3051\u3069\u3001\u610f\u8b58\u3057\u306a\u304f\u3066\u826f\u3044\u3002\nRails\u3068Heroku\u4f7f\u3063\u3066\u307e\u3059\u3002Heroku\u3058\u3083\u306a\u304f\u3066\u3082Pusher\u306f\u4f7f\u3048\u307e\u3059\u304c\u3002\n![Screen Shot 2015-01-11 at 10.50.05 PM](http://image.workabroad.jp/upload/2015/230/workabroad.jpg)\n\n**heroku\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8**\n[Pusher | Heroku Dev Center](https://devcenter.heroku.com/articles/pusher)\n[Adding in-app notifications with Pusher | Heroku Dev Center](https://devcenter.heroku.com/articles/pusher-in-app-notifications#creating-our-authentication-endpoint)\n\nheroku\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6cbf\u3063\u3066\u3084\u3063\u305f\u3093\u3067\u3059\u304c\u3001\nTurbolinks\u3068\u306e\u7d61\u307f\u304c\u3042\u308b\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u5909\u3048\u307e\u3057\u305f\u3002\n\n\u3000\u3000\nGemfile\n\n```\n\ngem 'pusher'\n\n```\n\nHeroku\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089Pusher\u3092\u8ffd\u52a0\u3002\n\u30ea\u30df\u30c3\u30c8\u306f\u3042\u308b\u3051\u3069\u7121\u6599\u3067\u4f7f\u3048\u308b\u3002\n\n![Pusher  Development \u2014 App keys](http://image.workabroad.jp/upload/2015/231/workabroad.jpg)\n\n\n\n###\u8a2d\u5b9a\n\nAPI\u30ad\u30fc\u3068\u304b\u3092\u8ffd\u52a0\u3002Heroku\u306e\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306f\u4f55\u306b\u3082\u3057\u306a\u304f\u3066\u3082\u9762\u5012\u3092\u307f\u3066\u304f\u308c\u308b\u307f\u305f\u3044\u3002\nPusher.url \u3068\u304b Pusher.app_id \u3068\u304b\u306f\u81ea\u5206\u306e\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3068Heroku\u4e0a\u306e\u30a2\u30d7\u30ea\u3068\u3067\u306f\u9055\u3046\u3082\u306e\u306a\u306e\u3067\u6ce8\u610f\u3002\n\nconfig/environments/development.rb\n\n```ruby\n\n  # Real time notification\n  require 'pusher'\n  Pusher.url = \"http://7f115110ccdsxxxxxxxxx:f7b9a0f68dxxxxxxxxxx@api-eu.pusher.com/apps/100000\"\n  Pusher.logger = Rails.logger\n\n  # Lines below are needed only for development environment.\n  # In production, Pusher will automatically take care of this.\n  require 'pusher'\n  Pusher.app_id = '000000'\n  Pusher.key    = '7f1151xxxxxxxxxxxxxxxxxx'\n  Pusher.secret = 'f7b9a0f68dc6xxxxxxxxxxxxx'\n\n\n```\n\n\n###Javascript\u3092\u8aad\u307f\u8fbc\u307f\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066assets pipeline\u306b\u5165\u308c\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u30ea\u30f3\u30af\u304c\u304a\u3059\u3059\u3081\u3063\u3066\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u305d\u3046\u3057\u3042\u305f\u3002\n\n> We highly recommended that you link to our hosted version which is minified and served by a CDN. By linking to a minor version (e.g. 2.2) you will automatically receive patch updates.\n\nviews/layouts/application.html.erb\n\n```html\n\n  <!-- Pusher (Heroku addon) -->\n  <script src=\"//js.pusher.com/2.2/pusher.min.js\" type=\"text/javascript\"></script>\n\n```\n\n\n###\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\n\nJavascript\u3092\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u547c\u3073\u51fa\u3057\u305f\u3044\u306e\u3067\u3001Api_key\u3092\u74b0\u5883\u5909\u6570\u306b\u3057\u307e\u3057\u305f\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u306a\u3044\u3051\u3069\u3002api_key\u3092\u3069\u3046\u3084\u3063\u3066production/development\u3067\u5207\u308a\u66ff\u3048\u308b\u304b\u3060\u3051\u3069\u3001HTML\u306b\u57cb\u3081\u8fbc\u3093\u3058\u3083\u3044\u307e\u3057\u305f\u3002\u3064\u3044\u3067\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u306eID\u3082\u3002\n\u306a\u3093\u304b\u3044\u3044\u65b9\u6cd5\u306a\u3044\u304b\u306a\u3002\n\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\n\n```\n\n$ vi ~/.bash_profile\nexport PUSHER_API_KEY=\"7b01788fd3cxxxxd05470\"\n\n```\n\nHeroku\n\n```\n\n$ heroku config:set YADOKALY_PUSHER_API_KEY=7b01788fdxxxxx05470\n\n```\n\nHTML\uff08views/layouts/application.html.erb\u3068\u304b\u3069\u3053\u3067\u3082\uff09\n\n```html\n\n<span id=\"current_user_id\" data-value=\"<%= current_user.id %>\" style=\"display:none;\"></span>\n<span id=\"pusher_api_key\" data-value=\"<%= ENV['PUSHER_API_KEY'] %>\" style=\"display:none;\"></span>\n\n```\n\n\n###\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\n\ncurrent_user\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u3046\u3044\u524d\u63d0\u3067\u3059\u3002\n\u30c6\u30b9\u30c8\u3068\u3057\u3066push\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3092\u3064\u304f\u308a\u307e\u3057\u305f\u3002\n\n```ruby\n\n class PusherController < ApplicationController\n  protect_from_forgery :except => :auth # stop rails CSRF protection for this action\n\n  def auth\n    if current_user\n      response = Pusher[params[:channel_name]].authenticate(params[:socket_id])\n      render :json => response\n    else\n      render :text => \"Not authorized\", :status => '403'\n    end\n  end\n\n  def push\n    Pusher['private-'+current_user.id.to_s].trigger('new_message', {:sender => current_user.name, :link => \"/chatroom/123\"})\n  \trender nothing: true\n  end\n\nend\n\n```\n\n\u5bfe\u5fdc\u3059\u308bRoute\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nconfig/routes.rb\n\n```ruby\n\n  post 'pusher/auth'\n  get 'pusher/push'\n\n```\n\n\n\n###\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\n/pusher/push\u3092\u53e9\u304f\u30ea\u30f3\u30af\u3092View\u306e\u3069\u3053\u304b\u306b\u5165\u308c\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n```erb\n\n<%= link_to \"push\", \"/pusher/push\", remote: true %>\n\n```\n\nbody\u306e\u4e2d\u306b\u66f8\u304f\u3068Turbolinks\u3068\u8272\u3005\u3042\u3063\u3066\u30011\u56de\u30ce\u30fc\u30c6\u30a3\u30d5\u30a3\u30b1\u30fc\u30b7\u30e7\u30f3\u9001\u3063\u305f\u3064\u3082\u308a\u304c2\u500b\u30823\u500b\u3082\u8868\u793a\u3055\u308c\u308b\u3063\u3066\u72b6\u6cc1\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30da\u30fc\u30b8\u9077\u79fb\u3059\u308b\u305f\u3073\u306bPushrer instances\u3092\u30ab\u30e9\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nassets/javascripts/pusher.coffee\n\n```coffee\n\npusher_reset = ->\n\t# Disconnect and remove all pusher instance\n\t# to avoide multiple execution.\n\tif Pusher\n\t\t$.each(Pusher.instances, (index, instance) ->\n\t\t\tinstance.disconnect()\n\t\t)\n\t\tPusher.instances = []\n\t\tconsole.log 'pusher_reset fired.'\n\n\nready = ->\n\n\t# Pusher notification\n\t# Pusher['private-1'].trigger() in controller\n\tcurrent_user_id = $('#current_user_id').attr('data-value')\n\tapi_key = $('#pusher_api_key').attr('data-value')\n\n\tif Pusher && current_user_id\n\t\tpusher \t= new Pusher(api_key, { cluster: 'eu' })\n\t\tchannel = pusher.subscribe('private-' + current_user_id)\n\n\t\tchannel.bind('new_message', (data) ->\n\t\t\tconsole.log 'fire'\n\t\t\t# Will be executed when the method in controller called.\n\t\t\tif !$('.notify-wrap').length\n\t\t\t\t$('body').prepend('<div class=\"notify-wrap\"></div>')\n\t\t\tmsg = data.sender + ' \u3055\u3093\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3057\u307e\u3057\u305f\u3002'\n\t\t\tmsgDiv = '<div class=\"notify\">' + \n\t\t\t\t\t\t\t\t\t'<span class=\"got-it\"><i class=\"fa fa-times-circle\"></i></span>' + \n\t\t\t\t\t\t\t\t\t'<a href=\"' + data.link + '\">' + msg + '</a>' + \n\t\t\t\t\t\t\t\t'</div>'\n\t\t\t$(msgDiv).prependTo('.notify-wrap').animate({ right: 0 }, 350)\n\t\t\t### if you want to hide it after some seconds\n\t\t\tsetTimeout( ->\n\t\t\t\t$('#notify').fadeOut()\n\t\t\t, 10000)\n\t\t\t###\n\t\t)\n\t$('body').on 'click', '.got-it', (e) ->\n\t\te.preventDefault()\n\t\t$(this).closest('.notify').remove()\n\n# For turbolinks\n$(document).ready(ready)\n$(document).on 'page:load', ready\n$(document).on 'page:receive', pusher_reset\n\n```\n\n\n###\u898b\u305f\u76ee\n\n\u3061\u3087\u3063\u3068\u304b\u3063\u3053\u3088\u304f\u3057\u307e\u3059\u3002\n\u6a2a\u304b\u3089\u30b9\u30c3\u3068\u5165\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3001right: -300px;\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306b\u3057\u3066\u304a\u3044\u3066\u3001\n\u524d\u8ff0\u306e.animate({ right: 0 }, 350) \u3067\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u3066\u307e\u3059\u3002\n\nassets/stylesheets/pusher.scss\n\n```scss\n\n$c_light_gray: #F7F7F7;\n$c_blue: #114aa9;\n$c_gray: #666666;\n\n.notify-wrap {\n\tz-index: 10;\n\tposition: fixed;\n\ttop: 10px;\n\tright: 10px;\n\t.notify {\n\t\tposition: relative;\n\t\tright: -300px;\n\t\twidth: 200px;\n\t\tborder-radius: 5px;\n\t\tfont-size: 0.85em;\n\t\tborder: 3px solid $c_light_gray;\n\t\tbackground-color: #fff;\t\n\t\tbox-shadow: 0 4px 10px #ddd;\n\t\tmargin-bottom: 10px;\n\t\t&:hover {\n\t\t\tborder-color: lighten($c_blue, 42);\n\t\t}\n\t\ta {\n\t\t\theight: 100%;\n\t\t\twidth: 100%;\n\t\t\tdisplay: block;\n\t\t\tpadding: 10px 15px;\n\t\t\t&:hover {\n\t\t\t\ttext-decoration: none;\n\t\t\t\t//color: #fff;\n\t\t\t}\n\t\t}\n\t\t.got-it {\n\t\t\tposition: absolute;\n\t\t\ttop: -7px;\n\t\t\tright: -7px;\n\t\t\tfont-size: 20px;\n\t\t\twidth: 24px;\n\t\t\theight: 24px;\n\t\t\tline-height: 20px;\n\t\t\tborder: 2px solid #fff;\n\t\t\tbackground-color: #fff;\n\t\t\tborder-radius: 50%;\n\t\t\ttext-align: center;\n\t\t\tcursor: pointer;\n\t\t\t&:hover {\n\t\t\t\tcolor: #fff;\n\t\t\t\tborder: 2px solid $c_gray;\n\t\t\t\tbackground-color: $c_gray;\n\t\t\t}\n\t\t}\n\t}\n}\n\n```\n\n\u4ee5\u4e0a\u304b\u306a\u3002\n\u3053\u308c\u3067 push\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3089\u30b9\u30c3\u3068\u30ce\u30fc\u30c6\u30a3\u30d5\u30a3\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u73fe\u308c\u308b\u306f\u305a\u3002\n\u697d\u3057\u3044\uff01\n\n\n###\u53c2\u8003\n\n[Pusher | Heroku Dev Center](https://devcenter.heroku.com/articles/pusher)\n[Adding in-app notifications with Pusher | Heroku Dev Center](https://devcenter.heroku.com/articles/pusher-in-app-notifications#creating-our-authentication-endpoint)\n[Documentation | Pusher](http://pusher.com/docs/)\n[Pusher connections stack up when using turbo links \u00b7 Issue #48 \u00b7 chrismccord/sync \u00b7 GitHub](https://github.com/chrismccord/sync/issues/48)\n[Turbolinks support for Pusher.js](https://gist.github.com/ejholmes/6135198)\n[rails/turbolinks \u00b7 GitHub](https://github.com/rails/turbolinks)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \u2192 <a href=\"http://workabroad.jp/posts/2127\">http://workabroad.jp/posts/2127</a>\n", "tags": ["Rails", "Notification", "Pusher", "Heroku"]}