{"context": " More than 1 year has passed since last update.zabbix 3 \u306e\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u304c\u8feb\u3063\u3066\u304d\u307e\u3057\u305f\n\u305d\u306e\u69cb\u7bc9\u624b\u9806\u306b\u3064\u3044\u3066\u3001\u3069\u3053\u307e\u3067shell\u82b8\u3067\u8a66\u305b\u308b\u304b\u3084\u3063\u3066\u307f\u305f\u6240\u3001\u307b\u307c\u81ea\u52d5\u5316\u304c\u51fa\u6765\u305f\u306e\u3067\u516c\u958b\u3057\u307e\u3059\n\u4ee5\u4e0b\u69cb\u6210\nCentOS6.7\nphp 5.6.18\nApache 2.2.27\nPostgreSQL 9.5.1\n\u6ce8\u610f\u4e8b\u9805\n\u203b\uff11\u3000php\u3084PostgreSQL\u7b49\u3082\u57fa\u672c\u7684\u306a\u6240\u3060\u3051\u8a2d\u5b9a\u3092\u5f04\u3063\u3066\u307e\u3059\u3002\u52d5\u4f5c\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u9069\u5b9c\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u203b\uff12\u3000\u9014\u4e2d\u306b\u3042\u308b\u30e6\u30fc\u30b6zabbix\u306b\u95a2\u3059\u308bOS,PgSQL\u306b\u5bfe\u3059\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\"XXXXXXXXXXXX\"\u306f\u3054\u81ea\u8eab\u306e\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u4e8b\u3092\u5f37\u304f\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u3053\u306e\u307e\u307e\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30db\u30fc\u30eb\u3068\u306a\u3063\u3066\u3082\u8cac\u4efb\u306f\u8ca0\u3044\u304b\u306d\u307e\u3059\u3002\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u30b3\u30d4\u30da\u5229\u7528\u306f\u30c0\u30e1\uff01\u7d76\u5bfe\uff01\uff01\n\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u5168\u3066sh\u306b\u66f8\u304d\u8fbc\u307f\u307e\u3059\n\n/root/setup-zabbix.sh\n# OS\u306e\u6700\u65b0\u30d1\u30c3\u30c1\u9069\u7528\nyum -y update\n\n# epel\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n\n# remi\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n# pgdg\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh http://yum.postgresql.org/9.5/redhat/rhel-6.7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\n# centos.alt.ru.repo\u8ffd\u52a0\necho \"[CentALT]\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"name=CentALT Packages for Enterprise Linux 6 - $basearch\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"baseurl=http://mirror.sysadminguide.net/centalt/repository/centos/6/\\$basearch/\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"enabled=0\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"gpgcheck=0\" >> /etc/yum.repos.d/centos.alt.ru.repo\n\n\n# \u5404\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u7121\u52b9\u5316\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel-testing.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/pgdg-95-centos.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi-php70.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi-safe.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi.repo\n\n# PostgreSQL 9.5\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install postgresql95-server postgresql95-devel postgresql95-contrib --enablerepo=pgdg95\n\n# PostgreSQL\u306eDB\u521d\u671f\u5316\u5b9f\u884c\nservice postgresql-9.5 initdb\n\n# pg_hba.conf\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u5909\u66f4\u306b\u3088\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u5411\u4e0a\nsed -i -e \"s/peer/trust/g\" /var/lib/pgsql/9.5/data/pg_hba.conf\nsed -i -e \"s/ident/trust/g\" /var/lib/pgsql/9.5/data/pg_hba.conf\n\n# postgresql.conf\u306e\u57fa\u672c\u7684\u306a\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u8a2d\u5b9a\necho \"checkpoint_timeout = 30min\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"checkpoint_completion_target = 0.8\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"listen_addresses = '*'\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"port = 8765\" >> /var/lib/pgsql/9.5/data/postgresql.conf\n\n# PostgreSQL9.5\u306eOS\u8d77\u52d5\u6642\u306e\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u8a2d\u5b9a\nchkconfig postgresql-9.5 on\n\n# PostgreSQL9.5\u8d77\u52d5\nservice postgresql-9.5 start\n\n# PostgreSQL9.5\u306e\u521d\u671f\u8a2d\u5b9a\n\necho \"create user zabbix SUPERUSER PASSWORD 'XXXXXXXXXXXX';\" >> /root/create.sql\necho \"create database zabbix owner=zabbix;\" >> /root/create.sql\n/usr/bin/psql -f /root/create.sql -U postgres -p 8765\nrm -f /root/create.sql\n\n# \u4e8b\u524d\u306b\u69cb\u6210\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install libcurl-devel libzip zlib-devel gcc libxml2-devel net-snmp-devel libcurl-devel expect\n\n# apache 2.2\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u6700\u65b0\u7248\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install httpd httpd-devel --enablerepo=CentALT\necho \"ServerName `hostname`:80\" >> /etc/httpd/conf/httpd.conf\n\n# php\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install php php-common php-mbstring php-xml php-gd php-bcmath php-pgsql --enablerepo=remi,remi-php56\n\n# php.ini\u4fee\u6b63\nsed -i -e \"s/post_max_size = 8M/post_max_size = 16M/g\" /etc/php.ini\nsed -i -e \"s/max_execution_time = 30/max_execution_time = 300/g\" /etc/php.ini\nsed -i -e \"s/max_input_time = 60/max_input_time = 300/g\" /etc/php.ini\nsed -i -e \"s/;date.timezone =/date.timezone = Asia\\/Tokyo/g\" /etc/php.ini\nsed -i -e \"s/;always_populate_raw_post_data/always_populate_raw_post_data/g\" /etc/php.ini\nsed -i -e \"s/memory_limit = 128M/memory_limit = 256M/g\" /etc/php.ini\n\n# OS\u4e0a\u306e\u30e6\u30fc\u30b6:zabbix \u30d1\u30b9\u30ef\u30fc\u30c9:XXXXXXXXXXXX \u30b0\u30eb\u30fc\u30d7:zabbix\u306e\u4f5c\u6210\ngroupadd zabbix\nuseradd -g zabbix zabbix\necho XXXXXXXXXXXX | passwd --stdin zabbix\n\n# zabbix\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ncd /root/\nwget 'http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Development/2.5.0/zabbix-2.5.0.tar.gz'\ntar -zxvf zabbix-2.5.0.tar.gz\n\n# zabbix\u306ePostgreSQL\u3078\u306e\u30af\u30a8\u30ea\u66f8\u304d\u51fa\u3057\ncd /root/zabbix-2.5.0/database/postgresql\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/schema.sh\necho \"expect -c \\\"\" >> /root/schema.sh\necho \"set timeout 5\" >> /root/schema.sh\necho \"spawn psql -p 8765 -W -d zabbix -f schema.sql zabbix\" >> /root/schema.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/schema.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/schema.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/schema.sh\necho \"exit 0\" >> /root/schema.sh\necho \"\\\"\" >> /root/schema.sh\nchmod u+x /root/schema.sh\nsh /root/schema.sh\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/images.sh\necho \"expect -c \\\"\" >> /root/images.sh\necho \"set timeout 5\" >> /root/images.sh\necho \"spawn psql -p 8765 -W -d zabbix -f images.sql zabbix\" >> /root/images.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/images.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/images.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/images.sh\necho \"exit 0\" >> /root/images.sh\necho \"\\\"\" >> /root/images.sh\nchmod u+x /root/images.sh\nsh /root/images.sh\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/data.sh\necho \"expect -c \\\"\" >> /root/data.sh\necho \"set timeout 5\" >> /root/data.sh\necho \"spawn psql -p 8765 -W -d zabbix -f data.sql zabbix\" >> /root/data.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/data.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/data.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/data.sh\necho \"exit 0\" >> /root/data.sh\necho \"\\\"\" >> /root/data.sh\nchmod u+x /root/data.sh\nsh /root/data.sh\n\nrm -f /root/schema.sh\nrm -f /root/images.sh\nrm -f /root/data.sh\n\n# configure\u304b\u3089make install\u307e\u3067\ncd /root/zabbix-2.5.0/\n./configure --enable-server --enable-agent --with-postgresql=/usr/pgsql-9.5/bin/pg_config --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2\nmake && make install\n\n# \u300c/usr/local/etc/zabbix_server.conf\u300d\u306e\u4fee\u6b63\nmkdir /var/run/zabbix\nmkdir /var/log/zabbix\nchown -R zabbix:zabbix /var/run/zabbix\nchown -R zabbix:zabbix /var/log/zabbix\n\nsed -i -e \"s/LogFile=\\/tmp\\/zabbix_server.log/LogFile=\\/var\\/log\\/zabbix\\/zabbix_server.log/g\" /usr/local/etc/zabbix_server.conf\necho \"PidFile=/var/run/zabbix/zabbix_server.pid\" >> /usr/local/etc/zabbix_server.conf\necho \"DBHost=localhost\" >> /usr/local/etc/zabbix_server.conf\necho \"DBSocket=/tmp/.s.PGSQL.8765\" >> /usr/local/etc/zabbix_server.conf\necho \"DBPassword=XXXXXXXXXXXX\" >> /usr/local/etc/zabbix_server.conf\necho \"DBPort=8765\" >> /usr/local/etc/zabbix_server.conf\necho \"ListenPort=10051\" >> /usr/local/etc/zabbix_server.conf\necho \"ListenIP=127.0.0.1\" >> /usr/local/etc/zabbix_server.conf\n\n# \u516c\u958b\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u914d\u7f6e\nmkdir /var/www/html/zabbix\ncp -frapi /root/zabbix-2.5.0/frontends/php/* /var/www/html/zabbix\n\n# \u300c/var/www/html/zabbix/conf/zabbix.conf.php\u300d\u306e\u66f8\u304d\u51fa\u3057\necho \"<?php\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"// Zabbix GUI configuration file.\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"global \\$DB;\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['TYPE']     = 'POSTGRESQL';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['SERVER']   = 'localhost';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['PORT']     = '8765';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['DATABASE'] = 'zabbix';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['USER']     = 'zabbix';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['PASSWORD'] = 'XXXXXXXXXXXX';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"// Schema name. Used for IBM DB2 and PostgreSQL.\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['SCHEMA'] = '';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER      = 'localhost';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER_PORT = '8765';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER_NAME = '';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$IMAGE_FORMAT_DEFAULT = IMAGE_FORMAT_PNG;\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"?>\" >> /var/www/html/zabbix/conf/zabbix.conf.php\n\n# \u300c/var/www/html/zabbix/conf/zabbix.conf.php\u300d\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u5909\u66f4\nchmod 666 /var/www/html/zabbix/conf/zabbix.conf.php\n\n# zabbix-serve\u306e\u8d77\u52d5 (\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8d77\u52d5\u30b9\u30d7\u30ea\u30af\u30c8\u3092\u767b\u9332\u3059\u308b\u3002)\n/usr/local/sbin/zabbix_server\n\n# zabbix\u4e2d\u306e\u30b0\u30e9\u30d5\u306e\u6587\u5b57\u5316\u3051\u5bfe\u5fdc\nyum -y install vlgothic-p-fonts\ncd /var/www/html/zabbix/fonts\nln -s /usr/share/fonts/vlgothic/VL-PGothic-Regular.ttf ./VL-PGothic-Regular.ttf\n\n# \u30d5\u30a9\u30f3\u30c8\u6307\u5b9a\u3092\"DejaVuSans\"\u304b\u3089\"VL-PGothic-Regular\"\u306b\u5909\u66f4\nsed -i -e \"s/DejaVuSans/VL-PGothic-Regular/g\" /var/www/html/zabbix/include/defines.inc.php\n\n# Apache\u306e\u8d77\u52d5\nservice httpd start\n\n# OS\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nchkconfig httpd on\nchkconfig postgresql-9.5 on\n\n\nsh\u30d5\u30a1\u30a4\u30eb\u306b\u5b9f\u884c\u6a29\u9650\u3092\u3064\u3051\u3066\nchmod u+x /root/setup-zabbix.sh\nsh\u3092\u52d5\u304b\u3057\u307e\u3059\nsh /root/setup-zabbix.sh\n\u3053\u308c\u3060\u3051\u3067\u3057\u3070\u3089\u304f\u5f85\u3066\u3070\u69cb\u7bc9\u304c\u7d42\u308f\u3063\u3061\u3083\u3044\u307e\u3059\n\u4e00\u901a\u308a\u7d42\u308f\u3063\u305f\u5f8c\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u3044\u3064\u3082\u306eURL\u3067\u3044\u3064\u3082\u306eAdmin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\nhttp://{\u30b5\u30fc\u30d0IP}/zabbix/\n\u5f8c\u306f\u3088\u3057\u306a\u306bzabbix\u30e9\u30a4\u30d5\u3092\u30a8\u30f3\u30b8\u30e7\u30a4\u3057\u3066\u4e0b\u3055\u3044\n((\u8ffd\u8a18))\nCentOS6.7\u306b\u3064\u304d\u3001pgdg\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u4ee5\u4e0b\u306erhel7\u7cfb\u306e\u3082\u306e\nhttp://yum.postgresql.org/9.5/redhat/rhel-7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\u3092\u5229\u7528\u305b\u305a\nhttp://yum.postgresql.org/9.5/redhat/rhel-6.7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\u3092\u5229\u7528\u3059\u308b\u624b\u9806\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\niwaim@github\u3055\u3093\u3001\u3054\u6307\u6458\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\nzabbix 3 \u306e\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u304c\u8feb\u3063\u3066\u304d\u307e\u3057\u305f\n\n\u305d\u306e\u69cb\u7bc9\u624b\u9806\u306b\u3064\u3044\u3066\u3001\u3069\u3053\u307e\u3067shell\u82b8\u3067\u8a66\u305b\u308b\u304b\u3084\u3063\u3066\u307f\u305f\u6240\u3001\u307b\u307c\u81ea\u52d5\u5316\u304c\u51fa\u6765\u305f\u306e\u3067\u516c\u958b\u3057\u307e\u3059\n\n\u4ee5\u4e0b\u69cb\u6210\n\nCentOS6.7\nphp 5.6.18\nApache 2.2.27\nPostgreSQL 9.5.1\n\n\u6ce8\u610f\u4e8b\u9805\n\n\u203b\uff11\u3000php\u3084PostgreSQL\u7b49\u3082\u57fa\u672c\u7684\u306a\u6240\u3060\u3051\u8a2d\u5b9a\u3092\u5f04\u3063\u3066\u307e\u3059\u3002\u52d5\u4f5c\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u9069\u5b9c\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u203b\uff12\u3000\u9014\u4e2d\u306b\u3042\u308b\u30e6\u30fc\u30b6zabbix\u306b\u95a2\u3059\u308bOS,PgSQL\u306b\u5bfe\u3059\u308b\u30d1\u30b9\u30ef\u30fc\u30c9\"XXXXXXXXXXXX\"\u306f\u3054\u81ea\u8eab\u306e\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u4e8b\u3092\u5f37\u304f\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u3053\u306e\u307e\u307e\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30db\u30fc\u30eb\u3068\u306a\u3063\u3066\u3082\u8cac\u4efb\u306f\u8ca0\u3044\u304b\u306d\u307e\u3059\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u30b3\u30d4\u30da\u5229\u7528\u306f\u30c0\u30e1\uff01\u7d76\u5bfe\uff01\uff01\n\n\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u5168\u3066sh\u306b\u66f8\u304d\u8fbc\u307f\u307e\u3059\n\n```vim:/root/setup-zabbix.sh\n# OS\u306e\u6700\u65b0\u30d1\u30c3\u30c1\u9069\u7528\nyum -y update\n\n# epel\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh https://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n\n# remi\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n# pgdg\u30ec\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm -ivh http://yum.postgresql.org/9.5/redhat/rhel-6.7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\n# centos.alt.ru.repo\u8ffd\u52a0\necho \"[CentALT]\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"name=CentALT Packages for Enterprise Linux 6 - $basearch\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"baseurl=http://mirror.sysadminguide.net/centalt/repository/centos/6/\\$basearch/\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"enabled=0\" >> /etc/yum.repos.d/centos.alt.ru.repo\necho \"gpgcheck=0\" >> /etc/yum.repos.d/centos.alt.ru.repo\n\n\n# \u5404\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u7121\u52b9\u5316\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel-testing.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/epel.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/pgdg-95-centos.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi-php70.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi-safe.repo\nsed -i -e \"s/enabled=1/enabled=0/g\" /etc/yum.repos.d/remi.repo\n\n# PostgreSQL 9.5\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install postgresql95-server postgresql95-devel postgresql95-contrib --enablerepo=pgdg95\n\n# PostgreSQL\u306eDB\u521d\u671f\u5316\u5b9f\u884c\nservice postgresql-9.5 initdb\n\n# pg_hba.conf\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u5909\u66f4\u306b\u3088\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u5411\u4e0a\nsed -i -e \"s/peer/trust/g\" /var/lib/pgsql/9.5/data/pg_hba.conf\nsed -i -e \"s/ident/trust/g\" /var/lib/pgsql/9.5/data/pg_hba.conf\n\n# postgresql.conf\u306e\u57fa\u672c\u7684\u306a\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u8a2d\u5b9a\necho \"checkpoint_timeout = 30min\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"checkpoint_completion_target = 0.8\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"listen_addresses = '*'\" >> /var/lib/pgsql/9.5/data/postgresql.conf\necho \"port = 8765\" >> /var/lib/pgsql/9.5/data/postgresql.conf\n\n# PostgreSQL9.5\u306eOS\u8d77\u52d5\u6642\u306e\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u8a2d\u5b9a\nchkconfig postgresql-9.5 on\n\n# PostgreSQL9.5\u8d77\u52d5\nservice postgresql-9.5 start\n\n# PostgreSQL9.5\u306e\u521d\u671f\u8a2d\u5b9a\n\necho \"create user zabbix SUPERUSER PASSWORD 'XXXXXXXXXXXX';\" >> /root/create.sql\necho \"create database zabbix owner=zabbix;\" >> /root/create.sql\n/usr/bin/psql -f /root/create.sql -U postgres -p 8765\nrm -f /root/create.sql\n\n# \u4e8b\u524d\u306b\u69cb\u6210\u306b\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install libcurl-devel libzip zlib-devel gcc libxml2-devel net-snmp-devel libcurl-devel expect\n\n# apache 2.2\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u6700\u65b0\u7248\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install httpd httpd-devel --enablerepo=CentALT\necho \"ServerName `hostname`:80\" >> /etc/httpd/conf/httpd.conf\n\n# php\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install php php-common php-mbstring php-xml php-gd php-bcmath php-pgsql --enablerepo=remi,remi-php56\n\n# php.ini\u4fee\u6b63\nsed -i -e \"s/post_max_size = 8M/post_max_size = 16M/g\" /etc/php.ini\nsed -i -e \"s/max_execution_time = 30/max_execution_time = 300/g\" /etc/php.ini\nsed -i -e \"s/max_input_time = 60/max_input_time = 300/g\" /etc/php.ini\nsed -i -e \"s/;date.timezone =/date.timezone = Asia\\/Tokyo/g\" /etc/php.ini\nsed -i -e \"s/;always_populate_raw_post_data/always_populate_raw_post_data/g\" /etc/php.ini\nsed -i -e \"s/memory_limit = 128M/memory_limit = 256M/g\" /etc/php.ini\n\n# OS\u4e0a\u306e\u30e6\u30fc\u30b6:zabbix \u30d1\u30b9\u30ef\u30fc\u30c9:XXXXXXXXXXXX \u30b0\u30eb\u30fc\u30d7:zabbix\u306e\u4f5c\u6210\ngroupadd zabbix\nuseradd -g zabbix zabbix\necho XXXXXXXXXXXX | passwd --stdin zabbix\n\n# zabbix\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ncd /root/\nwget 'http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Development/2.5.0/zabbix-2.5.0.tar.gz'\ntar -zxvf zabbix-2.5.0.tar.gz\n\n# zabbix\u306ePostgreSQL\u3078\u306e\u30af\u30a8\u30ea\u66f8\u304d\u51fa\u3057\ncd /root/zabbix-2.5.0/database/postgresql\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/schema.sh\necho \"expect -c \\\"\" >> /root/schema.sh\necho \"set timeout 5\" >> /root/schema.sh\necho \"spawn psql -p 8765 -W -d zabbix -f schema.sql zabbix\" >> /root/schema.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/schema.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/schema.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/schema.sh\necho \"exit 0\" >> /root/schema.sh\necho \"\\\"\" >> /root/schema.sh\nchmod u+x /root/schema.sh\nsh /root/schema.sh\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/images.sh\necho \"expect -c \\\"\" >> /root/images.sh\necho \"set timeout 5\" >> /root/images.sh\necho \"spawn psql -p 8765 -W -d zabbix -f images.sql zabbix\" >> /root/images.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/images.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/images.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/images.sh\necho \"exit 0\" >> /root/images.sh\necho \"\\\"\" >> /root/images.sh\nchmod u+x /root/images.sh\nsh /root/images.sh\n\necho \"PW=\\\"XXXXXXXXXXXX\\\"\" >> /root/data.sh\necho \"expect -c \\\"\" >> /root/data.sh\necho \"set timeout 5\" >> /root/data.sh\necho \"spawn psql -p 8765 -W -d zabbix -f data.sql zabbix\" >> /root/data.sh\necho \"expect \\\\\\\"\u30e6\u30fc\u30b6 zabbix \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\\\\\\\" \" >> /root/data.sh\necho \"send \\\\\\\"\\${PW}\\n\\\\\\\"\" >> /root/data.sh\necho \"expect \\\\\\\"$\\\\\\\"\" >> /root/data.sh\necho \"exit 0\" >> /root/data.sh\necho \"\\\"\" >> /root/data.sh\nchmod u+x /root/data.sh\nsh /root/data.sh\n\nrm -f /root/schema.sh\nrm -f /root/images.sh\nrm -f /root/data.sh\n\n# configure\u304b\u3089make install\u307e\u3067\ncd /root/zabbix-2.5.0/\n./configure --enable-server --enable-agent --with-postgresql=/usr/pgsql-9.5/bin/pg_config --enable-ipv6 --with-net-snmp --with-libcurl --with-libxml2\nmake && make install\n\n# \u300c/usr/local/etc/zabbix_server.conf\u300d\u306e\u4fee\u6b63\nmkdir /var/run/zabbix\nmkdir /var/log/zabbix\nchown -R zabbix:zabbix /var/run/zabbix\nchown -R zabbix:zabbix /var/log/zabbix\n\nsed -i -e \"s/LogFile=\\/tmp\\/zabbix_server.log/LogFile=\\/var\\/log\\/zabbix\\/zabbix_server.log/g\" /usr/local/etc/zabbix_server.conf\necho \"PidFile=/var/run/zabbix/zabbix_server.pid\" >> /usr/local/etc/zabbix_server.conf\necho \"DBHost=localhost\" >> /usr/local/etc/zabbix_server.conf\necho \"DBSocket=/tmp/.s.PGSQL.8765\" >> /usr/local/etc/zabbix_server.conf\necho \"DBPassword=XXXXXXXXXXXX\" >> /usr/local/etc/zabbix_server.conf\necho \"DBPort=8765\" >> /usr/local/etc/zabbix_server.conf\necho \"ListenPort=10051\" >> /usr/local/etc/zabbix_server.conf\necho \"ListenIP=127.0.0.1\" >> /usr/local/etc/zabbix_server.conf\n\n# \u516c\u958b\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u914d\u7f6e\nmkdir /var/www/html/zabbix\ncp -frapi /root/zabbix-2.5.0/frontends/php/* /var/www/html/zabbix\n\n# \u300c/var/www/html/zabbix/conf/zabbix.conf.php\u300d\u306e\u66f8\u304d\u51fa\u3057\necho \"<?php\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"// Zabbix GUI configuration file.\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"global \\$DB;\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['TYPE']     = 'POSTGRESQL';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['SERVER']   = 'localhost';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['PORT']     = '8765';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['DATABASE'] = 'zabbix';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['USER']     = 'zabbix';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['PASSWORD'] = 'XXXXXXXXXXXX';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"// Schema name. Used for IBM DB2 and PostgreSQL.\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$DB['SCHEMA'] = '';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER      = 'localhost';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER_PORT = '8765';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$ZBX_SERVER_NAME = '';\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"\\$IMAGE_FORMAT_DEFAULT = IMAGE_FORMAT_PNG;\" >> /var/www/html/zabbix/conf/zabbix.conf.php\necho \"?>\" >> /var/www/html/zabbix/conf/zabbix.conf.php\n\n# \u300c/var/www/html/zabbix/conf/zabbix.conf.php\u300d\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u5909\u66f4\nchmod 666 /var/www/html/zabbix/conf/zabbix.conf.php\n\n# zabbix-serve\u306e\u8d77\u52d5 (\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8d77\u52d5\u30b9\u30d7\u30ea\u30af\u30c8\u3092\u767b\u9332\u3059\u308b\u3002)\n/usr/local/sbin/zabbix_server\n\n# zabbix\u4e2d\u306e\u30b0\u30e9\u30d5\u306e\u6587\u5b57\u5316\u3051\u5bfe\u5fdc\nyum -y install vlgothic-p-fonts\ncd /var/www/html/zabbix/fonts\nln -s /usr/share/fonts/vlgothic/VL-PGothic-Regular.ttf ./VL-PGothic-Regular.ttf\n\n# \u30d5\u30a9\u30f3\u30c8\u6307\u5b9a\u3092\"DejaVuSans\"\u304b\u3089\"VL-PGothic-Regular\"\u306b\u5909\u66f4\nsed -i -e \"s/DejaVuSans/VL-PGothic-Regular/g\" /var/www/html/zabbix/include/defines.inc.php\n\n# Apache\u306e\u8d77\u52d5\nservice httpd start\n\n# OS\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\nchkconfig httpd on\nchkconfig postgresql-9.5 on\n```\n\nsh\u30d5\u30a1\u30a4\u30eb\u306b\u5b9f\u884c\u6a29\u9650\u3092\u3064\u3051\u3066\n`chmod u+x /root/setup-zabbix.sh`\n\nsh\u3092\u52d5\u304b\u3057\u307e\u3059\n`sh /root/setup-zabbix.sh`\n\n\u3053\u308c\u3060\u3051\u3067\u3057\u3070\u3089\u304f\u5f85\u3066\u3070\u69cb\u7bc9\u304c\u7d42\u308f\u3063\u3061\u3083\u3044\u307e\u3059\n\n\u4e00\u901a\u308a\u7d42\u308f\u3063\u305f\u5f8c\u3001\u30d6\u30e9\u30a6\u30b6\u3067\u3044\u3064\u3082\u306eURL\u3067\u3044\u3064\u3082\u306eAdmin\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n`http://{\u30b5\u30fc\u30d0IP}/zabbix/`\n\n\u5f8c\u306f\u3088\u3057\u306a\u306bzabbix\u30e9\u30a4\u30d5\u3092\u30a8\u30f3\u30b8\u30e7\u30a4\u3057\u3066\u4e0b\u3055\u3044\n\n((\u8ffd\u8a18))\nCentOS6.7\u306b\u3064\u304d\u3001pgdg\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306f\u3001\u4ee5\u4e0b\u306erhel7\u7cfb\u306e\u3082\u306e\nhttp://yum.postgresql.org/9.5/redhat/rhel-7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\u3092\u5229\u7528\u305b\u305a\nhttp://yum.postgresql.org/9.5/redhat/rhel-6.7-x86_64/pgdg-centos95-9.5-2.noarch.rpm\n\u3092\u5229\u7528\u3059\u308b\u624b\u9806\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\niwaim@github\u3055\u3093\u3001\u3054\u6307\u6458\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\n", "tags": ["zabbix", "PHP", "CentOS", "PostgreSQL"]}