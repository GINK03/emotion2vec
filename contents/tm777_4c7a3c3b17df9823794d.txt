{"context": "Web\u30d5\u30a9\u30fc\u30e0\u306eASP.NET4.5\u3067\u8ffd\u52a0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3067\u306f\u3001\"1,000\"\u306e\u3088\u3046\u306a\u30ab\u30f3\u30de\u7de8\u96c6\u3055\u308c\u305f\u6570\u5024\u306f\u30a8\u30e9\u30fc\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002ASP.NET MVC\u3067\u3082\u540c\u3058\u3053\u3068\u304c\u8d77\u3053\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c0\u30fc\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u3067\u5272\u3068\u7c21\u5358\u306b\u89e3\u6c7a\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001Web\u30d5\u30a9\u30fc\u30e0\u306b\u540c\u3058\u3084\u308a\u65b9\u3092\u3057\u3066\u3082\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3002\u7de8\u96c6\u6642\u306f\u6570\u5024\u3092\u30ab\u30f3\u30de\u7de8\u96c6\u3057\u306a\u3044\u904b\u7528\u306b\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u30ab\u30f3\u30de\u7de8\u96c6\u3057\u3066\u304a\u304d\u305f\u3044\u3053\u3068\u3082\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067Web\u30d5\u30a9\u30fc\u30e0\u306e\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u8003\u3048\u307e\u3057\u305f\u3002.NET\u306e\u30bd\u30fc\u30b9\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u62dd\u501f\u3057\u3066\u5fc5\u8981\u306a\u4fee\u6b63\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306fGlobal.asax.cs\u306b\uff12\u884c\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nGlobal.asax.cs\nusing System.Web.ModelBinding;    //\u2190\u8ffd\u52a0\n\nnamespace WebApplication1\n{\n    public class Global : HttpApplication\n    {\n        void Application_Start(object sender, EventArgs e)\n        {\n            // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3067\u3059\n            RouteConfig.RegisterRoutes(RouteTable.Routes);\n            BundleConfig.RegisterBundles(BundleTable.Bundles);\n\n            //\u2193\u8ffd\u52a0\n            ((DefaultModelBinder)ModelBinders.Binders.DefaultBinder).Providers[7] = new CustomTypeConverterModelBinderProvider();\n        }\n    }\n}\n\n\n\u6b21\u306bTypeConverteModelBinderProvider\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u307e\u3059\u3002.NET\u306e\u30bd\u30fc\u30b9\u304b\u3089\u8a72\u5f53\u7b87\u6240\u3092\u6301\u3063\u3066\u304d\u3066\u3001internal\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\u4f7f\u7528\u3067\u304d\u306a\u3044\u7b87\u6240\u306b\u3064\u3044\u3066\u3001\u66f8\u304d\u63db\u3048\u305f\u308a\u3001\u52d5\u4f5c\u306b\u652f\u969c\u304c\u306a\u3051\u308c\u3070\u524a\u9664\u3057\u307e\u3059\u3002\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.ModelBinding;\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.ComponentModel;\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.Diagnostics.CodeAnalysis;\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.Globalization;\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\n\nnamespace WebApplication1\n{\n    // Returns a binder that can perform conversions using a .NET TypeConverter.\n    public sealed class CustomTypeConverterModelBinderProvider : ModelBinderProvider\n    {\n\n        public override IModelBinder GetBinder(ModelBindingExecutionContext modelBindingExecutionContext, ModelBindingContext bindingContext)\n        {\n            //ModelBinderUtil.ValidateBindingContext(bindingContext);\u3000\u3000//\u2190\u524a\u9664\n\n            //ValueProviderResult vpResult = bindingContext.UnvalidatedValueProvider.GetValue(bindingContext.ModelName, skipValidation: !bindingContext.ValidateRequest);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ValueProviderResult vpResult = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);\n            if (vpResult == null)\n            {\n                return null; // no value to convert\n            }\n\n            if (!TypeDescriptor.GetConverter(bindingContext.ModelType).CanConvertFrom(typeof(string)))\n            {\n                return null; // this type cannot be converted\n            }\n\n            return new CustomTypeConverterModelBinder();\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n        }\n\n    }\n\n    public sealed class CustomTypeConverterModelBinder : IModelBinder\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n    {\n\n        [SuppressMessage(\"Microsoft.Design\", \"CA1031:DoNotCatchGeneralExceptionTypes\", Justification = \"The exception is recorded to be acted upon later.\")]\n        [SuppressMessage(\"Microsoft.Globalization\", \"CA1304:SpecifyCultureInfo\", MessageId = \"System.Web.ModelBinding.ValueProviderResult.ConvertTo(System.Type)\", Justification = \"The ValueProviderResult already has the necessary context to perform a culture-aware conversion.\")]\n        public bool BindModel(ModelBindingExecutionContext modelBindingExecutionContext, ModelBindingContext bindingContext)\n        {\n            //ModelBinderUtil.ValidateBindingContext(bindingContext);\u3000\u3000//\u2190\u524a\u9664\n\n            //ValueProviderResult vpResult = bindingContext.UnvalidatedValueProvider.GetValue(bindingContext.ModelName, skipValidation: !bindingContext.ValidateRequest);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ValueProviderResult vpResult = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);\n            if (vpResult == null)\n            {\n                return false; // no entry\n            }\n\n            object newModel;\n            bindingContext.ModelState.SetModelValue(bindingContext.ModelName, vpResult);\n            try\n            {\n                //Decimal\u306e\u5834\u5408\u3001\u30ab\u30f3\u30de\u304c\u3042\u3063\u3066\u3082\u6570\u5024\u306b\u5909\u63db\u3059\u308b\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n                if (bindingContext.ModelType == typeof(Decimal) || bindingContext.ModelType == typeof(Nullable<Decimal>))\n                {\n                    newModel = Decimal.Parse(vpResult.AttemptedValue, NumberStyles.Any);\n                }\n                else\n                {\n                    newModel = vpResult.ConvertTo(bindingContext.ModelType);\n                }\n            }\n            catch (Exception ex)\n            {\n                if (IsFormatException(ex))\n                {\n                    // there was a type conversion failure\n                    string errorString = ModelBinderErrorMessageProviders.TypeConversionErrorMessageProvider(modelBindingExecutionContext, bindingContext.ModelMetadata, vpResult.AttemptedValue);\n                    if (errorString != null)\n                    {\n                        bindingContext.ModelState.AddModelError(bindingContext.ModelName, errorString);\n                    }\n                }\n                else\n                {\n                    bindingContext.ModelState.AddModelError(bindingContext.ModelName, ex);\n                }\n                return false;\n            }\n\n            //ModelBinderUtil.ReplaceEmptyStringWithNull(bindingContext.ModelMetadata, ref newModel);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ReplaceEmptyStringWithNull(bindingContext.ModelMetadata, ref newModel);\n            bindingContext.Model = newModel;\n            return true;\n        }\n\n        private static bool IsFormatException(Exception ex)\n        {\n            for (; ex != null; ex = ex.InnerException)\n            {\n                if (ex is FormatException)\n                {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        public static void ReplaceEmptyStringWithNull(ModelMetadata modelMetadata, ref object model)\n        {\n            if (modelMetadata.ConvertEmptyStringToNull && StringIsEmptyOrWhitespace(model as string))\n            {\n                model = null;\n            }\n        }\n\n        // Based on String.IsNullOrWhitespace\n        private static bool StringIsEmptyOrWhitespace(string s)\n        {\n            if (s == null)\n            {\n                return false;\n            }\n\n            if (s.Length != 0)\n            {\n                for (int i = 0; i < s.Length; i++)\n                {\n                    if (!Char.IsWhiteSpace(s[i]))\n                    {\n                        return false;\n                    }\n                }\n            }\n            return true;\n        }\n     }\n}\n\n\n\u3053\u308c\u3067\u30ab\u30f3\u30de\u7de8\u96c6\u3055\u308c\u305f\u6570\u5024\u3082\u30a8\u30e9\u30fc\u306a\u304f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\u4ee5\u4e0a\nWeb\u30d5\u30a9\u30fc\u30e0\u306eASP.NET4.5\u3067\u8ffd\u52a0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3067\u306f\u3001\"1,000\"\u306e\u3088\u3046\u306a\u30ab\u30f3\u30de\u7de8\u96c6\u3055\u308c\u305f\u6570\u5024\u306f\u30a8\u30e9\u30fc\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002ASP.NET MVC\u3067\u3082\u540c\u3058\u3053\u3068\u304c\u8d77\u3053\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c0\u30fc\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u3067\u5272\u3068\u7c21\u5358\u306b\u89e3\u6c7a\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001Web\u30d5\u30a9\u30fc\u30e0\u306b\u540c\u3058\u3084\u308a\u65b9\u3092\u3057\u3066\u3082\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3002\u7de8\u96c6\u6642\u306f\u6570\u5024\u3092\u30ab\u30f3\u30de\u7de8\u96c6\u3057\u306a\u3044\u904b\u7528\u306b\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u30ab\u30f3\u30de\u7de8\u96c6\u3057\u3066\u304a\u304d\u305f\u3044\u3053\u3068\u3082\u591a\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067Web\u30d5\u30a9\u30fc\u30e0\u306e\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u8003\u3048\u307e\u3057\u305f\u3002.NET\u306e\u30bd\u30fc\u30b9\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u62dd\u501f\u3057\u3066\u5fc5\u8981\u306a\u4fee\u6b63\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306fGlobal.asax.cs\u306b\uff12\u884c\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```csharp:Global.asax.cs\nusing System.Web.ModelBinding;    //\u2190\u8ffd\u52a0\n\nnamespace WebApplication1\n{\n    public class Global : HttpApplication\n    {\n        void Application_Start(object sender, EventArgs e)\n        {\n            // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30fc\u30c9\u3067\u3059\n            RouteConfig.RegisterRoutes(RouteTable.Routes);\n            BundleConfig.RegisterBundles(BundleTable.Bundles);\n\n            //\u2193\u8ffd\u52a0\n            ((DefaultModelBinder)ModelBinders.Binders.DefaultBinder).Providers[7] = new CustomTypeConverterModelBinderProvider();\n        }\n    }\n}\n```\n\u6b21\u306bTypeConverteModelBinderProvider\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u307e\u3059\u3002.NET\u306e\u30bd\u30fc\u30b9\u304b\u3089\u8a72\u5f53\u7b87\u6240\u3092\u6301\u3063\u3066\u304d\u3066\u3001internal\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\u4f7f\u7528\u3067\u304d\u306a\u3044\u7b87\u6240\u306b\u3064\u3044\u3066\u3001\u66f8\u304d\u63db\u3048\u305f\u308a\u3001\u52d5\u4f5c\u306b\u652f\u969c\u304c\u306a\u3051\u308c\u3070\u524a\u9664\u3057\u307e\u3059\u3002\n\n```csharp:\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Web;\nusing System.Web.ModelBinding;\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.ComponentModel;\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.Diagnostics.CodeAnalysis;\u3000\u3000//\u2190\u8ffd\u52a0\nusing System.Globalization;\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//\u2190\u8ffd\u52a0\n\nnamespace WebApplication1\n{\n    // Returns a binder that can perform conversions using a .NET TypeConverter.\n    public sealed class CustomTypeConverterModelBinderProvider : ModelBinderProvider\n    {\n\n        public override IModelBinder GetBinder(ModelBindingExecutionContext modelBindingExecutionContext, ModelBindingContext bindingContext)\n        {\n            //ModelBinderUtil.ValidateBindingContext(bindingContext);\u3000\u3000//\u2190\u524a\u9664\n\n            //ValueProviderResult vpResult = bindingContext.UnvalidatedValueProvider.GetValue(bindingContext.ModelName, skipValidation: !bindingContext.ValidateRequest);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ValueProviderResult vpResult = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);\n            if (vpResult == null)\n            {\n                return null; // no value to convert\n            }\n\n            if (!TypeDescriptor.GetConverter(bindingContext.ModelType).CanConvertFrom(typeof(string)))\n            {\n                return null; // this type cannot be converted\n            }\n\n            return new CustomTypeConverterModelBinder();\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n        }\n\n    }\n\n    public sealed class CustomTypeConverterModelBinder : IModelBinder\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n    {\n\n        [SuppressMessage(\"Microsoft.Design\", \"CA1031:DoNotCatchGeneralExceptionTypes\", Justification = \"The exception is recorded to be acted upon later.\")]\n        [SuppressMessage(\"Microsoft.Globalization\", \"CA1304:SpecifyCultureInfo\", MessageId = \"System.Web.ModelBinding.ValueProviderResult.ConvertTo(System.Type)\", Justification = \"The ValueProviderResult already has the necessary context to perform a culture-aware conversion.\")]\n        public bool BindModel(ModelBindingExecutionContext modelBindingExecutionContext, ModelBindingContext bindingContext)\n        {\n            //ModelBinderUtil.ValidateBindingContext(bindingContext);\u3000\u3000//\u2190\u524a\u9664\n\n            //ValueProviderResult vpResult = bindingContext.UnvalidatedValueProvider.GetValue(bindingContext.ModelName, skipValidation: !bindingContext.ValidateRequest);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ValueProviderResult vpResult = bindingContext.ValueProvider.GetValue(bindingContext.ModelName);\n            if (vpResult == null)\n            {\n                return false; // no entry\n            }\n\n            object newModel;\n            bindingContext.ModelState.SetModelValue(bindingContext.ModelName, vpResult);\n            try\n            {\n                //Decimal\u306e\u5834\u5408\u3001\u30ab\u30f3\u30de\u304c\u3042\u3063\u3066\u3082\u6570\u5024\u306b\u5909\u63db\u3059\u308b\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n                if (bindingContext.ModelType == typeof(Decimal) || bindingContext.ModelType == typeof(Nullable<Decimal>))\n                {\n                    newModel = Decimal.Parse(vpResult.AttemptedValue, NumberStyles.Any);\n                }\n                else\n                {\n                    newModel = vpResult.ConvertTo(bindingContext.ModelType);\n                }\n            }\n            catch (Exception ex)\n            {\n                if (IsFormatException(ex))\n                {\n                    // there was a type conversion failure\n                    string errorString = ModelBinderErrorMessageProviders.TypeConversionErrorMessageProvider(modelBindingExecutionContext, bindingContext.ModelMetadata, vpResult.AttemptedValue);\n                    if (errorString != null)\n                    {\n                        bindingContext.ModelState.AddModelError(bindingContext.ModelName, errorString);\n                    }\n                }\n                else\n                {\n                    bindingContext.ModelState.AddModelError(bindingContext.ModelName, ex);\n                }\n                return false;\n            }\n\n            //ModelBinderUtil.ReplaceEmptyStringWithNull(bindingContext.ModelMetadata, ref newModel);\u3000\u3000//\u2190\u66f8\u304d\u63db\u3048\n            ReplaceEmptyStringWithNull(bindingContext.ModelMetadata, ref newModel);\n            bindingContext.Model = newModel;\n            return true;\n        }\n\n        private static bool IsFormatException(Exception ex)\n        {\n            for (; ex != null; ex = ex.InnerException)\n            {\n                if (ex is FormatException)\n                {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        public static void ReplaceEmptyStringWithNull(ModelMetadata modelMetadata, ref object model)\n        {\n            if (modelMetadata.ConvertEmptyStringToNull && StringIsEmptyOrWhitespace(model as string))\n            {\n                model = null;\n            }\n        }\n\n        // Based on String.IsNullOrWhitespace\n        private static bool StringIsEmptyOrWhitespace(string s)\n        {\n            if (s == null)\n            {\n                return false;\n            }\n\n            if (s.Length != 0)\n            {\n                for (int i = 0; i < s.Length; i++)\n                {\n                    if (!Char.IsWhiteSpace(s[i]))\n                    {\n                        return false;\n                    }\n                }\n            }\n            return true;\n        }\n     }\n}\n\n```\n\u3053\u308c\u3067\u30ab\u30f3\u30de\u7de8\u96c6\u3055\u308c\u305f\u6570\u5024\u3082\u30a8\u30e9\u30fc\u306a\u304f\u30e2\u30c7\u30eb\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\n\u4ee5\u4e0a\n", "tags": ["ASP.NET"]}