{"tags": ["zabbix", "centos7", "PHP7", "h2o"], "context": " More than 1 year has passed since last update.\nCentOS 7.1.1503\nSELinux\u7121\u52b9\u5316\u6e08\u307f\n\n\nepel\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nyum install -y epel-release\n\n\nPHP7\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  autoconf \\\n  make \\\n  gcc \\\n  gcc-c++ \\\n  bison \\\n  net-snmp-devel \\\n  libxml2-devel \\\n  openssl-devel \\\n  freetype-devel \\\n  mariadb-devel \\\n  libcurl-devel \\\n  libpng-devel \\\n  libjpeg-turbo-devel \\\n  openldap-devel \\\n  libmcrypt-devel \\\n  readline-devel \\\n  gd-devel \\\n  bzip2-devel \\\n  libicu-devel \\\n  libwebp-devel \\\n  gmp-devel \\\n  libtidy-devel \\\n  libxslt-devel\n\n# \u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\ncurl -L https://github.com/php/php-src/archive/php-7.0.0RC2.tar.gz > php-7.0.0RC2.tar.gz\ntar zxf php-7.0.0RC2.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd php-src-php-7.0.0RC2\n./buildconf --force\n./configure \\\n  --prefix=/opt/php7 \\\n  --with-libdir=lib64 \\\n  --enable-fpm \\\n  --enable-mbstring \\\n  --enable-mysqlnd \\\n  --enable-bcmath \\\n  --enable-sockets \\\n  --enable-exif \\\n  --enable-gd-native-ttf \\\n  --enable-gd-jis-conv \\\n  --enable-intl \\\n  --enable-pcntl \\\n  --enable-soap \\\n  --enable-wddx \\\n  --enable-zip \\\n  --with-openssl \\\n  --with-pcre-regex \\\n  --with-zlib \\\n  --with-bz2 \\\n  --with-curl \\\n  --with-gd \\\n  --with-webp-dir \\\n  --with-jpeg-dir \\\n  --with-png-dir \\\n  --with-zlib-dir \\\n  --with-xpm-dir \\\n  --with-freetype-dir \\\n  --with-gettext \\\n  --with-gmp \\\n  --with-mhash \\\n  --with-icu-dir=/usr \\\n  --with-ldap \\\n  --with-onig \\\n  --with-mcrypt \\\n  --with-mysqli=mysqlnd \\\n  --with-pdo-mysql=mysqlnd \\\n  --with-readline \\\n  --with-snmp \\\n  --with-tidy \\\n  --with-xsl \\\n  --with-gnu-ld\n\nmake -j$(nproc)\nmake install\n\n\n\u30cf\u30de\u3063\u305f\n--with-jpeg-dir, --with-freetype-dir\u306b=/usr\u3092\u3064\u3051\u305f\u3089\u8a8d\u8b58\u3055\u308c\u306a\u304b\u3063\u305f\u306e\u3067\u6ce8\u610f\u3002\n\nH2O\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  make \\\n  gcc \\\n  cmake \\\n  libyaml-devel \\\n  openssl-devel\n\n# Github\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ncd; curl -L https://github.com/h2o/h2o/archive/v1.4.4.tar.gz > h2o-1.4.4.tar.gz\ntar zxf h2o-1.4.4.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd h2o-1.4.4\ncmake -DCMAKE_INSTALL_PREFIX=/opt/h2o .\nmake h2o && make install\n\n# \u30b5\u30f3\u30d7\u30eb\u8a3c\u660e\u66f8\u3092\u30b3\u30d4\u30fc\ncp examples/h2o/server.* /opt/h2o/\nchmod 600 /opt/h2o/server.*\n\n# h2o\u30e6\u30fc\u30b6\u4f5c\u6210\ngroupadd h2o\nuseradd -g h2o -s /sbin/nologin -d /opt/h2o h2o\n\n\nMariaDB\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y mariadb-server\nsystemctl enable mariadb\nsystemctl start mariadb\n\n\nZABBIX 2.5(3.0\u03b1)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# zabbix\u30e6\u30fc\u30b6\u4f5c\u6210\ngroupadd zabbix\nuseradd -g zabbix zabbix\n\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  mariadb-devel \\\n  libxml2-devel \\\n  net-snmp-devel \\\n  libcurl-devel \\\n  libssh2-devel \\\n  openldap-devel \\\n  java-1.8.0-openjdk-devel\n\n# \u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\ncd; curl -L http://goo.gl/BzG5RL > zabbix-2.5.0.tar.gz\ntar zxf zabbix-2.5.0.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd zabbix-2.5.0\n./configure \\\n  --enable-server \\\n  --enable-agent \\\n  --enable-java \\\n  --with-mysql \\\n  --with-net-snmp \\\n  --with-libcurl \\\n  --with-libxml2 \\\n  --with-ssh2 \\\n  --with-ldap \\\n  --with-iconv\nmake -j$(nproc) install\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316\ncd database/mysql\nmysql -uroot -e \"create database zabbix character set utf8 collate utf8_bin;\"\nmysql -uroot -e \"grant all on zabbix.* to zabbix@localhost identified by 'zabbix';\"\nmysql -uroot zabbix < schema.sql\nmysql -uroot zabbix < images.sql\nmysql -uroot zabbix < data.sql\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\ncp /usr/local/etc/zabbix_server.conf /usr/local/etc/zabbix_server.conf.orig\necho DBPassword=zabbix >> /usr/local/etc/zabbix_server.conf\n\n# ZABBIX systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/zabbix-server.service\n[Unit]\nDescription=Zabbix Server\nAfter=network.target mariadb.service\n\n[Service]\nType=oneshot\nExecStart=/usr/local/sbin/zabbix_server -c /usr/local/etc/zabbix_server.conf\nExecReload=/usr/local/sbin/zabbix_server -R config_cache_reload\nRemainAfterExit=yes\nPIDFile=/tmp/zabbix_server.pid\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# ZABBIX\u8d77\u52d5\nsystemctl daemon-reload\nsystemctl start zabbix-server\nsystemctl enable zabbix-server\n\n\nZABBIX\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u8a2d\u5b9a\n# php-fpm\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\ncp /opt/php7/etc/php-fpm.conf.default /tmp/php-fpm.conf\nsed -i 's/;pid = .*$/pid = run\\/php-fpm.pid/' /tmp/php-fpm.conf\ncp /opt/php7/etc/php-fpm.d/www.conf.default /tmp/www.conf\nsed -i 's/;listen.owner = nobody/listen.owner = h2o/' /tmp/www.conf\nsed -i 's/;listen.group = nobody/listen.group = h2o/' /tmp/www.conf\nsed -i 's/user = nobody/user = h2o/' /tmp/www.conf\nsed -i 's/group = nobody/group = h2o/' /tmp/www.conf\nsed -i 's|listen = 127.0.0.1:9000|listen = /tmp/php-fpm.sock|' /tmp/www.conf\ncp /tmp/www.conf /opt/php7/etc/php-fpm.d/www.conf\ncp /tmp/php-fpm.conf /opt/php7/etc/php-fpm.conf\n\n#php.ini \u4f5c\u6210\ncd; cd php-src-php-7.0.0RC2\ncp php.ini-production /tmp/php.ini\nsed -i 's/^post_max_size =.*$/post_max_size = 16M/' /tmp/php.ini\nsed -i 's/^max_input_time =.*$/max_input_time = 300/' /tmp/php.ini\nsed -i 's/^max_execution_time =.*$/max_execution_time = 300/' /tmp/php.ini\nsed -i 's/^;date.timezone =.*$/date.timezone = Asia\\/Tokyo/' /tmp/php.ini\nsed -i 's/^;mbstring.language =.*$/mbstring.language = Japanese/' /tmp/php.ini\n# mysqli.default_socket \u3053\u308c\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068ZABBIX\u304c\u8a8d\u8b58\u3057\u3066\u304f\u308c\u306a\u304b\u3063\u305f\nsed -i 's/^mysqli.default_socket =.*$/mysqli.default_socket = \\/var\\/lib\\/mysql\\/mysql.sock/' /tmp/php.ini\ncp /tmp/php.ini /opt/php7/lib/php/php.ini\n\n# H2O\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /opt/h2o/h2o.conf\nuser: h2o\naccess-log: /var/log/h2o/access.log\nerror-log: /var/log/h2o/error.log\npid-file: /var/run/h2o/pid\nhttp2-reprioritize-blocking-assets: ON\n\nfile.custom-handler:\n  extension: .php\n  fastcgi.connect:\n    port: /tmp/php-fpm.sock\n    type: unix\n  # fastcgi\u3092h2o\u3067\u7ba1\u7406\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u3092\u30b3\u30e1\u30f3\u30c8\u89e3\u9664\n  # fastcgi.spawn: \"PHP_FCGI_CHILDREN=10 exec /opt/php7/bin/php-cgi -c /opt/php7/lib/php/php.ini\"\n\nfile.index: [ 'index.php', 'index.html' ]\n\nhosts:\n  \"localhost\":\n    listen:\n      host: 0.0.0.0\n      port: 443\n      ssl:\n        certificate-file: /opt/h2o/server.crt\n        key-file: /opt/h2o/server.key\n    paths:\n      \"/zabbix\":\n        file.dir: /opt/h2o/html/zabbix\nEOT\n\n# php-fpm systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/php-fpm.service\n[Unit]\nDescription=PHP FastCGI Server\nAfter=network.target remote-fs.target\n\n[Service]\nType=forking\nPIDFile=/opt/php7/var/run/php-fpm.pid\nWorkingDirectory=/opt/php7\nExecStartPre=/usr/bin/chown -R h2o:h2o /opt/php7/var\nExecStart=/opt/php7/sbin/php-fpm -c /opt/php7/lib/php/php.ini -D\nExecReload=/usr/bin/kill -HUP $MAINPID\nLimitNOFILE=infinity\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# h2o systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/h2o.service\n[Unit]\nDescription=h2o optimized HTTP server\nAfter=php-fpm.service\n\n[Service]\nType=forking\nPIDFile=/var/run/h2o/pid\nWorkingDirectory=/opt/h2o\nExecStartPre=-/usr/bin/mkdir -p /var/run/h2o /var/log/h2o\nExecStartPre=-/usr/bin/chown h2o:h2o /var/run/h2o /var/log/h2o\nExecStart=/opt/h2o/bin/h2o -c /opt/h2o/h2o.conf -m daemon\nExecReload=/usr/bin/kill -HUP $MAINPID\nLimitNOFILE=infinity\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# php-fpm \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u4e8b\u524d\u4f5c\u6210\ntouch /opt/php7/var/log/php-fpm.log\nchmod 775 /opt/php7/var/log/php-fpm.log\nchown -R h2o:h2o /opt/php7/var\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsystemctl daemon-reload\nsystemctl start php-fpm\nsystemctl start h2o\nsystemctl enable h2o\nsystemctl enable php-fpm\n\n# ZABBIX\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30d5\u30a1\u30a4\u30eb\u914d\u7f6e\nmkdir -p /opt/h2o/html/zabbix\ncp -r ~/zabbix-2.5.0/frontends/php/* /opt/h2o/html/zabbix/\nchown -R h2o:h2o /opt/h2o/html\n\n# always_populate_raw_post_data(PHP7\u3067\u524a\u9664)\u306e\u30c1\u30a7\u30c3\u30af\u3092\u7121\u52b9\u306b\u3059\u308b\ncp /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig\nvi /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php\ndiff -u /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php\n# diff\u5185\u5bb9 \u3053\u3053\u304b\u3089 ---------------------------------------------------------------------------\n--- /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig  2015-09-14 11:55:24.029602938 +0900\n+++ /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php       2015-09-14 11:57:28.443415294 +0900\n@@ -72,7 +72,7 @@\n                }\n\n                // check for deprecated PHP 5.6.0 option 'always_populate_raw_post_data'\n-               if (version_compare(PHP_VERSION, '5.6', '>=')) {\n+               if (version_compare(PHP_VERSION, '5.6', '>=') && version_compare(PHP_VERSION, '7', '<')) {\n                        $result[] = $this->checkPhpAlwaysPopulateRawPostData();\n                }\n                $result[] = $this->checkPhpSockets();\n# diff\u5185\u5bb9 \u3053\u3053\u307e\u3067 ---------------------------------------------------------------------------\n\n\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u958b\u653e\nfirewall-cmd --add-service https --zone public --permanent\nfirewall-cmd --add-port 10051/tcp --zone public --permanent\nfirewall-cmd --reload\n\n\n\u30b0\u30e9\u30d5\u6587\u5b57\u5316\u3051\u5bfe\u5fdc\nyum install -y vlgothic-p-fonts\ncd /opt/h2o/html/zabbix/fonts\nsudo -uh2o ln -s /usr/share/fonts/vlgothic/VL-PGothic-Regular.ttf ./VL-PGothic-Regular.ttf\nsed -i.orig 's/DejaVuSans/VL-PGothic-Regular/g' /opt/h2o/html/zabbix/include/defines.inc.php\n\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u30d6\u30e9\u30a6\u30b6\u3067 ${hostname}:443/zabbix/ \u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n\n\n\n\n\nAdmin/zabbix \u3067\u30b5\u30a4\u30f3\u30a4\u30f3\n\n\n\u53f3\u4e0a\u306e\u4eba\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066[Language]\u3092[Japanese[ja_JP]\u306b\u5909\u66f4\n\n\u65e5\u672c\u8a9e\u306b\u306a\u308a\u307e\u3057\u305f\n\n\n- CentOS 7.1.1503\n- SELinux\u7121\u52b9\u5316\u6e08\u307f\n\n# epel\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n```bash\nyum install -y epel-release\n```\n\n# PHP7\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  autoconf \\\n  make \\\n  gcc \\\n  gcc-c++ \\\n  bison \\\n  net-snmp-devel \\\n  libxml2-devel \\\n  openssl-devel \\\n  freetype-devel \\\n  mariadb-devel \\\n  libcurl-devel \\\n  libpng-devel \\\n  libjpeg-turbo-devel \\\n  openldap-devel \\\n  libmcrypt-devel \\\n  readline-devel \\\n  gd-devel \\\n  bzip2-devel \\\n  libicu-devel \\\n  libwebp-devel \\\n  gmp-devel \\\n  libtidy-devel \\\n  libxslt-devel\n\n# \u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\ncurl -L https://github.com/php/php-src/archive/php-7.0.0RC2.tar.gz > php-7.0.0RC2.tar.gz\ntar zxf php-7.0.0RC2.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd php-src-php-7.0.0RC2\n./buildconf --force\n./configure \\\n  --prefix=/opt/php7 \\\n  --with-libdir=lib64 \\\n  --enable-fpm \\\n  --enable-mbstring \\\n  --enable-mysqlnd \\\n  --enable-bcmath \\\n  --enable-sockets \\\n  --enable-exif \\\n  --enable-gd-native-ttf \\\n  --enable-gd-jis-conv \\\n  --enable-intl \\\n  --enable-pcntl \\\n  --enable-soap \\\n  --enable-wddx \\\n  --enable-zip \\\n  --with-openssl \\\n  --with-pcre-regex \\\n  --with-zlib \\\n  --with-bz2 \\\n  --with-curl \\\n  --with-gd \\\n  --with-webp-dir \\\n  --with-jpeg-dir \\\n  --with-png-dir \\\n  --with-zlib-dir \\\n  --with-xpm-dir \\\n  --with-freetype-dir \\\n  --with-gettext \\\n  --with-gmp \\\n  --with-mhash \\\n  --with-icu-dir=/usr \\\n  --with-ldap \\\n  --with-onig \\\n  --with-mcrypt \\\n  --with-mysqli=mysqlnd \\\n  --with-pdo-mysql=mysqlnd \\\n  --with-readline \\\n  --with-snmp \\\n  --with-tidy \\\n  --with-xsl \\\n  --with-gnu-ld\n\nmake -j$(nproc)\nmake install\n```\n\n## \u30cf\u30de\u3063\u305f\n--with-jpeg-dir, --with-freetype-dir\u306b=/usr\u3092\u3064\u3051\u305f\u3089\u8a8d\u8b58\u3055\u308c\u306a\u304b\u3063\u305f\u306e\u3067\u6ce8\u610f\u3002\n\n# H2O\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  make \\\n  gcc \\\n  cmake \\\n  libyaml-devel \\\n  openssl-devel\n\n# Github\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ncd; curl -L https://github.com/h2o/h2o/archive/v1.4.4.tar.gz > h2o-1.4.4.tar.gz\ntar zxf h2o-1.4.4.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd h2o-1.4.4\ncmake -DCMAKE_INSTALL_PREFIX=/opt/h2o .\nmake h2o && make install\n\n# \u30b5\u30f3\u30d7\u30eb\u8a3c\u660e\u66f8\u3092\u30b3\u30d4\u30fc\ncp examples/h2o/server.* /opt/h2o/\nchmod 600 /opt/h2o/server.*\n\n# h2o\u30e6\u30fc\u30b6\u4f5c\u6210\ngroupadd h2o\nuseradd -g h2o -s /sbin/nologin -d /opt/h2o h2o\n```\n\n# MariaDB\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\nyum install -y mariadb-server\nsystemctl enable mariadb\nsystemctl start mariadb\n```\n\n# ZABBIX 2.5(3.0\u03b1)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n# zabbix\u30e6\u30fc\u30b6\u4f5c\u6210\ngroupadd zabbix\nuseradd -g zabbix zabbix\n\n# \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install -y \\\n  mariadb-devel \\\n  libxml2-devel \\\n  net-snmp-devel \\\n  libcurl-devel \\\n  libssh2-devel \\\n  openldap-devel \\\n  java-1.8.0-openjdk-devel\n\n# \u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u89e3\u51cd\ncd; curl -L http://goo.gl/BzG5RL > zabbix-2.5.0.tar.gz\ntar zxf zabbix-2.5.0.tar.gz\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd zabbix-2.5.0\n./configure \\\n  --enable-server \\\n  --enable-agent \\\n  --enable-java \\\n  --with-mysql \\\n  --with-net-snmp \\\n  --with-libcurl \\\n  --with-libxml2 \\\n  --with-ssh2 \\\n  --with-ldap \\\n  --with-iconv\nmake -j$(nproc) install\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316\ncd database/mysql\nmysql -uroot -e \"create database zabbix character set utf8 collate utf8_bin;\"\nmysql -uroot -e \"grant all on zabbix.* to zabbix@localhost identified by 'zabbix';\"\nmysql -uroot zabbix < schema.sql\nmysql -uroot zabbix < images.sql\nmysql -uroot zabbix < data.sql\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\ncp /usr/local/etc/zabbix_server.conf /usr/local/etc/zabbix_server.conf.orig\necho DBPassword=zabbix >> /usr/local/etc/zabbix_server.conf\n\n# ZABBIX systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/zabbix-server.service\n[Unit]\nDescription=Zabbix Server\nAfter=network.target mariadb.service\n\n[Service]\nType=oneshot\nExecStart=/usr/local/sbin/zabbix_server -c /usr/local/etc/zabbix_server.conf\nExecReload=/usr/local/sbin/zabbix_server -R config_cache_reload\nRemainAfterExit=yes\nPIDFile=/tmp/zabbix_server.pid\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# ZABBIX\u8d77\u52d5\nsystemctl daemon-reload\nsystemctl start zabbix-server\nsystemctl enable zabbix-server\n```\n\n# ZABBIX\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u8a2d\u5b9a\n\n```bash\n# php-fpm\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7de8\u96c6\ncp /opt/php7/etc/php-fpm.conf.default /tmp/php-fpm.conf\nsed -i 's/;pid = .*$/pid = run\\/php-fpm.pid/' /tmp/php-fpm.conf\ncp /opt/php7/etc/php-fpm.d/www.conf.default /tmp/www.conf\nsed -i 's/;listen.owner = nobody/listen.owner = h2o/' /tmp/www.conf\nsed -i 's/;listen.group = nobody/listen.group = h2o/' /tmp/www.conf\nsed -i 's/user = nobody/user = h2o/' /tmp/www.conf\nsed -i 's/group = nobody/group = h2o/' /tmp/www.conf\nsed -i 's|listen = 127.0.0.1:9000|listen = /tmp/php-fpm.sock|' /tmp/www.conf\ncp /tmp/www.conf /opt/php7/etc/php-fpm.d/www.conf\ncp /tmp/php-fpm.conf /opt/php7/etc/php-fpm.conf\n\n#php.ini \u4f5c\u6210\ncd; cd php-src-php-7.0.0RC2\ncp php.ini-production /tmp/php.ini\nsed -i 's/^post_max_size =.*$/post_max_size = 16M/' /tmp/php.ini\nsed -i 's/^max_input_time =.*$/max_input_time = 300/' /tmp/php.ini\nsed -i 's/^max_execution_time =.*$/max_execution_time = 300/' /tmp/php.ini\nsed -i 's/^;date.timezone =.*$/date.timezone = Asia\\/Tokyo/' /tmp/php.ini\nsed -i 's/^;mbstring.language =.*$/mbstring.language = Japanese/' /tmp/php.ini\n# mysqli.default_socket \u3053\u308c\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068ZABBIX\u304c\u8a8d\u8b58\u3057\u3066\u304f\u308c\u306a\u304b\u3063\u305f\nsed -i 's/^mysqli.default_socket =.*$/mysqli.default_socket = \\/var\\/lib\\/mysql\\/mysql.sock/' /tmp/php.ini\ncp /tmp/php.ini /opt/php7/lib/php/php.ini\n\n# H2O\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /opt/h2o/h2o.conf\nuser: h2o\naccess-log: /var/log/h2o/access.log\nerror-log: /var/log/h2o/error.log\npid-file: /var/run/h2o/pid\nhttp2-reprioritize-blocking-assets: ON\n\nfile.custom-handler:\n  extension: .php\n  fastcgi.connect:\n    port: /tmp/php-fpm.sock\n    type: unix\n  # fastcgi\u3092h2o\u3067\u7ba1\u7406\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u3092\u30b3\u30e1\u30f3\u30c8\u89e3\u9664\n  # fastcgi.spawn: \"PHP_FCGI_CHILDREN=10 exec /opt/php7/bin/php-cgi -c /opt/php7/lib/php/php.ini\"\n\nfile.index: [ 'index.php', 'index.html' ]\n\nhosts:\n  \"localhost\":\n    listen:\n      host: 0.0.0.0\n      port: 443\n      ssl:\n        certificate-file: /opt/h2o/server.crt\n        key-file: /opt/h2o/server.key\n    paths:\n      \"/zabbix\":\n        file.dir: /opt/h2o/html/zabbix\nEOT\n\n# php-fpm systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/php-fpm.service\n[Unit]\nDescription=PHP FastCGI Server\nAfter=network.target remote-fs.target\n\n[Service]\nType=forking\nPIDFile=/opt/php7/var/run/php-fpm.pid\nWorkingDirectory=/opt/php7\nExecStartPre=/usr/bin/chown -R h2o:h2o /opt/php7/var\nExecStart=/opt/php7/sbin/php-fpm -c /opt/php7/lib/php/php.ini -D\nExecReload=/usr/bin/kill -HUP $MAINPID\nLimitNOFILE=infinity\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# h2o systemd\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ncat <<-EOT > /usr/lib/systemd/system/h2o.service\n[Unit]\nDescription=h2o optimized HTTP server\nAfter=php-fpm.service\n\n[Service]\nType=forking\nPIDFile=/var/run/h2o/pid\nWorkingDirectory=/opt/h2o\nExecStartPre=-/usr/bin/mkdir -p /var/run/h2o /var/log/h2o\nExecStartPre=-/usr/bin/chown h2o:h2o /var/run/h2o /var/log/h2o\nExecStart=/opt/h2o/bin/h2o -c /opt/h2o/h2o.conf -m daemon\nExecReload=/usr/bin/kill -HUP $MAINPID\nLimitNOFILE=infinity\n\n[Install]\nWantedBy=multi-user.target\nEOT\n\n# php-fpm \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u4e8b\u524d\u4f5c\u6210\ntouch /opt/php7/var/log/php-fpm.log\nchmod 775 /opt/php7/var/log/php-fpm.log\nchown -R h2o:h2o /opt/php7/var\n\n# \u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsystemctl daemon-reload\nsystemctl start php-fpm\nsystemctl start h2o\nsystemctl enable h2o\nsystemctl enable php-fpm\n\n# ZABBIX\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30d5\u30a1\u30a4\u30eb\u914d\u7f6e\nmkdir -p /opt/h2o/html/zabbix\ncp -r ~/zabbix-2.5.0/frontends/php/* /opt/h2o/html/zabbix/\nchown -R h2o:h2o /opt/h2o/html\n\n# always_populate_raw_post_data(PHP7\u3067\u524a\u9664)\u306e\u30c1\u30a7\u30c3\u30af\u3092\u7121\u52b9\u306b\u3059\u308b\ncp /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig\nvi /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php\ndiff -u /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php\n# diff\u5185\u5bb9 \u3053\u3053\u304b\u3089 ---------------------------------------------------------------------------\n--- /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php.orig  2015-09-14 11:55:24.029602938 +0900\n+++ /opt/h2o/html/zabbix/include/classes/setup/CFrontendSetup.php       2015-09-14 11:57:28.443415294 +0900\n@@ -72,7 +72,7 @@\n                }\n \n                // check for deprecated PHP 5.6.0 option 'always_populate_raw_post_data'\n-               if (version_compare(PHP_VERSION, '5.6', '>=')) {\n+               if (version_compare(PHP_VERSION, '5.6', '>=') && version_compare(PHP_VERSION, '7', '<')) {\n                        $result[] = $this->checkPhpAlwaysPopulateRawPostData();\n                }\n                $result[] = $this->checkPhpSockets();\n# diff\u5185\u5bb9 \u3053\u3053\u307e\u3067 ---------------------------------------------------------------------------\n```\n\n# \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u958b\u653e\n\n```bash\nfirewall-cmd --add-service https --zone public --permanent\nfirewall-cmd --add-port 10051/tcp --zone public --permanent\nfirewall-cmd --reload\n```\n\n# \u30b0\u30e9\u30d5\u6587\u5b57\u5316\u3051\u5bfe\u5fdc\n\n```bash\nyum install -y vlgothic-p-fonts\ncd /opt/h2o/html/zabbix/fonts\nsudo -uh2o ln -s /usr/share/fonts/vlgothic/VL-PGothic-Regular.ttf ./VL-PGothic-Regular.ttf\nsed -i.orig 's/DejaVuSans/VL-PGothic-Regular/g' /opt/h2o/html/zabbix/include/defines.inc.php\n```\n\n# \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u30d6\u30e9\u30a6\u30b6\u3067 ${hostname}:443/zabbix/ \u306b\u30a2\u30af\u30bb\u30b9\u3002\n\n![1.png](https://qiita-image-store.s3.amazonaws.com/0/17735/3a7e2f70-5c7e-7711-3883-c3fc99df7748.png)\n\n![2.png](https://qiita-image-store.s3.amazonaws.com/0/17735/ac75bf73-656b-a8ae-a123-57cc68f5b15b.png)\n\n![3.png](https://qiita-image-store.s3.amazonaws.com/0/17735/91900dfb-f39b-031f-b35b-1bc5928d26f5.png)\n\n![4.png](https://qiita-image-store.s3.amazonaws.com/0/17735/d4977764-5d51-9571-9af1-2a6efc7ba779.png)\n\n![5.png](https://qiita-image-store.s3.amazonaws.com/0/17735/8c7ea033-20a0-e9f7-8eb6-2797524c62e7.png)\n\n![6.png](https://qiita-image-store.s3.amazonaws.com/0/17735/36203fc0-38d7-6ce8-f5ad-945c424142df.png)\n\nAdmin/zabbix \u3067\u30b5\u30a4\u30f3\u30a4\u30f3\n![7.png](https://qiita-image-store.s3.amazonaws.com/0/17735/deb1abd5-58a0-eda3-ba19-6cf80a741ff2.png)\n\n![8.png](https://qiita-image-store.s3.amazonaws.com/0/17735/02b9af66-5423-2774-5025-bfe0a1c63549.png)\n\n\u53f3\u4e0a\u306e\u4eba\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066[Language]\u3092[Japanese[ja_JP]\u306b\u5909\u66f4\n![9.png](https://qiita-image-store.s3.amazonaws.com/0/17735/841f41b8-ebc9-7c06-0451-ec0a2b25941f.png)\n\n\u65e5\u672c\u8a9e\u306b\u306a\u308a\u307e\u3057\u305f\n![10.png](https://qiita-image-store.s3.amazonaws.com/0/17735/9cd7288b-204f-9d96-0aa3-0c3c8653d9e6.png)\n"}