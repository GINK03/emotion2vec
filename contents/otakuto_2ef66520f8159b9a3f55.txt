{"tags": ["CoreOS", "kubernetes", "vagrant"], "context": "\n\n\u306a\u306b\u3053\u308c\n\u30bf\u30a4\u30c8\u30eb\u901a\u308a\u306bkubernetes\u306eguestbook\u30b5\u30f3\u30d7\u30eb\u3092\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u306e\u304c\u76ee\u7684\u3067\u3059.\nkubernetes\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u901a\u308a\u306b\u3084\u3063\u3066\u3082\u52d5\u304b\u306a\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f.\n\n\u5b9f\u884c\u74b0\u5883\n\nGentoo (linux-4.7.0-rc7)\n\n\n\u5fc5\u8981\u306a\u3082\u306e\n\ncurl\ngit\nvagrant (1.8.5)\n\n\nkubernetes\u306e\u74b0\u5883\u69cb\u7bc9\n\nkubernetes\u3092\u64cd\u4f5c\u3059\u308bkubectl\u3092curl\u3059\u308b.\n\nLinux\u306e\u4eba\ncurl -O https://storage.googleapis.com/kubernetes-release/release/v1.3.4/bin/linux/amd64/kubectl\n\n\nMac\u306e\u4eba\ncurl -O https://storage.googleapis.com/kubernetes-release/release/v1.3.4/bin/darwin/amd64/kubectl\n\n\nkubectl\u306e\u914d\u7f6e\nchmod +x kubectl\nmv kubectl /usr/local/bin/kubectl\n\n\nkubernetes\u306e\u74b0\u5883\u306e\u5165\u3063\u305fCoreOS\u3092git clone\u3059\u308b.\ngit clone https://github.com/coreos/coreos-kubernetes.git\n\n\nvagrant\u3067CoreOS\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7acb\u3061\u4e0a\u3052\u308b.\ncd coreos-kubernetes/multi-node/vagrant\nvagrant up\n\n\nkubeconfig\u3092\u6307\u5b9a\u3059\u308b\nexport KUBECONFIG=\"${KUBECONFIG}:$(pwd)/kubeconfig\"\nkubectl config use-context vagrant-multi\nkubectl config set-cluster vagrant-multi-cluster --server=https://172.17.4.101:443 --certificate-authority=${PWD}/ssl/ca.pem\nkubectl config set-credentials vagrant-multi-admin --certificate-authority=${PWD}/ssl/ca.pem --client-key=${PWD}/ssl/admin-key.pem --client-certificate=${PWD}/ssl/admin.pem\nkubectl config set-context vagrant-multi --cluster=vagrant-multi-cluster --user=vagrant-multi-admin\nkubectl config use-context vagrant-multi\n\nnode\u304c\u751f\u304d\u3066\u308b\u304b\u78ba\u8a8d\n$ kubectl get nodes\nNAME           STATUS                     AGE\n172.17.4.101   Ready,SchedulingDisabled   1d\n172.17.4.201   Ready                      1d\n\n\u5404node\u304cReady\u306b\u306a\u3063\u3066\u3044\u308c\u3070kubernetes\u306e\u74b0\u5883\u69cb\u7bc9\u306f\u6210\u529f\u3067\u3059.\n\nguestbook\u306e\u5c0e\u5165\n\nguestbook\u306e\u30b5\u30f3\u30d7\u30eb\u3092git clone\u3059\u308b.\ngit clone https://github.com/kubernetes/kubernetes\n\nNodePort\u306e\u6307\u5b9a\nfrontend\u306e\u30dd\u30fc\u30c8\u306b\u30d9\u30a2\u30e1\u30bf\u30eb\u74b0\u5883\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bkubernetes/examples/guestbook/frontend-service.yaml\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b.\n\u4eca\u56de\u306fnode\u306e30301\u306b\u30b5\u30fc\u30d3\u30b9\u306e80\u756a\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b.\n--- a/examples/guestbook/frontend-service.yaml\n+++ b/examples/guestbook/frontend-service.yaml\n@@ -9,9 +9,11 @@ spec:\n   # if your cluster supports it, uncomment the following to automatically create\n   # an external load-balanced IP for the frontend service.\n   # type: LoadBalancer\n+  type: NodePort\n   ports:\n     # the port that this service should serve on\n   - port: 80\n+    nodePort: 30301\n   selector:\n     app: guestbook\n     tier: frontend\n\n\n\u30b5\u30fc\u30d3\u30b9\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u308b.\nkubectl create -f ./kubernetes/examples/guestbook/redis-master-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/redis-slave-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/frontend-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/redis-master-controller.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/redis-slave-controller.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/frontend-controller.yaml\n\n\n\u30b5\u30fc\u30d3\u30b9\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d.\n$ kubectl get services\nNAME           CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nfrontend       10.3.0.60    nodes         80/TCP     21m\nkubernetes     10.3.0.1     <none>        443/TCP    1d\nredis-master   10.3.0.61    <none>        6379/TCP   24m\nredis-slave    10.3.0.15    <none>        6379/TCP   24m\n\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d.\n$ kubectl get rc\nNAME           DESIRED   CURRENT   AGE\nfrontend       3         3         3m\nredis-master   1         1         5m\nredis-slave    2         2         4m\n\n\nguestbook\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\nnodes\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8abf\u3079\u308b.\n$ kubectl get nodes\nNAME           STATUS                     AGE\n172.17.4.101   Ready,SchedulingDisabled   1d\n172.17.4.201   Ready                      1d\n\n\u5404node\u306e30301\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b.\n$ curl 172.17.4.101:30301\n<html ng-app=\"redis\">...\n...</html>\n$ curl 172.17.4.201:30301\n<html ng-app=\"redis\">...\n...</html>\n\n\u3053\u3093\u306a\u306e\u304c\u3067\u305f\u3089\u6210\u529f\u3067\u3059.\n\n\n\u53c2\u8003\u6587\u732e\nhttps://coreos.com/kubernetes/docs/latest/kubernetes-on-vagrant.html\nhttps://coreos.com/kubernetes/docs/latest/configure-kubectl.html\nhttps://github.com/kubernetes/kubernetes/tree/master/examples/guestbook\n## \u306a\u306b\u3053\u308c\n\u30bf\u30a4\u30c8\u30eb\u901a\u308a\u306bkubernetes\u306eguestbook\u30b5\u30f3\u30d7\u30eb\u3092\u3068\u308a\u3042\u3048\u305a\u52d5\u304b\u3059\u306e\u304c\u76ee\u7684\u3067\u3059.\nkubernetes\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u901a\u308a\u306b\u3084\u3063\u3066\u3082\u52d5\u304b\u306a\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f.\n\n## \u5b9f\u884c\u74b0\u5883\n* Gentoo (linux-4.7.0-rc7)\n\n## \u5fc5\u8981\u306a\u3082\u306e\n* curl\n* git\n* vagrant (1.8.5)\n\n## kubernetes\u306e\u74b0\u5883\u69cb\u7bc9\n#### kubernetes\u3092\u64cd\u4f5c\u3059\u308bkubectl\u3092curl\u3059\u308b.\n\n#### Linux\u306e\u4eba\n\n```\ncurl -O https://storage.googleapis.com/kubernetes-release/release/v1.3.4/bin/linux/amd64/kubectl\n```\n\n#### Mac\u306e\u4eba\n\n```\ncurl -O https://storage.googleapis.com/kubernetes-release/release/v1.3.4/bin/darwin/amd64/kubectl\n```\n\n#### kubectl\u306e\u914d\u7f6e\n\n```\nchmod +x kubectl\nmv kubectl /usr/local/bin/kubectl\n```\n\n#### kubernetes\u306e\u74b0\u5883\u306e\u5165\u3063\u305fCoreOS\u3092git clone\u3059\u308b.\n\n```\ngit clone https://github.com/coreos/coreos-kubernetes.git\n```\n\n#### vagrant\u3067CoreOS\u306e\u30af\u30e9\u30b9\u30bf\u3092\u7acb\u3061\u4e0a\u3052\u308b.\n\n```\ncd coreos-kubernetes/multi-node/vagrant\nvagrant up\n```\n\n#### kubeconfig\u3092\u6307\u5b9a\u3059\u308b\n\n```\nexport KUBECONFIG=\"${KUBECONFIG}:$(pwd)/kubeconfig\"\nkubectl config use-context vagrant-multi\nkubectl config set-cluster vagrant-multi-cluster --server=https://172.17.4.101:443 --certificate-authority=${PWD}/ssl/ca.pem\nkubectl config set-credentials vagrant-multi-admin --certificate-authority=${PWD}/ssl/ca.pem --client-key=${PWD}/ssl/admin-key.pem --client-certificate=${PWD}/ssl/admin.pem\nkubectl config set-context vagrant-multi --cluster=vagrant-multi-cluster --user=vagrant-multi-admin\nkubectl config use-context vagrant-multi\n```\n\nnode\u304c\u751f\u304d\u3066\u308b\u304b\u78ba\u8a8d\n\n```\n$ kubectl get nodes\nNAME           STATUS                     AGE\n172.17.4.101   Ready,SchedulingDisabled   1d\n172.17.4.201   Ready                      1d\n```\n\u5404node\u304cReady\u306b\u306a\u3063\u3066\u3044\u308c\u3070kubernetes\u306e\u74b0\u5883\u69cb\u7bc9\u306f\u6210\u529f\u3067\u3059.\n\n## guestbook\u306e\u5c0e\u5165\n\n#### guestbook\u306e\u30b5\u30f3\u30d7\u30eb\u3092git clone\u3059\u308b.\n```git clone https://github.com/kubernetes/kubernetes```\n\n#### NodePort\u306e\u6307\u5b9a\nfrontend\u306e\u30dd\u30fc\u30c8\u306b\u30d9\u30a2\u30e1\u30bf\u30eb\u74b0\u5883\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bkubernetes/examples/guestbook/frontend-service.yaml\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b.\n\u4eca\u56de\u306fnode\u306e30301\u306b\u30b5\u30fc\u30d3\u30b9\u306e80\u756a\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b.\n\n```\n--- a/examples/guestbook/frontend-service.yaml\n+++ b/examples/guestbook/frontend-service.yaml\n@@ -9,9 +9,11 @@ spec:\n   # if your cluster supports it, uncomment the following to automatically create\n   # an external load-balanced IP for the frontend service.\n   # type: LoadBalancer\n+  type: NodePort\n   ports:\n     # the port that this service should serve on\n   - port: 80\n+    nodePort: 30301\n   selector:\n     app: guestbook\n     tier: frontend\n```\n\n#### \u30b5\u30fc\u30d3\u30b9\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u7acb\u3061\u4e0a\u3052\u308b.\n\n```\nkubectl create -f ./kubernetes/examples/guestbook/redis-master-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/redis-slave-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/frontend-service.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/redis-master-controller.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/redis-slave-controller.yaml\nkubectl create -f ./kubernetes/examples/guestbook/legacy/frontend-controller.yaml\n```\n\n#### \u30b5\u30fc\u30d3\u30b9\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d.\n\n```\n$ kubectl get services\nNAME           CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nfrontend       10.3.0.60    nodes         80/TCP     21m\nkubernetes     10.3.0.1     <none>        443/TCP    1d\nredis-master   10.3.0.61    <none>        6379/TCP   24m\nredis-slave    10.3.0.15    <none>        6379/TCP   24m\n```\n\n#### \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u304b\u306e\u78ba\u8a8d.\n\n```\n$ kubectl get rc\nNAME           DESIRED   CURRENT   AGE\nfrontend       3         3         3m\nredis-master   1         1         5m\nredis-slave    2         2         4m\n```\n\n#### guestbook\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\nnodes\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8abf\u3079\u308b.\n\n```\n$ kubectl get nodes\nNAME           STATUS                     AGE\n172.17.4.101   Ready,SchedulingDisabled   1d\n172.17.4.201   Ready                      1d\n```\n\u5404node\u306e30301\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b.\n\n```\n$ curl 172.17.4.101:30301\n<html ng-app=\"redis\">...\n...</html>\n$ curl 172.17.4.201:30301\n<html ng-app=\"redis\">...\n...</html>\n```\n\n\u3053\u3093\u306a\u306e\u304c\u3067\u305f\u3089\u6210\u529f\u3067\u3059.\n\n![20160812-140843.png](https://qiita-image-store.s3.amazonaws.com/0/136515/ee2422b2-21b4-f61d-3f82-aefc83ae675a.png)\n\n\n## \u53c2\u8003\u6587\u732e\n<https://coreos.com/kubernetes/docs/latest/kubernetes-on-vagrant.html>\n<https://coreos.com/kubernetes/docs/latest/configure-kubectl.html>\n<https://github.com/kubernetes/kubernetes/tree/master/examples/guestbook>\n"}