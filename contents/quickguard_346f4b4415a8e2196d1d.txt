{"context": " More than 1 year has passed since last update.\u524d\u56de collectd \u306b\u3064\u3044\u3066\u89e6\u308c\u305f\u306e\u3067\u3001\u3064\u3044\u3067\u306b output \u306b\u3064\u3044\u3066\u3082\u8a18\u8f09\n\n\u6982\u8981\ncollectd \u3067\u53ce\u96c6\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u60c5\u5831\u3092 riemann \u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u51e6\u7406\u3059\u308b\nriemann \u306f\u3001\u30a4\u30d9\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u30a8\u30f3\u30b8\u30f3\u3067\u3001\u4ee5\u4e0b\u306e\u57fa\u672c\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u4efb\u610f\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4ed8\u4e0e\u3067\u304d\u308b\n\nhost\nservice\nstate\ntime\ndescription\ntags\nmetric\nttl\n\n\u25a0\u69cb\u6210\ncollectd -> riemann -> riemann-dash \n               \u2514> Graphite -> Grafana\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u3092 Graphite \u4ee5\u5916\uff08InfluxDB, datadog \u7b49\u306e SaaS\uff09\u306b\u3082\u4fdd\u5b58\u3057\u305f\u308a\u3001\u30a2\u30e9\u30fc\u30c8\u3092\u30e1\u30fc\u30eb\u3001Slack\u3001Nagios \u306b\u6295\u3052\u305f\u308a\u3082\u3067\u304d\u308b\n\u30a4\u30e1\u30fc\u30b8\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u3088\u308a\n\nriemann \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install daemonize\n# rpm -ivh https://aphyr.com/riemann/riemann-0.2.10-1.noarch.rpm\n\n\nriemann \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb + \u5404\u5f79\u5272\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f clojure \u3067\u8a18\u8ff0\n/etc/riemann/\n|--riemann.config\n|\n|--/streams/\n|    |--default.config\n|    |--load.config\n|\n|--/filters/\n|    |--collectd.config\n|    |--rewrite.config\n|\n|--/targets/\n     |--graphite.config\n     |--index.config\n\n\nstreams : \u30a4\u30d9\u30f3\u30c8\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\nfilters : \u30a4\u30d9\u30f3\u30c8\u306b\u5bfe\u3059\u308b\u5909\u63db\u51e6\u7406\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\ntarget  : graphite \u3078\u306e\u51fa\u529b\u7b49 output \u95a2\u9023\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n\n\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3084 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea include \u7b49\u3001\u57fa\u672c\u8a2d\u5b9a\u306e\u307f\n\n/etc/riemann/riemann.config\n(logging/init :file \"/var/log/riemann/riemann.log\")\n\n(let [host \"0.0.0.0\"]\n  (tcp-server  :host host) ; :port 5555\n  (udp-server  :host host) ; :port 5555\n  (ws-server   :host host) ; :port 5556\n  (sse-server  :host host) ; :port 5558\n  (repl-server :host host) ; :port 5557\n)\n\n(periodically-expire 60)\n\n(include \"filters\")\n(include \"targets\")\n(include \"streams\")\n\n\n\u30a4\u30d9\u30f3\u30c8\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51e6\u7406\n\n/etc/riemann/streams/default.config\n(streams\n  graph\n  (with { :metric 1 :service \"events/sec\"\n      :host nil :tags nil :state nil } (rate 5 index))\n  (expired\n    #(info \"expired\" %))\n)\n\n\n\u95be\u5024\u306b\u3088\u308b\u30b9\u30c6\u30fc\u30bf\u30b9\u51e6\u7406\n\n/etc/riemann/streams/load.config\n(streams\n  rewrite-index\n  (cpu-stream rewrite-index)\n  (mem-stream rewrite-index)\n  (swap-stream rewrite-index)\n\n  (where (service #\"/cpu-\")\n    (split\n      (service #\"/cpu-idle$\")\n        (splitp >= metric\n          1  (with :state \"critical\" rewrite-index)\n          20 (with :state \"warning\"  rewrite-index)\n             (with :state \"ok\"       rewrite-index))\n      :otherwise\n        (splitp <= metric\n          80 (with :state \"critical\" rewrite-index)\n          40 (with :state \"warning\"  rewrite-index)\n             (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/disk_\")\n    (split\n      (service #\"/disk_octets\")\n        (splitp <= metric\n          2000 (with :state \"critical\" rewrite-index)\n               (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/memory-\")\n    (split\n      (service #\"/memory-used$\")\n        (splitp <= metric\n          30000000000 (with :state \"critical\" rewrite-index)\n          2000000000  (with :state \"warning\"  rewrite-index)\n                      (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/if_\")\n    (split\n      (service #\"/if_octets\")\n        (splitp <= metric\n          20000 (with :state \"critical\" rewrite-index)\n          1000  (with :state \"warning\"  rewrite-index)\n                (with :state \"ok\"       rewrite-index))\n  ))\n\n)\n\n\nfilter\u51e6\u7406\ncollectd \u304b\u3089\u76f4\u63a5 input \u3057\u305f\u5834\u5408\u3001service \u540d\u304c\u9577\u304b\u3063\u305f\u308a\u5206\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u5909\u63db\u51e6\u7406\n(load/load/shortterm \u2192 load1 \u7b49)\n\n/etc/riemann/filters/collectd.config\n(defmacro mem-stream\n  [& children]\n  `(where* (fn [{plugin# :plugin, state# :state}]\n             (and (= \"memory\" plugin#)\n                  (not= \"expired\" state#)))\n           (by [:host]\n               (project* [(comp (partial = \"used\") :type_instance)\n                          (comp (partial = \"cached\") :type_instance)\n                          (comp (partial = \"buffered\") :type_instance)\n                          (comp (partial = \"free\") :type_instance)]\n                         (smap\n                          (fn [[used# cached# buf# free#]]\n                            (when (and used# cached# buf# free#)\n                              (try\n                                (assoc used#\n                                  :service \"mem used%\"\n                                  :metric (-> (:metric used#)\n                                              (/ (+ (:metric used#)\n                                                    (:metric cached#)\n                                                    (:metric buf#)\n                                                    (:metric free#)))\n                                              (* 100)))\n                                (catch Exception e#\n                                  (error e# \"cannot compute mem pct for \" used# cached# buf# free#)\n                                  nil))))\n                          ~@children)))))\n\n(defmacro cpu-stream\n  [& children]\n  `(where* (fn [{plugin# :plugin, plugin_instance# :plugin_instance,\n                 state# :state}]\n             (and (= \"aggregation\" plugin#)\n                  (= \"cpu-average\" plugin_instance#)\n                  (not= \"expired\" state#)))\n     #(info %)\n           (by [:host]\n               (project* [(comp (partial = \"user\") :type_instance)\n                          (comp (partial = \"system\") :type_intance)\n                          (comp (partial = \"softirq\") :type_instance)\n                          (comp (partial = \"interrupt\") :type_instance)\n                          (comp (partial = \"steal\") :type_instance)\n                          (comp (partial = \"wait\") :type_instance)\n                          (comp (partial = \"nice\") :type_instance)]\n                         (smap (fn [events#]\n                                 (when-let [summed# (folds/sum events#)]\n                                   (try\n                                     (assoc summed# :service \"cpu all\")\n                                     (catch Exception e#\n                                       (error e# \"cannot compute cpu all for \" summed#)\n                                       nil))))\n                               ~@children)))))\n\n\n\n\n/etc/riemann/filters/rewrite.config\n(def default-services\n  [\n   {:service \"conntrack/conntrack\" :rewrite \"conntrack\"}\n   {:service \"load/load/shortterm\" :rewrite \"load1\"}\n   {:service \"load/load/midterm\" :rewrite \"load5\"}\n   {:service \"load/load/longterm\" :rewrite \"load15\"}\n   {:service \"memory/memory-used\" :rewrite \"mem used\"}\n   {:service \"memory/memory-free\" :rewrite \"mem free\"}\n   {:service \"memory/memory-buffered\" :rewrite \"mem buffered\"}\n   {:service \"memory/memory-cached\" :rewrite \"mem cached\"}\n   {:service #\"^cpu-([0-9]+)/cpu-(.*)$\" :rewrite \"cpu-$1 $2\"}\n   {:service #\"^aggregation-cpu-average/cpu-(.*)$\" :rewrite \"cpu $1\"}\n   {:service #\"^interface-(.*)/if_(errors|packets|octets)/(tx|rx)$\"\n    :rewrite \"nic $1 $3 $2\"}\n   {:service #\"^apache-apache/apache_(.*)$\" :rewrite \"apache $1\"}\n   {:service #\"^mysql-monitor/mysql_(.*)-(.*)$\" :rewrite \"mysql $2\"}\n   ]\n)\n\n(defn rewrite-service-with\n  [rules]\n  (let [matcher (fn [s1 s2] (if (string? s1) (= s1 s2) (re-find s1 s2)))]\n    (fn [{:keys [service] :as event}]\n      (or\n       (first\n        (for [{:keys [rewrite] :as rule} rules\n              :when (matcher (:service rule) service)]\n          (assoc event :service\n                 (if (string? (:service rule))\n                   rewrite\n                   (clojure.string/replace service (:service rule) rewrite)))))\n       event))))\n\n(def rewrite-service\n  (rewrite-service-with default-services))\n\n\noutput \u51e6\u7406\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u4ed8\u4e0e\n\n/etc/riemann/streams/index.config\n(def index\n    (default {:state \"ok\" :ttl 300}\n      (update-index (index))))\n\n(def rewrite-index\n  (smap rewrite-service index))\n\n\n\u30e1\u30c8\u30ea\u30af\u30b9 \u3092 graphite \u3078\u6d41\u3059\n\n/etc/riemann/streams/graphite.config\n(def graph\n    (graphite {:host \"\uff5bgraphite \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d\"}))\n\n\nriemann \u8d77\u52d5\n# /etc/init.d/riemann start\n\n\nriemann-dash \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u53d7\u3051\u53d6\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\u3059\u308b\u305f\u3081\u306e Sinatra \u3067\u3067\u304d\u305f\u30a2\u30d7\u30ea\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n# cd /opt\n# git clone https://github.com/aphyr/riemann-dash.git\n# cd riemann-dash\n# gem install bundler\n# bundle install\n\nfloat \u30b0\u30e9\u30d5 \u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u5909\u66f4\n# vi /opt/riemann-dash/lib/riemann/dash/public/views/flot.js\n           max: this.max\n         },\n         xaxis: {\n+          timezone: \"browser\",\n           font: this.font,\n\nriemann-dash \u8d77\u52d5\n# RACK_ENV=production bundle exec riemann-dash -c example/config.rb &\n\nhttp://\uff5briemann \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d:4567 \u306b\u30a2\u30af\u30bb\u30b9\n\n\nclient(collectd) \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\ncollectd \u3067\u53d6\u5f97\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u4ee5\u4e0b\n\ncpu\napache status\ndisk\ninterface\nmysql\n\ncollectd \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum -y install libcurl-devel net-snmp-devel protobuf-c-devel yajl-devel\n# wget http://collectd.org/files/collectd-5.5.0.tar.gz\n# tar zxvf collectd-5.5.0.tar.gz\n# cd collectd-5.5.0\n# ./cofigure\n# make; make install\n\ncollectd \u8a2d\u5b9a\n\n/opt/collectd/etc/collectd.conf\nHostname    \"*****\"\nFQDNLookup   false\nBaseDir     \"/opt/collectd/var/lib/collectd\"\nPIDFile     \"/opt/collectd/var/run/collectd.pid\"\nPluginDir   \"/opt/collectd/lib/collectd\"\nTypesDB     \"/opt/collectd/share/collectd/types.db\"\n\nInterval     5\nTimeout      5\nReadThreads  10\nWriteThreads 10\n\nLoadPlugin syslog\n\nLoadPlugin aggregation\nLoadPlugin apache\nLoadPlugin cpu\nLoadPlugin interface\nLoadPlugin load\nLoadPlugin mysql\nLoadPlugin memory\nLoadPlugin write_riemann\n\n<Plugin \"aggregation\">\n  <Aggregation>\n    Plugin \"cpu\"\n    Type \"cpu\"\n    GroupBy \"Host\"\n    GroupBy \"TypeInstance\"\n    CalculateAverage true\n  </Aggregation>\n</Plugin>\n\n<Plugin apache>\n  <Instance \"apache\">\n    URL \"http://localhost/server-status?auto\"\n  </Instance>\n</Plugin>\n\n<Plugin interface>\n        Interface \"eth0\"\n        IgnoreSelected false\n</Plugin>\n\n<Plugin mysql>\n        <Database demo>\n                Host \"localhost\"\n                User \"demo\"\n                Password \"demo\"\n                Database \"demo\"\n        </Database>\n</Plugin>\n\n<Plugin write_riemann>\n        <Node \"*****\">\n                Host \"\uff5briemann IP \u30a2\u30c9\u30ec\u30b9\uff5d\"\n                Port 5555\n                Protocol UDP\n                StoreRates true\n               AlwaysAppendDS false\n        </Node>\n        Tag \"collectd\"\n</Plugin>\n\n\n\u5404 client \u3067 collectd \u8d77\u52d5\n# /etc/init.d/collectd start\n\n\nriemann-dash \u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\u3059\u308b\ncollectd \u3067\u53d6\u5f97\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b0\u30e9\u30d5\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\n\u5404 view \u306b\u30af\u30a8\u30ea\u3092\u8a18\u8f09\u3059\u308b\n\u4f5c\u6210\u3057\u305f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30b3\u30f3\u30d5\u30a3\u30b0\n\n/opt/riemann-dash/config/config.json\n{\n  \"server\": \"\uff5briemann \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d:5556\",\n  \"server_type\": \"ws\",\n  \"workspaces\": [\n    {\n      \"name\": \"Riemann\",\n      \"view\": {\n        \"type\": \"Balloon\",\n        \"weight\": 1,\n        \"id\": \"7fb2428439a04d9238de9f2fd9eff1f5910d2477\",\n        \"version\": 38,\n        \"child\": {\n          \"type\": \"VStack\",\n          \"weight\": 1,\n          \"id\": \"cc696f34d59ea1f1f996c11f09293ba5dd47567d\",\n          \"version\": 38,\n          \"children\": [\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"954004fabce0e68e0e227feb1d30aaf2aa22475b\",\n              \"version\": 19,\n              \"children\": [\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"20fc8f5754b44f9549bf5ba4525284c6017bd15d\",\n                  \"version\": 0,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"3ef8b2f3786e2ab1ba017a66b0e2440b29c11159\",\n                      \"version\": 11,\n                      \"title\": \"Load\",\n                      \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"cpu idle\\\" or service =~ \\\"load%\\\" or service =~ \\\"mem used\\\" or service =~ \\\"swap in\\\" or service =~ \\\"swap out\\\")\",\n                      \"max\": \"\",\n                      \"rows\": \"\",\n                      \"cols\": \"\",\n                      \"row_sort\": \"lexical\",\n                      \"col_sort\": \"lexical\"\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"4e7fc05a9aaa0f2723d4ad5a4e0cdc5e40834cf5\",\n                  \"version\": 5,\n                  \"children\": [\n                    {\n                      \"type\": \"HStack\",\n                      \"weight\": 1,\n                      \"id\": \"d66f68fdbe079f699944f7d25afe5376e3906fc9\",\n                      \"version\": 1,\n                      \"children\": [\n                        {\n                          \"type\": \"Grid\",\n                          \"weight\": 1,\n                          \"id\": \"2c6bb867479df2aee7711f719c93b4895cc622c4\",\n                          \"version\": 1,\n                          \"title\": \"Apache\",\n                          \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"apache requests\\\" or service =~ \\\"apache connections\\\" or service =~ \\\"apache bytes\\\")\",\n                          \"max\": \"\",\n                          \"rows\": \"\",\n                          \"cols\": \"\",\n                          \"row_sort\": \"lexical\",\n                          \"col_sort\": \"lexical\"\n                        }\n                      ]\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"850e41e4c5043cba5a9d332930205428b62a35e2\",\n                  \"version\": 2,\n                  \"title\": \"MySQL\",\n                  \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"mysql insert\\\"\u3000or service =~ \\\"mysql select\\\"\u3000or service =~ \\\"mysql write\\\"\u3000or service =~ \\\"mysql update\\\" or service =~ \\\"mysql waited\\\" or service =~ \\\"mysql commit\\\")\",\n                  \"max\": \"\",\n                  \"rows\": \"\",\n                  \"cols\": \"\",\n                  \"row_sort\": \"lexical\",\n                  \"col_sort\": \"lexical\"\n                }\n              ]\n            },\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"2aacf97b956c8036d4dbac9947c7ea1e35224811\",\n              \"version\": 17,\n              \"children\": [\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"515eb5172d8d61dd37736a9991151e0c960c0c2e\",\n                  \"version\": 8,\n                  \"title\": \"Network In\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%rx octets\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"true\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"3957704a8803eebe37747de3c2a09948955bbbed\",\n                  \"version\": 3,\n                  \"title\": \"Network Out\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%tx octets\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"true\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"f2a30d5108a3b5f6b62666e53177f6cf212e3d7d\",\n                  \"version\": 5,\n                  \"title\": \"MySQL In\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql-monitor/mysql_octets/rx\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"false\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"8e16ee1e10ae604cb02dcc167ad60de53c49afe5\",\n                  \"version\": 5,\n                  \"title\": \"MySQL Out\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql-monitor/mysql_octets/tx\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"false\"\n                }\n              ]\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"b233bf70e76f064a41de2d30f9c0651dd93cd826\",\n              \"version\": 0\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"719cf6e9ba5f20f5518ecfaaad7ab1c1faa317c1\",\n              \"version\": 0\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"08bb43ff8ec587f08f459b010b1fad0bdcf9102f\",\n              \"version\": 0\n            }\n          ]\n        }\n      },\n      \"id\": \"d189ebe557de98af74b14ed7ccd8581b0522e449\"\n    },\n    {\n      \"name\": \"test1\",\n      \"view\": {\n        \"type\": \"Balloon\",\n        \"weight\": 1,\n        \"id\": \"b23298303d7ebbbfdc575809cc2bb0adae0412ac\",\n        \"version\": 18,\n        \"child\": {\n          \"type\": \"VStack\",\n          \"weight\": 1,\n          \"id\": \"22bb84c8df0c4da31d03ec6a619c2ac119c174e3\",\n          \"version\": 18,\n          \"children\": [\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"82498a58eb9aea04cf12119026dbd3dbf3aa6657\",\n              \"version\": 16,\n              \"children\": [\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"b5b362af5b973fdaa42938bf55115dd52ff1d628\",\n                  \"version\": 3,\n                  \"title\": \"CPU\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"cpu%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"afb874aaf0d3570e5fd77941ba1329649cad0e2e\",\n                  \"version\": 8,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"0b7d19e33b8e024a73c3ff05b23c23eac0e00dde\",\n                      \"version\": 2,\n                      \"title\": \"Memory\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mem%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"14485dfbf9f3a56254e446bc144d74b3481d716a\",\n                      \"version\": 4,\n                      \"title\": \"Swap\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"swap%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"5a68afca5889e62ccbe0de689eb8b219e1fb0a12\",\n                      \"version\": 3,\n                      \"title\": \"Cassandra\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"Cassandra%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"View\",\n                      \"weight\": 1,\n                      \"id\": \"43406cd90ac7eccf35b1bb87042c764fb8ac79f6\",\n                      \"version\": 0\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"f65df3ff7e24002766e4b5b2e1e867f5de346f04\",\n                  \"version\": 2,\n                  \"title\": \"Disk\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"disk%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"a0d0d7e9f83c67b3838f9e32c8e8b5d3a92d33ee\",\n                  \"version\": 2,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"270903b0bf5facb7208189511ddf4aa85b0e843e\",\n                      \"version\": 2,\n                      \"title\": \"Apache\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"apache%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"3fd8066915af6d5b9e6e27dbe913b7ac42c5b408\",\n                      \"version\": 1,\n                      \"title\": \"NIC\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"79fb5169a9bbc90c8181e4fe93d34fb725c76192\",\n                  \"version\": 1,\n                  \"title\": \"MySQL\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                }\n              ]\n            }\n          ]\n        }\n      },\n      \"id\": \"8deba7de3aea10b0d432d8c54ab53db6e4c16d2a\"\n    }\n  ]\n}\n\n\nclient \u5074\u306e collectd \u3092\u8d77\u52d5\u3057\u305f\u3089\u81ea\u52d5\u3067\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u30ce\u30fc\u30c9\u8ffd\u52a0\u3055\u308c\u308b\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b0\u30e9\u30d5\u8868\u793a\u4ee5\u5916\u306b\u3082\u3001\u30ed\u30b0\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u6d41\u3057\u305f\u308a\u30ea\u30b9\u30c8\u8868\u793a\u3057\u305f\u308a\u3082\u3067\u304d\u308b\n[\u524d\u56de](http://qiita.com/quickguard/items/eb11b40c8853eb99dcb8) collectd \u306b\u3064\u3044\u3066\u89e6\u308c\u305f\u306e\u3067\u3001\u3064\u3044\u3067\u306b output \u306b\u3064\u3044\u3066\u3082\u8a18\u8f09\n\n#\u6982\u8981\ncollectd \u3067\u53ce\u96c6\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u60c5\u5831\u3092 [riemann](http://riemann.io/) \u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u51e6\u7406\u3059\u308b\n\nriemann \u306f\u3001\u30a4\u30d9\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u30a8\u30f3\u30b8\u30f3\u3067\u3001\u4ee5\u4e0b\u306e\u57fa\u672c\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u4efb\u610f\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4ed8\u4e0e\u3067\u304d\u308b\n\n- host\n- service\n- state\n- time\n- description\n- tags\n- metric\n- ttl\n\n\u25a0\u69cb\u6210\n\n```\ncollectd -> riemann -> riemann-dash \n               \u2514> Graphite -> Grafana\n```\n\n\u30e1\u30c8\u30ea\u30af\u30b9\u3092 Graphite \u4ee5\u5916\uff08InfluxDB, datadog \u7b49\u306e SaaS\uff09\u306b\u3082\u4fdd\u5b58\u3057\u305f\u308a\u3001\u30a2\u30e9\u30fc\u30c8\u3092\u30e1\u30fc\u30eb\u3001Slack\u3001Nagios \u306b\u6295\u3052\u305f\u308a\u3082\u3067\u304d\u308b\n\n**\u30a4\u30e1\u30fc\u30b8**\n![00.png](https://qiita-image-store.s3.amazonaws.com/0/105824/ab06100d-fd30-cb34-a146-822814197dc6.png)\n\u516c\u5f0f\u30b5\u30a4\u30c8\u3088\u308a\n\n\n#riemann \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install daemonize\n# rpm -ivh https://aphyr.com/riemann/riemann-0.2.10-1.noarch.rpm\n```\n\n#riemann \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n**\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210**\n\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb + \u5404\u5f79\u5272\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5206\u5272\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f clojure \u3067\u8a18\u8ff0\n\n```\n/etc/riemann/\n|--riemann.config\n|\n|--/streams/\n|    |--default.config\n|    |--load.config\n|\n|--/filters/\n|    |--collectd.config\n|    |--rewrite.config\n|\n|--/targets/\n     |--graphite.config\n     |--index.config\n```\n\n- streams : \u30a4\u30d9\u30f3\u30c8\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n- filters : \u30a4\u30d9\u30f3\u30c8\u306b\u5bfe\u3059\u308b\u5909\u63db\u51e6\u7406\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n- target  : graphite \u3078\u306e\u51fa\u529b\u7b49 output \u95a2\u9023\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n\n\n**\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb**\n\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3084 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea include \u7b49\u3001\u57fa\u672c\u8a2d\u5b9a\u306e\u307f\n\n```clj:/etc/riemann/riemann.config\n(logging/init :file \"/var/log/riemann/riemann.log\")\n\n(let [host \"0.0.0.0\"]\n  (tcp-server  :host host) ; :port 5555\n  (udp-server  :host host) ; :port 5555\n  (ws-server   :host host) ; :port 5556\n  (sse-server  :host host) ; :port 5558\n  (repl-server :host host) ; :port 5557\n)\n\n(periodically-expire 60)\n\n(include \"filters\")\n(include \"targets\")\n(include \"streams\")\n```\n\n**\u30a4\u30d9\u30f3\u30c8\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406**\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u51e6\u7406\n\n```clj:/etc/riemann/streams/default.config\n(streams\n  graph\n  (with { :metric 1 :service \"events/sec\"\n      :host nil :tags nil :state nil } (rate 5 index))\n  (expired\n    #(info \"expired\" %))\n)\n```\n\n\u95be\u5024\u306b\u3088\u308b\u30b9\u30c6\u30fc\u30bf\u30b9\u51e6\u7406\n\n```clj:/etc/riemann/streams/load.config\n(streams\n  rewrite-index\n  (cpu-stream rewrite-index)\n  (mem-stream rewrite-index)\n  (swap-stream rewrite-index)\n\n  (where (service #\"/cpu-\")\n    (split\n      (service #\"/cpu-idle$\")\n        (splitp >= metric\n          1  (with :state \"critical\" rewrite-index)\n          20 (with :state \"warning\"  rewrite-index)\n             (with :state \"ok\"       rewrite-index))\n      :otherwise\n        (splitp <= metric\n          80 (with :state \"critical\" rewrite-index)\n          40 (with :state \"warning\"  rewrite-index)\n             (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/disk_\")\n    (split\n      (service #\"/disk_octets\")\n        (splitp <= metric\n          2000 (with :state \"critical\" rewrite-index)\n               (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/memory-\")\n    (split\n      (service #\"/memory-used$\")\n        (splitp <= metric\n          30000000000 (with :state \"critical\" rewrite-index)\n          2000000000  (with :state \"warning\"  rewrite-index)\n                      (with :state \"ok\"       rewrite-index))\n  ))\n\n  (where (service #\"/if_\")\n    (split\n      (service #\"/if_octets\")\n        (splitp <= metric\n          20000 (with :state \"critical\" rewrite-index)\n          1000  (with :state \"warning\"  rewrite-index)\n                (with :state \"ok\"       rewrite-index))\n  ))\n\n)\n```\n\n**filter\u51e6\u7406**\ncollectd \u304b\u3089\u76f4\u63a5 input \u3057\u305f\u5834\u5408\u3001service \u540d\u304c\u9577\u304b\u3063\u305f\u308a\u5206\u304b\u308a\u306b\u304f\u3044\u306e\u3067\u5909\u63db\u51e6\u7406\n(load/load/shortterm \u2192 load1 \u7b49)\n\n```clj:/etc/riemann/filters/collectd.config\n(defmacro mem-stream\n  [& children]\n  `(where* (fn [{plugin# :plugin, state# :state}]\n             (and (= \"memory\" plugin#)\n                  (not= \"expired\" state#)))\n           (by [:host]\n               (project* [(comp (partial = \"used\") :type_instance)\n                          (comp (partial = \"cached\") :type_instance)\n                          (comp (partial = \"buffered\") :type_instance)\n                          (comp (partial = \"free\") :type_instance)]\n                         (smap\n                          (fn [[used# cached# buf# free#]]\n                            (when (and used# cached# buf# free#)\n                              (try\n                                (assoc used#\n                                  :service \"mem used%\"\n                                  :metric (-> (:metric used#)\n                                              (/ (+ (:metric used#)\n                                                    (:metric cached#)\n                                                    (:metric buf#)\n                                                    (:metric free#)))\n                                              (* 100)))\n                                (catch Exception e#\n                                  (error e# \"cannot compute mem pct for \" used# cached# buf# free#)\n                                  nil))))\n                          ~@children)))))\n\n(defmacro cpu-stream\n  [& children]\n  `(where* (fn [{plugin# :plugin, plugin_instance# :plugin_instance,\n                 state# :state}]\n             (and (= \"aggregation\" plugin#)\n                  (= \"cpu-average\" plugin_instance#)\n                  (not= \"expired\" state#)))\n     #(info %)\n           (by [:host]\n               (project* [(comp (partial = \"user\") :type_instance)\n                          (comp (partial = \"system\") :type_intance)\n                          (comp (partial = \"softirq\") :type_instance)\n                          (comp (partial = \"interrupt\") :type_instance)\n                          (comp (partial = \"steal\") :type_instance)\n                          (comp (partial = \"wait\") :type_instance)\n                          (comp (partial = \"nice\") :type_instance)]\n                         (smap (fn [events#]\n                                 (when-let [summed# (folds/sum events#)]\n                                   (try\n                                     (assoc summed# :service \"cpu all\")\n                                     (catch Exception e#\n                                       (error e# \"cannot compute cpu all for \" summed#)\n                                       nil))))\n                               ~@children)))))\n\n```\n\n```clj:/etc/riemann/filters/rewrite.config\n(def default-services\n  [\n   {:service \"conntrack/conntrack\" :rewrite \"conntrack\"}\n   {:service \"load/load/shortterm\" :rewrite \"load1\"}\n   {:service \"load/load/midterm\" :rewrite \"load5\"}\n   {:service \"load/load/longterm\" :rewrite \"load15\"}\n   {:service \"memory/memory-used\" :rewrite \"mem used\"}\n   {:service \"memory/memory-free\" :rewrite \"mem free\"}\n   {:service \"memory/memory-buffered\" :rewrite \"mem buffered\"}\n   {:service \"memory/memory-cached\" :rewrite \"mem cached\"}\n   {:service #\"^cpu-([0-9]+)/cpu-(.*)$\" :rewrite \"cpu-$1 $2\"}\n   {:service #\"^aggregation-cpu-average/cpu-(.*)$\" :rewrite \"cpu $1\"}\n   {:service #\"^interface-(.*)/if_(errors|packets|octets)/(tx|rx)$\"\n    :rewrite \"nic $1 $3 $2\"}\n   {:service #\"^apache-apache/apache_(.*)$\" :rewrite \"apache $1\"}\n   {:service #\"^mysql-monitor/mysql_(.*)-(.*)$\" :rewrite \"mysql $2\"}\n   ]\n)\n\n(defn rewrite-service-with\n  [rules]\n  (let [matcher (fn [s1 s2] (if (string? s1) (= s1 s2) (re-find s1 s2)))]\n    (fn [{:keys [service] :as event}]\n      (or\n       (first\n        (for [{:keys [rewrite] :as rule} rules\n              :when (matcher (:service rule) service)]\n          (assoc event :service\n                 (if (string? (:service rule))\n                   rewrite\n                   (clojure.string/replace service (:service rule) rewrite)))))\n       event))))\n\n(def rewrite-service\n  (rewrite-service-with default-services))\n```\n\n**output \u51e6\u7406**\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u4ed8\u4e0e\n\n```clj:/etc/riemann/streams/index.config\n(def index\n    (default {:state \"ok\" :ttl 300}\n      (update-index (index))))\n\n(def rewrite-index\n  (smap rewrite-service index))\n```\n\n\u30e1\u30c8\u30ea\u30af\u30b9 \u3092 graphite \u3078\u6d41\u3059\n\n```clj:/etc/riemann/streams/graphite.config\n(def graph\n    (graphite {:host \"\uff5bgraphite \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d\"}))\n```\n\n**riemann \u8d77\u52d5**\n\n```\n# /etc/init.d/riemann start\n```\n\n#riemann-dash \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u53d7\u3051\u53d6\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\u3059\u308b\u305f\u3081\u306e Sinatra \u3067\u3067\u304d\u305f\u30a2\u30d7\u30ea\n\n**\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806**\n\n```\n# cd /opt\n# git clone https://github.com/aphyr/riemann-dash.git\n# cd riemann-dash\n# gem install bundler\n# bundle install\n```\n\nfloat \u30b0\u30e9\u30d5 \u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u5909\u66f4\n\n```\n# vi /opt/riemann-dash/lib/riemann/dash/public/views/flot.js\n           max: this.max\n         },\n         xaxis: {\n+          timezone: \"browser\",\n           font: this.font,\n```\n\n\n**riemann-dash \u8d77\u52d5**\n\n```\n# RACK_ENV=production bundle exec riemann-dash -c example/config.rb &\n```\n\nhttp://\uff5briemann \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d:4567 \u306b\u30a2\u30af\u30bb\u30b9\n\n![01.png](https://qiita-image-store.s3.amazonaws.com/0/105824/85461b5b-200d-eb1d-9d20-d97c2fa62307.png)\n\n\n#client(collectd) \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\ncollectd \u3067\u53d6\u5f97\u3059\u308b\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u4ee5\u4e0b\n\n- cpu\n- apache status\n- disk\n- interface\n- mysql\n\n\n**collectd \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\n\n```\n# yum -y install libcurl-devel net-snmp-devel protobuf-c-devel yajl-devel\n# wget http://collectd.org/files/collectd-5.5.0.tar.gz\n# tar zxvf collectd-5.5.0.tar.gz\n# cd collectd-5.5.0\n# ./cofigure\n# make; make install\n```\n\n**collectd \u8a2d\u5b9a**\n\n```:/opt/collectd/etc/collectd.conf\nHostname    \"*****\"\nFQDNLookup   false\nBaseDir     \"/opt/collectd/var/lib/collectd\"\nPIDFile     \"/opt/collectd/var/run/collectd.pid\"\nPluginDir   \"/opt/collectd/lib/collectd\"\nTypesDB     \"/opt/collectd/share/collectd/types.db\"\n\nInterval     5\nTimeout      5\nReadThreads  10\nWriteThreads 10\n\nLoadPlugin syslog\n\nLoadPlugin aggregation\nLoadPlugin apache\nLoadPlugin cpu\nLoadPlugin interface\nLoadPlugin load\nLoadPlugin mysql\nLoadPlugin memory\nLoadPlugin write_riemann\n\n<Plugin \"aggregation\">\n  <Aggregation>\n    Plugin \"cpu\"\n    Type \"cpu\"\n    GroupBy \"Host\"\n    GroupBy \"TypeInstance\"\n    CalculateAverage true\n  </Aggregation>\n</Plugin>\n\n<Plugin apache>\n  <Instance \"apache\">\n    URL \"http://localhost/server-status?auto\"\n  </Instance>\n</Plugin>\n\n<Plugin interface>\n        Interface \"eth0\"\n        IgnoreSelected false\n</Plugin>\n\n<Plugin mysql>\n        <Database demo>\n                Host \"localhost\"\n                User \"demo\"\n                Password \"demo\"\n                Database \"demo\"\n        </Database>\n</Plugin>\n\n<Plugin write_riemann>\n        <Node \"*****\">\n                Host \"\uff5briemann IP \u30a2\u30c9\u30ec\u30b9\uff5d\"\n                Port 5555\n                Protocol UDP\n                StoreRates true\n               AlwaysAppendDS false\n        </Node>\n        Tag \"collectd\"\n</Plugin>\n```\n\n**\u5404 client \u3067 collectd \u8d77\u52d5**\n\n```\n# /etc/init.d/collectd start\n```\n\n#riemann-dash \u3067\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\u3059\u308b\n\ncollectd \u3067\u53d6\u5f97\u3057\u305f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b0\u30e9\u30d5\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u8868\u793a\n\u5404 view \u306b\u30af\u30a8\u30ea\u3092\u8a18\u8f09\u3059\u308b\n\n**\u4f5c\u6210\u3057\u305f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9**\n![02.png](https://qiita-image-store.s3.amazonaws.com/0/105824/dc1a5404-52ad-0bf6-2620-4bba32853524.png)\n\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30b3\u30f3\u30d5\u30a3\u30b0\n\n```json:/opt/riemann-dash/config/config.json\n{\n  \"server\": \"\uff5briemann \u30b5\u30fc\u30d0 IP \u30a2\u30c9\u30ec\u30b9\uff5d:5556\",\n  \"server_type\": \"ws\",\n  \"workspaces\": [\n    {\n      \"name\": \"Riemann\",\n      \"view\": {\n        \"type\": \"Balloon\",\n        \"weight\": 1,\n        \"id\": \"7fb2428439a04d9238de9f2fd9eff1f5910d2477\",\n        \"version\": 38,\n        \"child\": {\n          \"type\": \"VStack\",\n          \"weight\": 1,\n          \"id\": \"cc696f34d59ea1f1f996c11f09293ba5dd47567d\",\n          \"version\": 38,\n          \"children\": [\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"954004fabce0e68e0e227feb1d30aaf2aa22475b\",\n              \"version\": 19,\n              \"children\": [\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"20fc8f5754b44f9549bf5ba4525284c6017bd15d\",\n                  \"version\": 0,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"3ef8b2f3786e2ab1ba017a66b0e2440b29c11159\",\n                      \"version\": 11,\n                      \"title\": \"Load\",\n                      \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"cpu idle\\\" or service =~ \\\"load%\\\" or service =~ \\\"mem used\\\" or service =~ \\\"swap in\\\" or service =~ \\\"swap out\\\")\",\n                      \"max\": \"\",\n                      \"rows\": \"\",\n                      \"cols\": \"\",\n                      \"row_sort\": \"lexical\",\n                      \"col_sort\": \"lexical\"\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"4e7fc05a9aaa0f2723d4ad5a4e0cdc5e40834cf5\",\n                  \"version\": 5,\n                  \"children\": [\n                    {\n                      \"type\": \"HStack\",\n                      \"weight\": 1,\n                      \"id\": \"d66f68fdbe079f699944f7d25afe5376e3906fc9\",\n                      \"version\": 1,\n                      \"children\": [\n                        {\n                          \"type\": \"Grid\",\n                          \"weight\": 1,\n                          \"id\": \"2c6bb867479df2aee7711f719c93b4895cc622c4\",\n                          \"version\": 1,\n                          \"title\": \"Apache\",\n                          \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"apache requests\\\" or service =~ \\\"apache connections\\\" or service =~ \\\"apache bytes\\\")\",\n                          \"max\": \"\",\n                          \"rows\": \"\",\n                          \"cols\": \"\",\n                          \"row_sort\": \"lexical\",\n                          \"col_sort\": \"lexical\"\n                        }\n                      ]\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"850e41e4c5043cba5a9d332930205428b62a35e2\",\n                  \"version\": 2,\n                  \"title\": \"MySQL\",\n                  \"query\": \"tagged \\\"collectd\\\" and (service =~ \\\"mysql insert\\\"\u3000or service =~ \\\"mysql select\\\"\u3000or service =~ \\\"mysql write\\\"\u3000or service =~ \\\"mysql update\\\" or service =~ \\\"mysql waited\\\" or service =~ \\\"mysql commit\\\")\",\n                  \"max\": \"\",\n                  \"rows\": \"\",\n                  \"cols\": \"\",\n                  \"row_sort\": \"lexical\",\n                  \"col_sort\": \"lexical\"\n                }\n              ]\n            },\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"2aacf97b956c8036d4dbac9947c7ea1e35224811\",\n              \"version\": 17,\n              \"children\": [\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"515eb5172d8d61dd37736a9991151e0c960c0c2e\",\n                  \"version\": 8,\n                  \"title\": \"Network In\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%rx octets\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"true\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"3957704a8803eebe37747de3c2a09948955bbbed\",\n                  \"version\": 3,\n                  \"title\": \"Network Out\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%tx octets\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"true\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"f2a30d5108a3b5f6b62666e53177f6cf212e3d7d\",\n                  \"version\": 5,\n                  \"title\": \"MySQL In\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql-monitor/mysql_octets/rx\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"false\"\n                },\n                {\n                  \"type\": \"Flot\",\n                  \"weight\": 1,\n                  \"id\": \"8e16ee1e10ae604cb02dcc167ad60de53c49afe5\",\n                  \"version\": 5,\n                  \"title\": \"MySQL Out\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql-monitor/mysql_octets/tx\\\"\",\n                  \"min\": null,\n                  \"max\": null,\n                  \"timeRange\": 180,\n                  \"graphType\": \"line\",\n                  \"stackMode\": \"false\"\n                }\n              ]\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"b233bf70e76f064a41de2d30f9c0651dd93cd826\",\n              \"version\": 0\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"719cf6e9ba5f20f5518ecfaaad7ab1c1faa317c1\",\n              \"version\": 0\n            },\n            {\n              \"type\": \"View\",\n              \"weight\": 1,\n              \"id\": \"08bb43ff8ec587f08f459b010b1fad0bdcf9102f\",\n              \"version\": 0\n            }\n          ]\n        }\n      },\n      \"id\": \"d189ebe557de98af74b14ed7ccd8581b0522e449\"\n    },\n    {\n      \"name\": \"test1\",\n      \"view\": {\n        \"type\": \"Balloon\",\n        \"weight\": 1,\n        \"id\": \"b23298303d7ebbbfdc575809cc2bb0adae0412ac\",\n        \"version\": 18,\n        \"child\": {\n          \"type\": \"VStack\",\n          \"weight\": 1,\n          \"id\": \"22bb84c8df0c4da31d03ec6a619c2ac119c174e3\",\n          \"version\": 18,\n          \"children\": [\n            {\n              \"type\": \"HStack\",\n              \"weight\": 1,\n              \"id\": \"82498a58eb9aea04cf12119026dbd3dbf3aa6657\",\n              \"version\": 16,\n              \"children\": [\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"b5b362af5b973fdaa42938bf55115dd52ff1d628\",\n                  \"version\": 3,\n                  \"title\": \"CPU\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"cpu%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"afb874aaf0d3570e5fd77941ba1329649cad0e2e\",\n                  \"version\": 8,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"0b7d19e33b8e024a73c3ff05b23c23eac0e00dde\",\n                      \"version\": 2,\n                      \"title\": \"Memory\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mem%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"14485dfbf9f3a56254e446bc144d74b3481d716a\",\n                      \"version\": 4,\n                      \"title\": \"Swap\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"swap%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"5a68afca5889e62ccbe0de689eb8b219e1fb0a12\",\n                      \"version\": 3,\n                      \"title\": \"Cassandra\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"Cassandra%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"View\",\n                      \"weight\": 1,\n                      \"id\": \"43406cd90ac7eccf35b1bb87042c764fb8ac79f6\",\n                      \"version\": 0\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"f65df3ff7e24002766e4b5b2e1e867f5de346f04\",\n                  \"version\": 2,\n                  \"title\": \"Disk\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"disk%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                },\n                {\n                  \"type\": \"VStack\",\n                  \"weight\": 1,\n                  \"id\": \"a0d0d7e9f83c67b3838f9e32c8e8b5d3a92d33ee\",\n                  \"version\": 2,\n                  \"children\": [\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"270903b0bf5facb7208189511ddf4aa85b0e843e\",\n                      \"version\": 2,\n                      \"title\": \"Apache\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"apache%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    },\n                    {\n                      \"type\": \"Grid\",\n                      \"weight\": 1,\n                      \"id\": \"3fd8066915af6d5b9e6e27dbe913b7ac42c5b408\",\n                      \"version\": 1,\n                      \"title\": \"NIC\",\n                      \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"nic%\\\"\",\n                      \"max\": \"\",\n                      \"rows\": \"service\",\n                      \"cols\": \"host\"\n                    }\n                  ]\n                },\n                {\n                  \"type\": \"Grid\",\n                  \"weight\": 1,\n                  \"id\": \"79fb5169a9bbc90c8181e4fe93d34fb725c76192\",\n                  \"version\": 1,\n                  \"title\": \"MySQL\",\n                  \"query\": \"tagged \\\"collectd\\\" and service =~ \\\"mysql%\\\"\",\n                  \"max\": \"\",\n                  \"rows\": \"service\",\n                  \"cols\": \"host\"\n                }\n              ]\n            }\n          ]\n        }\n      },\n      \"id\": \"8deba7de3aea10b0d432d8c54ab53db6e4c16d2a\"\n    }\n  ]\n}\n```\n\nclient \u5074\u306e collectd \u3092\u8d77\u52d5\u3057\u305f\u3089\u81ea\u52d5\u3067\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u30ce\u30fc\u30c9\u8ffd\u52a0\u3055\u308c\u308b\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306f\u30e1\u30c8\u30ea\u30af\u30b9\u306e\u30b0\u30e9\u30d5\u8868\u793a\u4ee5\u5916\u306b\u3082\u3001\u30ed\u30b0\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u6d41\u3057\u305f\u308a\u30ea\u30b9\u30c8\u8868\u793a\u3057\u305f\u308a\u3082\u3067\u304d\u308b\n", "tags": ["\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0", "graphite", "Clojure", "monitoring"]}