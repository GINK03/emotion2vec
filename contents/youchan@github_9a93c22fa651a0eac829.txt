{"context": "\u3053\u306e\u8a18\u4e8b\u306fOpal Advent Calendar 2016\u306e24\u65e5\u76ee\u306e\u6295\u7a3f\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\u4eca\u65e5\u306f\u30af\u30ea\u30b9\u30de\u30b9\u30a4\u30d6\u3067\u3059\u306d\u3002\u6628\u65e5\u3001\u4e88\u544a\u3057\u305f\u3068\u304a\u308a\u4eca\u65e5\u306fJS\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n\u4f8b\u306b\u3088\u3063\u3066\u4f7f\u3044\u304b\u305f\u304b\u3089\u3067\u3059\u3002\nrequire 'js'\n\n%x{\n  function Foo() {\n    this.bar = function() {\n      return 'bar';\n    };\n    this.baz = 'baz';\n  };\n}\n\nfoo = JS.new(`Foo`)\nputs foo.JS.bar\nputs foo.JS[:baz]\n\n\u6628\u65e5\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u4f3c\u3066\u3044\u307e\u3059\u306d\u3002\u3069\u3061\u3089\u3082JavaScript\u306e\u30b3\u30fc\u30c9\u3092\u547c\u3073\u3060\u3059\u305f\u3081\u306eAPI\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\nNative\u306fRuby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u30e9\u30c3\u30d7\u3057\u3066Ruby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u304c\u3001JS\u306fJavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u76f4\u63a5\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u3064\u304f\u3089\u308c\u3066\u3044\u307e\u3059\u3002\nfoo = JS.new(`Foo`)\n\n\u3053\u306e\u547c\u3073\u51fa\u3057\u3067\u8fd4\u3063\u3066\u304f\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(foo)\u306fRuby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u306f\u306a\u304f\u3001JavaScript\u5074\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u3064\u307e\u308a\nfoo = `new Foo()`\n\n\u3068\u66f8\u304f\u306e\u3068\u7b49\u4fa1\u3067\u3059\u3002(\u5f8c\u3067\u898b\u307e\u3059\u304c\u5b9f\u969b\u306b\u306fapply\u3092\u3064\u304b\u3063\u3066\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002)\nfoo\u306fJavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001Ruby\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066bar\u3092\u547c\u3076\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n(Native\u3067\u306fmethod_missing\u3092\u5229\u7528\u3057\u3066bar\u3092\u547c\u3076\u3068JavaScript\u306ebar()\u95a2\u6570\u304c\u547c\u3073\u51fa\u3055\u308c\u307e\u3057\u305f\u3002)\n\u305d\u3053\u3067\u3001Ruby\u306e\u306a\u304b\u3067JavaScript\u306ebar()\u95a2\u6570\u3092\u547c\u3076\u306b\u306f\u3001\nfoo.JS.bar\n\n\u306e\u3088\u3046\u306bJS\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9(?)\u3092\u4ecb\u3057\u3066\u547c\u3073\u3060\u3057\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30fc\u30c9\u306f\n`foo.bar()`\n\n\u3068\u7b49\u4fa1\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001stdlib/js.rb\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nnew\u306e\u5b9f\u88c5\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n  if `typeof Function.prototype.bind == 'function'`\n    def new(func, *args, &block)\n      args.insert(0, `this`)\n      args << block if block\n      `new (#{func}.bind.apply(#{func}, #{args}))()`\n    end\n  else\n    def new(func, *args, &block)\n      args << block if block\n      f = `function(){return func.apply(this, args)}`\n      f.JS[:prototype] = func.JS[:prototype]\n      `new f()`\n    end\n  end\n\nbind\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3067\u5206\u5c90\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u57fa\u672c\u7684\u306b\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092apply\u3057\u3066new\u3059\u308b\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\nnew\u306e\u4ed6\u306b\u3082\u3001delete,in,instanceof,typeof\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5358\u7d14\u306bJavaScript\u306e\u30b3\u30fc\u30c9\u3092\u547c\u3076\u3060\u3051\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001call\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n  def call(func, *args, &block)\n    g = global\n    args << block if block\n    g.JS[func].JS.apply(g, args)\n  end\n  alias method_missing call\n\n\u3053\u308c\u306fmethod_missing\u306balias\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u660e\u793a\u7684\u306bcall\u3057\u306a\u304f\u3066\u3082\u3001JS.parseInt()\u306e\u3088\u3046\u306b\u547c\u3073\u3060\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306aJS\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u5b9a\u7fa9\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u306fstdlib/js.rb\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001foo.JS.bar\u306e\u3088\u3046\u306a\u3082\u306e\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\u5b9f\u306fstdlib/js.rb\u306b\u306f\u3053\u306e\u5b9f\u88c5\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305f\u3081\u3057\u306brequire 'js'\u3092\u3057\u306a\u304f\u3066\u3082\u3053\u308c\u3089\u306e\u30b3\u30fc\u30c9\u306f\u3061\u3083\u3093\u3068\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\u3067\u306f\u3069\u3053\u306b\u3042\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\n\u5148\u7a0b\u3001\nfoo.JS.bar\n\n\u306f\n`foo.bar()`\n\n\u3068\u7b49\u4fa1\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3092\u307f\u308b\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u306fJS\u3068\u3044\u3046\u306e\u306f\u3069\u3053\u306b\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3057\u3087\u3046?\n\u7b54\u3048\u306fOpal\uff1a\uff1aRewriters::DotJsSyntax\u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u3042\u308a\u307e\u3059\u3002(lib/opal/rewriters/dot_js_syntax.rb)\n\nlib/opal/rewriters/dot_js_syntax.rb\n      def on_send(node)\n        recv, meth, *args = *node\n        if recv && recv.type == :send\n          recv_of_recv, meth_of_recv, _ = *recv\n          if meth_of_recv == :JS\n            case meth\n            when :[]\n              if args.size != 1\n                raise SyntaxError, \".JS[:property] syntax supports only one argument\"\n              end\n              property = args.first\n\n              node = to_js_attr_call(recv_of_recv, property)\n            when :[]=\n              if args.size != 2\n                raise SyntaxError, '.JS[:property]= syntax supports only two arguments'\n              end\n\n              property, value = *args\n              node = to_js_attr_assign_call(recv_of_recv, property, value)\n            else\n              node = to_native_js_call(recv_of_recv, meth, args)\n            end\n            super(node)\n          else\n            super\n          end\n        else\n          super\n        end\n      end\n\n\nOpal\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u306frecv.JS\u3068\u3044\u3046\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u66f8\u304d\u66ff\u3048\u3092\u304a\u3053\u306a\u3046\u3088\u3046\u3067\u3059\u3002JS\u306e\u5f8c\u306b\u7d9a\u304f\u6587\u5b57\u5217\u306b\u3088\u3063\u3066\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3042\u308b\u3044\u306f\u30a2\u30b5\u30a4\u30f3\u3001\u30e1\u30bd\u30c3\u30c9\u30b3\u30fc\u30eb\u306e3\u30d1\u30bf\u30fc\u30f3\u306b\u5206\u308c\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u3001to_js_attr_call,to_js_attr_assign_call,to_native_js_call\u3092\u547c\u3073\u3060\u3057\u3066\u3044\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070\u3001to_js_attr_call\u3060\u3063\u305f\u3089\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n      def to_js_attr_call(recv, property)\n        s(:jsattr, recv, property)\n      end\n\nOpal\u306e\u30d1\u30fc\u30b5\u30fc\u306fs\u5f0f\u3092\u6a21\u3057\u305f\u69cb\u6587\u6728\u3092\u4f5c\u308b\u306e\u3067\u3001s\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u3060\u3057\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001:jsattr\u3068\u3044\u3046\u30ce\u30fc\u30c9\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\u3053\u306e\u30ce\u30fc\u30c9\u304c\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3059\u308b\u306e\u306f\u3001lib/opal/nodes/call_special.rb\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nlib/opal/nodes/call_special.rb\n    # recvr.JS[:prop]\n    # => recvr.prop\n    class JsAttrNode < Base\n      handle :jsattr\n      children :recvr, :property\n\n      def compile\n        push recv(recvr), '[', expr(property), ']'\n      end\n    end\n\n\nJS\u3068\u3044\u3046\u4e00\u898b\u540c\u3058\u6a5f\u80fd\u306b\u898b\u3048\u305f\u3082\u306e\u306f\u4e8c\u3064\u306e\u6a5f\u80fd\u306b\u3088\u3063\u3066\u5b9f\u73fe\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n\nJS\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308b\u3001JavaScript\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u95a2\u6570\u3084\u6f14\u7b97\u5b50\u306e\u5229\u7528\n\nrecv.JS\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u306enative\u30b3\u30fc\u30c9\u3078\u306e\u66f8\u304d\u304b\u3048\n\n\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u306f\u3058\u3081\u305f\u3068\u304d\u306b\u306f\u30a4\u30d6\u3060\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3068\u3046\u3068\u3046\u65e5\u4ed8\u304c\u5909\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01\uff01\uff01\n\u3053\u306e\u8a18\u4e8b\u306f[Opal Advent Calendar 2016](http://qiita.com/advent-calendar/2016/opal)\u306e24\u65e5\u76ee\u306e\u6295\u7a3f\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u4eca\u65e5\u306f\u30af\u30ea\u30b9\u30de\u30b9\u30a4\u30d6\u3067\u3059\u306d\u3002\u6628\u65e5\u3001\u4e88\u544a\u3057\u305f\u3068\u304a\u308a\u4eca\u65e5\u306fJS\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n\u4f8b\u306b\u3088\u3063\u3066\u4f7f\u3044\u304b\u305f\u304b\u3089\u3067\u3059\u3002\n\n```ruby\nrequire 'js'\n\n%x{\n  function Foo() {\n    this.bar = function() {\n      return 'bar';\n    };\n    this.baz = 'baz';\n  };\n}\n\nfoo = JS.new(`Foo`)\nputs foo.JS.bar\nputs foo.JS[:baz]\n```\n\n\u6628\u65e5\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u4f3c\u3066\u3044\u307e\u3059\u306d\u3002\u3069\u3061\u3089\u3082JavaScript\u306e\u30b3\u30fc\u30c9\u3092\u547c\u3073\u3060\u3059\u305f\u3081\u306eAPI\u3068\u3044\u3046\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n`Native`\u306fRuby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u30e9\u30c3\u30d7\u3057\u3066Ruby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u304c\u3001`JS`\u306fJavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u76f4\u63a5\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u3064\u304f\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n```ruby\nfoo = JS.new(`Foo`)\n```\n\n\u3053\u306e\u547c\u3073\u51fa\u3057\u3067\u8fd4\u3063\u3066\u304f\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(`foo`)\u306fRuby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u306f\u306a\u304f\u3001JavaScript\u5074\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u3064\u307e\u308a\n\n```ruby\nfoo = `new Foo()`\n```\n\n\u3068\u66f8\u304f\u306e\u3068\u7b49\u4fa1\u3067\u3059\u3002(\u5f8c\u3067\u898b\u307e\u3059\u304c\u5b9f\u969b\u306b\u306f`apply`\u3092\u3064\u304b\u3063\u3066\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002)\n\n`foo`\u306fJavaScript\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001Ruby\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066`bar`\u3092\u547c\u3076\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n(`Native`\u3067\u306f`method_missing`\u3092\u5229\u7528\u3057\u3066`bar`\u3092\u547c\u3076\u3068JavaScript\u306e`bar()`\u95a2\u6570\u304c\u547c\u3073\u51fa\u3055\u308c\u307e\u3057\u305f\u3002)\n\u305d\u3053\u3067\u3001Ruby\u306e\u306a\u304b\u3067JavaScript\u306e`bar()`\u95a2\u6570\u3092\u547c\u3076\u306b\u306f\u3001\n\n```ruby\nfoo.JS.bar\n```\n\n\u306e\u3088\u3046\u306b`JS`\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9(?)\u3092\u4ecb\u3057\u3066\u547c\u3073\u3060\u3057\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30fc\u30c9\u306f\n\n```ruby\n`foo.bar()`\n```\n\u3068\u7b49\u4fa1\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3001*stdlib/js.rb*\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n`new`\u306e\u5b9f\u88c5\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```ruby\n  if `typeof Function.prototype.bind == 'function'`\n    def new(func, *args, &block)\n      args.insert(0, `this`)\n      args << block if block\n      `new (#{func}.bind.apply(#{func}, #{args}))()`\n    end\n  else\n    def new(func, *args, &block)\n      args << block if block\n      f = `function(){return func.apply(this, args)}`\n      f.JS[:prototype] = func.JS[:prototype]\n      `new f()`\n    end\n  end\n```\n\n`bind`\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3067\u5206\u5c90\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u57fa\u672c\u7684\u306b\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092`apply`\u3057\u3066`new`\u3059\u308b\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n`new`\u306e\u4ed6\u306b\u3082\u3001`delete`,`in`,`instanceof`,`typeof`\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5358\u7d14\u306bJavaScript\u306e\u30b3\u30fc\u30c9\u3092\u547c\u3076\u3060\u3051\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001`call`\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```ruby\n  def call(func, *args, &block)\n    g = global\n    args << block if block\n    g.JS[func].JS.apply(g, args)\n  end\n  alias method_missing call\n```\n\n\u3053\u308c\u306f`method_missing`\u306balias\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u660e\u793a\u7684\u306b`call`\u3057\u306a\u304f\u3066\u3082\u3001`JS.parseInt()`\u306e\u3088\u3046\u306b\u547c\u3073\u3060\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u306e\u3088\u3046\u306a`JS`\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u5b9a\u7fa9\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u306f*stdlib/js.rb*\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001`foo.JS.bar`\u306e\u3088\u3046\u306a\u3082\u306e\u306f\u3069\u306e\u3088\u3046\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\u5b9f\u306f*stdlib/js.rb*\u306b\u306f\u3053\u306e\u5b9f\u88c5\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305f\u3081\u3057\u306b`require 'js'`\u3092\u3057\u306a\u304f\u3066\u3082\u3053\u308c\u3089\u306e\u30b3\u30fc\u30c9\u306f\u3061\u3083\u3093\u3068\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\n\u3067\u306f\u3069\u3053\u306b\u3042\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\n\n\u5148\u7a0b\u3001\n\n```ruby\nfoo.JS.bar\n```\n\n\u306f\n\n```ruby\n`foo.bar()`\n```\n\n\u3068\u7b49\u4fa1\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3092\u307f\u308b\u3068\u307e\u3063\u305f\u304f\u540c\u3058\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u306f`JS`\u3068\u3044\u3046\u306e\u306f\u3069\u3053\u306b\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3057\u3087\u3046?\n\n\u7b54\u3048\u306f`Opal\uff1a\uff1aRewriters::DotJsSyntax`\u3068\u3044\u3046\u30af\u30e9\u30b9\u306b\u3042\u308a\u307e\u3059\u3002(*lib/opal/rewriters/dot_js_syntax.rb*)\n\n```ruby:lib/opal/rewriters/dot_js_syntax.rb\n      def on_send(node)\n        recv, meth, *args = *node\n        if recv && recv.type == :send\n          recv_of_recv, meth_of_recv, _ = *recv\n          if meth_of_recv == :JS\n            case meth\n            when :[]\n              if args.size != 1\n                raise SyntaxError, \".JS[:property] syntax supports only one argument\"\n              end\n              property = args.first\n\n              node = to_js_attr_call(recv_of_recv, property)\n            when :[]=\n              if args.size != 2\n                raise SyntaxError, '.JS[:property]= syntax supports only two arguments'\n              end\n\n              property, value = *args\n              node = to_js_attr_assign_call(recv_of_recv, property, value)\n            else\n              node = to_native_js_call(recv_of_recv, meth, args)\n            end\n            super(node)\n          else\n            super\n          end\n        else\n          super\n        end\n      end\n```\n\nOpal\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u306f`recv.JS`\u3068\u3044\u3046\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u66f8\u304d\u66ff\u3048\u3092\u304a\u3053\u306a\u3046\u3088\u3046\u3067\u3059\u3002`JS`\u306e\u5f8c\u306b\u7d9a\u304f\u6587\u5b57\u5217\u306b\u3088\u3063\u3066\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3042\u308b\u3044\u306f\u30a2\u30b5\u30a4\u30f3\u3001\u30e1\u30bd\u30c3\u30c9\u30b3\u30fc\u30eb\u306e3\u30d1\u30bf\u30fc\u30f3\u306b\u5206\u308c\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u3001`to_js_attr_call`,`to_js_attr_assign_call`,`to_native_js_call`\u3092\u547c\u3073\u3060\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u305f\u3068\u3048\u3070\u3001`to_js_attr_call`\u3060\u3063\u305f\u3089\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```ruby\n      def to_js_attr_call(recv, property)\n        s(:jsattr, recv, property)\n      end\n```\n\nOpal\u306e\u30d1\u30fc\u30b5\u30fc\u306fs\u5f0f\u3092\u6a21\u3057\u305f\u69cb\u6587\u6728\u3092\u4f5c\u308b\u306e\u3067\u3001`s`\u3068\u3044\u3046\u30e1\u30bd\u30c3\u30c9\u306e\u547c\u3073\u3060\u3057\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001`:jsattr`\u3068\u3044\u3046\u30ce\u30fc\u30c9\u3092\u3064\u304f\u308a\u307e\u3059\u3002\n\u3053\u306e\u30ce\u30fc\u30c9\u304c\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3059\u308b\u306e\u306f\u3001*lib/opal/nodes/call_special.rb*\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```ruby:lib/opal/nodes/call_special.rb\n    # recvr.JS[:prop]\n    # => recvr.prop\n    class JsAttrNode < Base\n      handle :jsattr\n      children :recvr, :property\n\n      def compile\n        push recv(recvr), '[', expr(property), ']'\n      end\n    end\n```\n\n`JS`\u3068\u3044\u3046\u4e00\u898b\u540c\u3058\u6a5f\u80fd\u306b\u898b\u3048\u305f\u3082\u306e\u306f\u4e8c\u3064\u306e\u6a5f\u80fd\u306b\u3088\u3063\u3066\u5b9f\u73fe\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n* `JS`\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308b\u3001JavaScript\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u95a2\u6570\u3084\u6f14\u7b97\u5b50\u306e\u5229\u7528\n* `recv.JS`\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u547c\u3073\u51fa\u3057\u306enative\u30b3\u30fc\u30c9\u3078\u306e\u66f8\u304d\u304b\u3048\n\n\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u306f\u3058\u3081\u305f\u3068\u304d\u306b\u306f\u30a4\u30d6\u3060\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3068\u3046\u3068\u3046\u65e5\u4ed8\u304c\u5909\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\u30e1\u30ea\u30fc\u30af\u30ea\u30b9\u30de\u30b9\uff01\uff01\uff01\n", "tags": ["Ruby", "Opal"]}