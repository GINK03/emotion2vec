{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nRedshift\u3067\u306f\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3063\u3066\u4fbf\u5229\u306a\u96c6\u8a08\u304c\u3067\u304d\u307e\u3059\u3002\n\uff08\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306b\u95a2\u3057\u3066\u306fPostgreSQL\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306eTips\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u3044\u3044\u3067\u3059\u3002\uff09\n\u305d\u306e\u8a18\u4e8b\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306b\u624b\u3092\u52a0\u3048\u3066\u3061\u3087\u3063\u3068\u4fbf\u5229\u306a\u3053\u3068\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3084\u308a\u305f\u3044\u4e8b\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304c\u3042\u3063\u305f\u3068\u304d\u306b\u3001\u6559\u79d1(subject)\u3054\u3068\u306bgrade\u304c\u9ad8\u3044\u751f\u5f92(name)\u3092\u30e9\u30f3\u30ad\u30f3\u30b0\u8868\u793a\u3059\u308b\u3002\n\u3053\u308c\u3092\u4f7f\u3048\u3070\u3001\u4f8b\u3048\u3070EC\u306e\u30b5\u30a4\u30c8\u3067\u3001\u30ab\u30c6\u30b4\u30ea\u3054\u3068\u306b\u58f2\u4e0a\u304c\u9ad8\u3044X\u500b\u306e\u30a2\u30a4\u30c6\u30e0\u306e\u307f\u3092\u53d6\u308a\u51fa\u3059\u3068\u3044\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n    name     | subject | grade | last_seen_in_class \n-------------+---------+-------+--------------------\n Michael     | english |     6 | 2014-08-24\n Emily       | math    |     5 | 2014-08-17\n Christopher | math    |     9 | 2014-08-24\n William     | english |     0 | 2014-07-18\n Tyler       | english |     4 | 2014-08-20\n Alexander   | history |    10 | 2014-08-22\n Benjamin    | history |     1 | 2014-08-24\n Jacob       | english |     9 | 2014-08-16\n Matthew     | english |     7 | 2014-08-24\n Emma        | math    |     8 | 2014-08-17\n Ashley      | math    |    10 | 2014-08-16\n Grace       | english |     3 | 2014-08-21\n Alexis      | history |     4 | 2014-08-24\n Victoria    | history |     4 | 2014-08-24\n(14 \u884c)\n\n\n\u624b\u9806\nRedshift\u3067\u8a66\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\nCREATE TEMP TABLE student_subjects (\n   name text,\n   subject text,\n   grade int DEFAULT NULL,\n   last_seen_in_class date\n);\n\n\n\u30c7\u30fc\u30bf\u306e\u7528\u610f\nINSERT INTO student_subjects (name, subject, grade, last_seen_in_class) VALUES \n    ('Jacob', 'english', '9', '2014-08-16'), ('Michael', 'english', '6', '2014-08-24'), \n    ('Matthew', 'english', '7', '2014-08-24'), ('Emily', 'math', '5', '2014-08-17'),\n    ('Emma', 'math', '8', '2014-08-17'), ('Christopher', 'math', '9', '2014-08-24'),\n    ('Ashley', 'math', '10', '2014-08-16'), ('William', 'english', '0', '2014-07-18'),\n    ('Grace', 'english', '3', '2014-08-21'), ('Tyler', 'english', '4', '2014-08-20'),\n    ('Alexis', 'history', '4', '2014-08-24'), ('Alexander', 'history', '10', '2014-08-22'),\n    ('Victoria', 'history', '4', '2014-08-24'), ('Benjamin', 'history', '1', '2014-08-24');\n\n\n\u5404\u30b5\u30d6\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306bgrade\u3067\u30e9\u30f3\u30af\u3092\u51fa\u3059\nSELECT rank() OVER (PARTITION BY subject ORDER BY grade DESC), name, subject, grade\nFROM student_subjects\nORDER BY subject, grade DESC;\n\n\u7d50\u679c\n rank |    name     | subject | grade \n------+-------------+---------+-------\n    1 | Jacob       | english |     9\n    2 | Matthew     | english |     7\n    3 | Michael     | english |     6\n    4 | Tyler       | english |     4\n    5 | Grace       | english |     3\n    6 | William     | english |     0\n    1 | Alexander   | history |    10\n    2 | Alexis      | history |     4\n    2 | Victoria    | history |     4\n    4 | Benjamin    | history |     1\n    1 | Ashley      | math    |    10\n    2 | Christopher | math    |     9\n    3 | Emma        | math    |     8\n    4 | Emily       | math    |     5\n(14 \u884c)\n\n\n\u5404\u30b5\u30d6\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306bgrade\u306eTop3\u3092\u51fa\u3059\n\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3063\u305fSQL\u5185\u3067\u306fwhere\u53e5\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u5165\u308c\u5b50\u306b\u3057\u3066WHERE\u3067\u53d6\u5f97\u3059\u308brank\u3092\u5236\u9650\u3057\u307e\u3059\u3002\nSELECT\n    *\nFROM\n    (\n        SELECT rank() OVER (PARTITION BY subject ORDER BY grade DESC), name, subject, grade\n        FROM student_subjects\n        ORDER BY subject, grade DESC\n    ) as t\nWHERE\n    rank <= 3\n\n\u7d50\u679c\n rank |    name     | subject | grade \n------+-------------+---------+-------\n    1 | Jacob       | english |     9\n    2 | Matthew     | english |     7\n    3 | Michael     | english |     6\n    1 | Alexander   | history |    10\n    2 | Alexis      | history |     4\n    2 | Victoria    | history |     4\n    1 | Ashley      | math    |    10\n    2 | Christopher | math    |     9\n    3 | Emma        | math    |     8\n(9 \u884c)\n\n\n# \u6982\u8981\nRedshift\u3067\u306f\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3063\u3066\u4fbf\u5229\u306a\u96c6\u8a08\u304c\u3067\u304d\u307e\u3059\u3002\n\uff08\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306b\u95a2\u3057\u3066\u306f[PostgreSQL\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306eTips](http://postd.cc/window_functions_postgresql/)\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u3044\u3044\u3067\u3059\u3002\uff09\n\n\u305d\u306e\u8a18\u4e8b\u306e\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306b\u624b\u3092\u52a0\u3048\u3066\u3061\u3087\u3063\u3068\u4fbf\u5229\u306a\u3053\u3068\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u3084\u308a\u305f\u3044\u4e8b\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304c\u3042\u3063\u305f\u3068\u304d\u306b\u3001\u6559\u79d1(subject)\u3054\u3068\u306bgrade\u304c\u9ad8\u3044\u751f\u5f92(name)\u3092\u30e9\u30f3\u30ad\u30f3\u30b0\u8868\u793a\u3059\u308b\u3002\n\u3053\u308c\u3092\u4f7f\u3048\u3070\u3001\u4f8b\u3048\u3070EC\u306e\u30b5\u30a4\u30c8\u3067\u3001\u30ab\u30c6\u30b4\u30ea\u3054\u3068\u306b\u58f2\u4e0a\u304c\u9ad8\u3044X\u500b\u306e\u30a2\u30a4\u30c6\u30e0\u306e\u307f\u3092\u53d6\u308a\u51fa\u3059\u3068\u3044\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n```\n    name     | subject | grade | last_seen_in_class \n-------------+---------+-------+--------------------\n Michael     | english |     6 | 2014-08-24\n Emily       | math    |     5 | 2014-08-17\n Christopher | math    |     9 | 2014-08-24\n William     | english |     0 | 2014-07-18\n Tyler       | english |     4 | 2014-08-20\n Alexander   | history |    10 | 2014-08-22\n Benjamin    | history |     1 | 2014-08-24\n Jacob       | english |     9 | 2014-08-16\n Matthew     | english |     7 | 2014-08-24\n Emma        | math    |     8 | 2014-08-17\n Ashley      | math    |    10 | 2014-08-16\n Grace       | english |     3 | 2014-08-21\n Alexis      | history |     4 | 2014-08-24\n Victoria    | history |     4 | 2014-08-24\n(14 \u884c)\n```\n\n# \u624b\u9806\n\nRedshift\u3067\u8a66\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n```\nCREATE TEMP TABLE student_subjects (\n   name text,\n   subject text,\n   grade int DEFAULT NULL,\n   last_seen_in_class date\n);\n```\n\n## \u30c7\u30fc\u30bf\u306e\u7528\u610f\n\n```\nINSERT INTO student_subjects (name, subject, grade, last_seen_in_class) VALUES \n    ('Jacob', 'english', '9', '2014-08-16'), ('Michael', 'english', '6', '2014-08-24'), \n    ('Matthew', 'english', '7', '2014-08-24'), ('Emily', 'math', '5', '2014-08-17'),\n    ('Emma', 'math', '8', '2014-08-17'), ('Christopher', 'math', '9', '2014-08-24'),\n    ('Ashley', 'math', '10', '2014-08-16'), ('William', 'english', '0', '2014-07-18'),\n    ('Grace', 'english', '3', '2014-08-21'), ('Tyler', 'english', '4', '2014-08-20'),\n    ('Alexis', 'history', '4', '2014-08-24'), ('Alexander', 'history', '10', '2014-08-22'),\n    ('Victoria', 'history', '4', '2014-08-24'), ('Benjamin', 'history', '1', '2014-08-24');\n```\n\n## \u5404\u30b5\u30d6\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306bgrade\u3067\u30e9\u30f3\u30af\u3092\u51fa\u3059\n\n```\nSELECT rank() OVER (PARTITION BY subject ORDER BY grade DESC), name, subject, grade\nFROM student_subjects\nORDER BY subject, grade DESC;\n```\n\n\u7d50\u679c\n\n```\n rank |    name     | subject | grade \n------+-------------+---------+-------\n    1 | Jacob       | english |     9\n    2 | Matthew     | english |     7\n    3 | Michael     | english |     6\n    4 | Tyler       | english |     4\n    5 | Grace       | english |     3\n    6 | William     | english |     0\n    1 | Alexander   | history |    10\n    2 | Alexis      | history |     4\n    2 | Victoria    | history |     4\n    4 | Benjamin    | history |     1\n    1 | Ashley      | math    |    10\n    2 | Christopher | math    |     9\n    3 | Emma        | math    |     8\n    4 | Emily       | math    |     5\n(14 \u884c)\n```\n\n## \u5404\u30b5\u30d6\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306bgrade\u306eTop3\u3092\u51fa\u3059\n\n\u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u3092\u4f7f\u3063\u305fSQL\u5185\u3067\u306fwhere\u53e5\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u5165\u308c\u5b50\u306b\u3057\u3066WHERE\u3067\u53d6\u5f97\u3059\u308brank\u3092\u5236\u9650\u3057\u307e\u3059\u3002\n\n```\nSELECT\n    *\nFROM\n    (\n        SELECT rank() OVER (PARTITION BY subject ORDER BY grade DESC), name, subject, grade\n        FROM student_subjects\n        ORDER BY subject, grade DESC\n    ) as t\nWHERE\n    rank <= 3\n```\n\n\u7d50\u679c\n\n```\n rank |    name     | subject | grade \n------+-------------+---------+-------\n    1 | Jacob       | english |     9\n    2 | Matthew     | english |     7\n    3 | Michael     | english |     6\n    1 | Alexander   | history |    10\n    2 | Alexis      | history |     4\n    2 | Victoria    | history |     4\n    1 | Ashley      | math    |    10\n    2 | Christopher | math    |     9\n    3 | Emma        | math    |     8\n(9 \u884c)\n```\n\n\n\n\n\n\n\n\n\n\n\n", "tags": ["redshift", "PostgreSQL"]}