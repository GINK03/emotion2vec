{"context": " More than 1 year has passed since last update.AWS\u306b\u306fCloudWatch\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u671f\u9593\u304c\u305f\u3063\u305f\u306e2\u9031\u9593\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\u305d\u308c\u3067\u306f\u904b\u7528\u3092\u7d9a\u3051\u3066\u3044\u304f\u306b\u3042\u305f\u3063\u3066\u77ed\u3059\u304e\u308b\u306e\u3067\u3001Zabbix\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u3066CloudWatch\u304b\u3089\u5024\u3092\u53d6\u5f97\u3057\u3064\u3064\u3001Zabbix\u304b\u3089\u3082\u76e3\u8996\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttps://www.zabbix.com/documentation/2.4/doku.php\n\n\u52d5\u4f5c\u78ba\u8a8d\u69cb\u6210\n\n\nEC2(c3.large)\n\nCentOS 6.6\nZabbix 2.4.3\nPHP 5.6.5\nnginx 1.6.2\n\n\n\nRDS(db.m3.medium)\n\nMySQL 5.6.22\n\n\n\n\nRDS\n\nSecurity Group\u4f5c\u6210\n\nZabbix\u30b5\u30fc\u30d0\u304b\u3089Port 3306\u3078\u306e\u30a2\u30af\u30bb\u30b9\u304c\u5fc5\u8981\n\n\n\n\nType\nProtocol\nPort Range\nSource\n\n\n\n\n3306\nTCP\n3306\nZabbix\u30b5\u30fc\u30d0\n\n\n\n\nDB Subnet Group\u4f5c\u6210\n\n\u65e2\u5b58\u306eVPC Subnet\u3092\u8ffd\u52a0\u3057\u305fDB Subnet Group\u3092\u4f5c\u6210\n\n\nParameter Group\u4f5c\u6210\n\n\nParameter Groups -> Create Parameter Group\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9069\u5b9c\u8a2d\u5b9a\n\n\n\n\nOption Group\u4f5c\u6210\n\n\nOption Groups -> Create Group\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9069\u5b9c\u8a2d\u5b9a\n\n\n\n\nRDS\u8d77\u52d5\n\nRDS -> Launch a DB Instance -> MySQL\n\n\nDo you plan to use this database for production purposes?\u3067\u9069\u5b9c\u9078\u629e\nBackup/Maintenance\u306f\u9069\u5b9c\u8a2d\u5b9a\n\n\n\n\n\n\nEC2\u8d77\u52d5\n\nIAM Role\u4f5c\u6210\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"autoscaling:Describe*\",\n        \"cloudwatch:Describe*\",\n        \"cloudwatch:Get*\",\n        \"cloudwatch:List*\",\n        \"logs:Get*\",\n        \"logs:Describe*\",\n        \"logs:TestMetricFilter\",\n        \"sns:Get*\",\n        \"sns:List*\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\nEC2\u8d77\u52d5\n\n\u4f5c\u6210\u3057\u305fIAM Role\u3092\u6307\u5b9a\u3057\u305f\u4e0a\u3067EC2\u3092\u8d77\u52d5\nc3.large\nCentOS 6.6\nSecutiry Group\u306b\u3066TCP Port 22/443\u3092IP\u9650\u5b9a\u3057\u3066\u958b\u653e\n\u65e2\u5b58\u306eVPC\u306b\u6240\u5c5e\u3055\u305b\u308b\nEIP\u3092\u4ed8\u4e0e\n\n\nPHP 5.6 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# rpm -ivh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\n# rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n# yum install --enablerepo=remi,remi-php56 php php-cli php-common php-gd php-pdo php-mysql php-xml php-bcmath php-mbstring php-fpm php-devel\n# php --version\nPHP 5.6.5 (cli) (built: Jan 21 2015 17:50:29)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2014 Zend Technologies\n\n# vi /etc/php.ini\n\n\n/etc/php.ini\n-max_execution_time = 30\n+max_execution_time = 300\n-max_input_time = 60\n+max_input_time = 300\n-post_max_size = 8M\n+post_max_size = 32M\n-;always_populate_raw_post_data = -1\n+always_populate_raw_post_data = -1\n+date.timezone = Asia/Tokyo\n\n\n\nMySQL\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://dev.mysql.com/downloads/repo/yum/\n\nMySQL\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n# rpm -ivh http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n\n\nMySQL\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install mysql\n# mysql --version\nmysql  Ver 14.14 Distrib 5.6.22, for Linux (x86_64) using  EditLine wrapper\n\n\nZabbix 2.4 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttp://www.zabbix.com/jp/download.php\n\nZabbix\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n# rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n\n\nZabbix\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-web-japanese zabbix-get\n\n\nZabbix \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com\nmysql> create database zabbix character set utf8 collate utf8_bin;\nmysql> grant all privileges on zabbix.* to zabbix@'10.0.%' identified by 'xxxx';\n\n\nschema\u5b9a\u7fa9/\u30c7\u30fc\u30bf\u6295\u5165\n# cd /usr/share/doc/zabbix-server-mysql-2.4.3/create\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < schema.sql\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < images.sql\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < data.sql\n\n\nZabbix Server\u8a2d\u5b9a\n# vi /etc/zabbix/zabbix_server.conf\n\nDBHost=zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com\nDBName=zabbix\nDBUser=zabbix\nDBPassword=xxxx\n\n\nZabbix Server\u8d77\u52d5\n# chkconfig zabbix-server on\n# service zabbix-server start\n\n\nZabbix Agent\u8d77\u52d5\n# chkconfig zabbix-agent on\n# service zabbix-agent start\n\n\nnginx \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306fstable\u306e1.6\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u305f\u3060\u3001nginx\u4f5c\u8005\u3044\u308f\u304f\u3001stable\u3088\u308amainline\u3092\u4f7f\u3046\u3079\u304d\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001mainline\u306e\u65b9\u304c\u3044\u3044\u304b\u3082\u3002\n\nnginx\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# rpm -ivh http://nginx.org/packages/rhel/6/noarch/RPMS/nginx-release-rhel-6-0.el6.ngx.noarch.rpm\n\n\nnginx\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install nginx\n# nginx -v\nnginx version: nginx/1.6.2\n\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u4f5c\u6210\n# ln -s /usr/share/zabbix /usr/share/nginx/html/zabbix\n\n\nSSL\u8a3c\u660e\u66f8\u4f5c\u6210\n\n\nOrganization Name\u3084Common Name\u306a\u3069\u306f\u9069\u5b9c\u8a2d\u5b9a\u3059\u308b\u3053\u3068\n\n# openssl req -new -days 365 -x509 -sha256 -newkey rsa:2048 -nodes -keyout /etc/nginx/zabbix-cert.key -out /etc/nginx/zabbix-cert.crt\nGenerating a 2048 bit RSA private key\n................................+++\n.........+++\nwriting new private key to '/etc/nginx/zabbix-cert.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:JP\nState or Province Name (full name) []:Tokyo\nLocality Name (eg, city) [Default City]:Minato\nOrganization Name (eg, company) [Default Company Ltd]:Enigmo Inc.\nOrganizational Unit Name (eg, section) []:System\nCommon Name (eg, your name or your server's hostname) []:zabbix.example.com\nEmail Address []:\n\n# chmod 400 /etc/nginx/zabbix-cert.*\n# openssl x509 -in /etc/nginx/zabbix-cert.crt -text -noout | grep \"Signature\\|Public-Key\"\n    Signature Algorithm: sha256WithRSAEncryption\n                Public-Key: (2048 bit)\n    Signature Algorithm: sha256WithRSAEncryption\n\n\nZabbix\u7528\u306e\u8a2d\u5b9a\n# vi /etc/nginx/conf.d/zabbix.conf\n\nserver {\n    listen 80;\n    listen 443 default_server ssl spdy;\n\n    root /usr/share/nginx/html;\n    ssl                  on;\n    ssl_certificate      /etc/nginx/zabbix-cert.crt;\n    ssl_certificate_key  /etc/nginx/zabbix-cert.key;\n\n    ssl_session_timeout  5m;\n\n    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers  ECDHE+RSAGCM:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:!aNULL!eNull:!EXPORT:!DES:!3DES:!MD5:!DSS;\n    ssl_prefer_server_ciphers   on;\n\n    server_name zabbix.example.com;\n    index index.html;\n    access_log /var/log/nginx/zabbix-access_log main;\n    error_log  /var/log/nginx/zabbix-error_log error;\n\n    location /zabbix {\n        index index.php;\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass 127.0.0.1:9000;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        include fastcgi_params;\n    }\n}\n\n\n\u57fa\u672c\u7684\u306a\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n# vi /etc/nginx/nginx.conf\n\n\n/etc/nginx/nginx.conf\n-worker_processes  1;\n+worker_processes  2;\n+worker_rlimit_nofile 100000;\n\n events {\n     worker_connections  1024;\n+    multi_accept on;\n+    use epoll;\n }\n\nhttp {\n-    #tcp_nopush     on;\n+    tcp_nopush      on;\n\n-    #gzip  on;\n+    gzip  on;\n+    gzip_vary on;\n+    gzip_comp_level 6;\n+    gzip_min_length 1024;\n+    gzip_types text/plain application/javascript text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\n+\n+   open_file_cache max=100000 inactive=20s;\n+   open_file_cache_valid 30s;\n+   open_file_cache_min_uses 2;\n+   open_file_cache_errors   on;\n+\n+    server_tokens  off;\n}\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30c1\u30a7\u30c3\u30af\n# service nginx configtest\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n\n\nnginx, php-fpm\u8d77\u52d5\n# chkconfig nginx on\n# service nginx start\n# chkconfig php-fpm on\n# service php-fpm start\n\n\nAWS\u76e3\u8996\u7528\u30d1\u30c3\u30b1\u30fc\u30b8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nAWS CLI \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nEPEL\u8a2d\u5b9a\n\n# rpm -ivh http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\n\n# vi /etc/yum.repos.d/epel.repo\n\n\n/etc/yum.repos.d/epel.repo\n[epel]\nname=Extra Packages for Enterprise Linux 6 - $basearch\n#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch\nmirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch\nfailovermethod=priority\n-enabled=1\n+enabled=0\n\n\n\npython-pip\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n# yum --enablerepo=epel install python-pip\n\n\nawscli\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n# pip install awscli\n\n\n\u78ba\u8a8d\n\n# aws --version\naws-cli/1.7.3 Python/2.6.6 Linux/2.6.32-504.1.3.el6.x86_64\n\n\nAWS CLI\u8a2d\u5b9a\n\u4f5c\u6210\u3057\u305fUser\u306eAccess Key/Secret Access Key\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n# sudo -u zabbix aws configure\nAWS Access Key ID [None]: xxxxxxxxxxxxx\nAWS Secret Access Key [None]: xxxxxxxxxxxxx\nDefault region name [None]: ap-northeast-1\nDefault output format [None]:\n\n# aws configure\nAWS Access Key ID [None]: xxxxxxxxxxxxx\nAWS Secret Access Key [None]: xxxxxxxxxxxxx\nDefault region name [None]: ap-northeast-1\nDefault output format [None]:\n\n\njq \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum --enablerepo=epel install jq\n\n\nZabbix\u8a2d\u5b9a\n\nWeb UI\u306b\u30a2\u30af\u30bb\u30b9\nhttps://zabbix.example.com/zabbix/setup.php\n\nZabbix Server\u521d\u671f\u8a2d\u5b9a\n\nNext\n\n\n\nNext\n\n\n\nUser/Password\u3092\u5165\u529b\u5f8c\u3001Test connection\u3067OK\u3068\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\nNext\n\n\n\n\u8b58\u5225\u7528\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306fName\u306b\u5165\u529b\nNext\n\n\n\nNext\n\n\n\nFinish\n\n\n\nUsername: Admin, Password: zabbix\nSign in\n\n\n\n\u30e1\u30fc\u30eb\u9001\u4fe1\u8a2d\u5b9a\n\nPostfix\u8a2d\u5b9a\n\u30db\u30b9\u30c8\u540d\u8a2d\u5b9a\u3002\n# vi /etc/postfix/main.cf\n\n\n/etc/postfix/main.cf\n+myhostname = zabbix.example.com\n\n\n# service postfix check\n# service postfix reload\n\n\nDNS\u30ec\u30b3\u30fc\u30c9\u8a2d\u5b9a\n\nTXT\u30ec\u30b3\u30fc\u30c9\u306bZabbix\u30b5\u30fc\u30d0\u306eEIP\u3092\u8ffd\u52a0\nZabbix\u30b5\u30fc\u30d0\u306eA\u30ec\u30b3\u30fc\u30c9\u3092\u8a2d\u5b9a\n\n\nzabbix.example.com -> Zabbix\u30b5\u30fc\u30d0\u306eEIP\nPostfix\u3067\u8a2d\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u540d\u3068\u5408\u308f\u305b\u308b\u3053\u3068\n\n\n\n\nAWS\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u5236\u9650\u306e\u89e3\u9664\u7533\u8acb\n\nElastic IP Address 1 -> Zabbix\u30b5\u30fc\u30d0\u306eEIP\nReverse DNS Record for EIP 1 -> zabbix.example.com\n\nhttps://portal.aws.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request\n\n\n\u53d7\u7406\u3055\u308c\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30fc\u30eb\u304c\u9001\u3089\u308c\u3066\u304f\u308b\n\nYour AWS Inquiry\n\nWe have configured the reverse DNS record(s) you requested. Your request was mapped for xxx.xxx.xxx.xxx. :zabbix.example.com. Please note that propagation of this update to DNSBL services that Amazon works with may take up to a week.\n\nIf you also requested removal of the email sending limitations on your account, these have also been removed for any IPs and instances under your account.\n\n\nSMTP\u8a2d\u5b9a\n\n\u7ba1\u7406 -> Email\nSMTP\u30b5\u30fc\u30d0\u30fc: localhost\nSMTP helo: zabbix.example.com\n\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9: zabbix@example.com\n\n\n\n\u76e3\u8996\u8a2d\u5b9a\n\u4ee5\u4e0b\u3092\u5229\u7528\u30fb\u53c2\u8003\u306b\u3057\u3066\u8a2d\u5b9a\u3002\n\n\nhttp://www.zabbix.org/wiki/Zabbix_Templates\n\nnginx: https://github.com/blacked/zbx_nginx_template\n\n\n\n\nhttp://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/CW_Support_For_AWS.html\n\nhttp://dev.classmethod.jp/cloud/aws/zabbix-with-cloudwatch/\n\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\u76e3\u8996\u3055\u308c\u308b\u5074\u3067\u884c\u3046\u4f5c\u696d\u306f\u4ee5\u4e0b\u3002\n\nZabbix\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n# rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n\n\nZabbix Agent\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install zabbix-agent\n\n\nZabbix Agent\u8a2d\u5b9a\n# vi /etc/zabbix/zabbix_agentd.conf\n\n\n/etc/zabbix/zabbix_agentd.conf\n-Hostname=Zabbix server\n+#Hostname=Zabbix server\n\n+EnableRemoteCommands=1\n\n+HostMetadataItem=system.uname\n\n\n\nZabbix Agent\u8d77\u52d5\n# chkconfig zabbix-agent on\n# service zabbix-agent start\n\n\n\u76e3\u8996\u5bfe\u8c61\u30db\u30b9\u30c8\u3092\u81ea\u52d5\u767b\u9332\u3059\u308b\u5834\u5408\n\u4e0b\u8a18\u624b\u9806\u3092\u5143\u306b\u8a2d\u5b9a\u3059\u308b\u3002\nhttps://www.zabbix.com/documentation/2.4/manual/discovery/auto_registration\n\n\u30b5\u30fc\u30d0\u5074\u3067\u30a2\u30af\u30b7\u30e7\u30f3\u8a2d\u5b9a\nWeb UI\u306b\u3066\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n\n\n\u8a2d\u5b9a -> \u30a2\u30af\u30b7\u30e7\u30f3\n\n\n\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b9\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u30e1\u30cb\u30e5\u30fc\u3067\u81ea\u52d5\u767b\u9332\u3092\u9078\u629e\n\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n\u30a2\u30af\u30b7\u30e7\u30f3\u30bf\u30d6\u5185\u306e\u540d\u524d\u3067\u3001\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u540d\u524d\u3092\u4ed8\u3051\u308b\n\n\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u6761\u4ef6\u30bf\u30d6\u3067\u3001\u4efb\u610f\u306e\u6761\u4ef6\u3092\u6307\u5b9a\uff08\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u5168\u3066\u306e\u30db\u30b9\u30c8\u304c\u5bfe\u8c61\u3068\u306a\u308b\uff09\n\n\n\u30db\u30b9\u30c8\u540d\u3084\u30db\u30b9\u30c8\u30e1\u30bf\u30c7\u30fc\u30bf(HostMetadata or HostMetadataItem)\u306a\u3069\u3092\u6761\u4ef6\u3068\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd \n\n\n\n\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u5185\u5bb9\u30bf\u30d6\u3067\u3001\u4ee5\u4e0b\u306e\u5b9f\u884c\u3092\u8ffd\u52a0\n\n\n\u30db\u30b9\u30c8\u3092\u8ffd\u52a0\n\u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u30ea\u30f3\u30af\n\u30e6\u30fc\u30b6\u30fc\u30b0\u30eb\u30fc\u30d7\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\n\n\n\n\n\n\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8a2d\u5b9a\u78ba\u8a8d\n\n/etc/zabbix/zabbix_agentd.conf\u5185\u306eServerActive\u3067Zabbix Server\u306eIP\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n# grep ^ServerActive /etc/zabbix/zabbix_agentd.conf\nServerActive=xxx.xxx.xxx.xxx\n\n\n\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u5834\u5408\u306fZabbix Agent\u3092\u518d\u8d77\u52d5\n\n# service zabbix-agent restart\n\n\nZabbix\u30b5\u30fc\u30d0\u306e\u30ea\u30bd\u30fc\u30b9\n\u307e\u3060\u76e3\u8996\u5bfe\u8c61\u304c\u5c11\u306a\u3044\u306e\u3067\u4f59\u88d5\u304c\u3042\u308b\u72b6\u614b\u3067\u3059\u3002\n\nhost: 10\u53f0\n\u76e3\u8996\u9805\u76ee\u6570: 4.96/\u79d2\n\n\n\nAWS\u306b\u306fCloudWatch\u304c\u3042\u308a\u307e\u3059\u304c\u3001[\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u671f\u9593\u304c\u305f\u3063\u305f\u306e2\u9031\u9593\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002](http://aws.amazon.com/jp/cloudwatch/details/)\n\u305d\u308c\u3067\u306f\u904b\u7528\u3092\u7d9a\u3051\u3066\u3044\u304f\u306b\u3042\u305f\u3063\u3066\u77ed\u3059\u304e\u308b\u306e\u3067\u3001Zabbix\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u3066CloudWatch\u304b\u3089\u5024\u3092\u53d6\u5f97\u3057\u3064\u3064\u3001Zabbix\u304b\u3089\u3082\u76e3\u8996\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n## \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\nhttps://www.zabbix.com/documentation/2.4/doku.php\n\n## \u52d5\u4f5c\u78ba\u8a8d\u69cb\u6210\n\n* EC2(c3.large)\n\t* CentOS 6.6\n\t* Zabbix 2.4.3\n\t* PHP 5.6.5\n\t* nginx 1.6.2\n\n* RDS(db.m3.medium)\n\t* MySQL 5.6.22\n\n## RDS\n\n### Security Group\u4f5c\u6210\n\n* Zabbix\u30b5\u30fc\u30d0\u304b\u3089Port 3306\u3078\u306e\u30a2\u30af\u30bb\u30b9\u304c\u5fc5\u8981\n\n|Type|Protocol|Port Range|Source|\n|---|---|---|---|\n|3306|TCP|3306|`Zabbix\u30b5\u30fc\u30d0`|\n\n### DB Subnet Group\u4f5c\u6210\n\n* \u65e2\u5b58\u306eVPC Subnet\u3092\u8ffd\u52a0\u3057\u305fDB Subnet Group\u3092\u4f5c\u6210\n\n### Parameter Group\u4f5c\u6210\n\n* `Parameter Groups` -> `Create Parameter Group`\n* \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9069\u5b9c\u8a2d\u5b9a\n\n![RDS_create_parameter_group.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/12a57c82-91a2-7acd-a9c3-9c3fd3cfc3c3.png \"RDS_create_parameter_group.png\")\n\n---\n\n### Option Group\u4f5c\u6210\n\n* `Option Groups` -> `Create Group`\n* \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u9069\u5b9c\u8a2d\u5b9a\n\n![RDS_create_option_group_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/2b3fd1f8-6a99-77a1-50db-29d138ac9bf6.png \"RDS_create_option_group_2015-03-31.png\")\n\n---\n\n### RDS\u8d77\u52d5\n\n* RDS -> `Launch a DB Instance` -> `MySQL`\n* `Do you plan to use this database for production purposes?`\u3067\u9069\u5b9c\u9078\u629e\n* Backup/Maintenance\u306f\u9069\u5b9c\u8a2d\u5b9a\n\n![rds-1_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/88bf7cf3-7552-29c6-e413-e016f505e4c3.png \"rds-1_2015-03-31.png\")\n\n---\n\n![rds-2_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/6ce0e821-faa4-2c74-de0c-a95f27919931.png \"rds-2_2015-03-31.png\")\n\n\n![rds-3_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/951204d8-a257-0d6e-3e59-1ee8249e5f47.png \"rds-3_2015-03-31.png\")\n\n\n## EC2\u8d77\u52d5\n\n### IAM Role\u4f5c\u6210\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"autoscaling:Describe*\",\n        \"cloudwatch:Describe*\",\n        \"cloudwatch:Get*\",\n        \"cloudwatch:List*\",\n        \"logs:Get*\",\n        \"logs:Describe*\",\n        \"logs:TestMetricFilter\",\n        \"sns:Get*\",\n        \"sns:List*\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n### EC2\u8d77\u52d5\n\n* \u4f5c\u6210\u3057\u305fIAM Role\u3092\u6307\u5b9a\u3057\u305f\u4e0a\u3067EC2\u3092\u8d77\u52d5\n* c3.large\n* CentOS 6.6\n* Secutiry Group\u306b\u3066TCP Port 22/443\u3092IP\u9650\u5b9a\u3057\u3066\u958b\u653e\n* \u65e2\u5b58\u306eVPC\u306b\u6240\u5c5e\u3055\u305b\u308b\n* EIP\u3092\u4ed8\u4e0e\n\n## PHP 5.6 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# rpm -ivh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\n# rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n```\n\n```\n# yum install --enablerepo=remi,remi-php56 php php-cli php-common php-gd php-pdo php-mysql php-xml php-bcmath php-mbstring php-fpm php-devel\n# php --version\nPHP 5.6.5 (cli) (built: Jan 21 2015 17:50:29)\nCopyright (c) 1997-2014 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2014 Zend Technologies\n```\n\n```\n# vi /etc/php.ini\n```\n\n```diff:/etc/php.ini\n-max_execution_time = 30\n+max_execution_time = 300\n-max_input_time = 60\n+max_input_time = 300\n-post_max_size = 8M\n+post_max_size = 32M\n-;always_populate_raw_post_data = -1\n+always_populate_raw_post_data = -1\n+date.timezone = Asia/Tokyo\n```\n\n## MySQL\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhttp://dev.mysql.com/downloads/repo/yum/\n\n### MySQL\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n\n```\n# rpm -ivh http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n```\n\n### MySQL\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install mysql\n# mysql --version\nmysql  Ver 14.14 Distrib 5.6.22, for Linux (x86_64) using  EditLine wrapper\n```\n\n## Zabbix 2.4 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhttp://www.zabbix.com/jp/download.php\n\n### Zabbix\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n\n```\n# rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n```\n\n### Zabbix\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install zabbix-server-mysql zabbix-web-mysql zabbix-agent zabbix-web-japanese zabbix-get\n```\n\n## Zabbix \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n\n```\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com\nmysql> create database zabbix character set utf8 collate utf8_bin;\nmysql> grant all privileges on zabbix.* to zabbix@'10.0.%' identified by 'xxxx';\n```\n\n### schema\u5b9a\u7fa9/\u30c7\u30fc\u30bf\u6295\u5165\n\n```\n# cd /usr/share/doc/zabbix-server-mysql-2.4.3/create\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < schema.sql\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < images.sql\n# mysql -u root -p -h zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com zabbix < data.sql\n```\n\n### Zabbix Server\u8a2d\u5b9a\n\n```\n# vi /etc/zabbix/zabbix_server.conf\n```\n\n```\nDBHost=zabbix-db-1.xxxxxx.ap-northeast-1.rds.amazonaws.com\nDBName=zabbix\nDBUser=zabbix\nDBPassword=xxxx\n```\n\n### Zabbix Server\u8d77\u52d5\n\n```\n# chkconfig zabbix-server on\n# service zabbix-server start\n```\n\n### Zabbix Agent\u8d77\u52d5\n\n```\n# chkconfig zabbix-agent on\n# service zabbix-agent start\n```\n\n## nginx \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3053\u3053\u3067\u306fstable\u306e1.6\u7cfb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\u305f\u3060\u3001[nginx\u4f5c\u8005\u3044\u308f\u304f\u3001stable\u3088\u308amainline\u3092\u4f7f\u3046\u3079\u304d](http://www.slideshare.net/narimichitakamura/nginx-201401201412)\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001[mainline](http://nginx.org/en/linux_packages.html#mainline)\u306e\u65b9\u304c\u3044\u3044\u304b\u3082\u3002\n\n### nginx\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# rpm -ivh http://nginx.org/packages/rhel/6/noarch/RPMS/nginx-release-rhel-6-0.el6.ngx.noarch.rpm\n```\n\n### nginx\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install nginx\n# nginx -v\nnginx version: nginx/1.6.2\n```\n\n### \u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u4f5c\u6210\n\n```\n# ln -s /usr/share/zabbix /usr/share/nginx/html/zabbix\n```\n\n### SSL\u8a3c\u660e\u66f8\u4f5c\u6210\n\n* `Organization Name`\u3084`Common Name`\u306a\u3069\u306f\u9069\u5b9c\u8a2d\u5b9a\u3059\u308b\u3053\u3068\n\n```\n# openssl req -new -days 365 -x509 -sha256 -newkey rsa:2048 -nodes -keyout /etc/nginx/zabbix-cert.key -out /etc/nginx/zabbix-cert.crt\nGenerating a 2048 bit RSA private key\n................................+++\n.........+++\nwriting new private key to '/etc/nginx/zabbix-cert.key'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCountry Name (2 letter code) [XX]:JP\nState or Province Name (full name) []:Tokyo\nLocality Name (eg, city) [Default City]:Minato\nOrganization Name (eg, company) [Default Company Ltd]:Enigmo Inc.\nOrganizational Unit Name (eg, section) []:System\nCommon Name (eg, your name or your server's hostname) []:zabbix.example.com\nEmail Address []:\n```\n\n```\n# chmod 400 /etc/nginx/zabbix-cert.*\n# openssl x509 -in /etc/nginx/zabbix-cert.crt -text -noout | grep \"Signature\\|Public-Key\"\n    Signature Algorithm: sha256WithRSAEncryption\n                Public-Key: (2048 bit)\n    Signature Algorithm: sha256WithRSAEncryption\n```\n\n### Zabbix\u7528\u306e\u8a2d\u5b9a\n\n```\n# vi /etc/nginx/conf.d/zabbix.conf\n```\n\n```\nserver {\n    listen 80;\n    listen 443 default_server ssl spdy;\n\n    root /usr/share/nginx/html;\n    ssl                  on;\n    ssl_certificate      /etc/nginx/zabbix-cert.crt;\n    ssl_certificate_key  /etc/nginx/zabbix-cert.key;\n\n    ssl_session_timeout  5m;\n\n    ssl_protocols  TLSv1 TLSv1.1 TLSv1.2;\n    ssl_ciphers  ECDHE+RSAGCM:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:!aNULL!eNull:!EXPORT:!DES:!3DES:!MD5:!DSS;\n    ssl_prefer_server_ciphers   on;\n\n    server_name zabbix.example.com;\n    index index.html;\n    access_log /var/log/nginx/zabbix-access_log main;\n    error_log  /var/log/nginx/zabbix-error_log error;\n\n    location /zabbix {\n        index index.php;\n    }\n\n    location ~ \\.php$ {\n        fastcgi_pass 127.0.0.1:9000;\n        fastcgi_index index.php;\n        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n        include fastcgi_params;\n    }\n}\n```\n\n### \u57fa\u672c\u7684\u306a\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n\n```\n# vi /etc/nginx/nginx.conf\n```\n\n```diff:/etc/nginx/nginx.conf\n-worker_processes  1;\n+worker_processes  2;\n+worker_rlimit_nofile 100000;\n\n events {\n     worker_connections  1024;\n+    multi_accept on;\n+    use epoll;\n }\n\nhttp {\n-    #tcp_nopush     on;\n+    tcp_nopush      on;\n\n-    #gzip  on;\n+    gzip  on;\n+    gzip_vary on;\n+    gzip_comp_level 6;\n+    gzip_min_length 1024;\n+    gzip_types text/plain application/javascript text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\n+\n+   open_file_cache max=100000 inactive=20s;\n+   open_file_cache_valid 30s;\n+   open_file_cache_min_uses 2;\n+   open_file_cache_errors   on;\n+\n+    server_tokens  off;\n}\n```\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u30c1\u30a7\u30c3\u30af\n\n```\n# service nginx configtest\nnginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n```\n\n### nginx, php-fpm\u8d77\u52d5\n\n```\n# chkconfig nginx on\n# service nginx start\n# chkconfig php-fpm on\n# service php-fpm start\n```\n\n## AWS\u76e3\u8996\u7528\u30d1\u30c3\u30b1\u30fc\u30b8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n### AWS CLI \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\n* EPEL\u8a2d\u5b9a\n\n```\n# rpm -ivh http://ftp.jaist.ac.jp/pub/Linux/Fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\n```\n\n```\n# vi /etc/yum.repos.d/epel.repo\n```\n\n```diff:/etc/yum.repos.d/epel.repo\n[epel]\nname=Extra Packages for Enterprise Linux 6 - $basearch\n#baseurl=http://download.fedoraproject.org/pub/epel/6/$basearch\nmirrorlist=https://mirrors.fedoraproject.org/metalink?repo=epel-6&arch=$basearch\nfailovermethod=priority\n-enabled=1\n+enabled=0\n```\n\n* python-pip\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum --enablerepo=epel install python-pip\n```\n\n* awscli\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# pip install awscli\n```\n\n* \u78ba\u8a8d\n\n```\n# aws --version\naws-cli/1.7.3 Python/2.6.6 Linux/2.6.32-504.1.3.el6.x86_64\n```\n\n### AWS CLI\u8a2d\u5b9a\n\n\u4f5c\u6210\u3057\u305fUser\u306eAccess Key/Secret Access Key\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```\n# sudo -u zabbix aws configure\nAWS Access Key ID [None]: xxxxxxxxxxxxx\nAWS Secret Access Key [None]: xxxxxxxxxxxxx\nDefault region name [None]: ap-northeast-1\nDefault output format [None]:\n```\n\n```\n# aws configure\nAWS Access Key ID [None]: xxxxxxxxxxxxx\nAWS Secret Access Key [None]: xxxxxxxxxxxxx\nDefault region name [None]: ap-northeast-1\nDefault output format [None]:\n```\n\n### jq \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum --enablerepo=epel install jq\n```\n\n## Zabbix\u8a2d\u5b9a\n\n### Web UI\u306b\u30a2\u30af\u30bb\u30b9\n\nhttps://zabbix.example.com/zabbix/setup.php\n\n### Zabbix Server\u521d\u671f\u8a2d\u5b9a\n\n* `Next`\n\n![zabbix-1.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/e37252a7-2327-9cbd-d515-db815790b469.png \"zabbix-1.png\")\n\n* `Next`\n\n![stylehaus-zabbix-setting-1.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/90d02d11-75c8-cc48-5c75-8d136337c068.png)\n\n* User/Password\u3092\u5165\u529b\u5f8c\u3001`Test connection`\u3067`OK`\u3068\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n* `Next`\n\n![zabbix-1_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/4cf6794b-0743-7878-12e9-6f9efa4555b7.png \"zabbix-1_2015-03-31.png\")\n\n* \u8b58\u5225\u7528\u306e\u540d\u524d\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f`Name`\u306b\u5165\u529b\n* `Next`\n\n![zabbix-2_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/7cfbcecc-7623-e766-9dc9-bf7803d48d1e.png \"zabbix-2_2015-03-31.png\")\n\n* `Next`\n\n![zabbix-3_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/b5268769-ec65-77b4-f78f-103ea88ea466.png \"zabbix-3_2015-03-31.png\")\n\n* `Finish`\n\n![zabbix-6.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/66397a03-ac6d-3d52-8031-ee7b35435d9d.png \"zabbix-6.png\")\n\n* Username: Admin, Password: zabbix\n* `Sign in`\n\n![zabbix-7.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/5cb71f40-1bb1-2bea-65f5-b4dc1a80a040.png \"zabbix-7.png\")\n\n## \u30e1\u30fc\u30eb\u9001\u4fe1\u8a2d\u5b9a\n\n### Postfix\u8a2d\u5b9a\n\n\u30db\u30b9\u30c8\u540d\u8a2d\u5b9a\u3002\n\n```\n# vi /etc/postfix/main.cf\n```\n\n```diff:/etc/postfix/main.cf\n+myhostname = zabbix.example.com\n```\n\n```\n# service postfix check\n# service postfix reload\n```\n\n### DNS\u30ec\u30b3\u30fc\u30c9\u8a2d\u5b9a\n\n* TXT\u30ec\u30b3\u30fc\u30c9\u306bZabbix\u30b5\u30fc\u30d0\u306eEIP\u3092\u8ffd\u52a0\n* Zabbix\u30b5\u30fc\u30d0\u306eA\u30ec\u30b3\u30fc\u30c9\u3092\u8a2d\u5b9a\n    * zabbix.example.com -> Zabbix\u30b5\u30fc\u30d0\u306eEIP\n    * Postfix\u3067\u8a2d\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u540d\u3068\u5408\u308f\u305b\u308b\u3053\u3068\n\n### AWS\u3067\u30e1\u30fc\u30eb\u9001\u4fe1\u5236\u9650\u306e\u89e3\u9664\u7533\u8acb\n\n* Elastic IP Address 1 -> Zabbix\u30b5\u30fc\u30d0\u306eEIP\n* Reverse DNS Record for EIP 1 -> zabbix.example.com\n\nhttps://portal.aws.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request\n\n![zabbix-5_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/dd4cb3b0-32db-f91a-9f9a-33be2061090d.png \"zabbix-5_2015-03-31.png\")\n\n* \u53d7\u7406\u3055\u308c\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30fc\u30eb\u304c\u9001\u3089\u308c\u3066\u304f\u308b\n\n```\nYour AWS Inquiry\n\nWe have configured the reverse DNS record(s) you requested. Your request was mapped for xxx.xxx.xxx.xxx. :zabbix.example.com. Please note that propagation of this update to DNSBL services that Amazon works with may take up to a week.\n\nIf you also requested removal of the email sending limitations on your account, these have also been removed for any IPs and instances under your account.\n```\n### SMTP\u8a2d\u5b9a\n\n* \u7ba1\u7406 -> Email\n* SMTP\u30b5\u30fc\u30d0\u30fc: localhost\n* SMTP helo: zabbix.example.com\n* \u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9: zabbix@example.com\n\n## \u76e3\u8996\u8a2d\u5b9a\n\n\u4ee5\u4e0b\u3092\u5229\u7528\u30fb\u53c2\u8003\u306b\u3057\u3066\u8a2d\u5b9a\u3002\n\n* http://www.zabbix.org/wiki/Zabbix_Templates\n    * nginx: https://github.com/blacked/zbx_nginx_template\n\n* http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/CW_Support_For_AWS.html\n    * http://dev.classmethod.jp/cloud/aws/zabbix-with-cloudwatch/\n\n## \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n\u76e3\u8996\u3055\u308c\u308b\u5074\u3067\u884c\u3046\u4f5c\u696d\u306f\u4ee5\u4e0b\u3002\n\n### Zabbix\u516c\u5f0f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6709\u52b9\u5316\n\n```\n# rpm -ivh http://repo.zabbix.com/zabbix/2.4/rhel/6/x86_64/zabbix-release-2.4-1.el6.noarch.rpm\n```\n\n### Zabbix Agent\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install zabbix-agent\n```\n\n### Zabbix Agent\u8a2d\u5b9a\n\n```\n# vi /etc/zabbix/zabbix_agentd.conf\n```\n\n```diff:/etc/zabbix/zabbix_agentd.conf\n-Hostname=Zabbix server\n+#Hostname=Zabbix server\n\n+EnableRemoteCommands=1\n\n+HostMetadataItem=system.uname\n```\n\n### Zabbix Agent\u8d77\u52d5\n\n```\n# chkconfig zabbix-agent on\n# service zabbix-agent start\n```\n\n## \u76e3\u8996\u5bfe\u8c61\u30db\u30b9\u30c8\u3092\u81ea\u52d5\u767b\u9332\u3059\u308b\u5834\u5408\n\n\u4e0b\u8a18\u624b\u9806\u3092\u5143\u306b\u8a2d\u5b9a\u3059\u308b\u3002\nhttps://www.zabbix.com/documentation/2.4/manual/discovery/auto_registration\n\n### \u30b5\u30fc\u30d0\u5074\u3067\u30a2\u30af\u30b7\u30e7\u30f3\u8a2d\u5b9a\n\nWeb UI\u306b\u3066\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3002\n\n1. `\u8a2d\u5b9a` -> `\u30a2\u30af\u30b7\u30e7\u30f3`\n1. `\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b9`\u306e\u30d7\u30eb\u30c0\u30a6\u30f3\u30e1\u30cb\u30e5\u30fc\u3067`\u81ea\u52d5\u767b\u9332`\u3092\u9078\u629e\n1. `\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u4f5c\u6210`\n1. `\u30a2\u30af\u30b7\u30e7\u30f3`\u30bf\u30d6\u5185\u306e`\u540d\u524d`\u3067\u3001\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u540d\u524d\u3092\u4ed8\u3051\u308b\n1. `\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u6761\u4ef6`\u30bf\u30d6\u3067\u3001\u4efb\u610f\u306e\u6761\u4ef6\u3092\u6307\u5b9a\uff08\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u5168\u3066\u306e\u30db\u30b9\u30c8\u304c\u5bfe\u8c61\u3068\u306a\u308b\uff09\n\t* \u30db\u30b9\u30c8\u540d\u3084\u30db\u30b9\u30c8\u30e1\u30bf\u30c7\u30fc\u30bf(HostMetadata or HostMetadataItem)\u306a\u3069\u3092\u6761\u4ef6\u3068\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd \n1. `\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c\u5185\u5bb9`\u30bf\u30d6\u3067\u3001\u4ee5\u4e0b\u306e\u5b9f\u884c\u3092\u8ffd\u52a0\n\t* \u30db\u30b9\u30c8\u3092\u8ffd\u52a0\n\t* \u30db\u30b9\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n\t* \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u30ea\u30f3\u30af\n\t* \u30e6\u30fc\u30b6\u30fc\u30b0\u30eb\u30fc\u30d7\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\n\n![action-1.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/77dab069-7d54-b325-a4e4-3e6cf573df51.png \"action-1.png\")\n\n---\n\n![action-2.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/619f4066-f759-df27-ad35-ae2891ca3d0b.png \"action-2.png\")\n\n---\n\n![action-3.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/0bdec2c1-2d52-bb14-f618-1253b77052f6.png \"action-3.png\")\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8a2d\u5b9a\u78ba\u8a8d\n\n* /etc/zabbix/zabbix_agentd.conf\u5185\u306e`ServerActive `\u3067Zabbix Server\u306eIP\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n```\n# grep ^ServerActive /etc/zabbix/zabbix_agentd.conf\nServerActive=xxx.xxx.xxx.xxx\n```\n\n* \u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u5834\u5408\u306fZabbix Agent\u3092\u518d\u8d77\u52d5\n\n```\n# service zabbix-agent restart\n```\n\n## Zabbix\u30b5\u30fc\u30d0\u306e\u30ea\u30bd\u30fc\u30b9\n\n\u307e\u3060\u76e3\u8996\u5bfe\u8c61\u304c\u5c11\u306a\u3044\u306e\u3067\u4f59\u88d5\u304c\u3042\u308b\u72b6\u614b\u3067\u3059\u3002\n\n* host: 10\u53f0\n* \u76e3\u8996\u9805\u76ee\u6570: 4.96/\u79d2\n\n![zabbix-status_2015-03-31.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/62ad3c40-9f46-f5ed-2e34-6df6dcf26155.png \"zabbix-status_2015-03-31.png\")\n\n![zabbix-2_20150331.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/e9d9d6c8-c62d-177a-0950-81fa753f11fa.png \"zabbix-2_20150331.png\")\n", "tags": ["zabbix", "CentOS", "AWS", "nginx", "EC2"]}