{"context": "\n\n\u6982\u8981\nAmazon API Gateway \u306e Custom Authorizer\u3092\u4f7f\u3046\u3068\u3001\u72ec\u81ea\u306e\u8a8d\u8a3c\u3092Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3067\u5b9a\u7fa9\u3057\u3066\u3001API Gateway\u3067\u4f5c\u3063\u305fAPI\u306e\u30a2\u30af\u30bb\u30b9\u7ba1\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nAmazon API Gateway \u30ab\u30b9\u30bf\u30e0\u8a8d\u8a3c\u306e\u6982\u8981\n\u4eca\u56de\u306fUser Pools\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30e6\u30fc\u30b6\u3067API\u8a8d\u8a3c\u6a5f\u80fd\u3092\u4f5c\u308a\u307e\u3059\u3002\nUser Pools\u306b\u3064\u3044\u3066\u306fAmazon Cognito User Pools\u3092\u4f7f\u3063\u3066\u3001web\u30b5\u30a4\u30c8\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u308b\u3067\u8a73\u3057\u304f\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u7aef\u7684\u306b\u8a00\u3046\u3068User Pools\u3067\u7ba1\u7406\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u3067API\u3092\u8a8d\u8a3c\u3057\u3088\u3046\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u5358\u7d14\u306b\u30e6\u30fc\u30b6\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u4f1a\u54e1\u60c5\u5831\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u30a2\u30d7\u30ea\u306b\u306f\u975e\u5e38\u306b\u52b9\u679c\u7684\u306b\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8a8d\u8a3c\u7528\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\nAPI\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306bAuthorization\u30d8\u30c3\u30c0\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002Authorization\u30d8\u30c3\u30c0\u30fc\u306bUser Pools\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\ncognitoidentityserviceprovider.getUser\u30e1\u30bd\u30c3\u30c9\u3067\u5224\u5b9a\u3092\u884c\u3044\u3002\n\u30a8\u30e9\u30fc\u304c\u8fd4\u308c\u3070\u3001API Gateway\u306b\u8fd4\u3059Policy Document\u306bDeny\u3092\u901a\u77e5\u3002\u6b63\u3057\u304f\u30e6\u30fc\u30b6\u60c5\u5831\u304c\u8fd4\u308c\u3070\u3001Allow\u3092\u901a\u77e5\u3057\u307e\u3059\u3002\nvar aws = require( 'aws-sdk' )\nvar cognitoidentityserviceprovider = new aws.CognitoIdentityServiceProvider({apiVersion: '2016-04-18',region: 'us-east-1'})\n\nexports.handler = function(event, context) {\n  var params = {\n    AccessToken:event.authorizationToken\n  }\n  cognitoidentityserviceprovider.getUser(params, function(err, data) {\n    if (err) { \n      context.succeed(generatePolicy('user', 'Deny', event.methodArn))\n    } else {\n      context.succeed(generatePolicy(data.Username, 'Allow', event.methodArn))\n    }\n  })\n}\n\nvar generatePolicy = function(principalId, effect, resource) {\n  var authResponse = {}\n  authResponse.principalId = principalId\n  if (effect && resource) {\n    var policyDocument = {}\n    policyDocument.Version = '2012-10-17'\n    policyDocument.Statement = []\n    var statementOne = {}\n    statementOne.Action = 'execute-api:Invoke'\n    statementOne.Effect = effect\n    statementOne.Resource = resource\n    policyDocument.Statement[0] = statementOne\n    authResponse.policyDocument = policyDocument\n  }\n  return authResponse\n}\n\n\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u753b\u9762\u3067method.request.header.Authorization\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5185\u306eevent.authorizationToken\u3067\u9001\u3089\u308c\u3066\u304d\u305f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u8a8d\u8a3c\u3092\u901a\u904e\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306aPolicy Document\u304c\u8fd4\u308a\u3001API\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"execute-api:Invoke\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:execute-api:ap-northeast-1:<Account ID>:5j2z5a7nh9/null/GET/\"\n    }\n  ]\n}\n\n\n\u8a8d\u8a3c\u3055\u308c\u305f\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306b\u6e21\u3059\n\u8a8d\u8a3c\u3092\u901a\u3063\u305f\u306e\u306f\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u901a\u5e38\u306f\u8a8d\u8a3c\u6e08\u307f\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u3092API\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3067\u3082\u53d6\u5f97\u3057\u3066\u51e6\u7406\u3092\u884c\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u6642\u306fprincipalId\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n$context.authorizer.principalId\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u308b\u3053\u3068\u3067\u8a8d\u8a3c\u6642\u306bprincipalId\u306b\u6307\u5b9a\u3057\u305f\u5024\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u305f\u5024\u3092\u5358\u7d14\u306b\u8fd4\u3059\u3082\u306e\u3092\u4eca\u56de\u306f\u30bb\u30c3\u30c8\u3057\u307e\u3057\u305f\u3002\nexports.handler = (event, context, callback) => {\n    callback(null, event.email); \n};\n\n\n\u5b9f\u884c\n\u3053\u308c\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u305fAPI\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u3087\u3046\n\u4f55\u3082\u30d8\u30c3\u30c0\u3092\u6307\u5b9a\u3057\u306a\u3044\u72b6\u614b\u3060\u3068\u3001401\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1\nHTTP/1.1 401 Unauthorized\nContent-Type: application/json\nContent-Length: 26\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:17:37 GMT\nx-amzn-ErrorType: UnauthorizedException\nx-amzn-RequestId: e23e564b-12dc-11e6-8e7a-099c2c59ca1e\nX-Cache: Error from cloudfront\nVia: 1.1 5753ad031d92fdc94452799736f8b898.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: oKcZn-6iyF7rcQ-LNYW696m-WYwTwm6kIsXPyyW8eTN8gXwf_hbciA==\n\n{\"message\":\"Unauthorized\"}\n\n\u6b21\u306bAuthorization\u30d8\u30c3\u30c0\u306b\u3067\u305f\u3089\u3081\u306a\u5024\u3092\u4ed8\u3051\u308b\u3068\u3001\u8a8d\u8a3c\u306b\u5f3e\u304b\u308c\u3066403\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1 -H 'Authorization: aaaaaaa'\nHTTP/1.1 403 Forbidden\nContent-Type: application/json\nContent-Length: 60\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:19:05 GMT\nx-amzn-ErrorType: AccessDeniedException\nx-amzn-RequestId: 15fa82a2-12dd-11e6-9ffc-5bd6f26ab516\nX-Cache: Error from cloudfront\nVia: 1.1 b5af8e55f6a9cb57b52430dc88fed3be.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: DT9Kdk7YpaAMkn_GFzXdh4T7oNlKao87pQOqCc_wfs3DqNeQGaWOVQ==\n\n{\"Message\":\"User is not authorized to access this resource\"}\n\n\u6700\u5f8c\u306bAuthorization\u30d8\u30c3\u30c0\u306b\u6b63\u3057\u3044\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u7528\u306b\u3061\u3083\u3093\u3068\u610f\u56f3\u901a\u308a\u306e\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1 -H 'Authorization: eyJraWQiOiJMK1luaTlURkR1Snl3UHJDdnNLVnJRVk1iREE1WkhHZ0tHdjZGRnRsdHhRPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIzYjNlMWU5My01NmUwLTQ2ODgtYTYzMi0yMjdiYjdlZTAwZjEiLCJ0b2tlbl91c2UiOiJdhY2Nlc3MiLCJzY29wZSI6ImF3cy5jb2duaXRvLnNpZ25pbi51c2VyLmFkbWluIiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfaXFMa2hvRFNXIiwiZXhwIjoxNDYyNDY4ODg1LCJjbGllbnRfaWQiOiIzbmppbXBxMnBhaXVlNG9mbms1bDRyOWYwdSIsInVzZXJuYW1lIjoiaG9yaWtlKzAwNUBkaWdpdGFsY3ViZS5qcCJ9.nNKEmvsosVpQM0w74Z-ruTSkyssTseI4xM2TvDxG9BEyz1bxsZhE1L14JHtKK9FXsKUYlAXAAblnkDdswSRlvge9UNmh6uPMgLUYA6jL-aZX3CNemgDHTZc0JxnsuaIF4WqnJ8T2gHtC-tCmIjUkJILIoPxMCPneklBO1rIjBEt2MQ2HBkYmkz3yfqVeE603Vr29yf3pcOpn-OcRvDq58UDr4liWI7ZR71ehgLhqmFv-qQ-_Kp6iInsUnK681nR2gvVXe1KMXKc6y5mwngBncocbx2gnqbXsyp_qQ4p93dTA6f_6CzMMeiPVVT9bK7m3pUsDASNWQhEdfbN_FZUdYksw'\n\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 37\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:22:06 GMT\nx-amzn-RequestId: 817a58ed-12dd-11e6-8b94-0d04b870f135\nX-Cache: Miss from cloudfront\nVia: 1.1 dbd66f9b48a662a90decd25d25e606f5.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: H9AyM6Xcs1goT341YENCsGcytUEb8BlONA6oWfo8nTLdwYVjszYkJg==\n\n{\"email\":\"horike+005@digitalcube.jp\"}\n\n\u3053\u3093\u306a\u306b\u7c21\u5358\u306bUser Pools\u3092\u4f7f\u3063\u3066API Gateway\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306e\u6a5f\u80fd\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\n\u307e\u3059\u307e\u3059\u5b9f\u7528\u7684\u306b\u306a\u3063\u3066\u3044\u304d\u307e\u3059\u306d\uff01\n#\u6982\u8981\nAmazon API Gateway \u306e Custom Authorizer\u3092\u4f7f\u3046\u3068\u3001\u72ec\u81ea\u306e\u8a8d\u8a3c\u3092Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3067\u5b9a\u7fa9\u3057\u3066\u3001API Gateway\u3067\u4f5c\u3063\u305fAPI\u306e\u30a2\u30af\u30bb\u30b9\u7ba1\u7406\u3092\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n[Amazon API Gateway \u30ab\u30b9\u30bf\u30e0\u8a8d\u8a3c\u306e\u6982\u8981](http://docs.aws.amazon.com/ja_jp/apigateway/latest/developerguide/use-custom-authorizer.html#api-gateway-custom-authorization-overview)\n\n\u4eca\u56de\u306fUser Pools\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u308b\u30e6\u30fc\u30b6\u3067API\u8a8d\u8a3c\u6a5f\u80fd\u3092\u4f5c\u308a\u307e\u3059\u3002\nUser Pools\u306b\u3064\u3044\u3066\u306f[Amazon Cognito User Pools\u3092\u4f7f\u3063\u3066\u3001web\u30b5\u30a4\u30c8\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u308b](http://qiita.com/horike37/items/1d522f66452d3abe1203)\u3067\u8a73\u3057\u304f\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\n![custom-auth-workflow.png](https://qiita-image-store.s3.amazonaws.com/0/65478/9dd9947f-32d9-6646-be39-b763003de91d.png)\n\n\u7aef\u7684\u306b\u8a00\u3046\u3068User Pools\u3067\u7ba1\u7406\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u3067API\u3092\u8a8d\u8a3c\u3057\u3088\u3046\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u5358\u7d14\u306b\u30e6\u30fc\u30b6\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u4f1a\u54e1\u60c5\u5831\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u30a2\u30d7\u30ea\u306b\u306f\u975e\u5e38\u306b\u52b9\u679c\u7684\u306b\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u8a8d\u8a3c\u7528\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\nAPI\u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306bAuthorization\u30d8\u30c3\u30c0\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002Authorization\u30d8\u30c3\u30c0\u30fc\u306bUser Pools\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\ncognitoidentityserviceprovider.getUser\u30e1\u30bd\u30c3\u30c9\u3067\u5224\u5b9a\u3092\u884c\u3044\u3002\n\u30a8\u30e9\u30fc\u304c\u8fd4\u308c\u3070\u3001API Gateway\u306b\u8fd4\u3059Policy Document\u306bDeny\u3092\u901a\u77e5\u3002\u6b63\u3057\u304f\u30e6\u30fc\u30b6\u60c5\u5831\u304c\u8fd4\u308c\u3070\u3001Allow\u3092\u901a\u77e5\u3057\u307e\u3059\u3002\n\n```js\nvar aws = require( 'aws-sdk' )\nvar cognitoidentityserviceprovider = new aws.CognitoIdentityServiceProvider({apiVersion: '2016-04-18',region: 'us-east-1'})\n\nexports.handler = function(event, context) {\n  var params = {\n    AccessToken:event.authorizationToken\n  }\n  cognitoidentityserviceprovider.getUser(params, function(err, data) {\n    if (err) { \n      context.succeed(generatePolicy('user', 'Deny', event.methodArn))\n    } else {\n      context.succeed(generatePolicy(data.Username, 'Allow', event.methodArn))\n    }\n  })\n}\n\nvar generatePolicy = function(principalId, effect, resource) {\n  var authResponse = {}\n  authResponse.principalId = principalId\n  if (effect && resource) {\n    var policyDocument = {}\n    policyDocument.Version = '2012-10-17'\n    policyDocument.Statement = []\n    var statementOne = {}\n    statementOne.Action = 'execute-api:Invoke'\n    statementOne.Effect = effect\n    statementOne.Resource = resource\n    policyDocument.Statement[0] = statementOne\n    authResponse.policyDocument = policyDocument\n  }\n  return authResponse\n}\n```\n\n\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u753b\u9762\u3067`method.request.header.Authorization`\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001Lambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u5185\u306e`event.authorizationToken`\u3067\u9001\u3089\u308c\u3066\u304d\u305f\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n<img width=\"1083\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-06 0.55.47.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/fe8d431d-aa36-828e-d7ba-c69b09b69996.png\">\n\n\n\u8a8d\u8a3c\u3092\u901a\u904e\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306aPolicy Document\u304c\u8fd4\u308a\u3001API\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"execute-api:Invoke\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"arn:aws:execute-api:ap-northeast-1:<Account ID>:5j2z5a7nh9/null/GET/\"\n    }\n  ]\n}\n```\n\n## \u8a8d\u8a3c\u3055\u308c\u305f\u30e6\u30fc\u30b6\u60c5\u5831\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306b\u6e21\u3059\n\u8a8d\u8a3c\u3092\u901a\u3063\u305f\u306e\u306f\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u901a\u5e38\u306f\u8a8d\u8a3c\u6e08\u307f\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u3092API\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u3067\u3082\u53d6\u5f97\u3057\u3066\u51e6\u7406\u3092\u884c\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u6642\u306f`principalId`\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n`$context.authorizer.principalId`\u3092\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u308b\u3053\u3068\u3067\u8a8d\u8a3c\u6642\u306bprincipalId\u306b\u6307\u5b9a\u3057\u305f\u5024\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n<img width=\"982\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-06 1.10.00.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/36d1c1e6-6233-767f-367c-f8e5f202767e.png\">\n\n\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u305b\u305f\u5024\u3092\u5358\u7d14\u306b\u8fd4\u3059\u3082\u306e\u3092\u4eca\u56de\u306f\u30bb\u30c3\u30c8\u3057\u307e\u3057\u305f\u3002\n\n```js\nexports.handler = (event, context, callback) => {\n    callback(null, event.email); \n};\n```\n\n## \u5b9f\u884c\n\u3053\u308c\u3067\u30c7\u30d7\u30ed\u30a4\u3057\u305fAPI\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u3087\u3046\n\n\u4f55\u3082\u30d8\u30c3\u30c0\u3092\u6307\u5b9a\u3057\u306a\u3044\u72b6\u614b\u3060\u3068\u3001401\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n```\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1\nHTTP/1.1 401 Unauthorized\nContent-Type: application/json\nContent-Length: 26\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:17:37 GMT\nx-amzn-ErrorType: UnauthorizedException\nx-amzn-RequestId: e23e564b-12dc-11e6-8e7a-099c2c59ca1e\nX-Cache: Error from cloudfront\nVia: 1.1 5753ad031d92fdc94452799736f8b898.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: oKcZn-6iyF7rcQ-LNYW696m-WYwTwm6kIsXPyyW8eTN8gXwf_hbciA==\n\n{\"message\":\"Unauthorized\"}\n```\n\n\u6b21\u306bAuthorization\u30d8\u30c3\u30c0\u306b\u3067\u305f\u3089\u3081\u306a\u5024\u3092\u4ed8\u3051\u308b\u3068\u3001\u8a8d\u8a3c\u306b\u5f3e\u304b\u308c\u3066403\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n```\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1 -H 'Authorization: aaaaaaa'\nHTTP/1.1 403 Forbidden\nContent-Type: application/json\nContent-Length: 60\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:19:05 GMT\nx-amzn-ErrorType: AccessDeniedException\nx-amzn-RequestId: 15fa82a2-12dd-11e6-9ffc-5bd6f26ab516\nX-Cache: Error from cloudfront\nVia: 1.1 b5af8e55f6a9cb57b52430dc88fed3be.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: DT9Kdk7YpaAMkn_GFzXdh4T7oNlKao87pQOqCc_wfs3DqNeQGaWOVQ==\n\n{\"Message\":\"User is not authorized to access this resource\"}\n```\n\n\u6700\u5f8c\u306bAuthorization\u30d8\u30c3\u30c0\u306b\u6b63\u3057\u3044\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4ed8\u4e0e\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u7528\u306b\u3061\u3083\u3093\u3068\u610f\u56f3\u901a\u308a\u306e\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\n```\n[horike@horiketakahiro-no-MacBook-Pro Documents]$curl --include https://5j2z5a7nh9.execute-api.ap-northeast-1.amazonaws.com/v1 -H 'Authorization: eyJraWQiOiJMK1luaTlURkR1Snl3UHJDdnNLVnJRVk1iREE1WkhHZ0tHdjZGRnRsdHhRPSIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIzYjNlMWU5My01NmUwLTQ2ODgtYTYzMi0yMjdiYjdlZTAwZjEiLCJ0b2tlbl91c2UiOiJdhY2Nlc3MiLCJzY29wZSI6ImF3cy5jb2duaXRvLnNpZ25pbi51c2VyLmFkbWluIiwiaXNzIjoiaHR0cHM6XC9cL2NvZ25pdG8taWRwLnVzLWVhc3QtMS5hbWF6b25hd3MuY29tXC91cy1lYXN0LTFfaXFMa2hvRFNXIiwiZXhwIjoxNDYyNDY4ODg1LCJjbGllbnRfaWQiOiIzbmppbXBxMnBhaXVlNG9mbms1bDRyOWYwdSIsInVzZXJuYW1lIjoiaG9yaWtlKzAwNUBkaWdpdGFsY3ViZS5qcCJ9.nNKEmvsosVpQM0w74Z-ruTSkyssTseI4xM2TvDxG9BEyz1bxsZhE1L14JHtKK9FXsKUYlAXAAblnkDdswSRlvge9UNmh6uPMgLUYA6jL-aZX3CNemgDHTZc0JxnsuaIF4WqnJ8T2gHtC-tCmIjUkJILIoPxMCPneklBO1rIjBEt2MQ2HBkYmkz3yfqVeE603Vr29yf3pcOpn-OcRvDq58UDr4liWI7ZR71ehgLhqmFv-qQ-_Kp6iInsUnK681nR2gvVXe1KMXKc6y5mwngBncocbx2gnqbXsyp_qQ4p93dTA6f_6CzMMeiPVVT9bK7m3pUsDASNWQhEdfbN_FZUdYksw'\n\nHTTP/1.1 200 OK\nContent-Type: application/json\nContent-Length: 37\nConnection: keep-alive\nDate: Thu, 05 May 2016 16:22:06 GMT\nx-amzn-RequestId: 817a58ed-12dd-11e6-8b94-0d04b870f135\nX-Cache: Miss from cloudfront\nVia: 1.1 dbd66f9b48a662a90decd25d25e606f5.cloudfront.net (CloudFront)\nX-Amz-Cf-Id: H9AyM6Xcs1goT341YENCsGcytUEb8BlONA6oWfo8nTLdwYVjszYkJg==\n\n{\"email\":\"horike+005@digitalcube.jp\"}\n```\n\n\u3053\u3093\u306a\u306b\u7c21\u5358\u306bUser Pools\u3092\u4f7f\u3063\u3066API Gateway\u306b\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306e\u6a5f\u80fd\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\n\u307e\u3059\u307e\u3059\u5b9f\u7528\u7684\u306b\u306a\u3063\u3066\u3044\u304d\u307e\u3059\u306d\uff01\n", "tags": ["AWS", "APIGateway", "cognito", "lambda"]}