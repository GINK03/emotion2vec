{"context": "\n\nASP.NET MVC \u5171\u6709\u3059\u308b\u90e8\u5206\u30d3\u30e5\u30fc\u306b\u3082\u30ed\u30fc\u30ab\u30eb\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3044\u305f\u3044\nASP.NET MVC \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u591a\u8a00\u8a9e\u5316\u306e\u4e0b\u3054\u3057\u3089\u3048\u306e\u305f\u3081\u306b\u3001\u300c\u3057\u3070\u3084\u3093\u300d\u3055\u3093\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\u3057\u3070\u3084\u3093\u96d1\u8a18 ASP.NET MVC 3 \u306e Razor \u3067\u3082\u591a\u8a00\u8a9e\u5bfe\u5fdc\u3092\u8a66\u3057\u3066\u307f\u308b\n\u305f\u3060\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u306f\u8907\u6570\u306e\u30d3\u30e5\u30fc\u3067\u5171\u6709\u3059\u308b\u90e8\u5206\u30d3\u30e5\u30fc ~/Views/Shared/_Navigation.cshtml \u306a\u3069\u304c\u3042\u308a\u3001\u305d\u308c\u3089\u306b\u4e0e\u3048\u305f\u30ed\u30fc\u30ab\u30eb\u30ea\u30bd\u30fc\u30b9 ~/Views/Shared/App_LocalResources/_Navigation.cshtml.resx \u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u90e8\u5206\u30d3\u30e5\u30fc\u306f\u3001\u305d\u306e\u540d\u306e\u3068\u304a\u308a\u3001\u89aa\u30d3\u30e5\u30fc\u306e\u4e00\u90e8\u5206\u306b\u306a\u308b\u306e\u3067\u3001GetVirtualPath \u306f\u89aa\u30d3\u30e5\u30fc\u306e\u30d1\u30b9\u3092\u8fd4\u3059\u3053\u3068\u304c\u8981\u56e0\u306e\u3088\u3046\u3067\u3059\u3002\u305d\u308a\u3083\u305d\u3046\u3060\u3002\n\u5c11\u3057\u624b\u3092\u52a0\u3048\u307e\u3057\u305f\u3001\u5909\u66f4\u70b9\u306f 2\u3064\u3067\u3059\u3002\n\nResource \u30e1\u30bd\u30c3\u30c9\u306b virtualPath \u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3002\nResourceRaw \u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3002 ActionLink \u306a\u3069\u306e\u30d8\u30eb\u30d1\u306b\u6e21\u3059\u6587\u5b57\u5217\u3082\u30ea\u30bd\u30fc\u30b9\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u304c\u7406\u7531\u3067\u3059\u3002\n\n    public static class LocalizationHelper\n    {\n        // 1. virtualPath \u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\n        public static MvcHtmlString Resource(this HtmlHelper helper, string expression, string virtualPath = null, params object[] args)\n        {\n            return MvcHtmlString.Create(ResourceRaw(helper, expression, virtualPath, args));\n        }\n\n        // 2. string \u3082\u8fd4\u305b\u308b\u3088\u3046\u306b\n        public static string ResourceRaw(this HtmlHelper helper, string expression, string virtualPath = null, params object[] args)\n        {\n            if (virtualPath == null)\n            {\n                virtualPath = GetVirtualPath(helper);\n            }\n\n            return GetResourceString(helper.ViewContext.HttpContext, expression, virtualPath, args);\n        }\n\n        public static string Resource(this Controller controller, string expression, params object[] args)\n        {\n            return GetResourceString(controller.HttpContext, expression, \"~/\", args);\n        }\n\n        private static string GetResourceString(HttpContextBase httpContext, string expression, string virtualPath, object[] args)\n        {\n            var context = new ExpressionBuilderContext(virtualPath);\n            var builder = new ResourceExpressionBuilder();\n            var fields = (ResourceExpressionFields)builder.ParseExpression(expression, typeof(string), context);\n\n            if (!string.IsNullOrEmpty(fields.ClassKey))\n            {\n                return string.Format((string)httpContext.GetGlobalResourceObject(fields.ClassKey, fields.ResourceKey, CultureInfo.CurrentUICulture), args);\n            }\n\n            return string.Format((string)httpContext.GetLocalResourceObject(virtualPath, fields.ResourceKey, CultureInfo.CurrentUICulture), args);\n        }\n\n        private static string GetVirtualPath(HtmlHelper helper)\n        {\n            // WebFormView \u6c7a\u3081\u6253\u3061\u3067\u306f\u306a\u304f\u3066\u57fa\u5e95\u30af\u30e9\u30b9\u306b\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\n            var view = helper.ViewContext.View as BuildManagerCompiledView;\n\n            if (view != null)\n            {\n                return view.ViewPath;\n            }\n\n            return null;\n        }\n    }\n\n\u547c\u3073\u51fa\u3057\u5074\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n// ~/Views/Shared/App_LocalResources/_Navigation.cshtml.resx \u306b\u5b9a\u7fa9\u3057\u305f\u30ad\u30fc MyTitle \u3092\u8aad\u307f\u51fa\u3059\n@Html.Resource(\"MyTitle\", \"~/Views/Shared/_Navigation.cshtml\")\n\n\u547c\u3073\u51fa\u3057\u5074\u304b\u3089\u307f\u308b\u3068 virtualPath\u304c\u76ee\u7acb\u3061\u3059\u304e\u3066\u5c11\u3057\u4e0d\u7d30\u5de5\u3067\u3059\u306d\u3002\n\u3084\u308a\u3088\u3046\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u672c\u65e5\u306f\u3053\u3053\u307e\u3067\u3002\n\u6700\u5f8c\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3057\u3070\u3084\u3093\u3055\u3093\u306e\u30bd\u30fc\u30b9\u3001\u30ea\u30f3\u30af\u306e\u304a\u304b\u3052\u3067\u52a9\u304b\u308a\u307e\u3057\u305f\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n# ASP.NET MVC \u5171\u6709\u3059\u308b\u90e8\u5206\u30d3\u30e5\u30fc\u306b\u3082\u30ed\u30fc\u30ab\u30eb\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3044\u305f\u3044\n\nASP.NET MVC \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u591a\u8a00\u8a9e\u5316\u306e\u4e0b\u3054\u3057\u3089\u3048\u306e\u305f\u3081\u306b\u3001\u300c\u3057\u3070\u3084\u3093\u300d\u3055\u3093\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n[\u3057\u3070\u3084\u3093\u96d1\u8a18 ASP.NET MVC 3 \u306e Razor \u3067\u3082\u591a\u8a00\u8a9e\u5bfe\u5fdc\u3092\u8a66\u3057\u3066\u307f\u308b](http://blog.shibayan.jp/entry/20110121/1295543963)\n\n\u305f\u3060\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u306f\u8907\u6570\u306e\u30d3\u30e5\u30fc\u3067\u5171\u6709\u3059\u308b\u90e8\u5206\u30d3\u30e5\u30fc `~/Views/Shared/_Navigation.cshtml` \u306a\u3069\u304c\u3042\u308a\u3001\u305d\u308c\u3089\u306b\u4e0e\u3048\u305f\u30ed\u30fc\u30ab\u30eb\u30ea\u30bd\u30fc\u30b9 `~/Views/Shared/App_LocalResources/_Navigation.cshtml.resx` \u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u90e8\u5206\u30d3\u30e5\u30fc\u306f\u3001\u305d\u306e\u540d\u306e\u3068\u304a\u308a\u3001\u89aa\u30d3\u30e5\u30fc\u306e\u4e00\u90e8\u5206\u306b\u306a\u308b\u306e\u3067\u3001`GetVirtualPath` \u306f\u89aa\u30d3\u30e5\u30fc\u306e\u30d1\u30b9\u3092\u8fd4\u3059\u3053\u3068\u304c\u8981\u56e0\u306e\u3088\u3046\u3067\u3059\u3002\u305d\u308a\u3083\u305d\u3046\u3060\u3002\n\n\u5c11\u3057\u624b\u3092\u52a0\u3048\u307e\u3057\u305f\u3001\u5909\u66f4\u70b9\u306f 2\u3064\u3067\u3059\u3002\n\n- Resource \u30e1\u30bd\u30c3\u30c9\u306b virtualPath \u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n- ResourceRaw \u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\u3002 `ActionLink` \u306a\u3069\u306e\u30d8\u30eb\u30d1\u306b\u6e21\u3059\u6587\u5b57\u5217\u3082\u30ea\u30bd\u30fc\u30b9\u306b\u3057\u305f\u304b\u3063\u305f\u306e\u304c\u7406\u7531\u3067\u3059\u3002\n\n\n```csharp\n    public static class LocalizationHelper\n    {\n        // 1. virtualPath \u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\n        public static MvcHtmlString Resource(this HtmlHelper helper, string expression, string virtualPath = null, params object[] args)\n        {\n            return MvcHtmlString.Create(ResourceRaw(helper, expression, virtualPath, args));\n        }\n\n        // 2. string \u3082\u8fd4\u305b\u308b\u3088\u3046\u306b\n        public static string ResourceRaw(this HtmlHelper helper, string expression, string virtualPath = null, params object[] args)\n        {\n            if (virtualPath == null)\n            {\n                virtualPath = GetVirtualPath(helper);\n            }\n\n            return GetResourceString(helper.ViewContext.HttpContext, expression, virtualPath, args);\n        }\n\n        public static string Resource(this Controller controller, string expression, params object[] args)\n        {\n            return GetResourceString(controller.HttpContext, expression, \"~/\", args);\n        }\n\n        private static string GetResourceString(HttpContextBase httpContext, string expression, string virtualPath, object[] args)\n        {\n            var context = new ExpressionBuilderContext(virtualPath);\n            var builder = new ResourceExpressionBuilder();\n            var fields = (ResourceExpressionFields)builder.ParseExpression(expression, typeof(string), context);\n\n            if (!string.IsNullOrEmpty(fields.ClassKey))\n            {\n                return string.Format((string)httpContext.GetGlobalResourceObject(fields.ClassKey, fields.ResourceKey, CultureInfo.CurrentUICulture), args);\n            }\n\n            return string.Format((string)httpContext.GetLocalResourceObject(virtualPath, fields.ResourceKey, CultureInfo.CurrentUICulture), args);\n        }\n\n        private static string GetVirtualPath(HtmlHelper helper)\n        {\n            // WebFormView \u6c7a\u3081\u6253\u3061\u3067\u306f\u306a\u304f\u3066\u57fa\u5e95\u30af\u30e9\u30b9\u306b\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\n            var view = helper.ViewContext.View as BuildManagerCompiledView;\n\n            if (view != null)\n            {\n                return view.ViewPath;\n            }\n\n            return null;\n        }\n    }\n```\n\n\u547c\u3073\u51fa\u3057\u5074\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3057\u3087\u3046\u304b\u3002\n\n```csharp\n// ~/Views/Shared/App_LocalResources/_Navigation.cshtml.resx \u306b\u5b9a\u7fa9\u3057\u305f\u30ad\u30fc MyTitle \u3092\u8aad\u307f\u51fa\u3059\n@Html.Resource(\"MyTitle\", \"~/Views/Shared/_Navigation.cshtml\")\n```\n\n\u547c\u3073\u51fa\u3057\u5074\u304b\u3089\u307f\u308b\u3068 `virtualPath`\u304c\u76ee\u7acb\u3061\u3059\u304e\u3066\u5c11\u3057\u4e0d\u7d30\u5de5\u3067\u3059\u306d\u3002\n\u3084\u308a\u3088\u3046\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u672c\u65e5\u306f\u3053\u3053\u307e\u3067\u3002\n\n\u6700\u5f8c\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u3057\u3070\u3084\u3093\u3055\u3093\u306e\u30bd\u30fc\u30b9\u3001\u30ea\u30f3\u30af\u306e\u304a\u304b\u3052\u3067\u52a9\u304b\u308a\u307e\u3057\u305f\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n", "tags": ["ASP.NET_MVC", "ASP.NET_MVC_Razor"]}