{"context": "[Python]FX\u30b7\u30b9\u30c8\u30ec\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6700\u9069\u5316\u3092\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u3067\u3084\u3063\u3066\u307f\u308b\n\u306e\u7d9a\u304d\u3067\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u306e\u4ee3\u308f\u308a\u306b\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(GA)\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u6e96\u5099\n\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u56de\u3068\u540c\u3058\u3067\u3059\u3002\nimport numpy as np\nimport pandas as pd\nimport indicators as ind #indicators.py\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nfrom backtest import Backtest,BacktestReport\n\ndataM1 = pd.read_csv('DAT_ASCII_EURUSD_M1_2015.csv', sep=';',\n                     names=('Time','Open','High','Low','Close', ''),\n                     index_col='Time', parse_dates=True)\ndataM1.index += pd.offsets.Hour(7) #7\u6642\u9593\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\nohlc = ind.TF_ohlc(dataM1, 'H') #\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n\nGitHub\u306b\u30a2\u30c3\u30d7\u3057\u3066\u3042\u308bindicators.py\u3068backtest.py\u304c\u5fc5\u8981\u3067\u3059\u3002backtest.py\u306b\u3064\u3044\u3066\u306f\u3001BacktestReport\u3067\u82e5\u5e72\u4fee\u6b63\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6700\u9069\u5316\u3059\u308b\u30c8\u30ec\u30fc\u30c9\u30b7\u30b9\u30c6\u30e0\n\u4eca\u56de\u306f\u6700\u9069\u5316\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5024\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u5897\u3084\u3059\u305f\u3081\u306b\u3001\uff12\u672c\u306e\u79fb\u52d5\u5e73\u5747\u306e\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u306b\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n\u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6c7a\u6e08\uff1a\u7d42\u5024\u304c\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u3092\u4e0b\u629c\u3051\u305f\u3068\u304d\n\u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6c7a\u6e08\uff1a\u7d42\u5024\u304c\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u3092\u4e0a\u629c\u3051\u305f\u3068\u304d\n\n\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\uff13\u500b\u3068\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u305d\u308c\u305e\u308c\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7bc4\u56f2\u3067\u63a2\u7d22\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nSlowMAperiod = np.arange(7, 151) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\nFastMAperiod = np.arange(5, 131) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\nExitMAperiod = np.arange(3, 111) #\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\n\n\u3060\u3044\u305f\u3044200\u4e07\u901a\u308a\u306e\u7d44\u307f\u5408\u308f\u305b\u3068\u306a\u308a\u307e\u3059\u3002\u7dcf\u5f53\u305f\u308a\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u6570\u6642\u9593\u306f\u304b\u304b\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n\u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3\n\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3\u306f\u3001\u524d\u56de\u306e\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u3068\u307b\u307c\u540c\u3058\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u63a2\u3059\u3068\u3053\u308d\u3092\u3001\u5f8c\u8ff0\u306e\u907a\u4f1d\u7684\u51e6\u7406\u306b\u7f6e\u304d\u63db\u3048\u308b\u3060\u3051\u3067\u3059\u3002\u307e\u305f\u58f2\u8cb7\u30b7\u30b0\u30ca\u30eb\u306f\u4e0a\u8a18\u306e\u30eb\u30fc\u30eb\u306e\u3088\u3046\u306b\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\ndef Optimize(ohlc, Prange):\n    def shift(x, n=1): return np.concatenate((np.zeros(n), x[:-n])) #\u30b7\u30d5\u30c8\u95a2\u6570\n\n    SlowMA = np.empty([len(Prange[0]), len(ohlc)]) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[0])):\n        SlowMA[i] = ind.iMA(ohlc, Prange[0][i])\n\n    FastMA = np.empty([len(Prange[1]), len(ohlc)]) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[1])):\n        FastMA[i] = ind.iMA(ohlc, Prange[1][i])\n\n    ExitMA = np.empty([len(Prange[2]), len(ohlc)]) #\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[2])):\n        ExitMA[i] = ind.iMA(ohlc, Prange[2][i])\n\n    Close = ohlc['Close'].values #\u7d42\u5024\n\n    M = 20 #\u500b\u4f53\u6570\n    Eval = np.zeros([M, 6])  #\u8a55\u4fa1\u9805\u76ee\n    Param = InitParam(Prange, M) #\u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\n    gens = 0 #\u4e16\u4ee3\u6570\n    while gens < 100:\n        for k in range(M):\n            i0 = Param[k,0]\n            i1 = Param[k,1]\n            i2 = Param[k,2]\n            #\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            BuyEntry = (FastMA[i1] > SlowMA[i0]) & (shift(FastMA[i1]) <= shift(SlowMA[i0]))\n            #\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            SellEntry = (FastMA[i1] < SlowMA[i0]) & (shift(FastMA[i1]) >= shift(SlowMA[i0]))\n            #\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            BuyExit = (Close < ExitMA[i2]) & (shift(Close) >= shift(ExitMA[i2]))\n            #\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            SellExit = (Close > ExitMA[i2]) & (shift(Close) <= shift(ExitMA[i2]))\n            #\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\n            Trade, PL = Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit) \n            Eval[k] = BacktestReport(Trade, PL)\n        # \u4e16\u4ee3\u306e\u4ea4\u4ee3\n        Param = Evolution(Param, Eval[:,0], Prange)\n        gens += 1\n        print(gens, Eval[0,0])\n    Slow = Prange[0][Param[:,0]]\n    Fast = Prange[1][Param[:,1]]\n    Exit = Prange[2][Param[:,2]]\n    return pd.DataFrame({'Slow':Slow, 'Fast':Fast, 'Exit':Exit, 'Profit': Eval[:,0], 'Trades':Eval[:,1],\n                         'Average':Eval[:,2],'PF':Eval[:,3], 'MDD':Eval[:,4], 'RF':Eval[:,5]},\n                         columns=['Slow','Fast','Exit','Profit','Trades','Average','PF','MDD','RF'])\n\n\u3082\u3046\u4e00\u3064\u3001\u524d\u56de\u304b\u3089\u306e\u5909\u66f4\u70b9\u306f\u3001SlowMAperiod, FastMAperiod, ExitMAperiod\u306e\u4e09\u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u7bc4\u56f2\u3092Prange\u3068\u3044\u3046\u30ea\u30b9\u30c8\u306b\u307e\u3068\u3081\u3066\u5404\u95a2\u6570\u306b\u6e21\u3059\u3088\u3046\u306b\u3057\u305f\u70b9\u3067\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6570\u304c\u5897\u3048\u3066\u3082\u305d\u306e\u307e\u307e\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u907a\u4f1d\u7684\u51e6\u7406\n\u4e0a\u306e\u95a2\u6570\u3067\u3001GA\u7528\u306b\u8ffd\u52a0\u3057\u305f\u95a2\u6570\u306f\u3001InitParam()\u3068Evolution()\u3067\u3059\u3002\u307e\u305a\u3001InitParam()\u306f\u3001\u5404\u500b\u4f53\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u521d\u671f\u5316\u3067\u3059\u3002\nfrom numpy.random import randint,choice\n\n#\u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndef InitParam(Prange, M):\n    Param = randint(len(Prange[0]), size=M)\n    for i in range(1,len(Prange)):\n        Param = np.vstack((Param, randint(len(Prange[i]), size=M)))\n    return Param.T\n\nEvolution()\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u3044\u304f\u3064\u304b\u306e\u907a\u4f1d\u7684\u51e6\u7406\u3092\u542b\u307f\u307e\u3059\u3002\n#\u907a\u4f1d\u7684\u51e6\u7406\ndef Evolution(Param, Eval, Prange):\n    #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n    #\uff11\u70b9\u4ea4\u53c9\n    #\u8fd1\u508d\u751f\u6210\n    #\u7a81\u7136\u5909\u7570\n    return Param\n\n\u305d\u308c\u305e\u308c\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n\u307e\u305a\u3001\u73fe\u5728\u306e\u500b\u4f53\u306e\u4e2d\u304b\u3089\u6b21\u4e16\u4ee3\u306b\u6b8b\u3059\u500b\u4f53\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u9078\u629e\u306e\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u306e\u3067\u3059\u304c\u3001Numpy\u306e\u95a2\u6570\u3067\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u306b\u4fbf\u5229\u306a\u95a2\u6570\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u306f\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u8a55\u4fa1\u5024\u3067\u3042\u308b\u9069\u5fdc\u5ea6\u306e\u5927\u304d\u3055\u306b\u5fdc\u3058\u3066\u3001\u78ba\u7387\u7684\u306b\u6b21\u4e16\u4ee3\u306b\u6b8b\u3059\u500b\u4f53\u3092\u9078\u629e\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002\u9069\u5fdc\u5ea6\u304c\u9ad8\u3044\u307b\u3069\u6b8b\u308a\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\u4eca\u56de\u4f7f\u3063\u305f\u95a2\u6570\u306f\u3001numpy.random.choice()\u3068\u3044\u3046\u95a2\u6570\u3067\u3001\u30ea\u30b9\u30c8\u304b\u3089\u5fc5\u8981\u306a\u500b\u6570\u5206\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u629e\u3059\u308b\u3082\u306e\u3067\u3059\u304c\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5f15\u6570\u306bp\u3068\u3044\u3046\u9078\u629e\u78ba\u7387\u306e\u30ea\u30b9\u30c8\u3092\u4ed8\u3051\u308b\u3068\u3001\u305d\u306e\u78ba\u7387\u306b\u5408\u308f\u305b\u3066\u9078\u629e\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3059\u3002\u3053\u308c\u306f\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u305d\u306e\u3082\u306e\u3067\u3059\u3002\u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n    #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n    Param = Param[np.argsort(Eval)[::-1]] #\u30bd\u30fc\u30c8\n    R = Eval-min(Eval)\n    R = R/sum(R)\n    idx = choice(len(Eval), size=len(Eval), replace=True, p=R)\n    idx[0] = 0 #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\n    Param = Param[idx]\n\n\u305f\u3060\u3001\u78ba\u7387\u304c\u30de\u30a4\u30ca\u30b9\u3060\u3068\u90fd\u5408\u304c\u60aa\u3044\u306e\u3067\u3001\u9069\u5fdc\u5ea6\u306e\u6700\u5c0f\u5024\u304c\uff10\u306b\u306a\u308b\u3088\u3046\u306b\u88dc\u6b63\u3057\u3066\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u3060\u3051\u3060\u3068\u3001\u9069\u5fdc\u5ea6\u304c\u9ad8\u304f\u3066\u3082\u904b\u60aa\u304f\u9078\u3070\u308c\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u9069\u5fdc\u5ea6\u3092\u30bd\u30fc\u30c8\u3057\u3066\u6700\u3082\u9ad8\u3044\u500b\u4f53\uff08\u30a8\u30ea\u30fc\u30c8\uff09\u306f\u5fc5\u305a\u6b21\u4e16\u4ee3\u306b\u6b8b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\uff11\u70b9\u4ea4\u53c9\n\u6b21\u306b\u907a\u4f1d\u5b50\u306e\u4ea4\u53c9\u3092\u884c\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u4e8c\u3064\u306e\u500b\u4f53\u3092\u9078\u3093\u3067\u3001\u907a\u4f1d\u5b50\u60c5\u5831\u306e\u4e00\u90e8\u3092\u4e92\u3044\u306b\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u4ea4\u53c9\u306e\u65b9\u6cd5\u3082\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e26\u3073\u306e\uff11\u304b\u6240\u3092\u9078\u3093\u3067\u3001\u305d\u306e\u524d\u5f8c\u3092\u4ea4\u63db\u3059\u308b\u65b9\u6cd5\u306b\u3057\u307e\u3057\u305f\u3002\n    #\uff11\u70b9\u4ea4\u53c9\n    N = 10\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    for i in range(0,N,2):\n        ix = idx[i:i+2]\n        p = randint(1,len(Prange))\n        Param[ix] = np.hstack((Param[ix][:,:p], Param[ix][:,p:][::-1]))\n\n\u3053\u3053\u3067\u3082choice()\u3092\u4f7f\u3063\u3066\u4ea4\u53c9\u3059\u308b\u500b\u4f53\u306e\u500b\u6570\u5206\u306e\u4e71\u6570\u5217\u3092\u751f\u6210\u3057\u307e\u3059\u3002replace=False\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067\u3001\u91cd\u8907\u306e\u306a\u3044\u4e71\u6570\u5217\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u3001\uff12\u500b\u305a\u3064\u306e\u500b\u4f53\u3092ix\u3068\u3057\u3066\u9078\u629e\u3057\u3066\u3001\u4ea4\u53c9\u70b9p\u306e\u5f8c\u534a\u306e\u30c7\u30fc\u30bf\u3092\u5165\u308c\u63db\u3048\u308b\u3053\u3068\u3067\u4ea4\u53c9\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u8fd1\u508d\u751f\u6210\n\u901a\u5e38\u306eGA\u3067\u306f\u3001\u9078\u629e\u3001\u4ea4\u53c9\u3001\u7a81\u7136\u5909\u7570\u3067\u9032\u5316\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u3088\u3046\u306b\u4ea4\u53c9\u70b9\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5207\u308c\u76ee\u306e\u3068\u3053\u308d\u306b\u9650\u5b9a\u3057\u3066\u3044\u308b\u3068\u3001\u3044\u3064\u306e\u9593\u306b\u304b\u540c\u3058\u500b\u4f53\u3060\u3089\u3051\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u9032\u5316\u304c\u6b62\u307e\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u304b\u3068\u3044\u3063\u3066\u3001\u7a81\u7136\u5909\u7570\u3092\u591a\u304f\u3059\u308b\u3068\u3001\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u306b\u8fd1\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u3042\u307e\u308a\u52b9\u7387\u304c\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e00\u90e8\u3092+1\u3001\u3042\u308b\u3044\u306f-1\u3059\u308b\u5909\u5316\u3092\u65bd\u3057\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u8fd1\u508d\u89e3\u3068\u3044\u3046\u3084\u3064\u3067\u3001\u5c40\u6240\u63a2\u7d22\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3088\u304f\u5229\u7528\u3055\u308c\u308b\u3082\u306e\u3067\u3059\u3002\n    #\u8fd1\u508d\u751f\u6210\n    N = 10\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    diff = choice([-1,1], size=N).reshape(N,1)\n    for i in range(N):\n        p = randint(len(Prange))\n        Param[idx[i]][p:p+1] = (Param[idx[i]][p]+diff[i]+len(Prange[p]))%len(Prange[p])\n\n\u4ea4\u53c9\u3068\u540c\u3058\u304f\u8fd1\u508d\u3092\u751f\u6210\u3059\u308b\u500b\u4f53\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u3069\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u5316\u3055\u305b\u308b\u304b\u3092\u307e\u305f\u4e71\u6570\u3067\u6c7a\u3081\u3066\u3001\u305d\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30921\u3060\u3051\u5909\u5316\u3055\u305b\u307e\u3059\u3002\n\n\u7a81\u7136\u5909\u7570\n\u6700\u5f8c\u306b\u7a81\u7136\u5909\u7570\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u3082\u3044\u304f\u3064\u304b\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u9078\u629e\u3057\u305f\u500b\u4f53\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e00\u90e8\u3092\u65b0\u3057\u304f\u4e71\u6570\u3067\u66f8\u304d\u63db\u3048\u307e\u3059\u3002GA\u306e\u5834\u5408\u3001\u5c40\u6240\u89e3\u304b\u3089\u629c\u3051\u51fa\u3059\u306b\u306f\u3001\u7a81\u7136\u5909\u7570\u304c\u91cd\u8981\u306a\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u3092\u591a\u7528\u3059\u308b\u3068\u30e9\u30f3\u30c0\u30e0\u6027\u304c\u9ad8\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u3001\uff12\u500b\u7a0b\u5ea6\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n    #\u7a81\u7136\u5909\u7570\n    N = 2\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    for i in range(N):\n        p = randint(len(Prange))\n        Param[idx[i]][p:p+1] = randint(len(Prange[p]))\n\n\n\u5b9f\u884c\u7d50\u679c\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u305f\u95a2\u6570\u3092\u4f7f\u3063\u3066\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\nresult = Optimize(ohlc, [SlowMAperiod, FastMAperiod, ExitMAperiod])\nresult.sort_values('Profit', ascending=False)\n\nGA\u3082\u4e71\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7d50\u679c\u306f\u6bce\u56de\u7570\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u7d50\u679c\u306e\u4e00\u4f8b\u3067\u3001\u4e16\u4ee3\u6bce\u306b\u6700\u3082\u9ad8\u3044\u9069\u5fdc\u5ea6\u3092\u793a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u9ad8\u3044\u9069\u5fdc\u5ea6\u306f\u9806\u6b21\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\n1 -94.9\n2 958.2\n3 958.2\n4 958.2\n5 1030.3\n6 1030.3\n7 1030.3\n8 1454.0\n9 1550.9\n10 1550.9\n11 1850.8\n12 1850.8\n13 1850.8\n14 1850.8\n15 1850.8\n16 1850.8\n17 2022.5\n18 2076.5\n19 2076.5\n20 2076.5\n\uff1a\n61 2076.5\n62 2076.5\n63 2076.5\n64 2076.5\n65 2076.5\n66 2316.2\n67 2316.2\n68 2316.2\n69 2316.2\n70 2316.2\n\uff1a\n95 2316.2\n96 2316.2\n97 2316.2\n98 2316.2\n99 2316.2\n100 2316.2\n\n\u6700\u5f8c\u306e\u4e16\u4ee3\u306b\u6b8b\u3063\u305f\u500b\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n\n\nSlow\nFast\nExit\nProfit\nTrades\nAverage\nPF\nMDD\nRF\n\n\n\n\n0\n126\n17\n107\n2316.2\n75.0\n30.882667\n2.306889\n387.1\n5.983467\n\n\n18\n126\n15\n107\n2316.2\n75.0\n30.882667\n2.306889\n387.1\n5.983467\n\n\n8\n105\n18\n106\n2210.2\n76.0\n29.081579\n2.247080\n387.1\n5.709636\n\n\n17\n126\n18\n108\n2130.9\n75.0\n28.412000\n2.158098\n424.9\n5.015062\n\n\n10\n126\n18\n107\n2078.4\n79.0\n26.308861\n1.980794\n448.3\n4.636181\n\n\n9\n127\n18\n107\n2074.5\n73.0\n28.417808\n2.184819\n371.3\n5.587126\n\n\n6\n126\n15\n7\n2030.3\n76.0\n26.714474\n2.007143\n415.7\n4.884051\n\n\n16\n126\n14\n107\n2024.9\n76.0\n26.643421\n2.100489\n424.9\n4.765592\n\n\n5\n126\n17\n107\n1954.7\n74.0\n26.414865\n1.917441\n448.3\n4.360250\n\n\n13\n126\n17\n105\n1878.7\n79.0\n23.781013\n1.888694\n414.2\n4.535732\n\n\n2\n127\n18\n107\n1872.4\n75.0\n24.965333\n1.878813\n448.3\n4.176667\n\n\n12\n126\n17\n101\n1869.6\n76.0\n24.600000\n2.063300\n420.4\n4.447193\n\n\n11\n92\n15\n107\n1859.5\n73.0\n25.472603\n2.006223\n358.8\n5.182553\n\n\n14\n125\n14\n108\n1843.1\n84.0\n21.941667\n1.811938\n473.6\n3.891681\n\n\n4\n124\n14\n107\n1839.8\n75.0\n24.530667\n1.975245\n420.4\n4.376308\n\n\n3\n42\n19\n107\n1796.8\n75.0\n23.957333\n1.912405\n410.7\n4.374970\n\n\n1\n125\n15\n106\n1614.7\n81.0\n19.934568\n1.711729\n386.9\n4.173430\n\n\n19\n104\n18\n107\n1583.7\n94.0\n16.847872\n1.654746\n393.4\n4.025674\n\n\n7\n125\n17\n106\n1421.7\n81.0\n17.551852\n1.629015\n574.4\n2.475104\n\n\n15\n92\n16\n107\n539.8\n103.0\n5.240777\n1.150513\n605.1\n0.892084\n\n\n\n\n\u3053\u306e\u554f\u984c\u306e\u6700\u9069\u89e3\u306f\u8abf\u3079\u3066\u3044\u306a\u3044\u306e\u3067\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3053\u306e\u7d50\u679c\u306f\u3001\u307e\u3042\u307e\u3042\u9ad8\u3044\u5024\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u3082\u305d\u3082GA\u306e\u76ee\u7684\u306f\u3001\u6700\u9069\u89e3\u3092\u6c42\u3081\u308b\u3053\u3068\u3067\u306f\u306a\u304f\u3001\u7dcf\u5f53\u305f\u308a\u3059\u308b\u3088\u308a\u77ed\u3044\u6642\u9593\u3067\u6e96\u6700\u9069\u89e3\u3092\u6c42\u3081\u308b\u3053\u3068\u3067\u3059\u3002\n\u5b9f\u969b\u3001\u30b7\u30b9\u30c8\u30ec\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6700\u9069\u89e3\u3092\u6c42\u3081\u305f\u3068\u3053\u308d\u3067\u3001\u305d\u306e\u30b7\u30b9\u30c6\u30e0\u304c\u5225\u306e\u671f\u9593\u3067\u3082\u540c\u3058\u7d50\u679c\u3092\u51fa\u3059\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3046\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001200\u4e07\u901a\u308a\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u4e2d\u304b\u30892000\u56de\u306e\u8a66\u884c\u3067\u307e\u3042\u307e\u3042\u306e\u89e3\u304c\u5f97\u3089\u308c\u305f\u306e\u3067\u3042\u308c\u3070\u3001\u3088\u3057\u3068\u3059\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u3002\n[[Python]FX\u30b7\u30b9\u30c8\u30ec\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6700\u9069\u5316\u3092\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u3067\u3084\u3063\u3066\u307f\u308b](http://qiita.com/toyolab/items/065dd54d2b9d8033a602)\n\n\u306e\u7d9a\u304d\u3067\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u306e\u4ee3\u308f\u308a\u306b\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(GA)\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u6e96\u5099\n\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u56de\u3068\u540c\u3058\u3067\u3059\u3002\n\n````py\nimport numpy as np\nimport pandas as pd\nimport indicators as ind #indicators.py\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\nfrom backtest import Backtest,BacktestReport\n\ndataM1 = pd.read_csv('DAT_ASCII_EURUSD_M1_2015.csv', sep=';',\n                     names=('Time','Open','High','Low','Close', ''),\n                     index_col='Time', parse_dates=True)\ndataM1.index += pd.offsets.Hour(7) #7\u6642\u9593\u306e\u30aa\u30d5\u30bb\u30c3\u30c8\nohlc = ind.TF_ohlc(dataM1, 'H') #\uff11\u6642\u9593\u8db3\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\n````\n\n[GitHub](https://github.com/toyolab/MT5IndicatorsPy)\u306b\u30a2\u30c3\u30d7\u3057\u3066\u3042\u308bindicators.py\u3068backtest.py\u304c\u5fc5\u8981\u3067\u3059\u3002backtest.py\u306b\u3064\u3044\u3066\u306f\u3001`BacktestReport`\u3067\u82e5\u5e72\u4fee\u6b63\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u6700\u9069\u5316\u3059\u308b\u30c8\u30ec\u30fc\u30c9\u30b7\u30b9\u30c6\u30e0\n\n\u4eca\u56de\u306f\u6700\u9069\u5316\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5024\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u5897\u3084\u3059\u305f\u3081\u306b\u3001\uff12\u672c\u306e\u79fb\u52d5\u5e73\u5747\u306e\u4ea4\u5dee\u30b7\u30b9\u30c6\u30e0\u306b\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n* \u8cb7\u3044\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6c7a\u6e08\uff1a\u7d42\u5024\u304c\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u3092\u4e0b\u629c\u3051\u305f\u3068\u304d\n* \u58f2\u308a\u30dd\u30b8\u30b7\u30e7\u30f3\u306e\u6c7a\u6e08\uff1a\u7d42\u5024\u304c\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u3092\u4e0a\u629c\u3051\u305f\u3068\u304d\n\n\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\uff13\u500b\u3068\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u305d\u308c\u305e\u308c\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7bc4\u56f2\u3067\u63a2\u7d22\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n````py\nSlowMAperiod = np.arange(7, 151) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\nFastMAperiod = np.arange(5, 131) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\nExitMAperiod = np.arange(3, 111) #\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\u671f\u9593\u306e\u7bc4\u56f2\n````\n\u3060\u3044\u305f\u3044200\u4e07\u901a\u308a\u306e\u7d44\u307f\u5408\u308f\u305b\u3068\u306a\u308a\u307e\u3059\u3002\u7dcf\u5f53\u305f\u308a\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u6570\u6642\u9593\u306f\u304b\u304b\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n# \u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3\n\n\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30e1\u30a4\u30f3\u30eb\u30fc\u30c1\u30f3\u306f\u3001\u524d\u56de\u306e\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u3068\u307b\u307c\u540c\u3058\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u63a2\u3059\u3068\u3053\u308d\u3092\u3001\u5f8c\u8ff0\u306e\u907a\u4f1d\u7684\u51e6\u7406\u306b\u7f6e\u304d\u63db\u3048\u308b\u3060\u3051\u3067\u3059\u3002\u307e\u305f\u58f2\u8cb7\u30b7\u30b0\u30ca\u30eb\u306f\u4e0a\u8a18\u306e\u30eb\u30fc\u30eb\u306e\u3088\u3046\u306b\u6c7a\u6e08\u7528\u306e\u30b7\u30b0\u30ca\u30eb\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n````py\ndef Optimize(ohlc, Prange):\n    def shift(x, n=1): return np.concatenate((np.zeros(n), x[:-n])) #\u30b7\u30d5\u30c8\u95a2\u6570\n\n    SlowMA = np.empty([len(Prange[0]), len(ohlc)]) #\u9577\u671f\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[0])):\n        SlowMA[i] = ind.iMA(ohlc, Prange[0][i])\n\n    FastMA = np.empty([len(Prange[1]), len(ohlc)]) #\u77ed\u671f\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[1])):\n        FastMA[i] = ind.iMA(ohlc, Prange[1][i])\n    \n    ExitMA = np.empty([len(Prange[2]), len(ohlc)]) #\u6c7a\u6e08\u7528\u79fb\u52d5\u5e73\u5747\n    for i in range(len(Prange[2])):\n        ExitMA[i] = ind.iMA(ohlc, Prange[2][i])\n    \n    Close = ohlc['Close'].values #\u7d42\u5024\n    \n    M = 20 #\u500b\u4f53\u6570\n    Eval = np.zeros([M, 6])  #\u8a55\u4fa1\u9805\u76ee\n    Param = InitParam(Prange, M) #\u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\n    gens = 0 #\u4e16\u4ee3\u6570\n    while gens < 100:\n        for k in range(M):\n            i0 = Param[k,0]\n            i1 = Param[k,1]\n            i2 = Param[k,2]\n            #\u8cb7\u3044\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            BuyEntry = (FastMA[i1] > SlowMA[i0]) & (shift(FastMA[i1]) <= shift(SlowMA[i0]))\n            #\u58f2\u308a\u30a8\u30f3\u30c8\u30ea\u30fc\u30b7\u30b0\u30ca\u30eb\n            SellEntry = (FastMA[i1] < SlowMA[i0]) & (shift(FastMA[i1]) >= shift(SlowMA[i0]))\n            #\u8cb7\u3044\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            BuyExit = (Close < ExitMA[i2]) & (shift(Close) >= shift(ExitMA[i2]))\n            #\u58f2\u308a\u30a8\u30b0\u30b8\u30c3\u30c8\u30b7\u30b0\u30ca\u30eb\n            SellExit = (Close > ExitMA[i2]) & (shift(Close) <= shift(ExitMA[i2]))\n            #\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\n            Trade, PL = Backtest(ohlc, BuyEntry, SellEntry, BuyExit, SellExit) \n            Eval[k] = BacktestReport(Trade, PL)\n        # \u4e16\u4ee3\u306e\u4ea4\u4ee3\n        Param = Evolution(Param, Eval[:,0], Prange)\n        gens += 1\n        print(gens, Eval[0,0])\n    Slow = Prange[0][Param[:,0]]\n    Fast = Prange[1][Param[:,1]]\n    Exit = Prange[2][Param[:,2]]\n    return pd.DataFrame({'Slow':Slow, 'Fast':Fast, 'Exit':Exit, 'Profit': Eval[:,0], 'Trades':Eval[:,1],\n                         'Average':Eval[:,2],'PF':Eval[:,3], 'MDD':Eval[:,4], 'RF':Eval[:,5]},\n                         columns=['Slow','Fast','Exit','Profit','Trades','Average','PF','MDD','RF'])\n````\n\u3082\u3046\u4e00\u3064\u3001\u524d\u56de\u304b\u3089\u306e\u5909\u66f4\u70b9\u306f\u3001`SlowMAperiod`, `FastMAperiod`, `ExitMAperiod`\u306e\u4e09\u3064\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u7bc4\u56f2\u3092`Prange`\u3068\u3044\u3046\u30ea\u30b9\u30c8\u306b\u307e\u3068\u3081\u3066\u5404\u95a2\u6570\u306b\u6e21\u3059\u3088\u3046\u306b\u3057\u305f\u70b9\u3067\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u3067\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u6570\u304c\u5897\u3048\u3066\u3082\u305d\u306e\u307e\u307e\u5bfe\u5fdc\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u907a\u4f1d\u7684\u51e6\u7406\n\u4e0a\u306e\u95a2\u6570\u3067\u3001GA\u7528\u306b\u8ffd\u52a0\u3057\u305f\u95a2\u6570\u306f\u3001`InitParam()`\u3068`Evolution()`\u3067\u3059\u3002\u307e\u305a\u3001`InitParam()`\u306f\u3001\u5404\u500b\u4f53\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u521d\u671f\u5316\u3067\u3059\u3002\n\n````py\nfrom numpy.random import randint,choice\n\n#\u30d1\u30e9\u30e1\u30fc\u30bf\u521d\u671f\u5316\ndef InitParam(Prange, M):\n    Param = randint(len(Prange[0]), size=M)\n    for i in range(1,len(Prange)):\n        Param = np.vstack((Param, randint(len(Prange[i]), size=M)))\n    return Param.T\n````\n`Evolution()`\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u3044\u304f\u3064\u304b\u306e\u907a\u4f1d\u7684\u51e6\u7406\u3092\u542b\u307f\u307e\u3059\u3002\n\n````py\n#\u907a\u4f1d\u7684\u51e6\u7406\ndef Evolution(Param, Eval, Prange):\n    #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n    #\uff11\u70b9\u4ea4\u53c9\n    #\u8fd1\u508d\u751f\u6210\n    #\u7a81\u7136\u5909\u7570\n    return Param\n````\n\n\u305d\u308c\u305e\u308c\u306e\u51e6\u7406\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n## \u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n\n\u307e\u305a\u3001\u73fe\u5728\u306e\u500b\u4f53\u306e\u4e2d\u304b\u3089\u6b21\u4e16\u4ee3\u306b\u6b8b\u3059\u500b\u4f53\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u9078\u629e\u306e\u65b9\u6cd5\u306f\u3044\u304f\u3064\u304b\u3042\u308b\u306e\u3067\u3059\u304c\u3001Numpy\u306e\u95a2\u6570\u3067\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u306b\u4fbf\u5229\u306a\u95a2\u6570\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u306f\u30d0\u30c3\u30af\u30c6\u30b9\u30c8\u306e\u8a55\u4fa1\u5024\u3067\u3042\u308b\u9069\u5fdc\u5ea6\u306e\u5927\u304d\u3055\u306b\u5fdc\u3058\u3066\u3001\u78ba\u7387\u7684\u306b\u6b21\u4e16\u4ee3\u306b\u6b8b\u3059\u500b\u4f53\u3092\u9078\u629e\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002\u9069\u5fdc\u5ea6\u304c\u9ad8\u3044\u307b\u3069\u6b8b\u308a\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u4f7f\u3063\u305f\u95a2\u6570\u306f\u3001`numpy.random.choice()`\u3068\u3044\u3046\u95a2\u6570\u3067\u3001\u30ea\u30b9\u30c8\u304b\u3089\u5fc5\u8981\u306a\u500b\u6570\u5206\u30e9\u30f3\u30c0\u30e0\u306b\u9078\u629e\u3059\u308b\u3082\u306e\u3067\u3059\u304c\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5f15\u6570\u306b`p`\u3068\u3044\u3046\u9078\u629e\u78ba\u7387\u306e\u30ea\u30b9\u30c8\u3092\u4ed8\u3051\u308b\u3068\u3001\u305d\u306e\u78ba\u7387\u306b\u5408\u308f\u305b\u3066\u9078\u629e\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3059\u3002\u3053\u308c\u306f\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u305d\u306e\u3082\u306e\u3067\u3059\u3002\u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\n\n````py\n    #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u4ed8\u304d\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\n    Param = Param[np.argsort(Eval)[::-1]] #\u30bd\u30fc\u30c8\n    R = Eval-min(Eval)\n    R = R/sum(R)\n    idx = choice(len(Eval), size=len(Eval), replace=True, p=R)\n    idx[0] = 0 #\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\n    Param = Param[idx]\n````\n\n\u305f\u3060\u3001\u78ba\u7387\u304c\u30de\u30a4\u30ca\u30b9\u3060\u3068\u90fd\u5408\u304c\u60aa\u3044\u306e\u3067\u3001\u9069\u5fdc\u5ea6\u306e\u6700\u5c0f\u5024\u304c\uff10\u306b\u306a\u308b\u3088\u3046\u306b\u88dc\u6b63\u3057\u3066\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u30eb\u30fc\u30ec\u30c3\u30c8\u9078\u629e\u3060\u3051\u3060\u3068\u3001\u9069\u5fdc\u5ea6\u304c\u9ad8\u304f\u3066\u3082\u904b\u60aa\u304f\u9078\u3070\u308c\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u3001\u9069\u5fdc\u5ea6\u3092\u30bd\u30fc\u30c8\u3057\u3066\u6700\u3082\u9ad8\u3044\u500b\u4f53\uff08\u30a8\u30ea\u30fc\u30c8\uff09\u306f\u5fc5\u305a\u6b21\u4e16\u4ee3\u306b\u6b8b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \uff11\u70b9\u4ea4\u53c9\n\n\u6b21\u306b\u907a\u4f1d\u5b50\u306e\u4ea4\u53c9\u3092\u884c\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u4e8c\u3064\u306e\u500b\u4f53\u3092\u9078\u3093\u3067\u3001\u907a\u4f1d\u5b50\u60c5\u5831\u306e\u4e00\u90e8\u3092\u4e92\u3044\u306b\u4ea4\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u4ea4\u53c9\u306e\u65b9\u6cd5\u3082\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e26\u3073\u306e\uff11\u304b\u6240\u3092\u9078\u3093\u3067\u3001\u305d\u306e\u524d\u5f8c\u3092\u4ea4\u63db\u3059\u308b\u65b9\u6cd5\u306b\u3057\u307e\u3057\u305f\u3002\n\n````py\n    #\uff11\u70b9\u4ea4\u53c9\n    N = 10\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    for i in range(0,N,2):\n        ix = idx[i:i+2]\n        p = randint(1,len(Prange))\n        Param[ix] = np.hstack((Param[ix][:,:p], Param[ix][:,p:][::-1]))\n````\n\n\u3053\u3053\u3067\u3082`choice()`\u3092\u4f7f\u3063\u3066\u4ea4\u53c9\u3059\u308b\u500b\u4f53\u306e\u500b\u6570\u5206\u306e\u4e71\u6570\u5217\u3092\u751f\u6210\u3057\u307e\u3059\u3002`replace=False`\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067\u3001\u91cd\u8907\u306e\u306a\u3044\u4e71\u6570\u5217\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u3001\uff12\u500b\u305a\u3064\u306e\u500b\u4f53\u3092`ix`\u3068\u3057\u3066\u9078\u629e\u3057\u3066\u3001\u4ea4\u53c9\u70b9`p`\u306e\u5f8c\u534a\u306e\u30c7\u30fc\u30bf\u3092\u5165\u308c\u63db\u3048\u308b\u3053\u3068\u3067\u4ea4\u53c9\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u8fd1\u508d\u751f\u6210\n\u901a\u5e38\u306eGA\u3067\u306f\u3001\u9078\u629e\u3001\u4ea4\u53c9\u3001\u7a81\u7136\u5909\u7570\u3067\u9032\u5316\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306e\u3088\u3046\u306b\u4ea4\u53c9\u70b9\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5207\u308c\u76ee\u306e\u3068\u3053\u308d\u306b\u9650\u5b9a\u3057\u3066\u3044\u308b\u3068\u3001\u3044\u3064\u306e\u9593\u306b\u304b\u540c\u3058\u500b\u4f53\u3060\u3089\u3051\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u9032\u5316\u304c\u6b62\u307e\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u304b\u3068\u3044\u3063\u3066\u3001\u7a81\u7136\u5909\u7570\u3092\u591a\u304f\u3059\u308b\u3068\u3001\u30e9\u30f3\u30c0\u30e0\u30b5\u30fc\u30c1\u306b\u8fd1\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u3042\u307e\u308a\u52b9\u7387\u304c\u3088\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e00\u90e8\u3092+1\u3001\u3042\u308b\u3044\u306f-1\u3059\u308b\u5909\u5316\u3092\u65bd\u3057\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u8fd1\u508d\u89e3\u3068\u3044\u3046\u3084\u3064\u3067\u3001\u5c40\u6240\u63a2\u7d22\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3088\u304f\u5229\u7528\u3055\u308c\u308b\u3082\u306e\u3067\u3059\u3002\n\n````py\n    #\u8fd1\u508d\u751f\u6210\n    N = 10\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    diff = choice([-1,1], size=N).reshape(N,1)\n    for i in range(N):\n        p = randint(len(Prange))\n        Param[idx[i]][p:p+1] = (Param[idx[i]][p]+diff[i]+len(Prange[p]))%len(Prange[p])\n````\n\n\u4ea4\u53c9\u3068\u540c\u3058\u304f\u8fd1\u508d\u3092\u751f\u6210\u3059\u308b\u500b\u4f53\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u3069\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u5316\u3055\u305b\u308b\u304b\u3092\u307e\u305f\u4e71\u6570\u3067\u6c7a\u3081\u3066\u3001\u305d\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30921\u3060\u3051\u5909\u5316\u3055\u305b\u307e\u3059\u3002\n\n## \u7a81\u7136\u5909\u7570\n\n\u6700\u5f8c\u306b\u7a81\u7136\u5909\u7570\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u3082\u3044\u304f\u3064\u304b\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u9078\u629e\u3057\u305f\u500b\u4f53\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4e00\u90e8\u3092\u65b0\u3057\u304f\u4e71\u6570\u3067\u66f8\u304d\u63db\u3048\u307e\u3059\u3002GA\u306e\u5834\u5408\u3001\u5c40\u6240\u89e3\u304b\u3089\u629c\u3051\u51fa\u3059\u306b\u306f\u3001\u7a81\u7136\u5909\u7570\u304c\u91cd\u8981\u306a\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u3092\u591a\u7528\u3059\u308b\u3068\u30e9\u30f3\u30c0\u30e0\u6027\u304c\u9ad8\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u3053\u3053\u3067\u306f\u3001\uff12\u500b\u7a0b\u5ea6\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n````py\n    #\u7a81\u7136\u5909\u7570\n    N = 2\n    idx = choice(np.arange(1,len(Param)), size=N, replace=False)\n    for i in range(N):\n        p = randint(len(Prange))\n        Param[idx[i]][p:p+1] = randint(len(Prange[p]))\n````\n\n# \u5b9f\u884c\u7d50\u679c\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u305f\u95a2\u6570\u3092\u4f7f\u3063\u3066\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n````py\nresult = Optimize(ohlc, [SlowMAperiod, FastMAperiod, ExitMAperiod])\nresult.sort_values('Profit', ascending=False)\n````\nGA\u3082\u4e71\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7d50\u679c\u306f\u6bce\u56de\u7570\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u7d50\u679c\u306e\u4e00\u4f8b\u3067\u3001\u4e16\u4ee3\u6bce\u306b\u6700\u3082\u9ad8\u3044\u9069\u5fdc\u5ea6\u3092\u793a\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u30a8\u30ea\u30fc\u30c8\u4fdd\u5b58\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u9ad8\u3044\u9069\u5fdc\u5ea6\u306f\u9806\u6b21\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002\n\n````\n1 -94.9\n2 958.2\n3 958.2\n4 958.2\n5 1030.3\n6 1030.3\n7 1030.3\n8 1454.0\n9 1550.9\n10 1550.9\n11 1850.8\n12 1850.8\n13 1850.8\n14 1850.8\n15 1850.8\n16 1850.8\n17 2022.5\n18 2076.5\n19 2076.5\n20 2076.5\n\uff1a\n61 2076.5\n62 2076.5\n63 2076.5\n64 2076.5\n65 2076.5\n66 2316.2\n67 2316.2\n68 2316.2\n69 2316.2\n70 2316.2\n\uff1a\n95 2316.2\n96 2316.2\n97 2316.2\n98 2316.2\n99 2316.2\n100 2316.2\n````\n\n\u6700\u5f8c\u306e\u4e16\u4ee3\u306b\u6b8b\u3063\u305f\u500b\u4f53\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Slow</th>\n      <th>Fast</th>\n      <th>Exit</th>\n      <th>Profit</th>\n      <th>Trades</th>\n      <th>Average</th>\n      <th>PF</th>\n      <th>MDD</th>\n      <th>RF</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>126</td>\n      <td>17</td>\n      <td>107</td>\n      <td>2316.2</td>\n      <td>75.0</td>\n      <td>30.882667</td>\n      <td>2.306889</td>\n      <td>387.1</td>\n      <td>5.983467</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>126</td>\n      <td>15</td>\n      <td>107</td>\n      <td>2316.2</td>\n      <td>75.0</td>\n      <td>30.882667</td>\n      <td>2.306889</td>\n      <td>387.1</td>\n      <td>5.983467</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>105</td>\n      <td>18</td>\n      <td>106</td>\n      <td>2210.2</td>\n      <td>76.0</td>\n      <td>29.081579</td>\n      <td>2.247080</td>\n      <td>387.1</td>\n      <td>5.709636</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>126</td>\n      <td>18</td>\n      <td>108</td>\n      <td>2130.9</td>\n      <td>75.0</td>\n      <td>28.412000</td>\n      <td>2.158098</td>\n      <td>424.9</td>\n      <td>5.015062</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>126</td>\n      <td>18</td>\n      <td>107</td>\n      <td>2078.4</td>\n      <td>79.0</td>\n      <td>26.308861</td>\n      <td>1.980794</td>\n      <td>448.3</td>\n      <td>4.636181</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>127</td>\n      <td>18</td>\n      <td>107</td>\n      <td>2074.5</td>\n      <td>73.0</td>\n      <td>28.417808</td>\n      <td>2.184819</td>\n      <td>371.3</td>\n      <td>5.587126</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>126</td>\n      <td>15</td>\n      <td>7</td>\n      <td>2030.3</td>\n      <td>76.0</td>\n      <td>26.714474</td>\n      <td>2.007143</td>\n      <td>415.7</td>\n      <td>4.884051</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>126</td>\n      <td>14</td>\n      <td>107</td>\n      <td>2024.9</td>\n      <td>76.0</td>\n      <td>26.643421</td>\n      <td>2.100489</td>\n      <td>424.9</td>\n      <td>4.765592</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>126</td>\n      <td>17</td>\n      <td>107</td>\n      <td>1954.7</td>\n      <td>74.0</td>\n      <td>26.414865</td>\n      <td>1.917441</td>\n      <td>448.3</td>\n      <td>4.360250</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>126</td>\n      <td>17</td>\n      <td>105</td>\n      <td>1878.7</td>\n      <td>79.0</td>\n      <td>23.781013</td>\n      <td>1.888694</td>\n      <td>414.2</td>\n      <td>4.535732</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>127</td>\n      <td>18</td>\n      <td>107</td>\n      <td>1872.4</td>\n      <td>75.0</td>\n      <td>24.965333</td>\n      <td>1.878813</td>\n      <td>448.3</td>\n      <td>4.176667</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>126</td>\n      <td>17</td>\n      <td>101</td>\n      <td>1869.6</td>\n      <td>76.0</td>\n      <td>24.600000</td>\n      <td>2.063300</td>\n      <td>420.4</td>\n      <td>4.447193</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>92</td>\n      <td>15</td>\n      <td>107</td>\n      <td>1859.5</td>\n      <td>73.0</td>\n      <td>25.472603</td>\n      <td>2.006223</td>\n      <td>358.8</td>\n      <td>5.182553</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>125</td>\n      <td>14</td>\n      <td>108</td>\n      <td>1843.1</td>\n      <td>84.0</td>\n      <td>21.941667</td>\n      <td>1.811938</td>\n      <td>473.6</td>\n      <td>3.891681</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>124</td>\n      <td>14</td>\n      <td>107</td>\n      <td>1839.8</td>\n      <td>75.0</td>\n      <td>24.530667</td>\n      <td>1.975245</td>\n      <td>420.4</td>\n      <td>4.376308</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>42</td>\n      <td>19</td>\n      <td>107</td>\n      <td>1796.8</td>\n      <td>75.0</td>\n      <td>23.957333</td>\n      <td>1.912405</td>\n      <td>410.7</td>\n      <td>4.374970</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>125</td>\n      <td>15</td>\n      <td>106</td>\n      <td>1614.7</td>\n      <td>81.0</td>\n      <td>19.934568</td>\n      <td>1.711729</td>\n      <td>386.9</td>\n      <td>4.173430</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>104</td>\n      <td>18</td>\n      <td>107</td>\n      <td>1583.7</td>\n      <td>94.0</td>\n      <td>16.847872</td>\n      <td>1.654746</td>\n      <td>393.4</td>\n      <td>4.025674</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>125</td>\n      <td>17</td>\n      <td>106</td>\n      <td>1421.7</td>\n      <td>81.0</td>\n      <td>17.551852</td>\n      <td>1.629015</td>\n      <td>574.4</td>\n      <td>2.475104</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>92</td>\n      <td>16</td>\n      <td>107</td>\n      <td>539.8</td>\n      <td>103.0</td>\n      <td>5.240777</td>\n      <td>1.150513</td>\n      <td>605.1</td>\n      <td>0.892084</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\u3053\u306e\u554f\u984c\u306e\u6700\u9069\u89e3\u306f\u8abf\u3079\u3066\u3044\u306a\u3044\u306e\u3067\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3053\u306e\u7d50\u679c\u306f\u3001\u307e\u3042\u307e\u3042\u9ad8\u3044\u5024\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u3082\u305d\u3082GA\u306e\u76ee\u7684\u306f\u3001\u6700\u9069\u89e3\u3092\u6c42\u3081\u308b\u3053\u3068\u3067\u306f\u306a\u304f\u3001\u7dcf\u5f53\u305f\u308a\u3059\u308b\u3088\u308a\u77ed\u3044\u6642\u9593\u3067\u6e96\u6700\u9069\u89e3\u3092\u6c42\u3081\u308b\u3053\u3068\u3067\u3059\u3002\n\n\u5b9f\u969b\u3001\u30b7\u30b9\u30c8\u30ec\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6700\u9069\u89e3\u3092\u6c42\u3081\u305f\u3068\u3053\u308d\u3067\u3001\u305d\u306e\u30b7\u30b9\u30c6\u30e0\u304c\u5225\u306e\u671f\u9593\u3067\u3082\u540c\u3058\u7d50\u679c\u3092\u51fa\u3059\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u305d\u3046\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001200\u4e07\u901a\u308a\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u4e2d\u304b\u30892000\u56de\u306e\u8a66\u884c\u3067\u307e\u3042\u307e\u3042\u306e\u89e3\u304c\u5f97\u3089\u308c\u305f\u306e\u3067\u3042\u308c\u3070\u3001\u3088\u3057\u3068\u3059\u308b\u3079\u304d\u3067\u3057\u3087\u3046\u3002\n", "tags": ["Python", "FX", "\u30b7\u30b9\u30c8\u30ec", "\u6700\u9069\u5316", "\u907a\u4f1d\u7684\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0"]}