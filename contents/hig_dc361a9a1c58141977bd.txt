{"context": "\u81ea\u5206\u306e\u5c45\u5834\u6240\u3092 OpenWeatherMap \u306b\u6295\u3052\u3066\u76f4\u8fd1\u306e\u5929\u6c17\u4e88\u5831\u3092\u8868\u793a\u3059\u308b\u304f\u305d\u30a2\u30d7\u30ea\u3002\n\n\u30b7\u30f3\u30d7\u30eb\u30a4\u30ba\u30d9\u30b9\u30c8\u3002\n\u5c45\u5834\u6240\u306f\u3001 GeoLocation \u3092\u4f7f\u7528\u3002\n\u5929\u6c17\u4e88\u5831\u306f\u3001 OpenWeatherMap \u304b\u3089\u53d6\u5f97\u3002\n\u5929\u5019\u306f\u3001\u6b21\u306e4\u30bf\u30a4\u30d7\u306e\u307f\u3068\u3057\u305f\u3002 \u6674\u308c\uff0f\u66c7\u308a\uff0f\u96e8\uff0f\u96ea\n\n\n\u3067\u304d\u305f\uff01\n\u25bc Flow \u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n\nOpenWeatherMap \u306e API Key \u306f\u66f8\u304d\u63db\u3048\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\n[{\"id\":\"34c5cf5.5aa2fb\",\"type\":\"http in\",\"z\":\"f582755b.efeaf8\",\"name\":\"request weather app\",\"url\":\"/weather\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":150,\"y\":80,\"wires\":[[\"2d6206d5.b21842\"]]},{\"id\":\"c56f0360.c2cce8\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"html\",\"field\":\"payload\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"mustache\",\"template\":\"<html>\\n    <head>\\n        <link href=\\\"//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css\\\" rel=\\\"stylesheet\\\" />\\n        <script src=\\\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\\\"></script>\\n        <style type=\\\"text/css\\\">\\n            {{{css}}}\\n        </style>\\n        <script type=\\\"text/javascript\\\">\\n            {{{js}}}\\n        </script>\\n    </head>\\n    <body>\\n        <div id=\\\"weather\\\">\\n            <i id=\\\"icon\\\" class=\\\"fa weathericon\\\" aria-hidden=\\\"true\\\"></i>\\n        </div>\\n    </body>\\n</html>\",\"x\":610,\"y\":80,\"wires\":[[\"4708a4b4.ab6014\"]]},{\"id\":\"4708a4b4.ab6014\",\"type\":\"http response\",\"z\":\"f582755b.efeaf8\",\"name\":\"response\",\"x\":760,\"y\":80,\"wires\":[]},{\"id\":\"f089755f.8069c8\",\"type\":\"http in\",\"z\":\"f582755b.efeaf8\",\"name\":\"get weather\",\"url\":\"/get\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":130,\"y\":160,\"wires\":[[\"6ef16af5.167c9c\"]]},{\"id\":\"6ef16af5.167c9c\",\"type\":\"function\",\"z\":\"f582755b.efeaf8\",\"name\":\"make url\",\"func\":\"var lat = msg.payload.lat;\\nvar lon = msg.payload.lon;\\nvar baseurl = \\\"http://api.openweathermap.org/data/2.5/weather\\\";\\nvar appid = \\\"e4157daxxxxxxxxxxxxxxxxxxb9baf14\\\";\\n\\nmsg.url = baseurl + \\\"?lat=\\\" + lat + \\\"&lon=\\\" + lon + \\\"&APPID=\\\" + appid;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":300,\"y\":160,\"wires\":[[\"26258434.060ae4\"]]},{\"id\":\"c473b665.a208e\",\"type\":\"http response\",\"z\":\"f582755b.efeaf8\",\"name\":\"response\",\"x\":880,\"y\":160,\"wires\":[]},{\"id\":\"26258434.060ae4\",\"type\":\"http request\",\"z\":\"f582755b.efeaf8\",\"name\":\"call OpenWeatherMap\",\"method\":\"GET\",\"ret\":\"obj\",\"url\":\"\",\"x\":500,\"y\":160,\"wires\":[[\"2ecd2991.4b7996\"]]},{\"id\":\"2ecd2991.4b7996\",\"type\":\"function\",\"z\":\"f582755b.efeaf8\",\"name\":\"set weather\",\"func\":\"var weather = msg.payload.weather[0].icon.substr(0, 2);\\nvar weatherstring = \\\"\\\";\\nswitch (weather) {\\n    case \\\"01\\\":\\n        weatherstring = \\\"sun\\\";\\n        break;\\n    case \\\"02\\\":\\n    case \\\"03\\\":\\n    case \\\"04\\\":\\n        weatherstring = \\\"cloud\\\";\\n        break;\\n    case \\\"09\\\":\\n    case \\\"10\\\":\\n    case \\\"11\\\":\\n        weatherstring = \\\"rain\\\";\\n        break;\\n    case \\\"13\\\":\\n        weatherstring = \\\"snow\\\";\\n        break;\\n    default:\\n        weatherstring = \\\"cloud\\\";\\n        break;\\n}\\nmsg.payload = weatherstring;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":710,\"y\":160,\"wires\":[[\"c473b665.a208e\"]]},{\"id\":\"2d6206d5.b21842\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"css\",\"field\":\"css\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"plain\",\"template\":\"html, body {\\n    padding: 0;\\n    margin: 0;\\n    height: 100%;\\n    background-color: black;\\n}\\n#weather {\\n    position: relative;\\n    height: 100%;\\n}\\n.weathericon {\\n    font-size: 400px;\\n    display: block;\\n    text-align: center;\\n    position: absolute;\\n    top: 50%;\\n    margin: -200px 0 0 0;\\n    width: 100%;\\n}\\n.cloudy {\\n    color: white;\\n    background-color: #99a3a4;\\n}\\n.rainy {\\n    color: white;\\n    background-color: #85c1e9;\\n}\\n.sunny {\\n    color: white;\\n    background-color: #f39c12;\\n}\\n.snowy {\\n    color: white;\\n    background-color: #e5e8e8;\\n}\",\"x\":330,\"y\":80,\"wires\":[[\"9ec2db8a.eb3238\"]]},{\"id\":\"9ec2db8a.eb3238\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"js\",\"field\":\"js\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"plain\",\"template\":\"$(function(){\\n    var baseurl = \\\"https://nodered-pro2-35hshwv45.herokuapp.com\\\";\\n\\tif( navigator.geolocation ) {\\n\\t\\tnavigator.geolocation.getCurrentPosition(\\n\\t\\t\\tfunction( position ){\\n\\t\\t\\t\\tvar data = position.coords ;\\n\\t\\t\\t\\tvar lat = data.latitude ;\\n\\t\\t\\t\\tvar lon = data.longitude ;\\n\\t\\t\\t\\tconsole.log(lat + \\\",\\\" + lon);\\n                $.ajax({\\n                    type: \\\"GET\\\",\\n                    url: baseurl + '/get?lat=' + lat + '&lon=' + lon,\\n                    dataType: 'text',\\n                    cache: true,\\n                    timeout: 10000\\n                }).done(function(response, textStatus, jqXHR) {\\n                    console.log(response);\\n                    var wt = '';\\n                    var cl = '';\\n                    switch (response) {\\n                        case \\\"sun\\\":\\n                            wt  = 'fa-sun-o sunny';\\n                            cl = 'sunny';\\n                            break;\\n                        case \\\"cloud\\\":\\n                            wt  = 'fa-cloud cloudy';\\n                            cl = 'cloudy';\\n                            break;\\n                        case \\\"rain\\\":\\n                            wt  = 'fa-tint rainy';\\n                            cl = 'rainy';\\n                            break;\\n                        case \\\"snow\\\":\\n                            wt  = 'fa-snowflake-o snowy';\\n                            cl = 'snowy';\\n                            break;\\n                    }\\n                    $(\\\"body\\\").addClass(cl);\\n                    $(\\\"#icon\\\").addClass(wt);\\n                }).fail(function(jqXHR, textStatus, errorThrown ) {\\n                    console.error(\\\"ajax\\\");\\n                });\\n\\t\\t\\t},\\n\\t\\t\\tfunction( error ){\\n\\t\\t\\t    console.error(error.code);\\n\\t\\t\\t} ,\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\\"enableHighAccuracy\\\": false,\\n\\t\\t\\t\\t\\\"timeout\\\": 8000,\\n\\t\\t\\t\\t\\\"maximumAge\\\": 2000,\\n\\t\\t\\t}\\n\\t\\t) ;\\n\\t} else {\\n\\t    console.error('geolocation');\\n\\t};\\n});\\n\",\"x\":470,\"y\":80,\"wires\":[[\"c56f0360.c2cce8\"]]}]\n\n\u25bc \u3053\u3093\u306a Flow\n\nUI \u306e\u6d41\u308c\n\u5929\u6c17\u4e88\u5831API\u306e\u30e9\u30c3\u30d1\u30fcAPI\u7684\u306a\u6d41\u308c\n\n\n\u25bc \u3053\u3093\u306a\u30a2\u30d7\u30ea\n   \n\n\u307e\u305a\u306f\u6e96\u5099\uff08OpenWeatherMap \u306e Key \u3092\u53d6\u5f97\uff09\n\n\nOpenWeatherMap \u306eAPI\u5229\u7528\u306b\u306f\u30e6\u30fc\u30b6\u767b\u9332\u304c\u5fc5\u8981\u3002\n\n\u25bc \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u3002\n\n\u25bc API Key \u306e\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u3001API Key \u3092\u30b2\u30c3\u30c8\u3002\n\n\n\u305d\u3057\u3066 enebular\n\u25bc enebular \u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n\u25bc [ +New Project ] \u30dc\u30bf\u30f3\u3067\u65b0\u898f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3002\n\n\u25bc [ New Flow ] \u30dc\u30bf\u30f3\u3067\u65b0\u898f\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3002\n\n\nUI \u306e Flow \u4f5c\u6210\u3078\n\u25bc http \u30ce\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u3053\u308c\u3067\u30a2\u30d7\u30ea\u306eURL\u304c\u6c7a\u307e\u308b\u3002\n\n\u25bc \u30a2\u30d7\u30ea\u306f\u3053\u3093\u306aURL\u306b\u306a\u308b\nhttps://nodered-pro2-35hshwv45.herokuapp.com/weather\n\u25bc \u30c9\u30e1\u30a4\u30f3\u90e8\u5206\u306f\u30b3\u30b3\uff01\n\n\u25bc template \u30ce\u30fc\u30c9\uff08css\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u4eca\u56de\u306ftemplate\u30ce\u30fc\u30c9\u3092\u3001css\u7528\u3001js\u7528\u3001html\u7528\u306e3\u3064\u306b\u5206\u5272\u3002\n\n\n\ncss\nhtml, body {\n    padding: 0;\n    margin: 0;\n    height: 100%;\n    background-color: black;\n}\n#weather {\n    position: relative;\n    height: 100%;\n}\n.weathericon {\n    font-size: 400px;\n    display: block;\n    text-align: center;\n    position: absolute;\n    top: 50%;\n    margin: -200px 0 0 0;\n    width: 100%;\n}\n.cloudy {\n    color: white;\n    background-color: #99a3a4;\n}\n.rainy {\n    color: white;\n    background-color: #85c1e9;\n}\n.sunny {\n    color: white;\n    background-color: #f39c12;\n}\n.snowy {\n    color: white;\n    background-color: #e5e8e8;\n}\n\n\n\u25bc template \u30ce\u30fc\u30c9\uff08js\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nhtml\u7528\u306e\u30ce\u30fc\u30c9\u3067jquery\u8aad\u307f\u8fbc\u3093\u3067\u308b\u306e\u3067\u3001jquery\u3067\u66f8\u304f\u3002\u3053\u306ejs\u306fhtml\u306b\u5c55\u958b\u3055\u308c\u308b\u3002\nnavigator.geolocation \u3067\u3001\u73fe\u5728\u4f4d\u7f6e\u3092\u53d6\u5f97\u3002\n\u53d6\u5f97\u3057\u305f\u4f4d\u7f6e\u60c5\u5831\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u304f\u3063\u3064\u3051\u3066\u5929\u6c17\u4e88\u5831API\u3092\u30b3\u30fc\u30eb\u3002\n\n\n\njs\n$(function(){\n    var baseurl = \"https://nodered-pro2-35hshwv45.herokuapp.com\";\n    if( navigator.geolocation ) {\n        navigator.geolocation.getCurrentPosition(\n            function( position ){\n                var data = position.coords ;\n                var lat = data.latitude ;\n                var lon = data.longitude ;\n                console.log(lat + \",\" + lon);\n                $.ajax({\n                    type: \"GET\",\n                    url: baseurl + '/get?lat=' + lat + '&lon=' + lon,\n                    dataType: 'text',\n                    cache: true,\n                    timeout: 10000\n                }).done(function(response, textStatus, jqXHR) {\n                    console.log(response);\n                    var wt = '';\n                    var cl = '';\n                    switch (response) {\n                        case \"sun\":\n                            wt  = 'fa-sun-o sunny';\n                            cl = 'sunny';\n                            break;\n                        case \"cloud\":\n                            wt  = 'fa-cloud cloudy';\n                            cl = 'cloudy';\n                            break;\n                        case \"rain\":\n                            wt  = 'fa-tint rainy';\n                            cl = 'rainy';\n                            break;\n                        case \"snow\":\n                            wt  = 'fa-snowflake-o snowy';\n                            cl = 'snowy';\n                            break;\n                    }\n                    $(\"body\").addClass(cl);\n                    $(\"#icon\").addClass(wt);\n                }).fail(function(jqXHR, textStatus, errorThrown ) {\n                    console.error(\"ajax\");\n                });\n            },\n            function( error ){\n                console.error(error.code);\n            } ,\n            {\n                \"enableHighAccuracy\": false,\n                \"timeout\": 8000,\n                \"maximumAge\": 2000,\n            }\n        ) ;\n    } else {\n        console.error('geolocation');\n    };\n});\n\n\n\u25bc template \u30ce\u30fc\u30c9\uff08HTML\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u77e2\u5370\u306e\u90e8\u5206\u306e\u62ec\u5f27\u306b\u6ce8\u610f\u3002\n\ncss\u3068js\u3092\u5c55\u958b\u3059\u308b\u3068\u3053\u3060\u3051\u6ce8\u610f\u3002\n\n\n\nhtml\n<!DOCTYPE html>\n<html lang=\"ja\">\n    <head>\n        <meta charset=\"utf-8\" />\n        <link href=\"//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css\" rel=\"stylesheet\" />\n        <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n        <style type=\"text/css\">\n            {{{css}}}\n        </style>\n        <script type=\"text/javascript\">\n            {{{js}}}\n        </script>\n    </head>\n    <body>\n        <div id=\"weather\">\n            <i id=\"icon\" class=\"fa weathericon\" aria-hidden=\"true\"></i>\n        </div>\n    </body>\n</html>\n\n\n\u25bc http request \u30ce\u30fc\u30c9\uff08response\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\n\u5929\u6c17\u4e88\u5831 API \u3092\u547c\u3073\u51fa\u3059 API \u306e\u30d5\u30ed\u30fc\u3002\n\u25bc API \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ce\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08make url\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nhttp in \u30ce\u30fc\u30c9\u3067\u53d7\u3051\u53d6\u3063\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u51e6\u7406\u3002\nOpenWeatherMap \u3092\u30b3\u30fc\u30eb\u3059\u308bURL\u306e\u4f5c\u6210\u3002\n\n\n\njs\nvar lat = msg.payload.lat;\nvar lon = msg.payload.lon;\nvar baseurl = \"http://api.openweathermap.org/data/2.5/weather\";\nvar appid = \"e4157daxxxxxxxxxxxxxxxxxxb9baf14\";\n\nmsg.url = baseurl + \"?lat=\" + lat + \"&lon=\" + lon + \"&APPID=\" + appid;\nreturn msg;\n\n\n\u25bc http request \u30ce\u30fc\u30c9\uff08make url\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08set weather\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u5929\u6c17\u30924\u30d1\u30bf\u30fc\u30f3\u306b\u96c6\u7d04\u3002\n\n\n\njs\nvar weather = msg.payload.weather[0].icon.substr(0, 2);\nvar weatherstring = \"\";\nswitch (weather) {\n    case \"01\":\n        weatherstring = \"sun\";\n        break;\n    case \"02\":\n    case \"03\":\n    case \"04\":\n        weatherstring = \"cloud\";\n        break;\n    case \"09\":\n    case \"10\":\n    case \"11\":\n        weatherstring = \"rain\";\n        break;\n    case \"13\":\n        weatherstring = \"snow\";\n        break;\n    default:\n        weatherstring = \"cloud\";\n        break;\n}\nmsg.payload = weatherstring;\nreturn msg;\n\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08response\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\u4ee5\u4e0a\n\u81ea\u5206\u306e\u5c45\u5834\u6240\u3092 OpenWeatherMap \u306b\u6295\u3052\u3066\u76f4\u8fd1\u306e\u5929\u6c17\u4e88\u5831\u3092\u8868\u793a\u3059\u308b~~\u304f\u305d~~\u30a2\u30d7\u30ea\u3002\n\n* \u30b7\u30f3\u30d7\u30eb\u30a4\u30ba\u30d9\u30b9\u30c8\u3002\n* \u5c45\u5834\u6240\u306f\u3001 GeoLocation \u3092\u4f7f\u7528\u3002\n* \u5929\u6c17\u4e88\u5831\u306f\u3001 OpenWeatherMap \u304b\u3089\u53d6\u5f97\u3002\n* \u5929\u5019\u306f\u3001\u6b21\u306e4\u30bf\u30a4\u30d7\u306e\u307f\u3068\u3057\u305f\u3002 \u6674\u308c\uff0f\u66c7\u308a\uff0f\u96e8\uff0f\u96ea\n\n## \u3067\u304d\u305f\uff01\n\n\u25bc Flow \u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\n\n* OpenWeatherMap \u306e API Key \u306f\u66f8\u304d\u63db\u3048\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\n```flow\n[{\"id\":\"34c5cf5.5aa2fb\",\"type\":\"http in\",\"z\":\"f582755b.efeaf8\",\"name\":\"request weather app\",\"url\":\"/weather\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":150,\"y\":80,\"wires\":[[\"2d6206d5.b21842\"]]},{\"id\":\"c56f0360.c2cce8\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"html\",\"field\":\"payload\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"mustache\",\"template\":\"<html>\\n    <head>\\n        <link href=\\\"//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css\\\" rel=\\\"stylesheet\\\" />\\n        <script src=\\\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\\\"></script>\\n        <style type=\\\"text/css\\\">\\n            {{{css}}}\\n        </style>\\n        <script type=\\\"text/javascript\\\">\\n            {{{js}}}\\n        </script>\\n    </head>\\n    <body>\\n        <div id=\\\"weather\\\">\\n            <i id=\\\"icon\\\" class=\\\"fa weathericon\\\" aria-hidden=\\\"true\\\"></i>\\n        </div>\\n    </body>\\n</html>\",\"x\":610,\"y\":80,\"wires\":[[\"4708a4b4.ab6014\"]]},{\"id\":\"4708a4b4.ab6014\",\"type\":\"http response\",\"z\":\"f582755b.efeaf8\",\"name\":\"response\",\"x\":760,\"y\":80,\"wires\":[]},{\"id\":\"f089755f.8069c8\",\"type\":\"http in\",\"z\":\"f582755b.efeaf8\",\"name\":\"get weather\",\"url\":\"/get\",\"method\":\"get\",\"swaggerDoc\":\"\",\"x\":130,\"y\":160,\"wires\":[[\"6ef16af5.167c9c\"]]},{\"id\":\"6ef16af5.167c9c\",\"type\":\"function\",\"z\":\"f582755b.efeaf8\",\"name\":\"make url\",\"func\":\"var lat = msg.payload.lat;\\nvar lon = msg.payload.lon;\\nvar baseurl = \\\"http://api.openweathermap.org/data/2.5/weather\\\";\\nvar appid = \\\"e4157daxxxxxxxxxxxxxxxxxxb9baf14\\\";\\n\\nmsg.url = baseurl + \\\"?lat=\\\" + lat + \\\"&lon=\\\" + lon + \\\"&APPID=\\\" + appid;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":300,\"y\":160,\"wires\":[[\"26258434.060ae4\"]]},{\"id\":\"c473b665.a208e\",\"type\":\"http response\",\"z\":\"f582755b.efeaf8\",\"name\":\"response\",\"x\":880,\"y\":160,\"wires\":[]},{\"id\":\"26258434.060ae4\",\"type\":\"http request\",\"z\":\"f582755b.efeaf8\",\"name\":\"call OpenWeatherMap\",\"method\":\"GET\",\"ret\":\"obj\",\"url\":\"\",\"x\":500,\"y\":160,\"wires\":[[\"2ecd2991.4b7996\"]]},{\"id\":\"2ecd2991.4b7996\",\"type\":\"function\",\"z\":\"f582755b.efeaf8\",\"name\":\"set weather\",\"func\":\"var weather = msg.payload.weather[0].icon.substr(0, 2);\\nvar weatherstring = \\\"\\\";\\nswitch (weather) {\\n    case \\\"01\\\":\\n        weatherstring = \\\"sun\\\";\\n        break;\\n    case \\\"02\\\":\\n    case \\\"03\\\":\\n    case \\\"04\\\":\\n        weatherstring = \\\"cloud\\\";\\n        break;\\n    case \\\"09\\\":\\n    case \\\"10\\\":\\n    case \\\"11\\\":\\n        weatherstring = \\\"rain\\\";\\n        break;\\n    case \\\"13\\\":\\n        weatherstring = \\\"snow\\\";\\n        break;\\n    default:\\n        weatherstring = \\\"cloud\\\";\\n        break;\\n}\\nmsg.payload = weatherstring;\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":710,\"y\":160,\"wires\":[[\"c473b665.a208e\"]]},{\"id\":\"2d6206d5.b21842\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"css\",\"field\":\"css\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"plain\",\"template\":\"html, body {\\n    padding: 0;\\n    margin: 0;\\n    height: 100%;\\n    background-color: black;\\n}\\n#weather {\\n    position: relative;\\n    height: 100%;\\n}\\n.weathericon {\\n    font-size: 400px;\\n    display: block;\\n    text-align: center;\\n    position: absolute;\\n    top: 50%;\\n    margin: -200px 0 0 0;\\n    width: 100%;\\n}\\n.cloudy {\\n    color: white;\\n    background-color: #99a3a4;\\n}\\n.rainy {\\n    color: white;\\n    background-color: #85c1e9;\\n}\\n.sunny {\\n    color: white;\\n    background-color: #f39c12;\\n}\\n.snowy {\\n    color: white;\\n    background-color: #e5e8e8;\\n}\",\"x\":330,\"y\":80,\"wires\":[[\"9ec2db8a.eb3238\"]]},{\"id\":\"9ec2db8a.eb3238\",\"type\":\"template\",\"z\":\"f582755b.efeaf8\",\"name\":\"js\",\"field\":\"js\",\"fieldType\":\"msg\",\"format\":\"handlebars\",\"syntax\":\"plain\",\"template\":\"$(function(){\\n    var baseurl = \\\"https://nodered-pro2-35hshwv45.herokuapp.com\\\";\\n\\tif( navigator.geolocation ) {\\n\\t\\tnavigator.geolocation.getCurrentPosition(\\n\\t\\t\\tfunction( position ){\\n\\t\\t\\t\\tvar data = position.coords ;\\n\\t\\t\\t\\tvar lat = data.latitude ;\\n\\t\\t\\t\\tvar lon = data.longitude ;\\n\\t\\t\\t\\tconsole.log(lat + \\\",\\\" + lon);\\n                $.ajax({\\n                    type: \\\"GET\\\",\\n                    url: baseurl + '/get?lat=' + lat + '&lon=' + lon,\\n                    dataType: 'text',\\n                    cache: true,\\n                    timeout: 10000\\n                }).done(function(response, textStatus, jqXHR) {\\n                    console.log(response);\\n                    var wt = '';\\n                    var cl = '';\\n                    switch (response) {\\n                        case \\\"sun\\\":\\n                            wt  = 'fa-sun-o sunny';\\n                            cl = 'sunny';\\n                            break;\\n                        case \\\"cloud\\\":\\n                            wt  = 'fa-cloud cloudy';\\n                            cl = 'cloudy';\\n                            break;\\n                        case \\\"rain\\\":\\n                            wt  = 'fa-tint rainy';\\n                            cl = 'rainy';\\n                            break;\\n                        case \\\"snow\\\":\\n                            wt  = 'fa-snowflake-o snowy';\\n                            cl = 'snowy';\\n                            break;\\n                    }\\n                    $(\\\"body\\\").addClass(cl);\\n                    $(\\\"#icon\\\").addClass(wt);\\n                }).fail(function(jqXHR, textStatus, errorThrown ) {\\n                    console.error(\\\"ajax\\\");\\n                });\\n\\t\\t\\t},\\n\\t\\t\\tfunction( error ){\\n\\t\\t\\t    console.error(error.code);\\n\\t\\t\\t} ,\\n\\t\\t\\t{\\n\\t\\t\\t\\t\\\"enableHighAccuracy\\\": false,\\n\\t\\t\\t\\t\\\"timeout\\\": 8000,\\n\\t\\t\\t\\t\\\"maximumAge\\\": 2000,\\n\\t\\t\\t}\\n\\t\\t) ;\\n\\t} else {\\n\\t    console.error('geolocation');\\n\\t};\\n});\\n\",\"x\":470,\"y\":80,\"wires\":[[\"c56f0360.c2cce8\"]]}]\n```\n\n\u25bc \u3053\u3093\u306a Flow\n\n* UI \u306e\u6d41\u308c\n* \u5929\u6c17\u4e88\u5831API\u306e\u30e9\u30c3\u30d1\u30fcAPI\u7684\u306a\u6d41\u308c\n\n![01-flow.png](https://qiita-image-store.s3.amazonaws.com/0/47512/af257a38-bd80-5c82-ae15-9885e6d69e34.png)\n\n\u25bc \u3053\u3093\u306a\u30a2\u30d7\u30ea\n\n![iphone-sun.png](https://qiita-image-store.s3.amazonaws.com/0/47512/84eb59aa-b220-fb86-1267-dfec68f2ca9c.png) ![iphone-cloud.png](https://qiita-image-store.s3.amazonaws.com/0/47512/b041e5da-6b78-20ae-7a9d-2ce750376882.png) ![iphone-rain.png](https://qiita-image-store.s3.amazonaws.com/0/47512/87e890f0-c39e-338e-f651-6a5f4816c8bd.png) \n\n## \u307e\u305a\u306f\u6e96\u5099\uff08OpenWeatherMap \u306e Key \u3092\u53d6\u5f97\uff09\n\n* [OpenWeatherMap](https://home.openweathermap.org/) \u306eAPI\u5229\u7528\u306b\u306f\u30e6\u30fc\u30b6\u767b\u9332\u304c\u5fc5\u8981\u3002\n\n\u25bc [\u30b5\u30a4\u30f3\u30a2\u30c3\u30d7](https://home.openweathermap.org/users/sign_up)\u3002\n\n![03-openweathermap-signup.png](https://qiita-image-store.s3.amazonaws.com/0/47512/358937d2-60f7-f9d2-6764-8a0c2a95750b.png)\n\n\u25bc [API Key](https://home.openweathermap.org/api_keys) \u306e\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u3001API Key \u3092\u30b2\u30c3\u30c8\u3002\n\n![04-openweathermap-apikey.png](https://qiita-image-store.s3.amazonaws.com/0/47512/0c05d8d5-bd1f-9cd5-c725-8d05fb12c53d.png)\n\n## \u305d\u3057\u3066 enebular\n\n\u25bc [enebular](http://enebular.com/) \u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n![05-enebular-signin.png](https://qiita-image-store.s3.amazonaws.com/0/47512/7c6385f8-d171-8bb9-c0a4-d668f8e36398.png)\n\n\u25bc [ +New Project ] \u30dc\u30bf\u30f3\u3067\u65b0\u898f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3002\n\n![06-enebular-newproject.png](https://qiita-image-store.s3.amazonaws.com/0/47512/2f5ef2b7-a0d7-3a24-0373-1e479b9022b2.png)\n\n\u25bc [ New Flow ] \u30dc\u30bf\u30f3\u3067\u65b0\u898f\u30d5\u30ed\u30fc\u3092\u4f5c\u6210\u3002\n\n![07-enebular-newflow.png](https://qiita-image-store.s3.amazonaws.com/0/47512/f84dab30-d5b7-2287-d251-99223631a405.png)\n\n## UI \u306e Flow \u4f5c\u6210\u3078\n\n\u25bc http \u30ce\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u3053\u308c\u3067\u30a2\u30d7\u30ea\u306eURL\u304c\u6c7a\u307e\u308b\u3002\n\n![08-httpnode.png](https://qiita-image-store.s3.amazonaws.com/0/47512/fd129154-b25f-0445-41d8-e4c4e112ac9e.png)\n\n\u25bc \u30a2\u30d7\u30ea\u306f\u3053\u3093\u306aURL\u306b\u306a\u308b\n\nhttps://nodered-pro2-35hshwv45.herokuapp.com/weather\n\n\u25bc \u30c9\u30e1\u30a4\u30f3\u90e8\u5206\u306f\u30b3\u30b3\uff01\n\n![08-01-i.png](https://qiita-image-store.s3.amazonaws.com/0/47512/30661b72-6c6c-5355-7ee2-161072e260ae.png)\n\n\u25bc template \u30ce\u30fc\u30c9\uff08css\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n* \u4eca\u56de\u306ftemplate\u30ce\u30fc\u30c9\u3092\u3001css\u7528\u3001js\u7528\u3001html\u7528\u306e3\u3064\u306b\u5206\u5272\u3002\n\n![09-cssnode.png](https://qiita-image-store.s3.amazonaws.com/0/47512/ab8f1948-9f1c-7272-77b5-a4320ac1853d.png)\n\n```css:css\nhtml, body {\n    padding: 0;\n    margin: 0;\n    height: 100%;\n    background-color: black;\n}\n#weather {\n    position: relative;\n    height: 100%;\n}\n.weathericon {\n    font-size: 400px;\n    display: block;\n    text-align: center;\n    position: absolute;\n    top: 50%;\n    margin: -200px 0 0 0;\n    width: 100%;\n}\n.cloudy {\n    color: white;\n    background-color: #99a3a4;\n}\n.rainy {\n    color: white;\n    background-color: #85c1e9;\n}\n.sunny {\n    color: white;\n    background-color: #f39c12;\n}\n.snowy {\n    color: white;\n    background-color: #e5e8e8;\n}\n```\n\n\u25bc template \u30ce\u30fc\u30c9\uff08js\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n* html\u7528\u306e\u30ce\u30fc\u30c9\u3067jquery\u8aad\u307f\u8fbc\u3093\u3067\u308b\u306e\u3067\u3001jquery\u3067\u66f8\u304f\u3002\u3053\u306ejs\u306fhtml\u306b\u5c55\u958b\u3055\u308c\u308b\u3002\n* navigator.geolocation \u3067\u3001\u73fe\u5728\u4f4d\u7f6e\u3092\u53d6\u5f97\u3002\n* \u53d6\u5f97\u3057\u305f\u4f4d\u7f6e\u60c5\u5831\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u304f\u3063\u3064\u3051\u3066\u5929\u6c17\u4e88\u5831API\u3092\u30b3\u30fc\u30eb\u3002\n\n![10-jsnode.png](https://qiita-image-store.s3.amazonaws.com/0/47512/4e2b06b2-f0ba-cb47-10ce-0f509ebe5225.png)\n\n```js:js\n$(function(){\n    var baseurl = \"https://nodered-pro2-35hshwv45.herokuapp.com\";\n\tif( navigator.geolocation ) {\n\t\tnavigator.geolocation.getCurrentPosition(\n\t\t\tfunction( position ){\n\t\t\t\tvar data = position.coords ;\n\t\t\t\tvar lat = data.latitude ;\n\t\t\t\tvar lon = data.longitude ;\n\t\t\t\tconsole.log(lat + \",\" + lon);\n                $.ajax({\n                    type: \"GET\",\n                    url: baseurl + '/get?lat=' + lat + '&lon=' + lon,\n                    dataType: 'text',\n                    cache: true,\n                    timeout: 10000\n                }).done(function(response, textStatus, jqXHR) {\n                    console.log(response);\n                    var wt = '';\n                    var cl = '';\n                    switch (response) {\n                        case \"sun\":\n                            wt  = 'fa-sun-o sunny';\n                            cl = 'sunny';\n                            break;\n                        case \"cloud\":\n                            wt  = 'fa-cloud cloudy';\n                            cl = 'cloudy';\n                            break;\n                        case \"rain\":\n                            wt  = 'fa-tint rainy';\n                            cl = 'rainy';\n                            break;\n                        case \"snow\":\n                            wt  = 'fa-snowflake-o snowy';\n                            cl = 'snowy';\n                            break;\n                    }\n                    $(\"body\").addClass(cl);\n                    $(\"#icon\").addClass(wt);\n                }).fail(function(jqXHR, textStatus, errorThrown ) {\n                    console.error(\"ajax\");\n                });\n\t\t\t},\n\t\t\tfunction( error ){\n\t\t\t    console.error(error.code);\n\t\t\t} ,\n\t\t\t{\n\t\t\t\t\"enableHighAccuracy\": false,\n\t\t\t\t\"timeout\": 8000,\n\t\t\t\t\"maximumAge\": 2000,\n\t\t\t}\n\t\t) ;\n\t} else {\n\t    console.error('geolocation');\n\t};\n});\n```\n\n\u25bc template \u30ce\u30fc\u30c9\uff08HTML\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\u77e2\u5370\u306e\u90e8\u5206\u306e\u62ec\u5f27\u306b\u6ce8\u610f\u3002\n\n* css\u3068js\u3092\u5c55\u958b\u3059\u308b\u3068\u3053\u3060\u3051\u6ce8\u610f\u3002\n\n![12-htmlnode.png](https://qiita-image-store.s3.amazonaws.com/0/47512/7d6ecad8-5dac-7104-bb5b-cca0711c00e2.png)\n\n~~~ html:html\n<!DOCTYPE html>\n<html lang=\"ja\">\n    <head>\n        <meta charset=\"utf-8\" />\n        <link href=\"//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css\" rel=\"stylesheet\" />\n        <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n        <style type=\"text/css\">\n            {{{css}}}\n        </style>\n        <script type=\"text/javascript\">\n            {{{js}}}\n        </script>\n    </head>\n    <body>\n        <div id=\"weather\">\n            <i id=\"icon\" class=\"fa weathericon\" aria-hidden=\"true\"></i>\n        </div>\n    </body>\n</html>\n~~~\n\n\u25bc http request \u30ce\u30fc\u30c9\uff08response\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![13-httpresponse.png](https://qiita-image-store.s3.amazonaws.com/0/47512/c7d248fb-16c6-b131-405d-1277dc9c4169.png)\n\n## \u5929\u6c17\u4e88\u5831 API \u3092\u547c\u3073\u51fa\u3059 API \u306e\u30d5\u30ed\u30fc\u3002\n\n\u25bc API \u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ce\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![14-getweather.png](https://qiita-image-store.s3.amazonaws.com/0/47512/26dd152e-986d-7c1f-cd90-42603ccddebb.png)\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08make url\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n* http in \u30ce\u30fc\u30c9\u3067\u53d7\u3051\u53d6\u3063\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u51e6\u7406\u3002\n* OpenWeatherMap \u3092\u30b3\u30fc\u30eb\u3059\u308bURL\u306e\u4f5c\u6210\u3002\n\n![15-makeurl.png](https://qiita-image-store.s3.amazonaws.com/0/47512/0461c14d-ad82-ca14-fe42-6fae7197b2ef.png)\n\n~~~ js:js\nvar lat = msg.payload.lat;\nvar lon = msg.payload.lon;\nvar baseurl = \"http://api.openweathermap.org/data/2.5/weather\";\nvar appid = \"e4157daxxxxxxxxxxxxxxxxxxb9baf14\";\n\nmsg.url = baseurl + \"?lat=\" + lat + \"&lon=\" + lon + \"&APPID=\" + appid;\nreturn msg;\n~~~\n\n\u25bc http request \u30ce\u30fc\u30c9\uff08make url\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![16-call.png](https://qiita-image-store.s3.amazonaws.com/0/47512/a10d0bb1-dc5a-32f3-d5b7-f4096e39e439.png)\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08set weather\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n* \u5929\u6c17\u30924\u30d1\u30bf\u30fc\u30f3\u306b\u96c6\u7d04\u3002\n\n![17-setweather.png](https://qiita-image-store.s3.amazonaws.com/0/47512/f7ced2a3-19c8-619c-e3b1-c57c34dea71c.png)\n\n~~~ js:js\nvar weather = msg.payload.weather[0].icon.substr(0, 2);\nvar weatherstring = \"\";\nswitch (weather) {\n    case \"01\":\n        weatherstring = \"sun\";\n        break;\n    case \"02\":\n    case \"03\":\n    case \"04\":\n        weatherstring = \"cloud\";\n        break;\n    case \"09\":\n    case \"10\":\n    case \"11\":\n        weatherstring = \"rain\";\n        break;\n    case \"13\":\n        weatherstring = \"snow\";\n        break;\n    default:\n        weatherstring = \"cloud\";\n        break;\n}\nmsg.payload = weatherstring;\nreturn msg;\n~~~\n\n\u25bc Function \u30ce\u30fc\u30c9\uff08response\uff09\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![18-response.png](https://qiita-image-store.s3.amazonaws.com/0/47512/92c791d2-994d-820a-348a-6a678dd9074c.png)\n\n\n\u4ee5\u4e0a\n", "tags": ["enebular"]}