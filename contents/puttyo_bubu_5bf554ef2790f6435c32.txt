{"tags": ["php-fpm", "nginx", "PHP"], "context": " More than 1 year has passed since last update.\n\ncentos\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n# cat /etc/redhat-release\nCentOS release 6.5 (Final)\n\n\nnginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0f\u30da\u30fc\u30b8\uff1a\u516c\u5f0f\u30da\u30fc\u30b8\n\nnginx\u306e\u305f\u3081\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u767b\u9332\n# rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n\nhttp://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm \u3092\u53d6\u5f97\u4e2d\n\u8b66\u544a: /var/tmp/rpm-tmp.96TgxU: \u30d8\u30c3\u30c0 V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:nginx-release-centos   ########################################### [100%]\n\n\n/etc/yum.repos.d\u306bnginx.repo\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install nginx\n\n# nginx -v\n\u3000\u3000nginx version: nginx/1.6.0\n\n\nnginx\u3067basic\u8a8d\u8a3c\u3092\u8a2d\u5b9a\u3059\u308b\n\u25a0\u53c2\u8003\nhttp://heartbeats.jp/hbblog/2012/02/nginx03.html\n htpasswd -cm .htpasswd username\n\n\nnginx.conf\u306e\u8a2d\u5b9a\n\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u306f/etc/nginx/nginx.cong\u306b\u8a18\u8f09\u3059\u308b\u3002\n\u4eca\u56de\u306e\u30b5\u30fc\u30d0\u8a2d\u5b9a\u306f/etc/nginx/conf.d\u306b\u500b\u5225\u306b\u304a\u304f\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306a\u3069\u306f\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u306e\u3067\u3001\n\u30dd\u30fc\u30c8\u306e\u307f\u5909\u66f4\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n/usr/share/nginx/html\u914d\u4e0b\u306eindex.html(nginx\u306ewelcome\u30da\u30fc\u30b8)\n\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3002\n\u3064\u304e\u30fc\u3002\n\nphp\u3001 php-fpm, mysql\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u308c\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3060\u3063\u305f\n#yum list installed | grep php\n\nphp-cli.x86_64          5.3.3-27.el6_5  @updates\nphp-common.x86_64       5.3.3-27.el6_5  @updates\nphp-domxml-php4-php5.noarch\nphp-jsonlint.noarch     1.1.2-1.el6     @epel\nphp-mcrypt.x86_64       5.3.3-3.el6     @epel\nphp-pdo.x86_64          5.3.3-27.el6_5  @updates\nphp-pear.noarch         1:1.9.4-4.el6   @base\nphp-xml.x86_64          5.3.3-27.el6_5  @updates\n\n\u5ff5\u306e\u305f\u3081\u4e00\u65e6\u5168\u90e8\u524a\u9664\nyum remove 'php-*'\n\n\u6d88\u3048\u305f\u3002\u6016\u3044\u3002\n\nremi \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\nrpm --import http://rpms.famillecollet.com/RPM-GPG-KEY-remi\nvim /etc/yum.repos.d/remi.repo\n\nremi\u306e\u8a2d\u5b9a\u3092\u65b0\u898f\u3067\u8ffd\u52a0\u3059\u308b\n/etc/yum.repos.d/remi.repo\n[remi]\nname=Les RPM de remi pour Enterprise Linux 5 - $basearch\nbaseurl=http://rpms.famillecollet.com/el5.$basearch/\nhttp://iut-info.univ-reims.fr/remirpms/el5.$basearch/\nenabled=0\npriority=1\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff08\u3044\u3064\u304b\u30bd\u30fc\u30b9\u304b\u3089\u3057\u3066\u307f\u305f\u3044)\nyum --enablerepo=remi install mysql mysql-server  php php-fpm php-devel php-cli php-xml php-mysql php-mbstring php-gd\n\n\u7d9a\u3044\u3066php-fpm\u306e\u8a2d\u5b9a\n\nphp-fpm\u306e\u8a2d\u5b9a\n/etc/php-fpm.d/www.conf\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u8d77\u52d5\u30e6\u30fc\u30b6\u3092nginx\u306b\u3059\u308b\nuser = nginx\ngroup = nginx\n\n\n\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3092\u5909\u66f4\nlisten = 127.0.0.1:9050\n\n\nnetstat -tapon\u3067\u78ba\u8a8d\ntcp        0      0 127.0.0.1:9050              0.0.0.0:*                   LISTEN      1402/php-fpm        off (0.00/0/0)\n\n\u304a\u304a\u3001\u3044\u3051\u3066\u308b\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u306bindex.php\u3092\u7f6e\u3044\u3066\n\nindex.php\n<?php\nphpinfo();\n\n\nhttp://XXXX/index.php\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n\u30a8\u30e9\u30fc\u3002\nnginx\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3002\npass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n\u3068\u3044\u3046\u30b3\u30e1\u30f3\u30c8\u914d\u4e0b\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u307f\u308b\u3002\n    location ~ \\.php$ {\n        root           html;\n        fastcgi_pass   127.0.0.1:9050;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n\n\u30a8\u30e9\uff0d\u3002\u306a\u305c\u306b\u3002\n\u30ed\u30b0\u3092\u898b\u308b\u3002\n\nnginx/error.log\nFastCGI sent in stderr: \"Primary script unknown\" while reading response header from upstream\n\n\n\u53c2\u8003URL\uff1ahttp://tonby.sakura.ne.jp/?p=953\n\u53c2\u8003URL\uff1ahttp://nginx.org/ja/docs/http/request_processing.html\nroot\u3068fastcgi_param\u306e\u8a2d\u5b9a\u304c\u60aa\u304b\u3063\u305f\u307f\u305f\u3044\u3002\nfastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\u3068\u306a\u3063\u3066\u3044\u305f\u304c\u3001\n/scripts\u30d5\u30a9\u30eb\u30c0\u306a\u3093\u3066\u306a\u3044\uff57\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u306e.php\u3092\u307f\u3066\u307b\u3057\u3044\u306e\u3067\u3001\nfastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;\n\u306b\u5909\u66f4\u3002\u518d\u5ea6\u30a2\u30af\u30bb\u30b9\u3002\u30a8\u30e9\u30fc\u3002\u306a\u3093\u3067\u3058\u3083\u3044\u3002\n\u4eca\u5ea6\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u304c\u60aa\u3044\u307f\u305f\u3044\u3002\nlocation / {}\u306b\u3066root\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u306e\u3067\u3001\nlocation ~ \\.php$ {}\u306b\u3066\u3001$document_root\u3092\u53c2\u7167\u3067\u304d\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u9055\u3063\u305f\u3002\n\u8a66\u3057\u306b\u30ed\u30b0\u306b$document_root\u3092\u5410\u304f\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3089\u3001/etc/nginx/html\u3068\u5410\u304b\u308c\u3066\u3044\u305f\u3002\n\u3053\u308c\u306f\u610f\u56f3\u3057\u306a\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3002\n\u5404\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u53c2\u7167\u3059\u308b\u305f\u3081\u306e$documnt_root\u306fserver{}\u76f4\u4e0b\u3067\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3002\n\u3088\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3002\n\nnginx.confg\nserver {\n   root   /usr/share/nginx/html;\n\n   location ~ \\.php$ {\n        #root           $document_root;\n        fastcgi_pass   127.0.0.1:9050;\n        fastcgi_index  index.php;\n        #fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}\n\n\n\u3084\u3063\u3068phpInfo\u304c\u307f\u308c\u305f\uff57\n\u4eca\u65e5\u306f\u3053\u3053\u307e\u3067\u3002\u6b21\u306f\u3001mysql\u3092\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u308b\u3002\n\n##centos\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n# cat /etc/redhat-release\nCentOS release 6.5 (Final)\n```\n\n##nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0f\u30da\u30fc\u30b8\uff1a\u516c\u5f0f\u30da\u30fc\u30b8\n\n###nginx\u306e\u305f\u3081\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u767b\u9332\n\n```\n# rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n\nhttp://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm \u3092\u53d6\u5f97\u4e2d\n\u8b66\u544a: /var/tmp/rpm-tmp.96TgxU: \u30d8\u30c3\u30c0 V4 RSA/SHA1 Signature, key ID 7bd9bf62: NOKEY\n\u6e96\u5099\u4e2d...                ########################################### [100%]\n   1:nginx-release-centos   ########################################### [100%]\n\n```\n\n`/etc/yum.repos.d`\u306bnginx.repo\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n###\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# yum install nginx\n```\n\n\n```\u30d0\u30fc\u30b8\u30e7\u30f3\n# nginx -v\n\u3000\u3000nginx version: nginx/1.6.0\n```\n\n## nginx\u3067basic\u8a8d\u8a3c\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u25a0\u53c2\u8003\nhttp://heartbeats.jp/hbblog/2012/02/nginx03.html\n\n```\n htpasswd -cm .htpasswd username\n````\n\n\n##nginx.conf\u306e\u8a2d\u5b9a\n\u57fa\u672c\u7684\u306a\u8a2d\u5b9a\u306f`/etc/nginx/nginx.cong`\u306b\u8a18\u8f09\u3059\u308b\u3002\n\u4eca\u56de\u306e\u30b5\u30fc\u30d0\u8a2d\u5b9a\u306f`/etc/nginx/conf.d`\u306b\u500b\u5225\u306b\u304a\u304f\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306a\u3069\u306f\u8a2d\u5b9a\u3057\u3066\u3042\u308b\u306e\u3067\u3001\n\u30dd\u30fc\u30c8\u306e\u307f\u5909\u66f4\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n/usr/share/nginx/html\u914d\u4e0b\u306eindex.html(nginx\u306ewelcome\u30da\u30fc\u30b8)\n\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3002\n\n\u3064\u304e\u30fc\u3002\n\n##php\u3001 php-fpm, mysql\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3053\u308c\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3060\u3063\u305f\n\n```\n#yum list installed | grep php\n\nphp-cli.x86_64          5.3.3-27.el6_5  @updates\nphp-common.x86_64       5.3.3-27.el6_5  @updates\nphp-domxml-php4-php5.noarch\nphp-jsonlint.noarch     1.1.2-1.el6     @epel\nphp-mcrypt.x86_64       5.3.3-3.el6     @epel\nphp-pdo.x86_64          5.3.3-27.el6_5  @updates\nphp-pear.noarch         1:1.9.4-4.el6   @base\nphp-xml.x86_64          5.3.3-27.el6_5  @updates\n```\n\n\u5ff5\u306e\u305f\u3081\u4e00\u65e6\u5168\u90e8\u524a\u9664\n\n```\nyum remove 'php-*'\n```\n\n\u6d88\u3048\u305f\u3002\u6016\u3044\u3002\n\n##remi \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\n```\nrpm --import http://rpms.famillecollet.com/RPM-GPG-KEY-remi\nvim /etc/yum.repos.d/remi.repo\n```\n\nremi\u306e\u8a2d\u5b9a\u3092\u65b0\u898f\u3067\u8ffd\u52a0\u3059\u308b\n\n```\n/etc/yum.repos.d/remi.repo\n[remi]\nname=Les RPM de remi pour Enterprise Linux 5 - $basearch\nbaseurl=http://rpms.famillecollet.com/el5.$basearch/\nhttp://iut-info.univ-reims.fr/remirpms/el5.$basearch/\nenabled=0\npriority=1\n\n```\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff08\u3044\u3064\u304b\u30bd\u30fc\u30b9\u304b\u3089\u3057\u3066\u307f\u305f\u3044)\n```\nyum --enablerepo=remi install mysql mysql-server  php php-fpm php-devel php-cli php-xml php-mysql php-mbstring php-gd\n```\n\n\u7d9a\u3044\u3066php-fpm\u306e\u8a2d\u5b9a\n\n##php-fpm\u306e\u8a2d\u5b9a\n\n/etc/php-fpm.d/www.conf\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n###\u8d77\u52d5\u30e6\u30fc\u30b6\u3092nginx\u306b\u3059\u308b\n\n```\nuser = nginx\ngroup = nginx\n```\n\n###\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3092\u5909\u66f4\n\n```\nlisten = 127.0.0.1:9050\n```\n\n###netstat -tapon\u3067\u78ba\u8a8d\n\n```\ntcp        0      0 127.0.0.1:9050              0.0.0.0:*                   LISTEN      1402/php-fpm        off (0.00/0/0)\n```\n\n\u304a\u304a\u3001\u3044\u3051\u3066\u308b\u3002\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u306bindex.php\u3092\u7f6e\u3044\u3066\n\n```index.php\n<?php\nphpinfo();\n```\n\nhttp://XXXX/index.php\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n\u30a8\u30e9\u30fc\u3002\nnginx\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3002\n`pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000`\n\u3068\u3044\u3046\u30b3\u30e1\u30f3\u30c8\u914d\u4e0b\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u307f\u308b\u3002\n\n```\n    location ~ \\.php$ {\n        root           html;\n        fastcgi_pass   127.0.0.1:9050;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n```\n\n\u30a8\u30e9\uff0d\u3002\u306a\u305c\u306b\u3002\n\u30ed\u30b0\u3092\u898b\u308b\u3002\n\n```nginx/error.log\nFastCGI sent in stderr: \"Primary script unknown\" while reading response header from upstream\n```\n\n\u53c2\u8003URL\uff1ahttp://tonby.sakura.ne.jp/?p=953\n\u53c2\u8003URL\uff1ahttp://nginx.org/ja/docs/http/request_processing.html\n\nroot\u3068fastcgi_param\u306e\u8a2d\u5b9a\u304c\u60aa\u304b\u3063\u305f\u307f\u305f\u3044\u3002\n\n`fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;`\u3068\u306a\u3063\u3066\u3044\u305f\u304c\u3001\n/scripts\u30d5\u30a9\u30eb\u30c0\u306a\u3093\u3066\u306a\u3044\uff57\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u914d\u4e0b\u306e.php\u3092\u307f\u3066\u307b\u3057\u3044\u306e\u3067\u3001\n`fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;`\n\u306b\u5909\u66f4\u3002\u518d\u5ea6\u30a2\u30af\u30bb\u30b9\u3002\u30a8\u30e9\u30fc\u3002\u306a\u3093\u3067\u3058\u3083\u3044\u3002\n\n\u4eca\u5ea6\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u304c\u60aa\u3044\u307f\u305f\u3044\u3002\n\n`location / {}`\u306b\u3066root\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u306e\u3067\u3001\n`location ~ \\.php$ {}`\u306b\u3066\u3001$document_root\u3092\u53c2\u7167\u3067\u304d\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u304c\u9055\u3063\u305f\u3002\n\u8a66\u3057\u306b\u30ed\u30b0\u306b`$document_root`\u3092\u5410\u304f\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3089\u3001`/etc/nginx/html`\u3068\u5410\u304b\u308c\u3066\u3044\u305f\u3002\n\u3053\u308c\u306f\u610f\u56f3\u3057\u306a\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3002\n\n\u5404\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u53c2\u7167\u3059\u308b\u305f\u3081\u306e$documnt_root\u306fserver{}\u76f4\u4e0b\u3067\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3002\n\u3088\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3002\n\n\n```nginx.confg\nserver {\n   root   /usr/share/nginx/html;\n   \n   location ~ \\.php$ {\n        #root           $document_root;\n        fastcgi_pass   127.0.0.1:9050;\n        fastcgi_index  index.php;\n        #fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n        fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}\n```\n\n\u3084\u3063\u3068phpInfo\u304c\u307f\u308c\u305f\uff57\n\u4eca\u65e5\u306f\u3053\u3053\u307e\u3067\u3002\u6b21\u306f\u3001mysql\u3092\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u308b\u3002\n"}