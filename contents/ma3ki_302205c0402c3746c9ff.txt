{"context": " More than 1 year has passed since last update.zabbix-agent\u3067ssl\u306e\u8a3c\u660e\u66f8\u306e\u6709\u52b9\u671f\u9650\u3092\u76e3\u8996\u3059\u308b\u305f\u3081\u3001\nUserParameter\u306b\u6b8b\u308a\u65e5\u6570\u3092\u51fa\u529b\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n2015/10/22 \u66f4\u65b0\nUserParameter \u306b -servername $1 \u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\nZabbix\u3067SSL\u8a3c\u660e\u66f8\u306e\u6709\u52b9\u671f\u9650\u76e3\u8996(\uff11\u3064\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u8907\u6570\u306e\u30db\u30b9\u30c8\u304c\u3042\u308b\u3068\u304d)\n\nZabbix\u306e\u30a2\u30a4\u30c6\u30e0\u8a2d\u5b9a\n\u30bf\u30a4\u30d7: Zabbix\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\n\u30ad\u30fc: cert_expire_check[host,port,timeout]\n\u30c7\u30fc\u30bf\u578b: \u6570\u5024(\u6574\u6570)\n\nhost: \u63a5\u7d9a\u5148\u30db\u30b9\u30c8\u540d\nport: \u63a5\u7d9a\u5148\u30dd\u30fc\u30c8\u540d\ntimeout: openssl\u30b3\u30de\u30f3\u30c9\u3067\u63a5\u7d9a\u3059\u308b\u6642\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u79d2\n\u203b3\u9805\u76ee\u3068\u3082\u8a2d\u5b9a\u5fc5\u9808\n\n\nzabbix-agentd.conf\u3078\u306e\u8a2d\u5b9a\u8ffd\u52a0\n\nzabbix-agentd.conf\nTimeout=10\nUserParameter=cert_expire_check[*],export UTIME=$(date +%s); expr $(( $(date --date \"$(timeout $3 openssl s_client -connect $1:$2 -servername $1 < /dev/null 2>/dev/null| openssl x509 -text 2>/dev/null | awk -v UTIME=$UTIME '/Not After :/{if($$0~/N/){print $$4,$$5,$$6,$$7,$$8}else{print \"@\"UTIME}}')\" +%s) - $UTIME )) / 86400\n\n\n\n\nzabbix_get\u3067\u30c6\u30b9\u30c8\n\nzabbix_get\n\u6b63\u5e38\u7cfb\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,443,5]\n14\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,465,5]\n14\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[mail.yahoo.co.jp,443,5]\n129\n\n\u63a5\u7d9a\u3067\u304d\u306a\u3044\u5834\u5408\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,80,5]\n0\n\n\u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(zabbix-agent\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306b\u5148\u306b\u5f15\u3063\u304b\u304b\u3063\u305f\u5834\u5408)\n# /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[yahoo.co.jp,443,10]\nZBX_NOTSUPPORTED: Timeout while executing a shell script.\n\n\u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(5\u79d2\u4ee5\u5185\u306b\u63a5\u7d9a\u5148\u306e\u5fdc\u7b54\u304c\u306a\u3044\u5834\u5408)\n# /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[yahoo.co.jp,443,5]\n0\n\n\u30a8\u30e9\u30fc\u306f0\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n\nzabbix-agent\u3067ssl\u306e\u8a3c\u660e\u66f8\u306e\u6709\u52b9\u671f\u9650\u3092\u76e3\u8996\u3059\u308b\u305f\u3081\u3001\nUserParameter\u306b\u6b8b\u308a\u65e5\u6570\u3092\u51fa\u529b\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n##2015/10/22 \u66f4\u65b0\nUserParameter \u306b -servername $1 \u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n [Zabbix\u3067SSL\u8a3c\u660e\u66f8\u306e\u6709\u52b9\u671f\u9650\u76e3\u8996(\uff11\u3064\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u8907\u6570\u306e\u30db\u30b9\u30c8\u304c\u3042\u308b\u3068\u304d)](http://qiita.com/manabuishiirb/items/e958dab61bcde1d788c7#comment-44b33481b95bfee11298)\n\n##Zabbix\u306e\u30a2\u30a4\u30c6\u30e0\u8a2d\u5b9a\n```\n\u30bf\u30a4\u30d7: Zabbix\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\n\u30ad\u30fc: cert_expire_check[host,port,timeout]\n\u30c7\u30fc\u30bf\u578b: \u6570\u5024(\u6574\u6570)\n\nhost: \u63a5\u7d9a\u5148\u30db\u30b9\u30c8\u540d\nport: \u63a5\u7d9a\u5148\u30dd\u30fc\u30c8\u540d\ntimeout: openssl\u30b3\u30de\u30f3\u30c9\u3067\u63a5\u7d9a\u3059\u308b\u6642\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u79d2\n\u203b3\u9805\u76ee\u3068\u3082\u8a2d\u5b9a\u5fc5\u9808\n```\n\n##zabbix-agentd.conf\u3078\u306e\u8a2d\u5b9a\u8ffd\u52a0\n```conf:zabbix-agentd.conf\nTimeout=10\nUserParameter=cert_expire_check[*],export UTIME=$(date +%s); expr $(( $(date --date \"$(timeout $3 openssl s_client -connect $1:$2 -servername $1 < /dev/null 2>/dev/null| openssl x509 -text 2>/dev/null | awk -v UTIME=$UTIME '/Not After :/{if($$0~/N/){print $$4,$$5,$$6,$$7,$$8}else{print \"@\"UTIME}}')\" +%s) - $UTIME )) / 86400\n\n```\n##zabbix_get\u3067\u30c6\u30b9\u30c8\n```test:zabbix_get\n\u6b63\u5e38\u7cfb\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,443,5]\n14\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,465,5]\n14\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[mail.yahoo.co.jp,443,5]\n129\n\n\u63a5\u7d9a\u3067\u304d\u306a\u3044\u5834\u5408\n$ /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[ma3ki.net,80,5]\n0\n\n\u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(zabbix-agent\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306b\u5148\u306b\u5f15\u3063\u304b\u304b\u3063\u305f\u5834\u5408)\n# /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[yahoo.co.jp,443,10]\nZBX_NOTSUPPORTED: Timeout while executing a shell script.\n\n\u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8(5\u79d2\u4ee5\u5185\u306b\u63a5\u7d9a\u5148\u306e\u5fdc\u7b54\u304c\u306a\u3044\u5834\u5408)\n# /usr/local/zabbix/bin/zabbix_get -s localhost -k cert_expire_check[yahoo.co.jp,443,5]\n0\n\n\u30a8\u30e9\u30fc\u306f0\u3092\u8fd4\u3057\u307e\u3059\u3002\n```\n", "tags": ["zabbix"]}