{"context": " More than 1 year has passed since last update.\u524d\u56de\u306b\u5f15\u304d\u7d9a\u304dredshift\u3092\u8a66\u3057\u305f\u30e1\u30e2\u3067\u3059\u3002\n\n1000\u4e07\u884c\u306e\u30c7\u30fc\u30bf\u306eImport\u3084Select\u306a\u3069\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u3092Import\u3057\u3066\u307f\u307e\u3059\u3002\n\u524d\u56de\u3068\u306e\u9055\u3044\u306f\u3001response \u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u591a\u5c11\u5927\u304d\u3081\u306e\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3057\u3066\u3001\uff11\u30ec\u30b3\u30fc\u30c9\u5f53\u305f\u308a\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u3053\u3068\u3067\u3059\u3002\n\ntype: varchar(32)\npoint: int\nresponse: varchar(65535)  # 65535 \u304c MAX\nevent_datetime: datetime\n\n\nDDL\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\nCreate Table sample2 (\n  type VARCHAR(32) ENCODE TEXT255,\n  point INT,\n  response VARCHAR(65535),\n  event_datetime TIMESTAMP\n)\nDISTSTYLE EVEN\nSORTKEY (event_datetime);\n\n\nImport\u3059\u308b\u30c7\u30fc\u30bf\u3092\u9069\u5f53\u306b\u4f5c\u308a\u307e\u3059\n\nmake_data2.rb\n# coding: utf-8\n\nnum = ARGV.shift.to_i\nDELI = \"\\001\"\n\nTYPES = [\"cat\", \"dog\", \"cow\", \"horse\"]\n\nnum.times do |i|\n  type = TYPES[i % TYPES.size]\n  point = Random.rand(10) + 1\n  response = (Random.rand(63)+33).chr * (Random.rand(2000) + 800)\n  dt = Time.now.utc\n  puts [type, point, response, dt].join(DELI)\nend\n\n\n\n1\u4e07\u884c\u306e\u30c7\u30fc\u30bf\u30921000\u500b\u4f5c\u3063\u3066S3\u306bUpload\u3059\u308b\nfor i in {000..999};do; ruby make_data2.rb 10000 | gzip > files/sample2.data.${i}.gz;done \ns3cmd put files/sample2.data.* s3://BUCKET/redshift/sample2/   \n\nFile\u30b5\u30a4\u30ba\u306f\u5408\u8a0879MB\u7a0b(gzip\u5f8c)\u3002\n\nImport \u3084 Select \u306e\u5b9f\u884c\u6642\u9593\n\u203b\u3061\u306a\u307f\u306bQuery\u306e\u5b9f\u884c\u6642\u9593\u306fRedshift\u306eWeb\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\u306eQueries*\u30bf\u30d6\u304b\u3089\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002*\nCOPY sample2\nFROM 's3://BUCKET/redshift/sample2/sample2.data'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=****;aws_secret_access_key=****'\n;\n\u2192 \u7d04520\u79d2\n\nmydb=# select count(*) from sample2;\n  count   \n----------\n 10000000\n(1 \u884c)\n\u2192 2.34\u79d2\n\nmydb=# select type, count(*) from sample2 group by type;\n type  |  count  \n-------+---------\n dog   | 2500000\n cat   | 2500000\n cow   | 2500000\n horse | 2500000\n(4 \u884c)\n\u2192 5.54\u79d2\n\n\nDISK\u4f7f\u7528\u91cf\nPerformance\u30bf\u30d6\u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001\u300cPercentage of Disk Space Used\u300d \u304c 0.83% \u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n2TB \u00d7 0.0083 \u2252 16GB\n\n\u3067\u3059\u3002\n\u4eca\u56de\u306e\uff11\u30ec\u30b3\u30fc\u30c9\u5f53\u305f\u308a\u7d042000B\u5f31\u304b\u306a\u3001\u3068\u3044\u3046\u611f\u3058\u306a\u306e\u3067\u3001\n2000B \u00d7 1\u5343\u4e07\u30ec\u30b3\u30fc\u30c9(10M\u30ec\u30b3\u30fc\u30c9) -> 20GB\n\n\u3068\u306a\u308a\u3001\u8aac\u660e\u304c\u3064\u304d\u305d\u3046\u306a\u30b5\u30a4\u30ba\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nImport\u901f\u5ea6\u3068\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3084\u6570\u306e\u95a2\u4fc2\uff1f\n\u5148\u307b\u3069\u306e\u30d5\u30a1\u30a4\u30eb\u306f\uff11\u3064\u5f53\u305f\u308a79KB\u3068\u5c0f\u3055\u3081\u3060\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u305f\u65b9\u304cImport\u306b\u304b\u304b\u308b\u5b9f\u884c\u6642\u9593\u304c\u77ed\u304f\u306a\u308b\u304b\u306a\u3068\u601d\u3063\u3066\u3082\u3046\u4e00\u5ea6\u691c\u8a3c\u3002\u4eca\u5ea6\u306f\u3001100\u4e07\u884c\u309210\u500b\u3067\u8a66\u3057\u3066\u307f\u308b\uff08\uff11\u30d5\u30a1\u30a4\u30eb\u5f53\u305f\u308a\u7d047.9MB\uff09\u3002\nfor i in {0..9};do; gzip -dc files/sample2.data.${i}* | gzip > files2/sample2b.data.${i}.gz; done\ns3cmd put files2/sample2b.data.* s3://BUCKET/redshift/sample2b/   \n\nCOPY sample2\nFROM 's3://BUCKET/redshift/sample2b/sample2b.data'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=***********;aws_secret_access_key=***********'\n;\n-> 458\u79d2\n\n\u3053\u306e\u6642\u306f62\u79d2\u7a0b\u77ed\u304b\u304f\u306a\u308a\u307e\u3057\u305f\uff08\u3067\u3082\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3057\u305f\u3089\u9045\u304b\u3063\u305f\u306e\u3067\u8aa4\u5dee\u306e\u7bc4\u56f2\u306e\u3088\u3046\u3067\u3059\uff09\u3002\nSelect\u306e\u901f\u5ea6\u306f\u5909\u308f\u3063\u305f\u304b\u306a\uff1f\nmydb=# select type, count(*) from sample2 group by type;\n type  |  count  \n-------+---------\n dog   | 5000000\n cat   | 5000000\n cow   | 5000000\n horse | 5000000\n(4 \u884c)\n-> 1.62\u79d2\n\n\u3053\u306e\u7a0b\u5ea6\u3067\u306f\u5f71\u97ff\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\n\u3082\u3046\u4e00\u5ea6\u30011\u4e07\u884c\u00d7\uff11\uff10\uff10\uff10\u30d5\u30a1\u30a4\u30eb\u3092Import\u3057\u3066\u307f\u308b\u3002\n\n\u2192 474\u79d2 \uff08\u5148\u7a0b\u306f520\u79d2\uff09\n\n\n\n\u3082\u3046\u4e00\u5ea6\u3001100\u4e07\u884c\u00d710File\u3092Import\u3057\u3066\u307f\u308b\u3002\n\n\u2192 521\u79d2 \uff08\u5148\u7a0b\u306f458\u79d2\uff09\n\n\n\n\n[\u524d\u56de](http://qiita.com/items/871927e15d0cbe01c5e4)\u306b\u5f15\u304d\u7d9a\u304dredshift\u3092\u8a66\u3057\u305f\u30e1\u30e2\u3067\u3059\u3002\n\n1000\u4e07\u884c\u306e\u30c7\u30fc\u30bf\u306eImport\u3084Select\u306a\u3069\n--------------\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u3092Import\u3057\u3066\u307f\u307e\u3059\u3002\n\u524d\u56de\u3068\u306e\u9055\u3044\u306f\u3001**response** \u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u591a\u5c11\u5927\u304d\u3081\u306e\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3057\u3066\u3001\uff11\u30ec\u30b3\u30fc\u30c9\u5f53\u305f\u308a\u306e\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3044\u3053\u3068\u3067\u3059\u3002\n\n* type: varchar(32)\n* point: int\n* response: varchar(65535)  # 65535 \u304c MAX\n* event_datetime: datetime  \n\n\nDDL\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n```sql\nCreate Table sample2 (\n  type VARCHAR(32) ENCODE TEXT255,\n  point INT,\n  response VARCHAR(65535),\n  event_datetime TIMESTAMP\n)\nDISTSTYLE EVEN\nSORTKEY (event_datetime);\n```\n\n### Import\u3059\u308b\u30c7\u30fc\u30bf\u3092\u9069\u5f53\u306b\u4f5c\u308a\u307e\u3059\n\n```make_data2.rb\n# coding: utf-8\n\nnum = ARGV.shift.to_i\nDELI = \"\\001\"\n\nTYPES = [\"cat\", \"dog\", \"cow\", \"horse\"]\n\nnum.times do |i|\n  type = TYPES[i % TYPES.size]\n  point = Random.rand(10) + 1\n  response = (Random.rand(63)+33).chr * (Random.rand(2000) + 800)\n  dt = Time.now.utc\n  puts [type, point, response, dt].join(DELI)\nend\n```\n\n\n### 1\u4e07\u884c\u306e\u30c7\u30fc\u30bf\u30921000\u500b\u4f5c\u3063\u3066S3\u306bUpload\u3059\u308b\n\n```zsh\nfor i in {000..999};do; ruby make_data2.rb 10000 | gzip > files/sample2.data.${i}.gz;done \ns3cmd put files/sample2.data.* s3://BUCKET/redshift/sample2/   \n```\n\nFile\u30b5\u30a4\u30ba\u306f\u5408\u8a0879MB\u7a0b(gzip\u5f8c)\u3002\n\n### Import \u3084 Select \u306e\u5b9f\u884c\u6642\u9593\n*\u203b\u3061\u306a\u307f\u306bQuery\u306e\u5b9f\u884c\u6642\u9593\u306fRedshift\u306eWeb\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\u306e*Queries*\u30bf\u30d6\u304b\u3089\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002*\n\n```sql\nCOPY sample2\nFROM 's3://BUCKET/redshift/sample2/sample2.data'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=****;aws_secret_access_key=****'\n;\n\u2192 \u7d04520\u79d2\n\nmydb=# select count(*) from sample2;\n  count   \n----------\n 10000000\n(1 \u884c)\n\u2192 2.34\u79d2\n\nmydb=# select type, count(*) from sample2 group by type;\n type  |  count  \n-------+---------\n dog   | 2500000\n cat   | 2500000\n cow   | 2500000\n horse | 2500000\n(4 \u884c)\n\u2192 5.54\u79d2\n```\n\n### DISK\u4f7f\u7528\u91cf\n\n**Performance**\u30bf\u30d6\u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001*\u300cPercentage of Disk Space Used\u300d* \u304c **0.83%** \u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\t2TB \u00d7 0.0083 \u2252 16GB\n\n\u3067\u3059\u3002\n\n\u4eca\u56de\u306e\uff11\u30ec\u30b3\u30fc\u30c9\u5f53\u305f\u308a\u7d042000B\u5f31\u304b\u306a\u3001\u3068\u3044\u3046\u611f\u3058\u306a\u306e\u3067\u3001\n\n\t2000B \u00d7 1\u5343\u4e07\u30ec\u30b3\u30fc\u30c9(10M\u30ec\u30b3\u30fc\u30c9) -> 20GB\n\n\u3068\u306a\u308a\u3001\u8aac\u660e\u304c\u3064\u304d\u305d\u3046\u306a\u30b5\u30a4\u30ba\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\nImport\u901f\u5ea6\u3068\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3084\u6570\u306e\u95a2\u4fc2\uff1f\n-------\n\n\u5148\u307b\u3069\u306e\u30d5\u30a1\u30a4\u30eb\u306f\uff11\u3064\u5f53\u305f\u308a79KB\u3068\u5c0f\u3055\u3081\u3060\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u305f\u65b9\u304cImport\u306b\u304b\u304b\u308b\u5b9f\u884c\u6642\u9593\u304c\u77ed\u304f\u306a\u308b\u304b\u306a\u3068\u601d\u3063\u3066\u3082\u3046\u4e00\u5ea6\u691c\u8a3c\u3002\u4eca\u5ea6\u306f\u3001100\u4e07\u884c\u309210\u500b\u3067\u8a66\u3057\u3066\u307f\u308b\uff08\uff11\u30d5\u30a1\u30a4\u30eb\u5f53\u305f\u308a\u7d047.9MB\uff09\u3002\n\n```zsh\nfor i in {0..9};do; gzip -dc files/sample2.data.${i}* | gzip > files2/sample2b.data.${i}.gz; done\ns3cmd put files2/sample2b.data.* s3://BUCKET/redshift/sample2b/   \n```\n\n```sql\nCOPY sample2\nFROM 's3://BUCKET/redshift/sample2b/sample2b.data'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=***********;aws_secret_access_key=***********'\n;\n-> 458\u79d2\n```\n\n\u3053\u306e\u6642\u306f62\u79d2\u7a0b\u77ed\u304b\u304f\u306a\u308a\u307e\u3057\u305f\uff08\u3067\u3082\u3001\u3082\u3046\u4e00\u5ea6\u5b9f\u884c\u3057\u305f\u3089\u9045\u304b\u3063\u305f\u306e\u3067\u8aa4\u5dee\u306e\u7bc4\u56f2\u306e\u3088\u3046\u3067\u3059\uff09\u3002\n\n\nSelect\u306e\u901f\u5ea6\u306f\u5909\u308f\u3063\u305f\u304b\u306a\uff1f\n\n```sql\nmydb=# select type, count(*) from sample2 group by type;\n type  |  count  \n-------+---------\n dog   | 5000000\n cat   | 5000000\n cow   | 5000000\n horse | 5000000\n(4 \u884c)\n-> 1.62\u79d2\n```\n\u3053\u306e\u7a0b\u5ea6\u3067\u306f\u5f71\u97ff\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n* \u3082\u3046\u4e00\u5ea6\u30011\u4e07\u884c\u00d7\uff11\uff10\uff10\uff10\u30d5\u30a1\u30a4\u30eb\u3092Import\u3057\u3066\u307f\u308b\u3002\n\t* \u2192 474\u79d2 \uff08\u5148\u7a0b\u306f520\u79d2\uff09\n\n* \u3082\u3046\u4e00\u5ea6\u3001100\u4e07\u884c\u00d710File\u3092Import\u3057\u3066\u307f\u308b\u3002\n\t* \u2192 521\u79d2 \uff08\u5148\u7a0b\u306f458\u79d2\uff09\n\n\n", "tags": ["redshift"]}