{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u500b\u4eba\u7684\u306a\u8da3\u5473\u3067\u3001\u5404\u97f3\u697d\u30ec\u30fc\u30d9\u30eb\u304c\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3\u7528\u306b\u516c\u958b\u3057\u3066\u3044\u308b\u97f3\u697d (Bandcamp, SoundCloud, Vimeo, YouTube \u306a\u3069\u306b\u6563\u3089\u3070\u3063\u3066\u3044\u308b) \u3092\u4e00\u5143\u7ba1\u7406\u3059\u308b\u30a2\u30d7\u30ea\u3092 Yii2 \u3067\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\u3067\u3001\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u30a2\u30d7\u30ea\u306e\u4e00\u90e8\u5206\u3092\u3088\u308a\u30b7\u30f3\u30d7\u30eb\u306b\u3057\u305f\u5f62\u3067\u66f8\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u308f\u308a\u3068\u3054\u3061\u3083\u3054\u3061\u3083\u3057\u3066\u3057\u307e\u3046\u304b\u3082\u3067\u3059\u304c\u3001Yii2 \u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u6d41\u308c\u3092\u5c11\u3057\u3067\u3082\u611f\u3058\u53d6\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u3053\u306e\u30a2\u30d7\u30ea\u3067\u3067\u304d\u308b\u3053\u3068\n\n\u66f2\u306e URL \u3092\u30e6\u30fc\u30b6\u304c\u5165\u529b\u3059\u308b\u3068\u3001\u81ea\u52d5\u7684\u306b\u66f2\u306e\u60c5\u5831\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3059\u308b\n\u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3057\u3066\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af(\u30bf\u30c3\u30d7)\u3059\u308b\u3068\u66f2\u304c\u518d\u751f\u3055\u308c\u308b\n\n\n\u4f7f\u3063\u305f\u3082\u306e\n\nPHP 5.6.16\nMySQL 5.7.9\nYii Framework 2.0.7-dev\njamband/ripple 0.1.5\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nComposer \u3067 Yii2 \u306a\u3069\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n(Composer \u3084 composer asset plugin \u306a\u3069\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u516c\u5f0f\u30ac\u30a4\u30c9\u306e Yii \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b \u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044)\ncd /path/to/somewhere\ncomposer create-project --prefer-dist yiisoft/yii2-app-basic basic\ncd ./basic\n\n\u3067\u3001\u4eca\u56de\u306f Yii \u306e 2.0.7 \u4ee5\u964d\u306e\u6a5f\u80fd\u3082\u5c11\u3057\u4f7f\u3044\u305f\u3044\u306e\u3067 yiisoft/yii2 \u3092 dev-master \u306b\u3057\u3066\u3001\u3064\u3044\u3067\u306b jamband/ripple \u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n( jamband/ripple \u306f URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u4f7f\u3044\u307e\u3059 )\n\ncomposer.json\n{\n    \"require\": {\n        \"yiisoft/yii2\": \"dev-master\",\n        \"jamband/ripple\": \"*\",\n}\n\n\ncomposer update\n\nyii2basic \u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210:\n( \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306f\u4efb\u610f\u306e\u3082\u306e\u3067\u304b\u307e\u308f\u306a\u3044 )\nmysql.server start\nmysql --login-path=xxxxxxx\nmysql> CREATE DATABASE yii2basic;\n\n\u30a2\u30d7\u30ea\u5074\u3067 DB \u306e\u8a2d\u5b9a\u3092\u3059\u308b:\n( \u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b )\n\nconfig/db.php\nreturn [\n    'class' => 'yii\\db\\Connection',\n    'dsn' => 'mysql:host=localhost;dbname=yii2basic',\n    'username' => 'xxxxxxx',\n    'password' => 'xxxxxxx',\n    'charset' => 'utf8',\n];\n\n\ntrack \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210:\n( \u66f2\u306e\u60c5\u5831\u3092\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u633f\u5165\u3057\u3066\u3044\u304d\u307e\u3059 )\n./yii migrate/create create_track --fields=url:string:notNull,title:string:notNull,image:string:notNull,provider_name:string:notNull,provider_key:string:notNull\n\n\u4e0a\u8a18\u306e\u3084\u308a\u65b9\u306f Yii 2.0.7 \u4ee5\u964d\u3067\u4f7f\u3048\u308b\u3084\u308a\u65b9\u3067\u3059 (\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3) \u3002\n\u5404\u30ab\u30e9\u30e0\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058:\n\nurl: \u66f2\u306e URL\ntitle: \u66f2\u306e\u30bf\u30a4\u30c8\u30eb\nimage: \u66f2\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\nprovider_name: \u66f2\u3092\u63d0\u4f9b\u5143 (Bandcamp, SoundCloud, Vimeo, YouTube \u306e\u3044\u305a\u308c\u304b)\nprovider_key: \u66f2\u306e ID\n\n\u9069\u7528\u3057\u307e\u3059:\n./yii migrate\n\nPHP \u30d3\u30eb\u30c8\u30a4\u30f3\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u3092\u8d77\u52d5:\nphp -S localhost:8080 -t /path/to/basic/web\n\n\u30d6\u30e9\u30a6\u30b6\u3067 localhost:8080 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\u300cCongratulations!\u300d\u3068\u51fa\u308c\u3070 OK \u3067\u3059\u3002\u3042\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f URL \u304c\u82e5\u5e72\u6c5a\u3044\u306e\u3067\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3067\u7dba\u9e97\u306b\u3057\u3066\u304a\u304d\u307e\u3059:\n\nconfig/web.php\n'components' => [\n    // ...\n    'urlManager' => [\n        'enablePrettyUrl' => true,\n        'showScriptName' => false,\n    ],\n\n\n\u3053\u308c\u3067\u6e96\u5099\u306f\u5b8c\u4e86 :)\n\nTrack \u30e2\u30c7\u30eb\u306e\u4f5c\u6210\n\n\nhttp://localhost:8080/gii \u306b\u30a2\u30af\u30bb\u30b9\u3057 Model Generator \u306e Start \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\nTable Name \u306b t \u3068\u5165\u529b\u3057\u5019\u88dc\u306e track \u3092\u30af\u30ea\u30c3\u30af\n\u30bf\u30d6\u3067 Model Class \u306b\u79fb\u52d5\u3057\u3001\u81ea\u52d5\u3067 Track \u3068\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\nGenerate Relations \u306e\u30c1\u30a7\u30c3\u30af\u3092\u5916\u3059\nPreview \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057 Generate \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067 Track \u30e2\u30c7\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\nTrack \u30e2\u30c7\u30eb\u306e\u4e2d\u8eab\u3092\u66f8\u3044\u3066\u3044\u304f\nTrack \u30e2\u30c7\u30eb\u3067\u306f\u3001URL \u304b\u3089\u81ea\u52d5\u7684\u306b\u66f2\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30b3\u30fc\u30c9\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\u65b0\u305f\u306b\u4f5c\u308b\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b:\n\nmodels/Track.php\npublic function setContents(\\Goutte\\Client $client) {\n    // URL \u304b\u3089\u81ea\u52d5\u3067 title, image, provider_name, provider_key \u3092\u53d6\u5f97\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n}\npublic function validateUrl($attribute, $params) {\n    // URL \u304c\u66f2\u306e URL \u3068\u3057\u3066\u6b63\u3057\u3044\u3082\u306e\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\n    // \u6b63\u3057\u304f\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8ffd\u52a0\u3059\u308b\n}\npublic function validateContent($attribute, $params) {\n    // URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\n    // \u53d6\u5f97\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8ffd\u52a0\u3059\u308b\n}\n\n\n\u307e\u305a\u306f Track::setContents() \u304b\u3089:\n\nmodels/Track.php\nuse jamband\\ripple\\Ripple;\nuse Goutte\\Client;\n\nclass Track extends \\yii\\db\\ActiveRecord\n{\n    /**\n     * @param Client $client\n     * @return Track\n     */\n    public function setContents(Client $client)\n    {\n        $ripple = new Ripple($this->url);\n        if ($ripple->isValidUrl()) {\n            $ripple->request($client);\n\n            if ($this->title === '') {\n                $this->title = $ripple->title();\n            }\n            $this->image = $ripple->image();\n            $this->provider_name = $ripple->provider();\n            $this->provider_key = $ripple->id();\n        }\n        return $this;\n    }\n\n\nURL \u3092 Ripple \u306b\u98df\u308f\u305b\u3066\u3001\u305d\u308c\u304c\u6b63\u3057\u3044 URL \u306a\u3089\u3070\u66f2\u306e\u60c5\u5831\u3092\u81ea\u52d5\u53d6\u5f97\u3057\u3066\u3001\u5404\u30ab\u30e9\u30e0\u306b\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\u611f\u3058\u3067\u3059\u3002\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb:\n\nmodels/Track.php\npublic function rules()\n{\n    return [\n        [['url'], 'required'],\n        [['url', 'title'], 'trim'],\n        [['url', 'title'], 'unique'],\n        [['title'], 'string', 'max' => 200],\n        ['url', 'validateUrl'],\n        ['url', 'validateContent'],\n    ];\n}\n\npublic function validateUrl($attribute, $params)\n{\n    if (!(new Ripple($this->$attribute))->isValidUrl()) {\n        $this->addError($attribute, '\u66f2\u306e URL \u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002');\n    }\n}\n\npublic function validateContent($attribute, $params)\n{\n    if (!isset($this->image) || !isset($this->provider_key)) {\n        $this->addError($attribute, 'URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002');\n    }\n}\n\n\nURL \u304c\u66f2\u306e URL \u3068\u3057\u3066\u6b63\u3057\u3044\u304b\u3092\u691c\u8a3c\u3059\u308b\u3082\u306e\u3068\u3001URL \u304b\u3089\u3061\u3083\u3093\u3068\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u691c\u8a3c\u3059\u308b\u3082\u306e\u3092\u30ab\u30b9\u30bf\u30e0\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u308a\u65b9\u306f\u516c\u5f0f\u30ac\u30a4\u30c9\u306e \u5165\u529b\u3092\u691c\u8a3c\u3059\u308b \u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\nTrackController \u3068\u30d3\u30e5\u30fc\u306e\u4f5c\u6210\n\n\nhttp://localhost:8080/gii \u306b\u30a2\u30af\u30bb\u30b9\u3057 CRUD Generator \u306e Start \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\nModel Class \u306b app\\models\\Track \u3068\u5165\u529b\nController Class \u306b app\\controllers\\TrackController \u3068\u5165\u529b\nWidget Used in Index Page \u306e\u4e0b\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 ListView \u306b\u5408\u308f\u305b\u308b\nPreview \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057 Generate \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3068\u30d3\u30e5\u30fc\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u3064\u3044\u3067\u306b http://localhost:8080 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b track/index \u3092\u547c\u3073\u51fa\u3059\u5f62\u306b\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\nconfig/web.php\n$config = [\n    'id' => 'basic',\n    'defaultRoute' => 'track', // \u8ffd\u52a0\n    'basePath' => dirname(__DIR__),\n    // ...\n\n\n\nTrackController \u306e\u4e2d\u8eab\u3092\u66f8\u3044\u3066\u3044\u304f\n\u30e2\u30c7\u30eb\u3067\u66f8\u3044\u305f Track::setContents() \u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e actionCreate() \u3068 actionUpdate() \u3067\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\ncontrollers/TrackController.php\nuse jamband\\ripple\\Ripple;\nuse Goutte\\Client;\n\n// \u3053\u306e\u884c\u3092\nif ($model->load(Yii::$app->request->post()) && $model->save()) {\n\n// \u3053\u3046\u66f8\u304d\u63db\u3048\u308b\nif ($model->load(Yii::$app->request->post()) && $model->setContents(new Client())->save()) {\n\n\n\u3053\u308c\u3067\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f OK \u3067\u3059 :)\n\n\u66f2\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\n\n\nhttp://localhost:8080/ \u306b\u30a2\u30af\u30bb\u30b9\u3057 Create Track \u3092\u30af\u30ea\u30c3\u30af\nUrl \u306b https://linneshelvete.bandcamp.com/track/tjeresten \u3068\u5165\u529b\u3057 Create \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067\u66f2\u306e\u3044\u308d\u3093\u306a\u60c5\u5831\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u81ea\u52d5\u3067\u633f\u5165\u3055\u308c\u307e\u3059 ( \u4ee5\u4e0b\u306f\u4f8b\u3067\u3059 ) \u3002\n\n\n\n\u30ab\u30e9\u30e0\n\u5024\n\n\n\n\nID\n1\n\n\nUrl\nhttps://linneshelvete.bandcamp.com/track/tjeresten\n\n\nTitle\nLinn\u00e9s Helvete - Tjeresten\n\n\nImage\nhttps://f1.bcbits.com/img/a3144407673_16.jpg\n\n\nProvider Name\nBandcamp\n\n\nProvider Key\n932292198\n\n\n\n\n\u66f2\u3092\u518d\u751f\u3057\u3066\u307f\u308b\n\u518d\u751f\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6d41\u308c\u3092\u3068\u308a\u307e\u3057\u305f:\n\n\u8ffd\u52a0\u3057\u305f\u66f2\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\n\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u8868\u793a\u3055\u308c\u3066\u66f2\u304c\u518d\u751f\u3055\u308c\u308b\n\u518d\u751f\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u30da\u30fc\u30b8\u4e0a\u90e8\u306b\u73fe\u5728\u518d\u751f\u3055\u308c\u3066\u3044\u308b\u66f2\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8868\u793a\u3059\u308b\n\u305d\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u73fe\u5728\u518d\u751f\u3055\u308c\u3066\u3044\u308b\u66f2\u304c\u307e\u305f\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u3067\u8868\u793a\u3055\u308c\u308b\nx \u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u518d\u751f\u306f\u30b9\u30c8\u30c3\u30d7\u3059\u308b (\u4e00\u6642\u3067\u306f\u306a\u304f\u5b8c\u5168\u306b)\n\u518d\u751f\u3057\u3066\u3044\u3066\u3082\u4ed6\u306e\u66f2\u3092\u63a2\u305b\u308b\u3088\u3046\u306b\u3059\u308b (\u306a\u306b\u304b\u3057\u3089\u306e\u64cd\u4f5c\u3092\u3057\u3066\u3044\u3066\u3082\u518d\u751f\u3092\u505c\u6b62\u3055\u305b\u306a\u3044)\n\n\u6700\u5f8c\u306f\u300c\u3042\u308b\u7a0b\u5ea6\u300d\u305d\u3046\u3055\u305b\u308b\u304f\u3089\u3044\u3067\u3002\n\nTrackController::actionIndex() \u3068 views/track/index.php \u306e\u4fee\u6b63\n\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b 1 \u30da\u30fc\u30b8\u306b 2 \u4ef6\u3060\u3051\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u5f62\u306b\u5909\u66f4:\n\ncontrollers/TrackController.php\n$dataProvider = new ActiveDataProvider([\n    'query' => Track::find(),\n    'pagination' => ['pageSize' => 2], // \u8ffd\u52a0\n    'sort' => false, // \u8ffd\u52a0\n]);\n\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30ae\u30e3\u30e9\u30ea\u30fc\u98a8\u306b:\n\nviews/track/index.php\n<?php\nuse yii\\helpers\\Html;\nuse yii\\helpers\\Url;\nuse yii\\widgets\\LinkPager;\nuse yii\\widgets\\Pjax;\n?>\n<h1><?= Html::encode($this->title) ?></h1>\n<p><?= Html::a('Create Track', ['create'], ['class' => 'btn btn-success']) ?></p>\n\n<div id=\"track-embed\"></div>\n<div id=\"track-now\" class=\"text-center\"></div>\n\n<?php Pjax::begin(['scrollTo' => 0]) ?>\n    <div class=\"row\">\n        <?php $embedUrl = Url::to(['embed']) ?>\n        <?php foreach ($dataProvider->models as $model): ?>\n            <div class=\"col-xs-12 col-sm-6\">\n                <div class=\"thumbnail\">\n                    <?= Html::img(Html::encode($model->image), [\n                        'class' => 'track-image',\n                        'data-url' => $embedUrl,\n                        'data-name' => $model->provider_name,\n                        'data-key' => $model->provider_key,\n                        'data-title' => $model->title,\n                    ]) ?>\n                    <div class=\"caption\">\n                        <h4><?= Html::a(Html::encode($model->title), Html::encode($model->url), [\n                            'target' => '_blank',\n                        ]) ?></h4>\n                        <?= Html::a('View', ['view', 'id' => $model->id]) ?>\n                    </div>\n                </div>\n            </div>\n        <?php endforeach ?>\n    </div>\n    <?= LinkPager::widget(['pagination' => $dataProvider->pagination]) ?>\n<?php Pjax::end() ?>\n\n<?php\n$this->registerJs(<<<'JS'\n$(document).on('click', '.track-image', function() {\n    var $el = $(this);\n    $.ajax($el.attr('data-url'), {\n        timeout: 10000,\n        data: {\n            name: $el.attr('data-name'),\n            key: $el.attr('data-key')\n        },\n        context: {\n            name: $el.attr('data-name'),\n            title: $el.attr('data-title')\n        }\n    }).done(function(data) {\n        $('#track-embed').html('<div class=\"fade modal\" id=\"track-modal\"><div class=\"modal-dialog\">' +\n            '<iframe src=\"' + data.embed + '\" frameborder=\"0\" allowfullscreen /></div></div>');\n\n        var $modal = $('#track-modal');\n        var $iframe = $modal.find('iframe');\n\n        if (/^(Vimeo|YouTube)$/.test(this.name)) {\n            $iframe.wrap('<div class=\"embed-responsive embed-responsive-16by9\" />')\n                .addClass('embed-responsive-item');\n        } else {\n            $iframe.attr({\n                'width': '100%',\n                'height': '120'\n            });\n        }\n        $modal.modal('show');\n        $('#track-now').html('<p><span id=\"track-now-title\" /><span id=\"track-now-clear\" /></p>');\n        $('#track-now-title').text(this.title);\n    }).fail(function(data) {\n        alert('\u901a\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002');\n    });\n});\n$(document).on('click', '#track-now-title', function() {\n    $('#track-modal').modal('show');\n});\n$(document).on('click', '#track-now-clear', function() {\n    $('#track-modal, #track-now').empty();\n});\nJS\n);\n\n\n\u30a4\u30f3\u30e9\u30a4\u30f3\u306e JavaScript \u90e8\u5206\u306f\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u308b\u3068 /track/embed \u306b name, key \u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u52a0\u3057\u3066 Ajax \u3067 GET \u30ea\u30af\u30a8\u30b9\u30c8\u3057\u307e\u3059\u3002\u6210\u529f\u3059\u308c\u3070 #track-embed \u90e8\u5206\u306e HTML \u3092\u7d44\u307f\u7acb\u3066\u3066\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u8868\u793a\u3057\u3001 #track-now \u90e8\u5206\u306b\u30bf\u30a4\u30c8\u30eb\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\nTrackController::actionEmbed() \u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\ncontrollers/TrackController.php\nuse yii\\web\\Response;\n\n/**\n * @param string $name \u30d7\u30ed\u30d0\u30a4\u30c0\u540d\n * @param string $key \u66f2\u306e ID\n * @return mixed\n */\npublic function actionEmbed($name, $key)\n{\n    if (Yii::$app->request->isAjax) {\n        $ripple = new Ripple();\n        $ripple->setEmbedParams(Yii::$app->params['ripple.embed']['index']);\n\n        Yii::$app->response->format = Response::FORMAT_JSON;\n        return ['embed' => $ripple->embed($name, $key)];\n    }\n}\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u304c Ajax \u901a\u4fe1\u306e\u3082\u306e\u3067\u3042\u308c\u3070\u3001iframe \u306e\u751f\u6210\u306b\u5fc5\u8981\u306a src \u3092 Ripple::embed() \u3067\u7d44\u307f\u7acb\u3066\u3066\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u57cb\u3081\u8fbc\u307f\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4e8b\u524d\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u81ea\u52d5\u518d\u751f\u306b\u3057\u305f\u308a\u3001\u898b\u305f\u76ee\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002Ripple::setEmbedParams() \u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u4f8b\u3068\u3057\u3066\u306f\u4ee5\u4e0b:\n\nconfig/params.php\nreturn [\n    'ripple.embed' => [\n        'index' => [\n            'Bandcamp' => 'size=large/tracklist=false/artwork=small/',\n            'SoundCloud' => '&auto_play=true&show_comments=false',\n            'YouTube' => '?autoplay=1',\n            'Vimeo' => '?autoplay=1',\n        ]\n    ],\n];\n\n\n\n\u30b9\u30bf\u30a4\u30eb\u306e\u5fae\u8abf\u6574\n\u4ed5\u4e0a\u3052\u306b\u30b9\u30bf\u30a4\u30eb\u3092\u826f\u3044\u611f\u3058\u306b\u3057\u307e\u3059:\n\nviews/layouts/main.php\n<!-- <?= Html::csrfMetaTags() ?> \u306e\u4e0b\u3089\u3078\u3093\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0 -->\n<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css\">\n\n\n\nweb/css/site.css\n#track-now-title,\n#track-now-clear {\n  cursor: pointer;\n}\n#track-now-title:before,\n#track-now-clear:before {\n  font-family: FontAwesome;\n  padding: 0 5px;\n}\n#track-now-title:before {\n  content: \"\\f028\";\n}\n#track-now-clear:before {\n  content: \"\\f00d\";\n}\n.track-image {\n  width: 100%;\n  cursor: pointer;\n}\n\n\n\u3053\u308c\u3067\u30c7\u30e2\u30a2\u30d7\u30ea\u306f\u5b8c\u6210\u3067\u3059 :)\n\n\u6ce8\u610f\u70b9\n\n\u3053\u306e\u30c7\u30e2\u30a2\u30d7\u30ea\u306f\u7aef\u672b\u306b\u3088\u3063\u3066\u66f2\u306e\u81ea\u52d5\u518d\u751f\u304c\u3067\u304d\u308b\u3082\u306e\u3082\u3042\u308c\u3070\u3001\u305d\u3046\u3067\u306a\u3044\u3082\u306e\u3082\u3042\u308a\u307e\u3059\n\u307e\u305f PC \u7aef\u672b\u3067\u3042\u3063\u3066\u3082 YouTube \u306a\u3069\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u518d\u751f\u3055\u305b\u308b Web \u30b5\u30fc\u30d3\u30b9\u306f\u3088\u308d\u3057\u304f\u306a\u3044\u306e\u3067\u3001\u898b\u305b\u65b9\u3092\u5de5\u592b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \n\n\n\u30ea\u30f3\u30af\n\nYii 2 \u30ac\u30a4\u30c9\nYii 2 API\noEmbed\nFriendsOfPHP/Goutte\njamband/ripple\n\n\n## \u306f\u3058\u3081\u306b\n\n\u500b\u4eba\u7684\u306a\u8da3\u5473\u3067\u3001\u5404\u97f3\u697d\u30ec\u30fc\u30d9\u30eb\u304c\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3\u7528\u306b\u516c\u958b\u3057\u3066\u3044\u308b\u97f3\u697d (Bandcamp, SoundCloud, Vimeo, YouTube \u306a\u3069\u306b\u6563\u3089\u3070\u3063\u3066\u3044\u308b) \u3092\u4e00\u5143\u7ba1\u7406\u3059\u308b\u30a2\u30d7\u30ea\u3092 Yii2 \u3067\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\u3067\u3001\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u30a2\u30d7\u30ea\u306e\u4e00\u90e8\u5206\u3092\u3088\u308a\u30b7\u30f3\u30d7\u30eb\u306b\u3057\u305f\u5f62\u3067\u66f8\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u308f\u308a\u3068\u3054\u3061\u3083\u3054\u3061\u3083\u3057\u3066\u3057\u307e\u3046\u304b\u3082\u3067\u3059\u304c\u3001Yii2 \u3067\u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u6d41\u308c\u3092\u5c11\u3057\u3067\u3082\u611f\u3058\u53d6\u3063\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n## \u3053\u306e\u30a2\u30d7\u30ea\u3067\u3067\u304d\u308b\u3053\u3068\n\n* \u66f2\u306e URL \u3092\u30e6\u30fc\u30b6\u304c\u5165\u529b\u3059\u308b\u3068\u3001\u81ea\u52d5\u7684\u306b\u66f2\u306e\u60c5\u5831\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3059\u308b\n* \u4fdd\u5b58\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3057\u3066\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af(\u30bf\u30c3\u30d7)\u3059\u308b\u3068\u66f2\u304c\u518d\u751f\u3055\u308c\u308b\n\n## \u4f7f\u3063\u305f\u3082\u306e\n\n* PHP 5.6.16\n* MySQL 5.7.9\n* Yii Framework 2.0.7-dev\n* jamband/ripple 0.1.5\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\nComposer \u3067 Yii2 \u306a\u3069\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb:\n(Composer \u3084 composer asset plugin \u306a\u3069\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u516c\u5f0f\u30ac\u30a4\u30c9\u306e [Yii \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](https://github.com/yiisoft/yii2/blob/master/docs/guide-ja/start-installation.md) \u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044)\n\n```\ncd /path/to/somewhere\ncomposer create-project --prefer-dist yiisoft/yii2-app-basic basic\ncd ./basic\n```\n\n\u3067\u3001\u4eca\u56de\u306f Yii \u306e 2.0.7 \u4ee5\u964d\u306e\u6a5f\u80fd\u3082\u5c11\u3057\u4f7f\u3044\u305f\u3044\u306e\u3067 yiisoft/yii2 \u3092 dev-master \u306b\u3057\u3066\u3001\u3064\u3044\u3067\u306b jamband/ripple \u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n( [jamband/ripple](https://github.com/jamband/ripple) \u306f URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u4f7f\u3044\u307e\u3059 )\n\n```composer.json\n{\n    \"require\": {\n        \"yiisoft/yii2\": \"dev-master\",\n        \"jamband/ripple\": \"*\",\n}\n```\n\n```\ncomposer update\n```\n\nyii2basic \u3068\u3044\u3046\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210:\n( \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306f\u4efb\u610f\u306e\u3082\u306e\u3067\u304b\u307e\u308f\u306a\u3044 )\n\n```\nmysql.server start\nmysql --login-path=xxxxxxx\nmysql> CREATE DATABASE yii2basic;\n```\n\n\u30a2\u30d7\u30ea\u5074\u3067 DB \u306e\u8a2d\u5b9a\u3092\u3059\u308b:\n( \u30e6\u30fc\u30b6\u540d\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u81ea\u5206\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u308b )\n\n```php:config/db.php\nreturn [\n    'class' => 'yii\\db\\Connection',\n    'dsn' => 'mysql:host=localhost;dbname=yii2basic',\n    'username' => 'xxxxxxx',\n    'password' => 'xxxxxxx',\n    'charset' => 'utf8',\n];\n```\n\ntrack \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210:\n( \u66f2\u306e\u60c5\u5831\u3092\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u633f\u5165\u3057\u3066\u3044\u304d\u307e\u3059 )\n\n```\n./yii migrate/create create_track --fields=url:string:notNull,title:string:notNull,image:string:notNull,provider_name:string:notNull,provider_key:string:notNull\n```\n\n\u4e0a\u8a18\u306e\u3084\u308a\u65b9\u306f Yii 2.0.7 \u4ee5\u964d\u3067\u4f7f\u3048\u308b\u3084\u308a\u65b9\u3067\u3059 ([\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3](https://github.com/yiisoft/yii2/blob/master/docs/guide-ja/db-migrations.md)) \u3002\n\n\u5404\u30ab\u30e9\u30e0\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058:\n\n* url: \u66f2\u306e URL\n* title: \u66f2\u306e\u30bf\u30a4\u30c8\u30eb\n* image: \u66f2\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\n* provider_name: \u66f2\u3092\u63d0\u4f9b\u5143 (Bandcamp, SoundCloud, Vimeo, YouTube \u306e\u3044\u305a\u308c\u304b)\n* provider_key: \u66f2\u306e ID\n\n\u9069\u7528\u3057\u307e\u3059:\n\n```\n./yii migrate\n```\n\nPHP \u30d3\u30eb\u30c8\u30a4\u30f3\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u3092\u8d77\u52d5:\n\n```\nphp -S localhost:8080 -t /path/to/basic/web\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067 localhost:8080 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\u300cCongratulations!\u300d\u3068\u51fa\u308c\u3070 OK \u3067\u3059\u3002\u3042\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f URL \u304c\u82e5\u5e72\u6c5a\u3044\u306e\u3067\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3067\u7dba\u9e97\u306b\u3057\u3066\u304a\u304d\u307e\u3059:\n\n```php:config/web.php\n'components' => [\n    // ...\n    'urlManager' => [\n        'enablePrettyUrl' => true,\n        'showScriptName' => false,\n    ],\n```\n\n\u3053\u308c\u3067\u6e96\u5099\u306f\u5b8c\u4e86 :)\n\n\n## Track \u30e2\u30c7\u30eb\u306e\u4f5c\u6210\n\n* http://localhost:8080/gii \u306b\u30a2\u30af\u30bb\u30b9\u3057 Model Generator \u306e Start \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n* Table Name \u306b t \u3068\u5165\u529b\u3057\u5019\u88dc\u306e track \u3092\u30af\u30ea\u30c3\u30af\n* \u30bf\u30d6\u3067 Model Class \u306b\u79fb\u52d5\u3057\u3001\u81ea\u52d5\u3067 Track \u3068\u5165\u529b\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d\n* Generate Relations \u306e\u30c1\u30a7\u30c3\u30af\u3092\u5916\u3059\n* Preview \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057 Generate \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067 Track \u30e2\u30c7\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n## Track \u30e2\u30c7\u30eb\u306e\u4e2d\u8eab\u3092\u66f8\u3044\u3066\u3044\u304f\n\nTrack \u30e2\u30c7\u30eb\u3067\u306f\u3001URL \u304b\u3089\u81ea\u52d5\u7684\u306b\u66f2\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30b3\u30fc\u30c9\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\u65b0\u305f\u306b\u4f5c\u308b\u30e1\u30bd\u30c3\u30c9\u306f\u4ee5\u4e0b:\n\n```php:models/Track.php\npublic function setContents(\\Goutte\\Client $client) {\n    // URL \u304b\u3089\u81ea\u52d5\u3067 title, image, provider_name, provider_key \u3092\u53d6\u5f97\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n}\npublic function validateUrl($attribute, $params) {\n    // URL \u304c\u66f2\u306e URL \u3068\u3057\u3066\u6b63\u3057\u3044\u3082\u306e\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\n    // \u6b63\u3057\u304f\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8ffd\u52a0\u3059\u308b\n}\npublic function validateContent($attribute, $params) {\n    // URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\n    // \u53d6\u5f97\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8ffd\u52a0\u3059\u308b\n}\n```\n\n\u307e\u305a\u306f Track::setContents() \u304b\u3089:\n\n```php:models/Track.php\nuse jamband\\ripple\\Ripple;\nuse Goutte\\Client;\n\nclass Track extends \\yii\\db\\ActiveRecord\n{\n    /**\n     * @param Client $client\n     * @return Track\n     */\n    public function setContents(Client $client)\n    {\n        $ripple = new Ripple($this->url);\n        if ($ripple->isValidUrl()) {\n            $ripple->request($client);\n\n            if ($this->title === '') {\n                $this->title = $ripple->title();\n            }\n            $this->image = $ripple->image();\n            $this->provider_name = $ripple->provider();\n            $this->provider_key = $ripple->id();\n        }\n        return $this;\n    }\n```\n\nURL \u3092 Ripple \u306b\u98df\u308f\u305b\u3066\u3001\u305d\u308c\u304c\u6b63\u3057\u3044 URL \u306a\u3089\u3070\u66f2\u306e\u60c5\u5831\u3092\u81ea\u52d5\u53d6\u5f97\u3057\u3066\u3001\u5404\u30ab\u30e9\u30e0\u306b\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\u611f\u3058\u3067\u3059\u3002\n\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb:\n\n```php:models/Track.php\npublic function rules()\n{\n    return [\n        [['url'], 'required'],\n        [['url', 'title'], 'trim'],\n        [['url', 'title'], 'unique'],\n        [['title'], 'string', 'max' => 200],\n        ['url', 'validateUrl'],\n        ['url', 'validateContent'],\n    ];\n}\n\npublic function validateUrl($attribute, $params)\n{\n    if (!(new Ripple($this->$attribute))->isValidUrl()) {\n        $this->addError($attribute, '\u66f2\u306e URL \u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002');\n    }\n}\n\npublic function validateContent($attribute, $params)\n{\n    if (!isset($this->image) || !isset($this->provider_key)) {\n        $this->addError($attribute, 'URL \u304b\u3089\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002');\n    }\n}\n```\n\nURL \u304c\u66f2\u306e URL \u3068\u3057\u3066\u6b63\u3057\u3044\u304b\u3092\u691c\u8a3c\u3059\u308b\u3082\u306e\u3068\u3001URL \u304b\u3089\u3061\u3083\u3093\u3068\u66f2\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u691c\u8a3c\u3059\u308b\u3082\u306e\u3092\u30ab\u30b9\u30bf\u30e0\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u308a\u65b9\u306f\u516c\u5f0f\u30ac\u30a4\u30c9\u306e [\u5165\u529b\u3092\u691c\u8a3c\u3059\u308b](https://github.com/yiisoft/yii2/blob/master/docs/guide-ja/input-validation.md) \u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n## TrackController \u3068\u30d3\u30e5\u30fc\u306e\u4f5c\u6210\n\n* http://localhost:8080/gii \u306b\u30a2\u30af\u30bb\u30b9\u3057 CRUD Generator \u306e Start \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n* Model Class \u306b app\\models\\Track \u3068\u5165\u529b\n* Controller Class \u306b app\\controllers\\TrackController \u3068\u5165\u529b\n* Widget Used in Index Page \u306e\u4e0b\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 ListView \u306b\u5408\u308f\u305b\u308b\n* Preview \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057 Generate \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3068\u30d3\u30e5\u30fc\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u3064\u3044\u3067\u306b http://localhost:8080 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b track/index \u3092\u547c\u3073\u51fa\u3059\u5f62\u306b\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n```php:config/web.php\n$config = [\n    'id' => 'basic',\n    'defaultRoute' => 'track', // \u8ffd\u52a0\n    'basePath' => dirname(__DIR__),\n    // ...\n```\n\n## TrackController \u306e\u4e2d\u8eab\u3092\u66f8\u3044\u3066\u3044\u304f\n\n\u30e2\u30c7\u30eb\u3067\u66f8\u3044\u305f Track::setContents() \u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e actionCreate() \u3068 actionUpdate() \u3067\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```php:controllers/TrackController.php\nuse jamband\\ripple\\Ripple;\nuse Goutte\\Client;\n\n// \u3053\u306e\u884c\u3092\nif ($model->load(Yii::$app->request->post()) && $model->save()) {\n\n// \u3053\u3046\u66f8\u304d\u63db\u3048\u308b\nif ($model->load(Yii::$app->request->post()) && $model->setContents(new Client())->save()) {\n```\n\n\u3053\u308c\u3067\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f OK \u3067\u3059 :)\n\n## \u66f2\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\n\n* http://localhost:8080/ \u306b\u30a2\u30af\u30bb\u30b9\u3057 Create Track \u3092\u30af\u30ea\u30c3\u30af\n* Url \u306b https://linneshelvete.bandcamp.com/track/tjeresten \u3068\u5165\u529b\u3057 Create \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\n\n\u3053\u308c\u3067\u66f2\u306e\u3044\u308d\u3093\u306a\u60c5\u5831\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u81ea\u52d5\u3067\u633f\u5165\u3055\u308c\u307e\u3059 ( \u4ee5\u4e0b\u306f\u4f8b\u3067\u3059 ) \u3002\n\n|\u30ab\u30e9\u30e0|\u5024|\n|---|---|\n|ID|1|\n|Url|https://linneshelvete.bandcamp.com/track/tjeresten|\n|Title|Linn\u00e9s Helvete - Tjeresten|\n|Image|https://f1.bcbits.com/img/a3144407673_16.jpg|\n|Provider Name|Bandcamp|\n|Provider Key|932292198|\n\n## \u66f2\u3092\u518d\u751f\u3057\u3066\u307f\u308b\n\n\u518d\u751f\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6d41\u308c\u3092\u3068\u308a\u307e\u3057\u305f:\n\n* \u8ffd\u52a0\u3057\u305f\u66f2\u306e\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\n* \u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u8868\u793a\u3055\u308c\u3066\u66f2\u304c\u518d\u751f\u3055\u308c\u308b\n* \u518d\u751f\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u30da\u30fc\u30b8\u4e0a\u90e8\u306b\u73fe\u5728\u518d\u751f\u3055\u308c\u3066\u3044\u308b\u66f2\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8868\u793a\u3059\u308b\n* \u305d\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u73fe\u5728\u518d\u751f\u3055\u308c\u3066\u3044\u308b\u66f2\u304c\u307e\u305f\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u3067\u8868\u793a\u3055\u308c\u308b\n* x \u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u518d\u751f\u306f\u30b9\u30c8\u30c3\u30d7\u3059\u308b (\u4e00\u6642\u3067\u306f\u306a\u304f\u5b8c\u5168\u306b)\n* \u518d\u751f\u3057\u3066\u3044\u3066\u3082\u4ed6\u306e\u66f2\u3092\u63a2\u305b\u308b\u3088\u3046\u306b\u3059\u308b (\u306a\u306b\u304b\u3057\u3089\u306e\u64cd\u4f5c\u3092\u3057\u3066\u3044\u3066\u3082\u518d\u751f\u3092\u505c\u6b62\u3055\u305b\u306a\u3044)\n\n\u6700\u5f8c\u306f\u300c\u3042\u308b\u7a0b\u5ea6\u300d\u305d\u3046\u3055\u305b\u308b\u304f\u3089\u3044\u3067\u3002\n\n## TrackController::actionIndex() \u3068 views/track/index.php \u306e\u4fee\u6b63\n\n\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b 1 \u30da\u30fc\u30b8\u306b 2 \u4ef6\u3060\u3051\u30ea\u30b9\u30c8\u8868\u793a\u3059\u308b\u5f62\u306b\u5909\u66f4:\n\n```php:controllers/TrackController.php\n$dataProvider = new ActiveDataProvider([\n    'query' => Track::find(),\n    'pagination' => ['pageSize' => 2], // \u8ffd\u52a0\n    'sort' => false, // \u8ffd\u52a0\n]);\n```\n\n\u30b5\u30e0\u30cd\u30a4\u30eb\u3092\u30ae\u30e3\u30e9\u30ea\u30fc\u98a8\u306b:\n\n```html+php:views/track/index.php\n<?php\nuse yii\\helpers\\Html;\nuse yii\\helpers\\Url;\nuse yii\\widgets\\LinkPager;\nuse yii\\widgets\\Pjax;\n?>\n<h1><?= Html::encode($this->title) ?></h1>\n<p><?= Html::a('Create Track', ['create'], ['class' => 'btn btn-success']) ?></p>\n\n<div id=\"track-embed\"></div>\n<div id=\"track-now\" class=\"text-center\"></div>\n\n<?php Pjax::begin(['scrollTo' => 0]) ?>\n    <div class=\"row\">\n        <?php $embedUrl = Url::to(['embed']) ?>\n        <?php foreach ($dataProvider->models as $model): ?>\n            <div class=\"col-xs-12 col-sm-6\">\n                <div class=\"thumbnail\">\n                    <?= Html::img(Html::encode($model->image), [\n                        'class' => 'track-image',\n                        'data-url' => $embedUrl,\n                        'data-name' => $model->provider_name,\n                        'data-key' => $model->provider_key,\n                        'data-title' => $model->title,\n                    ]) ?>\n                    <div class=\"caption\">\n                        <h4><?= Html::a(Html::encode($model->title), Html::encode($model->url), [\n                            'target' => '_blank',\n                        ]) ?></h4>\n                        <?= Html::a('View', ['view', 'id' => $model->id]) ?>\n                    </div>\n                </div>\n            </div>\n        <?php endforeach ?>\n    </div>\n    <?= LinkPager::widget(['pagination' => $dataProvider->pagination]) ?>\n<?php Pjax::end() ?>\n\n<?php\n$this->registerJs(<<<'JS'\n$(document).on('click', '.track-image', function() {\n    var $el = $(this);\n    $.ajax($el.attr('data-url'), {\n        timeout: 10000,\n        data: {\n            name: $el.attr('data-name'),\n            key: $el.attr('data-key')\n        },\n        context: {\n            name: $el.attr('data-name'),\n            title: $el.attr('data-title')\n        }\n    }).done(function(data) {\n        $('#track-embed').html('<div class=\"fade modal\" id=\"track-modal\"><div class=\"modal-dialog\">' +\n            '<iframe src=\"' + data.embed + '\" frameborder=\"0\" allowfullscreen /></div></div>');\n\n        var $modal = $('#track-modal');\n        var $iframe = $modal.find('iframe');\n\n        if (/^(Vimeo|YouTube)$/.test(this.name)) {\n            $iframe.wrap('<div class=\"embed-responsive embed-responsive-16by9\" />')\n                .addClass('embed-responsive-item');\n        } else {\n            $iframe.attr({\n                'width': '100%',\n                'height': '120'\n            });\n        }\n        $modal.modal('show');\n        $('#track-now').html('<p><span id=\"track-now-title\" /><span id=\"track-now-clear\" /></p>');\n        $('#track-now-title').text(this.title);\n    }).fail(function(data) {\n        alert('\u901a\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002');\n    });\n});\n$(document).on('click', '#track-now-title', function() {\n    $('#track-modal').modal('show');\n});\n$(document).on('click', '#track-now-clear', function() {\n    $('#track-modal, #track-now').empty();\n});\nJS\n);\n```\n\n\u30a4\u30f3\u30e9\u30a4\u30f3\u306e JavaScript \u90e8\u5206\u306f\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u308b\u3068 /track/embed \u306b name, key \u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u52a0\u3057\u3066 Ajax \u3067 GET \u30ea\u30af\u30a8\u30b9\u30c8\u3057\u307e\u3059\u3002\u6210\u529f\u3059\u308c\u3070 #track-embed \u90e8\u5206\u306e HTML \u3092\u7d44\u307f\u7acb\u3066\u3066\u30e2\u30fc\u30c0\u30eb\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u8868\u793a\u3057\u3001 #track-now \u90e8\u5206\u306b\u30bf\u30a4\u30c8\u30eb\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n## TrackController::actionEmbed() \u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\n```php:controllers/TrackController.php\nuse yii\\web\\Response;\n\n/**\n * @param string $name \u30d7\u30ed\u30d0\u30a4\u30c0\u540d\n * @param string $key \u66f2\u306e ID\n * @return mixed\n */\npublic function actionEmbed($name, $key)\n{\n    if (Yii::$app->request->isAjax) {\n        $ripple = new Ripple();\n        $ripple->setEmbedParams(Yii::$app->params['ripple.embed']['index']);\n\n        Yii::$app->response->format = Response::FORMAT_JSON;\n        return ['embed' => $ripple->embed($name, $key)];\n    }\n}\n```\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u304c Ajax \u901a\u4fe1\u306e\u3082\u306e\u3067\u3042\u308c\u3070\u3001iframe \u306e\u751f\u6210\u306b\u5fc5\u8981\u306a src \u3092 Ripple::embed() \u3067\u7d44\u307f\u7acb\u3066\u3066\u5024\u3092\u8fd4\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u57cb\u3081\u8fbc\u307f\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4e8b\u524d\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u81ea\u52d5\u518d\u751f\u306b\u3057\u305f\u308a\u3001\u898b\u305f\u76ee\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002Ripple::setEmbedParams() \u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u4f8b\u3068\u3057\u3066\u306f\u4ee5\u4e0b:\n\n```php:config/params.php\nreturn [\n    'ripple.embed' => [\n        'index' => [\n            'Bandcamp' => 'size=large/tracklist=false/artwork=small/',\n            'SoundCloud' => '&auto_play=true&show_comments=false',\n            'YouTube' => '?autoplay=1',\n            'Vimeo' => '?autoplay=1',\n        ]\n    ],\n];\n```\n\n## \u30b9\u30bf\u30a4\u30eb\u306e\u5fae\u8abf\u6574\n\n\u4ed5\u4e0a\u3052\u306b\u30b9\u30bf\u30a4\u30eb\u3092\u826f\u3044\u611f\u3058\u306b\u3057\u307e\u3059:\n\n```html:views/layouts/main.php\n<!-- <?= Html::csrfMetaTags() ?> \u306e\u4e0b\u3089\u3078\u3093\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0 -->\n<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css\">\n```\n```css:web/css/site.css\n#track-now-title,\n#track-now-clear {\n  cursor: pointer;\n}\n#track-now-title:before,\n#track-now-clear:before {\n  font-family: FontAwesome;\n  padding: 0 5px;\n}\n#track-now-title:before {\n  content: \"\\f028\";\n}\n#track-now-clear:before {\n  content: \"\\f00d\";\n}\n.track-image {\n  width: 100%;\n  cursor: pointer;\n}\n```\n\n\u3053\u308c\u3067\u30c7\u30e2\u30a2\u30d7\u30ea\u306f\u5b8c\u6210\u3067\u3059 :)\n\n## \u6ce8\u610f\u70b9\n\n* \u3053\u306e\u30c7\u30e2\u30a2\u30d7\u30ea\u306f\u7aef\u672b\u306b\u3088\u3063\u3066\u66f2\u306e\u81ea\u52d5\u518d\u751f\u304c\u3067\u304d\u308b\u3082\u306e\u3082\u3042\u308c\u3070\u3001\u305d\u3046\u3067\u306a\u3044\u3082\u306e\u3082\u3042\u308a\u307e\u3059\n* \u307e\u305f PC \u7aef\u672b\u3067\u3042\u3063\u3066\u3082 YouTube \u306a\u3069\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u518d\u751f\u3055\u305b\u308b Web \u30b5\u30fc\u30d3\u30b9\u306f\u3088\u308d\u3057\u304f\u306a\u3044\u306e\u3067\u3001\u898b\u305b\u65b9\u3092\u5de5\u592b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \n\n## \u30ea\u30f3\u30af\n\n* [Yii 2 \u30ac\u30a4\u30c9](https://github.com/yiisoft/yii2/tree/master/docs/guide-ja)\n* [Yii 2 API](http://www.yiiframework.com/doc-2.0/)\n* [oEmbed](http://oembed.com/)\n* [FriendsOfPHP/Goutte](https://github.com/FriendsOfPHP/Goutte)\n* [jamband/ripple](https://github.com/jamband/ripple)\n", "tags": ["PHP5.6", "Yii2.0"]}