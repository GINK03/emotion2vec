{"context": "Datadog\u306eDocker\u30db\u30b9\u30c8\u5411\u3051Agent\u306fD4x\u306b\u3061\u3087\u3046\u3069\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u601d\u3063\u305f\u306e\u3067\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\nrun => service\u306b\u5909\u63db\u3059\u308b\nDocker\u30db\u30b9\u30c8\u5411\u3051Agent\u306e\u30a4\u30f3\u30b9\u30c8\u30e9\u30af\u30b7\u30e7\u30f3\u304b\u3089\u306f\u3053\u3046\u6765\u308b\u306e\u3067\u3001\ndocker run -d --name dd-agent \\\n  -v /var/run/docker.sock:/var/run/docker.sock:ro \\\n  -v /proc/:/host/proc/:ro \\\n  -v /sys/fs/cgroup/:/host/sys/fs/cgroup:ro \\\n  -e API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx datadog/docker-dd-agent:latest\n\nglobal\u30e2\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u52d5\u304b\u305b\u308b\u3088\u3046\u306b\u5909\u63db\u3068\u3002\u3053\u3046\u3057\u3066\u304a\u3051\u3070\u30ce\u30fc\u30c9\u304c\u5897\u6e1b\u3057\u3066\u3082\u5168\u4f53\u3067Agent\u304c\u7a3c\u50cd\u3059\u308b\u72b6\u6cc1\u3092\u4fdd\u3066\u308b\u3002\ndocker service create --name global-dd-agent \\\n  --mode global \\\n  --limit-cpu 1 \\\n  --mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock,readonly=true \\\n  --mount type=bind,source=/proc/,target=/host/proc/,readonly=true \\\n  --mount type=bind,source=/sys/fs/cgroup/,target=/host/sys/fs/cgroup,readonly=true \\\n  -e API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \\\n  datadog/docker-dd-agent:latest\n\n\u305d\u3046\u3044\u3048\u3070global\u306b\u3082\u5bfe\u8c61\u7d5e\u308a\u304c\u3067\u304d\u308b\u3093\u3060\u308d\u3046\u304b\uff1f\u307e\u3042\u4eca\u56de\u306f\u3044\u3044\u3084\u3002\n\nService\u306e\u78ba\u8a8d\n\u5168\u90e8\u306eNode\u3067Agent\u304c\u52d5\u304d\u3060\u3057\u305f\u306d\u3002\n$ docker service ps global-dd-agent\nID                         NAME                 IMAGE                           NODE                            DESIRED STATE  CURRENT STATE           ERROR\nb2m3d5lvyng0dn0p20ubpktpj  global-dd-agent      datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 25 seconds ago  \nb71c81rhk8k1qzybme6on0csl   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 20 seconds ago  \n0tkbe30m150unwuh58hw4svb2   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 23 seconds ago  \narc0tozq3ypoltqntli23eo4a   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 12 seconds ago  \nev76xdu7vc8r1pgldd1g5ui1f   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 22 seconds ago  \n8atpxhwzhf4lie9xs50rq5geb   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 20 seconds ago\n\nDatadog\u5074\u306b\u3082\u30ac\u30b5\u3063\u3068\u60c5\u5831\u304c\u4e0a\u304c\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\nDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u3089\u308c\u305f\u308a\u3059\u308b\u69d8\u5b50\u3082\u3042\u304c\u3063\u3066\u304d\u3066\u8272\u3005\u3068\u4e01\u5ea6\u3044\u3044\u304b\u3082\u3002\n\n\u304a\u308f\u308a\u306b\nglobal\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u4e00\u767a\u30bf\u30b9\u30af\u306b\u3082\u4f7f\u3048\u308b\u3002\u4f8b\u3048\u3070\u4e8b\u524d\u306bdocker image\u3092pull\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u304b\u3002\n\nDatadog\u306eDocker\u30db\u30b9\u30c8\u5411\u3051Agent\u306fD4x\u306b\u3061\u3087\u3046\u3069\u3044\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3068\u601d\u3063\u305f\u306e\u3067\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\n## run => service\u306b\u5909\u63db\u3059\u308b\n\nDocker\u30db\u30b9\u30c8\u5411\u3051Agent\u306e\u30a4\u30f3\u30b9\u30c8\u30e9\u30af\u30b7\u30e7\u30f3\u304b\u3089\u306f\u3053\u3046\u6765\u308b\u306e\u3067\u3001\n\n```\ndocker run -d --name dd-agent \\\n  -v /var/run/docker.sock:/var/run/docker.sock:ro \\\n  -v /proc/:/host/proc/:ro \\\n  -v /sys/fs/cgroup/:/host/sys/fs/cgroup:ro \\\n  -e API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx datadog/docker-dd-agent:latest\n```\n\nglobal\u30e2\u30fc\u30c9\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u52d5\u304b\u305b\u308b\u3088\u3046\u306b\u5909\u63db\u3068\u3002\u3053\u3046\u3057\u3066\u304a\u3051\u3070\u30ce\u30fc\u30c9\u304c\u5897\u6e1b\u3057\u3066\u3082\u5168\u4f53\u3067Agent\u304c\u7a3c\u50cd\u3059\u308b\u72b6\u6cc1\u3092\u4fdd\u3066\u308b\u3002\n\n```\ndocker service create --name global-dd-agent \\\n  --mode global \\\n  --limit-cpu 1 \\\n  --mount type=bind,source=/var/run/docker.sock,target=/var/run/docker.sock,readonly=true \\\n  --mount type=bind,source=/proc/,target=/host/proc/,readonly=true \\\n  --mount type=bind,source=/sys/fs/cgroup/,target=/host/sys/fs/cgroup,readonly=true \\\n  -e API_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \\\n  datadog/docker-dd-agent:latest\n```\n\n\u305d\u3046\u3044\u3048\u3070global\u306b\u3082\u5bfe\u8c61\u7d5e\u308a\u304c\u3067\u304d\u308b\u3093\u3060\u308d\u3046\u304b\uff1f\u307e\u3042\u4eca\u56de\u306f\u3044\u3044\u3084\u3002\n\n## Service\u306e\u78ba\u8a8d\n\n\u5168\u90e8\u306eNode\u3067Agent\u304c\u52d5\u304d\u3060\u3057\u305f\u306d\u3002\n\n```\n$ docker service ps global-dd-agent\nID                         NAME                 IMAGE                           NODE                            DESIRED STATE  CURRENT STATE           ERROR\nb2m3d5lvyng0dn0p20ubpktpj  global-dd-agent      datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 25 seconds ago  \nb71c81rhk8k1qzybme6on0csl   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 20 seconds ago  \n0tkbe30m150unwuh58hw4svb2   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 23 seconds ago  \narc0tozq3ypoltqntli23eo4a   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 12 seconds ago  \nev76xdu7vc8r1pgldd1g5ui1f   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 22 seconds ago  \n8atpxhwzhf4lie9xs50rq5geb   \\_ global-dd-agent  datadog/docker-dd-agent:latest  ip-192-168-xxx-xxx.ec2.internal  Running        Running 20 seconds ago\n```\n\nDatadog\u5074\u306b\u3082\u30ac\u30b5\u3063\u3068\u60c5\u5831\u304c\u4e0a\u304c\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\n![Events___Datadog.jpg](https://qiita-image-store.s3.amazonaws.com/0/7454/610a0c14-e933-89d8-0f5f-18c11a0c4600.jpeg \"Events___Datadog.jpg\")\n\nDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u3089\u308c\u305f\u308a\u3059\u308b\u69d8\u5b50\u3082\u3042\u304c\u3063\u3066\u304d\u3066\u8272\u3005\u3068\u4e01\u5ea6\u3044\u3044\u304b\u3082\u3002\n\n\n## \u304a\u308f\u308a\u306b\n\nglobal\u306e\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u4e00\u767a\u30bf\u30b9\u30af\u306b\u3082\u4f7f\u3048\u308b\u3002\u4f8b\u3048\u3070\u4e8b\u524d\u306bdocker image\u3092pull\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u304b\u3002\n", "tags": ["d4x", "docker", "Datadog"]}