{"context": " More than 1 year has passed since last update.\n\n1.\u4f9d\u5b58\u95a2\u4fc2\n\nbuild.gradle\ndependencies{\n\n    [\"core\", \"context\",\"test\",\"tx\",\"jdbc\",\"aop\"].each {\n        compile \"org.springframework:spring-${it}:3.2.3.RELEASE\"\n    }\n    //AOP\n    testCompile 'aspectj:aspectjrt:1.5.4'\n    testCompile 'aspectj:aspectjweaver:1.5.4'\n\n    //\u5177\u8c61\u30af\u30e9\u30b9\u306b\u5bfe\u3059\u308bAOP(<aop:config proxy-target-class=\"true\">)\n    testCompile 'cglib:cglib-nodep:2.2.2'\n    //JNDI on Spring Context (jndi.properties,jndi.xml)\n    testCompile 'org.apache.xbean:xbean-spring:3.14'\n\n\n    //... others\n}\n\n\n\n2.Spring3\u306b\u3088\u308bJNDI\u8a2d\u5b9a\njndi.properties\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u767b\u9332\u3059\u308b\u4e8b\u306b\u3088\u308a\u3001jndi.xml\u304c\u6709\u52b9\u306b\u306a\u308b\n\njndi.properties\n\njava.naming.factory.initial=org.apache.xbean.spring.jndi.SpringInitialContextFactory\n\n\n\ndataSource\u5b9a\u7fa9\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001TransactionAwareDataSourceProxy\u3067DriverManagerDataSource\u3092\u30e9\u30c3\u30d7\u3057\u3066\u3044\u308b\u3068\u3053\u308d\n(\u5ba3\u8a00\u7684\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7528\uff09\n\njndi.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans\">\n\n    <bean id=\"jdbcDataSource\"\n        class=\"org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy\">\n        <constructor-arg>\n            <bean class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n                <property name=\"driverClassName\" value=\"oracle.jdbc.driver.OracleDriver\" />\n                <property name=\"url\" value=\"jdbc:oracle:thin:@YOUR_HOST:1521:orcl\" />\n                <property name=\"username\" value=\"NAME\" />\n                <property name=\"password\" value=\"PASS\" />\n            </bean>\n        </constructor-arg>\n    </bean>\n\n    <bean id=\"jndi\" class=\"org.apache.xbean.spring.jndi.DefaultContext\">\n        <property name=\"entries\">\n            <map>\n                <entry key=\"jdbc/dataSource\">\n                    <ref bean=\"jdbcDataSource\" />\n                </entry>\n            </map>\n        </property>\n    </bean>\n\n</beans>\n\n\n\n3.applicationContext\u8a2d\u5b9a\n2.\u3067\u767b\u9332\u3057\u305fJNDI\u3088\u308a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n\napplicationContext.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n    xmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\"\n    xsi:schemaLocation=\"http://www.springframework.org/schema/beans\n         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n         http://www.springframework.org/schema/aop\n         http://www.springframework.org/schema/aop/spring-aop-3.0.xsd\n         http://www.springframework.org/schema/tx\n         http://www.springframework.org/schema/tx/spring-tx-3.0.xsd\n         http://www.springframework.org/schema/context\n         http://www.springframework.org/schema/context/spring-context-3.0.xsd\">\n\n    <context:annotation-config />\n    <context:component-scan base-package=\"jp.co\" />\n\n    <!-- @see jndi.properties,jndi.xml -->\n    <bean id=\"dataSource\" class=\"org.springframework.jndi.JndiObjectFactoryBean\">\n        <property name=\"jndiName\">\n            <value>jdbc/dataSource</value>\n        </property>\n    </bean>\n\n    <bean id=\"transactionManager\"\n        class=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n        <property name=\"dataSource\" ref=\"dataSource\" />\n    </bean>\n\n    <tx:annotation-driven/>\n    <tx:advice id=\"txDefault\" transaction-manager=\"transactionManager\">\n        <tx:attributes>\n            <tx:method name=\"*\" />\n        </tx:attributes>\n    </tx:advice>\n    <aop:config proxy-target-class=\"true\">\n        <aop:advisor\n            pointcut=\"execution(* services.bizlogic.*.*(..))\"\n            advice-ref=\"txDefault\" />\n    </aop:config>\n</beans>\n\n\n\n\n3. Config(Doma)\n\nAppConfig.java\n\nimport javax.naming.InitialContext;\nimport javax.naming.NamingException;\nimport javax.sql.DataSource;\n\nimport org.seasar.doma.jdbc.DomaAbstractConfig;\nimport org.seasar.doma.jdbc.JdbcLogger;\nimport org.seasar.doma.jdbc.dialect.Dialect;\nimport org.seasar.doma.jdbc.dialect.OracleDialect;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class AppConfig extends DomaAbstractConfig {\n\n    private final Dialect DIARECT = new OracleDialect();\n\n    DataSource dataSource;\n\n    public AppConfig() {\n    dataSource = createDataSource();\n    }\n\n    @Override\n    public DataSource getDataSource() {\n    return dataSource;\n    }\n\n    @Override\n    public Dialect getDialect() {\n    return DIARECT;\n    }\n\n    @Override\n    public JdbcLogger getJdbcLogger() {\n    return new Slf4JLogger();\n    }\n\n    protected DataSource createDataSource() {\n    try {\n        return (DataSource) InitialContext.doLookup(\"jdbc/dataSource\");\n    } catch (NamingException e) {\n        throw new RuntimeException(e);\n    }\n    }\n}\n\n\n\n1.\u4f9d\u5b58\u95a2\u4fc2\n----\n\n```build.gradle\ndependencies{\n\n\t[\"core\", \"context\",\"test\",\"tx\",\"jdbc\",\"aop\"].each {\n\t\tcompile \"org.springframework:spring-${it}:3.2.3.RELEASE\"\n    }\n    //AOP\n    testCompile 'aspectj:aspectjrt:1.5.4'\n    testCompile 'aspectj:aspectjweaver:1.5.4'\n    \n    //\u5177\u8c61\u30af\u30e9\u30b9\u306b\u5bfe\u3059\u308bAOP(<aop:config proxy-target-class=\"true\">)\n    testCompile 'cglib:cglib-nodep:2.2.2'\n    //JNDI on Spring Context (jndi.properties,jndi.xml)\n    testCompile 'org.apache.xbean:xbean-spring:3.14'\n\n\n\t//... others\n}\n```\n\n2.Spring3\u306b\u3088\u308bJNDI\u8a2d\u5b9a\n----\n\njndi.properties\u306b\u4ee5\u4e0b\u306e\u30af\u30e9\u30b9\u3092\u767b\u9332\u3059\u308b\u4e8b\u306b\u3088\u308a\u3001jndi.xml\u304c\u6709\u52b9\u306b\u306a\u308b\n\n```jndi.properties\n\njava.naming.factory.initial=org.apache.xbean.spring.jndi.SpringInitialContextFactory\n\n```\n\ndataSource\u5b9a\u7fa9\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001TransactionAwareDataSourceProxy\u3067DriverManagerDataSource\u3092\u30e9\u30c3\u30d7\u3057\u3066\u3044\u308b\u3068\u3053\u308d\n(\u5ba3\u8a00\u7684\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7528\uff09\n\n```jndi.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" \n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans\">\n\n\t<bean id=\"jdbcDataSource\"\n\t\tclass=\"org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy\">\n\t\t<constructor-arg>\n\t\t\t<bean class=\"org.springframework.jdbc.datasource.DriverManagerDataSource\">\n\t\t\t\t<property name=\"driverClassName\" value=\"oracle.jdbc.driver.OracleDriver\" />\n\t\t\t\t<property name=\"url\" value=\"jdbc:oracle:thin:@YOUR_HOST:1521:orcl\" />\n\t\t\t\t<property name=\"username\" value=\"NAME\" />\n\t\t\t\t<property name=\"password\" value=\"PASS\" />\n\t\t\t</bean>\n\t\t</constructor-arg>\n\t</bean>\n\n\t<bean id=\"jndi\" class=\"org.apache.xbean.spring.jndi.DefaultContext\">\n\t\t<property name=\"entries\">\n\t\t\t<map>\n\t\t\t\t<entry key=\"jdbc/dataSource\">\n\t\t\t\t\t<ref bean=\"jdbcDataSource\" />\n\t\t\t\t</entry>\n\t\t\t</map>\n\t\t</property>\n\t</bean>\n\n</beans>\n```\n\n3.applicationContext\u8a2d\u5b9a\n----\n\n2.\u3067\u767b\u9332\u3057\u305fJNDI\u3088\u308a\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\n\n```applicationContext.xml\n\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<beans xmlns=\"http://www.springframework.org/schema/beans\"\n\txmlns:aop=\"http://www.springframework.org/schema/aop\" xmlns:tx=\"http://www.springframework.org/schema/tx\"\n\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\"\n\txsi:schemaLocation=\"http://www.springframework.org/schema/beans\n         http://www.springframework.org/schema/beans/spring-beans-3.0.xsd\n         http://www.springframework.org/schema/aop\n         http://www.springframework.org/schema/aop/spring-aop-3.0.xsd\n         http://www.springframework.org/schema/tx\n         http://www.springframework.org/schema/tx/spring-tx-3.0.xsd\n         http://www.springframework.org/schema/context\n         http://www.springframework.org/schema/context/spring-context-3.0.xsd\">\n\n\t<context:annotation-config />\n\t<context:component-scan base-package=\"jp.co\" />\n\n\t<!-- @see jndi.properties,jndi.xml -->\n\t<bean id=\"dataSource\" class=\"org.springframework.jndi.JndiObjectFactoryBean\">\n\t\t<property name=\"jndiName\">\n\t\t\t<value>jdbc/dataSource</value>\n\t\t</property>\n\t</bean>\n\n\t<bean id=\"transactionManager\"\n\t\tclass=\"org.springframework.jdbc.datasource.DataSourceTransactionManager\">\n\t\t<property name=\"dataSource\" ref=\"dataSource\" />\n\t</bean>\n\n\t<tx:annotation-driven/>\n\t<tx:advice id=\"txDefault\" transaction-manager=\"transactionManager\">\n\t\t<tx:attributes>\n\t\t\t<tx:method name=\"*\" />\n\t\t</tx:attributes>\n\t</tx:advice>\n\t<aop:config proxy-target-class=\"true\">\n\t\t<aop:advisor\n\t\t\tpointcut=\"execution(* services.bizlogic.*.*(..))\"\n\t\t\tadvice-ref=\"txDefault\" />\n\t</aop:config>\n</beans>\n\n```\n\n3. Config(Doma)\n----\n\n```java:AppConfig.java\n\nimport javax.naming.InitialContext;\nimport javax.naming.NamingException;\nimport javax.sql.DataSource;\n\nimport org.seasar.doma.jdbc.DomaAbstractConfig;\nimport org.seasar.doma.jdbc.JdbcLogger;\nimport org.seasar.doma.jdbc.dialect.Dialect;\nimport org.seasar.doma.jdbc.dialect.OracleDialect;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class AppConfig extends DomaAbstractConfig {\n\n    private final Dialect DIARECT = new OracleDialect();\n\n    DataSource dataSource;\n\n    public AppConfig() {\n\tdataSource = createDataSource();\n    }\n\n    @Override\n    public DataSource getDataSource() {\n\treturn dataSource;\n    }\n\n    @Override\n    public Dialect getDialect() {\n\treturn DIARECT;\n    }\n\n    @Override\n    public JdbcLogger getJdbcLogger() {\n\treturn new Slf4JLogger();\n    }\n\n    protected DataSource createDataSource() {\n\ttry {\n\t    return (DataSource) InitialContext.doLookup(\"jdbc/dataSource\");\n\t} catch (NamingException e) {\n\t    throw new RuntimeException(e);\n\t}\n    }\n}\n\n```\n", "tags": ["Java1.6", "Doma1.29", "spring3.2.3"]}