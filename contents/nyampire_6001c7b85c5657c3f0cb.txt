{"context": " More than 1 year has passed since last update.\u304b\u304d\u306a\u3050\u308a\u30e1\u30e2\u5e33\u3002\n\nserver environment\nConoHa\u306e\u4e00\u756a\u5b89\u3044\u30d7\u30e9\u30f3\u3001ubuntu 13.10\u74b0\u5883\u3067\u4f5c\u6210\u3002\n\npostgis install\nfor version 2.*.\nhttp://trac.osgeo.org/postgis/wiki/UsersWikiPostGIS21UbuntuPGSQL93Apt\nCREATE EXTENSION adminpack; needs postgresql-contrib-9.1 package.\nsudo apt-get install postgresql-contrib-9.1\n\n\u305f\u3060\u3001\u3053\u308c\u306e\u305b\u3044\u3067 postgres9.3\u3068\u3001postgres9.1\u304c\u4e21\u65b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u611f\u3058\u3002\u8abf\u3079\u305f\u3089\u3001\u5b9f\u50cd\u3057\u3066\u3044\u308b\u306e\u306f9.1\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\n\u305f\u3076\u3093\u3001postgresql-contrib-9.3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3053\u3093\u306a\u3053\u3068\u306b\u306f\u306a\u3089\u306a\u304b\u3063\u305f\u3002\u305d\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30829.3\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\nsudo apt-get install postgresql-9.1-postgis-2.1\nsudo apt-get install postgresql-9.1-postgis-2.1-scripts\nsudo apt-get install postgresql-9.1-postgis-scripts\n\n\u3053\u3053\u3082\u53c2\u8003\u304b\uff1f\nhttp://technobytz.com/install-postgis-postgresql-9-3-ubuntu.html\n\nDatabase creation & enable extension on the Database\nsudo su - postgres\ncreatedb hdm\npsql -d hdm\ncreate extension postgis;\ncreate extension hstore;\n\\q\n\n\u3042\u3068\u3001createuser\u3067\u3001\u30e6\u30fc\u30b6\u4f5c\u3063\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3059\u308b\u3002\n\nmapnik\nnightly build is highly unstable, using 2.2.* as package.\nhttps://github.com/mapnik/mapnik/wiki/UbuntuInstallation\nsudo add-apt-repository ppa:mapnik/v2.2.0\nsudo apt-get update\nsudo apt-get install libmapnik libmapnik-dev mapnik-utils python-mapnik\n\n\ninstall git\nas we always do.\napt-get install git\n\n\napache2\napt-get install apache2\n\n\nmod_tile\nhttp://wiki.openstreetmap.org/wiki/HowTo_mod_tile\nsudo aptitude install apache2 apache2-threaded-dev apache2-mpm-prefork apache2-utils\nsudo apt-get install libagg-dev\n\ncd ~/src\ngit clone https://github.com/openstreetmap/mod_tile.git\ncd mod_tile\nsudo apt-get install dh-autoreconf\n./autogen.sh\n./configure\nmake\nsudo make install\nsudo make install-mod_tile # Only needed with recent mod_tile version\n\nmod_tile\u3092mods-available\u306b\u683c\u7d0d\u3057\u3066\u3001mods_enabled\u304b\u3089\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u3042\u3052\u308b\u3002\na2enmod\u30b3\u30de\u30f3\u30c9\u3067\u3082\u53ef\u3002\nsudo vi /etc/apache2/mods-available/mod_tile.load\nsudo ln -s /etc/apache2/mods-available/mod_tile.load /etc/apache2/mods-enabled/mod_tile.load\n\nrenderd\u306esocket\u7ba1\u7406\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u78ba\u4fdd\u3002/etc/renderd.conf\u306e\u4e2d\u306e\u8a2d\u5b9a\u3001\u304a\u3088\u3073 /etc/apache2/site-available\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u306b\u3042\u308f\u305b\u308b\u3053\u3068\u3002\nsudo mkdir /var/run/renderd\nsudo chown www-data /var/run/renderd\n\n\u3042\u3068\u3001\u30b5\u30f3\u30d7\u30eb\u63d0\u793a\u3055\u308c\u3066\u3044\u308bsite-available\u306e\u30b3\u30f3\u30c6\u30ca\u8a18\u8ff0\u306f\u3001ModTileRenderdSocketName\u304c\u3044\u308d\u3093\u306a\u3068\u3053\u308d\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u7570\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ed6\u3068\u3042\u308f\u305b\u308b\u3053\u3068\u3002\nLoadTileConfigFile /etc/renderd.conf\n# ModTileRenderdSocketName /tmp/osm-renderd \u3053\u306e\u884c\u3002\nModTileRenderdSocketName /var/run/renderd/renderd.sock\n# Timeout before giving up for a tile to be rendered\nModTileRequestTimeout 3\n# Timeout before giving up for a tile to be rendered that is otherwise missing\nModTileMissingRequestTimeout 30\n\n/etc/init.d/renderd\u3092\u8a2d\u7f6e\u3059\u308b\u5834\u5408\u306f\u3053\u3061\u3089\u306e\u624b\u9806\u53c2\u7167\u3002\nhttp://switch2osm.org/serving-tiles/manually-building-a-tile-server/\nsudo cp  ~/src/mod_tile/debian/renderd.init /etc/init.d/renderd\nsudo chmod u+x /etc/init.d/renderd\n\nEdit the /etc/init.d/renderd file as root \u2013 you\u2019ll need to make a couple of changes to the DAEMON and DAEMON_ARGS lines so that they read:\n\nDAEMON=/usr/local/bin/$NAME\nDAEMON_ARGS=\"-c /usr/local/etc/renderd.conf\"\n\n\u3044\u3063\u305f\u3093root\u3067\u30bf\u30a4\u30eb\u753b\u50cf\u3092\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u3001daemon\u5316\u3057\u305f\u6642\u306b\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u3081\u306a\u304f\u3066\u753b\u50cf\u306e\u751f\u6210\u306b\u5931\u6557\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u306e\u3067\u3001daemon\u5316\u3057\u305f\u5f8c\u306f\u3044\u3063\u305f\u3093\u4f5c\u6210\u3057\u305f\u30bf\u30a4\u30eb\u753b\u50cf\u3092\u5168\u524a\u9664\u3059\u308b\u3053\u3068\u3092\u30aa\u30b9\u30b9\u30e1\u3002\n\nosm2pgsql\nsudo apt-get install osm2pgsql\n\n\u8981\u78ba: postgis-1.5\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3057\u307e\u3046\u304c\u5927\u4e08\u592b\u304b\u3002\n\nosmosis\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3060\u3068\u30010.40.1\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\nsudo apt-get install osmosis\n\n\u3068\u308a\u3042\u3048\u305a\u306f\u5927\u4e08\u592b\u3060\u3051\u3069\u3001\u6700\u65b0\u7248\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u5916\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3002\nhttp://wiki.openstreetmap.org/wiki/Osmosis/Installation\nwget http://bretth.dev.openstreetmap.org/osmosis-build/osmosis-latest.tgz\ntar xvfz osmosis-latest.tgz\ncd osmosis-*\nchmod a+x bin/osmosis\nbin/osmosis\n\n\nOSM files\nfor test purpose, bbbike extract would be easy choice.\nhttp://download.bbbike.org/osm/bbbike/Tokyo/\nwget http://download.bbbike.org/osm/bbbike/Tokyo/Tokyo.osm.pbf\n\n\nimport data into postgis database\n\u30e6\u30fc\u30b6\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5ea6\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\nGeoFabrik\u306eJapan.-latest.pbf\u306e\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u3066\u30e1\u30e2\u30ea\u306e\u30a2\u30ed\u30b1\u30fc\u30c8\u8abf\u6574\u3057\u306a\u3044\u3068\u30c0\u30e1\u307d\u3044\u3002\u3042\u308b\u3044\u306f slim mode\uff1f\nosm2pgsql -G -U postgres -d hdm /home/nyampire/osmfile/Tokyo.osm.pbf --hstore --create\n\nConoHa\u306e\u6700\u5b89\u30d7\u30e9\u30f3(\u30e1\u30e2\u30ea1G)\u3060\u3068\u3001\u30e1\u30e2\u30ea320MB\u5272\u308a\u5f53\u3066\u304f\u3089\u3044\u304c\u7cbe\u4e00\u676f\u307d\u3044\u3002\nosm2pgsql -W -G -U postgres -d hdm /home/nyampire/osmfile/japan-latest.osm.pbf --number-processes 2 --slim -C 320 --hstore --create \n\n\nfonts\nMapnik\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(/etc/renderd.conf)\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u30d5\u30a9\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30d5\u30a9\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/usr/share/fonts/truetype)\u3092\u6307\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3057\u307e\u3063\u305f\u307b\u3046\u304c\u697d\u306a\u6c17\u304c\u3059\u308b\u3002\napt-get install fonts-vlgothic\n\n\ntilemill (optional)\n\nminutely diff (optional)\nhttp://wiki.openstreetmap.org/wiki/Minutely_Mapnik\nhttp://wiki.openstreetmap.org/wiki/Planet.osm/diffs\n\u3082\u3057\u304b\u3057\u305f\u3089\u6700\u5f37\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 http://switch2osm.org/loading-osm-data/\nKomzpa\u4f5c\u6210\u306efetch\u30b3\u30de\u30f3\u30c9 https://github.com/Komzpa/furry-sansa\n\u30bf\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\u30d0\u30c3\u30c1(mod_tile\u7528) http://wiki.openstreetmap.org/wiki/Howto_real_time_tiles_rendering_with_mapnik_and_mod_python\nmod_tile\u5358\u4f53\u3067\u3082\u3044\u3051\u308b\u307d\u3044\u3002state.txt\u3092\u3061\u3083\u3093\u3068\u8aad\u307f\u8fbc\u307e\u305b\u3066\u3042\u3052\u308c\u3070OK http://wiki.openstreetmap.org/wiki/Mod_tile\nstate.txt\u306e\u751f\u6210\u306f\u3053\u3053\u304c\u3088\u3055\u3052\u3002\u904e\u53bb\u306estate.txt\u3092\u4f7f\u3063\u3066\u3082\u3001\u91cd\u8907\u3076\u3093\u306f\u81ea\u52d5\u7684\u306b\u6392\u9664\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u5c11\u3057\u904e\u53bb\u306e\u3076\u3093\u304b\u3089\u9069\u7528\u3059\u308b\u306e\u304c\u3088\u3055\u305d\u3046\u3002\nhttp://osm.personalwerk.de/replicate-sequences/\n\u3068\u308a\u3042\u3048\u305a\u3001 http://wiki.openstreetmap.org/wiki/Minutely_Mapnik \u306e\u624b\u9806\u3067\u3044\u3051\u305d\u3046\u3002state.txt\u306f\u3001\u5b9f\u969b\u306eDump\u3088\u308a\u3082\u904e\u53bb\u306e\u65e5\u4ed8\u3092\u6307\u5b9a\u3057\u3066\u3044\u3066\u3082\u5927\u4e08\u592b\u306a\u306e\u3067\u3001\u6c17\u306b\u305b\u305a\u306b\u751f\u6210\u3057\u3066\u30c8\u30e9\u30a4\u3059\u308c\u3070OK\u3002\n\u3042\u3068\u3001~/.pgpass\u306b\u3001PostGIS\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u5e78\u305b\u306b\u306a\u308c\u308b\u3002\n\u3053\u3093\u306a\u304b\u3093\u3058\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u9069\u5f53\u306b\u307e\u308f\u3057\u3066\u3001\u3042\u3068\u306f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u30b3\u30de\u30f3\u30c9\u3092cron\u306b\u653e\u308a\u8fbc\u3093\u3067\u304a\u3051\u3070\u304a\u3063\u3051\u30fc\u3002\n\u3053\u308c\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u53ef\u80fd\u3002\n#!/bin/bash\nfor i in {0..100}\ndo\n  osmosis --read-replication-interval workingDirectory=$WORKDIR_OSM --simplify-change --write-xml-change - | osm2pgsql --append --number-processes 2 -G -U gis -d hdm --slim -C 320 --hstore -\ndone\n\n\u30bf\u30a4\u30eb\u306eexpire\u306f\u3001\u3053\u308c\u3092\u304b\u307e\u305b\u308b\u3089\u3057\u3044\u3002\nhttp://wiki.openstreetmap.org/wiki/Tile_expire_methods\n\n\n\u304b\u304d\u306a\u3050\u308a\u30e1\u30e2\u5e33\u3002\n## server environment\nConoHa\u306e\u4e00\u756a\u5b89\u3044\u30d7\u30e9\u30f3\u3001ubuntu 13.10\u74b0\u5883\u3067\u4f5c\u6210\u3002\n\n## postgis install\nfor version 2.*.\n\nhttp://trac.osgeo.org/postgis/wiki/UsersWikiPostGIS21UbuntuPGSQL93Apt\n\n`CREATE EXTENSION adminpack;` needs `postgresql-contrib-9.1` package.\n\n```\nsudo apt-get install postgresql-contrib-9.1\n```\n\n\u305f\u3060\u3001\u3053\u308c\u306e\u305b\u3044\u3067 postgres9.3\u3068\u3001postgres9.1\u304c\u4e21\u65b9\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u611f\u3058\u3002\u8abf\u3079\u305f\u3089\u3001\u5b9f\u50cd\u3057\u3066\u3044\u308b\u306e\u306f9.1\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f\u4ee5\u4e0b\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3002\n\u305f\u3076\u3093\u3001postgresql-contrib-9.3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070\u3053\u3093\u306a\u3053\u3068\u306b\u306f\u306a\u3089\u306a\u304b\u3063\u305f\u3002\u305d\u306e\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30829.3\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\n\n```\nsudo apt-get install postgresql-9.1-postgis-2.1\nsudo apt-get install postgresql-9.1-postgis-2.1-scripts\nsudo apt-get install postgresql-9.1-postgis-scripts\n```\n\n\u3053\u3053\u3082\u53c2\u8003\u304b\uff1f\nhttp://technobytz.com/install-postgis-postgresql-9-3-ubuntu.html\n\n\n### Database creation & enable extension on the Database\n\n```\nsudo su - postgres\ncreatedb hdm\npsql -d hdm\ncreate extension postgis;\ncreate extension hstore;\n\\q\n```\n\n\u3042\u3068\u3001createuser\u3067\u3001\u30e6\u30fc\u30b6\u4f5c\u3063\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3059\u308b\u3002\n\n## mapnik\nnightly build is highly unstable, using 2.2.* as package.\n\nhttps://github.com/mapnik/mapnik/wiki/UbuntuInstallation\n\n```\nsudo add-apt-repository ppa:mapnik/v2.2.0\nsudo apt-get update\nsudo apt-get install libmapnik libmapnik-dev mapnik-utils python-mapnik\n```\n\n\n\n\n## install git\nas we always do.\n\n```\napt-get install git\n```\n\n## apache2\n\n```\napt-get install apache2\n```\n\n## mod_tile\n\nhttp://wiki.openstreetmap.org/wiki/HowTo_mod_tile\n\n```\nsudo aptitude install apache2 apache2-threaded-dev apache2-mpm-prefork apache2-utils\nsudo apt-get install libagg-dev\n```\n\n```\ncd ~/src\ngit clone https://github.com/openstreetmap/mod_tile.git\ncd mod_tile\nsudo apt-get install dh-autoreconf\n./autogen.sh\n./configure\nmake\nsudo make install\nsudo make install-mod_tile # Only needed with recent mod_tile version\n```\n\nmod_tile\u3092`mods-available`\u306b\u683c\u7d0d\u3057\u3066\u3001`mods_enabled`\u304b\u3089\u30ea\u30f3\u30af\u3092\u5f35\u3063\u3066\u3042\u3052\u308b\u3002\na2enmod\u30b3\u30de\u30f3\u30c9\u3067\u3082\u53ef\u3002\n\n```\nsudo vi /etc/apache2/mods-available/mod_tile.load\nsudo ln -s /etc/apache2/mods-available/mod_tile.load /etc/apache2/mods-enabled/mod_tile.load\n```\n\n\nrenderd\u306esocket\u7ba1\u7406\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u78ba\u4fdd\u3002/etc/renderd.conf\u306e\u4e2d\u306e\u8a2d\u5b9a\u3001\u304a\u3088\u3073 /etc/apache2/site-available\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u306b\u3042\u308f\u305b\u308b\u3053\u3068\u3002\n\n```\nsudo mkdir /var/run/renderd\nsudo chown www-data /var/run/renderd\n```\n\n\u3042\u3068\u3001\u30b5\u30f3\u30d7\u30eb\u63d0\u793a\u3055\u308c\u3066\u3044\u308bsite-available\u306e\u30b3\u30f3\u30c6\u30ca\u8a18\u8ff0\u306f\u3001`ModTileRenderdSocketName`\u304c\u3044\u308d\u3093\u306a\u3068\u3053\u308d\u306e\u30b5\u30f3\u30d7\u30eb\u3068\u7570\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ed6\u3068\u3042\u308f\u305b\u308b\u3053\u3068\u3002\n\n```\nLoadTileConfigFile /etc/renderd.conf\n# ModTileRenderdSocketName /tmp/osm-renderd \u3053\u306e\u884c\u3002\nModTileRenderdSocketName /var/run/renderd/renderd.sock\n# Timeout before giving up for a tile to be rendered\nModTileRequestTimeout 3\n# Timeout before giving up for a tile to be rendered that is otherwise missing\nModTileMissingRequestTimeout 30\n```\n\n/etc/init.d/renderd\u3092\u8a2d\u7f6e\u3059\u308b\u5834\u5408\u306f\u3053\u3061\u3089\u306e\u624b\u9806\u53c2\u7167\u3002\n\nhttp://switch2osm.org/serving-tiles/manually-building-a-tile-server/\n\n```\nsudo cp  ~/src/mod_tile/debian/renderd.init /etc/init.d/renderd\nsudo chmod u+x /etc/init.d/renderd\n\nEdit the /etc/init.d/renderd file as root \u2013 you\u2019ll need to make a couple of changes to the DAEMON and DAEMON_ARGS lines so that they read:\n\nDAEMON=/usr/local/bin/$NAME\nDAEMON_ARGS=\"-c /usr/local/etc/renderd.conf\"\n```\n\n\u3044\u3063\u305f\u3093root\u3067\u30bf\u30a4\u30eb\u753b\u50cf\u3092\u4f5c\u3063\u3066\u3057\u307e\u3046\u3068\u3001daemon\u5316\u3057\u305f\u6642\u306b\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u3081\u306a\u304f\u3066\u753b\u50cf\u306e\u751f\u6210\u306b\u5931\u6557\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u306e\u3067\u3001daemon\u5316\u3057\u305f\u5f8c\u306f\u3044\u3063\u305f\u3093\u4f5c\u6210\u3057\u305f\u30bf\u30a4\u30eb\u753b\u50cf\u3092\u5168\u524a\u9664\u3059\u308b\u3053\u3068\u3092\u30aa\u30b9\u30b9\u30e1\u3002\n\n\n## osm2pgsql\n```\nsudo apt-get install osm2pgsql\n```\n\n\u8981\u78ba: postgis-1.5\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3057\u307e\u3046\u304c\u5927\u4e08\u592b\u304b\u3002\n\n## osmosis\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3060\u3068\u30010.40.1\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3002\n\n```\nsudo apt-get install osmosis\n```\n\n\u3068\u308a\u3042\u3048\u305a\u306f\u5927\u4e08\u592b\u3060\u3051\u3069\u3001\u6700\u65b0\u7248\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u5916\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3002\n\nhttp://wiki.openstreetmap.org/wiki/Osmosis/Installation\n\n```\nwget http://bretth.dev.openstreetmap.org/osmosis-build/osmosis-latest.tgz\ntar xvfz osmosis-latest.tgz\ncd osmosis-*\nchmod a+x bin/osmosis\nbin/osmosis\n```\n\n### OSM files\nfor test purpose, bbbike extract would be easy choice.\n\nhttp://download.bbbike.org/osm/bbbike/Tokyo/\n\n\n```\nwget http://download.bbbike.org/osm/bbbike/Tokyo/Tokyo.osm.pbf\n```\n\n### import data into postgis database\n\n\u30e6\u30fc\u30b6\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5ea6\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\nGeoFabrik\u306eJapan.-latest.pbf\u306e\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u3066\u30e1\u30e2\u30ea\u306e\u30a2\u30ed\u30b1\u30fc\u30c8\u8abf\u6574\u3057\u306a\u3044\u3068\u30c0\u30e1\u307d\u3044\u3002\u3042\u308b\u3044\u306f slim mode\uff1f\n\n```\nosm2pgsql -G -U postgres -d hdm /home/nyampire/osmfile/Tokyo.osm.pbf --hstore --create\n```\n\nConoHa\u306e\u6700\u5b89\u30d7\u30e9\u30f3(\u30e1\u30e2\u30ea1G)\u3060\u3068\u3001\u30e1\u30e2\u30ea320MB\u5272\u308a\u5f53\u3066\u304f\u3089\u3044\u304c\u7cbe\u4e00\u676f\u307d\u3044\u3002\n\n```\nosm2pgsql -W -G -U postgres -d hdm /home/nyampire/osmfile/japan-latest.osm.pbf --number-processes 2 --slim -C 320 --hstore --create \n```\n\n\n### fonts\n\nMapnik\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(/etc/renderd.conf)\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u30d5\u30a9\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u30b7\u30b9\u30c6\u30e0\u306e\u30d5\u30a9\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/usr/share/fonts/truetype)\u3092\u6307\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3057\u307e\u3063\u305f\u307b\u3046\u304c\u697d\u306a\u6c17\u304c\u3059\u308b\u3002\n\n```\napt-get install fonts-vlgothic\n```\n\n\n## tilemill (optional)\n\n## minutely diff (optional)\n\nhttp://wiki.openstreetmap.org/wiki/Minutely_Mapnik\n\nhttp://wiki.openstreetmap.org/wiki/Planet.osm/diffs\n\n\u3082\u3057\u304b\u3057\u305f\u3089\u6700\u5f37\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 http://switch2osm.org/loading-osm-data/\n\nKomzpa\u4f5c\u6210\u306efetch\u30b3\u30de\u30f3\u30c9 https://github.com/Komzpa/furry-sansa\n\n\u30bf\u30a4\u30eb\u306e\u81ea\u52d5\u66f4\u65b0\u30d0\u30c3\u30c1(mod_tile\u7528) http://wiki.openstreetmap.org/wiki/Howto_real_time_tiles_rendering_with_mapnik_and_mod_python\n\nmod_tile\u5358\u4f53\u3067\u3082\u3044\u3051\u308b\u307d\u3044\u3002state.txt\u3092\u3061\u3083\u3093\u3068\u8aad\u307f\u8fbc\u307e\u305b\u3066\u3042\u3052\u308c\u3070OK http://wiki.openstreetmap.org/wiki/Mod_tile\n\nstate.txt\u306e\u751f\u6210\u306f\u3053\u3053\u304c\u3088\u3055\u3052\u3002\u904e\u53bb\u306estate.txt\u3092\u4f7f\u3063\u3066\u3082\u3001\u91cd\u8907\u3076\u3093\u306f\u81ea\u52d5\u7684\u306b\u6392\u9664\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u5c11\u3057\u904e\u53bb\u306e\u3076\u3093\u304b\u3089\u9069\u7528\u3059\u308b\u306e\u304c\u3088\u3055\u305d\u3046\u3002\n\nhttp://osm.personalwerk.de/replicate-sequences/\n\n\u3068\u308a\u3042\u3048\u305a\u3001 http://wiki.openstreetmap.org/wiki/Minutely_Mapnik \u306e\u624b\u9806\u3067\u3044\u3051\u305d\u3046\u3002state.txt\u306f\u3001\u5b9f\u969b\u306eDump\u3088\u308a\u3082\u904e\u53bb\u306e\u65e5\u4ed8\u3092\u6307\u5b9a\u3057\u3066\u3044\u3066\u3082\u5927\u4e08\u592b\u306a\u306e\u3067\u3001\u6c17\u306b\u305b\u305a\u306b\u751f\u6210\u3057\u3066\u30c8\u30e9\u30a4\u3059\u308c\u3070OK\u3002\n\n\u3042\u3068\u3001~/.pgpass\u306b\u3001PostGIS\u7528\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u5e78\u305b\u306b\u306a\u308c\u308b\u3002\n\n\u3053\u3093\u306a\u304b\u3093\u3058\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u9069\u5f53\u306b\u307e\u308f\u3057\u3066\u3001\u3042\u3068\u306f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u30b3\u30de\u30f3\u30c9\u3092cron\u306b\u653e\u308a\u8fbc\u3093\u3067\u304a\u3051\u3070\u304a\u3063\u3051\u30fc\u3002\n\u3053\u308c\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u53ef\u80fd\u3002\n\n``` shell\n#!/bin/bash\nfor i in {0..100}\ndo\n  osmosis --read-replication-interval workingDirectory=$WORKDIR_OSM --simplify-change --write-xml-change - | osm2pgsql --append --number-processes 2 -G -U gis -d hdm --slim -C 320 --hstore -\ndone\n```\n\n\u30bf\u30a4\u30eb\u306eexpire\u306f\u3001\u3053\u308c\u3092\u304b\u307e\u305b\u308b\u3089\u3057\u3044\u3002\n\nhttp://wiki.openstreetmap.org/wiki/Tile_expire_methods\n\n\n\n", "tags": ["OpenStreetMap"]}