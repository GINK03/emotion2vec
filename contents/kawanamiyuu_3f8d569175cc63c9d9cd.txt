{"tags": ["BEAR.Sunday0.10.5", "PHP", "twig", "BEAR.Package0.12.0", "BEAR.Resource0.13.2"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002BEAR.Sunday\u3067\u306fTwig\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066\u63a1\u7528\u3055\u308c\u3066\u304a\u308a\u3001\u901a\u5e38\u306e\u753b\u9762\u8868\u793a\u3067\u306fPage\u30ea\u30bd\u30fc\u30b9\u306fTwig\u3067HTML\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3057\u304b\u3057\u3001Ajax\u7b49\u3067JSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u6b32\u3057\u3044\u5834\u5408\u306b\u306f\u3001Page\u30ea\u30bd\u30fc\u30b9\u3092JSON\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u6700\u3082\u7c21\u5358\u306a\u5b9f\u88c5\nJSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u6b32\u3057\u3044Page\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u3067\u3001Renderer\u306bJsonRenderer\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nnamespace My\\Project\\Resource\\Page;\n\nuse BEAR\\Package\\Provide\\ResourceView\\JsonRenderer;\nuse BEAR\\Resource\\ResourceObject;\n\nclass Hello extends ResourceObject\n{\n    /**\n     * @param string $name\n     * @return $this\n     */\n    public function onGet($name)\n    {\n        $this['greeting'] = \"hello \" . $name;\n\n        $this->setRenderer(new JsonRenderer($this));\n        return $this;\n    }\n} \n\n\u3053\u308c\u3067\n$.ajax({\n    type: 'GET',\n    url: '/hoge',\n    data: { 'name': 'foobar' },\n    dataType: 'json'\n}).done(function(json) {\n    console.log(json.greeting); // \"hello foobar\"\n})...\n\n\u306e\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u3068\u3001\u3053\u3053\u3067\u3001\u6298\u89d2BEAR.Sunday\u306a\u306e\u3067\u3001AOP\u3067\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\nAOP\u3067\u306e\u5b9f\u88c5\n\n\u69cb\u6210\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u305f\u524d\u63d0\u3067\u3059\u3002\n$ composer create-project bear/skeleton My.Project\n$ cd My.Project\n$ composer install\n\n$ tree My.Project/src\nMy.Project/src \n\u251c\u2500\u2500 Annotation\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ResponseJson.php \u2605\u8ffd\u52a0\n\u251c\u2500\u2500 App.php\n\u251c\u2500\u2500 Interceptor\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ResponseJson.php \u2605\u8ffd\u52a0\n\u251c\u2500\u2500 Module\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 App\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Aspect.php \u2605\u7de8\u96c6\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Dependency.php\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 AppModule.php \u2605\u7de8\u96c6\n\u2514\u2500\u2500 Resource\n    \u251c\u2500\u2500 App\n    \u2514\u2500\u2500 Page\n        \u251c\u2500\u2500 Index.php\n        \u251c\u2500\u2500 Index.twig\n        \u2514\u2500\u2500 Hello.php \u2605\u8ffd\u52a0\n\n\nPage\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\n\nsrc/Resource/Page/Hello.php\n\u4e0b\u8a18\u306e\u3088\u3046\u306bPage\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u306bResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067JSON\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u308b\u3053\u3068\u3092\u76ee\u6307\u3057\u307e\u3059\u3002\nnamespace My\\Project\\Resource\\Page;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Annotation\\ResponseJson;\n\nclass Hello extends ResourceObject\n{\n    /**\n     * @ResponseJson\n     *\n     * @param string $name\n     * @return $this\n     */\n    public function onGet($name)\n    {\n        $this['greeting'] = \"hello \" . $name;\n        return $this;\n    }\n} \n\n\nAnnotation\n\nsrc/Annotation/ResponseJson.php\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u5bfe\u8c61\uff08@Target\uff09\u306fMETHOD\u3067\u3059\u3002\nnamespace My\\Project\\Annotation;\n\nuse BEAR\\Sunday\\Annotation\\AnnotationInterface;\n\n/**\n * ResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\n *\n * @Annotation\n * @Target(\"METHOD\")\n */\nfinal class ResponseJson implements AnnotationInterface\n{\n} \n\n\nInterceptor\n\nsrc/Interceptor/ResponseJson.php\n\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067Page\u30ea\u30bd\u30fc\u30b9\u306eRenderer\u306bJsonRenderer\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nnamespace My\\Project\\Interceptor;\n\nuse BEAR\\Package\\Provide\\ResourceView\\JsonRenderer;\nuse BEAR\\Resource\\ResourceObject;\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Aop\\MethodInvocation;\n\n/**\n * ResponseJson\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\n */\nclass ResponseJson implements MethodInterceptor\n{\n    /**\n     * {@inheritdoc}\n     */\n    public function invoke(MethodInvocation $invocation)\n    {\n        /** @var ResourceObject $page */\n        $page = $invocation->getThis();\n        $page->setRenderer(new JsonRenderer($page));\n        return $invocation->proceed();\n    }\n}\n\n\nAOP\u306e\u8a2d\u5b9a\n\nsrc/Module/App/Aspect.php\nResourceObject\u30af\u30e9\u30b9\u306e\u30b5\u30d6\u30af\u30e9\u30b9\uff08\uff1dPage\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\uff09\u306e\u3001ResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u306b\u5bfe\u3057\u3066\u3001\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u3092\u675f\u7e1b\u3057\u307e\u3059\u3002\nnamespace My\\Project\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    protected function configure()\n    {\n        $this->installResponseJson();\n    }\n\n    private function installResponseJson()\n    {\n        $this->bindInterceptor(\n            $this->matcher->subclassesOf('BEAR\\Resource\\ResourceObject'),\n            $this->matcher->annotatedWith('My\\Project\\Annotation\\ResponseJson'),\n            [$this->requestInjection('My\\Project\\Interceptor\\ResponseJson')]\n        );\n    }\n}\n\n\nsrc/Module/AppModule.php\n\u2605\u5370\u306e\u7b87\u6240\u3092\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\u3057\u3001\u4e0a\u8a18\u306eAOP\u306e\u8a2d\u5b9a\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n\u203bAspect#installResponseJson\u306e\u51e6\u7406\u3092AppModule#configure\u306b\u76f4\u63a5\u66f8\u3044\u3066\u3082\u540c\u3058\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002\nnamespace My\\Project\\Module;\n\nuse BEAR\\Package\\Module\\Package\\StandardPackageModule;\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\n\nclass AppModule extends AbstractModule\n{\n        :\n        : \n\n    protected function configure()\n    {\n        $this->install(new StandardPackageModule('My\\Project', $this->context, dirname(dirname(__DIR__))));\n\n        // override module\n        // $this->install(new SmartyModule($this));\n\n        // $this->install(new AuraViewModule($this));\n\n        // install application dependency\n        // $this->install(new App\\Dependency);\n\n        // install application aspect\n        $this->install(new App\\Aspect($this)); \u2605\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\n    }\n}\n\n\u3053\u308c\u3067ResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092Page\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u4ed8\u52a0\u3059\u308b\u3060\u3051\u3067\u3001JSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5f97\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3057\u307e\u3057\u305f\u3002\n\n[BEAR.Sunday](http://bearsunday.github.io/index.html)\u3067\u306f[Twig](http://twig.sensiolabs.org/)\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066\u63a1\u7528\u3055\u308c\u3066\u304a\u308a\u3001\u901a\u5e38\u306e\u753b\u9762\u8868\u793a\u3067\u306fPage\u30ea\u30bd\u30fc\u30b9\u306fTwig\u3067HTML\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3057\u304b\u3057\u3001Ajax\u7b49\u3067JSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u6b32\u3057\u3044\u5834\u5408\u306b\u306f\u3001Page\u30ea\u30bd\u30fc\u30b9\u3092JSON\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## \u6700\u3082\u7c21\u5358\u306a\u5b9f\u88c5\n\nJSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u6b32\u3057\u3044Page\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u3067\u3001Renderer\u306b```JsonRenderer```\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```php\nnamespace My\\Project\\Resource\\Page;\n\nuse BEAR\\Package\\Provide\\ResourceView\\JsonRenderer;\nuse BEAR\\Resource\\ResourceObject;\n\nclass Hello extends ResourceObject\n{\n\t/**\n\t * @param string $name\n\t * @return $this\n\t */\n\tpublic function onGet($name)\n\t{\n\t\t$this['greeting'] = \"hello \" . $name;\n\n\t\t$this->setRenderer(new JsonRenderer($this));\n\t\treturn $this;\n\t}\n} \n```\n\n\u3053\u308c\u3067\n\n```javascript\n$.ajax({\n\ttype: 'GET',\n\turl: '/hoge',\n\tdata: { 'name': 'foobar' },\n\tdataType: 'json'\n}).done(function(json) {\n\tconsole.log(json.greeting); // \"hello foobar\"\n})...\n```\n\n\u306e\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n\u3068\u3001\u3053\u3053\u3067\u3001\u6298\u89d2BEAR.Sunday\u306a\u306e\u3067\u3001```AOP```\u3067\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3059\u3002\n\n## AOP\u3067\u306e\u5b9f\u88c5\n\n### \u69cb\u6210\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u305f\u524d\u63d0\u3067\u3059\u3002\n\n```bash\n$ composer create-project bear/skeleton My.Project\n$ cd My.Project\n$ composer install\n```\n\n```bash\n$ tree My.Project/src\nMy.Project/src \n\u251c\u2500\u2500 Annotation\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ResponseJson.php \u2605\u8ffd\u52a0\n\u251c\u2500\u2500 App.php\n\u251c\u2500\u2500 Interceptor\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 ResponseJson.php \u2605\u8ffd\u52a0\n\u251c\u2500\u2500 Module\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 App\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 Aspect.php \u2605\u7de8\u96c6\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 Dependency.php\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 AppModule.php \u2605\u7de8\u96c6\n\u2514\u2500\u2500 Resource\n    \u251c\u2500\u2500 App\n    \u2514\u2500\u2500 Page\n        \u251c\u2500\u2500 Index.php\n        \u251c\u2500\u2500 Index.twig\n        \u2514\u2500\u2500 Hello.php \u2605\u8ffd\u52a0\n```\n\n\n### Page\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\n\n#### src/Resource/Page/Hello.php\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306bPage\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u306b```ResponseJson```\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067JSON\u8868\u73fe\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u308b\u3053\u3068\u3092\u76ee\u6307\u3057\u307e\u3059\u3002\n\n```php\nnamespace My\\Project\\Resource\\Page;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Annotation\\ResponseJson;\n\nclass Hello extends ResourceObject\n{\n\t/**\n\t * @ResponseJson\n\t *\n\t * @param string $name\n\t * @return $this\n\t */\n\tpublic function onGet($name)\n\t{\n\t\t$this['greeting'] = \"hello \" . $name;\n\t\treturn $this;\n\t}\n} \n```\n\n\n### Annotation \n\n#### src/Annotation/ResponseJson.php\n\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u5bfe\u8c61\uff08```@Target```\uff09\u306f```METHOD```\u3067\u3059\u3002\n\n```php\nnamespace My\\Project\\Annotation;\n\nuse BEAR\\Sunday\\Annotation\\AnnotationInterface;\n\n/**\n * ResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\n *\n * @Annotation\n * @Target(\"METHOD\")\n */\nfinal class ResponseJson implements AnnotationInterface\n{\n} \n```\n\n### Interceptor\n\n#### src/Interceptor/ResponseJson.php\n\n\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067Page\u30ea\u30bd\u30fc\u30b9\u306eRenderer\u306b```JsonRenderer```\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```php\nnamespace My\\Project\\Interceptor;\n\nuse BEAR\\Package\\Provide\\ResourceView\\JsonRenderer;\nuse BEAR\\Resource\\ResourceObject;\nuse Ray\\Aop\\MethodInterceptor;\nuse Ray\\Aop\\MethodInvocation;\n\n/**\n * ResponseJson\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\n */\nclass ResponseJson implements MethodInterceptor\n{\n\t/**\n\t * {@inheritdoc}\n\t */\n\tpublic function invoke(MethodInvocation $invocation)\n\t{\n\t\t/** @var ResourceObject $page */\n\t\t$page = $invocation->getThis();\n\t\t$page->setRenderer(new JsonRenderer($page));\n\t\treturn $invocation->proceed();\n\t}\n}\n```\n\n### AOP\u306e\u8a2d\u5b9a\n\n#### src/Module/App/Aspect.php\n\nResourceObject\u30af\u30e9\u30b9\u306e\u30b5\u30d6\u30af\u30e9\u30b9\uff08\uff1dPage\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\uff09\u306e\u3001ResponseJson\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u306b\u5bfe\u3057\u3066\u3001\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc\u3092\u3092\u675f\u7e1b\u3057\u307e\u3059\u3002\n\n```php\nnamespace My\\Project\\Module\\App;\n\nuse BEAR\\Package;\nuse Ray\\Di\\AbstractModule;\n\nclass Aspect extends AbstractModule\n{\n    protected function configure()\n    {\n\t\t$this->installResponseJson();\n    }\n\n\tprivate function installResponseJson()\n\t{\n\t\t$this->bindInterceptor(\n\t\t\t$this->matcher->subclassesOf('BEAR\\Resource\\ResourceObject'),\n\t\t\t$this->matcher->annotatedWith('My\\Project\\Annotation\\ResponseJson'),\n\t\t\t[$this->requestInjection('My\\Project\\Interceptor\\ResponseJson')]\n\t\t);\n\t}\n}\n```\n\n#### src/Module/AppModule.php\n\n\u2605\u5370\u306e\u7b87\u6240\u3092\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\u3057\u3001\u4e0a\u8a18\u306eAOP\u306e\u8a2d\u5b9a\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n\n\u203bAspect#installResponseJson\u306e\u51e6\u7406\u3092AppModule#configure\u306b\u76f4\u63a5\u66f8\u3044\u3066\u3082\u540c\u3058\u3088\u3046\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n```php\nnamespace My\\Project\\Module;\n\nuse BEAR\\Package\\Module\\Package\\StandardPackageModule;\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\n\nclass AppModule extends AbstractModule\n{\n\t\t:\n\t\t: \n\n    protected function configure()\n    {\n        $this->install(new StandardPackageModule('My\\Project', $this->context, dirname(dirname(__DIR__))));\n\n        // override module\n        // $this->install(new SmartyModule($this));\n\n        // $this->install(new AuraViewModule($this));\n\n        // install application dependency\n        // $this->install(new App\\Dependency);\n\n\t\t// install application aspect\n\t\t$this->install(new App\\Aspect($this)); \u2605\u30b3\u30e1\u30f3\u30c8\u30a4\u30f3\n    }\n}\n```\n\n\n\n\u3053\u308c\u3067```ResponseJson```\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092Page\u30ea\u30bd\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u4ed8\u52a0\u3059\u308b\u3060\u3051\u3067\u3001JSON\u5f62\u5f0f\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5f97\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3057\u307e\u3057\u305f\u3002\n"}