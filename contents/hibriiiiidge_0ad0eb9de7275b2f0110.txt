{"context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\n\u89aaselect\u30bf\u30b0\u3067\u9078\u629e\u3055\u308c\u305f\u9805\u76ee\u306b\u30ab\u30c6\u30b4\u30e9\u30a4\u30ba\u3055\u308c\u305f\u5b50select\u30bf\u30b0\u3092Ajax\u3067\u751f\u6210\u3059\u308b\n\n\u4f8b\uff09\u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc(TOYOTA,NISSAN,HONDA)\u306b\u9023\u52d5\u3057\u305f\u5404\u30e1\u30fc\u30ab\u30fc\u306e\u8eca\u7a2e\u306eselect\u30bf\u30b0\u3092\u751f\u6210\n*\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u306f\u5b9f\u88c5\u51fa\u6765\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n\n\n\n\n\u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc maker \u30c6\u30fc\u30d6\u30eb\uff08\u89aa\uff09\n\n\n\n\nid\nmaker_name\n\n\n\n\n1\nTOYOTA\n\n\n2\nNISSAN\n\n\n3\nHONDA\n\n\n\n\n\u8eca\u7a2e\u30c6\u30fc\u30d6\u30eb\u3000model \u30c6\u30fc\u30d6\u30eb\uff08\u5b50\uff09\n\n\n\n\nid\nmaker_id\nmodel_name\n\n\n\n\n1\n1\n\u30a2\u30af\u30a2\n\n\n2\n1\n\u30a2\u30eb\u30d5\u30a9\u30fc\u30c9\n\n\n3\n1\n\u30ab\u30ed\u30fc\u30e9\n\n\n4\n1\n\u30d7\u30ea\u30a6\u30b9\n\n\n5\n1\n\u30af\u30e9\u30a6\u30f3\n\n\n6\n2\n\u30b8\u30e5\u30fc\u30af\n\n\n7\n2\n\u30ce\u30fc\u30c8\n\n\n8\n2\n\u30ad\u30e5\u30fc\u30d6\n\n\n9\n2\n\u30bb\u30ec\u30ca\n\n\n10\n3\n\u30aa\u30c7\u30c3\u30bb\u30a4\n\n\n11\n3\n\u30d5\u30a3\u30c3\u30c8\n\n\n12\n3\nN-BOX\n\n\n13\n3\n\u30b9\u30c6\u30c3\u30d7\u30ef\u30b4\u30f3\n\n\n14\n3\nCR-V\n\n\n15\n3\nCR-Z\n\n\n\n\nindex.php\n<?php\n  //DB\u3078\u63a5\u7d9a\n  try {\n    $dsn = 'mysql:host=localhost;dbname=car_maker;charset=utf8';\n    $user = 'username'; //root\n    $pass = 'password'; //root\n    $pdo = new PDO($dsn, $user, $pass, array(PDO::ATTR_EMULATE_PREPARES => false));\n  } catch (Exception $e) {\n    exit('\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u5931\u6557'.$e->getMessage());\n  }\n  //maker\u30c6\u30fc\u30d6\u30eb \u304b\u3089\u5024\u3092\u53d6\u5f97\u3057\u3001 id \u3068 name \u3092 $maker_list\u914d\u5217 \u306b\u683c\u7d0d\n  $sql = \"SELECT * FROM maker\";\n  $stmt = $pdo->query($sql);\n  $maker_list = array();\n  while($row = $stmt -> fetch(PDO::FETCH_ASSOC)){\n    $maker_list[$row['id']] = $row['name'];\n  }\n?>\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <script src=\"js/jquery-1.12.4.min.js\" charset=\"utf-8\"></script>\n    <script type=\"text/javascript\">\n      $(function(){\n        //select\u30bf\u30b0\uff08\u89aa\uff09 \u304c\u5909\u66f4\u3055\u308c\u305f\u5834\u5408\n        $('[name=car_maker]').on('change', function(){\n          var maker_val = $(this).val();\n\n          //maker_val\u5024 \u3092 select.php \u3078\u6e21\u3059\n          $.ajax({\n            url: \"select.php\",\n            type: \"POST\",\n            dataType: 'json',\n            data: {\n              maker_id: maker_val\n            }\n          })\n          .done(function(data){\n            //select\u30bf\u30b0\uff08\u5b50\uff09 \u306e option\u5024 \u3092\u4e00\u65e6\u524a\u9664\n            $('.car_model option').remove();\n            //select.php \u304b\u3089\u623b\u3063\u3066\u6765\u305f data \u306e\u5024\u3092\u305d\u308c\u305d\u308c option\u30bf\u30b0 \u3068\u3057\u3066\u751f\u6210\u3057\u3001\n            // .car_model \u306b option\u30bf\u30b0 \u3092\u8ffd\u52a0\u3059\u308b\n            $.each(data, function(id, name){\n              $('.car_model').append($('<option>').text(name).attr('value', id));\n            });\n          })\n          .fail(function(){\n            console.log(\"\u5931\u6557\");\n          });\n\n        });\n      });\n    </script>\n    <title>Ajax Sample</title>\n  </head>\n  <body>\n    <h1>Ajax Sample</h1>\n      <div class=\"\">\n        <span>\u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc\uff1a</span>\n        <select class=\"car_maker\" name=\"car_maker\">\n          <option>\u9078\u629e\u3057\u3066\u4e0b\u3055\u3044</option>\n          <?php foreach($maker_list as $key => $maker_name){\n            echo '<option name=\"\" value=\"'.$key.'\">'.$maker_name.'</option>';\n          }?>\n        </select>\n        <span>\u8eca\u7a2e\uff1a</span>\n        <select class=\"car_model\" name=\"car_model\">\n          <option class=\"\">\u9078\u629e\u3057\u3066\u4e0b\u3055\u3044</option>\n        </select>\n      </div>\n  </body>\n</html>\n\n\n\nselect.php\n<?php\n  //\u76f4\u63a5\u306e\u30da\u30fc\u30b8\u9077\u79fb\u3092\u963b\u6b62\n  $request = isset($_SERVER['HTTP_X_REQUESTED_WITH']) ? strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) : '';\n  if($request !== 'xmlhttprequest') exit;\n  //DB\u3078\u306e\u63a5\u7d9a\n  //\u672c\u6765\u306f db_connect\u95a2\u6570 \u3092\u4f5c\u6210\u3057\u3066\u3001DRY\u306b\u3057\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\u3002\n  try {\n    $dsn = 'mysql:host=localhost;dbname=car_model;charset=utf8';\n    $user = 'username';\n    $pass = 'password';\n    $pdo = new PDO($dsn, $user, $pass, array(PDO::ATTR_EMULATE_PREPARES => false));\n  }\n  catch (Exception $e) {\n    exit('\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u5931\u6557'.$e->getMessage());\n  }\n  //Ajax\u3067\u6e21\u3063\u3066\u304d\u305f\u5024\u3092\u3082\u3068\u306b model\u30c6\u30fc\u30d6\u30eb \u304b\u3089\u8a72\u5f53\u3059\u308b model \u3092\u62bd\u51fa\n  $maker_no = $_POST['maker_no'];\n  $sql = 'SELECT * FROM model WHERE maker_id = :maker_id';\n  $stmt=$pdo->prepare($sql);\n  $stmt->bindValue(':maker_id', (int)$maker_no, PDO::PARAM_INT);\n  $stmt->execute();\n\n  //\u62bd\u51fa\u3055\u308c\u305f\u5024\u3092 $model_list\u914d\u5217 \u306b\u683c\u7d0d\n  $model_list = array();\n  while($row = $stmt -> fetch(PDO::FETCH_ASSOC)){\n    $model_list[$row['id']] = $row['name'];\n  }\n  header('Content-Type: application/json');\n  //json\u5f62\u5f0f\u3067 index.php \u3078\u30d0\u30c3\u30af\u3059\u308b\n  echo json_encode($model_list);\n ?>\n\n\n#\u3084\u308a\u305f\u3044\u3053\u3068\n- \u89aaselect\u30bf\u30b0\u3067\u9078\u629e\u3055\u308c\u305f\u9805\u76ee\u306b\u30ab\u30c6\u30b4\u30e9\u30a4\u30ba\u3055\u308c\u305f\u5b50select\u30bf\u30b0\u3092Ajax\u3067\u751f\u6210\u3059\u308b\n\n\u4f8b\uff09\u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc(TOYOTA,NISSAN,HONDA)\u306b\u9023\u52d5\u3057\u305f\u5404\u30e1\u30fc\u30ab\u30fc\u306e\u8eca\u7a2e\u306eselect\u30bf\u30b0\u3092\u751f\u6210\n\n*\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u306f\u5b9f\u88c5\u51fa\u6765\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n\n<img width=\"613\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-04 20.52.15.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/114886/addd10e0-bfb7-d1a2-b921-32af78176d5e.png\">\n\n<img width=\"596\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-04 20.52.30.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/114886/7245e11b-6a20-bfd8-c6f6-1e47bffb2e29.png\">\n\n<img width=\"562\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-04 20.52.43.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/114886/1c469c57-534a-0048-6c27-7ccb3d7a0ca1.png\">\n\n\n\n\n- \u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc maker \u30c6\u30fc\u30d6\u30eb\uff08\u89aa\uff09\n\n| id |  maker_name  |\n|:--:|:-----------:|\n| 1  |  TOYOTA     |\n| 2  |  NISSAN     |\n| 3  |  HONDA      |\n\n\n- \u8eca\u7a2e\u30c6\u30fc\u30d6\u30eb\u3000model \u30c6\u30fc\u30d6\u30eb\uff08\u5b50\uff09\n\n| id | maker_id | model_name |\n|:-:|:-:|:---------:|\n| 1 | 1 | \u30a2\u30af\u30a2 |\n| 2 | 1 | \u30a2\u30eb\u30d5\u30a9\u30fc\u30c9 |\n| 3 | 1 | \u30ab\u30ed\u30fc\u30e9 |\n| 4 | 1 | \u30d7\u30ea\u30a6\u30b9 |\n| 5 | 1 | \u30af\u30e9\u30a6\u30f3 |\n| 6 | 2 | \u30b8\u30e5\u30fc\u30af |\n| 7 | 2 | \u30ce\u30fc\u30c8 |\n| 8 | 2 | \u30ad\u30e5\u30fc\u30d6 |\n| 9 | 2 | \u30bb\u30ec\u30ca |\n| 10 | 3 | \u30aa\u30c7\u30c3\u30bb\u30a4 |\n| 11 | 3 | \u30d5\u30a3\u30c3\u30c8 |\n| 12 | 3 | N-BOX |\n| 13 | 3 | \u30b9\u30c6\u30c3\u30d7\u30ef\u30b4\u30f3 |\n| 14 | 3 | CR-V |\n| 15 | 3 | CR-Z |\n\n```index.php\n<?php\n  //DB\u3078\u63a5\u7d9a\n  try {\n    $dsn = 'mysql:host=localhost;dbname=car_maker;charset=utf8';\n    $user = 'username'; //root\n    $pass = 'password'; //root\n    $pdo = new PDO($dsn, $user, $pass, array(PDO::ATTR_EMULATE_PREPARES => false));\n  } catch (Exception $e) {\n    exit('\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u5931\u6557'.$e->getMessage());\n  }\n  //maker\u30c6\u30fc\u30d6\u30eb \u304b\u3089\u5024\u3092\u53d6\u5f97\u3057\u3001 id \u3068 name \u3092 $maker_list\u914d\u5217 \u306b\u683c\u7d0d\n  $sql = \"SELECT * FROM maker\";\n  $stmt = $pdo->query($sql);\n  $maker_list = array();\n  while($row = $stmt -> fetch(PDO::FETCH_ASSOC)){\n    $maker_list[$row['id']] = $row['name'];\n  }\n?>\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <script src=\"js/jquery-1.12.4.min.js\" charset=\"utf-8\"></script>\n    <script type=\"text/javascript\">\n      $(function(){\n        //select\u30bf\u30b0\uff08\u89aa\uff09 \u304c\u5909\u66f4\u3055\u308c\u305f\u5834\u5408\n        $('[name=car_maker]').on('change', function(){\n          var maker_val = $(this).val();\n\n          //maker_val\u5024 \u3092 select.php \u3078\u6e21\u3059\n          $.ajax({\n            url: \"select.php\",\n            type: \"POST\",\n            dataType: 'json',\n            data: {\n              maker_id: maker_val\n            }\n          })\n          .done(function(data){\n            //select\u30bf\u30b0\uff08\u5b50\uff09 \u306e option\u5024 \u3092\u4e00\u65e6\u524a\u9664\n            $('.car_model option').remove();\n            //select.php \u304b\u3089\u623b\u3063\u3066\u6765\u305f data \u306e\u5024\u3092\u305d\u308c\u305d\u308c option\u30bf\u30b0 \u3068\u3057\u3066\u751f\u6210\u3057\u3001\n            // .car_model \u306b option\u30bf\u30b0 \u3092\u8ffd\u52a0\u3059\u308b\n            $.each(data, function(id, name){\n              $('.car_model').append($('<option>').text(name).attr('value', id));\n            });\n          })\n          .fail(function(){\n            console.log(\"\u5931\u6557\");\n          });\n\n        });\n      });\n    </script>\n    <title>Ajax Sample</title>\n  </head>\n  <body>\n    <h1>Ajax Sample</h1>\n      <div class=\"\">\n        <span>\u81ea\u52d5\u8eca\u30e1\u30fc\u30ab\u30fc\uff1a</span>\n        <select class=\"car_maker\" name=\"car_maker\">\n          <option>\u9078\u629e\u3057\u3066\u4e0b\u3055\u3044</option>\n          <?php foreach($maker_list as $key => $maker_name){\n            echo '<option name=\"\" value=\"'.$key.'\">'.$maker_name.'</option>';\n          }?>\n        </select>\n        <span>\u8eca\u7a2e\uff1a</span>\n        <select class=\"car_model\" name=\"car_model\">\n          <option class=\"\">\u9078\u629e\u3057\u3066\u4e0b\u3055\u3044</option>\n        </select>\n      </div>\n  </body>\n</html>\n```\n\n```select.php\n<?php\n  //\u76f4\u63a5\u306e\u30da\u30fc\u30b8\u9077\u79fb\u3092\u963b\u6b62\n  $request = isset($_SERVER['HTTP_X_REQUESTED_WITH']) ? strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) : '';\n  if($request !== 'xmlhttprequest') exit;\n  //DB\u3078\u306e\u63a5\u7d9a\n  //\u672c\u6765\u306f db_connect\u95a2\u6570 \u3092\u4f5c\u6210\u3057\u3066\u3001DRY\u306b\u3057\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\u3002\n  try {\n    $dsn = 'mysql:host=localhost;dbname=car_model;charset=utf8';\n    $user = 'username';\n    $pass = 'password';\n    $pdo = new PDO($dsn, $user, $pass, array(PDO::ATTR_EMULATE_PREPARES => false));\n  }\n  catch (Exception $e) {\n    exit('\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u5931\u6557'.$e->getMessage());\n  }\n  //Ajax\u3067\u6e21\u3063\u3066\u304d\u305f\u5024\u3092\u3082\u3068\u306b model\u30c6\u30fc\u30d6\u30eb \u304b\u3089\u8a72\u5f53\u3059\u308b model \u3092\u62bd\u51fa\n  $maker_no = $_POST['maker_no'];\n  $sql = 'SELECT * FROM model WHERE maker_id = :maker_id';\n  $stmt=$pdo->prepare($sql);\n  $stmt->bindValue(':maker_id', (int)$maker_no, PDO::PARAM_INT);\n  $stmt->execute();\n\n  //\u62bd\u51fa\u3055\u308c\u305f\u5024\u3092 $model_list\u914d\u5217 \u306b\u683c\u7d0d\n  $model_list = array();\n  while($row = $stmt -> fetch(PDO::FETCH_ASSOC)){\n    $model_list[$row['id']] = $row['name'];\n  }\n  header('Content-Type: application/json');\n  //json\u5f62\u5f0f\u3067 index.php \u3078\u30d0\u30c3\u30af\u3059\u308b\n  echo json_encode($model_list);\n ?>\n```\n\n\n \n\n\n\n\n", "tags": ["Ajax", "PHP", "select"]}