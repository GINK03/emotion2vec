{"tags": ["C#", "xUnit", "\u30c6\u30b9\u30c8", "TDD"], "context": "\n\n\u6982\u8981\n.NET Core\u306e\u958b\u767a\u3067xUnit\u3092\u5229\u7528\u3057\u3066\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u3057\u3066\u3044\u308b\u3068\u304d\u3001\u30c6\u30b9\u30c8\u306e\u4e2d\u304b\u3089appsettings.json\u3084UserSecrets\u306e\u8a2d\u5b9a\u5024\u3092\u8aad\u307f\u8fbc\u307f\u305f\u3044\u3001\u3068\u3044\u3046\u30cb\u30fc\u30ba\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nxUnit\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u304cIClassFixture<TFixture>\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u3068\u3001xUnit runner\u304c\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u524d\u306bTFixture\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u6e21\u3057\u3066\u304f\u308c\u307e\u30591\uff08\u4ed6\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u8a00\u3046\u3068\u3053\u308d\u306esetup()\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u60f3\u50cf\u3057\u3066\u3082\u3089\u3048\u308c\u3070\uff09\u3002\n\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u3001TFixture\u5074\u3067appsettings.json\u3084UserSecrets\u3092\u8aad\u307f\u8fbc\u307f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306b\u6e21\u3059\u3088\u3046\u306a\u5b9f\u88c5\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u5b9f\u88c5\u4f8b\n\nappsettings.json\u3084UserSecrets\u3092\u8aad\u307f\u8fbc\u3080TFixture\u306e\u30b3\u30fc\u30c9\u4f8b\nusing Microsoft.Extensions.Configuration;\nusing Microsoft.Extensions.PlatformAbstractions;\n\npublic class AppSettingsFixture : IDisposable\n{\n    public IConfigurationRoot Configuration { get; private set; }\n    public AppSettingsFixture()\n    {\n        var builder = new ConfigurationBuilder()\n                .SetBasePath(PlatformServices.Default.Application.ApplicationBasePath)\n                .AddJsonFile(\"appsettings.json\", optional: false, reloadOnChange: true)\n                .AddEnvironmentVariables()\n                .AddUserSecrets()\n                ;\n\n        Configuration = builder.Build();\n    }\n\n    public void Dispose()\n    {\n        Configuration = null;\n    }\n}\n\n\nappsettings.json\u3068UserSecrets\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bproject.json\u306b\u5909\u66f4\u3092\u52a0\u3048\u308b\n.NET Core RC2\u306eUserSecrets\u306e\u5b9f\u88c5\u3067\u306f\u3001UserSecrets\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306bproject.json\u5185\u306euserSecretsId\u8a2d\u5b9a\u5024\u304c\u5fc5\u8981\u3068\u306a\u3063\u3066\u3044\u307e\u30592\u3002\n\u305d\u306e\u305f\u3081\u3001project.json\u3068appsettings.json\u306e2\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u30d3\u30eb\u30c9\u306eOutput\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3055\u308c\u308b\u3088\u3046\u306b\u3001project.json\u306ebuildOptions:copyToOutput\u8a2d\u5b9a\u5024\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n{\n  \"buildOptions\": {\n    \"copyToOutput\": {\n      \"include\": [ \"appsettings.json\", \"project.json\" ]\n    }\n}\n\n\n\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5074\u3067AppSettingsFixture\u3092\u53d7\u3051\u53d6\u308b\npublic class SomeTest: IClassFixture<AppSettingsFixture>\n{\n    private readonly AppSettingsFixture _appsettingsFixture;\n\n    public SomeTest(AppSettingsFixture _appsettings)\n    {\n        _appsettingsFixture = _appsettings;\n    }\n\n    [Fact]\n    public void ItShouldWork()\n    {\n        // \u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5185\u3067\u6b21\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3002\n        // _appsettingsFixture.Configuration\n    }\n}\n\n\n\u5099\u8003\n\n\n\n\nShared Context between Tests - Class Fixtures; when you want to create a single test context and share it among all the tests in the class, and have it cleaned up after all the tests in the class have finished.\u00a0\u21a9\n\n\nUsing user secrets with dotnet cli requires publishing the project.json file\u00a0\u21a9\n\n\n\n# \u6982\u8981\n\n.NET Core\u306e\u958b\u767a\u3067[xUnit](https://xunit.github.io/)\u3092\u5229\u7528\u3057\u3066\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3092\u3057\u3066\u3044\u308b\u3068\u304d\u3001\u30c6\u30b9\u30c8\u306e\u4e2d\u304b\u3089appsettings.json\u3084[UserSecrets](https://docs.asp.net/en/latest/security/app-secrets.html)\u306e\u8a2d\u5b9a\u5024\u3092\u8aad\u307f\u8fbc\u307f\u305f\u3044\u3001\u3068\u3044\u3046\u30cb\u30fc\u30ba\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nxUnit\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u304c`IClassFixture<TFixture>`\u3092\u5b9f\u88c5\u3057\u3066\u3044\u308b\u3068\u3001xUnit runner\u304c\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u524d\u306b`TFixture`\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5316\u3057\u3066\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u6e21\u3057\u3066\u304f\u308c\u307e\u3059[^1]\uff08\u4ed6\u306e\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u8a00\u3046\u3068\u3053\u308d\u306e`setup()`\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u60f3\u50cf\u3057\u3066\u3082\u3089\u3048\u308c\u3070\uff09\u3002\n\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u3001`TFixture`\u5074\u3067appsettings.json\u3084UserSecrets\u3092\u8aad\u307f\u8fbc\u307f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306b\u6e21\u3059\u3088\u3046\u306a\u5b9f\u88c5\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u5b9f\u88c5\u4f8b\n\n## appsettings.json\u3084UserSecrets\u3092\u8aad\u307f\u8fbc\u3080TFixture\u306e\u30b3\u30fc\u30c9\u4f8b\n\n```csharp\nusing Microsoft.Extensions.Configuration;\nusing Microsoft.Extensions.PlatformAbstractions;\n\npublic class AppSettingsFixture : IDisposable\n{\n\tpublic IConfigurationRoot Configuration { get; private set; }\n\tpublic AppSettingsFixture()\n\t{\n\t    var builder = new ConfigurationBuilder()\n\t            .SetBasePath(PlatformServices.Default.Application.ApplicationBasePath)\n\t            .AddJsonFile(\"appsettings.json\", optional: false, reloadOnChange: true)\n\t            .AddEnvironmentVariables()\n\t            .AddUserSecrets()\n\t            ;\n\n\t    Configuration = builder.Build();\n\t}\n\n\tpublic void Dispose()\n\t{\n\t    Configuration = null;\n\t}\n}\n```\n\n\n## appsettings.json\u3068UserSecrets\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bproject.json\u306b\u5909\u66f4\u3092\u52a0\u3048\u308b\n\n[.NET Core RC2](https://dot.net/)\u306eUserSecrets\u306e\u5b9f\u88c5\u3067\u306f\u3001UserSecrets\u3092\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306bproject.json\u5185\u306e`userSecretsId`\u8a2d\u5b9a\u5024\u304c\u5fc5\u8981\u3068\u306a\u3063\u3066\u3044\u307e\u3059[^2]\u3002\n\u305d\u306e\u305f\u3081\u3001project.json\u3068appsettings.json\u306e2\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u30d3\u30eb\u30c9\u306eOutput\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3055\u308c\u308b\u3088\u3046\u306b\u3001project.json\u306ebuildOptions:copyToOutput\u8a2d\u5b9a\u5024\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```json\n{\n  \"buildOptions\": {\n    \"copyToOutput\": {\n      \"include\": [ \"appsettings.json\", \"project.json\" ]\n    }\n}\n```\n\n\n## \u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5074\u3067AppSettingsFixture\u3092\u53d7\u3051\u53d6\u308b\n\n```csharp\npublic class SomeTest: IClassFixture<AppSettingsFixture>\n{\n\tprivate readonly AppSettingsFixture _appsettingsFixture;\n\n\tpublic SomeTest(AppSettingsFixture _appsettings)\n\t{\n\t    _appsettingsFixture = _appsettings;\n\t}\n\n\t[Fact]\n\tpublic void ItShouldWork()\n\t{\n\t    // \u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u5185\u3067\u6b21\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3002\n\t    // _appsettingsFixture.Configuration\n\t}\n}\n```\n\n\n# \u5099\u8003\n\n[^1]: [Shared Context between Tests - Class Fixtures; when you want to create a single test context and share it among all the tests in the class, and have it cleaned up after all the tests in the class have finished.](https://xunit.github.io/docs/shared-context.html#class-fixture)\n[^2]: [Using user secrets with dotnet cli requires publishing the project.json file](https://github.com/aspnet/UserSecrets/issues/62)\n"}