{"tags": ["Bluemix", "Node.js", "Express", "ejs", "watson-developer-cloud"], "context": "\u524d\u56de\u304b\u3089\u306e\u7d9a\u304d\u3067\u3001STT\u3067\u97f3\u58f0\u8a8d\u8b58Javascript\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n3. STT\u3067\u97f3\u58f0\u8a8d\u8b58Javascript\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0\nwav\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3001STT\u306b\u97f3\u58f0\u8a8d\u8b58\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eapp.js\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u305f\u3081\u306e\u30ed\u30b8\u30c3\u30af\u306b\u3064\u3044\u3066\u306f\u3001\u5049\u5927\u306a\u5148\u9054\u306e\u65b9\u3005\u306e\u624b\u98064\u3068formidable\u3001Bluemix\u306bDeploy\u3059\u308b\u305f\u3081\u306eport\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u624b\u98065\u306e\u8a18\u8ff0\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002STT\u306e\u97f3\u58f0\u8a8d\u8b58\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u3001STT\u306eAPI Reference\u306eSessionless\u306eRecognize audio\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nSTT\u306e\u30b5\u30fc\u30d3\u30b9\u8cc7\u683c\u60c5\u5831\u3092\u3001 'USERNAME\u3092\u633f\u5165'\u3084 'PASSWORD\u3092\u633f\u5165'\u306e\u7b87\u6240\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u3001\u201d//wav\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u751f\u6210\u201d\u306e\u8a18\u8ff0\u306f\u958b\u767a\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u306eWindows\u306e\u305f\u3081\u306e\u30e2\u30ce\u3067\u3059(Windows\u74b0\u5883\u3068Bluemix\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u306b\u304a\u3051\u308b\u3001\u30c9\u30e9\u30a4\u30d6\u6307\u5b9a\u3084\\\u306e\u51e6\u7406\u304c\u7570\u306a\u308b\u305f\u3081\u3067\u3059\u3001\u4e0d\u4fbf\u3067\u3059)\u3002\nvar params\u3067\u3001recognize\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002model\u3067ja-JP_NarrowbandModel\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u30a4\u30ad\u30ca\u30ea\u8ab2\u91d1\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4f59\u8ac7\u3067\u3059\u304c\u3001ja-JP_NarrowbandModel\u306f\u3001\u30d3\u30c3\u30c8\u30ec\u30fc\u30c8\u304c\u4f4e\u3044(\u4f8b 128kbps)\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u97f3\u58f0\u8a8d\u8b58\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u97f3\u58f0\u30c7\u30fc\u30bf\u306f\u3001ja-JP_BroadbandModel\u3067\u306f\u51e6\u7406\u3067\u305a\u3001\u30a8\u30e9\u30fc\u7d42\u4e86\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u3053\u306e\u30bd\u30fc\u30b9\u3067\u306f\u3001Upload\u3055\u308c\u305fwav\u30d5\u30a1\u30a4\u30eb\u306f\u305d\u306e\u307e\u307e\u6b8b\u308a\u307e\u3059\u3002\u4f55\u56de\u3082Upload\u3092\u7e70\u308a\u8fd4\u3059\u3068\u30c7\u30a3\u30b9\u30af\u30b9\u30da\u30fc\u30b9\u304c\u903c\u8feb\u3057\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\napp.js\nvar http = require('http'),\n    util = require('util'),\n    formidable = require('formidable'),\n    server;\n\nvar cfenv = require( 'cfenv' );\nvar appEnv = cfenv.getAppEnv();\n\n//\u30d5\u30a1\u30a4\u30eb\u4fdd\u5b58\u5834\u6240\nvar TEST_TMP=\".\";\n//\u30dd\u30fc\u30c8\u756a\u53f7\nvar TEST_PORT=8080;\n\n//upload\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\nvar wavpath = null;\n\nserver = http.createServer(function(req, res) {\n  if (req.url == '/') {\n    res.writeHead(200, {'content-type': 'text/html; charset=UTF-8'});\n    res.end(\n      '<form action=\"/upload\" enctype=\"multipart/form-data\" method=\"post\">'+\n      '<input type=\"text\" name=\"title\"><br>'+\n      '<input type=\"file\" name=\"upload\" multiple=\"multiple\"><br>'+\n      '<input type=\"submit\" value=\"Upload\">'+\n      '</form>'+\n      '<form action=\"/watson\" method=\"post\">'+\n      '<input type=\"submit\" value=\"Watson\">'+\n      '</form>'\n    );\n  } else if (req.url == '/upload') {\n    var form = new formidable.IncomingForm(),\n        files = [],\n        fields = [];\n\n    form.uploadDir = TEST_TMP;\n\n    form\n      .on('field', function(field, value) {\n        console.log(field, value);\n        fields.push([field, value]);\n      })\n      .on('file', function(field, file) {\n        console.log(field, file);\n        wavpath = file.path;\n        files.push([field, file]);\n      })\n      .on('end', function() {\n        console.log('-> upload done');\n        res.writeHead(200, {'content-type': 'text/plain; charset=UTF-8'});\n        res.write('received fields:\\n\\n '+util.inspect(fields));\n        res.write('\\n\\n');\n        console.log('-> util.inspect');\n\nconsole.log(util.inspect(files));\nconsole.log(wavpath);\n\n        res.end('received files:\\n\\n '+util.inspect(files));\n      });\n    form.parse(req);\n\n  } else if (req.url == '/watson') {\n\n// watson-developer-cloud stt start\nvar watson = require('watson-developer-cloud');\nvar fs = require('fs');\nvar speech_to_text = watson.speech_to_text({\n  username: 'USERNAME\u3092\u633f\u5165',\n  password: 'PASSWORD\u3092\u633f\u5165',\n  version: 'v1'\n});\n\n//wav\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u751f\u6210\n//var fullwavpath = null;\n//fullwavpath = 'C:' + wavpath;\n//console.log(fullwavpath);\n//var result = fullwavpath.replace( /\\\\/g , '\\\\'+'\\\\' );\n//console.log(result);\n\nvar fullwavpath = null;\nfullwavpath = wavpath;\nconsole.log(fullwavpath);\nvar result = fullwavpath;\nconsole.log(result);\n\nvar params = {\n  audio: fs.createReadStream(result),\n  content_type: 'audio/wav',\n  model: 'ja-JP_BroadbandModel',\n  timestamps: true,\n  word_alternatives: 0.9\n};\n\nspeech_to_text.recognize(params, function(err, transcript) {\n  if (err)\n    console.log(err);\n  else\n    console.log(JSON.stringify(transcript, null, 2));\n        res.writeHead(200, {'content-type': 'text/plain; charset=UTF-8'});\n        res.write(JSON.stringify(transcript, null, 2));\n        res.write('\\n\\n');\n        res.end('\u30c6\u30ad\u30b9\u30c8\u5316\u7d42\u4e86')\n\n});\n// watson-developer-cloud stt end\n\n  } else {\n    res.writeHead(404, {'content-type': 'text/plain'});\n    res.end('404');\n  }\n});\n\n//server.listen(TEST_PORT);\nserver.listen(appEnv.port);\n\nconsole.log('listening on http://localhost:'+TEST_PORT+'/');\n\n\n4. Bluemix\u306b\u30c7\u30d7\u30ed\u30a4\u306b\u7d9a\u304d\u307e\u3059\u3002\n[\u524d\u56de](http://qiita.com/yoshiono/items/b7352e9d1dfe7a7f9fd1)\u304b\u3089\u306e\u7d9a\u304d\u3067\u3001STT\u3067\u97f3\u58f0\u8a8d\u8b58Javascript\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n**3. STT\u3067\u97f3\u58f0\u8a8d\u8b58Javascript\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0**\nwav\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3001STT\u306b\u97f3\u58f0\u8a8d\u8b58\u6a5f\u80fd\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eapp.js\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u305f\u3081\u306e\u30ed\u30b8\u30c3\u30af\u306b\u3064\u3044\u3066\u306f\u3001\u5049\u5927\u306a\u5148\u9054\u306e\u65b9\u3005\u306e[\u624b\u98064](http://dev.classmethod.jp/server-side/node-formidable/)\u3068[formidable](https://github.com/felixge/node-formidable)\u3001Bluemix\u306bDeploy\u3059\u308b\u305f\u3081\u306eport\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f[\u624b\u98065](http://dotnsf.blog.jp/archives/1042018908.html)\u306e\u8a18\u8ff0\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002STT\u306e\u97f3\u58f0\u8a8d\u8b58\u51e6\u7406\u306b\u3064\u3044\u3066\u306f\u3001STT\u306e[API Reference](https://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/speech-to-text/api/v1/)\u306eSessionless\u306eRecognize audio\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nSTT\u306e\u30b5\u30fc\u30d3\u30b9\u8cc7\u683c\u60c5\u5831\u3092\u3001 'USERNAME\u3092\u633f\u5165'\u3084 'PASSWORD\u3092\u633f\u5165'\u306e\u7b87\u6240\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u3001\u201d//wav\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u751f\u6210\u201d\u306e\u8a18\u8ff0\u306f\u958b\u767a\u6642\u306e\u30ed\u30fc\u30ab\u30eb\u306eWindows\u306e\u305f\u3081\u306e\u30e2\u30ce\u3067\u3059(Windows\u74b0\u5883\u3068Bluemix\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u306b\u304a\u3051\u308b\u3001\u30c9\u30e9\u30a4\u30d6\u6307\u5b9a\u3084\\\u306e\u51e6\u7406\u304c\u7570\u306a\u308b\u305f\u3081\u3067\u3059\u3001\u4e0d\u4fbf\u3067\u3059)\u3002\nvar params\u3067\u3001recognize\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002model\u3067ja-JP_NarrowbandModel\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u30a4\u30ad\u30ca\u30ea\u8ab2\u91d1\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4f59\u8ac7\u3067\u3059\u304c\u3001ja-JP_NarrowbandModel\u306f\u3001\u30d3\u30c3\u30c8\u30ec\u30fc\u30c8\u304c\u4f4e\u3044(\u4f8b 128kbps)\u9332\u97f3\u30c7\u30fc\u30bf\u306e\u97f3\u58f0\u8a8d\u8b58\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u97f3\u58f0\u30c7\u30fc\u30bf\u306f\u3001ja-JP_BroadbandModel\u3067\u306f\u51e6\u7406\u3067\u305a\u3001\u30a8\u30e9\u30fc\u7d42\u4e86\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u3053\u306e\u30bd\u30fc\u30b9\u3067\u306f\u3001Upload\u3055\u308c\u305fwav\u30d5\u30a1\u30a4\u30eb\u306f\u305d\u306e\u307e\u307e\u6b8b\u308a\u307e\u3059\u3002\u4f55\u56de\u3082Upload\u3092\u7e70\u308a\u8fd4\u3059\u3068\u30c7\u30a3\u30b9\u30af\u30b9\u30da\u30fc\u30b9\u304c\u903c\u8feb\u3057\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```js:app.js\nvar http = require('http'),\n    util = require('util'),\n    formidable = require('formidable'),\n    server;\n\nvar cfenv = require( 'cfenv' );\nvar appEnv = cfenv.getAppEnv();\n \n//\u30d5\u30a1\u30a4\u30eb\u4fdd\u5b58\u5834\u6240\nvar TEST_TMP=\".\";\n//\u30dd\u30fc\u30c8\u756a\u53f7\nvar TEST_PORT=8080;\n\n//upload\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\nvar wavpath = null;\n\nserver = http.createServer(function(req, res) {\n  if (req.url == '/') {\n    res.writeHead(200, {'content-type': 'text/html; charset=UTF-8'});\n    res.end(\n      '<form action=\"/upload\" enctype=\"multipart/form-data\" method=\"post\">'+\n      '<input type=\"text\" name=\"title\"><br>'+\n      '<input type=\"file\" name=\"upload\" multiple=\"multiple\"><br>'+\n      '<input type=\"submit\" value=\"Upload\">'+\n      '</form>'+\n      '<form action=\"/watson\" method=\"post\">'+\n      '<input type=\"submit\" value=\"Watson\">'+\n      '</form>'\n    );\n  } else if (req.url == '/upload') {\n    var form = new formidable.IncomingForm(),\n        files = [],\n        fields = [];\n     \n    form.uploadDir = TEST_TMP;\n \n    form\n      .on('field', function(field, value) {\n        console.log(field, value);\n        fields.push([field, value]);\n      })\n      .on('file', function(field, file) {\n        console.log(field, file);\n        wavpath = file.path;\n        files.push([field, file]);\n      })\n      .on('end', function() {\n        console.log('-> upload done');\n        res.writeHead(200, {'content-type': 'text/plain; charset=UTF-8'});\n        res.write('received fields:\\n\\n '+util.inspect(fields));\n        res.write('\\n\\n');\n        console.log('-> util.inspect');\n\nconsole.log(util.inspect(files));\nconsole.log(wavpath);\n\n        res.end('received files:\\n\\n '+util.inspect(files));\n      });\n    form.parse(req);\n\n  } else if (req.url == '/watson') {\n\n// watson-developer-cloud stt start\nvar watson = require('watson-developer-cloud');\nvar fs = require('fs');\nvar speech_to_text = watson.speech_to_text({\n  username: 'USERNAME\u3092\u633f\u5165',\n  password: 'PASSWORD\u3092\u633f\u5165',\n  version: 'v1'\n});\n\n//wav\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u751f\u6210\n//var fullwavpath = null;\n//fullwavpath = 'C:' + wavpath;\n//console.log(fullwavpath);\n//var result = fullwavpath.replace( /\\\\/g , '\\\\'+'\\\\' );\n//console.log(result);\n\nvar fullwavpath = null;\nfullwavpath = wavpath;\nconsole.log(fullwavpath);\nvar result = fullwavpath;\nconsole.log(result);\n\nvar params = {\n  audio: fs.createReadStream(result),\n  content_type: 'audio/wav',\n  model: 'ja-JP_BroadbandModel',\n  timestamps: true,\n  word_alternatives: 0.9\n};\n\nspeech_to_text.recognize(params, function(err, transcript) {\n  if (err)\n    console.log(err);\n  else\n    console.log(JSON.stringify(transcript, null, 2));\n        res.writeHead(200, {'content-type': 'text/plain; charset=UTF-8'});\n        res.write(JSON.stringify(transcript, null, 2));\n        res.write('\\n\\n');\n        res.end('\u30c6\u30ad\u30b9\u30c8\u5316\u7d42\u4e86')\n\n});\n// watson-developer-cloud stt end\n\n  } else {\n    res.writeHead(404, {'content-type': 'text/plain'});\n    res.end('404');\n  }\n});\n\n//server.listen(TEST_PORT);\nserver.listen(appEnv.port);\n \nconsole.log('listening on http://localhost:'+TEST_PORT+'/');\n```\n[4. Bluemix\u306b\u30c7\u30d7\u30ed\u30a4](http://qiita.com/yoshiono/items/61518b82be69abde3c15)\u306b\u7d9a\u304d\u307e\u3059\u3002\n\n\n\n"}