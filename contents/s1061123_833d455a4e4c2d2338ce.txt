{"context": " More than 1 year has passed since last update.\n\nLagopus 0.2\u3092qemu/kvm with virtio-net\u3067\u52d5\u304b\u3059\n\u672c\u8a18\u4e8b\u3067\u306f\n\nUbuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u306bdpdk,ryu,Lagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\nping\u306e\u758e\u901a\u3092\n\n\nnetns\u3092\u4f7f\u7528\u3057\u3066Hypervisor\u5074\u306elinux\u5074\u304b\u3089\u78ba\u8a8d\u3059\u308b\n\u4ed6\u306eQemu\u306eVM\u3068\u63a5\u7d9a\u3057\u3066\u78ba\u8a8d\u3059\u308b\n\n\n\n\u307e\u3067\u306e\u624b\u9806\u3092\u8aac\u660e\u3059\u308b\u3002\n\n\u524d\u56de\u3068\u306e\u76f8\u9055\u70b9\nLagopus\u3092qemu/kvm with virtio-net\u3067\u52d5\u304b\u3059 (dpdk 1.7.1/lagopus 0.1.2)\n\u3068\u306f\u4ee5\u4e0b\u306e\u70b9\u304c\u7570\u306a\u308b\u3002\n\nvirtio-net\u306e\u30d1\u30c3\u30c1 (lagopus_fix_virtio_tx_mtu_02.diff)\n/usr/local/etc/lagopus/lagopus.conf \u306e\u66f8\u5f0f\nlagopus\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3 ('-b'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0)\n\n\n\u74b0\u5883\n\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\nHypervisor\n\n\nLinux kernel 4.0.5\nqemu 2.1.2\n\n\nGuestOS (VM)\n\n\nUbuntu 14.04 (amd64)\nlagopus (github, master:6cd6660e2d5e7ce79e713aa4de9ab32efa011905)\ndpdk 2.1.0\nRyu 3.25 (pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb, python 2.7.6)\n\n\n\n\n\u524d\u6e96\u5099\n\u3053\u3053\u3067\u306fUbuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u306eVM\u306bLagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u307e\u3067\u3092\u8aac\u660e\u3059\u308b\u3002\n\u307e\u305a\u59cb\u3081\u306bUbuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u3092\u7528\u610f\u3059\u308b\u3002\n\u305f\u3060\u3057\u3001qemu\u306e\u8d77\u52d5\u6642\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\n\n\n-cpu host\u3092\u3064\u3051\u308b\n\n-smp cores={\u30b3\u30a2\u6570},threads=1\u306e\u6307\u5b9a\n\n\n(cores\u3068threads\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068lagopus\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u70ba)\n\n\n\u5404\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8\u306eMAC\u6307\u5b9a(\u5168\u3066\u7570\u306a\u308bMAC\u306b\u3059\u308b\u3053\u3068)\n\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u306b\u3088\u3063\u3066\u7570\u306a\u308b-netdev\u306e\u8a2d\u5b9a\n\n\nnetns\u306e\u5834\u5408\u306b\u306ftap\u3092\u4f7f\u7528\u3059\u308b\n\u4ed6\u306evm\u306e\u5834\u5408\u306b\u306fsocket\u3092\u4f7f\u7528\u3059\u308b\n\n\n\n\u53c2\u8003\u306b\u8457\u8005\u306e\u8d77\u52d5\u6642\u306eoption\u3092\u3053\u3053\u306b\u793a\u3059\u3002\n\nshell\n#(netns\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408)\ncpu=3\nmem=4000\nqemu=qemu-system-x86_64\nimage=lagopus_sw.qcow2\nboot=c\n\n${qemu} -cpu host -smp ${cpu},cores=${cpu},threads=1 -numa node \\\n        -m ${mem} ${snapshot} \\\n        -rtc base=utc -usbdevice tablet -monitor stdio \\\n        -drive file=${image},if=virtio -boot ${boot} -vnc ${vnc} \\\n        -enable-kvm -L /usr/share/qemu  \\\n        -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:56 \\\n        -device virtio-net-pci,netdev=net1,mac=52:54:01:12:34:56 \\\n        -device virtio-net-pci,netdev=net2,mac=52:54:02:12:34:56 \\\n        -netdev bridge,id=net0,br=br0 \\\n        -netdev socket,id=net1,listen=:5001 \\\n        -netdev socket,id=net2,listen=:5002\n\n\n\nshell\n#(\u4ed6\u306eQemu\u306eVM\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408)\ncpu=3\nmem=4000\nqemu=qemu-system-x86_64\nimage=lagopus_sw.qcow2\nboot=c\n\n${qemu} -cpu host -smp ${cpu},cores=${cpu},threads=1 -numa node \\\n        -m ${mem} ${snapshot} \\\n        -rtc base=utc -usbdevice tablet -monitor stdio \\\n        -drive file=${image},if=virtio -boot ${boot} -vnc ${vnc} \\\n        -enable-kvm -L /usr/share/qemu  \\\n        -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:56 \\\n        -device virtio-net-pci,netdev=net1,mac=52:54:01:12:34:56 \\\n        -device virtio-net-pci,netdev=net2,mac=52:54:02:12:34:56 \\\n        -netdev bridge,id=net0,br=br0 \\\n        -netdev tap,id=net1,ifname=tap11,script=no \\\n        -netdev tap,id=net2,ifname=tap12,script=no \n\n\n\nUbuntu\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u30fb\u8a2d\u5b9a\u5909\u66f4\n\u307e\u305aLagopus\u306e\u5c0e\u5165\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nshell\nsudo apt-get -y update\nsudo apt-get -y install unzip build-essential libexpat1-dev libgmp-dev libncurses5-dev libssl-dev libpcap-dev byacc flex libreadline-dev python-dev python-pastedeploy python-paste python-twisted git python-setuptools python-pip libxml2-dev libxslt1-dev ethtool\n\n\nLagopus/dpdk\u3067\u5fc5\u8981\u3068\u306a\u308bhugepage\u306e\u8a2d\u5b9a\u3092grub\u306b\u5bfe\u3057\u3066\u884c\u306a\u3044\u3001\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n/etc/default/grub\nGRUB_CMDLINE_LINUX=\"hugepages=256\"\n\n\n\nshell\nsudo update-grub\nsudo reboot\n\n\n\ndpdk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306fdpdk\u306e1.7.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nshell\nwget -O - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.xz | tar xvfpJ -\ncd dpdk-2.1.0/\nmake install T=x86_64-native-linuxapp-gcc\n\n\n\nlagopus\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306flagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002release-0.2\u30d6\u30e9\u30f3\u30c1\u3067\u78ba\u8a8d\u3057\u305f\u3002\n\u73fe\u5728\u306elagopus\u3067\u306fvirtio-net\u3067\u306e\u52d5\u4f5c\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u304412\u306e\u3067\u3001\u516c\u5f0f\u306bpatch\u3092\u5f53\u3066\u308b\u304b\u8457\u8005\u306e\u5bfe\u5fdc\u6e08\u307f\u306egithub\u3092\u30af\u30ed\u30fc\u30f3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u4ee5\u4e0b\u306e\u3069\u3061\u3089\u304b\u306e\u624b\u6bb5\u3067\u3082\u3044\u3044\u306e\u3067lagopus\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\nshell\n# \u516c\u5f0fgit\u306bpatch\u3092\u5f53\u3066\u308b\u65b9\u6cd5\ngit clone https://github.com/lagopus/lagopus.git\ncd lagopus\ngit checkout release-0.2.0\nwget -O - http://s1061123.net/lagopus_fix_virtio_tx_mtu_02.diff | patch -p1\n\n\n\u305d\u306e\u5f8c\uff0c\u5148\u7a0b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305fdpdk\u3092\u6307\u5b9a\u3057\u3066lagopus\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3002\n\nshell\n./configure --with-dpdk-dir=${HOME}/dpdk-2.1.0\nmake \nsudo make install\n\n\n\nlagopus.conf\u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306econfig\u3092\u4f5c\u6210\u3057\u3066\uff0c/usr/local/etc/lagopus.conf\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n\u6ce8\u610f\n\u3053\u3053\u306eeth0,eth1\u306flagopus\u306e\u305f\u3081\u306b\u7528\u610f\u3059\u308b\u30dd\u30fc\u30c8\u306e\u6570\u3060\u3051\u7528\u610f\u3059\u308b\u3002\u3053\u3053\u3067\u306eeth0,eth1\u306flagopus\u3067\u7ba1\u7406\u3055\u308c\u308b\u30dd\u30fc\u30c8\u3067\u3042\u308b\u306e\u3067Linux\u304b\u3089\u898b\u3048\u308beth0,eth1\u3068\u306f\u9055\u3046\u30dd\u30fc\u30c8\u3092\u6307\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3002\u3053\u3053\u306e\u4f8b\u3067\u306flagopus\u306eVM\u306f3\u30dd\u30fc\u30c8\u3092\u6301\u3061\uff0c\u51852 \u30dd\u30fc\u30c8\u3092lagopus\u306e\u30b9\u30a4\u30c3\u30c1\u7528\u30dd\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u3046\u3053\u3068\u306b\u3057\u3066\u3044\u308b\u3002\n\nLinux\u306eeth0\nLinux\u306eeth1 -> Lagopus\u306eeth0\u306b\u306a\u308b (\u3053\u306e\u6642\u70b9\u3067Linux\u304b\u3089\u898b\u3048\u306a\u304f\u306a\u308b)\nLinux\u306eeth2 -> Lagopus\u306eeth1\u306b\u306a\u308b\n\n\n/usr/local/etc/lagopus.conf\nchannel channel01 create -dst-addr 127.0.0.1 -protocol tcp\n\ncontroller controller01 create -channel channel01 -role equal -connection-type main\n\ninterface interface01 create -type ethernet-dpdk-phy -device eth0 -port-number 0\n\ninterface interface02 create -type ethernet-dpdk-phy -device eth1 -port-number 1\n\nport port01 create -interface interface01\n\nport port02 create -interface interface02\n\nbridge bridge01 create -controller controller01 -port port01 1 -port port02 2 -dpid 0x1\nbridge bridge01 enable\n\n\n\nryu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nlagopus\u3092\u52d5\u304b\u3059\u969b\u306bOpenFlow Controller\u3068\u3057\u3066Ryu\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u305d\u308c\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nryu\u306einstall\u5f8c\u306bsix\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092upgrade\u3059\u308b\u3053\u3068\u304c\u4eca\u306e\u3068\u3053\u308d\u5fc5\u8981\u3089\u3057\u3044\u3002\npip install ryu\npip install six --upgrade\n\n\nlagopus\u3092\u8d77\u52d5\u3059\u308b\nlagopus\u3092\u52d5\u304b\u3059\u969b(\u518d\u8d77\u52d5\u5f8c\u3082\u542b\u3080)\uff0clagopus\u3060\u3051\u3067\u306a\u304fdpdk\u306e\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084OpenFlow\u30b3\u30f3\u30c8\u30ed\u30fc \u30e9\u306e\u8d77\u52d5\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u3053\u3053\u3067\u306f\u305d\u308c\u3089\u3092\u8aac\u660e\u3059\u308b\u3002\n\ndpdk(lagopus)\u5bfe\u8c61\u306ePCI\u30dd\u30fc\u30c8\u306e\u78ba\u8a8d\n\u307e\u305alagopus\u3068\u3057\u3066\u52d5\u304b\u3057\u305f\u3044\u30dd\u30fc\u30c8\u304c\u5c5e\u3059\u308bPCI\u306e\u30dd\u30fc\u30c8\u3092\u77e5\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002dpdk-1.7.1/tools/dpdk_nic_bind.py --status\u3092\u5b9f\u884c\u3057\u3066\u3069\u306e\u30dd\u30fc\u30c8\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\nshell\n$ ./tools/dpdk_nic_bind.py --status\n\nNetwork devices using DPDK-compatible driver\n============================================\n<none>\n\nNetwork devices using kernel driver\n===================================\n0000:00:03.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n0000:00:04.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n0000:00:05.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n\nOther network devices\n=====================\n<none>\n\n\n\u3053\u306e\u5834\u5408\uff0c\u4e00\u756a\u4e0a\u306eport(linux\u306eeth0)\u306f\u5916\u90e8\u63a5\u7d9a\u5411\u3051\u306e\u30dd\u30fc\u30c8\u306a\u306e\u3067\u305d\u308c\u4ee5\u5916\u306e0000:00:04.0, 0000:00:05.0\u306e2\u3064\u304c\u5bfe\u8c61\u3068\u306a\u308b\u3002\n\ndpdk\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ndpdk\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e0b\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\u305d\u306e\u969b\u306b\u5148\u7a0b\u78ba\u8a8d\u3057\u305fPCI\u306e\u30dd\u30fc\u30c8\u3092DPDK_NIC_PCIS\u306b\u8a18\u5165\u3059\u308b\u3053\u3068\u3002\n\ninstall-dpdk.sh\n#!/bin/sh\n# This script is derived from handson training resources.\n# http://lagopus.github.io/handson/handson.tar.xz\nexport RTE_SDK=${HOME}/dpdk-2.1.0\nexport RTE_TARGET=x86_64-native-linuxapp-gcc\n\nDPDK_NIC_PCIS=\"0000:00:04.0 0000:00:05.0\"\nHUGEPAGE_NOPAGES=\"256\"\n\nset_numa_pages()\n{\n        for d in /sys/devices/system/node/node? ; do\n                sudo sh -c \"echo ${HUGEPAGE_NOPAGES} > $d/hugepages/hugepages-2048kB/nr_hugepages\"\n        done\n}\n\nset_no_numa_pages()\n{\n        sudo sh -c \"echo ${HUGEPAGE_NOPAGES} > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages\"\n}\n\n# install module\nsudo modprobe uio\nsudo insmod ${RTE_SDK}/${RTE_TARGET}/kmod/igb_uio.ko\nsudo insmod ${RTE_SDK}/${RTE_TARGET}/kmod/rte_kni.ko\n\n# unbind e1000 NICs from igb and bind igb_uio for DPDK\nsudo ${RTE_SDK}/tools/dpdk_nic_bind.py --bind=igb_uio  ${DPDK_NIC_PCIS}\nsudo ${RTE_SDK}/tools/dpdk_nic_bind.py --status\n\n# mount fugepagefs\necho \"Set hugepagesize=${HUGEPAGE_NOPAGES} of 2MB page\"\nNCPUS=$(find /sys/devices/system/node/node?  -maxdepth 0 -type d | wc -l)\n\nif [ ${NCPUS} -gt 1 ] ; then\n        set_numa_pages\nelse\n        set_no_numa_pages\nfi\n\necho \"Creating /mnt/huge and mounting as hugetlbfs\"\nsudo mkdir -p /mnt/huge\ngrep -s '/mnt/huge' /proc/mounts > /dev/null\nif [ $? -ne 0 ] ; then\n        sudo mount -t hugetlbfs nodev /mnt/huge\nfi\n\nunset RTE_SDK\nunset RTE_TARGET\n\n\ninstall-dpdk.sh\u3092\u5b9f\u884c\u3057dpdk\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\"Network devices using DPDK-compatible driver\"\u306b\u5bfe\u8c61\u306e\u30dd\u30fc\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u308c\u3070\u3088\u3044\u3002\nuser@packer-ubuntu-1404-server:~$ ./install-dpdk.sh \n[sudo] password for user: \n\nNetwork devices using DPDK-compatible driver\n============================================\n0000:00:04.0 'Virtio network device' drv=igb_uio unused=\n0000:00:05.0 'Virtio network device' drv=igb_uio unused=\n\nNetwork devices using kernel driver\n===================================\n0000:00:03.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio \n\nOther network devices\n=====================\n<none>\nSet hugepagesize=256 of 2MB page\nCreating /mnt/huge and mounting as hugetlbfs\n\n\nlagopus\u306e\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067lagopus\u3092\u8d77\u52d5\u3055\u305b\u308b\u3002Lagopus\u306b\u8a8d\u8b58\u3055\u305b\u305f\u304f\u306a\u3044\u30dd\u30fc\u30c8(\u3053\u306e\u5834\u5408\u306feth0)\u304c\u3042\u308b\u5834\u5408\u306b\u306f'-b'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066blacklist\u5316\u3057\u306a\u3044\u3068Lagopus\u304c\u8d77\u52d5\u3057\u306a\u3044(\u6b63\u78ba\u306b\u306fdpdk\u304c\u30a8\u30e9\u30fc)\u3059\u308b\u306e\u3067\u6ce8\u610f\u3002\n\nshell\nsudo lagopus -d -- -c3 -n1 -b 00:03.0 -- -p3\n\n\n\nryu\u306e\u8d77\u52d5\n\u3053\u3053\u3067\u306fryu\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u3042\u308bsimple switch\u3092\u8d77\u52d5\u3059\u308b\u3002\n\nshell\nryu-manager --verbose\n/usr/local/lib/python2.7/dist-packages/ryu/app/simple_switch_13.py\n\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\"move onto main mode\"\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u308b\u3002\n\u3053\u308c\u3067lagopus\u306fRyu\u3068\u9023\u643a\u3057\u3066\u7c21\u5358\u306aL2 Switch\u3068\u306a\u3063\u305f\u3002\n\n\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\n\nnetns\u3092\u4f7f\u7528\u3057\u3066Hypervisor\u304b\u3089ping\u3092\u78ba\u8a8d\n\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f2\u3064\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3053\u3068\u3067\u758e\u901a\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n(\u4e21\u65b9\u306eifconfig\u3092\u5168\u3066\u5b9f\u884c\u3057\u305f\u5f8c\u306bping\u3092\u6253\u3064\u3053\u3068)\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306f\n\nc1, c2\u3068\u3044\u3046network namespace\u3092\u4f5c\u6210\u3057\n\u305d\u3053\u306btap11, tap12\u3092c1,c2\u3068\u5225\u306enamespace\u306b\u6240\u5c5e\u3055\u305b\u305f\u5f8c\nc1, c2\u306e\u4e2d\u3067/bin/bash\u3092\u8d77\u52d5\u3059\u308b\n\n\u3053\u3068\u3092\u884c\u306a\u3063\u3066\u3044\u308b\u3002\n\nshell\n#(A-side)\nsudo ip netns add c1\nsudo ip link set tap11 netns c1\nsudo ip netns exec c1 /bin/bash\nsudo ifconfig tap11 192.168.1.1/24\nping 192.168.1.2\n\n\n\nshell\n#(B-side)\nsudo ip netns add c2\nsudo ip link set tap12 netns c2\nsudo ip netns exec c2 /bin/bash\nsudo ifconfig tap12 192.168.1.2/24\nping 192.168.1.1\n\n\n\n\u4ed6\u306eQemu\u306evm\u304b\u3089ping\u3092\u78ba\u8a8d\n\u4ed6\u306eQemu\u306evm\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f\u5404OS\u3067\u540c\u3058\u30b5\u30d6\u30cd\u30c3\u30c8\u306eIP\u3092\u632f\u308b\u3053\u3068\u3067\u758e\u901a\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n\u305d\u306e\u5834\u5408\u306eQemu\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\nshell\n#(A-side)\nqemu-system-x86_64  ...\u5fc5\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3...\n        -device virtio-net-pci,netdev=net1,mac=52:54:11:12:34:56 \\\n        -netdev socket,id=net1,connect=127.0.0.1:5001\n\n\n\nshell\n#(B-side)\nqemu-system-x86_64  ...\u5fc5\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3...\n        -device virtio-net-pci,netdev=net1,mac=52:54:21:12:34:56 \\\n        -netdev socket,id=net1,connect=127.0.0.1:5002\n\n\n\n\u307e\u3068\u3081\n\u672c\u8a18\u4e8b\u3067\u306flagopus\u3092ubuntu14\u3092\u5165\u308c\u305fqemu(virtio-net)\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u305f\u3002\n\n\u8b1d\u8f9e\n\u3053\u306e\u3088\u3046\u306a\u30bd\u30d5\u30c8\u3092\u4f5c\u3063\u3066\u3044\u308blagopus\u958b\u767a\u8005\u30c1\u30fc\u30e0\u306e\u65b9\u3001\u307e\u305flagopus\u306ehandson\u3092\u4f01\u753b\u3057\u305f\u65b9\u306b\u611f\u8b1d\u81f4\u3057\u307e\u3059\u3002\n\n\n\n\nPull Request\u306f\u63d0\u51fa\u6e08\u307f (https://github.com/lagopus/lagopus/pull/46)\u00a0\u21a9\n\n\nPull Request\u306f\u63d0\u51fa\u6e08\u307f (https://github.com/lagopus/lagopus/pull/47)\u00a0\u21a9\n\n\n\n#Lagopus 0.2\u3092qemu/kvm with virtio-net\u3067\u52d5\u304b\u3059\n\n\u672c\u8a18\u4e8b\u3067\u306f\n\n* Ubuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u306bdpdk,ryu,Lagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\n* ping\u306e\u758e\u901a\u3092\n * netns\u3092\u4f7f\u7528\u3057\u3066Hypervisor\u5074\u306elinux\u5074\u304b\u3089\u78ba\u8a8d\u3059\u308b\n * \u4ed6\u306eQemu\u306eVM\u3068\u63a5\u7d9a\u3057\u3066\u78ba\u8a8d\u3059\u308b\n\n\u307e\u3067\u306e\u624b\u9806\u3092\u8aac\u660e\u3059\u308b\u3002\n\n#\u524d\u56de\u3068\u306e\u76f8\u9055\u70b9\n[Lagopus\u3092qemu/kvm with virtio-net\u3067\u52d5\u304b\u3059 (dpdk 1.7.1/lagopus 0.1.2)\n](http://qiita.com/s1061123/items/ffa3974e4635c06faa26)\u3068\u306f\u4ee5\u4e0b\u306e\u70b9\u304c\u7570\u306a\u308b\u3002\n\n* virtio-net\u306e\u30d1\u30c3\u30c1 ([lagopus_fix_virtio_tx_mtu_02.diff](http://s1061123.net/lagopus_fix_virtio_tx_mtu_02.diff))\n* /usr/local/etc/lagopus/lagopus.conf \u306e\u66f8\u5f0f\n* lagopus\u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3 ('-b'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0)\n\n#\u74b0\u5883\n\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\n* Hypervisor\n * Linux kernel 4.0.5\n * qemu 2.1.2\n* GuestOS (VM)\n * Ubuntu 14.04 (amd64)\n * lagopus (github, master:6cd6660e2d5e7ce79e713aa4de9ab32efa011905)\n * dpdk 2.1.0\n * Ryu 3.25 (pip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb, python 2.7.6)\n\n\n#\u524d\u6e96\u5099\n\u3053\u3053\u3067\u306fUbuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u306eVM\u306bLagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u307e\u3067\u3092\u8aac\u660e\u3059\u308b\u3002\n\u307e\u305a\u59cb\u3081\u306bUbuntu14\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fQemu\u3092\u7528\u610f\u3059\u308b\u3002\n\n\u305f\u3060\u3057\u3001qemu\u306e\u8d77\u52d5\u6642\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3068\u306a\u308b\u306e\u3067\u6ce8\u610f\n\n* ```-cpu host```\u3092\u3064\u3051\u308b\n* ```-smp cores={\u30b3\u30a2\u6570},threads=1```\u306e\u6307\u5b9a\n * (cores\u3068threads\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068lagopus\u304c\u8d77\u52d5\u3067\u304d\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u70ba)\n* \u5404\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8\u306eMAC\u6307\u5b9a(\u5168\u3066\u7570\u306a\u308bMAC\u306b\u3059\u308b\u3053\u3068)\n* \u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u306b\u3088\u3063\u3066\u7570\u306a\u308b```-netdev```\u306e\u8a2d\u5b9a\n    * netns\u306e\u5834\u5408\u306b\u306ftap\u3092\u4f7f\u7528\u3059\u308b\n    * \u4ed6\u306evm\u306e\u5834\u5408\u306b\u306fsocket\u3092\u4f7f\u7528\u3059\u308b\n\n\u53c2\u8003\u306b\u8457\u8005\u306e\u8d77\u52d5\u6642\u306eoption\u3092\u3053\u3053\u306b\u793a\u3059\u3002\n\n```lang:shell\n#(netns\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408)\ncpu=3\nmem=4000\nqemu=qemu-system-x86_64\nimage=lagopus_sw.qcow2\nboot=c\n\n${qemu} -cpu host -smp ${cpu},cores=${cpu},threads=1 -numa node \\\n        -m ${mem} ${snapshot} \\\n        -rtc base=utc -usbdevice tablet -monitor stdio \\\n        -drive file=${image},if=virtio -boot ${boot} -vnc ${vnc} \\\n        -enable-kvm -L /usr/share/qemu  \\\n        -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:56 \\\n        -device virtio-net-pci,netdev=net1,mac=52:54:01:12:34:56 \\\n        -device virtio-net-pci,netdev=net2,mac=52:54:02:12:34:56 \\\n        -netdev bridge,id=net0,br=br0 \\\n        -netdev socket,id=net1,listen=:5001 \\\n        -netdev socket,id=net2,listen=:5002\n```\n\n```lang:shell\n#(\u4ed6\u306eQemu\u306eVM\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408)\ncpu=3\nmem=4000\nqemu=qemu-system-x86_64\nimage=lagopus_sw.qcow2\nboot=c\n\n${qemu} -cpu host -smp ${cpu},cores=${cpu},threads=1 -numa node \\\n        -m ${mem} ${snapshot} \\\n        -rtc base=utc -usbdevice tablet -monitor stdio \\\n        -drive file=${image},if=virtio -boot ${boot} -vnc ${vnc} \\\n        -enable-kvm -L /usr/share/qemu  \\\n        -device virtio-net-pci,netdev=net0,mac=52:54:00:12:34:56 \\\n        -device virtio-net-pci,netdev=net1,mac=52:54:01:12:34:56 \\\n        -device virtio-net-pci,netdev=net2,mac=52:54:02:12:34:56 \\\n        -netdev bridge,id=net0,br=br0 \\\n        -netdev tap,id=net1,ifname=tap11,script=no \\\n        -netdev tap,id=net2,ifname=tap12,script=no \n```\n\n#Ubuntu\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u30fb\u8a2d\u5b9a\u5909\u66f4\n\n\u307e\u305aLagopus\u306e\u5c0e\u5165\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```lang:shell\nsudo apt-get -y update\nsudo apt-get -y install unzip build-essential libexpat1-dev libgmp-dev libncurses5-dev libssl-dev libpcap-dev byacc flex libreadline-dev python-dev python-pastedeploy python-paste python-twisted git python-setuptools python-pip libxml2-dev libxslt1-dev ethtool\n```\n\nLagopus/dpdk\u3067\u5fc5\u8981\u3068\u306a\u308bhugepage\u306e\u8a2d\u5b9a\u3092grub\u306b\u5bfe\u3057\u3066\u884c\u306a\u3044\u3001\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```lang:/etc/default/grub\nGRUB_CMDLINE_LINUX=\"hugepages=256\"\n```\n\n```lang:shell\nsudo update-grub\nsudo reboot\n```\n\n#dpdk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306fdpdk\u306e1.7.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```lang:shell\nwget -O - http://dpdk.org/browse/dpdk/snapshot/dpdk-2.1.0.tar.xz | tar xvfpJ -\ncd dpdk-2.1.0/\nmake install T=x86_64-native-linuxapp-gcc\n```\n\n#lagopus\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306flagopus\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002release-0.2\u30d6\u30e9\u30f3\u30c1\u3067\u78ba\u8a8d\u3057\u305f\u3002\n\n\u73fe\u5728\u306elagopus\u3067\u306fvirtio-net\u3067\u306e\u52d5\u4f5c\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044[^1][^2]\u306e\u3067\u3001\u516c\u5f0f\u306bpatch\u3092\u5f53\u3066\u308b\u304b\u8457\u8005\u306e\u5bfe\u5fdc\u6e08\u307f\u306egithub\u3092\u30af\u30ed\u30fc\u30f3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u4ee5\u4e0b\u306e\u3069\u3061\u3089\u304b\u306e\u624b\u6bb5\u3067\u3082\u3044\u3044\u306e\u3067lagopus\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n```lang:shell\n# \u516c\u5f0fgit\u306bpatch\u3092\u5f53\u3066\u308b\u65b9\u6cd5\ngit clone https://github.com/lagopus/lagopus.git\ncd lagopus\ngit checkout release-0.2.0\nwget -O - http://s1061123.net/lagopus_fix_virtio_tx_mtu_02.diff | patch -p1\n```\n\n\u305d\u306e\u5f8c\uff0c\u5148\u7a0b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305fdpdk\u3092\u6307\u5b9a\u3057\u3066lagopus\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u3002\n\n```lang:shell\n./configure --with-dpdk-dir=${HOME}/dpdk-2.1.0\nmake \nsudo make install\n```\n\n[^1]: Pull Request\u306f\u63d0\u51fa\u6e08\u307f (https://github.com/lagopus/lagopus/pull/46)\n[^2]: Pull Request\u306f\u63d0\u51fa\u6e08\u307f (https://github.com/lagopus/lagopus/pull/47)\n\n##lagopus.conf\u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306econfig\u3092\u4f5c\u6210\u3057\u3066\uff0c```/usr/local/etc/lagopus.conf```\u3068\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n###\u6ce8\u610f\n\u3053\u3053\u306eeth0,eth1\u306flagopus\u306e\u305f\u3081\u306b\u7528\u610f\u3059\u308b\u30dd\u30fc\u30c8\u306e\u6570\u3060\u3051\u7528\u610f\u3059\u308b\u3002\u3053\u3053\u3067\u306eeth0,eth1\u306flagopus\u3067\u7ba1\u7406\u3055\u308c\u308b\u30dd\u30fc\u30c8\u3067\u3042\u308b\u306e\u3067Linux\u304b\u3089\u898b\u3048\u308beth0,eth1\u3068\u306f\u9055\u3046\u30dd\u30fc\u30c8\u3092\u6307\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u6ce8\u610f\u3002\u3053\u3053\u306e\u4f8b\u3067\u306flagopus\u306eVM\u306f3\u30dd\u30fc\u30c8\u3092\u6301\u3061\uff0c\u51852 \u30dd\u30fc\u30c8\u3092lagopus\u306e\u30b9\u30a4\u30c3\u30c1\u7528\u30dd\u30fc\u30c8\u3068\u3057\u3066\u4f7f\u3046\u3053\u3068\u306b\u3057\u3066\u3044\u308b\u3002\n\n* Linux\u306eeth0\n* Linux\u306eeth1 -> Lagopus\u306eeth0\u306b\u306a\u308b (\u3053\u306e\u6642\u70b9\u3067Linux\u304b\u3089\u898b\u3048\u306a\u304f\u306a\u308b)\n* Linux\u306eeth2 -> Lagopus\u306eeth1\u306b\u306a\u308b\n\n```/usr/local/etc/lagopus.conf\nchannel channel01 create -dst-addr 127.0.0.1 -protocol tcp\n\ncontroller controller01 create -channel channel01 -role equal -connection-type main\n\ninterface interface01 create -type ethernet-dpdk-phy -device eth0 -port-number 0\n\ninterface interface02 create -type ethernet-dpdk-phy -device eth1 -port-number 1\n\nport port01 create -interface interface01\n\nport port02 create -interface interface02\n\nbridge bridge01 create -controller controller01 -port port01 1 -port port02 2 -dpid 0x1\nbridge bridge01 enable\n```\n\n#ryu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nlagopus\u3092\u52d5\u304b\u3059\u969b\u306bOpenFlow Controller\u3068\u3057\u3066Ryu\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u305d\u308c\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nryu\u306einstall\u5f8c\u306bsix\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092upgrade\u3059\u308b\u3053\u3068\u304c\u4eca\u306e\u3068\u3053\u308d\u5fc5\u8981\u3089\u3057\u3044\u3002\n\n```\npip install ryu\npip install six --upgrade\n```\n\n#lagopus\u3092\u8d77\u52d5\u3059\u308b\nlagopus\u3092\u52d5\u304b\u3059\u969b(\u518d\u8d77\u52d5\u5f8c\u3082\u542b\u3080)\uff0clagopus\u3060\u3051\u3067\u306a\u304fdpdk\u306e\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084OpenFlow\u30b3\u30f3\u30c8\u30ed\u30fc \u30e9\u306e\u8d77\u52d5\u304c\u5fc5\u8981\u306b\u306a\u308b\u3002\n\u3053\u3053\u3067\u306f\u305d\u308c\u3089\u3092\u8aac\u660e\u3059\u308b\u3002\n\n##dpdk(lagopus)\u5bfe\u8c61\u306ePCI\u30dd\u30fc\u30c8\u306e\u78ba\u8a8d\n\u307e\u305alagopus\u3068\u3057\u3066\u52d5\u304b\u3057\u305f\u3044\u30dd\u30fc\u30c8\u304c\u5c5e\u3059\u308bPCI\u306e\u30dd\u30fc\u30c8\u3092\u77e5\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002```dpdk-1.7.1/tools/dpdk_nic_bind.py --status```\u3092\u5b9f\u884c\u3057\u3066\u3069\u306e\u30dd\u30fc\u30c8\u304b\u78ba\u8a8d\u3059\u308b\u3002\n\n```lang:shell\n$ ./tools/dpdk_nic_bind.py --status\n\nNetwork devices using DPDK-compatible driver\n============================================\n<none>\n\nNetwork devices using kernel driver\n===================================\n0000:00:03.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n0000:00:04.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n0000:00:05.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio\n\nOther network devices\n=====================\n<none>\n```\n\u3053\u306e\u5834\u5408\uff0c\u4e00\u756a\u4e0a\u306eport(linux\u306eeth0)\u306f\u5916\u90e8\u63a5\u7d9a\u5411\u3051\u306e\u30dd\u30fc\u30c8\u306a\u306e\u3067\u305d\u308c\u4ee5\u5916\u306e0000:00:04.0, 0000:00:05.0\u306e2\u3064\u304c\u5bfe\u8c61\u3068\u306a\u308b\u3002\n\n##dpdk\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ndpdk\u30c9\u30e9\u30a4\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e0b\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\u305d\u306e\u969b\u306b\u5148\u7a0b\u78ba\u8a8d\u3057\u305fPCI\u306e\u30dd\u30fc\u30c8\u3092```DPDK_NIC_PCIS```\u306b\u8a18\u5165\u3059\u308b\u3053\u3068\u3002\n\n```install-dpdk.sh\n#!/bin/sh\n# This script is derived from handson training resources.\n# http://lagopus.github.io/handson/handson.tar.xz\nexport RTE_SDK=${HOME}/dpdk-2.1.0\nexport RTE_TARGET=x86_64-native-linuxapp-gcc\n\nDPDK_NIC_PCIS=\"0000:00:04.0 0000:00:05.0\"\nHUGEPAGE_NOPAGES=\"256\"\n\nset_numa_pages()\n{\n        for d in /sys/devices/system/node/node? ; do\n                sudo sh -c \"echo ${HUGEPAGE_NOPAGES} > $d/hugepages/hugepages-2048kB/nr_hugepages\"\n        done\n}\n\nset_no_numa_pages()\n{\n        sudo sh -c \"echo ${HUGEPAGE_NOPAGES} > /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages\"\n}\n\n# install module\nsudo modprobe uio\nsudo insmod ${RTE_SDK}/${RTE_TARGET}/kmod/igb_uio.ko\nsudo insmod ${RTE_SDK}/${RTE_TARGET}/kmod/rte_kni.ko\n\n# unbind e1000 NICs from igb and bind igb_uio for DPDK\nsudo ${RTE_SDK}/tools/dpdk_nic_bind.py --bind=igb_uio  ${DPDK_NIC_PCIS}\nsudo ${RTE_SDK}/tools/dpdk_nic_bind.py --status\n\n# mount fugepagefs\necho \"Set hugepagesize=${HUGEPAGE_NOPAGES} of 2MB page\"\nNCPUS=$(find /sys/devices/system/node/node?  -maxdepth 0 -type d | wc -l)\n\nif [ ${NCPUS} -gt 1 ] ; then\n        set_numa_pages\nelse\n        set_no_numa_pages\nfi\n\necho \"Creating /mnt/huge and mounting as hugetlbfs\"\nsudo mkdir -p /mnt/huge\ngrep -s '/mnt/huge' /proc/mounts > /dev/null\nif [ $? -ne 0 ] ; then\n        sudo mount -t hugetlbfs nodev /mnt/huge\nfi\n\nunset RTE_SDK\nunset RTE_TARGET\n```\n\ninstall-dpdk.sh\u3092\u5b9f\u884c\u3057dpdk\u30c9\u30e9\u30a4\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\"Network devices using DPDK-compatible driver\"\u306b\u5bfe\u8c61\u306e\u30dd\u30fc\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u308c\u3070\u3088\u3044\u3002\n\n```\nuser@packer-ubuntu-1404-server:~$ ./install-dpdk.sh \n[sudo] password for user: \n\nNetwork devices using DPDK-compatible driver\n============================================\n0000:00:04.0 'Virtio network device' drv=igb_uio unused=\n0000:00:05.0 'Virtio network device' drv=igb_uio unused=\n\nNetwork devices using kernel driver\n===================================\n0000:00:03.0 'Virtio network device' if= drv=virtio-pci unused=igb_uio \n\nOther network devices\n=====================\n<none>\nSet hugepagesize=256 of 2MB page\nCreating /mnt/huge and mounting as hugetlbfs\n```\n\n##lagopus\u306e\u8d77\u52d5\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067lagopus\u3092\u8d77\u52d5\u3055\u305b\u308b\u3002Lagopus\u306b\u8a8d\u8b58\u3055\u305b\u305f\u304f\u306a\u3044\u30dd\u30fc\u30c8(\u3053\u306e\u5834\u5408\u306feth0)\u304c\u3042\u308b\u5834\u5408\u306b\u306f'-b'\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066blacklist\u5316\u3057\u306a\u3044\u3068Lagopus\u304c\u8d77\u52d5\u3057\u306a\u3044(\u6b63\u78ba\u306b\u306fdpdk\u304c\u30a8\u30e9\u30fc)\u3059\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n```lang:shell\nsudo lagopus -d -- -c3 -n1 -b 00:03.0 -- -p3\n```\n\n##ryu\u306e\u8d77\u52d5\n\u3053\u3053\u3067\u306fryu\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u3042\u308bsimple switch\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```lang:shell\nryu-manager --verbose\n/usr/local/lib/python2.7/dist-packages/ryu/app/simple_switch_13.py\n```\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\"move onto main mode\"\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u308b\u3002\n\u3053\u308c\u3067lagopus\u306fRyu\u3068\u9023\u643a\u3057\u3066\u7c21\u5358\u306aL2 Switch\u3068\u306a\u3063\u305f\u3002\n\n#\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\n\n##netns\u3092\u4f7f\u7528\u3057\u3066Hypervisor\u304b\u3089ping\u3092\u78ba\u8a8d\n\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f2\u3064\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3053\u3068\u3067\u758e\u901a\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n(\u4e21\u65b9\u306eifconfig\u3092\u5168\u3066\u5b9f\u884c\u3057\u305f\u5f8c\u306bping\u3092\u6253\u3064\u3053\u3068)\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306f\n\n* c1, c2\u3068\u3044\u3046network namespace\u3092\u4f5c\u6210\u3057\n* \u305d\u3053\u306btap11, tap12\u3092c1,c2\u3068\u5225\u306enamespace\u306b\u6240\u5c5e\u3055\u305b\u305f\u5f8c\n* c1, c2\u306e\u4e2d\u3067/bin/bash\u3092\u8d77\u52d5\u3059\u308b\n\n\u3053\u3068\u3092\u884c\u306a\u3063\u3066\u3044\u308b\u3002\n\n```lang:shell\n#(A-side)\nsudo ip netns add c1\nsudo ip link set tap11 netns c1\nsudo ip netns exec c1 /bin/bash\nsudo ifconfig tap11 192.168.1.1/24\nping 192.168.1.2\n```\n\n```lang:shell\n#(B-side)\nsudo ip netns add c2\nsudo ip link set tap12 netns c2\nsudo ip netns exec c2 /bin/bash\nsudo ifconfig tap12 192.168.1.2/24\nping 192.168.1.1\n```\n\n##\u4ed6\u306eQemu\u306evm\u304b\u3089ping\u3092\u78ba\u8a8d\n\u4ed6\u306eQemu\u306evm\u3092\u4f7f\u7528\u3057\u3066\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f\u5404OS\u3067\u540c\u3058\u30b5\u30d6\u30cd\u30c3\u30c8\u306eIP\u3092\u632f\u308b\u3053\u3068\u3067\u758e\u901a\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3042\u308b\u3002\n\u305d\u306e\u5834\u5408\u306eQemu\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n```lang:shell\n#(A-side)\nqemu-system-x86_64  ...\u5fc5\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3...\n        -device virtio-net-pci,netdev=net1,mac=52:54:11:12:34:56 \\\n        -netdev socket,id=net1,connect=127.0.0.1:5001\n```\n```lang:shell\n#(B-side)\nqemu-system-x86_64  ...\u5fc5\u8981\u306a\u30aa\u30d7\u30b7\u30e7\u30f3...\n        -device virtio-net-pci,netdev=net1,mac=52:54:21:12:34:56 \\\n        -netdev socket,id=net1,connect=127.0.0.1:5002\n```\n\n#\u307e\u3068\u3081\n\u672c\u8a18\u4e8b\u3067\u306flagopus\u3092ubuntu14\u3092\u5165\u308c\u305fqemu(virtio-net)\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u305f\u3002\n\n##\u8b1d\u8f9e\n\u3053\u306e\u3088\u3046\u306a\u30bd\u30d5\u30c8\u3092\u4f5c\u3063\u3066\u3044\u308blagopus\u958b\u767a\u8005\u30c1\u30fc\u30e0\u306e\u65b9\u3001\u307e\u305flagopus\u306ehandson\u3092\u4f01\u753b\u3057\u305f\u65b9\u306b\u611f\u8b1d\u81f4\u3057\u307e\u3059\u3002\n", "tags": ["SDN", "OpenFlow", "Lagopus", "Ryu", "dpdk"]}