{"context": "pdo\u3067MySQL\u3092\u64cd\u4f5c\u3059\u308b\u65b9\u6cd5\u306e\u5099\u5fd8\u9332\u3002\n\n#1: \u63a5\u7d9a\n\n\u8a2d\u5b9a\n\n./inc/config.php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASS', '\u30d1\u30b9\u30ef\u30fc\u30c9');\ndefine(\"DB_NAME\",\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\");\n\n\n\n\n\u63a5\u7d9a_pdo\u63a5\u7d9a\ninclude_once(\"inc/config.php\");\n\n$option = array(\n  PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n    // \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30a8\u30e9\u30fc\u767a\u751f\u6642\u306e\u51e6\u7406\u65b9\u6cd5\u3092\u6307\u5b9a\n  PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n    // SELECT \u7b49\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u969b\u306e\u578b\u3092\u6307\u5b9a\n  PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,\n    // SELECT \u3057\u305f\u884c\u6570\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570 rowCount() \u304c\u4f7f\u3048\u308b\n  PDO::ATTR_EMULATE_PREPARES => false,\n    // MySQL\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u6a5f\u80fd\u306e\u4ee3\u308f\u308a\u306b\u30a8\u30df\u30e5\u3057\u305f\u3082\u306e\u3092\u4f7f\u3046\u8a2d\u5b9a\n  PDO::ATTR_STRINGIFY_FETCHES => false\n    // \u53d6\u5f97\u6642\u3057\u305f\u5185\u5bb9\u3092\u6587\u5b57\u5217\u578b\u306b\u5909\u63db\u3059\u308b\u304b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3,int\u578b\u3082\u6587\u5b57\u5217\u6271\u3044\n);\n\n$dsn = 'mysql:dbname='.DB_NAME.';host=' . DB_HOST . ';charset=utf8';\ntry {\n  $pdo = new PDO($dsn, DB_USER, DB_PASS, $option);\n} catch (PDOException $e){\n  echo $e->getMessage();\n}\n\n\n\n#2: cleate\n\u7c21\u5358\u306a\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3002\n\n\n\u30c6\u30fc\u30d6\u30eb\u540d: users\n\u30ab\u30e9\u30e0:\nuser_id\nuser_name\npassword\n\n$sql_u= 'create table if not exists users(\n  user_id int not null auto_increment,\n  user_name varchar(255) not null,\n  password char(32) not null,\n  primary key(user_id),\n  unique(user_name)\n)character set utf8;';\n$res_u = $pdo -> prepare($sql_u);\n$res_u -> execute();\n\n\n\n\u30c6\u30fc\u30d6\u30eb\u540d: texts\n\u30ab\u30e9\u30e0:\nid\nname\ntxt\ncreateDate\n\n$sql_t= 'create table if not exists texts(\n  id int not null auto_increment,\n  name varchar(255) not null,\n  text varchar(500),\n  createDate datetime not null,\n  primary key(id)\n)character set utf8;';\n$res_t = $pdo -> prepare($sql_t);\n$res_t -> execute();\n\n\n\n\u30c6\u30fc\u30d6\u30eb\u540d\u91cd\u8907\u9632\u6b62 -> if not exists\n\u7a7a\u767d\u30c0\u30e1 -> not null\n\u4e3b\u30ad\u30fc -> primary key(\u30ab\u30e9\u30e0\u540d);\n\u30e6\u30cb\u30fc\u30af -> unique(\u30ab\u30e9\u30e0\u540d);\nauto_increment \u306f\u30ab\u30e9\u30e0\u306b1\u3064\u3060\u3051\u3002\nupdate\u3057\u305f\u6642\u306b\u81ea\u52d5\u3067\u6642\u523b\u767b\u9332\u3000-> timestamp\n\u4e3b\u30ad\u30fc\u3092\u5fd8\u308c\u3066\u3044\u3066\u3001\u5f8c\u3067\u8ffd\u52a0\u8a2d\u5b9a\u3059\u308b\u5834\u5408\n(\u30c6\u30fc\u30d6\u30eb\u540d=>users\u3001\u8ffd\u52a0\u30ab\u30e9\u30e0\u540d:user_id)\ncreate table users(primary kye(user_id));\n\n\n#3: insert\n\n\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u633f\u5165 \n\"test1\"\u3092#2\u3067\u4f5c\u6210\u3057\u305f\"users\"\u306b\u8ffd\u52a0\u3059\u308b\n\n\n$sql = $pdo -> prepare(\"INSERT INTO users (user_name, password) VALUES (:name, :pass)\"); \n$sql -> bindParam(':name', $name, PDO::PARAM_STR); \n$sql -> bindParam(':pass', $pass, PDO::PARAM_STR);\n\n$name = 'test1'; \n$pass = md5('1234'); \n$sql -> execute();\n\n\n$sql -> bindParam('\u3053\u3053\u306bbind\u3059\u308b:(\u30b3\u30ed\u30f3)\u4ed8\u304d\u306e\u3093', \u5909\u6570, PDO::PARAM_STR);\n\n\nsprintf\u3067\u306e%s\u3084%d\u306e\u4ee3\u308f\u308a\u306bbind\u3092\u4f7f\u7528\u3059\u308b\u3002\n\nbindParam\u306f PDO::PARAM_INT \u3092\u6307\u5b9a\u3057\u3066\u3082 \u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u308f\u308c\u308b\nbindValue \u306f\u5024\u306e\u6307\u5b9a\u3092\u5909\u6570\u3067\u3082\u884c\u3048\u308b\u3057\u3001\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u3082\u53ef\u80fd\n\u3053\u306e\u5834\u5408\u306f PDO::PARAM_INT \u306a\u3069\u306e\u578b\u6307\u5b9a\u304c\u5fc5\u8981\u3002\n\n\n\n#4: update\n\n\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u633f\u5165\n\"test1\"\u3092\"test2\"\u306b\u5909\u66f4\u3059\u308b\n\n\n$sql = $pdo -> prepare( \n\"UPDATE users SET user_name= :name , password= :pass where user_name='test1';\" \n); \n$sql -> bindParam(':name', $name, PDO::PARAM_STR); \n$sql -> bindParam(':pass', $pass, PDO::PARAM_STR);\n\n$name = 'test2'; \n$pass = md5('1111'); \n$sql -> execute();\n\n\n\ninsert\u3068\u307b\u307c\u4e00\u7dd2\u3002\n\n\n#5: select\n\n\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\n\n\n// $pdo->query(\"SELECT * FROM \u30c6\u30fc\u30d6\u30eb\u540d WHERE \u6761\u4ef6\u6587 ORDER BY \u6761\u4ef6\");\n\n$sql = $pdo -> query(\"SELECT * FROM users;\");\n\nwhile($row = $sql -> fetch(PDO::FETCH_ASSOC)) { \n  $id = $row[\"user_id\"]; \n  $user = $row[\"user_name\"]; \n  $pass = $row[\"password\"];\n\n// \u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u8868\u793a \n// <<< EOS \u304b\u3089 EOS \u307e\u3067\u3092html\u5f62\u5f0f\u3067\u8868\u793a \n// \u4e2d\u3067 \u5909\u6570\u3082\u5c55\u958b\u3055\u308c\u308b\n\necho <<<EOS \n  <dl> \n    <dd>$id</dd>\n    <dd>$user</dd>\n    <dd>$pass</dd>\n  </dl>\nEOS; \n}\n\n\n\nfetch(PDO::FETCH_ASSOC)\n\u2191 mysql_fetch_assoc \u3068\u540c\u7fa9 \nEOS\u306f\u52dd\u624b\u306b\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\n\u30e1\u30b8\u30e3\u30fc\u306a\u306e\u306fEOF\u2026 \n\u3000End Of File \n\u30d5\u30a1\u30a4\u30eb\u306f\u9055\u548c\u611f\u304c\u3042\u3063\u305f\u306e\u3067\u3001 \n\u3000End Of Strings\n\"\u6587\u5b57\u5217\"\u3063\u3066\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30b7\u30e1\u306eEOS;\u3088\u308a\u624b\u524d\u306f\u30b9\u30da\u30fc\u30b9\u3084\u30bf\u30b0\u306f\u4ed8\u3051\u306a\u3044\u3088\u3046\u306b\uff01\n\n\n#6: delete & drop\n\n'test2'\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\n\n\n$sql = $pdo -> query(\"DELETE FROM users WHERE user_name='test2';\"); \n$sql -> execute();\n\n\n\n$sql\u3067sql\u6587\u3092\u4f5c\u6210\u3057\u3066\u3001execute();\u3067\u5b9f\u884c\u3059\u308b\u3060\u3051\u3002\n\u30c6\u30fc\u30d6\u30eb\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306fdrop\u3059\u308b\n\n\n$sql = $pdo -> query(\"DROP TABLE IF EXISTS users,texts;\"); \n$sql -> execute();\n\n\n\nTABLE\u3092DATABASE\u306b\u5909\u3048\u308b\u3068\u3001DATABASE\u3082\u524a\u9664\u53ef\u80fd\n\npdo\u3067MySQL\u3092\u64cd\u4f5c\u3059\u308b\u65b9\u6cd5\u306e\u5099\u5fd8\u9332\u3002\n\n## #1: \u63a5\u7d9a\n\n### \u8a2d\u5b9a\n\n```php:./inc/config.php\ndefine('DB_HOST', 'localhost');\ndefine('DB_USER', 'root');\ndefine('DB_PASS', '\u30d1\u30b9\u30ef\u30fc\u30c9');\ndefine(\"DB_NAME\",\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\");\n```\n\n---\n\n### \u63a5\u7d9a_pdo\u63a5\u7d9a\n\n```php\ninclude_once(\"inc/config.php\");\n\n$option = array(\n  PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION,\n    // \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30a8\u30e9\u30fc\u767a\u751f\u6642\u306e\u51e6\u7406\u65b9\u6cd5\u3092\u6307\u5b9a\n  PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n    // SELECT \u7b49\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u969b\u306e\u578b\u3092\u6307\u5b9a\n  PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,\n    // SELECT \u3057\u305f\u884c\u6570\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570 rowCount() \u304c\u4f7f\u3048\u308b\n  PDO::ATTR_EMULATE_PREPARES => false,\n    // MySQL\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u6a5f\u80fd\u306e\u4ee3\u308f\u308a\u306b\u30a8\u30df\u30e5\u3057\u305f\u3082\u306e\u3092\u4f7f\u3046\u8a2d\u5b9a\n  PDO::ATTR_STRINGIFY_FETCHES => false\n    // \u53d6\u5f97\u6642\u3057\u305f\u5185\u5bb9\u3092\u6587\u5b57\u5217\u578b\u306b\u5909\u63db\u3059\u308b\u304b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3,int\u578b\u3082\u6587\u5b57\u5217\u6271\u3044\n);\n\n$dsn = 'mysql:dbname='.DB_NAME.';host=' . DB_HOST . ';charset=utf8';\ntry {\n  $pdo = new PDO($dsn, DB_USER, DB_PASS, $option);\n} catch (PDOException $e){\n  echo $e->getMessage();\n}\n```\n\n---\n\n## #2: cleate\n\n\u7c21\u5358\u306a\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3002\n\n---\n\n>\u30c6\u30fc\u30d6\u30eb\u540d: users\n>\u30ab\u30e9\u30e0:\n> user_id\n> user_name\n> password\n\n```php\n$sql_u= 'create table if not exists users(\n  user_id int not null auto_increment,\n  user_name varchar(255) not null,\n  password char(32) not null,\n  primary key(user_id),\n  unique(user_name)\n)character set utf8;';\n$res_u = $pdo -> prepare($sql_u);\n$res_u -> execute();\n```\n\n---\n\n>\u30c6\u30fc\u30d6\u30eb\u540d: texts\n>\u30ab\u30e9\u30e0:\n> id\n> name\n> txt\n> createDate\n\n```php\n$sql_t= 'create table if not exists texts(\n  id int not null auto_increment,\n  name varchar(255) not null,\n  text varchar(500),\n  createDate datetime not null,\n  primary key(id)\n)character set utf8;';\n$res_t = $pdo -> prepare($sql_t);\n$res_t -> execute();\n```\n\n---\n\n>\u30c6\u30fc\u30d6\u30eb\u540d\u91cd\u8907\u9632\u6b62 -> if not exists\n>\u7a7a\u767d\u30c0\u30e1 -> not null\n>\u4e3b\u30ad\u30fc -> primary key(\u30ab\u30e9\u30e0\u540d);\n>\u30e6\u30cb\u30fc\u30af -> unique(\u30ab\u30e9\u30e0\u540d);\n>auto_increment \u306f\u30ab\u30e9\u30e0\u306b1\u3064\u3060\u3051\u3002\n>update\u3057\u305f\u6642\u306b\u81ea\u52d5\u3067\u6642\u523b\u767b\u9332\u3000-> timestamp\n>\n>\u4e3b\u30ad\u30fc\u3092\u5fd8\u308c\u3066\u3044\u3066\u3001\u5f8c\u3067\u8ffd\u52a0\u8a2d\u5b9a\u3059\u308b\u5834\u5408\n>(\u30c6\u30fc\u30d6\u30eb\u540d=>users\u3001\u8ffd\u52a0\u30ab\u30e9\u30e0\u540d:user_id)\n> create table users(primary kye(user_id));\n\n\n## #3: insert\n\n>\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u633f\u5165 \n>\"test1\"\u3092#2\u3067\u4f5c\u6210\u3057\u305f\"users\"\u306b\u8ffd\u52a0\u3059\u308b\n\n---\n\n```php\n$sql = $pdo -> prepare(\"INSERT INTO users (user_name, password) VALUES (:name, :pass)\"); \n$sql -> bindParam(':name', $name, PDO::PARAM_STR); \n$sql -> bindParam(':pass', $pass, PDO::PARAM_STR);\n\n$name = 'test1'; \n$pass = md5('1234'); \n$sql -> execute();\n```\n\n---\n\n```php\n$sql -> bindParam('\u3053\u3053\u306bbind\u3059\u308b:(\u30b3\u30ed\u30f3)\u4ed8\u304d\u306e\u3093', \u5909\u6570, PDO::PARAM_STR);\n```\n\n>sprintf\u3067\u306e`%s`\u3084`%d`\u306e\u4ee3\u308f\u308a\u306bbind\u3092\u4f7f\u7528\u3059\u308b\u3002\n>\n>* bindParam\u306f `PDO::PARAM_INT` \u3092\u6307\u5b9a\u3057\u3066\u3082 \u6587\u5b57\u5217\u3068\u3057\u3066\u6271\u308f\u308c\u308b\n>* bindValue \u306f\u5024\u306e\u6307\u5b9a\u3092\u5909\u6570\u3067\u3082\u884c\u3048\u308b\u3057\u3001\u6570\u5024\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u3082\u53ef\u80fd  \n>  \u3053\u306e\u5834\u5408\u306f `PDO::PARAM_INT` \u306a\u3069\u306e\u578b\u6307\u5b9a\u304c\u5fc5\u8981\u3002\n\n\n## #4: update\n>\u30d7\u30ea\u30da\u30a2\u30c9\u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u3067\u633f\u5165\n>\"test1\"\u3092\"test2\"\u306b\u5909\u66f4\u3059\u308b\n\n---\n\n```php\n$sql = $pdo -> prepare( \n\"UPDATE users SET user_name= :name , password= :pass where user_name='test1';\" \n); \n$sql -> bindParam(':name', $name, PDO::PARAM_STR); \n$sql -> bindParam(':pass', $pass, PDO::PARAM_STR);\n\n$name = 'test2'; \n$pass = md5('1111'); \n$sql -> execute();\n```\n\n---\n\n>insert\u3068\u307b\u307c\u4e00\u7dd2\u3002\n\n## #5: select\n\n>\u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f7f\u7528\n\n---\n\n```php\n// $pdo->query(\"SELECT * FROM \u30c6\u30fc\u30d6\u30eb\u540d WHERE \u6761\u4ef6\u6587 ORDER BY \u6761\u4ef6\");\n\n$sql = $pdo -> query(\"SELECT * FROM users;\");\n\nwhile($row = $sql -> fetch(PDO::FETCH_ASSOC)) { \n  $id = $row[\"user_id\"]; \n  $user = $row[\"user_name\"]; \n  $pass = $row[\"password\"];\n\n// \u30d2\u30a2\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u8868\u793a \n// <<< EOS \u304b\u3089 EOS \u307e\u3067\u3092html\u5f62\u5f0f\u3067\u8868\u793a \n// \u4e2d\u3067 \u5909\u6570\u3082\u5c55\u958b\u3055\u308c\u308b\n\necho <<<EOS \n  <dl> \n    <dd>$id</dd>\n    <dd>$user</dd>\n    <dd>$pass</dd>\n  </dl>\nEOS; \n}\n```\n\n---\n\n>`fetch(PDO::FETCH_ASSOC)`\n>\u2191 mysql_fetch_assoc \u3068\u540c\u7fa9 \n>\n>`EOS`\u306f\u52dd\u624b\u306b\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\n>\u30e1\u30b8\u30e3\u30fc\u306a\u306e\u306f`EOF`\u2026 \n>\u3000End Of File \n>\u30d5\u30a1\u30a4\u30eb\u306f\u9055\u548c\u611f\u304c\u3042\u3063\u305f\u306e\u3067\u3001 \n>\u3000End Of Strings\n>\"\u6587\u5b57\u5217\"\u3063\u3066\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n>`\u30b7\u30e1\u306eEOS;\u3088\u308a\u624b\u524d\u306f\u30b9\u30da\u30fc\u30b9\u3084\u30bf\u30b0\u306f\u4ed8\u3051\u306a\u3044\u3088\u3046\u306b\uff01`\n\n## #6: delete & drop\n\n>'test2'\u306e\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\n\n---\n\n```php\n$sql = $pdo -> query(\"DELETE FROM users WHERE user_name='test2';\"); \n$sql -> execute();\n```\n\n---\n\n>`$sql`\u3067sql\u6587\u3092\u4f5c\u6210\u3057\u3066\u3001`execute();`\u3067\u5b9f\u884c\u3059\u308b\u3060\u3051\u3002\n>\u30c6\u30fc\u30d6\u30eb\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306fdrop\u3059\u308b\n\n---\n\n```php\n$sql = $pdo -> query(\"DROP TABLE IF EXISTS users,texts;\"); \n$sql -> execute();\n```\n\n---\n\n>TABLE\u3092DATABASE\u306b\u5909\u3048\u308b\u3068\u3001DATABASE\u3082\u524a\u9664\u53ef\u80fd\n", "tags": ["PHP", "PDO", "MySQL"]}