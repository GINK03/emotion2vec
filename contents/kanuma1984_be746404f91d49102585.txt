{"context": " More than 1 year has passed since last update.\n\n\u30b4\u30fc\u30eb\n\u4eee\u60f3\u30de\u30b7\u30f3\u306bansible\u3092\u4f7f\u3063\u3066php\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\nphp.ini\u3068php-fpm\u306ewww.conf\u3092/etc/\u306b\u751f\u6210\u3057\u307e\u3059\u3002\n\u524d\u56de\u3001nginx\u3092\u5165\u308c\u3066\u3044\u308b\u306e\u3067php-fpm\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\n\n\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306fMac OS X 10.7.5\n\u4eee\u60f3\u30de\u30b7\u30f3\u306fcentos6.5\nansible 1.4.1\nVagrant 1.3.5\n\n\n\u30d5\u30ed\u30fc\n\u524d\u56de\u306e\u7d9a\u304d\u3068\u3057\u3066\u9032\u3081\u307e\u3059\u3002\n\nplaybook\u306bphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\nphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528roles\u8ffd\u52a0\nansible-playbook\u5b9f\u884c\n\n\nplaybook\u306bphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\nlocal.yml\u306b\u4ee5\u4e0b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nlocal.yml\n- name: PHP Playbook\n  hosts: local\n  sudo: yes\n  roles:\n    - php\n  tags:\n    - php\n\n\n\nphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528roles\u8ffd\u52a0\n\u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u4e0b\u6e96\u5099\u3067\u3059\u3002\n$ mkdir provisioning/roles/php\n$ mkdir provisioning/roles/php/tasks\n$ touch provisioning/roles/php/tasks/main.yml\n$ mkdir provisioning/roles/php/templates\n\nmain.yml\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nepel\u3068remi\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3082\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nmain.yml\n---\n# file: provisioning/roles/php/tasks/main.yml\n- name: set epel repository\n  shell: rpm -Uvh --force http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n- name: set remi repository\n  command: sudo rpm -Uvh --force http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n- name: install php\n  yum: name={{item}} enablerepo=remi,epel state=present\n  with_items:\n    - php\n    - php-devel\n    - php-fpm\n\n- name: put php.ini\n  template: src=roles/php/templates/php.ini.j2 dest=/etc/php.ini\n- name: put php-fpm.d/www.conf\n  template: src=roles/php/templates/www.conf.j2 dest=/etc/php-fpm.d/www.conf\n\n- name: set autoload php-fpm\n  command: chkconfig php-fpm on\n- name: restart php-fpm\n  command: service php-fpm restart\n\n\n\u5b9f\u884c\u524d\u306bphp.ini.js\u3068php-fpm\u306ewww.conf.js\u3092\nprovisioning/roles/php/templates\u4e0b\u306b\u7f6e\u3044\u3066\u4e0b\u3055\u3044\u3002\u6700\u60aa\u3001\u4e2d\u8eab\u306f\u306a\u3093\u3067\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\nansible-playbook\u5b9f\u884c\n\u30bf\u30b0\u3092\u6307\u5b9a\u3057\u3066php\u306e\u30bf\u30b9\u30af\u3060\u3051\u8d70\u3089\u305b\u307e\u3059\u3002\nvagrant up\u3092\u3057\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u8d77\u52d5\u3055\u305b\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u306d\u3002\n$ ansible-playbook provisioning/local.yml --tags \"php\" -i provisioning/inventory/local\n\nPLAY [PHP Playbook] ***********************************************************\n\nGATHERING FACTS ***************************************************************\nok: [localhost]\n\nTASK: [php | set epel repository] *********************************************\nchanged: [localhost]\n\nTASK: [php | set remi repository] *********************************************\nchanged: [localhost]\n\nTASK: [php | install php] *****************************************************\nok: [localhost] => (item=php,php-devel,php-fpm)\n\nTASK: [php | put php.ini] *****************************************************\nok: [localhost]\n\nTASK: [php | put php-fpm.d/www.conf] ******************************************\nok: [localhost]\n\nTASK: [php | set autoload php-fpm] ********************************************\nchanged: [localhost]\n\nTASK: [php | restart php-fpm] *************************************************\nchanged: [localhost]\n\nPLAY RECAP ********************************************************************\nlocalhost                  : ok=8    changed=4    unreachable=0    failed=0\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\uff01\uff01\n\u30bf\u30b0\u306e\u6307\u5b9a\u4fbf\u5229\u3060\u306a\u3041\u3002\n\u3042\u3068\u500b\u4eba\u7684\u306b\u306fwith_items\u304c\u6c17\u306b\u5165\u3063\u305f\u3002\n#\u30b4\u30fc\u30eb\n\u4eee\u60f3\u30de\u30b7\u30f3\u306bansible\u3092\u4f7f\u3063\u3066php\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\nphp.ini\u3068php-fpm\u306ewww.conf\u3092/etc/\u306b\u751f\u6210\u3057\u307e\u3059\u3002\n\n[\u524d\u56de](http://qiita.com/kanuma1984/items/2f89142fc3cab702e84d)\u3001nginx\u3092\u5165\u308c\u3066\u3044\u308b\u306e\u3067php-fpm\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n#\u74b0\u5883\n\n+ \u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306fMac OS X 10.7.5\n+ \u4eee\u60f3\u30de\u30b7\u30f3\u306fcentos6.5\n+ ansible 1.4.1\n+ Vagrant 1.3.5\n\n#\u30d5\u30ed\u30fc\n\n[\u524d\u56de](http://qiita.com/kanuma1984/items/2f89142fc3cab702e84d)\u306e\u7d9a\u304d\u3068\u3057\u3066\u9032\u3081\u307e\u3059\u3002\n\n+ playbook\u306bphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\n+ php\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528roles\u8ffd\u52a0\n+ ansible-playbook\u5b9f\u884c\n\n\n#playbook\u306bphp\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\nlocal.yml\u306b\u4ee5\u4e0b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```yaml:local.yml\n- name: PHP Playbook\n  hosts: local\n  sudo: yes\n  roles:\n    - php\n  tags:\n    - php\n```\n\n#php\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528roles\u8ffd\u52a0\n\u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u4e0b\u6e96\u5099\u3067\u3059\u3002\n\n```bash\n$ mkdir provisioning/roles/php\n$ mkdir provisioning/roles/php/tasks\n$ touch provisioning/roles/php/tasks/main.yml\n$ mkdir provisioning/roles/php/templates\n```\n\nmain.yml\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nepel\u3068remi\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3082\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```yaml:main.yml\n---\n# file: provisioning/roles/php/tasks/main.yml\n- name: set epel repository\n  shell: rpm -Uvh --force http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\n- name: set remi repository\n  command: sudo rpm -Uvh --force http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n\n- name: install php\n  yum: name={{item}} enablerepo=remi,epel state=present\n  with_items:\n    - php\n    - php-devel\n    - php-fpm\n\n- name: put php.ini\n  template: src=roles/php/templates/php.ini.j2 dest=/etc/php.ini\n- name: put php-fpm.d/www.conf\n  template: src=roles/php/templates/www.conf.j2 dest=/etc/php-fpm.d/www.conf\n\n- name: set autoload php-fpm\n  command: chkconfig php-fpm on\n- name: restart php-fpm\n  command: service php-fpm restart\n```\n\n\u5b9f\u884c\u524d\u306bphp.ini.js\u3068php-fpm\u306ewww.conf.js\u3092\nprovisioning/roles/php/templates\u4e0b\u306b\u7f6e\u3044\u3066\u4e0b\u3055\u3044\u3002\u6700\u60aa\u3001\u4e2d\u8eab\u306f\u306a\u3093\u3067\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\n\n#ansible-playbook\u5b9f\u884c\n\n\u30bf\u30b0\u3092\u6307\u5b9a\u3057\u3066php\u306e\u30bf\u30b9\u30af\u3060\u3051\u8d70\u3089\u305b\u307e\u3059\u3002\nvagrant up\u3092\u3057\u3066\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u8d77\u52d5\u3055\u305b\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u306d\u3002\n\n```bash\n$ ansible-playbook provisioning/local.yml --tags \"php\" -i provisioning/inventory/local\n\nPLAY [PHP Playbook] ***********************************************************\n\nGATHERING FACTS ***************************************************************\nok: [localhost]\n\nTASK: [php | set epel repository] *********************************************\nchanged: [localhost]\n\nTASK: [php | set remi repository] *********************************************\nchanged: [localhost]\n\nTASK: [php | install php] *****************************************************\nok: [localhost] => (item=php,php-devel,php-fpm)\n\nTASK: [php | put php.ini] *****************************************************\nok: [localhost]\n\nTASK: [php | put php-fpm.d/www.conf] ******************************************\nok: [localhost]\n\nTASK: [php | set autoload php-fpm] ********************************************\nchanged: [localhost]\n\nTASK: [php | restart php-fpm] *************************************************\nchanged: [localhost]\n\nPLAY RECAP ********************************************************************\nlocalhost                  : ok=8    changed=4    unreachable=0    failed=0\n```\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\uff01\uff01\n\u30bf\u30b0\u306e\u6307\u5b9a\u4fbf\u5229\u3060\u306a\u3041\u3002\n\u3042\u3068\u500b\u4eba\u7684\u306b\u306fwith_items\u304c\u6c17\u306b\u5165\u3063\u305f\u3002\n", "tags": ["vagrant", "Ansible", "PHP", "php-fpm", "nginx"]}