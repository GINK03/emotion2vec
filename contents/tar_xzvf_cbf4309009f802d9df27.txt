{"context": " More than 1 year has passed since last update.\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3001\u3044\u3064\u3082\u304a\u4e16\u8a71\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3001Docker\u306e\u30db\u30b9\u30c8\u52d5\u304b\u3057\u305f\u308a\u3001\u691c\u8a3c\u7528\u9014\u3067\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u3044\u307e\u3059\u3002\n\u3059\u3050\u30b5\u30fc\u30d0\u30fc\u304c\u4f5c\u6210\u3067\u304d\u3001\u4f7f\u3046\u4e8b\u304c\u3067\u304d\u308b\u3002\u3057\u304b\u3082\u3001\u4f7f\u3063\u305f\u5206\u3060\u3051\u3057\u304b\u304a\u91d1\u304c\u304b\u304b\u3089\u306a\u3044\u3002\n\u4fbf\u5229\u3067\u3059\u306d!\n\u5b9f\u306f\u300111\u6708\u306b\u300c\u3055\u304f\u3089\u77f3\u72e9DC\u898b\u5b66\u30c4\u30a2\u30fc\u300d\u306b\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002\nhttps://picasablog.wordpress.com/2015/11/19/\u7b2c4\u56de\u300c\u3055\u304f\u3089\u77f3\u72e9dc\u898b\u5b66\u30c4\u30a2\u30fc\u300d\u306b\u53c2\u52a0\u3057\u307e\u3057\u305f/\n\u305d\u306e\u969b\u306b\u9802\u3044\u305f\u3001\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30af\u30fc\u30dd\u30f3\u3067\u300cDocker\u306e\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b\u300d\u691c\u8a3c\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u203b\u691c\u8a3c\u306e\u305f\u3081\u3001firewall\u30aa\u30d5\u3001root\u3067\u306e\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\u904b\u7528\u3059\u308b\u969b\u306b\u306f\u3001\u9069\u5207\u306afirewall\u306e\u8a2d\u5b9a\u3001\u6a29\u9650\u306e\u64cd\u4f5c\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\nDocker Swarm\u3067Docker\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b\u3002\n\u4e8b\u524d\u306b\u3001\u77f3\u72e9\u7b2c\uff11\u30be\u30fc\u30f3\u306b\u3001Ubuntu Server 14.04 3 LTS 64bit (Docker\u30db\u30b9\u30c8\u7528)\n\u4e8b\u524d\u306b\u3001\u77f3\u72e9\u7b2c\uff12\u30be\u30fc\u30f3\u306b\u3001Ubuntu Server 14.04 3 LTS 64bit (Docker\u30db\u30b9\u30c8\u7528)\n\u4e8b\u524d\u306b\u3001\u6771\u4eac\u7b2c\uff11\u30be\u30fc\u30f3\u306b\u3001CentOS 7.1 64bit (consul\u7528)\n\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\uff08\u8aac\u660e\u7701\u7565\uff09\n\n\n\n\u30be\u30fc\u30f3\n\u30db\u30b9\u30c8\u540d\nIP\n\n\n\n\n\u77f3\u72e9\u7b2c\uff11\u30be\u30fc\u30f3\ndocker-host-1\na.a.a.a\n\n\n\u77f3\u72e9\u7b2c\uff12\u30be\u30fc\u30f3\ndocker-host-2\nb.b.b.b\n\n\n\u6771\u4eac\u7b2c\uff11\u30be\u30fc\u30f3\nconsul\nc.c.c.c\n\n\n\nhttp://kakakikikeke.blogspot.jp/2015/10/centos-consul.html \u3088\u308a\u5f15\u7528\n\nconsul\u69cb\u7bc9\n[root@consul ~]# systemctl stop firewalld\n[root@consul ~]# cd /usr/bin\n[root@consul ~]# curl -O https://dl.bintray.com/mitchellh/consul/0.5.2_linux_amd64.zip\n[root@consul ~]# unzip 0.5.2_linux_amd64.zip\n[root@consul ~]# consul agent -server -bootstrap -client=0.0.0.0 -data-dir /tmp/consul\n\n\nDocker\u30db\u30b9\u30c8\u69cb\u7bc9\n\u516c\u5f0f\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\uff08\u8aac\u660e\u7701\u7565\uff09\nhttps://docs.docker.com/engine/installation/ubuntulinux/\n# docker run hello-world\n\n\nSwarm\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\n\u3053\u3061\u3089\u3082\u3001\u516c\u5f0f\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\nhttps://docs.docker.com/swarm/install-manual/\n# docker pull swarm\n\n\nSwarm node\u69cb\u7bc9\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u4e0a\u3067\n# docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u305f\u30bf\u30fc\u30df\u30ca\u30eb\u306b\u306f\u3001\u30ed\u30b0\u304c\u6d41\u308c\u308b\u306e\u3067\u3001\u8907\u6570\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u3044\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\ndocker-host-1\n# docker run -d swarm join --addr=a.a.a.a:2375 consul://c.c.c.c:8500/nodes\n\ndocker-host-2\n# docker run -d swarm join --addr=b.b.b.b:2375 consul://c.c.c.c:8500/nodes\n\n\nSwarm manager\u69cb\u7bc9\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n# docker run -d -p 10000:2375 swarm manage consul://c.c.c.c:8500/nodes\n\n\n\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u3092\u898b\u3066\u307f\u308b\n# docker -H tcp://localhost:10000 info\nContainers: 32\nImages: 7\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n docker-host-1: a.a.a.a:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 16\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.019 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-28-generic, operatingsystem=Ubuntu 14.04.3 LTS, storagedriver=aufs\n docker-host-2: b.b.b.b:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 16\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.019 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-28-generic, operatingsystem=Ubuntu 14.04.3 LTS, storagedriver=aufs\nCPUs: 2\nTotal Memory: 2.038 GiB\nName: 082f0047225d\n\n\n2\u3064\u306e\u30ce\u30fc\u30c9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u6ca2\u5c71\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\u30b3\u30f3\u30c6\u30ca\u304c\u3001\u3069\u306e\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u308b\u304b\u306e\u8aac\u660e\u3067\u3059\u3002\uff08URL\u5148\uff09\nhttps://docs.docker.com/swarm/scheduler/strategy/\n\u4eca\u56de\u306f\u3001\nStrategy: spread\u306a\u306e\u3067\u3001\u5747\u7b49\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u914d\u7f6e\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n# docker -H tcp://localhost:10000 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u309210\u56de\u5165\u529b\n# docker -H tcp://localhost:10000 run -itd ubuntu /bin/bash\n\n# docker -H tcp://localhost:10000 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES\n94248b8d581e        ubuntu              \"/bin/bash\"         53 seconds ago       Up 52 seconds                           docker-host-2/serene_goldberg\n14756426159c        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/lonely_brown\n648aacfd52cc        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sharp_kowalevski\n5e252ac1cd66        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/condescending_engelbart\n75ef8b2e8489        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sad_liskov\n90bd7d46fe05        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/cocky_wright\n64d4378d3552        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/angry_archimedes\ndcaeb7fd8bbc        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/stoic_jang\nc8e476c8faac        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/agitated_curie\n264b7a389a79        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sharp_hypatia\n\n\u305d\u308c\u305e\u308c\u306e\u30ce\u30fc\u30c9\u306b5\u3064\u305a\u3064\u30b3\u30f3\u30c6\u30ca\u304c\u914d\u7f6e\u3055\u308c\u307e\u3057\u305f\u3002\n\nMulti-host networking\u3067Docker\u30db\u30b9\u30c8\u3092\u8de8\u3050\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u308b\u3002\n\u5148\u7a0b\u306f\u3001\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308a\u307e\u3057\u305f\u3001\u3057\u304b\u3057\u3001\u30ce\u30fc\u30c9\u9593\u306e\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306f\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001\u5225\u30ce\u30fc\u30c9\u9593\uff08\u5225\u30db\u30b9\u30c8\uff09\u3067\u3082\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u7e4b\u304c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nhttps://docs.docker.com/engine/userguide/networking/get-started-overlay/\nMulti-host networking\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001Linux Kernel\u304c3.16\u4ee5\u4e0a\u3067\u306a\u3044\u3068\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\nhttp://www.neko6.info/archives/1874 \u3088\u308a\u5f15\u7528\n# apt-get install linux-image-3.16.0-28-generic linux-headers-3.16.0-28\n\nhttps://github.com/docker/docker/issues/14026 \u3088\u308a\u5f15\u7528\n# apt-get -y update\n# apt-get -y upgrade\n# apt-get -y dist-upgrade\n# apt-get -y install aufs-tools openjdk-7-jre curl wget git vim make php-pear \\\nphp5-dev php5-curl python mc gawk ssh grep sudo htop nmon mysql-client php5-cli \\\nsqlite3 sysstat sysdig linux-headers-$(uname -r) lxc bsdtar\n# apt-get -y install linux-image-extra-$(uname -r)\n# modprobe aufs\n# apt-get clean\n# reboot\n\n\u5148\u307b\u3069\u540c\u69d8\u3001\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\n# docker daemon --cluster-advertise=eth0:2376 --cluster-store=consul://c.c.c.c:8500/nodes -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n\ndocker-host-1\n# docker run -d swarm join --addr=a.a.a.a:2375 consul://c.c.c.c:8500/nodes\n\ndocker-host-2\n# docker run -d swarm join --addr=b.b.b.b:2375 consul://c.c.c.c:8500/nodes\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n# docker run -d -p 10000:2375 swarm manage consul://c.c.c.c:8500/nodes\n\n\u3069\u3061\u3089\u304b\u306e\u30db\u30b9\u30c8\u3067\n# docker network create --driver overlay my-net\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n# docker -H tcp://localhost:10000 run --net=my-net -i -t ubuntu /bin/bash\n\n\u7acb\u3061\u4e0a\u304c\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u300110.0.0.* \u306eIP\u304c\u5272\u308a\u632f\u3089\u308c\u307e\u3059\u3002\n\u7acb\u3061\u4e0a\u304c\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092ping\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7e4b\u304c\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u611f\u60f3\n\u30af\u30e9\u30b9\u30bf\u3068\u3044\u3046\u3068\u3001\u7d50\u69cb\u96e3\u3057\u3044\u306e\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\nswarm\u3092pull\u3057\u3066\u30ce\u30fc\u30c9\u3067\u3042\u3063\u305f\u308a\u3001\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u304c\u7d44\u3081\u308b\u306e\u306f\u3059\u3054\u304f\u697d\u3060\u306a\u3068\u601d\u3044\u307e\u3057\u305f\u3002\nHA\u69cb\u6210\u3082\u7d44\u3081\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u7d44\u3093\u3067\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n# \u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3001\u3044\u3064\u3082\u304a\u4e16\u8a71\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u3001Docker\u306e\u30db\u30b9\u30c8\u52d5\u304b\u3057\u305f\u308a\u3001\u691c\u8a3c\u7528\u9014\u3067\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u3044\u307e\u3059\u3002\n\u3059\u3050\u30b5\u30fc\u30d0\u30fc\u304c\u4f5c\u6210\u3067\u304d\u3001\u4f7f\u3046\u4e8b\u304c\u3067\u304d\u308b\u3002\u3057\u304b\u3082\u3001\u4f7f\u3063\u305f\u5206\u3060\u3051\u3057\u304b\u304a\u91d1\u304c\u304b\u304b\u3089\u306a\u3044\u3002\n\n\u4fbf\u5229\u3067\u3059\u306d!\n\n\u5b9f\u306f\u300111\u6708\u306b\u300c\u3055\u304f\u3089\u77f3\u72e9DC\u898b\u5b66\u30c4\u30a2\u30fc\u300d\u306b\u53c2\u52a0\u3057\u307e\u3057\u305f\u3002\nhttps://picasablog.wordpress.com/2015/11/19/\u7b2c4\u56de\u300c\u3055\u304f\u3089\u77f3\u72e9dc\u898b\u5b66\u30c4\u30a2\u30fc\u300d\u306b\u53c2\u52a0\u3057\u307e\u3057\u305f/\n\n\u305d\u306e\u969b\u306b\u9802\u3044\u305f\u3001\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9\u306e\u30af\u30fc\u30dd\u30f3\u3067\u300cDocker\u306e\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b\u300d\u691c\u8a3c\u3092\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u203b\u691c\u8a3c\u306e\u305f\u3081\u3001firewall\u30aa\u30d5\u3001root\u3067\u306e\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\u904b\u7528\u3059\u308b\u969b\u306b\u306f\u3001\u9069\u5207\u306afirewall\u306e\u8a2d\u5b9a\u3001\u6a29\u9650\u306e\u64cd\u4f5c\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n# Docker Swarm\u3067Docker\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308b\u3002\n\n\u4e8b\u524d\u306b\u3001\u77f3\u72e9\u7b2c\uff11\u30be\u30fc\u30f3\u306b\u3001Ubuntu Server 14.04 3 LTS 64bit (Docker\u30db\u30b9\u30c8\u7528)\n\u4e8b\u524d\u306b\u3001\u77f3\u72e9\u7b2c\uff12\u30be\u30fc\u30f3\u306b\u3001Ubuntu Server 14.04 3 LTS 64bit (Docker\u30db\u30b9\u30c8\u7528)\n\u4e8b\u524d\u306b\u3001\u6771\u4eac\u7b2c\uff11\u30be\u30fc\u30f3\u306b\u3001CentOS 7.1 64bit (consul\u7528)\n\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\uff08\u8aac\u660e\u7701\u7565\uff09\n\n|\u30be\u30fc\u30f3|\u30db\u30b9\u30c8\u540d|IP|\n|---|---|---|\n|\u77f3\u72e9\u7b2c\uff11\u30be\u30fc\u30f3|docker-host-1|a.a.a.a|\n|\u77f3\u72e9\u7b2c\uff12\u30be\u30fc\u30f3|docker-host-2|b.b.b.b|\n|\u6771\u4eac\u7b2c\uff11\u30be\u30fc\u30f3|consul|c.c.c.c|\n\nhttp://kakakikikeke.blogspot.jp/2015/10/centos-consul.html \u3088\u308a\u5f15\u7528\n\n## consul\u69cb\u7bc9\n```bash\n[root@consul ~]# systemctl stop firewalld\n[root@consul ~]# cd /usr/bin\n[root@consul ~]# curl -O https://dl.bintray.com/mitchellh/consul/0.5.2_linux_amd64.zip\n[root@consul ~]# unzip 0.5.2_linux_amd64.zip\n[root@consul ~]# consul agent -server -bootstrap -client=0.0.0.0 -data-dir /tmp/consul\n```\n\n## Docker\u30db\u30b9\u30c8\u69cb\u7bc9\n\n\u516c\u5f0f\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\uff08\u8aac\u660e\u7701\u7565\uff09\nhttps://docs.docker.com/engine/installation/ubuntulinux/\n\n```bash\n# docker run hello-world\n```\n\n## Swarm\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\n\n\u3053\u3061\u3089\u3082\u3001\u516c\u5f0f\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\nhttps://docs.docker.com/swarm/install-manual/\n\n```bash\n# docker pull swarm\n```\n\n# Swarm node\u69cb\u7bc9\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u4e0a\u3067\n\n```bash\n# docker daemon -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n```\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u305f\u30bf\u30fc\u30df\u30ca\u30eb\u306b\u306f\u3001\u30ed\u30b0\u304c\u6d41\u308c\u308b\u306e\u3067\u3001\u8907\u6570\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\u3044\u307e\u3059\u3002\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n\ndocker-host-1\n\n```bash\n# docker run -d swarm join --addr=a.a.a.a:2375 consul://c.c.c.c:8500/nodes\n```\n\ndocker-host-2\n\n```bash\n# docker run -d swarm join --addr=b.b.b.b:2375 consul://c.c.c.c:8500/nodes\n```\n\n# Swarm manager\u69cb\u7bc9\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n\n```bash\n# docker run -d -p 10000:2375 swarm manage consul://c.c.c.c:8500/nodes\n```\n\n# \u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u3092\u898b\u3066\u307f\u308b\n\n```bash\n# docker -H tcp://localhost:10000 info\nContainers: 32\nImages: 7\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n docker-host-1: a.a.a.a:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 16\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.019 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-28-generic, operatingsystem=Ubuntu 14.04.3 LTS, storagedriver=aufs\n docker-host-2: b.b.b.b:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 16\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.019 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-28-generic, operatingsystem=Ubuntu 14.04.3 LTS, storagedriver=aufs\nCPUs: 2\nTotal Memory: 2.038 GiB\nName: 082f0047225d\n\n```\n\n2\u3064\u306e\u30ce\u30fc\u30c9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n## \u30b3\u30f3\u30c6\u30ca\u3092\u6ca2\u5c71\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u304c\u3001\u3069\u306e\u3088\u3046\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u308b\u304b\u306e\u8aac\u660e\u3067\u3059\u3002\uff08URL\u5148\uff09\nhttps://docs.docker.com/swarm/scheduler/strategy/\n\u4eca\u56de\u306f\u3001\nStrategy: spread\u306a\u306e\u3067\u3001\u5747\u7b49\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u914d\u7f6e\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n# docker -H tcp://localhost:10000 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n```\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u309210\u56de\u5165\u529b\n\n```bash\n# docker -H tcp://localhost:10000 run -itd ubuntu /bin/bash\n```\n\n```bash\n# docker -H tcp://localhost:10000 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS               NAMES\n94248b8d581e        ubuntu              \"/bin/bash\"         53 seconds ago       Up 52 seconds                           docker-host-2/serene_goldberg\n14756426159c        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/lonely_brown\n648aacfd52cc        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sharp_kowalevski\n5e252ac1cd66        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/condescending_engelbart\n75ef8b2e8489        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sad_liskov\n90bd7d46fe05        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/cocky_wright\n64d4378d3552        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/angry_archimedes\ndcaeb7fd8bbc        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/stoic_jang\nc8e476c8faac        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-1/agitated_curie\n264b7a389a79        ubuntu              \"/bin/bash\"         About a minute ago   Up About a minute                       docker-host-2/sharp_hypatia\n```\n\n\u305d\u308c\u305e\u308c\u306e\u30ce\u30fc\u30c9\u306b5\u3064\u305a\u3064\u30b3\u30f3\u30c6\u30ca\u304c\u914d\u7f6e\u3055\u308c\u307e\u3057\u305f\u3002\n\n# Multi-host networking\u3067Docker\u30db\u30b9\u30c8\u3092\u8de8\u3050\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u308b\u3002\n\n\u5148\u7a0b\u306f\u3001\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u308a\u307e\u3057\u305f\u3001\u3057\u304b\u3057\u3001\u30ce\u30fc\u30c9\u9593\u306e\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306f\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001\u5225\u30ce\u30fc\u30c9\u9593\uff08\u5225\u30db\u30b9\u30c8\uff09\u3067\u3082\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u7e4b\u304c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nhttps://docs.docker.com/engine/userguide/networking/get-started-overlay/\nMulti-host networking\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001Linux Kernel\u304c3.16\u4ee5\u4e0a\u3067\u306a\u3044\u3068\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\nhttp://www.neko6.info/archives/1874 \u3088\u308a\u5f15\u7528\n\n```bash\n# apt-get install linux-image-3.16.0-28-generic linux-headers-3.16.0-28\n```\n\nhttps://github.com/docker/docker/issues/14026 \u3088\u308a\u5f15\u7528\n\n```bash\n# apt-get -y update\n# apt-get -y upgrade\n# apt-get -y dist-upgrade\n# apt-get -y install aufs-tools openjdk-7-jre curl wget git vim make php-pear \\\nphp5-dev php5-curl python mc gawk ssh grep sudo htop nmon mysql-client php5-cli \\\nsqlite3 sysstat sysdig linux-headers-$(uname -r) lxc bsdtar\n# apt-get -y install linux-image-extra-$(uname -r)\n# modprobe aufs\n# apt-get clean\n# reboot\n```\n\n\u5148\u307b\u3069\u540c\u69d8\u3001\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066\n\n```bash\n# docker daemon --cluster-advertise=eth0:2376 --cluster-store=consul://c.c.c.c:8500/nodes -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\n```\n\ndocker-host-1\n\n```bash\n# docker run -d swarm join --addr=a.a.a.a:2375 consul://c.c.c.c:8500/nodes\n```\n\ndocker-host-2\n\n```bash\n# docker run -d swarm join --addr=b.b.b.b:2375 consul://c.c.c.c:8500/nodes\n```\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n\n```bash\n# docker run -d -p 10000:2375 swarm manage consul://c.c.c.c:8500/nodes\n```\n\n\u3069\u3061\u3089\u304b\u306e\u30db\u30b9\u30c8\u3067\n\n```bash\n# docker network create --driver overlay my-net\n```\n\n\u305d\u308c\u305e\u308c\u306eDocker\u30db\u30b9\u30c8\u3067\n\n```bash\n# docker -H tcp://localhost:10000 run --net=my-net -i -t ubuntu /bin/bash\n```\n\n\u7acb\u3061\u4e0a\u304c\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u300110.0.0.* \u306eIP\u304c\u5272\u308a\u632f\u3089\u308c\u307e\u3059\u3002\n\n\u7acb\u3061\u4e0a\u304c\u3063\u305f\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092ping\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u7e4b\u304c\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n# \u611f\u60f3\n\u30af\u30e9\u30b9\u30bf\u3068\u3044\u3046\u3068\u3001\u7d50\u69cb\u96e3\u3057\u3044\u306e\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3057\u305f\u304c\u3001\nswarm\u3092pull\u3057\u3066\u30ce\u30fc\u30c9\u3067\u3042\u3063\u305f\u308a\u3001\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\u304c\u7d44\u3081\u308b\u306e\u306f\u3059\u3054\u304f\u697d\u3060\u306a\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\nHA\u69cb\u6210\u3082\u7d44\u3081\u308b\u3088\u3046\u3067\u3059\u306e\u3067\u3001\u7d44\u3093\u3067\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["docker", "DockerSwarm", "\u3055\u304f\u3089\u306e\u30af\u30e9\u30a6\u30c9"]}