{"tags": ["RaspberryPi", "raspbian"], "context": "\n\nF2FS\u3068\u306f\uff1f\nWikipedia - F2FS(\u82f1\u8a9e)\u3088\u308a\u3000\n\nF2FS (Flash-Friendly File System) is a flash file system initially developed by Samsung Electronics for the Linux kernel.\n\n=> F2FS\uff08\u30d5\u30e9\u30c3\u30b7\u30e5\u30d5\u30ec\u30f3\u30c9\u30ea\u30fc\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\uff09\u306f\u3001\u6700\u521d\u306bLinux\u30ab\u30fc\u30cd\u30eb\u306e\u305f\u3081\u306b\u30b5\u30e0\u30b9\u30f3\u96fb\u5b50\u304c\u958b\u767a\u3057\u305f\u30d5\u30e9\u30c3\u30b7\u30e5\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u3059\u3002(google\u7ffb\u8a33)\nSSD\u3068\u304beMMC\u3068\u304b\u3001SD\u30ab\u30fc\u30c9\u307f\u305f\u3044\u306a\u3001NAND\u30d5\u30e9\u30c3\u30b7\u30e5\u30d9\u30fc\u30b9\u306e\u7279\u6027\u3092\u8003\u616e\u3057\u3066\u4f5c\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3089\u3057\u3044\u3067\u3059\u3088\u3002\n\n\u7c21\u5358\u306a\u6982\u8981\n\n\nmicroSD 2\u679a - 1\u679a\u76ee(rootfs=ext4)\u3067\u8d77\u52d5\u4f5c\u696d\u3057\u3066\u3001USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0\u306b\u633f\u3057\u305f2\u679a\u76ee \u306b(rootfs=f2fs)\u3092\u4f5c\u308b\npi@raspberrypi:~$ mount | grep mmc\n/dev/mmcblk0p2 on / type f2fs (rw,noatime,background_gc=on,user_xattr,acl,inline_data,extent_cache,active_logs=6)\n/dev/mmcblk0p1 on /boot type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,errors=remount-ro)\npi@raspberrypi:~$\n\n\n\n# \u3053\u308c\u3084\u308b\u3068\u3001Windows\u306eExtFS\u4f7f\u3063\u3066\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u3044\u3088\u30fc =>\u95a2\u9023:(\u3089\u305a\u3071\u3044)Windows\u4e0a\u304b\u3089\u56fa\u5b9aIP\u8a2d\u5b9a\n\n\u74b0\u5883\n\nRaspberry Pi\u3000:  \u3072\u3068\u3064 (RPi2\u3068RPi3\u3067\u78ba\u8a8d)\nmicroSD: 2\u679a:\u30002016-05-10-raspbian-jessie-lite.img\u3000\u3092\u713c\u304f\nUSB microSD\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0(\u30e9\u30a4\u30bf) : \u3072\u3068\u3064\n(jessie\u306eimg\u66f8\u304d\u8fbc\u307f\u7528\u30d1\u30bd\u30b3\u30f3: Windows 7x64)\n\n\n\u624b\u9806\n\u3042\u3068\u3067\u30012016-05-10-raspbian-jessie-lite.img\u3092\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b. (SD_ext4\u306emicroSD\u3078\u30b3\u30d4\u30fc\u3068\u304b\u3001USB-HDD\u3092\u3064\u306a\u3050\u3068\u304b\u3001NFS\u3068\u304b)\n\n\n2016-05-10-raspbian-jessie-lite.img\u30922\u679a\u306emicroSD\u3078\u713c\u304f\nSD_f2fs\u30ab\u30fc\u30c9(f2fs\u7528): \u8d77\u52d5\u3057\u3066sudo shutdown -h now (rootfs\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u62e1\u5927\u3055\u308c\u308b)\nSD_ext4\u30ab\u30fc\u30c9(\u4f5c\u696d\u7528): \u306b\u5dee\u3057\u66ff\u3048\u3066\u8d77\u52d5\u3002\n\u30c4\u30fc\u30eb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb: sudo apt-get install f2fs-tools\n\n\nSD_f2fs\u30ab\u30fc\u30c9: USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0\u306b\u3044\u308c\u3066\u3001Raspberry Pi\u3078\u633f\u3059\u3002 (/dev/sda\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3057\u305f)\n\n\u3053\u3093\u306a\u611f\u3058\npi@raspberrypi:~ $ sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT,LABEL\nNAME        FSTYPE  SIZE MOUNTPOINT LABEL\nsda                 7.4G\n\u251c\u2500sda1      vfat     63M            boot\n\u2514\u2500sda2      ext4    7.4G\nmmcblk0             7.4G\n\u251c\u2500mmcblk0p1 vfat     63M /boot      boot\n\u2514\u2500mmcblk0p2 ext4    7.4G /\npi@raspberrypi:~ $\n\n\n\n\nsda\u306e\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3001\u30de\u30a6\u30f3\u30c8\u3002sda2\u3092f2fs\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nsudo mkdir /media/boot_fs\nsudo mkdir /media/root_fs\nsudo mount -t vfat /dev/sda1 /media/boot_fs\nsudo mkfs.f2fs /dev/sda2\nsudo mount -t f2fs /dev/sda2 /media/root_fs\n\n\n\n2016-05-10-raspbian-jessie-lite.img\u3092\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\n\n\nimg\u306egeometry\u3092\u53d6\u5f97 (sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img)\n\nimg\u306egeometry\u3092\u53d6\u5f97\npi@raspberrypi:/media/RPi $ sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-10-raspbian-jessie-lite.img: cannot get geometry\nDisk ./2016-05-10-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\nDevice Boot    Start       End   #sectors  Id  System\n./2016-05-10-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-10-raspbian-jessie-lite.img2        137216   2707455    2570240  83  Linux\n./2016-05-10-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-10-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:/media/RPi $\n\n\n\n\nloopback\u3067\u30de\u30a6\u30f3\u30c8 \u4e0a\u3067\u53d6\u5f97\u3057\u305f 137216\u3092\u4f7f\u3046\nsudo mount -o loop,offset=$((512*137216)) 2016-05-10-raspbian-jessie-lite.img /media/raspimg/root\n\nmount\u5f8c\u3001ls\u3067\u78ba\u8a8d\npi@raspberrypi:/media/RPi $ sudo mount -o loop,offset=$((512*137216)) 2016-05-10-raspbian-jessie-lite.img /media/raspimg/root\npi@raspberrypi:/media/rasp/RPi $ ls  /media/raspimg/root/\nbin  boot  dev  etc  home  lib  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n\n\n\n\u3044\u307e\u306e\u3068\u3053\u308d\u4ee5\u4e0b\u306e\u3069\u308c\u3082137216\u306e\u3088\u3046\u3067\u3059\u3002\n\n\n2016-05-10-raspbian-jessie-lite.img\n2016-05-27-raspbian-jessie-lite.img\n2016-05-27-raspbian-jessie.img\n\n\n\n\n\n\n\u30b3\u30d4\u30fc\u3059\u308b sudo cp -a /media/raspimg/root/* /media/root_fs/\n\n\u8a2d\u5b9a\u3092\u7de8\u96c6: ext4=> f2fs\u3078\u3001/etc/fstab\u3068/boot/cmdline.txt\n\n\nsudo vi /media/root_fs/etc/fstab\n\n/media/root_fs/etc/fstab\n...\n/dev/mmcblk0p1  /boot           vfat    defaults          0       2\n/dev/mmcblk0p2  /               f2fs    defaults,noatime  0       1\n...\n\n\n\n\nsudo vi /media/boot_fs/cmdline.txt : rootfstype=f2fs\n\n/media/boot_fs/cmdline.txt\ndwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=f2fs elevator=deadline fsck.repair=yes rootwait\n\n\n\n\n\nsync\u3057\u3066\u3001sudo shutdown -h now\u3067\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3002\nSD_f2fs\u30ab\u30fc\u30c9\u3092\u3089\u305a\u3071\u3044\u306b\u633f\u3057\u3066\u3001\u8d77\u52d5\u3002\n\u8d77\u52d5\u5f8c\u3001\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebsudo apt-get install f2fs-tools\n\n\nWindows\u306e\u30d5\u30a1\u30a4\u30eb\u5171\u6709\u3067\u3001jessie\u306eimg\u3092\u30de\u30a6\u30f3\u30c8\n\nWindows\u3067\u30d5\u30a9\u30eb\u30c0\u5171\u6709\u3057\u3066\u3001rpi_share\u3068\u540d\u524d\u3092\u3064\u3051\u308b\n\n\u30e9\u30ba\u30d1\u30a4\u3067\u3001\n\nsudo apt-get install cifs-utils\n\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30d5\u30a9\u30eb\u30c0\u4f5c\u6210:sudo mkdir /media/img\n\n\u30de\u30a6\u30f3\u30c8:sudo mount -t cifs //<windows\u306eIP\u30a2\u30c9\u30ec\u30b9>/rpi_share  /media/img -o user=username, dom=domain,pass=passoword \u30e6\u30fc\u30b6/\u30c9\u30e1\u30a4\u30f3/\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u3002pass=\u304c\u306a\u3051\u308c\u3070\u3001\u304d\u304b\u308c\u308b\u3002\nls /media/img\n\nloopback\u30de\u30a6\u30f3\u30c8\nexport RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img\nexport PART_START1=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^1\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nexport PART_START2=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^2\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nsudo mkdir -p /media/raspimg/{boot,root}\nsudo mount -o loop,offset=$((512*$PART_START1)) $RASPBIAN_IMG /media/raspimg/boot\nsudo mount -o loop,offset=$((512*$PART_START2)) $RASPBIAN_IMG /media/raspimg/root\n# \u78ba\u8a8d.\nls /media/raspimg/root\n\n\n\n\n\n\n\u4e00\u6c17\u306b\u3084\u308b\n\n\u66f8\u304d\u8fbc\u307f\u5148\u306e\u30ab\u30fc\u30c9\u306b\u306f\u3001jessie\u3092\u66f8\u304d\u8fbc\u307e\u306a\u304f\u3066\u3088\u3044\u3002\n\u74b0\u5883\u5909\u6570\u30922\u3064\u8a2d\u5b9a\u3057\u3066\u3001\u3053\u3074\u307a\u3059\u308b\u3002\n\n\n\u66f8\u304d\u8fbc\u307f\u5148(USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0)\u306emicroSD: DEV_NEW_SD=/dev/sda\n\nRaspbian\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb: export RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img\n\n\n\n\n\nbash\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u3053\u3074\u307a\n#\n# DEV_NEW_SD: microSD on USB card reader\n#\nexport DEV_NEW_SD=/dev/sda\nexport RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img\n#\n# Mount Raspbian img\nexport PART_START1=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^1\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nexport PART_START2=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^2\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nsudo mkdir -p /media/raspimg/{boot,root}\nsudo mount -o loop,offset=$((512*$PART_START1)) $RASPBIAN_IMG /media/raspimg/boot\nsudo mount -o loop,offset=$((512*$PART_START2)) $RASPBIAN_IMG /media/raspimg/root\n\n#\n# Clear Parition info(MBR : 1st sector)\nsudo dd if=/dev/zero of=${DEV_NEW_SD} bs=512 count=1\n# Create partition\nsudo fdisk ${DEV_NEW_SD} <<EOF\np\nn\np\n1\n8192\n137215\nn\np\n2\n137216\n\nt\n1\nc\np\nw\nEOF\n\n\n#\n# Format partitions\nsudo mkfs.vfat ${DEV_NEW_SD}1\nsudo mkfs.f2fs ${DEV_NEW_SD}2\n#\n# Mount Dest Partition\nsudo mkdir /media/{boot_fs,root_fs}\nsudo mount -t vfat ${DEV_NEW_SD}1 /media/boot_fs\nsudo mount -t f2fs ${DEV_NEW_SD}2 /media/root_fs\nmount | grep ${DEV_NEW_SD}\n#\n# Copy files\ntime sudo cp -a /media/raspimg/boot/* /media/boot_fs/\ntime sudo cp -a /media/raspimg/root/* /media/root_fs/\n#\n# Edit cmdline.txt and fstab (ext4 to f2fs)\nsudo sed -i 's/ quiet init=.*$//' /media/boot_fs/cmdline.txt\nsudo sed -i 's/rootfstype=ext4/rootfstype=f2fs/' /media/boot_fs/cmdline.txt\nsudo sed -i 's/ext4/f2fs/g' /media/root_fs/etc/fstab\n#\n# Sync\nsync\nsleep 5\n\n\n# Unmount Dest drive\nsudo umount ${DEV_NEW_SD}1\nsudo umount ${DEV_NEW_SD}2\nsudo rmdir /media/{boot_fs,root_fs}\n\n# Unmount Raspbian img\nsudo umount /media/raspimg/boot\nsudo umount /media/raspimg/root\nsudo rmdir /media/raspimg/{boot,root,}\n\n\n\n\u53c2\u8003\u306b\u3057\u305f(\u3068\u3044\u3046\u304b\u305d\u306e\u307e\u307e..)\u30da\u30fc\u30b8\n\nHOWTO: Replace the micro SD card's ext4 root partition by f2fs on the Raspberry PI\nMounting a raspbian image file as loop device\naaa\n\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-10-raspbian-jessie-lite.img: cannot get geometry\n\nDisk ./2016-05-10-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-10-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-10-raspbian-jessie-lite.img2        137216   2707455    2570240  83  Linux\n./2016-05-10-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-10-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-27-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-27-raspbian-jessie-lite.img: cannot get geometry\n\nDisk ./2016-05-27-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-27-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-27-raspbian-jessie-lite.img2        137216   2709503    2572288  83  Linux\n./2016-05-27-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-27-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-27-raspbian-jessie.img\nsfdisk: Disk ./2016-05-27-raspbian-jessie.img: cannot get geometry\n\nDisk ./2016-05-27-raspbian-jessie.img: 488 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-27-raspbian-jessie.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-27-raspbian-jessie.img2        137216   7849983    7712768  83  Linux\n./2016-05-27-raspbian-jessie.img3             0         -          0   0  Empty\n./2016-05-27-raspbian-jessie.img4             0         -          0   0  Empty\npi@raspberrypi:~$ \n\n## F2FS\u3068\u306f\uff1f\n\n[Wikipedia - F2FS(\u82f1\u8a9e)](https://en.wikipedia.org/wiki/F2FS)\u3088\u308a\u3000\n> F2FS (Flash-Friendly File System) is a flash file system initially developed by Samsung Electronics for the Linux kernel.\n\n=> F2FS\uff08\u30d5\u30e9\u30c3\u30b7\u30e5\u30d5\u30ec\u30f3\u30c9\u30ea\u30fc\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\uff09\u306f\u3001\u6700\u521d\u306bLinux\u30ab\u30fc\u30cd\u30eb\u306e\u305f\u3081\u306b\u30b5\u30e0\u30b9\u30f3\u96fb\u5b50\u304c\u958b\u767a\u3057\u305f\u30d5\u30e9\u30c3\u30b7\u30e5\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3067\u3059\u3002(google\u7ffb\u8a33)\n\nSSD\u3068\u304beMMC\u3068\u304b\u3001SD\u30ab\u30fc\u30c9\u307f\u305f\u3044\u306a\u3001NAND\u30d5\u30e9\u30c3\u30b7\u30e5\u30d9\u30fc\u30b9\u306e\u7279\u6027\u3092\u8003\u616e\u3057\u3066\u4f5c\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3089\u3057\u3044\u3067\u3059\u3088\u3002\n\n## \u7c21\u5358\u306a\u6982\u8981\n- microSD 2\u679a - 1\u679a\u76ee(rootfs=ext4)\u3067\u8d77\u52d5\u4f5c\u696d\u3057\u3066\u3001USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0\u306b\u633f\u3057\u305f2\u679a\u76ee \u306b(rootfs=f2fs)\u3092\u4f5c\u308b\n\n    ```shell-session\npi@raspberrypi:~$ mount | grep mmc\n/dev/mmcblk0p2 on / type f2fs (rw,noatime,background_gc=on,user_xattr,acl,inline_data,extent_cache,active_logs=6)\n/dev/mmcblk0p1 on /boot type vfat (rw,relatime,fmask=0022,dmask=0022,codepage=437,iocharset=ascii,shortname=mixed,errors=remount-ro)\npi@raspberrypi:~$\n```\n\n\\# \u3053\u308c\u3084\u308b\u3068\u3001Windows\u306eExtFS\u4f7f\u3063\u3066\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u3044\u3088\u30fc =>\u95a2\u9023:[\\(\u3089\u305a\u3071\u3044)Windows\u4e0a\u304b\u3089\u56fa\u5b9aIP\u8a2d\u5b9a](http://qiita.com/mt08/item/2da1cce534dfdc84f5e3)\n\n## \u74b0\u5883\n- Raspberry Pi\u3000:  \u3072\u3068\u3064 (RPi2\u3068RPi3\u3067\u78ba\u8a8d)\n- microSD: 2\u679a:\u3000`2016-05-10-raspbian-jessie-lite.img`\u3000\u3092\u713c\u304f\n- USB microSD\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0(\u30e9\u30a4\u30bf) : \u3072\u3068\u3064\n- (jessie\u306eimg\u66f8\u304d\u8fbc\u307f\u7528\u30d1\u30bd\u30b3\u30f3: Windows 7x64)\n\n## \u624b\u9806\n \u3042\u3068\u3067\u3001`2016-05-10-raspbian-jessie-lite.img`\u3092\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b. (SD_ext4\u306emicroSD\u3078\u30b3\u30d4\u30fc\u3068\u304b\u3001USB-HDD\u3092\u3064\u306a\u3050\u3068\u304b\u3001NFS\u3068\u304b)\n\n1. `2016-05-10-raspbian-jessie-lite.img`\u30922\u679a\u306emicroSD\u3078\u713c\u304f\n2. SD_f2fs\u30ab\u30fc\u30c9(f2fs\u7528): \u8d77\u52d5\u3057\u3066`sudo shutdown -h now` (rootfs\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u62e1\u5927\u3055\u308c\u308b)\n3. SD_ext4\u30ab\u30fc\u30c9(\u4f5c\u696d\u7528): \u306b\u5dee\u3057\u66ff\u3048\u3066\u8d77\u52d5\u3002\n4. \u30c4\u30fc\u30eb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb: `sudo apt-get install f2fs-tools`\n5. `SD_f2fs`\u30ab\u30fc\u30c9: USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0\u306b\u3044\u308c\u3066\u3001Raspberry Pi\u3078\u633f\u3059\u3002 (`/dev/sda`\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3057\u305f)\n\n    ```shell-session:\u3053\u3093\u306a\u611f\u3058\npi@raspberrypi:~ $ sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT,LABEL\nNAME        FSTYPE  SIZE MOUNTPOINT LABEL\nsda                 7.4G\n\u251c\u2500sda1      vfat     63M            boot\n\u2514\u2500sda2      ext4    7.4G\nmmcblk0             7.4G\n\u251c\u2500mmcblk0p1 vfat     63M /boot      boot\n\u2514\u2500mmcblk0p2 ext4    7.4G /\npi@raspberrypi:~ $\n```\n\n6. `sda`\u306e\u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3001\u30de\u30a6\u30f3\u30c8\u3002`sda2`\u3092`f2fs`\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n\n    ```shell-session\nsudo mkdir /media/boot_fs\nsudo mkdir /media/root_fs\nsudo mount -t vfat /dev/sda1 /media/boot_fs\nsudo mkfs.f2fs /dev/sda2\nsudo mount -t f2fs /dev/sda2 /media/root_fs\n```\n7. `2016-05-10-raspbian-jessie-lite.img`\u3092\u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\n    1. img\u306egeometry\u3092\u53d6\u5f97 (`sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img`)\n\n        ```shell-session:img\u306egeometry\u3092\u53d6\u5f97\npi@raspberrypi:/media/RPi $ sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-10-raspbian-jessie-lite.img: cannot get geometry\nDisk ./2016-05-10-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-10-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-10-raspbian-jessie-lite.img2        137216   2707455    2570240  83  Linux\n./2016-05-10-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-10-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:/media/RPi $\n```\n    2. loopback\u3067\u30de\u30a6\u30f3\u30c8 \u4e0a\u3067\u53d6\u5f97\u3057\u305f `137216`\u3092\u4f7f\u3046\n    `sudo mount -o loop,offset=$((512*137216)) 2016-05-10-raspbian-jessie-lite.img /media/raspimg/root`\n\n        ```shell-session:mount\u5f8c\u3001ls\u3067\u78ba\u8a8d\npi@raspberrypi:/media/RPi $ sudo mount -o loop,offset=$((512*137216)) 2016-05-10-raspbian-jessie-lite.img /media/raspimg/root\npi@raspberrypi:/media/rasp/RPi $ ls  /media/raspimg/root/\nbin  boot  dev  etc  home  lib  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var\n```\n        - \u3044\u307e\u306e\u3068\u3053\u308d\u4ee5\u4e0b\u306e\u3069\u308c\u3082`137216`\u306e\u3088\u3046\u3067\u3059\u3002\n            - `2016-05-10-raspbian-jessie-lite.img`\n            - `2016-05-27-raspbian-jessie-lite.img`\n            - `2016-05-27-raspbian-jessie.img`\n8. \u30b3\u30d4\u30fc\u3059\u308b <br>`sudo cp -a /media/raspimg/root/* /media/root_fs/`\n9. \u8a2d\u5b9a\u3092\u7de8\u96c6: `ext4`=> `f2fs`\u3078\u3001`/etc/fstab`\u3068`/boot/cmdline.txt`\n    1. `sudo vi /media/root_fs/etc/fstab`\n\n        ```txt:/media/root_fs/etc/fstab\n...\n/dev/mmcblk0p1  /boot           vfat    defaults          0       2\n/dev/mmcblk0p2  /               f2fs    defaults,noatime  0       1\n...\n```\n    2. `sudo vi /media/boot_fs/cmdline.txt` : rootfstype=f2fs\n\n        ```txt:/media/boot_fs/cmdline.txt\ndwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=f2fs elevator=deadline fsck.repair=yes rootwait\n```\n\n10. `sync`\u3057\u3066\u3001`sudo shutdown -h now`\u3067\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3002\n11. SD_f2fs\u30ab\u30fc\u30c9\u3092\u3089\u305a\u3071\u3044\u306b\u633f\u3057\u3066\u3001\u8d77\u52d5\u3002\n12. \u8d77\u52d5\u5f8c\u3001\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb<br>`sudo apt-get install f2fs-tools`\n\n### Windows\u306e\u30d5\u30a1\u30a4\u30eb\u5171\u6709\u3067\u3001jessie\u306eimg\u3092\u30de\u30a6\u30f3\u30c8\n1. Windows\u3067\u30d5\u30a9\u30eb\u30c0\u5171\u6709\u3057\u3066\u3001`rpi_share`\u3068\u540d\u524d\u3092\u3064\u3051\u308b\n2. \u30e9\u30ba\u30d1\u30a4\u3067\u3001\n    1. `sudo apt-get install cifs-utils`\n    2. \u30de\u30a6\u30f3\u30c8\u3059\u308b\u30d5\u30a9\u30eb\u30c0\u4f5c\u6210:<br>`sudo mkdir /media/img`\n    3. \u30de\u30a6\u30f3\u30c8:<br>`sudo mount -t cifs //<windows\u306eIP\u30a2\u30c9\u30ec\u30b9>/rpi_share  /media/img -o user=username, dom=domain,pass=passoword` <br>\u30e6\u30fc\u30b6/\u30c9\u30e1\u30a4\u30f3/\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u5fc5\u8981\u306a\u3082\u306e\u3092\u3002`pass=`\u304c\u306a\u3051\u308c\u3070\u3001\u304d\u304b\u308c\u308b\u3002\n    4. `ls /media/img`\n\n    5. loopback\u30de\u30a6\u30f3\u30c8\n\n        ```\nexport RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img\nexport PART_START1=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^1\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nexport PART_START2=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^2\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nsudo mkdir -p /media/raspimg/{boot,root}\nsudo mount -o loop,offset=$((512*$PART_START1)) $RASPBIAN_IMG /media/raspimg/boot\nsudo mount -o loop,offset=$((512*$PART_START2)) $RASPBIAN_IMG /media/raspimg/root\n# \u78ba\u8a8d.\nls /media/raspimg/root\n```\n\n### \u4e00\u6c17\u306b\u3084\u308b\n- \u66f8\u304d\u8fbc\u307f\u5148\u306e\u30ab\u30fc\u30c9\u306b\u306f\u3001<font color='red'>**jessie\u3092\u66f8\u304d\u8fbc\u307e\u306a\u304f\u3066\u3088\u3044**</font>\u3002\n- \u74b0\u5883\u5909\u6570\u30922\u3064\u8a2d\u5b9a\u3057\u3066\u3001\u3053\u3074\u307a\u3059\u308b\u3002\n    - \u66f8\u304d\u8fbc\u307f\u5148(USB\u30ab\u30fc\u30c9\u30ea\u30fc\u30c0)\u306emicroSD: `DEV_NEW_SD=/dev/sda`\n    - Raspbian\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb: `export RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img`\n\n```bash:bash\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u3053\u3074\u307a\n#\n# DEV_NEW_SD: microSD on USB card reader\n#\nexport DEV_NEW_SD=/dev/sda\nexport RASPBIAN_IMG=/media/img/2016-05-27-raspbian-jessie-lite.img\n#\n# Mount Raspbian img\nexport PART_START1=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^1\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nexport PART_START2=$(parted $RASPBIAN_IMG -ms unit s p | grep \"^2\" | cut -f 2 -d: | sed 's/[^0-9]//g')\nsudo mkdir -p /media/raspimg/{boot,root}\nsudo mount -o loop,offset=$((512*$PART_START1)) $RASPBIAN_IMG /media/raspimg/boot\nsudo mount -o loop,offset=$((512*$PART_START2)) $RASPBIAN_IMG /media/raspimg/root\n\n#\n# Clear Parition info(MBR : 1st sector)\nsudo dd if=/dev/zero of=${DEV_NEW_SD} bs=512 count=1\n# Create partition\nsudo fdisk ${DEV_NEW_SD} <<EOF\np\nn\np\n1\n8192\n137215\nn\np\n2\n137216\n\nt\n1\nc\np\nw\nEOF\n\n\n#\n# Format partitions\nsudo mkfs.vfat ${DEV_NEW_SD}1\nsudo mkfs.f2fs ${DEV_NEW_SD}2\n#\n# Mount Dest Partition\nsudo mkdir /media/{boot_fs,root_fs}\nsudo mount -t vfat ${DEV_NEW_SD}1 /media/boot_fs\nsudo mount -t f2fs ${DEV_NEW_SD}2 /media/root_fs\nmount | grep ${DEV_NEW_SD}\n#\n# Copy files\ntime sudo cp -a /media/raspimg/boot/* /media/boot_fs/\ntime sudo cp -a /media/raspimg/root/* /media/root_fs/\n#\n# Edit cmdline.txt and fstab (ext4 to f2fs)\nsudo sed -i 's/ quiet init=.*$//' /media/boot_fs/cmdline.txt\nsudo sed -i 's/rootfstype=ext4/rootfstype=f2fs/' /media/boot_fs/cmdline.txt\nsudo sed -i 's/ext4/f2fs/g' /media/root_fs/etc/fstab\n#\n# Sync\nsync\nsleep 5\n\n\n# Unmount Dest drive\nsudo umount ${DEV_NEW_SD}1\nsudo umount ${DEV_NEW_SD}2\nsudo rmdir /media/{boot_fs,root_fs}\n\n# Unmount Raspbian img\nsudo umount /media/raspimg/boot\nsudo umount /media/raspimg/root\nsudo rmdir /media/raspimg/{boot,root,}\n```\n\n\n## \u53c2\u8003\u306b\u3057\u305f(\u3068\u3044\u3046\u304b\u305d\u306e\u307e\u307e..)\u30da\u30fc\u30b8\n- [HOWTO: Replace the micro SD card's ext4 root partition by f2fs on the Raspberry PI](http://whitehorseplanet.org/gate/topics/documentation/public/howto_ext4_to_f2fs_root_partition_raspi.html)\n- [Mounting a raspbian image file as loop device](http://www.grosshans.biz/WordPress/?p=19)\n- aaa\n\n```shell-session\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-10-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-10-raspbian-jessie-lite.img: cannot get geometry\n\nDisk ./2016-05-10-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-10-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-10-raspbian-jessie-lite.img2        137216   2707455    2570240  83  Linux\n./2016-05-10-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-10-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-27-raspbian-jessie-lite.img\nsfdisk: Disk ./2016-05-27-raspbian-jessie-lite.img: cannot get geometry\n\nDisk ./2016-05-27-raspbian-jessie-lite.img: 168 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-27-raspbian-jessie-lite.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-27-raspbian-jessie-lite.img2        137216   2709503    2572288  83  Linux\n./2016-05-27-raspbian-jessie-lite.img3             0         -          0   0  Empty\n./2016-05-27-raspbian-jessie-lite.img4             0         -          0   0  Empty\npi@raspberrypi:~$ sfdisk -uS -l ./2016-05-27-raspbian-jessie.img\nsfdisk: Disk ./2016-05-27-raspbian-jessie.img: cannot get geometry\n\nDisk ./2016-05-27-raspbian-jessie.img: 488 cylinders, 255 heads, 63 sectors/track\nUnits: sectors of 512 bytes, counting from 0\n\n   Device Boot    Start       End   #sectors  Id  System\n./2016-05-27-raspbian-jessie.img1          8192    137215     129024   c  W95 FAT32 (LBA)\n./2016-05-27-raspbian-jessie.img2        137216   7849983    7712768  83  Linux\n./2016-05-27-raspbian-jessie.img3             0         -          0   0  Empty\n./2016-05-27-raspbian-jessie.img4             0         -          0   0  Empty\npi@raspberrypi:~$ \n```\n"}