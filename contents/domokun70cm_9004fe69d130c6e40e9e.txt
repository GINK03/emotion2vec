{"context": "\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\u3053\u306e\u624b\u9806\u306f\u3001JAWS-UG CLI\u5c02\u9580\u652f\u90e8 #58 KMS\u5165\u9580\u3067\u5b9f\u65bd\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u5fc5\u8981\u306a\u6a29\u9650\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nKMS\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nS3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nSTS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nIAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\naws-cli/1.10.56 Python/2.7.10 Linux/4.4.15-25.57.amzn1.x86_64 botocore/1.4.46\n\n\n\n0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n\n\n\n0.5. \u5909\u6570\u306e\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nADMIN_NAME='jawsug-cli-admin'\n\nALIAS=\"alias/cli-handson0815\"\n\nKEY_ID=$(aws kms list-aliases \\\n    --query \"Aliases[?AliasName == \\`${ALIAS}\\`].TargetKeyId\" \\\n    --output text) \\\n    && echo ${KEY_ID}\n\n\n\n1. \u7ba1\u7406\u8005\u60c5\u5831\u306e\u8a8d\u8a3c\u60c5\u5831\u53d6\u5f97\n\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u751f\u6210\u3057\u3001\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n1.0 \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\u3053\u3053\u3067\u3001\u6700\u521d\u306b\u5229\u7528\u3057\u3066\u3044\u305f\u8a8d\u8a3c\u60c5\u5831\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u5834\u5408\u306f\u3001\u74b0\u5883\u5909\u6570\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b3\u30de\u30f3\u30c9\nunset AWS_DEFAULT_PROFILE\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************EPRQ         iam-role\nsecret_key     ****************RQyb         iam-role\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\u5225\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u5834\u5408\u306b\u306f\u3001\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE='\uff08\u5207\u308a\u66ff\u3048\u524d\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\uff09'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n1.1. access key\u306e\u4f5c\u6210\u3068\u53d6\u5f97\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMIN_NAME: ${ADMIN_NAME}\n\nETX\n\n\n\n\u7d50\u679c\n\n    ADMIN_NAME: jawsug-cli-admin\n\n\n\n\naccess key\u306e\u4f5c\u6210\u3068\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\naws iam create-access-key \\\n    --user-name ${ADMIN_NAME} \\\n    > ${ADMIN_NAME}.json \\\n    && cat ${ADMIN_NAME}.json\n\n\n\n\u7d50\u679c\n{\n    \"AccessKey\": {\n        \"UserName\": \"jawsug-cli-admin\",\n        \"Status\": \"Active\",\n        \"CreateDate\": \"2016-08-06T05:55:49.222Z\",\n        \"SecretAccessKey\": \"****************************************\",\n        \"AccessKeyId\": \"********************\"\n    }\n}\n\n\n\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u62bd\u51fa\n\n\u30b3\u30de\u30f3\u30c9\nADMIN_ACCESS_KEY=$( \\\n    cat ${ADMIN_NAME}.json \\\n    | jp.py 'AccessKey.AccessKeyId' \\\n    | sed 's/\"//g') \\\n    && echo ${ADMIN_ACCESS_KEY}\n\nADMIN_SECRET_ACCESS_KEY=$( \\\n    cat ${ADMIN_NAME}.json \\\n    | jp.py 'AccessKey.SecretAccessKey' \\\n    | sed 's/\"//g') \\\n    && echo ${ADMIN_SECRET_ACCESS_KEY}\n\n\n\n1.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u6307\u5b9a\n\u540c\u3058\u540d\u524d\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b3\u30de\u30f3\u30c9\nADMINS_PROFILE_NAME=${ADMIN_NAME}\n\n\n\n1.3. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u672a\u4f7f\u7528\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws configure get aws_access_key_id \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure get aws_secret_access_key \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure get region \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n\n\n\n1.4. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMIN_NAME: ${ADMIN_NAME}\n    ACCESS_KEY: ${ADMIN_ACCESS_KEY}\n    SECRET_ACCESS_KEY: ${ADMIN_SECRET_ACCESS_KEY}\n    REGION: ${AWS_DEFAULT_REGION}\n\nETX\n\n\n\n\u7d50\u679c\n\n    ADMIN_NAME: jawsug-cli-admin\n    ACCESS_KEY: ********************\n    SECRET_ACCESS_KEY: ***********************************\n    REGION: ap-northeast-1\n\n\n\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws configure set aws_access_key_id ${ADMIN_ACCESS_KEY} \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure set aws_secret_access_key ${ADMIN_SECRET_ACCESS_KEY} \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure set region ${AWS_DEFAULT_REGION} \\\n    --profile ${ADMINS_PROFILE_NAME}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n1.5. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\uff08.aws/credentials\uff09\n\n\u30b3\u30de\u30f3\u30c9\ncat ~/.aws/credentials\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n[jawsug-cli-user]\naws_access_key_id = ********************\naws_secret_access_key = ***********************************\n[jawsug-cli-admin]\naws_access_key_id = ********************\naws_secret_access_key = ***********************************\n\n\n\n1.6. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\uff08.aws/config\uff09\n\n\u30b3\u30de\u30f3\u30c9\ncat ~/.aws/config\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n[profile jawsug-cli-user]\nregion = ap-northeast-1\ns3 =\n    signature_version = s3v4\n[profile jawsug-cli-admin]\nregion = ap-northeast-1\n\n\n\n2. \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\n2.1. \u73fe\u5728\u306e\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\u3042\u3068\u3067\u73fe\u5728\u306e\u72b6\u614b\u306b\u623b\u308b\u305f\u3081\u3001\u7d50\u679c\u3092\u63a7\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u4ee5\u4e0b\u306e\u7d50\u679c\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************CIIA         iam-role\nsecret_key     ****************wGIk         iam-role\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n2.2. \u5207\u66ff\u5f8c\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMINS_PROFILE_NAME: ${ADMINS_PROFILE_NAME}\n\nETX\n\n\n\n\u7d50\u679c\n\n    ADMINS_PROFILE_NAME: jawsug-cli-admin\n\n\n\n\n2.3. \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${ADMINS_PROFILE_NAME}\n\n\n\n2.4. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************QNVA shared-credentials-file\nsecret_key     ****************fTJ+ shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n3. \u30ad\u30fc\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\n\u4efb\u610f\u306e\u5468\u671f\u3067\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n3.1. \u8a2d\u5b9a\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws kms get-key-rotation-status \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyRotationEnabled\": false\n}\n\n\n\n3.2. \u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u6709\u52b9\u5316\n\n\u30b3\u30de\u30f3\u30c9\naws kms enable-key-rotation \\\n    --key-id  ${KEY_ID}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n3.3. \u8a2d\u5b9a\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws kms get-key-rotation-status \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyRotationEnabled\": true\n}\n\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n# \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\n\u3053\u306e\u624b\u9806\u306f\u3001[JAWS-UG CLI\u5c02\u9580\u652f\u90e8 #58 KMS\u5165\u9580](https://manage.doorkeeper.jp/groups/jawsug-cli/events/41911)\u3067\u5b9f\u65bd\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n## \u5fc5\u8981\u306a\u6a29\u9650\n\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- KMS\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- S3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- STS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- IAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n# 0. \u6e96\u5099\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n## 0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n## 0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```text:\u7d50\u679c\naws-cli/1.10.56 Python/2.7.10 Linux/4.4.15-25.57.amzn1.x86_64 botocore/1.4.46\n```\n\n## 0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n```\n\n## 0.5. \u5909\u6570\u306e\u8a2d\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nADMIN_NAME='jawsug-cli-admin'\n\nALIAS=\"alias/cli-handson0815\"\n\nKEY_ID=$(aws kms list-aliases \\\n    --query \"Aliases[?AliasName == \\`${ALIAS}\\`].TargetKeyId\" \\\n    --output text) \\\n    && echo ${KEY_ID}\n```\n\n# 1. \u7ba1\u7406\u8005\u60c5\u5831\u306e\u8a8d\u8a3c\u60c5\u5831\u53d6\u5f97\n\n\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u751f\u6210\u3057\u3001\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n## 1.0 \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\n\u3053\u3053\u3067\u3001\u6700\u521d\u306b\u5229\u7528\u3057\u3066\u3044\u305f\u8a8d\u8a3c\u60c5\u5831\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u5834\u5408\u306f\u3001\u74b0\u5883\u5909\u6570\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\nunset AWS_DEFAULT_PROFILE\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************EPRQ         iam-role\nsecret_key     ****************RQyb         iam-role\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n\u5225\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u305f\u5834\u5408\u306b\u306f\u3001\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE='\uff08\u5207\u308a\u66ff\u3048\u524d\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\uff09'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n## 1.1. access key\u306e\u4f5c\u6210\u3068\u53d6\u5f97\n\n### \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMIN_NAME: ${ADMIN_NAME}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n    ADMIN_NAME: jawsug-cli-admin\n\n```\n\n### access key\u306e\u4f5c\u6210\u3068\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws iam create-access-key \\\n    --user-name ${ADMIN_NAME} \\\n    > ${ADMIN_NAME}.json \\\n    && cat ${ADMIN_NAME}.json\n```\n\n```json:\u7d50\u679c:\n{\n    \"AccessKey\": {\n        \"UserName\": \"jawsug-cli-admin\",\n        \"Status\": \"Active\",\n        \"CreateDate\": \"2016-08-06T05:55:49.222Z\",\n        \"SecretAccessKey\": \"****************************************\",\n        \"AccessKeyId\": \"********************\"\n    }\n}\n```\n\n### \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u62bd\u51fa\n\n```bash:\u30b3\u30de\u30f3\u30c9\nADMIN_ACCESS_KEY=$( \\\n    cat ${ADMIN_NAME}.json \\\n    | jp.py 'AccessKey.AccessKeyId' \\\n    | sed 's/\"//g') \\\n    && echo ${ADMIN_ACCESS_KEY}\n\nADMIN_SECRET_ACCESS_KEY=$( \\\n    cat ${ADMIN_NAME}.json \\\n    | jp.py 'AccessKey.SecretAccessKey' \\\n    | sed 's/\"//g') \\\n    && echo ${ADMIN_SECRET_ACCESS_KEY}\n```\n\n\n## 1.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u6307\u5b9a\n\n\u540c\u3058\u540d\u524d\u306e\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\nADMINS_PROFILE_NAME=${ADMIN_NAME}\n```\n\n## 1.3. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u672a\u4f7f\u7528\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure get aws_access_key_id \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure get aws_secret_access_key \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure get region \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\nThe config profile (jawsug-cli-admin) could not be found\n```\n\n\n## 1.4. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n### \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMIN_NAME: ${ADMIN_NAME}\n    ACCESS_KEY: ${ADMIN_ACCESS_KEY}\n    SECRET_ACCESS_KEY: ${ADMIN_SECRET_ACCESS_KEY}\n    REGION: ${AWS_DEFAULT_REGION}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n    ADMIN_NAME: jawsug-cli-admin\n    ACCESS_KEY: ********************\n    SECRET_ACCESS_KEY: ***********************************\n    REGION: ap-northeast-1\n\n```\n\n\n### \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure set aws_access_key_id ${ADMIN_ACCESS_KEY} \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure set aws_secret_access_key ${ADMIN_SECRET_ACCESS_KEY} \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure set region ${AWS_DEFAULT_REGION} \\\n    --profile ${ADMINS_PROFILE_NAME}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n## 1.5. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\uff08.aws/credentials\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat ~/.aws/credentials\n```\n\n```text:\u7d50\u679c\uff08\u4f8b\uff09\n[jawsug-cli-user]\naws_access_key_id = ********************\naws_secret_access_key = ***********************************\n[jawsug-cli-admin]\naws_access_key_id = ********************\naws_secret_access_key = ***********************************\n```\n\n## 1.6. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\uff08.aws/config\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat ~/.aws/config\n```\n\n```text:\u7d50\u679c\uff08\u4f8b\uff09\n[profile jawsug-cli-user]\nregion = ap-northeast-1\ns3 =\n    signature_version = s3v4\n[profile jawsug-cli-admin]\nregion = ap-northeast-1\n```\n\n\n# 2. \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\n## 2.1. \u73fe\u5728\u306e\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\n\u3042\u3068\u3067\u73fe\u5728\u306e\u72b6\u614b\u306b\u623b\u308b\u305f\u3081\u3001\u7d50\u679c\u3092\u63a7\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u4ee5\u4e0b\u306e\u7d50\u679c\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\uff08\u4f8b\uff09\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************CIIA         iam-role\nsecret_key     ****************wGIk         iam-role\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n## 2.2. \u5207\u66ff\u5f8c\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    ADMINS_PROFILE_NAME: ${ADMINS_PROFILE_NAME}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n    ADMINS_PROFILE_NAME: jawsug-cli-admin\n\n```\n\n\n## 2.3. \u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${ADMINS_PROFILE_NAME}\n```\n\n## 2.4. \u8a8d\u8a3c\u60c5\u5831\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************QNVA shared-credentials-file\nsecret_key     ****************fTJ+ shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n# 3. \u30ad\u30fc\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\n\n\u4efb\u610f\u306e\u5468\u671f\u3067\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n## 3.1. \u8a2d\u5b9a\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms get-key-rotation-status \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyRotationEnabled\": false\n}\n```\n\n## 3.2. \u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u6709\u52b9\u5316\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms enable-key-rotation \\\n    --key-id  ${KEY_ID}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n\n## 3.3. \u8a2d\u5b9a\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms get-key-rotation-status \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyRotationEnabled\": true\n}\n```\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n", "tags": ["AWS", "aws-cli", "kms"]}