{"context": "\u203b\u300c\u2248\u2248\u2248\u300d\u306f\u7701\u7565\u3092\u8868\u3059\n\u203bExpress.js\u3082\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u4e00\u90e8\u305d\u308c\u7528\u306e\u66f8\u304d\u65b9\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000\u904e\u53bb\u8a18\u4e8b\uff1aNode.js+Express.js+log4js\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\n$ rpm -qi td-agent\nName        : td-agent\nVersion     : 2.3.1\nRelease     : 0.el7\nArchitecture: x86_64\n\u2248\u2248\u2248\n\n$ node -v\nv6.2.1\n\n$ cat package.json\n{\n  \u2248\u2248\u2248\n  \"dependencies\": {\n    \"log4js\": \"^0.6.37\",\n    \"fluent-logger\": \"^1.1.1\",\n    \u2248\u2248\u2248\n  },\n  \u2248\u2248\u2248\n}\n\n\nFluentd\u306e\u8a2d\u5b9a\n$ cat /etc/td-agent/td-agent.conf \n\u2248\u2248\u2248\n<match nodejs.access.*>\n        type file\n        path /var/log/nodejs/td-access.log\n</match>\n\n<match nodejs.system.*>\n    type file\n    path /var/log/nodejs/td-system.log\n</match>\n\n$ /etc/init.d/td-agent restart\n\n\nlog4js\u306e\u8a2d\u5b9a\n$ cat modules/logger.js \nvar log4js = require('log4js');\n\nlog4js.configure({\n    \"levels\": {\n      \"access\": \"ALL\",\n      \"system\": \"ALL\",\n      \"error\": \"ERROR\"\n    }\n});\n\nlog4js.addAppender(\n        require('fluent-logger').support.log4jsAppender(\"nodejs.access\", {\n                host: \"localhost\",\n                port: 24224,\n                timeout: 3.0,\n                levelTag: true\n        }),\n        [\"access\"]\n);\nlog4js.addAppender(\n        require('fluent-logger').support.log4jsAppender(\"nodejs.system\", {\n                host: \"localhost\",\n                port: 24224,\n                timeout: 3.0,\n                levelTag: true\n        }),\n        [\"system\", \"error\"]\n);\n\n// \u4ee5\u4e0b\u306f\u3001Express.js\u7528\u306e\u8a2d\u5b9a\nmodule.exports = {\n  access: log4js.getLogger('access'),\n  system: log4js.getLogger('system'),\n  error: log4js.getLogger('error'),\n  express: log4js.connectLogger(log4js.getLogger('access'), {level: log4js.levels.INFO}),\n  isDebug: function(category) {\n    return (log4js.levels.DEBUG.level >= category.level.level);\n  }\n};\n\n\n\u203b\u300c\u2248\u2248\u2248\u300d\u306f\u7701\u7565\u3092\u8868\u3059\n\u203bExpress.js\u3082\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u4e00\u90e8\u305d\u308c\u7528\u306e\u66f8\u304d\u65b9\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000\u904e\u53bb\u8a18\u4e8b\uff1a<a href=\"http://qiita.com/cobachan/items/953a507c7eb772f7f5d8\">Node.js+Express.js+log4js</a>\n\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n$ rpm -qi td-agent\nName        : td-agent\nVersion     : 2.3.1\nRelease     : 0.el7\nArchitecture: x86_64\n\u2248\u2248\u2248\n```\n\n```\n$ node -v\nv6.2.1\n```\n\n```\n$ cat package.json\n{\n  \u2248\u2248\u2248\n  \"dependencies\": {\n    \"log4js\": \"^0.6.37\",\n    \"fluent-logger\": \"^1.1.1\",\n    \u2248\u2248\u2248\n  },\n  \u2248\u2248\u2248\n}\n```\n\n# Fluentd\u306e\u8a2d\u5b9a\n```\n$ cat /etc/td-agent/td-agent.conf \n\u2248\u2248\u2248\n<match nodejs.access.*>\n        type file\n        path /var/log/nodejs/td-access.log\n</match>\n\n<match nodejs.system.*>\n\ttype file\n\tpath /var/log/nodejs/td-system.log\n</match>\n```\n\n```\n$ /etc/init.d/td-agent restart\n```\n\n# log4js\u306e\u8a2d\u5b9a\n```\n$ cat modules/logger.js \nvar log4js = require('log4js');\n\nlog4js.configure({\n    \"levels\": {\n      \"access\": \"ALL\",\n      \"system\": \"ALL\",\n      \"error\": \"ERROR\"\n    }\n});\n\nlog4js.addAppender(\n        require('fluent-logger').support.log4jsAppender(\"nodejs.access\", {\n                host: \"localhost\",\n                port: 24224,\n                timeout: 3.0,\n                levelTag: true\n        }),\n        [\"access\"]\n);\nlog4js.addAppender(\n        require('fluent-logger').support.log4jsAppender(\"nodejs.system\", {\n                host: \"localhost\",\n                port: 24224,\n                timeout: 3.0,\n                levelTag: true\n        }),\n        [\"system\", \"error\"]\n);\n\n// \u4ee5\u4e0b\u306f\u3001Express.js\u7528\u306e\u8a2d\u5b9a\nmodule.exports = {\n  access: log4js.getLogger('access'),\n  system: log4js.getLogger('system'),\n  error: log4js.getLogger('error'),\n  express: log4js.connectLogger(log4js.getLogger('access'), {level: log4js.levels.INFO}),\n  isDebug: function(category) {\n    return (log4js.levels.DEBUG.level >= category.level.level);\n  }\n};\n\n", "tags": ["Node.js", "fluentd", "log4js"]}