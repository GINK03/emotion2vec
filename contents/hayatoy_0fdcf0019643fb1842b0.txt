{"context": "\u3042\u307e\u308a\u6ce8\u76ee\u3092\u96c6\u3081\u306a\u3044Google Cloud Dataflow\u3067\u3059\u304c\u3001\u7c21\u5358\u306b\u5b9f\u884c\u74b0\u5883\u3092\u30ed\u30fc\u30ab\u30eb/\u30ea\u30e2\u30fc\u30c8\u5207\u308a\u66ff\u3048\u3067\u304d\u308b\u306e\u3067\u304b\u306a\u308a\u4fbf\u5229\u3067\u3059\u3002\u3057\u304b\u3082\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30e9\u30a4\u30d6\u30e9\u30ea\u3057\u304b\u4f7f\u3048\u306a\u3044\u3068\u601d\u3063\u3066\u3044\u305f\u3089pip\u306e\u30ea\u30b9\u30c8\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u3001\u72ec\u81ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u3067\u304d\u308b\u3068\u306e\u3053\u3068\u3002\n\u3058\u3083\u3042\u3069\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3001Document\u3092\u3056\u3063\u3068\u691c\u7d22\u3057\u3066\u3082\u51fa\u3066\u3053\u306a\u3044\u306e\u3067\u8abf\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u6e96\u5099\n\u307e\u305a\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3001\u3053\u306e\u8fba\u306f@orfeon\u3055\u3093\u306e\u4e38\u30d1\u30af\u30ea\u3067\u3059\u30fb\u30fb\n\nOption\u306e\u8a2d\u5b9a\nimport apache_beam as beam\nimport apache_beam.transforms.window as window\n\noptions = beam.utils.pipeline_options.PipelineOptions()\n\ngoogle_cloud_options = options.view_as(beam.utils.pipeline_options.GoogleCloudOptions)\ngoogle_cloud_options.project = '{PROJECTID}'\ngoogle_cloud_options.job_name = 'test'\ngoogle_cloud_options.staging_location = 'gs://{BUCKET_NAME}/binaries'\ngoogle_cloud_options.temp_location = 'gs://{BUCKET_NAME}/temp'\n\nworker_options = options.view_as(beam.utils.pipeline_options.WorkerOptions)\nworker_options.max_num_workers = 1\n\n# options.view_as(beam.utils.pipeline_options.StandardOptions).runner = 'DirectRunner'\noptions.view_as(beam.utils.pipeline_options.StandardOptions).runner = 'DataflowRunner'\n\np = beam.Pipeline(options=options)\n\n\npip freeze\u3092\u5b9f\u884c\u3057\u3066Python\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u3092\u30ed\u30b0\u51fa\u529b\u3057\u307e\u3059\u3002\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u51fa\u529b\u90e8\u5206\ndef inspect_df(dat):\n    import subprocess\n    import logging\n    process = subprocess.Popen('pip freeze', shell=True,\n                               stdout=subprocess.PIPE, \n                               stderr=subprocess.PIPE)\n    for line in process.stdout:\n        logging.info(line)\n\n\nDataflow\u4e0a\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002hello world\u306f\u8981\u3089\u306a\u3044\u304b\u3082\u30fb\u30fb\n\n\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5b9f\u884c\n(p | 'init' >> beam.Create(['hello', 'world'])\n   | 'inspect' >> beam.Map(inspect_df))\n\np.run()\n\n\n\u3053\u308c\u3067\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u304c\u30ed\u30b0\u306b\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001Cloud Console\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30ed\u30b0\u78ba\u8a8d\nDataflow\u306eDocument\u3060\u3068\u3001Dataflow\u306eJob\u8a73\u7d30\u753b\u9762\u304b\u3089\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u30012017\u5e743\u67084\u65e5\u73fe\u5728\u3060\u3068Stackdriver->Logging\u306e\u65b9\u306b\u79fb\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u306b\u30ed\u30b0\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u4e00\u89a7\n\u4e0a\u8a18\u30ed\u30b0\u306b\u5410\u304b\u308c\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e00\u89a7\u3067\u3059\u30022017\u5e743\u67084\u65e5\u73fe\u5728\n\n\n\nPackage\nVersion\n\n\n\n\navro\n1.8.1\n\n\nbeautifulsoup4\n4.5.1\n\n\nbs4\n0.0.1\n\n\ncrcmod\n1.7\n\n\nCython\n0.25.2\n\n\ndataflow-worker\n0.5.5\n\n\ndill\n0.2.5\n\n\nenum34\n1.1.6\n\n\nfuncsigs\n1.0.2\n\n\nfutures\n3.0.5\n\n\ngoogle-api-python-client\n1.6.2\n\n\ngoogle-apitools\n0.5.7\n\n\ngoogle-cloud-dataflow\n0.5.5\n\n\ngoogle-python-cloud-debugger\n1.9\n\n\ngoogledatastore\n6.4.1\n\n\ngrpcio\n1.1.0\n\n\nguppy\n0.1.10\n\n\nhttplib2\n0.9.2\n\n\nmock\n2.0.0\n\n\nnltk\n3.2.1\n\n\nnose\n1.3.7\n\n\nnumpy\n1.12.0\n\n\noauth2client\n2.2.0\n\n\npandas\n0.18.1\n\n\npbr\n1.10.0\n\n\nPillow\n3.4.1\n\n\nproto-google-datastore-v1\n1.3.1\n\n\nprotobuf\n3.0.0\n\n\nprotorpc\n0.11.1\n\n\npyasn1\n0.2.2\n\n\npyasn1-modules\n0.0.8\n\n\npython-dateutil\n2.6.0\n\n\npython-gflags\n3.0.6\n\n\npython-snappy\n0.5\n\n\npytz\n2016.10\n\n\nPyYAML\n3.11\n\n\nrequests\n2.10.0\n\n\nrsa\n3.4.2\n\n\nscikit-learn\n0.17.1\n\n\nscipy\n0.17.1\n\n\nsix\n1.10.0\n\n\ntensorflow\n1.0.0\n\n\ntensorflow-transform\n0.1.4\n\n\nuritemplate\n3.0.0\n\n\n\ntf.transform\u304c\u6765\u305f\u304b\u3089\u3067\u3057\u3087\u3046\u304b\uff1fCloud ML\u3067\u306fTensorFlow ver\u306f0.12\u3067\u3059\u304c\u3053\u3061\u3089\u3067\u306f1.0.0\u3067\u3059\u306d\u3002scikit-learn\u306f\u3061\u3087\u3063\u3068\u53e4\u3044\u3088\u3046\u3067\u3059\u3002\n\u3084\u3084staging\u306f\u9045\u3044\u3082\u306e\u306e\u3001Jupyter Notebook\u4e0a\u304b\u3089\u7c21\u5358\u306b\u30ed\u30fc\u30ab\u30eb/\u30ea\u30e2\u30fc\u30c8\u5207\u308a\u66ff\u3048\u3066\u3001\u52dd\u624b\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u7acb\u3061\u4e0a\u3052\u304b\u3089\u7acb\u3061\u4e0b\u3052\u307e\u3067\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u3067\u884c\u3063\u3066\u304f\u308c\u308bDataflow\u306f\u30c7\u30fc\u30bf\u89e3\u6790\u3084\u6a5f\u68b0\u5b66\u7fd2\u306a\u3069\u306e\u7528\u9014\u3067\u3082\u5f37\u529b\u306a\u30c4\u30fc\u30eb\u3068\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\u3042\u307e\u308a\u6ce8\u76ee\u3092\u96c6\u3081\u306a\u3044Google Cloud Dataflow\u3067\u3059\u304c\u3001\u7c21\u5358\u306b\u5b9f\u884c\u74b0\u5883\u3092\u30ed\u30fc\u30ab\u30eb/\u30ea\u30e2\u30fc\u30c8\u5207\u308a\u66ff\u3048\u3067\u304d\u308b\u306e\u3067\u304b\u306a\u308a\u4fbf\u5229\u3067\u3059\u3002\u3057\u304b\u3082\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30e9\u30a4\u30d6\u30e9\u30ea\u3057\u304b\u4f7f\u3048\u306a\u3044\u3068\u601d\u3063\u3066\u3044\u305f\u3089[pip\u306e\u30ea\u30b9\u30c8](https://cloud.google.com/dataflow/pipelines/dependencies-python)\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u308a\u3001[\u72ec\u81ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://qiita.com/orfeon/items/78ff952052c4bde4bcd3)\u3082\u3067\u304d\u308b\u3068\u306e\u3053\u3068\u3002\n\u3058\u3083\u3042\u3069\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u30d7\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3001Document\u3092\u3056\u3063\u3068\u691c\u7d22\u3057\u3066\u3082\u51fa\u3066\u3053\u306a\u3044\u306e\u3067\u8abf\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u6e96\u5099\n\n\u307e\u305a\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3001\u3053\u306e\u8fba\u306f@orfeon\u3055\u3093\u306e\u4e38\u30d1\u30af\u30ea\u3067\u3059\u30fb\u30fb\n\n```py:Option\u306e\u8a2d\u5b9a\nimport apache_beam as beam\nimport apache_beam.transforms.window as window\n\noptions = beam.utils.pipeline_options.PipelineOptions()\n\ngoogle_cloud_options = options.view_as(beam.utils.pipeline_options.GoogleCloudOptions)\ngoogle_cloud_options.project = '{PROJECTID}'\ngoogle_cloud_options.job_name = 'test'\ngoogle_cloud_options.staging_location = 'gs://{BUCKET_NAME}/binaries'\ngoogle_cloud_options.temp_location = 'gs://{BUCKET_NAME}/temp'\n\nworker_options = options.view_as(beam.utils.pipeline_options.WorkerOptions)\nworker_options.max_num_workers = 1\n\n# options.view_as(beam.utils.pipeline_options.StandardOptions).runner = 'DirectRunner'\noptions.view_as(beam.utils.pipeline_options.StandardOptions).runner = 'DataflowRunner'\n\np = beam.Pipeline(options=options)\n```\n\n`pip freeze`\u3092\u5b9f\u884c\u3057\u3066Python\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u3092\u30ed\u30b0\u51fa\u529b\u3057\u307e\u3059\u3002\n\n```py:\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u51fa\u529b\u90e8\u5206\ndef inspect_df(dat):\n    import subprocess\n    import logging\n    process = subprocess.Popen('pip freeze', shell=True,\n                               stdout=subprocess.PIPE, \n                               stderr=subprocess.PIPE)\n    for line in process.stdout:\n        logging.info(line)\n```\n\nDataflow\u4e0a\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002hello world\u306f\u8981\u3089\u306a\u3044\u304b\u3082\u30fb\u30fb\n\n```py:\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5b9f\u884c\n(p | 'init' >> beam.Create(['hello', 'world'])\n   | 'inspect' >> beam.Map(inspect_df))\n\np.run()\n```\n\n\u3053\u308c\u3067\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u884c\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u304c\u30ed\u30b0\u306b\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001Cloud Console\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u30ed\u30b0\u78ba\u8a8d\n[Dataflow\u306eDocument](https://cloud.google.com/dataflow/pipelines/logging)\u3060\u3068\u3001Dataflow\u306eJob\u8a73\u7d30\u753b\u9762\u304b\u3089\u30ed\u30b0\u3092\u78ba\u8a8d\u3059\u308b\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u30012017\u5e743\u67084\u65e5\u73fe\u5728\u3060\u3068Stackdriver->Logging\u306e\u65b9\u306b\u79fb\u3063\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"1038\" alt=\"Logs_Viewer_-_Test_fx_lab.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/162369/a947ee6c-d328-1fde-00ca-174225d4277b.png\">\n\u3053\u3093\u306a\u611f\u3058\u306b\u30ed\u30b0\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n# \u30d1\u30c3\u30b1\u30fc\u30b8\u4e00\u89a7\n\u4e0a\u8a18\u30ed\u30b0\u306b\u5410\u304b\u308c\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4e00\u89a7\u3067\u3059\u3002**2017\u5e743\u67084\u65e5\u73fe\u5728**\n\n| Package | Version |\n|---|---|\n| avro | 1.8.1 |\n| beautifulsoup4 | 4.5.1 |\n| bs4 | 0.0.1 |\n| crcmod | 1.7 |\n| Cython | 0.25.2 |\n| dataflow-worker | 0.5.5 |\n| dill | 0.2.5 |\n| enum34 | 1.1.6 |\n| funcsigs | 1.0.2 |\n| futures | 3.0.5 |\n| google-api-python-client | 1.6.2 |\n| google-apitools | 0.5.7 |\n| google-cloud-dataflow | 0.5.5 |\n| google-python-cloud-debugger | 1.9 |\n| googledatastore | 6.4.1 |\n| grpcio | 1.1.0 |\n| guppy | 0.1.10 |\n| httplib2 | 0.9.2 |\n| mock | 2.0.0 |\n| nltk | 3.2.1 |\n| nose | 1.3.7 |\n| numpy | 1.12.0 |\n| oauth2client | 2.2.0 |\n| pandas | 0.18.1 |\n| pbr | 1.10.0 |\n| Pillow | 3.4.1 |\n| proto-google-datastore-v1 | 1.3.1 |\n| protobuf | 3.0.0 |\n| protorpc | 0.11.1 |\n| pyasn1 | 0.2.2 |\n| pyasn1-modules | 0.0.8 |\n| python-dateutil | 2.6.0 |\n| python-gflags | 3.0.6 |\n| python-snappy | 0.5 |\n| pytz | 2016.10 |\n| PyYAML | 3.11 |\n| requests | 2.10.0 |\n| rsa | 3.4.2 |\n| scikit-learn | 0.17.1 |\n| scipy | 0.17.1 |\n| six | 1.10.0 |\n| tensorflow | 1.0.0 |\n| tensorflow-transform | 0.1.4 |\n| uritemplate | 3.0.0 |\n\n`tf.transform`\u304c\u6765\u305f\u304b\u3089\u3067\u3057\u3087\u3046\u304b\uff1f`Cloud ML`\u3067\u306fTensorFlow ver\u306f0.12\u3067\u3059\u304c\u3053\u3061\u3089\u3067\u306f1.0.0\u3067\u3059\u306d\u3002scikit-learn\u306f\u3061\u3087\u3063\u3068\u53e4\u3044\u3088\u3046\u3067\u3059\u3002\n\n\u3084\u3084staging\u306f\u9045\u3044\u3082\u306e\u306e\u3001Jupyter Notebook\u4e0a\u304b\u3089\u7c21\u5358\u306b\u30ed\u30fc\u30ab\u30eb/\u30ea\u30e2\u30fc\u30c8\u5207\u308a\u66ff\u3048\u3066\u3001\u52dd\u624b\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u7acb\u3061\u4e0a\u3052\u304b\u3089\u7acb\u3061\u4e0b\u3052\u307e\u3067\u30d5\u30eb\u30de\u30cd\u30fc\u30b8\u30c9\u3067\u884c\u3063\u3066\u304f\u308c\u308bDataflow\u306f\u30c7\u30fc\u30bf\u89e3\u6790\u3084\u6a5f\u68b0\u5b66\u7fd2\u306a\u3069\u306e\u7528\u9014\u3067\u3082\u5f37\u529b\u306a\u30c4\u30fc\u30eb\u3068\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n", "tags": ["GoogleCloudPlatform", "GoogleCloudDataflow", "ApacheBeam", "Python"]}