{"tags": ["Ruby", "Sinatra", "api", "JSON"], "context": "\u524d\u306e\u8a18\u4e8b\u3068\u304b\u3067Mysql\u306b\u8caf\u3081\u305f\u30c7\u30fc\u30bf\u3092\u5916\u304b\u3089\u4f7f\u3044\u305f\u3044\u3068\u601d\u3063\u3066Sinatra\u3067jsonAPI\u5316\u3057\u305f\u306e\u3067\u624b\u9806\u3092\u30e1\u30e2\u3002\nmysql2\u3067\u3084\u3063\u305f\u3051\u3069\u3001\u672c\u6765\u306fActiveRecord\u3068\u304b\u3092\u4f7f\u3046\u3079\u304d\u306a\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u4e0b\u6e96\u5099\n\n\u5fc5\u8981\u306aGem\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngem install mysql2\ngem install sinatra\ngem install json\n\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n\u30b5\u30f3\u30d7\u30eb\u7528\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3002\u4f5c\u6210\u5f8c\u9069\u5f53\u306a\u30c7\u30fc\u30bf\u3092insert\u3057\u3066\u304a\u304f\u3002\n\u65e2\u306b\u306a\u306b\u304b\u3057\u3089\u30c7\u30fc\u30bf\u306e\u6e9c\u307e\u3063\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u3042\u308b\u306a\u3089\u305d\u308c\u3092\u4f7f\u3048\u3070\u3044\u3044\u3067\u3059\u3002\nmysql> CREATE TABLE `data` (\n  `Id` int(11) NOT NULL AUTO_INCREMENT,\n  `Title` varchar(256) DEFAULT NULL,\n  `URL` varchar(512) DEFAULT NULL,\n  `Created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`Id`)\n) ENGINE=MyISAM DEFAULT CHARSET=utf8;\n\nmysql> desc data;\n+--------------+--------------+------+-----+-------------------+----------------+\n| Field        | Type         | Null | Key | Default           | Extra          |\n+--------------+--------------+------+-----+-------------------+----------------+\n| Id           | int(11)      | NO   | PRI | NULL              | auto_increment |\n| Title        | varchar(256) | YES  |     | NULL              |                |\n| URL          | varchar(512) | YES  |     | NULL              |                |\n| Created_at   | timestamp    | NO   |     | CURRENT_TIMESTAMP |                |\n+--------------+--------------+------+-----+-------------------+----------------+\n\n\nAPI\u90e8\u5206\u306e\u30b3\u30fc\u30c9\nmysql2\u3067\u53d6\u5f97\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u30921\u884c\u3065\u3064\u914d\u5217\u306b\u683c\u7d0d\u3057\u305f\u5f8cto_json\u3067json\u5316\u3001API\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3059\u308b\u3002\n\u4e0d\u8981\u306a\u30ab\u30e9\u30e0\u304c\u3042\u308b\u5834\u5408\u306f\u3001sql\u3067\u843d\u3068\u3059\u4ed6\u306bto_json\u306e\u5f15\u6570\u3067\u53d6\u6368\u9078\u629e\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u308b\u6a21\u69d8\u3002\n\napi.rb\nrequire 'sinatra'\nrequire 'mysql2'\nrequire 'json'\nrequire 'yaml'\n\nget '/api' do\n  content_type 'application/json'\n  db_to_json\nend\n\ndef db_to_json\n    client = Mysql2::Client.new(YAML.load_file('database.yml'))\n    sql = \"select * from data limit 10\" #10\u4ef6\u5206\u53d6\u5f97\n\n    ary = Array.new\n    client.query(sql).each {|row| ary << row}\n    return ary.to_json\nend\n\n\nDB\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\ndatabase.yml\ndatabase: \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\nhost: localhost\nusername: \u30e6\u30fc\u30b6\u540d\npassword: \u30d1\u30b9\u30ef\u30fc\u30c9\n\n\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u307f\u308b\n\nsinatra\u3092\u8d77\u52d5\n$ ruby api.rb\n\nwget\u3067\u30a2\u30af\u30bb\u30b9\uff08jq\u3067\u6574\u5f62\uff09\n$ wget -O - \"http://localhost:4567/api\" | jq .\n[\n  {\n    \"Id\": 1,\n    \"Title\": \"Mechanize\u3067Twitter\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u306e\u30c7\u30fc\u30bf\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3092\u81ea\u52d5\u5316\u3059\u308b\",\n    \"URL\": \"http://qiita.com/Feburic/items/20590d02152e06faf502\",\n    \"Created_at\": \"2016-10-10 02:16:00 +0900\"\n  },\n  {\n    \"Id\": 2,\n    \"Title\": \"Amazon\u306e\u5546\u54c1\u30da\u30fc\u30b8URL\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u95a2\u3059\u308b\u30e1\u30e2\",\n    \"URL\": \"http://qiita.com/Feburic/items/6e918b1a9345367622c9\",\n    \"Created_at\": \"2016-10-10 02:16:00 +0900\"\n  }\n]\n\n\u3046\u307e\u3044\u3053\u3068\u52d5\u3044\u3066\u308b\u3063\u307d\u3044\u3002\n\n[\u524d\u306e\u8a18\u4e8b](http://qiita.com/Feburic/items/20590d02152e06faf502)\u3068\u304b\u3067Mysql\u306b\u8caf\u3081\u305f\u30c7\u30fc\u30bf\u3092\u5916\u304b\u3089\u4f7f\u3044\u305f\u3044\u3068\u601d\u3063\u3066Sinatra\u3067jsonAPI\u5316\u3057\u305f\u306e\u3067\u624b\u9806\u3092\u30e1\u30e2\u3002\nmysql2\u3067\u3084\u3063\u305f\u3051\u3069\u3001\u672c\u6765\u306fActiveRecord\u3068\u304b\u3092\u4f7f\u3046\u3079\u304d\u306a\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n## \u4e0b\u6e96\u5099\n### \u5fc5\u8981\u306aGem\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\ngem install mysql2\ngem install sinatra\ngem install json\n```\n### \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n\u30b5\u30f3\u30d7\u30eb\u7528\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3002\u4f5c\u6210\u5f8c\u9069\u5f53\u306a\u30c7\u30fc\u30bf\u3092insert\u3057\u3066\u304a\u304f\u3002\n\u65e2\u306b\u306a\u306b\u304b\u3057\u3089\u30c7\u30fc\u30bf\u306e\u6e9c\u307e\u3063\u305f\u30c6\u30fc\u30d6\u30eb\u304c\u3042\u308b\u306a\u3089\u305d\u308c\u3092\u4f7f\u3048\u3070\u3044\u3044\u3067\u3059\u3002\n\n```\nmysql> CREATE TABLE `data` (\n  `Id` int(11) NOT NULL AUTO_INCREMENT,\n  `Title` varchar(256) DEFAULT NULL,\n  `URL` varchar(512) DEFAULT NULL,\n  `Created_at` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  PRIMARY KEY (`Id`)\n) ENGINE=MyISAM DEFAULT CHARSET=utf8;\n\nmysql> desc data;\n+--------------+--------------+------+-----+-------------------+----------------+\n| Field        | Type         | Null | Key | Default           | Extra          |\n+--------------+--------------+------+-----+-------------------+----------------+\n| Id           | int(11)      | NO   | PRI | NULL              | auto_increment |\n| Title        | varchar(256) | YES  |     | NULL              |                |\n| URL          | varchar(512) | YES  |     | NULL              |                |\n| Created_at   | timestamp    | NO   |     | CURRENT_TIMESTAMP |                |\n+--------------+--------------+------+-----+-------------------+----------------+\n```\n\n## API\u90e8\u5206\u306e\u30b3\u30fc\u30c9\nmysql2\u3067\u53d6\u5f97\u3057\u305f\u30ec\u30b3\u30fc\u30c9\u30921\u884c\u3065\u3064\u914d\u5217\u306b\u683c\u7d0d\u3057\u305f\u5f8cto_json\u3067json\u5316\u3001API\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3059\u308b\u3002\n\u4e0d\u8981\u306a\u30ab\u30e9\u30e0\u304c\u3042\u308b\u5834\u5408\u306f\u3001sql\u3067\u843d\u3068\u3059\u4ed6\u306bto_json\u306e\u5f15\u6570\u3067\u53d6\u6368\u9078\u629e\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u308b\u6a21\u69d8\u3002\n\n```ruby:api.rb\nrequire 'sinatra'\nrequire 'mysql2'\nrequire 'json'\nrequire 'yaml'\n\nget '/api' do\n  content_type 'application/json'\n  db_to_json\nend\n\ndef db_to_json\n    client = Mysql2::Client.new(YAML.load_file('database.yml'))\n    sql = \"select * from data limit 10\" #10\u4ef6\u5206\u53d6\u5f97\n\n    ary = Array.new\n    client.query(sql).each {|row| ary << row}\n    return ary.to_json\nend\n```\nDB\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n```ruby:database.yml\ndatabase: \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\nhost: localhost\nusername: \u30e6\u30fc\u30b6\u540d\npassword: \u30d1\u30b9\u30ef\u30fc\u30c9\n```\n\n## \u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u307f\u308b\n### sinatra\u3092\u8d77\u52d5\n`$ ruby api.rb`\n### wget\u3067\u30a2\u30af\u30bb\u30b9\uff08jq\u3067\u6574\u5f62\uff09\n```bash\n$ wget -O - \"http://localhost:4567/api\" | jq .\n[\n  {\n    \"Id\": 1,\n    \"Title\": \"Mechanize\u3067Twitter\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u306e\u30c7\u30fc\u30bf\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3092\u81ea\u52d5\u5316\u3059\u308b\",\n    \"URL\": \"http://qiita.com/Feburic/items/20590d02152e06faf502\",\n    \"Created_at\": \"2016-10-10 02:16:00 +0900\"\n  },\n  {\n    \"Id\": 2,\n    \"Title\": \"Amazon\u306e\u5546\u54c1\u30da\u30fc\u30b8URL\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u95a2\u3059\u308b\u30e1\u30e2\",\n    \"URL\": \"http://qiita.com/Feburic/items/6e918b1a9345367622c9\",\n    \"Created_at\": \"2016-10-10 02:16:00 +0900\"\n  }\n]\n```\n\n\u3046\u307e\u3044\u3053\u3068\u52d5\u3044\u3066\u308b\u3063\u307d\u3044\u3002\n"}