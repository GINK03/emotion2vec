{"context": "AutoScaling\u3092\u4f7f\u3063\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3092\u3059\u308b\u3068\u3001\u52d5\u7684\u306b\u5909\u308f\u308bPublic IP\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3055\u308c\u308b\u3002AutoScaling\u304c\u767a\u52d5\u3059\u308b\u3068\u304b\u3059\u308b\u3068\u3001\u767a\u52d5\u3059\u308b\u5ea6\u306bIP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3046\u3002\n\u9001\u4fe1\u5143\u3092\u56fa\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3001IP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u758e\u901a\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u3002\n\u305d\u3053\u3067\u3001EIP\u306e\u7d10\u4ed8\u3051\u304ccloud-init\u8d77\u52d5\u6642\u306b\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\u524d\u63d0\u3068\u3057\u3066\u306f\u3001AutoScaling\u3067\u8d77\u52d5\u3067\u304d\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5206\u306eEIP\u306e\u30b9\u30c8\u30c3\u30af\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u8d77\u52d5\u6642\u306bEIP\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3060\u304c\u3001\u3053\u308c\u3067\u306f\u3001\u5272\u308a\u5f53\u3066\u3067\u304d\u308bEIP\u3092\u6307\u5b9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u9001\u4fe1\u5148\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u5236\u9650\u8a2d\u5b9a\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002AutoScaling\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u306b\u4e00\u90e8\u5236\u9650\u3092\u4ed8\u3044\u3066\u3057\u307e\u3046\u3002\n\u5b9f\u969b\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a\u306fIAM Role\u306e\u8a2d\u5b9a\u304b\u3089\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeAddresses\",\n        \"ec2:AssociateAddress\"\n        ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n   ]\n}\n\n\u6b21\u306b\u3001AutoScaling LaunchConfigration \u3092\u4f5c\u6210\n#!/bin/bash -ex\n\nexec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1\n\necho BEGIN\n\nREGION=`curl -s http://169.254.169.254/latest/meta-data/local-hostname | cut -d '.' -f2`\n\n\nexport AWS_DEFAULT_REGION=${REGION}\n\nINSTANCE_ID=`curl http://169.254.169.254/latest/meta-data/instance-id`\n\nfor ALLOC_ID in `aws ec2 describe-addresses --filter \"Name=domain,Values=vpc\" | jq '.Addresses[].AllocationId' | cut -d '\"' -f 2`\ndo\n  CMD=\"aws ec2 associate-address --instance-id $INSTANCE_ID --allocation-id $ALLOC_ID --no-allow-reassociation \"\n  $CMD\n  STATUS=$?\n  if [ 0 = $STATUS ] ; then\n    exit 0\n  fi\ndone\n\n\u4e88\u3081\u3001AutoScaling\u3067\u8d77\u52d5\u60f3\u5b9a\u3059\u308b\u6570(MAX)\u306eEIP\u3092\u78ba\u4fdd(Allocate)\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u7d10\u4ed8\u3051\u306a\u3044EIP\u304c\u3042\u308b\u5834\u5408\u3001$0.005/\u6642\u9593\u306e\u8ab2\u91d1\u304c\u767a\u751f\u3057\u307e\u3059\u3002\uff08\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\nAutoScaling\u3092\u4f7f\u3063\u3066\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3092\u3059\u308b\u3068\u3001\u52d5\u7684\u306b\u5909\u308f\u308bPublic IP\u304c\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3055\u308c\u308b\u3002AutoScaling\u304c\u767a\u52d5\u3059\u308b\u3068\u304b\u3059\u308b\u3068\u3001\u767a\u52d5\u3059\u308b\u5ea6\u306bIP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u3057\u307e\u3046\u3002\n\n\u9001\u4fe1\u5143\u3092\u56fa\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3001IP\u30a2\u30c9\u30ec\u30b9\u304c\u5909\u308f\u3063\u3066\u758e\u901a\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u3002\n\u305d\u3053\u3067\u3001EIP\u306e\u7d10\u4ed8\u3051\u304ccloud-init\u8d77\u52d5\u6642\u306b\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u524d\u63d0\u3068\u3057\u3066\u306f\u3001AutoScaling\u3067\u8d77\u52d5\u3067\u304d\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5206\u306eEIP\u306e\u30b9\u30c8\u30c3\u30af\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u8d77\u52d5\u6642\u306bEIP\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3060\u304c\u3001\u3053\u308c\u3067\u306f\u3001\u5272\u308a\u5f53\u3066\u3067\u304d\u308bEIP\u3092\u6307\u5b9a\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u9001\u4fe1\u5148\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u5236\u9650\u8a2d\u5b9a\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002AutoScaling\u306e\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u306b\u4e00\u90e8\u5236\u9650\u3092\u4ed8\u3044\u3066\u3057\u307e\u3046\u3002\n\n\u5b9f\u969b\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u305a\u306fIAM Role\u306e\u8a2d\u5b9a\u304b\u3089\n\n```\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"ec2:DescribeInstances\",\n        \"ec2:DescribeAddresses\",\n        \"ec2:AssociateAddress\"\n        ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n   ]\n}\n```\n\n\u6b21\u306b\u3001AutoScaling LaunchConfigration \u3092\u4f5c\u6210\n\n\n```\n#!/bin/bash -ex\n\nexec > >(tee /var/log/user-data.log|logger -t user-data -s 2>/dev/console) 2>&1\n\necho BEGIN\n\nREGION=`curl -s http://169.254.169.254/latest/meta-data/local-hostname | cut -d '.' -f2`\n\n\nexport AWS_DEFAULT_REGION=${REGION}\n\nINSTANCE_ID=`curl http://169.254.169.254/latest/meta-data/instance-id`\n\nfor ALLOC_ID in `aws ec2 describe-addresses --filter \"Name=domain,Values=vpc\" | jq '.Addresses[].AllocationId' | cut -d '\"' -f 2`\ndo\n  CMD=\"aws ec2 associate-address --instance-id $INSTANCE_ID --allocation-id $ALLOC_ID --no-allow-reassociation \"\n  $CMD\n  STATUS=$?\n  if [ 0 = $STATUS ] ; then\n    exit 0\n  fi\ndone\n```\n\n\u4e88\u3081\u3001AutoScaling\u3067\u8d77\u52d5\u60f3\u5b9a\u3059\u308b\u6570(MAX)\u306eEIP\u3092\u78ba\u4fdd(Allocate)\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u7d10\u4ed8\u3051\u306a\u3044EIP\u304c\u3042\u308b\u5834\u5408\u3001$0.005/\u6642\u9593\u306e\u8ab2\u91d1\u304c\u767a\u751f\u3057\u307e\u3059\u3002\uff08\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\uff09\n", "tags": ["AutoScaling", "AWS"]}