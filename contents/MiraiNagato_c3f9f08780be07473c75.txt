{"context": "\u3000Delphi Advent Calender \u306b\u306f\u4eca\u5e74\u521d\u53c2\u52a0\u30012016\u5e74\u306e22\u65e5\u76ee(12\u670822\u65e5\u5206)\u3092\u62c5\u5f53\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u9577\u9580\u307f\u3089\u3044\u3068\u7533\u3057\u307e\u3059\u3002Delphi\u3068\u306f13\u5e74\u3001\u4e2d\u5b662\u5e74\u304b\u3089\u306e\u304a\u4ed8\u304d\u5408\u3044\u3067\u3059\u3002\u6b73\u3082\u53d6\u308a\u307e\u3057\u305f\u3002\u672c\u65e5\u306f\u30ab\u30ec\u30f3\u30c0\u30fc\u3068\u3044\u3046\u3088\u308a\u3001\u3082\u306f\u3084\u8aad\u307f\u7269\u3060\u3068\u304b\u30ea\u30bd\u30fc\u30b9\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u611f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3054\u7b11\u89a7\u3044\u305f\u3060\u3051\u307e\u3059\u3068\u5e78\u3044\u3067\u3059\u3002\n\nIntroduction: FMX\u3067\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u4f7f\u3044\u305f\u3044\uff01\n\u3000\u304b\u306a\u308a\u7a81\u7136\u3067\u3059\u304c\u3001\u4e0b\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nCopyright \u24b8 2015- MiraiTunes, Kokonotori and Minori Fuyuzora\n\u3000\u3069\u3053\u304b\u3089\u3069\u3046\u898b\u3066\u3082\u3001\u6700\u8fd1\u6d41\u884c\u308a\u306e\u840c\u3048\u7cfb\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306b\u5909\u308f\u308a\u306a\u304f\u3001\u3057\u304b\u3082\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u672c\u4eba\u304c\u5236\u4f5c\u3057\u305f\u3082\u306e\u3067\u3042\u308b\u3068\u3044\u3046\u306e\u3067\u3059\u304b\u3089\u3001\u3053\u308a\u3083\u4e00\u4f53\u4f55\u304c\u8d77\u3053\u308d\u3046\u3068\u3057\u3066\u3044\u308b\u3093\u3060\u3044\uff1f\u3000\u3068\u3044\u3046\u6c17\u6301\u3061\u306b\u306f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\u305d\u3046\u3067\u3059\u3002\u5ba3\u4f1d\u3067\u3059\u3002\n\u2026\u2026\u3044\u3084\u3001\u3082\u3061\u308d\u3093\u5618\u3067\u3059\u3051\u3069\u3002\n\u3000\u6ce8\u76ee\u3057\u3066\u3044\u305f\u3060\u304d\u305f\u3044\u306e\u306f\u3001\u7dd1\u5730\u306e\u90e8\u5206\u3001\u30c6\u30ad\u30b9\u30c8\u30a6\u30a4\u30f3\u30c9\u30a6\u3067\u3059\u3002\u3053\u3053\u306e\u30d5\u30a9\u30f3\u30c8\uff01\u3000\u6c17\u4ed8\u304d\u307e\u3057\u305f\u304b\uff1f\u3000Windows\u3067\u306f\u6a19\u6e96\u3067\u5165\u3063\u3066\u3044\u306a\u3044\u3001\u3080\u3057\u308d\u5165\u3063\u3066\u3044\u305f\u3089\u3073\u3063\u304f\u308a\u3068\u3082\u8a00\u3048\u308b\u3001\u6709\u5fd7(fontopo\u69d8)\u306b\u3088\u3063\u3066\u4f5c\u3089\u308c\u305f\u30d5\u30a9\u30f3\u30c8\u300c\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u300d\u3067\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\u3000\u3053\u306e\u30d5\u30a9\u30f3\u30c8\u306f\u67d4\u3089\u304b\u3044\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u304c\u8aad\u307f\u3084\u3059\u304f\u3001\u30d3\u30eb\u30c8\u30a4\u30f3\u306e\u30d5\u30a9\u30f3\u30c8(MS\u30b4\u30b7\u30c3\u30af\u306a\u3069)\u3067\u8868\u793a\u3059\u308b\u306e\u3068\u3001\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u8868\u793a\u3059\u308b\u306e\u3068\u3067\u306f\u5fc3\u7406\u7684\u306b\u3082\u5927\u304d\u306a\u5dee\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u3044\u3053\u3046\u3001\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u3044\u3053\u3046\u3001\u3068\u8efd\u304f\u601d\u3063\u3066\u3044\u305f\u77e2\u5148\u3001\u3059\u3050\u3055\u307e\u6280\u8853\u7684\u306a\u5927\u554f\u984c\u306b\u3076\u3061\u5f53\u305f\u308b\u2026\u2026\u3068\u3044\u3046\u304b\u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u3002\n\n\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3063\u3066\u2026\u2026\u3044\u3044\u3088\u306d\n\n\u898b\u77e5\u3089\u306c\u3001API\n\u3000AddFontResource\u3092\u4f7f\u3046\u3088\u3046\u306a\u3001\u5f93\u6765\u306e\u65b9\u6cd5\u3067\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u4f7f\u3048\u307e\u305b\u3093\uff01\uff01\n\u3000\u5f93\u6765\u306eVCL\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3057\u305f\u3089\u3001GDI\u30ad\u30e3\u30f3\u30d0\u30b9\u3067\u306e\u6587\u5b57\u63cf\u753b\u3067\u3042\u308b\u305f\u3081\u306b\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30b3\u30fc\u30c9\u306fAddFontResource/RemoveFontResource\u3092\u8a18\u8ff0\u3057\u3001WM_FONTCHANGE\u3092\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\u3072\u3058\u3087\u3046\u306b\u304a\u624b\u8efd\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u3088\u304f\u8003\u3048\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002FMX\u306fDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u3002VCL\u306eGDI\u30ad\u30e3\u30f3\u30d0\u30b9\u3068\u306f\u8a33\u304c\u9055\u3044\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u4f55\u304c\u9055\u3046\u306e\u304b\u3068\u3044\u3048\u3070\u3001DirectWrite\u3067\u6587\u5b57\u3092\u63cf\u753b\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3068\u3044\u3046\u70b9\u3002\u3046\u308f\u3042\u3042\u8b0e\u6280\u8853\u304d\u305f\u3042\u3042\u3042\uff01\n\u3000\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304b\u3089\u3057\u3066\u65e2\u306b\u9055\u3063\u3066\u3044\u308bGDI\u3068Direct2D\u3002Direct2D\u30ad\u30e3\u30f3\u30d0\u30b9\u4e0a\u3067\u306f\u3001GDI\u3067\u6d3b\u7528\u3057\u3066\u3044\u305f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u306e\u30b3\u30fc\u30c9\u3001\u5373\u3061AddFontResource/RemoveFontResource\u306f\u4e00\u5207\u610f\u5473\u3092\u70ba\u3057\u307e\u305b\u3093\u3002\u3044\u3084\u3001\u6b63\u78ba\u306b\u306f\u300c\u30d5\u30a9\u30f3\u30c8\u306e\u4e00\u89a7\u300d\u306b\u306f\u53cd\u6620\u3055\u308c\u308b\u306e\u306b\u5b9f\u969b\u306b\u306f\u63cf\u753b\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u6700\u5f37\u306b\u30cd\u30ac\u30c6\u30a3\u30f4\u3067\u8a33\u306e\u5206\u304b\u3089\u306a\u3044\u610f\u5473\u3092\u6b8b\u3057\u3066\u3044\u304f\u7d50\u679c\u304c\u5f85\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3055\u3089\u306b\u5384\u4ecb\u306a\u306e\u306f\u3001FMX\u306eDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306a\u8a2d\u8a08\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u30591\u3002\u4e07\u4e8b\u4f11\u3059\u304b\u2026\u2026\uff01\uff1f\u3000\u52a9\u3051\u3066\u30de\u30a4\u30af\u30ed\u30bd\u30d5\u30c8\uff01\u3000\u4f53\u9a13\u7248\u30ea\u30ea\u30fc\u30b9\u306b\u9593\u306b\u5408\u308f\u306a\u3044\u3088\uff012\n\n\u3068\u3044\u3046\u3053\u3068\u3067\n\u3000\u624b\u6bb5\u306f\u9078\u3070\u306a\u3044\u3002FMX\u30bd\u30fc\u30b9\u6539\u9020\u3082\u8f9e\u3055\u306a\u3044\u3002\u4f5c\u54c1\u306e\u305f\u3081\u306b\uff01\u3000\u30d5\u30a9\u30f3\u30c8\u306e\u305f\u3081\u306b\uff01\n\n\u3053\u3053\u307e\u3067\u306e\u307e\u3068\u3081\u3068\u88dc\u8db3\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u7d44\u307f\u8fbc\u3080\u306e\u304c\u76ee\u7684\u3002\n\u4e0a\u8a18\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u3082\u5f53\u7136Delphi(Firemonkey, FMX)\u88fd\u3002\u672c\u4f53\u306b\u3064\u3044\u3066\u306f\u307e\u305f\u306e\u6a5f\u4f1a\u306b\u3002\n\u3068\u3053\u308d\u304cFMX\u3067\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u5229\u7528\u3067\u304d\u306a\u3044\uff1f\u3000\u3067\u304d\u308b\u3068\u3044\u3046\u5642\u3082\uff1f\n\u958b\u767a\u74b0\u5883\u306f Windows7/10 Pro 64bit, AMD Radeon R7 240, \u8a33\u3042\u3063\u3066 Delphi XE6\n\n\n\n\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u5b9f\u88c5\u306b\u95a2\u3059\u308b\u6982\u8981\n\nFMX\u306eDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306b\u304a\u3044\u3066\u3001FontCollection\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3067\u5f15\u304d\u51fa\u3059\n\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30ed\u30fc\u30c0\u30fc\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u6642\u306b\u65b0\u898f\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u751f\u6210\u3002\n\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3068\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304b\u3089\u30d5\u30a9\u30f3\u30c8\u3092\u53d6\u308a\u51fa\u3057\u3066\u65b0\u305f\u306b\u767b\u9332\u3057\u3066\u3044\u304f\n\u5f15\u304d\u51fa\u3057\u3066\u304a\u3044\u305fFontCollection\u306b\u3001\u65b0\u3057\u304f\u4f5c\u3063\u305f\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5dee\u3057\u8fbc\u307f\u3002\n\u30d5\u30a9\u30f3\u30c8\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\uff01\n\n\u3000\u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u5b9a\u7fa9\u3059\u308bFMX.Canvas.D2D.pas\u3001\u305d\u306e\u4e2d\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\u6587\u5b57\u63cf\u753b\u95a2\u9023\u306eDirectWrite API\u306b\u306f\u3001\u5b9f\u306f\u63cf\u753b\u306b\u4f7f\u7528\u3059\u308b\u30d5\u30a9\u30f3\u30c8\u3092\u6e21\u3059\u305f\u3081\u306eIDWriteFontCollection\u578b\u306e\u5f15\u6570\u304c\u3042\u308a\u307e\u3059\u3002nil\u3092\u6307\u5b9a\u3059\u308b\u3068\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u5168\u3066\u304c\u5bfe\u8c61\u306b\u306a\u308a\u307e\u3059\u3002\u3068\u306b\u3082\u304b\u304f\u306b\u3082\u3001\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308bnil\u3092\u53d6\u3063\u6255\u3063\u3066\u3001\u4efb\u610f\u306e\u30d5\u30a9\u30f3\u30c8\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\u30ad\u30e3\u30f3\u30d0\u30b9\u81ea\u4f53\u306f implementation \u4ee5\u4e0b\u3067\u96a0\u3055\u308c\u3066\u3057\u307e\u3063\u3066\u304a\u308a\u3001\u8272\u3005\u9762\u5012\u306a\u72b6\u6cc1\u3067\u3059\u3002\n\n\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u57fa\u790e\u77e5\u8b58\n\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001Direct2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306b\u304a\u3044\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u6271\u3044\u305f\u3044\u3068\u304d\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306a\u3069\u3092\u7d39\u4ecb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nIDWriteFactory\nFactory\u3068\u540d\u306e\u4ed8\u304f\u901a\u308a\u3001DirectWrite\u95a2\u4fc2\u306e\u5143\u7de0\u3081\u3002\u8272\u3005\u53d6\u308c\u308b\u3002\n\u5143\u7de0\u3081\u306a\u306e\u3067\u5927\u91cf\u306b\u4f5c\u308b\u30bf\u30a4\u30d7\u306e\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4f7f\u3044\u7d42\u308f\u3063\u305f\u3089nil\u3067\u3055\u3088\u306a\u3089\u3092\u3057\u307e\u3057\u3087\u3046\u3002\n\nIDWriteFontFile\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5b9f\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\nIDWriteFontFileEnumerator\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5217\u6319\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002\u4e3b\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u3067\u3001\u5b9f\u969b\u306b\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u3001\u4f7f\u3048\u308b\u30d5\u30a9\u30f3\u30c8\u306e\u4e00\u89a7\u3092\u6559\u3048\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\nIDWriteFont\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306e\u5b9f\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\nIDWriteFontFamily\n\u30d5\u30a9\u30f3\u30c8\u306b\u542b\u307e\u308c\u308b\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3002Regular\u3068\u304bBold\u3068\u304b\u3002\n\nIDWriteFontFace\n\u30d5\u30a9\u30f3\u30c8\u306b\u542b\u307e\u308c\u308b\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u306e\u7dcf\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\nIDWriteFontCollection\n\u30d5\u30a9\u30f3\u30c8\u306e\u5bc4\u305b\u96c6\u3081\u3002\u30b7\u30b9\u30c6\u30e0\u306b\u3042\u308b\u30d5\u30a9\u30f3\u30c8\u3092\u96c6\u3081\u305f\u3082\u306e(\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6)\u306fIDWriteFactory\u304b\u3089\u53d6\u3063\u3066\u3053\u308c\u305f\u308a\u3059\u308b\u3002\n\u30ab\u30b9\u30bf\u30e0\u306a\u5bc4\u305b\u96c6\u3081\u306f\u3001\u5f8c\u8ff0\u306e IDWriteFontCollectionLoader \u3092\u7d4c\u7531\u3057\u3066\u4e00\u6c17\u306b\u4f5c\u308a\u4e0a\u3052\u308b\u3002\n\u4f5c\u308a\u4e0a\u3052\u305f\u3089\u6700\u5f8c\u3001\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0/\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u306b\u3082\u540c\u3058\u304f\u3001\u5f8c\u304b\u3089IDWriteFontFile\u3092\u8ffd\u52a0\u3057\u305f\u308a\u3067\u304d\u306a\u3044\u3002\n\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u4eba\u516c\u7684\u5b58\u5728\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u3068\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u542b\u3093\u3060IDWriteFontCollection\u3092\u4f5c\u3063\u3066\u3001\u4f8b\u306enil\u306e\u5834\u6240\u306b\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u30b4\u30fc\u30eb\u3068\u306a\u308b\u3002\n\nIDWriteFontCollectionLoader\nDirectWrite\u304c\u30d5\u30a9\u30f3\u30c8\u96c6(IDWriteFontCollection)\u3092\u4f5c\u308b\u3068\u304d\u3001\u30d5\u30a9\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u6e90\u6cc9\u3068\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002\u4e3b\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u3067\u3001\u5b9f\u969b\u306b\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30b9\u30af\u3060\u3051\u3067\u306a\u304f\u3001\u30ea\u30bd\u30fc\u30b9\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304b\u3089\u306eLoader\u3084Enum\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308c\u3070\u3001\u3042\u308b\u610f\u5473\u3067\u306f\u8d85\u5909\u614b\u7684\u306aIDWriteFontCollection\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u88c5\u3057\u3088\u3046\uff01\n\u3068\u3044\u3046\u8a33\u3067\u3001\u9b54\u6539\u9020\u3092\u65bd\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u4e0a\u8a18\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306f\u81ea\u4f5c\u306eFMX\u88fd\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u306a\u306e\u306f\u65e2\u306b\u8ff0\u3079\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u7406\u7531\u306f\u3084\u306f\u308a\u30af\u30ed\u30b9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5bfe\u5fdc\u3068\u3001\u9ad8\u3044\u62e1\u5f35\u6027\u3092\u72d9\u3063\u3066\u306e\u3053\u3068\u3002\u6562\u3048\u3066\u65e2\u88fd\u54c1\u3092\u4f7f\u308f\u305a\u306b\u307e\u3055\u306b1\u304b\u3089\u5236\u4f5c\u3059\u308b\u7121\u8336\u30d7\u30e9\u30f3\u3092\u3076\u3061\u4e0a\u3052\u3066\u304a\u308a\u307e\u3057\u305f\u304c\u3001\u307e\u3055\u304b\u3053\u3093\u306a\u3068\u3053\u308d\u3067\u8e93\u304f\u306a\u3093\u3066\u601d\u3063\u3066\u3082\u307f\u306a\u304b\u3063\u305f\u308f\u3051\u3067\u3059\u3002\n\nSTEP1. FontCollection\u3092\u5f15\u304d\u51fa\u3059\n\u3053\u3053\u304b\u3089\u306f\u3001\u4e00\u90e8\u3001FMX\u306e\u30bd\u30fc\u30b9\u3092\u89e6\u308a\u307e\u3059\u3002\u8a66\u3057\u3066\u307f\u305f\u3044\u65b9\u306f\u3001\u5fc5\u305a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\ni. \u304a\u3082\u3080\u308d\u306b FMX.Canvas.D2D.pas \u3092\u958b\u304d\u3001implementation\u7bc0\u306e\u524d\u306b\u6b21\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nFMX.Canvas.D2D.After.pas\nvar\n  FontCollection: IUnknown = nil; // Added\n\n\nii. \u3059\u3079\u3066\u306e DWriteFactory.CreateTextFormat \u306b\u5bfe\u3057\u3066\u3001FontCollection \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\nFMX.Canvas.D2D.Before.pas\n  DWriteFactory.CreateTextFormat(PChar(WS), nil, D2FontWeight(FFont.Style), D2FontStyle(FFont.Style),\n    DWRITE_FONT_STRETCH_NORMAL, FFont.Size, PChar(FLocaleName), TextFormat);\n  if TFillTextFlag.RightToLeft in Flags then\n    TextFormat.SetReadingDirection(DWRITE_READING_DIRECTION_RIGHT_TO_LEFT);\n\n  ...\n\n  if Succeeded(TCanvasD2D.DWriteFactory.CreateTextFormat(\n       PChar(Font.Family),\n       nil,\n       D2FontWeight(Font.Style),\n       D2FontStyle(Font.Style),\n       DWRITE_FONT_STRETCH_NORMAL,\n       Font.Size,\n       PChar(LocaleName),\n       TextFormat)) then\n\n\n\n\n\nFMX.Canvas.D2D.After.pas\n  DWriteFactory.CreateTextFormat(PChar(WS), IDWriteFontCollection(FontCollection), D2FontWeight(FFont.Style), D2FontStyle(FFont.Style),\n    DWRITE_FONT_STRETCH_NORMAL, FFont.Size, PChar(FLocaleName), TextFormat);\n  if TFillTextFlag.RightToLeft in Flags then\n    TextFormat.SetReadingDirection(DWRITE_READING_DIRECTION_RIGHT_TO_LEFT);\n\n  ...\n\n  if Succeeded(TCanvasD2D.DWriteFactory.CreateTextFormat(\n       PChar(Font.Family),\n       IDWriteFontCollection(FontCollection),\n       D2FontWeight(Font.Style),\n       D2FontStyle(Font.Style),\n       DWRITE_FONT_STRETCH_NORMAL,\n       Font.Size,\n       PChar(LocaleName),\n       TextFormat)) then\n\n\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u308c\u3067\u597d\u304d\u306aFontCollection\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u306eFontCollection\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u304d\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u3002\u30b5\u30d6\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u3084\u308b\u3068\u304d\u306f\u3001Synchronize\u306a\u3069\u3092\u901a\u3057\u3066\u66f8\u304d\u63db\u3048\u307e\u3057\u3087\u3046\u3002FMX\u306e\u63cf\u753b\u51e6\u7406\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u305f\u3076\u3093\u3002\n\nSTEP2. \u5fc5\u8981\u306a\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\nIDWriteFontCollectionLoader, IDWriteFontFileEnumerator \u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u3068\u300c\u4ffa(DirectWrite)\u306f\u304a\u524d\u306e\u7528\u610f\u3057\u305f\u30af\u30e9\u30b9\u3092\u901a\u3058\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5217\u6319\u3057\u305f\u308a\u8aad\u307f\u53d6\u3063\u305f\u308a\u3059\u308b\u304b\u3089\u3001\u5f8c\u306f\u3088\u308d\u3057\u304f\u3074\u3087\u3093\u300d\u2026\u2026\u3057\u3083\u30fc\u306d\u3048\u306a\u3042\u3001\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\nTCustomFontRegister \u306f\u5358\u306a\u308b\u4fbf\u5229\u30af\u30e9\u30b9\u3067\u3059\u3002\u4eba\u306b\u3088\u3063\u3066\u306f\u5fc5\u8981\u306a\u3044\u306e\u304b\u3082\u3002\nTCustomFontRegister \u3092Create\u3057\u305f\u6642\u70b9\u3067\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5229\u7528\u53ef\u80fd\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u4ee3\u7269\u3067\u3059\u3002\n\nUtils.pas\ntype\n  TCustomFontRegister = class\n  private\n      FFontFiles : TStrings;\n      FOnRegistered : TSimpleNotify;\n      FRegisterThread : TThread;\n      FRegisterSuccessed : Boolean;\n      FRegistered : Boolean;\n      {$IFDEF MSWINDOWS}\n      CL : Array [1..2] of IDWriteFontCollectionLoader;\n      DFC : Array [1..2] of IDWriteFontCollection;\n      {$ENDIF}\n      procedure registring(AForm:TForm=nil);\n      procedure unregistring();\n  public\n      constructor Create(AFontPaths:Array of String; Relative:Boolean=True; Finish:TSimpleNotify=nil);\n      destructor Destroy; override;\n      procedure ManualRegister(AForm:TForm=nil);\n      procedure ManualUnRegister();\n      property RegisterSuccessed:Boolean read FRegisterSuccessed;\n      property Registered:Boolean read FRegistered write FRegistered;\n      property RegisterThread:TThread read FRegisterThread;\n      property OnRegistered:TSimpleNotify read FOnRegistered write FOnRegistered;\n  end;\n\n{$IFDEF MSWINDOWS}\n\n  TCustomFontLoader = class(TInterfacedObject,IDWriteFontCollectionLoader)\n      FFontDB : TList<IDWriteFontFile>;\n      FCollectionkey : Pointer;\n      FEnum : IDWriteFontFileEnumerator;\n      procedure AddFont(AFont:IDWriteFontFile);\n      function CreateEnumeratorFromKey(const factory: IDWriteFactory; const collectionKey: Pointer; collectionKeySize: Cardinal; out fontFileEnumerator: IDWriteFontFileEnumerator): HResult; stdcall;\n      constructor Create();\n      destructor Destroy; override;\n  end;\n\n  TCustomFontEnumerator = class(TInterfacedObject,IDWriteFontFileEnumerator)\n      FParent : IDWriteFontCollectionLoader;\n      i : Integer;\n      function MoveNext(var hasCurrentFile: BOOL): HResult; stdcall;\n      function GetCurrentFontFile(out fontFile: IDWriteFontFile): HResult; stdcall;\n      constructor Create(AParent:IDWriteFontCollectionLoader);\n      destructor Destroy; override;\n  end;\n{$ENDIF}\n\n\n\u3055\u3066\u3001\u809d\u5fc3\u8981\u306e\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u8aad\u307f\u8fbc\u307f\u30af\u30e9\u30b9\u3068\u304b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u5217\u6319\u30af\u30e9\u30b9\u3092\u6b21\u306b\u793a\u3057\u307e\u3059\u3002\n\u3053\u308c\u304c\u7121\u3044\u3068\u59cb\u307e\u308b\u3082\u306e\u3082\u59cb\u307e\u3089\u306a\u3044\u3067\u3059\u304b\u3089\u306d\uff01\n\nUtils.pas\n{$IFDEF MSWINDOWS}\n(* TCustomFontLoader *)\nconstructor TCustomFontLoader.Create();\nbegin\n      inherited Create;\n      FFontDB := TList<IDWriteFontFile>.Create;\nend;\n\ndestructor TCustomFontLoader.Destroy;\nvar\n      i : Integer;\nbegin\n      for i := 0 to FFontDB.Count-1 do FFontDB[i] := nil;\n      FEnum := nil;\n      FFontDB.Free;\n\n      inherited;\nend;\n\nprocedure TCustomFontLoader.AddFont(AFont:IDWriteFontFile);\nbegin\n      FFontDB.Add(AFont);\nend;\n\nfunction TCustomFontLoader.CreateEnumeratorFromKey(const factory: IDWriteFactory;\nconst collectionKey: Pointer; collectionKeySize: Cardinal;\nout fontFileEnumerator: IDWriteFontFileEnumerator): HResult;\nbegin\n      FEnum := IDWriteFontFileEnumerator(TCustomFontEnumerator.Create(Self));\n      fontFileEnumerator := FEnum;\n      FCollectionkey := collectionKey;\n      RESULT := S_OK;\nend;\n\n(* TCustomFontEnumerator *)\nfunction TCustomFontEnumerator.MoveNext(var hasCurrentFile: BOOL): HResult;\nbegin\n      Inc(i);\n      hasCurrentFile := i < (FParent as TCustomFontLoader).FFontDB.Count;\n      RESULT := S_OK;\nend;\n\nfunction TCustomFontEnumerator.GetCurrentFontFile(out fontFile: IDWriteFontFile): HResult;\nbegin\n      fontFile := (FParent as TCustomFontLoader).FFontDB[i];\n      RESULT := S_OK;\nend;\n\nconstructor TCustomFontEnumerator.Create(AParent:IDWriteFontCollectionLoader);\nbegin\n      inherited Create;\n\n      FParent := AParent;\n      i := -1;\nend;\n\ndestructor TCustomFontEnumerator.Destroy;\nbegin\n      inherited;\nend;\n\n\n\u7279\u7b46\u3059\u3079\u304d\u30dd\u30a4\u30f3\u30c8\u306f\u7279\u306b\u3042\u308a\u307e\u305b\u3093\u304c\u3001\n\nTCustomFontLoader.AddFont\u3067\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b3\u3057\u3066\u304a\u304d(\u5185\u90e8\u306e\u30ea\u30b9\u30c8\u306bTList<IDWriteFontFile>\u3092\u63a1\u7528)\nDirectWrite\u304c\u30d5\u30a9\u30f3\u30c8\u3092\u5217\u6319\u3057\u306b\u6765\u305f\u3068\u304d\u306fMoveNext\u3067\u300c\u307e\u3060\u3042\u308b\u3067\u300d\u300c\u3082\u3046\u306a\u3044\u3067\u300d\u3068\u6559\u3048\u3066\u3084\u308a\nDirectWrite\u304c\u300c\u3053\u308c\u6b32\u3057\u3044\uff01\u300d\u3068\u3044\u3063\u305f\u3068\u304d\u306fGetCurrentFontFile\u306b\u3066\u30d5\u30a9\u30f3\u30c8\u3092\u6e21\u3057\u3066\u3042\u3052\u308b\n\n\u3053\u306e\u4e09\u70b9\u30bb\u30c3\u30c8\u304c\u4e3b\u306a\u6d41\u308c\u3067\u3059\u3002\n\u3000\u3057\u304b\u3057\u3001\u5f15\u6570\u3092\u898b\u308b\u3068\u5206\u304b\u308b\u901a\u308aGetCurrentFontFile\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u6765\u3066\u3082\u300c\u6b32\u3057\u3044\u306e\u3069\u306e\u30d5\u30a9\u30f3\u30c8\u3084\uff01\u300d(\u5206\u304b\u3089\u3093)\u3068\u4e00\u77ac\u601d\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u5b9f\u306fMoveNext\u3068\u52d5\u4f5c\u304c\u30bb\u30c3\u30c8\u306a\u306e\u3067\u3001\u3053\u3053\u307e\u3067\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u305e\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u30af\u30e9\u30b9\u5074\u3067\u899a\u3048\u3066\u304a\u3051\u3070\u3001\u300c\u3053\u308c\u6b32\u3057\u3044\uff01\u300d\u3068\u8a00\u308f\u308c\u305f\u3068\u304d\u306b\u300c\u3042\u3042\u3001i\u756a\u76ee\u306e\u3084\u3064\u3067\u3059\u306d\u3001\u306f\u3044\u3069\u3046\u305e\u300d\u3068\u6e21\u305b\u308b\u308f\u3051\u3067\u3059\u3002\n\u3055\u3066\u3001\u6b21\u306f\u4fbf\u5229\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u90e8\u3067\u3059\u3002\u307b\u307c\u81ea\u5206\u7528\u304b\u3064\u3001\u30af\u30bd\u9577\u3044\u306e\u3067\u5fc5\u8981\u306a\u3051\u308c\u3070\u9069\u5b9c\u30b9\u30eb\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3059\u308b\u30b3\u30fc\u30c9\u3092registering\u95a2\u6570\u306b\u8a18\u8ff0\u3057\u3066\u3044\u308b\u3053\u3068\u3060\u3051\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nUtils.pas\nconstructor TCustomFontRegister.Create(AFontPaths:Array of String; Relative:Boolean=True; Finish:TSimpleNotify=nil);\nvar\n      i : Integer;\n      rp : String;\nbegin\n      inherited Create;\n      FFontFiles := TStringList.Create;\n\n      FOnRegistered := Finish;\n\n      rp := '';\n      if Relative then rp := IncludeTrailingPathDelimiter(ExtractFileDir(ParamStr(0)));\n\n      for i := 0 to High(AFontPaths) do FFontFiles.Add(rp+AFontPaths[i]);\n      if FFontFiles.Count > 0 then registring();\nend;\n\ndestructor TCustomFontRegister.Destroy;\nbegin\n      unregistring();\n      FFontFiles.Free;\n      inherited;\nend;\n\nprocedure TCustomFontRegister.unregistring();\n{$IFDEF MACOS}\nbegin\n      FRegistered := False;\nend;\n{$ELSEIF Defined(MSWINDOWS)}\nvar\n      i : Integer;\n      DF : IDWriteFactory;\nbegin\n      if FRegistered then\n      begin\n            // for DirectWrite\n            if GlobalUseDirect2D and (GlobalVersionWin.dwMajorVersion >= 6) then\n            begin\n                  DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n                  try\n                        DF.UnregisterFontCollectionLoader(CL[2]);\n                        Fmx.Canvas.D2D.FontCollection := nil;\n                  finally\n                        DF := nil; DFC[2] := nil;\n                  end;\n            // for GDI\n            end else\n            begin\n                  for i := 0 to FFontFiles.Count-1 do\n                  begin\n                        if FileExists(FFontFiles[i])  then\n                        begin\n                              RemoveFontResourceEx(PWideChar(FFontFiles[i]),FR_PRIVATE,nil);\n                        end;\n                  end;\n\n                  SendMessage(HWND_BROADCAST, WM_FONTCHANGE, 0, 0);\n            end;\n      end;\n\n      FRegistered := False;\nend;\n{$ENDIF}\n\nprocedure TCustomFontRegister.ManualRegister(AForm:TForm=nil);\nbegin\n      registring(AForm);\nend;\n\nprocedure TCustomFontRegister.ManualUnRegister();\nbegin\n      unregistring();\nend;\n\nprocedure TCustomFontRegister.registring(AForm:TForm=nil);\n{$IFDEF MACOS}\nbegin\n      if Assigned(FOnRegistered) then FOnRegistered(Self);\nend;\n{$ELSEIF Defined(MSWINDOWS)}\n\n    procedure MethRefToMethPtr(const MethRef; var MethPtr);\n    type\n        TVtable = array [0 .. 3] of Pointer;\n        PVtable = ^TVtable;\n        PPVtable = ^PVtable;\n    begin\n        TMethod(MethPtr).Code := PPVtable(MethRef)^^[3];\n        TMethod(MethPtr).Data := Pointer(MethRef);\n    end;\n\n    function MakeNotify(const Proc: TNotifyEventProc): TNotifyEvent;\n    begin\n        MethRefToMethPtr(Proc, Result);\n    end;\n\nbegin\n      FRegisterSuccessed := False;\n      FRegistered := False;\n\n      FRegisterThread := TThread.CreateAnonymousThread(\n      procedure\n      var\n            i,j,k,n : Integer;\n            m : Cardinal;\n            DF : IDWriteFactory;\n            SYS : IDWriteFontCollection;\n            hr : HRESULT;\n            wff : IDWriteFontFile;\n            pwff : Array [0..16] of IDWriteFontFile;\n            Dff : IDWriteFontFace;\n            wf : IDWriteFont;\n            CK : Pointer;\n            FM : IDWriteFontFamily;\n            FMN : IDWriteLocalizedStrings;\n            FontName : Array [0..1024] of WideChar;\n            GDIFont : TMemoryStream;\n            exists : LongBool;\n            BOOT_LIST : TStringList;\n      begin\n\n      try\n\n      // for DirectWrite\n      if GlobalUseDirect2D and (GlobalVersionWin.dwMajorVersion >= 6) then\n      begin\n            DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n            try\n                  BOOT_LIST := TStringList.Create;\n                  CL[1] := TCustomFontLoader.Create();\n                  CL[2] := TCustomFontLoader.Create();\n\n                  with Boot_list do\n                  begin\n                        Add('MS Gothic');\n                        Add('MS PGothic');\n                        Add('MS UI Gothic');\n                        Add('MS Mincho');\n                        Add('MS PMincho');\n                        Add('Meiryo');\n                        Add('Meiryo UI');\n                        Add('Segoe UI');\n                        Add('Yu Gothic');\n                        Add('Yu Gothic UI');\n                        Add('Georgia');\n                        Add('Courier New');\n                        Add('Arial');\n                        Add('Times New Roman');\n                  end;\n\n                  for i := 0 to FFontFiles.Count-1 do\n                  begin\n                        if FileExists(FFontFiles[i]) and SUCCEEDED(DF.CreateFontFileReference(PWideChar(FFontFiles[i]),nil,wff)) then\n                        begin\n                              for n := 1 to 2 do (CL[n] as TCustomFontLoader).AddFont(wff);\n                        end;\n                  end;\n\n                  DF.GetSystemFontCollection(SYS,False);\n\n                  // 2\u30b9\u30ad\u30e3\u30f3\u5b9f\u65bd\n                  for n := 1 to 2 do\n                  begin\n                        if SUCCEEDED(DF.RegisterFontCollectionLoader(CL[n])) then\n                        begin\n                              try\n                                    for i := 0 to SYS.GetFontFamilyCount-1 do\n                                    begin\n                                          if SUCCEEDED(SYS.GetFontFamily(i,FM)) then\n                                          begin\n                                                // minimum filter (1 of 2 only)\n                                                if (n = 1) then\n                                                begin\n                                                      FM.GetFamilyNames(FMN);\n\n                                                      if SUCCEEDED(FMN.GetString(0,@FontName[0],1023)) then\n                                                      begin\n                                                            if Boot_list.IndexOf(StrPas(PWideChar(@FontName[0]))) < 0 then\n                                                            begin\n                                                                  Continue;\n                                                            end;\n                                                      end;\n                                                end;\n\n                                                exists := True;\n                                                if (exists) then\n                                                begin\n                                                      for j := 0 to FM.GetFontCount-1 do\n                                                      begin\n                                                            FM.GetFont(j,wf);\n                                                            wf.CreateFontFace(Dff);\n\n                                                            Dff.GetFiles(m,nil);\n                                                            Dff.GetFiles(m,@pwff[0]);\n\n                                                            for k := 0 to m-1 do\n                                                            begin\n                                                                  if pwff[k] <> nil then (CL[n] as TCustomFontLoader).AddFont(pwff[k]);\n                                                            end;\n\n                                                      end;\n                                                end;\n                                          end;\n\n                                    end;\n\n                                    CK := Pointer(1024*n);\n                                    hr := DF.CreateCustomFontCollection(CL[n],@CK,sizeof(Pointer),DFC[n]);\n\n                                    TThread.Synchronize(TThread.CurrentThread,procedure()\n                                    begin\n                                          Fmx.Canvas.D2D.FontCollection := DFC[n];\n                                    end);\n\n                                    if ForceTerminate then break;\n\n                              except\n\n                              end;\n                        end;\n                  end;\n            finally\n                  DF.UnregisterFontCollectionLoader(CL[1]);\n                  DF := nil;\n                  DFC[1] := nil;\n                  SYS := nil; wf := nil; wff := nil; Dff := nil; FM := nil;\n                  for i := Low(pwff) to High(pwff) do pwff[i] := nil;\n                  BOOT_LIST.Free;\n            end;\n\n      // for GDI\n      end else\n      begin\n            if CompareText(TCanvasManager.DefaultCanvas.ClassName,'TCanvasGdiPlus') <> 0 then exit;\n\n            for i := 0 to FFontFiles.Count-1 do\n            begin\n                  if FileExists(FFontFiles[i]) and (LowerCase(ExtractFileExt(FFontFiles[i])) = '.ttf') then\n                  begin\n                        if AForm <> nil then\n                        begin\n                              GDIFont := TMemoryStream.Create;\n                              try\n                                    GDIFont.LoadFromFile(FFontFiles[i]); GDIFont.Seek(0,0);\n                                    AForm.Canvas.LoadFontFromStream(GDIFont);\n                              finally\n                                    GDIFont.Free;\n                              end;\n                        end;\n\n                        if (AForm = nil) then AddFontResourceEx(PWideChar(FFontFiles[i]),FR_PRIVATE,nil);\n                  end;\n            end;\n\n            if (AForm = nil) then SendMessage(HWND_BROADCAST, WM_FONTCHANGE, 0, 0);\n      end;\n\n      except\n      end;\n\n      end);\n\n      with FRegisterThread do\n      begin\n            OnTerminate := MakeNotify(\n                procedure(Sender: TObject)\n                begin\n                      FRegisterSuccessed := True;\n                      FRegistered := True;\n                      FRegisterThread := nil;\n                      if Assigned(FOnRegistered) then FOnRegistered(Sender);\n                end);\n\n            FreeOnTerminate := True;\n            Start;\n      end;\n\nend;\n{$ENDIF}\n\n\n\u9577\u3005\u3068\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\u5b9f\u306f\u3053\u306e\u4fbf\u5229\u30af\u30e9\u30b9\u306e\u4e2d\u306b\u3001\u5c0f\u6280\u3068\u554f\u984c\u304c\u3051\u3063\u3053\u3046\u6df7\u3056\u3063\u3066\u3044\u307e\u3059\u3002\u3044\u304f\u3064\u304b\u7d39\u4ecb\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u3063\u305d\u308aGDI\u5bfe\u5fdc\u30b3\u30fc\u30c9\u304c\u6df7\u305c\u3066\u3042\u308b\nregistring() \u3084 unregistring() \u3067\u306f\u3001\u3053\u3063\u305d\u308a\u3001GDI\u7528\u306e\u3001\u3044\u308f\u3086\u308b\u5f93\u6765\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u30b3\u30fc\u30c9\u304c\u5165\u308c\u3066\u3042\u308a\u307e\u3059\u3002XP\u4ee5\u524d\u3067\u306fDirectWrite\u304c\u4f7f\u3048\u307e\u305b\u3093\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308bGDI+\u306e\u305f\u3081\u306b\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u3067\u3082\u3053\u308c\u3001\u5b9f\u969b\u306bGDI+\u30ad\u30e3\u30f3\u30d0\u30b9\u3067\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u6c17\u304c\u3057\u306a\u3044\u3067\u3082\u306a\u3044\u2026\u2026\uff1f\u3000\u306a\u304aWindows\u306eFMX\u3067\u306f\u57fa\u672c\u7684\u306bDirect2D\u304bGDI+\u3067\u3001GDI\u306f\u4f7f\u308f\u308c\u307e\u305b\u3093\u3002\n\n\u3053\u3063\u305d\u308aWindows/macOS\u5bfe\u5fdc\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u304c\u6df7\u305c\u3066\u3042\u308b\nmacOS\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u3001app\u5185\u306b\u30d5\u30a9\u30f3\u30c8\u3092\u914d\u7f6e\u3059\u308b\u3060\u3051\u3067\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u3053\u306e\u30af\u30e9\u30b9\u81ea\u4f53\u304c\u4e0d\u8981\u3067\u3059\u3002\n\u30e1\u30a4\u30f3\u30e6\u30cb\u30c3\u30c8\u5074\u3067\u300cmacOS\u306e\u5834\u5408\u306f\u30af\u30e9\u30b9\u3092\u4f5c\u3089\u306a\u3044\u300d\u3092\u3084\u3063\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u30af\u30e9\u30b9\u5185\u90e8\u3067\u5207\u308a\u5206\u3051\u3066\u3044\u307e\u3059\u3002\n\n\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u767b\u9332\u51e6\u7406\nregistring()\u5185\u306f\u30b9\u30d1\u30b2\u30c6\u30a3\u30b3\u30fc\u30c9\u306a\u3089\u306c\u3001\u3046\u3069\u3093\u30b3\u30fc\u30c9\u3068\u3044\u3046\u304b\u304d\u3057\u3081\u3093\u30b3\u30fc\u30c9\u3068\u3044\u3046\u304b\u3001\u7f8e\u5473\u3057\u3044\u3093\u3060\u3051\u3069\u305f\u3076\u3093\u305d\u308c\u79d8\u4f1d\u306e\u30bf\u30ec\u306e\u305b\u3044\u306e\u3058\u3083\u306a\u3044\u304b\u3044\uff1f\u3000\u307f\u305f\u3044\u306a\u89e3\u8aad\u306e\u3057\u3065\u3089\u3055\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u7533\u3057\u8a33\u306a\u3044\u3002\n\u57fa\u672c\u7684\u306a\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n\n\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u3078\u76f4\u63a5\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u305f\u3089\u6700\u9ad8\u3060\u3051\u3069\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u4e00\u5de5\u592b\n\u5148\u307b\u3069\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30ed\u30fc\u30c0\u30fc\u3067\u597d\u304d\u306a\u30d5\u30a9\u30f3\u30c8\u3092\u8aad\u307f\u8fbc\u3093\u3067GO! \u2192 \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u5165\u308b\u3051\u3069\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u5168\u90e8\u4f7f\u3048\u306a\u3044\n\u305d\u3053\u3067\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306b\u52a0\u3048\u3066\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u3082\u8ffd\u52a0\u3002\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u8ffd\u52a0\u306e\u969b\u306f\u3001\u4e88\u3081\u53d6\u5f97\u3067\u304d\u308b\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u304b\u3089\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30df\u30ea\u30fc\u306a\u3069\u3092\u8fbf\u3063\u3066\u3044\u304d\u3001\u6700\u7d42\u7684\u306b\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5b9f\u4f53(\u306e\u3088\u3046\u306a\u3082\u306e)\u3001IDWriteFontFile\u3092\u30b2\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n\u3053\u308c\u3067OK\uff01\n\n\n\u3068\u3066\u3082\u9045\u3044\n\u5b9f\u88c5\u3067\u304d\u305f\u3053\u3068\u306f\u826f\u3044\u3082\u306e\u306e\u3001\u524d\u8ff0\u306e\u300c\u57fa\u672c\u7684\u306a\u6d41\u308c\u300d\u3067\u5358\u7d14\u306b\u5b9f\u88c5\u3057\u3066\u52d5\u304b\u3059\u3068\u306a\u305c\u3060\u304bCreateCustomFontCollection\u3067\u30d5\u30a9\u30f3\u30c8\u96c6\u3092\u4f5c\u3063\u3066\u3082\u3089\u3046\u306e\u306b\u76f8\u5f53\u306a\u6642\u9593\u304c\u304b\u304b\u308a\u3001\u3082\u3057\u30bd\u30d5\u30c8\u8d77\u52d5\u6642\u306b\u30d5\u30a9\u30f3\u30c8\u767b\u9332\u5b8c\u4e86\u5f85\u3061\u3068\u304b\u3084\u3063\u3061\u3083\u3046\u3068\u5730\u7344\u306e\u3088\u3046\u306a\u5f85\u3061\u6642\u9593\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u306b\u3088\u3063\u3066\u306f\u30d5\u30ea\u30fc\u30ba\u306b\u8fd1\u3044\u72b6\u614b\u306b\u306a\u308b\u3053\u3068\u3082\u3002\u6016\u3063\uff01\n\u7406\u7531\u306f\u5358\u7d14\u3067\u3001\n\n\u3053\u306e\u3054\u6642\u4e16\u3001\u3069\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u3067\u3082\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u5165\u3063\u3066\u3044\u308b\u30d5\u30a9\u30f3\u30c8\u81ea\u4f53\u304c\u3068\u306b\u304b\u304f\u591a\u3044 (\u6b27\u6587\u30fb\u548c\u6587\u30fb\u30b7\u30f3\u30dc\u30eb)\n\u305d\u3093\u306a\u72b6\u6cc1\u4e0b\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u7dcf\u4f53\u306f\u8457\u3057\u304f\u5de8\u5927\u3067\u3042\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u5168\u3066\u3068\u5fc5\u8981\u306a\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u30ed\u30fc\u30c0\u30fc\u3092 IDWriteFactory.CreateCustomFontCollection \u306b\u6e21\u3059\u3068\u51e6\u7406\u5f85\u3061\u3067\u3057\u3070\u3089\u304f\u5236\u5fa1\u304c\u5e30\u3063\u3066\u3053\u306a\u3044\n\n\u4eca\u5ea6\u3053\u305d\u8a70\u3093\u3060\u304b\u2026\u2026\uff1f\u3000\u4e07\u7b56\u5c3d\u304d\u305f\u304b\uff1f\u3000\u3044\u3084\u3001\u307e\u3060\u3060\uff01\n\n\u4e8c\u6bb5\u968e\u306b\u5206\u3051\u3066FontCollection\u3092\u4f5c\u308b\n\u3061\u3087\u3063\u3068\u3053\u3053\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nUtils.pas\n                  with Boot_list do\n                  begin\n                        Add('MS Gothic');\n                        Add('MS PGothic');\n                        Add('MS UI Gothic');\n                        Add('MS Mincho');\n                        Add('MS PMincho');\n                        Add('Meiryo');\n                        Add('Meiryo UI');\n                        Add('Segoe UI');\n                        Add('Yu Gothic');\n                        Add('Yu Gothic UI');\n                        Add('Georgia');\n                        Add('Courier New');\n                        Add('Arial');\n                        Add('Times New Roman');\n                  end;\n// \u4e2d\u7565\n                                                // minimum filter (1 of 2 only)\n                                                if (n = 1) then\n                                                begin\n                                                      FM.GetFamilyNames(FMN);\n\n                                                      if SUCCEEDED(FMN.GetString(0,@FontName[0],1023)) then\n                                                      begin\n                                                            if Boot_list.IndexOf(StrPas(PWideChar(@FontName[0]))) < 0 then\n                                                            begin\n                                                                  Continue;\n                                                            end;\n                                                      end;\n                                                end;\n\n\n\u3000\u4f55\u3084\u3089\u602a\u3057\u3044\u6587\u5b57\u5217\u306e\u7f85\u5217\u304c\u3042\u308a\u307e\u3059\u306d\u3002\u305d\u3057\u3066\u3001\u5f8c\u306b\u73fe\u308c\u308b\u30eb\u30fc\u30d7\u306e\u4e2d\u3067\u306f\u3001\u4f55\u3084\u3089\u3001\u3053\u306e\u30ea\u30b9\u30c8\u3092\u4f7f\u3063\u3066\u4f55\u304b\u3084\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\n\u3000\u305d\u3046\uff01\u3000\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u4e00\u822c\u7684\u306a\u6027\u8cea\u306b\u76ee\u3092\u4ed8\u3051\u307e\u3059\u3002\u62d9\u4f5c\u306e\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306b\u3057\u308d\u3001\u4ed6\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30bd\u30d5\u30c8\u306b\u3057\u308d\u3001\u5b9f\u969b\u306b\u4f7f\u3046\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u9650\u3089\u308c\u3066\u3044\u307e\u3059\u3088\u306d\u3002\u6b27\u6587\u30d5\u30a9\u30f3\u30c8\u306a\u3093\u3066\u306e\u3082\u3001Arial,Verdana,Tahoma,Courier New\u304c\u4f7f\u308f\u308c\u308b\u304b\u3069\u3046\u304b\u3044\u3063\u305f\u5177\u5408\u3067\u3001\u305d\u308c\u306a\u3089\u3001\u307e\u305a\u306f\u6700\u5c0f\u9650\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3067\u7acb\u3061\u4e0a\u3052\u3066\u8d77\u52d5\u3092\u7206\u901f\u5316\u3057\u3061\u3083\u3044\u307e\u3059\u3002\u4f8b\u3048\u308b\u306a\u3089\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u72b6\u614b\u3067\u3059\u306d4\u3002\n\u3000\u5f15\u304d\u7d9a\u3044\u3066\u3001\u30d5\u30eb\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u305f\u3081\u3001\u3057\u3070\u3089\u304fCreateCustomFontCollection\u3092\u8d70\u3089\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u653e\u7f6e\u30d7\u30ec\u30a4\u3067\u3059\u3002\u3048\u3001\u305d\u308c\u56fa\u307e\u308b\u3093\u3058\u3083\u306a\u3044\uff1f\u3000\u3044\u3048\u3044\u3048\u3001\u3088\u304f\u898b\u3066\u304f\u3060\u3055\u3044\u3002\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9(TAnonymousThread)\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u533f\u540d\u30b9\u30ec\u30c3\u30c9\u3067\u30e9\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3042\u308a\u307e\u3059\u3002FontCollection\u66f8\u304d\u63db\u3048\u6642\u306a\u3069\u306fSynchronize\u3092\u5fd8\u308c\u305a\u306b\uff01\n\u3000\u653e\u7f6e\u30d7\u30ec\u30a4\u304c\u5b8c\u4e86\u3057\u305f\u3068\u304d\u306f\u3001\u30d5\u30eb\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u51fa\u6765\u4e0a\u304c\u3063\u3066\u3044\u307e\u3059\u3002\u6539\u3081\u3066\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5dee\u3057\u66ff\u3048\u308b\u3068\u3001\u898b\u4e8b\u306b\u300c2\u30d1\u30b9\u4f5c\u6226\u300d\u306b\u3088\u308bFMX\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u4ee5\u4e0a\u304c\u3001FMX\u306b\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u30b4\u30ea\u62bc\u3057\u3067\u5b9f\u73fe\u3059\u308b\u624b\u9806\u3060\u3063\u305f\u306e\u3067\u3057\u305f\u3002\u9577\u304b\u3063\u305f\u3042\u3042\u3042\uff01\n\n\u554f\u984c\u70b9\n\u3000\u304a\u7d04\u675f\u901a\u308a\u3001\u7389\u306b\u7455\u306a\u30dd\u30a4\u30f3\u30c8\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u3002\n\n\u5404\u7a2eAPI\u306e\u53d6\u308a\u6271\u3044\u3068\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\n\u3000\u6c17\u3092\u4ed8\u3051\u3066\u66f8\u3044\u305f\u3064\u3082\u308a\u3067\u3059\u304c\u3001\u30df\u30b9\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u3088\u3046\u306a\u306a\u3044\u3088\u3046\u306a\u2026\u2026\u3002\n\n\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3055\u3088\u306a\u3089\u3092\u544a\u3052\u308b\u3068\u304d\n\u3000\u3082\u3046\u4f7f\u308f\u306a\u3044\u6642\u306fnil\u4ee3\u5165\u3067\u826f\u3044\u3093\u3060\u3063\u3051\uff1f\n\nCreateCustomFontCollection\u4e2d\u306b\u30bd\u30d5\u30c8\u304c\u7d42\u4e86\u3057\u305f\u3089\uff1f\n\u3000\u3053\u308c\u304c\u5927\u554f\u984c\u3002\u5225\u30b9\u30ec\u30c3\u30c9\u3067CreateCustomFontCollection\u3092\u52d5\u304b\u3059\u3053\u3068\u3067\u8272\u3005\u8aa4\u9b54\u5316\u3057\u306f\u5229\u304d\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30bd\u30d5\u30c8\u7d42\u4e86\u6642\u3068\u306a\u308b\u3068\u8a71\u306f\u5225\u3002\u8d77\u52d5\u3057\u3066\u3059\u3050\u7d42\u4e86\u3059\u308b\u306a\u3069\u3001CreateCustomFontCollection\u304b\u3089\u5236\u5fa1\u304c\u8fd4\u3089\u306a\u3044\u72b6\u614b\u3067\u30bd\u30d5\u30c8\u7d42\u4e86\u3092\u8a66\u307f\u3089\u308c\u308b\u3068\u3001\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u4f5c\u3063\u3066\u308b\u6700\u4e2d\u306e\u30b9\u30ec\u30c3\u30c9\u3092\u5b89\u5168\u306b\u6b62\u3081\u308b\u624b\u6bb5\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u6700\u5f37\u306e\u8aa4\u9b54\u5316\u3057\u3068\u3057\u3066\u3001TerminateThread\u3042\u305f\u308a\u3092\u4f7f\u3063\u3066\u30b5\u30d6\u30b9\u30ec\u30c3\u30c9\u3092\u6bba\u3063\u305f\u308a\u3059\u308b\u65b9\u6cd5\u3082\u3042\u308b\u3051\u308c\u3069\u3001\u305d\u308c\u3059\u3089\u30c0\u30e1\u306a\u5834\u5408\u306fAccess Violation\u7b49\u306e\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u308a\u3057\u307e\u3059\u3002except\u3067\u63e1\u308a\u6f70\u3059\u306e\u3082\u2026\u2026\u306d\u3048\uff1f\n\u3000\u672c\u5f53\u306b\u5fc5\u8981\u306a\u3044\u30d5\u30a9\u30f3\u30c8\u306f\u5168\u90e8\u5f3e\u304f\u65b9\u5411\u6027\u3067\u3044\u304f\u306e\u304c\u73fe\u72b6\u30d9\u30bf\u30fc\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001\u65e5\u672c\u8a9e\u306e\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u3067\u306f\u3001\u6b27\u6587/\u30b7\u30f3\u30dc\u30eb\u30d5\u30a9\u30f3\u30c8\u306e\u3046\u3061\u3001\u7279\u5b9a\u306e\u3082\u306e\u6570\u500b\u4ee5\u5916\u306f\u78ba\u5b9f\u306b\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u6975\u8ad6\u3001\u6b27\u6587\u30fb\u30b7\u30f3\u30dc\u30eb\u306f\u5168\u90e8\u5f3e\u3044\u3066\u65e5\u672c\u8a9e\u30d5\u30a9\u30f3\u30c8\u3060\u3051\u8aad\u307f\u8fbc\u3080\u306e\u3060\u3063\u3066\u5341\u5206\u30a2\u30ea\u3067\u3057\u3087\u3046\u3002\n\n\u304a\u307e\u3051\uff1aSTEP3. \u30d5\u30a9\u30f3\u30c8\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\nDirectWrite\u3068GDI\u3067\u306f\u6307\u5b9a\u3059\u308b\u30d5\u30a9\u30f3\u30c8\u540d\u304c\u5fae\u5999\u306b\u9055\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u3064\u3044\u3067\u306bmasOS\u3082\u3002\n\u9069\u5207\u306b\u30d5\u30a9\u30f3\u30c8\u30ea\u30b9\u30c8\u3092\u53d6\u3063\u3066\u3053\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nUtils.pas\nfunction EnumFontFamProc(var EnumLogFont: TLogFont; var NewTextMetric: TNewTextMetric; FontType: Integer; LPARAM: Longint): Integer; stdcall; export;\nvar\n      AFontName : String;\nbegin\n      Result := 1;\n\n      AFontName := StrPas(PWideChar(@EnumLogFont.lfFaceName[0]));\n\n      if (pos('@',AFontName)=0) and (FontType = TRUETYPE_FONTTYPE) then\n      begin\n            TStrings(LPARAM).Add(AFontname);\n      end;\nend;\n\nprocedure GetFontList(List:TStrings);\nvar\n      DC:HDC;\n      DF : IDWriteFactory;\n      DFC : IDWriteFontCollection;\n      FM : IDWriteFontFamily;\n      FMN : IDWriteLocalizedStrings;\n      FontName : Array [0..1024] of WideChar;\n      i : Integer;\n      j : Cardinal;\n      locname : Array [0..10] of WideChar;\n      exists : LongBool;\n      lf:tagLOGFONTW;\nbegin\n      // for DirectWrite\n      if GlobalUseDirect2D then\n      begin\n            DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n            try\n                  DFC := IDWriteFontCollection(FMX.Canvas.D2d.FontCollection);\n                  if DFC = nil then DF.GetSystemFontCollection(DFC,false);\n\n                  for i := 0 to DFC.GetFontFamilyCount-1 do\n                  begin\n                        DFC.GetFontFamily(i,FM);\n                        FM.GetFamilyNames(FMN);\n                        locname := 'ja-jp'+#0;\n                        FMN.FindLocaleName(locname[0],j,exists);\n                        if (exists) then\n                        begin\n                              FMN.GetString(j,@FontName[0],Length(FontName)-1);\n                              List.Add(StrPas(PWideChar(@FontName[0])));\n                        end;\n                  end;\n            finally\n                  DF := nil;\n            end;\n\n      // for GDI\n      end else\n      begin\n            DC := GetDC(0);\n            try\n                  FillMemory(@lf,sizeof(lf),0);\n                  lf.lfCharSet := SHIFTJIS_CHARSET;\n                  lf.lfPitchAndFamily := 0;\n                  FillChar(lf.lfFaceName, sizeof(lf.lfFaceName), 0);\n                  EnumFontFamiliesEx(DC, lf, @EnumFontFamProc, LongInt(List), 0);\n            finally\n                  ReleaseDC(0, DC);\n            end;\n      end;\n\nend;\n{$ENDIF}\n\n{$IFDEF MACOS}\nprocedure GetFontList(List:TStrings);\nvar\n      fm: NSFontManager;\n      fa: NSArray;\n      i: Integer;\n      fname: NSString;\nbegin\n      fm := TNSFontManager.Wrap(TNSFontManager.OCClass.sharedFontManager);\n      fa := fm.availableFontFamilies;\n\n      for i := 0 to fa.count-1 do\n      begin\n            fname := TNSString.Wrap(fa.objectAtIndex(i));\n            List.Add(fname.UTF8String);\n      end;\nend;\n{$ENDIF}\n\n\n\nDirectWrite\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30df\u30ea\u30fc\u8fba\u308a\u304b\u3089\u540d\u524d\u3092\u5f97\u307e\u3059\u3002\nGDI\n\u5b9a\u756a\u306e\u3084\u3064\u3067\u3059\u306d\u3002EnumFontFamiliesEx API \u3092\u4f7f\u3044\u307e\u3059\u3002\nmacOS\nTNSFontManager\u306eavailableFontFamilies\u3088\u308a\u5217\u6319\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u30e9\u30a4\u30bb\u30f3\u30b9\n\u3000MIT License \u3063\u3066\u3053\u3068\u3067\u3001\u3069\u3046\u3063\u3059\u304b\uff1f\n\n\u3055\u3044\u3054\u306b\n\u3000\u5f53\u521d\u3001\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u30bf\u30ab\u3092\u304f\u304f\u3063\u3066\u3044\u305fFMX\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3002\u3068\u3053\u308d\u304c\u3001\u65e5\u672c\u306f\u3082\u3061\u308d\u3093\u3001\u6d77\u5916\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u3084StackOverflow\u3092\u8997\u3044\u3066\u3082\u300c\u7121\u7406\u3084\u305e\u305d\u308c\u2026\u2026(\u610f\u8a33)\u300d\u306eAnswer\u3070\u304b\u308a\u3002\u982d\u3092\u62b1\u3048\u3066\u4e00\u30f6\u6708\u4e8c\u30f6\u6708\u2026\u2026\u3075\u3068\u89e3\u6c7a\u306e\u9053\u7b4b\u304c\u7acb\u3063\u3066\u304d\u305f\u3068\u304d\u306f\u3001\u30ac\u30c3\u30c4\u30dd\u30fc\u30ba\u3092\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\u3000FMX\u88fd\u304b\u3064\u3001\u3053\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u7d44\u307f\u8fbc\u3093\u3060\u62d9\u4f5c\u306eADV\u300e\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb\u300f(\u6700\u521d\u306b\u304a\u898b\u305b\u3057\u305f\u3082\u306e\u3067\u3059\u306d)\u306f\u3001\u4ed6\u306e\u4e0d\u5177\u5408\u3082\u767a\u751f\u3057\u305f\u308a\u7d06\u4f59\u66f2\u6298\u3042\u3063\u305f\u3082\u306e\u306e\u3001\u73fe\u5728\u306f\u307b\u307cStable\u306b\u9054\u3057\u3001\u7d9a\u7de8\u306b\u307e\u3067\u5229\u7528\u3067\u304d\u308b\u7a0b\u5ea6\u306b\u306f\u6c4e\u7528\u5316\u3082\u9032\u307f\u307e\u3057\u305f\u3002\u3055\u3089\u306b\u3001macOS\u306e\u65b9\u3067\u3082\u30d7\u30ec\u30a4\u3067\u304d\u308b\u306e\u304c\u500b\u4eba\u7684\u306a\u63a8\u3057\u3067\u3059\u3002\u307e\u3063\u305f\u304f\u3001Delphi\u306f\u6700\u9ad8\u3060\u305c\uff01\n\u3000\u4ee5\u4e0a\u3001\u540d\u53e4\u5c4b\u751f\u307e\u308c\u30fb\u540d\u53e4\u5c4b\u80b2\u3061\u306e\u6d41\u6d6a\u306e\u30d7\u30ed\u30b0\u30e9\u30de\u30fc\u3001\u9577\u9580\u307f\u3089\u3044\u304cFMX\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u4e8b\u60c5\u306b\u3064\u3044\u3066\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u3002\u9577\u304f\u306a\u3063\u3066\u3054\u3081\u3093\u306d\uff01\u3000\u3067\u306f\u307e\u305f\u6765\u5e74\uff01\u3000\u4f55\u304b\u66f8\u3051\u305f\u3089\u3044\u3044\u306a\uff01\n\n\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb\u3001\u3069\u3046\u305e\u3088\u3057\u306a\u306b\u3002(\u30c0\u30a4\u30ec\u30af\u30c8\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0)\n\n\n\n\n\u5c11\u306a\u304f\u3068\u3082XE6\u3067\u306f\u30c0\u30e1\u3002\u305d\u308c\u4ee5\u964d\u306f\u77e5\u3089\u3093\u3002\u00a0\u21a9\n\n\n\u304a\u304b\u3052\u3055\u307e\u3067\u6628\u5e74\u51ac\u3001\u9593\u306b\u5408\u3044\u307e\u3057\u305f\u3002\u00a0\u21a9\n\n\nIDWriteFontFile \u81ea\u4f53\u306f IDWriteFactory.CreateFontFileReference \u3067\u304a\u624b\u8efd\u306b\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u00a0\u21a9\n\n\nWindows\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3063\u3066\u5b9f\u969b\u306e\u3068\u3053\u308d\u8d77\u52d5\u901f\u304f\u306a\u3044\u3088\u306d\u00a0\u21a9\n\n\n\n\u3000Delphi Advent Calender \u306b\u306f\u4eca\u5e74\u521d\u53c2\u52a0\u30012016\u5e74\u306e22\u65e5\u76ee(12\u670822\u65e5\u5206)\u3092\u62c5\u5f53\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f[\u9577\u9580\u307f\u3089\u3044](https://twitter.com/MiraiNagato)\u3068\u7533\u3057\u307e\u3059\u3002Delphi\u3068\u306f13\u5e74\u3001\u4e2d\u5b662\u5e74\u304b\u3089\u306e\u304a\u4ed8\u304d\u5408\u3044\u3067\u3059\u3002\u6b73\u3082\u53d6\u308a\u307e\u3057\u305f\u3002\u672c\u65e5\u306f\u30ab\u30ec\u30f3\u30c0\u30fc\u3068\u3044\u3046\u3088\u308a\u3001\u3082\u306f\u3084\u8aad\u307f\u7269\u3060\u3068\u304b\u30ea\u30bd\u30fc\u30b9\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u611f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3054\u7b11\u89a7\u3044\u305f\u3060\u3051\u307e\u3059\u3068\u5e78\u3044\u3067\u3059\u3002\n# Introduction: FMX\u3067\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u4f7f\u3044\u305f\u3044\uff01\n\u3000\u304b\u306a\u308a\u7a81\u7136\u3067\u3059\u304c\u3001\u4e0b\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002![scr05.jpg](https://qiita-image-store.s3.amazonaws.com/0/146457/260632a3-d09d-1ee0-0972-86ba1f40fb13.jpeg \"\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb\")\nCopyright \u24b8 2015- [MiraiTunes](http://mtunes.tumblr.com/), [Kokonotori](http://silver-thorn.jp/bazaar/) and [Minori Fuyuzora](http://yuzutororo.zashiki.com/)\n\n\u3000\u3069\u3053\u304b\u3089\u3069\u3046\u898b\u3066\u3082\u3001\u6700\u8fd1\u6d41\u884c\u308a\u306e\u840c\u3048\u7cfb\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306b\u5909\u308f\u308a\u306a\u304f\u3001\u3057\u304b\u3082\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u672c\u4eba\u304c\u5236\u4f5c\u3057\u305f\u3082\u306e\u3067\u3042\u308b\u3068\u3044\u3046\u306e\u3067\u3059\u304b\u3089\u3001\u3053\u308a\u3083\u4e00\u4f53\u4f55\u304c\u8d77\u3053\u308d\u3046\u3068\u3057\u3066\u3044\u308b\u3093\u3060\u3044\uff1f\u3000\u3068\u3044\u3046\u6c17\u6301\u3061\u306b\u306f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\u305d\u3046\u3067\u3059\u3002\u5ba3\u4f1d\u3067\u3059\u3002\n**\u2026\u2026\u3044\u3084\u3001\u3082\u3061\u308d\u3093\u5618\u3067\u3059\u3051\u3069\u3002**\n\n\u3000\u6ce8\u76ee\u3057\u3066\u3044\u305f\u3060\u304d\u305f\u3044\u306e\u306f\u3001\u7dd1\u5730\u306e\u90e8\u5206\u3001\u30c6\u30ad\u30b9\u30c8\u30a6\u30a4\u30f3\u30c9\u30a6\u3067\u3059\u3002\u3053\u3053\u306e\u30d5\u30a9\u30f3\u30c8\uff01\u3000\u6c17\u4ed8\u304d\u307e\u3057\u305f\u304b\uff1f\u3000Windows\u3067\u306f\u6a19\u6e96\u3067\u5165\u3063\u3066\u3044\u306a\u3044\u3001\u3080\u3057\u308d\u5165\u3063\u3066\u3044\u305f\u3089\u3073\u3063\u304f\u308a\u3068\u3082\u8a00\u3048\u308b\u3001\u6709\u5fd7(fontopo\u69d8)\u306b\u3088\u3063\u3066\u4f5c\u3089\u308c\u305f\u30d5\u30a9\u30f3\u30c8\u300c**[\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2](http://fontopo.com/)**\u300d\u3067\u8868\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3000\u3053\u306e\u30d5\u30a9\u30f3\u30c8\u306f\u67d4\u3089\u304b\u3044\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u304c\u8aad\u307f\u3084\u3059\u304f\u3001\u30d3\u30eb\u30c8\u30a4\u30f3\u306e\u30d5\u30a9\u30f3\u30c8(MS\u30b4\u30b7\u30c3\u30af\u306a\u3069)\u3067\u8868\u793a\u3059\u308b\u306e\u3068\u3001\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u8868\u793a\u3059\u308b\u306e\u3068\u3067\u306f\u5fc3\u7406\u7684\u306b\u3082\u5927\u304d\u306a\u5dee\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u3044\u3053\u3046\u3001\u307c\u304f\u305f\u3061\u306e\u30b4\u30b7\u30c3\u30af2\u3067\u3044\u3053\u3046\u3001\u3068\u8efd\u304f\u601d\u3063\u3066\u3044\u305f\u77e2\u5148\u3001**\u3059\u3050\u3055\u307e\u6280\u8853\u7684\u306a\u5927\u554f\u984c\u306b\u3076\u3061\u5f53\u305f\u308b\u2026\u2026\u3068\u3044\u3046\u304b\u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u3002**\n\n![fontchangeimg.png](https://qiita-image-store.s3.amazonaws.com/0/146457/eba5a957-d1d6-0530-cf6e-df119a2306ff.png)\n_\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3063\u3066\u2026\u2026\u3044\u3044\u3088\u306d_\n\n# \u898b\u77e5\u3089\u306c\u3001API\n\n\u3000**AddFontResource\u3092\u4f7f\u3046\u3088\u3046\u306a\u3001\u5f93\u6765\u306e\u65b9\u6cd5\u3067\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u4f7f\u3048\u307e\u305b\u3093\uff01\uff01**\n\n\u3000\u5f93\u6765\u306eVCL\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3057\u305f\u3089\u3001GDI\u30ad\u30e3\u30f3\u30d0\u30b9\u3067\u306e\u6587\u5b57\u63cf\u753b\u3067\u3042\u308b\u305f\u3081\u306b\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30b3\u30fc\u30c9\u306fAddFontResource/RemoveFontResource\u3092\u8a18\u8ff0\u3057\u3001WM_FONTCHANGE\u3092\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\u3072\u3058\u3087\u3046\u306b\u304a\u624b\u8efd\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u3088\u304f\u8003\u3048\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002FMX\u306fDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u3002VCL\u306eGDI\u30ad\u30e3\u30f3\u30d0\u30b9\u3068\u306f\u8a33\u304c\u9055\u3044\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u4f55\u304c\u9055\u3046\u306e\u304b\u3068\u3044\u3048\u3070\u3001**DirectWrite\u3067\u6587\u5b57\u3092\u63cf\u753b\u3057\u3066\u3044\u308b\u3089\u3057\u3044**\u3068\u3044\u3046\u70b9\u3002\u3046\u308f\u3042\u3042\u8b0e\u6280\u8853\u304d\u305f\u3042\u3042\u3042\uff01\n\n\u3000\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304b\u3089\u3057\u3066\u65e2\u306b\u9055\u3063\u3066\u3044\u308bGDI\u3068Direct2D\u3002Direct2D\u30ad\u30e3\u30f3\u30d0\u30b9\u4e0a\u3067\u306f\u3001GDI\u3067\u6d3b\u7528\u3057\u3066\u3044\u305f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u306e\u30b3\u30fc\u30c9\u3001\u5373\u3061AddFontResource/RemoveFontResource\u306f\u4e00\u5207\u610f\u5473\u3092\u70ba\u3057\u307e\u305b\u3093\u3002\u3044\u3084\u3001\u6b63\u78ba\u306b\u306f**\u300c\u30d5\u30a9\u30f3\u30c8\u306e\u4e00\u89a7\u300d\u306b\u306f\u53cd\u6620\u3055\u308c\u308b\u306e\u306b\u5b9f\u969b\u306b\u306f\u63cf\u753b\u3067\u304d\u306a\u3044**\u3068\u3044\u3046\u6700\u5f37\u306b\u30cd\u30ac\u30c6\u30a3\u30f4\u3067\u8a33\u306e\u5206\u304b\u3089\u306a\u3044\u610f\u5473\u3092\u6b8b\u3057\u3066\u3044\u304f\u7d50\u679c\u304c\u5f85\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3055\u3089\u306b\u5384\u4ecb\u306a\u306e\u306f\u3001FMX\u306eDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306a\u8a2d\u8a08\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3059[^1]\u3002\u4e07\u4e8b\u4f11\u3059\u304b\u2026\u2026\uff01\uff1f\u3000\u52a9\u3051\u3066\u30de\u30a4\u30af\u30ed\u30bd\u30d5\u30c8\uff01\u3000\u4f53\u9a13\u7248\u30ea\u30ea\u30fc\u30b9\u306b\u9593\u306b\u5408\u308f\u306a\u3044\u3088\uff01[^2]\n[^1]: \u5c11\u306a\u304f\u3068\u3082XE6\u3067\u306f\u30c0\u30e1\u3002\u305d\u308c\u4ee5\u964d\u306f\u77e5\u3089\u3093\u3002\n[^2]: \u304a\u304b\u3052\u3055\u307e\u3067\u6628\u5e74\u51ac\u3001\u9593\u306b\u5408\u3044\u307e\u3057\u305f\u3002\n\n# \u3068\u3044\u3046\u3053\u3068\u3067\n\n\u3000\u624b\u6bb5\u306f\u9078\u3070\u306a\u3044\u3002FMX\u30bd\u30fc\u30b9\u6539\u9020\u3082\u8f9e\u3055\u306a\u3044\u3002\u4f5c\u54c1\u306e\u305f\u3081\u306b\uff01\u3000\u30d5\u30a9\u30f3\u30c8\u306e\u305f\u3081\u306b\uff01\n\n# \u3053\u3053\u307e\u3067\u306e\u307e\u3068\u3081\u3068\u88dc\u8db3\n- \u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u7d44\u307f\u8fbc\u3080\u306e\u304c\u76ee\u7684\u3002\n- \u4e0a\u8a18\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u3082\u5f53\u7136Delphi(Firemonkey, FMX)\u88fd\u3002\u672c\u4f53\u306b\u3064\u3044\u3066\u306f\u307e\u305f\u306e\u6a5f\u4f1a\u306b\u3002\n- \u3068\u3053\u308d\u304cFMX\u3067\u306f\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u5229\u7528\u3067\u304d\u306a\u3044\uff1f\u3000\u3067\u304d\u308b\u3068\u3044\u3046\u5642\u3082\uff1f\n- \u958b\u767a\u74b0\u5883\u306f Windows7/10 Pro 64bit, AMD Radeon R7 240, \u8a33\u3042\u3063\u3066 **Delphi XE6**\n\n# \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u5b9f\u88c5\u306b\u95a2\u3059\u308b\u6982\u8981\n- FMX\u306eDirect2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306b\u304a\u3044\u3066\u3001FontCollection\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3067\u5f15\u304d\u51fa\u3059\n- \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30ed\u30fc\u30c0\u30fc\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\n- \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8d77\u52d5\u6642\u306b\u65b0\u898f\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u751f\u6210\u3002\n- \u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3068\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304b\u3089\u30d5\u30a9\u30f3\u30c8\u3092\u53d6\u308a\u51fa\u3057\u3066\u65b0\u305f\u306b\u767b\u9332\u3057\u3066\u3044\u304f\n- \u5f15\u304d\u51fa\u3057\u3066\u304a\u3044\u305fFontCollection\u306b\u3001\u65b0\u3057\u304f\u4f5c\u3063\u305f\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5dee\u3057\u8fbc\u307f\u3002\n- \u30d5\u30a9\u30f3\u30c8\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308b\uff01\n\n\u3000\u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u5b9a\u7fa9\u3059\u308bFMX.Canvas.D2D.pas\u3001\u305d\u306e\u4e2d\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\u6587\u5b57\u63cf\u753b\u95a2\u9023\u306eDirectWrite API\u306b\u306f\u3001**\u5b9f\u306f\u63cf\u753b\u306b\u4f7f\u7528\u3059\u308b\u30d5\u30a9\u30f3\u30c8\u3092\u6e21\u3059\u305f\u3081\u306eIDWriteFontCollection\u578b\u306e\u5f15\u6570**\u304c\u3042\u308a\u307e\u3059\u3002nil\u3092\u6307\u5b9a\u3059\u308b\u3068\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u5168\u3066\u304c\u5bfe\u8c61\u306b\u306a\u308a\u307e\u3059\u3002\u3068\u306b\u3082\u304b\u304f\u306b\u3082\u3001\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308bnil\u3092\u53d6\u3063\u6255\u3063\u3066\u3001\u4efb\u610f\u306e\u30d5\u30a9\u30f3\u30c8\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u3002\u30ad\u30e3\u30f3\u30d0\u30b9\u81ea\u4f53\u306f implementation \u4ee5\u4e0b\u3067\u96a0\u3055\u308c\u3066\u3057\u307e\u3063\u3066\u304a\u308a\u3001\u8272\u3005\u9762\u5012\u306a\u72b6\u6cc1\u3067\u3059\u3002\n\n# \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u57fa\u790e\u77e5\u8b58\n\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001Direct2D\u30ad\u30e3\u30f3\u30d0\u30b9\u306b\u304a\u3044\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u6271\u3044\u305f\u3044\u3068\u304d\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306a\u3069\u3092\u7d39\u4ecb\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n## IDWriteFactory\nFactory\u3068\u540d\u306e\u4ed8\u304f\u901a\u308a\u3001DirectWrite\u95a2\u4fc2\u306e\u5143\u7de0\u3081\u3002\u8272\u3005\u53d6\u308c\u308b\u3002\n\u5143\u7de0\u3081\u306a\u306e\u3067\u5927\u91cf\u306b\u4f5c\u308b\u30bf\u30a4\u30d7\u306e\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4f7f\u3044\u7d42\u308f\u3063\u305f\u3089nil\u3067\u3055\u3088\u306a\u3089\u3092\u3057\u307e\u3057\u3087\u3046\u3002\n\n## IDWriteFontFile\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5b9f\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\n## IDWriteFontFileEnumerator\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5217\u6319\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002\u4e3b\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u3067\u3001\u5b9f\u969b\u306b\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u3001\u4f7f\u3048\u308b\u30d5\u30a9\u30f3\u30c8\u306e\u4e00\u89a7\u3092\u6559\u3048\u3066\u3042\u3052\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n## IDWriteFont\n\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306e\u5b9f\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\n## IDWriteFontFamily\n\u30d5\u30a9\u30f3\u30c8\u306b\u542b\u307e\u308c\u308b\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3002Regular\u3068\u304bBold\u3068\u304b\u3002\n\n## IDWriteFontFace\n\u30d5\u30a9\u30f3\u30c8\u306b\u542b\u307e\u308c\u308b\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u306e\u7dcf\u4f53(\u3068\u3044\u3046\u30a4\u30e1\u30fc\u30b8)\u3002\n\n## IDWriteFontCollection\n\u30d5\u30a9\u30f3\u30c8\u306e\u5bc4\u305b\u96c6\u3081\u3002\u30b7\u30b9\u30c6\u30e0\u306b\u3042\u308b\u30d5\u30a9\u30f3\u30c8\u3092\u96c6\u3081\u305f\u3082\u306e(\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6)\u306fIDWriteFactory\u304b\u3089\u53d6\u3063\u3066\u3053\u308c\u305f\u308a\u3059\u308b\u3002\n\u30ab\u30b9\u30bf\u30e0\u306a\u5bc4\u305b\u96c6\u3081\u306f\u3001\u5f8c\u8ff0\u306e IDWriteFontCollectionLoader \u3092\u7d4c\u7531\u3057\u3066\u4e00\u6c17\u306b\u4f5c\u308a\u4e0a\u3052\u308b\u3002\n**\u4f5c\u308a\u4e0a\u3052\u305f\u3089\u6700\u5f8c\u3001\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0/\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002**\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u306b\u3082\u540c\u3058\u304f\u3001\u5f8c\u304b\u3089IDWriteFontFile\u3092\u8ffd\u52a0\u3057\u305f\u308a\u3067\u304d\u306a\u3044\u3002\n\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u4eba\u516c\u7684\u5b58\u5728\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u3068\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u542b\u3093\u3060IDWriteFontCollection\u3092\u4f5c\u3063\u3066\u3001\u4f8b\u306enil\u306e\u5834\u6240\u306b\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u30b4\u30fc\u30eb\u3068\u306a\u308b\u3002\n\n## IDWriteFontCollectionLoader\nDirectWrite\u304c\u30d5\u30a9\u30f3\u30c8\u96c6(IDWriteFontCollection)\u3092\u4f5c\u308b\u3068\u304d\u3001\u30d5\u30a9\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u6e90\u6cc9\u3068\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3002\u4e3b\u306b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u3067\u3001\u5b9f\u969b\u306b\u306f\u3053\u308c\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30ed\u30fc\u30ab\u30eb\u30c7\u30a3\u30b9\u30af\u3060\u3051\u3067\u306a\u304f\u3001\u30ea\u30bd\u30fc\u30b9\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304b\u3089\u306eLoader\u3084Enum\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308c\u3070\u3001\u3042\u308b\u610f\u5473\u3067\u306f\u8d85\u5909\u614b\u7684\u306aIDWriteFontCollection\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\n# \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u88c5\u3057\u3088\u3046\uff01\n\n \u3068\u3044\u3046\u8a33\u3067\u3001\u9b54\u6539\u9020\u3092\u65bd\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\u4e0a\u8a18\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306f\u81ea\u4f5c\u306eFMX\u88fd\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u306a\u306e\u306f\u65e2\u306b\u8ff0\u3079\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u7406\u7531\u306f\u3084\u306f\u308a\u30af\u30ed\u30b9\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5bfe\u5fdc\u3068\u3001\u9ad8\u3044\u62e1\u5f35\u6027\u3092\u72d9\u3063\u3066\u306e\u3053\u3068\u3002\u6562\u3048\u3066\u65e2\u88fd\u54c1\u3092\u4f7f\u308f\u305a\u306b\u307e\u3055\u306b1\u304b\u3089\u5236\u4f5c\u3059\u308b\u7121\u8336\u30d7\u30e9\u30f3\u3092\u3076\u3061\u4e0a\u3052\u3066\u304a\u308a\u307e\u3057\u305f\u304c\u3001\u307e\u3055\u304b\u3053\u3093\u306a\u3068\u3053\u308d\u3067\u8e93\u304f\u306a\u3093\u3066\u601d\u3063\u3066\u3082\u307f\u306a\u304b\u3063\u305f\u308f\u3051\u3067\u3059\u3002\n\n## STEP1. FontCollection\u3092\u5f15\u304d\u51fa\u3059\n\u3053\u3053\u304b\u3089\u306f\u3001\u4e00\u90e8\u3001FMX\u306e\u30bd\u30fc\u30b9\u3092\u89e6\u308a\u307e\u3059\u3002\u8a66\u3057\u3066\u307f\u305f\u3044\u65b9\u306f\u3001\u5fc5\u305a\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u53d6\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\ni. \u304a\u3082\u3080\u308d\u306b FMX.Canvas.D2D.pas \u3092\u958b\u304d\u3001implementation\u7bc0\u306e\u524d\u306b\u6b21\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```Delphi:FMX.Canvas.D2D.After.pas\nvar\n  FontCollection: IUnknown = nil; // Added\n```\n\nii. \u3059\u3079\u3066\u306e DWriteFactory.CreateTextFormat \u306b\u5bfe\u3057\u3066\u3001FontCollection \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```Delphi:FMX.Canvas.D2D.Before.pas\n  DWriteFactory.CreateTextFormat(PChar(WS), nil, D2FontWeight(FFont.Style), D2FontStyle(FFont.Style),\n    DWRITE_FONT_STRETCH_NORMAL, FFont.Size, PChar(FLocaleName), TextFormat);\n  if TFillTextFlag.RightToLeft in Flags then\n    TextFormat.SetReadingDirection(DWRITE_READING_DIRECTION_RIGHT_TO_LEFT);\n\n  ...\n\n  if Succeeded(TCanvasD2D.DWriteFactory.CreateTextFormat(\n       PChar(Font.Family),\n       nil,\n       D2FontWeight(Font.Style),\n       D2FontStyle(Font.Style),\n       DWRITE_FONT_STRETCH_NORMAL,\n       Font.Size,\n       PChar(LocaleName),\n       TextFormat)) then\n\n\n```\n\n```Delphi:FMX.Canvas.D2D.After.pas\n  DWriteFactory.CreateTextFormat(PChar(WS), IDWriteFontCollection(FontCollection), D2FontWeight(FFont.Style), D2FontStyle(FFont.Style),\n    DWRITE_FONT_STRETCH_NORMAL, FFont.Size, PChar(FLocaleName), TextFormat);\n  if TFillTextFlag.RightToLeft in Flags then\n    TextFormat.SetReadingDirection(DWRITE_READING_DIRECTION_RIGHT_TO_LEFT);\n\n  ...\n\n  if Succeeded(TCanvasD2D.DWriteFactory.CreateTextFormat(\n       PChar(Font.Family),\n       IDWriteFontCollection(FontCollection),\n       D2FontWeight(Font.Style),\n       D2FontStyle(Font.Style),\n       DWRITE_FONT_STRETCH_NORMAL,\n       Font.Size,\n       PChar(LocaleName),\n       TextFormat)) then\n```\n\u3068\u308a\u3042\u3048\u305a\u3001\u3053\u308c\u3067\u597d\u304d\u306aFontCollection\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u306eFontCollection\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u304d\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u3002\u30b5\u30d6\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u3084\u308b\u3068\u304d\u306f\u3001Synchronize\u306a\u3069\u3092\u901a\u3057\u3066\u66f8\u304d\u63db\u3048\u307e\u3057\u3087\u3046\u3002FMX\u306e\u63cf\u753b\u51e6\u7406\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u305f\u3076\u3093\u3002\n\n## STEP2. \u5fc5\u8981\u306a\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\nIDWriteFontCollectionLoader, IDWriteFontFileEnumerator \u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\u3056\u3063\u304f\u308a\u8aac\u660e\u3059\u308b\u3068\u300c\u4ffa(DirectWrite)\u306f\u304a\u524d\u306e\u7528\u610f\u3057\u305f\u30af\u30e9\u30b9\u3092\u901a\u3058\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5217\u6319\u3057\u305f\u308a\u8aad\u307f\u53d6\u3063\u305f\u308a\u3059\u308b\u304b\u3089\u3001\u5f8c\u306f\u3088\u308d\u3057\u304f\u3074\u3087\u3093\u300d\u2026\u2026\u3057\u3083\u30fc\u306d\u3048\u306a\u3042\u3001\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\nTCustomFontRegister \u306f\u5358\u306a\u308b\u4fbf\u5229\u30af\u30e9\u30b9\u3067\u3059\u3002\u4eba\u306b\u3088\u3063\u3066\u306f\u5fc5\u8981\u306a\u3044\u306e\u304b\u3082\u3002\nTCustomFontRegister \u3092Create\u3057\u305f\u6642\u70b9\u3067\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5229\u7528\u53ef\u80fd\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u4ee3\u7269\u3067\u3059\u3002\n\n```Delphi:Utils.pas\ntype\n  TCustomFontRegister = class\n  private\n      FFontFiles : TStrings;\n      FOnRegistered : TSimpleNotify;\n      FRegisterThread : TThread;\n      FRegisterSuccessed : Boolean;\n      FRegistered : Boolean;\n      {$IFDEF MSWINDOWS}\n      CL : Array [1..2] of IDWriteFontCollectionLoader;\n      DFC : Array [1..2] of IDWriteFontCollection;\n      {$ENDIF}\n      procedure registring(AForm:TForm=nil);\n      procedure unregistring();\n  public\n      constructor Create(AFontPaths:Array of String; Relative:Boolean=True; Finish:TSimpleNotify=nil);\n      destructor Destroy; override;\n      procedure ManualRegister(AForm:TForm=nil);\n      procedure ManualUnRegister();\n      property RegisterSuccessed:Boolean read FRegisterSuccessed;\n      property Registered:Boolean read FRegistered write FRegistered;\n      property RegisterThread:TThread read FRegisterThread;\n      property OnRegistered:TSimpleNotify read FOnRegistered write FOnRegistered;\n  end;\n\n{$IFDEF MSWINDOWS}\n\n  TCustomFontLoader = class(TInterfacedObject,IDWriteFontCollectionLoader)\n      FFontDB : TList<IDWriteFontFile>;\n      FCollectionkey : Pointer;\n      FEnum : IDWriteFontFileEnumerator;\n      procedure AddFont(AFont:IDWriteFontFile);\n      function CreateEnumeratorFromKey(const factory: IDWriteFactory; const collectionKey: Pointer; collectionKeySize: Cardinal; out fontFileEnumerator: IDWriteFontFileEnumerator): HResult; stdcall;\n      constructor Create();\n      destructor Destroy; override;\n  end;\n\n  TCustomFontEnumerator = class(TInterfacedObject,IDWriteFontFileEnumerator)\n      FParent : IDWriteFontCollectionLoader;\n      i : Integer;\n      function MoveNext(var hasCurrentFile: BOOL): HResult; stdcall;\n      function GetCurrentFontFile(out fontFile: IDWriteFontFile): HResult; stdcall;\n      constructor Create(AParent:IDWriteFontCollectionLoader);\n      destructor Destroy; override;\n  end;\n{$ENDIF}\n```\n\n\u3055\u3066\u3001\u809d\u5fc3\u8981\u306e\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u8aad\u307f\u8fbc\u307f\u30af\u30e9\u30b9\u3068\u304b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u5217\u6319\u30af\u30e9\u30b9\u3092\u6b21\u306b\u793a\u3057\u307e\u3059\u3002\n\u3053\u308c\u304c\u7121\u3044\u3068\u59cb\u307e\u308b\u3082\u306e\u3082\u59cb\u307e\u3089\u306a\u3044\u3067\u3059\u304b\u3089\u306d\uff01\n\n```Delphi:Utils.pas\n{$IFDEF MSWINDOWS}\n(* TCustomFontLoader *)\nconstructor TCustomFontLoader.Create();\nbegin\n      inherited Create;\n      FFontDB := TList<IDWriteFontFile>.Create;\nend;\n\ndestructor TCustomFontLoader.Destroy;\nvar\n      i : Integer;\nbegin\n      for i := 0 to FFontDB.Count-1 do FFontDB[i] := nil;\n      FEnum := nil;\n      FFontDB.Free;\n\n      inherited;\nend;\n\nprocedure TCustomFontLoader.AddFont(AFont:IDWriteFontFile);\nbegin\n      FFontDB.Add(AFont);\nend;\n\nfunction TCustomFontLoader.CreateEnumeratorFromKey(const factory: IDWriteFactory;\nconst collectionKey: Pointer; collectionKeySize: Cardinal;\nout fontFileEnumerator: IDWriteFontFileEnumerator): HResult;\nbegin\n      FEnum := IDWriteFontFileEnumerator(TCustomFontEnumerator.Create(Self));\n      fontFileEnumerator := FEnum;\n      FCollectionkey := collectionKey;\n      RESULT := S_OK;\nend;\n\n(* TCustomFontEnumerator *)\nfunction TCustomFontEnumerator.MoveNext(var hasCurrentFile: BOOL): HResult;\nbegin\n      Inc(i);\n      hasCurrentFile := i < (FParent as TCustomFontLoader).FFontDB.Count;\n      RESULT := S_OK;\nend;\n\nfunction TCustomFontEnumerator.GetCurrentFontFile(out fontFile: IDWriteFontFile): HResult;\nbegin\n      fontFile := (FParent as TCustomFontLoader).FFontDB[i];\n      RESULT := S_OK;\nend;\n\nconstructor TCustomFontEnumerator.Create(AParent:IDWriteFontCollectionLoader);\nbegin\n      inherited Create;\n\n      FParent := AParent;\n      i := -1;\nend;\n\ndestructor TCustomFontEnumerator.Destroy;\nbegin\n      inherited;\nend;\n```\n\u7279\u7b46\u3059\u3079\u304d\u30dd\u30a4\u30f3\u30c8\u306f\u7279\u306b\u3042\u308a\u307e\u305b\u3093\u304c\u3001\n\n- TCustomFontLoader.AddFont\u3067\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b[^4]\u3057\u3066\u304a\u304d(\u5185\u90e8\u306e\u30ea\u30b9\u30c8\u306bTList\\<IDWriteFontFile\\>\u3092\u63a1\u7528)\n- DirectWrite\u304c\u30d5\u30a9\u30f3\u30c8\u3092\u5217\u6319\u3057\u306b\u6765\u305f\u3068\u304d\u306fMoveNext\u3067\u300c\u307e\u3060\u3042\u308b\u3067\u300d\u300c\u3082\u3046\u306a\u3044\u3067\u300d\u3068\u6559\u3048\u3066\u3084\u308a\n- DirectWrite\u304c\u300c\u3053\u308c\u6b32\u3057\u3044\uff01\u300d\u3068\u3044\u3063\u305f\u3068\u304d\u306fGetCurrentFontFile\u306b\u3066\u30d5\u30a9\u30f3\u30c8\u3092\u6e21\u3057\u3066\u3042\u3052\u308b\n\n\u3053\u306e\u4e09\u70b9\u30bb\u30c3\u30c8\u304c\u4e3b\u306a\u6d41\u308c\u3067\u3059\u3002\n\n[^4]: IDWriteFontFile \u81ea\u4f53\u306f IDWriteFactory.CreateFontFileReference \u3067\u304a\u624b\u8efd\u306b\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3000\u3057\u304b\u3057\u3001\u5f15\u6570\u3092\u898b\u308b\u3068\u5206\u304b\u308b\u901a\u308aGetCurrentFontFile\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u6765\u3066\u3082\u300c\u6b32\u3057\u3044\u306e\u3069\u306e\u30d5\u30a9\u30f3\u30c8\u3084\uff01\u300d(\u5206\u304b\u3089\u3093)\u3068\u4e00\u77ac\u601d\u3046\u308f\u3051\u3067\u3059\u304c\u3001\u5b9f\u306fMoveNext\u3068\u52d5\u4f5c\u304c\u30bb\u30c3\u30c8\u306a\u306e\u3067\u3001\u3053\u3053\u307e\u3067\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u305e\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u30af\u30e9\u30b9\u5074\u3067\u899a\u3048\u3066\u304a\u3051\u3070\u3001\u300c\u3053\u308c\u6b32\u3057\u3044\uff01\u300d\u3068\u8a00\u308f\u308c\u305f\u3068\u304d\u306b\u300c\u3042\u3042\u3001i\u756a\u76ee\u306e\u3084\u3064\u3067\u3059\u306d\u3001\u306f\u3044\u3069\u3046\u305e\u300d\u3068\u6e21\u305b\u308b\u308f\u3051\u3067\u3059\u3002\n\n\n\u3055\u3066\u3001\u6b21\u306f\u4fbf\u5229\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u90e8\u3067\u3059\u3002\u307b\u307c\u81ea\u5206\u7528\u304b\u3064\u3001\u30af\u30bd\u9577\u3044\u306e\u3067\u5fc5\u8981\u306a\u3051\u308c\u3070\u9069\u5b9c\u30b9\u30eb\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3060\u3057\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3059\u308b\u30b3\u30fc\u30c9\u3092registering\u95a2\u6570\u306b\u8a18\u8ff0\u3057\u3066\u3044\u308b\u3053\u3068\u3060\u3051\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```Delphi:Utils.pas\nconstructor TCustomFontRegister.Create(AFontPaths:Array of String; Relative:Boolean=True; Finish:TSimpleNotify=nil);\nvar\n      i : Integer;\n      rp : String;\nbegin\n      inherited Create;\n      FFontFiles := TStringList.Create;\n\n      FOnRegistered := Finish;\n\n      rp := '';\n      if Relative then rp := IncludeTrailingPathDelimiter(ExtractFileDir(ParamStr(0)));\n\n      for i := 0 to High(AFontPaths) do FFontFiles.Add(rp+AFontPaths[i]);\n      if FFontFiles.Count > 0 then registring();\nend;\n\ndestructor TCustomFontRegister.Destroy;\nbegin\n      unregistring();\n      FFontFiles.Free;\n      inherited;\nend;\n\nprocedure TCustomFontRegister.unregistring();\n{$IFDEF MACOS}\nbegin\n      FRegistered := False;\nend;\n{$ELSEIF Defined(MSWINDOWS)}\nvar\n      i : Integer;\n      DF : IDWriteFactory;\nbegin\n      if FRegistered then\n      begin\n            // for DirectWrite\n            if GlobalUseDirect2D and (GlobalVersionWin.dwMajorVersion >= 6) then\n            begin\n                  DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n                  try\n                        DF.UnregisterFontCollectionLoader(CL[2]);\n                        Fmx.Canvas.D2D.FontCollection := nil;\n                  finally\n                        DF := nil; DFC[2] := nil;\n                  end;\n            // for GDI\n            end else\n            begin\n                  for i := 0 to FFontFiles.Count-1 do\n                  begin\n                        if FileExists(FFontFiles[i])  then\n                        begin\n                              RemoveFontResourceEx(PWideChar(FFontFiles[i]),FR_PRIVATE,nil);\n                        end;\n                  end;\n\n                  SendMessage(HWND_BROADCAST, WM_FONTCHANGE, 0, 0);\n            end;\n      end;\n\n      FRegistered := False;\nend;\n{$ENDIF}\n\nprocedure TCustomFontRegister.ManualRegister(AForm:TForm=nil);\nbegin\n      registring(AForm);\nend;\n\nprocedure TCustomFontRegister.ManualUnRegister();\nbegin\n      unregistring();\nend;\n\nprocedure TCustomFontRegister.registring(AForm:TForm=nil);\n{$IFDEF MACOS}\nbegin\n      if Assigned(FOnRegistered) then FOnRegistered(Self);\nend;\n{$ELSEIF Defined(MSWINDOWS)}\n\n    procedure MethRefToMethPtr(const MethRef; var MethPtr);\n    type\n        TVtable = array [0 .. 3] of Pointer;\n        PVtable = ^TVtable;\n        PPVtable = ^PVtable;\n    begin\n        TMethod(MethPtr).Code := PPVtable(MethRef)^^[3];\n        TMethod(MethPtr).Data := Pointer(MethRef);\n    end;\n\n    function MakeNotify(const Proc: TNotifyEventProc): TNotifyEvent;\n    begin\n        MethRefToMethPtr(Proc, Result);\n    end;\n\nbegin\n      FRegisterSuccessed := False;\n      FRegistered := False;\n\n      FRegisterThread := TThread.CreateAnonymousThread(\n      procedure\n      var\n            i,j,k,n : Integer;\n            m : Cardinal;\n            DF : IDWriteFactory;\n            SYS : IDWriteFontCollection;\n            hr : HRESULT;\n            wff : IDWriteFontFile;\n            pwff : Array [0..16] of IDWriteFontFile;\n            Dff : IDWriteFontFace;\n            wf : IDWriteFont;\n            CK : Pointer;\n            FM : IDWriteFontFamily;\n            FMN : IDWriteLocalizedStrings;\n            FontName : Array [0..1024] of WideChar;\n            GDIFont : TMemoryStream;\n            exists : LongBool;\n            BOOT_LIST : TStringList;\n      begin\n\n      try\n\n      // for DirectWrite\n      if GlobalUseDirect2D and (GlobalVersionWin.dwMajorVersion >= 6) then\n      begin\n            DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n            try\n                  BOOT_LIST := TStringList.Create;\n                  CL[1] := TCustomFontLoader.Create();\n                  CL[2] := TCustomFontLoader.Create();\n\n                  with Boot_list do\n                  begin\n                        Add('MS Gothic');\n                        Add('MS PGothic');\n                        Add('MS UI Gothic');\n                        Add('MS Mincho');\n                        Add('MS PMincho');\n                        Add('Meiryo');\n                        Add('Meiryo UI');\n                        Add('Segoe UI');\n                        Add('Yu Gothic');\n                        Add('Yu Gothic UI');\n                        Add('Georgia');\n                        Add('Courier New');\n                        Add('Arial');\n                        Add('Times New Roman');\n                  end;\n\n                  for i := 0 to FFontFiles.Count-1 do\n                  begin\n                        if FileExists(FFontFiles[i]) and SUCCEEDED(DF.CreateFontFileReference(PWideChar(FFontFiles[i]),nil,wff)) then\n                        begin\n                              for n := 1 to 2 do (CL[n] as TCustomFontLoader).AddFont(wff);\n                        end;\n                  end;\n\n                  DF.GetSystemFontCollection(SYS,False);\n\n                  // 2\u30b9\u30ad\u30e3\u30f3\u5b9f\u65bd\n                  for n := 1 to 2 do\n                  begin\n                        if SUCCEEDED(DF.RegisterFontCollectionLoader(CL[n])) then\n                        begin\n                              try\n                                    for i := 0 to SYS.GetFontFamilyCount-1 do\n                                    begin\n                                          if SUCCEEDED(SYS.GetFontFamily(i,FM)) then\n                                          begin\n                                                // minimum filter (1 of 2 only)\n                                                if (n = 1) then\n                                                begin\n                                                      FM.GetFamilyNames(FMN);\n\n                                                      if SUCCEEDED(FMN.GetString(0,@FontName[0],1023)) then\n                                                      begin\n                                                            if Boot_list.IndexOf(StrPas(PWideChar(@FontName[0]))) < 0 then\n                                                            begin\n                                                                  Continue;\n                                                            end;\n                                                      end;\n                                                end;\n\n                                                exists := True;\n                                                if (exists) then\n                                                begin\n                                                      for j := 0 to FM.GetFontCount-1 do\n                                                      begin\n                                                            FM.GetFont(j,wf);\n                                                            wf.CreateFontFace(Dff);\n\n                                                            Dff.GetFiles(m,nil);\n                                                            Dff.GetFiles(m,@pwff[0]);\n\n                                                            for k := 0 to m-1 do\n                                                            begin\n                                                                  if pwff[k] <> nil then (CL[n] as TCustomFontLoader).AddFont(pwff[k]);\n                                                            end;\n\n                                                      end;\n                                                end;\n                                          end;\n\n                                    end;\n\n                                    CK := Pointer(1024*n);\n                                    hr := DF.CreateCustomFontCollection(CL[n],@CK,sizeof(Pointer),DFC[n]);\n\n                                    TThread.Synchronize(TThread.CurrentThread,procedure()\n                                    begin\n                                          Fmx.Canvas.D2D.FontCollection := DFC[n];\n                                    end);\n\n                                    if ForceTerminate then break;\n\n                              except\n\n                              end;\n                        end;\n                  end;\n            finally\n                  DF.UnregisterFontCollectionLoader(CL[1]);\n                  DF := nil;\n                  DFC[1] := nil;\n                  SYS := nil; wf := nil; wff := nil; Dff := nil; FM := nil;\n                  for i := Low(pwff) to High(pwff) do pwff[i] := nil;\n                  BOOT_LIST.Free;\n            end;\n\n      // for GDI\n      end else\n      begin\n            if CompareText(TCanvasManager.DefaultCanvas.ClassName,'TCanvasGdiPlus') <> 0 then exit;\n\n            for i := 0 to FFontFiles.Count-1 do\n            begin\n                  if FileExists(FFontFiles[i]) and (LowerCase(ExtractFileExt(FFontFiles[i])) = '.ttf') then\n                  begin\n                        if AForm <> nil then\n                        begin\n                              GDIFont := TMemoryStream.Create;\n                              try\n                                    GDIFont.LoadFromFile(FFontFiles[i]); GDIFont.Seek(0,0);\n                                    AForm.Canvas.LoadFontFromStream(GDIFont);\n                              finally\n                                    GDIFont.Free;\n                              end;\n                        end;\n\n                        if (AForm = nil) then AddFontResourceEx(PWideChar(FFontFiles[i]),FR_PRIVATE,nil);\n                  end;\n            end;\n\n            if (AForm = nil) then SendMessage(HWND_BROADCAST, WM_FONTCHANGE, 0, 0);\n      end;\n\n      except\n      end;\n\n      end);\n\n      with FRegisterThread do\n      begin\n            OnTerminate := MakeNotify(\n                procedure(Sender: TObject)\n                begin\n                      FRegisterSuccessed := True;\n                      FRegistered := True;\n                      FRegisterThread := nil;\n                      if Assigned(FOnRegistered) then FOnRegistered(Sender);\n                end);\n\n            FreeOnTerminate := True;\n            Start;\n      end;\n\nend;\n{$ENDIF}\n```\n\n\u9577\u3005\u3068\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\u5b9f\u306f\u3053\u306e\u4fbf\u5229\u30af\u30e9\u30b9\u306e\u4e2d\u306b\u3001\u5c0f\u6280\u3068\u554f\u984c\u304c\u3051\u3063\u3053\u3046\u6df7\u3056\u3063\u3066\u3044\u307e\u3059\u3002\u3044\u304f\u3064\u304b\u7d39\u4ecb\u3057\u307e\u3057\u3087\u3046\u3002\n\n### \u3053\u3063\u305d\u308aGDI\u5bfe\u5fdc\u30b3\u30fc\u30c9\u304c\u6df7\u305c\u3066\u3042\u308b\n\nregistring() \u3084 unregistring() \u3067\u306f\u3001\u3053\u3063\u305d\u308a\u3001GDI\u7528\u306e\u3001\u3044\u308f\u3086\u308b\u5f93\u6765\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u7528\u30b3\u30fc\u30c9\u304c\u5165\u308c\u3066\u3042\u308a\u307e\u3059\u3002XP\u4ee5\u524d\u3067\u306fDirectWrite\u304c\u4f7f\u3048\u307e\u305b\u3093\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308bGDI+\u306e\u305f\u3081\u306b\u7528\u610f\u3057\u307e\u3057\u305f\u3002\u3067\u3082\u3053\u308c\u3001\u5b9f\u969b\u306bGDI+\u30ad\u30e3\u30f3\u30d0\u30b9\u3067\u306f\u4f7f\u3048\u306a\u304b\u3063\u305f\u3088\u3046\u306a\u6c17\u304c\u3057\u306a\u3044\u3067\u3082\u306a\u3044\u2026\u2026\uff1f\u3000\u306a\u304aWindows\u306eFMX\u3067\u306f\u57fa\u672c\u7684\u306bDirect2D\u304bGDI+\u3067\u3001GDI\u306f\u4f7f\u308f\u308c\u307e\u305b\u3093\u3002\n\n### \u3053\u3063\u305d\u308aWindows/macOS\u5bfe\u5fdc\u30d7\u30ea\u30d7\u30ed\u30bb\u30c3\u30b5\u304c\u6df7\u305c\u3066\u3042\u308b\n\nmacOS\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u3001app\u5185\u306b\u30d5\u30a9\u30f3\u30c8\u3092\u914d\u7f6e\u3059\u308b\u3060\u3051\u3067\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u3053\u306e\u30af\u30e9\u30b9\u81ea\u4f53\u304c\u4e0d\u8981\u3067\u3059\u3002\n\u30e1\u30a4\u30f3\u30e6\u30cb\u30c3\u30c8\u5074\u3067\u300cmacOS\u306e\u5834\u5408\u306f\u30af\u30e9\u30b9\u3092\u4f5c\u3089\u306a\u3044\u300d\u3092\u3084\u3063\u3066\u3082\u826f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u30af\u30e9\u30b9\u5185\u90e8\u3067\u5207\u308a\u5206\u3051\u3066\u3044\u307e\u3059\u3002\n\n### \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u767b\u9332\u51e6\u7406\n\nregistring()\u5185\u306f\u30b9\u30d1\u30b2\u30c6\u30a3\u30b3\u30fc\u30c9\u306a\u3089\u306c\u3001\u3046\u3069\u3093\u30b3\u30fc\u30c9\u3068\u3044\u3046\u304b\u304d\u3057\u3081\u3093\u30b3\u30fc\u30c9\u3068\u3044\u3046\u304b\u3001\u7f8e\u5473\u3057\u3044\u3093\u3060\u3051\u3069\u305f\u3076\u3093\u305d\u308c\u79d8\u4f1d\u306e\u30bf\u30ec\u306e\u305b\u3044\u306e\u3058\u3083\u306a\u3044\u304b\u3044\uff1f\u3000\u307f\u305f\u3044\u306a\u89e3\u8aad\u306e\u3057\u3065\u3089\u3055\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u7533\u3057\u8a33\u306a\u3044\u3002\n\n\u57fa\u672c\u7684\u306a\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n\n- \u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u3078\u76f4\u63a5\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3067\u304d\u305f\u3089\u6700\u9ad8\u3060\u3051\u3069\u51fa\u6765\u306a\u3044\u306e\u3067\u3001\u4e00\u5de5\u592b\n- \u5148\u307b\u3069\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u30ed\u30fc\u30c0\u30fc\u3067\u597d\u304d\u306a\u30d5\u30a9\u30f3\u30c8\u3092\u8aad\u307f\u8fbc\u3093\u3067GO! \u2192 \u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u5165\u308b\u3051\u3069\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u304c\u5168\u90e8\u4f7f\u3048\u306a\u3044\n- \u305d\u3053\u3067\u3001\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306b\u52a0\u3048\u3066\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u3082\u8ffd\u52a0\u3002\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u8ffd\u52a0\u306e\u969b\u306f\u3001\u4e88\u3081\u53d6\u5f97\u3067\u304d\u308b\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u96c6\u304b\u3089\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30df\u30ea\u30fc\u306a\u3069\u3092\u8fbf\u3063\u3066\u3044\u304d\u3001\u6700\u7d42\u7684\u306b\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5b9f\u4f53(\u306e\u3088\u3046\u306a\u3082\u306e)\u3001IDWriteFontFile\u3092\u30b2\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n- \u3053\u308c\u3067OK\uff01\n\n### \u3068\u3066\u3082\u9045\u3044\n\n\u5b9f\u88c5\u3067\u304d\u305f\u3053\u3068\u306f\u826f\u3044\u3082\u306e\u306e\u3001\u524d\u8ff0\u306e\u300c\u57fa\u672c\u7684\u306a\u6d41\u308c\u300d\u3067\u5358\u7d14\u306b\u5b9f\u88c5\u3057\u3066\u52d5\u304b\u3059\u3068\u306a\u305c\u3060\u304bCreateCustomFontCollection\u3067\u30d5\u30a9\u30f3\u30c8\u96c6\u3092\u4f5c\u3063\u3066\u3082\u3089\u3046\u306e\u306b\u76f8\u5f53\u306a\u6642\u9593\u304c\u304b\u304b\u308a\u3001\u3082\u3057\u30bd\u30d5\u30c8\u8d77\u52d5\u6642\u306b\u30d5\u30a9\u30f3\u30c8\u767b\u9332\u5b8c\u4e86\u5f85\u3061\u3068\u304b\u3084\u3063\u3061\u3083\u3046\u3068\u5730\u7344\u306e\u3088\u3046\u306a\u5f85\u3061\u6642\u9593\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u306b\u3088\u3063\u3066\u306f\u30d5\u30ea\u30fc\u30ba\u306b\u8fd1\u3044\u72b6\u614b\u306b\u306a\u308b\u3053\u3068\u3082\u3002\u6016\u3063\uff01\n\n\u7406\u7531\u306f\u5358\u7d14\u3067\u3001\n\n- \u3053\u306e\u3054\u6642\u4e16\u3001\u3069\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u30fc\u3067\u3082\u3001\u30b7\u30b9\u30c6\u30e0\u306b\u5165\u3063\u3066\u3044\u308b\u30d5\u30a9\u30f3\u30c8\u81ea\u4f53\u304c\u3068\u306b\u304b\u304f\u591a\u3044 (\u6b27\u6587\u30fb\u548c\u6587\u30fb\u30b7\u30f3\u30dc\u30eb)\n- \u305d\u3093\u306a\u72b6\u6cc1\u4e0b\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u7dcf\u4f53\u306f\u8457\u3057\u304f\u5de8\u5927\u3067\u3042\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u5168\u3066\u3068\u5fc5\u8981\u306a\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u30ed\u30fc\u30c0\u30fc\u3092 IDWriteFactory.CreateCustomFontCollection \u306b\u6e21\u3059\u3068\u51e6\u7406\u5f85\u3061\u3067\u3057\u3070\u3089\u304f\u5236\u5fa1\u304c\u5e30\u3063\u3066\u3053\u306a\u3044\n\n\u4eca\u5ea6\u3053\u305d\u8a70\u3093\u3060\u304b\u2026\u2026\uff1f\u3000\u4e07\u7b56\u5c3d\u304d\u305f\u304b\uff1f\u3000\u3044\u3084\u3001\u307e\u3060\u3060\uff01\n\n### \u4e8c\u6bb5\u968e\u306b\u5206\u3051\u3066FontCollection\u3092\u4f5c\u308b\n\n\u3061\u3087\u3063\u3068\u3053\u3053\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```Delphi:Utils.pas\n                  with Boot_list do\n                  begin\n                        Add('MS Gothic');\n                        Add('MS PGothic');\n                        Add('MS UI Gothic');\n                        Add('MS Mincho');\n                        Add('MS PMincho');\n                        Add('Meiryo');\n                        Add('Meiryo UI');\n                        Add('Segoe UI');\n                        Add('Yu Gothic');\n                        Add('Yu Gothic UI');\n                        Add('Georgia');\n                        Add('Courier New');\n                        Add('Arial');\n                        Add('Times New Roman');\n                  end;\n// \u4e2d\u7565\n                                                // minimum filter (1 of 2 only)\n                                                if (n = 1) then\n                                                begin\n                                                      FM.GetFamilyNames(FMN);\n\n                                                      if SUCCEEDED(FMN.GetString(0,@FontName[0],1023)) then\n                                                      begin\n                                                            if Boot_list.IndexOf(StrPas(PWideChar(@FontName[0]))) < 0 then\n                                                            begin\n                                                                  Continue;\n                                                            end;\n                                                      end;\n                                                end;\n```\n\n\u3000\u4f55\u3084\u3089\u602a\u3057\u3044\u6587\u5b57\u5217\u306e\u7f85\u5217\u304c\u3042\u308a\u307e\u3059\u306d\u3002\u305d\u3057\u3066\u3001\u5f8c\u306b\u73fe\u308c\u308b\u30eb\u30fc\u30d7\u306e\u4e2d\u3067\u306f\u3001\u4f55\u3084\u3089\u3001\u3053\u306e\u30ea\u30b9\u30c8\u3092\u4f7f\u3063\u3066\u4f55\u304b\u3084\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\n\n\u3000\u305d\u3046\uff01\u3000\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u4e00\u822c\u7684\u306a\u6027\u8cea\u306b\u76ee\u3092\u4ed8\u3051\u307e\u3059\u3002\u62d9\u4f5c\u306e\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u306b\u3057\u308d\u3001\u4ed6\u306e\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30bd\u30d5\u30c8\u306b\u3057\u308d\u3001**\u5b9f\u969b\u306b\u4f7f\u3046\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\u306f\u9650\u3089\u308c\u3066\u3044\u307e\u3059\u3088\u306d**\u3002\u6b27\u6587\u30d5\u30a9\u30f3\u30c8\u306a\u3093\u3066\u306e\u3082\u3001Arial,Verdana,Tahoma,Courier New\u304c\u4f7f\u308f\u308c\u308b\u304b\u3069\u3046\u304b\u3044\u3063\u305f\u5177\u5408\u3067\u3001\u305d\u308c\u306a\u3089\u3001\u307e\u305a\u306f**\u6700\u5c0f\u9650\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3067\u7acb\u3061\u4e0a\u3052\u3066\u8d77\u52d5\u3092\u7206\u901f\u5316**\u3057\u3061\u3083\u3044\u307e\u3059\u3002\u4f8b\u3048\u308b\u306a\u3089\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u72b6\u614b\u3067\u3059\u306d[^6]\u3002\n\n[^6]: Windows\u306e\u30bb\u30fc\u30d5\u30e2\u30fc\u30c9\u3063\u3066\u5b9f\u969b\u306e\u3068\u3053\u308d\u8d77\u52d5\u901f\u304f\u306a\u3044\u3088\u306d\n\n\u3000\u5f15\u304d\u7d9a\u3044\u3066\u3001\u30d5\u30eb\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u305f\u3081\u3001\u3057\u3070\u3089\u304fCreateCustomFontCollection\u3092\u8d70\u3089\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u653e\u7f6e\u30d7\u30ec\u30a4\u3067\u3059\u3002\u3048\u3001\u305d\u308c\u56fa\u307e\u308b\u3093\u3058\u3083\u306a\u3044\uff1f\u3000\u3044\u3048\u3044\u3048\u3001\u3088\u304f\u898b\u3066\u304f\u3060\u3055\u3044\u3002\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9(TAnonymousThread)\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u533f\u540d\u30b9\u30ec\u30c3\u30c9\u3067\u30e9\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3042\u308a\u307e\u3059\u3002FontCollection\u66f8\u304d\u63db\u3048\u6642\u306a\u3069\u306fSynchronize\u3092\u5fd8\u308c\u305a\u306b\uff01\n\n\u3000\u653e\u7f6e\u30d7\u30ec\u30a4\u304c\u5b8c\u4e86\u3057\u305f\u3068\u304d\u306f\u3001\u30d5\u30eb\u306e\u30b7\u30b9\u30c6\u30e0\u30d5\u30a9\u30f3\u30c8\uff0b\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u306e\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u51fa\u6765\u4e0a\u304c\u3063\u3066\u3044\u307e\u3059\u3002\u6539\u3081\u3066\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u5dee\u3057\u66ff\u3048\u308b\u3068\u3001\u898b\u4e8b\u306b\u300c2\u30d1\u30b9\u4f5c\u6226\u300d\u306b\u3088\u308bFMX\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3000\u4ee5\u4e0a\u304c\u3001FMX\u306b\u3066\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u30b4\u30ea\u62bc\u3057\u3067\u5b9f\u73fe\u3059\u308b\u624b\u9806\u3060\u3063\u305f\u306e\u3067\u3057\u305f\u3002**\u9577\u304b\u3063\u305f\u3042\u3042\u3042\uff01**\n\n## \u554f\u984c\u70b9\n\n\u3000\u304a\u7d04\u675f\u901a\u308a\u3001\u7389\u306b\u7455\u306a\u30dd\u30a4\u30f3\u30c8\u306f\u3044\u304f\u3064\u304b\u3042\u308a\u307e\u3059\u3002\n\n### \u5404\u7a2eAPI\u306e\u53d6\u308a\u6271\u3044\u3068\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\n\u3000\u6c17\u3092\u4ed8\u3051\u3066\u66f8\u3044\u305f\u3064\u3082\u308a\u3067\u3059\u304c\u3001\u30df\u30b9\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u3088\u3046\u306a\u306a\u3044\u3088\u3046\u306a\u2026\u2026\u3002\n\n### \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3055\u3088\u306a\u3089\u3092\u544a\u3052\u308b\u3068\u304d\n\u3000\u3082\u3046\u4f7f\u308f\u306a\u3044\u6642\u306fnil\u4ee3\u5165\u3067\u826f\u3044\u3093\u3060\u3063\u3051\uff1f\n\n### CreateCustomFontCollection\u4e2d\u306b\u30bd\u30d5\u30c8\u304c\u7d42\u4e86\u3057\u305f\u3089\uff1f\n\u3000\u3053\u308c\u304c\u5927\u554f\u984c\u3002\u5225\u30b9\u30ec\u30c3\u30c9\u3067CreateCustomFontCollection\u3092\u52d5\u304b\u3059\u3053\u3068\u3067\u8272\u3005\u8aa4\u9b54\u5316\u3057\u306f\u5229\u304d\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30bd\u30d5\u30c8\u7d42\u4e86\u6642\u3068\u306a\u308b\u3068\u8a71\u306f\u5225\u3002\u8d77\u52d5\u3057\u3066\u3059\u3050\u7d42\u4e86\u3059\u308b\u306a\u3069\u3001**CreateCustomFontCollection\u304b\u3089\u5236\u5fa1\u304c\u8fd4\u3089\u306a\u3044\u72b6\u614b\u3067\u30bd\u30d5\u30c8\u7d42\u4e86\u3092\u8a66\u307f\u3089\u308c\u308b\u3068\u3001\u30d5\u30a9\u30f3\u30c8\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u4f5c\u3063\u3066\u308b\u6700\u4e2d\u306e\u30b9\u30ec\u30c3\u30c9\u3092\u5b89\u5168\u306b\u6b62\u3081\u308b\u624b\u6bb5\u304c\u3042\u308a\u307e\u305b\u3093**\u3002\u6700\u5f37\u306e\u8aa4\u9b54\u5316\u3057\u3068\u3057\u3066\u3001TerminateThread\u3042\u305f\u308a\u3092\u4f7f\u3063\u3066\u30b5\u30d6\u30b9\u30ec\u30c3\u30c9\u3092\u6bba\u3063\u305f\u308a\u3059\u308b\u65b9\u6cd5\u3082\u3042\u308b\u3051\u308c\u3069\u3001\u305d\u308c\u3059\u3089\u30c0\u30e1\u306a\u5834\u5408\u306fAccess Violation\u7b49\u306e\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u308a\u3057\u307e\u3059\u3002except\u3067\u63e1\u308a\u6f70\u3059\u306e\u3082\u2026\u2026\u306d\u3048\uff1f\n\n\u3000\u672c\u5f53\u306b\u5fc5\u8981\u306a\u3044\u30d5\u30a9\u30f3\u30c8\u306f\u5168\u90e8\u5f3e\u304f\u65b9\u5411\u6027\u3067\u3044\u304f\u306e\u304c\u73fe\u72b6\u30d9\u30bf\u30fc\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u4f8b\u3048\u3070\u3001\u65e5\u672c\u8a9e\u306e\u30a2\u30c9\u30d9\u30f3\u30c1\u30e3\u30fc\u30b2\u30fc\u30e0\u3067\u306f\u3001\u6b27\u6587/\u30b7\u30f3\u30dc\u30eb\u30d5\u30a9\u30f3\u30c8\u306e\u3046\u3061\u3001\u7279\u5b9a\u306e\u3082\u306e\u6570\u500b\u4ee5\u5916\u306f\u78ba\u5b9f\u306b\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u6975\u8ad6\u3001\u6b27\u6587\u30fb\u30b7\u30f3\u30dc\u30eb\u306f\u5168\u90e8\u5f3e\u3044\u3066\u65e5\u672c\u8a9e\u30d5\u30a9\u30f3\u30c8\u3060\u3051\u8aad\u307f\u8fbc\u3080\u306e\u3060\u3063\u3066\u5341\u5206\u30a2\u30ea\u3067\u3057\u3087\u3046\u3002\n\n## \u304a\u307e\u3051\uff1aSTEP3. \u30d5\u30a9\u30f3\u30c8\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\nDirectWrite\u3068GDI\u3067\u306f\u6307\u5b9a\u3059\u308b\u30d5\u30a9\u30f3\u30c8\u540d\u304c\u5fae\u5999\u306b\u9055\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u3064\u3044\u3067\u306bmasOS\u3082\u3002\n\u9069\u5207\u306b\u30d5\u30a9\u30f3\u30c8\u30ea\u30b9\u30c8\u3092\u53d6\u3063\u3066\u3053\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```Delphi:Utils.pas\nfunction EnumFontFamProc(var EnumLogFont: TLogFont; var NewTextMetric: TNewTextMetric; FontType: Integer; LPARAM: Longint): Integer; stdcall; export;\nvar\n      AFontName : String;\nbegin\n      Result := 1;\n\n      AFontName := StrPas(PWideChar(@EnumLogFont.lfFaceName[0]));\n\n      if (pos('@',AFontName)=0) and (FontType = TRUETYPE_FONTTYPE) then\n      begin\n            TStrings(LPARAM).Add(AFontname);\n      end;\nend;\n\nprocedure GetFontList(List:TStrings);\nvar\n      DC:HDC;\n      DF : IDWriteFactory;\n      DFC : IDWriteFontCollection;\n      FM : IDWriteFontFamily;\n      FMN : IDWriteLocalizedStrings;\n      FontName : Array [0..1024] of WideChar;\n      i : Integer;\n      j : Cardinal;\n      locname : Array [0..10] of WideChar;\n      exists : LongBool;\n      lf:tagLOGFONTW;\nbegin\n      // for DirectWrite\n      if GlobalUseDirect2D then\n      begin\n            DWriteCreateFactory(DWRITE_FACTORY_TYPE_SHARED, IDWriteFactory, IUnknown(DF));\n            try\n                  DFC := IDWriteFontCollection(FMX.Canvas.D2d.FontCollection);\n                  if DFC = nil then DF.GetSystemFontCollection(DFC,false);\n\n                  for i := 0 to DFC.GetFontFamilyCount-1 do\n                  begin\n                        DFC.GetFontFamily(i,FM);\n                        FM.GetFamilyNames(FMN);\n                        locname := 'ja-jp'+#0;\n                        FMN.FindLocaleName(locname[0],j,exists);\n                        if (exists) then\n                        begin\n                              FMN.GetString(j,@FontName[0],Length(FontName)-1);\n                              List.Add(StrPas(PWideChar(@FontName[0])));\n                        end;\n                  end;\n            finally\n                  DF := nil;\n            end;\n\n      // for GDI\n      end else\n      begin\n            DC := GetDC(0);\n            try\n                  FillMemory(@lf,sizeof(lf),0);\n                  lf.lfCharSet := SHIFTJIS_CHARSET;\n                  lf.lfPitchAndFamily := 0;\n                  FillChar(lf.lfFaceName, sizeof(lf.lfFaceName), 0);\n                  EnumFontFamiliesEx(DC, lf, @EnumFontFamProc, LongInt(List), 0);\n            finally\n                  ReleaseDC(0, DC);\n            end;\n      end;\n\nend;\n{$ENDIF}\n\n{$IFDEF MACOS}\nprocedure GetFontList(List:TStrings);\nvar\n      fm: NSFontManager;\n      fa: NSArray;\n      i: Integer;\n      fname: NSString;\nbegin\n      fm := TNSFontManager.Wrap(TNSFontManager.OCClass.sharedFontManager);\n      fa := fm.availableFontFamilies;\n\n      for i := 0 to fa.count-1 do\n      begin\n            fname := TNSString.Wrap(fa.objectAtIndex(i));\n            List.Add(fname.UTF8String);\n      end;\nend;\n{$ENDIF}\n```\n\n<dl>\n  <dt>DirectWrite</dt>\n  <dd>\u30d5\u30a9\u30f3\u30c8\u30d5\u30a1\u30df\u30ea\u30fc\u8fba\u308a\u304b\u3089\u540d\u524d\u3092\u5f97\u307e\u3059\u3002</dd>\n  <dt>GDI</dt>\n  <dd>\u5b9a\u756a\u306e\u3084\u3064\u3067\u3059\u306d\u3002EnumFontFamiliesEx API \u3092\u4f7f\u3044\u307e\u3059\u3002</dd>\n  <dt>macOS</dt>\n  <dd>TNSFontManager\u306eavailableFontFamilies\u3088\u308a\u5217\u6319\u3057\u3066\u3044\u304d\u307e\u3059\u3002</dd>\n</dl>\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u30e9\u30a4\u30bb\u30f3\u30b9\n\u3000MIT License \u3063\u3066\u3053\u3068\u3067\u3001\u3069\u3046\u3063\u3059\u304b\uff1f\n\n## \u3055\u3044\u3054\u306b\n\n\u3000\u5f53\u521d\u3001\u5b9f\u88c5\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u30bf\u30ab\u3092\u304f\u304f\u3063\u3066\u3044\u305fFMX\u3067\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3002\u3068\u3053\u308d\u304c\u3001\u65e5\u672c\u306f\u3082\u3061\u308d\u3093\u3001\u6d77\u5916\u306e\u30d5\u30a9\u30fc\u30e9\u30e0\u3084StackOverflow\u3092\u8997\u3044\u3066\u3082\u300c**\u7121\u7406\u3084\u305e\u305d\u308c\u2026\u2026**(\u610f\u8a33)\u300d\u306eAnswer\u3070\u304b\u308a\u3002\u982d\u3092\u62b1\u3048\u3066\u4e00\u30f6\u6708\u4e8c\u30f6\u6708\u2026\u2026\u3075\u3068\u89e3\u6c7a\u306e\u9053\u7b4b\u304c\u7acb\u3063\u3066\u304d\u305f\u3068\u304d\u306f\u3001\u30ac\u30c3\u30c4\u30dd\u30fc\u30ba\u3092\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\u3000FMX\u88fd\u304b\u3064\u3001\u3053\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u3092\u7d44\u307f\u8fbc\u3093\u3060\u62d9\u4f5c\u306eADV\u300e[\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb](http://jikutale.zuh.jp/ \"\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb\")\u300f(\u6700\u521d\u306b\u304a\u898b\u305b\u3057\u305f\u3082\u306e\u3067\u3059\u306d)\u306f\u3001\u4ed6\u306e\u4e0d\u5177\u5408\u3082\u767a\u751f\u3057\u305f\u308a\u7d06\u4f59\u66f2\u6298\u3042\u3063\u305f\u3082\u306e\u306e\u3001\u73fe\u5728\u306f\u307b\u307cStable\u306b\u9054\u3057\u3001\u7d9a\u7de8\u306b\u307e\u3067\u5229\u7528\u3067\u304d\u308b\u7a0b\u5ea6\u306b\u306f\u6c4e\u7528\u5316\u3082\u9032\u307f\u307e\u3057\u305f\u3002\u3055\u3089\u306b\u3001macOS\u306e\u65b9\u3067\u3082\u30d7\u30ec\u30a4\u3067\u304d\u308b\u306e\u304c\u500b\u4eba\u7684\u306a\u63a8\u3057\u3067\u3059\u3002**\u307e\u3063\u305f\u304f\u3001Delphi\u306f\u6700\u9ad8\u3060\u305c\uff01**\n\n\u3000\u4ee5\u4e0a\u3001\u540d\u53e4\u5c4b\u751f\u307e\u308c\u30fb\u540d\u53e4\u5c4b\u80b2\u3061\u306e\u6d41\u6d6a\u306e\u30d7\u30ed\u30b0\u30e9\u30de\u30fc\u3001\u9577\u9580\u307f\u3089\u3044\u304cFMX\u306e\u30ab\u30b9\u30bf\u30e0\u30d5\u30a9\u30f3\u30c8\u4e8b\u60c5\u306b\u3064\u3044\u3066\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u3002\u9577\u304f\u306a\u3063\u3066\u3054\u3081\u3093\u306d\uff01\u3000\u3067\u306f\u307e\u305f\u6765\u5e74\uff01\u3000\u4f55\u304b\u66f8\u3051\u305f\u3089\u3044\u3044\u306a\uff01\n\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/146457/96dbcad7-5b4f-585b-964b-ac6bbfb35d0d.png)\n\u6642\u7a7a\u6539\u672d\u306e\u30d5\u30a7\u30a2\u30ea\u30fc\u30c6\u30a4\u30eb\u3001\u3069\u3046\u305e\u3088\u3057\u306a\u306b\u3002(\u30c0\u30a4\u30ec\u30af\u30c8\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0)\n", "tags": ["Delphi", "FMX"]}