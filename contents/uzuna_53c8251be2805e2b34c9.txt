{"context": "\u524d\u56dehapijs\u3067\u753b\u50cf\u751f\u6210\u30b5\u30fc\u30d0\u3092\u305f\u3066\u307e\u3057\u305f\u3002\n\u3068\u306a\u308b\u3068\u6b21\u306fajax\u3067\u30c7\u30fc\u30bf\u306e\u3084\u308a\u53d6\u308a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\nCORS\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nhapijs\u306e\u8a2d\u5b9a\n\u8a2d\u5b9a\u306f\u7c21\u5358\u3067 connection \u306e\u547c\u3073\u51fa\u3057\u306e\u3068\u304d\u306b routes.cors \u306e\u3057\u305f\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\norigin : \u8a31\u53ef\u3059\u308b\u30a2\u30af\u30bb\u30b9\u5143\u306e\u30ea\u30b9\u30c8\nmaxAge : preflight\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u6709\u52b9\u671f\u9593\nheaders: \u8a31\u53ef\u3059\u308b\u30ab\u30b9\u30bf\u30e0\u30bf\u30b0\u306e\u30ea\u30b9\u30c8\n\nserver.connection({\n    port: process.env.PORT || 3000,\n    routes:{\n        cors:{\n            origin:[\"https://desolate-cove-15227.herokuapp.com\"],\n            maxAge: 10,\n            headers:[\"x-api-key\"]\n        }\n    }\n});\n\n\u6b21\u306bRoute\u306e\u8a2d\u5b9a\u3067\u3059\u304c headers \u306evalidation\u306f\u5c11\u3057\u5de5\u592b\u304c\u5fc5\u8981\u3067 Joi.object \u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3057\u307e\u3059\n\u305d\u306e\u307e\u307e\u6e21\u3059\u3068Validation\u304c\u901a\u3089\u306a\u304f\u306a\u308b\u306e\u3067 `.options({ allowUnknown: true }) \u304c\u5fc5\u8981\u3067\u3059\u3002\n\u8a73\u3057\u304f\u306f\u672c\u5bb6\u306eissue\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\nvalidate: {\n    params: {\n        id: Joi.string()\n            .regex(/^[a-zA-Z0-9]{3,20}$/)\n            .default(\"test\"),\n    },\n    headers: Joi.object().keys({\n        \"x-api-key\": Joi.number().integer()\n            .min(-1000).max(1000)\n            .default(0)\n    }).options({ allowUnknown: true })\n}\n\n\u3053\u308c\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u5b9f\u969b\u306b\u5225\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u305f\u306e\u304c\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059\nimg\u30bf\u30b0\u306b\u30a2\u30c9\u30ec\u30b9\u3092\u76f4\u63a5\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3068\u3001CORS\u306e\u30c6\u30b9\u30c8\u306e\u305f\u3081dataURL\u3067\u53d6\u5f97\u3059\u308b\u5834\u5408\u3092\u8a66\u3057\u3066\u307e\u3059\u3002\n\u3053\u308c\u3067API\u30b5\u30fc\u30d0\u3068\u3057\u3066\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u6240\u611f\nhapijs\u306e\u7279\u5fb4\u3092\u8003\u3048\u3066\u307f\u308b\u3068 Joi \u3068 Hoek \u3067\u3059\u3002\nJoi \u306fhapijs\u5168\u4f53\u306b\u578b\u306e\u3088\u3046\u306a\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u8a2d\u5b9a\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u3092 Joi \u3092\u901a\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\nHoek \u306fObject\u306e\u53d6\u308a\u6271\u3044\u3092\u88dc\u52a9\u3059\u308b\u3082\u306e\u3067\u30de\u30fc\u30b8\u3001\u6bd4\u8f03\u3001\u5e73\u5766\u5316\u306a\u3069\u306e\u64cd\u4f5c\u3092\u5bb9\u6613\u306b\u3057\u3066\u304f\u308c\u307e\u3059\u3002\nhapijs\u306f\u30b5\u30fc\u30d0\u306e\u6a5f\u80fd\u3092Joi\u3067\u5b9a\u7fa9\u3002\u30e6\u30fc\u30b6\u30fc\u306fhoek\u3067\u5fc5\u8981\u306a\u7bc4\u56f2\u3092\u62e1\u5f35\u3057\u3066\u4f7f\u3046\u3001\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c\u304c\u5c11\u306a\u3044\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u3053\u3068\u3067\u304d\u307e\u3059\u3002\n\u305d\u306e\u3042\u305f\u308aexpress\u306f\u305a\u3063\u3068\u81ea\u7531\u5ea6\u306e\u9ad8\u304f\u6c17\u8efd\u306b\u4f7f\u3048\u308b\u5206\u3001\u6c17\u3092\u4f7f\u308f\u306a\u3044\u3068\u8106\u5f31\u6027\u3092\u4f5c\u308a\u8fbc\u307f\u3084\u3059\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u306d\u3002\n\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u306e\u306fhapi\u3067\u3001\u9759\u7684\u306a\u3082\u306e\u306fexpress\u3092\u3068\u4f7f\u3044\u5206\u3051\u308b\u3068\u4f7f\u3044\u52dd\u624b\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\u524d\u56dehapijs\u3067\u753b\u50cf\u751f\u6210\u30b5\u30fc\u30d0\u3092\u305f\u3066\u307e\u3057\u305f\u3002\n\u3068\u306a\u308b\u3068\u6b21\u306fajax\u3067\u30c7\u30fc\u30bf\u306e\u3084\u308a\u53d6\u308a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u3053\u308d\u3067\u3059\u3002\nCORS\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n## hapijs\u306e\u8a2d\u5b9a\n\n\u8a2d\u5b9a\u306f\u7c21\u5358\u3067 `connection` \u306e\u547c\u3073\u51fa\u3057\u306e\u3068\u304d\u306b `routes.cors` \u306e\u3057\u305f\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n* origin : \u8a31\u53ef\u3059\u308b\u30a2\u30af\u30bb\u30b9\u5143\u306e\u30ea\u30b9\u30c8\n* maxAge : preflight\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u6709\u52b9\u671f\u9593\n* headers: \u8a31\u53ef\u3059\u308b\u30ab\u30b9\u30bf\u30e0\u30bf\u30b0\u306e\u30ea\u30b9\u30c8\n\n```js\nserver.connection({\n\tport: process.env.PORT || 3000,\n\troutes:{\n\t\tcors:{\n\t\t\torigin:[\"https://desolate-cove-15227.herokuapp.com\"],\n\t\t\tmaxAge: 10,\n\t\t\theaders:[\"x-api-key\"]\n\t\t}\n\t}\n});\n```\n\n\u6b21\u306bRoute\u306e\u8a2d\u5b9a\u3067\u3059\u304c `headers` \u306evalidation\u306f\u5c11\u3057\u5de5\u592b\u304c\u5fc5\u8981\u3067 `Joi.object` \u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3057\u307e\u3059\n\u305d\u306e\u307e\u307e\u6e21\u3059\u3068Validation\u304c\u901a\u3089\u306a\u304f\u306a\u308b\u306e\u3067 `.options({ allowUnknown: true }) \u304c\u5fc5\u8981\u3067\u3059\u3002\n\u8a73\u3057\u304f\u306f[\u672c\u5bb6\u306eissue](https://github.com/hapijs/hapi/issues/2407)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n\n```js\nvalidate: {\n\tparams: {\n\t\tid: Joi.string()\n\t\t\t.regex(/^[a-zA-Z0-9]{3,20}$/)\n\t\t\t.default(\"test\"),\n\t},\n\theaders: Joi.object().keys({\n\t\t\"x-api-key\": Joi.number().integer()\n\t\t\t.min(-1000).max(1000)\n\t\t\t.default(0)\n\t}).options({ allowUnknown: true })\n}\n```\n\n\u3053\u308c\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u5b9f\u969b\u306b\u5225\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u305f\u306e\u304c[\u3053\u3061\u3089\u306b\u306a\u308a\u307e\u3059](https://desolate-cove-15227.herokuapp.com/)\nimg\u30bf\u30b0\u306b\u30a2\u30c9\u30ec\u30b9\u3092\u76f4\u63a5\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3068\u3001CORS\u306e\u30c6\u30b9\u30c8\u306e\u305f\u3081dataURL\u3067\u53d6\u5f97\u3059\u308b\u5834\u5408\u3092\u8a66\u3057\u3066\u307e\u3059\u3002\n\n\u3053\u308c\u3067API\u30b5\u30fc\u30d0\u3068\u3057\u3066\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n### \u6240\u611f\n\nhapijs\u306e\u7279\u5fb4\u3092\u8003\u3048\u3066\u307f\u308b\u3068 `Joi` \u3068 `Hoek` \u3067\u3059\u3002\n`Joi` \u306fhapijs\u5168\u4f53\u306b\u578b\u306e\u3088\u3046\u306a\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u8a2d\u5b9a\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u3092 `Joi` \u3092\u901a\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n`Hoek` \u306fObject\u306e\u53d6\u308a\u6271\u3044\u3092\u88dc\u52a9\u3059\u308b\u3082\u306e\u3067\u30de\u30fc\u30b8\u3001\u6bd4\u8f03\u3001\u5e73\u5766\u5316\u306a\u3069\u306e\u64cd\u4f5c\u3092\u5bb9\u6613\u306b\u3057\u3066\u304f\u308c\u307e\u3059\u3002\nhapijs\u306f\u30b5\u30fc\u30d0\u306e\u6a5f\u80fd\u3092Joi\u3067\u5b9a\u7fa9\u3002\u30e6\u30fc\u30b6\u30fc\u306fhoek\u3067\u5fc5\u8981\u306a\u7bc4\u56f2\u3092\u62e1\u5f35\u3057\u3066\u4f7f\u3046\u3001\u610f\u56f3\u3057\u306a\u3044\u52d5\u4f5c\u304c\u5c11\u306a\u3044\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u3053\u3068\u3067\u304d\u307e\u3059\u3002\n\u305d\u306e\u3042\u305f\u308aexpress\u306f\u305a\u3063\u3068\u81ea\u7531\u5ea6\u306e\u9ad8\u304f\u6c17\u8efd\u306b\u4f7f\u3048\u308b\u5206\u3001\u6c17\u3092\u4f7f\u308f\u306a\u3044\u3068\u8106\u5f31\u6027\u3092\u4f5c\u308a\u8fbc\u307f\u3084\u3059\u3044\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u306d\u3002\n\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u306e\u306fhapi\u3067\u3001\u9759\u7684\u306a\u3082\u306e\u306fexpress\u3092\u3068\u4f7f\u3044\u5206\u3051\u308b\u3068\u4f7f\u3044\u52dd\u624b\u304c\u826f\u3055\u305d\u3046\u3067\u3059\u3002\n\n", "tags": ["Hapi.js", "CORS"]}