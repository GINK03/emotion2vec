{"context": " More than 1 year has passed since last update.\n\n[aws-cli]RDS\u306e\u30ed\u30b0\u3092cli\u3067\u78ba\u8a8d\u3059\u308b\n\nRDS\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30b0\u30eb\u30fc\u30d7\u306e\u5024\u5909\u66f4\n\n\n\n\u9805\u76ee\n\u5909\u66f4\u524d\n\u5909\u66f4\u5f8c\n\n\n\n\ngeneral_log\nnull\n1\n\n\nlog_output\nTABLE\nFILE\n\n\nslow_query_log\nnull\n1\n\n\nlong_query_time\nnull\n3\n\n\n\n\nRDS\u306eReadOnly Policy\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3001IAM\u30b0\u30eb\u30fc\u30d7\u201drds-maintenance\u201d\u4f5c\u6210\n$ aws iam list-groups-for-user --user-name rds-maintenance\n{\n    \"Groups\": [\n        {\n            \"Path\": \"/\",\n            \"CreateDate\": \"2015-08-31T04:00:57Z\",\n            \"GroupId\": \"AGPAITHVICAQS5MDE6RXC\",\n            \"Arn\": \"arn:aws:iam::792454999443:group/rds-maintenance\",\n            \"GroupName\": \"rds-maintenance\"\n        }\n    ]\n}\n\n$ aws iam list-attached-group-policies --group-name rds-maintenance\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"AmazonRDSReadOnlyAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess\"\n        }\n    ],\n    \"IsTruncated\": false\n}\n\n\nRDS\u306e\"DownloadDBLogFilePortion\"\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"rds-log-download-policy\",\n            \"PolicyArn\": \"arn:aws:iam::792454999443:policy/rds-log-download-policy\"\n        },\n        {\n            \"PolicyName\": \"AmazonRDSReadOnlyAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess\"\n        }\n    ],\n    \"IsTruncated\": false\n}\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1441005849679\",\n            \"Action\": [\n                \"rds:DownloadDBLogFilePortion\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\n{\n    \"Users\": [\n        {\n            \"UserName\": \"rds-maintenance\",\n            \"Path\": \"/\",\n            \"CreateDate\": \"2015-08-31T04:01:47Z\",\n            \"UserId\": \"AIDAI5T2AKMQHUDZ4HXLG\",\n            \"Arn\": \"arn:aws:iam::792454999443:user/rds-maintenance\"\n        }\n    ]\n}\n\n\n\u30e6\u30fc\u30b6\"rds-maintenance\"\u304caws cli\u3092\u4f7f\u3048\u308b\u3088\u3046\u8a2d\u5b9a\n$aws configure --profile rds-mente\nAWS Access Key ID [****************23IQ]:\nAWS Secret Access Key [****************33ZN]:\nDefault region name [ap-northeast-1]:\nDefault output format [json]:\n\n\nRDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e00\u89a7\u53d6\u5f97\uff08jq\u3067\u52a0\u5de5\u6e08\u307f\uff09\n$ aws rds describe-db-instances --profile vivo-rds-mente | jq '.DBInstances[].DBInstanceIdentifier'\n\n\"dev-db\"\n\"prod-db\"\n\"stg-db\"\n\n\n\u7279\u5b9a\u306eRDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u4e00\u89a7\u3092\u53d6\u5f97\n$ aws rds describe-db-log-files --db-instance-identifier dev-db --profile rds-mente\n\n{\n    \"DescribeDBLogFiles\": [\n        {\n            \"LastWritten\": 1440998400000,\n            \"LogFileName\": \"error/mysql-error.log\",\n            \"Size\": 0\n        },\n        {\n            \"LastWritten\": 1440998580000,\n            \"LogFileName\": \"general/mysql-general.log\",\n            \"Size\": 52731\n        },\n        {\n            \"LastWritten\": 1440993600000,\n            \"LogFileName\": \"general/mysql-general.log.4\",\n            \"Size\": 248955\n        },\n        {\n            \"LastWritten\": 1440997200000,\n            \"LogFileName\": \"general/mysql-general.log.5\",\n            \"Size\": 2096024\n        },\n        {\n            \"LastWritten\": 1431214055000,\n            \"LogFileName\": \"mysqlUpgrade\",\n            \"Size\": 2457\n        },\n        {\n            \"LastWritten\": 1440998400000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log\",\n            \"Size\": 915\n        },\n        {\n            \"LastWritten\": 1440993376000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log.4\",\n            \"Size\": 183\n        },\n        {\n            \"LastWritten\": 1440996900000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log.5\",\n            \"Size\": 2196\n        }\n    ]\n}\n\n\n\u30ed\u30b0\u78ba\u8a8d\naws rds download-db-log-file-portion --db-instance-identifier dev-db --log-file-name \"general/mysql-general.log\" --profile rds-mente --output text\n\n\n\u30ed\u30b0\u3092\u51fa\u529b\naws rds download-db-log-file-portion --db-instance-identifier dev-db --log-file-name \"general/mysql-general.log\" --profile rds-mente --output text > mysql-general.log\n\n# [aws-cli]RDS\u306e\u30ed\u30b0\u3092cli\u3067\u78ba\u8a8d\u3059\u308b\n## RDS\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30b0\u30eb\u30fc\u30d7\u306e\u5024\u5909\u66f4\n| \u9805\u76ee | \u5909\u66f4\u524d | \u5909\u66f4\u5f8c |\n|:-----------|------------:|:------------:|\n| general_log       |   null |     1     |\n| log_output     |      TABLE |    FILE    |\n| slow_query_log       |        null |     1     |\n| long_query_time         |          null |      3      |\n\n\n## RDS\u306eReadOnly Policy\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u305f\u3001IAM\u30b0\u30eb\u30fc\u30d7\u201drds-maintenance\u201d\u4f5c\u6210\n```\n$ aws iam list-groups-for-user --user-name rds-maintenance\n{\n    \"Groups\": [\n        {\n            \"Path\": \"/\",\n            \"CreateDate\": \"2015-08-31T04:00:57Z\",\n            \"GroupId\": \"AGPAITHVICAQS5MDE6RXC\",\n            \"Arn\": \"arn:aws:iam::792454999443:group/rds-maintenance\",\n            \"GroupName\": \"rds-maintenance\"\n        }\n    ]\n}\n```\n\n```\n$ aws iam list-attached-group-policies --group-name rds-maintenance\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"AmazonRDSReadOnlyAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess\"\n        }\n    ],\n    \"IsTruncated\": false\n}\n```\n\n## RDS\u306e\"DownloadDBLogFilePortion\"\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\n```\n{\n    \"AttachedPolicies\": [\n        {\n            \"PolicyName\": \"rds-log-download-policy\",\n            \"PolicyArn\": \"arn:aws:iam::792454999443:policy/rds-log-download-policy\"\n        },\n        {\n            \"PolicyName\": \"AmazonRDSReadOnlyAccess\",\n            \"PolicyArn\": \"arn:aws:iam::aws:policy/AmazonRDSReadOnlyAccess\"\n        }\n    ],\n    \"IsTruncated\": false\n}\n```\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Stmt1441005849679\",\n            \"Action\": [\n                \"rds:DownloadDBLogFilePortion\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n\n\n## \u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u3001\u30b0\u30eb\u30fc\u30d7\u306b\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\n```\n{\n    \"Users\": [\n        {\n            \"UserName\": \"rds-maintenance\",\n            \"Path\": \"/\",\n            \"CreateDate\": \"2015-08-31T04:01:47Z\",\n            \"UserId\": \"AIDAI5T2AKMQHUDZ4HXLG\",\n            \"Arn\": \"arn:aws:iam::792454999443:user/rds-maintenance\"\n        }\n    ]\n}\n```\n\n## \u30e6\u30fc\u30b6\"rds-maintenance\"\u304caws cli\u3092\u4f7f\u3048\u308b\u3088\u3046\u8a2d\u5b9a\n```\n$aws configure --profile rds-mente\nAWS Access Key ID [****************23IQ]:\nAWS Secret Access Key [****************33ZN]:\nDefault region name [ap-northeast-1]:\nDefault output format [json]:\n```\n\n## RDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e00\u89a7\u53d6\u5f97\uff08jq\u3067\u52a0\u5de5\u6e08\u307f\uff09\n```\n$ aws rds describe-db-instances --profile vivo-rds-mente | jq '.DBInstances[].DBInstanceIdentifier'\n\n\"dev-db\"\n\"prod-db\"\n\"stg-db\"\n```\n\n## \u7279\u5b9a\u306eRDS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ed\u30b0\u4e00\u89a7\u3092\u53d6\u5f97\n```\n$ aws rds describe-db-log-files --db-instance-identifier dev-db --profile rds-mente\n\n{\n    \"DescribeDBLogFiles\": [\n        {\n            \"LastWritten\": 1440998400000,\n            \"LogFileName\": \"error/mysql-error.log\",\n            \"Size\": 0\n        },\n        {\n            \"LastWritten\": 1440998580000,\n            \"LogFileName\": \"general/mysql-general.log\",\n            \"Size\": 52731\n        },\n        {\n            \"LastWritten\": 1440993600000,\n            \"LogFileName\": \"general/mysql-general.log.4\",\n            \"Size\": 248955\n        },\n        {\n            \"LastWritten\": 1440997200000,\n            \"LogFileName\": \"general/mysql-general.log.5\",\n            \"Size\": 2096024\n        },\n        {\n            \"LastWritten\": 1431214055000,\n            \"LogFileName\": \"mysqlUpgrade\",\n            \"Size\": 2457\n        },\n        {\n            \"LastWritten\": 1440998400000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log\",\n            \"Size\": 915\n        },\n        {\n            \"LastWritten\": 1440993376000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log.4\",\n            \"Size\": 183\n        },\n        {\n            \"LastWritten\": 1440996900000,\n            \"LogFileName\": \"slowquery/mysql-slowquery.log.5\",\n            \"Size\": 2196\n        }\n    ]\n}\n```\n\n## \u30ed\u30b0\u78ba\u8a8d\n```\naws rds download-db-log-file-portion --db-instance-identifier dev-db --log-file-name \"general/mysql-general.log\" --profile rds-mente --output text\n```\n\n## \u30ed\u30b0\u3092\u51fa\u529b\n```\naws rds download-db-log-file-portion --db-instance-identifier dev-db --log-file-name \"general/mysql-general.log\" --profile rds-mente --output text > mysql-general.log\n```\n\n\n\n\n", "tags": ["AWS", "RDS", "aws-cli"]}