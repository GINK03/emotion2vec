{"tags": ["Phalcon", "Ginq", "PHP"], "context": " More than 1 year has passed since last update.\u53bb\u5e74\u66f8\u3044\u305f Phalcon Model::find \u306e\u7d50\u679c\u3092 Ginq \u306b\u3059\u308b\u65b9\u6cd5 \u3068\u3044\u3046\u8a18\u4e8b\u3067\u6687\u304c\u3042\u3063\u305f\u3089\u66f8\u304f\u3063\u3066\u8a00\u3063\u3066\u305f\u3084\u3064\u3067\u3059\u3002\n\u6700\u8fd1\u306f\u6687\u304c\u3042\u3063\u305f\u3089\u4e8c\u767e\u3046\u3093\u5e74\u5f8c\u306e\u30dc\u30b9\u30c8\u30f3\u306b\u884c\u3063\u3066\u307e\u3059(Fallout4)\u3002\u3067\u3082\u3084\u3063\u3071\u308a\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\nWhy\nModel find \u7d50\u679c\u3092 Ginq \u306b\u7d71\u4e00\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092 Ginq \u306b\u5bfe\u5fdc\u3055\u305b\u305f\u304b\u3063\u305f\u3002\n\u8d85\u30cb\u30c3\u30c1\u3002\n\nCode\n\u540d\u524d\u7a7a\u9593\u306f\u66f8\u3044\u3066\u307e\u305b\u3093\u3002\u9069\u5b9c\u9069\u5207\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nGinqPaginator.php\n<?php\n\nuse Phalcon\\Paginator\\Exception;\nuse Phalcon\\Paginator\\AdapterInterface;\n\nclass GinqPaginator implements AdapterInterface\n{\n    /** @type array */\n    protected $config;\n\n    /** @type int */\n    protected $page;\n\n    /** @type int */\n    protected $limitRows;\n\n    public function __construct($config)\n    {\n        $this->config = $config;\n        if (isset($config['limit'])) {\n            $this->limitRows = $config['limit'];\n        }\n        if (isset($config['page'])) {\n            $this->page = $config['page'];\n        }\n    }\n\n    public function setCurrentPage($page)\n    {\n        $this->page = $page;\n        return $this;\n    }\n\n    public function getPaginate()\n    {\n        $limit = intval($this->limitRows);\n        $config = $this->config;\n        /** @var Ginq $items */\n        $items = $config['data'];\n        $pageNumber = intval($this->page);\n\n        if (!(class_exists(\"Ginq\\\\Ginq\") and $items instanceof \\Ginq\\Ginq)) {\n            throw new Exception(\"Invalid data for paginator\");\n        }\n\n        if ($pageNumber <= 0) {\n            $pageNumber = 1;\n        }\n\n        if ($limit <= 0) {\n            throw new Exception(\"The limit number is zero or less\");\n        }\n\n        $n = $items->count();\n        $offset = $limit * ($pageNumber - 1);\n        $totalPages = (int)ceil($n / $limit);\n\n        if ($offset > 0) $items = $items->drop($offset);\n        $items = $items->take($limit);\n\n        $next = $pageNumber < $totalPages\n            ? $pageNumber + 1\n            : $totalPages;\n\n        $before = $pageNumber > 1\n            ? $pageNumber - 1\n            : 1;\n\n        return (object)[\n            'items' => $items->toList(),\n            'first' => 1,\n            'before' => $before,\n            'current' => $pageNumber,\n            'last' => $totalPages,\n            'next' => $next,\n            'total_pages' => $totalPages,\n            'total_items' => $n,\n            'limit' => $limit,\n        ];\n    }\n}\n\n\n\nHow\n\nEntryController.php\nclass EntryController extendes Controller {\n\n    public function entriesAction()\n    {\n        $limit = 10;    // 1\u30da\u30fc\u30b8\u306b\u8868\u793a\u3059\u308b\u6570\n        // \u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304b\u3089\u30da\u30fc\u30b8\u756a\u53f7\u3092\u53d6\u5f97 ?page=1 \n        $page_num = $this->request->get('page', ['int'], 1);\n        $entries = Entries::find(); // \u306a\u3093\u304b\u305f\u304f\u3055\u3093\u53d6\u5f97\u3059\u308b(\u8fd4\u3063\u3066\u304f\u308b\u306e\u306f Ginq)\n\n        // Ginq, \u30da\u30fc\u30b8\u5185\u8868\u793a\u6570, \u30da\u30fc\u30b8\u756a\u53f7\u3092\u6e21\u3059\n        $paginator = new GinqPaginator([\n            'data' => $entries,\n            'limit' => $limit,\n            'page' => $page_num,\n        ]);\n        // \u4eca\u56de\u306e\u30da\u30fc\u30b8\u3092\u53d6\u5f97\n        $page = $paginator->getPaginate();\n        $this->view->setVar('page', $page);\n    }\n\n}\n\n\n\nentries.volt\n{{ page.current }} <!-- \u4eca\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.before }} <!-- \u524d\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.next }} <!-- \u6b21\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.total_pages }} <!-- \u4f55\u30da\u30fc\u30b8\u3042\u308b\u304b -->\n{{ page.total_items }} <!-- \u5168\u90e8\u3067\u3044\u304f\u3064\u3042\u308b\u304b -->\n<ul>\n  {% for entry in page.items %} <!-- \u30da\u30fc\u30b8\u5185\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u30a4\u30c6\u30ec\u30fc\u30c8 -->\n    <li>{{ entry.title }}</li>\n  {% endfor %}\n</ul>\n\n\n\n\u53bb\u5e74\u66f8\u3044\u305f [Phalcon Model::find \u306e\u7d50\u679c\u3092 Ginq \u306b\u3059\u308b\u65b9\u6cd5](http://qiita.com/sukobuto/items/9472d1257750edc6d22a) \u3068\u3044\u3046\u8a18\u4e8b\u3067\u6687\u304c\u3042\u3063\u305f\u3089\u66f8\u304f\u3063\u3066\u8a00\u3063\u3066\u305f\u3084\u3064\u3067\u3059\u3002\n\u6700\u8fd1\u306f\u6687\u304c\u3042\u3063\u305f\u3089\u4e8c\u767e\u3046\u3093\u5e74\u5f8c\u306e\u30dc\u30b9\u30c8\u30f3\u306b\u884c\u3063\u3066\u307e\u3059(Fallout4)\u3002\u3067\u3082\u3084\u3063\u3071\u308a\u5fc5\u8981\u306b\u306a\u3063\u305f\u306e\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\n# Why\n\nModel find \u7d50\u679c\u3092 Ginq \u306b\u7d71\u4e00\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30da\u30fc\u30b8\u30f3\u30b0\u3092 Ginq \u306b\u5bfe\u5fdc\u3055\u305b\u305f\u304b\u3063\u305f\u3002\n\u8d85\u30cb\u30c3\u30c1\u3002\n\n# Code\n\n\u540d\u524d\u7a7a\u9593\u306f\u66f8\u3044\u3066\u307e\u305b\u3093\u3002\u9069\u5b9c\u9069\u5207\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```php:GinqPaginator.php\n<?php\n\nuse Phalcon\\Paginator\\Exception;\nuse Phalcon\\Paginator\\AdapterInterface;\n\nclass GinqPaginator implements AdapterInterface\n{\n\t/** @type array */\n\tprotected $config;\n\n\t/** @type int */\n\tprotected $page;\n\n\t/** @type int */\n\tprotected $limitRows;\n\n\tpublic function __construct($config)\n\t{\n\t\t$this->config = $config;\n\t\tif (isset($config['limit'])) {\n\t\t\t$this->limitRows = $config['limit'];\n\t\t}\n\t\tif (isset($config['page'])) {\n\t\t\t$this->page = $config['page'];\n\t\t}\n\t}\n\n\tpublic function setCurrentPage($page)\n\t{\n\t\t$this->page = $page;\n\t\treturn $this;\n\t}\n\n\tpublic function getPaginate()\n\t{\n\t\t$limit = intval($this->limitRows);\n\t\t$config = $this->config;\n\t\t/** @var Ginq $items */\n\t\t$items = $config['data'];\n\t\t$pageNumber = intval($this->page);\n\n\t\tif (!(class_exists(\"Ginq\\\\Ginq\") and $items instanceof \\Ginq\\Ginq)) {\n\t\t\tthrow new Exception(\"Invalid data for paginator\");\n\t\t}\n\n\t\tif ($pageNumber <= 0) {\n\t\t\t$pageNumber = 1;\n\t\t}\n\n\t\tif ($limit <= 0) {\n\t\t\tthrow new Exception(\"The limit number is zero or less\");\n\t\t}\n\n\t\t$n = $items->count();\n\t\t$offset = $limit * ($pageNumber - 1);\n\t\t$totalPages = (int)ceil($n / $limit);\n\n\t\tif ($offset > 0) $items = $items->drop($offset);\n\t\t$items = $items->take($limit);\n\n\t\t$next = $pageNumber < $totalPages\n\t\t\t? $pageNumber + 1\n\t\t\t: $totalPages;\n\n\t\t$before = $pageNumber > 1\n\t\t\t? $pageNumber - 1\n\t\t\t: 1;\n\n\t\treturn (object)[\n\t\t\t'items' => $items->toList(),\n\t\t\t'first' => 1,\n\t\t\t'before' => $before,\n\t\t\t'current' => $pageNumber,\n\t\t\t'last' => $totalPages,\n\t\t\t'next' => $next,\n\t\t\t'total_pages' => $totalPages,\n\t\t\t'total_items' => $n,\n\t\t\t'limit' => $limit,\n\t\t];\n\t}\n}\n```\n\n# How\n\n```php:EntryController.php\nclass EntryController extendes Controller {\n\n\tpublic function entriesAction()\n\t{\n\t\t$limit = 10;\t// 1\u30da\u30fc\u30b8\u306b\u8868\u793a\u3059\u308b\u6570\n\t\t// \u30af\u30a8\u30ea\u30b9\u30c8\u30ea\u30f3\u30b0\u304b\u3089\u30da\u30fc\u30b8\u756a\u53f7\u3092\u53d6\u5f97 ?page=1 \n\t\t$page_num = $this->request->get('page', ['int'], 1);\n\t\t$entries = Entries::find();\t// \u306a\u3093\u304b\u305f\u304f\u3055\u3093\u53d6\u5f97\u3059\u308b(\u8fd4\u3063\u3066\u304f\u308b\u306e\u306f Ginq)\n\t\t\n\t\t// Ginq, \u30da\u30fc\u30b8\u5185\u8868\u793a\u6570, \u30da\u30fc\u30b8\u756a\u53f7\u3092\u6e21\u3059\n\t\t$paginator = new GinqPaginator([\n\t\t\t'data' => $entries,\n\t\t\t'limit' => $limit,\n\t\t\t'page' => $page_num,\n\t\t]);\n\t\t// \u4eca\u56de\u306e\u30da\u30fc\u30b8\u3092\u53d6\u5f97\n\t\t$page = $paginator->getPaginate();\n\t\t$this->view->setVar('page', $page);\n\t}\n\n}\n```\n\n```html:entries.volt\n{{ page.current }} <!-- \u4eca\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.before }} <!-- \u524d\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.next }} <!-- \u6b21\u306e\u30da\u30fc\u30b8\u756a\u53f7 -->\n{{ page.total_pages }} <!-- \u4f55\u30da\u30fc\u30b8\u3042\u308b\u304b -->\n{{ page.total_items }} <!-- \u5168\u90e8\u3067\u3044\u304f\u3064\u3042\u308b\u304b -->\n<ul>\n  {% for entry in page.items %} <!-- \u30da\u30fc\u30b8\u5185\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u30a4\u30c6\u30ec\u30fc\u30c8 -->\n    <li>{{ entry.title }}</li>\n  {% endfor %}\n</ul>\n```\n"}