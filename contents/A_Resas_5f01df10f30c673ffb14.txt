{"tags": ["Linux", "Network", "mpls"], "context": "\n\n\u306f\u3058\u307e\u308a\u306e\u3054\u3042\u3044\u3055\u3064\n\u3042\u3089\u308c\u3055(@A_Resas)\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u306fLinux Advent Calendar 2016\u306e12\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\n\u3053\u306e\u5ea6Advent Calender\u3068\u3044\u3046\u3082\u306e\u306b\u6295\u7a3f\u3057\u305f\u304f\u306a\u308a\u3001Linux\u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u5f97\u610f\u5206\u91ce\u3067\u66f8\u3044\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u305f\u3002\u4ee5\u524d\u3001Linux\u304cMPLS\u306e\u5bfe\u5fdc\u3092\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u8a18\u4e8b\u3092\u767a\u898b\u3057\u3001\u3069\u3046\u52d5\u304f\u306e\u304b\u6c17\u306b\u306a\u308b\u306a\u3041\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\u3067\u3054\u3056\u308b\u306e\u5dfb\u3001\u3067\u3042\u308a\u307e\u3059\uff01\n\nMPLS\u3068\u306f\u306a\u3093\u3067\u3057\u3087\u3046\u304b\uff1f\nMPLS(Multi-Protocol Label Switching)\u3068\u306fL2\u30d8\u30c3\u30c0\u3068L3\u30d8\u30c3\u30c0\u306e\u9593\u306bShim\u30d8\u30c3\u30c0(\u901a\u79f0\u30e9\u30d9\u30eb\u30d8\u30c3\u30c0)\u3068\u547c\u3070\u308c\u308b\u30d8\u30c3\u30c0\u3092\u3064\u3051\u3066\u901a\u4fe1\u306e\u9ad8\u901f\u5316\u3057\u3061\u3083\u3046\u3093\u3060\u305c\u306a\u6b21\u4e16\u4ee3\uff08\u3068\u3044\u3046\u306b\u306f\u5e83\u307e\u3063\u3066\u304b\u3089\u6642\u9593\u304c\u7d50\u69cb\u7d4c\u904e\u3057\u3066\u3044\u308b\u304c\u7b11\uff09\u306e\u30d0\u30c3\u30af\u30dc\u30fc\u30f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6280\u8853\u3067\u3059\u3002\u65e5\u672c\u8a9e\u3067\u306fYahoo!\u3055\u3093\u3084net one\u3055\u3093\u304f\u3089\u3044\u3057\u304b\u8aac\u660e\u3059\u308b\u30b5\u30a4\u30c8\u304c\u306a\u3044\u306e\u3067\u307e\u3041\u65e5\u672c\u3058\u3083\u6b21\u4e16\u4ee3\u3067\u306f\u7b11\n\u30a2\u30d7\u30ea\u5c4b\u306e\u65b9\u3067\u3082VLAN\u3084OSPF\u3068\u304b\u306a\u3089\u77e5\u3063\u3066\u308b\u305e\uff5e\u307f\u305f\u3044\u306a\u4eba\u3082\u3044\u3089\u3063\u3057\u3083\u308b\u3067\u3057\u3087\u3046\u304c\u3001MPLS\u306f\u306a\u304b\u306a\u304b\u30de\u30a4\u30ca\u30fc\u306a\u306e\u3067\u77e5\u3089\u306a\u3044\u65b9\u3082\u591a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u5168\u304f\u610f\u5473\u4e0d\u660e\u306a\u72b6\u614b\u3067\u305f\u3060\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3092\u898b\u305b\u3089\u308c\u3066\u3082\u5fae\u5999\u3067\u3057\u3087\u3046\u304b\u3089\u3001\u304b\u308b\uff5e\u304f\u8aac\u660e\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3068\u8a00\u3044\u3064\u3064\u30ac\u30c3\u30c4\u30ea\u8aac\u660e\u3092\u66f8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001\u304a\u6642\u9593\u306b\u9650\u308a\u306e\u3042\u308b\u65b9\u306f\u300c\u5b9f\u884c\u74b0\u5883\uff01\u300d\u307e\u3067\u98db\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n\u57fa\u672c\u7684\u306bRIP\u3084OSPF\u3084BGP\u7b49\u306e\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u3068\u306b\u3082\u304b\u304f\u306b\u3082\u4ee5\u4e0b\u306e\u30eb\u30fc\u30eb\u3092\u5b88\u308a\u307e\u3059\u3002\n\u2460\u81ea\u5206\u914d\u4e0b\u306b\u3044\u308b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u7d4c\u8def\u60c5\u5831\u3092\u81ea\u5206\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u8868\u306b\u66f8\u304f\u3002\n\u2461\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u540c\u3058\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3068\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2462\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u305d\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u5f93\u3044\u3001\u3088\u308a\u5b9b\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u4f3c\u3066\u308b\u7d4c\u8def\u3092\u6301\u3063\u3066\u308b\u3068\u66f8\u3044\u3066\u3042\u308b\u96a3\u306e\u30eb\u30fc\u30bf\uff08\u3082\u3057\u304f\u306f\u81ea\u5206\u914d\u4e0b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\uff09\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u3002\n\u57fa\u672c\u7684\u306b\u901a\u5e38\u306eIP\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3053\u306e\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u307e\u3059\u3002\n\n\u56e0\u307f\u306bCisco IOS\u7b49\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\nProtocols\nPrefix\nNext Hop\nOutgoing\n\n\n\n\nC\n12.0.0.0/24\nis directly connected\nEthernet3/2\n\n\nL\n12.0.0.2/32\nis directly connected\nEthernet3/2\n\n\nO\n14.0.0.0/24\nvia 12.0.0.1\nEthernet3/2\n\n\nO\n15.0.0.0/24\nvia 25.0.0.3\nEthernet4/4\n\n\nC\n23.0.0.0/24\nis directly connected\nEthernet3/3\n\n\nL\n23.0.0.1/32\nis directly connected\nEthernet3/3\n\n\nC\n25.0.0.0/24\nis directly connected\nEthernet4/4\n\n\nL\n25.0.0.1/32\nis directly connected\nEthernet4/4\n\n\nO\n35.0.0.0/24\nvia 25.0.0.3\nEthernet4/4\n\n\n\n\u4f8b\u3048\u3070\u3067\u3059\u304c\u3001\u8868\u306e\u4e00\u756a\u4e0a\u306e\u8a18\u8ff0\u306f\u300c12.0.0.0/24\u300d\u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u300cis directly connected\u300d\u3001\u3064\u307e\u308a\u3053\u306e\u30eb\u30fc\u30bf\u306e\u76f4\u4e0b\u306b\u3042\u308a\u3001\u300cEthernet3/2\u300d\u304c\u305d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u7e4b\u304c\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u4e8b\u3092\u793a\u3057\u307e\u3059\u3002\n\u4e00\u65b9\u3001\u300c14.0.0.0/24\u300d\u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u300cvia 12.0.0.1\u300d\u3001\u3064\u307e\u308a\u3053\u306e12.0.0.1\u3068\u3044\u3046IP\u30a2\u30c9\u30ec\u30b9\u306e\u5148\u306b\u3042\u308a\u3001\u305d\u3053\u3078\u306f\u300cEthernet3/2\u300d\u3092\u4ecb\u3057\u3066\u6295\u3052\u308b\u3068\u3044\u3046\u610f\u5473\u5408\u3044\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\u4e00\u65b9\u3001MPLS\u3092\u4f7f\u3063\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3053\u306e\u30eb\u30fc\u30eb\u3092\u6539\u9020\u3057\u3066\u57fa\u672c\u7684\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u6295\u3052\u307e\u3059\u3002\n\u2460\u81ea\u5206\u914d\u4e0b\u306b\u3044\u308b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u7d4c\u8def\u60c5\u5831\u3092\u81ea\u5206\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u8868\u306b\u66f8\u304f\u3002\n\u2461\u305d\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u5143\u306b\u300c\u7d4c\u8def\u60c5\u5831\u300d\u3092\u300c\u30e9\u30d9\u30eb\u306e\u756a\u53f7\u300d\u3068\u3057\u305f\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u66f8\u304f\u3002\n\u2462\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u540c\u3058\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3068\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2463\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u30e9\u30d9\u30eb\u306e\u756a\u53f7\u3082\u30e9\u30d9\u30eb\u4ea4\u63db\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3092\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2464\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u5f93\u3044\u3001\u5b9b\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u5bfe\u5fdc\u4ed8\u3051\u3089\u308c\u3066\u5e83\u544a\u3055\u308c\u3066\u304d\u305f\u30e9\u30d9\u30eb\u756a\u53f7\u306b\u5f93\u3044\u3001\u305d\u306e\u756a\u53f7\u3092\u5e83\u544a\u3057\u3066\u304d\u305f\u96a3\u306e\u30eb\u30fc\u30bf\uff08\u3082\u3057\u304f\u306f\u81ea\u5206\u914d\u4e0b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\uff09\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u3002\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\u66f4\u306b\u7815\u3044\u3066\u8a00\u3046\u306e\u3067\u3042\u308c\u3070RIP\u3084OSPF\u3084BGP\u304c\u8d70\u3063\u3066\u3044\u308b\u30eb\u30fc\u30bf\u304c\u300c\u57fa\u672c\u7684\u306b\u306f\u3001\u3088\u308a\u8fd1\u3044\uff08Metric,Longest Match\u7b49\uff09\u5b9b\u5148\u306e\u7d4c\u8def\u60c5\u5831\u3092\u6301\u3063\u3066\u308b\u30eb\u30fc\u30bf\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300d\u306b\u5bfe\u3057\u3066\u3001MPLS\u4e0a\u306e\u30eb\u30fc\u30bf\u306f\u300c\u4e8b\u524d\u306b\u5b9b\u5148\u306e\u7d4c\u8def\u60c5\u5831\u306b\u5bfe\u3057\u3066\u30e9\u30d9\u30eb\u756a\u53f7\u3092\u3064\u3051\u3066\u304a\u304d\u3001\u6295\u3052\u3089\u308c\u3066\u304d\u305f\u30e9\u30d9\u30eb\u756a\u53f7\u306b\u5f93\u3044\u3001\u6b21\u306e\u30eb\u30fc\u30bf\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300d\u3068\u3044\u3046\u52d5\u304d\u3092\u3059\u308b\u308f\u3051\u3067\u3059\u3002\n\u3053\u308c\u3092\u3059\u308b\u4e8b\u3067\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u898b\u3066\u51c4\u3044\u3044\u3063\u3071\u3044\u3042\u308b\u7d4c\u8def\u60c5\u5831\u306e\u4e2d\u304b\u3089\u3001\u4e00\u756a\u8fd1\u3044\u7d4c\u8def\u3092\u6301\u3063\u3066\u308b\u30eb\u30fc\u30bf\u306f\u3069\u308c\u304b\u306a\u30fb\u30fb\u30fb\u30fb\u306a\u3093\u3066\u8003\u3048\u305a\u306b\u3001\u3053\u306e\u5b9b\u5148\u306f\u3053\u306e\u756a\u53f7\uff01\u3070\u3057\u3085\u3093\uff01\u3068\u6295\u3052\u308c\u3070\u826f\u304f\u306a\u308a\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u9ad8\u901f\u5316\u3092\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08\u672c\u5f53\u306f\u30d1\u30c8\u30ea\u30b7\u30a2\u30c4\u30ea\u30fc\u306e\u539f\u7406\u304b\u3089\u8aac\u660e\u3057\u305f\u3044\u3067\u3059\u304c\u3001\u30b9\u30da\u30fc\u30b9\u306e\u95a2\u4fc2\u4e0a\u3001\u304b\u306a\u308a\u7c21\u6f54\u306b\u66f8\u304d\u307e\u3057\u305f\u30fb\u30fb\u30fb\u30fb\uff09\u3002\n\n\u56e0\u307f\u306bCisco IOS\u7b49\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\nLocal Lable\nOutgoing   Lable\nPrefix\nOutgoing IF\nNext Hop IF\n\n\n\n\n16\nPop Label\n59.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n17\nPop Label\n57.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n18\nPop Label\n56.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n19\nPop Label\n36.0.0.0/24\nEt3/3\n23.0.0.2\n\n\n20\nPop Label\n35.0.0.0/24\nEt3/3\n23.0.0.2\n\n\n\nPop Label\n35.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n21\nPop Label\n15.0.0.0/24\nEt3/2\n12.0.0.1\n\n\n22\nPop Label\n14.0.0.0/24\nEt3/2\n12.0.0.1\n\n\n23\nPop Label\n100.0.0.0/24\nEt3/2\n12.0.0.1\n\n\n24\n24\n69.0.0.0/24\nEt3/3\n23.0.0.2\n\n\n\n19\n69.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n25\n23\n200.0.0.0/24\nEt3/3\n23.0.0.2\n\n\n\n20\n200.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n26\n26\n47.0.0.0/24\nEt3/2\n12.0.0.1\n\n\n\n23\n47.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n27\n22\n78.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n28\n21\n89.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n30\nPop Label\n58.0.0.0/24\nEt4/4\n25.0.0.3\n\n\n\n\u4f8b\u3067\u306f\u3001\u4e0b\u304b\u3089\u4e09\u756a\u76ee\u3001\u300c78.0.0.0/24 \u300d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5bfe\u3057\u3066\u306f\u3001Local Label\u300c27\u300d\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u96a3\u63a5\u30eb\u30fc\u30bf\u304c\u5b9b\u5148\u300c78.0.0.0/24\u300d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5411\u3051\u3066\u81ea\u5206\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u969b\u306b\u3053\u306e\u6570\u5b57\u3092\u3064\u3051\u3066\u6765\u307e\u3059\uff08\u3068\u3044\u3046\u4e8b\u304c\u65e2\u306b\u5206\u304b\u3063\u3066\u3044\u307e\u3059\uff09\u3002\u305d\u3046\u3057\u305f\u3089Outgoing Lable\u300c22\u300d\u3092\u3064\u3051\u3066\u6295\u3052\u308b\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\u4e00\u756a\u53f3\u306e\u4e8c\u3064\u306f\u300c78.0.0.0/24\u300d\u306b\u5411\u304b\u3046\u306b\u306f\u81ea\u5206\u306e\u30eb\u30fc\u30bf\u306eIF\uff08Outgoing IF\uff09Et4/4\u304b\u3089\u3001\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u30a2\u30c9\u30ec\u30b925.0.0.3\u306b\u6295\u3052\u308c\u3070\u826f\u3044\u3068\u66f8\u3044\u3066\u307e\u3059\u3002\n\u3053\u308c\u3092\u307e\u3068\u3081\u308b\u3068\u3053\u306e\u30eb\u30fc\u30bf\u306f\u3001\n\u300e\u30e9\u30d9\u30eb\u756a\u53f727\u3092\u3064\u3051\u3066\u6295\u3052\u3066\u304d\u305fMPLS\u30d1\u30b1\u30c3\u30c8\u306b\u306f\u3001\u30e9\u30d9\u30eb\u756a\u53f722\u3064\u3051\u3066Et4/4\u304b\u3089\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d725.0.0.3\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300f\u3068\u8aad\u307f\u53d6\u308c\u308b\u308f\u3051\u3067\u3059\u3002\u5b9f\u969b\u306b\u6295\u3052\u308b\u969b\u306b\u306f\u30e9\u30d9\u30eb\u3057\u304b\u30eb\u30fc\u30bf\u306f\u898b\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3053\u308c\u3067\u5206\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\uff08\u305f\u3060\u3001LDP\u7b49\u3067\u30e9\u30d9\u30eb\u60c5\u5831\u3092\u96a3\u63a5\u540c\u58eb\u3067\u4ea4\u63db\u3059\u308b\u969b\u306b\u306f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5f15\u7528\u3059\u308b\u3068\u3044\u3046\u4e8b\u306f\u5fd8\u308c\u305a\u306b\uff09\u3002\n\n\n\u203bMPLS\u754c\u9688\u3067\u306f\u3001\u30e9\u30d9\u30eb\u3092\u3064\u3051\u308b\u4e8b\u3092\u300cPush\u300d\u3001\u30e9\u30d9\u30eb\u3092\u5916\u3059\u4e8b\u3092\u300cPop\u300d\u3001Pop\u3068Push\u3092\u4f75\u305b\u3066\u30e9\u30d9\u30eb\u3092\u9055\u3046\u3082\u306e\u306b\u4ea4\u63db\u3059\u308b\u3053\u3068\u3092\u300cSwap\u300d\u3068\u3044\u3044\u307e\u3059\u3002\u899a\u3048\u3066\u304a\u304f\u3068\u82f1\u6587\u3092\u8aad\u3080\u969b\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n\u203b\u4e0a\u306e\u8a18\u8ff0\u306b\u3088\u308a\u52d8\u306e\u826f\u3044\u65b9\u306f\u304a\u6c17\u3065\u304d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4e0a\u306e\u8868\u306e\u300cPop Lable\u300d\u3053\u308c\u306f\u300c\u30e9\u30d9\u30eb\u3092\u4f55\u3082\u3064\u3051\u305a\u306b\u6295\u3052\u308b\u300d\u4e8b\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u30eb\u30fc\u30bf\u304cMPLS\u7db2\u306e\u30a8\u30c3\u30b8\u3060\u3063\u305f\u5834\u5408\u3001\u305d\u306e\u5148\u306fIP\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306a\u308aEthernet\u306a\u308aPPP\u3067\u98db\u3070\u305b\u308b\u306e\u3067\u30e9\u30d9\u30eb\u3064\u3051\u308b\u5fc5\u8981\u304c\u306a\u3044\u3088\u306d\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\u53c2\u8003\uff1ahttp://www.itbook.info/study/mpls4.html\n\n\n\u306a\u3093\u3068\u306a\u3041\u304f\u5206\u304b\u3063\u3066\u305f\u3088\u3046\u306a\uff1f\n\u3068\u308a\u3042\u3048\u305a\u300c\u306a\u3093\u304bOSPF\u3068\u304b\u3088\u308a\u3064\u3048\u30fc\u3084\u3064\u306a\u3093\u3060\u3041\uff01\u300d\u300c\u6570\u5b57\u898b\u3066\u6295\u3052\u308b\u3063\u3066\u3060\u3051\u3067\u901f\u304f\u306a\u308b\u3063\u3066\u610f\u5916\u3068\u4eca\u307e\u3067\u306e\u30eb\u30fc\u30bf\u3063\u3066\u304a\u30d0\u30ab\u3055\u3093\u3060\u3063\u305f\u306e\uff1f\u300d\u307f\u305f\u3044\u306b\u601d\u3048\u305f\u3089\u3044\u3044\u3093\u3060\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u305d\u3082\u305d\u3082MPLS\u306a\u3093\u3066\u305f\u3060\u306eIP\u7db2\u306b\u88ab\u305b\u308b\u5f62\u3067\u5b9f\u73fe\u3059\u308b\u7656\u306b\u306a\u3093\u3067\u901f\u304f\u306a\u308b\u306e\uff1f\u8907\u96d1\u306b\u306a\u3063\u3066\u308b\u3058\u3083\u3093\u7b49\u3001\u305d\u3046\u3044\u3046\u306e\u304c\u6c17\u306b\u306a\u308b\u4eba\u306f\u8abf\u3079\u308b\u3068\u6df1\u6df5\u306b\u5165\u308c\u307e\u3059\u306e\u3067\u662f\u975e\uff09\u3002\u3055\u3066\u3001\u3053\u3063\u304b\u3089\u672c\u984c\u306b\u623b\u3063\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5b9f\u884c\u74b0\u5883\uff01\n\u4eca\u56de\u306e\u691c\u8a3c\u74b0\u5883\u306e\u57fa\u76e4\u306b\u306f\u5225\u306b\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306a\u3093\u3066\u6e2c\u3089\u306a\u3044\u3057\u30011\u304b\u3089\u30aa\u30f3\u30d7\u30ec\u3067\u7acb\u3066\u308b\u306e\u306f\u3057\u3093\u3069\u3044\u306e\u3067\u3001\u4eee\u60f3\u74b0\u5883\u3092\u4f7f\u3044\u79c1\u306f\u30d1\u30bd\u30b3\u30f3\u4e00\u53f0\u3067\u5168\u3066\u3084\u308a\u304d\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u7b11\n\n\u4f7f\u7528\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\n[\u30db\u30b9\u30c8PC]\n\u30fbWindows 10\n\u30fbGNS3 -version 1.5.1 on Windows (64-bit) with Python 3.5.1 Qt 5.6.0-\n\u30fbOracle VirtualBox -version 5.1.8 r111374 (Qt5.5.1)-\n[\u30b2\u30b9\u30c8VM]\n\u30fbUbuntu16.04LTS -kernel version 4.60-\n\u30fbWireshark -version 2.0.2-\n\u30fbiproute  -version 4.4.0-1vyos2 -\n\u30fbiproute2 -version 4.4.0-1vyos2-\n\u30fbmpls_gso(modprobe)\n\u30fbmpls_router(modprobe)\n\u30fbmpls_iptunnel(modprobe)\n\u691c\u8a3c\u74b0\u5883\u306e\u30c8\u30dd\u30ed\u30b8\u30fc\u306f\u4e0b\u306b\u8a18\u3057\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306e\u69cb\u6210\u3067\u3059\u304c\u3001\u3084\u3084\u8907\u96d1\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u84cb\u3092\u958b\u3051\u3066\u307f\u308c\u3070\u3001Ubuntu\u30922\u53f0GNS3\u306e\u4e2d\u306b\u4f5c\u308a\u3001Ubuntu\u306e\u4e2d\u306bnetns\u306e\u4eee\u60f3\u7a7a\u9593\u3092\u4f5c\u3063\u3066\u3044\u308b\u3060\u3051\u3067\u3054\u3056\u3044\u307e\u3059\u3002netns on Ubuntu on GNS3\u307f\u305f\u3044\u306a\uff1f\u7b11\n\u5b9f\u306f\u3088\u304f\u3088\u304f\u4e16\u306eLinux\u306eMPLS\u306e\u5148\u99c6\u8005\u306e\u65b9\u3005\u306e\u30d6\u30ed\u30b0\u3092\u898b\u308b\u3068\u3001\u300c\u30e9\u30d9\u30eb\u3092Pop\u300d\u3068\u300c\u30e9\u30d9\u30eb\u3092Push\u300d\u307e\u3067\u306f\u3084\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u300c\u30e9\u30d9\u30eb\u3092Swap\u300d\u307e\u3067\u3084\u3063\u3066\u3044\u308b\u30d6\u30ed\u30b0\u306f\u6d77\u5916\u542b\u3081\u79c1\u306f\u4eca\u306e\u3068\u3053\u308d\u767a\u898b\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u7b11\uff08Pop\u3001Push\u3001Swap\u306b\u95a2\u3057\u3066\u306f\u524d\u8ff0\uff09\u3002\n\u305f\u3060\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u691c\u8a3c\u3092\u4e38\u30d1\u30af\u30ea\u3092\u3059\u308b\u306e\u3082\u306a\u3093\u3067\u3059\u3057\u3001\u3053\u306e\u300c\u30e9\u30d9\u30eb\u3092Swap\u300d\u3064\u307e\u308a\u30e9\u30d9\u30eb\u4ea4\u63db\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\uff01\u3068\u3044\u3046\u306e\u304c\u4eca\u56de\u306e\u691c\u8a3c\u306e\u5927\u9805\u76ee\u3067\u3042\u308a\u307e\u3059\uff01\n\n\u3082\u3063\u3068\u3082\u3001\u4eca\u56de\u3084\u308bMPLS\u306f\u300eStatic MPLS\u300f\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\u53c2\u8003:http://www.networkers-online.com/blog/2009/01/static-routes-label-mapping-in-mpls/\n\u666e\u901a\u3001Google\u3067MPLS\u3092\u691c\u7d22\u3059\u308b\u3068\u305f\u3044\u3066\u3044\u306f\u300eLDP\u300f\u3084\u300eRSVP\u300f\u3068\u3044\u3046\u52d5\u7684\u306b\u30e9\u30d9\u30eb\u60c5\u5831\u3092\u4ea4\u63db\u3059\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30bb\u30c3\u30c8\u3067\u69cb\u7bc9\u3059\u308b\u524d\u63d0\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u304c\u76ee\u306b\u3044\u304f\u3068\u304a\u3082\u3044\u307e\u3059\u3002\u4e00\u65b9\u3001\u3053\u306e\u300eLDP\u300f\u3084\u300eRSVP\u300f\u3092\u4f7f\u308f\u306a\u3044\u3067\u3001\u7d4c\u8def\u306b\u76f4\u63a5\u624b\u6253\u3061\u3067\u30e9\u30d9\u30eb\u60c5\u5831\u3068\u7d4c\u8def\u60c5\u5831\u3092\u30ea\u30f3\u30af\u3055\u305b\u3066\u3057\u307e\u3046\u306e\u304c\u300eStatic MPLS\u300f\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u3042\u304f\u307e\u3067MPLS\u306e\u52d5\u304d\u3060\u3051\u898b\u305f\u3044\u3057\u3001Quagga\u306eLDP\u30c7\u30fc\u30e2\u30f3\u306f\u307e\u3060\u958b\u767a\u7248\u3067\u3059\u306e\u3067\u3001\u300eStatic MPLS\u300f\u3067\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u56e0\u307f\u306bStatic\u306e\u65b9\u304c\u6bb5\u9055\u3044\u3067\u8a2d\u8a08\u304c\u9762\u5012\u3067\u3059\u7b11\n\n\n\u3068\u306b\u304b\u304f\u3084\u3063\u3066\u3044\u304f\u306e\u3060\u3041\n\u3068\u308a\u3042\u3048\u305aVirtualbox\u3068GNS3\u306e\u304f\u3060\u308a\u306f\u672c\u984c\u304b\u3089\u5927\u5e45\u306b\u305a\u308c\u308b\u306e\u3067\u98db\u3070\u3057\u307e\u3059\u3002\nVirtualbox\u3067Ubuntu\u30922\u53f0\u3064\u304f\u308a\u30fc\u306e\u3001GNS3\u3067Ubuntu\u30922\u53f0\u3064\u306a\u304e\u30fc\u306e\u3001\u30c8\u30c4\u30ae\u30fc\u30ce\u3067\u3054\u3056\u3044\u307e\u3059\u308b\uff01\u7b11\n\n\u3068\u308a\u3042\u3048\u305a\u3074\u3083\u3074\u3083\u3063\u3068\u4eee\u60f3\u74b0\u5883\u3092\u7acb\u3066\u3066\u3057\u307e\u3044\u3001\u6b21\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u524d\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u3092\u3057\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\n\u4e8b\u524d\u6e96\u5099\u3067\u306fUbunu2\u53f0\u5206\u540c\u3058\u4e8b\u3092\u3057\u307e\u3059\u306e\u3067\u305d\u306e\u3064\u3082\u308a\u3067(\u2267\u25bd\u2266)\n\u307e\u305a\u306f\u4eca\u56de\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066mpls_router\u3092\u8aad\u307f\u8fbc\u3080\u3068\u3057\u307e\u3059\u3002\n\u3067\u3059\u304c\u305d\u3082\u305d\u3082Linux\u30ab\u30fc\u30cd\u30eb\u3068\u3057\u3066\u306e\u30b5\u30dd\u30fc\u30c8\u3068\u3057\u3066MPLS Multipath\u3068\u304b\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305f\u306e\u306fv4.3\u304b\u3089\u3060\u3068\u304b\u3001git.kernel.org\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\u304a\u3063\u3068\u3061\u3087\u3046\u3069\u3044\u3044\u3068\u3053\u308d\u306b\u3001\u79c1\u306e\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u306bv4.6\u306eURL\u304c\u30e1\u30e2\u3063\u3066\u3042\u3063\u305f\u306e\u3067\u305d\u306e\u30ab\u30fc\u30cd\u30eb\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u7b11\u3000(\u3053\u306e\u30b5\u30a4\u30c8\u306b\u306fv4.3\u4ee5\u4e0a\u3067\u3084\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3088\uff5e\u3063\u3066\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u591a\u52064.4\u3068\u304b\u306a\u3089\u3044\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u9069\u5f53)\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600_4.6.0-040600.201606100558_all.deb\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600-generic_4.6.0-040600.201606100558_amd64.deb\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-image-4.6.0-040600-generic_4.6.0-040600.201606100558_amd64.deb\n# dpkg -i *.deb\n# update-grub \n# reboot\n\n\nuname\nLinux ubuntu01-VirtualBox 4.6.0-040600-generic #201606100558 SMP Fri Jun 10 10:01:15 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\n\n\u30ab\u30fc\u30cd\u30eb\u3092v4.60\u306b\u3057\u307e\u3057\u305f\u3002\n\u66f4\u306b\u4eca\u56deiproute\u53ca\u3073iproute2\u3092\u65b0\u3057\u3044\u3082\u306e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u6b64\u65b9\u306e\u30b5\u30a4\u30c8\u304b\u3089\u3001vyos/vyos-iproute\u306eiproute\u3001iproute2\u306eversion4.40\u3092\u9802\u6234\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n# wget https://github.com/higebu/vyatta-iproute/releases/download/debian%2F4.4.0-1vyos2/iproute_4.4.0-1vyos2_all.deb\n# wget https://github.com/higebu/vyatta-iproute/releases/download/debian%2F4.4.0-1vyos2/iproute2_4.4.0-1vyos2_amd64.deb\n# dpkg -i iproute_4.4.0-1vyos2_all.deb\n# dpkg -i iproute2_4.4.0-1vyos2_amd64.deb\n\n\ndpkg\n# dpkg -l | grep iproute\nii  iproute                                              1:4.4.0-1vyos2                                all          transitional dummy package for iprout2\nii  iproute2                                             1:4.4.0-1vyos2                                amd64        networking and traffic control tools\nii  iproute2-doc                                         4.3.0-1ubuntu3                                all          networking and traffic control tools - documentation\n\n\niproute\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n\u6b21\u306b\u5fc5\u8981\u306a\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n# sudo modprobe mpls_gso\n# sudo modprobe mpls_router\n# sudo modprobe mpls_iptunnel\n\n\u5c1a\u30ab\u30fc\u30cd\u30eb\u3092v4.60\u306b\u3057\u3066\u3044\u308c\u3070\u3001\u4eca\u56de\u306f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u518d\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u308a\u3001\u306a\u3093\u3066\u4e8b\u306f\u767a\u751f\u3057\u307e\u305b\u3093\u306e\u3067\u3054\u5b89\u5fc3\u3092\u3002\n\u3064\u3044\u3067\u3001\u30e9\u30d9\u30eb\u306e\u6700\u5927\u5024\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u5b9f\u306f\u3053\u308c\u306fMPLS\u306e\u30e9\u30d9\u30eb\u3092\u751f\u6210\u3059\u308b\u306e\u306b\u5fc5\u9808\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3068\n\nmpls_router\u3092\u8aad\u307f\u8fbc\u3080\u3068 /proc/sys/net/mpls \u4ee5\u4e0b\u304c\u3067\u304d\u308b\u3002platform_labels \u306f MPLS \u306e\u30e9\u30d9\u30eb\u3067\u6271\u3046\u6570\u5b57\u306e\u6700\u5927\u5024\u3092\u6c7a\u3081\u308b\u3002\u2026\u3053\u308c\u5236\u9650\u3059\u308b\u5fc5\u8981\u6027\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3051\u308c\u3069\u3001\u4e00\u822c\u7684\u306aMPLS \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30eb\u30fc\u30bf\u3067\u306f\u8a2d\u5b9a\u3059\u308b\u3082\u306e\u304c\u591a\u3044\u69d8\u5b50\u3002\u3068\u308a\u3042\u3048\u305a 64 \u3042\u305f\u308a\u306b\u3057\u3066\u307f\u305f\u3002\u3044\u305a\u308c\u306b\u305b\u3088 mpls \u306e\u6700\u5927\u5024\u306f 20bit \u3092\u8d85\u3048\u3089\u308c\u306a\u3044\u3002\u305d\u308c\u304b\u3089 0--15 \u306f\u4e88\u7d04\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n(\u53c2\u8003:http://qiita.com/kwi/items/bccf38b69e089b729da9)\n\n\u3068\u3044\u3046\u4e8b\u3089\u3057\u3044\u3067\u3059\u306e\u3067\u3001\u307e\u3001\u6c17\u5206\u30671000\u306b\u3057\u307e\u3059\u3002\n\u3068\u3053\u308d\u3067Cisco\u306eIOS\u3067\u306f\u30e9\u30d9\u30eb\u306e\u6700\u5927\u5024\u306f\u8a2d\u5b9a\u3057\u307e\u3059\u304cCisco IOS XR\u3084juniper SRX\u3068\u304b\u3067\u306f\u8a2d\u5b9a\u306f\u5fc5\u8981\u306a\u304b\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u307e\u3001\u3044\u3044\u3084\u3002\n# echo 1000 > /proc/sys/net/mpls/platform_labels\n\n\u5b9f\u969b\u306b\u306f\u3001MPLS\u306f20bit\u3067\u3059\u306e\u3067\u300116-1048576\u307e\u3067\u6307\u5b9a\u53ef\u80fd\u3067\u3059\u306e\u3067\u3001100\u4e07\u500b\u304f\u3089\u3044\u306e\u7d4c\u8def\u306b\u306f\u8a2d\u5b9a\u53ef\u80fd\u3068\u306a\u308b\u308f\u3051\u3067\u3059\u306d\u3002\n\u6b21\u306b\u3001\u4eca\u56de\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u57fa\u76e4\u3068\u306a\u308b\u4ee5\u4e0b\u306enetns\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u3053\u304b\u3089\u306fUbuntu2\u53f0\u305d\u308c\u305e\u308c\u5206\u3051\u3066\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n\nnetns(netns\u306eman\u30da\u30fc\u30b8\u306f\u30b3\u30c1\u30e9)\u3068\u306f\u306a\u3093\u3060\u3089\u30db\u30a4\u3001\u3068\u601d\u3063\u305f\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://kernhack.hatenablog.com/entry/2014/12/09/000827\n\u4eee\u60f3\u30db\u30b9\u30c8\u4f5c\u6210\u53ca\u3073\u4eee\u60f3NIC\u4f5c\u6210\u304c\u51fa\u6765\u308b\u512a\u308c\u3082\u306e\u3067\u3042\u308a\u3001veth\u3084namespace\u7b49\u306fopenstack\u3084docker\u7b49\u3067\u4f7f\u308f\u308c\u308b\u6280\u8853\u3067\u3042\u308a\u307e\u3057\u3066\u3001\u304b\u306a\u308aLinux\u306e\u30ab\u30fc\u30cd\u30eb\u6e96\u62e0\u306a\u4eee\u60f3\u5316\u6280\u8853\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002namespace\u3092\u4e3b\u306b\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u307e\u3001VM\u3068\u3044\u3046\u3088\u308a\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u304b\u306d\u3002\n\u6c17\u8efd\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u3082\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u307e\u305f\u4f5c\u6210\u3057\u305f\u4eee\u60f3NIC\u306b\u5bfe\u3057\u3066tcpdump\u7b49\u3082\u52d5\u304d\u307e\u3059\u3002\u52d5\u4f5c\u3082\u5b89\u5b9a\u3057\u3066\u304a\u308a\u3001\u975e\u5e38\u306b\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u691c\u8a3c\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u8a00\u3048\u307e\u3059\u3002\n\n\n\u74b0\u5883\u8a2d\u8a08\n\u3068\u308a\u3042\u3048\u305a\u30b3\u30de\u30f3\u30c9\u3092\u3060\u3070\u30fc\u3063\u3068\u66f8\u304d\u307e\u3059\u3002\n\nubuntu01\n# ip link add veth0 type veth peer name veth1\n# sysctl -w net.mpls.conf.veth0.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n# ifconfig veth0 10.0.0.1/24 up\n# ip netns add host1\n# ip link set veth1 netns host1\n# ip netns exec host1 ifconfig lo 1.1.1.1/32 up\n# ip netns exec host1 ifconfig veth1 10.0.0.2/24 up\n\n\n\nubuntu02\n# ip link add veth2 type veth peer name veth3\n# sysctl -w net.mpls.conf.veth2.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n# ifconfig veth2 30.0.0.1/24 up\n# ip netns add host2\n# ip link set veth3 netns host2\n# ip netns exec host2 ifconfig lo 2.2.2.2/32 up\n# ip netns exec host2 ifconfig veth3 30.0.0.2/24 up\n\n\n\u74b0\u5883\u5468\u308a\u306fUbuntu01Ubuntu02\u3069\u3061\u3089\u3082\u5de6\u53f3\u5bfe\u79f0\u306a\u8a2d\u5b9a\u306a\u306e\u3067Ubuntu01\u3060\u3051\u3092\u4e2d\u5fc3\u306b\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\u307e\u305a\u3001\n# ip link add veth0 type veth peer name veth1\n# sysctl -w net.mpls.conf.veth0.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n\n\u3053\u3053\u3067\u306f\u4eee\u60f3NIC\u3067\u3042\u308bveth\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\nLinux\u754c\u9688\u3067\u306f\u307b\u307cvSwitch\u306b\u7f8e\u5473\u3057\u3044\u6240\u3092\u6301\u3063\u3066\u304b\u308c\u305fveth\u3067\u3059\u304c\u7b11 \u305f\u3060\u300c\uff12\u3064\u306e\u4eee\u60f3\u30ce\u30fc\u30c9\u3092\u4eee\u60f3\u7684\u306b\u3064\u306a\u3052\u308b\u300d\u3068\u3044\u3046\u30b6\u30fb\u30b7\u30f3\u30d7\u30eb\u306a\u52d5\u304d\u3092\u3057\u307e\u3059\u3002\n\u4e0a\u8a18\u3067\u306fveth0-1\u3068\u3044\u30462\u3064\u306e\u4eee\u60f3NIC\u3092\u304f\u3063\u3064\u3044\u305f\u72b6\u614b\u3067\u4f5c\u3063\u3066\u3042\u3052\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001veth\u3092\u4f5c\u308a\u7d42\u308f\u3063\u305f\u3089eth1\u3068veth0\u306bmpls\u306e\u30e9\u30d9\u30eb\u53d7\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u3064\u3044\u3067\u3001\n# ip netns add host1\n# ip link set veth1 netns host1\n# ip netns exec host1 ifconfig lo 1.1.1.1/32 up\n# ip netns exec host1 ifconfig veth1 10.0.0.2/24 up\n\n\u4f5c\u6210\u3057\u305fveth\u306b\u30a2\u30c9\u30ec\u30b9\u3092\u632f\u308a\u3001\u4eee\u60f3\u30db\u30b9\u30c8host1\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3064\u3044\u306bveth\u3068host\u3092\u63a5\u7d9a\u3057\u307e\u3059\u304c\u3001\u5c11\u3057\u308f\u304b\u308a\u306b\u304f\u3044\u70b9\u304c\u3042\u308a\u307e\u3059\u3002\nveth0\u306f\u4f5c\u6210\u3057\u305f\u6642\u306b\u65e2\u306b\u672c\u4f53\u306eUbuntu\u306b\u304f\u3063\u3064\u3044\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u5148\u306eveth1\u306f\u6d6e\u3044\u3066\u3044\u307e\u3059\u3002\n\u306e\u3067\u3001ip link set veth netns host\u3068\u3044\u3046\u5f62\u3067\u6d6e\u3044\u3066\u3044\u308bveth1\u3092\u4eee\u60f3host\u306b\u5dee\u3057\u8fbc\u307f\u3001\u305d\u306e\u5f8c\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u632f\u3063\u3066\u3044\u304f\u6d41\u308c\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u6700\u5f8c\u306b\u91cd\u8981\u306a\u6240\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3001\u3064\u307e\u308a\u30e9\u30d9\u30eb\u3092\u3064\u3051\u308b\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3044\u305f\u3057\u307e\u3059\u3002\u3053\u3053\u304b\u3089\u306fUbuntu02\u3068\u5171\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u8a08\u5168\u4f53\u3092\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u8a08\n\u305d\u3082\u305d\u3082\u3001\u4eca\u56de\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3059\u304c\u3001\u5927\u307e\u304b\u306a\u6d41\u308c\u3092\u4ee5\u4e0b\u306b\u8a18\u3057\u307e\u3057\u305f\u3002\n\n\n\u305d\u308c\u305e\u308c\u306e\u5f79\u5272\u3068\u3057\u3066\u3001\n\u2606\u5b9b\u51482.2.2.2\u306e\u5834\u5408\n\u4eee\u60f3host1\u21d2\u5b9b\u51482.2.2.2/32\u306e\u30d1\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u3001\u30e9\u30d9\u30eb101\u3092\u3064\u3051\u3066(Push!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d710.0.0.1\u306b\u6295\u3052\u308b\nUbuntu01\u21d2\u30e9\u30d9\u30eb101\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089111\u306b\u4ed8\u3051\u66ff\u3048\u3066(Pop+Push=Swap!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d720.0.0.2\u306b\u6295\u3052\u308b\nUbuntu02\u21d2\u30e9\u30d9\u30eb111\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30e9\u30d9\u30eb\u3092\u5916\u3057\u3066(Pop!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d730.0.0.2\u306b\u6295\u3052\u308b\n\u2606\u5b9b\u51481.1.1.1\u306e\u5834\u5408\n\u4eee\u60f3host2\u21d2\u5b9b\u51481.1.1.1/32\u306e\u30d1\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u3001\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u3066(Push!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d730.0.0.1\u306b\u6295\u3052\u308b\nUbuntu02\u21d2\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089211\u306b\u4ed8\u3051\u66ff\u3048\u3066(Pop+Push=Swap!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d720.0.0.1\u306b\u6295\u3052\u308b\nUbuntu01\u21d2\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30e9\u30d9\u30eb\u3092\u5916\u3057\u3066(Pop!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d710.0.0.2\u306b\u6295\u3052\u308b\n\u3068\u3044\u3046\u8a2d\u8a08\u306b\u3057\u3066\u3044\u304d\u307e\u3059\u308b\u3002\u3053\u308c\u3092\u8a2d\u5b9a\u306b\u53cd\u6620\u3059\u308b\u3068\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\nubuntu01\n# ip netns exec host1 ip route add 2.2.2.2/32 encap mpls 101 via inet 10.0.0.1\n# ip -f mpls route add 101 via inet 20.0.0.2 as 111\n# ip -f mpls route add 211 via inet 10.0.0.2 \n\n\n\nubuntu02\n# ip netns exec host2 ip route add 1.1.1.1/32 encap mpls 201 via inet 30.0.0.1\n# ip -f mpls route add 201 via inet 20.0.0.1 as 211\n# ip -f mpls route add 111 via inet 30.0.0.2 \n\n\n\u3055\u3066\u3001\u6700\u5f8c\u306b\u3061\u3083\u3093\u3068\u30a2\u30c9\u30ec\u30b9\u3084\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3044\u305f\u3057\u307e\u3059\u3002\n\nUbuntu01Interface\u60c5\u5831\n# ip addr\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:bb:53:39 brd ff:ff:ff:ff:ff:ff\n    inet 20.0.0.1/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:febb:5339/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 62:25:5e:be:b4:87 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6025:5eff:febe:b487/64 scope link \n       valid_lft forever preferred_lft forever\n\n# ip netns exec host1 ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/0 scope host lo\n       valid_lft forever preferred_lft forever\n    inet 1.1.1.1/32 scope global lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n5: veth1@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 3e:1e:b0:36:b7:f7 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.0.2/24 brd 10.0.0.255 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::3c1e:b0ff:fe36:b7f7/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\nUbuntu01\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u60c5\u5831\n# ip -M route\n101 as to 111 via inet 20.0.0.2 dev eth1 \n211 via inet 10.0.0.2 dev veth0 \n\n# ip netns exec host1 ip route\n2.2.2.2  encap mpls  101 via 10.0.0.1 dev veth1 \n10.0.0.0/24 dev veth1  proto kernel  scope link  src 10.0.0.2\n\n\n\nUbuntu02Interface\u60c5\u5831\n# ip addr\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:57:b9:5b brd ff:ff:ff:ff:ff:ff\n    inet 20.0.0.2/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fe57:b95b/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth2@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether fa:29:06:fc:29:26 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 30.0.0.1/24 brd 30.0.0.255 scope global veth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f829:6ff:fefc:2926/64 scope link \n       valid_lft forever preferred_lft forever\n\n# ip netns exec host2 ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/0 scope host lo\n       valid_lft forever preferred_lft forever\n    inet 2.2.2.2/32 scope global lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n5: veth3@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 3e:8b:48:f0:90:41 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 30.0.0.2/24 brd 30.0.0.255 scope global veth3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::3c8b:48ff:fef0:9041/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\nUbuntu02\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\n# ip -M  route\n111 via inet 30.0.0.2 dev veth2 \n201 as to 211 via inet 20.0.0.1 dev eth1 \n# ip netns exec host2 ip route\n1.1.1.1  encap mpls  201 via 30.0.0.1 dev veth3 \n30.0.0.0/24 dev veth3  proto kernel  scope link  src 30.0.0.2 \n\n\n\n\u3055\u3041\u3066\u691c\u8a3c\u306a\u306e\u3089\uff01\n\u691c\u8a3c\u306fPing\u3068Wireshark\u3067\u78ba\u8a8d\u3044\u305f\u3057\u307e\u3059\u3002\n\n\u308c\u3063\u3064\u3089\u758e\u901a\u78ba\u8a8d\u266a\n\nubuntu01\n# ip netns exec host1 ping 2.2.2.2 -I 1.1.1.1\nPING 2.2.2.2 (2.2.2.2) from 1.1.1.1 : 56(84) bytes of data.\n64 bytes from 2.2.2.2: icmp_seq=1 ttl=62 time=0.430 ms\n64 bytes from 2.2.2.2: icmp_seq=2 ttl=62 time=0.384 ms\n64 bytes from 2.2.2.2: icmp_seq=3 ttl=62 time=0.478 ms\n64 bytes from 2.2.2.2: icmp_seq=4 ttl=62 time=0.715 ms\n64 bytes from 2.2.2.2: icmp_seq=5 ttl=62 time=0.494 ms\n^C\n--- 2.2.2.2 ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 3998ms\nrtt min/avg/max/mdev = 0.384/0.500/0.715/0.114 ms\n\n\n\nubuntu02\n# ip netns exec host2 ping 1.1.1.1 -I 2.2.2.2\nPING 1.1.1.1 (1.1.1.1) from 2.2.2.2 : 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=62 time=0.536 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=62 time=1.06 ms\n64 bytes from 1.1.1.1: icmp_seq=3 ttl=62 time=0.530 ms\n64 bytes from 1.1.1.1: icmp_seq=4 ttl=62 time=1.16 ms\n64 bytes from 1.1.1.1: icmp_seq=5 ttl=62 time=0.570 ms\n^C\n--- 1.1.1.1 ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 4002ms\nrtt min/avg/max/mdev = 0.530/0.771/1.160/0.281 ms\n\n\n\u304a\uff5e\u758e\u901a\u51fa\u6765\u3066\u3044\u307e\u3059\u3002\n\n\u308c\u3063\u3064\u3089Wireshark\u266a\n\n\u2606\u5b9b\u51482.2.2.2\u306e\u30d1\u30b1\u30c3\u30c8\u3067Wireshark\uff01\n[host1]--[veth0]--[Ubuntu01]--[eth1]--[eth1]--[Ubuntu02]--[veth2]--[host2]\n\nTo2.2.2.2_Ubuntu01_veth0\n\n\u30e9\u30d9\u30eb101\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo2.2.2.2_Ubuntu01_eth1\n\n\u30e9\u30d9\u30eb111\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo2.2.2.2_Ubuntu02_eth1\n\n\u30e9\u30d9\u30eb111\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo2.2.2.2_Ubuntu02_veth2\n\n\u30e9\u30d9\u30eb\u3092Pop!\u3057\u3066\u304a\u308a\u307e\u3059\uff01\n\n\u2606\u5b9b\u51481.1.1.1\u306e\u30d1\u30b1\u30c3\u30c8\u3067Wireshark\uff01\n[host1]--[veth0]--[Ubuntu01]--[eth1]--[eth1]--[Ubuntu02]--[veth2]--[host2]\n\nTo1.1.1.1_Ubuntu02_veth2\n\n\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo1.1.1.1_Ubuntu02_eth1\n\n\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo1.1.1.1_Ubuntu01_eth1\n\n\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\nTo1.1.1.1_Ubuntu01_veth0\n\n\u30e9\u30d9\u30eb\u3092Pop\u3057\u3066\u304a\u308a\u307e\u3059\uff01\n\n\u30df\u30c3\u30b7\u30e7\u30f3\u30b3\u30f3\u30d7\u30ea\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30c8\uff01\uff01\uff01\u7b11\n\n\u304a\u308f\u308a\u306e\u3054\u3042\u3044\u3055\u3064\n\u3068\u3044\u3046\u308f\u3051\u3067netns\u5185\u3067MPLS\u306e\u30e9\u30d9\u30eb\u8cbc\u308a\u3092\u898b\u308b\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u5b9f\u306f\u3053\u308c\u3001\u6700\u521d\u30e9\u30d9\u30eb\u306empls_router\u306e\u30e9\u30d9\u30ebSwap\u306e\u8cc7\u6599\u304c\u3042\u307e\u308a\u306b\u3082\u7121\u3044\u4e0a\u306b\u3046\u307e\u304f\u3044\u304b\u305a\u3001\u4f5c\u3063\u3066\u306f\u58ca\u3057\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u306f\u30a8\u30e9\u30fc\u306e\u7e70\u308a\u8fd4\u3057\u3067\u7b11 \u6700\u5f8c\u306e\u6700\u5f8c\u307e\u3067\u7c98\u3063\u3066\u3044\u305f\u3089\u51fa\u6765\u4e0a\u304c\u3063\u305f\u6b21\u7b2c\u3067\u3059\u7b11\n\u4eca\u56de\u306f\u305f\u3060\u305f\u3060\u30e9\u30d9\u30eb\u3092PopPushSwap\u3055\u305b\u305f\u3060\u3051\u3068\u306a\u308a\u307e\u3059\u304c\u3001\n\u5b9f\u969b\u306b\u306fMPLS\u306e\u30e9\u30d9\u30eb\u306f\u9ad8\u901f\u5316\u4ee5\u5916\u306b\u3082RSVP\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u4e8b\u3067\u5e2f\u57df\u5236\u5fa1\u3092\u884c\u3046RSVP-TE\u3067\u3042\u3063\u305f\u308a\u3001MP-BGP\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u4e8b\u306b\u3088\u308aL2VPN\u3084L3VPN\u3068\u3057\u3066\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u3046\u3044\u3063\u305f\u3088\u3046\u306b\u4eca\u307e\u3067\u306f\u300c\u6700\u77ed\u7d4c\u8def\u3092\u9078\u3076\u300d\u3068\u3044\u3046\u4e8b\u3067\u504f\u3063\u3066\u3044\u305f\u308a\u3001VM\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308bVM\u79fb\u52d5\u306b\u3088\u308bARP\u89e3\u6c7a\u306b\u5207\u308a\u623b\u3057\u306b\u6642\u9593\u304b\u304b\u3063\u3066\u3044\u305f\u3082\u306e\u3092MPLS\u306b\u8272\u3005\u306a\u60c5\u5831\u3092\u8f09\u305b\u308b\u4e8b\u306b\u3088\u308a\u89e3\u6c7a\u51fa\u6765\u305f\u308a\u3068\u3001\u30e9\u30d9\u30eb\u3092\u305f\u3060\u8cbc\u308b\u3060\u3051\u4ee5\u5916\u306b\u3082MPLS\u306f\u6d3b\u8e8d\u51fa\u6765\u308b\u821e\u53f0\u306f\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\u3002\n\u305d\u3053\u306bLinux\u3068\u3057\u3066\u6700\u8fd1\u6a19\u6e96\u642d\u8f09\u3057\u3066\u304d\u305fMPLS\u3067\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3088\u308a\u67d4\u8edf\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u624b\u8efd\u306b\u3001\u6c4e\u7528\u7684\u306b\u4f7f\u308f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u4e8b\u3092\u671f\u5f85\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u307e\u305f\u305c\u3072\u3001MPLS\u306e\u5c0e\u5165\u3092\u3054\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u7b11\n##\u306f\u3058\u307e\u308a\u306e\u3054\u3042\u3044\u3055\u3064\n\u3042\u3089\u308c\u3055(@A_Resas)\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u306f[Linux Advent Calendar 2016](http://qiita.com/advent-calendar/2016/linux)\u306e12\u65e5\u76ee\u306e\u8a18\u4e8b\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u5ea6Advent Calender\u3068\u3044\u3046\u3082\u306e\u306b\u6295\u7a3f\u3057\u305f\u304f\u306a\u308a\u3001Linux\u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u898b\u3064\u3051\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u5f97\u610f\u5206\u91ce\u3067\u66f8\u3044\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u305f\u3002[\u4ee5\u524d\u3001Linux\u304cMPLS\u306e\u5bfe\u5fdc\u3092\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u8a18\u4e8b](http://qiita.com/kwi/items/bccf38b69e089b729da9)\u3092\u767a\u898b\u3057\u3001\u3069\u3046\u52d5\u304f\u306e\u304b\u6c17\u306b\u306a\u308b\u306a\u3041\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u308b\u3067\u3054\u3056\u308b\u306e\u5dfb\u3001\u3067\u3042\u308a\u307e\u3059\uff01\n##MPLS\u3068\u306f\u306a\u3093\u3067\u3057\u3087\u3046\u304b\uff1f\n[MPLS(Multi-Protocol Label Switching)](https://ja.wikipedia.org/wiki/Multi-Protocol_Label_Switching)\u3068\u306fL2\u30d8\u30c3\u30c0\u3068L3\u30d8\u30c3\u30c0\u306e\u9593\u306bShim\u30d8\u30c3\u30c0(\u901a\u79f0\u30e9\u30d9\u30eb\u30d8\u30c3\u30c0)\u3068\u547c\u3070\u308c\u308b\u30d8\u30c3\u30c0\u3092\u3064\u3051\u3066\u901a\u4fe1\u306e\u9ad8\u901f\u5316\u3057\u3061\u3083\u3046\u3093\u3060\u305c\u306a\u6b21\u4e16\u4ee3\uff08\u3068\u3044\u3046\u306b\u306f\u5e83\u307e\u3063\u3066\u304b\u3089\u6642\u9593\u304c\u7d50\u69cb\u7d4c\u904e\u3057\u3066\u3044\u308b\u304c\u7b11\uff09\u306e\u30d0\u30c3\u30af\u30dc\u30fc\u30f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6280\u8853\u3067\u3059\u3002\u65e5\u672c\u8a9e\u3067\u306f[Yahoo!](https://techblog.yahoo.co.jp/infrastructure/evpn/)\u3055\u3093\u3084[net one](http://www.netone.co.jp/training/detail/zki034.html)\u3055\u3093\u304f\u3089\u3044\u3057\u304b\u8aac\u660e\u3059\u308b\u30b5\u30a4\u30c8\u304c\u306a\u3044\u306e\u3067\u307e\u3041\u65e5\u672c\u3058\u3083\u6b21\u4e16\u4ee3\u3067\u306f\u7b11\n\n\u30a2\u30d7\u30ea\u5c4b\u306e\u65b9\u3067\u3082VLAN\u3084OSPF\u3068\u304b\u306a\u3089\u77e5\u3063\u3066\u308b\u305e\uff5e\u307f\u305f\u3044\u306a\u4eba\u3082\u3044\u3089\u3063\u3057\u3083\u308b\u3067\u3057\u3087\u3046\u304c\u3001MPLS\u306f\u306a\u304b\u306a\u304b\u30de\u30a4\u30ca\u30fc\u306a\u306e\u3067\u77e5\u3089\u306a\u3044\u65b9\u3082\u591a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u5168\u304f\u610f\u5473\u4e0d\u660e\u306a\u72b6\u614b\u3067\u305f\u3060\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3092\u898b\u305b\u3089\u308c\u3066\u3082\u5fae\u5999\u3067\u3057\u3087\u3046\u304b\u3089\u3001\u304b\u308b\uff5e\u304f\u8aac\u660e\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n***\n*\u3068\u8a00\u3044\u3064\u3064\u30ac\u30c3\u30c4\u30ea\u8aac\u660e\u3092\u66f8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001\u304a\u6642\u9593\u306b\u9650\u308a\u306e\u3042\u308b\u65b9\u306f\u300c\u5b9f\u884c\u74b0\u5883\uff01\u300d\u307e\u3067\u98db\u3093\u3067\u304f\u3060\u3055\u3044\u3002*\n***\n\n\u57fa\u672c\u7684\u306bRIP\u3084OSPF\u3084BGP\u7b49\u306e\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u3068\u306b\u3082\u304b\u304f\u306b\u3082\u4ee5\u4e0b\u306e\u30eb\u30fc\u30eb\u3092\u5b88\u308a\u307e\u3059\u3002\n\n\u2460\u81ea\u5206\u914d\u4e0b\u306b\u3044\u308b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u7d4c\u8def\u60c5\u5831\u3092\u81ea\u5206\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u8868\u306b\u66f8\u304f\u3002\n\u2461\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u540c\u3058\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3068\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2462\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u305d\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u5f93\u3044\u3001\u3088\u308a\u5b9b\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u4f3c\u3066\u308b\u7d4c\u8def\u3092\u6301\u3063\u3066\u308b\u3068\u66f8\u3044\u3066\u3042\u308b\u96a3\u306e\u30eb\u30fc\u30bf\uff08\u3082\u3057\u304f\u306f\u81ea\u5206\u914d\u4e0b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\uff09\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u3002\n\n\u57fa\u672c\u7684\u306b\u901a\u5e38\u306eIP\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3053\u306e\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u307e\u3059\u3002\n***\n\u56e0\u307f\u306bCisco IOS\u7b49\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n|Protocols     |Prefix       |Next Hop|Outgoing   | \n|:----------|:----------|:----------|:----------|\nC|        12.0.0.0/24 |is directly connected| Ethernet3/2\nL|        12.0.0.2/32 |is directly connected| Ethernet3/2\nO|        14.0.0.0/24 |via 12.0.0.1| Ethernet3/2\nO|        15.0.0.0/24 |via 25.0.0.3| Ethernet4/4\nC|        23.0.0.0/24 |is directly connected| Ethernet3/3\nL|        23.0.0.1/32 |is directly connected| Ethernet3/3\nC|        25.0.0.0/24 |is directly connected| Ethernet4/4\nL|        25.0.0.1/32 |is directly connected| Ethernet4/4\nO|        35.0.0.0/24 |via 25.0.0.3| Ethernet4/4\n\u4f8b\u3048\u3070\u3067\u3059\u304c\u3001\u8868\u306e\u4e00\u756a\u4e0a\u306e\u8a18\u8ff0\u306f\u300c12.0.0.0/24\u300d\u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u300cis directly connected\u300d\u3001\u3064\u307e\u308a\u3053\u306e\u30eb\u30fc\u30bf\u306e\u76f4\u4e0b\u306b\u3042\u308a\u3001\u300cEthernet3/2\u300d\u304c\u305d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u7e4b\u304c\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u4e8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n\u4e00\u65b9\u3001\u300c14.0.0.0/24\u300d\u3068\u3044\u3046\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u300cvia 12.0.0.1\u300d\u3001\u3064\u307e\u308a\u3053\u306e12.0.0.1\u3068\u3044\u3046IP\u30a2\u30c9\u30ec\u30b9\u306e\u5148\u306b\u3042\u308a\u3001\u305d\u3053\u3078\u306f\u300cEthernet3/2\u300d\u3092\u4ecb\u3057\u3066\u6295\u3052\u308b\u3068\u3044\u3046\u610f\u5473\u5408\u3044\u3068\u306a\u308a\u307e\u3059\u3002\n<img width=\"404\" alt=\"6743869d1dd7631473f5b4f78c948c4c.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/1f35043f-f788-8bf9-f256-874e1ee56420.png\">\n\n\n***\n\n\u4e00\u65b9\u3001MPLS\u3092\u4f7f\u3063\u305f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u306f\u3053\u306e\u30eb\u30fc\u30eb\u3092\u6539\u9020\u3057\u3066\u57fa\u672c\u7684\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u6295\u3052\u307e\u3059\u3002\n\n\u2460\u81ea\u5206\u914d\u4e0b\u306b\u3044\u308b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u7d4c\u8def\u60c5\u5831\u3092\u81ea\u5206\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u8868\u306b\u66f8\u304f\u3002\n\u2461\u305d\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u5143\u306b\u300c\u7d4c\u8def\u60c5\u5831\u300d\u3092\u300c\u30e9\u30d9\u30eb\u306e\u756a\u53f7\u300d\u3068\u3057\u305f\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u66f8\u304f\u3002\n\u2462\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u5185\u5bb9\u3092\u540c\u3058\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3068\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2463\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306e\u30e9\u30d9\u30eb\u306e\u756a\u53f7\u3082\u30e9\u30d9\u30eb\u4ea4\u63db\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u8a71\u3057\u3066\u3044\u308b\u96a3\u306e\u30eb\u30fc\u30bf\u3092\u30eb\u30fc\u30eb\u306b\u5f93\u3044\u4ea4\u63db\u3059\u308b\u3002\n\u2464\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u5f93\u3044\u3001\u5b9b\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u5bfe\u5fdc\u4ed8\u3051\u3089\u308c\u3066\u5e83\u544a\u3055\u308c\u3066\u304d\u305f\u30e9\u30d9\u30eb\u756a\u53f7\u306b\u5f93\u3044\u3001\u305d\u306e\u756a\u53f7\u3092\u5e83\u544a\u3057\u3066\u304d\u305f\u96a3\u306e\u30eb\u30fc\u30bf\uff08\u3082\u3057\u304f\u306f\u81ea\u5206\u914d\u4e0b\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\uff09\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u3002\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\u66f4\u306b\u7815\u3044\u3066\u8a00\u3046\u306e\u3067\u3042\u308c\u3070RIP\u3084OSPF\u3084BGP\u304c\u8d70\u3063\u3066\u3044\u308b\u30eb\u30fc\u30bf\u304c\u300c\u57fa\u672c\u7684\u306b\u306f\u3001\u3088\u308a\u8fd1\u3044\uff08Metric,Longest Match\u7b49\uff09\u5b9b\u5148\u306e\u7d4c\u8def\u60c5\u5831\u3092\u6301\u3063\u3066\u308b\u30eb\u30fc\u30bf\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300d\u306b\u5bfe\u3057\u3066\u3001MPLS\u4e0a\u306e\u30eb\u30fc\u30bf\u306f\u300c\u4e8b\u524d\u306b\u5b9b\u5148\u306e\u7d4c\u8def\u60c5\u5831\u306b\u5bfe\u3057\u3066\u30e9\u30d9\u30eb\u756a\u53f7\u3092\u3064\u3051\u3066\u304a\u304d\u3001\u6295\u3052\u3089\u308c\u3066\u304d\u305f\u30e9\u30d9\u30eb\u756a\u53f7\u306b\u5f93\u3044\u3001\u6b21\u306e\u30eb\u30fc\u30bf\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300d\u3068\u3044\u3046\u52d5\u304d\u3092\u3059\u308b\u308f\u3051\u3067\u3059\u3002\n\n\u3053\u308c\u3092\u3059\u308b\u4e8b\u3067\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3092\u898b\u3066\u51c4\u3044\u3044\u3063\u3071\u3044\u3042\u308b\u7d4c\u8def\u60c5\u5831\u306e\u4e2d\u304b\u3089\u3001\u4e00\u756a\u8fd1\u3044\u7d4c\u8def\u3092\u6301\u3063\u3066\u308b\u30eb\u30fc\u30bf\u306f\u3069\u308c\u304b\u306a\u30fb\u30fb\u30fb\u30fb\u306a\u3093\u3066\u8003\u3048\u305a\u306b\u3001\u3053\u306e\u5b9b\u5148\u306f\u3053\u306e\u756a\u53f7\uff01\u3070\u3057\u3085\u3093\uff01\u3068\u6295\u3052\u308c\u3070\u826f\u304f\u306a\u308a\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u9ad8\u901f\u5316\u3092\u5b9f\u73fe\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08\u672c\u5f53\u306f[\u30d1\u30c8\u30ea\u30b7\u30a2\u30c4\u30ea\u30fc](https://github.com/ethereum/wiki/wiki/%5BJapanese%5D-Patricia-Tree)\u306e\u539f\u7406\u304b\u3089\u8aac\u660e\u3057\u305f\u3044\u3067\u3059\u304c\u3001\u30b9\u30da\u30fc\u30b9\u306e\u95a2\u4fc2\u4e0a\u3001\u304b\u306a\u308a\u7c21\u6f54\u306b\u66f8\u304d\u307e\u3057\u305f\u30fb\u30fb\u30fb\u30fb\uff09\u3002\n\n***\n\u56e0\u307f\u306bCisco IOS\u7b49\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n|Local Lable     |Outgoing   Lable |Prefix     |Outgoing IF  |   Next Hop IF|\n|:----------|:----------|:----------|:----------|:----------|\n16         |Pop Label  |59.0.0.0/24    |     Et4/4  |   25.0.0.3|\n17         |Pop Label  |57.0.0.0/24    |       Et4/4  |   25.0.0.3|\n18         |Pop Label  |56.0.0.0/24    |      Et4/4  |   25.0.0.3|\n19         |Pop Label  |36.0.0.0/24    |      Et3/3  |   23.0.0.2|\n20         |Pop Label  |35.0.0.0/24    |      Et3/3  |   23.0.0.2|\n           |Pop Label  |35.0.0.0/24    |     Et4/4  |   25.0.0.3|\n21         |Pop Label  |15.0.0.0/24    |    Et3/2  |   12.0.0.1|\n22         |Pop Label  |14.0.0.0/24    |      Et3/2  |   12.0.0.1|\n23         |Pop Label  |100.0.0.0/24   |   Et3/2  |   12.0.0.1|\n24         |24         |69.0.0.0/24    |       Et3/3  |   23.0.0.2|\n           |19         |69.0.0.0/24    |    Et4/4  |   25.0.0.3|\n25         |23         |200.0.0.0/24   |    Et3/3  |   23.0.0.2|\n           |20         |200.0.0.0/24   |    Et4/4  |   25.0.0.3|\n26         |26         |47.0.0.0/24    |     Et3/2  |   12.0.0.1|\n           |23         |47.0.0.0/24    |    Et4/4  |   25.0.0.3|\n27         |22         |78.0.0.0/24    |    Et4/4  |   25.0.0.3|\n28         |21         |89.0.0.0/24    |     Et4/4  |   25.0.0.3|\n30         |Pop Label  |58.0.0.0/24    |     Et4/4  |   25.0.0.3|\n\u4f8b\u3067\u306f\u3001\u4e0b\u304b\u3089\u4e09\u756a\u76ee\u3001\u300c78.0.0.0/24 \u300d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5bfe\u3057\u3066\u306f\u3001Local Label\u300c27\u300d\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u96a3\u63a5\u30eb\u30fc\u30bf\u304c\u5b9b\u5148\u300c78.0.0.0/24\u300d\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5411\u3051\u3066\u81ea\u5206\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u969b\u306b\u3053\u306e\u6570\u5b57\u3092\u3064\u3051\u3066\u6765\u307e\u3059\uff08\u3068\u3044\u3046\u4e8b\u304c\u65e2\u306b\u5206\u304b\u3063\u3066\u3044\u307e\u3059\uff09\u3002\u305d\u3046\u3057\u305f\u3089Outgoing Lable\u300c22\u300d\u3092\u3064\u3051\u3066\u6295\u3052\u308b\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\u4e00\u756a\u53f3\u306e\u4e8c\u3064\u306f\u300c78.0.0.0/24\u300d\u306b\u5411\u304b\u3046\u306b\u306f\u81ea\u5206\u306e\u30eb\u30fc\u30bf\u306eIF\uff08Outgoing IF\uff09Et4/4\u304b\u3089\u3001\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u30a2\u30c9\u30ec\u30b925.0.0.3\u306b\u6295\u3052\u308c\u3070\u826f\u3044\u3068\u66f8\u3044\u3066\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u307e\u3068\u3081\u308b\u3068\u3053\u306e\u30eb\u30fc\u30bf\u306f\u3001\n\u300e\u30e9\u30d9\u30eb\u756a\u53f727\u3092\u3064\u3051\u3066\u6295\u3052\u3066\u304d\u305fMPLS\u30d1\u30b1\u30c3\u30c8\u306b\u306f\u3001\u30e9\u30d9\u30eb\u756a\u53f722\u3064\u3051\u3066Et4/4\u304b\u3089\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d725.0.0.3\u306b\u5411\u3051\u3066\u6295\u3052\u308b\u300f\u3068\u8aad\u307f\u53d6\u308c\u308b\u308f\u3051\u3067\u3059\u3002\u5b9f\u969b\u306b\u6295\u3052\u308b\u969b\u306b\u306f\u30e9\u30d9\u30eb\u3057\u304b\u30eb\u30fc\u30bf\u306f\u898b\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3053\u308c\u3067\u5206\u304b\u308b\u304b\u3068\u601d\u3044\u307e\u3059\uff08\u305f\u3060\u3001LDP\u7b49\u3067\u30e9\u30d9\u30eb\u60c5\u5831\u3092\u96a3\u63a5\u540c\u58eb\u3067\u4ea4\u63db\u3059\u308b\u969b\u306b\u306f\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5f15\u7528\u3059\u308b\u3068\u3044\u3046\u4e8b\u306f\u5fd8\u308c\u305a\u306b\uff09\u3002\n\n<img width=\"504\" alt=\"d0b26a6b0f4a8fa8b639aa762399988a.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/cdfc3b74-cd39-6b08-6b05-23ee5aff560b.png\">\n\n\n***\n*\u203bMPLS\u754c\u9688\u3067\u306f\u3001\u30e9\u30d9\u30eb\u3092\u3064\u3051\u308b\u4e8b\u3092\u300cPush\u300d\u3001\u30e9\u30d9\u30eb\u3092\u5916\u3059\u4e8b\u3092\u300cPop\u300d\u3001Pop\u3068Push\u3092\u4f75\u305b\u3066\u30e9\u30d9\u30eb\u3092\u9055\u3046\u3082\u306e\u306b\u4ea4\u63db\u3059\u308b\u3053\u3068\u3092\u300cSwap\u300d\u3068\u3044\u3044\u307e\u3059\u3002\u899a\u3048\u3066\u304a\u304f\u3068\u82f1\u6587\u3092\u8aad\u3080\u969b\u306b\u4fbf\u5229\u3067\u3059\u3002*\n***\n\n*\u203b\u4e0a\u306e\u8a18\u8ff0\u306b\u3088\u308a\u52d8\u306e\u826f\u3044\u65b9\u306f\u304a\u6c17\u3065\u304d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u4e0a\u306e\u8868\u306e\u300cPop Lable\u300d\u3053\u308c\u306f\u300c\u30e9\u30d9\u30eb\u3092\u4f55\u3082\u3064\u3051\u305a\u306b\u6295\u3052\u308b\u300d\u4e8b\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u30eb\u30fc\u30bf\u304cMPLS\u7db2\u306e\u30a8\u30c3\u30b8\u3060\u3063\u305f\u5834\u5408\u3001\u305d\u306e\u5148\u306fIP\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306a\u308aEthernet\u306a\u308aPPP\u3067\u98db\u3070\u305b\u308b\u306e\u3067\u30e9\u30d9\u30eb\u3064\u3051\u308b\u5fc5\u8981\u304c\u306a\u3044\u3088\u306d\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\u53c2\u8003\uff1ahttp://www.itbook.info/study/mpls4.html*\n***\n\n##\u306a\u3093\u3068\u306a\u3041\u304f\u5206\u304b\u3063\u3066\u305f\u3088\u3046\u306a\uff1f\n\u3068\u308a\u3042\u3048\u305a\u300c\u306a\u3093\u304bOSPF\u3068\u304b\u3088\u308a\u3064\u3048\u30fc\u3084\u3064\u306a\u3093\u3060\u3041\uff01\u300d\u300c\u6570\u5b57\u898b\u3066\u6295\u3052\u308b\u3063\u3066\u3060\u3051\u3067\u901f\u304f\u306a\u308b\u3063\u3066\u610f\u5916\u3068\u4eca\u307e\u3067\u306e\u30eb\u30fc\u30bf\u3063\u3066\u304a\u30d0\u30ab\u3055\u3093\u3060\u3063\u305f\u306e\uff1f\u300d\u307f\u305f\u3044\u306b\u601d\u3048\u305f\u3089\u3044\u3044\u3093\u3060\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u305d\u3082\u305d\u3082MPLS\u306a\u3093\u3066\u305f\u3060\u306eIP\u7db2\u306b\u88ab\u305b\u308b\u5f62\u3067\u5b9f\u73fe\u3059\u308b\u7656\u306b\u306a\u3093\u3067\u901f\u304f\u306a\u308b\u306e\uff1f\u8907\u96d1\u306b\u306a\u3063\u3066\u308b\u3058\u3083\u3093\u7b49\u3001\u305d\u3046\u3044\u3046\u306e\u304c\u6c17\u306b\u306a\u308b\u4eba\u306f\u8abf\u3079\u308b\u3068\u6df1\u6df5\u306b\u5165\u308c\u307e\u3059\u306e\u3067\u662f\u975e\uff09\u3002\u3055\u3066\u3001\u3053\u3063\u304b\u3089\u672c\u984c\u306b\u623b\u3063\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n##\u5b9f\u884c\u74b0\u5883\uff01\n\u4eca\u56de\u306e\u691c\u8a3c\u74b0\u5883\u306e\u57fa\u76e4\u306b\u306f\u5225\u306b\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306a\u3093\u3066\u6e2c\u3089\u306a\u3044\u3057\u30011\u304b\u3089\u30aa\u30f3\u30d7\u30ec\u3067\u7acb\u3066\u308b\u306e\u306f\u3057\u3093\u3069\u3044\u306e\u3067\u3001\u4eee\u60f3\u74b0\u5883\u3092\u4f7f\u3044\u79c1\u306f\u30d1\u30bd\u30b3\u30f3\u4e00\u53f0\u3067\u5168\u3066\u3084\u308a\u304d\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u7b11\n\n####\u4f7f\u7528\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2####\n[\u30db\u30b9\u30c8PC]\n\u30fbWindows 10\n\u30fbGNS3 -version 1.5.1 on Windows (64-bit) with Python 3.5.1 Qt 5.6.0-\n\u30fbOracle VirtualBox -version 5.1.8 r111374 (Qt5.5.1)-\n\n[\u30b2\u30b9\u30c8VM]\n\u30fbUbuntu16.04LTS -kernel version 4.60-\n\u30fbWireshark -version 2.0.2-\n\u30fbiproute  -version 4.4.0-1vyos2 -\n\u30fbiproute2 -version 4.4.0-1vyos2-\n\u30fbmpls_gso(modprobe)\n\u30fbmpls_router(modprobe)\n\u30fbmpls_iptunnel(modprobe)\n\n\u691c\u8a3c\u74b0\u5883\u306e\u30c8\u30dd\u30ed\u30b8\u30fc\u306f\u4e0b\u306b\u8a18\u3057\u307e\u3057\u305f\u3002\n\n<img width=\"558\" alt=\"e6f7aad0a17e125fad5aea8ad259d091.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/c8f88810-9b02-427b-c9c2-1c7f6f49856d.png\">\n\n\u4eca\u56de\u306e\u69cb\u6210\u3067\u3059\u304c\u3001\u3084\u3084\u8907\u96d1\u306b\u898b\u3048\u307e\u3059\u304c\u3001\u84cb\u3092\u958b\u3051\u3066\u307f\u308c\u3070\u3001Ubuntu\u30922\u53f0[GNS3](https://www.gns3.com/)\u306e\u4e2d\u306b\u4f5c\u308a\u3001Ubuntu\u306e\u4e2d\u306bnetns\u306e\u4eee\u60f3\u7a7a\u9593\u3092\u4f5c\u3063\u3066\u3044\u308b\u3060\u3051\u3067\u3054\u3056\u3044\u307e\u3059\u3002netns on Ubuntu on GNS3\u307f\u305f\u3044\u306a\uff1f\u7b11\n\u5b9f\u306f\u3088\u304f\u3088\u304f\u4e16\u306eLinux\u306eMPLS\u306e\u5148\u99c6\u8005\u306e\u65b9\u3005\u306e\u30d6\u30ed\u30b0\u3092\u898b\u308b\u3068\u3001\u300c\u30e9\u30d9\u30eb\u3092Pop\u300d\u3068\u300c\u30e9\u30d9\u30eb\u3092Push\u300d\u307e\u3067\u306f\u3084\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u300c\u30e9\u30d9\u30eb\u3092Swap\u300d\u307e\u3067\u3084\u3063\u3066\u3044\u308b\u30d6\u30ed\u30b0\u306f\u6d77\u5916\u542b\u3081\u79c1\u306f\u4eca\u306e\u3068\u3053\u308d\u767a\u898b\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u7b11\uff08Pop\u3001Push\u3001Swap\u306b\u95a2\u3057\u3066\u306f\u524d\u8ff0\uff09\u3002\n\u305f\u3060\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u691c\u8a3c\u3092\u4e38\u30d1\u30af\u30ea\u3092\u3059\u308b\u306e\u3082\u306a\u3093\u3067\u3059\u3057\u3001\u3053\u306e\u300c\u30e9\u30d9\u30eb\u3092Swap\u300d\u3064\u307e\u308a\u30e9\u30d9\u30eb\u4ea4\u63db\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\uff01\u3068\u3044\u3046\u306e\u304c\u4eca\u56de\u306e\u691c\u8a3c\u306e\u5927\u9805\u76ee\u3067\u3042\u308a\u307e\u3059\uff01\n\n***\n*\u3082\u3063\u3068\u3082\u3001\u4eca\u56de\u3084\u308bMPLS\u306f\u300eStatic MPLS\u300f\u3068\u547c\u3070\u308c\u308b\u3082\u306e\u3067\u3054\u3056\u3044\u307e\u3059\u3002\n\u53c2\u8003:http://www.networkers-online.com/blog/2009/01/static-routes-label-mapping-in-mpls/*\n\n*\u666e\u901a\u3001Google\u3067MPLS\u3092\u691c\u7d22\u3059\u308b\u3068\u305f\u3044\u3066\u3044\u306f\u300eLDP\u300f\u3084\u300eRSVP\u300f\u3068\u3044\u3046\u52d5\u7684\u306b\u30e9\u30d9\u30eb\u60c5\u5831\u3092\u4ea4\u63db\u3059\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30bb\u30c3\u30c8\u3067\u69cb\u7bc9\u3059\u308b\u524d\u63d0\u3067\u4f7f\u308f\u308c\u3066\u3044\u308b\u306e\u304c\u76ee\u306b\u3044\u304f\u3068\u304a\u3082\u3044\u307e\u3059\u3002\u4e00\u65b9\u3001\u3053\u306e\u300eLDP\u300f\u3084\u300eRSVP\u300f\u3092\u4f7f\u308f\u306a\u3044\u3067\u3001\u7d4c\u8def\u306b\u76f4\u63a5\u624b\u6253\u3061\u3067\u30e9\u30d9\u30eb\u60c5\u5831\u3068\u7d4c\u8def\u60c5\u5831\u3092\u30ea\u30f3\u30af\u3055\u305b\u3066\u3057\u307e\u3046\u306e\u304c\u300eStatic MPLS\u300f\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f\u3042\u304f\u307e\u3067MPLS\u306e\u52d5\u304d\u3060\u3051\u898b\u305f\u3044\u3057\u3001Quagga\u306eLDP\u30c7\u30fc\u30e2\u30f3\u306f\u307e\u3060\u958b\u767a\u7248\u3067\u3059\u306e\u3067\u3001\u300eStatic MPLS\u300f\u3067\u3084\u3063\u3066\u3044\u304d\u307e\u3059\u3002\u56e0\u307f\u306bStatic\u306e\u65b9\u304c\u6bb5\u9055\u3044\u3067\u8a2d\u8a08\u304c\u9762\u5012\u3067\u3059\u7b11*\n***\n\n##\u3068\u306b\u304b\u304f\u3084\u3063\u3066\u3044\u304f\u306e\u3060\u3041##\n\u3068\u308a\u3042\u3048\u305aVirtualbox\u3068GNS3\u306e\u304f\u3060\u308a\u306f\u672c\u984c\u304b\u3089\u5927\u5e45\u306b\u305a\u308c\u308b\u306e\u3067\u98db\u3070\u3057\u307e\u3059\u3002\nVirtualbox\u3067Ubuntu\u30922\u53f0\u3064\u304f\u308a\u30fc\u306e\u3001GNS3\u3067Ubuntu\u30922\u53f0\u3064\u306a\u304e\u30fc\u306e\u3001\u30c8\u30c4\u30ae\u30fc\u30ce\u3067\u3054\u3056\u3044\u307e\u3059\u308b\uff01\u7b11\n\n<img width=\"960\" alt=\"40f63b32be3cfc30b9da4aaa6a3f0bfa.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/576ff703-c060-30da-41c0-f701fed9b429.png\">\n\n\u3068\u308a\u3042\u3048\u305a\u3074\u3083\u3074\u3083\u3063\u3068\u4eee\u60f3\u74b0\u5883\u3092\u7acb\u3066\u3066\u3057\u307e\u3044\u3001\u6b21\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u524d\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d\u3092\u3057\u307e\u3059\u3002\n\n##\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f5c\u696d##\n\u4e8b\u524d\u6e96\u5099\u3067\u306fUbunu2\u53f0\u5206\u540c\u3058\u4e8b\u3092\u3057\u307e\u3059\u306e\u3067\u305d\u306e\u3064\u3082\u308a\u3067(\u2267\u25bd\u2266)\n\n\u307e\u305a\u306f\u4eca\u56de\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066mpls_router\u3092\u8aad\u307f\u8fbc\u3080\u3068\u3057\u307e\u3059\u3002\n\u3067\u3059\u304c\u305d\u3082\u305d\u3082Linux\u30ab\u30fc\u30cd\u30eb\u3068\u3057\u3066\u306e\u30b5\u30dd\u30fc\u30c8\u3068\u3057\u3066MPLS Multipath\u3068\u304b\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u305f\u306e\u306fv4.3\u304b\u3089\u3060\u3068\u304b\u3001[git.kernel.org](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=f8efb73c97e2fa0abbe2e07c5c5df07800312643)\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u304a\u3063\u3068\u3061\u3087\u3046\u3069\u3044\u3044\u3068\u3053\u308d\u306b\u3001\u79c1\u306e\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u306bv4.6\u306eURL\u304c\u30e1\u30e2\u3063\u3066\u3042\u3063\u305f\u306e\u3067\u305d\u306e\u30ab\u30fc\u30cd\u30eb\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u7b11\u3000([\u3053\u306e\u30b5\u30a4\u30c8](http://pieknywidok.blogspot.jp/2015/12/mpls-testbed-on-ubuntu-linux-with.html)\u306b\u306fv4.3\u4ee5\u4e0a\u3067\u3084\u3063\u305f\u307b\u3046\u304c\u3044\u3044\u3088\uff5e\u3063\u3066\u66f8\u3044\u3066\u3042\u308b\u306e\u3067\u591a\u52064.4\u3068\u304b\u306a\u3089\u3044\u3051\u308b\u3068\u601d\u3044\u307e\u3059\u9069\u5f53)\n\n```\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600_4.6.0-040600.201606100558_all.deb\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-headers-4.6.0-040600-generic_4.6.0-040600.201606100558_amd64.deb\n# wget http://kernel.ubuntu.com/~kernel-ppa/mainline/v4.6-yakkety/linux-image-4.6.0-040600-generic_4.6.0-040600.201606100558_amd64.deb\n# dpkg -i *.deb\n# update-grub \n# reboot\n```\n\n```bat:uname\nLinux ubuntu01-VirtualBox 4.6.0-040600-generic #201606100558 SMP Fri Jun 10 10:01:15 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n\u30ab\u30fc\u30cd\u30eb\u3092v4.60\u306b\u3057\u307e\u3057\u305f\u3002\n\u66f4\u306b\u4eca\u56deiproute\u53ca\u3073iproute2\u3092\u65b0\u3057\u3044\u3082\u306e\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n[\u6b64\u65b9\u306e\u30b5\u30a4\u30c8](https://github.com/higebu/vyatta-iproute/releases/tag/debian/4.4.0-1vyos2)\u304b\u3089\u3001vyos/vyos-iproute\u306eiproute\u3001iproute2\u306eversion4.40\u3092\u9802\u6234\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n\n```\n# wget https://github.com/higebu/vyatta-iproute/releases/download/debian%2F4.4.0-1vyos2/iproute_4.4.0-1vyos2_all.deb\n# wget https://github.com/higebu/vyatta-iproute/releases/download/debian%2F4.4.0-1vyos2/iproute2_4.4.0-1vyos2_amd64.deb\n# dpkg -i iproute_4.4.0-1vyos2_all.deb\n# dpkg -i iproute2_4.4.0-1vyos2_amd64.deb\n```\n```bat:dpkg\n# dpkg -l | grep iproute\nii  iproute                                              1:4.4.0-1vyos2                                all          transitional dummy package for iprout2\nii  iproute2                                             1:4.4.0-1vyos2                                amd64        networking and traffic control tools\nii  iproute2-doc                                         4.3.0-1ubuntu3                                all          networking and traffic control tools - documentation\n```\n\niproute\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n\n\u6b21\u306b\u5fc5\u8981\u306a\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n# sudo modprobe mpls_gso\n# sudo modprobe mpls_router\n# sudo modprobe mpls_iptunnel\n```\n\n\u5c1a\u30ab\u30fc\u30cd\u30eb\u3092v4.60\u306b\u3057\u3066\u3044\u308c\u3070\u3001\u4eca\u56de\u306f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u518d\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u308a\u3001\u306a\u3093\u3066\u4e8b\u306f\u767a\u751f\u3057\u307e\u305b\u3093\u306e\u3067\u3054\u5b89\u5fc3\u3092\u3002\n\n\u3064\u3044\u3067\u3001\u30e9\u30d9\u30eb\u306e\u6700\u5927\u5024\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u5b9f\u306f\u3053\u308c\u306fMPLS\u306e\u30e9\u30d9\u30eb\u3092\u751f\u6210\u3059\u308b\u306e\u306b\u5fc5\u9808\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\u4ed6\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3068\n\n>mpls_router\u3092\u8aad\u307f\u8fbc\u3080\u3068 /proc/sys/net/mpls \u4ee5\u4e0b\u304c\u3067\u304d\u308b\u3002platform_labels \u306f MPLS \u306e\u30e9\u30d9\u30eb\u3067\u6271\u3046\u6570\u5b57\u306e\u6700\u5927\u5024\u3092\u6c7a\u3081\u308b\u3002\u2026\u3053\u308c\u5236\u9650\u3059\u308b\u5fc5\u8981\u6027\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3051\u308c\u3069\u3001\u4e00\u822c\u7684\u306aMPLS \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30eb\u30fc\u30bf\u3067\u306f\u8a2d\u5b9a\u3059\u308b\u3082\u306e\u304c\u591a\u3044\u69d8\u5b50\u3002\u3068\u308a\u3042\u3048\u305a 64 \u3042\u305f\u308a\u306b\u3057\u3066\u307f\u305f\u3002\u3044\u305a\u308c\u306b\u305b\u3088 mpls \u306e\u6700\u5927\u5024\u306f 20bit \u3092\u8d85\u3048\u3089\u308c\u306a\u3044\u3002\u305d\u308c\u304b\u3089 0--15 \u306f\u4e88\u7d04\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\n(\u53c2\u8003:http://qiita.com/kwi/items/bccf38b69e089b729da9)\n\n\u3068\u3044\u3046\u4e8b\u3089\u3057\u3044\u3067\u3059\u306e\u3067\u3001\u307e\u3001\u6c17\u5206\u30671000\u306b\u3057\u307e\u3059\u3002\n\u3068\u3053\u308d\u3067Cisco\u306eIOS\u3067\u306f\u30e9\u30d9\u30eb\u306e\u6700\u5927\u5024\u306f\u8a2d\u5b9a\u3057\u307e\u3059\u304cCisco IOS XR\u3084juniper SRX\u3068\u304b\u3067\u306f\u8a2d\u5b9a\u306f\u5fc5\u8981\u306a\u304b\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u307e\u3001\u3044\u3044\u3084\u3002\n\n```\n# echo 1000 > /proc/sys/net/mpls/platform_labels\n```\n\u5b9f\u969b\u306b\u306f\u3001MPLS\u306f20bit\u3067\u3059\u306e\u3067\u300116-1048576\u307e\u3067\u6307\u5b9a\u53ef\u80fd\u3067\u3059\u306e\u3067\u3001100\u4e07\u500b\u304f\u3089\u3044\u306e\u7d4c\u8def\u306b\u306f\u8a2d\u5b9a\u53ef\u80fd\u3068\u306a\u308b\u308f\u3051\u3067\u3059\u306d\u3002\n\n\u6b21\u306b\u3001\u4eca\u56de\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u57fa\u76e4\u3068\u306a\u308b\u4ee5\u4e0b\u306enetns\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u3053\u3053\u304b\u3089\u306fUbuntu2\u53f0\u305d\u308c\u305e\u308c\u5206\u3051\u3066\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n<img width=\"558\" alt=\"e6f7aad0a17e125fad5aea8ad259d091.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/ec31db7c-c896-57d3-2f4a-90dc8e75a566.png\">\n\n\n***\n*netns(netns\u306eman\u30da\u30fc\u30b8\u306f[\u30b3\u30c1\u30e9](http://man7.org/linux/man-pages/man8/ip-netns.8.html))\u3068\u306f\u306a\u3093\u3060\u3089\u30db\u30a4\u3001\u3068\u601d\u3063\u305f\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u3053\u3061\u3089\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://kernhack.hatenablog.com/entry/2014/12/09/000827*\n\n*\u4eee\u60f3\u30db\u30b9\u30c8\u4f5c\u6210\u53ca\u3073\u4eee\u60f3NIC\u4f5c\u6210\u304c\u51fa\u6765\u308b\u512a\u308c\u3082\u306e\u3067\u3042\u308a\u3001veth\u3084namespace\u7b49\u306fopenstack\u3084docker\u7b49\u3067\u4f7f\u308f\u308c\u308b\u6280\u8853\u3067\u3042\u308a\u307e\u3057\u3066\u3001\u304b\u306a\u308aLinux\u306e\u30ab\u30fc\u30cd\u30eb\u6e96\u62e0\u306a\u4eee\u60f3\u5316\u6280\u8853\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002namespace\u3092\u4e3b\u306b\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001\u307e\u3001VM\u3068\u3044\u3046\u3088\u308a\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u304b\u306d\u3002\n\u6c17\u8efd\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u3082\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u307e\u305f\u4f5c\u6210\u3057\u305f\u4eee\u60f3NIC\u306b\u5bfe\u3057\u3066tcpdump\u7b49\u3082\u52d5\u304d\u307e\u3059\u3002\u52d5\u4f5c\u3082\u5b89\u5b9a\u3057\u3066\u304a\u308a\u3001\u975e\u5e38\u306b\u4f7f\u3044\u52dd\u624b\u304c\u3088\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u691c\u8a3c\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3068\u8a00\u3048\u307e\u3059\u3002*\n***\n\n####\u74b0\u5883\u8a2d\u8a08####\n\u3068\u308a\u3042\u3048\u305a\u30b3\u30de\u30f3\u30c9\u3092\u3060\u3070\u30fc\u3063\u3068\u66f8\u304d\u307e\u3059\u3002\n\n```bat:ubuntu01\n# ip link add veth0 type veth peer name veth1\n# sysctl -w net.mpls.conf.veth0.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n# ifconfig veth0 10.0.0.1/24 up\n# ip netns add host1\n# ip link set veth1 netns host1\n# ip netns exec host1 ifconfig lo 1.1.1.1/32 up\n# ip netns exec host1 ifconfig veth1 10.0.0.2/24 up\n```\n\n```bat:ubuntu02\n# ip link add veth2 type veth peer name veth3\n# sysctl -w net.mpls.conf.veth2.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n# ifconfig veth2 30.0.0.1/24 up\n# ip netns add host2\n# ip link set veth3 netns host2\n# ip netns exec host2 ifconfig lo 2.2.2.2/32 up\n# ip netns exec host2 ifconfig veth3 30.0.0.2/24 up\n```\n\n\u74b0\u5883\u5468\u308a\u306fUbuntu01Ubuntu02\u3069\u3061\u3089\u3082\u5de6\u53f3\u5bfe\u79f0\u306a\u8a2d\u5b9a\u306a\u306e\u3067Ubuntu01\u3060\u3051\u3092\u4e2d\u5fc3\u306b\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\n\u307e\u305a\u3001\n\n```\n# ip link add veth0 type veth peer name veth1\n# sysctl -w net.mpls.conf.veth0.input=1\n# sysctl -w net.mpls.conf.eth1.input=1\n```\n\n\u3053\u3053\u3067\u306f\u4eee\u60f3NIC\u3067\u3042\u308bveth\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\nLinux\u754c\u9688\u3067\u306f\u307b\u307cvSwitch\u306b\u7f8e\u5473\u3057\u3044\u6240\u3092\u6301\u3063\u3066\u304b\u308c\u305fveth\u3067\u3059\u304c\u7b11 \u305f\u3060\u300c\uff12\u3064\u306e\u4eee\u60f3\u30ce\u30fc\u30c9\u3092\u4eee\u60f3\u7684\u306b\u3064\u306a\u3052\u308b\u300d\u3068\u3044\u3046\u30b6\u30fb\u30b7\u30f3\u30d7\u30eb\u306a\u52d5\u304d\u3092\u3057\u307e\u3059\u3002\n\u4e0a\u8a18\u3067\u306fveth0-1\u3068\u3044\u30462\u3064\u306e\u4eee\u60f3NIC\u3092\u304f\u3063\u3064\u3044\u305f\u72b6\u614b\u3067\u4f5c\u3063\u3066\u3042\u3052\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001veth\u3092\u4f5c\u308a\u7d42\u308f\u3063\u305f\u3089eth1\u3068veth0\u306bmpls\u306e\u30e9\u30d9\u30eb\u53d7\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n\u3064\u3044\u3067\u3001\n\n```\n# ip netns add host1\n# ip link set veth1 netns host1\n# ip netns exec host1 ifconfig lo 1.1.1.1/32 up\n# ip netns exec host1 ifconfig veth1 10.0.0.2/24 up\n```\n\n\u4f5c\u6210\u3057\u305fveth\u306b\u30a2\u30c9\u30ec\u30b9\u3092\u632f\u308a\u3001\u4eee\u60f3\u30db\u30b9\u30c8host1\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u3064\u3044\u306bveth\u3068host\u3092\u63a5\u7d9a\u3057\u307e\u3059\u304c\u3001\u5c11\u3057\u308f\u304b\u308a\u306b\u304f\u3044\u70b9\u304c\u3042\u308a\u307e\u3059\u3002\nveth0\u306f\u4f5c\u6210\u3057\u305f\u6642\u306b\u65e2\u306b\u672c\u4f53\u306eUbuntu\u306b\u304f\u3063\u3064\u3044\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u305d\u306e\u5148\u306eveth1\u306f\u6d6e\u3044\u3066\u3044\u307e\u3059\u3002\n\u306e\u3067\u3001ip link set veth netns host\u3068\u3044\u3046\u5f62\u3067\u6d6e\u3044\u3066\u3044\u308bveth1\u3092\u4eee\u60f3host\u306b\u5dee\u3057\u8fbc\u307f\u3001\u305d\u306e\u5f8c\u306b\u4eee\u60f3\u30db\u30b9\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u632f\u3063\u3066\u3044\u304f\u6d41\u308c\u3068\u306a\u3063\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u305d\u3057\u3066\u6700\u5f8c\u306b\u91cd\u8981\u306a\u6240\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u3001\u3064\u307e\u308a\u30e9\u30d9\u30eb\u3092\u3064\u3051\u308b\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3044\u305f\u3057\u307e\u3059\u3002\u3053\u3053\u304b\u3089\u306fUbuntu02\u3068\u5171\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u8a08\u5168\u4f53\u3092\u898b\u3066\u3044\u304d\u307e\u3057\u3087\u3046\n\n####\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u8a08####\n\u305d\u3082\u305d\u3082\u3001\u4eca\u56de\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3067\u3059\u304c\u3001\u5927\u307e\u304b\u306a\u6d41\u308c\u3092\u4ee5\u4e0b\u306b\u8a18\u3057\u307e\u3057\u305f\u3002\n<img width=\"600\" alt=\"ac173eb74222c09e4c715766c92cbdf8.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/fe7e95af-2009-e1cd-df2f-87230e57005d.png\">\n\n<img width=\"600\" alt=\"bdfff4732eefff60a49c3c5deba74023.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/20f10718-c7a3-0315-f9c6-c3a07cc7869b.png\">\n\n\n\u305d\u308c\u305e\u308c\u306e\u5f79\u5272\u3068\u3057\u3066\u3001\n\n\u2606\u5b9b\u51482.2.2.2\u306e\u5834\u5408\n\u4eee\u60f3host1\u21d2\u5b9b\u51482.2.2.2/32\u306e\u30d1\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u3001\u30e9\u30d9\u30eb101\u3092\u3064\u3051\u3066(Push!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d710.0.0.1\u306b\u6295\u3052\u308b\nUbuntu01\u21d2\u30e9\u30d9\u30eb101\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089111\u306b\u4ed8\u3051\u66ff\u3048\u3066(Pop+Push=Swap!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d720.0.0.2\u306b\u6295\u3052\u308b\nUbuntu02\u21d2\u30e9\u30d9\u30eb111\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30e9\u30d9\u30eb\u3092\u5916\u3057\u3066(Pop!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d730.0.0.2\u306b\u6295\u3052\u308b\n\n\u2606\u5b9b\u51481.1.1.1\u306e\u5834\u5408\n\u4eee\u60f3host2\u21d2\u5b9b\u51481.1.1.1/32\u306e\u30d1\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u3001\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u3066(Push!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d730.0.0.1\u306b\u6295\u3052\u308b\nUbuntu02\u21d2\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089211\u306b\u4ed8\u3051\u66ff\u3048\u3066(Pop+Push=Swap!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d720.0.0.1\u306b\u6295\u3052\u308b\nUbuntu01\u21d2\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u305f\u30d1\u30b1\u30c3\u30c8\u304c\u6765\u305f\u3089\u30e9\u30d9\u30eb\u3092\u5916\u3057\u3066(Pop!)\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d710.0.0.2\u306b\u6295\u3052\u308b\n\n\u3068\u3044\u3046\u8a2d\u8a08\u306b\u3057\u3066\u3044\u304d\u307e\u3059\u308b\u3002\u3053\u308c\u3092\u8a2d\u5b9a\u306b\u53cd\u6620\u3059\u308b\u3068\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\n```bat:ubuntu01\n# ip netns exec host1 ip route add 2.2.2.2/32 encap mpls 101 via inet 10.0.0.1\n# ip -f mpls route add 101 via inet 20.0.0.2 as 111\n# ip -f mpls route add 211 via inet 10.0.0.2 \n```\n\n```bat:ubuntu02\n# ip netns exec host2 ip route add 1.1.1.1/32 encap mpls 201 via inet 30.0.0.1\n# ip -f mpls route add 201 via inet 20.0.0.1 as 211\n# ip -f mpls route add 111 via inet 30.0.0.2 \n```\n\n\u3055\u3066\u3001\u6700\u5f8c\u306b\u3061\u3083\u3093\u3068\u30a2\u30c9\u30ec\u30b9\u3084\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306b\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3044\u305f\u3057\u307e\u3059\u3002\n\n```bat:Ubuntu01Interface\u60c5\u5831\n# ip addr\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:bb:53:39 brd ff:ff:ff:ff:ff:ff\n    inet 20.0.0.1/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:febb:5339/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 62:25:5e:be:b4:87 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6025:5eff:febe:b487/64 scope link \n       valid_lft forever preferred_lft forever\n\n# ip netns exec host1 ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/0 scope host lo\n       valid_lft forever preferred_lft forever\n    inet 1.1.1.1/32 scope global lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n5: veth1@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 3e:1e:b0:36:b7:f7 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.0.2/24 brd 10.0.0.255 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::3c1e:b0ff:fe36:b7f7/64 scope link \n       valid_lft forever preferred_lft forever\n```\n```bat:Ubuntu01\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u60c5\u5831\n# ip -M route\n101 as to 111 via inet 20.0.0.2 dev eth1 \n211 via inet 10.0.0.2 dev veth0 \n\n# ip netns exec host1 ip route\n2.2.2.2  encap mpls  101 via 10.0.0.1 dev veth1 \n10.0.0.0/24 dev veth1  proto kernel  scope link  src 10.0.0.2\n```\n\n```bat:Ubuntu02Interface\u60c5\u5831\n# ip addr\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 08:00:27:57:b9:5b brd ff:ff:ff:ff:ff:ff\n    inet 20.0.0.2/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::a00:27ff:fe57:b95b/64 scope link \n       valid_lft forever preferred_lft forever\n6: veth2@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether fa:29:06:fc:29:26 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 30.0.0.1/24 brd 30.0.0.255 scope global veth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f829:6ff:fefc:2926/64 scope link \n       valid_lft forever preferred_lft forever\n\n# ip netns exec host2 ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/0 scope host lo\n       valid_lft forever preferred_lft forever\n    inet 2.2.2.2/32 scope global lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n5: veth3@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 3e:8b:48:f0:90:41 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 30.0.0.2/24 brd 30.0.0.255 scope global veth3\n       valid_lft forever preferred_lft forever\n    inet6 fe80::3c8b:48ff:fef0:9041/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n\n```bat:Ubuntu02\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\n# ip -M  route\n111 via inet 30.0.0.2 dev veth2 \n201 as to 211 via inet 20.0.0.1 dev eth1 \n# ip netns exec host2 ip route\n1.1.1.1  encap mpls  201 via 30.0.0.1 dev veth3 \n30.0.0.0/24 dev veth3  proto kernel  scope link  src 30.0.0.2 \n```\n\n##\u3055\u3041\u3066\u691c\u8a3c\u306a\u306e\u3089\uff01##\n\n\u691c\u8a3c\u306fPing\u3068Wireshark\u3067\u78ba\u8a8d\u3044\u305f\u3057\u307e\u3059\u3002\n\n####\u308c\u3063\u3064\u3089\u758e\u901a\u78ba\u8a8d\u266a####\n\n```bat:ubuntu01\n# ip netns exec host1 ping 2.2.2.2 -I 1.1.1.1\nPING 2.2.2.2 (2.2.2.2) from 1.1.1.1 : 56(84) bytes of data.\n64 bytes from 2.2.2.2: icmp_seq=1 ttl=62 time=0.430 ms\n64 bytes from 2.2.2.2: icmp_seq=2 ttl=62 time=0.384 ms\n64 bytes from 2.2.2.2: icmp_seq=3 ttl=62 time=0.478 ms\n64 bytes from 2.2.2.2: icmp_seq=4 ttl=62 time=0.715 ms\n64 bytes from 2.2.2.2: icmp_seq=5 ttl=62 time=0.494 ms\n^C\n--- 2.2.2.2 ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 3998ms\nrtt min/avg/max/mdev = 0.384/0.500/0.715/0.114 ms\n```\n\n```bat:ubuntu02\n# ip netns exec host2 ping 1.1.1.1 -I 2.2.2.2\nPING 1.1.1.1 (1.1.1.1) from 2.2.2.2 : 56(84) bytes of data.\n64 bytes from 1.1.1.1: icmp_seq=1 ttl=62 time=0.536 ms\n64 bytes from 1.1.1.1: icmp_seq=2 ttl=62 time=1.06 ms\n64 bytes from 1.1.1.1: icmp_seq=3 ttl=62 time=0.530 ms\n64 bytes from 1.1.1.1: icmp_seq=4 ttl=62 time=1.16 ms\n64 bytes from 1.1.1.1: icmp_seq=5 ttl=62 time=0.570 ms\n^C\n--- 1.1.1.1 ping statistics ---\n5 packets transmitted, 5 received, 0% packet loss, time 4002ms\nrtt min/avg/max/mdev = 0.530/0.771/1.160/0.281 ms\n```\n\n\u304a\uff5e\u758e\u901a\u51fa\u6765\u3066\u3044\u307e\u3059\u3002\n\n####\u308c\u3063\u3064\u3089Wireshark\u266a####\n\n***\n\n\u2606\u5b9b\u51482.2.2.2\u306e\u30d1\u30b1\u30c3\u30c8\u3067Wireshark\uff01\n\n[host1]--[veth0]--[Ubuntu01]--[eth1]--[eth1]--[Ubuntu02]--[veth2]--[host2]\n\n#####To2.2.2.2_Ubuntu01_veth0#####\n<img width=\"481\" alt=\"0d81b27bd31ddf824b6bc0dbb2a32c41.jpng.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/c4af3ecc-2244-a84c-c38b-526733e4d5d2.png\">\n\n\u30e9\u30d9\u30eb101\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To2.2.2.2_Ubuntu01_eth1#####\n<img width=\"483\" alt=\"9b8846e8c8ebc25752213055164b59fe.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/4caa2f75-4ca5-0544-87e0-2ecc84c91c3d.png\">\n\n\u30e9\u30d9\u30eb111\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To2.2.2.2_Ubuntu02_eth1#####\n<img width=\"480\" alt=\"87749e45de069b993c199950d6ad0bf9.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/8cc34450-7f35-da74-0a95-f0f270469936.png\">\n\n\u30e9\u30d9\u30eb111\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To2.2.2.2_Ubuntu02_veth2#####\n<img width=\"481\" alt=\"10ad9ad20e48c32a11c217dbe1f5c6d4.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/5783a108-108a-dbd5-a59a-0afd6a25a0fd.png\">\n\n\u30e9\u30d9\u30eb\u3092Pop!\u3057\u3066\u304a\u308a\u307e\u3059\uff01\n\n***\n\n\u2606\u5b9b\u51481.1.1.1\u306e\u30d1\u30b1\u30c3\u30c8\u3067Wireshark\uff01\n\n[host1]--[veth0]--[Ubuntu01]--[eth1]--[eth1]--[Ubuntu02]--[veth2]--[host2]\n\n#####To1.1.1.1_Ubuntu02_veth2#####\n<img width=\"480\" alt=\"85005ecdaa5f7324d5adc49d45a7ddd2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/8dc7ca3a-bc36-55be-a9b5-eeca65309ff7.png\">\n\n\u30e9\u30d9\u30eb201\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To1.1.1.1_Ubuntu02_eth1#####\n<img width=\"480\" alt=\"6716dbb2a2cf5c9b02121a11363d0a60.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/bf99a786-9e08-525a-ee45-14f911ead7c0.png\">\n\n\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To1.1.1.1_Ubuntu01_eth1#####\n<img width=\"479\" alt=\"43dff543b9633edadceb88e3e80b851f.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/c03cd4c2-a1f0-8b09-32f9-19087bd83f5c.png\">\n\n\u30e9\u30d9\u30eb211\u3092\u3064\u3051\u3066\u304a\u308a\u307e\u3059\uff01\n\n#####To1.1.1.1_Ubuntu01_veth0#####\n<img width=\"481\" alt=\"415ded4f5b2a85b1c35d40f0029ef1f6.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/124502/262046ee-f24d-c34a-980f-4a04b71f7d49.png\">\n\n\u30e9\u30d9\u30eb\u3092Pop\u3057\u3066\u304a\u308a\u307e\u3059\uff01\n\n***\n\n\u30df\u30c3\u30b7\u30e7\u30f3\u30b3\u30f3\u30d7\u30ea\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30fc\u30c8\uff01\uff01\uff01\u7b11\n\n##\u304a\u308f\u308a\u306e\u3054\u3042\u3044\u3055\u3064##\n\u3068\u3044\u3046\u308f\u3051\u3067netns\u5185\u3067MPLS\u306e\u30e9\u30d9\u30eb\u8cbc\u308a\u3092\u898b\u308b\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u5b9f\u306f\u3053\u308c\u3001\u6700\u521d\u30e9\u30d9\u30eb\u306empls_router\u306e\u30e9\u30d9\u30ebSwap\u306e\u8cc7\u6599\u304c\u3042\u307e\u308a\u306b\u3082\u7121\u3044\u4e0a\u306b\u3046\u307e\u304f\u3044\u304b\u305a\u3001\u4f5c\u3063\u3066\u306f\u58ca\u3057\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u306f\u30a8\u30e9\u30fc\u306e\u7e70\u308a\u8fd4\u3057\u3067\u7b11 \u6700\u5f8c\u306e\u6700\u5f8c\u307e\u3067\u7c98\u3063\u3066\u3044\u305f\u3089\u51fa\u6765\u4e0a\u304c\u3063\u305f\u6b21\u7b2c\u3067\u3059\u7b11\n\n\u4eca\u56de\u306f\u305f\u3060\u305f\u3060\u30e9\u30d9\u30eb\u3092PopPushSwap\u3055\u305b\u305f\u3060\u3051\u3068\u306a\u308a\u307e\u3059\u304c\u3001\n\u5b9f\u969b\u306b\u306fMPLS\u306e\u30e9\u30d9\u30eb\u306f\u9ad8\u901f\u5316\u4ee5\u5916\u306b\u3082RSVP\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u4e8b\u3067\u5e2f\u57df\u5236\u5fa1\u3092\u884c\u3046RSVP-TE\u3067\u3042\u3063\u305f\u308a\u3001MP-BGP\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u4e8b\u306b\u3088\u308aL2VPN\u3084L3VPN\u3068\u3057\u3066\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u3046\u3044\u3063\u305f\u3088\u3046\u306b\u4eca\u307e\u3067\u306f\u300c\u6700\u77ed\u7d4c\u8def\u3092\u9078\u3076\u300d\u3068\u3044\u3046\u4e8b\u3067\u504f\u3063\u3066\u3044\u305f\u308a\u3001VM\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308bVM\u79fb\u52d5\u306b\u3088\u308bARP\u89e3\u6c7a\u306b\u5207\u308a\u623b\u3057\u306b\u6642\u9593\u304b\u304b\u3063\u3066\u3044\u305f\u3082\u306e\u3092MPLS\u306b\u8272\u3005\u306a\u60c5\u5831\u3092\u8f09\u305b\u308b\u4e8b\u306b\u3088\u308a\u89e3\u6c7a\u51fa\u6765\u305f\u308a\u3068\u3001\u30e9\u30d9\u30eb\u3092\u305f\u3060\u8cbc\u308b\u3060\u3051\u4ee5\u5916\u306b\u3082MPLS\u306f\u6d3b\u8e8d\u51fa\u6765\u308b\u821e\u53f0\u306f\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\u3002\n\n\u305d\u3053\u306bLinux\u3068\u3057\u3066\u6700\u8fd1\u6a19\u6e96\u642d\u8f09\u3057\u3066\u304d\u305fMPLS\u3067\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3088\u308a\u67d4\u8edf\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u624b\u8efd\u306b\u3001\u6c4e\u7528\u7684\u306b\u4f7f\u308f\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u4e8b\u3092\u671f\u5f85\u3057\u3066\u304a\u308a\u307e\u3059\u3002\u307e\u305f\u305c\u3072\u3001MPLS\u306e\u5c0e\u5165\u3092\u3054\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u7b11\n"}