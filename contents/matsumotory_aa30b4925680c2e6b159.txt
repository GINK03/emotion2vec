{"tags": ["ngx_mruby", "Lua", "mruby", "nginx", "lua-nginx-module"], "context": " More than 1 year has passed since last update.\n\nConfiguration, Environment\n\nMachine\n\nUbuntu14.04 on VMWare \nIntel(R) Core(TM) i7-4770K CPU @ 3.50GHz 4core\nMemory 8GB\n\n\nSoftware version\n\n\nngx_mruby GitHub latest master\n\ndf050067427fc8448a3c8589403fdfe336b82136\n\n\n\nlua-nginx-module GitHub latest master\n\nbc120f9a2279a384e4335bedf765e844b4d22adb\n\n\nnginx 1.7.6\nDidn't tune up kernel parameters\n\n\nOS\n$ uname -a\nLinux ubuntu14-04-64 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:30:00 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n\n\nnginx binary\n$ ldd build/nginx/sbin/nginx\n        linux-vdso.so.1 =>  (0x00007fff28946000)\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007feca7446000)\n        libcrypt.so.1 => /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007feca720d000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007feca6f06000)\n        libcrypto.so.1.0.0 => /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007feca6b2c000)\n        libhiredis.so.0.10 => /usr/lib/x86_64-linux-gnu/libhiredis.so.0.10 (0x00007feca6922000)\n        libluajit-5.1.so.2 => /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2 (0x00007feca66b2000)\n        libpcre.so.3 => /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007feca6474000)\n        libz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007feca625b000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007feca5e94000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007feca7677000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007feca5c90000)\n        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007feca5a7a000)\n\n\nnginx build options\n$ ./build/nginx/sbin/nginx -V\nnginx version: nginx/1.7.6\nbuilt by gcc 4.8.2 (Ubuntu 4.8.2-19ubuntu1) \nconfigure arguments: --add-module=/home/matsumotory/DEV/ngx_mruby --add-module=/home/matsumotory/DEV/ngx_mruby/dependence/ngx_devel_kit --prefix=/home/matsumotory/DEV/ngx_mruby/build/nginx --add-module=/home/matsumotory/DEV/lua-nginx-module\n\n\nnginx.conf\n\nnginx.conf\nworker_processes auto;\n\nevents {\n    worker_connections 1024;\n    multi_accept on;\n}\n\ndaemon off;\n\nhttp {\n    include mime.types;\n    server {\n        listen 58080;\n        server_name  localhost;\n        root /home/matsumotory/DEV/ngx_mruby/build/nginx/html/;\n\n        location /mruby {\n            mruby_content_handler_code \"Nginx.echo 'hello ngx_mruby world.'\";\n        }\n\n        location /lua {\n            content_by_lua \"ngx.say('Hello ngx_lualu world.')\";\n        }\n\n        location /static {\n            # create static/inex.html\n        }\n    }\n}\n\n\n\n\nBenchmark Commands\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/mruby\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/lua\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/static/index.html\n\n\nBenchmark Results\n\nngx_mruby\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /mruby\nDocument Length:        23 bytes\n\nConcurrency Level:      100\nTime taken for tests:   11.708 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990044\nTotal transferred:      143950220 bytes\nHTML transferred:       23000000 bytes\nRequests per second:    85414.56 [#/sec] (mean)\nTime per request:       1.171 [ms] (mean)\nTime per request:       0.012 [ms] (mean, across all concurrent requests)\nTransfer rate:          12007.27 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.2      0      28\nProcessing:     0    1   1.5      1     111\nWaiting:        0    1   1.5      1     111\nTotal:          0    1   1.6      1     114\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      1\n  75%      1\n  80%      2\n  90%      2\n  95%      2\n  98%      4\n  99%      5\n 100%    114 (longest request)\n\n\nlua-nginx-module\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /lua\nDocument Length:        23 bytes\n\nConcurrency Level:      100\nTime taken for tests:   15.227 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990053\nTotal transferred:      169950265 bytes\nHTML transferred:       23000000 bytes\nRequests per second:    65674.42 [#/sec] (mean)\nTime per request:       1.523 [ms] (mean)\nTime per request:       0.015 [ms] (mean, across all concurrent requests)\nTransfer rate:          10899.79 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.3      0      16\nProcessing:     0    2   2.5      1     143\nWaiting:        0    1   2.5      1     143\nTotal:          0    2   2.5      1     143\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      2\n  75%      2\n  80%      2\n  90%      3\n  95%      3\n  98%      5\n  99%      8\n 100%    143 (longest request)\n\n\n\nStatic Content\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /static/hello.html\nDocument Length:        22 bytes\n\nConcurrency Level:      100\nTime taken for tests:   16.687 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990049\nTotal transferred:      256950245 bytes\nHTML transferred:       22000000 bytes\nRequests per second:    59927.44 [#/sec] (mean)\nTime per request:       1.669 [ms] (mean)\nTime per request:       0.017 [ms] (mean, across all concurrent requests)\nTransfer rate:          15037.47 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.3      0      58\nProcessing:     0    2   3.8      1     449\nWaiting:        0    2   3.8      1     449\nTotal:          0    2   3.9      1     449\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      2\n  75%      2\n  80%      2\n  90%      3\n  95%      4\n  98%      8\n  99%     12\n 100%    449 (longest request)\n\n\none mistake; response data byte is different from others. If you write the following into nginx.conf, more faster, maybe.\naccept_mutex_delay 100ms;\nsendfile on;\ntcp_nopush on;\ntcp_nodelay on;\nkeepalive_requests 100000;\n\n\nThoughts\n\n\n\nname\nresult\n\n\n\n\nngx_mruby\nRequests per second:    85414.56 #/sec\n\n\n\nlua-nginx-module\nRequests per second:    65674.42 #/sec\n\n\n\nstatic contents\nRequests per second:    59927.44 #/sec\n\n\n\n\nIt's a just hello world benchmark, so this benchmark is hobby. But, very interesting.\n\n## Configuration, Environment\n### Machine\n\n- Ubuntu14.04 on VMWare \n- Intel(R) Core(TM) i7-4770K CPU @ 3.50GHz 4core\n- Memory 8GB\n\n### Software version\n\n- [ngx_mruby GitHub latest master](https://github.com/matsumoto-r/ngx_mruby/commit/df050067427fc8448a3c8589403fdfe336b82136) \n  - df050067427fc8448a3c8589403fdfe336b82136\n- [lua-nginx-module GitHub latest master](https://github.com/openresty/lua-nginx-module/commit/bc120f9a2279a384e4335bedf765e844b4d22adb) \n  - bc120f9a2279a384e4335bedf765e844b4d22adb\n- nginx 1.7.6\n- Didn't tune up kernel parameters\n\n#### OS\n\n```\n$ uname -a\nLinux ubuntu14-04-64 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:30:00 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux\n```\n\n### nginx binary\n```bash\n$ ldd build/nginx/sbin/nginx\n        linux-vdso.so.1 =>  (0x00007fff28946000)\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007feca7446000)\n        libcrypt.so.1 => /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007feca720d000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007feca6f06000)\n        libcrypto.so.1.0.0 => /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007feca6b2c000)\n        libhiredis.so.0.10 => /usr/lib/x86_64-linux-gnu/libhiredis.so.0.10 (0x00007feca6922000)\n        libluajit-5.1.so.2 => /usr/lib/x86_64-linux-gnu/libluajit-5.1.so.2 (0x00007feca66b2000)\n        libpcre.so.3 => /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007feca6474000)\n        libz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007feca625b000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007feca5e94000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007feca7677000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007feca5c90000)\n        libgcc_s.so.1 => /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007feca5a7a000)\n```\n\n### nginx build options\n```bash\n$ ./build/nginx/sbin/nginx -V\nnginx version: nginx/1.7.6\nbuilt by gcc 4.8.2 (Ubuntu 4.8.2-19ubuntu1) \nconfigure arguments: --add-module=/home/matsumotory/DEV/ngx_mruby --add-module=/home/matsumotory/DEV/ngx_mruby/dependence/ngx_devel_kit --prefix=/home/matsumotory/DEV/ngx_mruby/build/nginx --add-module=/home/matsumotory/DEV/lua-nginx-module\n```\n\n### nginx.conf\n```nginx:nginx.conf\nworker_processes auto;\n\nevents {\n    worker_connections 1024;\n    multi_accept on;\n}\n\ndaemon off;\n\nhttp {\n    include mime.types;\n    server {\n        listen 58080;\n        server_name  localhost;\n        root /home/matsumotory/DEV/ngx_mruby/build/nginx/html/;\n\n        location /mruby {\n            mruby_content_handler_code \"Nginx.echo 'hello ngx_mruby world.'\";\n        }\n\n        location /lua {\n            content_by_lua \"ngx.say('Hello ngx_lualu world.')\";\n        }\n\n        location /static {\n            # create static/inex.html\n        }\n    }\n}\n\n```\n\n### Benchmark Commands\n```bash\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/mruby\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/lua\n$ ab -c 100 -n 1000000 -k http://127.0.0.1:58080/static/index.html\n```\n\n## Benchmark Results\n### ngx_mruby\n\n```\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /mruby\nDocument Length:        23 bytes\n\nConcurrency Level:      100\nTime taken for tests:   11.708 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990044\nTotal transferred:      143950220 bytes\nHTML transferred:       23000000 bytes\nRequests per second:    85414.56 [#/sec] (mean)\nTime per request:       1.171 [ms] (mean)\nTime per request:       0.012 [ms] (mean, across all concurrent requests)\nTransfer rate:          12007.27 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.2      0      28\nProcessing:     0    1   1.5      1     111\nWaiting:        0    1   1.5      1     111\nTotal:          0    1   1.6      1     114\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      1\n  75%      1\n  80%      2\n  90%      2\n  95%      2\n  98%      4\n  99%      5\n 100%    114 (longest request)\n```\n\n### lua-nginx-module\n```\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /lua\nDocument Length:        23 bytes\n\nConcurrency Level:      100\nTime taken for tests:   15.227 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990053\nTotal transferred:      169950265 bytes\nHTML transferred:       23000000 bytes\nRequests per second:    65674.42 [#/sec] (mean)\nTime per request:       1.523 [ms] (mean)\nTime per request:       0.015 [ms] (mean, across all concurrent requests)\nTransfer rate:          10899.79 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.3      0      16\nProcessing:     0    2   2.5      1     143\nWaiting:        0    1   2.5      1     143\nTotal:          0    2   2.5      1     143\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      2\n  75%      2\n  80%      2\n  90%      3\n  95%      3\n  98%      5\n  99%      8\n 100%    143 (longest request)\n\n```\n\n### Static Content\n```\nThis is ApacheBench, Version 2.3 <$Revision: 1528965 $>\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 100000 requests\nCompleted 200000 requests\nCompleted 300000 requests\nCompleted 400000 requests\nCompleted 500000 requests\nCompleted 600000 requests\nCompleted 700000 requests\nCompleted 800000 requests\nCompleted 900000 requests\nCompleted 1000000 requests\nFinished 1000000 requests\n\n\nServer Software:        nginx/1.7.6\nServer Hostname:        127.0.0.1\nServer Port:            58080\n\nDocument Path:          /static/hello.html\nDocument Length:        22 bytes\n\nConcurrency Level:      100\nTime taken for tests:   16.687 seconds\nComplete requests:      1000000\nFailed requests:        0\nKeep-Alive requests:    990049\nTotal transferred:      256950245 bytes\nHTML transferred:       22000000 bytes\nRequests per second:    59927.44 [#/sec] (mean)\nTime per request:       1.669 [ms] (mean)\nTime per request:       0.017 [ms] (mean, across all concurrent requests)\nTransfer rate:          15037.47 [Kbytes/sec] received\n\nConnection Times (ms)\n              min  mean[+/-sd] median   max\nConnect:        0    0   0.3      0      58\nProcessing:     0    2   3.8      1     449\nWaiting:        0    2   3.8      1     449\nTotal:          0    2   3.9      1     449\n\nPercentage of the requests served within a certain time (ms)\n  50%      1\n  66%      2\n  75%      2\n  80%      2\n  90%      3\n  95%      4\n  98%      8\n  99%     12\n 100%    449 (longest request)\n\n```\n\none mistake; response data byte is different from others. If you write the following into nginx.conf, more faster, maybe.\n\n```\naccept_mutex_delay 100ms;\nsendfile on;\ntcp_nopush on;\ntcp_nodelay on;\nkeepalive_requests 100000;\n```\n\n## Thoughts\n\nname|result\n----|-----\nngx_mruby|Requests per second:    85414.56 [#/sec] (mean)\nlua-nginx-module|Requests per second:    65674.42 [#/sec] (mean)\nstatic contents|Requests per second:    59927.44 [#/sec] (mean)\n\nIt's a just hello world benchmark, so this benchmark is hobby. But, very interesting.\n"}