{"tags": ["digdag", "TreasureData"], "context": "\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u7ba1\u7406\u30c4\u30fc\u30ebDigdag\u306b\u65b0\u3057\u304f s3_wait> \u30aa\u30da\u30ec\u30fc\u30bf\u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\u60f3\u5b9a\u5229\u7528\u30b1\u30fc\u30b9\u3068\u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u7d50\u679c\u306b\u3064\u3044\u3066\u3001\u7c21\u5358\u306b\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u9593\u3084\u30c1\u30fc\u30e0\u9593\u3067\u306e\u30c7\u30fc\u30bf\u5171\u6709\u3068\u3057\u3066\u3001S3\u304c\u5229\u7528\u3055\u308c\u308b\u30b1\u30fc\u30b9\u304c\u591a\u3044\n\u8cac\u4efb\u7bc4\u56f2\u304c\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u306e\u30c7\u30fc\u30bf\u5171\u6709\u3068\u3057\u3066\u306f\u3001S3\u306a\u3069\u306e\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3084FTP\u306a\u3069\u306b\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3001\u53c2\u7167\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u591a\u304f\u4e00\u822c\u7684\u306b\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5229\u7528\u3057\u3066\u3044\u308b\u30d9\u30f3\u30c0\u30fc\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u751f\u30ed\u30b0\u3084\u30ec\u30dd\u30fc\u30c8\u3092\u6e21\u3057\u3066\u3082\u3089\u3063\u305f\u308a\u3001\u30a4\u30f3\u30d5\u30e9DBA\u30c1\u30fc\u30e0\u304b\u3089\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u30c1\u30fc\u30e0\u3078\u5b9a\u671f\u7684\u306b\u30de\u30fc\u30b1\u30c3\u30c8\u5229\u7528\u3067\u304d\u308b\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3082\u3089\u3063\u305f\u308a\u3001\u306a\u3069\u3002\u30b7\u30f3\u30d7\u30eb\u306b\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5074\u3068\u30c7\u30fc\u30bf\u53d7\u53d6\u5074\u3067\u304a\u4e92\u3044\u306e\u904b\u7528\u306b\u5e72\u6e09\u3057\u305f\u308a\u3001\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3057\u306a\u304f\u3066\u6e08\u3080\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4e8b\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u306bs3_wait>\u30aa\u30da\u30ec\u30fc\u30bf\u3092\u5229\u7528\n\u30c7\u30fc\u30bf\u53d7\u53d6\u5074\u306f\u3001\u53d7\u3051\u53d6\u308b\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u3082\u3068\u306b\u3044\u308d\u3044\u308d\u3068\u30d0\u30c3\u30c1\u51e6\u7406\u3092\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u524d\u63d0\u3068\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u3044\u3068\u5f8c\u7d9a\u306e\u51e6\u7406\u304c\u5931\u6557\u3057\u307e\u3059\u306e\u3067\u3001\u4e8b\u524d\u51e6\u7406\u3068\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002s3_wait>\u30aa\u30da\u30ec\u30fc\u30bf\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u78ba\u8a8d\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5348\u524d2\u6642\u306b\u30d5\u30a1\u30a4\u30eb\u304cS3\u306b\u7f6e\u3044\u3066\u3042\u308b\u306f\u305a\u304c\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5074\u306e\u51e6\u7406\u304c\u4f55\u304b\u306e\u30c8\u30e9\u30d6\u30eb\u3067\u3044\u3064\u3082\u3088\u308a\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u7f6e\u304b\u308c\u308b\u307e\u3067\u3001\u5f85\u6a5f\u3057\u307e\u3059\u3002\u5b9a\u671f\u7684\u306b\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u3057\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u78ba\u8a8d\u3067\u304d\u3066\u304b\u3089\u3001\u5f8c\u7d9a\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u51e6\u7406\u306b\u9032\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30b7\u30ca\u30ea\u30aa - S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u3001Treasure Data\u306b\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9-  \u4e8b\u524d\u6e96\u5099\u3000\n\u4ee5\u4e0b\u52d5\u4f5c\u78ba\u8a8d\u306e\u6e96\u5099\u306b\u306a\u308a\u307e\u3059\u3002\u30b7\u30ca\u30ea\u30aa\u3068\u3057\u3066\u306f\u3001S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u3001Treasure Data\u306b\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306aCSV\u5f62\u5f0f\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u60f3\u5b9a\u3057\u307e\u3059(\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u306a\u306e\u3067\u65e5\u4ed8\u30c7\u30fc\u30bf\u304c\u53e4\u3044\u3067\u3059\u306d)\u3002\ntime,user,host,path,referer,code,agent,size,method\n2014-10-03 19:59:53,,148.165.90.106,/category/electronics,/category/music,200,Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C),66,GET\n2014-10-03 19:59:37,,144.105.77.66,/item/electronics/3305,/category/computers,200,\"Mozilla/5.0 (iPad; CPU OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A405 Safari/7534.48.3\",135,GET\n2014-10-03 19:59:21,,108.54.178.116,/category/electronics,/category/software,200,\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11\",69,GET\n2014-10-03 19:59:05,,104.129.105.202,/item/electronics/4504,/item/games/394,200,Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0),83,GET\n2014-10-03 19:58:50,,208.48.26.63,/item/software/706,/search/?c=Software+Toys,200,Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0),76,GET\n2014-10-03 19:58:34,,108.78.209.95,/item/giftcards/4879,/item/toys/197,200,Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1,137,GET\n2014-10-03 19:58:18,,108.198.97.206,/item/computers/4785,-,200,Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1,69,GET\n2014-10-03 19:58:02,,172.195.185.46,/category/games,/category/games,200,Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0.1) Gecko/20100101 Firefox/9.0.1,41,GET\n2014-10-03 19:57:46,,88.24.72.177,/item/giftcards/4410,-,200,Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C),72,GET\n\n\n\u307e\u305a\u306f\u3001digdag\u3092\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\n\u65e5\u3005\u958b\u767a\u304c\u9032\u3093\u3067\u3044\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306f\u5e38\u306b\u6700\u65b0\u306b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n$ digdag selfupdate\n2016-10-03 13:44:50 +0900: Digdag v0.8.13\nChecking the latest version...\nUpgrading to 0.8.16...\nVerifying...\nUpgraded to 0.8.16\n\n\ndigdag\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\ndigdag init\u30b3\u30de\u30f3\u30c9\u3067\u3001import_from_s3\u3068\u3044\u3046\u540d\u306edigdag\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n$ digdag init import_from_s3\n2016-10-03 14:11:46 +0900: Digdag v0.8.16\n  Creating import_from_s3/import_from_s3.dig\n  Creating import_from_s3/.gitignore\nDone. Type `cd import_from_s3` and then `digdag run import_from_s3.dig` to run the workflow. Enjoy!\n\n$ cd import_from_s3/\n$ ls\nimport_from_s3.dig\n\n\n.dig\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\n\u4e0a\u8a18\u3067\u751f\u6210\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u306eimport_from_s3.dig\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u5404\u30bf\u30b9\u30af\u306f\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n+check_file_on_s3: \u30bf\u30b9\u30af\u3067 s3_wait> \u30aa\u30da\u30ec\u30fc\u30bf\u3092\u5229\u7528\u3057\u3066\u3001S3\u4e0a\u306eyada-tokyo-bucket\u30d0\u30b1\u30c3\u30c8\u5185\u306ewww_access_YYYYMMDD\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb(YYYYMMDD\u306f20161003\u306a\u3069\u306e\u65e5\u4ed8\u3092\u60f3\u5b9a)\u306e\u5b58\u5728\u3092\u78ba\u8a8d\u3059\u308b\u3002\n+create_table: \u30bf\u30b9\u30af\u3067\u306f\u3001td_ddl> \u30aa\u30da\u30ec\u30fc\u30bf\u3067\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u5148\u3068\u306a\u308b\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u306e\u30c6\u30fc\u30d6\u30eb(www_access)\u3092\u4f5c\u6210\u3059\u308b\u3002\n+load_to_td_from_s3: \u30bf\u30b9\u30af\u3067\u3001S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3078\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u5b9f\u65bd\u3002imports\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306bload.yml\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\nimport_from_s3.dig\ntimezone: Asia/Tokyo\n\n_export:\n  td:\n    database: yada_demo\n\n+setup:\n  echo>: start ${session_time}\n\n+disp_current_date:\n  echo>: ${new Date().toUTCString()}\n\n+check_file_on_s3:\n  s3_wait>: yada-tokyo-bucket/www_access_${session_date_compact}\n\n+create_table:\n  td_ddl>:\n  create_tables: [www_access]\n\n+load_to_td_from_s3:\n  td_load>: imports/load.yml\n  database: yada_demo\n  table: www_access\n\n+teardown:\n  echo>: finish ${session_time}\n\n\n\nimports/load.yml\n---\nin:\n  type: s3\n  access_key_id: xxxx\n  secret_access_key: xxxx\n  bucket: yada-tokyo-bucket\n  path_prefix: www_access_${session_date_compact}\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: \",\"\n    quote: \"\\\"\"\n    escape: \"\\\"\"\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: time, type: timestamp, format: \"%Y-%m-%d %H:%M:%S\"}\n    - {name: user, type: string}\n    - {name: host, type: string}\n    - {name: path, type: string}\n    - {name: referer, type: string}\n    - {name: code, type: long}\n    - {name: agent, type: string}\n    - {name: size, type: long}\n    - {name: method, type: string}\nout:\n  mode: append\n\n\n\ndigdag\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u969b\u306eSecrets\u8a2d\u5b9a\n.dig\u30d5\u30a1\u30a4\u30eb\u3067\u5b9a\u7fa9\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002(\u5b9a\u7fa9\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u5b9a\u671f\u7684\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u5225\u9014\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30b5\u30fc\u30d0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002)\n\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001Secrets\u3067\u3042\u308bAWS\u306ecredential\u3092 ~/.config/digdag/config \u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n~/.config/digdag/config\nsecrets.aws.access-key-id = xxx\nsecrets.aws.secret-access-key = xxx\n\n\n\u4ee5\u4e0a\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\ndigdag run\n$ digdag run import_from_s3.dig --rerun\n2016-10-03 16:05:15 +0900: Digdag v0.8.16\n2016-10-03 16:05:17 +0900 [WARN] (main): Reusing the last session time 2016-10-03T09:00:00+09:00.\n2016-10-03 16:05:17 +0900 [INFO] (main): Using session /Users/ryuy/work_se/digdag/import_from_s3/.digdag/status/20161003T090000+0900.\n2016-10-03 16:05:17 +0900 [INFO] (main): Starting a new session project id=1 workflow name=import_from_s3 session_time=2016-10-03T09:00:00+09:00\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+setup): echo>: start 2016-10-03T09:00:00+09:00\nstart 2016-10-03T09:00:00+09:00\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+disp_current_date): echo>: Mon, 03 Oct 2016 07:05:18 GMT\nMon, 03 Oct 2016 07:05:18 GMT\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:05:28 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:05:40 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:06:01 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:06:44 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:08:07 +0900 [INFO] (0019@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:10:49 +0900 [INFO] (0020@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:15:52 +0900 [INFO] (0021@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n\ndigdag run\u30b3\u30de\u30f3\u30c9\u3067\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001S3\u4e0a\u306e\u3000yada-tokyo-bucket/www_access_20161003 \u3092\u5b9a\u671f\u7684\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u30c1\u30a7\u30c3\u30af\u9593\u9694\u306f\u3060\u3093\u3060\u3093\u4f38\u3073\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u3053\u3067\u5b9f\u969b\u306b\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067 yada-tokyo-bucket/www_access_20161003 \u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u307f\u307e\u3059\u3002\n$ aws s3 cp s3://yada-tokyo-bucket/www_access.csv s3://yada-tokyo-bucket/www_access_20161003\ncopy: s3://yada-tokyo-bucket/www_access.csv to s3://yada-tokyo-bucket/www_access_20161003\n\n\u305d\u3046\u3059\u308b\u3068\u3001\u6b21\u306e s3_wait> \u306b\u3088\u308b\u30c1\u30a7\u30c3\u30af\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u304c\u78ba\u8a8d\u3067\u304d\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u51e6\u7406\u304c\u9032\u307f\u307e\u3059\u3002\ntd_ddl>\u3067www_access\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001td_load> \u3067\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n2016-10-03 16:20:54 +0900 [INFO] (0022@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): td_ddl>: null\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): td-client version: 0.7.26\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): Logging initialized @940060ms\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): Creating TD table yada_demo.www_access\n2016-10-03 16:20:56 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:20:57 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:20:58 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): Started bulk load job id=93586036\n2016-10-03 16:21:00 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:02 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:06 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:13 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:14 +0900 [INFO] (0022@+import_from_s3+teardown): echo>: finish 2016-10-03T09:00:00+09:00\nfinish 2016-10-03T09:00:00+09:00\nSuccess. Task state is saved at /Users/ryuy/work_se/digdag/import_from_s3/.digdag/status/20161003T090000+0900 directory.\n  * Use --session <daily | hourly | \"yyyy-MM-dd[ HH:mm:ss]\"> to not reuse the last session time.\n  * Use --rerun, --start +NAME, or --goal +NAME argument to rerun skipped tasks.\n\n\u6700\u5f8c\u306b\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3067\u30c7\u30fc\u30bf\u78ba\u8a8d\u3002\n$ td query -Tpresto -w -d yada_demo 'select * from www_access limit 10'\n\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n| user | host            | path                   | referer                  | code | agent                                                                                                                                                                     | size | method | time       |\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n| null | 148.165.90.106  | /category/electronics  | /category/music          | 200  | Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C) | 66   | GET    | 1412366393 |\n| null | 144.105.77.66   | /item/electronics/3305 | /category/computers      | 200  | Mozilla/5.0 (iPad; CPU OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A405 Safari/7534.48.3                                           | 135  | GET    | 1412366377 |\n| null | 108.54.178.116  | /category/electronics  | /category/software       | 200  | Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11                                                               | 69   | GET    | 1412366361 |\n| null | 104.129.105.202 | /item/electronics/4504 | /item/games/394          | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)                                                                                                           | 83   | GET    | 1412366345 |\n| null | 208.48.26.63    | /item/software/706     | /search/?c=Software+Toys | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)                                                                                                    | 76   | GET    | 1412366330 |\n| null | 108.78.209.95   | /item/giftcards/4879   | /item/toys/197           | 200  | Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1                                                                                                     | 137  | GET    | 1412366314 |\n| null | 108.198.97.206  | /item/computers/4785   | -                        | 200  | Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1                                                                                                     | 69   | GET    | 1412366298 |\n| null | 172.195.185.46  | /category/games        | /category/games          | 200  | Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0.1) Gecko/20100101 Firefox/9.0.1                                                                                       | 41   | GET    | 1412366282 |\n| null | 88.24.72.177    | /item/giftcards/4410   | -                        | 200  | Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C) | 72   | GET    | 1412366266 |\n| null | 24.129.141.79   | /category/electronics  | /category/networking     | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)                                                                                                           | 73   | GET    | 1412366250 |\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n\n\n\u307e\u3068\u3081\nDigdag\u306e s3_wait> \u30aa\u30da\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\n\u30b7\u30f3\u30d7\u30eb\u306a\u6a5f\u80fd\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u30c1\u30a7\u30c3\u30af\u3092\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u3068\u3001\u9762\u5012\u304b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u7ba1\u7406\u30c4\u30fc\u30eb[Digdag](http://www.digdag.io/)\u306b\u65b0\u3057\u304f [s3_wait>](http://www.digdag.io/operators.html#s3-wait-wait-for-a-file-in-amazon-s3) \u30aa\u30da\u30ec\u30fc\u30bf\u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\u60f3\u5b9a\u5229\u7528\u30b1\u30fc\u30b9\u3068\u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u7d50\u679c\u306b\u3064\u3044\u3066\u3001\u7c21\u5358\u306b\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n# \u30b5\u30fc\u30d3\u30b9\u9593\u3084\u30c1\u30fc\u30e0\u9593\u3067\u306e\u30c7\u30fc\u30bf\u5171\u6709\u3068\u3057\u3066\u3001S3\u304c\u5229\u7528\u3055\u308c\u308b\u30b1\u30fc\u30b9\u304c\u591a\u3044\n\n\u8cac\u4efb\u7bc4\u56f2\u304c\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u306e\u30c7\u30fc\u30bf\u5171\u6709\u3068\u3057\u3066\u306f\u3001S3\u306a\u3069\u306e\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\u3084FTP\u306a\u3069\u306b\u30c7\u30fc\u30bf\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u3001\u53c2\u7167\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u591a\u304f\u4e00\u822c\u7684\u306b\u884c\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5229\u7528\u3057\u3066\u3044\u308b\u30d9\u30f3\u30c0\u30fc\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u751f\u30ed\u30b0\u3084\u30ec\u30dd\u30fc\u30c8\u3092\u6e21\u3057\u3066\u3082\u3089\u3063\u305f\u308a\u3001\u30a4\u30f3\u30d5\u30e9DBA\u30c1\u30fc\u30e0\u304b\u3089\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u30c1\u30fc\u30e0\u3078\u5b9a\u671f\u7684\u306b\u30de\u30fc\u30b1\u30c3\u30c8\u5229\u7528\u3067\u304d\u308b\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066\u3082\u3089\u3063\u305f\u308a\u3001\u306a\u3069\u3002\u30b7\u30f3\u30d7\u30eb\u306b\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u6e21\u3059\u3053\u3068\u3067\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5074\u3068\u30c7\u30fc\u30bf\u53d7\u53d6\u5074\u3067\u304a\u4e92\u3044\u306e\u904b\u7528\u306b\u5e72\u6e09\u3057\u305f\u308a\u3001\u30a2\u30af\u30bb\u30b9\u3057\u305f\u308a\u3057\u306a\u304f\u3066\u6e08\u3080\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u4e8b\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u306bs3_wait>\u30aa\u30da\u30ec\u30fc\u30bf\u3092\u5229\u7528\n\n\u30c7\u30fc\u30bf\u53d7\u53d6\u5074\u306f\u3001\u53d7\u3051\u53d6\u308b\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u3082\u3068\u306b\u3044\u308d\u3044\u308d\u3068\u30d0\u30c3\u30c1\u51e6\u7406\u3092\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u524d\u63d0\u3068\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u306a\u3044\u3068\u5f8c\u7d9a\u306e\u51e6\u7406\u304c\u5931\u6557\u3057\u307e\u3059\u306e\u3067\u3001\u4e8b\u524d\u51e6\u7406\u3068\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002s3_wait>\u30aa\u30da\u30ec\u30fc\u30bf\u306f\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u78ba\u8a8d\u306b\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u5348\u524d2\u6642\u306b\u30d5\u30a1\u30a4\u30eb\u304cS3\u306b\u7f6e\u3044\u3066\u3042\u308b\u306f\u305a\u304c\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5074\u306e\u51e6\u7406\u304c\u4f55\u304b\u306e\u30c8\u30e9\u30d6\u30eb\u3067\u3044\u3064\u3082\u3088\u308a\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u7f6e\u304b\u308c\u308b\u307e\u3067\u3001\u5f85\u6a5f\u3057\u307e\u3059\u3002\u5b9a\u671f\u7684\u306b\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u3057\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u78ba\u8a8d\u3067\u304d\u3066\u304b\u3089\u3001\u5f8c\u7d9a\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u51e6\u7406\u306b\u9032\u3080\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u30b7\u30ca\u30ea\u30aa - S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u3001Treasure Data\u306b\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9-  \u4e8b\u524d\u6e96\u5099\u3000\n\n\u4ee5\u4e0b\u52d5\u4f5c\u78ba\u8a8d\u306e\u6e96\u5099\u306b\u306a\u308a\u307e\u3059\u3002\u30b7\u30ca\u30ea\u30aa\u3068\u3057\u3066\u306f\u3001S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u3001Treasure Data\u306b\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306aCSV\u5f62\u5f0f\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u60f3\u5b9a\u3057\u307e\u3059(\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u306a\u306e\u3067\u65e5\u4ed8\u30c7\u30fc\u30bf\u304c\u53e4\u3044\u3067\u3059\u306d)\u3002\n\n```\ntime,user,host,path,referer,code,agent,size,method\n2014-10-03 19:59:53,,148.165.90.106,/category/electronics,/category/music,200,Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C),66,GET\n2014-10-03 19:59:37,,144.105.77.66,/item/electronics/3305,/category/computers,200,\"Mozilla/5.0 (iPad; CPU OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A405 Safari/7534.48.3\",135,GET\n2014-10-03 19:59:21,,108.54.178.116,/category/electronics,/category/software,200,\"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11\",69,GET\n2014-10-03 19:59:05,,104.129.105.202,/item/electronics/4504,/item/games/394,200,Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0),83,GET\n2014-10-03 19:58:50,,208.48.26.63,/item/software/706,/search/?c=Software+Toys,200,Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0),76,GET\n2014-10-03 19:58:34,,108.78.209.95,/item/giftcards/4879,/item/toys/197,200,Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1,137,GET\n2014-10-03 19:58:18,,108.198.97.206,/item/computers/4785,-,200,Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1,69,GET\n2014-10-03 19:58:02,,172.195.185.46,/category/games,/category/games,200,Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0.1) Gecko/20100101 Firefox/9.0.1,41,GET\n2014-10-03 19:57:46,,88.24.72.177,/item/giftcards/4410,-,200,Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C),72,GET\n```\n\n\n\n### \u307e\u305a\u306f\u3001digdag\u3092\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\n\u65e5\u3005\u958b\u767a\u304c\u9032\u3093\u3067\u3044\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306f\u5e38\u306b\u6700\u65b0\u306b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n```\n$ digdag selfupdate\n2016-10-03 13:44:50 +0900: Digdag v0.8.13\nChecking the latest version...\nUpgrading to 0.8.16...\nVerifying...\nUpgraded to 0.8.16\n```\n\n### digdag\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\ndigdag init\u30b3\u30de\u30f3\u30c9\u3067\u3001import_from_s3\u3068\u3044\u3046\u540d\u306edigdag\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$ digdag init import_from_s3\n2016-10-03 14:11:46 +0900: Digdag v0.8.16\n  Creating import_from_s3/import_from_s3.dig\n  Creating import_from_s3/.gitignore\nDone. Type `cd import_from_s3` and then `digdag run import_from_s3.dig` to run the workflow. Enjoy!\n\n$ cd import_from_s3/\n$ ls\nimport_from_s3.dig\n```\n\n### .dig\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\n\u4e0a\u8a18\u3067\u751f\u6210\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u306eimport_from_s3.dig\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u5404\u30bf\u30b9\u30af\u306f\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n- +check_file_on_s3: \u30bf\u30b9\u30af\u3067 s3_wait> \u30aa\u30da\u30ec\u30fc\u30bf\u3092\u5229\u7528\u3057\u3066\u3001S3\u4e0a\u306eyada-tokyo-bucket\u30d0\u30b1\u30c3\u30c8\u5185\u306ewww_access_YYYYMMDD\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb(YYYYMMDD\u306f20161003\u306a\u3069\u306e\u65e5\u4ed8\u3092\u60f3\u5b9a)\u306e\u5b58\u5728\u3092\u78ba\u8a8d\u3059\u308b\u3002\n- +create_table: \u30bf\u30b9\u30af\u3067\u306f\u3001td_ddl> \u30aa\u30da\u30ec\u30fc\u30bf\u3067\u3001\u30a4\u30f3\u30dd\u30fc\u30c8\u5148\u3068\u306a\u308b\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u306e\u30c6\u30fc\u30d6\u30eb(www_access)\u3092\u4f5c\u6210\u3059\u308b\u3002\n- +load_to_td_from_s3: \u30bf\u30b9\u30af\u3067\u3001S3\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u3092\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3078\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u5b9f\u65bd\u3002imports\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306bload.yml\u3092\u7528\u610f\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n```import_from_s3.dig\ntimezone: Asia/Tokyo\n\n_export:\n  td:\n    database: yada_demo\n\n+setup:\n  echo>: start ${session_time}\n\n+disp_current_date:\n  echo>: ${new Date().toUTCString()}\n\n+check_file_on_s3:\n  s3_wait>: yada-tokyo-bucket/www_access_${session_date_compact}\n\n+create_table:\n  td_ddl>:\n  create_tables: [www_access]\n\n+load_to_td_from_s3:\n  td_load>: imports/load.yml\n  database: yada_demo\n  table: www_access\n\n+teardown:\n  echo>: finish ${session_time}\n```\n\n```imports/load.yml\n---\nin:\n  type: s3\n  access_key_id: xxxx\n  secret_access_key: xxxx\n  bucket: yada-tokyo-bucket\n  path_prefix: www_access_${session_date_compact}\n  parser:\n    charset: UTF-8\n    newline: CRLF\n    type: csv\n    delimiter: \",\"\n    quote: \"\\\"\"\n    escape: \"\\\"\"\n    trim_if_not_quoted: false\n    skip_header_lines: 1\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: time, type: timestamp, format: \"%Y-%m-%d %H:%M:%S\"}\n    - {name: user, type: string}\n    - {name: host, type: string}\n    - {name: path, type: string}\n    - {name: referer, type: string}\n    - {name: code, type: long}\n    - {name: agent, type: string}\n    - {name: size, type: long}\n    - {name: method, type: string}\nout:\n  mode: append\n```\n\n### digdag\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u969b\u306eSecrets\u8a2d\u5b9a\n\n.dig\u30d5\u30a1\u30a4\u30eb\u3067\u5b9a\u7fa9\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002(\u5b9a\u7fa9\u3057\u305f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u5b9a\u671f\u7684\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u5225\u9014\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30b5\u30fc\u30d0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002)\n\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001[Secrets](http://www.digdag.io/command_reference.html#secrets)\u3067\u3042\u308bAWS\u306ecredential\u3092 ~/.config/digdag/config \u30d5\u30a1\u30a4\u30eb\u306b\u5b9a\u7fa9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```~/.config/digdag/config\nsecrets.aws.access-key-id = xxx\nsecrets.aws.secret-access-key = xxx\n```\n\n\u4ee5\u4e0a\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n## digdag run\n```\n$ digdag run import_from_s3.dig --rerun\n2016-10-03 16:05:15 +0900: Digdag v0.8.16\n2016-10-03 16:05:17 +0900 [WARN] (main): Reusing the last session time 2016-10-03T09:00:00+09:00.\n2016-10-03 16:05:17 +0900 [INFO] (main): Using session /Users/ryuy/work_se/digdag/import_from_s3/.digdag/status/20161003T090000+0900.\n2016-10-03 16:05:17 +0900 [INFO] (main): Starting a new session project id=1 workflow name=import_from_s3 session_time=2016-10-03T09:00:00+09:00\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+setup): echo>: start 2016-10-03T09:00:00+09:00\nstart 2016-10-03T09:00:00+09:00\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+disp_current_date): echo>: Mon, 03 Oct 2016 07:05:18 GMT\nMon, 03 Oct 2016 07:05:18 GMT\n2016-10-03 16:05:18 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:05:28 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:05:40 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:06:01 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:06:44 +0900 [INFO] (0017@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:08:07 +0900 [INFO] (0019@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:10:49 +0900 [INFO] (0020@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:15:52 +0900 [INFO] (0021@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n```\ndigdag run\u30b3\u30de\u30f3\u30c9\u3067\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001S3\u4e0a\u306e\u3000yada-tokyo-bucket/www_access_20161003 \u3092\u5b9a\u671f\u7684\u306b\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u30c1\u30a7\u30c3\u30af\u9593\u9694\u306f\u3060\u3093\u3060\u3093\u4f38\u3073\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u5b9f\u969b\u306b\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067 yada-tokyo-bucket/www_access_20161003 \u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u307f\u307e\u3059\u3002\n\n```\n$ aws s3 cp s3://yada-tokyo-bucket/www_access.csv s3://yada-tokyo-bucket/www_access_20161003\ncopy: s3://yada-tokyo-bucket/www_access.csv to s3://yada-tokyo-bucket/www_access_20161003\n```\n\n\u305d\u3046\u3059\u308b\u3068\u3001\u6b21\u306e s3_wait> \u306b\u3088\u308b\u30c1\u30a7\u30c3\u30af\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30d5\u30a1\u30a4\u30eb\u306e\u5b58\u5728\u304c\u78ba\u8a8d\u3067\u304d\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u51e6\u7406\u304c\u9032\u307f\u307e\u3059\u3002\ntd_ddl>\u3067www_access\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u3001td_load> \u3067\u30c7\u30fc\u30bf\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n2016-10-03 16:20:54 +0900 [INFO] (0022@+import_from_s3+check_file_on_s3): s3_wait>: yada-tokyo-bucket/www_access_20161003\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): td_ddl>: null\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): td-client version: 0.7.26\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): Logging initialized @940060ms\n2016-10-03 16:20:55 +0900 [INFO] (0022@+import_from_s3+create_table): Creating TD table yada_demo.www_access\n2016-10-03 16:20:56 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:20:57 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:20:58 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): Started bulk load job id=93586036\n2016-10-03 16:21:00 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:02 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:06 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:13 +0900 [INFO] (0022@+import_from_s3+load_to_td_from_s3): td_load>: imports/load.yml\n2016-10-03 16:21:14 +0900 [INFO] (0022@+import_from_s3+teardown): echo>: finish 2016-10-03T09:00:00+09:00\nfinish 2016-10-03T09:00:00+09:00\nSuccess. Task state is saved at /Users/ryuy/work_se/digdag/import_from_s3/.digdag/status/20161003T090000+0900 directory.\n  * Use --session <daily | hourly | \"yyyy-MM-dd[ HH:mm:ss]\"> to not reuse the last session time.\n  * Use --rerun, --start +NAME, or --goal +NAME argument to rerun skipped tasks.\n```\n\n\u6700\u5f8c\u306b\u30c8\u30ec\u30b8\u30e3\u30fc\u30c7\u30fc\u30bf\u3067\u30c7\u30fc\u30bf\u78ba\u8a8d\u3002\n\n```\n$ td query -Tpresto -w -d yada_demo 'select * from www_access limit 10'\n\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n| user | host            | path                   | referer                  | code | agent                                                                                                                                                                     | size | method | time       |\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n| null | 148.165.90.106  | /category/electronics  | /category/music          | 200  | Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C) | 66   | GET    | 1412366393 |\n| null | 144.105.77.66   | /item/electronics/3305 | /category/computers      | 200  | Mozilla/5.0 (iPad; CPU OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A405 Safari/7534.48.3                                           | 135  | GET    | 1412366377 |\n| null | 108.54.178.116  | /category/electronics  | /category/software       | 200  | Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11                                                               | 69   | GET    | 1412366361 |\n| null | 104.129.105.202 | /item/electronics/4504 | /item/games/394          | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)                                                                                                           | 83   | GET    | 1412366345 |\n| null | 208.48.26.63    | /item/software/706     | /search/?c=Software+Toys | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)                                                                                                    | 76   | GET    | 1412366330 |\n| null | 108.78.209.95   | /item/giftcards/4879   | /item/toys/197           | 200  | Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1                                                                                                     | 137  | GET    | 1412366314 |\n| null | 108.198.97.206  | /item/computers/4785   | -                        | 200  | Mozilla/5.0 (Windows NT 6.0; rv:10.0.1) Gecko/20100101 Firefox/10.0.1                                                                                                     | 69   | GET    | 1412366298 |\n| null | 172.195.185.46  | /category/games        | /category/games          | 200  | Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:9.0.1) Gecko/20100101 Firefox/9.0.1                                                                                       | 41   | GET    | 1412366282 |\n| null | 88.24.72.177    | /item/giftcards/4410   | -                        | 200  | Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; YTB730; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C) | 72   | GET    | 1412366266 |\n| null | 24.129.141.79   | /category/electronics  | /category/networking     | 200  | Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)                                                                                                           | 73   | GET    | 1412366250 |\n+------+-----------------+------------------------+--------------------------+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+--------+------------+\n```\n\n# \u307e\u3068\u3081\n\nDigdag\u306e s3_wait> \u30aa\u30da\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\n\u30b7\u30f3\u30d7\u30eb\u306a\u6a5f\u80fd\u3067\u3059\u304c\u3001\u30d5\u30a1\u30a4\u30eb\u30c1\u30a7\u30c3\u30af\u3092\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u3068\u3001\u9762\u5012\u304b\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n"}