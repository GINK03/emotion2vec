{"context": " More than 1 year has passed since last update.\n\nWhat's this?\n\nCinder volume \u306e Backup \u3092 AZ1 \u306b\u4f5c\u6210\n\u65b0\u3057\u3044 Cinder volume \u3092\u5225\u306e AZ2 \u306b\u4f5c\u6210\u3057\u3001\u305d\u3053\u3078 Backup \u304b\u3089 Restore\n\n\nInitial state\n\nNova AZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27 |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T02:38:52.000000 |\n| |- node-28 |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T02:38:45.000000 |\n| nova2                    | available                              |\n| |- node-31 |                                        |\n| | |- nova-compute        | enabled :-) 2015-02-25T02:38:53.000000 |\n+--------------------------+----------------------------------------+\n\n\nCinder AZ\n# cinder availability-zone-list\n+-------+-----------+\n|  Name |   Status  |\n+-------+-----------+\n|  nova | available |\n| nova2 | available |\n+-------+-----------+\n\n\nCinder volume\n# cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n| 52a71ec9-57f2-4124-bb80-ba3d93e148e7 | available | admin_vol02  |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n# cinder show admin_vol01 | egrep \"Property|availability_zone\"\n|            Property            |                Value                 |\n|       availability_zone        |                 nova                 |\n\n\nCider Backup\n# cinder backup-list\n+----+-----------+--------+------+------+--------------+-----------+\n| ID | Volume ID | Status | Name | Size | Object Count | Container |\n+----+-----------+--------+------+------+--------------+-----------+\n+----+-----------+--------+------+------+--------------+-----------+\n\n\nBackup Cinder volume in AZ1\n\nTake Cinder backup\n[node-27]# cinder backup-create --display-name admin_vol01_bkup admin_vol01\n+-----------+--------------------------------------+\n|  Property |                Value                 |\n+-----------+--------------------------------------+\n|     id    | 34706b5d-511a-4c5f-91ea-a62162fa44f6 |\n|    name   |           admin_vol01_bkup           |\n| volume_id | 37bc4c84-557c-4aed-abce-0994803aef61 |\n+-----------+--------------------------------------+\n\n\nCheck Cinder backup\n[node-27]# cinder backup-list\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n|                  ID                  |              Volume ID               |   Status  |       Name       | Size | Object Count | Container |\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n| 34706b5d-511a-4c5f-91ea-a62162fa44f6 | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01_bkup |  1   |     None     |  backups  |\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n\n\nRestore Cinder volume to AZ2 from the backup of AZ1\n\nCreate new Cinder volume in AZ2\n# cinder create --display-name admin_vol11 --availability-zone nova2 1\n+---------------------+--------------------------------------+\n|       Property      |                Value                 |\n+---------------------+--------------------------------------+\n|     attachments     |                  []                  |\n|  availability_zone  |                nova2                 |\n|       bootable      |                false                 |\n|      created_at     |      2015-02-25T04:55:45.992701      |\n| display_description |                 None                 |\n|     display_name    |             admin_vol11              |\n|      encrypted      |                False                 |\n|          id         | 5e608667-4489-4171-be96-14358c6f2836 |\n|       metadata      |                  {}                  |\n|         size        |                  1                   |\n|     snapshot_id     |                 None                 |\n|     source_volid    |                 None                 |\n|        status       |               creating               |\n|     volume_type     |                 None                 |\n+---------------------+--------------------------------------+\n\n\nCheck the Cinder volume\n# cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n| 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol11  |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n# cinder show admin_vol11 | egrep \"Property|availability_zone\"\n|            Property            |                Value                 |\n|       availability_zone        |                nova2                 |\n\n\nRestore to the Cinder volume of AZ2 from the backup of AZ1\n# cinder backup-restore --volume-id 5e608667-4489-4171-be96-14358c6f2836 34706b5d-511a-4c5f-91ea-a62162fa44f6\n\n\nCheck the Cinder volume\n# cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n| 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol01  |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n# cinder show 5e608667-4489-4171-be96-14358c6f2836 | egrep \"Property|availability_zone\"\n|            Property            |                Value                 |\n|       availability_zone        |                nova2                 |\n\n\nRename the Cinder volume\n# cinder rename 5e608667-4489-4171-be96-14358c6f2836 admin_vol11\n\n# cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n| 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol11  |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n\nDelete backup\n\nInitial state\n# cinder backup-list\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n|                  ID                  |              Volume ID               |   Status  |       Name       | Size | Object Count | Container |\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n| 34706b5d-511a-4c5f-91ea-a62162fa44f6 | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01_bkup |  1   |     None     |  backups  |\n+--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n\n\nBackup delete\n# cinder backup-delete 34706b5d-511a-4c5f-91ea-a62162fa44f6\n\n\nCheck\n# cinder backup-list\n+----+-----------+--------+------+------+--------------+-----------+\n| ID | Volume ID | Status | Name | Size | Object Count | Container |\n+----+-----------+--------+------+------+--------------+-----------+\n+----+-----------+--------+------+------+--------------+-----------+\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nCinder Backup/Restore\nCinder Backup/Restore between AZ\nCinder Backup/Restore between Region\n## What's this?\n\n* Cinder volume \u306e Backup \u3092 AZ1 \u306b\u4f5c\u6210\n* \u65b0\u3057\u3044 Cinder volume \u3092\u5225\u306e AZ2 \u306b\u4f5c\u6210\u3057\u3001\u305d\u3053\u3078 Backup \u304b\u3089 Restore\n\n\n## Initial state\n\n#### Nova AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27 |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T02:38:52.000000 |\n    | |- node-28 |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T02:38:45.000000 |\n    | nova2                    | available                              |\n    | |- node-31 |                                        |\n    | | |- nova-compute        | enabled :-) 2015-02-25T02:38:53.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Cinder AZ\n\n    # cinder availability-zone-list\n    +-------+-----------+\n    |  Name |   Status  |\n    +-------+-----------+\n    |  nova | available |\n    | nova2 | available |\n    +-------+-----------+\n\n#### Cinder volume\n\n    # cinder list\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n    | 52a71ec9-57f2-4124-bb80-ba3d93e148e7 | available | admin_vol02  |  1   |     None    |  false   |             |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n    # cinder show admin_vol01 | egrep \"Property|availability_zone\"\n    |            Property            |                Value                 |\n    |       availability_zone        |                 nova                 |\n\n\n#### Cider Backup\n\n    # cinder backup-list\n    +----+-----------+--------+------+------+--------------+-----------+\n    | ID | Volume ID | Status | Name | Size | Object Count | Container |\n    +----+-----------+--------+------+------+--------------+-----------+\n    +----+-----------+--------+------+------+--------------+-----------+\n\n## Backup Cinder volume in AZ1\n\n#### Take Cinder backup\n\n    [node-27]# cinder backup-create --display-name admin_vol01_bkup admin_vol01\n    +-----------+--------------------------------------+\n    |  Property |                Value                 |\n    +-----------+--------------------------------------+\n    |     id    | 34706b5d-511a-4c5f-91ea-a62162fa44f6 |\n    |    name   |           admin_vol01_bkup           |\n    | volume_id | 37bc4c84-557c-4aed-abce-0994803aef61 |\n    +-----------+--------------------------------------+\n\n#### Check Cinder backup\n\n    [node-27]# cinder backup-list\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n    |                  ID                  |              Volume ID               |   Status  |       Name       | Size | Object Count | Container |\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n    | 34706b5d-511a-4c5f-91ea-a62162fa44f6 | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01_bkup |  1   |     None     |  backups  |\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n\n\n## Restore Cinder volume to AZ2 from the backup of AZ1\n\n#### Create new Cinder volume in AZ2\n\n    # cinder create --display-name admin_vol11 --availability-zone nova2 1\n    +---------------------+--------------------------------------+\n    |       Property      |                Value                 |\n    +---------------------+--------------------------------------+\n    |     attachments     |                  []                  |\n    |  availability_zone  |                nova2                 |\n    |       bootable      |                false                 |\n    |      created_at     |      2015-02-25T04:55:45.992701      |\n    | display_description |                 None                 |\n    |     display_name    |             admin_vol11              |\n    |      encrypted      |                False                 |\n    |          id         | 5e608667-4489-4171-be96-14358c6f2836 |\n    |       metadata      |                  {}                  |\n    |         size        |                  1                   |\n    |     snapshot_id     |                 None                 |\n    |     source_volid    |                 None                 |\n    |        status       |               creating               |\n    |     volume_type     |                 None                 |\n    +---------------------+--------------------------------------+\n\n#### Check the Cinder volume\n\n    # cinder list\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n    | 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol11  |  1   |     None    |  false   |             |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n    # cinder show admin_vol11 | egrep \"Property|availability_zone\"\n    |            Property            |                Value                 |\n    |       availability_zone        |                nova2                 |\n\n\n#### Restore to the Cinder volume of AZ2 from the backup of AZ1\n\n    # cinder backup-restore --volume-id 5e608667-4489-4171-be96-14358c6f2836 34706b5d-511a-4c5f-91ea-a62162fa44f6\n\n#### Check the Cinder volume\n\n    # cinder list\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n    | 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol01  |  1   |     None    |  false   |             |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n    # cinder show 5e608667-4489-4171-be96-14358c6f2836 | egrep \"Property|availability_zone\"\n    |            Property            |                Value                 |\n    |       availability_zone        |                nova2                 |\n\n\n#### Rename the Cinder volume\n\n    # cinder rename 5e608667-4489-4171-be96-14358c6f2836 admin_vol11\n\n    # cinder list\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01  |  1   |     None    |  false   |             |\n    | 5e608667-4489-4171-be96-14358c6f2836 | available | admin_vol11  |  1   |     None    |  false   |             |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n## Delete backup\n\n#### Initial state\n\n    # cinder backup-list\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n    |                  ID                  |              Volume ID               |   Status  |       Name       | Size | Object Count | Container |\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n    | 34706b5d-511a-4c5f-91ea-a62162fa44f6 | 37bc4c84-557c-4aed-abce-0994803aef61 | available | admin_vol01_bkup |  1   |     None     |  backups  |\n    +--------------------------------------+--------------------------------------+-----------+------------------+------+--------------+-----------+\n\n#### Backup delete\n\n    # cinder backup-delete 34706b5d-511a-4c5f-91ea-a62162fa44f6\n\n#### Check\n\n    # cinder backup-list\n    +----+-----------+--------+------+------+--------------+-----------+\n    | ID | Volume ID | Status | Name | Size | Object Count | Container |\n    +----+-----------+--------+------+------+--------------+-----------+\n    +----+-----------+--------+------+------+--------------+-----------+\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n## Reference\n\n[Cinder Backup/Restore][link-01]\n[Cinder Backup/Restore between AZ][link-02]\n[Cinder Backup/Restore between Region][link-03]\n\n[link-01]:http://qiita.com/idzzy/items/ac163d0ce7cc9f036031\n[link-02]:http://qiita.com/idzzy/items/caaa83de00abe78095e2\n[link-03]:http://qiita.com/idzzy/items/fef77c7853eb6f6b1479\n", "tags": ["openstack", "Cinder"]}