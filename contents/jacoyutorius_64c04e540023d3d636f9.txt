{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\ntd-agent\u306a\u3093\u304b\u304c\u6d41\u884c\u308a\u306e\u4eca\u3001system\u30ed\u30b0\u3092\u305d\u306e\u307e\u3093\u307e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u3044\u306a\u3093\u3066\u306e\u306f\u8ab0\u3082\u304c\"\u305d\u308c\u307b\u3093\u3068\u306b\u5f8c\u3067\u4f7f\u3046\u306e\u304b\u3088\uff1f\"\u3068\u8a00\u3044\u305f\u304f\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u307e\u3041\u696d\u52d9\u547d\u4ee4\u306a\u306e\u3067\u3084\u3063\u3066\u307f\u305f\u6b21\u7b2c\u3002\n\nAWS CLI + Ruby\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u305b\u308b\u30c4\u30fc\u30eb\u306f\u3001s3sync\u3084s3cmd\u306a\u3069\u3042\u308a\u307e\u3059\u304c\u3001\n\u7d14\u6b63\u306e\u3082\u306e\u3092\u4f7f\u3063\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u5f8c\u3005\u306eAPI\u306e\u5909\u66f4\u306b\u3082\u5f37\u304b\u308d\u3046\u3068\u601d\u3044\u3001AWS CLI\u3092Ruby\u304b\u3089\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\uff08AWS Ruby SDK\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066API\u306e\u4ed5\u69d8\u304c\u30ac\u30e9\u30c3\u3068\u5909\u308f\u3063\u305f\u3053\u3068\u3082\u3042\u3063\u305f\u306e\u3067\u3002\u3042\u3068\u3001AWS CLI\u306e\u307b\u3046\u304c\u76f4\u611f\u7684\u306b\u4f7f\u3048\u308b\u6c17\u304c\u500b\u4eba\u7684\u306b\u306f\u3057\u3066\u307e\u3059\uff09\n\n\u4f7f\u3044\u65b9\u306a\u3069\n\u5b9f\u884c\u30b5\u30fc\u30d0\u30fc\u306fScientificLinux6.5\u3002\n\nAWS CLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff06\u8a2d\u5b9a\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3002\nCentOS6.5\u306baws-cli\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u5b9f\u884c\ngit clone git@bitbucket.org:FOURIER_INC/fanatic.git\ncd fanatic\nbundle install\nbundle exec app.rb\n\n\n\u30b3\u30fc\u30c9\n\u7279\u306b\u8aac\u660e\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u3082\u306a\u3044\u304b\u306a\u3002\u3002\nRuby\u3067\u66f8\u3044\u3066\u3044\u308b\u3051\u3069\u3001Kernel#system\u3067\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3060\u3051\u3002\n\u8907\u6570\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001s3://#{\u30d0\u30b1\u30c3\u30c8\u540d}/#{\u30db\u30b9\u30c8\u540d} \u4ee5\u4e0b\u306b\u30ed\u30b0\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u308b\u3002\n\napp.rb\n# \u4fdd\u5b58\u3059\u308b\u30ed\u30b0\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30d1\u30b9\ntarget_dir_path = [\n  \"/var/log/httpd\",\n  \"/var/log/mysql\",\n  \"/var/log/messages\"\n]\ntarget_file_path = [\n  \"/var/log/lastlog\",\n  \"/var/log/maillog\",\"\n  \"\"/var/log/yum-log\",\n  \"/var/log/secure\"\n]\n\n# \u4fdd\u5b58\u3059\u308b\u30d0\u30b1\u30c3\u30c8\u540d\ntarget_bucket = \"log-transfer\"\n# \u30d7\u30ec\u30d5\u30a3\u30af\u30b9\uff08\u30b5\u30fc\u30d0\u30fc\u540d\uff09\ntarget_prefix = `hostname`.strip\n\n# upload directories\ntarget_dir_path.each do |path|\n  next unless Dir.exist? path\n\n  # \"./test_dir\" => \"test_dir\"\n  dirname = path.split(\"/\").last\n  [\n    \"aws s3 sync #{path} s3://#{target_bucket}/#{target_prefix}/#{dirname}\",\n    \"aws s3 ls s3://#{target_bucket}\"\n  ].each do |command|\n    system command\n  end\nend\n\n# upload files\ntarget_file_path.each do |path|\n  next unless File.exist? path\n\n  filename = path.split(\"/\").last\n  [\n    \"aws s3 cp #{path} s3://#{target_bucket}/#{target_prefix}/#{filename}\",\n    \"aws s3 ls s3://#{target_bucket}\"\n  ].each do |command|\n    system command\n  end\nend\n\n\n\n\u307e\u3068\u3081\n\u3053\u3046\u3044\u3046\u5b9f\u88c5\u304c\u826f\u3044\u306e\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3051\u3069\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30b4\u30ea\u30b4\u30ea\u66f8\u304f\u306e\u5acc\u3060\u306a\u3041\u3068\u601d\u3046\u50d5\u306e\u3088\u3046\u306a\u4eba\u306b\u306fRuby\u3067\u30b5\u30af\u30c3\u3068\u66f8\u3051\u308b\u306e\u306f\u3044\u3044\u306a\u3041\u3068\u3002\n\n# \u306f\u3058\u3081\u306b\n\ntd-agent\u306a\u3093\u304b\u304c\u6d41\u884c\u308a\u306e\u4eca\u3001system\u30ed\u30b0\u3092\u305d\u306e\u307e\u3093\u307e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u3044\u306a\u3093\u3066\u306e\u306f\u8ab0\u3082\u304c\"\u305d\u308c\u307b\u3093\u3068\u306b\u5f8c\u3067\u4f7f\u3046\u306e\u304b\u3088\uff1f\"\u3068\u8a00\u3044\u305f\u304f\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3059\u304c\u3001\u307e\u3041\u696d\u52d9\u547d\u4ee4\u306a\u306e\u3067\u3084\u3063\u3066\u307f\u305f\u6b21\u7b2c\u3002\n\n# AWS CLI + Ruby\n\nS3\u3078\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u305b\u308b\u30c4\u30fc\u30eb\u306f\u3001s3sync\u3084s3cmd\u306a\u3069\u3042\u308a\u307e\u3059\u304c\u3001\n\u7d14\u6b63\u306e\u3082\u306e\u3092\u4f7f\u3063\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u5f8c\u3005\u306eAPI\u306e\u5909\u66f4\u306b\u3082\u5f37\u304b\u308d\u3046\u3068\u601d\u3044\u3001AWS CLI\u3092Ruby\u304b\u3089\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\uff08AWS Ruby SDK\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u3082\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066API\u306e\u4ed5\u69d8\u304c\u30ac\u30e9\u30c3\u3068\u5909\u308f\u3063\u305f\u3053\u3068\u3082\u3042\u3063\u305f\u306e\u3067\u3002\u3042\u3068\u3001AWS CLI\u306e\u307b\u3046\u304c\u76f4\u611f\u7684\u306b\u4f7f\u3048\u308b\u6c17\u304c\u500b\u4eba\u7684\u306b\u306f\u3057\u3066\u307e\u3059\uff09\n\n\n# \u4f7f\u3044\u65b9\u306a\u3069\n\n\u5b9f\u884c\u30b5\u30fc\u30d0\u30fc\u306fScientificLinux6.5\u3002\n\n## AWS CLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff06\u8a2d\u5b9a\n\n\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3002\n\n[CentOS6.5\u306baws-cli\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://rikuga.me/2014/02/14/centos6-5\u306baws-cli\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/)\n\n## \u5b9f\u884c\n\n```\ngit clone git@bitbucket.org:FOURIER_INC/fanatic.git\ncd fanatic\nbundle install\nbundle exec app.rb\n```\n\n## \u30b3\u30fc\u30c9\n\n\u7279\u306b\u8aac\u660e\u3059\u308b\u3088\u3046\u306a\u3053\u3068\u3082\u306a\u3044\u304b\u306a\u3002\u3002\nRuby\u3067\u66f8\u3044\u3066\u3044\u308b\u3051\u3069\u3001Kernel#system\u3067\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u3060\u3051\u3002\n\n\u8907\u6570\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001s3://#{\u30d0\u30b1\u30c3\u30c8\u540d}/#{\u30db\u30b9\u30c8\u540d} \u4ee5\u4e0b\u306b\u30ed\u30b0\u304c\u4fdd\u5b58\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u308b\u3002\n\n\n```app.rb\n# \u4fdd\u5b58\u3059\u308b\u30ed\u30b0\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u306e\u30d1\u30b9\ntarget_dir_path = [\n  \"/var/log/httpd\",\n  \"/var/log/mysql\",\n  \"/var/log/messages\"\n]\ntarget_file_path = [\n  \"/var/log/lastlog\",\n  \"/var/log/maillog\",\"\n  \"\"/var/log/yum-log\",\n  \"/var/log/secure\"\n]\n\n# \u4fdd\u5b58\u3059\u308b\u30d0\u30b1\u30c3\u30c8\u540d\ntarget_bucket = \"log-transfer\"\n# \u30d7\u30ec\u30d5\u30a3\u30af\u30b9\uff08\u30b5\u30fc\u30d0\u30fc\u540d\uff09\ntarget_prefix = `hostname`.strip\n\n# upload directories\ntarget_dir_path.each do |path|\n  next unless Dir.exist? path\n\n  # \"./test_dir\" => \"test_dir\"\n  dirname = path.split(\"/\").last\n  [\n    \"aws s3 sync #{path} s3://#{target_bucket}/#{target_prefix}/#{dirname}\",\n    \"aws s3 ls s3://#{target_bucket}\"\n  ].each do |command|\n    system command\n  end\nend\n\n# upload files\ntarget_file_path.each do |path|\n  next unless File.exist? path\n\n  filename = path.split(\"/\").last\n  [\n    \"aws s3 cp #{path} s3://#{target_bucket}/#{target_prefix}/#{filename}\",\n    \"aws s3 ls s3://#{target_bucket}\"\n  ].each do |command|\n    system command\n  end\nend\n```\n\n## \u307e\u3068\u3081\n\n\u3053\u3046\u3044\u3046\u5b9f\u88c5\u304c\u826f\u3044\u306e\u304b\u306f\u308f\u304b\u3089\u306a\u3044\u3051\u3069\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30b4\u30ea\u30b4\u30ea\u66f8\u304f\u306e\u5acc\u3060\u306a\u3041\u3068\u601d\u3046\u50d5\u306e\u3088\u3046\u306a\u4eba\u306b\u306fRuby\u3067\u30b5\u30af\u30c3\u3068\u66f8\u3051\u308b\u306e\u306f\u3044\u3044\u306a\u3041\u3068\u3002\n\n", "tags": ["S3", "AWS", "Ruby"]}