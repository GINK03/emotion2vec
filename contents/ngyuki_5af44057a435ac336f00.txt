{"tags": ["PHP", "PHPUnit", "docker"], "context": " More than 1 year has passed since last update.\u5c11\u3057\u524d\u306b ParaTest \u3068 Docker \u3092\u4f7f\u3063\u3066 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\n\nParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita\n\n\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u305f\u3068\u304d\u3088\u308a\u3082\u5341\u500d\u8fd1\u304f\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\u6539\u5584\u70b9\u3068\u3057\u3066\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u8003\u3048\u3066\u3044\u307e\u3057\u305f\u3002\n\nParaTest \u3092\u5f04\u3063\u3066 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u4e26\u5217\u6570\u3060\u3051\u3057\u304b\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\nRAID0 \u3068\u304b\u3067\u30c7\u30a3\u30b9\u30af\u306e I/O \u3092\u826f\u304f\u3059\u308b\n\u3082\u3046\u5c11\u3057\u30de\u30b7\u306a\u6027\u80fd(CPU \u3084\u30e1\u30e2\u30ea)\u306e\u30b5\u30fc\u30d0\u3067\u3084\u308b\n\n\u4eca\u306e\u3054\u6642\u4e16 AWS \u306a\u3069\u306e IaaS \u3092\u4f7f\u3048\u3070\u305d\u308c\u306a\u308a\u306e\u6027\u80fd\u306e\u30b5\u30fc\u30d0\u304c\u3059\u3050\u306b\u4f7f\u3048\u308b\u306e\u3067 AWS EC2 \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\u524d\u56de\u306f phpunit \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u3092\u884c\u3063\u305f\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u304c\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3068\u3066\u3082\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u3053\u308c\u3092\u6539\u5584\u3059\u308b\u305f\u3081\u306b\u306f ParaTest \u3092\u5f04\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u304f\u8003\u3048\u308c\u3070\u5358\u306b ParaTest \u306e\u5b9f\u884c\u524d\u306b\u5fc5\u8981\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 phpunit \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066 PHPUnit \u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3044\u3060\u3051\u306a\u306e\u3067\u3001\u6b21\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\nphpunit-docker-start\n#!/bin/bash\n\nexport PHPUNIT_DOCKER_IMAGE=sample\nexport PHPUNIT_DOCKER_DIR=$(cd \"$(dirname \"$0\")\"/..;pwd)\nexport PHPUNIT_DOCKER_TMP=/tmp/phpunit-docker-$$\nexport PHPUNIT_DOCKER_PARA=${PHPUNIT_DOCKER_PARA:=4}\nexport PHPUNIT_DOCKER_ENTER=\"sudo /usr/local/bin/docker-enter\"\n\nfunction cleanup\n{\n  echo -e \"\\nCleanup...\"\n  for cid in $(ls \"$PHPUNIT_DOCKER_TMP\"); do\n    docker rm -f \"$cid\"\n    rm -f \"$PHPUNIT_DOCKER_TMP/$cid\"\n  done\n  rmdir \"$PHPUNIT_DOCKER_TMP\"\n}\n\ntrap cleanup 0\n\n[ ! -d \"$PHPUNIT_DOCKER_TMP\" ] && {\n  mkdir -p \"$PHPUNIT_DOCKER_TMP\"\n}\n\nfor (( i=0; i<\"$PHPUNIT_DOCKER_PARA\"; i++ )); do\n  cid=$(docker run -d \\\n    -v /tmp:/tmp:rw \\\n    -v \"$PHPUNIT_DOCKER_DIR:$PHPUNIT_DOCKER_DIR:ro\" \\\n    -w \"$PHPUNIT_DOCKER_DIR\" \"$PHPUNIT_DOCKER_IMAGE\" \\\n    /usr/bin/mysqld_safe\n  )\n  echo \"docker run $cid\"\n  touch \"$PHPUNIT_DOCKER_TMP/$cid\"\ndone\n\ncd \"$PHPUNIT_DOCKER_DIR\"\nvendor/bin/paratest --processes=\"$PHPUNIT_DOCKER_PARA\" --phpunit=$(dirname \"$0\")/phpunit-docker-enter\n\nphpunit-docker-enter\n#!/bin/bash\n\nfunction log\n{\n  logger -t phpunit-docker \"$@\"\n}\n\nwhile :; do\n  for cid in $(ls \"$PHPUNIT_DOCKER_TMP\"); do\n    {\n      flock -n -x $fd && {\n        log \"enter: $cid\"\n        $PHPUNIT_DOCKER_ENTER \"$cid\" /bin/bash -c '\n          cd \"$1\"\n          shift\n          vendor/bin/phpunit \"$@\"\n        ' -- \"$PHPUNIT_DOCKER_DIR\" \"$@\"\n        log \"leave: $cid\"\n        exit\n      }\n    } {fd}< \"$PHPUNIT_DOCKER_TMP/$cid\"\n  done\n  sleep 10\ndone\n\nphpunit-docker-start \u304c paratest \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3001\u5fc5\u8981\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 paratest \u3092\u5b9f\u884c\u3057\u3001\u7d42\u4e86\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u4e26\u5217\u6570\u306f\u74b0\u5883\u5909\u6570 PHPUNIT_DOCKER_PARA \u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\nphpunit-docker-enter \u304c phpunit \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u3063\u3066 phpunit \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308b\u305f\u3081\u306b docker-enter \u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306f\u5f8c\u8ff0\u3059\u308b\u624b\u9806\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nEC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6e96\u5099\n\u307e\u305a\u306f EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 t2.micro \u3067\u4f5c\u6210\u3057\u307e\u3059\u3002AMI \u306f Amazon Linux AMI 2014.09 (HVM) \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u5f8c\u306b SSH \u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u6b21\u306e\u3088\u3046\u306b Docker \u3084\u3089 PHP \u3084\u3089\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo su -\n\n# rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\n# yum -y install docker-io\n# yum -y install mysql55-server\n# yum -y install php55 php55-cli php55-opcache \\\n  php55-process php55-mysqlnd php55-pdo php55-mbstring php55-xml \\\n  php55-pecl-xdebug php55-pecl-jsonc\n\n# mkdir -p /path/to/sample\n# chown ec2-user. /path/to/sample\n\n# chkconfig docker on\n# service docker start\n\n# docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter\n\ndocker run --rm -v /usr/local/bin:/target jpetazzo/nsenter \u3067 docker-enter \u3068\u3044\u3046 Docker \u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002Docker \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3068\u3057\u3066\u4f7f\u3046\u306a\u3093\u3066\u9762\u767d\u3044\u3067\u3059\u306d\u3002\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\u30ed\u30fc\u30ab\u30eb\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 rsync \u3067\u307e\u308b\u3054\u3068\u8ee2\u9001\u3057\u307e\u3059\u3002\n$ rsync /path/to/sample/ ec2-user@192.0.2.123:/path/to/sample/ -azv\n\n\nDocker \u30b3\u30f3\u30c6\u30ca\u306e\u6e96\u5099\n\u524d\u56de\u306e\u5185\u5bb9\u3068\u5909\u308f\u308a\u3042\u308a\u307e\u305b\u3093\u3002\n\nParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita\n\nDockerfile \u3067\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u307e\u3067\u3092\u884c\u3044\u307e\u3059\u3002\nFROM centos:centos6\nMAINTAINER ore\n\nRUN yum -y install epel-release rootfiles\nRUN rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\nRUN yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum -y install mysql-community-server\n\nRUN yum -y install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nRUN yum -y --enablerepo=remi-php55 install php php-cli php-opcache \\\n  php-process php-mysqlnd php-pdo php-mbstring php-xml \\\n  php-pecl-xdebug php-pecl-zip  php-pecl-yaml php-pecl-jsonc\n\nRUN echo -e \"[mysqld]\\ntmpdir = /var/tmp\\n\" > /etc/my.cnf\nRUN touch /etc/sysconfig/network\nRUN mysql_install_db --user=mysql\n\nRUN service mysqld start && mysql -ve \" \\\n  CREATE DATABASE sample_test DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin; \\\n  GRANT ALL ON sample_test.* TO sample@'localhost'; \\\n  GRANT ALL ON sample_test.* TO sample@'%'; \\\n\" ; service mysqld stop\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n# docker build -t sample:base .\n\n\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# docker run --name=tmp -v /path/to/sample:/path/to/sample:ro sample:base /bin/bash -c '\n  service mysqld start\n  cd /path/to/sample\n  ./build.sh migrate --test\n  service mysqld stop\n'\n# docker commit tmp sample\n# docker rm tmp\n\n\nt2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u4e0a\u624b\u304f\u69cb\u7bc9\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u306e\u78ba\u8a8d\u306e\u305f\u3081\u306b t2.micro \u306e\u307e\u307e\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305a\u306f\u524d\u56de\u4f5c\u6210\u3057\u305f phpunit-docker \u3067\u3001\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n# cd /path/to/sample\n# tests/phpunit-docker\n\n\u6b21\u306e\u901a\u308a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nStarting mysqld:  [  OK  ]\nPHPUnit 3.7.37 by Sebastian Bergmann.\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 720 (  8%)\n............................................................... 126 / 720 ( 17%)\n............................................................... 189 / 720 ( 26%)\n............................................................... 252 / 720 ( 35%)\n............................................................... 315 / 720 ( 43%)\n............................................................... 378 / 720 ( 52%)\n............................................................... 441 / 720 ( 61%)\n............................................................... 504 / 720 ( 70%)\n............................................................... 567 / 720 ( 78%)\n............................................................... 630 / 720 ( 87%)\n............................................................... 693 / 720 ( 96%)\n.........................\n\nTime: 1.35 minutes, Memory: 111.50Mb\n\nOK (718 tests, 2726 assertions)\n\n\nt2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u7d9a\u3044\u3066\u3001\u65b0\u3057\u304f\u4f5c\u6210\u3057\u305f phpunit-docker-start \u3068 phpunit-docker-enter \u3067\u4e26\u5217\u6570 2 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# cd /path/to/sample\n# PHPUNIT_DOCKER_PARA=2 tests/phpunit-docker-start\n\n\u6b21\u306e\u901a\u308a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\ndocker run 093e(\u7565)\ndocker run feb6(\u7565)\n\nRunning phpunit in 2 processes with tests/phpunit-docker-enter\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n........E...................................................... 504 / 644 ( 78%)\n..............................................................F 567 / 644 ( 88%)\n............................................................... 630 / 644 ( 97%)\n............................................................... 693 / 644 (107%)\n.........................\n\nTime: 1.71 minutes, Memory: 36.50Mb\n\nThere was 1 error:\n\n(\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2720, Failures: 1, Errors: 1.\n\nCleanup...\n093e(\u7565)\nfeb6(\u7565)\n\n\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3088\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u30fb\u30fb\u30fbt2.micro \u306a\u306e\u3067\u4ed5\u65b9\u3042\u308a\u307e\u305b\u3093\u3002\n\u30b3\u30b1\u305f\u30c6\u30b9\u30c8\u304c\u3042\u308b\u306e\u306f\u3001\u3042\u308b\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u5225\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u5b9f\u884c\u3092\u524d\u63d0\u306b\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u5f0a\u5bb3\u3067\u3059\u304c\u3001\u3069\u3061\u3089\u304b\u3068\u3044\u3048\u3070\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u306e\u554f\u984c\u3067\u3059\u3002\n\nt2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u300c\u30d7\u30ed\u30bb\u30b9\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u300d\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3057\u305f\u3002t2.micro \u3060\u3068\u4e26\u5217\u6570 10 \u306f\u7121\u7406\u3067\u3057\u305f\u3002\n\nm3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\nt2.micro \u3067\u4e26\u5217\u6570\u3092\u4e0a\u3052\u308b\u306e\u306f\u7121\u7406\u304c\u3042\u308b\u306e\u3067\u3001\u304a\u8ca1\u5e03\u4e8b\u60c5\u3068\u76f8\u8ac7\u306e\u3046\u3048 m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u8a66\u3057\u307e\u3057\u305f\u3002\nt2.micro \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 AMI \u3092\u4f5c\u6210\u3057\u3001\u305d\u306e AMI \u304b\u3089 m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# tests/phpunit-docker\n(\u7565)\nTime: 1.28 minutes, Memory: 111.50Mb\n(\u7565)\n\nt2.micro \u3068\u3042\u307e\u308a\u5909\u308f\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\nm3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u6b21\u306b\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\ndocker run e642(\u7565)\ndocker run 7afc(\u7565)\ndocker run bd6d(\u7565)\ndocker run d7af(\u7565)\ndocker run 599e(\u7565)\ndocker run 2278(\u7565)\ndocker run 464b(\u7565)\ndocker run 960b(\u7565)\ndocker run 1789(\u7565)\ndocker run 84d8(\u7565)\n\nRunning phpunit in 10 processes with tests/phpunit-docker-enter\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n............................................................... 504 / 644 ( 78%)\n......E...................................F.................... 567 / 644 ( 88%)\n............................................................... 630 / 644 ( 97%)\n............................................................... 693 / 644 (107%)\n.........................\n\nTime: 28.5 seconds, Memory: 36.50Mb\n\nThere was 1 error:\n\n(\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2721, Failures: 1, Errors: 1.\n\nCleanup...\n1789(\u7565)\n2278(\u7565)\n464b(\u7565)\n599e(\u7565)\n7afc(\u7565)\n84d8(\u7565)\n960b(\u7565)\nbd6d(\u7565)\nd7af(\u7565)\ne642(\u7565)\n\n\uff12\u500d\u4ee5\u4e0a\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u3055\u3059\u304c m3.2xlarge \u306f\u683c\u304c\u9055\u3044\u307e\u3057\u305f\u3002\n\nm3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 20 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u52e2\u3044\u4f59\u3063\u3066\u4e26\u5217\u6570 20 \u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n# PHPUNIT_DOCKER_PARA=20 tests/phpunit-docker-start\n(\u7565)\nTime: 36.5 seconds, Memory: 37.25Mb\n(\u7565)\n\n\u4e26\u5217\u6570 10 \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u3053\u308c\u4ee5\u4e0a\u4e26\u5217\u6570\u3092\u4e0a\u3052\u3066\u3082\u65e9\u304f\u306f\u306a\u3089\u306a\u3055\u305d\u3046\u3067\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u3067\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\n\u6b21\u306b\u3001\u3082\u3063\u3068\u30c7\u30a3\u30b9\u30af\u3092\u65e9\u304f\u3059\u308b\u305f\u3081\u306b AWS \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nm3.2xlarge \u3060\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u304c\uff12\u3064\u3042\u3063\u305f\u306e\u3067\u3001LVM \u3067\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002\n# umount /dev/xvdb\n# pvcreate /dev/xvdb /dev/xvdc\n# vgcreate vg0 /dev/xvdb /dev/xvdc\n# lvcreate -L 40G -i 2 -n docker vg0\n# mkfs.ext4 /dev/vg0/docker\n# service docker stop\n# mount -t ext4 /dev/vg0/docker /mnt\n# cp -a /var/lib/docker/* /mnt/\n# umount /mnt\n# mount -t ext4 /dev/vg0/docker /var/lib/docker\n# service docker start\n\n\nm3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# tests/phpunit-docker\n(\u7565)\nTime: 2.73 minutes, Memory: 111.50Mb\n(\u7565)\n\nEBS \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\nm3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u7d9a\u3044\u3066\u3001\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\n(\u7565)\nTime: 1.74 minutes, Memory: 36.50Mb\n(\u7565)\n\n\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u3088\u308a\u306f\u65e9\u3044\u3067\u3059\u304c\u3001\u3084\u3063\u3071\u308a EBS \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\nEBS \u3088\u308a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306e\u65b9\u304c I/O \u6027\u80fd\u306f\u826f\u3044\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u308f\u3051\u3067\u306f\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\u306d\uff1f \u3042\u308b\u3044\u306f\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u3084\u30de\u30a6\u30f3\u30c8\u306e\u3084\u308a\u65b9\u304c\u307e\u305a\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nm3.2xlarge \u306e tmpfs \u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u4e26\u5217\u6570\u3092\u5897\u3084\u3057\u3066\u3082\u30c7\u30a3\u30b9\u30af\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3042\u307e\u308a\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u30c0\u30e1\u5143\u3067 /var/lib/docker \u3092 tmpfs \u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u307e\u305a\u3001\u73fe\u5728\u306e\u30b5\u30a4\u30ba\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# du -sh /var/lib/docker/\n1.5G    /var/lib/docker/\n\n1.5G \u3057\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u30018G \u3050\u3089\u3044\u3042\u308c\u3070\u5341\u5206\u3067\u3057\u3087\u3046\u3002\n# service docker stop\n# umount /var/lib/docker\n# mkdir /docker\n# mount -t tmpfs -o size=8G tmpfs /docker\n# cp -a /var/lib/docker/* /docker\n# mount --bind /docker /var/lib/docker\n# service docker start\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# tests/phpunit-docker\n(\u7565)\nTime: 45.86 seconds, Memory: 111.75Mb\n(\u7565)\n\n\u3055\u3059\u304c\u306b\u901f\u3044\u3067\u3059\u3001EBS \u3068\u304f\u3089\u3079\u3066\u500d\u3050\u3089\u3044\u901f\u3044\u3067\u3059\u3002\n\u6b21\u306b\u4e26\u5217\u6570 10 \u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\n(\u7565)\nTime: 17.48 seconds, Memory: 36.50Mb\n(\u7565)\n\n\u3055\u3089\u306b\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3001\u5f53\u305f\u308a\u524d\u306a\u6c17\u3082\u3057\u307e\u3059\u304c\u3059\u3054\u3044\u3067\u3059\u3002\n\n\u307e\u3068\u3081\n\u5f53\u521d\u306e\u79c1\u306e\u30ed\u30fc\u30ab\u30eb\u306e VM \u3067\uff11\u5206\u534a\u3050\u3089\u3044\u304b\u304b\u3063\u3066\u3044\u305f\u30c6\u30b9\u30c8\u304c\u3001\u6700\u7d42\u7684\u306b 18 \u79d2\u3050\u3089\u3044\u306b\u307e\u3067\u77ed\u7e2e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u3082\u3001AWS \u306e\u305d\u308c\u306a\u308a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3063\u305f\u308a tmpfs \u306b\u3057\u3066\u307f\u305f\u308a\u3068\u304b\u306a\u308a\u7121\u7406\u77e2\u7406\u611f\u306f\u3042\u308a\u307e\u3059\u304c\u3002\n\u3055\u3059\u304c\u306b\u3053\u306e\u305f\u3081\u3060\u3051\u306b\uff11\u6642\u9593\u3067100\u5186\u306f\u8f9b\u3044\u3067\u3059\u304c\u3001\u30e1\u30e2\u30ea\u3068CPU\u30b3\u30a2\u6570\u3055\u3048\u3069\u3046\u306b\u304b\u51fa\u6765\u308c\u3070 ParaTest+Docker \u3067\u30c6\u30b9\u30c8\u3092\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u8a66\u307f\u3082\u30a2\u30ea\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nc3.8xlarge \u306e tmpfs \u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u9650\u754c\u304c\u898b\u305f\u304f\u306a\u3063\u305f\u306e\u3067 c3.8xlarge \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3084\u308b\u3053\u3068\u306f m3.2xlarge \u306e\u3068\u304d\u3068\u5909\u308f\u308a\u307e\u305b\u3093\u304c\u3001\u30b3\u30f3\u30c6\u30ca\u6570\u304c\u5897\u3048\u308b\u306e\u3067 tmpfs \u306e\u30b5\u30a4\u30ba\u3092 20G \u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3042\u3068\u3001\uff11\u6642\u9593\u3067200\u5186\u3050\u3089\u3044\u30c1\u30e3\u30ea\u30f3\u30c1\u30e3\u30ea\u30f3\u3057\u307e\u3059\u3002\n# service docker stop\n# mkdir /docker\n# mount -t tmpfs -o size=20G tmpfs /docker\n# cp -a /var/lib/docker/* /docker\n# mount --bind /docker /var/lib/docker\n# service docker start\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n# tests/phpunit-docker\n(\u7565)\nTime: 44.55 seconds, Memory: 111.75Mb\n(\u7565)\n\n\u307e\u3041\u5909\u308f\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\u6b21\u306b\u4e26\u5217\u6570 20 \u3067\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n# PHPUNIT_DOCKER_PARA=20 tests/phpunit-docker-start\n(\u7565)\nTime: 6.36 seconds, Memory: 36.25Mb\n(\u7565)\n\n\u3082\u3046\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u524a\u9664\u306b\u4e00\u756a\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\uff08\u4e0a\u3067\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u6642\u9593\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u306e\u6642\u9593\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\uff09\u3002\n\u6b21\u306b\u4e26\u5217\u6570 30 \u3067\u5b9f\u884c\u30fb\u30fb\u30fb\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u4e0a\u624b\u304f\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u79c1\u306e\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4f55\u304b\u3057\u3089\u554f\u984c\u304c\u3042\u308b\u304b\u3001\u3082\u3057\u304f\u306f\u306a\u306b\u304b\u5225\u306e\u539f\u56e0\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u5c11\u3057\u524d\u306b ParaTest \u3068 Docker \u3092\u4f7f\u3063\u3066 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\n\n - [ParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita](http://qiita.com/ngyuki/items/c831c7af4a8ac6948c7d \"ParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita\")\n\n\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u305f\u3068\u304d\u3088\u308a\u3082\u5341\u500d\u8fd1\u304f\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u6539\u5584\u70b9\u3068\u3057\u3066\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u8003\u3048\u3066\u3044\u307e\u3057\u305f\u3002\n\n - ParaTest \u3092\u5f04\u3063\u3066 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u4e26\u5217\u6570\u3060\u3051\u3057\u304b\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n - RAID0 \u3068\u304b\u3067\u30c7\u30a3\u30b9\u30af\u306e I/O \u3092\u826f\u304f\u3059\u308b\n - \u3082\u3046\u5c11\u3057\u30de\u30b7\u306a\u6027\u80fd(CPU \u3084\u30e1\u30e2\u30ea)\u306e\u30b5\u30fc\u30d0\u3067\u3084\u308b\n\n\u4eca\u306e\u3054\u6642\u4e16 AWS \u306a\u3069\u306e IaaS \u3092\u4f7f\u3048\u3070\u305d\u308c\u306a\u308a\u306e\u6027\u80fd\u306e\u30b5\u30fc\u30d0\u304c\u3059\u3050\u306b\u4f7f\u3048\u308b\u306e\u3067 AWS EC2 \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u524d\u56de\u306f `phpunit` \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u3092\u884c\u3063\u305f\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u304c\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3068\u3066\u3082\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u3092\u6539\u5584\u3059\u308b\u305f\u3081\u306b\u306f ParaTest \u3092\u5f04\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3088\u304f\u8003\u3048\u308c\u3070\u5358\u306b ParaTest \u306e\u5b9f\u884c\u524d\u306b\u5fc5\u8981\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 `phpunit` \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066 PHPUnit \u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3044\u3060\u3051\u306a\u306e\u3067\u3001\u6b21\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n*phpunit-docker-start*\n\n```bash\n#!/bin/bash\n\nexport PHPUNIT_DOCKER_IMAGE=sample\nexport PHPUNIT_DOCKER_DIR=$(cd \"$(dirname \"$0\")\"/..;pwd)\nexport PHPUNIT_DOCKER_TMP=/tmp/phpunit-docker-$$\nexport PHPUNIT_DOCKER_PARA=${PHPUNIT_DOCKER_PARA:=4}\nexport PHPUNIT_DOCKER_ENTER=\"sudo /usr/local/bin/docker-enter\"\n\nfunction cleanup\n{\n  echo -e \"\\nCleanup...\"\n  for cid in $(ls \"$PHPUNIT_DOCKER_TMP\"); do\n    docker rm -f \"$cid\"\n    rm -f \"$PHPUNIT_DOCKER_TMP/$cid\"\n  done\n  rmdir \"$PHPUNIT_DOCKER_TMP\"\n}\n\ntrap cleanup 0\n\n[ ! -d \"$PHPUNIT_DOCKER_TMP\" ] && {\n  mkdir -p \"$PHPUNIT_DOCKER_TMP\"\n}\n\nfor (( i=0; i<\"$PHPUNIT_DOCKER_PARA\"; i++ )); do\n  cid=$(docker run -d \\\n    -v /tmp:/tmp:rw \\\n    -v \"$PHPUNIT_DOCKER_DIR:$PHPUNIT_DOCKER_DIR:ro\" \\\n    -w \"$PHPUNIT_DOCKER_DIR\" \"$PHPUNIT_DOCKER_IMAGE\" \\\n    /usr/bin/mysqld_safe\n  )\n  echo \"docker run $cid\"\n  touch \"$PHPUNIT_DOCKER_TMP/$cid\"\ndone\n\ncd \"$PHPUNIT_DOCKER_DIR\"\nvendor/bin/paratest --processes=\"$PHPUNIT_DOCKER_PARA\" --phpunit=$(dirname \"$0\")/phpunit-docker-enter\n```\n\n*phpunit-docker-enter*\n\n```bash\n#!/bin/bash\n\nfunction log\n{\n  logger -t phpunit-docker \"$@\"\n}\n\nwhile :; do\n  for cid in $(ls \"$PHPUNIT_DOCKER_TMP\"); do\n    {\n      flock -n -x $fd && {\n        log \"enter: $cid\"\n        $PHPUNIT_DOCKER_ENTER \"$cid\" /bin/bash -c '\n          cd \"$1\"\n          shift\n          vendor/bin/phpunit \"$@\"\n        ' -- \"$PHPUNIT_DOCKER_DIR\" \"$@\"\n        log \"leave: $cid\"\n        exit\n      }\n    } {fd}< \"$PHPUNIT_DOCKER_TMP/$cid\"\n  done\n  sleep 10\ndone\n```\n\n`phpunit-docker-start` \u304c `paratest` \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3001\u5fc5\u8981\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 `paratest` \u3092\u5b9f\u884c\u3057\u3001\u7d42\u4e86\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3057\u307e\u3059\u3002\u4e26\u5217\u6570\u306f\u74b0\u5883\u5909\u6570 `PHPUNIT_DOCKER_PARA` \u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n`phpunit-docker-enter` \u304c `phpunit` \u30b3\u30de\u30f3\u30c9\u306e\u30e9\u30c3\u30d1\u30fc\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u3063\u3066 `phpunit` \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308b\u305f\u3081\u306b `docker-enter` \u3068\u3044\u3046\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306f\u5f8c\u8ff0\u3059\u308b\u624b\u9806\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n# EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6e96\u5099\n\n\u307e\u305a\u306f EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 t2.micro \u3067\u4f5c\u6210\u3057\u307e\u3059\u3002AMI \u306f `Amazon Linux AMI 2014.09 (HVM)` \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u5f8c\u306b SSH \u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u6b21\u306e\u3088\u3046\u306b Docker \u3084\u3089 PHP \u3084\u3089\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```text\n$ sudo su -\n\n# rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\n# yum -y install docker-io\n# yum -y install mysql55-server\n# yum -y install php55 php55-cli php55-opcache \\\n  php55-process php55-mysqlnd php55-pdo php55-mbstring php55-xml \\\n  php55-pecl-xdebug php55-pecl-jsonc\n\n# mkdir -p /path/to/sample\n# chown ec2-user. /path/to/sample\n\n# chkconfig docker on\n# service docker start\n\n# docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter\n```\n\n`docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter` \u3067 `docker-enter` \u3068\u3044\u3046 Docker \u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308b\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002Docker \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3068\u3057\u3066\u4f7f\u3046\u306a\u3093\u3066\u9762\u767d\u3044\u3067\u3059\u306d\u3002\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u8ee2\u9001\n\n\u30ed\u30fc\u30ab\u30eb\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 `rsync` \u3067\u307e\u308b\u3054\u3068\u8ee2\u9001\u3057\u307e\u3059\u3002\n\n```text\n$ rsync /path/to/sample/ ec2-user@192.0.2.123:/path/to/sample/ -azv\n```\n\n# Docker \u30b3\u30f3\u30c6\u30ca\u306e\u6e96\u5099\n\n\u524d\u56de\u306e\u5185\u5bb9\u3068\u5909\u308f\u308a\u3042\u308a\u307e\u305b\u3093\u3002\n\n - [ParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita](http://qiita.com/ngyuki/items/c831c7af4a8ac6948c7d \"ParaTest \u3068 Docker \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3059\u308b\u8a66\u307f - Qiita\")\n\n`Dockerfile` \u3067\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3001\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u307e\u3067\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\nFROM centos:centos6\nMAINTAINER ore\n\nRUN yum -y install epel-release rootfiles\nRUN rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\nRUN yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum -y install mysql-community-server\n\nRUN yum -y install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nRUN yum -y --enablerepo=remi-php55 install php php-cli php-opcache \\\n  php-process php-mysqlnd php-pdo php-mbstring php-xml \\\n  php-pecl-xdebug php-pecl-zip  php-pecl-yaml php-pecl-jsonc\n\nRUN echo -e \"[mysqld]\\ntmpdir = /var/tmp\\n\" > /etc/my.cnf\nRUN touch /etc/sysconfig/network\nRUN mysql_install_db --user=mysql\n\nRUN service mysqld start && mysql -ve \" \\\n  CREATE DATABASE sample_test DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin; \\\n  GRANT ALL ON sample_test.* TO sample@'localhost'; \\\n  GRANT ALL ON sample_test.* TO sample@'%'; \\\n\" ; service mysqld stop\n```\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```text\n# docker build -t sample:base .\n```\n\n\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text\n# docker run --name=tmp -v /path/to/sample:/path/to/sample:ro sample:base /bin/bash -c '\n  service mysqld start\n  cd /path/to/sample\n  ./build.sh migrate --test\n  service mysqld stop\n'\n# docker commit tmp sample\n# docker rm tmp\n```\n\n# t2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u4e0a\u624b\u304f\u69cb\u7bc9\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u306e\u78ba\u8a8d\u306e\u305f\u3081\u306b t2.micro \u306e\u307e\u307e\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u524d\u56de\u4f5c\u6210\u3057\u305f `phpunit-docker` \u3067\u3001\u5358\u4e00\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```text\n# cd /path/to/sample\n# tests/phpunit-docker\n```\n\n\u6b21\u306e\u901a\u308a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\nStarting mysqld:  [  OK  ]\nPHPUnit 3.7.37 by Sebastian Bergmann.\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 720 (  8%)\n............................................................... 126 / 720 ( 17%)\n............................................................... 189 / 720 ( 26%)\n............................................................... 252 / 720 ( 35%)\n............................................................... 315 / 720 ( 43%)\n............................................................... 378 / 720 ( 52%)\n............................................................... 441 / 720 ( 61%)\n............................................................... 504 / 720 ( 70%)\n............................................................... 567 / 720 ( 78%)\n............................................................... 630 / 720 ( 87%)\n............................................................... 693 / 720 ( 96%)\n.........................\n\nTime: 1.35 minutes, Memory: 111.50Mb\n\nOK (718 tests, 2726 assertions)\n```\n\n# t2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u7d9a\u3044\u3066\u3001\u65b0\u3057\u304f\u4f5c\u6210\u3057\u305f `phpunit-docker-start` \u3068 `phpunit-docker-enter` \u3067\u4e26\u5217\u6570 2 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# cd /path/to/sample\n# PHPUNIT_DOCKER_PARA=2 tests/phpunit-docker-start\n```\n\n\u6b21\u306e\u901a\u308a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\ndocker run 093e(\u7565)\ndocker run feb6(\u7565)\n\nRunning phpunit in 2 processes with tests/phpunit-docker-enter\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n........E...................................................... 504 / 644 ( 78%)\n..............................................................F 567 / 644 ( 88%)\n............................................................... 630 / 644 ( 97%)\n............................................................... 693 / 644 (107%)\n.........................\n\nTime: 1.71 minutes, Memory: 36.50Mb\n\nThere was 1 error:\n\n(\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2720, Failures: 1, Errors: 1.\n\nCleanup...\n093e(\u7565)\nfeb6(\u7565)\n```\n\n\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3088\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u30fb\u30fb\u30fbt2.micro \u306a\u306e\u3067\u4ed5\u65b9\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u30b3\u30b1\u305f\u30c6\u30b9\u30c8\u304c\u3042\u308b\u306e\u306f\u3001\u3042\u308b\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u5225\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u5b9f\u884c\u3092\u524d\u63d0\u306b\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u5f0a\u5bb3\u3067\u3059\u304c\u3001\u3069\u3061\u3089\u304b\u3068\u3044\u3048\u3070\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u306e\u554f\u984c\u3067\u3059\u3002\n\n# t2.micro \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u300c\u30d7\u30ed\u30bb\u30b9\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u300d\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3057\u305f\u3002t2.micro \u3060\u3068\u4e26\u5217\u6570 10 \u306f\u7121\u7406\u3067\u3057\u305f\u3002\n\n# m3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\nt2.micro \u3067\u4e26\u5217\u6570\u3092\u4e0a\u3052\u308b\u306e\u306f\u7121\u7406\u304c\u3042\u308b\u306e\u3067\u3001\u304a\u8ca1\u5e03\u4e8b\u60c5\u3068\u76f8\u8ac7\u306e\u3046\u3048 m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u8a66\u3057\u307e\u3057\u305f\u3002\n\nt2.micro \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 AMI \u3092\u4f5c\u6210\u3057\u3001\u305d\u306e AMI \u304b\u3089 m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# tests/phpunit-docker\n(\u7565)\nTime: 1.28 minutes, Memory: 111.50Mb\n(\u7565)\n```\n\nt2.micro \u3068\u3042\u307e\u308a\u5909\u308f\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n# m3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u6b21\u306b\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\ndocker run e642(\u7565)\ndocker run 7afc(\u7565)\ndocker run bd6d(\u7565)\ndocker run d7af(\u7565)\ndocker run 599e(\u7565)\ndocker run 2278(\u7565)\ndocker run 464b(\u7565)\ndocker run 960b(\u7565)\ndocker run 1789(\u7565)\ndocker run 84d8(\u7565)\n\nRunning phpunit in 10 processes with tests/phpunit-docker-enter\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n............................................................... 504 / 644 ( 78%)\n......E...................................F.................... 567 / 644 ( 88%)\n............................................................... 630 / 644 ( 97%)\n............................................................... 693 / 644 (107%)\n.........................\n\nTime: 28.5 seconds, Memory: 36.50Mb\n\nThere was 1 error:\n\n(\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2721, Failures: 1, Errors: 1.\n\nCleanup...\n1789(\u7565)\n2278(\u7565)\n464b(\u7565)\n599e(\u7565)\n7afc(\u7565)\n84d8(\u7565)\n960b(\u7565)\nbd6d(\u7565)\nd7af(\u7565)\ne642(\u7565)\n```\n\n\uff12\u500d\u4ee5\u4e0a\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u3055\u3059\u304c m3.2xlarge \u306f\u683c\u304c\u9055\u3044\u307e\u3057\u305f\u3002\n\n# m3.2xlarge \u306e\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 20 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u52e2\u3044\u4f59\u3063\u3066\u4e26\u5217\u6570 20 \u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```text\n# PHPUNIT_DOCKER_PARA=20 tests/phpunit-docker-start\n(\u7565)\nTime: 36.5 seconds, Memory: 37.25Mb\n(\u7565)\n```\n\n\u4e26\u5217\u6570 10 \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u3053\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u3053\u308c\u4ee5\u4e0a\u4e26\u5217\u6570\u3092\u4e0a\u3052\u3066\u3082\u65e9\u304f\u306f\u306a\u3089\u306a\u3055\u305d\u3046\u3067\u3059\u3002\n\n# \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u3067\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\n\n\u6b21\u306b\u3001\u3082\u3063\u3068\u30c7\u30a3\u30b9\u30af\u3092\u65e9\u304f\u3059\u308b\u305f\u3081\u306b AWS \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nm3.2xlarge \u3060\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u304c\uff12\u3064\u3042\u3063\u305f\u306e\u3067\u3001LVM \u3067\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n```text\n# umount /dev/xvdb\n# pvcreate /dev/xvdb /dev/xvdc\n# vgcreate vg0 /dev/xvdb /dev/xvdc\n# lvcreate -L 40G -i 2 -n docker vg0\n# mkfs.ext4 /dev/vg0/docker\n# service docker stop\n# mount -t ext4 /dev/vg0/docker /mnt\n# cp -a /var/lib/docker/* /mnt/\n# umount /mnt\n# mount -t ext4 /dev/vg0/docker /var/lib/docker\n# service docker start\n```\n\n# m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# tests/phpunit-docker\n(\u7565)\nTime: 2.73 minutes, Memory: 111.50Mb\n(\u7565)\n```\n\nEBS \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\n# m3.2xlarge \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u7d9a\u3044\u3066\u3001\u4e26\u5217\u6570 10 \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```text\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\n(\u7565)\nTime: 1.74 minutes, Memory: 36.50Mb\n(\u7565)\n```\n\n\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u3088\u308a\u306f\u65e9\u3044\u3067\u3059\u304c\u3001\u3084\u3063\u3071\u308a EBS \u3088\u308a\u3082\u9045\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\nEBS \u3088\u308a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c8\u30a2\u306e\u65b9\u304c I/O \u6027\u80fd\u306f\u826f\u3044\u3068\u601d\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u3046\u3044\u3046\u308f\u3051\u3067\u306f\u306a\u3044\u306e\u3067\u3057\u3087\u3046\u304b\u306d\uff1f \u3042\u308b\u3044\u306f\u30b9\u30c8\u30e9\u30a4\u30d4\u30f3\u30b0\u3084\u30de\u30a6\u30f3\u30c8\u306e\u3084\u308a\u65b9\u304c\u307e\u305a\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# m3.2xlarge \u306e tmpfs \u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u4e26\u5217\u6570\u3092\u5897\u3084\u3057\u3066\u3082\u30c7\u30a3\u30b9\u30af\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3042\u307e\u308a\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u30c0\u30e1\u5143\u3067 `/var/lib/docker` \u3092 tmpfs \u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u307e\u305a\u3001\u73fe\u5728\u306e\u30b5\u30a4\u30ba\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text\n# du -sh /var/lib/docker/\n1.5G    /var/lib/docker/\n```\n\n1.5G \u3057\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u30018G \u3050\u3089\u3044\u3042\u308c\u3070\u5341\u5206\u3067\u3057\u3087\u3046\u3002\n\n```text\n# service docker stop\n# umount /var/lib/docker\n# mkdir /docker\n# mount -t tmpfs -o size=8G tmpfs /docker\n# cp -a /var/lib/docker/* /docker\n# mount --bind /docker /var/lib/docker\n# service docker start\n```\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# tests/phpunit-docker\n(\u7565)\nTime: 45.86 seconds, Memory: 111.75Mb\n(\u7565)\n```\n\n\u3055\u3059\u304c\u306b\u901f\u3044\u3067\u3059\u3001EBS \u3068\u304f\u3089\u3079\u3066\u500d\u3050\u3089\u3044\u901f\u3044\u3067\u3059\u3002\n\n\u6b21\u306b\u4e26\u5217\u6570 10 \u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# PHPUNIT_DOCKER_PARA=10 tests/phpunit-docker-start\n(\u7565)\nTime: 17.48 seconds, Memory: 36.50Mb\n(\u7565)\n```\n\n\u3055\u3089\u306b\u65e9\u304f\u306a\u308a\u307e\u3057\u305f\u3001\u5f53\u305f\u308a\u524d\u306a\u6c17\u3082\u3057\u307e\u3059\u304c\u3059\u3054\u3044\u3067\u3059\u3002\n\n# \u307e\u3068\u3081\n\n\u5f53\u521d\u306e\u79c1\u306e\u30ed\u30fc\u30ab\u30eb\u306e VM \u3067\uff11\u5206\u534a\u3050\u3089\u3044\u304b\u304b\u3063\u3066\u3044\u305f\u30c6\u30b9\u30c8\u304c\u3001\u6700\u7d42\u7684\u306b 18 \u79d2\u3050\u3089\u3044\u306b\u307e\u3067\u77ed\u7e2e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u3082\u3001AWS \u306e\u305d\u308c\u306a\u308a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3063\u305f\u308a tmpfs \u306b\u3057\u3066\u307f\u305f\u308a\u3068\u304b\u306a\u308a\u7121\u7406\u77e2\u7406\u611f\u306f\u3042\u308a\u307e\u3059\u304c\u3002\n\n\u3055\u3059\u304c\u306b\u3053\u306e\u305f\u3081\u3060\u3051\u306b\uff11\u6642\u9593\u3067100\u5186\u306f\u8f9b\u3044\u3067\u3059\u304c\u3001\u30e1\u30e2\u30ea\u3068CPU\u30b3\u30a2\u6570\u3055\u3048\u3069\u3046\u306b\u304b\u51fa\u6765\u308c\u3070 ParaTest+Docker \u3067\u30c6\u30b9\u30c8\u3092\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u8a66\u307f\u3082\u30a2\u30ea\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# c3.8xlarge \u306e tmpfs \u306a\u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u9650\u754c\u304c\u898b\u305f\u304f\u306a\u3063\u305f\u306e\u3067 c3.8xlarge \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3084\u308b\u3053\u3068\u306f m3.2xlarge \u306e\u3068\u304d\u3068\u5909\u308f\u308a\u307e\u305b\u3093\u304c\u3001\u30b3\u30f3\u30c6\u30ca\u6570\u304c\u5897\u3048\u308b\u306e\u3067 tmpfs \u306e\u30b5\u30a4\u30ba\u3092 20G \u306b\u3057\u3066\u3044\u307e\u3059\u3002\u3042\u3068\u3001\uff11\u6642\u9593\u3067200\u5186\u3050\u3089\u3044\u30c1\u30e3\u30ea\u30f3\u30c1\u30e3\u30ea\u30f3\u3057\u307e\u3059\u3002\n\n```text\n# service docker stop\n# mkdir /docker\n# mount -t tmpfs -o size=20G tmpfs /docker\n# cp -a /var/lib/docker/* /docker\n# mount --bind /docker /var/lib/docker\n# service docker start\n```\n\n\u307e\u305a\u306f\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# tests/phpunit-docker\n(\u7565)\nTime: 44.55 seconds, Memory: 111.75Mb\n(\u7565)\n```\n\n\u307e\u3041\u5909\u308f\u3089\u306a\u3044\u3067\u3059\u306d\u3002\n\n\u6b21\u306b\u4e26\u5217\u6570 20 \u3067\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n```text\n# PHPUNIT_DOCKER_PARA=20 tests/phpunit-docker-start\n(\u7565)\nTime: 6.36 seconds, Memory: 36.25Mb\n(\u7565)\n```\n\n\u3082\u3046\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u524a\u9664\u306b\u4e00\u756a\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\uff08\u4e0a\u3067\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u6642\u9593\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u306e\u6642\u9593\u306f\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\uff09\u3002\n\n\u6b21\u306b\u4e26\u5217\u6570 30 \u3067\u5b9f\u884c\u30fb\u30fb\u30fb\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u4e0a\u624b\u304f\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u79c1\u306e\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4f55\u304b\u3057\u3089\u554f\u984c\u304c\u3042\u308b\u304b\u3001\u3082\u3057\u304f\u306f\u306a\u306b\u304b\u5225\u306e\u539f\u56e0\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n"}