{"tags": ["CentOS", "\u30d9\u30f3\u30c1\u30de\u30fc\u30af", "fio", "centos7"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nCentOS7\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304cXFS\u3068\u306a\u308a\u307e\u3057\u305f\u3002\nmkfs\u30b3\u30de\u30f3\u30c9\u3067\u3082\u3001minix, xfs, btrfs\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u6c17\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u8272\u3005\u8abf\u3079\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u81ea\u5206\u306a\u308a\u53d6\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u591a\u5c11\u306a\u308a\u3068\u3082\u3054\u53c2\u8003\u306b\u306a\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8272\u3005\u306a\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\n\u3053\u3061\u3089\u3092\u3054\u53c2\u8003\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/sion_cojp/items/c8e015db39ddbf43012e\n\n\u305d\u308c\u305e\u308c\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u308b\n\n\u4eca\u56de\u306e\u74b0\u5883\u306f\n\n\nCentOS6\uff08\u30db\u30b9\u30c8\uff09\n\n\n4Core, MEM:32G, HDD:300G\n\n\nCentOS7\uff08\u30b2\u30b9\u30c8\u3002\u3053\u3061\u3089\u3067\u8a08\u6e2c\u3057\u3066\u304a\u308a\u307e\u3059\u3002\uff09\n\n\nvCPU *1, MEM:4G, HDD:40G\n\n\n\n\n\u5bb9\u91cf\u304c\u5c11\u306a\u304b\u3063\u305f\u305f\u3081\u3001btrfs\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u304c\u7d42\u308f\u3063\u305f\u5f8c\u3001zfs\u306b\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u5909\u66f4\u3057\u691c\u8a3c\u3092\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n### zfs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum localinstall --nogpgcheck http://download.fedoraproject.org/pub/epel/beta/7/x86_64/epel-release-7-0.2.noarch.rpm\n$ sudo yum localinstall --nogpgcheck http://archive.zfsonlinux.org/epel/zfs-release.el7.noarch.rpm\n$ sudo yum install kernel-devel zfs\n\n# spl zfs\u3092\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u30d3\u30eb\u30c9\n$ dkms status\nspl, 0.6.3: added\nzfs, 0.6.3: added\n$ dkms install -m spl -v 0.6.3\nError! echo\nYour kernel headers for kernel 3.10.0-123.el7.x86_64 cannot be found at\n/lib/modules/3.10.0-123.el7.x86_64/build or /lib/modules/3.10.0-123.el7.x86_64/source.\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3046\u3068\u8a00\u308f\u308c\u305f\u306e\u3067\u3001\u5165\u308c\u5909\u3048\u307e\u3057\u3087\u3046\n$ rpm -qa | grep kernel-devel\nkernel-devel-3.10.0-123.6.3.el7.x86_64\n$ rpm -e --nodeps kernel-devel-3.10.0-123.6.3.el7.x86_64\n$ wget ftp://mirror.switch.ch/pool/4/mirror/scientificlinux/7rolling/x86_64/os/Packages/kernel-devel-3.10.0-123.el7.x86_64.rpm\n$ rpm -ivh kernel-devel-3.10.0-123.el7.x86_64.rpm\n\n# \u518d\u5ea6\u30d3\u30eb\u30c9\n$ dkms install -m spl -v 0.6.3\nDKMS: install completed.\n$ dkms install -m zfs -v 0.6.3\nDKMS: install completed.\n\n# \u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\u5ff5\u306e\u305f\u3081\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n$dkms status\nspl, 0.6.3, 3.10.0-123.el7.x86_64, x86_64: installed\nzfs, 0.6.3, 3.10.0-123.el7.x86_64, x86_64: installed\n\n### \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\u3002\u96d1\u306b\u66f8\u3044\u3066\u307e\u3059\u3002\u3002\n$ sudo fdisk /dev/vda\nn\ne\nenter enter\np\n\nn\nl\nenter +5G\np\n*3\u56de\n\n\u30b3\u30de\u30f3\u30c9 (m \u3067\u30d8\u30eb\u30d7): p\n/dev/vda1   *        2048      411647      204800   83  Linux\n/dev/vda2          411648    45475839    22532096   8e  Linux LVM\n/dev/vda3        45475840    83886079    19205120    5  Extended\n/dev/vda5        45477888    55963647     5242880   83  Linux\n/dev/vda6        55965696    66451455     5242880   83  Linux\n\n\u30b3\u30de\u30f3\u30c9 (m \u3067\u30d8\u30eb\u30d7): w\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u306f\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\uff01\n\n# \u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n$ reboot\n\n### ext4\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\n$ sudo mkfs.ext4 /dev/vda5\nmke2fs 1.42.9 (28-Dec-2013)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n327680 inodes, 1310720 blocks\n65536 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=1342177280\n40 block groups\n32768 blocks per group, 32768 fragments per group\n8192 inodes per group\nSuperblock backups stored on blocks:\n    32768, 98304, 163840, 229376, 294912, 819200, 884736\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n\n### xfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059 \n$ sudo mkfs.xfs /dev/vda6\nmeta-data=/dev/vda6              isize=256    agcount=4, agsize=327680 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0\ndata     =                       bsize=4096   blocks=1310720, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal log           bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\n\n### btrfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo  mkfs.btrfs /dev/vda7\nWARNING! - Btrfs v3.12 IS EXPERIMENTAL\nWARNING! - see http://btrfs.wiki.kernel.org before using\nTurning ON incompat feature 'extref': increased hardlink limit per file to 65536\nfs created label (null) on /dev/vda7\n    nodesize 16384 leafsize 16384 sectorsize 4096 size 5.00GiB\nBtrfs v3.12\n\n### \uff08btrfs\u306e\u691c\u8a3c\u304c\u7d42\u308f\u3063\u305f\u3089\uff09zfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# zfs\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u4f5c\u6210\n$ zpool create zfs /dev/vda7\n$ df | grep zfs\nzfs                         5128576       0  5128576    0% /zfs\n\n# zfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4f5c\u6210\n$ zfs create zfs/test\n$ zfs listcd\nNAME       USED  AVAIL  REFER  MOUNTPOINT\nzfs        148K  4.89G  32.5K  /zfs\nzfs/test    30K  4.89G    30K  /zfs/test\n\n### \u3061\u306a\u307f\u306b\u524a\u9664\u3059\u308b\u3068\u304d\u306f\n$ umount zfs/test\n$ zfs destroy zfs/test\n\n$ umount zfs\n$ zpool destroy zfs\n\n### \u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n$ mkdir -p {ext4, xfs, brtfs}\n$ blkid | grep vda[5-7]\n/dev/vda5: UUID=\"\u25cb\u25cb\u25cb\" TYPE=\"ext4\"\n/dev/vda6: UUID=\"\u00d7\u00d7\u00d7\" TYPE=\"xfs\"\n/dev/vda7: UUID=\"\u25b3\u25b3\u25b3\" UUID_SUB=\"\u25a1\u25a1\u25a1\" TYPE=\"btrfs\"\n\n\n### \uff13\u884c\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\n$ sudo vi /etc/fstab\nUUID=\"\u25cb\u25cb\u25cb\"     /ext4   ext4    defaults        1 2\nUUID=\"\u00d7\u00d7\u00d7\"     /xfs    xfs     defaults        1 2\nUUID=\"\u25b3\u25b3\u25b3\"     /btrfs  btrfs   defaults        1 2\n\n$ df -Tmh | grep \"vda[5,6,7]\\|\u30d5\u30a1\u30a4\u30eb\"\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9            \u30bf\u30a4\u30d7   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/vda5               ext4       4.8G   20M  4.6G    1% /ext4\n/dev/vda6               xfs        5.0G   33M  5.0G    1% /xfs\n/dev/vda7               btrfs      5.0G  320K  4.5G    1% /btrfs\n\n\n1.2G\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc & \u524a\u9664\u3057\u3066\u307f\u308b\uff08time\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u6e2c\u5b9a\uff09\n\n\n\n\ncp real time\nrm real time\n\n\n\n\next4\n0m9.723s (124MB/s)\n0m1.905s(631MB/s)\n\n\nxfs\n0m7.013s (171MB/s)\n0m1.258s(960MB/s)\n\n\nbtrfs\n0m8.505s (141MB/s)\n0m1.329s(863MB/s)\n\n\nzfs\n1m40.611s(12MB/s)\n0m2.589s(480MB/s)\n\n\n\n\n\u524a\u9664\u304c\u9045\u3044\u3068\u8a00\u308f\u308c\u305fxfs\u3060\u3051\u3069\u3001\u5168\u7136\u901f\u3044\u3002\n\u57fa\u672c\u7684\u306aseq/read,write\u304c\u5727\u5012\u7684\u306b\u65e9\u3044\u306e\u3060\u308d\u3046\u3002\nzfs\u306f\u30e1\u30e2\u30ea\u304c\u5c11\u306a\u3044\u306e\u304b\u3081\u3061\u3083\u304f\u3061\u3083\u9045\u3044\u3002\n\n\nfio\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u6e2c\u5b9a\u3059\u308b\n### fio\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install -y libaio-devel\n$ wget http://pkgs.repoforge.org/fio/fio-2.1.7-1.el7.rf.x86_64.rpm\n$ rpm -ivh fio-2.1.7-1.el7.rf.x86_64.rpm\n\n### fio\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u6642\u306f\u3001\u5404\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ncd {/ext4, /xfs, /brtfs, /zfs/test}\n\n### \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3002seq,random/read,write \u3092\u56f3\u308a\u307e\u3059\u3002\n### bs=4K\n$ fio -rw=read -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqread\n$ fio -rw=write -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqwrite\n$ fio -rw=randread -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randread\n$ fio -rw=randwrite -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randwrite\n\n### bs=16K\n### \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3002seq,random/read,write \u3092\u56f3\u308a\u307e\u3059\u3002\n$ fio -rw=read -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqread\n$ fio -rw=write -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqwrite\n$ fio -rw=randread -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randread\n$ fio -rw=randwrite -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randwrite\n\nfio\u306e\u8a73\u7d30\u306f\u3053\u3061\u3089\n\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\n\u8a73\u7d30\n\n\n\n\nbs\n\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u6307\u5b9a\u3002\u4eca\u56de\u306flinux\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3068MySQL\u3092\u60f3\u5b9a\u3057\u30664K\u306816K\n\n\nsize\n\u3053\u306e\u6e2c\u5b9a\u3067\u8aad\u307f\u66f8\u304d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\n\n\nnumjobs\n\u30b8\u30e7\u30d6\u306e\u30af\u30ed\u30fc\u30f3\u6570\u3002\u540c\u6642\u306b\u3044\u304f\u3064IO\u3092\u767a\u751f\u3055\u305b\u308b\u304b\u3002\n\n\nrutime\n\u6e2c\u5b9a\u6642\u9593\uff08\u79d2\uff09\n\n\ndirect\n\u30c0\u30a4\u30ec\u30af\u30c8\u8ee2\u9001\u30021\u306f\u6709\u52b9\u306b\u3059\u308b\n\n\ninvalidate\n\u30d0\u30c3\u30d5\u30a1\u30ad\u30e3\u30c3\u30b7\u30e5\u30021\u306f\u7121\u52b9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09\n\n\nioengine\n\u5229\u7528\u3059\u308bIO\u30a8\u30f3\u30b8\u30f3\u3002liabaio\u306fLinux\u30ab\u30fc\u30cd\u30eb\u5185\u3067\u5b9f\u88c5\u3055\u308c\u3066\u308b\u975e\u540c\u671fIO\n\n\niodepth\nqueue depth\u3068\u3082\u3044\u3046\u3002\u3069\u308c\u304f\u3089\u3044\u5e73\u884c\u3057\u3066\u975e\u540c\u671f\u8aad\u307f\u66f8\u304d\u3092\u884c\u3046\u304b\u3002\u4e00\u5ea6\u306b\u53d7\u3051\u53d6\u308c\u308b\u30b3\u30de\u30f3\u30c9\u306e\u6570\u3002\n\n\nipdepth_batch\nIO\u6570\u3092\u3069\u308c\u3060\u3051\u51fa\u3059\u304b\u3002\u57fa\u672c\u306fiodepth\u3068\u540c\u3058\u5024\u306b\u3059\u308b\u3002\n\n\nipdepth_batch_complete\n\u3069\u308c\u3060\u3051\u306eIO\u3092\u3059\u3050\u306b\u56de\u53ce\u3059\u308b\u304b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f1\u3067\u3001\u7406\u7531\u306f\u30ab\u30fc\u30cd\u30eb\u304b\u3089\u56de\u53ce\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6700\u5c0fIO=1\u3092\u6c42\u3081\u308b\u304b\u3089\u3002\n\n\ngroup_reporting\n\u7d50\u679c\u3092job\u5358\u4f4d\u3067\u306a\u304f\u3001\u30b0\u30eb\u30fc\u30d7\u5358\u4f4d\u3067\u51fa\u529b\n\n\n\n\n\u6e2c\u5b9a\u7d50\u679c\uff08IOPS\uff09\n\n3G(size)\u306e\u30d5\u30a1\u30a4\u30eb1\u500b\uff08numjobs\uff09\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3057\u3066\u3082\u5927\u5dee\u306f\u5168\u7136\u306a\u3044\u306e\u3067\u3001100M\u306e\u30d5\u30a1\u30a4\u30eb40\u500b\u3067\u3044\u3063\u3066\u307f\u307e\u3059\u3002\n\u7686\u3055\u3093\u304c\u904b\u7528\u3057\u3066\u308bMySQL\u306e\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u3092\u8a2d\u5b9a\u3057\u3066\u6e2c\u3063\u3066\u3082\u826f\u3044\u3067\u3057\u3087\u3046\n$ mysql -uroot -e 'show status' | grep page_size\n\n\nbs=4K\n\u203b\u5358\u4f4d\u306fIOPS\u3067\u3059\u3002\n\n\n\n\next4(4K)\nxfs(4K)\nbtrfs(4K)\nzfs(4K)\n\n\n\n\nseq-read\n6155\n17434\n10631\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nseq-write\n639\n1192\n759\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nrandom-read\n1609\n1438\n1532\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nrandom-write\n188\n188\n191\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\n\n\nbs=16K\n\u203b\u5358\u4f4d\u306fIOPS\u3067\u3059\u3002\n\n\n\n\next4(16K)\nxfs(16K)\nbtrfs(16K)\nzfs(16K)\n\n\n\n\nseq-read\n6864\n6502\n3036\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nseq-write\n1085\n1082\n462\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nrandom-read\n1086\n1208\n387\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\nrandom-write\n172\n93\n82\n\u6e2c\u5b9a\u4e0d\u80fd\n\n\n\n\nfio\u306e\u7d50\u679c\u3092\u307f\u3066\n\n4K\u3060\u3068IOPS\u306f\u9045\u3081\u3002\u305f\u3060\u3001\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5909\u308f\u3063\u3066\u3082\u3001IOPS\u304c\u3055\u307b\u3069\u5909\u308f\u3089\u306a\u3044ext4\u306f\u5b89\u5b9a\u3057\u3066\u308b\u3068\u3044\u3048\u308b\u3002\nxfs\u306f4K\u3060\u3068\u7206\u901f\u3002\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u9045\u304f\u306a\u3063\u3066\u3044\u304f\u50be\u5411\u3067\u3057\u305f\u3002\nbtrfs\u3082xfs\u3068\u4f3c\u3066\u3044\u308b\u304c\u3001\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u6700\u60aa\u306a\u7d50\u679c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\nzfs\u306f\u9045\u3044\u3002\u3068\u306b\u304b\u304f\u9045\u3044\u3002\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u6642\u9593\u304c\u3081\u3063\u3061\u3083\u304b\u304b\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u6e2c\u5b9a\u4e0d\u80fd\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n\u79c1\u306a\u308a\u306e\u7dcf\u8a55\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u6df7\u5728\u3059\u308b\u306e\u306f\u51fa\u6765\u308b\u9650\u308a\u907f\u3051\u305f\u3044\u3002\n\u3068\u3044\u3046\u306e\u3092\u30d9\u30fc\u30b9\u306b\u3059\u308b\u3068XFS\u304c\u826f\u3044\u3002\n\n\u4e00\u822c\u7684\u306blinux\u306e\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306f4k\u306a\u306e\u3067\u3001xfs\u306e\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3002\n\n\nMySQL\u3067\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u5927\u304d\u3081\u306a\u3089ext4\u3067\u3082\u3088\u3044\u3002xfs\u3060\u3068\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u306b\u3064\u308c\u3066\u9045\u304f\u306a\u3063\u3066\u308b\u50be\u5411\u304c\u898b\u3048\u308b\u3002\n\n\u30e9\u30f3\u30c0\u30e0\u30a2\u30af\u30bb\u30b9\u3067\u52a3\u3063\u3066\u5165\u308b\u90e8\u5206\u306f\u3001\u3042\u3048\u3066\u30d5\u30eb\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5229\u7528\u3057\u306a\u3044\u65b9\u6cd5\u3092\u3068\u3063\u3066\u3082\u3088\u3044\u3002\n\n\n\u305f\u3060\u3001SSD\u3084\u3089ioDrive\u3060\u3068\u3001\u51e6\u7406\u304c\u7206\u901f\u306b\u306a\u308b\u306e\u3067\u3001\u305d\u306e\u3068\u304d\u306fxfs\u3092\u9078\u3076\u306e\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u30b9\u30c8\u30ec\u30fc\u30b8\u7cfb\u306bxfs\u306f\u7121\u8b00\u3002\uff08fsck\u6642\u306b1TB\u306b\u3064\u304d\u30e1\u30e2\u30ea1GB\u3068\u304b\u8ad6\u5916\u3002\uff09\uff08\u4fee\u6b63\u3055\u308c\u305f\u3068\u3044\u3046\u60c5\u5831\u3082\u3042\u308a\u307e\u3059\u3002http://xfs.org/index.php/XFS_status_update_for_2010#XFS_status_update_for_January_2010\uff09\n\n\u30b9\u30c8\u30ec\u30fc\u30b8\u7cfb\u306b\u306fZFS\u3084Btrfs\u3092\u7d44\u307f\u8fbc\u3080\u3068\u826f\u3044\u3002\u5c06\u6765\u7684\u306b\u304a\u3059\u3059\u3081\u306a\u306e\u306fZFS\u304b\u306d\u3002\n\n\u91cd\u8907\u30d5\u30a1\u30a4\u30eb\u7bc0\u7d04\u6a5f\u80fd\u3084\u3001\u30c1\u30a7\u30c3\u30af\u5468\u308a\u304c\u5b89\u5fc3\u3068\u304b\u5b09\u3057\u3044\u3002\u4eca\u5f8c\u958b\u767a\u3067\u3055\u3089\u306b\u826f\u304f\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u52d5\u5411\u3092\u4f3a\u3044\u305f\u3044\u3067\u3059\u306d\u3002\n\u3057\u304b\u3057\u73fe\u72b6\u3067\u306fZFS\u306f\u307e\u3060\u30b7\u30b9\u30c6\u30e0\u306b\u7d44\u307f\u8fbc\u3080\u306e\u306f\u96e3\u3057\u3044\u3002\u5185\u5bb9\u3068\u3057\u3066\u306f\u7d20\u6674\u3089\u3057\u3044\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\u306e\u3067\u958b\u767a\u306b\u671f\u5f85\u3002\n\n\n\n#\u6982\u8981\nCentOS7\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304cXFS\u3068\u306a\u308a\u307e\u3057\u305f\u3002\nmkfs\u30b3\u30de\u30f3\u30c9\u3067\u3082\u3001minix, xfs, btrfs\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u6c17\u306b\u306a\u308b\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u8272\u3005\u8abf\u3079\u3001\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u81ea\u5206\u306a\u308a\u53d6\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u591a\u5c11\u306a\u308a\u3068\u3082\u3054\u53c2\u8003\u306b\u306a\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n#\u8272\u3005\u306a\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\n\u3053\u3061\u3089\u3092\u3054\u53c2\u8003\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/sion_cojp/items/c8e015db39ddbf43012e\n\n#\u305d\u308c\u305e\u308c\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u308b\n- \u4eca\u56de\u306e\u74b0\u5883\u306f\n    - CentOS6\uff08\u30db\u30b9\u30c8\uff09\n        - 4Core, MEM:32G, HDD:300G\n    - CentOS7\uff08\u30b2\u30b9\u30c8\u3002\u3053\u3061\u3089\u3067\u8a08\u6e2c\u3057\u3066\u304a\u308a\u307e\u3059\u3002\uff09\n        - vCPU *1, MEM:4G, HDD:40G\n- \u5bb9\u91cf\u304c\u5c11\u306a\u304b\u3063\u305f\u305f\u3081\u3001btrfs\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u304c\u7d42\u308f\u3063\u305f\u5f8c\u3001zfs\u306b\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u5909\u66f4\u3057\u691c\u8a3c\u3092\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n~~~bash\n### zfs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum localinstall --nogpgcheck http://download.fedoraproject.org/pub/epel/beta/7/x86_64/epel-release-7-0.2.noarch.rpm\n$ sudo yum localinstall --nogpgcheck http://archive.zfsonlinux.org/epel/zfs-release.el7.noarch.rpm\n$ sudo yum install kernel-devel zfs\n \n# spl zfs\u3092\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u30d3\u30eb\u30c9\n$ dkms status\nspl, 0.6.3: added\nzfs, 0.6.3: added\n$ dkms install -m spl -v 0.6.3\nError! echo\nYour kernel headers for kernel 3.10.0-123.el7.x86_64 cannot be found at\n/lib/modules/3.10.0-123.el7.x86_64/build or /lib/modules/3.10.0-123.el7.x86_64/source.\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u9055\u3046\u3068\u8a00\u308f\u308c\u305f\u306e\u3067\u3001\u5165\u308c\u5909\u3048\u307e\u3057\u3087\u3046\n$ rpm -qa | grep kernel-devel\nkernel-devel-3.10.0-123.6.3.el7.x86_64\n$ rpm -e --nodeps kernel-devel-3.10.0-123.6.3.el7.x86_64\n$ wget ftp://mirror.switch.ch/pool/4/mirror/scientificlinux/7rolling/x86_64/os/Packages/kernel-devel-3.10.0-123.el7.x86_64.rpm\n$ rpm -ivh kernel-devel-3.10.0-123.el7.x86_64.rpm\n \n# \u518d\u5ea6\u30d3\u30eb\u30c9\n$ dkms install -m spl -v 0.6.3\nDKMS: install completed.\n$ dkms install -m zfs -v 0.6.3\nDKMS: install completed.\n\n# \u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\u5ff5\u306e\u305f\u3081\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n$dkms status\nspl, 0.6.3, 3.10.0-123.el7.x86_64, x86_64: installed\nzfs, 0.6.3, 3.10.0-123.el7.x86_64, x86_64: installed\n \n### \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\u3002\u96d1\u306b\u66f8\u3044\u3066\u307e\u3059\u3002\u3002\n$ sudo fdisk /dev/vda\nn\ne\nenter enter\np\n \nn\nl\nenter +5G\np\n*3\u56de\n \n\u30b3\u30de\u30f3\u30c9 (m \u3067\u30d8\u30eb\u30d7): p\n/dev/vda1   *        2048      411647      204800   83  Linux\n/dev/vda2          411648    45475839    22532096   8e  Linux LVM\n/dev/vda3        45475840    83886079    19205120    5  Extended\n/dev/vda5        45477888    55963647     5242880   83  Linux\n/dev/vda6        55965696    66451455     5242880   83  Linux\n \n\u30b3\u30de\u30f3\u30c9 (m \u3067\u30d8\u30eb\u30d7): w\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb\u306f\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\uff01\n\n# \u30b5\u30fc\u30d0\u518d\u8d77\u52d5\n$ reboot\n~~~ \n~~~bash\n### ext4\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\n$ sudo mkfs.ext4 /dev/vda5\nmke2fs 1.42.9 (28-Dec-2013)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n327680 inodes, 1310720 blocks\n65536 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=1342177280\n40 block groups\n32768 blocks per group, 32768 fragments per group\n8192 inodes per group\nSuperblock backups stored on blocks:\n    32768, 98304, 163840, 229376, 294912, 819200, 884736\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n~~~ \n\n~~~bash\n### xfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059 \n$ sudo mkfs.xfs /dev/vda6\nmeta-data=/dev/vda6              isize=256    agcount=4, agsize=327680 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0\ndata     =                       bsize=4096   blocks=1310720, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal log           bsize=4096   blocks=2560, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\n~~~ \n \n~~~bash\n### btrfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo  mkfs.btrfs /dev/vda7\nWARNING! - Btrfs v3.12 IS EXPERIMENTAL\nWARNING! - see http://btrfs.wiki.kernel.org before using\nTurning ON incompat feature 'extref': increased hardlink limit per file to 65536\nfs created label (null) on /dev/vda7\n    nodesize 16384 leafsize 16384 sectorsize 4096 size 5.00GiB\nBtrfs v3.12\n~~~ \n\n~~~bash\n### \uff08btrfs\u306e\u691c\u8a3c\u304c\u7d42\u308f\u3063\u305f\u3089\uff09zfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# zfs\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u4f5c\u6210\n$ zpool create zfs /dev/vda7\n$ df | grep zfs\nzfs                         5128576       0  5128576    0% /zfs\n \n# zfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u4f5c\u6210\n$ zfs create zfs/test\n$ zfs listcd\nNAME       USED  AVAIL  REFER  MOUNTPOINT\nzfs        148K  4.89G  32.5K  /zfs\nzfs/test    30K  4.89G    30K  /zfs/test\n \n### \u3061\u306a\u307f\u306b\u524a\u9664\u3059\u308b\u3068\u304d\u306f\n$ umount zfs/test\n$ zfs destroy zfs/test\n\n$ umount zfs\n$ zpool destroy zfs\n~~~\n\n~~~bash\n### \u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n$ mkdir -p {ext4, xfs, brtfs}\n$ blkid | grep vda[5-7]\n/dev/vda5: UUID=\"\u25cb\u25cb\u25cb\" TYPE=\"ext4\"\n/dev/vda6: UUID=\"\u00d7\u00d7\u00d7\" TYPE=\"xfs\"\n/dev/vda7: UUID=\"\u25b3\u25b3\u25b3\" UUID_SUB=\"\u25a1\u25a1\u25a1\" TYPE=\"btrfs\"\n \n \n### \uff13\u884c\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\n$ sudo vi /etc/fstab\nUUID=\"\u25cb\u25cb\u25cb\"     /ext4   ext4    defaults        1 2\nUUID=\"\u00d7\u00d7\u00d7\"     /xfs    xfs     defaults        1 2\nUUID=\"\u25b3\u25b3\u25b3\"     /btrfs  btrfs   defaults        1 2\n \n$ df -Tmh | grep \"vda[5,6,7]\\|\u30d5\u30a1\u30a4\u30eb\"\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9            \u30bf\u30a4\u30d7   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/vda5               ext4       4.8G   20M  4.6G    1% /ext4\n/dev/vda6               xfs        5.0G   33M  5.0G    1% /xfs\n/dev/vda7               btrfs      5.0G  320K  4.5G    1% /btrfs\n~~~\n\n#1.2G\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc & \u524a\u9664\u3057\u3066\u307f\u308b\uff08time\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u6e2c\u5b9a\uff09\n|  |cp real time|rm real time|\n|:-----------:|:------------:|:------------:|\n|ext4|0m9.723s (124MB/s)|0m1.905s(631MB/s)|\n|xfs|<b>0m7.013s (171MB/s)</b>|<b>0m1.258s(960MB/s)</b>|\n|btrfs|0m8.505s (141MB/s)|0m1.329s(863MB/s)|\n|zfs|1m40.611s(12MB/s)|0m2.589s(480MB/s)|\n\n- \u524a\u9664\u304c\u9045\u3044\u3068\u8a00\u308f\u308c\u305fxfs\u3060\u3051\u3069\u3001\u5168\u7136\u901f\u3044\u3002\n- \u57fa\u672c\u7684\u306aseq/read,write\u304c\u5727\u5012\u7684\u306b\u65e9\u3044\u306e\u3060\u308d\u3046\u3002\n- zfs\u306f\u30e1\u30e2\u30ea\u304c\u5c11\u306a\u3044\u306e\u304b\u3081\u3061\u3083\u304f\u3061\u3083\u9045\u3044\u3002\n\n#fio\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u6e2c\u5b9a\u3059\u308b\n~~~bash\n### fio\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install -y libaio-devel\n$ wget http://pkgs.repoforge.org/fio/fio-2.1.7-1.el7.rf.x86_64.rpm\n$ rpm -ivh fio-2.1.7-1.el7.rf.x86_64.rpm\n \n### fio\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u6642\u306f\u3001\u5404\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ncd {/ext4, /xfs, /brtfs, /zfs/test}\n \n### \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3002seq,random/read,write \u3092\u56f3\u308a\u307e\u3059\u3002\n### bs=4K\n$ fio -rw=read -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqread\n$ fio -rw=write -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqwrite\n$ fio -rw=randread -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randread\n$ fio -rw=randwrite -bs=4k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randwrite\n \n### bs=16K\n### \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u3002seq,random/read,write \u3092\u56f3\u308a\u307e\u3059\u3002\n$ fio -rw=read -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqread\n$ fio -rw=write -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=seqwrite\n$ fio -rw=randread -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randread\n$ fio -rw=randwrite -bs=16k -size=100m -numjobs=40 -runtime=60 -direct=1 -invalidate=1 -ioengine=libaio -iodepth=32 -iodepth_batch=32 -group_reporting -name=randwrite\n~~~\n\nfio\u306e\u8a73\u7d30\u306f\u3053\u3061\u3089\n\n|\u30aa\u30d7\u30b7\u30e7\u30f3|\u8a73\u7d30|\n|:------------:|:------------|\n|bs|\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u6307\u5b9a\u3002<br>\u4eca\u56de\u306flinux\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3068MySQL\u3092\u60f3\u5b9a\u3057\u30664K\u306816K|\n|size|\u3053\u306e\u6e2c\u5b9a\u3067\u8aad\u307f\u66f8\u304d\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba|\n|numjobs|\u30b8\u30e7\u30d6\u306e\u30af\u30ed\u30fc\u30f3\u6570\u3002\u540c\u6642\u306b\u3044\u304f\u3064IO\u3092\u767a\u751f\u3055\u305b\u308b\u304b\u3002|\n|rutime|\u6e2c\u5b9a\u6642\u9593\uff08\u79d2\uff09|\n|direct|\u30c0\u30a4\u30ec\u30af\u30c8\u8ee2\u9001\u30021\u306f\u6709\u52b9\u306b\u3059\u308b|\n|invalidate|\u30d0\u30c3\u30d5\u30a1\u30ad\u30e3\u30c3\u30b7\u30e5\u30021\u306f\u7121\u52b9\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09|\n|ioengine|\u5229\u7528\u3059\u308bIO\u30a8\u30f3\u30b8\u30f3\u3002liabaio\u306fLinux\u30ab\u30fc\u30cd\u30eb\u5185\u3067\u5b9f\u88c5\u3055\u308c\u3066\u308b\u975e\u540c\u671fIO|\n|iodepth|queue depth\u3068\u3082\u3044\u3046\u3002\u3069\u308c\u304f\u3089\u3044\u5e73\u884c\u3057\u3066\u975e\u540c\u671f\u8aad\u307f\u66f8\u304d\u3092\u884c\u3046\u304b\u3002<br>\u4e00\u5ea6\u306b\u53d7\u3051\u53d6\u308c\u308b\u30b3\u30de\u30f3\u30c9\u306e\u6570\u3002|\n|ipdepth_batch|IO\u6570\u3092\u3069\u308c\u3060\u3051\u51fa\u3059\u304b\u3002\u57fa\u672c\u306fiodepth\u3068\u540c\u3058\u5024\u306b\u3059\u308b\u3002|\n|ipdepth_batch_complete|\u3069\u308c\u3060\u3051\u306eIO\u3092\u3059\u3050\u306b\u56de\u53ce\u3059\u308b\u304b\u3002<br>\u30c7\u30d5\u30a9\u30eb\u30c8\u306f1\u3067\u3001\u7406\u7531\u306f\u30ab\u30fc\u30cd\u30eb\u304b\u3089\u56de\u53ce\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u306e\u6700\u5c0fIO=1\u3092\u6c42\u3081\u308b\u304b\u3089\u3002|\n|group_reporting|\u7d50\u679c\u3092job\u5358\u4f4d\u3067\u306a\u304f\u3001\u30b0\u30eb\u30fc\u30d7\u5358\u4f4d\u3067\u51fa\u529b|\n\n#\u6e2c\u5b9a\u7d50\u679c\uff08IOPS\uff09\n- 3G(size)\u306e\u30d5\u30a1\u30a4\u30eb1\u500b\uff08numjobs\uff09\u3067\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3057\u3066\u3082\u5927\u5dee\u306f\u5168\u7136\u306a\u3044\u306e\u3067\u3001100M\u306e\u30d5\u30a1\u30a4\u30eb40\u500b\u3067\u3044\u3063\u3066\u307f\u307e\u3059\u3002\n- \u7686\u3055\u3093\u304c\u904b\u7528\u3057\u3066\u308bMySQL\u306e\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u3092\u8a2d\u5b9a\u3057\u3066\u6e2c\u3063\u3066\u3082\u826f\u3044\u3067\u3057\u3087\u3046\n- $ mysql -uroot -e 'show status' | grep page_size\n\n##bs=4K\n\n\u203b\u5358\u4f4d\u306fIOPS\u3067\u3059\u3002\n\n||ext4(4K)|xfs(4K)|btrfs(4K)|zfs(4K)|\n|:------------|:------------|:------------|:------------|:------------|\n|seq-read|6155|<b>17434</b>|10631|\u6e2c\u5b9a\u4e0d\u80fd|\n|seq-write|639|<b>1192</b>|759|\u6e2c\u5b9a\u4e0d\u80fd||\n|random-read|<b>1609</b>|1438|1532|\u6e2c\u5b9a\u4e0d\u80fd|\n|random-write|188|188|<b>191</b>|\u6e2c\u5b9a\u4e0d\u80fd|\n\n##bs=16K\n\n\u203b\u5358\u4f4d\u306fIOPS\u3067\u3059\u3002\n\n||ext4(16K)|xfs(16K)|btrfs(16K)|zfs(16K)|\n|:------------|:------------|:------------|:------------|:------------|\n|seq-read|<b>6864</b>|6502|3036|\u6e2c\u5b9a\u4e0d\u80fd|\n|seq-write|<b>1085</b>|1082|462|\u6e2c\u5b9a\u4e0d\u80fd||\n|random-read|1086|<b>1208</b>|387|\u6e2c\u5b9a\u4e0d\u80fd|\n|random-write|172|93|82|\u6e2c\u5b9a\u4e0d\u80fd|\n\n#fio\u306e\u7d50\u679c\u3092\u307f\u3066\n- 4K\u3060\u3068IOPS\u306f\u9045\u3081\u3002\u305f\u3060\u3001\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5909\u308f\u3063\u3066\u3082\u3001IOPS\u304c\u3055\u307b\u3069\u5909\u308f\u3089\u306a\u3044ext4\u306f\u5b89\u5b9a\u3057\u3066\u308b\u3068\u3044\u3048\u308b\u3002\n- xfs\u306f4K\u3060\u3068\u7206\u901f\u3002\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u9045\u304f\u306a\u3063\u3066\u3044\u304f\u50be\u5411\u3067\u3057\u305f\u3002\n- btrfs\u3082xfs\u3068\u4f3c\u3066\u3044\u308b\u304c\u3001\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u6700\u60aa\u306a\u7d50\u679c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n- zfs\u306f\u9045\u3044\u3002\u3068\u306b\u304b\u304f\u9045\u3044\u3002\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u6642\u9593\u304c\u3081\u3063\u3061\u3083\u304b\u304b\u308a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u6e2c\u5b9a\u4e0d\u80fd\u306b\u3057\u307e\u3057\u305f\u3002\n\n# \u79c1\u306a\u308a\u306e\u7dcf\u8a55\n<h3>\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304c\u6df7\u5728\u3059\u308b\u306e\u306f\u51fa\u6765\u308b\u9650\u308a\u907f\u3051\u305f\u3044\u3002<br>\n\u3068\u3044\u3046\u306e\u3092\u30d9\u30fc\u30b9\u306b\u3059\u308b\u3068XFS\u304c\u826f\u3044\u3002</h3>\n\n- \u4e00\u822c\u7684\u306blinux\u306e\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306f4k\u306a\u306e\u3067\u3001xfs\u306e\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3002\n<br>\n\n- MySQL\u3067\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u5927\u304d\u3081\u306a\u3089ext4\u3067\u3082\u3088\u3044\u3002xfs\u3060\u3068\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u304c\u5927\u304d\u304f\u306a\u308b\u306b\u3064\u308c\u3066\u9045\u304f\u306a\u3063\u3066\u308b\u50be\u5411\u304c\u898b\u3048\u308b\u3002\n    - \u30e9\u30f3\u30c0\u30e0\u30a2\u30af\u30bb\u30b9\u3067\u52a3\u3063\u3066\u5165\u308b\u90e8\u5206\u306f\u3001\u3042\u3048\u3066\u30d5\u30eb\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u5229\u7528\u3057\u306a\u3044\u65b9\u6cd5\u3092\u3068\u3063\u3066\u3082\u3088\u3044\u3002\n- \u305f\u3060\u3001SSD\u3084\u3089ioDrive\u3060\u3068\u3001\u51e6\u7406\u304c\u7206\u901f\u306b\u306a\u308b\u306e\u3067\u3001\u305d\u306e\u3068\u304d\u306fxfs\u3092\u9078\u3076\u306e\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n<br>\n\n- \u30b9\u30c8\u30ec\u30fc\u30b8\u7cfb\u306bxfs\u306f\u7121\u8b00\u3002\uff08fsck\u6642\u306b1TB\u306b\u3064\u304d\u30e1\u30e2\u30ea1GB\u3068\u304b\u8ad6\u5916\u3002\uff09<br>\uff08\u4fee\u6b63\u3055\u308c\u305f\u3068\u3044\u3046\u60c5\u5831\u3082\u3042\u308a\u307e\u3059\u3002http://xfs.org/index.php/XFS_status_update_for_2010#XFS_status_update_for_January_2010\uff09\n- \u30b9\u30c8\u30ec\u30fc\u30b8\u7cfb\u306b\u306fZFS\u3084Btrfs\u3092\u7d44\u307f\u8fbc\u3080\u3068\u826f\u3044\u3002\u5c06\u6765\u7684\u306b\u304a\u3059\u3059\u3081\u306a\u306e\u306fZFS\u304b\u306d\u3002\n    - \u91cd\u8907\u30d5\u30a1\u30a4\u30eb\u7bc0\u7d04\u6a5f\u80fd\u3084\u3001\u30c1\u30a7\u30c3\u30af\u5468\u308a\u304c\u5b89\u5fc3\u3068\u304b\u5b09\u3057\u3044\u3002\u4eca\u5f8c\u958b\u767a\u3067\u3055\u3089\u306b\u826f\u304f\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u52d5\u5411\u3092\u4f3a\u3044\u305f\u3044\u3067\u3059\u306d\u3002\n    - \u3057\u304b\u3057\u73fe\u72b6\u3067\u306fZFS\u306f\u307e\u3060\u30b7\u30b9\u30c6\u30e0\u306b\u7d44\u307f\u8fbc\u3080\u306e\u306f\u96e3\u3057\u3044\u3002\u5185\u5bb9\u3068\u3057\u3066\u306f\u7d20\u6674\u3089\u3057\u3044\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\u306e\u3067\u958b\u767a\u306b\u671f\u5f85\u3002\n"}