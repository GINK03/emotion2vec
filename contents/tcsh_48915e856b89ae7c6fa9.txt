{"context": " More than 1 year has passed since last update.AWS CLI\u3092\u5229\u7528\u3057\u3066\u3001AWS Config\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\nConfig\u3078\u306e\u6a29\u9650\nConfig\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nS3\u3078\u306e\u6a29\u9650\nS3\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nSNS\u3078\u306e\u6a29\u9650\nSNS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nIAM\u3078\u306e\u6a29\u9650\nIAM\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.7.28\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\u7d50\u679c(\u4f8b):\n  aws-cli/1.7.28 Python/2.7.5 Darwin/13.4.0\n\n\n0. \u4e8b\u524d\u4f5c\u696d\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\u4f5c\u6210\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\u7d50\u679c(\u4f8b)\n        Name                    Value             Type    Location\n        ----                    -----             ----    --------\n     profile administrator-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n  access_key     ****************XXXX shared-credentials-file\n  secret_key     ****************XXXX shared-credentials-file\n      region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. AWS ID\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nAWS_ID=`aws iam get-user --query 'User.Arn' --output text 2>&1 | sed 's/^.*:://' | sed 's/:.*$//'` \\\n  || AWS_ID=`aws iam get-user --query 'User.Arn' --output text  2>&1 | sed 's/^.* User: arn:aws:iam:://' |sed 's/:.*$//' | tr -d '\\n'` \\\n  && echo ${AWS_ID}\n\n\n\u7d50\u679c(\u4f8b):\n  XXXXXXXXXXXX\n\n\n1.2. S3\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6c7a\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nS3_BUCKET_NAME=\"config-bucket-${AWS_ID}-${AWS_DEFAULT_REGION}\" \\\n        && echo ${S3_BUCKET_NAME}\n\n\n\u30d0\u30b1\u30c3\u30c8\u540d\u304c\u7a7a\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws s3 ls s3://${S3_BUCKET_NAME}/\n\n\n\u7d50\u679c:\n  A client error (NoSuchBucket) occurred when calling the ListObjects operation: The specified bucket does not exist\n\n\n1.3. SNS\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6c7a\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nSNS_TOPIC_NAME=\"config-topic\"\n\n\n\u30c8\u30d4\u30c3\u30af\u540d\u304c\u7a7a\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nSNS_TOPIC_ARN=$(aws sns list-topics --query \"Topics[?contains(TopicArn,\\`${SNS_TOPIC_NAME}\\`)].TopicArn\" --output text) \\\n        && echo ${SNS_TOPIC_ARN}\n\n\n\u7d50\u679c:\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n1.4. IAM\u30ed\u30fc\u30eb\u540d\u306e\u6c7a\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_NAME=\"config-role-${AWS_DEFAULT_REGION}\" \\\n        && echo ${IAM_ROLE_NAME}\n\n\n\u540c\u3058\u540d\u524d\u306eIAM\u30ed\u30fc\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role \\\n         --role-name ${IAM_ROLE_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  A client error (NoSuchEntity) occurred when calling the GetRole operation: The role with name config-role-ap-northeast-1 cannot be found.\n\n\n1.5. \u30ed\u30fc\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nFILE_ROLE_DOC=\"iam-role-${IAM_ROLE_NAME}.json\" \\\n          && echo ${FILE_ROLE_DOC}\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_DOC}\n{\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Principal\": {\n                          \"Service\": \"config.amazonaws.com\"\n                      },\n                      \"Effect\": \"Allow\",\n                      \"Sid\": \"\"\n                  }\n          ]\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${FILE_ROLE_DOC}\n\n\n\n1.6. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nFILE_ROLE_POLICY_DOC=\"iam-role-${IAM_ROLE_NAME}-policy.json\" \\\n          && echo ${FILE_ROLE_POLICY_DOC}\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n  AWS_ID: ${AWS_ID}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"appstream:Get*\",\n              \"autoscaling:Describe*\",\n              \"cloudformation:DescribeStacks\",\n              \"cloudformation:DescribeStackEvents\",\n              \"cloudformation:DescribeStackResource\",\n              \"cloudformation:DescribeStackResources\",\n              \"cloudformation:GetTemplate\",\n              \"cloudformation:List*\",\n              \"cloudfront:Get*\",\n              \"cloudfront:List*\",\n              \"cloudtrail:DescribeTrails\",\n              \"cloudtrail:GetTrailStatus\",\n              \"cloudwatch:Describe*\",\n              \"cloudwatch:Get*\",\n              \"cloudwatch:List*\",\n              \"directconnect:Describe*\",\n              \"dynamodb:GetItem\",\n              \"dynamodb:BatchGetItem\",\n              \"dynamodb:Query\",\n              \"dynamodb:Scan\",\n              \"dynamodb:DescribeTable\",\n              \"dynamodb:ListTables\",\n              \"ec2:Describe*\",\n              \"elasticache:Describe*\",\n              \"elasticbeanstalk:Check*\",\n              \"elasticbeanstalk:Describe*\",\n              \"elasticbeanstalk:List*\",\n              \"elasticbeanstalk:RequestEnvironmentInfo\",\n              \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n              \"elasticloadbalancing:Describe*\",\n              \"elastictranscoder:Read*\",\n              \"elastictranscoder:List*\",\n              \"iam:List*\",\n              \"iam:Get*\",\n              \"kinesis:Describe*\",\n              \"kinesis:Get*\",\n              \"kinesis:List*\",\n              \"opsworks:Describe*\",\n              \"opsworks:Get*\",\n              \"route53:Get*\",\n              \"route53:List*\",\n              \"redshift:Describe*\",\n              \"redshift:ViewQueriesInConsole\",\n              \"rds:Describe*\",\n              \"rds:ListTagsForResource\",\n              \"s3:Get*\",\n              \"s3:List*\",\n              \"sdb:GetAttributes\",\n              \"sdb:List*\",\n              \"sdb:Select*\",\n              \"ses:Get*\",\n              \"ses:List*\",\n              \"sns:Get*\",\n              \"sns:List*\",\n              \"sqs:GetQueueAttributes\",\n              \"sqs:ListQueues\",\n              \"sqs:ReceiveMessage\",\n              \"storagegateway:List*\",\n              \"storagegateway:Describe*\",\n              \"trustedadvisor:Describe*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:PutObject*\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::config-bucket-${AWS_ID}-ap-northeast-1/AWSLogs/${AWS_ID}/*\"\n            ],\n            \"Condition\": {\n              \"StringLike\": {\n                \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n              }\n            }\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:GetBucketAcl\"\n            ],\n            \"Resource\": \"arn:aws:s3:::config-bucket-${AWS_ID}-ap-northeast-1\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": \"sns:Publish\",\n            \"Resource\": \"arn:aws:sns:ap-northeast-1:${AWS_ID}:config-topic\"\n          }\n        ]\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${FILE_ROLE_POLICY_DOC}\n\n\n\n1. S3\u30d0\u30b1\u30c3\u30c8\u306e\u4f5c\u6210\n\n1.1. S3\u30d0\u30b1\u30c3\u30c8\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws s3 mb s3://${S3_BUCKET_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  make_bucket: s3://config-bucket-XXXXXXXXXXXX-ap-northeast-1/\n\n\n1.2. S3\u30d0\u30b1\u30c3\u30c8\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws s3 ls s3://${S3_BUCKET_NAME}\n\n\n\u7d50\u679c:\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n2. SNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n\n2.1. SNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n\u624b\u9806: http://qiita.com/tcsh/items/e05e21e7338668cbf3b8\n\n2.2. SNS\u30c8\u30d4\u30c3\u30af\u306e\u8cfc\u8aad\n\u624b\u9806: http://qiita.com/tcsh/items/ca81576b0018bfa32cbe\n\n3. IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u53c2\u8003: http://docs.aws.amazon.com/config/latest/developerguide/iamrole-\npermissions.html\n\n3.1. \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n          IAM_ROLE_NAME: ${IAM_ROLE_NAME}\n          FILE_ROLE_DOC: ${FILE_ROLE_DOC}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws iam create-role \\\n         --role-name ${IAM_ROLE_NAME} \\\n         --assume-role-policy-document file://${FILE_ROLE_DOC}\n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"Role\": {\n      \"AssumeRolePolicyDocument\": {\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n              {\n                  \"Action\": \"sts:AssumeRole\",\n                  \"Sid\": \"\",\n                  \"Effect\": \"Allow\",\n                  \"Principal\": {\n                      \"Service\": \"config.amazonaws.com\"\n                  }\n              }\n          ]\n      },\n      \"RoleId\": \"AROAJKX6IMJRSEEVCOO5C\",\n      \"CreateDate\": \"2015-05-25T06:54:10.914Z\",\n      \"RoleName\": \"config-role-ap-northeast-1\",\n      \"Path\": \"/\",\n      \"Arn\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\"\n    }\n  }\n\n\n3.2. \u30ed\u30fc\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role \\\n        --role-name ${IAM_ROLE_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"Role\": {\n      \"AssumeRolePolicyDocument\": {\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n              {\n                  \"Action\": \"sts:AssumeRole\",\n                  \"Principal\": {\n                      \"Service\": \"config.amazonaws.com\"\n                  },\n                  \"Effect\": \"Allow\",\n                  \"Sid\": \"\"\n              }\n          ]\n      },\n      \"RoleId\": \"AROAJYWFXLVCHHE5VT6LI\",\n      \"CreateDate\": \"2015-05-25T06:54:10Z\",\n      \"RoleName\": \"config-role-ap-northeast-1\",\n      \"Path\": \"/\",\n      \"Arn\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\"\n    }\n  }\n\n\n3.3. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_POLICY_NAME=\"policy_CloudTrail_CloudWatchLogs_Role_${AWS_DEFAULT_REGION}\"\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n          IAM_ROLE_NAME:        ${IAM_ROLE_NAME}\n          IAM_ROLE_POLICY_NAME: ${IAM_ROLE_POLICY_NAME}\n          FILE_ROLE_POLICY_DOC: ${FILE_ROLE_POLICY_DOC}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws iam put-role-policy \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --policy-name ${IAM_ROLE_POLICY_NAME} \\\n          --policy-document file://${FILE_ROLE_POLICY_DOC}\n\n\n\u7d50\u679c(\u4f8b):\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n3.4. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws iam get-role-policy \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --policy-name ${IAM_ROLE_POLICY_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n      {\n        \"Action\": [\n          \"appstream:Get*\",\n          \"autoscaling:Describe*\",\n          \"cloudformation:DescribeStacks\",\n          \"cloudformation:DescribeStackEvents\",\n          \"cloudformation:DescribeStackResource\",\n          \"cloudformation:DescribeStackResources\",\n          \"cloudformation:GetTemplate\",\n          \"cloudformation:List*\",\n          \"cloudfront:Get*\",\n          \"cloudfront:List*\",\n          \"cloudtrail:DescribeTrails\",\n          \"cloudtrail:GetTrailStatus\",\n          \"cloudwatch:Describe*\",\n          \"cloudwatch:Get*\",\n          \"cloudwatch:List*\",\n          \"directconnect:Describe*\",\n          \"dynamodb:GetItem\",\n          \"dynamodb:BatchGetItem\",\n          \"dynamodb:Query\",\n          \"dynamodb:Scan\",\n          \"dynamodb:DescribeTable\",\n          \"dynamodb:ListTables\",\n          \"ec2:Describe*\",\n          \"elasticache:Describe*\",\n          \"elasticbeanstalk:Check*\",\n          \"elasticbeanstalk:Describe*\",\n          \"elasticbeanstalk:List*\",\n          \"elasticbeanstalk:RequestEnvironmentInfo\",\n          \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n          \"elasticloadbalancing:Describe*\",\n          \"elastictranscoder:Read*\",\n          \"elastictranscoder:List*\",\n          \"iam:List*\",\n          \"iam:Get*\",\n          \"kinesis:Describe*\",\n          \"kinesis:Get*\",\n          \"kinesis:List*\",\n          \"opsworks:Describe*\",\n          \"opsworks:Get*\",\n          \"route53:Get*\",\n          \"route53:List*\",\n          \"redshift:Describe*\",\n          \"redshift:ViewQueriesInConsole\",\n          \"rds:Describe*\",\n          \"rds:ListTagsForResource\",\n          \"s3:Get*\",\n          \"s3:List*\",\n          \"sdb:GetAttributes\",\n          \"sdb:List*\",\n          \"sdb:Select*\",\n          \"ses:Get*\",\n          \"ses:List*\",\n          \"sns:Get*\",\n          \"sns:List*\",\n          \"sqs:GetQueueAttributes\",\n          \"sqs:ListQueues\",\n          \"sqs:ReceiveMessage\",\n          \"storagegateway:List*\",\n          \"storagegateway:Describe*\",\n          \"trustedadvisor:Describe*\"\n        ],\n        \"Effect\": \"Allow\",\n        \"Resource\": \"*\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:PutObject*\"\n        ],\n        \"Resource\": [\n          \"arn:aws:s3:::config-bucket-XXXXXXXXXXXX-ap-northeast-1/AWSLogs/XXXXXXXXXXXX/*\"\n        ],\n        \"Condition\": {\n          \"StringLike\": {\n            \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n          }\n        }\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": [\n          \"s3:GetBucketAcl\"\n        ],\n        \"Resource\": \"arn:aws:s3:::config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n      },\n      {\n        \"Effect\": \"Allow\",\n        \"Action\": \"sns:Publish\",\n        \"Resource\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\"\n      }\n    ]\n  }\n\n\n3.5. IAM\u30ed\u30fc\u30eb\u306eARN\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_ARN=`aws iam get-role --role-name ${IAM_ROLE_NAME} --query 'Role.Arn' --output text` \\\n        && echo ${IAM_ROLE_ARN}\n\n\n\u7d50\u679c(\u4f8b):\n  arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\n\n\n4. Config\u306e\u6709\u52b9\u5316\n\n4.1. subscribe\u306e\u5b9f\u65bd\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n  S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n  SNS_TOPIC_ARN: ${SNS_TOPIC_ARN}\n  IAM_ROLE_ARN: ${IAM_ROLE_ARN}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice subscribe \\\n        --s3-bucket ${S3_BUCKET_NAME} \\\n        --sns-topic ${SNS_TOPIC_ARN} \\\n        --iam-role ${IAM_ROLE_ARN}\n\n\n\u7d50\u679c(\u4f8b):\n  Using existing S3 bucket: config-bucket-XXXXXXXXXXXX-ap-northeast-1\n  Using existing SNS topic: arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\n  Subscribe succeeded:\n\n  Configuration Recorders: [\n      {\n          \"roleARN\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\",\n          \"name\": \"default\"\n      }\n  ]\n\n  Delivery Channels: [\n      {\n          \"snsTopicARN\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\",\n          \"name\": \"default\",\n          \"s3BucketName\": \"config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n      }\n  ]\n\n\n4.2. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configservice get-status \n\n\n\u7d50\u679c:\n  Configuration Recorders:\n\n  name: default\n  recorder: ON\n  last status: SUCCESS\n\n  Delivery Channels:\n\n  name: default\n  last stream delivery status: SUCCESS\n\n\n5. \u78ba\u8a8d\n\n5.1. \u30c7\u30ea\u30d0\u30ea\u30c1\u30e3\u30cd\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configservice describe-delivery-channels \n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"DeliveryChannels\": [\n      {\n          \"snsTopicARN\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\",\n          \"name\": \"default\",\n          \"s3BucketName\": \"config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n      }\n    ]\n  }\n\n\n5.2. \u30c7\u30ea\u30d0\u30ea\u30c1\u30e3\u30cd\u30eb\u540d\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nCONF_DELIVERY_CHANNEL=` aws configservice describe-delivery-channels --query 'DeliveryChannels[].name' --output text` \\\n        && echo ${CONF_DELIVERY_CHANNEL}\n\n\n\n5.3. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configservice describe-configuration-recorders \n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"ConfigurationRecorders\": [\n      {\n          \"roleARN\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\",\n          \"name\": \"default\"\n      }\n    ]\n  }\n\n\n5.4. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configservice describe-configuration-recorder-status \n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"ConfigurationRecordersStatus\": [\n      {\n          \"recording\": true,\n          \"lastStatusChangeTime\": 1432175805.699,\n          \"lastStartTime\": 1428460592.195,\n          \"lastStatus\": \"SUCCESS\",\n          \"name\": \"default\"\n      }\n    ]\n  }\n\n\n5.5. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u540d\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nCONF_RECORD_NAME=` aws configservice describe-configuration-recorders --query 'ConfigurationRecorders[].name' --output text` \\\n        && echo ${CONF_RECORD_NAME}\n\n\n\n6. \u52d5\u4f5c\u78ba\u8a8d\n\n6.1. VPC\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-vpc --cidr-block 10.1.0.0/20\n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"Vpc\": {\n      \"InstanceTenancy\": \"default\",\n      \"State\": \"pending\",\n      \"VpcId\": \"vpc-xxxxxxxx\",\n      \"CidrBlock\": \"10.1.0.0/18\",\n      \"DhcpOptionsId\": \"dopt-xxxxxxxx\"\n    }\n  }\n\n\n\u30b3\u30de\u30f3\u30c9\nVPC_ID=vpc-xxxxxxxx\nCONF_RESOURCE_ID=${VPC_ID}\n\n\n\n6.2. \u5c65\u6b74\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nCONF_RESOURCE_TYPE='AWS::EC2::VPC'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice get-resource-config-history \\\n        --resource-type ${CONF_RESOURCE_TYPE} \\\n        --resource-id ${CONF_RESOURCE_ID}\n\n\n\u7d50\u679c(\u4f8b):\n  {\n    \"configurationItems\": [\n      {\n          \"configurationItemCaptureTime\": 1432538711.476,\n          \"relationships\": [\n              {\n                  \"resourceType\": \"AWS::EC2::NetworkAcl\",\n                  \"resourceId\": \"acl-xxxxxxxx\",\n                  \"relationshipName\": \"Contains NetworkAcl\"\n              },\n              {\n                  \"resourceType\": \"AWS::EC2::RouteTable\",\n                  \"resourceId\": \"rtb-xxxxxxxx\",\n                  \"relationshipName\": \"Contains RouteTable\"\n              },\n              {\n                  \"resourceType\": \"AWS::EC2::SecurityGroup\",\n                  \"resourceId\": \"sg-xxxxxxxx\",\n                  \"relationshipName\": \"Contains SecurityGroup\"\n              }\n          ],\n          \"availabilityZone\": \"Multiple Availability Zones\",\n          \"tags\": {},\n          \"resourceType\": \"AWS::EC2::VPC\",\n          \"resourceId\": \"vpc-xxxxxxxx\",\n          \"configurationStateId\": \"1\",\n          \"relatedEvents\": [\n              \"xxxxxxxx-xxxx-xxxx-xxxx-c83c9ba78b53\"\n          ],\n          \"arn\": \"arn:aws:ec2:ap-northeast-1:XXXXXXXXXXXX:vpc/vpc-xxxxxxxx\",\n          \"version\": \"1.0\",\n          \"configurationItemMD5Hash\": \"347d45e5c147842ec20f02309d66a4a2\",\n          \"configuration\": \"{\"vpcId\":\"vpc-xxxxxxxx\",\"state\":\"available\",\"cidrBlock\":\"10.1.0.0/18\",\"dhcpOptionsId\":\"dopt-xxxxxxxx\",\"tags\":[],\"instanceTenancy\":\"default\",\"isDefault\":false}\",\n          \"configurationItemStatus\": \"ResourceDiscovered\",\n          \"accountId\": \"XXXXXXXXXXXX\"\n      }\n    ],\n    \"nextToken\": \"eyJlbmNyeXB0ZWREYXRhIjpbMTEzLDU0LC0xMTMsMTIsLTUwLC0xMDcsNTcsOTYsLTkxLC03MywtMjEsOCwtNDAsNzQsOTAsMzUsLTIsODYsLTY1LDcxLC03LC05XSwzNCwyMSw5MywtMzIsLTk2LDgwLDQsODksLTMwLC05NCwtNjQsLTQsNDgsLTExMCw1Nyw5LC05Myw4MywzNCwxMjQsLTkwLDE0LDIwLC0xMDUsMTAzLC0xMjAsLTkxLC0xMjcsMTI0LC0xMjEsLTExMywtOTUsLTkyLC0yMiwxNCw4NiwtMzUsLTM5LDExNywtMTYsMTEsNjgsNjAsLTkxLDYsNzgsMTE2LC03MiwxMjIsMTA0LC0zNSw4MCwtNjAsLTUxLDE1LDI0LDExMSwtMTAsNjYsLTEyMSwtOTUsLTI3LC01OCwzMSw4OSwtMTksLTc2LC0zOSw3NiwtMjYsLTMzLDMyLC03MSwtNjMsLTExLC0yMCw3NCwxNCwtMzAsNjEsLTEyNywtMTUsNDEsNTgsLTIxLC00OSw1MCwtMzcsLTY1LC05LC0xMjgsLTc4LDExMSw0LC02OSw1OCwtNjMsMTE2LC02NywtOTMsMTA2LC0yNywxMjUsMTcsOTQsLTI5LC0yMSwtNywtMzQsLTM4LDM4LC0xMDAsLTYzLDY1LDEwLDgsLTc5LDEyNCw1LC02NCwtMzEsLTEwMCwyNiwtODAsLTExNiwtNTksNSwyMSw2MywzOCwtODUsMTI2LDYzLC04NCwtNCw1NCw1NywtMTA0LC00NCwtMTIzLDI0LDU4LC0zLDMyXSwibWF0ZXJpYWxTZXRTZXJpYWxOdW1iZXIiOjEsIml2UGFyYW1ldGVyU3BlYyI6eyJpdiI6WzUxLC0xMDIsMTA5LDQ4LDE3LC0xMjIsLTEyMiw5MiwtNTgsMTI0LC04MiwtODQsLTIxLC05MiwyLC00X119fQ==\"\n  }\n\n\n6.3. VPC\u306e\u524a\u9664\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 delete-vpc --vpc-id ${VPC_ID}\n\n\n\u7d50\u679c:\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n7. \u8a18\u9332\u306e\u505c\u6b62\u3001\u518d\u958b\n\n7.1. \u8a18\u9332\u306e\u505c\u6b62\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n  CONF_RECORD_NAME: ${CONF_RECORD_NAME}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice stop-configuration-recorder \\\n        --configuration-recorder-name ${CONF_RECORD_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice get-status \n\n\n\u7d50\u679c:\n  Configuration Recorders:\n\n  name: default\n  recorder: OFF\n\n  Delivery Channels:\n\n  name: default\n  last stream delivery status: SUCCESS\n  last snapshot delivery status: SUCCESS\n\n\n7.2. \u8a18\u9332\u306e\u518d\u958b\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n  CONF_RECORD_NAME: ${CONF_RECORD_NAME}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice start-configuration-recorder \\\n        --configuration-recorder-name ${CONF_RECORD_NAME}\n\n\n\u7d50\u679c(\u4f8b):\n  (\u623b\u308a\u5024\u306a\u3057)\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice get-status \n\n\n\u7d50\u679c:\n  Configuration Recorders:\n\n  name: default\n  recorder: ON\n  last status: SUCCESS\n\n  Delivery Channels:\n\n  name: default\n  last stream delivery status: SUCCESS\n\n\n8. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97\n\n8.1. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n  CONF_DELIVERY_CHANNEL: ${CONF_DELIVERY_CHANNEL}\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configservice deliver-config-snapshot \\\n        --delivery-channel-name ${CONF_DELIVERY_CHANNEL}\n\n\n\u7d50\u679c(\u4f8b):\n  {\n      \"configSnapshotId\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n  }\n\n\n8.2. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configservice describe-delivery-channel-status \\\n        --query 'DeliveryChannelsStatus[].configSnapshotDeliveryInfo'\n\n\n\u7d50\u679c:\n  [\n    {\n      \"lastSuccessfulTime\": 1432541300.012,\n      \"lastStatus\": \"SUCCESS\",\n      \"lastAttemptTime\": 1432541300.012\n    }\n  ]\n\n\n8.3. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n(\u4f8b)   s3://config-bucket-XXXXXXXXXXXX-ap-northeast-1/AWSLogs/XXXXXXXXXXXX/Config/ap-northeast-1/2015/5/25/ConfigSnapshot/XXXXXXXXXXXX-northeast-1_ConfigSnapshot_20150525T080818Z_ca395e18-ef27-40b2-839d-2cab2bcab226.json.gz\n\n\u5b8c\u4e86\nAWS Config\u306f\u7121\u6599\u67a0\u304c\u7121\u3044\u306e\u3067\u3001\u30cf\u30f3\u30ba\u30aa\u30f3\u5b8c\u4e86\u5f8c\u306f\u8ab2\u91d1\u3092\u907f\u3051\u305f\u3044\u5834\u5408\u306f\u8a18\u9332\u3092\u505c\u6b62\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001AWS Config\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n\nConfig\u3078\u306e\u6a29\u9650\n--------------\n\nConfig\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nS3\u3078\u306e\u6a29\u9650\n----------\n\nS3\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nSNS\u3078\u306e\u6a29\u9650\n-----------\n\nSNS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nIAM\u3078\u306e\u6a29\u9650\n-----------\n\nIAM\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.7.28\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n\u7d50\u679c(\u4f8b):\n\n      aws-cli/1.7.28 Python/2.7.5 Darwin/13.4.0\n\n\n0. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\n\u4f5c\u6210\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002\n\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n```\n\n\u7d50\u679c(\u4f8b)\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile administrator-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n1.1. AWS ID\u306e\u53d6\u5f97\n-----------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nAWS_ID=`aws iam get-user --query 'User.Arn' --output text 2>&1 | sed 's/^.*:://' | sed 's/:.*$//'` \\\n  || AWS_ID=`aws iam get-user --query 'User.Arn' --output text  2>&1 | sed 's/^.* User: arn:aws:iam:://' |sed 's/:.*$//' | tr -d '\\n'` \\\n  && echo ${AWS_ID}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      XXXXXXXXXXXX\n\n\n1.2. S3\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6c7a\u5b9a\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nS3_BUCKET_NAME=\"config-bucket-${AWS_ID}-${AWS_DEFAULT_REGION}\" \\\n        && echo ${S3_BUCKET_NAME}\n```\n\n\u30d0\u30b1\u30c3\u30c8\u540d\u304c\u7a7a\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws s3 ls s3://${S3_BUCKET_NAME}/\n```\n\n\u7d50\u679c:\n\n      A client error (NoSuchBucket) occurred when calling the ListObjects operation: The specified bucket does not exist\n\n\n1.3. SNS\u30d0\u30b1\u30c3\u30c8\u540d\u306e\u6c7a\u5b9a\n------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nSNS_TOPIC_NAME=\"config-topic\"\n```\n\n\u30c8\u30d4\u30c3\u30af\u540d\u304c\u7a7a\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nSNS_TOPIC_ARN=$(aws sns list-topics --query \"Topics[?contains(TopicArn,\\`${SNS_TOPIC_NAME}\\`)].TopicArn\" --output text) \\\n        && echo ${SNS_TOPIC_ARN}\n```\n\n\n\u7d50\u679c:\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n1.4. IAM\u30ed\u30fc\u30eb\u540d\u306e\u6c7a\u5b9a\n----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_NAME=\"config-role-${AWS_DEFAULT_REGION}\" \\\n        && echo ${IAM_ROLE_NAME}\n```\n\n\u540c\u3058\u540d\u524d\u306eIAM\u30ed\u30fc\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam get-role \\\n         --role-name ${IAM_ROLE_NAME}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      A client error (NoSuchEntity) occurred when calling the GetRole operation: The role with name config-role-ap-northeast-1 cannot be found.\n\n\n1.5. \u30ed\u30fc\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n-----------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nFILE_ROLE_DOC=\"iam-role-${IAM_ROLE_NAME}.json\" \\\n          && echo ${FILE_ROLE_DOC}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_ROLE_DOC}\n{\n          \"Version\": \"2012-10-17\",\n          \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Principal\": {\n                          \"Service\": \"config.amazonaws.com\"\n                      },\n                      \"Effect\": \"Allow\",\n                      \"Sid\": \"\"\n                  }\n          ]\n}\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\njsonlint -q ${FILE_ROLE_DOC}\n```\n\n\n1.6. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4f5c\u6210\n-------------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nFILE_ROLE_POLICY_DOC=\"iam-role-${IAM_ROLE_NAME}-policy.json\" \\\n          && echo ${FILE_ROLE_POLICY_DOC}\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n  AWS_ID: ${AWS_ID}\n\nETX\n```\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_ROLE_POLICY_DOC}\n{\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"appstream:Get*\",\n              \"autoscaling:Describe*\",\n              \"cloudformation:DescribeStacks\",\n              \"cloudformation:DescribeStackEvents\",\n              \"cloudformation:DescribeStackResource\",\n              \"cloudformation:DescribeStackResources\",\n              \"cloudformation:GetTemplate\",\n              \"cloudformation:List*\",\n              \"cloudfront:Get*\",\n              \"cloudfront:List*\",\n              \"cloudtrail:DescribeTrails\",\n              \"cloudtrail:GetTrailStatus\",\n              \"cloudwatch:Describe*\",\n              \"cloudwatch:Get*\",\n              \"cloudwatch:List*\",\n              \"directconnect:Describe*\",\n              \"dynamodb:GetItem\",\n              \"dynamodb:BatchGetItem\",\n              \"dynamodb:Query\",\n              \"dynamodb:Scan\",\n              \"dynamodb:DescribeTable\",\n              \"dynamodb:ListTables\",\n              \"ec2:Describe*\",\n              \"elasticache:Describe*\",\n              \"elasticbeanstalk:Check*\",\n              \"elasticbeanstalk:Describe*\",\n              \"elasticbeanstalk:List*\",\n              \"elasticbeanstalk:RequestEnvironmentInfo\",\n              \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n              \"elasticloadbalancing:Describe*\",\n              \"elastictranscoder:Read*\",\n              \"elastictranscoder:List*\",\n              \"iam:List*\",\n              \"iam:Get*\",\n              \"kinesis:Describe*\",\n              \"kinesis:Get*\",\n              \"kinesis:List*\",\n              \"opsworks:Describe*\",\n              \"opsworks:Get*\",\n              \"route53:Get*\",\n              \"route53:List*\",\n              \"redshift:Describe*\",\n              \"redshift:ViewQueriesInConsole\",\n              \"rds:Describe*\",\n              \"rds:ListTagsForResource\",\n              \"s3:Get*\",\n              \"s3:List*\",\n              \"sdb:GetAttributes\",\n              \"sdb:List*\",\n              \"sdb:Select*\",\n              \"ses:Get*\",\n              \"ses:List*\",\n              \"sns:Get*\",\n              \"sns:List*\",\n              \"sqs:GetQueueAttributes\",\n              \"sqs:ListQueues\",\n              \"sqs:ReceiveMessage\",\n              \"storagegateway:List*\",\n              \"storagegateway:Describe*\",\n              \"trustedadvisor:Describe*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:PutObject*\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::config-bucket-${AWS_ID}-ap-northeast-1/AWSLogs/${AWS_ID}/*\"\n            ],\n            \"Condition\": {\n              \"StringLike\": {\n                \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n              }\n            }\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:GetBucketAcl\"\n            ],\n            \"Resource\": \"arn:aws:s3:::config-bucket-${AWS_ID}-ap-northeast-1\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": \"sns:Publish\",\n            \"Resource\": \"arn:aws:sns:ap-northeast-1:${AWS_ID}:config-topic\"\n          }\n        ]\n}\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\njsonlint -q ${FILE_ROLE_POLICY_DOC}\n```\n\n\n1. S3\u30d0\u30b1\u30c3\u30c8\u306e\u4f5c\u6210\n===================\n\n\n1.1. S3\u30d0\u30b1\u30c3\u30c8\u306e\u4f5c\u6210\n---------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws s3 mb s3://${S3_BUCKET_NAME}\n```\n\n\n\u7d50\u679c(\u4f8b):\n\n      make_bucket: s3://config-bucket-XXXXXXXXXXXX-ap-northeast-1/\n\n\n1.2. S3\u30d0\u30b1\u30c3\u30c8\u306e\u78ba\u8a8d\n---------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws s3 ls s3://${S3_BUCKET_NAME}\n```\n\n\u7d50\u679c:\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n2. SNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n====================\n\n\n2.1. SNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n----------------------\n\n\u624b\u9806: http://qiita.com/tcsh/items/e05e21e7338668cbf3b8\n\n\n2.2. SNS\u30c8\u30d4\u30c3\u30af\u306e\u8cfc\u8aad\n----------------------\n\n\u624b\u9806: http://qiita.com/tcsh/items/ca81576b0018bfa32cbe\n\n\n3. IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n==================\n\n\u53c2\u8003: http://docs.aws.amazon.com/config/latest/developerguide/iamrole-\npermissions.html\n\n\n3.1. \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n-----------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n          IAM_ROLE_NAME: ${IAM_ROLE_NAME}\n          FILE_ROLE_DOC: ${FILE_ROLE_DOC}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam create-role \\\n         --role-name ${IAM_ROLE_NAME} \\\n         --assume-role-policy-document file://${FILE_ROLE_DOC}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"Role\": {\n          \"AssumeRolePolicyDocument\": {\n              \"Version\": \"2012-10-17\",\n              \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Sid\": \"\",\n                      \"Effect\": \"Allow\",\n                      \"Principal\": {\n                          \"Service\": \"config.amazonaws.com\"\n                      }\n                  }\n              ]\n          },\n          \"RoleId\": \"AROAJKX6IMJRSEEVCOO5C\",\n          \"CreateDate\": \"2015-05-25T06:54:10.914Z\",\n          \"RoleName\": \"config-role-ap-northeast-1\",\n          \"Path\": \"/\",\n          \"Arn\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\"\n        }\n      }\n\n\n3.2. \u30ed\u30fc\u30eb\u306e\u78ba\u8a8d\n-----------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam get-role \\\n        --role-name ${IAM_ROLE_NAME}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"Role\": {\n          \"AssumeRolePolicyDocument\": {\n              \"Version\": \"2012-10-17\",\n              \"Statement\": [\n                  {\n                      \"Action\": \"sts:AssumeRole\",\n                      \"Principal\": {\n                          \"Service\": \"config.amazonaws.com\"\n                      },\n                      \"Effect\": \"Allow\",\n                      \"Sid\": \"\"\n                  }\n              ]\n          },\n          \"RoleId\": \"AROAJYWFXLVCHHE5VT6LI\",\n          \"CreateDate\": \"2015-05-25T06:54:10Z\",\n          \"RoleName\": \"config-role-ap-northeast-1\",\n          \"Path\": \"/\",\n          \"Arn\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\"\n        }\n      }\n\n\n3.3. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_POLICY_NAME=\"policy_CloudTrail_CloudWatchLogs_Role_${AWS_DEFAULT_REGION}\"\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n          IAM_ROLE_NAME:        ${IAM_ROLE_NAME}\n          IAM_ROLE_POLICY_NAME: ${IAM_ROLE_POLICY_NAME}\n          FILE_ROLE_POLICY_DOC: ${FILE_ROLE_POLICY_DOC}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam put-role-policy \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --policy-name ${IAM_ROLE_POLICY_NAME} \\\n          --policy-document file://${FILE_ROLE_POLICY_DOC}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n3.4. \u30ed\u30fc\u30eb\u30dd\u30ea\u30b7\u30fc\u306e\u78ba\u8a8d\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws iam get-role-policy \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --policy-name ${IAM_ROLE_POLICY_NAME}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"appstream:Get*\",\n              \"autoscaling:Describe*\",\n              \"cloudformation:DescribeStacks\",\n              \"cloudformation:DescribeStackEvents\",\n              \"cloudformation:DescribeStackResource\",\n              \"cloudformation:DescribeStackResources\",\n              \"cloudformation:GetTemplate\",\n              \"cloudformation:List*\",\n              \"cloudfront:Get*\",\n              \"cloudfront:List*\",\n              \"cloudtrail:DescribeTrails\",\n              \"cloudtrail:GetTrailStatus\",\n              \"cloudwatch:Describe*\",\n              \"cloudwatch:Get*\",\n              \"cloudwatch:List*\",\n              \"directconnect:Describe*\",\n              \"dynamodb:GetItem\",\n              \"dynamodb:BatchGetItem\",\n              \"dynamodb:Query\",\n              \"dynamodb:Scan\",\n              \"dynamodb:DescribeTable\",\n              \"dynamodb:ListTables\",\n              \"ec2:Describe*\",\n              \"elasticache:Describe*\",\n              \"elasticbeanstalk:Check*\",\n              \"elasticbeanstalk:Describe*\",\n              \"elasticbeanstalk:List*\",\n              \"elasticbeanstalk:RequestEnvironmentInfo\",\n              \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n              \"elasticloadbalancing:Describe*\",\n              \"elastictranscoder:Read*\",\n              \"elastictranscoder:List*\",\n              \"iam:List*\",\n              \"iam:Get*\",\n              \"kinesis:Describe*\",\n              \"kinesis:Get*\",\n              \"kinesis:List*\",\n              \"opsworks:Describe*\",\n              \"opsworks:Get*\",\n              \"route53:Get*\",\n              \"route53:List*\",\n              \"redshift:Describe*\",\n              \"redshift:ViewQueriesInConsole\",\n              \"rds:Describe*\",\n              \"rds:ListTagsForResource\",\n              \"s3:Get*\",\n              \"s3:List*\",\n              \"sdb:GetAttributes\",\n              \"sdb:List*\",\n              \"sdb:Select*\",\n              \"ses:Get*\",\n              \"ses:List*\",\n              \"sns:Get*\",\n              \"sns:List*\",\n              \"sqs:GetQueueAttributes\",\n              \"sqs:ListQueues\",\n              \"sqs:ReceiveMessage\",\n              \"storagegateway:List*\",\n              \"storagegateway:Describe*\",\n              \"trustedadvisor:Describe*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:PutObject*\"\n            ],\n            \"Resource\": [\n              \"arn:aws:s3:::config-bucket-XXXXXXXXXXXX-ap-northeast-1/AWSLogs/XXXXXXXXXXXX/*\"\n            ],\n            \"Condition\": {\n              \"StringLike\": {\n                \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n              }\n            }\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n              \"s3:GetBucketAcl\"\n            ],\n            \"Resource\": \"arn:aws:s3:::config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n          },\n          {\n            \"Effect\": \"Allow\",\n            \"Action\": \"sns:Publish\",\n            \"Resource\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\"\n          }\n        ]\n      }\n\n\n3.5. IAM\u30ed\u30fc\u30eb\u306eARN\u53d6\u5f97\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_ARN=`aws iam get-role --role-name ${IAM_ROLE_NAME} --query 'Role.Arn' --output text` \\\n        && echo ${IAM_ROLE_ARN}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\n\n\n4. Config\u306e\u6709\u52b9\u5316\n=================\n\n\n4.1. subscribe\u306e\u5b9f\u65bd\n--------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n  S3_BUCKET_NAME: ${S3_BUCKET_NAME}\n  SNS_TOPIC_ARN: ${SNS_TOPIC_ARN}\n  IAM_ROLE_ARN: ${IAM_ROLE_ARN}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice subscribe \\\n        --s3-bucket ${S3_BUCKET_NAME} \\\n        --sns-topic ${SNS_TOPIC_ARN} \\\n        --iam-role ${IAM_ROLE_ARN}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      Using existing S3 bucket: config-bucket-XXXXXXXXXXXX-ap-northeast-1\n      Using existing SNS topic: arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\n      Subscribe succeeded:\n\n      Configuration Recorders: [\n          {\n              \"roleARN\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\",\n              \"name\": \"default\"\n          }\n      ]\n\n      Delivery Channels: [\n          {\n              \"snsTopicARN\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\",\n              \"name\": \"default\",\n              \"s3BucketName\": \"config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n          }\n      ]\n\n\n4.2. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n---------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice get-status \n```\n\n\u7d50\u679c:\n\n      Configuration Recorders:\n\n      name: default\n      recorder: ON\n      last status: SUCCESS\n\n      Delivery Channels:\n\n      name: default\n      last stream delivery status: SUCCESS\n\n\n5. \u78ba\u8a8d\n=======\n\n\n5.1. \u30c7\u30ea\u30d0\u30ea\u30c1\u30e3\u30cd\u30eb\u306e\u78ba\u8a8d\n---------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice describe-delivery-channels \n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"DeliveryChannels\": [\n          {\n              \"snsTopicARN\": \"arn:aws:sns:ap-northeast-1:XXXXXXXXXXXX:config-topic\",\n              \"name\": \"default\",\n              \"s3BucketName\": \"config-bucket-XXXXXXXXXXXX-ap-northeast-1\"\n          }\n        ]\n      }\n\n\n5.2. \u30c7\u30ea\u30d0\u30ea\u30c1\u30e3\u30cd\u30eb\u540d\u306e\u53d6\u5f97\n-----------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCONF_DELIVERY_CHANNEL=` aws configservice describe-delivery-channels --query 'DeliveryChannels[].name' --output text` \\\n        && echo ${CONF_DELIVERY_CHANNEL}\n```\n\n\n\n5.3. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u306e\u78ba\u8a8d\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice describe-configuration-recorders \n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"ConfigurationRecorders\": [\n          {\n              \"roleARN\": \"arn:aws:iam::XXXXXXXXXXXX:role/config-role-ap-northeast-1\",\n              \"name\": \"default\"\n          }\n        ]\n      }\n\n\n5.4. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u306e\u72b6\u614b\u78ba\u8a8d\n-------------------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice describe-configuration-recorder-status \n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"ConfigurationRecordersStatus\": [\n          {\n              \"recording\": true,\n              \"lastStatusChangeTime\": 1432175805.699,\n              \"lastStartTime\": 1428460592.195,\n              \"lastStatus\": \"SUCCESS\",\n              \"name\": \"default\"\n          }\n        ]\n      }\n\n\n5.5. \u8a2d\u5b9a\u30ec\u30b3\u30fc\u30c0\u540d\u306e\u53d6\u5f97\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCONF_RECORD_NAME=` aws configservice describe-configuration-recorders --query 'ConfigurationRecorders[].name' --output text` \\\n        && echo ${CONF_RECORD_NAME}\n```\n\n\n\n6. \u52d5\u4f5c\u78ba\u8a8d\n===========\n\n\n6.1. VPC\u306e\u4f5c\u6210\n--------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 create-vpc --cidr-block 10.1.0.0/20\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"Vpc\": {\n          \"InstanceTenancy\": \"default\",\n          \"State\": \"pending\",\n          \"VpcId\": \"vpc-xxxxxxxx\",\n          \"CidrBlock\": \"10.1.0.0/18\",\n          \"DhcpOptionsId\": \"dopt-xxxxxxxx\"\n        }\n      }\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nVPC_ID=vpc-xxxxxxxx\nCONF_RESOURCE_ID=${VPC_ID}\n```\n\n\n6.2. \u5c65\u6b74\u306e\u78ba\u8a8d\n---------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCONF_RESOURCE_TYPE='AWS::EC2::VPC'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice get-resource-config-history \\\n        --resource-type ${CONF_RESOURCE_TYPE} \\\n        --resource-id ${CONF_RESOURCE_ID}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n        \"configurationItems\": [\n          {\n              \"configurationItemCaptureTime\": 1432538711.476,\n              \"relationships\": [\n                  {\n                      \"resourceType\": \"AWS::EC2::NetworkAcl\",\n                      \"resourceId\": \"acl-xxxxxxxx\",\n                      \"relationshipName\": \"Contains NetworkAcl\"\n                  },\n                  {\n                      \"resourceType\": \"AWS::EC2::RouteTable\",\n                      \"resourceId\": \"rtb-xxxxxxxx\",\n                      \"relationshipName\": \"Contains RouteTable\"\n                  },\n                  {\n                      \"resourceType\": \"AWS::EC2::SecurityGroup\",\n                      \"resourceId\": \"sg-xxxxxxxx\",\n                      \"relationshipName\": \"Contains SecurityGroup\"\n                  }\n              ],\n              \"availabilityZone\": \"Multiple Availability Zones\",\n              \"tags\": {},\n              \"resourceType\": \"AWS::EC2::VPC\",\n              \"resourceId\": \"vpc-xxxxxxxx\",\n              \"configurationStateId\": \"1\",\n              \"relatedEvents\": [\n                  \"xxxxxxxx-xxxx-xxxx-xxxx-c83c9ba78b53\"\n              ],\n              \"arn\": \"arn:aws:ec2:ap-northeast-1:XXXXXXXXXXXX:vpc/vpc-xxxxxxxx\",\n              \"version\": \"1.0\",\n              \"configurationItemMD5Hash\": \"347d45e5c147842ec20f02309d66a4a2\",\n              \"configuration\": \"{\"vpcId\":\"vpc-xxxxxxxx\",\"state\":\"available\",\"cidrBlock\":\"10.1.0.0/18\",\"dhcpOptionsId\":\"dopt-xxxxxxxx\",\"tags\":[],\"instanceTenancy\":\"default\",\"isDefault\":false}\",\n              \"configurationItemStatus\": \"ResourceDiscovered\",\n              \"accountId\": \"XXXXXXXXXXXX\"\n          }\n        ],\n        \"nextToken\": \"eyJlbmNyeXB0ZWREYXRhIjpbMTEzLDU0LC0xMTMsMTIsLTUwLC0xMDcsNTcsOTYsLTkxLC03MywtMjEsOCwtNDAsNzQsOTAsMzUsLTIsODYsLTY1LDcxLC03LC05XSwzNCwyMSw5MywtMzIsLTk2LDgwLDQsODksLTMwLC05NCwtNjQsLTQsNDgsLTExMCw1Nyw5LC05Myw4MywzNCwxMjQsLTkwLDE0LDIwLC0xMDUsMTAzLC0xMjAsLTkxLC0xMjcsMTI0LC0xMjEsLTExMywtOTUsLTkyLC0yMiwxNCw4NiwtMzUsLTM5LDExNywtMTYsMTEsNjgsNjAsLTkxLDYsNzgsMTE2LC03MiwxMjIsMTA0LC0zNSw4MCwtNjAsLTUxLDE1LDI0LDExMSwtMTAsNjYsLTEyMSwtOTUsLTI3LC01OCwzMSw4OSwtMTksLTc2LC0zOSw3NiwtMjYsLTMzLDMyLC03MSwtNjMsLTExLC0yMCw3NCwxNCwtMzAsNjEsLTEyNywtMTUsNDEsNTgsLTIxLC00OSw1MCwtMzcsLTY1LC05LC0xMjgsLTc4LDExMSw0LC02OSw1OCwtNjMsMTE2LC02NywtOTMsMTA2LC0yNywxMjUsMTcsOTQsLTI5LC0yMSwtNywtMzQsLTM4LDM4LC0xMDAsLTYzLDY1LDEwLDgsLTc5LDEyNCw1LC02NCwtMzEsLTEwMCwyNiwtODAsLTExNiwtNTksNSwyMSw2MywzOCwtODUsMTI2LDYzLC04NCwtNCw1NCw1NywtMTA0LC00NCwtMTIzLDI0LDU4LC0zLDMyXSwibWF0ZXJpYWxTZXRTZXJpYWxOdW1iZXIiOjEsIml2UGFyYW1ldGVyU3BlYyI6eyJpdiI6WzUxLC0xMDIsMTA5LDQ4LDE3LC0xMjIsLTEyMiw5MiwtNTgsMTI0LC04MiwtODQsLTIxLC05MiwyLC00X119fQ==\"\n      }\n\n\n\n\n6.3. VPC\u306e\u524a\u9664\n--------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws ec2 delete-vpc --vpc-id ${VPC_ID}\n```\n\n\u7d50\u679c:\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n7. \u8a18\u9332\u306e\u505c\u6b62\u3001\u518d\u958b\n===================\n\n\n7.1. \u8a18\u9332\u306e\u505c\u6b62\n---------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n  CONF_RECORD_NAME: ${CONF_RECORD_NAME}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice stop-configuration-recorder \\\n        --configuration-recorder-name ${CONF_RECORD_NAME}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice get-status \n```\n\n\u7d50\u679c:\n\n      Configuration Recorders:\n\n      name: default\n      recorder: OFF\n\n      Delivery Channels:\n\n      name: default\n      last stream delivery status: SUCCESS\n      last snapshot delivery status: SUCCESS\n\n\n\n7.2. \u8a18\u9332\u306e\u518d\u958b\n---------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n  CONF_RECORD_NAME: ${CONF_RECORD_NAME}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice start-configuration-recorder \\\n        --configuration-recorder-name ${CONF_RECORD_NAME}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      (\u623b\u308a\u5024\u306a\u3057)\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice get-status \n```\n\n\u7d50\u679c:\n\n      Configuration Recorders:\n\n      name: default\n      recorder: ON\n      last status: SUCCESS\n\n      Delivery Channels:\n\n      name: default\n      last stream delivery status: SUCCESS\n\n\n8. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97\n=========================\n\n\n8.1. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\n---------------------------\n\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n  CONF_DELIVERY_CHANNEL: ${CONF_DELIVERY_CHANNEL}\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice deliver-config-snapshot \\\n        --delivery-channel-name ${CONF_DELIVERY_CHANNEL}\n```\n\n\u7d50\u679c(\u4f8b):\n\n      {\n          \"configSnapshotId\": \"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n      }\n\n\n8.2. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n---------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws configservice describe-delivery-channel-status \\\n        --query 'DeliveryChannelsStatus[].configSnapshotDeliveryInfo'\n```\n\n\u7d50\u679c:\n\n      [\n        {\n          \"lastSuccessfulTime\": 1432541300.012,\n          \"lastStatus\": \"SUCCESS\",\n          \"lastAttemptTime\": 1432541300.012\n        }\n      ]\n\n\n8.3. \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\n---------------------------\n\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n(\u4f8b)   s3://config-bucket-XXXXXXXXXXXX-ap-northeast-1/AWSLogs/XXXXXXXXXXXX/Config/ap-northeast-1/2015/5/25/ConfigSnapshot/XXXXXXXXXXXX-northeast-1_ConfigSnapshot_20150525T080818Z_ca395e18-ef27-40b2-839d-2cab2bcab226.json.gz\n\n\n\u5b8c\u4e86\n====\n\nAWS Config\u306f\u7121\u6599\u67a0\u304c\u7121\u3044\u306e\u3067\u3001\u30cf\u30f3\u30ba\u30aa\u30f3\u5b8c\u4e86\u5f8c\u306f\u8ab2\u91d1\u3092\u907f\u3051\u305f\u3044\u5834\u5408\u306f\u8a18\u9332\u3092\u505c\u6b62\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["AWS", "aws-cli", "aws-config"]}