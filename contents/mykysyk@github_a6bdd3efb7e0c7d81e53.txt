{"context": " More than 1 year has passed since last update.\n\n\u53c2\u8003\nRDO\nRDO:Neutron with existing external network\nOPENSTACK MANUALS:Configure network node\nOPENSTACK MANUALS:Configure compute node\nRed Hat Enterprise Linux OpenStack Platform : Editing a PackStack Answer File\n\n\u69cb\u7bc9\u74b0\u5883\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b5\u30fc\u30d0\u30fc\n\n\n\nOS\nIP\u30a2\u30c9\u30ec\u30b9\n\u30e1\u30e2\u30ea\nCPU\nNIC\n\n\n\n\nCentOS6.5\n192.168.1.41\n2GB\n2\n1\n\n\n\npublic\u7a7a\u9593(\u7269\u7406\u74b0\u5883)\n\n\n\n\u540d\u524d\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\n\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP(\u975eDHCP\u7a7a\u9593)\n\n\n\n\npublic\n192.168.1.0/24\n192.168.1.1\n192.168.1.42~49\n\n\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u7a7a\u9593(\u4eee\u60f3\u74b0\u5883)\n\n\n\n\u540d\u524d\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\n\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP(\u975eDHCP\u7a7a\u9593)\n\n\n\n\nprivate\n192.168.111.0/24\n192.168.111.1\n192.168.111.2~254\n\n\n\n\n\u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30fb\u6642\u523b\u3092\u5408\u308f\u305b\u308b\n\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u30fbRDO\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\u30fbopenstack-packstack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nshell\nyum install -y ntpdate && ntpdate ntp.nict.jp\n\nyum update  -y\n\nyum install -y http://rdo.fedorapeople.org/openstack-icehouse/rdo-release-icehouse.rpm\n\nyum install -y openstack-packstack\n\n\n\n\n\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u4fee\u6b63\n\nshell\nsed -i.org \\\n    -e \"s/^net.ipv4.ip_forward.*=.*0/net.ipv4.ip_forward = 1/\" \\\n    -e \"s/^net.ipv4.conf.all.rp_filter.*=.*1/net.ipv4.conf.all.rp_filter = 0/\" \\\n    -e \"s/^net.ipv4.conf.default.rp_filter.*=.*1/net.ipv4.conf.default.rp_filter = 0/\" \\\n    /etc/sysctl.conf\n\nsysctl -p\n\n\n\n\u30a2\u30f3\u30b5\u30fc\u30d5\u30a1\u30a4\u30eb\u751f\u6210\u3068\u7de8\u96c6\n\u30fb\u30a2\u30f3\u30b5\u30fc\u30d5\u30a1\u30a4\u30eb\u751f\u6210\n\n\nshell\npackstack --gen-answer-file answer.txt\n\n\n\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\n\n\nshell\nKEYSTONE_PASSWORD=password\n\nsed -i.org \\\n    -e \"s/^CONFIG_KEYSTONE_ADMIN_PW=.*/CONFIG_KEYSTONE_ADMIN_PW=${KEYSTONE_PASSWORD}/\" \\\n    -e \"s/^CONFIG_KEYSTONE_DEMO_PW=.*/CONFIG_KEYSTONE_DEMO_PW=${KEYSTONE_PASSWORD}/\" \\\n    answer.txt\n\n\n\n\u30fb\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092lo\u306b\u3059\u308b\n\n\nshell\nsed -i \\\n    -e \"s/^CONFIG_NOVA_NETWORK_PRIVIF=eth1/CONFIG_NOVA_NETWORK_PRIVIF=lo/\" \\\n    -e \"s/^CONFIG_NOVA_COMPUTE_PRIVIF=eth1/CONFIG_NOVA_COMPUTE_PRIVIF=lo/\" \\\n    answer.txt\n\n\n\n\u30fbCinder\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u30c7\u30a3\u30b9\u30af\u30b5\u30a4\u30ba\u306e\u5909\u66f4(\u4efb\u610f)\n\n\nshell\nVOLUMES_SIZE=50G\n\nsed -i \\\n    -e \"s/^CONFIG_CINDER_VOLUMES_SIZE=20G/CONFIG_CINDER_VOLUMES_SIZE=$VOLUMES_SIZE/\" \\\n    answer.txt\n\n\n\n\u30fbKeystone\u306e\u30c8\u30fc\u30af\u30f3\u30d5\u30a9\u30fc\u30de\u30c3\u30c8UUID\u306b\u5909\u66f4(\u4efb\u610f)\n\n\nshell\nsed -i \\\n    -e \"s/^CONFIG_KEYSTONE_TOKEN_FORMAT=PKI/CONFIG_KEYSTONE_TOKEN_FORMAT=UUID/\" \\\n    answer.txt\n\n\n\n\u30fbHeat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u4efb\u610f)\n\n\nshell\nsed -i \\\n    -e \"s/^CONFIG_HEAT_INSTALL=n/CONFIG_HEAT_INSTALL=y/\" \\\n    -e \"s/^CONFIG_HEAT_CLOUDWATCH_INSTALL=n/CONFIG_HEAT_CLOUDWATCH_INSTALL=y/\" \\\n    -e \"s/^CONFIG_HEAT_CFN_INSTALL=n/CONFIG_HEAT_CFN_INSTALL=y/\" \\\n    answer.txt\n\n\n\n\u30fb\u30c7\u30e2\u306f\u3044\u3089\u306a\u3044(\u4efb\u610f)\n\n\nshell\nsed -i \\\n    -e \"s/^CONFIG_PROVISION_DEMO=y/CONFIG_PROVISION_DEMO=n/\" \\\n    answer.txt\n\n\n\n\u30fbNagios\u306f\u3044\u3089\u306a\u3044(\u4efb\u610f)\n\n\nshell\nsed -i \\\n    -e \"s/^CONFIG_NAGIOS_INSTALL=y/CONFIG_NAGIOS_INSTALL=n/\" \\\n    answer.txt\n\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\n\nshell\npackstack --answer-file answer.txt\n\n\n\nNeutron\u8a2d\u5b9a\u8ffd\u52a0\n\nshell\nvi /etc/neutron/plugin.ini\n\n\n\u30fb/etc/neutron/plugin.ini \u6700\u7d42\u884c\u306b\u8ffd\u8a18\n\n\n/etc/neutron/plugin.ini\n[ovs]\nnetwork_vlan_ranges = physnet1\nbridge_mappings = physnet1:br-ex\n\n\n\n\nlibvirt_type\u8a2d\u5b9a\n\nshell\nvi /etc/nova/nova.conf\n\n\n\u30fblibvirt_type \u306b kvm\u3082\u3057\u304f\u306fqemu \u3092\u6307\u5b9a\n\n\n/etc/nova/nova.conf\n[libvirt]\nvirt_type=qemu\n\n\n\n\nNIC\u306e\u8a2d\u5b9a\u5909\u66f4\n\u30fbeth0 \u7de8\u96c6\n\n\nshell\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n\n\n\n\n/etc/sysconfig/network-scripts/ifcfg-eth0\nDEVICE=eth0\nTYPE=OVSPort\nDEVICETYPE=ovs\nOVS_BRIDGE=br-ex\nONBOOT=yes\n\n\n\n\n\u30fbbr-ex \u7de8\u96c6\n\n\nshell\nvi /etc/sysconfig/network-scripts/ifcfg-br-ex\n\n\n\n\n/etc/sysconfig/network-scripts/ifcfg-br-ex\nDEVICE=br-ex\nDEVICETYPE=ovs\nTYPE=OVSBridge\nBOOTPROTO=static\nIPADDR=192.168.1.41\nNETMASK=255.255.255.0\nGATEWAY=192.168.1.1\nDNS1=192.168.1.1\nONBOOT=yes\n\n\n\n\n\n\u518d\u8d77\u52d5\n\nshell\nreboot\n\n\n\n\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u7bc9\n\nshell\nsource /root/keystonerc_admin\n\n\n\u30fbpublic\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\n\n\nshell\nneutron net-create public \\\n    --router:external true\n\nneutron subnet-create \\\n    --name public_subnet \\\n    --enable_dhcp=False \\\n    --allocation-pool=start=192.168.1.42,end=192.168.1.49 \\\n    --gateway=192.168.1.1 \\\n    public \\\n    192.168.1.0/24\n\n\n\n\u30fbpvivate\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\n\n\nshell\nneutron net-create private \\\n    --shared\n\nneutron subnet-create \\\n    --name private_subnet \\\n    --enable_dhcp=True \\\n    --allocation-pool=start=192.168.111.2,end=192.168.111.254 \\\n    --gateway=192.168.111.1 \\\n    private \\\n    192.168.111.0/24\n\n\n\n\u30fb\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\u4f5c\u6210\n\n\nshell\nneutron router-create router1\n\nneutron router-gateway-set router1 public\n\nneutron router-interface-add router1 private_subnet\n\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8 \u30d5\u30ec\u30fc\u30d0\u30fc\u306e\u4fee\u6b63\n\u30fb\u73fe\u5728\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u78ba\u8a8d\n\u30fb1\u756a\u76ee\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u524a\u9664\n\u30fb1\u756a\u76ee\u306b\u65b0\u3057\u3044\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\n\u30fb\u30d5\u30ec\u30fc\u30d0\u30fc\u78ba\u8a8d\n\n\nshell\nnova flavor-list\n\nnova flavor-delete 1\n\nnova flavor-create m1.tiny 1 512 10 1\n\nnova flavor-list\n\n\n\nflavor-create\u306e\u5404\u5024\u306b\u3064\u3044\u3066\n# nova flavor-create \\\n       FLAVOR_NAME \\\n       FLAVOR_ID \\\n       RAM_IN_MB \\\n       ROOT_DISK_IN_GB \\\n       NUMBER_OF_VCPUS\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4fee\u6b63\n\n\u30fbPING\u8a31\u53ef\n\n\nshell\nneutron security-group-rule-create \\\n    --protocol icmp \\\n    --direction ingress default\n\nnova secgroup-add-rule default icmp -1 -1 0.0.0.0/0\n\n\n\n\u30fbSSH\u8a31\u53ef\n\n\nshell\nneutron security-group-rule-create \\\n    --protocol tcp --port-range-min 22 \\\n    --port-range-max 22 \\\n    --direction ingress default\n\nnova secgroup-add-rule default tcp 22 22 0.0.0.0/0\n\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nshell\nyum install -y qemu-img virt-install\n\n\n\n\u30fbqcow2\u5f62\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u30c7\u30a3\u30b9\u30af\u4f5c\u6210\n\n\nshell\nIMAGE_NAME=CentOS6.5\n\nqemu-img create -f qcow2 /var/lib/libvirt/images/$IMAGE_NAME.qcow2 10G\n\n\n\n\u30fbCentOS\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\n\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30eaURL\u6307\u5b9a\n\u30fbKVM\u4e0a\u3067\u306e\u540d\u524d\u3092\u6307\u5b9a\n\u30fbvirt-install\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nshell\nREPOS=http://ftp.riken.jp/Linux/centos/6/os/x86_64/\n\nIMAGE_NAME=CentOS6.5\n\nvirt-install \\\n    --name $IMAGE_NAME \\\n    --ram 512 \\\n    --disk path=/var/lib/libvirt/images/$IMAGE_NAME.qcow2,format=qcow2 \\\n    --vcpus=1 \\\n    --os-type linux \\\n    --os-variant=rhel6 \\\n    --nographics \\\n    --location=\"$REPOS\" \\\n    --extra-args='console=tty0 console=ttyS0,115200n8 serial'\n\n\n\u30fbCentOS\u30a4\u30e1\u30fc\u30b8\u5185\u3067\n\n\nshell\nrm /etc/udev/rules.d/70-persistent-net.rules\n\nln -s /dev/null /etc/udev/rules.d/70-persistent-net.rules\n\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n\n\n\n\n/etc/sysconfig/network-scripts/ifcfg-eth0\nDEVICE=eth0\nONBOOT=yes\nTYPE=Ethernet\nBOOTPROTO=dhcp\n\n\n\n\n\n\u30fb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u5727\u7e2e\n\n\nshell\nIMAGE_NAME=CentOS6.5\n\nqemu-img convert -c -O qcow2 \\\n    /var/lib/libvirt/images/$IMAGE_NAME.qcow2 \\\n    /var/lib/libvirt/images/$IMAGE_NAME.new.qcow2\n\nrm /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n\nmv /var/lib/libvirt/images/$IMAGE_NAME.new.qcow2 \\\n   /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u767b\u9332\n\nshell\nIMAGE_NAME=CentOS6.5\n\nglance image-create \\\n    --name=$IMAGE_NAME \\\n    --is-public=true \\\n    --disk-format=qcow2 \\\n    --container-format=bare < /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n\n\n\n\u30ad\u30fc\u30da\u30a2\u4f5c\u6210\n\nshell\ncd && nova keypair-add mykey > mykey && chmod 600 mykey\n\nnova keypair-list\n\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\nshell\nIMAGE_NAME=CentOS6.5\n\nINSTANCE_NAME=CentOS6.5-test\n\nPRIVATE_NET_ID=`neutron net-list | awk '$4==\"private\"{print $2}'`\n\nnova boot \\\n    --flavor 1 \\\n    --image $IMAGE_NAME \\\n    --security_group default \\\n    --nic net-id=$PRIVATE_NET_ID \\\n    --key-name mykey \\\n    $INSTANCE_NAME\n\n\n\n\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306e\u4ed8\u4e0e\n\u30fb\u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30d0\u30a4\u30b9ID\u3092\u53d6\u5f97\u3059\u308b\n\n\nshell\nINSTANCE_NAME=CentOS6.5-test\n\nDEVICE_ID=`nova list | awk -v INSTANCE_NAME=$INSTANCE_NAME '$4==INSTANCE_NAME{print $2}'`\n\necho $DEVICE_ID\n\n\n\n\u30fb\u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30dd\u30fc\u30c8ID\u3092\u53d6\u5f97\u3059\u308b\n\n\nshell\nPORT_ID=`neutron port-list --device_id=$DEVICE_ID | awk '/ip_address/{print $2}'`\n\necho $PORT_ID\n\n\n\n\u30fb\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306e\u5272\u51fa\u3068\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306eID\u3092\u53d6\u5f97\u3059\u308b\n\n\nshell\nFLOATINGIP_ID=`neutron floatingip-create public | awk '$2~/^id$/{print $4}'`\n\necho $FLOATINGIP_ID\n\n\n\n\u30fb\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u3092\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u308b\n\n\nshell\nneutron floatingip-associate $FLOATINGIP_ID $PORT_ID\n\n\n\n\u30fb\u78ba\u8a8d\n\n\nshell\nnova list --name $INSTANCE_NAME\nneutron floatingip-list --id $FLOATINGIP_ID | awk '{print $6}'\n\n\n\n\n\u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bssh\u63a5\u7d9a\u3059\u308b\n\nshell\nssh -i mykey root@floating_ip_address\n\n\n## \u53c2\u8003\n[RDO]\n(https://openstack.redhat.com/Main_Page)\n[RDO:Neutron with existing external network]\n(https://openstack.redhat.com/Neutron_with_existing_external_network)\n[OPENSTACK MANUALS:Configure network node]\n(http://docs.openstack.org/icehouse/install-guide/install/yum/content/neutron-ml2-network-node.html)\n[OPENSTACK MANUALS:Configure compute node]\n(http://docs.openstack.org/icehouse/install-guide/install/yum/content/neutron-ml2-compute-node.html)\n[Red Hat Enterprise Linux OpenStack Platform : Editing a PackStack Answer File]\n(https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux_OpenStack_Platform/2/html/Getting_Started_Guide/ch06s03s02.html)\n\n## \u69cb\u7bc9\u74b0\u5883\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30b5\u30fc\u30d0\u30fc\n\n| OS        | IP\u30a2\u30c9\u30ec\u30b9   |\u30e1\u30e2\u30ea|CPU|NIC|\n|:--        |:--          | --:| --:| --:|\n| CentOS6.5 |192.168.1.41 | 2GB |  2|   1|\n\npublic\u7a7a\u9593(\u7269\u7406\u74b0\u5883)\n\n| \u540d\u524d | \u30cd\u30c3\u30c8\u30ef\u30fc\u30af        | \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4   |\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP(\u975eDHCP\u7a7a\u9593)|\n|:--   |:--                |:--            |:--                |\n| public  |192.168.1.0/24  | 192.168.1.1   | 192.168.1.42~49   |\n\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u7a7a\u9593(\u4eee\u60f3\u74b0\u5883)\n\n| \u540d\u524d | \u30cd\u30c3\u30c8\u30ef\u30fc\u30af        | \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4   |\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP(\u975eDHCP\u7a7a\u9593)|\n|:--   |:--                |:--            |:--                |\n| private |192.168.111.0/24| 192.168.111.1 | 192.168.111.2~254 |\n\n## \u5fc5\u8981\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30fb\u6642\u523b\u3092\u5408\u308f\u305b\u308b\n\u30fb\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u30fbRDO\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n\u30fbopenstack-packstack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n>\n```shell-session:shell\nyum install -y ntpdate && ntpdate ntp.nict.jp\n>\nyum update  -y\n>\nyum install -y http://rdo.fedorapeople.org/openstack-icehouse/rdo-release-icehouse.rpm\n>\nyum install -y openstack-packstack\n```\n\n## \u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u4fee\u6b63\n```shell:shell\nsed -i.org \\\n    -e \"s/^net.ipv4.ip_forward.*=.*0/net.ipv4.ip_forward = 1/\" \\\n    -e \"s/^net.ipv4.conf.all.rp_filter.*=.*1/net.ipv4.conf.all.rp_filter = 0/\" \\\n    -e \"s/^net.ipv4.conf.default.rp_filter.*=.*1/net.ipv4.conf.default.rp_filter = 0/\" \\\n    /etc/sysctl.conf\n\nsysctl -p\n```\n\n## \u30a2\u30f3\u30b5\u30fc\u30d5\u30a1\u30a4\u30eb\u751f\u6210\u3068\u7de8\u96c6\n\n\u30fb\u30a2\u30f3\u30b5\u30fc\u30d5\u30a1\u30a4\u30eb\u751f\u6210\n>\n```shell:shell\npackstack --gen-answer-file answer.txt\n```\n>\n\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\n>>\n```shell:shell\nKEYSTONE_PASSWORD=password\n>>\nsed -i.org \\\n    -e \"s/^CONFIG_KEYSTONE_ADMIN_PW=.*/CONFIG_KEYSTONE_ADMIN_PW=${KEYSTONE_PASSWORD}/\" \\\n    -e \"s/^CONFIG_KEYSTONE_DEMO_PW=.*/CONFIG_KEYSTONE_DEMO_PW=${KEYSTONE_PASSWORD}/\" \\\n    answer.txt\n```\n>\n\u30fb\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092lo\u306b\u3059\u308b\n>>\n```shell:shell\nsed -i \\\n    -e \"s/^CONFIG_NOVA_NETWORK_PRIVIF=eth1/CONFIG_NOVA_NETWORK_PRIVIF=lo/\" \\\n    -e \"s/^CONFIG_NOVA_COMPUTE_PRIVIF=eth1/CONFIG_NOVA_COMPUTE_PRIVIF=lo/\" \\\n    answer.txt\n```\n\n>\n\u30fbCinder\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u30c7\u30a3\u30b9\u30af\u30b5\u30a4\u30ba\u306e\u5909\u66f4(\u4efb\u610f)\n>>\n```shell:shell\nVOLUMES_SIZE=50G\n>>\nsed -i \\\n    -e \"s/^CONFIG_CINDER_VOLUMES_SIZE=20G/CONFIG_CINDER_VOLUMES_SIZE=$VOLUMES_SIZE/\" \\\n    answer.txt\n```\n>\n\u30fbKeystone\u306e\u30c8\u30fc\u30af\u30f3\u30d5\u30a9\u30fc\u30de\u30c3\u30c8UUID\u306b\u5909\u66f4(\u4efb\u610f)\n>>\n```shell:shell\nsed -i \\\n    -e \"s/^CONFIG_KEYSTONE_TOKEN_FORMAT=PKI/CONFIG_KEYSTONE_TOKEN_FORMAT=UUID/\" \\\n    answer.txt\n```\n>\n\u30fbHeat\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(\u4efb\u610f)\n>>\n```shell:shell\nsed -i \\\n    -e \"s/^CONFIG_HEAT_INSTALL=n/CONFIG_HEAT_INSTALL=y/\" \\\n    -e \"s/^CONFIG_HEAT_CLOUDWATCH_INSTALL=n/CONFIG_HEAT_CLOUDWATCH_INSTALL=y/\" \\\n    -e \"s/^CONFIG_HEAT_CFN_INSTALL=n/CONFIG_HEAT_CFN_INSTALL=y/\" \\\n    answer.txt\n```\n>\n\u30fb\u30c7\u30e2\u306f\u3044\u3089\u306a\u3044(\u4efb\u610f)\n>>\n```shell:shell\nsed -i \\\n    -e \"s/^CONFIG_PROVISION_DEMO=y/CONFIG_PROVISION_DEMO=n/\" \\\n    answer.txt\n```\n>\n\u30fbNagios\u306f\u3044\u3089\u306a\u3044(\u4efb\u610f)\n>>\n```shell:shell\nsed -i \\\n    -e \"s/^CONFIG_NAGIOS_INSTALL=y/CONFIG_NAGIOS_INSTALL=n/\" \\\n    answer.txt\n```\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\n\n```shell:shell\npackstack --answer-file answer.txt\n```\n\n## Neutron\u8a2d\u5b9a\u8ffd\u52a0\n\n\n```shell:shell\nvi /etc/neutron/plugin.ini\n```\n\n\u30fb/etc/neutron/plugin.ini \u6700\u7d42\u884c\u306b\u8ffd\u8a18\n>\n```ini:/etc/neutron/plugin.ini\n[ovs]\nnetwork_vlan_ranges = physnet1\nbridge_mappings = physnet1:br-ex\n```\n\n## libvirt_type\u8a2d\u5b9a\n\n```shell:shell\nvi /etc/nova/nova.conf\n```\n\u30fblibvirt_type \u306b kvm\u3082\u3057\u304f\u306fqemu \u3092\u6307\u5b9a\n>\n```ini:/etc/nova/nova.conf\n[libvirt]\nvirt_type=qemu\n```\n\n## NIC\u306e\u8a2d\u5b9a\u5909\u66f4\n\u30fbeth0 \u7de8\u96c6\n>\n```shell:shell\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n```\n>>\n```ini:/etc/sysconfig/network-scripts/ifcfg-eth0\nDEVICE=eth0\nTYPE=OVSPort\nDEVICETYPE=ovs\nOVS_BRIDGE=br-ex\nONBOOT=yes\n```\n\n\u30fbbr-ex \u7de8\u96c6\n>\n```shell:shell\nvi /etc/sysconfig/network-scripts/ifcfg-br-ex\n```\n>>\n```ini:/etc/sysconfig/network-scripts/ifcfg-br-ex\nDEVICE=br-ex\nDEVICETYPE=ovs\nTYPE=OVSBridge\nBOOTPROTO=static\nIPADDR=192.168.1.41\nNETMASK=255.255.255.0\nGATEWAY=192.168.1.1\nDNS1=192.168.1.1\nONBOOT=yes\n```\n\n## \u518d\u8d77\u52d5\n\n```shell:shell\nreboot\n```\n\n## \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u7bc9\n\n```shell:shell\nsource /root/keystonerc_admin\n```\n\n\u30fbpublic\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\n>\n```shell:shell\nneutron net-create public \\\n    --router:external true\n>\nneutron subnet-create \\\n    --name public_subnet \\\n    --enable_dhcp=False \\\n    --allocation-pool=start=192.168.1.42,end=192.168.1.49 \\\n    --gateway=192.168.1.1 \\\n    public \\\n    192.168.1.0/24\n```\n\n\u30fbpvivate\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\n>\n```shell:shell\nneutron net-create private \\\n    --shared\n>\nneutron subnet-create \\\n    --name private_subnet \\\n    --enable_dhcp=True \\\n    --allocation-pool=start=192.168.111.2,end=192.168.111.254 \\\n    --gateway=192.168.111.1 \\\n    private \\\n    192.168.111.0/24\n```\n\n\u30fb\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\u4f5c\u6210\n>\n```shell:shell\nneutron router-create router1\n>\nneutron router-gateway-set router1 public\n>\nneutron router-interface-add router1 private_subnet\n```\n\n## \u30c7\u30d5\u30a9\u30eb\u30c8 \u30d5\u30ec\u30fc\u30d0\u30fc\u306e\u4fee\u6b63\n\u30fb\u73fe\u5728\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u78ba\u8a8d\n\u30fb1\u756a\u76ee\u306e\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u524a\u9664\n\u30fb1\u756a\u76ee\u306b\u65b0\u3057\u3044\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\n\u30fb\u30d5\u30ec\u30fc\u30d0\u30fc\u78ba\u8a8d\n>\n```shell:shell\nnova flavor-list\n>\nnova flavor-delete 1\n>\nnova flavor-create m1.tiny 1 512 10 1\n>\nnova flavor-list\n```\n>\n```text:flavor-create\u306e\u5404\u5024\u306b\u3064\u3044\u3066\n# nova flavor-create \\\n       FLAVOR_NAME \\\n       FLAVOR_ID \\\n       RAM_IN_MB \\\n       ROOT_DISK_IN_GB \\\n       NUMBER_OF_VCPUS\n```\n> \n## \u30c7\u30d5\u30a9\u30eb\u30c8 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4fee\u6b63\n\n\u30fbPING\u8a31\u53ef\n>\n```shell:shell\nneutron security-group-rule-create \\\n    --protocol icmp \\\n    --direction ingress default\n>\nnova secgroup-add-rule default icmp -1 -1 0.0.0.0/0\n```\n\n\u30fbSSH\u8a31\u53ef\n>\n```shell:shell\nneutron security-group-rule-create \\\n    --protocol tcp --port-range-min 22 \\\n    --port-range-max 22 \\\n    --direction ingress default\n>\nnova secgroup-add-rule default tcp 22 22 0.0.0.0/0\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n>\n```shell:shell\nyum install -y qemu-img virt-install\n```\n\n\u30fbqcow2\u5f62\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u30c7\u30a3\u30b9\u30af\u4f5c\u6210\n>\n```shell:shell\nIMAGE_NAME=CentOS6.5\n>\nqemu-img create -f qcow2 /var/lib/libvirt/images/$IMAGE_NAME.qcow2 10G\n```\n\n\u30fbCentOS\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\n>\n\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ea\u30dd\u30b8\u30c8\u30eaURL\u6307\u5b9a\n\u30fbKVM\u4e0a\u3067\u306e\u540d\u524d\u3092\u6307\u5b9a\n\u30fbvirt-install\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n>\n```shell:shell\nREPOS=http://ftp.riken.jp/Linux/centos/6/os/x86_64/\n>\nIMAGE_NAME=CentOS6.5\n>\nvirt-install \\\n    --name $IMAGE_NAME \\\n    --ram 512 \\\n    --disk path=/var/lib/libvirt/images/$IMAGE_NAME.qcow2,format=qcow2 \\\n    --vcpus=1 \\\n    --os-type linux \\\n    --os-variant=rhel6 \\\n    --nographics \\\n    --location=\"$REPOS\" \\\n    --extra-args='console=tty0 console=ttyS0,115200n8 serial'\n```\n>\n\u30fbCentOS\u30a4\u30e1\u30fc\u30b8\u5185\u3067\n>>\n```shell:shell\nrm /etc/udev/rules.d/70-persistent-net.rules\n>>\nln -s /dev/null /etc/udev/rules.d/70-persistent-net.rules\n>>\nvi /etc/sysconfig/network-scripts/ifcfg-eth0\n```\n>>>\n```ini:/etc/sysconfig/network-scripts/ifcfg-eth0\nDEVICE=eth0\nONBOOT=yes\nTYPE=Ethernet\nBOOTPROTO=dhcp\n```\n\n\u30fb\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u5727\u7e2e\n>\n```shell:shell\nIMAGE_NAME=CentOS6.5\n> \nqemu-img convert -c -O qcow2 \\\n    /var/lib/libvirt/images/$IMAGE_NAME.qcow2 \\\n    /var/lib/libvirt/images/$IMAGE_NAME.new.qcow2\n> \nrm /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n> \nmv /var/lib/libvirt/images/$IMAGE_NAME.new.qcow2 \\\n   /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u30a4\u30e1\u30fc\u30b8\u767b\u9332\n\n```shell:shell\nIMAGE_NAME=CentOS6.5\n\nglance image-create \\\n    --name=$IMAGE_NAME \\\n    --is-public=true \\\n    --disk-format=qcow2 \\\n    --container-format=bare < /var/lib/libvirt/images/$IMAGE_NAME.qcow2\n```\n\n## \u30ad\u30fc\u30da\u30a2\u4f5c\u6210\n\n```shell:shell\ncd && nova keypair-add mykey > mykey && chmod 600 mykey\n\nnova keypair-list\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\n```shell:shell\nIMAGE_NAME=CentOS6.5\n\nINSTANCE_NAME=CentOS6.5-test\n\nPRIVATE_NET_ID=`neutron net-list | awk '$4==\"private\"{print $2}'`\n\nnova boot \\\n    --flavor 1 \\\n    --image $IMAGE_NAME \\\n    --security_group default \\\n    --nic net-id=$PRIVATE_NET_ID \\\n    --key-name mykey \\\n    $INSTANCE_NAME\n```\n\n## \u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306e\u4ed8\u4e0e\n\n\u30fb\u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30d0\u30a4\u30b9ID\u3092\u53d6\u5f97\u3059\u308b\n>\n```shell:shell\nINSTANCE_NAME=CentOS6.5-test\n>\nDEVICE_ID=`nova list | awk -v INSTANCE_NAME=$INSTANCE_NAME '$4==INSTANCE_NAME{print $2}'`\n>\necho $DEVICE_ID\n```\n\n\u30fb\u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30dd\u30fc\u30c8ID\u3092\u53d6\u5f97\u3059\u308b\n>\n```shell:shell\nPORT_ID=`neutron port-list --device_id=$DEVICE_ID | awk '/ip_address/{print $2}'`\n>\necho $PORT_ID\n```\n\n\u30fb\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306e\u5272\u51fa\u3068\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u306eID\u3092\u53d6\u5f97\u3059\u308b\n>\n```shell:shell\nFLOATINGIP_ID=`neutron floatingip-create public | awk '$2~/^id$/{print $4}'`\n>\necho $FLOATINGIP_ID\n```\n\n\u30fb\u30d5\u30ed\u30fc\u30c6\u30a3\u30f3\u30b0IP\u3092\u30b5\u30d6\u30cd\u30c3\u30c8\u306b\u5272\u308a\u5f53\u3066\u308b\n>\n```shell:shell\nneutron floatingip-associate $FLOATINGIP_ID $PORT_ID\n```\n\n\u30fb\u78ba\u8a8d\n>\n```shell:shell\nnova list --name $INSTANCE_NAME\nneutron floatingip-list --id $FLOATINGIP_ID | awk '{print $6}'\n```\n\n## \u4f5c\u6210\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bssh\u63a5\u7d9a\u3059\u308b\n\n```shell:shell\nssh -i mykey root@floating_ip_address\n```\n\n", "tags": ["openstackIcehouse", "CentOS6.5"]}