{"context": "wowza\u306e\u30ed\u30b0\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5834\u5408\u306e\u60f3\u5b9a\u3067\u3059\u3002\n\nlog4j.properties\n# Access appender\nlog4j.appender.serverAccess.layout.Fields=date,time,tz,x-event,x-category,x-severity,x-status,x-ctx,x-comment,x-vhost,x-app,x-appinst,x-duration,s-ip,s-port,s-uri,c-ip,c-proto,c-referrer,c-user-agent,c-client-id,cs-bytes,sc-bytes,x-stream-id,x-spos,cs-stream-bytes,sc-stream-bytes,x-sname,x-sname-query,x-file-name,x-file-ext,x-file-size,x-file-length,x-suri,x-suri-stem,x-suri-query,cs-uri-stem,cs-uri-query\n\n# Error appender\nlog4j.appender.serverError.layout.Fields=x-severity,x-category,x-event;date,time,c-client-id,c-ip,c-port,cs-bytes,sc-bytes,x-duration,x-sname,x-stream-id,x-spos,sc-stream-bytes,cs-stream-bytes,x-file-size,x-file-length,x-ctx,x-comment\n\n\n\nconfig\u4f8b\nembulk\u3067\u6d41\u3057\u8fbc\u3080\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\u30ad\u30e2\u306f\u3001\u65e5\u6642\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u4f5c\u6210\u90e8\u5206\u3067\u3059\u3002\nwowza\u306e\u30ed\u30b0\u306f\u3001\u65e5\u4ed8\u3068\u6642\u523b\u3092\u5225\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u51fa\u529b\u3059\u308b\u305f\u3081\u3001\n\u305d\u308c\u3092\u7d50\u5408\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306b\n\nembulk-filter-column\nembulk-filter-ruby_proc\n\n\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u203b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4e0b\u8a18\u3068\u306a\u308a\u307e\u3059\u3002\n embulk gem install embulk-filter-column embulk-filter-ruby_proc\n\n\n\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\n\nembulk-config.yml\nin:\n  type: file\n  path_prefix: /path/to/wowza-access-log.txt\n  parser:\n    charset: UTF-8\n    newline: LF\n    type: csv\n    delimiter: \"\\t\"\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 0\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: date        , type: string}\n    - {name: time        , type: string}\n    - {name: tz          , type: string}\n    - {name: x-event     , type: string}\n    - {name: x-category  , type: string}\n    - {name: x-severity  , type: string}\n    - {name: x-status    , type: long}\n    - {name: x-ctx       , type: string}\n    - {name: x-comment   , type: string}\n    - {name: x-vhost     , type: string}\n    - {name: x-app       , type: string}\n    - {name: x-appinst   , type: string}\n    - {name: x-duration  , type: string}\n    - {name: s-ip        , type: string}\n    - {name: s-port      , type: string}\n    - {name: s-uri       , type: string}\n    - {name: c-ip        , type: string}\n    - {name: c-proto     , type: string}\n    - {name: c-referer   , type: string}\n    - {name: c-user-agent, type: string}\n    - {name: client-id   , type: string}\n    - {name: cs-bytes    , type: string}\n    - {name: sc-bytes    , type: string}\n    - {name: x-stream-id , type: string}\n    - {name: x-spos          , type: string}\n    - {name: cs-stream-bytes , type: string}\n    - {name: sc-stream-bytes , type: string}\n    - {name: x-sname         , type: string}\n    - {name: x-sname-query   , type: string}\n    - {name: x-file-name     , type: string}\n    - {name: x-file-ext      , type: string}\n    - {name: x-file-size     , type: string}\n    - {name: x-file-length   , type: string}\n    - {name: x-suri          , type: string}\n    - {name: x-suri-stem     , type: string}\n    - {name: x-suri-queri    , type: string}\n    - {name: cs-uri-stem     , type: string}\n    - {name: cs-uri-query    , type: string}\n\nfilters:\n  - type: column\n    add_columns:\n    - {name : datetime, type: timestamp, default: \"1970-01-01\", format: \"%Y-%m-%d\"}\n  - type: ruby_proc\n    before:\n      - proc: |\n          -> do\n            require \"time\"\n          end\n    rows:\n      - proc: |\n          ->(record) do\n            record.tap do |r|\n              r[\"datetime\"] = Time.iso8601(r[\"date\"] + \"T\" + r[\"time\"] + \"+09:00\")\n            end\n          end\n\n  - type: column\n    drop_columns:\n    - {name : date}\n    - {name : time}\n\nout:\n  type: elasticsearch_ruby\n  mode: normal\n  nodes:\n  - {host: localhost, port: 9200}\n  index: logstash-wowza\n  index_type: wow\n\n\n\n\u30a8\u30e9\u30fc\u30ed\u30b0\n\nembulk-config-error.yml\nin:\n  type: file\n  path_prefix: /path/to/wowza-error-log.txt\n  parser:\n    charset: UTF-8\n    newline: LF\n    type: csv\n    delimiter: \"\\t\"\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 0\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name:  x-severity      , type: string}\n    - {name:  x-category      , type: string}\n    - {name:  x-event         , type: string}\n    - {name:  date            , type: string}\n    - {name:  time            , type: string}\n    - {name:  c-client-id     , type: string}\n    - {name:  c-ip            , type: string}\n    - {name:  c-port          , type: string}\n    - {name:  cs-bytes        , type: string}\n    - {name:  sc-bytes        , type: string}\n    - {name:  x-duration      , type: string}\n    - {name:  x-sname         , type: string}\n    - {name:  x-stream-id     , type: string}\n    - {name:  x-spos          , type: string}\n    - {name:  sc-stream-bytes , type: string}\n    - {name:  cs-stream-bytes , type: string}\n    - {name:  x-file-size     , type: string}\n    - {name:  x-file-length   , type: string}\n    - {name:  x-ctx           , type: string}\n    - {name:  x-comment       , type: string}\n\nfilters:\n  - type: column\n    add_columns:\n    - {name : datetime, type: timestamp, default: \"1970-01-01\", format: \"%Y-%m-%d\"}\n  - type: ruby_proc\n    before:\n      - proc: |\n          -> do\n            require \"time\"\n          end\n    rows:\n      - proc: |\n          ->(record) do\n            record.tap do |r|\n              r[\"datetime\"] = Time.iso8601(r[\"date\"] + \"T\" + r[\"time\"] + \"+09:00\")\n            end\n          end\n\n  - type: column\n    drop_columns:\n    - {name : date}\n    - {name : time}\n\nout:\n  type: elasticsearch_ruby\n  mode: normal\n  nodes:\n  - {host: localhost, port: 9200}\n  index: logstash-wowza-error-test\n  index_type: wow\n\n\n\nwowza\u306e\u30ed\u30b0\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u3001[\u30c7\u30d5\u30a9\u30eb\u30c8](https://github.com/awead/WowzaMediaServer/blob/master/conf/log4j.properties)\u306e\u5834\u5408\u306e\u60f3\u5b9a\u3067\u3059\u3002\n\n```bash:log4j.properties\n# Access appender\nlog4j.appender.serverAccess.layout.Fields=date,time,tz,x-event,x-category,x-severity,x-status,x-ctx,x-comment,x-vhost,x-app,x-appinst,x-duration,s-ip,s-port,s-uri,c-ip,c-proto,c-referrer,c-user-agent,c-client-id,cs-bytes,sc-bytes,x-stream-id,x-spos,cs-stream-bytes,sc-stream-bytes,x-sname,x-sname-query,x-file-name,x-file-ext,x-file-size,x-file-length,x-suri,x-suri-stem,x-suri-query,cs-uri-stem,cs-uri-query\n\n# Error appender\nlog4j.appender.serverError.layout.Fields=x-severity,x-category,x-event;date,time,c-client-id,c-ip,c-port,cs-bytes,sc-bytes,x-duration,x-sname,x-stream-id,x-spos,sc-stream-bytes,cs-stream-bytes,x-file-size,x-file-length,x-ctx,x-comment\n```\n\nconfig\u4f8b\n====\n\nembulk\u3067\u6d41\u3057\u8fbc\u3080\u30b3\u30f3\u30d5\u30a3\u30b0\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\u30ad\u30e2\u306f\u3001\u65e5\u6642\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u4f5c\u6210\u90e8\u5206\u3067\u3059\u3002\nwowza\u306e\u30ed\u30b0\u306f\u3001\u65e5\u4ed8\u3068\u6642\u523b\u3092\u5225\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u51fa\u529b\u3059\u308b\u305f\u3081\u3001\n\u305d\u308c\u3092\u7d50\u5408\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u305d\u306e\u305f\u3081\u306b\n\n* [embulk-filter-column](https://github.com/sonots/embulk-filter-column)\n* [embulk-filter-ruby_proc](https://github.com/joker1007/embulk-filter-ruby_proc)\n\n\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u203b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4e0b\u8a18\u3068\u306a\u308a\u307e\u3059\u3002\n\n```\n embulk gem install embulk-filter-column embulk-filter-ruby_proc\n```\n\n#### \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\n\n```yaml:embulk-config.yml\nin:\n  type: file\n  path_prefix: /path/to/wowza-access-log.txt\n  parser:\n    charset: UTF-8\n    newline: LF\n    type: csv\n    delimiter: \"\\t\"\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 0\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name: date        , type: string}\n    - {name: time        , type: string}\n    - {name: tz          , type: string}\n    - {name: x-event     , type: string}\n    - {name: x-category  , type: string}\n    - {name: x-severity  , type: string}\n    - {name: x-status    , type: long}\n    - {name: x-ctx       , type: string}\n    - {name: x-comment   , type: string}\n    - {name: x-vhost     , type: string}\n    - {name: x-app       , type: string}\n    - {name: x-appinst   , type: string}\n    - {name: x-duration  , type: string}\n    - {name: s-ip        , type: string}\n    - {name: s-port      , type: string}\n    - {name: s-uri       , type: string}\n    - {name: c-ip        , type: string}\n    - {name: c-proto     , type: string}\n    - {name: c-referer   , type: string}\n    - {name: c-user-agent, type: string}\n    - {name: client-id   , type: string}\n    - {name: cs-bytes    , type: string}\n    - {name: sc-bytes    , type: string}\n    - {name: x-stream-id , type: string}\n    - {name: x-spos          , type: string}\n    - {name: cs-stream-bytes , type: string}\n    - {name: sc-stream-bytes , type: string}\n    - {name: x-sname         , type: string}\n    - {name: x-sname-query   , type: string}\n    - {name: x-file-name     , type: string}\n    - {name: x-file-ext      , type: string}\n    - {name: x-file-size     , type: string}\n    - {name: x-file-length   , type: string}\n    - {name: x-suri          , type: string}\n    - {name: x-suri-stem     , type: string}\n    - {name: x-suri-queri    , type: string}\n    - {name: cs-uri-stem     , type: string}\n    - {name: cs-uri-query    , type: string}\n\nfilters:\n  - type: column\n    add_columns:\n    - {name : datetime, type: timestamp, default: \"1970-01-01\", format: \"%Y-%m-%d\"}\n  - type: ruby_proc\n    before:\n      - proc: |\n          -> do\n            require \"time\"\n          end\n    rows:\n      - proc: |\n          ->(record) do\n            record.tap do |r|\n              r[\"datetime\"] = Time.iso8601(r[\"date\"] + \"T\" + r[\"time\"] + \"+09:00\")\n            end\n          end\n\n  - type: column\n    drop_columns:\n    - {name : date}\n    - {name : time}\n\nout:\n  type: elasticsearch_ruby\n  mode: normal\n  nodes:\n  - {host: localhost, port: 9200}\n  index: logstash-wowza\n  index_type: wow\n```\n\n\n#### \u30a8\u30e9\u30fc\u30ed\u30b0\n\n```yaml:embulk-config-error.yml\nin:\n  type: file\n  path_prefix: /path/to/wowza-error-log.txt\n  parser:\n    charset: UTF-8\n    newline: LF\n    type: csv\n    delimiter: \"\\t\"\n    quote: '\"'\n    escape: '\"'\n    trim_if_not_quoted: false\n    skip_header_lines: 0\n    allow_extra_columns: false\n    allow_optional_columns: false\n    columns:\n    - {name:  x-severity      , type: string}\n    - {name:  x-category      , type: string}\n    - {name:  x-event         , type: string}\n    - {name:  date            , type: string}\n    - {name:  time            , type: string}\n    - {name:  c-client-id     , type: string}\n    - {name:  c-ip            , type: string}\n    - {name:  c-port          , type: string}\n    - {name:  cs-bytes        , type: string}\n    - {name:  sc-bytes        , type: string}\n    - {name:  x-duration      , type: string}\n    - {name:  x-sname         , type: string}\n    - {name:  x-stream-id     , type: string}\n    - {name:  x-spos          , type: string}\n    - {name:  sc-stream-bytes , type: string}\n    - {name:  cs-stream-bytes , type: string}\n    - {name:  x-file-size     , type: string}\n    - {name:  x-file-length   , type: string}\n    - {name:  x-ctx           , type: string}\n    - {name:  x-comment       , type: string}\n\nfilters:\n  - type: column\n    add_columns:\n    - {name : datetime, type: timestamp, default: \"1970-01-01\", format: \"%Y-%m-%d\"}\n  - type: ruby_proc\n    before:\n      - proc: |\n          -> do\n            require \"time\"\n          end\n    rows:\n      - proc: |\n          ->(record) do\n            record.tap do |r|\n              r[\"datetime\"] = Time.iso8601(r[\"date\"] + \"T\" + r[\"time\"] + \"+09:00\")\n            end\n          end\n\n  - type: column\n    drop_columns:\n    - {name : date}\n    - {name : time}\n\nout:\n  type: elasticsearch_ruby\n  mode: normal\n  nodes:\n  - {host: localhost, port: 9200}\n  index: logstash-wowza-error-test\n  index_type: wow\n```\n\n", "tags": ["Embulk", "wowza"]}