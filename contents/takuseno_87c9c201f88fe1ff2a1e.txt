{"tags": ["PHP", "Hubot", "Slack", "GitHub"], "context": " More than 1 year has passed since last update.\n\n\u7d4c\u7def\n\u73fe\u5728\u4f1a\u793e\u3067\u306f\u30ec\u30ac\u30b7\u30fc\u306aPHP\u304c\u4f7f\u308f\u308c\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4fdd\u5b88\u304c\u7d9a\u3051\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u65e5\u672c\u3067\u306f\u304a\u305d\u3089\u304f\u591a\u304f\u306eWeb\u30b5\u30a4\u30c8\u3067\u30ec\u30ac\u30b7\u30fc\u306aPHP\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u30e2\u30c0\u30f3\u306a\u6700\u65b0\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u306f\u9055\u3044\u3001\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5316\u3001CI\u3001\u30b3\u30fc\u30c9\u306e\u9759\u7684\u89e3\u6790\u306a\u3069\u3068\u306f\u7a0b\u9060\u3044\u3067\u3059\u3002\u9577\u3044\u9593\u4fdd\u5b88\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04\u306e\u7d71\u4e00\u3082\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\uff01\n\u65b0\u3057\u3044\u3082\u306e\u3092\u4f7f\u3063\u3066\u30ec\u30ac\u30b7\u30fc\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30e2\u30c0\u30f3\u306a\u3082\u306e\u306b\u3057\u307e\u3057\u3087\u3046\uff01\n\u3068\u3044\u3046\u3053\u3068\u3067\u307e\u305a\u30a4\u30f3\u30c7\u30f3\u30c8\u306b\u30bf\u30d6\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30af\u3059\u308b\u3060\u3051\u306e\u30dc\u30c3\u30c8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u50d5\u306e\u3044\u308b\u4f1a\u793e\u306e\u8a00\u3044\u4f1d\u3048\u306b\u3088\u308a\u307e\u3059\u3068\u30a4\u30f3\u30c7\u30f3\u30c8\u306f\u30bf\u30d6\u3089\u3057\u3044\u306e\u3067\u30b9\u30da\u30fc\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\nGitHub\u306eWebhooks\u304b\u3089push\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u98db\u3070\u3057\u3066\u3082\u3089\u3063\u3066\u3001\u305d\u3053\u304b\u3089\u30b3\u30df\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u306b\u884c\u304d\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\n\ncheckIndentation.coffee\ntoken = 'token'\napiUrl = \"https://api.github.com/repos/[Organization\u540d]\"\nrepository = \"hoge\"\n\nmodule.exports = (robot) ->\n  robot.router.post(\"/github/check/commits\", (req, response) ->\n    data = req.body\n    for commit in data.commits\n      request = robot.http(\"#{apiUrl}/#{repository}/commits/#{commit.id}\")\n        .query(access_token: token)\n        .get()\n\n      request((err, res, body) ->\n        if err\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", \"\u4f55\u304b\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3061\u3083\u3044\u307e\u3057\u305f...\")\n          return\n\n        commit = JSON.parse body\n\n        if commit.message == \"Not Found\"\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", \"#{repository}\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f..\")\n          return\n\n        fileNames = []\n        for file in commit.files\n          if file.status == 'modified' || file.status == 'added'\n            if file.filename.match(/^.*\\.php$/g) != null\n              if !checkIndentation(file.patch)\n                fileNames.push(file.filename)\n\n        if fileNames.length != 0\n          respond = \"#{commit.committer.login}\u3055\u3093!\\n\u30b9\u30da\u30fc\u30b9\u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u304c\u6df7\u3058\u3063\u3066\u307e\u3059\u3088!\\n\\n\"\n          respond += \"#{commit.commit.message}\\n\\n\"\n          respond += \"#{fileNames.join('\\n')}\"\n          respond += \"\\n\\n#{commit.html_url}\"\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", respond)\n      )\n    response.end('')\n  )\n\ncheckIndentation = (patch) ->\n  index = patch.indexOf(\"\\n\")\n  while 1\n    nextIndex = patch.indexOf(\"\\n\", index + 1)\n    if nextIndex == -1\n      break\n    string = patch.slice(index + 1, nextIndex)\n    if (string.slice(0, 1) == '+')\n      if (string.substr(1).match(/^ +\\S+/) != null)\n        return false\n    index = nextIndex\n  return true\n\n\n\n\u3053\u308c\u3067GitHub\u306e\u8a2d\u5b9a\u304b\u3089Webhooks\u3092[\u30dc\u30c3\u30c8\u306eURL]/github/check/commits\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\u4eca\u56de\u306fGitHub API\u3067\u30d5\u30a1\u30a4\u30eb\u3054\u3068\u306e\u5dee\u5206\u3092\u30d1\u30c3\u30c1\u5f62\u5f0f\u3067\u53d6\u5f97\u3057\u3066\u30a4\u30f3\u30c7\u30f3\u30c8\u3092\u8abf\u3079\u3066\u3044\u307e\u3059\u3002\n\n\u5b9f\u884c\u3057\u305f\u611f\u3058\n\n\u81a8\u5927\u306a\u30b3\u30fc\u30c9\u3092\u5168\u90e8PHP Code Sniffer\u3068\u304b\u304b\u3051\u305f\u3089\u3068\u3093\u3067\u3082\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3051\u3069\u3001\u4eca\u5f8c\u306e\u5909\u66f4\u7b87\u6240\u3060\u3051\u6307\u6458\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u304b\u306a\u308a\u6709\u52b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u7d4c\u7def\n\u73fe\u5728\u4f1a\u793e\u3067\u306f\u30ec\u30ac\u30b7\u30fc\u306aPHP\u304c\u4f7f\u308f\u308c\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4fdd\u5b88\u304c\u7d9a\u3051\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u65e5\u672c\u3067\u306f\u304a\u305d\u3089\u304f\u591a\u304f\u306eWeb\u30b5\u30a4\u30c8\u3067\u30ec\u30ac\u30b7\u30fc\u306aPHP\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u30e2\u30c0\u30f3\u306a\u6700\u65b0\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u306f\u9055\u3044\u3001\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5316\u3001CI\u3001\u30b3\u30fc\u30c9\u306e\u9759\u7684\u89e3\u6790\u306a\u3069\u3068\u306f\u7a0b\u9060\u3044\u3067\u3059\u3002\u9577\u3044\u9593\u4fdd\u5b88\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u898f\u7d04\u306e\u7d71\u4e00\u3082\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067\uff01\n\u65b0\u3057\u3044\u3082\u306e\u3092\u4f7f\u3063\u3066\u30ec\u30ac\u30b7\u30fc\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30e2\u30c0\u30f3\u306a\u3082\u306e\u306b\u3057\u307e\u3057\u3087\u3046\uff01\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u307e\u305a\u30a4\u30f3\u30c7\u30f3\u30c8\u306b\u30bf\u30d6\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30af\u3059\u308b\u3060\u3051\u306e\u30dc\u30c3\u30c8\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u50d5\u306e\u3044\u308b\u4f1a\u793e\u306e\u8a00\u3044\u4f1d\u3048\u306b\u3088\u308a\u307e\u3059\u3068\u30a4\u30f3\u30c7\u30f3\u30c8\u306f\u30bf\u30d6\u3089\u3057\u3044\u306e\u3067\u30b9\u30da\u30fc\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\n\nGitHub\u306eWebhooks\u304b\u3089push\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u98db\u3070\u3057\u3066\u3082\u3089\u3063\u3066\u3001\u305d\u3053\u304b\u3089\u30b3\u30df\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u306b\u884c\u304d\u307e\u3059\u3002\n\n# \u30b3\u30fc\u30c9\n```coffee:checkIndentation.coffee\ntoken = 'token'\napiUrl = \"https://api.github.com/repos/[Organization\u540d]\"\nrepository = \"hoge\"\n\nmodule.exports = (robot) ->\n  robot.router.post(\"/github/check/commits\", (req, response) ->\n    data = req.body\n    for commit in data.commits\n      request = robot.http(\"#{apiUrl}/#{repository}/commits/#{commit.id}\")\n        .query(access_token: token)\n        .get()\n\n      request((err, res, body) ->\n        if err\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", \"\u4f55\u304b\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3061\u3083\u3044\u307e\u3057\u305f...\")\n          return\n\n        commit = JSON.parse body\n\n        if commit.message == \"Not Found\"\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", \"#{repository}\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f..\")\n          return\n\n        fileNames = []\n        for file in commit.files\n          if file.status == 'modified' || file.status == 'added'\n            if file.filename.match(/^.*\\.php$/g) != null\n              if !checkIndentation(file.patch)\n                fileNames.push(file.filename)\n\n        if fileNames.length != 0\n          respond = \"#{commit.committer.login}\u3055\u3093!\\n\u30b9\u30da\u30fc\u30b9\u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u304c\u6df7\u3058\u3063\u3066\u307e\u3059\u3088!\\n\\n\"\n          respond += \"#{commit.commit.message}\\n\\n\"\n          respond += \"#{fileNames.join('\\n')}\"\n          respond += \"\\n\\n#{commit.html_url}\"\n          robot.messageRoom(\"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\", respond)\n      )\n    response.end('')\n  )\n\ncheckIndentation = (patch) ->\n  index = patch.indexOf(\"\\n\")\n  while 1\n    nextIndex = patch.indexOf(\"\\n\", index + 1)\n    if nextIndex == -1\n      break\n    string = patch.slice(index + 1, nextIndex)\n    if (string.slice(0, 1) == '+')\n      if (string.substr(1).match(/^ +\\S+/) != null)\n        return false\n    index = nextIndex\n  return true\n\n```\n\n\u3053\u308c\u3067GitHub\u306e\u8a2d\u5b9a\u304b\u3089Webhooks\u3092`[\u30dc\u30c3\u30c8\u306eURL]/github/check/commits`\u3092\u8a2d\u5b9a\u3059\u308c\u3070\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u4eca\u56de\u306fGitHub API\u3067\u30d5\u30a1\u30a4\u30eb\u3054\u3068\u306e\u5dee\u5206\u3092\u30d1\u30c3\u30c1\u5f62\u5f0f\u3067\u53d6\u5f97\u3057\u3066\u30a4\u30f3\u30c7\u30f3\u30c8\u3092\u8abf\u3079\u3066\u3044\u307e\u3059\u3002\n\n# \u5b9f\u884c\u3057\u305f\u611f\u3058\n\n![slack.jpg](https://qiita-image-store.s3.amazonaws.com/0/72360/f0bd63dd-b10a-277f-46d0-cfdc6375b453.jpeg)\n\n\u81a8\u5927\u306a\u30b3\u30fc\u30c9\u3092\u5168\u90e8PHP Code Sniffer\u3068\u304b\u304b\u3051\u305f\u3089\u3068\u3093\u3067\u3082\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3051\u3069\u3001\u4eca\u5f8c\u306e\u5909\u66f4\u7b87\u6240\u3060\u3051\u6307\u6458\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u304b\u306a\u308a\u6709\u52b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n"}