{"context": "Zabbix\u306e\u30a2\u30e9\u30fc\u30c8\u901a\u77e5\u306f\u30e1\u30fc\u30eb\u3067\u884c\u3063\u3066\u3044\u305f\u304c\u3001\nSlack\u306b\u90e8\u5c4b\u3092\u7acb\u3066\u3066\u3001\u305d\u3053\u3078\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\n\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\u306b\u6319\u3052\u3066\u3044\u308b\u30b5\u30a4\u30c8\u306b\u5f93\u3063\u3066\u3044\u308d\u3044\u308d\u3084\u3063\u3066\u307f\u305f\u3082\u306e\u306e\n\u601d\u3046\u3088\u3046\u306b\u52d5\u304b\u306a\u3044\u306e\u3067\u3001\u7d50\u5c40\u81ea\u5206\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3084\u3063\u305f\u7d50\u679c\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3053\u3068\u306b\u3057\u305f\u3002\n\n\u524d\u63d0\n\nCentOS Linux release 7.2.1511\nZabbix 3.01\n\n\n\u624b\u9806\n\n\u30a2\u30e9\u30fc\u30c8\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7f6e\u304d\u5834\u6240\u3092\u78ba\u8a8d\u3059\u308b\n[root@jumps alertscripts]# grep AlertScripts /etc/zabbix/zabbix_server.conf\n# AlertScriptsPath=${datadir}/zabbix/alertscripts\nAlertScriptsPath=/usr/lib/zabbix/alertscripts\n\n\nZabbix\u304c\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\n\nMedia Types\n\u753b\u50cf\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\nScript Parameters\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002\n\u8a2d\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3055\u308c\u308b\u4ed5\u7d44\u307f\u3089\u3057\u3044\u3002\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n/usr/lib/zabbix/alertscripts/slack.sh {ALERT.SUBJECT} {ALERT.MESSAGE}\n\n\n\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\u30e6\u30fc\u30b6slack\u3055\u3093\u306e\u6a29\u9650\u3067\u898b\u3048\u308b\u7bc4\u56f2\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u3001Script\uff1aSlack\u3092\u5229\u7528\u3057\u3066\u901a\u77e5\u3055\u308c\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\n\nSend to\u306f\u4eca\u56de\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u304c\u3001\u5fc5\u9808\u3089\u3057\u3044\u306e\u3067\u9069\u5f53\u306bChannel\u540d\u3092\u5165\u308c\u308b\u3002\n\nAction\u306e\u8a2d\u5b9a\n\u5404\u30db\u30b9\u30c8\u3067\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308bTrigger\u304cHit\u3057\u305f\u3068\u304d\u306b\u3053\u306eAction\u304c\u52d5\u304f\u3002\n\u3064\u307e\u308a\u3001\u4f55\u304b\u30a2\u30e9\u30fc\u30c8\u304c\u767a\u751f\u3057\u305f\u306b\u3069\u3046\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u4eca\u56de\u306f\u3000\u30e6\u30fc\u30b6\uff1aslack\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u3068\u8a2d\u5b9a\u3059\u308b\u3002\n\n\n\n\nSlack\u5074\u306e\u8a2d\u5b9a\n\nzabbix\u90e8\u5c4b\u3092\u4f5c\u308b\nCHANNELS\u306e\u53f3\u306b\u3042\u308b + \u304b\u3089\u3042\u3063\u3055\u308a\u4f5c\u6210\u3067\u304d\u308b\u306e\u3067\u5272\u611b\u3059\u308b\n\nWebhook\u3092\u8a2d\u5b9a\u3059\u308b\nTeam Setting\u304b\u3089\u9069\u5f53\u306b\u63a2\u3057\u3066\u30dd\u30c1\u30dd\u30c1\u3057\u3066\u6b21\u306e\u3088\u3046\u306a\u753b\u9762\u306b\u9032\u307f\u3001Webhook URL\u3092\u53d6\u5f97\u3002\n\n/usr/share/zabbix/favicon.ico\u3092png\u306b\u3057\u3066\u5229\u7528\u3002\u3061\u3087\u3063\u3068\u30dc\u30b1\u308b\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u7d30\u304b\u3044\u6574\u5f62\u306f\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u3001\u901a\u77e5\u3055\u308c\u308b\u3068\u304d\u306b\u8272\u3060\u3051\u5909\u308f\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\n\u8272\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30673\u3064\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3089\u3057\u3044\u3002\n\n*2016/03/30 \u8ffd\u8a18 \nSNMP-Trap\u306eMessage\u306e\u4e2d\u306b\u5165\u3063\u3066\u3044\u308b\"\uff08\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\uff09\u304cJSON\u3068\u76f8\u6027\u60aa\u3044\u3089\u3057\u3044\u306e\u3067\u6d88\u3059\u884c\u3092\u8ffd\u52a0\u3057\u305f\n\n/usr/lib/zabbix/alertscripts/slack.sh\n#!/bin/bash\n\nslack_url= [Webhook URL]\nsubject=$1\nmessage=$2\nusername=Zabbix\n\n# Change message color depending on the subject\nif [ \"${subject%%:*}\" == 'OK' ]; then\n        color=\"good\"\nelif [ \"${subject%%:*}\" == 'PROBLEM' ]; then\n        color=\"danger\"\nelse\n        color=\"#808080\"\nfi\n\n# Delete double quote (\") on the message\nmessage=`echo ${message} | sed -e 's/\"//g'`\n\n# Message format\npayload=\"payload={\n   \\\"username\\\":\\\"${username}\\\",\n   \\\"attachments\\\": [\n    {\n        \\\"title\\\": \\\"${subject%%:*}\\\",\n        \\\"color\\\": \\\"${color}\\\",\n        \\\"text\\\": \\\"${message}\\\"\n    }\n  ]\n}\"\n\n# Posting message to slack\ncurl -m 5 --data-urlencode \"${payload}\" \"${slack_url}\"\n\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u901a\u77e5\u304c\u8a18\u4e8b\u306e\u4e00\u756a\u4e0a\u306b\u8868\u793a\u3057\u3066\u3044\u308b\u753b\u50cf\u3002\nchannel\u306fWebhook URL\u3067\u6307\u5b9a\u6e08\u307f\u306a\u306e\u3067\u4e0d\u8981\u3060\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u3001attachments\u3092\u4f7f\u308f\u305a\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7d20\u3067\u3060\u3059\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n\u305d\u306e\u4ed6\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4e2d\u3067\u306f{ALERT.MESSAGE}\u306e\u6574\u5f62\u3092\u3084\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001Action\u306eDefault Message\u3092\u7de8\u96c6\u3057\u3066\u5fc5\u8981\u306a\u60c5\u5831\u3060\u3051\u3068\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n*2016/03/23\u8ffd\u8a18\n\u53c2\u8003\u307e\u3067\u306b\u3001\u7de8\u96c6\u3057\u305f\u3082\u306e\u3082\u8cbc\u3063\u3066\u304a\u304f\u3002\n\nDefaultMessage\nDate: {EVENT.DATE}  {EVENT.TIME} \nDescription: {TRIGGER.NAME}\nHostname: {HOST.NAME1}\nIP address: {HOST.IP1}\nSeverity: {TRIGGER.SEVERITY}\n\nItem values: {ITEM.NAME1}: {ITEM.VALUE1}\n\nOriginal event ID: {EVENT.ID}\n\n\n\nRecoveryMessage\nDate: {EVENT.RECOVERY.DATE}  {EVENT.RECOVERY.TIME}\nDescription: {TRIGGER.NAME}\nHostname: {HOST.NAME1}\nIP address: {HOST.IP1}\n\nItem values: {ITEM.NAME1}: {ITEM.VALUE1}\n\nOriginal event ID: {EVENT.ID}\n\n\n\nZabbix 3.0\u3060\u3068Original event ID\u304c\u540c\u3058\u306b\u306a\u3089\u306a\u3044(?)\u70ba\u306bRecoveryMessage\u304c\u4f7f\u308f\u308c\u306a\u3044\u3088\u3046\u3060\u3002\u8b0e\n\n\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\n\nZabbix\u304b\u3089Slack\u306b\u901a\u77e5\u3092\u9001\u308b\nZabbix\u304b\u3089Slack\u3078\u3061\u3087\u3063\u3068\u30ea\u30c3\u30c1\u306a\u901a\u77e5\u3092\u3059\u308b\nhttps://github.com/ericoc/zabbix-slack-alertscript\nhttps://www.zabbix.com/documentation/3.0/manual/appendix/macros/supported_by_location\nhttps://api.slack.com/docs/attachments\n\nZabbix\u306e\u30a2\u30e9\u30fc\u30c8\u901a\u77e5\u306f\u30e1\u30fc\u30eb\u3067\u884c\u3063\u3066\u3044\u305f\u304c\u3001\nSlack\u306b\u90e8\u5c4b\u3092\u7acb\u3066\u3066\u3001\u305d\u3053\u3078\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/69745/63e5c87a-1886-7fc9-fcd1-96f4cb83a6d0.png)\n\n\n\u95a2\u9023\u30ea\u30bd\u30fc\u30b9\u306b\u6319\u3052\u3066\u3044\u308b\u30b5\u30a4\u30c8\u306b\u5f93\u3063\u3066\u3044\u308d\u3044\u308d\u3084\u3063\u3066\u307f\u305f\u3082\u306e\u306e\n\u601d\u3046\u3088\u3046\u306b\u52d5\u304b\u306a\u3044\u306e\u3067\u3001\u7d50\u5c40\u81ea\u5206\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3084\u3063\u305f\u7d50\u679c\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3053\u3068\u306b\u3057\u305f\u3002\n\n\n# \u524d\u63d0\n- CentOS Linux release 7.2.1511\n- Zabbix 3.01\n\n# \u624b\u9806\n## \u30a2\u30e9\u30fc\u30c8\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7f6e\u304d\u5834\u6240\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n[root@jumps alertscripts]# grep AlertScripts /etc/zabbix/zabbix_server.conf\n# AlertScriptsPath=${datadir}/zabbix/alertscripts\nAlertScriptsPath=/usr/lib/zabbix/alertscripts\n```\n\n## Zabbix\u304c\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\n### Media Types\n\u753b\u50cf\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n\n![image](https://vcjp.qiita.com/files/280a2f4f-6a0a-9c4a-e9c3-409d4e7825ea.png)\n\nScript Parameters\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](https://www.zabbix.com/documentation/3.0/manual/appendix/macros/supported_by_location)\u3092\u53c2\u7167\u3002\n\n\u8a2d\u5b9a\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3055\u308c\u308b\u4ed5\u7d44\u307f\u3089\u3057\u3044\u3002\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```\n/usr/lib/zabbix/alertscripts/slack.sh {ALERT.SUBJECT} {ALERT.MESSAGE}\n```\n\n### \u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\u30e6\u30fc\u30b6slack\u3055\u3093\u306e\u6a29\u9650\u3067\u898b\u3048\u308b\u7bc4\u56f2\u306e\u30a2\u30e9\u30fc\u30c8\u306f\u3001Script\uff1aSlack\u3092\u5229\u7528\u3057\u3066\u901a\u77e5\u3055\u308c\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\n![image](https://vcjp.qiita.com/files/70d09945-0279-97ba-fd9b-9032fbac9bc6.png)\n\n``Send to``\u306f\u4eca\u56de\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u304c\u3001\u5fc5\u9808\u3089\u3057\u3044\u306e\u3067\u9069\u5f53\u306bChannel\u540d\u3092\u5165\u308c\u308b\u3002\n\n### Action\u306e\u8a2d\u5b9a\n\u5404\u30db\u30b9\u30c8\u3067\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3044\u308bTrigger\u304cHit\u3057\u305f\u3068\u304d\u306b\u3053\u306eAction\u304c\u52d5\u304f\u3002\n\u3064\u307e\u308a\u3001\u4f55\u304b\u30a2\u30e9\u30fc\u30c8\u304c\u767a\u751f\u3057\u305f\u306b\u3069\u3046\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u4eca\u56de\u306f\u3000\u30e6\u30fc\u30b6\uff1aslack\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u3068\u8a2d\u5b9a\u3059\u308b\u3002\n\n\n![image](https://vcjp.qiita.com/files/0d1a87f7-1590-3190-a27e-98ea6999a35a.png)\n\n![image](https://vcjp.qiita.com/files/4dab27e1-457b-ea9e-c3fd-b09efc766be6.png)\n\n![image](https://vcjp.qiita.com/files/cf123126-ac69-7136-4f08-2b0968c9a8c5.png)\n\n\n\n## Slack\u5074\u306e\u8a2d\u5b9a\n### zabbix\u90e8\u5c4b\u3092\u4f5c\u308b\nCHANNELS\u306e\u53f3\u306b\u3042\u308b + \u304b\u3089\u3042\u3063\u3055\u308a\u4f5c\u6210\u3067\u304d\u308b\u306e\u3067\u5272\u611b\u3059\u308b\n\n### Webhook\u3092\u8a2d\u5b9a\u3059\u308b\nTeam Setting\u304b\u3089\u9069\u5f53\u306b\u63a2\u3057\u3066\u30dd\u30c1\u30dd\u30c1\u3057\u3066\u6b21\u306e\u3088\u3046\u306a\u753b\u9762\u306b\u9032\u307f\u3001Webhook URL\u3092\u53d6\u5f97\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/69745/21557e60-01ef-ef07-ae4d-4f6077b9e41c.png)\n\n\n``/usr/share/zabbix/favicon.ico``\u3092png\u306b\u3057\u3066\u5229\u7528\u3002\u3061\u3087\u3063\u3068\u30dc\u30b1\u308b\u3002\n\n\n## \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u7d30\u304b\u3044\u6574\u5f62\u306f\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u3001\u901a\u77e5\u3055\u308c\u308b\u3068\u304d\u306b\u8272\u3060\u3051\u5909\u308f\u308b\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\n\u8272\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u30673\u3064\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3089\u3057\u3044\u3002\n![image](https://vcjp.qiita.com/files/ce980e10-b465-a2f4-18e0-ffd67b27ed9c.png)\n\n\n*2016/03/30 \u8ffd\u8a18 \nSNMP-Trap\u306eMessage\u306e\u4e2d\u306b\u5165\u3063\u3066\u3044\u308b\"\uff08\u30c0\u30d6\u30eb\u30af\u30a9\u30fc\u30c8\uff09\u304cJSON\u3068\u76f8\u6027\u60aa\u3044\u3089\u3057\u3044\u306e\u3067\u6d88\u3059\u884c\u3092\u8ffd\u52a0\u3057\u305f\n\n```bash:/usr/lib/zabbix/alertscripts/slack.sh\n#!/bin/bash\n\nslack_url= [Webhook URL]\nsubject=$1\nmessage=$2\nusername=Zabbix\n\n# Change message color depending on the subject\nif [ \"${subject%%:*}\" == 'OK' ]; then\n        color=\"good\"\nelif [ \"${subject%%:*}\" == 'PROBLEM' ]; then\n        color=\"danger\"\nelse\n        color=\"#808080\"\nfi\n\n# Delete double quote (\") on the message\nmessage=`echo ${message} | sed -e 's/\"//g'`\n\n# Message format\npayload=\"payload={\n   \\\"username\\\":\\\"${username}\\\",\n   \\\"attachments\\\": [\n    {\n        \\\"title\\\": \\\"${subject%%:*}\\\",\n        \\\"color\\\": \\\"${color}\\\",\n        \\\"text\\\": \\\"${message}\\\"\n    }\n  ]\n}\"\n\n# Posting message to slack\ncurl -m 5 --data-urlencode \"${payload}\" \"${slack_url}\"\n```\n\u51fa\u6765\u4e0a\u304c\u3063\u305f\u901a\u77e5\u304c\u8a18\u4e8b\u306e\u4e00\u756a\u4e0a\u306b\u8868\u793a\u3057\u3066\u3044\u308b\u753b\u50cf\u3002\n``channel``\u306fWebhook URL\u3067\u6307\u5b9a\u6e08\u307f\u306a\u306e\u3067\u4e0d\u8981\u3060\u3063\u305f\u3002\n\u3061\u306a\u307f\u306b\u3001``attachments``\u3092\u4f7f\u308f\u305a\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u7d20\u3067\u3060\u3059\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/69745/15c9f9b4-d016-8e6f-c0e4-91046d5b51ad.png)\n\n\n\n#\u305d\u306e\u4ed6\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4e2d\u3067\u306f``{ALERT.MESSAGE}``\u306e\u6574\u5f62\u3092\u3084\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001Action\u306e``Default Message``\u3092\u7de8\u96c6\u3057\u3066\u5fc5\u8981\u306a\u60c5\u5831\u3060\u3051\u3068\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n*2016/03/23\u8ffd\u8a18\n\n\u53c2\u8003\u307e\u3067\u306b\u3001\u7de8\u96c6\u3057\u305f\u3082\u306e\u3082\u8cbc\u3063\u3066\u304a\u304f\u3002\n\n```:DefaultMessage\nDate: {EVENT.DATE}  {EVENT.TIME} \nDescription: {TRIGGER.NAME}\nHostname: {HOST.NAME1}\nIP address: {HOST.IP1}\nSeverity: {TRIGGER.SEVERITY}\n\nItem values: {ITEM.NAME1}: {ITEM.VALUE1}\n\nOriginal event ID: {EVENT.ID}\n```\n\n```:RecoveryMessage\nDate: {EVENT.RECOVERY.DATE}  {EVENT.RECOVERY.TIME}\nDescription: {TRIGGER.NAME}\nHostname: {HOST.NAME1}\nIP address: {HOST.IP1}\n\nItem values: {ITEM.NAME1}: {ITEM.VALUE1}\n\nOriginal event ID: {EVENT.ID}\n```\n![image](https://qiita-image-store.s3.amazonaws.com/0/69745/98d2670f-30fd-733c-0f78-0d0425b5c12d.png)\n\nZabbix 3.0\u3060\u3068Original event ID\u304c\u540c\u3058\u306b\u306a\u3089\u306a\u3044(?)\u70ba\u306bRecoveryMessage\u304c\u4f7f\u308f\u308c\u306a\u3044\u3088\u3046\u3060\u3002\u8b0e\n\n# \u95a2\u9023\u30ea\u30bd\u30fc\u30b9\n- [Zabbix\u304b\u3089Slack\u306b\u901a\u77e5\u3092\u9001\u308b](http://qiita.com/takashyx/items/3c9becf345cd58ca69bf)\n- [Zabbix\u304b\u3089Slack\u3078\u3061\u3087\u3063\u3068\u30ea\u30c3\u30c1\u306a\u901a\u77e5\u3092\u3059\u308b](http://qiita.com/bageljp@github/items/20be937ca3bb92100e8f)\n- https://github.com/ericoc/zabbix-slack-alertscript\n- https://www.zabbix.com/documentation/3.0/manual/appendix/macros/supported_by_location\n- https://api.slack.com/docs/attachments\n", "tags": ["zabbix", "Slack"]}