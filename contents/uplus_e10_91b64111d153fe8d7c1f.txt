{"tags": ["KVM", "Linux", "virt", "Ubuntu15.10"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002virt-manager\u3001\u3082\u3057\u304f\u306fvirt-install\u3067\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5171\u6709\u3059\u308b\u306b\u306fNFS(Network File System)\u3092\u4f7f\u3046\u3002\n\nNFS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30db\u30b9\u30c8\n$ sudo apt-get install nfs-common nfs-kernel-server\n\n\u30b2\u30b9\u30c8\n$ sudo apt-get install nfs-common\n\n\n\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\n\u5171\u6709\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 /etc/exports\u306b\u66f8\u304f\u3002\n\u66f8\u5f0f: \u30d1\u30b9 \u30de\u30a6\u30f3\u30c8\u3092\u8a31\u53ef\u3059\u308b\u30a2\u30c9\u30ec\u30b9(\u30aa\u30d7\u30b7\u30e7\u30f3)\n$ cat /etc/exports\n/dir/path 192.168.122.0/24(rw,sync,no_subtree_check,fsid=0) \n$ sudo exportfs -rav  #\u8a2d\u5b9a\u53cd\u6620\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306efsid=0\u306f/dir/path\u3092\u30eb\u30fc\u30c8\u3068\u3057\u3066\u6271\u3046\u3068\u3044\u3046\u610f\u5473\u3002\n\u8aad\u307f\u53d6\u308a\u5c02\u7528\u306b\u3057\u305f\u3044\u3068\u304d\u306frw\u3092ro\u306b\u3059\u308c\u3070\u3044\u3044\u3002\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u4f7f\u7528\u3059\u308b\u30dd\u30fc\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u958b\u653e\u3059\u308b\u3002\n$ rpcinfo -p\n\n\u7b46\u8005\u306e\u74b0\u5883(ufw)\u306e\u5834\u5408\u306f\u3002\nsudo ufw allow from 192.168.122.0/24 to any port 111\nsudo ufw allow from 192.168.122.0/24 to any port 2049\nsudo ufw allow from 192.168.122.0/24 to any port 48218 proto udp\nsudo ufw allow from 192.168.122.0/24 to any port 38309 proto tcp\nsudo ufw allow from 192.168.122.0/24 to any port 48900 proto udp\nsudo ufw allow from 192.168.122.0/24 to any port 41747 proto tcp\n\n\n\u30b2\u30b9\u30c8\u306e\u8a2d\u5b9a\n\u3068\u304f\u306b\u8a2d\u5b9a\u306f\u5fc5\u8981\u306a\u3044\u306e\u3067\u3042\u3068\u306f\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3060\u3051\u3002\n192.168.1.2\u3092\u30db\u30b9\u30c8\u3060\u3068\u3059\u308b\u3068\u3002\n\u30db\u30b9\u30c8\u3067\u516c\u958b\u3055\u308c\u3066\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3002\n\u5b9f\u884c\u3057\u3066\u3082\u5fdc\u7b54\u304c\u306a\u3044\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u963b\u307e\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n$ showmount -e 192.168.1.2\n\n\u30db\u30b9\u30c8\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3002\n/etc/exports\u3067fsid=0\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30eb\u30fc\u30c8\u306b\u306a\u308b\u3002\n$ sudo mount 192.168.1.2:/ /mnt\n\n\u518d\u8d77\u52d5\u3057\u3066\u3082\u81ea\u52d5\u3067\u30de\u30a6\u30f3\u30c8\u3057\u305f\u3044\u5834\u5408\u306f/etc/fstab\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u4eca\u56de\u306e\u5834\u5408\u306f\u4e0b\u8a18\u306e\u51fa\u529b\u306e\u6700\u5f8c\u306e\u884c\u3092\u8ffd\u8a18\u3059\u308c\u3070\u3044\u3044\u3002\n$ cat /etc/fstab\n/dev/sda1      /     ext4   errors=remount-ro 0 1\n/dev/sda2      none  swap   sw 0 0\n192.168.1.2:/  /mnt  nfs4   rsize=8192,wsize=8192,timeo=14,_netdev 0 0\n\nvirt-manager\u3001\u3082\u3057\u304f\u306fvirt-install\u3067\u4f5c\u6210\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5171\u6709\u3059\u308b\u306b\u306f[NFS](https://wiki.archlinuxjp.org/index.php/NFS)(Network File System)\u3092\u4f7f\u3046\u3002\n\n#NFS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30db\u30b9\u30c8\n\n```bash\n$ sudo apt-get install nfs-common nfs-kernel-server\n```\n\n\u30b2\u30b9\u30c8\n\n```bash\n$ sudo apt-get install nfs-common\n```\n\n#\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a\n\n\u5171\u6709\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 ```/etc/exports```\u306b\u66f8\u304f\u3002\n\u66f8\u5f0f: \u30d1\u30b9 \u30de\u30a6\u30f3\u30c8\u3092\u8a31\u53ef\u3059\u308b\u30a2\u30c9\u30ec\u30b9(\u30aa\u30d7\u30b7\u30e7\u30f3)\n\n```bash\n$ cat /etc/exports\n/dir/path 192.168.122.0/24(rw,sync,no_subtree_check,fsid=0) \n$ sudo exportfs -rav  #\u8a2d\u5b9a\u53cd\u6620\n```\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306e```fsid=0```\u306f```/dir/path```\u3092\u30eb\u30fc\u30c8\u3068\u3057\u3066\u6271\u3046\u3068\u3044\u3046\u610f\u5473\u3002\n\u8aad\u307f\u53d6\u308a\u5c02\u7528\u306b\u3057\u305f\u3044\u3068\u304d\u306f```rw```\u3092```ro```\u306b\u3059\u308c\u3070\u3044\u3044\u3002\n\n\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u4e0b\u8a18\u306e\u65b9\u6cd5\u3067\u4f7f\u7528\u3059\u308b\u30dd\u30fc\u30c8\u3092\u78ba\u8a8d\u3057\u3066\u958b\u653e\u3059\u308b\u3002\n\n```bash\n$ rpcinfo -p\n```\n\n\u7b46\u8005\u306e\u74b0\u5883(ufw)\u306e\u5834\u5408\u306f\u3002\n\n```bash\nsudo ufw allow from 192.168.122.0/24 to any port 111\nsudo ufw allow from 192.168.122.0/24 to any port 2049\nsudo ufw allow from 192.168.122.0/24 to any port 48218 proto udp\nsudo ufw allow from 192.168.122.0/24 to any port 38309 proto tcp\nsudo ufw allow from 192.168.122.0/24 to any port 48900 proto udp\nsudo ufw allow from 192.168.122.0/24 to any port 41747 proto tcp\n```\n\n\n#\u30b2\u30b9\u30c8\u306e\u8a2d\u5b9a\n\n\u3068\u304f\u306b\u8a2d\u5b9a\u306f\u5fc5\u8981\u306a\u3044\u306e\u3067\u3042\u3068\u306f\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3060\u3051\u3002\n```192.168.1.2```\u3092\u30db\u30b9\u30c8\u3060\u3068\u3059\u308b\u3068\u3002\n\n\u30db\u30b9\u30c8\u3067\u516c\u958b\u3055\u308c\u3066\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8868\u793a\u3002\n\u5b9f\u884c\u3057\u3066\u3082\u5fdc\u7b54\u304c\u306a\u3044\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3067\u963b\u307e\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n```bash\n$ showmount -e 192.168.1.2\n```\n\n\u30db\u30b9\u30c8\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3002\n```/etc/exports```\u3067```fsid=0```\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30eb\u30fc\u30c8\u306b\u306a\u308b\u3002\n\n```bash\n$ sudo mount 192.168.1.2:/ /mnt\n```\n\n\u518d\u8d77\u52d5\u3057\u3066\u3082\u81ea\u52d5\u3067\u30de\u30a6\u30f3\u30c8\u3057\u305f\u3044\u5834\u5408\u306f```/etc/fstab```\u3092\u7de8\u96c6\u3059\u308b\u3002\n\u4eca\u56de\u306e\u5834\u5408\u306f\u4e0b\u8a18\u306e\u51fa\u529b\u306e\u6700\u5f8c\u306e\u884c\u3092\u8ffd\u8a18\u3059\u308c\u3070\u3044\u3044\u3002\n\n```bash\n$ cat /etc/fstab\n/dev/sda1      /     ext4   errors=remount-ro 0 1\n/dev/sda2      none  swap   sw 0 0\n192.168.1.2:/  /mnt  nfs4   rsize=8192,wsize=8192,timeo=14,_netdev 0 0\n```\n"}