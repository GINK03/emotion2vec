{"context": "\n\n\u306a\u308b\u3079\u304f\u697d\u3057\u3066 slack \u306b\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u9001\u308a\u305f\u3044\n\n\u8981\u4ef6\n\nhost \u540d\u3092\u51fa\u3057\u305f\u3044\u3002\nCRITICAL \u304c\u542b\u307e\u308c\u308b\u884c\u3092\u51fa\u3057\u305f\u3044\n\n\nslack \u306e incoming web hook \u3064\u304f\u3063\u3066 url \u53d6\u5f97\u3059\u308b\ntd-agent2 intall. (\u3082\u3057 td-agent \u304c 1 \u3060\u3063\u305f\u3089\u4e00\u5ea6\u6d88\u3059)\nplugin \u3092 install \u3059\u308b\n\n# yum --setopt=tsflags=noscripts remove td-agent\n# yum --setopt=tsflags=noscripts remove td-agent2\n# curl -L http://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n# /usr/sbin/td-agent-gem install fluent-plugin-slack\n# /usr/sbin/td-agent-gem install fluent-plugin-rewrite-tag-filter\n\ntd-agent.conf (\u3053\u306e\u4f8b\u306f daemontools \u3067\u8d77\u52d5\u3057\u3066\u3044\u308b plack \u306e log \u3067\u3059)\n# tail \u3067\u62fe\u3046\n<source>\n  @type tail\n  path /service/my-web/log/main/current\n  pos_file /var/log/td-agent/error.log.pos\n  tag plack.raw\n  format /^(?<message>.*)$/\n</source>\n\n# \u6761\u4ef6\u3067 tag \u3064\u3051\u306a\u304a\u3059 rewrite\n<match plack.raw>\n  @type rewrite_tag_filter\n  rewriterule1 message ^.*CRITICAL.*$ plack.error\n  rewriterule2 message ^.*HTTP/1.0\" 404 .*$ plack.error\n</match>\n\n# host \u540d\u4ed8\u4e0e\u3059\u308b\n<filter plack.*>\n  @type record_transformer\n  <record>\n    host ${hostname}\n  </record>\n</filter>\n\n# slack \u306b\u306a\u3052\u308b\n<match plack.error>\n  @type slack\n  webhook_url https://hooks.slack.com/services/xxxx/xxxx/xxxx\n  channel hoge\n  username error\n  icon_emoji :gear:\n  flush_interval 10s\n  message_keys host,message\n  message \"[%s] %s\"\n</match>\n\n# \u306a\u308b\u3079\u304f\u697d\u3057\u3066 slack \u306b\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u9001\u308a\u305f\u3044\n## \u8981\u4ef6\n- host \u540d\u3092\u51fa\u3057\u305f\u3044\u3002\n- CRITICAL \u304c\u542b\u307e\u308c\u308b\u884c\u3092\u51fa\u3057\u305f\u3044\n\n1. slack \u306e incoming web hook \u3064\u304f\u3063\u3066 url \u53d6\u5f97\u3059\u308b\n1. td-agent2 intall. (\u3082\u3057 td-agent \u304c 1 \u3060\u3063\u305f\u3089\u4e00\u5ea6\u6d88\u3059)\n1. plugin \u3092 install \u3059\u308b\n\n```\n# yum --setopt=tsflags=noscripts remove td-agent\n# yum --setopt=tsflags=noscripts remove td-agent2\n# curl -L http://toolbelt.treasuredata.com/sh/install-redhat-td-agent2.sh | sh\n# /usr/sbin/td-agent-gem install fluent-plugin-slack\n# /usr/sbin/td-agent-gem install fluent-plugin-rewrite-tag-filter\n```\n\n\ntd-agent.conf (\u3053\u306e\u4f8b\u306f daemontools \u3067\u8d77\u52d5\u3057\u3066\u3044\u308b plack \u306e log \u3067\u3059)\n\n```\n# tail \u3067\u62fe\u3046\n<source>\n  @type tail\n  path /service/my-web/log/main/current\n  pos_file /var/log/td-agent/error.log.pos\n  tag plack.raw\n  format /^(?<message>.*)$/\n</source>\n\n# \u6761\u4ef6\u3067 tag \u3064\u3051\u306a\u304a\u3059 rewrite\n<match plack.raw>\n  @type rewrite_tag_filter\n  rewriterule1 message ^.*CRITICAL.*$ plack.error\n  rewriterule2 message ^.*HTTP/1.0\" 404 .*$ plack.error\n</match>\n\n# host \u540d\u4ed8\u4e0e\u3059\u308b\n<filter plack.*>\n  @type record_transformer\n  <record>\n    host ${hostname}\n  </record>\n</filter>\n\n# slack \u306b\u306a\u3052\u308b\n<match plack.error>\n  @type slack\n  webhook_url https://hooks.slack.com/services/xxxx/xxxx/xxxx\n  channel hoge\n  username error\n  icon_emoji :gear:\n  flush_interval 10s\n  message_keys host,message\n  message \"[%s] %s\"\n</match>\n```\n\n", "tags": ["Perl", "td-agent", "fluentd"]}