{"tags": ["bitbucket", "Ruby", "api"], "context": " More than 1 year has passed since last update.\n\nBitbucket | bitbucket_rest_api gem \u3067 \u516c\u958b\u9375\u3092\u767b\u9332\u30fb\u53c2\u7167\u30fb\u524a\u9664 #bitbucket\n\n \u6982\u8981\n bitbucket_rest_api gem \u3067 \u516c\u958b\u9375\u3092\u8ffd\u52a0\u30fb\u53c2\u7167\u30fb\u524a\u9664\u3057\u307e\u3059\u3002\n\n \u524d\u63d0\n\n\u5bfe\u8c61\u30e6\u30fc\u30b6\u30fc\u306f  Bitbucket \u306b\u767b\u9332\u6e08\u307f\n\n bitbucket_rest_api gem \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n\n dotenv gem \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n\n\n \u624b\u9806\n\n Gemfile \u306e\u4f5c\u6210\n\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306b  dotenv gem \u3092\u5229\u7528\u3057\u307e\u3059\nsource \"https://rubygems.org\"\n\ngem \"dotenv\"\ngem \"bitbucket\"\n\n\n .env \u306e\u4f5c\u6210\n\u9375\u306eID\u306f BitBucket \u306b\u767b\u9332\u3059\u308b\u969b\u306e\u30e9\u30d9\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u9375\u306e\u30d1\u30b9\u306f\u767b\u9332\u5bfe\u8c61\u306e\u9375\u306e\u30d1\u30b9\u3092\u8a18\u8ff0\u3059\u308b\u3002\nBasic \u8a8d\u8a3c\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u3002\nPUBLIC_KEY_PATH=public_key_path\nPUBLIC_KEY_ID=deploy\nLOGIN=your_login_name\nPASSWORD=your_password\n\n\n \u9375\u306e\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n new_key\n\u9375\u306e ID \u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  timestamp = Time.now.strftime('%Y%m%d_%H%M%S')\n  bitbucket.users.account.new_key(ENV['LOGIN'], {\n    key: File.read(ENV['PUBLIC_KEY_PATH']),\n    label: \"#{ENV['PUBLIC_KEY_ID']}_#{timestamp}\" \n  })\n  puts \"Complete add '#{ENV['PUBLIC_KEY_ID']}_#{timestamp}' key\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n\n\n \u9375\u767b\u9332\u306e\u5b9f\u884c\n$ ruby new_key.rb\nComplete add 'deploy_20141212_151637' key\n\n\n \u9375\u306e\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n keys\n.env \u30d5\u30a1\u30a4\u30eb\u30fb Gemfile \u306f\u767b\u9332\u51e6\u7406\u3068\u540c\u3058\u3002\n\u81ea\u30e6\u30fc\u30b6\u30fc\u306e\u9375\u3092\u3059\u3079\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  print bitbucket.users.account.keys(ENV['LOGIN']).map { |e|\"id:#{e.pk},label:#{e.label}\" }.join(\"\\n\") + \"\\n\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n\n\n \u9375\u53c2\u7167\u306e\u5b9f\u884c\n$ ruby keys.rb\nid:2249918,label:deploy_20141212_151637\nid:2249873,label:deploy_20141212_150343\nid:2249871,label:deploy_20141212_150247\nid:2249868,label:deploy_20141212_150207\nid:2249860,label:deploy_20141212_150018\nid:2249858,label:deploy_20141212_145946\n\n\n \u9375\u306e\u524a\u9664\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n delete_key\n.env \u30d5\u30a1\u30a4\u30eb\u30fb Gemfile \u306f\u767b\u9332\u51e6\u7406\u3068\u540c\u3058\u3002\n\u767b\u9332\u51e6\u7406\u3067\u8907\u6570\u767b\u9332\u3057\u305f\u9375\u306e\u3046\u3061\u3001\u6700\u65b0\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u9664\u3044\u3066\u524a\u9664\u3057\u307e\u3059\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\ndef show_keys(bitbucket)\n  print bitbucket.users.account.keys(ENV['LOGIN']).map { |e|\"id:#{e.pk},label:#{e.label}\" }.join(\"\\n\") + \"\\n\"\nend\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  puts \"before remove\"\n  show_keys(bitbucket)\n  puts \"start remove\"\n  bitbucket.users.account.keys(ENV['LOGIN']).sort_by { |e|e[:label] }\n            .reverse\n            .drop(1)\n            .each { |e|bitbucket.users.account.delete_key(ENV['LOGIN'], e[:pk]) }\n  puts \"end   remove\"\n  show_keys(bitbucket)\n  puts \"after remove\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n\n\n \u9375\u524a\u9664\u306e\u5b9f\u884c\nruby delete_public_key.rb\n\n\n\u51fa\u529b\n\n$ ruby delete_key.rb\nbefore remove\nid:2249918,label:deploy_20141212_151637\nid:2249873,label:deploy_20141212_150343\nid:2249871,label:deploy_20141212_150247\nid:2249868,label:deploy_20141212_150207\nid:2249860,label:deploy_20141212_150018\nid:2249858,label:deploy_20141212_145946\nstart remove\nend   remove\nafter remove\nid:2249918,label:deploy_20141212_151637\n\n\n\u88dc\u8db3\n\nREST API \u306e\u691c\u8a3c\u6642\u306b\u3001 Bitbucket \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b REST API Console \u3092\u5229\u7528\u3059\u308b\u3068\u4fbf\u5229\u3067\u3059\n\n\n\n REST API Console\n\n\n\n\n\n \u53c2\u7167\n\n\n bitbucket Ruby API wrapper\n\n\n Bitbucket | REST API Document\n\n\n# Bitbucket | bitbucket_rest_api gem \u3067 \u516c\u958b\u9375\u3092\u767b\u9332\u30fb\u53c2\u7167\u30fb\u524a\u9664 #bitbucket\n## <i class=\"fa fa-cubes\" style=\"font-size:1em;\"></i> \u6982\u8981\n<i class=\"fa fa-bitbucket\" style=\"font-size:1em;\"></i> bitbucket_rest_api gem \u3067 \u516c\u958b\u9375\u3092\u8ffd\u52a0\u30fb\u53c2\u7167\u30fb\u524a\u9664\u3057\u307e\u3059\u3002\n## <i class=\"fa fa-cube\" style=\"font-size:1em;\"></i> \u524d\u63d0\n* \u5bfe\u8c61\u30e6\u30fc\u30b6\u30fc\u306f <i class=\"fa fa-bitbucket\" style=\"font-size:1em;\"></i> [Bitbucket](https://bitbucket.org/) \u306b\u767b\u9332\u6e08\u307f\n* <i class=\"fa fa-github-square\" style=\"font-size:1em;\"></i> [bitbucket_rest_api gem](https://github.com/vongrippen/bitbucket) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n* <i class=\"fa fa-external-link-square\" style=\"font-size:1em;\"></i> [dotenv gem](http://rubygems.org/gems/dotenv) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\n\n## <i class=\"fa fa-files-o\" style=\"font-size:1em;\"></i> \u624b\u9806\n### <i class=\"fa fa-gear\" style=\"font-size:1em;\"></i> Gemfile \u306e\u4f5c\u6210\n\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306b <i class=\"fa fa-github-square\" style=\"font-size:1em;\"></i> [dotenv gem](https://github.com/bkeepers/dotenv) \u3092\u5229\u7528\u3057\u307e\u3059\n\n~~~ruby\nsource \"https://rubygems.org\"\n\ngem \"dotenv\"\ngem \"bitbucket\"\n~~~\n\n### <i class=\"fa fa-gear\" style=\"font-size:1em;\"></i> .env \u306e\u4f5c\u6210\n\u9375\u306eID\u306f BitBucket \u306b\u767b\u9332\u3059\u308b\u969b\u306e\u30e9\u30d9\u30eb\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u9375\u306e\u30d1\u30b9\u306f\u767b\u9332\u5bfe\u8c61\u306e\u9375\u306e\u30d1\u30b9\u3092\u8a18\u8ff0\u3059\u308b\u3002\nBasic \u8a8d\u8a3c\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n~~~\nPUBLIC_KEY_PATH=public_key_path\nPUBLIC_KEY_ID=deploy\nLOGIN=your_login_name\nPASSWORD=your_password\n~~~\n\n### <i class=\"fa fa-code\" style=\"font-size:1em;\"></i> \u9375\u306e\u767b\u9332\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n<i class=\"fa fa-external-link-square\" style=\"font-size:1em;\"></i> [new_key](http://www.rubydoc.info/github/vongrippen/bitbucket/master/BitBucket/Users/Account:new_key)\n\n\u9375\u306e ID \u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n~~~ruby\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  timestamp = Time.now.strftime('%Y%m%d_%H%M%S')\n  bitbucket.users.account.new_key(ENV['LOGIN'], {\n    key: File.read(ENV['PUBLIC_KEY_PATH']),\n    label: \"#{ENV['PUBLIC_KEY_ID']}_#{timestamp}\" \n  })\n  puts \"Complete add '#{ENV['PUBLIC_KEY_ID']}_#{timestamp}' key\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n~~~\n\n## <i class=\"fa fa-key\" style=\"font-size:1em;\"></i><i class=\"fa fa-cloud-upload\" style=\"font-size:1em;\"></i> \u9375\u767b\u9332\u306e\u5b9f\u884c\n\n~~~bash\n$ ruby new_key.rb\nComplete add 'deploy_20141212_151637' key\n~~~\n\n### <i class=\"fa fa-code\" style=\"font-size:1em;\"></i> \u9375\u306e\u53c2\u7167\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n<i class=\"fa fa-external-link-square\" style=\"font-size:1em;\"></i> [keys](http://www.rubydoc.info/github/vongrippen/bitbucket/master/BitBucket/Users/Account:keys)\n\n.env \u30d5\u30a1\u30a4\u30eb\u30fb Gemfile \u306f\u767b\u9332\u51e6\u7406\u3068\u540c\u3058\u3002\n\u81ea\u30e6\u30fc\u30b6\u30fc\u306e\u9375\u3092\u3059\u3079\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n~~~ruby\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  print bitbucket.users.account.keys(ENV['LOGIN']).map { |e|\"id:#{e.pk},label:#{e.label}\" }.join(\"\\n\") + \"\\n\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n~~~\n\n## <i class=\"fa fa-key\" style=\"font-size:1em;\"></i><i class=\"fa fa-search\" style=\"font-size:1em;\"></i> \u9375\u53c2\u7167\u306e\u5b9f\u884c\n\n~~~bash\n$ ruby keys.rb\nid:2249918,label:deploy_20141212_151637\nid:2249873,label:deploy_20141212_150343\nid:2249871,label:deploy_20141212_150247\nid:2249868,label:deploy_20141212_150207\nid:2249860,label:deploy_20141212_150018\nid:2249858,label:deploy_20141212_145946\n~~~\n\n### <i class=\"fa fa-code\" style=\"font-size:1em;\"></i> \u9375\u306e\u524a\u9664\u30b9\u30af\u30ea\u30d7\u30c8\nAPI \u306f\u4ee5\u4e0b\u3002\n<i class=\"fa fa-external-link-square\" style=\"font-size:1em;\"></i> [delete_key](http://www.rubydoc.info/github/vongrippen/bitbucket/master/BitBucket/Users/Account:delete_key)\n\n.env \u30d5\u30a1\u30a4\u30eb\u30fb Gemfile \u306f\u767b\u9332\u51e6\u7406\u3068\u540c\u3058\u3002\n\u767b\u9332\u51e6\u7406\u3067\u8907\u6570\u767b\u9332\u3057\u305f\u9375\u306e\u3046\u3061\u3001\u6700\u65b0\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u9664\u3044\u3066\u524a\u9664\u3057\u307e\u3059\n\n~~~ruby\nrequire 'bitbucket_rest_api'\nrequire 'dotenv'\n\ndef show_keys(bitbucket)\n  print bitbucket.users.account.keys(ENV['LOGIN']).map { |e|\"id:#{e.pk},label:#{e.label}\" }.join(\"\\n\") + \"\\n\"\nend\n\nbegin\n  Dotenv.load\n  bitbucket = BitBucket.new basic_auth: \"#{ENV['LOGIN']}:#{ENV['PASSWORD']}\"\n\n  puts \"before remove\"\n  show_keys(bitbucket)\n  puts \"start remove\"\n  bitbucket.users.account.keys(ENV['LOGIN']).sort_by { |e|e[:label] }\n            .reverse\n            .drop(1)\n            .each { |e|bitbucket.users.account.delete_key(ENV['LOGIN'], e[:pk]) }\n  puts \"end   remove\"\n  show_keys(bitbucket)\n  puts \"after remove\"\n  exit(true)\nrescue => e\n  puts e.message\n  exit(false)\nend\n~~~\n\n## <i class=\"fa fa-key\" style=\"font-size:1em;\"></i><i class=\"fa fa-trash\" style=\"font-size:1em;\"></i> \u9375\u524a\u9664\u306e\u5b9f\u884c\n\n~~~bash\nruby delete_public_key.rb\n~~~\n\n* \u51fa\u529b\n\n~~~\n$ ruby delete_key.rb\nbefore remove\nid:2249918,label:deploy_20141212_151637\nid:2249873,label:deploy_20141212_150343\nid:2249871,label:deploy_20141212_150247\nid:2249868,label:deploy_20141212_150207\nid:2249860,label:deploy_20141212_150018\nid:2249858,label:deploy_20141212_145946\nstart remove\nend   remove\nafter remove\nid:2249918,label:deploy_20141212_151637\n~~~\n\n## \u88dc\u8db3\n* REST API \u306e\u691c\u8a3c\u6642\u306b\u3001 Bitbucket \u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b REST API Console \u3092\u5229\u7528\u3059\u308b\u3068\u4fbf\u5229\u3067\u3059\n    * <i class=\"fa fa-bitbucket-square\" style=\"font-size:1em;\"></i> [REST API Console](http://restbrowser.bitbucket.org/)\n\n## <i class=\"fa fa-arrow-circle-right\" style=\"font-size:1em;\"></i> \u53c2\u7167\n* <i class=\"fa fa-github-square\" style=\"font-size:1em;\"></i> [bitbucket Ruby API wrapper](https://github.com/vongrippen/bitbucket)\n* <i class=\"fa fa-bitbucket-square\" style=\"font-size:1em;\"></i> [Bitbucket | REST API Document](https://confluence.atlassian.co.jp/pages/viewpage.action?pageId=33687485)\n"}