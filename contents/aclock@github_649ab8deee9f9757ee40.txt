{"context": " More than 1 year has passed since last update.\u30e6\u30fc\u30b6\u30fc\u4f1a\u3067\u4f7f\u7528\u3057\u305f\u30b9\u30e9\u30a4\u30c9\u306b\u30b3\u30fc\u30c9\u304c\u53ce\u307e\u3089\u306a\u304b\u3063\u305f\u304b\u3089\nQiita\u306b\u4e0a\u3052\u3066\u305f\u3093\u3060\u3051\u3069\u3001\u3084\u3063\u3071\u308a\u4eca\u898b\u3066\u3082\u653e\u7f6e\u306f\u9177\u3044\u3067\u3059\u306d\u3068\u601d\u3046\u306e\u3067\u624b\u76f4\u3057\u3002\nCloudStack\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3042\u308b http://cloudstack.org/dl/cloud-set-guest-password \u306f\n\u76f8\u5909\u308f\u3089\u305a\u30ea\u30f3\u30af\u5207\u308c\u4e2d\u3002\u3084\u308b\u6c17\u3092\u611f\u3058\u307e\u3059\u3002\ncloud-set-guest-password script\u7b49\u3067\u30b0\u30b0\u308b\u3068\u305f\u304f\u3055\u3093\u51fa\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u3061\u3089\u3092\u30d9\u30fc\u30b9\u306bGET\u3057\u3066\u6d41\u7528\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nGET\u3057\u305fcloud-set-guest-password\u3092\u7de8\u96c6\u3002\n\nDHCP_FILES\u306e\u7b87\u6240\u3092CentOS7\u7528\u306b\u3059\u308b\u3068\u3044\u3044\u611f\u3058\u3002\nDHCP_FILES=`find /var/lib/NetworkManager/ -type f -name \\*lease` \n\n\n\u5b9f\u884c\u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u30d5\u30a1\u30a4\u30eb\u79fb\u52d5\n\nchmod +x cloud-set-guest-password\n\nmv cloud-set-guest-password /usr/local/bin/\n\n# vim /usr/local/bin/cloud-set-guest-password\n\n\ncloud-set-guest-password\n#!/bin/bash\n#\n# Init file for Password Download Client\n#\n# chkconfig: 345 98 02\n# description: Password Download Client\n\n# Modify this line to specify the user (default is root)\nuser=root\n# Add your DHCP lease file here\nDHCP_FILES=`find /var/lib/NetworkManager/ -type f -name \\*lease`\n\nfor DHCP_FILE in $DHCP_FILES\ndo\n        if [ -f $DHCP_FILE ]\n        then\n                DOMR_IP=$(grep dhcp-server-identifier $DHCP_FILE | tail -1 | awk '{print $NF}' | tr -d '\\;')\n                break;\n        fi\ndone\n\npassword=$(wget -t 3 -T 20 -O - --header \"DomU_Request: send_my_password\" $DOMR_IP:8080)\n\nif [ $? -ne 0 ]\nthen\n        exit 1\nfi\n\npassword=$(echo $password | tr -d '\\r')\n\nif [ -n \"$password\" ] && [ \"$password\" != \"bad_request\" ] && [ \"$password\" != \"saved_password\" ]\nthen\n        echo $password | passwd --stdin $user\n        if [ $? -gt 0 ]\n        then\n                usermod -p `mkpasswd $password 42` $user\n                if [ $? -gt 0 ]\n                then\n                        exit 1\n                fi\n        fi\n        wget -t 3 -T 20 -O - --header \"DomU_Request: saved_password\" $DOMR_IP:8080\nfi\n\nexit 0\n\n\n\nsystemd\u306b\u3066\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306ecloud-set-guest-password\u81ea\u52d5\u8d77\u52d5\u5316\u306e\u8a2d\u5b9a\n\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\nsystemctl enable cloud-set-guest-password\n\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u614b\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\nsystemctl status cloud-set-guest-password\n\u554f\u984c\u304c\u306a\u3051\u308c\u3070\u8d77\u52d5\u306e\u78ba\u8a8d\u304c\u51fa\u6765\u307e\u3059\u3002\nsystemd[1]: Started CloudStack Password Modification Script.\n\n\u30e6\u30fc\u30b6\u30fc\u4f1a\u3067\u4f7f\u7528\u3057\u305f\u30b9\u30e9\u30a4\u30c9\u306b\u30b3\u30fc\u30c9\u304c\u53ce\u307e\u3089\u306a\u304b\u3063\u305f\u304b\u3089\nQiita\u306b\u4e0a\u3052\u3066\u305f\u3093\u3060\u3051\u3069\u3001\u3084\u3063\u3071\u308a\u4eca\u898b\u3066\u3082\u653e\u7f6e\u306f\u9177\u3044\u3067\u3059\u306d\u3068\u601d\u3046\u306e\u3067\u624b\u76f4\u3057\u3002\n\nCloudStack\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3042\u308b http://cloudstack.org/dl/cloud-set-guest-password \u306f\n\u76f8\u5909\u308f\u3089\u305a\u30ea\u30f3\u30af\u5207\u308c\u4e2d\u3002\u3084\u308b\u6c17\u3092\u611f\u3058\u307e\u3059\u3002\ncloud-set-guest-password script\u7b49\u3067\u30b0\u30b0\u308b\u3068\u305f\u304f\u3055\u3093\u51fa\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u3061\u3089\u3092\u30d9\u30fc\u30b9\u306bGET\u3057\u3066\u6d41\u7528\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n+ GET\u3057\u305fcloud-set-guest-password\u3092\u7de8\u96c6\u3002\n\nDHCP_FILES\u306e\u7b87\u6240\u3092CentOS7\u7528\u306b\u3059\u308b\u3068\u3044\u3044\u611f\u3058\u3002\n\n```sh\nDHCP_FILES=`find /var/lib/NetworkManager/ -type f -name \\*lease` \n```\n+ \u5b9f\u884c\u6a29\u9650\u306e\u4ed8\u4e0e\u3068\u30d5\u30a1\u30a4\u30eb\u79fb\u52d5\n\n```sh\nchmod +x cloud-set-guest-password\n\nmv cloud-set-guest-password /usr/local/bin/\n```\n```sh\n# vim /usr/local/bin/cloud-set-guest-password\n```\n\n```sh:cloud-set-guest-password\n#!/bin/bash\n#\n# Init file for Password Download Client\n#\n# chkconfig: 345 98 02\n# description: Password Download Client\n\n# Modify this line to specify the user (default is root)\nuser=root\n# Add your DHCP lease file here\nDHCP_FILES=`find /var/lib/NetworkManager/ -type f -name \\*lease`\n\nfor DHCP_FILE in $DHCP_FILES\ndo\n        if [ -f $DHCP_FILE ]\n        then\n                DOMR_IP=$(grep dhcp-server-identifier $DHCP_FILE | tail -1 | awk '{print $NF}' | tr -d '\\;')\n                break;\n        fi\ndone\n\npassword=$(wget -t 3 -T 20 -O - --header \"DomU_Request: send_my_password\" $DOMR_IP:8080)\n\nif [ $? -ne 0 ]\nthen\n        exit 1\nfi\n\npassword=$(echo $password | tr -d '\\r')\n\nif [ -n \"$password\" ] && [ \"$password\" != \"bad_request\" ] && [ \"$password\" != \"saved_password\" ]\nthen\n        echo $password | passwd --stdin $user\n        if [ $? -gt 0 ]\n        then\n                usermod -p `mkpasswd $password 42` $user\n                if [ $? -gt 0 ]\n                then\n                        exit 1\n                fi\n        fi\n        wget -t 3 -T 20 -O - --header \"DomU_Request: saved_password\" $DOMR_IP:8080\nfi\n\nexit 0\n```\n\n* systemd\u306b\u3066\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306ecloud-set-guest-password\u81ea\u52d5\u8d77\u52d5\u5316\u306e\u8a2d\u5b9a\n\n1. \u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\nsystemctl enable cloud-set-guest-password\n\n\n1. \u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u614b\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\nsystemctl status cloud-set-guest-password\n\u554f\u984c\u304c\u306a\u3051\u308c\u3070\u8d77\u52d5\u306e\u78ba\u8a8d\u304c\u51fa\u6765\u307e\u3059\u3002\nsystemd[1]: Started CloudStack Password Modification Script.\n", "tags": ["CloudStack"]}