{"context": "Trackrr.io API\u306e\u4e00\u3064\u306b\u8ddd\u96e2\u3092\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070Trackrr.io\u4e0a\u3067\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u3044\u308b\u30d0\u30b9A\u3068\u3001\u81ea\u5206\u3068\u306e\u9593\u306e\u8ddd\u96e2\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4ee5\u524d\u4f5c\u6210\u3057\u305fhtml\u3067\u30b9\u30de\u30d5\u30a9\u306e\u4f4d\u7f6e\u60c5\u5831\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u3001\u30e9\u30ba\u30d1\u30a4\u306b\u8fd1\u3065\u3044\u305f\u3089slack\u3067\u901a\u77e5\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u5148\u307b\u3069\u306e\u4f8b\u3060\u3068\u3001\u30b9\u30de\u30d5\u30a9\u3092\u30d0\u30b9A\u3001\u30e9\u30ba\u30d1\u30a4\u3092\u81ea\u5206\u306b\u7f6e\u304d\u63db\u3048\u308b\u3068\u308f\u304b\u308a\u3084\u3059\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nSlack\u306b\u901a\u77e5\u3057\u3066\u307f\u308b\n\nNode Library for the Slack APIs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ npm install @slack/client --save\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No description\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No repository field.\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No README data\n@slack/client@3.5.3 node_modules/@slack/client\ntqq inherits@2.0.1\ntqq eventemitter3@1.2.0\ntqq url-join@0.0.1\ntqq async@1.5.2\ntqq retry@0.9.0\ntqq ws@1.1.1 (options@0.0.6, ultron@1.0.2)\ntqq bluebird@3.4.1\ntqq https-proxy-agent@1.0.0 (extend@3.0.0, debug@2.2.0, agent-base@2.0.1)\ntqq winston@2.2.0 (cycle@1.0.3, stack-trace@0.0.9, isstream@0.1.2, eyes@0.1.8, async@1.0.0, pkginfo@0.3.1, colors@1.0.3)\ntqq request@2.74.0 (aws-sign2@0.6.0, tunnel-agent@0.4.3, forever-agent@0.6.1, oauth-sign@0.8.2, is-typedarray@1.0.0, caseless@0.11.0, stringstream@0.0.5, aws4@1.4.1, isstream@0.1.2, extend@3.0.0, json-stringify-safe@5.0.1, form-data@1.0.0-rc4, tough-cookie@2.3.1, qs@6.2.1, node-uuid@1.4.7, combined-stream@1.0.5, mime-types@2.1.11, bl@1.1.2, hawk@3.1.3, http-signature@1.1.1, har-validator@2.0.6)\nmqq lodash@4.14.0\npi@raspberrypi:~/trackrr.io-sdk-js-sample$\n\n\nslack.js\u3092\u4f5c\u6210\n\u4eca\u56de\u306fTest token\u3067\u9001\u4fe1\u3057\u307e\u3059\u3002\n\nslack.js\nvar WebClient = require('@slack/client').WebClient;\nvar token = process.env.SLACK_API_TOKEN || '';\nvar web = new WebClient(token);\nweb.chat.postMessage('\u30c1\u30e3\u30f3\u30cd\u30eb\u540d','paspberrypi\u304b\u3089\u9001\u4fe1');\n\n\n\u203bTest token\u306f\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nnode slack.js\u3067\u5b9f\u884c\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\n\u8ddd\u96e2\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\n\u30e9\u30ba\u30d1\u30a4\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308bGPS\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u60c5\u5831\u3067\u8ddd\u96e2\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n\ndistance.js\u3092\u4f5c\u6210\n\ndistance.js\n//\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\nvar serialport = require(\"serialport\");\nvar nmea = require('nmea-0183');\nvar port = '/dev/ttyUSB0';\nvar baudrate = 4800;\nvar readline = '\\r\\n';\nvar https = require('https');\n\nvar receiver = new serialport(port, {\n  baudrate: parseInt(baudrate),\n  parser: serialport.parsers.readline(readline)\n});\n\n//Trackrr.io API\u306e\u8a2d\u5b9a\nvar options = {\n    hostname: 'trackrr.io',\n    port: 443,\n    path: '/api/geoCalc/calc-distance-by-location',\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/json'\n    }\n};\n//GPS\u306e\u53d7\u4fe1\nreceiver.on('data', function(data) {\n        var nmeaData = nmea.parse(data);\n    if (nmeaData['id'] == 'GPRMC') {\n                var postData = JSON.stringify({\n                  \"destCoords\": {\n                    \"latitude\": Number(nmeaData.latitude),\n                    \"longitude\": Number(nmeaData.longitude)\n                  },\n                  \"startGpsKey\": \"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"\n                });\n                console.log(postData);\n                var req = https.request(options, (res) => {\n                        res.on('data', (body) => {\n                        var data = JSON.parse(body);\n                        console.log(data);\n                        });\n                });\n                req.write(postData);\n                req.end();\n    }\n});\n\n\n\u3067\u3001\u5b9f\u884c\u7d50\u679c\u306f\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ node distance.js\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n{ value: 13.946871637221008 }\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n\n{ value: 13.946871637221008 }\u306e\u5024\u304cAPI\u306e\u8fd4\u5374\u5024\u306b\u306a\u308a\u307e\u3059\u3002\u5358\u4f4d\u306f\u30e1\u30fc\u30c8\u30eb\u306a\u306e\u3067\u7d0414\u30e1\u30fc\u30c8\u30eb\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3042\u3068\u306f\u3001\u4e21\u65b9\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u300c\u8fd1\u3065\u3044\u3066\u304d\u305f\u3089slack\u901a\u77e5\u300d\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u8ddd\u96e2\u304c\u8fd1\u3065\u3044\u305f\u3089slack\u901a\u77e5\u3057\u3066\u307f\u308b\n\nnotification.js\n//\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\nvar serialport = require(\"serialport\");\nvar nmea = require('nmea-0183');\nvar port = '/dev/ttyUSB0';\nvar baudrate = 4800;\nvar readline = '\\r\\n';\nvar https = require('https');\n\nvar receiver = new serialport(port, {\n  baudrate: parseInt(baudrate),\n  parser: serialport.parsers.readline(readline)\n});\n\n//Trackrr.io API\u306e\u8a2d\u5b9a\nvar options = {\n    hostname: 'trackrr.io',\n    port: 443,\n    path: '/api/geoCalc/calc-distance-by-location',\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/json'\n    }\n};\n//GPS\u306e\u53d7\u4fe1\nvar threshold = 5;\nreceiver.on('data', function(data) {\n    var nmeaData;\n        try{\n                nmeaData = nmea.parse(data);\n        }catch(e){\n                return;\n        }\n    if (nmeaData['id'] == 'GPRMC') {\n            receiver.pause();\n            var postData = JSON.stringify({\n              \"destCoords\": {\n                \"latitude\": Number(nmeaData.latitude),\n                \"longitude\": Number(nmeaData.longitude)\n              },\n              \"startGpsKey\": \"3daaa2bb091ba1b325b4cfc1fd4e8c5f2f11e9e499608df969420389248a465feb6d43397ed4af7ab708\"\n            });\n            var req = https.request(options, (res) => {\n                    res.on('data', (body) => {\n                    var data = JSON.parse(body);\n                    console.log(data.value + ' \u30e1\u30fc\u30c8\u30eb');\n                    if(data.value <= threshold ){\n                        alreadyPost = true;\n                        var WebClient = require('@slack/client').WebClient;\n                        var token = process.env.SLACK_API_TOKEN || '';\n                        var web = new WebClient(token);\n\n                        web.chat.postMessage('XXXXXXXXXX', threshold + '\u30e1\u30fc\u30c8\u30eb\u4ee5\u5185\u306b\u63a5\u8fd1\u3057\u307e\u3057\u305f',{},()=>{\n                            try{\n                                receiver.close();\n                            }catch(e){}\n                            });\n\n                    }else{\n                        receiver.resume();\n                    }\n                });\n            });\n            req.write(postData);\n            req.end();\n    }\n});\n\n\nAPI\u306e\u623b\u308a\u3092\u5f85\u3064\u305f\u3081\u306bpause\u3068resume\u306e\u5236\u5fa1\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n\u3067\u3001\u5b9f\u884c\u7d50\u679c\u306f\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ node notification.js\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.943679953067919 \u30e1\u30fc\u30c8\u30eb\n6.724093703647338 \u30e1\u30fc\u30c8\u30eb\n6.901201531272668 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.111587767226975 \u30e1\u30fc\u30c8\u30eb\n10.111587767226975 \u30e1\u30fc\u30c8\u30eb\n11.93416830479277 \u30e1\u30fc\u30c8\u30eb\n11.93416830479277 \u30e1\u30fc\u30c8\u30eb\n11.413325129551174 \u30e1\u30fc\u30c8\u30eb\n11.413325129551174 \u30e1\u30fc\u30c8\u30eb\n10.895831331792595 \u30e1\u30fc\u30c8\u30eb\n10.895831331792595 \u30e1\u30fc\u30c8\u30eb\n2.4974182395343565 \u30e1\u30fc\u30c8\u30eb\npi@raspberrypi:~/trackrr.io-sdk-js-sample$\n\n\n\u6765\u3066\u307e\u3059\u306d\uff5e\u3002\n\u306a\u304b\u306a\u304b5\u30e1\u30fc\u30c8\u30eb\u4ee5\u5185\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u30e9\u30ba\u30d1\u30a4\u306e\u6a2a\u306b\u30b9\u30de\u30d5\u30a9\u3092\u7f6e\u3044\u305f\u3089\u3001\u3044\u304d\u306a\u308a2\u30e1\u30fc\u30c8\u30eb\u306b\u306a\u3063\u3066\u901a\u77e5\u304c\u6765\u307e\u3057\u305f\u3002  \n\u3068\u308a\u3042\u3048\u305a\u6210\u529f\u3067\u3059\u3002\n[Trackrr.io API](https://trackrr.io/swagger-ui/index.html)\u306e\u4e00\u3064\u306b\u8ddd\u96e2\u3092\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070Trackrr.io\u4e0a\u3067\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u3044\u308b\u30d0\u30b9A\u3068\u3001\u81ea\u5206\u3068\u306e\u9593\u306e\u8ddd\u96e2\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306f[\u4ee5\u524d\u4f5c\u6210\u3057\u305fhtml](http://qiita.com/YusukeHasegawa/items/f2d2c6af1b6caab03cc6)\u3067\u30b9\u30de\u30d5\u30a9\u306e\u4f4d\u7f6e\u60c5\u5831\u3092\u30c8\u30e9\u30c3\u30ad\u30f3\u30b0\u3057\u3066\u3001\u30e9\u30ba\u30d1\u30a4\u306b\u8fd1\u3065\u3044\u305f\u3089slack\u3067\u901a\u77e5\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5148\u307b\u3069\u306e\u4f8b\u3060\u3068\u3001\u30b9\u30de\u30d5\u30a9\u3092\u30d0\u30b9A\u3001\u30e9\u30ba\u30d1\u30a4\u3092\u81ea\u5206\u306b\u7f6e\u304d\u63db\u3048\u308b\u3068\u308f\u304b\u308a\u3084\u3059\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n#Slack\u306b\u901a\u77e5\u3057\u3066\u307f\u308b\n##Node Library for the Slack APIs\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```shell-session\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ npm install @slack/client --save\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No description\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No repository field.\nnpm WARN package.json trackrr.io-sdk-js-sample@1.0.0 No README data\n@slack/client@3.5.3 node_modules/@slack/client\ntqq inherits@2.0.1\ntqq eventemitter3@1.2.0\ntqq url-join@0.0.1\ntqq async@1.5.2\ntqq retry@0.9.0\ntqq ws@1.1.1 (options@0.0.6, ultron@1.0.2)\ntqq bluebird@3.4.1\ntqq https-proxy-agent@1.0.0 (extend@3.0.0, debug@2.2.0, agent-base@2.0.1)\ntqq winston@2.2.0 (cycle@1.0.3, stack-trace@0.0.9, isstream@0.1.2, eyes@0.1.8, async@1.0.0, pkginfo@0.3.1, colors@1.0.3)\ntqq request@2.74.0 (aws-sign2@0.6.0, tunnel-agent@0.4.3, forever-agent@0.6.1, oauth-sign@0.8.2, is-typedarray@1.0.0, caseless@0.11.0, stringstream@0.0.5, aws4@1.4.1, isstream@0.1.2, extend@3.0.0, json-stringify-safe@5.0.1, form-data@1.0.0-rc4, tough-cookie@2.3.1, qs@6.2.1, node-uuid@1.4.7, combined-stream@1.0.5, mime-types@2.1.11, bl@1.1.2, hawk@3.1.3, http-signature@1.1.1, har-validator@2.0.6)\nmqq lodash@4.14.0\npi@raspberrypi:~/trackrr.io-sdk-js-sample$\n```\n\n##slack.js\u3092\u4f5c\u6210\n\u4eca\u56de\u306fTest token\u3067\u9001\u4fe1\u3057\u307e\u3059\u3002\n\n```js:slack.js\nvar WebClient = require('@slack/client').WebClient;\nvar token = process.env.SLACK_API_TOKEN || '';\nvar web = new WebClient(token);\nweb.chat.postMessage('\u30c1\u30e3\u30f3\u30cd\u30eb\u540d','paspberrypi\u304b\u3089\u9001\u4fe1');\n```\n\u203bTest token\u306f\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n`node slack.js`\u3067\u5b9f\u884c\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/132516/67b8d6ba-7efd-621b-63e4-82e0d732c614.png)\n\n#\u8ddd\u96e2\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\n\u30e9\u30ba\u30d1\u30a4\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308bGPS\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u60c5\u5831\u3067\u8ddd\u96e2\u3092\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002\n\n##distance.js\u3092\u4f5c\u6210\n\n```js:distance.js\n//\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\nvar serialport = require(\"serialport\");\nvar nmea = require('nmea-0183');\nvar port = '/dev/ttyUSB0';\nvar baudrate = 4800;\nvar readline = '\\r\\n';\nvar https = require('https');\n\nvar receiver = new serialport(port, {\n  baudrate: parseInt(baudrate),\n  parser: serialport.parsers.readline(readline)\n});\n\n//Trackrr.io API\u306e\u8a2d\u5b9a\nvar options = {\n    hostname: 'trackrr.io',\n    port: 443,\n    path: '/api/geoCalc/calc-distance-by-location',\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/json'\n    }\n};\n//GPS\u306e\u53d7\u4fe1\nreceiver.on('data', function(data) {\n        var nmeaData = nmea.parse(data);\n    if (nmeaData['id'] == 'GPRMC') {\n                var postData = JSON.stringify({\n                  \"destCoords\": {\n                    \"latitude\": Number(nmeaData.latitude),\n                    \"longitude\": Number(nmeaData.longitude)\n                  },\n                  \"startGpsKey\": \"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"\n                });\n                console.log(postData);\n                var req = https.request(options, (res) => {\n                        res.on('data', (body) => {\n                        var data = JSON.parse(body);\n                        console.log(data);\n                        });\n                });\n                req.write(postData);\n                req.end();\n    }\n});\n```\n\u3067\u3001\u5b9f\u884c\u7d50\u679c\u306f\n\n```shell-session\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ node distance.js\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n{ value: 13.946871637221008 }\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n{\"destCoords\":{\"latitude\":35.69545667,\"longitude\":139.76682167},\"gpsKey\":\"844ebb8f1c9deb4bcbaf1acf765c90d34c19fde2bd6b590556015e56f7ba323647c520f2e409d4f9f93f\"}\n{ value: 13.946871637221008 }\n```\n{ value: 13.946871637221008 }\u306e\u5024\u304cAPI\u306e\u8fd4\u5374\u5024\u306b\u306a\u308a\u307e\u3059\u3002\u5358\u4f4d\u306f\u30e1\u30fc\u30c8\u30eb\u306a\u306e\u3067\u7d0414\u30e1\u30fc\u30c8\u30eb\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3042\u3068\u306f\u3001\u4e21\u65b9\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070**\u300c\u8fd1\u3065\u3044\u3066\u304d\u305f\u3089slack\u901a\u77e5\u300d**\u304c\u3067\u304d\u307e\u3059\u3002\n\n#\u8ddd\u96e2\u304c\u8fd1\u3065\u3044\u305f\u3089slack\u901a\u77e5\u3057\u3066\u307f\u308b\n\n```js:notification.js\n//\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\nvar serialport = require(\"serialport\");\nvar nmea = require('nmea-0183');\nvar port = '/dev/ttyUSB0';\nvar baudrate = 4800;\nvar readline = '\\r\\n';\nvar https = require('https');\n\nvar receiver = new serialport(port, {\n  baudrate: parseInt(baudrate),\n  parser: serialport.parsers.readline(readline)\n});\n\n//Trackrr.io API\u306e\u8a2d\u5b9a\nvar options = {\n    hostname: 'trackrr.io',\n    port: 443,\n    path: '/api/geoCalc/calc-distance-by-location',\n    method: 'POST',\n    headers: {\n        'Content-Type': 'application/json'\n    }\n};\n//GPS\u306e\u53d7\u4fe1\nvar threshold = 5;\nreceiver.on('data', function(data) {\n    var nmeaData;\n        try{\n                nmeaData = nmea.parse(data);\n        }catch(e){\n                return;\n        }\n    if (nmeaData['id'] == 'GPRMC') {\n            receiver.pause();\n            var postData = JSON.stringify({\n              \"destCoords\": {\n                \"latitude\": Number(nmeaData.latitude),\n                \"longitude\": Number(nmeaData.longitude)\n              },\n              \"startGpsKey\": \"3daaa2bb091ba1b325b4cfc1fd4e8c5f2f11e9e499608df969420389248a465feb6d43397ed4af7ab708\"\n            });\n            var req = https.request(options, (res) => {\n                    res.on('data', (body) => {\n                    var data = JSON.parse(body);\n                    console.log(data.value + ' \u30e1\u30fc\u30c8\u30eb');\n                    if(data.value <= threshold ){\n                        alreadyPost = true;\n                        var WebClient = require('@slack/client').WebClient;\n                        var token = process.env.SLACK_API_TOKEN || '';\n                        var web = new WebClient(token);\n\n                        web.chat.postMessage('XXXXXXXXXX', threshold + '\u30e1\u30fc\u30c8\u30eb\u4ee5\u5185\u306b\u63a5\u8fd1\u3057\u307e\u3057\u305f',{},()=>{\n                            try{\n                                receiver.close();\n                            }catch(e){}\n                            });\n\n                    }else{\n                        receiver.resume();\n                    }\n                });\n            });\n            req.write(postData);\n            req.end();\n    }\n});\n```\nAPI\u306e\u623b\u308a\u3092\u5f85\u3064\u305f\u3081\u306b`pause`\u3068`resume`\u306e\u5236\u5fa1\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n\u3067\u3001\u5b9f\u884c\u7d50\u679c\u306f\n\n```shell-session\npi@raspberrypi:~/trackrr.io-sdk-js-sample$ node notification.js\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n8.616847940533734 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.088631416607953 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n7.037313556063385 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.9891696750310555 \u30e1\u30fc\u30c8\u30eb\n6.943679953067919 \u30e1\u30fc\u30c8\u30eb\n6.724093703647338 \u30e1\u30fc\u30c8\u30eb\n6.901201531272668 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.50715297385343 \u30e1\u30fc\u30c8\u30eb\n10.111587767226975 \u30e1\u30fc\u30c8\u30eb\n10.111587767226975 \u30e1\u30fc\u30c8\u30eb\n11.93416830479277 \u30e1\u30fc\u30c8\u30eb\n11.93416830479277 \u30e1\u30fc\u30c8\u30eb\n11.413325129551174 \u30e1\u30fc\u30c8\u30eb\n11.413325129551174 \u30e1\u30fc\u30c8\u30eb\n10.895831331792595 \u30e1\u30fc\u30c8\u30eb\n10.895831331792595 \u30e1\u30fc\u30c8\u30eb\n2.4974182395343565 \u30e1\u30fc\u30c8\u30eb\npi@raspberrypi:~/trackrr.io-sdk-js-sample$\n```\n![ScreenClip.png](https://qiita-image-store.s3.amazonaws.com/0/132516/54702445-8ac2-7546-587a-c302854cab4e.png)\n\n\u6765\u3066\u307e\u3059\u306d\uff5e\u3002\n\u306a\u304b\u306a\u304b5\u30e1\u30fc\u30c8\u30eb\u4ee5\u5185\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u30e9\u30ba\u30d1\u30a4\u306e\u6a2a\u306b\u30b9\u30de\u30d5\u30a9\u3092\u7f6e\u3044\u305f\u3089\u3001\u3044\u304d\u306a\u308a2\u30e1\u30fc\u30c8\u30eb\u306b\u306a\u3063\u3066\u901a\u77e5\u304c\u6765\u307e\u3057\u305f\u3002 :sweat_smile: \n\u3068\u308a\u3042\u3048\u305a\u6210\u529f\u3067\u3059\u3002\n", "tags": ["Trackrr.io", "GPS", "IoT", "RaspberryPi", "Slack"]}