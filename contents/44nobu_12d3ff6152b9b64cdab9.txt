{"tags": ["Ansible", "\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0"], "context": "\n\n\u74b0\u5883\nOS: macOS Sierra 10.12 \n$ ansible --version  \nansible 2.1.2.0\n  config file = /Users/xxxx/.ansible.cfg\n  configured module search path = Default w/o overrides\n$ ssh -V\nOpenSSH_7.2p2, LibreSSL 2.4.1\n\n\n\u73fe\u8c61\n\u5148\u65e5\u3001OS\u3092yosemite\u2192Sierra\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067ansible\u304c\u901a\u3089\u306a\u304f\u306a\u308b\u73fe\u8c61\u304c\u767a\u751f \n\uff08pip\u3068\u304b\u30c4\u30fc\u30eb\u5468\u308a\u3082\u5165\u308c\u76f4\u3057\u3066\u305f\u306e\u3067\u4f55\u304c\u8d77\u56e0\u3067\u767a\u751f\u3060\u3063\u305f\u304b\u306f\u95c7\u306e\u4e2d...)\n$ ansible -i ~/inventory/test -m ping ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com | UNREACHABLE! => {\n    \"changed\": false, \n    \"msg\": \"Failed to connect to the host via ssh.\", \n    \"unreachable\": true\n}\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089ssh\u53e9\u304f\u3068\u554f\u984c\u306a\u304f\u7e4b\u304c\u308b\u305f\u3081\u3001\u3069\u3046\u3084\u3089ansible\u3067\u3064\u306a\u3050\u5834\u5408\u3060\u3051\u4e0a\u624b\u304f\u758e\u901a\u304c\u53d6\u308c\u306a\u3044\u3089\u3057\u3044\u3002\n\u539f\u56e0\u304c\u308f\u304b\u3089\u306a\u3044\u307e\u307e\u3001\u3068\u308a\u3042\u3048\u305a\u8a73\u7d30\u30ed\u30b0\u3092\u51fa\u3057\u3066\u307f\u308b\u3002\n$ ansible -i ~/inventory/test -m ping -vvv ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nUsing /Users/xxxx/.ansible.cfg as config file\n<ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com> ESTABLISH SSH CONNECTION FOR USER: xxxxxxxx\n## \u898b\u96e3\u3044\u305f\u3081\u6539\u884c\u5165\u308c\u3066\u307e\u3059\u304c\uff11\u884c\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\n<ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com> SSH: EXEC ssh -C -q -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no \\\\\n-o 'IdentityFile=\"/Users/xxxx/.ssh/id_rsa\"' -o KbdInteractiveAuthentication=no \n-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey \n-o PasswordAuthentication=no -o User=yyyyyyyyyyyyyyy -o ConnectTimeout=10 \n-o ControlPath=/Users/xxxx/.ansible/cp/ansible-ssh-%h-%p-%r ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com \n'/bin/sh -c '\"'\"'( umask 77 && mkdir -p \"` echo $HOME/.ansible/tmp/ansible-tmp-1476547752.75-109767175351042 `\" && echo ansible-tmp-1476547752.75-109767175351042=\"` echo $HOME/.ansible/tmp/ansible-tmp-1476547752.75-109767175351042 `\" ) && sleep 0'\"'\"''\n\nec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com | UNREACHABLE! => {\n    \"changed\": false, \n    \"msg\": \"Failed to connect to the host via ssh.\", \n    \"unreachable\": true\n}\n\n\u4f7f\u3063\u305f\u3053\u3068\u306e\u306a\u3044ssh\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8272\u3005\u4ed8\u3044\u3066\u304a\u308a\u3001\u3053\u306e\u8fba\u304c\u602a\u3057\u3044\u3002\n\u8a66\u3057\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u540c\u4e00\u30aa\u30d7\u30b7\u30e7\u30f3\u3067ssh\u3092\u53e9\u3044\u3066\u898b\u308b\u3002\nssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no \\\\\n-o 'IdentityFile=\"/Users/xxxx/.ssh/id_rsa\"' -o KbdInteractiveAuthentication=no \\\\\n-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey \\\\\n-o PasswordAuthentication=no -o User=yyyyyyyyyyyyyyy -o ConnectTimeout=10 \\\\\n-o ControlPath=/Users/xxxx/.ansible/cp/ansible-ssh-%h-%p-%r ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nWarning: Permanently added 'ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com,2402:4200:1:297:5054:97ff:fe78:641c' (RSA) to the list of known hosts.\nunix_listener: \"/Users/xxxx/.ansible/cp/ansible-ssh-ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com-22-yyyyyyyyyyyyyyy.AhNsT3MRS29JPVFp\" too long for Unix domain socket\n\n\u3053\u308c\u304c\u539f\u56e0\u3063\u307d\u3044\uff01 \nunix_listener: \"/Users/xxxx/.ansible/cp/ansible-ssh-ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com-22-yyyyyyyyyyyyyyy.AhNsT3MRS29JPVFp\" too long for Unix domain socket\n\n\u53d6\u3063\u639b\u304b\u308a\u3092\u898b\u3064\u3051\u3089\u308c\u305f\u305f\u305f\u3081\u3001\u30b0\u30b0\u3063\u3066\u307f\u308b\u3068\u3042\u3063\u3055\u308a\u3068issue\u3092\u767a\u898b\u3002\nhttps://github.com/ansible/ansible/issues/11536\n\n\u89e3\u6c7a\u65b9\u6cd5\n.ansible.cfg\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0. \n[ssh_connection]\ncontrol_path=/tmp/%%h-%%p-%%r\n\n\u30b3\u30c3\u30c1\u3067\u3082\u554f\u984c\u306a\u3057\uff08\u53c2\u8003)\n[ssh_connection]\ncontrol_path=%(directory)s/%%C\n\n\n\u53c2\u8003\nhttps://github.com/ansible/ansible/issues/11536\nhttp://qiita.com/kawaz/items/a0151d3aa2b6f9c4b3b8\n## \u74b0\u5883\nOS: macOS Sierra 10.12 \n\n```\n$ ansible --version  \nansible 2.1.2.0\n  config file = /Users/xxxx/.ansible.cfg\n  configured module search path = Default w/o overrides\n$ ssh -V\nOpenSSH_7.2p2, LibreSSL 2.4.1\n```\n\n## \u73fe\u8c61\n\u5148\u65e5\u3001OS\u3092yosemite\u2192Sierra\u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067ansible\u304c\u901a\u3089\u306a\u304f\u306a\u308b\u73fe\u8c61\u304c\u767a\u751f \n\uff08pip\u3068\u304b\u30c4\u30fc\u30eb\u5468\u308a\u3082\u5165\u308c\u76f4\u3057\u3066\u305f\u306e\u3067\u4f55\u304c\u8d77\u56e0\u3067\u767a\u751f\u3060\u3063\u305f\u304b\u306f\u95c7\u306e\u4e2d...)\n\n```\n$ ansible -i ~/inventory/test -m ping ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com | UNREACHABLE! => {\n    \"changed\": false, \n    \"msg\": \"Failed to connect to the host via ssh.\", \n    \"unreachable\": true\n}\n```\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089ssh\u53e9\u304f\u3068\u554f\u984c\u306a\u304f\u7e4b\u304c\u308b\u305f\u3081\u3001\u3069\u3046\u3084\u3089ansible\u3067\u3064\u306a\u3050\u5834\u5408\u3060\u3051\u4e0a\u624b\u304f\u758e\u901a\u304c\u53d6\u308c\u306a\u3044\u3089\u3057\u3044\u3002\n\u539f\u56e0\u304c\u308f\u304b\u3089\u306a\u3044\u307e\u307e\u3001\u3068\u308a\u3042\u3048\u305a\u8a73\u7d30\u30ed\u30b0\u3092\u51fa\u3057\u3066\u307f\u308b\u3002\n\n```\n$ ansible -i ~/inventory/test -m ping -vvv ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nUsing /Users/xxxx/.ansible.cfg as config file\n<ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com> ESTABLISH SSH CONNECTION FOR USER: xxxxxxxx\n## \u898b\u96e3\u3044\u305f\u3081\u6539\u884c\u5165\u308c\u3066\u307e\u3059\u304c\uff11\u884c\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\n<ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com> SSH: EXEC ssh -C -q -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no \\\\\n-o 'IdentityFile=\"/Users/xxxx/.ssh/id_rsa\"' -o KbdInteractiveAuthentication=no \n-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey \n-o PasswordAuthentication=no -o User=yyyyyyyyyyyyyyy -o ConnectTimeout=10 \n-o ControlPath=/Users/xxxx/.ansible/cp/ansible-ssh-%h-%p-%r ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com \n'/bin/sh -c '\"'\"'( umask 77 && mkdir -p \"` echo $HOME/.ansible/tmp/ansible-tmp-1476547752.75-109767175351042 `\" && echo ansible-tmp-1476547752.75-109767175351042=\"` echo $HOME/.ansible/tmp/ansible-tmp-1476547752.75-109767175351042 `\" ) && sleep 0'\"'\"''\n\nec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com | UNREACHABLE! => {\n    \"changed\": false, \n    \"msg\": \"Failed to connect to the host via ssh.\", \n    \"unreachable\": true\n}\n```\n\n\u4f7f\u3063\u305f\u3053\u3068\u306e\u306a\u3044ssh\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8272\u3005\u4ed8\u3044\u3066\u304a\u308a\u3001\u3053\u306e\u8fba\u304c\u602a\u3057\u3044\u3002\n\u8a66\u3057\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u540c\u4e00\u30aa\u30d7\u30b7\u30e7\u30f3\u3067ssh\u3092\u53e9\u3044\u3066\u898b\u308b\u3002\n\n```\nssh -C -o ControlMaster=auto -o ControlPersist=60s -o StrictHostKeyChecking=no \\\\\n-o 'IdentityFile=\"/Users/xxxx/.ssh/id_rsa\"' -o KbdInteractiveAuthentication=no \\\\\n-o PreferredAuthentications=gssapi-with-mic,gssapi-keyex,hostbased,publickey \\\\\n-o PasswordAuthentication=no -o User=yyyyyyyyyyyyyyy -o ConnectTimeout=10 \\\\\n-o ControlPath=/Users/xxxx/.ansible/cp/ansible-ssh-%h-%p-%r ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com\nWarning: Permanently added 'ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com,2402:4200:1:297:5054:97ff:fe78:641c' (RSA) to the list of known hosts.\nunix_listener: \"/Users/xxxx/.ansible/cp/ansible-ssh-ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com-22-yyyyyyyyyyyyyyy.AhNsT3MRS29JPVFp\" too long for Unix domain socket\n```\n\n\u3053\u308c\u304c\u539f\u56e0\u3063\u307d\u3044\uff01 \n\n```\nunix_listener: \"/Users/xxxx/.ansible/cp/ansible-ssh-ec2-XX-XXX-XX-XX.eu-west-1.compute.amazonaws.com-22-yyyyyyyyyyyyyyy.AhNsT3MRS29JPVFp\" too long for Unix domain socket\n```\n\n\u53d6\u3063\u639b\u304b\u308a\u3092\u898b\u3064\u3051\u3089\u308c\u305f\u305f\u305f\u3081\u3001\u30b0\u30b0\u3063\u3066\u307f\u308b\u3068\u3042\u3063\u3055\u308a\u3068issue\u3092\u767a\u898b\u3002\n https://github.com/ansible/ansible/issues/11536\n\n## \u89e3\u6c7a\u65b9\u6cd5\n`.ansible.cfg`\u30d5\u30a1\u30a4\u30eb\u306b\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0. \n\n```\n[ssh_connection]\ncontrol_path=/tmp/%%h-%%p-%%r\n```\n\n\u30b3\u30c3\u30c1\u3067\u3082\u554f\u984c\u306a\u3057\uff08[\u53c2\u8003](http://qiita.com/kawaz/items/a0151d3aa2b6f9c4b3b8#comment-8932a2c6a4d83d519bd8]))\n\n```\n[ssh_connection]\ncontrol_path=%(directory)s/%%C\n```\n\n\n## \u53c2\u8003\n https://github.com/ansible/ansible/issues/11536\n http://qiita.com/kawaz/items/a0151d3aa2b6f9c4b3b8\n"}