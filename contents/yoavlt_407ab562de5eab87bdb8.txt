{"context": " More than 1 year has passed since last update.\u524d\u56de\u306e\u7d9a\u304d\u3002\n\u4eca\u56de\u306fEcto.Queryable\u3068\u30af\u30a8\u30ea\u5408\u6210\u3001Migration\u306e\u8a73\u7d30\u3002\n\u9069\u5207\u306a\u9053\u5177\u304c\u3042\u308c\u3070\u3001\u4eba\u9593\u306e\u751f\u7523\u6027\u3068\u601d\u8003\u529b\u306f\u5927\u304d\u304f\u98db\u8e8d\u3059\u308b\u3002Ecto\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u306b\u7279\u5316\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306e\u3088\u3046\u306b\u64cd\u4f5c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u3067\u306f\u771f\u4f3c\u3067\u304d\u306a\u3044\u307b\u3069\u306e\u67d4\u8edf\u6027\u3092\u6301\u3063\u305fElixir\u3060\u304b\u3089\u3053\u305d\u3067\u304d\u308b\u3053\u3068\u3060\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u306eEcto\u3067\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u4f5c\u3089\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306e\u3088\u3046\u306a\u30a8\u30ec\u30ac\u30f3\u30c8\u306aAPI\u3092\u901a\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\nclass\u3067\u3082struct\u3067\u3082\u306a\u304f\u3001\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306fschema\u30de\u30af\u30ed\u3067\u69cb\u7bc9\u3067\u304d\u305f\u3088\u3046\u306b\u3001\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9a\u7fa9\u306b\u304a\u3044\u3066\u3082\u3001SQL\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u3088\u3046\u306b\u3001create\u3084drop\u3092\u901a\u3057\u3066\u64cd\u4f5c\u3067\u304d\u308b\u3002\n\ncreate\nmix ecto.gen.migration create_users\n\n\u3068\u3059\u308b\u3068\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u7a7a\u306echange/0\u95a2\u6570\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u3059\u308b\u3002\ndefmodule MyRepo.Migrations.CreateUsers do\n  use Ecto.Migration\n\n  def change do\n    create table(:users) do\n      add :username, :string\n      add :email, :string\n      add :age, :integer\n      add :group_id, references(:groups)\n\n      timestamps\n    end\n    create index(:users, [:group_id])\n    create index(:users, [:username], unique: true)\n  end\nend\n\ntimestamps\u306f:inserted_at\u3068:updated_at\u3092\u30ab\u30e9\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\ndrop\ndrop\u3067\u30c6\u30fc\u30d6\u30eb\u3084\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\u3059\u308b\u3002\ndrop table(:users)\ndrop index(:users, [:username])\n\n\nalter\nalter\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\nremove\u3001modiry\u3001description\u304c\u4f7f\u3048\u308b\u3002\nalter table(:users) do\n  remove :age\n  modify :age, :years\n  add :description, :text\nend\n\n\nexists?\n\u30c6\u30fc\u30d6\u30eb\u306e\u5b58\u5728\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u304d\u306f\u3053\u3046\u3059\u308b\u3002\nelixir:\nexists? table(:users)\n\n\nrename\nrename\u3067\u30c6\u30fc\u30d6\u30eb\u540d\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\nrename table(:users), table(:new_users)\n\n\nEcto\u306e\u30af\u30a8\u30ea\nElixir\u306e\u30af\u30a8\u30ea\u306ffrom\u30de\u30af\u30ed\u3092\u901a\u3057\u3066\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u305d\u3057\u3066\u95a2\u6570\u5408\u6210\u306e\u3088\u3046\u306b\u30af\u30a8\u30ea\u3092 \u5408\u6210\u53ef\u80fd \u306a\u3053\u3068\u304c\u5927\u304d\u306a\u7279\u5fb4\u3060\u3002\n\u30af\u30a8\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u304a\u99b4\u67d3\u307f\u306eSQL\u306e\u3088\u3046\u306a\u69cb\u6587\u3067\u69cb\u7bc9\u3057\u3066\u3044\u3051\u308b\u3002\nfrom u in User,\nwhere: u.age > 20,\nselect: u.name\n\n\n\u4f7f\u7528\u53ef\u80fd\u306a\u30af\u30a8\u30ea\n\ndistinct\nexclude\nfrom\ngroup_by\nhaving\njoin\nlimit\nlock\noffset\norder_by\npreload\nselect\nupdate\nwhere\n\n\n\u4f7f\u7528\u53ef\u80fd\u306a\u30aa\u30da\u30ec\u30fc\u30bf\u30fc\n\n\n==, !=, <=, >=, <, >\n\n\nand, or, not\n\nin\n\nlike, ilike\n\nis_nil\n\ncount, avg, sum, min, max\n\n\ndatetime_add, date_add\n\n\n\nlike, ilike\n\nfrom b in Books,\nwhere: ilike(b.title, \"Elixir%\")\n\n\navg, sum, min, max\n\nfrom b in Books,\nselect: avg(b.price)\n\n\ndatetime_add, date_add\n\n\u76f4\u8fd11\u30f6\u6708\u306b\u767a\u58f2\u3055\u308c\u305f\u672c\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u30af\u30a8\u30ea\u306f\u3053\u3046\u66f8\u3051\u3070\u826f\u3044\u3002\nfrom book in Books,\nwhere book.published_at > datetime_add(^Ecto.DateTime.utc, -1, \"month\")\n\n\nElixir\u30b3\u30fc\u30c9\u306e\u633f\u5165\nElixir\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30af\u30a8\u30ea\u306b\u542b\u3081\u308b\u306b\u306f\u5909\u6570\u3084\u5f0f\u306e\u524d\u306b^\u3092\u3064\u3051\u308b\u3002\nfrom u in User,\nwhere: u.age > ^age and u.height > ^(height * 100)\n\n\n\u30af\u30a8\u30ea\u306e\u5408\u6210\n\u30af\u30a8\u30ea\u64cd\u4f5c\u306f\u5408\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u7b2c\u4e00\u5f15\u6570\u3092Queryable\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3057\u305f\u5909\u6570\u3092\u53d7\u3051\u53d6\u308b\u95a2\u6570\u5b9a\u7fa9\u3092\u3057\u3066\u304a\u3044\u3066\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3067\u5408\u6210\u3059\u308b\u3068\u304b\u3063\u3053\u3044\u3044\u3002\ndefmodule App.Book do\n  use App.Web, :model\n\n  schema \"books\" do\n    field :title, :string\n    field :price, :integer\n    field :published_at, Ecto.DateTime\n\n    timestamps\n  end\n\n  def published_recently(query) do\n    from b in query,\n    where: b.published_at > datetime_add(^Ecto.DateTime.utc, -1, \"month\")\n  end\n\n  def starts_with(query, title) do\n    from b in query,\n    where: ilike(b.title, ^(title <> \"%\"))\n  end\n\n  def lower_price(query, price) do\n    from b in query,\n    where: b.price < ^price\n  end\nend\n\n\u3068\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u3001\u76f4\u8fd11\u30f6\u6708\u3067\u3001Elixir\u304b\u3089\u59cb\u307e\u308b\u30bf\u30a4\u30c8\u30eb\u304b\u30643000\u5186\u4ee5\u4e0b\u306e\u672c\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u53d6\u5f97\u3057\u3066\u304f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nalias App.Book\nBook \n|> Book.starts_with(\"Elixir\") \n|> Book.lower_price(3000) \n|> Book.published_recently\n|> Repo.all\n\n[\u524d\u56de](http://qiita.com/yoavlt/items/2faa2107eedd8c82ff8f)\u306e\u7d9a\u304d\u3002\n\u4eca\u56de\u306fEcto.Queryable\u3068\u30af\u30a8\u30ea\u5408\u6210\u3001Migration\u306e\u8a73\u7d30\u3002\n\n\u9069\u5207\u306a\u9053\u5177\u304c\u3042\u308c\u3070\u3001\u4eba\u9593\u306e\u751f\u7523\u6027\u3068\u601d\u8003\u529b\u306f\u5927\u304d\u304f\u98db\u8e8d\u3059\u308b\u3002Ecto\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u306b\u7279\u5316\u3057\u305f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306e\u3088\u3046\u306b\u64cd\u4f5c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u3067\u306f\u771f\u4f3c\u3067\u304d\u306a\u3044\u307b\u3069\u306e\u67d4\u8edf\u6027\u3092\u6301\u3063\u305fElixir\u3060\u304b\u3089\u3053\u305d\u3067\u304d\u308b\u3053\u3068\u3060\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u306eEcto\u3067\u306f\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u4f5c\u3089\u308c\u305f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306e\u3088\u3046\u306a\u30a8\u30ec\u30ac\u30f3\u30c8\u306aAPI\u3092\u901a\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n## \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\n`class`\u3067\u3082`struct`\u3067\u3082\u306a\u304f\u3001\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u306f`schema`\u30de\u30af\u30ed\u3067\u69cb\u7bc9\u3067\u304d\u305f\u3088\u3046\u306b\u3001\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9a\u7fa9\u306b\u304a\u3044\u3066\u3082\u3001SQL\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u306e\u3088\u3046\u306b\u3001`create`\u3084`drop`\u3092\u901a\u3057\u3066\u64cd\u4f5c\u3067\u304d\u308b\u3002\n\n### create\n\n```sh:\nmix ecto.gen.migration create_users\n```\n\n\u3068\u3059\u308b\u3068\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u7a7a\u306e`change/0`\u95a2\u6570\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u3001\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u3092\u3059\u308b\u3002\n\n```elixir:\ndefmodule MyRepo.Migrations.CreateUsers do\n  use Ecto.Migration\n\n  def change do\n    create table(:users) do\n      add :username, :string\n      add :email, :string\n      add :age, :integer\n      add :group_id, references(:groups)\n\n      timestamps\n    end\n    create index(:users, [:group_id])\n    create index(:users, [:username], unique: true)\n  end\nend\n```\n\n`timestamps`\u306f`:inserted_at`\u3068`:updated_at`\u3092\u30ab\u30e9\u30e0\u306b\u8ffd\u52a0\u3059\u308b\u3002\n\n### drop\n\ndrop\u3067\u30c6\u30fc\u30d6\u30eb\u3084\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\u3059\u308b\u3002\n\n```elixir:\ndrop table(:users)\ndrop index(:users, [:username])\n```\n\n### alter\n\nalter\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3059\u308b\u3068\u304d\u306b\u4f7f\u3046\u3002\n`remove`\u3001`modiry`\u3001`description`\u304c\u4f7f\u3048\u308b\u3002\n\n```elixir:\nalter table(:users) do\n  remove :age\n  modify :age, :years\n  add :description, :text\nend\n```\n\n### exists?\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u5b58\u5728\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u304d\u306f\u3053\u3046\u3059\u308b\u3002\n```elixir:\nexists? table(:users)\n```\n### rename\n\n`rename`\u3067\u30c6\u30fc\u30d6\u30eb\u540d\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\n```elixir:\nrename table(:users), table(:new_users)\n```\n\n## Ecto\u306e\u30af\u30a8\u30ea\nElixir\u306e\u30af\u30a8\u30ea\u306f`from`\u30de\u30af\u30ed\u3092\u901a\u3057\u3066\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u305d\u3057\u3066\u95a2\u6570\u5408\u6210\u306e\u3088\u3046\u306b\u30af\u30a8\u30ea\u3092 **\u5408\u6210\u53ef\u80fd** \u306a\u3053\u3068\u304c\u5927\u304d\u306a\u7279\u5fb4\u3060\u3002\n\u30af\u30a8\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u304a\u99b4\u67d3\u307f\u306eSQL\u306e\u3088\u3046\u306a\u69cb\u6587\u3067\u69cb\u7bc9\u3057\u3066\u3044\u3051\u308b\u3002\n\n```elixir:\nfrom u in User,\nwhere: u.age > 20,\nselect: u.name\n```\n\n### \u4f7f\u7528\u53ef\u80fd\u306a\u30af\u30a8\u30ea\n\n* `distinct`\n* `exclude`\n* `from`\n* `group_by`\n* `having`\n* `join`\n* `limit`\n* `lock`\n* `offset`\n* `order_by`\n* `preload`\n* `select`\n* `update`\n* `where`\n\n### \u4f7f\u7528\u53ef\u80fd\u306a\u30aa\u30da\u30ec\u30fc\u30bf\u30fc\n\n* `==`, `!=`, `<=`, `>=`, `<`, `>`\n* `and`, `or`, `not`\n* `in`\n* `like`, `ilike`\n* `is_nil`\n* `count`, `avg`, `sum`, `min`, `max`\n* `datetime_add`, `date_add`\n\n#### `like`, `ilike`\n\n```elixir:\nfrom b in Books,\nwhere: ilike(b.title, \"Elixir%\")\n```\n\n#### `avg`, `sum`, `min`, `max`\n\n```elixir:\nfrom b in Books,\nselect: avg(b.price)\n```\n\n#### `datetime_add`, `date_add`\n\n\u76f4\u8fd11\u30f6\u6708\u306b\u767a\u58f2\u3055\u308c\u305f\u672c\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\u30af\u30a8\u30ea\u306f\u3053\u3046\u66f8\u3051\u3070\u826f\u3044\u3002\n\n```elixir:\nfrom book in Books,\nwhere book.published_at > datetime_add(^Ecto.DateTime.utc, -1, \"month\")\n```\n\n### Elixir\u30b3\u30fc\u30c9\u306e\u633f\u5165\n\nElixir\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30af\u30a8\u30ea\u306b\u542b\u3081\u308b\u306b\u306f\u5909\u6570\u3084\u5f0f\u306e\u524d\u306b`^`\u3092\u3064\u3051\u308b\u3002\n\n```elixir:\nfrom u in User,\nwhere: u.age > ^age and u.height > ^(height * 100)\n```\n\n### \u30af\u30a8\u30ea\u306e\u5408\u6210\n\n\u30af\u30a8\u30ea\u64cd\u4f5c\u306f\u5408\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u7b2c\u4e00\u5f15\u6570\u3092Queryable\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3057\u305f\u5909\u6570\u3092\u53d7\u3051\u53d6\u308b\u95a2\u6570\u5b9a\u7fa9\u3092\u3057\u3066\u304a\u3044\u3066\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3067\u5408\u6210\u3059\u308b\u3068\u304b\u3063\u3053\u3044\u3044\u3002\n\n```elixir:\ndefmodule App.Book do\n  use App.Web, :model\n\n  schema \"books\" do\n    field :title, :string\n    field :price, :integer\n    field :published_at, Ecto.DateTime\n\n    timestamps\n  end\n\n  def published_recently(query) do\n    from b in query,\n    where: b.published_at > datetime_add(^Ecto.DateTime.utc, -1, \"month\")\n  end\n\n  def starts_with(query, title) do\n    from b in query,\n    where: ilike(b.title, ^(title <> \"%\"))\n  end\n\n  def lower_price(query, price) do\n    from b in query,\n    where: b.price < ^price\n  end\nend\n```\n\n\u3068\u5b9a\u7fa9\u3057\u3066\u304a\u3051\u3070\u3001\u76f4\u8fd11\u30f6\u6708\u3067\u3001Elixir\u304b\u3089\u59cb\u307e\u308b\u30bf\u30a4\u30c8\u30eb\u304b\u30643000\u5186\u4ee5\u4e0b\u306e\u672c\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u53d6\u5f97\u3057\u3066\u304f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```elixir:\nalias App.Book\nBook \n|> Book.starts_with(\"Elixir\") \n|> Book.lower_price(3000) \n|> Book.published_recently\n|> Repo.all\n```\n", "tags": ["Elixir", "Phoenix", "ecto"]}