{"context": " More than 1 year has passed since last update.\u57fa\u672c\u7684\u306b\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3068\u540c\u3058\u5185\u5bb9\u3067\u3059\u3002\nNode.js/ExpressJS\u3067\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\nhttp://d.hatena.ne.jp/zebevogue/20120828/1346140796\n\u305f\u3060\u3057\u3001\u4f55\u30ab\u6240\u304b\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\nexpress\u30b3\u30de\u30f3\u30c9\n$ express upload\n$ cd upload\n$ npm install\n$ mkdir uploads\n\n\u6d41\u308c\u3068\u3057\u3066\u306f\n1. get '/'\u3067 routes/index.js#index \u304c\u547c\u3070\u308c\u3066\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3057\u3001\n2. post 'upload'\u3067 routes/upload.js#upload \u304c\u547c\u3070\u308c\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u51e6\u7406\u3059\u308b\n\u3068\u3044\u3046\u611f\u3058\u3067\u826f\u3044\u3002\n\u307e\u305a1.\u304b\u3089\u3084\u308b\u3002\n\napp.js\u3092\u7de8\u96c6\u3059\u308b\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n\napp.js\nvar routes = {\n    index  : require('./routes/index'),\n};\n...\napp.get('/', routes.index.index);\n...\n\n\n\nroutes/index.js\n\u500b\u4eba\u7684\u8da3\u5473\u3067CoffeeScript\u3067\u66f8\u3044\u305f\u3002-b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u305fcoffee -bcw index.coffee\u30b3\u30de\u30f3\u30c9\u3067\u5909\u63db\u3059\u308b\u306e\u3067\u3001 app.js \u304b\u3089\u3067\u3082\u4e2d\u307e\u3067\u898b\u3048\u308b\u3002\u3068\u3044\u3046\u304b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u305d\u306e\u307e\u307e\u3002\n\n\nexports.index = (req, res) ->\n  res.render 'index',{\n    title: 'Express'\n  }\n\n\n\nindex.js\nexports.index = function(req, res) {\n  res.render('index', {\n    title: 'Express'\n  });\n};\n\n\n\u53c2\u7167\u3059\u308b index.jade \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u30d5\u30a9\u30fc\u30e0\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\nindex.jade\nextends layout\n\nblock content\n  form(method=\"post\", enctype=\"multipart/form-data\", action=\"/upload\")\n    input(type=\"file\", name=\"thumbnail\")\n    input(type=\"submit\")\n\n\n\u3053\u308c\u3067\u30d5\u30a9\u30fc\u30e0\u304c\u898b\u3048\u308b\u306f\u305a\u3002\n\n\u6b21\u306b2.\u3092\u3084\u308b\n\napp.js\n\napp.js\nvar routes = {\n    index  : require('./routes/index'),\n    upload : require('./routes/upload')\n};\n...\n\napp.configure(function(){\n    ...\n    //app.use(express.bodyParser());\n    app.use(express.bodyParser({uploadDir:'./uploads'}));\n    ...\n});\n\napp.get('/', routes.index.index);\napp.post('/upload', routes.upload.post);\n...\n\n\n\nroutes/upload.js\n\nupload.coffee\nfs = require 'fs'\nexports.post = (req, res) ->\n  # \u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n  tmp_path = req.files.thumbnail.path\n  # public\u4ee5\u4e0b\u306b\u7f6e\u304f\u30d1\u30b9\n  target_path = './uploads/' + req.files.thumbnail.name\n  # public\u4ee5\u4e0b\u306b\u79fb\u52d5\n  fs.rename tmp_path, target_path, (err) ->\n    if err then throw err\n    # \u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n    fs.unlink tmp_path, ->\n      if err then throw err\n      res.send 'File uploaded to: ' + target_path + ' - ' + req.files.thumbnail.size + ' bytes'\n\n\n\nupload.js\nvar fs;\n\nfs = require('fs');\n\nexports.post = function(req, res) {\n  var target_path, tmp_path;\n  tmp_path = req.files.thumbnail.path;\n  target_path = './uploads/' + req.files.thumbnail.name;\n  fs.rename(tmp_path, target_path, function(err) {\n    if (err) {\n      throw err;\n    }\n    fs.unlink(tmp_path, function() {\n      if (err) {\n        throw err;\n      }\n      res.send('File uploaded to: ' + target_path + ' - ' + req.files.thumbnail.size + ' bytes');\n    });\n  });\n};\n\n\n\u3053\u308c\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n\u30d6\u30ed\u30b0\u3084\u3063\u3066\u307e\u3059\uff1aPAPA-tronix !\n\u57fa\u672c\u7684\u306b\u4ee5\u4e0b\u306e\u30da\u30fc\u30b8\u3068\u540c\u3058\u5185\u5bb9\u3067\u3059\u3002\n\nNode.js/ExpressJS\u3067\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\nhttp://d.hatena.ne.jp/zebevogue/20120828/1346140796\n\n\u305f\u3060\u3057\u3001\u4f55\u30ab\u6240\u304b\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n###express\u30b3\u30de\u30f3\u30c9\n\n```\n$ express upload\n$ cd upload\n$ npm install\n$ mkdir uploads\n```\n\n\u6d41\u308c\u3068\u3057\u3066\u306f\n1. ```get '/'```\u3067 **routes/index.js#index** \u304c\u547c\u3070\u308c\u3066\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3057\u3001\n2. ```post 'upload'```\u3067 **routes/upload.js#upload** \u304c\u547c\u3070\u308c\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u51e6\u7406\u3059\u308b\n\u3068\u3044\u3046\u611f\u3058\u3067\u826f\u3044\u3002\n\n\u307e\u305a1.\u304b\u3089\u3084\u308b\u3002\n\n###app.js\u3092\u7de8\u96c6\u3059\u308b\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\u3059\u308b\n\n```js:app.js\nvar routes = {\n\tindex  : require('./routes/index'),\n};\n...\napp.get('/', routes.index.index);\n...\n```\n\n###routes/index.js\n\n\u500b\u4eba\u7684\u8da3\u5473\u3067CoffeeScript\u3067\u66f8\u3044\u305f\u3002```-b```\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u305f```coffee -bcw index.coffee```\u30b3\u30de\u30f3\u30c9\u3067\u5909\u63db\u3059\u308b\u306e\u3067\u3001 **app.js** \u304b\u3089\u3067\u3082\u4e2d\u307e\u3067\u898b\u3048\u308b\u3002\u3068\u3044\u3046\u304b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u305d\u306e\u307e\u307e\u3002\n\n```coffeescript::index.coffee\nexports.index = (req, res) ->\n  res.render 'index',{\n    title: 'Express'\n  }\n```\n\n```js:index.js\nexports.index = function(req, res) {\n  res.render('index', {\n    title: 'Express'\n  });\n};\n```\n\n\u53c2\u7167\u3059\u308b **index.jade** \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u30d5\u30a9\u30fc\u30e0\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n```jade:index.jade\nextends layout\n\nblock content\n  form(method=\"post\", enctype=\"multipart/form-data\", action=\"/upload\")\n    input(type=\"file\", name=\"thumbnail\")\n    input(type=\"submit\")\n```\n\n\u3053\u308c\u3067\u30d5\u30a9\u30fc\u30e0\u304c\u898b\u3048\u308b\u306f\u305a\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2013-08-14 11.15.18.png](https://qiita-image-store.s3.amazonaws.com/0/12939/1b9f1ac9-e909-62e2-2668-de3830071822.png)\n\n\u6b21\u306b2.\u3092\u3084\u308b\n\n###app.js\n\n```js:app.js\nvar routes = {\n\tindex  : require('./routes/index'),\n\tupload : require('./routes/upload')\n};\n...\n\napp.configure(function(){\n\t...\n\t//app.use(express.bodyParser());\n\tapp.use(express.bodyParser({uploadDir:'./uploads'}));\n\t...\n});\n\napp.get('/', routes.index.index);\napp.post('/upload', routes.upload.post);\n...\n```\n\n###routes/upload.js\n\n```coffeescript:upload.coffee\nfs = require 'fs'\nexports.post = (req, res) ->\n  # \u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n  tmp_path = req.files.thumbnail.path\n  # public\u4ee5\u4e0b\u306b\u7f6e\u304f\u30d1\u30b9\n  target_path = './uploads/' + req.files.thumbnail.name\n  # public\u4ee5\u4e0b\u306b\u79fb\u52d5\n  fs.rename tmp_path, target_path, (err) ->\n    if err then throw err\n    # \u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n    fs.unlink tmp_path, ->\n      if err then throw err\n      res.send 'File uploaded to: ' + target_path + ' - ' + req.files.thumbnail.size + ' bytes'\n```\n\n```js:upload.js\nvar fs;\n\nfs = require('fs');\n\nexports.post = function(req, res) {\n  var target_path, tmp_path;\n  tmp_path = req.files.thumbnail.path;\n  target_path = './uploads/' + req.files.thumbnail.name;\n  fs.rename(tmp_path, target_path, function(err) {\n    if (err) {\n      throw err;\n    }\n    fs.unlink(tmp_path, function() {\n      if (err) {\n        throw err;\n      }\n      res.send('File uploaded to: ' + target_path + ' - ' + req.files.thumbnail.size + ' bytes');\n    });\n  });\n};\n```\n\n\u3053\u308c\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2013-08-14 11.18.54.png](https://qiita-image-store.s3.amazonaws.com/0/12939/4b69bd93-f030-34c7-a346-11f977b078b7.png)\n\n-----\n\u30d6\u30ed\u30b0\u3084\u3063\u3066\u307e\u3059\uff1a[PAPA-tronix !](http://weed.cocolog-nifty.com/wzero3es/)\n", "tags": ["Node.js0.11.4", "Express3.3.5", "Jade", "CoffeeScript1.3.3"]}