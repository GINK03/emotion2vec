{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nMemcached \u306e append \u304c\u3001\u540c\u3058\u30ad\u30fc\u3067\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5024\u306e\u9577\u3055\u306b\u3088\u3063\u3066\u51e6\u7406\u901f\u5ea6\u304c\u7570\u306a\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\u6027\u80fd\u304c\u5f90\u3005\u306b\u52a3\u5316\u3059\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\u74b0\u5883\n\u30fb\u30db\u30b9\u30c8\u30de\u30b7\u30f3\n\u30d7\u30ed\u30bb\u30c3\u30b5\uff1aIntel Core2 Duo CPU U9400 @ 1.40GHz\n\u5b9f\u88c5\u30e1\u30e2\u30ea(RAM)\uff1a4.00GB (2.96GB\u4f7f\u7528\u53ef\u80fd)\n\u30b7\u30b9\u30c6\u30e0\u306e\u7a2e\u985e\uff1a32\u30d3\u30c3\u30c8\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\n\u30fb\u30db\u30b9\u30c8OS\nWindows 7 Home Premium Service Pack 1\n\u30fbVM\nVirtualBox 4.3.8 r92456\n\u30d7\u30ed\u30bb\u30c3\u30b5\u30fc\u6570\uff1a1\n\u30e1\u30a4\u30f3\u30e1\u30e2\u30ea\u30fc\uff1a1024MB\n\u30fb\u30b2\u30b9\u30c8OS\nFedora release 20 (Heisenbug)\n\u30fb\u5404\u7a2e\u30d0\u30fc\u30b8\u30e7\u30f3\nMemcached 1.4.17 (memcached-1.4.17-1.fc20.i686)\nPHP 5.5.9 (php-5.5.9-2.fc20.i686)\nlibmemcached-1.0.16-2.fc20.i686\nphp-pecl-memcached-2.1.0-8.fc20.i686\n\n\u5b9f\u884c\u3057\u305f\u5185\u5bb9\n\n\u4e88\u3081Memcached\u306badd\u3057\u3066\u304a\u304f\u3002\u3053\u3053\u3067\u306e\u5024\u306e\u9577\u3055\u3092\u5909\u3048\u306a\u304c\u3089\u4f55\u56de\u304b\u691c\u8a3c\u3059\u308b\u3002\n1\u30d0\u30a4\u30c8\u306e\u30c7\u30fc\u30bf\u3092append\u3059\u308b\u3002\u3053\u306eappend\u51e6\u7406\u306e\u5b9f\u884c\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\u3002\n\n\nmtest.sh\n#!/bin/sh\n\nlen=1\nwhile [ $len -le 1000000 ]\ndo\n    pkill memcached\n    sleep 1\n    echo pgrep:`pgrep memcached`\n    memcached -p 11211 -m 256m -d\n    sleep 1\n    echo pgrep:`pgrep memcached`\n\n    php mtest.php $len\n\n    len=`expr $len \\* 10`\ndone\n\n\n\nmtest.php\n<?php\n\n$len = $argv[1];\n\nprint \"len:$len\\n\";\n\n$m = new Memcached();\n$m->addServer('localhost', 11211);\n$m->setOption(Memcached::OPT_COMPRESSION, false);\n\n$value = str_repeat('a', $len);\n\n$time_total = 0;\nfor ($i = 0; $i < 100; $i++) {\n    $key = uniqid();\n    if (!$m->add($key, $value)) {\n        error_log('ERROR add');\n    }\n\n    $time_start = microtime(true);\n    if (!$m->append($key, 'a')) {\n        error_log('ERROR append');\n    }\n    $time_end = microtime(true);\n        $time = $time_end - $time_start;\n    $time_total += $time;\n}\n\n$avg = $time_total / $i;\n\nprint \"time:\" . $avg . \"\\n\";\nprint \"----------\\n\";\n\n\n\n\u7d50\u679c\n1\u56de\u76ee\n$ ./mtest.sh\npgrep:\npgrep:7177\nlen:1\ntime:0.001196608543396\n----------\npgrep:\npgrep:7191\nlen:10\ntime:0.0013752150535583\n----------\npgrep:\npgrep:7205\nlen:100\ntime:0.0012749838829041\n----------\npgrep:\npgrep:7219\nlen:1000\ntime:0.0013504481315613\n----------\npgrep:\npgrep:7233\nlen:10000\ntime:0.001392662525177\n----------\npgrep:\npgrep:7247\nlen:100000\ntime:0.0020507955551147\n----------\npgrep:\npgrep:7261\nlen:1000000\ntime:0.011878855228424\n----------\n\n2\u56de\u76ee\n$ ./mtest.sh\npgrep:\npgrep:7276\nlen:1\ntime:0.0013153910636902\n----------\npgrep:\npgrep:7290\nlen:10\ntime:0.0012726187705994\n----------\npgrep:\npgrep:7304\nlen:100\ntime:0.0014189291000366\n----------\npgrep:\npgrep:7318\nlen:1000\ntime:0.0013002800941467\n----------\npgrep:\npgrep:7332\nlen:10000\ntime:0.0013521313667297\n----------\npgrep:\npgrep:7346\nlen:100000\ntime:0.0019809556007385\n----------\npgrep:\npgrep:7360\nlen:1000000\ntime:0.010912144184113\n----------\n\n\u5e73\u5747\n\n\n\n\u5143\u306e\u30c7\u30fc\u30bf\u9577(bytes)\nappend\u5b9f\u884c\u6642\u9593\u306e\u5e73\u5747(ms)\n\n\n\n\n1\n1.25\n\n\n10\n1.32\n\n\n100\n1.34\n\n\n1000\n1.32\n\n\n10000\n1.37\n\n\n100000\n2.01\n\n\n1000000\n11.39\n\n\n\n## \u6982\u8981\nMemcached \u306e append \u304c\u3001\u540c\u3058\u30ad\u30fc\u3067\u65e2\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5024\u306e\u9577\u3055\u306b\u3088\u3063\u3066\u51e6\u7406\u901f\u5ea6\u304c\u7570\u306a\u308b\u306e\u304b\u3092\u78ba\u8a8d\u3057\u305f\u3002\n\u6027\u80fd\u304c\u5f90\u3005\u306b\u52a3\u5316\u3059\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n## \u74b0\u5883\n\u30fb\u30db\u30b9\u30c8\u30de\u30b7\u30f3\n\u30d7\u30ed\u30bb\u30c3\u30b5\uff1aIntel Core2 Duo CPU U9400 @ 1.40GHz\n\u5b9f\u88c5\u30e1\u30e2\u30ea(RAM)\uff1a4.00GB (2.96GB\u4f7f\u7528\u53ef\u80fd)\n\u30b7\u30b9\u30c6\u30e0\u306e\u7a2e\u985e\uff1a32\u30d3\u30c3\u30c8\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\n\n\u30fb\u30db\u30b9\u30c8OS\nWindows 7 Home Premium Service Pack 1\n\n\u30fbVM\nVirtualBox 4.3.8 r92456\n\u30d7\u30ed\u30bb\u30c3\u30b5\u30fc\u6570\uff1a1\n\u30e1\u30a4\u30f3\u30e1\u30e2\u30ea\u30fc\uff1a1024MB\n\n\u30fb\u30b2\u30b9\u30c8OS\nFedora release 20 (Heisenbug)\n\n\u30fb\u5404\u7a2e\u30d0\u30fc\u30b8\u30e7\u30f3\nMemcached 1.4.17 (memcached-1.4.17-1.fc20.i686)\nPHP 5.5.9 (php-5.5.9-2.fc20.i686)\nlibmemcached-1.0.16-2.fc20.i686\nphp-pecl-memcached-2.1.0-8.fc20.i686\n\n## \u5b9f\u884c\u3057\u305f\u5185\u5bb9\n* \u4e88\u3081Memcached\u306badd\u3057\u3066\u304a\u304f\u3002\u3053\u3053\u3067\u306e\u5024\u306e\u9577\u3055\u3092\u5909\u3048\u306a\u304c\u3089\u4f55\u56de\u304b\u691c\u8a3c\u3059\u308b\u3002\n* 1\u30d0\u30a4\u30c8\u306e\u30c7\u30fc\u30bf\u3092append\u3059\u308b\u3002\u3053\u306eappend\u51e6\u7406\u306e\u5b9f\u884c\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\u3002\n\n```bash:mtest.sh\n#!/bin/sh\n\nlen=1\nwhile [ $len -le 1000000 ]\ndo\n\tpkill memcached\n\tsleep 1\n\techo pgrep:`pgrep memcached`\n\tmemcached -p 11211 -m 256m -d\n\tsleep 1\n\techo pgrep:`pgrep memcached`\n\n\tphp mtest.php $len\n\n\tlen=`expr $len \\* 10`\ndone\n```\n\n```php:mtest.php\n<?php\n\n$len = $argv[1];\n\nprint \"len:$len\\n\";\n\n$m = new Memcached();\n$m->addServer('localhost', 11211);\n$m->setOption(Memcached::OPT_COMPRESSION, false);\n\n$value = str_repeat('a', $len);\n\n$time_total = 0;\nfor ($i = 0; $i < 100; $i++) {\n\t$key = uniqid();\n\tif (!$m->add($key, $value)) {\n\t\terror_log('ERROR add');\n\t}\n\n\t$time_start = microtime(true);\n\tif (!$m->append($key, 'a')) {\n\t\terror_log('ERROR append');\n\t}\n\t$time_end = microtime(true);\n        $time = $time_end - $time_start;\n\t$time_total += $time;\n}\n\n$avg = $time_total / $i;\n\nprint \"time:\" . $avg . \"\\n\";\nprint \"----------\\n\";\n```\n\n## \u7d50\u679c\n1\u56de\u76ee\n\n```shell-session\n$ ./mtest.sh\npgrep:\npgrep:7177\nlen:1\ntime:0.001196608543396\n----------\npgrep:\npgrep:7191\nlen:10\ntime:0.0013752150535583\n----------\npgrep:\npgrep:7205\nlen:100\ntime:0.0012749838829041\n----------\npgrep:\npgrep:7219\nlen:1000\ntime:0.0013504481315613\n----------\npgrep:\npgrep:7233\nlen:10000\ntime:0.001392662525177\n----------\npgrep:\npgrep:7247\nlen:100000\ntime:0.0020507955551147\n----------\npgrep:\npgrep:7261\nlen:1000000\ntime:0.011878855228424\n----------\n```\n\n2\u56de\u76ee\n\n```shell-session\n$ ./mtest.sh\npgrep:\npgrep:7276\nlen:1\ntime:0.0013153910636902\n----------\npgrep:\npgrep:7290\nlen:10\ntime:0.0012726187705994\n----------\npgrep:\npgrep:7304\nlen:100\ntime:0.0014189291000366\n----------\npgrep:\npgrep:7318\nlen:1000\ntime:0.0013002800941467\n----------\npgrep:\npgrep:7332\nlen:10000\ntime:0.0013521313667297\n----------\npgrep:\npgrep:7346\nlen:100000\ntime:0.0019809556007385\n----------\npgrep:\npgrep:7360\nlen:1000000\ntime:0.010912144184113\n----------\n```\n\n\u5e73\u5747\n\n| \u5143\u306e\u30c7\u30fc\u30bf\u9577(bytes) | append\u5b9f\u884c\u6642\u9593\u306e\u5e73\u5747(ms) |\n|--------------------:|-------------------------:|\n|                   1 |                     1.25 |\n|                  10 |                     1.32 |\n|                 100 |                     1.34 |\n|                1000 |                     1.32 |\n|               10000 |                     1.37 |\n|              100000 |                     2.01 |\n|             1000000 |                    11.39 |\n\n", "tags": ["Memcached"]}