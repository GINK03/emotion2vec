{"context": "\u81ea\u5206\u306e\u30d1\u30bd\u30b3\u30f3\u4e0a\u306b \u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066 VyOS \u3092\u7acb\u3067 Bluemix VPN \u30b5\u30fc\u30d3\u30b9\u306a\u3069\u3068\u63a5\u7d9a\u3067\u304d\u305f\u3089\u4fbf\u5229\u3067\u3059\u3088\u306d\u3002 VPN\u30eb\u30fc\u30bf\u30fc\u7528\u306b\u5c02\u7528\u306b\u30d1\u30bd\u30b3\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u306a\u304f\u3066\u3082\u3001\u30b3\u30b9\u30c8\u3092\u304b\u3051\u305a\u624b\u8efd\u306b\u5b89\u5168\u306b\u5229\u7528\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306f\u3001Bluemix VPN \u30b5\u30fc\u30d3\u30b9 \u3060\u3051\u3067\u306a\u304f\u3001Bluemix Infrastructure (\u65e7SoftLayer)\u306e VPN\u30b5\u30fc\u30d3\u30b9\u306e\u63a5\u7d9a\u306b\u9069\u7528\u3067\u304d\u307e\u3059\u304b\u3089\u3001\u6709\u7528\u6027\u3082\u9ad8\u3044\u3068\u601d\u3044\u307e\u3059\u3002 \n\u3053\u308c\u306f\u63d0\u6848\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u6ce8\u610f\u70b9\u3092\u7406\u89e3\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u307f\u305f\u8a18\u9332\u3067\u3059\u3002\n\n\u69cb\u6210\u56f3\nvagrant + VirtualBox \u3067\u52d5\u4f5c\u3059\u308bVyOS\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\u3068Bluemix\u306eVPN\u30b5\u30fc\u30d3\u30b9\u3068\u3092\u63a5\u7d9a\u3057\u3066\u3001\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9 \u3068 Bluemix \u306e IBM Container \u74b0\u5883\u3092\u30bb\u30ad\u30e5\u30a2\u306b\u63a5\u7d9a\u3059\u308b\n\n\nBluemix VPN \u30b5\u30fc\u30d3\u30b9 \u6ce8\u6587\nBluemix \u306b\u30ed\u30b0\u30a4\u30f3 \u3057\u3066 \u6b21\u306e\u30a2\u30a4\u30b3\u30f3\u304b\u3089 VPN\u30b5\u30fc\u30d3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3057\u307e\u3059\u3002 \u30aa\u30fc\u30c0\u30fc\u6642\u306bIBM Container \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001VPN\u3067\u63a5\u7d9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u306b\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u304c\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u304b\u3089\u3001\u5148\u306b\u9069\u5f53\u306aIBM Container \u3092\u4e00\u3064\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30aa\u30fc\u30c0\u30fc\u304c\u5b8c\u4e86\u3057\u305f\u3089 \u6b21\u306e Create New \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u6b21\u306e\u4e3b\u8981\u306a\u8a2d\u5b9a\u3092\u9032\u3081\u3001Save \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n* Preshared Key String   VyOS\u306eVPN IPSec\u8a2d\u5b9a\u3068\u5171\u6709\u3059\u308b\u30ad\u30fc\u30ef\u30fc\u30c9\n* Customer Gateway IP    \u81ea\u30aa\u30d5\u30a3\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\n* Customer Subnet        \u81ea\u30aa\u30d5\u30a3\u30b9\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\n\n\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9\u306e\u30eb\u30fc\u30bf\u30fc\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5074\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u77e5\u308b\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\nubuntu@ubuntu-xenial:~$ curl ifconfig.me \n126.**.***.***\n\n\nVagrant \u306e\u4eee\u88c5\u30b5\u30fc\u30d0\u30fc\u306e\u74b0\u5883\u3092\u4f5c\u308b\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306e\u74b0\u5883\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002 VirtualBox\u306eVyOS\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306f\u3001https://atlas.hashicorp.com/higebu/boxes/vyos/ \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\nimac:~ maho$ mkdir vyos\nimac:~ maho$ cd vyos\nimac:vyos maho$ vagrant init higebu/vyos\n\nVagrant up \u3059\u308b\u524d\u306b\u3001Vagrantfile \u3092\u7de8\u96c6\u3057\u3066\u304a\u304d\u307e\u3059\u3002 \u7de8\u96c6\u306e\u76ee\u7684\u306f\u4ee5\u4e0b\u306e\uff12\u70b9\u3067\u3059\u3002\n\u30fb\u8a8d\u8a3c\u7528\u516c\u958b\u9375\u306e\u5909\u66f4\u3092\u6b62\u3081\u308b\n\u30fb\u30d6\u30ea\u30c3\u30b8\u30fb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u3066IP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\n\u4ed8\u4e0e\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9\u304c\u3001\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9\u3084\u4ed6\u306evagrant\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u304b\u3089 IBM Container \u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\u306e \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u30aa\u30d5\u30a3\u30b9\u306e\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u304b\u3089\u78ba\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n  # Create a public network, which generally matched to bridged network.\n  # Bridged networks make the machine appear as another physical device on\n  # your network.\n  config.ssh.insert_key = false\n  config.vm.network \"public_network\", bridge: \"en0: Ethernet\", ip: \"192.168.1.76\"\n\nVyOS \u4eee\u88c5\u30eb\u30fc\u30bf\u30fc\u3092\u8d77\u52d5\u3059\u308b\nimac:vyos maho$ vagrant up\n\nVyOS \u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u521d\u671f\u306e\u78ba\u8a8d\u4f5c\u696d\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\nimac:vyos maho$ vagrant ssh\nLinux vyos 3.13.11-1-amd64-vyos #1 SMP Wed Aug 12 02:08:05 UTC 2015 x86_64\nWelcome to VyOS.\nThis system is open-source software. The exact distribution terms for \neach module comprising the full system are described in the individual \nfiles in /usr/share/doc/*/copyright.\n\n\u6700\u521d\u306b eth1 \u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002 VagrantFile\u306e\u8a2d\u5b9a\u304c\u8aa4\u3063\u3066\u3044\u308b\u3068 eth1\u304c\u5b58\u5728\u3057\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nvagrant@vyos:~$ sh int\nCodes: S - State, L - Link, u - Up, D - Down, A - Admin Down\nInterface        IP Address                        S/L  Description\n---------        ----------                        ---  -----------\neth0             10.0.2.15/24                      u/u  \neth1             192.168.1.76/24                   u/u  \nlo               127.0.0.1/8                       u/u  \n                 ::1/128\n\nBluemix \u306e VPN\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\u758e\u901a\u3092\u78ba\u8a8d\u3059\u308b\u3002\nvagrant@vyos:~$ ping 169.46.18.177 \nPING 169.46.18.177 (169.46.18.177) 56(84) bytes of data.\n64 bytes from 169.46.18.177: icmp_req=1 ttl=63 time=145 ms\n64 bytes from 169.46.18.177: icmp_req=2 ttl=63 time=145 ms\n64 bytes from 169.46.18.177: icmp_req=3 ttl=63 time=145 ms\n^C\n--- 169.46.18.177 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2002ms\nrtt min/avg/max/mdev = 145.132/145.174/145.247/0.315 ms\n\n\nVyOS\u306e\u8a2d\u5b9a\n\n\u8a2d\u5b9a\u30e2\u30fc\u30c9\u3078\u5909\u66f4\nVyOS\u306f\u7701\u7565\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u306e\u3067\u3001configure \u3068\u30d5\u30eb\u30b9\u30da\u30eb\u3067\u306f\u306a\u304f\u3001conf\u3067\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\nvagrant@vyos:~$ conf   \n[edit]\n\n\n\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nVagrantFile\u306e\u8a2d\u5b9a\u3057\u305f\u30d6\u30ea\u30c3\u30b8\u7528\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u3001\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002 \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u7406\u7531\u306f\u3001\u4ed6\u306ePC\u306a\u3069\u306e\u30ce\u30fc\u30c9\u304b\u3089\u3082\u5229\u7528\u3067\u304d\u308b\u305f\u3081\u3067\u3059\u3002\nvagrant@vyos# edit interfaces ethernet eth1  \n[edit interfaces ethernet eth1]\nvagrant@vyos# set address 192.168.1.76/24\n[edit interfaces ethernet eth1]\n\n\nVPN\u306e\u8a2d\u5b9a\nBluemix \u306e VPN \u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u306a\u304c\u3089ESP\u3068IKE\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \u3053\u306eESP (Encapsulated Security Payload )\u306f\u3001\u30da\u30a4\u30ed\u30fc\u30c9\u90e8\u306b\u5bfe\u3057\u3066\u6697\u53f7\u5316\u306e\u8a2d\u5b9a\u3067\u3059\u3002IKE(Internet Key Exchange)\u306f\u3001\u9375\u4ea4\u63db\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u3059\u3002\u3000\nipsec-interface \u3067 sh int \u3067\u8868\u793a\u3055\u308c\u308b \u30d6\u30ea\u30c3\u30b8\u5074\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \nnat-networks \u306f\u3001Bluemix VPN \u30b5\u30fc\u30d3\u30b9\u306e\u8a73\u7d30\u306e ( All Single Containers / All Scalable Groups ) \u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nnat-traversal enable \u306f\u3001\u30d6\u30ed\u30fc\u30c9\u30d0\u30f3\u30c9\u30eb\u30fc\u30bf\u30fc\u304c NAT\u3057\u3066\u3044\u308b\u306e\u3067\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n ipsec {\n     esp-group default {  <-- Bluemix VPN \u306e IPsec Policies \u3068\u5408\u308f\u305b\u308b\n         compression disable\n         lifetime 3600\n         mode tunnel\n         pfs dh-group2\n         proposal 1 {\n             encryption aes128\n             hash sha1\n         }\n     }\n     ike-group default {\u3000<-- Bluemix VPN \u306e IKE Policies \u3068\u5408\u308f\u305b\u308b\u3000 \n         ikev2-reauth no\n         key-exchange ikev1\n         lifetime 86400\n         proposal 1 {\n             dh-group 2\n             encryption aes128\n             hash sha1\n         }\n     }\n     ipsec-interfaces {\n         interface eth1\n     }\n     nat-networks {\n         allowed-network 172.29.0.0/16 {\n         }\n     }\n     nat-traversal enable\n\nBluemix VPN\u30b5\u30fc\u30d3\u30b9\u306e\u6761\u4ef6\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nvagrant@vyos# sh ipsec site-to-site \n peer 169.46.18.177 {  <-- Bluemix \u306e VPN \u30eb\u30fc\u30bf\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\n     authentication {\n         id 126.77.118.60  <-- \u81ea\u30b5\u30a4\u30c8\u306e\u30d6\u30ed\u30fc\u30c9\u30d0\u30f3\u30c9\u30eb\u30fc\u30bf\u306b\u4ed8\u4e0e\u3055\u308c\u305f\u30a2\u30c9\u30ec\u30b9\n         mode pre-shared-secret   \n         pre-shared-secret *********  <-- Bluemix VPN\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u5171\u6709\u9375\u3068\u540c\u3058\u3082\u306e\n         remote-id 169.46.18.177  <-- Bluemix \u306e VPN \u30eb\u30fc\u30bf\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\n     }\n     connection-type initiate    <-- \u63a5\u7d9a\u3092\u81ea\u767a\u7684\u306b\u958b\u59cb \n     default-esp-group default   <-- ESP\u3092\u524d\u8ff0\u306edefault\u306b\u8a2d\u5b9a\n     ike-group default           <-- IKE\u3092\u524d\u8ff0\u306edefault\u306b\u8a2d\u5b9a\n     ikev2-reauth inherit\n     local-address any\n     tunnel 1 {\n         local {\n             prefix 192.168.1.0/24  <-- \u81ea\u74b0\u5883\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a2\u30c9\u30ec\u30b9 \n         }\n         remote {\n             prefix 172.29.0.0/16   <-- IBM Container \u306e\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\n         }\n     }\n }\n[edit vpn]\n\n\n\u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u52d5\u4f5c\u78ba\u8a8d\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8a2d\u5b9a\u5909\u66f4\u306e\u78ba\u5b9a\u3068\u6c38\u7d9a\u5316\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\nvagrant@vyos# commit\nvagrant@vyos# save\n\n\u8a2d\u5b9a\u30e2\u30fc\u30c9\u304b\u3089\u629c\u3051\u3066\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001state \u304c up \u3067\u3042\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\nvagrant@vyos:~$ sh vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n169.46.18.177                           10.0.2.15                              \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash    NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----    -----  ------  ------  -----\n    1       up     0.0/0.0        aes128   sha1    yes    1314    3600    all\n\n\n\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\n\u8a2d\u5b9a\u304c\u9593\u9055\u3044\u306a\u3069\u3067\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u304cIPSec\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u78ba\u7acb\u3067\u304d\u306a\u3044\u5834\u5408\u306e\u554f\u984c\u5224\u5225\u306e\u30d2\u30f3\u30c8\u3067\u3059\u3002\n\nsh vpn debug \u3067 pending \u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u63a2\u3057\u3066\u6b62\u307e\u3063\u3066\u308b\u7b87\u6240\u3092\u7279\u5b9a\nsh log tail \u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u5931\u6557\u3092\u78ba\u8a8d\nsh vpn ike sa, sh vpn ipsec sa \u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n\n\n\u758e\u901a\u8a66\u9a13\nVyOS\u306e\u30d6\u30ea\u30c3\u30b8\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9\u306b\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ntkr@raspi1 ~ $ netstat -r\nKernel IP routing table\nDestination     Gateway         Genmask         Flags   MSS Window  irtt Iface\ndefault         192.168.1.1     0.0.0.0         UG        0 0          0 eth0\n172.29.0.0      192.168.1.76    255.255.0.0     UG        0 0          0 eth0\n192.168.1.0     *               255.255.255.0   U         0 0          0 eth0\n192.168.1.0     *               255.255.255.0   U         0 0          0 eth0.1\n\nIBM Container \u306b\u5411\u3051\u3066 ping \u306b\u5fdc\u7b54\u304c\u3042\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ntkr@raspi1 ~ $ ping 172.29.0.48\nPING 172.29.0.48 (172.29.0.48) 56(84) bytes of data.\n64 bytes from 172.29.0.48: icmp_req=1 ttl=62 time=138 ms\n64 bytes from 172.29.0.48: icmp_req=2 ttl=62 time=137 ms\n64 bytes from 172.29.0.48: icmp_req=3 ttl=62 time=137 ms\n^C\n--- 172.29.0.48 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 137.700/138.014/138.446/0.532 ms\n\ntraceroute \u3067 \u7d4c\u8def\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ntkr@raspi1 ~ $ traceroute 172.29.0.48\ntraceroute to 172.29.0.48 (172.29.0.48), 30 hops max, 60 byte packets\n 1  192.168.1.76 (192.168.1.76)  0.864 ms  0.503 ms  0.726 ms\n 2  * * *\n 3  172.29.0.48 (172.29.0.48)  137.325 ms  137.757 ms  137.515 ms\n\nIBM Container ibmnode\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\ntkr@raspi1 ~ $ curl http://172.29.0.48:3000\nHello World!\n\n\u4ee5\u4e0a\u3001VirutalBox \u4e0a\u306e VyOS\u30eb\u30fc\u30bf \u3068 Bluemix VPN \u3068\u306e VPN\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nVyOS\u5168\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\nvagrant@vyos:~$ sh conf\ninterfaces {\n    ethernet eth0 {\n        address dhcp\n        duplex auto\n        hw-id 08:00:27:0f:ec:bf\n        smp_affinity auto\n        speed auto\n    }\n    ethernet eth1 {\n        address 192.168.1.76/24\n        duplex auto\n        hw-id 08:00:27:7a:71:aa\n        smp_affinity auto\n        speed auto\n    }\n    loopback lo {\n    }\n}\nservice {\n    ssh {\n        disable-host-validation\n        port 22\n    }\n}\nsystem {\n    config-management {\n        commit-revisions 20\n    }\n    gateway-address 192.168.1.1\n    host-name vyos\n    ntp {\n        server 0.pool.ntp.org {\n        }\n        server 1.pool.ntp.org {\n        }\n        server 2.pool.ntp.org {\n        }\n    }\n    package {\n        auto-sync 1\n        repository community {\n            components main\n            distribution helium\n            password ****************\n            url http://packages.vyos.net/vyos\n            username \"\"\n        }\n    }\n    syslog {\n        global {\n            facility all {\n                level notice\n            }\n            facility protocols {\n                level debug\n            }\n        }\n    }\n    time-zone UTC\n}\nvpn {\n    ipsec {\n        esp-group default {\n            compression disable\n            lifetime 3600\n            mode tunnel\n            pfs dh-group2\n            proposal 1 {\n                encryption aes128\n                hash sha1\n            }\n        }\n        ike-group default {\n            ikev2-reauth no\n            key-exchange ikev1\n            lifetime 86400\n            proposal 1 {\n                dh-group 2\n                encryption aes128\n                hash sha1\n            }\n        }\n        ipsec-interfaces {\n            interface eth1\n        }\n        nat-networks {\n            allowed-network 172.29.0.0/16 {\n            }\n        }\n        nat-traversal enable\n        site-to-site {\n            peer 169.46.18.177 {\n                authentication {\n                    id **.**.**.** <- \u79d8\u5bc6\u3067\u3059\n                    mode pre-shared-secret\n                    pre-shared-secret ****************\n                    remote-id 169.46.18.177\n                }\n                connection-type initiate\n                default-esp-group default\n                ike-group default\n                ikev2-reauth inherit\n                local-address any\n                tunnel 1 {\n                    allow-nat-networks disable\n                    allow-public-networks disable\n                    local {\n                        prefix 192.168.1.0/24\n                    }\n                    remote {\n                        prefix 172.29.0.0/16\n                    }\n                }\n            }\n        }\n    }\n}\n\n\u81ea\u5206\u306e\u30d1\u30bd\u30b3\u30f3\u4e0a\u306b \u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066 VyOS \u3092\u7acb\u3067 Bluemix VPN \u30b5\u30fc\u30d3\u30b9\u306a\u3069\u3068\u63a5\u7d9a\u3067\u304d\u305f\u3089\u4fbf\u5229\u3067\u3059\u3088\u306d\u3002 VPN\u30eb\u30fc\u30bf\u30fc\u7528\u306b\u5c02\u7528\u306b\u30d1\u30bd\u30b3\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u306a\u304f\u3066\u3082\u3001\u30b3\u30b9\u30c8\u3092\u304b\u3051\u305a\u624b\u8efd\u306b\u5b89\u5168\u306b\u5229\u7528\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306f\u3001Bluemix VPN \u30b5\u30fc\u30d3\u30b9 \u3060\u3051\u3067\u306a\u304f\u3001Bluemix Infrastructure (\u65e7SoftLayer)\u306e VPN\u30b5\u30fc\u30d3\u30b9\u306e\u63a5\u7d9a\u306b\u9069\u7528\u3067\u304d\u307e\u3059\u304b\u3089\u3001\u6709\u7528\u6027\u3082\u9ad8\u3044\u3068\u601d\u3044\u307e\u3059\u3002 \n\n\u3053\u308c\u306f\u63d0\u6848\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u6ce8\u610f\u70b9\u3092\u7406\u89e3\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u307f\u305f\u8a18\u9332\u3067\u3059\u3002\n\n\n# \u69cb\u6210\u56f3\nvagrant + VirtualBox \u3067\u52d5\u4f5c\u3059\u308bVyOS\u4eee\u60f3\u30eb\u30fc\u30bf\u30fc\u3068Bluemix\u306eVPN\u30b5\u30fc\u30d3\u30b9\u3068\u3092\u63a5\u7d9a\u3057\u3066\u3001\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9 \u3068 Bluemix \u306e IBM Container \u74b0\u5883\u3092\u30bb\u30ad\u30e5\u30a2\u306b\u63a5\u7d9a\u3059\u308b\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-17 11.13.26.png](https://qiita-image-store.s3.amazonaws.com/0/42829/34266b3a-24f1-3a20-af7d-17c434aa1b75.png)\n\n\n\n# Bluemix VPN \u30b5\u30fc\u30d3\u30b9 \u6ce8\u6587\n\nBluemix \u306b\u30ed\u30b0\u30a4\u30f3 \u3057\u3066 \u6b21\u306e\u30a2\u30a4\u30b3\u30f3\u304b\u3089 VPN\u30b5\u30fc\u30d3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3057\u307e\u3059\u3002 \u30aa\u30fc\u30c0\u30fc\u6642\u306bIBM Container \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001VPN\u3067\u63a5\u7d9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u306b\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u304c\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u304b\u3089\u3001\u5148\u306b\u9069\u5f53\u306aIBM Container \u3092\u4e00\u3064\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-17 9.46.42.png](https://qiita-image-store.s3.amazonaws.com/0/42829/80b7e918-85c5-effb-bbc9-6edbdf20c63b.png)\n\n\u30aa\u30fc\u30c0\u30fc\u304c\u5b8c\u4e86\u3057\u305f\u3089 \u6b21\u306e Create New \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a2d\u5b9a\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-17 10.26.10.png](https://qiita-image-store.s3.amazonaws.com/0/42829/5ee9b2ce-de3e-49aa-e255-d9492eb3eae2.png)\n\n\u6b21\u306e\u4e3b\u8981\u306a\u8a2d\u5b9a\u3092\u9032\u3081\u3001Save \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n* Preshared Key String   VyOS\u306eVPN IPSec\u8a2d\u5b9a\u3068\u5171\u6709\u3059\u308b\u30ad\u30fc\u30ef\u30fc\u30c9\n* Customer Gateway IP    \u81ea\u30aa\u30d5\u30a3\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30a2\u30c9\u30ec\u30b9\n* Customer Subnet        \u81ea\u30aa\u30d5\u30a3\u30b9\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-17 10.33.14.png](https://qiita-image-store.s3.amazonaws.com/0/42829/5781d1fe-e1f6-4d8e-ef95-e8f79f81a9a2.png)\n\n\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9\u306e\u30eb\u30fc\u30bf\u30fc\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5074\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u77e5\u308b\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\n\n~~~\nubuntu@ubuntu-xenial:~$ curl ifconfig.me \n126.**.***.***\n~~~\n\n\n\n# Vagrant \u306e\u4eee\u88c5\u30b5\u30fc\u30d0\u30fc\u306e\u74b0\u5883\u3092\u4f5c\u308b\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306e\u74b0\u5883\u3092\u521d\u671f\u5316\u3057\u307e\u3059\u3002 VirtualBox\u306eVyOS\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306f\u3001https://atlas.hashicorp.com/higebu/boxes/vyos/ \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n~~~\nimac:~ maho$ mkdir vyos\nimac:~ maho$ cd vyos\nimac:vyos maho$ vagrant init higebu/vyos\n~~~\n\nVagrant up \u3059\u308b\u524d\u306b\u3001Vagrantfile \u3092\u7de8\u96c6\u3057\u3066\u304a\u304d\u307e\u3059\u3002 \u7de8\u96c6\u306e\u76ee\u7684\u306f\u4ee5\u4e0b\u306e\uff12\u70b9\u3067\u3059\u3002\n\u30fb\u8a8d\u8a3c\u7528\u516c\u958b\u9375\u306e\u5909\u66f4\u3092\u6b62\u3081\u308b\n\u30fb\u30d6\u30ea\u30c3\u30b8\u30fb\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u3066IP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\n\u4ed8\u4e0e\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9\u304c\u3001\u81ea\u5206\u306e\u30aa\u30d5\u30a3\u30b9\u3084\u4ed6\u306evagrant\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u304b\u3089 IBM Container \u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5834\u5408\u306e \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u30a2\u30c9\u30ec\u30b9\u306b\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u30aa\u30d5\u30a3\u30b9\u306e\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\u304b\u3089\u78ba\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n~~~\n  # Create a public network, which generally matched to bridged network.\n  # Bridged networks make the machine appear as another physical device on\n  # your network.\n  config.ssh.insert_key = false\n  config.vm.network \"public_network\", bridge: \"en0: Ethernet\", ip: \"192.168.1.76\"\n~~~\n\n\n\nVyOS \u4eee\u88c5\u30eb\u30fc\u30bf\u30fc\u3092\u8d77\u52d5\u3059\u308b\n\n~~~\nimac:vyos maho$ vagrant up\n~~~\n\nVyOS \u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u521d\u671f\u306e\u78ba\u8a8d\u4f5c\u696d\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n~~~\nimac:vyos maho$ vagrant ssh\nLinux vyos 3.13.11-1-amd64-vyos #1 SMP Wed Aug 12 02:08:05 UTC 2015 x86_64\nWelcome to VyOS.\nThis system is open-source software. The exact distribution terms for \neach module comprising the full system are described in the individual \nfiles in /usr/share/doc/*/copyright.\n~~~\n\n\n\u6700\u521d\u306b eth1 \u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002 VagrantFile\u306e\u8a2d\u5b9a\u304c\u8aa4\u3063\u3066\u3044\u308b\u3068 eth1\u304c\u5b58\u5728\u3057\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n~~~\nvagrant@vyos:~$ sh int\nCodes: S - State, L - Link, u - Up, D - Down, A - Admin Down\nInterface        IP Address                        S/L  Description\n---------        ----------                        ---  -----------\neth0             10.0.2.15/24                      u/u  \neth1             192.168.1.76/24                   u/u  \nlo               127.0.0.1/8                       u/u  \n                 ::1/128\n~~~\n\n\nBluemix \u306e VPN\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\u758e\u901a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~\nvagrant@vyos:~$ ping 169.46.18.177 \nPING 169.46.18.177 (169.46.18.177) 56(84) bytes of data.\n64 bytes from 169.46.18.177: icmp_req=1 ttl=63 time=145 ms\n64 bytes from 169.46.18.177: icmp_req=2 ttl=63 time=145 ms\n64 bytes from 169.46.18.177: icmp_req=3 ttl=63 time=145 ms\n^C\n--- 169.46.18.177 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2002ms\nrtt min/avg/max/mdev = 145.132/145.174/145.247/0.315 ms\n~~~\n\n\n# VyOS\u306e\u8a2d\u5b9a\n\n\n## \u8a2d\u5b9a\u30e2\u30fc\u30c9\u3078\u5909\u66f4\nVyOS\u306f\u7701\u7565\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u306e\u3067\u3001configure \u3068\u30d5\u30eb\u30b9\u30da\u30eb\u3067\u306f\u306a\u304f\u3001conf\u3067\u5909\u66f4\u3067\u304d\u307e\u3059\u3002\n\n~~~\nvagrant@vyos:~$ conf   \n[edit]\n~~~\n\n## \u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306e\u8a2d\u5b9a\nVagrantFile\u306e\u8a2d\u5b9a\u3057\u305f\u30d6\u30ea\u30c3\u30b8\u7528\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306b\u3001\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002 \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u7406\u7531\u306f\u3001\u4ed6\u306ePC\u306a\u3069\u306e\u30ce\u30fc\u30c9\u304b\u3089\u3082\u5229\u7528\u3067\u304d\u308b\u305f\u3081\u3067\u3059\u3002\n\n~~~\nvagrant@vyos# edit interfaces ethernet eth1  \n[edit interfaces ethernet eth1]\nvagrant@vyos# set address 192.168.1.76/24\n[edit interfaces ethernet eth1]\n~~~\n\n\n## VPN\u306e\u8a2d\u5b9a\n\nBluemix \u306e VPN \u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u306a\u304c\u3089ESP\u3068IKE\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \u3053\u306eESP (Encapsulated Security Payload )\u306f\u3001\u30da\u30a4\u30ed\u30fc\u30c9\u90e8\u306b\u5bfe\u3057\u3066\u6697\u53f7\u5316\u306e\u8a2d\u5b9a\u3067\u3059\u3002IKE(Internet Key Exchange)\u306f\u3001\u9375\u4ea4\u63db\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3067\u3059\u3002\u3000\nipsec-interface \u3067 sh int \u3067\u8868\u793a\u3055\u308c\u308b \u30d6\u30ea\u30c3\u30b8\u5074\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002 \nnat-networks \u306f\u3001Bluemix VPN \u30b5\u30fc\u30d3\u30b9\u306e\u8a73\u7d30\u306e ( All Single Containers / All Scalable Groups ) \u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nnat-traversal enable \u306f\u3001\u30d6\u30ed\u30fc\u30c9\u30d0\u30f3\u30c9\u30eb\u30fc\u30bf\u30fc\u304c NAT\u3057\u3066\u3044\u308b\u306e\u3067\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n~~~\n ipsec {\n     esp-group default {  <-- Bluemix VPN \u306e IPsec Policies \u3068\u5408\u308f\u305b\u308b\n         compression disable\n         lifetime 3600\n         mode tunnel\n         pfs dh-group2\n         proposal 1 {\n             encryption aes128\n             hash sha1\n         }\n     }\n     ike-group default {\u3000<-- Bluemix VPN \u306e IKE Policies \u3068\u5408\u308f\u305b\u308b\u3000 \n         ikev2-reauth no\n         key-exchange ikev1\n         lifetime 86400\n         proposal 1 {\n             dh-group 2\n             encryption aes128\n             hash sha1\n         }\n     }\n     ipsec-interfaces {\n         interface eth1\n     }\n     nat-networks {\n         allowed-network 172.29.0.0/16 {\n         }\n     }\n     nat-traversal enable\n~~~\n\nBluemix VPN\u30b5\u30fc\u30d3\u30b9\u306e\u6761\u4ef6\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n~~~\nvagrant@vyos# sh ipsec site-to-site \n peer 169.46.18.177 {  <-- Bluemix \u306e VPN \u30eb\u30fc\u30bf\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\n     authentication {\n         id 126.77.118.60  <-- \u81ea\u30b5\u30a4\u30c8\u306e\u30d6\u30ed\u30fc\u30c9\u30d0\u30f3\u30c9\u30eb\u30fc\u30bf\u306b\u4ed8\u4e0e\u3055\u308c\u305f\u30a2\u30c9\u30ec\u30b9\n         mode pre-shared-secret   \n         pre-shared-secret *********  <-- Bluemix VPN\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u5171\u6709\u9375\u3068\u540c\u3058\u3082\u306e\n         remote-id 169.46.18.177  <-- Bluemix \u306e VPN \u30eb\u30fc\u30bf\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\n     }\n     connection-type initiate    <-- \u63a5\u7d9a\u3092\u81ea\u767a\u7684\u306b\u958b\u59cb \n     default-esp-group default   <-- ESP\u3092\u524d\u8ff0\u306edefault\u306b\u8a2d\u5b9a\n     ike-group default           <-- IKE\u3092\u524d\u8ff0\u306edefault\u306b\u8a2d\u5b9a\n     ikev2-reauth inherit\n     local-address any\n     tunnel 1 {\n         local {\n             prefix 192.168.1.0/24  <-- \u81ea\u74b0\u5883\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u30a2\u30c9\u30ec\u30b9 \n         }\n         remote {\n             prefix 172.29.0.0/16   <-- IBM Container \u306e\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\n         }\n     }\n }\n[edit vpn]\n~~~\n\n## \u8a2d\u5b9a\u306e\u78ba\u5b9a\u3068\u52d5\u4f5c\u78ba\u8a8d\n\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u8a2d\u5b9a\u5909\u66f4\u306e\u78ba\u5b9a\u3068\u6c38\u7d9a\u5316\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n~~~\nvagrant@vyos# commit\nvagrant@vyos# save\n~~~\n\n\u8a2d\u5b9a\u30e2\u30fc\u30c9\u304b\u3089\u629c\u3051\u3066\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001state \u304c up \u3067\u3042\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\n~~~\nvagrant@vyos:~$ sh vpn ipsec sa\nPeer ID / IP                            Local ID / IP               \n------------                            -------------\n169.46.18.177                           10.0.2.15                              \n\n    Tunnel  State  Bytes Out/In   Encrypt  Hash    NAT-T  A-Time  L-Time  Proto\n    ------  -----  -------------  -------  ----    -----  ------  ------  -----\n    1       up     0.0/0.0        aes128   sha1    yes    1314    3600    all\n~~~\n\n\n## \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\n\n\u8a2d\u5b9a\u304c\u9593\u9055\u3044\u306a\u3069\u3067\u3001\u30bb\u30c3\u30b7\u30e7\u30f3\u304cIPSec\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u78ba\u7acb\u3067\u304d\u306a\u3044\u5834\u5408\u306e\u554f\u984c\u5224\u5225\u306e\u30d2\u30f3\u30c8\u3067\u3059\u3002\n\n* sh vpn debug \u3067 pending \u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u63a2\u3057\u3066\u6b62\u307e\u3063\u3066\u308b\u7b87\u6240\u3092\u7279\u5b9a\n* sh log tail \u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u5931\u6557\u3092\u78ba\u8a8d\n* sh vpn ike sa, sh vpn ipsec sa \u3067\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u72b6\u614b\u3092\u78ba\u8a8d\n\n\n\n# \u758e\u901a\u8a66\u9a13\n\nVyOS\u306e\u30d6\u30ea\u30c3\u30b8\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9\u306b\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n~~~\ntkr@raspi1 ~ $ netstat -r\nKernel IP routing table\nDestination     Gateway         Genmask         Flags   MSS Window  irtt Iface\ndefault         192.168.1.1     0.0.0.0         UG        0 0          0 eth0\n172.29.0.0      192.168.1.76    255.255.0.0     UG        0 0          0 eth0\n192.168.1.0     *               255.255.255.0   U         0 0          0 eth0\n192.168.1.0     *               255.255.255.0   U         0 0          0 eth0.1\n~~~\n\nIBM Container \u306b\u5411\u3051\u3066 ping \u306b\u5fdc\u7b54\u304c\u3042\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n~~~\ntkr@raspi1 ~ $ ping 172.29.0.48\nPING 172.29.0.48 (172.29.0.48) 56(84) bytes of data.\n64 bytes from 172.29.0.48: icmp_req=1 ttl=62 time=138 ms\n64 bytes from 172.29.0.48: icmp_req=2 ttl=62 time=137 ms\n64 bytes from 172.29.0.48: icmp_req=3 ttl=62 time=137 ms\n^C\n--- 172.29.0.48 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2003ms\nrtt min/avg/max/mdev = 137.700/138.014/138.446/0.532 ms\n~~~\n\ntraceroute \u3067 \u7d4c\u8def\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n~~~\ntkr@raspi1 ~ $ traceroute 172.29.0.48\ntraceroute to 172.29.0.48 (172.29.0.48), 30 hops max, 60 byte packets\n 1  192.168.1.76 (192.168.1.76)  0.864 ms  0.503 ms  0.726 ms\n 2  * * *\n 3  172.29.0.48 (172.29.0.48)  137.325 ms  137.757 ms  137.515 ms\n~~~\n\nIBM Container ibmnode\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\n\n~~~\ntkr@raspi1 ~ $ curl http://172.29.0.48:3000\nHello World!\n~~~\n\n\u4ee5\u4e0a\u3001VirutalBox \u4e0a\u306e VyOS\u30eb\u30fc\u30bf \u3068 Bluemix VPN \u3068\u306e VPN\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u6a5f\u80fd\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\n\n\n## VyOS\u5168\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n~~~\nvagrant@vyos:~$ sh conf\ninterfaces {\n    ethernet eth0 {\n        address dhcp\n        duplex auto\n        hw-id 08:00:27:0f:ec:bf\n        smp_affinity auto\n        speed auto\n    }\n    ethernet eth1 {\n        address 192.168.1.76/24\n        duplex auto\n        hw-id 08:00:27:7a:71:aa\n        smp_affinity auto\n        speed auto\n    }\n    loopback lo {\n    }\n}\nservice {\n    ssh {\n        disable-host-validation\n        port 22\n    }\n}\nsystem {\n    config-management {\n        commit-revisions 20\n    }\n    gateway-address 192.168.1.1\n    host-name vyos\n    ntp {\n        server 0.pool.ntp.org {\n        }\n        server 1.pool.ntp.org {\n        }\n        server 2.pool.ntp.org {\n        }\n    }\n    package {\n        auto-sync 1\n        repository community {\n            components main\n            distribution helium\n            password ****************\n            url http://packages.vyos.net/vyos\n            username \"\"\n        }\n    }\n    syslog {\n        global {\n            facility all {\n                level notice\n            }\n            facility protocols {\n                level debug\n            }\n        }\n    }\n    time-zone UTC\n}\nvpn {\n    ipsec {\n        esp-group default {\n            compression disable\n            lifetime 3600\n            mode tunnel\n            pfs dh-group2\n            proposal 1 {\n                encryption aes128\n                hash sha1\n            }\n        }\n        ike-group default {\n            ikev2-reauth no\n            key-exchange ikev1\n            lifetime 86400\n            proposal 1 {\n                dh-group 2\n                encryption aes128\n                hash sha1\n            }\n        }\n        ipsec-interfaces {\n            interface eth1\n        }\n        nat-networks {\n            allowed-network 172.29.0.0/16 {\n            }\n        }\n        nat-traversal enable\n        site-to-site {\n            peer 169.46.18.177 {\n                authentication {\n                    id **.**.**.** <- \u79d8\u5bc6\u3067\u3059\n                    mode pre-shared-secret\n                    pre-shared-secret ****************\n                    remote-id 169.46.18.177\n                }\n                connection-type initiate\n                default-esp-group default\n                ike-group default\n                ikev2-reauth inherit\n                local-address any\n                tunnel 1 {\n                    allow-nat-networks disable\n                    allow-public-networks disable\n                    local {\n                        prefix 192.168.1.0/24\n                    }\n                    remote {\n                        prefix 172.29.0.0/16\n                    }\n                }\n            }\n        }\n    }\n}\n~~~\n\n", "tags": ["VyOS", "vyatta", "Bluemix", "VPN", "vagrant"]}