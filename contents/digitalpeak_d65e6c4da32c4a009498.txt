{"tags": ["vagrant", "chef-zero"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u76ee\u7684\n\u958b\u767a\u7528\u306bvagrant\u3092\u4f7f\u7528\u3057\u3066chef-zero\u3067chef-workstaion\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\n\u74b0\u5883\n\nWindows7 Professional\nVagrant 1.7.2\nCentOS Linux release 7.0.1406 (Core) \nAmazon Linux AMI release 2015.03\n\n\n\u30a4\u30e1\u30fc\u30b8\n\n\n\u8a2d\u5b9a\n\nchef-zero\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://downloads.chef.io/chef-dk/\n$ wget https://opscode-omnibus-packages.s3.amazonaws.com/el/6/x86_64/chefdk-0.3.5-1.x86_64.rpm\n$ sudo rpm -Uvh chefdk-0.3.5-1.x86_64.rpm\n$ sudo chef gem install knife-zero\n\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n$ chef generate repo chef-repo\n$ cd chef-repo\n\n\n\u30af\u30c3\u30af\u30d6\u30c3\u30af\u4f5c\u6210\n$ knife cookbook create nginx\n\n\u30ec\u30b7\u30d4\u4f5c\u6210\n\u3068\u308a\u3042\u3048\u305a\u3001\u30ce\u30fc\u30c9\u306bnginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n$nano ~/chef-repo/cookbooks/nginx/recipes/default.rb\n\n~/chef-repo/cookbooks/nginx/recipes/default.rb\npackage \"nginx\" do\n  action :install\nend\n\nservice \"nginx\" do\n  supports :status => true, :restart => true, :reload => true\n  action [ :enable, :start ]\nend\n\n\n\n\u30ce\u30fc\u30c9\u521d\u671f\u5316\n\u30ce\u30fc\u30c9\u306bchef\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3001workstation\u306enode\u3078\u521d\u671f\u5316\u3057\u305f\u30ce\u30fc\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002\nworkstation\u3067\u7ba1\u7406\u3057\u3084\u3059\u3044\u3088\u3046\u3001--node-name\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u3092nodename\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\n$ sudo knife zero bootstrap \u30ce\u30fc\u30c9GIP|FQDN -x ec2-user --node-name node1 -i ~/.ssh/\u79d8\u5bc6\u9375\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u3067\u4f7f\u7528\u3059\u308bknife.rb\u4f5c\u6210\n\n~/chef-repo/knife.rb\n#-z\u3001--local\u30e2\u30fc\u30c9\n#\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u30b7\u30a7\u30d5\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nlocal_mode true\nchef_server_url   'http://Workstation-IP:8889'\nnode_name         'Workstation-nodename'\nclient_key        '~/.ssh/\u30ce\u30fc\u30c9\u306b\u63a5\u7d9a\u3059\u308b\u969b\u306e\u79d8\u5bc6\u9375'\n\n\n\n\u30ce\u30fc\u30c9\u306b\u30ec\u30b7\u30d4\u5b9a\u7fa9\n$ knife node run_list add node1 'recipe[nginx]'\n\n\u30ce\u30fc\u30c9\u306b\u30ec\u30b7\u30d4\u9069\u7528\n$ sudo knife zero chef_client 'name:node1' -x ec2-user -i ~~/.ssh/\u79d8\u5bc6\u9375\n\n\u30ce\u30fc\u30c9\u306b\u3066\u78ba\u8a8d\n$ rpm -qa nginx $$ chef;ps aux | grep nginx\nchef-11.18.12-1.el6.x86_64\nnginx-1.6.2-1.23.amzn1.x86_64\nroot     28272  0.0  0.2 109516  2088 ?        Ss   11:17   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx    28276  0.0  0.3 109936  3224 ?        S    11:17   0:00 nginx: worker process\nec2-user 28294  0.0  0.0 110404   856 pts/0    S+   11:22   0:00 grep nginx\n\n\n\n\ncommit\n>vagrant sandbox commit\n[default] Committing the virtual machine...\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n\n#\u76ee\u7684\n\u958b\u767a\u7528\u306bvagrant\u3092\u4f7f\u7528\u3057\u3066chef-zero\u3067chef-workstaion\u3092\u69cb\u7bc9\u3059\u308b\u3002\n#\u74b0\u5883\n* Windows7 Professional\n* Vagrant 1.7.2\n* CentOS Linux release 7.0.1406 (Core) \n* Amazon Linux AMI release 2015.03\n\n##\u30a4\u30e1\u30fc\u30b8\n![image.jpg](https://qiita-image-store.s3.amazonaws.com/0/58788/147caf7b-bc51-9c6d-26ba-e9d57ceff2b3.jpeg)\n\n\n#\u8a2d\u5b9a\n##chef-zero\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://downloads.chef.io/chef-dk/\n\n```\n$ wget https://opscode-omnibus-packages.s3.amazonaws.com/el/6/x86_64/chefdk-0.3.5-1.x86_64.rpm\n$ sudo rpm -Uvh chefdk-0.3.5-1.x86_64.rpm\n$ sudo chef gem install knife-zero\n```\n##\u30ec\u30dd\u30b8\u30c8\u30ea\u4f5c\u6210\n\n```\n$ chef generate repo chef-repo\n$ cd chef-repo\n```\n\n##\u30af\u30c3\u30af\u30d6\u30c3\u30af\u4f5c\u6210\n`$ knife cookbook create nginx`\n\n##\u30ec\u30b7\u30d4\u4f5c\u6210\n\u3068\u308a\u3042\u3048\u305a\u3001\u30ce\u30fc\u30c9\u306bnginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n`$nano ~/chef-repo/cookbooks/nginx/recipes/default.rb`\n\n```~/chef-repo/cookbooks/nginx/recipes/default.rb\npackage \"nginx\" do\n  action :install\nend\n\nservice \"nginx\" do\n  supports :status => true, :restart => true, :reload => true\n  action [ :enable, :start ]\nend\n```\n\n##\u30ce\u30fc\u30c9\u521d\u671f\u5316\n\u30ce\u30fc\u30c9\u306bchef\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3001workstation\u306enode\u3078\u521d\u671f\u5316\u3057\u305f\u30ce\u30fc\u30c9\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002\nworkstation\u3067\u7ba1\u7406\u3057\u3084\u3059\u3044\u3088\u3046\u3001`--node-name`\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u3092nodename\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3002\n`$ sudo knife zero bootstrap \u30ce\u30fc\u30c9GIP|FQDN -x ec2-user --node-name node1 -i ~/.ssh/\u79d8\u5bc6\u9375`\n\n##\u30ec\u30dd\u30b8\u30c8\u30ea\u3067\u4f7f\u7528\u3059\u308bknife.rb\u4f5c\u6210\n```~/chef-repo/knife.rb\n#-z\u3001--local\u30e2\u30fc\u30c9\n#\u30ed\u30fc\u30ab\u30eb\u30e2\u30fc\u30c9\u3067\u30b7\u30a7\u30d5\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nlocal_mode true\nchef_server_url   'http://Workstation-IP:8889'\nnode_name         'Workstation-nodename'\nclient_key        '~/.ssh/\u30ce\u30fc\u30c9\u306b\u63a5\u7d9a\u3059\u308b\u969b\u306e\u79d8\u5bc6\u9375'\n```\n##\u30ce\u30fc\u30c9\u306b\u30ec\u30b7\u30d4\u5b9a\u7fa9\n`$ knife node run_list add node1 'recipe[nginx]'`\n\n##\u30ce\u30fc\u30c9\u306b\u30ec\u30b7\u30d4\u9069\u7528\n`$ sudo knife zero chef_client 'name:node1' -x ec2-user -i ~~/.ssh/\u79d8\u5bc6\u9375`\n\n##\u30ce\u30fc\u30c9\u306b\u3066\u78ba\u8a8d\n```\n$ rpm -qa nginx $$ chef;ps aux | grep nginx\nchef-11.18.12-1.el6.x86_64\nnginx-1.6.2-1.23.amzn1.x86_64\nroot     28272  0.0  0.2 109516  2088 ?        Ss   11:17   0:00 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\nnginx    28276  0.0  0.3 109936  3224 ?        S    11:17   0:00 nginx: worker process\nec2-user 28294  0.0  0.0 110404   856 pts/0    S+   11:22   0:00 grep nginx\n```\n![nginx.JPG](https://qiita-image-store.s3.amazonaws.com/0/58788/70db6d30-1d81-649c-fccc-cfd8ec290dd5.jpeg)\n<hr>\n\n##commit\n```\n>vagrant sandbox commit\n[default] Committing the virtual machine...\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%\n```\n\n\n\n\n"}