{"context": " More than 1 year has passed since last update.LVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u306b GlusterFS \u30d6\u30ea\u30c3\u30af\u3092\u4f5c\u308b\u3068\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4f7f\u3048\u308b\u3089\u3057\u3044\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nManaging Snapshots - Gluster Docs\nA Journey: Gluster Volume Snapshot Howto\n\nLVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u3064\u3044\u3066\u306f\u4ee5\u524d\u4e0b\u8a18\u306e\u6295\u7a3f\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\nLVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nglusterfs-server \u306f\u4e0b\u8a18\u306e\u8a18\u4e8b\u306e\u3088\u3046\u306b g1-g4 \u306e\uff14\u53f0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b glusterfs-fusr \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30b5\u30fc\u30d0 cl \u3082\uff11\u53f0\u8a2d\u3051\u3066\u3044\u307e\u3059\u3002\n\nGlusterFS \u3092\u4f7f\u3063\u3066\u307f\u305f\n\n\u8a18\u4e8b\u306e\u901a\u308a CentOS 7 \u306e\u74b0\u5883\u3092 Vagrant \u3067\u8907\u6570\u7acb\u3061\u4e0a\u3052\u3066\u8a66\u3057\u3066\u3044\u307e\u3059\u3002\u4f7f\u7528\u3057\u305f GlusterFS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 3.7.3 \u3067\u3059\u3002\n\nLVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\n\u8ffd\u52a0\u30c7\u30a3\u30b9\u30af\u306b LVM \u7528\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1-g4\nparted -s -a optimal /dev/sdb mklabel msdos -- mkpart primary 1 -1 set 1 lvm on\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1-g4\npvcreate /dev/sdb1\nvgcreate vg0 /dev/sdb1\n\n\n\u30b7\u30f3\u30d7\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1-g4\nlvcreate --thin -L 10G vg0/thin\n\n\n\u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1-g4\nlvcreate --thin -V 10G -n data vg0/thin\n\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1-g4\nmkfs.xfs /dev/vg0/data\n\n\n\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\ng1-g4\nmkdir -p /glfs/vols\ncat <<EOS>>/etc/fstab\n/dev/vg0/data /glfs/vols xfs defaults 0 0\nEOS\nmount /glfs/vols\n\n\n\nGlusterFS \u3092\u958b\u59cb\u3057\u3066\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\nGlusterFS \u306e\u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\ng1-g4\nsystemctl enable glusterd.service\nsystemctl start  glusterd.service\nsystemctl status glusterd.service\n\n\n\u30ce\u30fc\u30c9\uff14\u53f0\u304b\u3089\u306a\u308b\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1\ngluster peer probe g2\ngluster peer probe g3\ngluster peer probe g4\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ng1\ngluster volume create data replica 2 \\\n  g1:/glfs/vols/data \\\n  g2:/glfs/vols/data \\\n  g3:/glfs/vols/data \\\n  g4:/glfs/vols/data\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\ng1\ngluster volume start data\n\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u64cd\u4f5c\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\ncl\nmkdir -p /glfs/data\nmount -t glusterfs g1:/data /glfs/data\n\n\n\u9069\u5f53\u306b\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\ncl\nmkdir /glfs/data/xxx\necho 1 > /glfs/data/1.txt\n\n\n\u9069\u5f53\u306a\u30ce\u30fc\u30c9\uff08\u4f8b\u3048\u3070 g1\uff09\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u3067\u306f\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u540d\u306e\u5f8c\u308d\u306b\u4f5c\u6210\u6642\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u8a66\u3059\u3060\u3051\u306a\u3089\u540d\u524d\u304c\u9577\u3044\u3068\u4e0d\u4fbf\u306a\u306e\u3067 no-timestamp \u3092\u6307\u5b9a\u3057\u3066\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4ed8\u304b\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\ng1\ngluster snapshot create data-01 data no-timestamp\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u60c5\u5831\u3084\u72b6\u614b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\ng1\ngluster snapshot list\ngluster snapshot info data-01\ngluster snapshot status data-01\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u66f4\u306b\u3044\u308d\u3044\u308d\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\ncl\necho 5 > /glfs/data/5.txt\necho 6 > /glfs/data/6.txt\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u3057\u307e\u3059\u3002\n\ng1\ngluster snapshot activate data-01\n\n\n\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u3059\u308b\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30de\u30a6\u30f3\u30c8\u3067\u304d\u307e\u3059\u3002\n\ncl\nmkdir /glfs/data-01\nmount -t glusterfs g1:/snaps/data-01/data /glfs/data-01\n\n\n\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u901a\u5e38\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u306f 5.txt \u3084 6.txt \u304c\u3042\u308a\u307e\u3059\u304c\u30fb\u30fb\u30fb\n\ncl\nll /glfs/data\n\n\ntotal 2\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\n-rw-r--r-- 1 root root  2 Aug 23 14:30 5.txt\n-rw-r--r-- 1 root root  2 Aug 23 14:30 6.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306b\u306f 5.txt \u3084 6.txt \u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\ncl\nll /glfs/data-01\n\n\ntotal 1\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\ncl\numount /glfs/data-01\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n\ng1\ngluster volume stop data\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30ea\u30b9\u30c8\u30a2\u3057\u307e\u3059\u3002\n\ng1\ngluster snapshot restore data-01\n\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\ng1\ngluster volume start data\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u898b\u3066\u307f\u308b\u3068\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u6642\u70b9\u306b\u5fa9\u5143\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5224\u308a\u307e\u3059\u3002\n\ncl\nll /glfs/data/\n\n\ntotal 1\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n\n\n\u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u3067\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u81ea\u52d5\u524a\u9664\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30f3\u306b\u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4e00\u5b9a\u6570\u4ee5\u4e0a\u306b\u306a\u308b\u3068\u81ea\u52d5\u7684\u306b\u53e4\u3044\u3082\u306e\u304b\u3089\u524a\u9664\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\ng1\ngluster snapshot config snap-max-soft-limit 80\ngluster snapshot config auto-delete enable\ngluster snapshot config data snap-max-hard-limit 10\n\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\ng1\ngluster snapshot config\n\n\nSnapshot System Configuration:\nsnap-max-hard-limit : 256\nsnap-max-soft-limit : 80%\nauto-delete : enable\nactivate-on-create : disable\n\nSnapshot Volume Configuration:\n\nVolume : data\nsnap-max-hard-limit : 10\nEffective snap-max-hard-limit : 10\nEffective snap-max-soft-limit : 8 (80%)\n\n\u3053\u306e\u8a2d\u5b9a\u306f\u6b21\u306e\u3088\u3046\u306a\u610f\u5473\u3067\u3059\u3002\n\n\nsnap-max-hard-limit : 256\n\n\u30b7\u30b9\u30c6\u30e0\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306f 256 \u500b\n\u3053\u308c\u3092\u8d85\u3048\u3066\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u308b\n\n\n\nsnap-max-soft-limit : 80%\n\n\u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u306f\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306e 80%\n\u3053\u308c\u3092\u8d85\u3048\u305f\u3068\u304d\u306e\u52d5\u4f5c\u306f auto-delete \u306b\u3088\u308b\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u306a\u3044\n\n\n\nauto-delete : enable\n\n\u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u306b\u9054\u3057\u305f\u3068\u304d\u306e\u52d5\u4f5c\nenable \u306a\u3089\u81ea\u52d5\u7684\u306b\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u524a\u9664\ndisable \u306a\u3089\u8b66\u544a\u306e\u307f\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u306a\u3044\n\n\n\nsnap-max-hard-limit : 10\n\ndata \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306f 10 \u500b\n\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u305f\u304f\u3055\u3093\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\ng1\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\n\n\n\uff18\u500b\u76ee\u307e\u3067\u306f\u666e\u901a\u306b\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\ng1\ngluster snapshot list\n\n\ndata-snap_GMT-2015.08.23-05.56.34\ndata-snap_GMT-2015.08.23-05.56.48\ndata-snap_GMT-2015.08.23-05.56.55\ndata-snap_GMT-2015.08.23-05.57.03\ndata-snap_GMT-2015.08.23-05.57.11\ndata-snap_GMT-2015.08.23-05.57.17\ndata-snap_GMT-2015.08.23-05.57.22\ndata-snap_GMT-2015.08.23-05.57.28\n\n\uff19\u500b\u76ee\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\ng1\ngluster snapshot create data-snap data\n\n\nsnapshot create: success: Snap data-snap_GMT-2015.08.23-05.58.27 created successfully\n\n\u4e00\u756a\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\ng1\ngluster snapshot list\n\n\ndata-snap_GMT-2015.08.23-05.56.48\ndata-snap_GMT-2015.08.23-05.56.55\ndata-snap_GMT-2015.08.23-05.57.03\ndata-snap_GMT-2015.08.23-05.57.11\ndata-snap_GMT-2015.08.23-05.57.17\ndata-snap_GMT-2015.08.23-05.57.22\ndata-snap_GMT-2015.08.23-05.57.28\ndata-snap_GMT-2015.08.23-05.58.27\n\nLVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u306b GlusterFS \u30d6\u30ea\u30c3\u30af\u3092\u4f5c\u308b\u3068\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4f7f\u3048\u308b\u3089\u3057\u3044\u306e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n- [Managing Snapshots - Gluster Docs](http://gluster.readthedocs.org/en/latest/Administrator%20Guide/Managing%20Snapshots/ \"Managing Snapshots - Gluster Docs\")\n- [A Journey: Gluster Volume Snapshot Howto](http://rajesh-joseph.blogspot.jp/p/gluster-volume-snapshot-howto.html \"A Journey: Gluster Volume Snapshot Howto\")\n\nLVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u3064\u3044\u3066\u306f\u4ee5\u524d\u4e0b\u8a18\u306e\u6295\u7a3f\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\n\n- [LVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0](http://qiita.com/ngyuki/items/84c471862cb29f6dfc71 \"LVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\")\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n`glusterfs-server` \u306f\u4e0b\u8a18\u306e\u8a18\u4e8b\u306e\u3088\u3046\u306b g1-g4 \u306e\uff14\u53f0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u3059\u308b\u305f\u3081\u306b `glusterfs-fusr` \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30b5\u30fc\u30d0 `cl` \u3082\uff11\u53f0\u8a2d\u3051\u3066\u3044\u307e\u3059\u3002\n\n- [GlusterFS \u3092\u4f7f\u3063\u3066\u307f\u305f](http://ngyuki.hatenablog.com/entry/2015/08/26/013622 \"GlusterFS \u3092\u4f7f\u3063\u3066\u307f\u305f\")\n\n\u8a18\u4e8b\u306e\u901a\u308a CentOS 7 \u306e\u74b0\u5883\u3092 Vagrant \u3067\u8907\u6570\u7acb\u3061\u4e0a\u3052\u3066\u8a66\u3057\u3066\u3044\u307e\u3059\u3002\u4f7f\u7528\u3057\u305f GlusterFS \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 3.7.3 \u3067\u3059\u3002\n\n## LVM \u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\n\n\u8ffd\u52a0\u30c7\u30a3\u30b9\u30af\u306b LVM \u7528\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\nparted -s -a optimal /dev/sdb mklabel msdos -- mkpart primary 1 -1 set 1 lvm on\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\npvcreate /dev/sdb1\nvgcreate vg0 /dev/sdb1\n```\n\n\u30b7\u30f3\u30d7\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\nlvcreate --thin -L 10G vg0/thin\n```\n\n\u30b7\u30f3\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\nlvcreate --thin -V 10G -n data vg0/thin\n```\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\nmkfs.xfs /dev/vg0/data\n```\n\n\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n```sh:g1-g4\nmkdir -p /glfs/vols\ncat <<EOS>>/etc/fstab\n/dev/vg0/data /glfs/vols xfs defaults 0 0\nEOS\nmount /glfs/vols\n```\n\n## GlusterFS \u3092\u958b\u59cb\u3057\u3066\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\n\nGlusterFS \u306e\u30b5\u30fc\u30d3\u30b9\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```:g1-g4\nsystemctl enable glusterd.service\nsystemctl start  glusterd.service\nsystemctl status glusterd.service\n```\n\n\u30ce\u30fc\u30c9\uff14\u53f0\u304b\u3089\u306a\u308b\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster peer probe g2\ngluster peer probe g3\ngluster peer probe g4\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster volume create data replica 2 \\\n  g1:/glfs/vols/data \\\n  g2:/glfs/vols/data \\\n  g3:/glfs/vols/data \\\n  g4:/glfs/vols/data\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster volume start data\n```\n\n## \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u64cd\u4f5c\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n```sh:cl\nmkdir -p /glfs/data\nmount -t glusterfs g1:/data /glfs/data\n```\n\n\u9069\u5f53\u306b\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\n```sh:cl\nmkdir /glfs/data/xxx\necho 1 > /glfs/data/1.txt\n```\n\n\u9069\u5f53\u306a\u30ce\u30fc\u30c9\uff08\u4f8b\u3048\u3070 **g1**\uff09\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u3067\u306f\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u540d\u306e\u5f8c\u308d\u306b\u4f5c\u6210\u6642\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u8a66\u3059\u3060\u3051\u306a\u3089\u540d\u524d\u304c\u9577\u3044\u3068\u4e0d\u4fbf\u306a\u306e\u3067 `no-timestamp` \u3092\u6307\u5b9a\u3057\u3066\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4ed8\u304b\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot create data-01 data no-timestamp\n```\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u60c5\u5831\u3084\u72b6\u614b\u3092\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot list\ngluster snapshot info data-01\ngluster snapshot status data-01\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u66f4\u306b\u3044\u308d\u3044\u308d\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\n```sh:cl\necho 5 > /glfs/data/5.txt\necho 6 > /glfs/data/6.txt\n```\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot activate data-01\n```\n\n\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u3059\u308b\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30de\u30a6\u30f3\u30c8\u3067\u304d\u307e\u3059\u3002\n\n```sh:cl\nmkdir /glfs/data-01\nmount -t glusterfs g1:/snaps/data-01/data /glfs/data-01\n```\n\n\u4e2d\u8eab\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u901a\u5e38\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u306f 5.txt \u3084 6.txt \u304c\u3042\u308a\u307e\u3059\u304c\u30fb\u30fb\u30fb\n\n```sh:cl\nll /glfs/data\n```\n\n```\ntotal 2\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\n-rw-r--r-- 1 root root  2 Aug 23 14:30 5.txt\n-rw-r--r-- 1 root root  2 Aug 23 14:30 6.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n```\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306b\u306f 5.txt \u3084 6.txt \u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\n```sh:cl\nll /glfs/data-01\n```\n\n```\ntotal 1\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n```\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n```sh:cl\numount /glfs/data-01\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster volume stop data\n```\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u30ea\u30b9\u30c8\u30a2\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot restore data-01\n```\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster volume start data\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u898b\u3066\u307f\u308b\u3068\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u6642\u70b9\u306b\u5fa9\u5143\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5224\u308a\u307e\u3059\u3002\n\n```sh:cl\nll /glfs/data/\n```\n\n```\ntotal 1\n-rw-r--r-- 1 root root  2 Aug 23 14:24 1.txt\ndrwxr-xr-x 2 root root 12 Aug 23 14:24 xxx\n```\n\n## \u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u3067\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u81ea\u52d5\u524a\u9664\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u30f3\u306b\u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4e00\u5b9a\u6570\u4ee5\u4e0a\u306b\u306a\u308b\u3068\u81ea\u52d5\u7684\u306b\u53e4\u3044\u3082\u306e\u304b\u3089\u524a\u9664\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot config snap-max-soft-limit 80\ngluster snapshot config auto-delete enable\ngluster snapshot config data snap-max-hard-limit 10\n```\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot config\n```\n\n```\nSnapshot System Configuration:\nsnap-max-hard-limit : 256\nsnap-max-soft-limit : 80%\nauto-delete : enable\nactivate-on-create : disable\n\nSnapshot Volume Configuration:\n\nVolume : data\nsnap-max-hard-limit : 10\nEffective snap-max-hard-limit : 10\nEffective snap-max-soft-limit : 8 (80%)\n```\n\n\u3053\u306e\u8a2d\u5b9a\u306f\u6b21\u306e\u3088\u3046\u306a\u610f\u5473\u3067\u3059\u3002\n\n- `snap-max-hard-limit : 256`\n    - \u30b7\u30b9\u30c6\u30e0\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306f 256 \u500b\n    - \u3053\u308c\u3092\u8d85\u3048\u3066\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\n    - \u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u308b\n- `snap-max-soft-limit : 80%`\n    - \u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u306f\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306e 80%\n    - \u3053\u308c\u3092\u8d85\u3048\u305f\u3068\u304d\u306e\u52d5\u4f5c\u306f `auto-delete` \u306b\u3088\u308b\n    - \u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u306a\u3044\n- `auto-delete : enable`\n    - \u30bd\u30d5\u30c8\u30ea\u30df\u30c3\u30c8\u306b\u9054\u3057\u305f\u3068\u304d\u306e\u52d5\u4f5c\n    - enable \u306a\u3089\u81ea\u52d5\u7684\u306b\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u524a\u9664\n    - disable \u306a\u3089\u8b66\u544a\u306e\u307f\n    - \u30dc\u30ea\u30e5\u30fc\u30e0\u3054\u3068\u306e\u8a2d\u5b9a\u3067\u4e0a\u66f8\u304d\u3067\u304d\u306a\u3044\n- `snap-max-hard-limit : 10`\n    - data \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30cf\u30fc\u30c9\u30ea\u30df\u30c3\u30c8\u306f 10 \u500b\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u305f\u304f\u3055\u3093\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\ngluster snapshot create data-snap data\n```\n\n\uff18\u500b\u76ee\u307e\u3067\u306f\u666e\u901a\u306b\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot list\n```\n\n```\ndata-snap_GMT-2015.08.23-05.56.34\ndata-snap_GMT-2015.08.23-05.56.48\ndata-snap_GMT-2015.08.23-05.56.55\ndata-snap_GMT-2015.08.23-05.57.03\ndata-snap_GMT-2015.08.23-05.57.11\ndata-snap_GMT-2015.08.23-05.57.17\ndata-snap_GMT-2015.08.23-05.57.22\ndata-snap_GMT-2015.08.23-05.57.28\n```\n\n\uff19\u500b\u76ee\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot create data-snap data\n```\n\n```\nsnapshot create: success: Snap data-snap_GMT-2015.08.23-05.58.27 created successfully\n```\n\n\u4e00\u756a\u53e4\u3044\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n```sh:g1\ngluster snapshot list\n```\n\n```\ndata-snap_GMT-2015.08.23-05.56.48\ndata-snap_GMT-2015.08.23-05.56.55\ndata-snap_GMT-2015.08.23-05.57.03\ndata-snap_GMT-2015.08.23-05.57.11\ndata-snap_GMT-2015.08.23-05.57.17\ndata-snap_GMT-2015.08.23-05.57.22\ndata-snap_GMT-2015.08.23-05.57.28\ndata-snap_GMT-2015.08.23-05.58.27\n```\n", "tags": ["GlusterFS"]}