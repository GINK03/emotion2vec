{"tags": ["Node.js", "Express", "JavaScript"], "context": "Node.js\u3068Express4\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30b5\u30fc\u30d0\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u3092Web\u3067\u8abf\u3079\u305f\u3068\u3053\u308d\u3001\u53e4\u3044\u60c5\u5831\u3070\u304b\u308a\u51fa\u3066\u304d\u3066\u89e3\u6c7a\u307e\u3067\u306b\u534a\u65e5\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Express4\u3068multer\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u65b9\u6cd5\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3059\u3002\nmulter\u30e2\u30b8\u30e5\u30fc\u30eb\u306eREADME\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n\u524d\u63d0\u6761\u4ef6\nExpress\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f4.13.4\u3001multer\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f1.2.0\u3067\u3059\u3002\n$ express --version\n4.13.4\n\n$ npm list multer\nxxxx@y.y.y zzzzz\n\u2514\u2500\u2500 multer@1.2.0\n\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\nexpress-generator\u3092\u4f7f\u3063\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u96db\u5f62\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n$ express file-upload\n\n   create : file-upload\n   create : file-upload/package.json\n   create : file-upload/app.js\n   create : file-upload/public\n   create : file-upload/public/javascripts\n   create : file-upload/public/images\n   create : file-upload/public/stylesheets\n   create : file-upload/public/stylesheets/style.css\n   create : file-upload/routes\n   create : file-upload/routes/index.js\n   create : file-upload/routes/users.js\n   create : file-upload/views\n   create : file-upload/views/index.jade\n   create : file-upload/views/layout.jade\n   create : file-upload/views/error.jade\n   create : file-upload/bin\n   create : file-upload/bin/www\n\n   install dependencies:\n     $ cd file-upload && npm install\n\n   run the app:\n     $ DEBUG=file-upload:* npm start\n\n\u7d9a\u3044\u3066\u3001package.json\u3092\u7de8\u96c6\u3057\u3066multer\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n{\n  \"name\": \"file-upload\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node ./bin/www\"\n  },\n  \"dependencies\": {\n    \"body-parser\": \"~1.15.1\",\n    \"cookie-parser\": \"~1.4.3\",\n    \"debug\": \"~2.2.0\",\n    \"express\": \"~4.13.4\",\n    \"jade\": \"~1.11.0\",\n    \"morgan\": \"~1.7.0\",\n    \"serve-favicon\": \"~2.3.0\",\n    \"multer\": \"~1.2.0\"\n  }\n}\n\n\nviews/index.jade```\u3092\u7de8\u96c6\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u30b5\u30fc\u30d0\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u9762\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```jade\nextends layout\n\nblock content\n  h1= title\n  form(method=\"post\", enctype=\"multipart/form-data\", action=\"/upload\")\n    input(type=\"file\", name=\"thumbnail\")\n    input(type=\"submit\")\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u767a\u884c\u3059\u308bPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5fdc\u3058\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u51e6\u7406\u3092\u3001routes/index.js\u306b\u52a0\u3048\u307e\u3059\u3002\nvar express = require('express');\nvar router = express.Router();\nvar multer = require('multer');\n\nvar upload = multer({ dest: './uploads/' }).single('thumbnail');\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.render('index', { title: 'Express' });\n});\n\nrouter.post('/upload', function(req, res) {\n  upload(req, res, function(err) {\n    if(err) {\n      res.send(\"Failed to write \" + req.file.destination + \" with \" + err);\n    } else {\n      res.send(\"uploaded \" + req.file.originalname + \" as \" + req.file.filename. + \" Size: \" + req.file.size);\n    }\n  });\n});\n\nmodule.exports = router;\n\nmulter({ dest: './uploads/' })\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u4e00\u500b\u3060\u3051\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b.single()\u30e1\u30bd\u30c3\u30c9\u3092\u7528\u3044\u308b\u5834\u5408\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306freq.file\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u306b\u306f\u3001multer\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308a\u30e9\u30f3\u30c0\u30e0\u306a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306freq.file.orignalname\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306freq.file.filename\u304b\u3089\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u4ed6\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092req.file.destination\u304b\u3089\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u3092req.file.size\u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u3067\u306f\u3001\u3055\u3063\u305d\u304f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ npm install\nnpm WARN deprecated jade@1.11.0: Jade has been renamed to pug, please install the latest version of pug instead of jade\nnpm WARN deprecated transformers@2.1.0: Deprecated, use jstransformer\ncookie-parser@1.4.3 node_modules\\cookie-parser\n\u251c\u2500\u2500 cookie-signature@1.0.6\n\u2514\u2500\u2500 cookie@0.3.1\n...\n$ npm start\n\n> file-upload@0.0.0 start C:\\Users\\IBM_ADMIN\\Documents\\ITLMC\\2016\\blog\\file-upload\n> node ./bin/www\n\n\u30d6\u30e9\u30a6\u30b6\u3067http://localhost:3000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n\u300c\u53c2\u7167\u300d\u30dc\u30bf\u30f3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u3093\u3067\u3001\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3002\u3002\u3002\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u5b8c\u4e86\u6642\u306bupload()\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3057\u305f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u304c\u547c\u3070\u308c\u3066\u3001\u30b5\u30fc\u30d0\u304b\u3089\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002IMG_4533.JPG\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u304c2e491eefb9ec7c5858af2f0aba0ecee6\u3068\u3044\u3046\u540d\u524d\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\u3067\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u6307\u5b9a\u3057\u305f./uploads\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ ls -l ./uploads/\n\u5408\u8a08 188\n-rwx------+ 1 smatsui None 188729 9\u6708  28 15:01 2e491eefb9ec7c5858af2f0aba0ecee6\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\uff01\nNode.js\u3068Express4\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30b5\u30fc\u30d0\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u65b9\u6cd5\u3092Web\u3067\u8abf\u3079\u305f\u3068\u3053\u308d\u3001\u53e4\u3044\u60c5\u5831\u3070\u304b\u308a\u51fa\u3066\u304d\u3066\u89e3\u6c7a\u307e\u3067\u306b\u534a\u65e5\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Express4\u3068multer\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u65b9\u6cd5\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3059\u3002\n[multer\u30e2\u30b8\u30e5\u30fc\u30eb\u306eREADME](https://github.com/expressjs/multer/blob/master/README.md)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n#\u524d\u63d0\u6761\u4ef6\nExpress\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f4.13.4\u3001multer\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f1.2.0\u3067\u3059\u3002\n\n```shell-session\n$ express --version\n4.13.4\n```\n\n```shell-session\n$ npm list multer\nxxxx@y.y.y zzzzz\n\u2514\u2500\u2500 multer@1.2.0\n```\n\n# \u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\nexpress-generator\u3092\u4f7f\u3063\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u96db\u5f62\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n```shell-session\n$ express file-upload\n\n   create : file-upload\n   create : file-upload/package.json\n   create : file-upload/app.js\n   create : file-upload/public\n   create : file-upload/public/javascripts\n   create : file-upload/public/images\n   create : file-upload/public/stylesheets\n   create : file-upload/public/stylesheets/style.css\n   create : file-upload/routes\n   create : file-upload/routes/index.js\n   create : file-upload/routes/users.js\n   create : file-upload/views\n   create : file-upload/views/index.jade\n   create : file-upload/views/layout.jade\n   create : file-upload/views/error.jade\n   create : file-upload/bin\n   create : file-upload/bin/www\n\n   install dependencies:\n     $ cd file-upload && npm install\n\n   run the app:\n     $ DEBUG=file-upload:* npm start\n````\n\n\u7d9a\u3044\u3066\u3001```package.json```\u3092\u7de8\u96c6\u3057\u3066multer\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```json\n{\n  \"name\": \"file-upload\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node ./bin/www\"\n  },\n  \"dependencies\": {\n    \"body-parser\": \"~1.15.1\",\n    \"cookie-parser\": \"~1.4.3\",\n    \"debug\": \"~2.2.0\",\n    \"express\": \"~4.13.4\",\n    \"jade\": \"~1.11.0\",\n    \"morgan\": \"~1.7.0\",\n    \"serve-favicon\": \"~2.3.0\",\n    \"multer\": \"~1.2.0\"\n  }\n}\n```\n\n```views/index.jade```\u3092\u7de8\u96c6\u3057\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u30b5\u30fc\u30d0\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u753b\u9762\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```jade\nextends layout\n\nblock content\n  h1= title\n  form(method=\"post\", enctype=\"multipart/form-data\", action=\"/upload\")\n    input(type=\"file\", name=\"thumbnail\")\n    input(type=\"submit\")\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u767a\u884c\u3059\u308bPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u5fdc\u3058\u3066\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u51e6\u7406\u3092\u3001```routes/index.js```\u306b\u52a0\u3048\u307e\u3059\u3002\n\n```js\nvar express = require('express');\nvar router = express.Router();\nvar multer = require('multer');\n\nvar upload = multer({ dest: './uploads/' }).single('thumbnail');\n\n/* GET home page. */\nrouter.get('/', function(req, res, next) {\n  res.render('index', { title: 'Express' });\n});\n\nrouter.post('/upload', function(req, res) {\n  upload(req, res, function(err) {\n    if(err) {\n      res.send(\"Failed to write \" + req.file.destination + \" with \" + err);\n    } else {\n      res.send(\"uploaded \" + req.file.originalname + \" as \" + req.file.filename. + \" Size: \" + req.file.size);\n    }\n  });\n});\n\nmodule.exports = router;\n```\n\n```multer({ dest: './uploads/' })```\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u4e00\u500b\u3060\u3051\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b```.single()```\u30e1\u30bd\u30c3\u30c9\u3092\u7528\u3044\u308b\u5834\u5408\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f```req.file```\u306b\u683c\u7d0d\u3055\u308c\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u540d\u524d\u306b\u306f\u3001multer\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308a\u30e9\u30f3\u30c0\u30e0\u306a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f```req.file.orignalname```\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f```req.file.filename```\u304b\u3089\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u4ed6\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092```req.file.destination```\u304b\u3089\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u3092```req.file.size```\u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u3067\u306f\u3001\u3055\u3063\u305d\u304f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```shell-session\n$ npm install\nnpm WARN deprecated jade@1.11.0: Jade has been renamed to pug, please install the latest version of pug instead of jade\nnpm WARN deprecated transformers@2.1.0: Deprecated, use jstransformer\ncookie-parser@1.4.3 node_modules\\cookie-parser\n\u251c\u2500\u2500 cookie-signature@1.0.6\n\u2514\u2500\u2500 cookie@0.3.1\n...\n$ npm start\n\n> file-upload@0.0.0 start C:\\Users\\IBM_ADMIN\\Documents\\ITLMC\\2016\\blog\\file-upload\n> node ./bin/www\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067[http://localhost:3000](http://localhost:3000)\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n![interface.png](https://qiita-image-store.s3.amazonaws.com/0/16430/eef7cc75-1982-26ec-d12d-70c4ad81f9c6.png)\n\n\u300c\u53c2\u7167\u300d\u30dc\u30bf\u30f3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u3093\u3067\u3001\u9001\u4fe1\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3002\u3002\u3002\n\n![upload-done.png](https://qiita-image-store.s3.amazonaws.com/0/16430/73aef153-bfed-0183-31ed-d8bbd20eef6c.png)\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u5b8c\u4e86\u6642\u306b```upload()```\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3057\u305f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u304c\u547c\u3070\u308c\u3066\u3001\u30b5\u30fc\u30d0\u304b\u3089\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002```IMG_4533.JPG```\u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u304c```2e491eefb9ec7c5858af2f0aba0ecee6```\u3068\u3044\u3046\u540d\u524d\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u3088\u3046\u3067\u3059\u3002\u3067\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5148\u3068\u3057\u3066\u6307\u5b9a\u3057\u305f```./uploads```\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n$ ls -l ./uploads/\n\u5408\u8a08 188\n-rwx------+ 1 smatsui None 188729 9\u6708  28 15:01 2e491eefb9ec7c5858af2f0aba0ecee6\n```\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\uff01\n\n"}