{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u51e6\u7406\u4e2d\u306e worker \u3092\u5f71\u97ff\u3092\u4e0e\u3048\u305a\u306b\u3001\u30ed\u30b0\u30ec\u30d9\u30eb\u3092 debug \u306b\u3057\u305f\u304b\u3063\u305f\n\n\u74b0\u5883\nUbuntu 14.10 + php5-fpm 5.5.12\n\nman\nPHP-FPM(8)                                                          Scripting Language\n\n\nSIGNAL\n       Once started, php-fpm then responds to several POSIX signals:\n\n              SIGINT,SIGTERM      immediate termination\n              SIGQUIT             graceful stop\n              SIGUSR1             re-open log file\n              SIGUSR2             graceful reload of all workers + reload of fpm conf/binary\n\nSIGUSR2 \u3067\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n\ninit script\n/etc/init.d/php5-fpm \u306e\u4e2d\u8eab\n#\n# Function that sends a SIGHUP to the daemon/service\n#\ndo_reload() {\n        #\n        # If the daemon can reload its configuration without\n        # restarting (for example, when it is sent a SIGHUP),\n        # then implement that here.\n        #\n        start-stop-daemon --stop --signal USR2 --quiet --pidfile $PIDFILE --name $NAME\n        return 0\n}\n\nUSR2\u3001\u60f3\u5b9a\u3069\u304a\u308a\u3067\u3059\u306d\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n/sleep.php \u3092\u3053\u3057\u3089\u3048\u308b\n<?php\nsleep(100);\n\n\u305d\u3057\u3066\u3001\ncurl http://127.0.0.1/sleep.php\n\n\u3092\u53e9\u3044\u3066\u3001\u5225\u306e console \u3067\nkill -USR2 $(/usr/local/bin/supervisorctl pid php5-fpm)\n\n\u3092\u305f\u305f\u304f\u3002\u671f\u5f85\u3059\u308b\u306e\u306f curl \u304c\u305a\u3063\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u5f85\u3061\u3067\u3042\u308b\u3053\u3068\u3002\n\u304c\u3001\n<html>\n<head><title>502 Bad Gateway</title></head>\n<body bgcolor=\"white\">\n<center><h1>502 Bad Gateway</h1></center>\n<hr><center>nginx</center>\n</body>\n</html>\n\n\u304a\u3063\u3068\u3001 worker \u304c\u304a\u306a\u304f\u306a\u308a\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3002\u3002\n\n\u8ffd\u8a18\n\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u308b\u3068\u3001 Bug #60961: Graceful Restart (USR2) isn't very graceful \u304c2012\u5e74\u306b\u3042\u304c\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305a\u3063\u3068\u653e\u7f6e\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u3002\u3002\n# \u80cc\u666f\n\n\u51e6\u7406\u4e2d\u306e worker \u3092\u5f71\u97ff\u3092\u4e0e\u3048\u305a\u306b\u3001\u30ed\u30b0\u30ec\u30d9\u30eb\u3092 debug \u306b\u3057\u305f\u304b\u3063\u305f\n\n# \u74b0\u5883\n\nUbuntu 14.10 + php5-fpm 5.5.12\n\n# man\n\n```\nPHP-FPM(8)                                                          Scripting Language\n\n\nSIGNAL\n       Once started, php-fpm then responds to several POSIX signals:\n\n              SIGINT,SIGTERM      immediate termination\n              SIGQUIT             graceful stop\n              SIGUSR1             re-open log file\n              SIGUSR2             graceful reload of all workers + reload of fpm conf/binary\n```\n\n`SIGUSR2` \u3067\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u306d\u3002\n\n# init script\n\n`/etc/init.d/php5-fpm` \u306e\u4e2d\u8eab\n\n```\n#\n# Function that sends a SIGHUP to the daemon/service\n#\ndo_reload() {\n        #\n        # If the daemon can reload its configuration without\n        # restarting (for example, when it is sent a SIGHUP),\n        # then implement that here.\n        #\n        start-stop-daemon --stop --signal USR2 --quiet --pidfile $PIDFILE --name $NAME\n        return 0\n}\n```\n\nUSR2\u3001\u60f3\u5b9a\u3069\u304a\u308a\u3067\u3059\u306d\u3002\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n`/sleep.php` \u3092\u3053\u3057\u3089\u3048\u308b\n\n```php\n<?php\nsleep(100);\n```\n\n\u305d\u3057\u3066\u3001\n\n```\ncurl http://127.0.0.1/sleep.php\n```\n\n\u3092\u53e9\u3044\u3066\u3001\u5225\u306e console \u3067\n\n```\nkill -USR2 $(/usr/local/bin/supervisorctl pid php5-fpm)\n```\n\n\u3092\u305f\u305f\u304f\u3002\u671f\u5f85\u3059\u308b\u306e\u306f curl \u304c\u305a\u3063\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u5f85\u3061\u3067\u3042\u308b\u3053\u3068\u3002\n\n\u304c\u3001\n\n```\n<html>\n<head><title>502 Bad Gateway</title></head>\n<body bgcolor=\"white\">\n<center><h1>502 Bad Gateway</h1></center>\n<hr><center>nginx</center>\n</body>\n</html>\n```\n\n\u304a\u3063\u3068\u3001 worker \u304c\u304a\u306a\u304f\u306a\u308a\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3002\u3002\n\n# \u8ffd\u8a18\n\n\u3082\u3046\u5c11\u3057\u8abf\u3079\u3066\u307f\u308b\u3068\u3001 [Bug #60961: Graceful Restart (USR2) isn't very graceful](https://bugs.php.net/bug.php?id=60961) \u304c2012\u5e74\u306b\u3042\u304c\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305a\u3063\u3068\u653e\u7f6e\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u3002\u3002\n", "tags": ["php-fpm5.5", "Ubuntu14.10", "PHP"]}