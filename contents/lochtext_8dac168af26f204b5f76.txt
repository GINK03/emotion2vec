{"tags": ["\u6570\u5024\u8a08\u7b97", "Python", "matplotlib"], "context": " More than 1 year has passed since last update.http://nbviewer.ipython.org/github/barbagroup/CFDPython/blob/master/lessons/15_Step_11.ipynb\n\u3092\u898b\u3066\u3001\u30ad\u30e3\u30d3\u30c6\u30a3\u6d41\u308c\u306e\u66f8\u304d\u65b9\u304c\u308f\u304b\u3063\u305f\u304c\u3001\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3057\u306a\u3044\u306e\u3067\u7269\u8db3\u308a\u306a\u3044\u3002\n\u6700\u7d42\u7d50\u679c\u3060\u3051\u3092\u8868\u793a\u3059\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u3002\uff08\u5143\u30cd\u30bf\u3067\u306fiPython Notebook\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u3044\u308b\uff09\n\ncavorg.py\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport matplotlib.animation as animation\n\nnx = 41\nny = 41\nnt = 5\nnit=50\nc = 1\ndx = 2.0/(nx-1)\ndy = 2.0/(ny-1)\nx = np.linspace(0,2,nx)\ny = np.linspace(0,2,ny)\nX,Y = np.meshgrid(x,y)\n\nrho = 1\nnu = .1\ndt = .001\n\nu = np.zeros((ny, nx))\nv = np.zeros((ny, nx))\np = np.zeros((ny, nx)) \nb = np.zeros((ny, nx))\n\n\ndef buildUpB(b, rho, dt, u, v, dx, dy):\n\n    b[1:-1,1:-1]=rho*(1/dt*((u[1:-1,2:]-u[1:-1,0:-2])/(2*dx)+(v[2:,1:-1]-v[0:-2,1:-1])/(2*dy))-\\\n                      ((u[1:-1,2:]-u[1:-1,0:-2])/(2*dx))**2-\\\n                      2*((u[2:,1:-1]-u[0:-2,1:-1])/(2*dy)*(v[1:-1,2:]-v[1:-1,0:-2])/(2*dx))-\\\n                      ((v[2:,1:-1]-v[0:-2,1:-1])/(2*dy))**2)\n\n    return b\n\ndef presPoisson(p, dx, dy, b):\n    pn = np.empty_like(p)\n    pn = p.copy()\n\n    for q in range(nit):\n        pn = p.copy()\n        p[1:-1,1:-1] = ((pn[1:-1,2:]+pn[1:-1,0:-2])*dy**2+(pn[2:,1:-1]+pn[0:-2,1:-1])*dx**2)/\\\n                        (2*(dx**2+dy**2)) -\\\n                        dx**2*dy**2/(2*(dx**2+dy**2))*b[1:-1,1:-1]\n\n        p[-1,:] =p[-2,:] ##dp/dy = 0 at y = 2\n        p[0,:] = p[1,:]  ##dp/dy = 0 at y = 0\n        p[:,0]=p[:,1]    ##dp/dx = 0 at x = 0\n        p[:,-1]=0        ##p = 0 at x = 2\n\n    return p\n\ndef cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu):\n    un = np.empty_like(u)\n    vn = np.empty_like(v)\n    b = np.zeros((ny, nx))\n\n    for n in range(nt):\n        un = u.copy()\n        vn = v.copy()\n\n        b = buildUpB(b, rho, dt, u, v, dx, dy)\n        p = presPoisson(p, dx, dy, b)\n\n        u[1:-1,1:-1] = un[1:-1,1:-1]-\\\n                        un[1:-1,1:-1]*dt/dx*(un[1:-1,1:-1]-un[1:-1,0:-2])-\\\n                        vn[1:-1,1:-1]*dt/dy*(un[1:-1,1:-1]-un[0:-2,1:-1])-\\\n                        dt/(2*rho*dx)*(p[1:-1,2:]-p[1:-1,0:-2])+\\\n                        nu*(dt/dx**2*(un[1:-1,2:]-2*un[1:-1,1:-1]+un[1:-1,0:-2])+\\\n                        dt/dy**2*(un[2:,1:-1]-2*un[1:-1,1:-1]+un[0:-2,1:-1]))\n\n        v[1:-1,1:-1] = vn[1:-1,1:-1]-\\\n                        un[1:-1,1:-1]*dt/dx*(vn[1:-1,1:-1]-vn[1:-1,0:-2])-\\\n                        vn[1:-1,1:-1]*dt/dy*(vn[1:-1,1:-1]-vn[0:-2,1:-1])-\\\n                        dt/(2*rho*dy)*(p[2:,1:-1]-p[0:-2,1:-1])+\\\n                        nu*(dt/dx**2*(vn[1:-1,2:]-2*vn[1:-1,1:-1]+vn[1:-1,0:-2])+\\\n                        (dt/dy**2*(vn[2:,1:-1]-2*vn[1:-1,1:-1]+vn[0:-2,1:-1])))\n\n        u[0,:] = 0\n        u[:,0] = 0\n        u[:,-1] = 0\n        u[-1,:] = 1    #set velocity on cavity lid equal to 1\n        v[0,:] = 0\n        v[-1,:]=0\n        v[:,0] = 0\n        v[:,-1] = 0\n\n    return u, v, p\n\nfig = plt.figure(figsize=(11,7), dpi=100)\nu, v, p = cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu)\n\nplt.contourf(X,Y,p,alpha=0.5)\nplt.colorbar()\nplt.contour(X,Y,p)\nplt.quiver(X[::2,::2],Y[::2,::2],u[::2,::2],v[::2,::2])\nplt.xlabel('X')\nplt.ylabel('Y')\nplt.show()\n\n\nmatplotlib.animation\u3092\u4f7f\u3046\u3068gif\u30a2\u30cb\u30e1\u304c\u4f5c\u308c\u308b\u3089\u3057\u3044\u306e\u3067\u6311\u6226\u3057\u3066\u307f\u305f\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u3002\u7406\u7531\u3092\u4ee5\u4e0b\u3067\u8aac\u660e\u3059\u308b\u3002\ngif\u30a2\u30cb\u30e1\u306f\u3001imagemagick\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u4f5c\u308c\u308b\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u53c2\u7167\u3002\nhttp://kiito.hatenablog.com/entry/2013/11/27/233507\n\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u305f\u3081\u306e\u5177\u4f53\u7684\u306a\u65b9\u6cd5\u306f\u4ee5\u4e0b\u3002\n\n\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3092\u3055\u305b\u308b\u65b9\u6cd5\u306f\u4e8c\u901a\u308a\u306e\u3084\u308a\u65b9\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nanimation.ArtistAnimation\n...\u4e8b\u524d\u306b\u7528\u610f\u3057\u3066\u3042\u308b\u30c7\u30fc\u30bf\u3092\u63cf\u753b\nanimation.FuncAnimation\n...\u968f\u6642\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\n\nfrom http://cflat-inc.hatenablog.com/entry/2014/03/17/214719\n\u305d\u306e\u4ed6\u306e\u4f8b\nhttp://qiita.com/HirofumiYashima/items/5864fb9384053b77cf6f\nhttp://d.hatena.ne.jp/xef/20120629/p2\nhttp://stackoverflow.com/questions/24166236/add-text-to-image-animated-with-matplotlib-artistanimation\n\u6700\u521d\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u306fcavityFlow()\u306e\u4e2d\u3067for\u30eb\u30fc\u30d7\u3092\u56de\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30eb\u30fc\u30d7\u3054\u3068\u306b\u30c7\u30fc\u30bf\u3092\u5410\u304d\u51fa\u3057\u3066\u3001ArtistAnimation\u3067\u63cf\u753b\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3060\u304c\u3001\u63cf\u753b\u7528\u30c7\u30fc\u30bf\u306e\u914d\u5217\u306bcontourf\u3092\u6e21\u3059\u3068\u30d0\u30b0\u304c\u51fa\u308b\u3002\u3053\u308c\u306f\u4ed6\u306e\u3068\u3053\u308d\u3067\u3082\u5831\u544a\u3055\u308c\u3066\u3044\u308b\u306e\u3060\u304c\u3001\u5bfe\u5fdc\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3069\u3046\u304b\u308f\u304b\u3089\u306a\u3044\u3002\nhttp://matplotlib.1069221.n5.nabble.com/Matplotlib-1-1-0-animation-vs-contour-plots-td18703.html\nhttp://stackoverflow.com/questions/23070305/how-can-i-make-an-animation-with-contourf\n\u3068\u308a\u3042\u3048\u305aArtistAnimation\u3067\u306f\u306a\u304fFuncAnimation\u3067\u3084\u308c\u3070contourf\u3067\u3082\u30a2\u30cb\u30e1\u306b\u306a\u308b\u3089\u3057\u3044\u304c\u3001ArtistAnimation\u3067\u3082\u3067\u304d\u308b\u3088\u3068\u3044\u3046\u60c5\u5831\u3082\u3042\u308b\u3002\ncontourf\u3092\u9664\u3044\u3066\u3001\u6d41\u7dda\u3060\u3051\u63cf\u5199\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u7121\u4e8b\u4f5c\u6210\u3067\u304d\u305f\u306e\u3067\u3001\u3053\u308c\u306f\u3084\u306f\u308acontourf\u304c\u539f\u56e0\u306e\u30d0\u30b0\u3063\u307d\u3044\u3002\nhttp://nbviewer.ipython.org/github/barbagroup/CFDPython/blob/master/lessons/15_Step_11.ipynb\n\n\u3092\u898b\u3066\u3001\u30ad\u30e3\u30d3\u30c6\u30a3\u6d41\u308c\u306e\u66f8\u304d\u65b9\u304c\u308f\u304b\u3063\u305f\u304c\u3001\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3057\u306a\u3044\u306e\u3067\u7269\u8db3\u308a\u306a\u3044\u3002\n\n\u6700\u7d42\u7d50\u679c\u3060\u3051\u3092\u8868\u793a\u3059\u308b\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u3002\uff08\u5143\u30cd\u30bf\u3067\u306fiPython Notebook\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u3044\u308b\uff09\n\n```py:cavorg.py\nimport matplotlib.pyplot as plt\nimport numpy as np\nimport matplotlib.animation as animation\n\nnx = 41\nny = 41\nnt = 5\nnit=50\nc = 1\ndx = 2.0/(nx-1)\ndy = 2.0/(ny-1)\nx = np.linspace(0,2,nx)\ny = np.linspace(0,2,ny)\nX,Y = np.meshgrid(x,y)\n\nrho = 1\nnu = .1\ndt = .001\n\nu = np.zeros((ny, nx))\nv = np.zeros((ny, nx))\np = np.zeros((ny, nx)) \nb = np.zeros((ny, nx))\n\n\ndef buildUpB(b, rho, dt, u, v, dx, dy):\n    \n    b[1:-1,1:-1]=rho*(1/dt*((u[1:-1,2:]-u[1:-1,0:-2])/(2*dx)+(v[2:,1:-1]-v[0:-2,1:-1])/(2*dy))-\\\n                      ((u[1:-1,2:]-u[1:-1,0:-2])/(2*dx))**2-\\\n                      2*((u[2:,1:-1]-u[0:-2,1:-1])/(2*dy)*(v[1:-1,2:]-v[1:-1,0:-2])/(2*dx))-\\\n                      ((v[2:,1:-1]-v[0:-2,1:-1])/(2*dy))**2)\n\n    return b\n    \ndef presPoisson(p, dx, dy, b):\n    pn = np.empty_like(p)\n    pn = p.copy()\n    \n    for q in range(nit):\n        pn = p.copy()\n        p[1:-1,1:-1] = ((pn[1:-1,2:]+pn[1:-1,0:-2])*dy**2+(pn[2:,1:-1]+pn[0:-2,1:-1])*dx**2)/\\\n                        (2*(dx**2+dy**2)) -\\\n                        dx**2*dy**2/(2*(dx**2+dy**2))*b[1:-1,1:-1]\n\n        p[-1,:] =p[-2,:] ##dp/dy = 0 at y = 2\n        p[0,:] = p[1,:]  ##dp/dy = 0 at y = 0\n        p[:,0]=p[:,1]    ##dp/dx = 0 at x = 0\n        p[:,-1]=0        ##p = 0 at x = 2\n        \n    return p\n    \ndef cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu):\n    un = np.empty_like(u)\n    vn = np.empty_like(v)\n    b = np.zeros((ny, nx))\n    \n    for n in range(nt):\n        un = u.copy()\n        vn = v.copy()\n        \n        b = buildUpB(b, rho, dt, u, v, dx, dy)\n        p = presPoisson(p, dx, dy, b)\n        \n        u[1:-1,1:-1] = un[1:-1,1:-1]-\\\n                        un[1:-1,1:-1]*dt/dx*(un[1:-1,1:-1]-un[1:-1,0:-2])-\\\n                        vn[1:-1,1:-1]*dt/dy*(un[1:-1,1:-1]-un[0:-2,1:-1])-\\\n                        dt/(2*rho*dx)*(p[1:-1,2:]-p[1:-1,0:-2])+\\\n                        nu*(dt/dx**2*(un[1:-1,2:]-2*un[1:-1,1:-1]+un[1:-1,0:-2])+\\\n                        dt/dy**2*(un[2:,1:-1]-2*un[1:-1,1:-1]+un[0:-2,1:-1]))\n\n        v[1:-1,1:-1] = vn[1:-1,1:-1]-\\\n                        un[1:-1,1:-1]*dt/dx*(vn[1:-1,1:-1]-vn[1:-1,0:-2])-\\\n                        vn[1:-1,1:-1]*dt/dy*(vn[1:-1,1:-1]-vn[0:-2,1:-1])-\\\n                        dt/(2*rho*dy)*(p[2:,1:-1]-p[0:-2,1:-1])+\\\n                        nu*(dt/dx**2*(vn[1:-1,2:]-2*vn[1:-1,1:-1]+vn[1:-1,0:-2])+\\\n                        (dt/dy**2*(vn[2:,1:-1]-2*vn[1:-1,1:-1]+vn[0:-2,1:-1])))\n\n        u[0,:] = 0\n        u[:,0] = 0\n        u[:,-1] = 0\n        u[-1,:] = 1    #set velocity on cavity lid equal to 1\n        v[0,:] = 0\n        v[-1,:]=0\n        v[:,0] = 0\n        v[:,-1] = 0\n   \n    return u, v, p\n    \nfig = plt.figure(figsize=(11,7), dpi=100)\nu, v, p = cavityFlow(nt, u, v, dt, dx, dy, p, rho, nu)\n\nplt.contourf(X,Y,p,alpha=0.5)\nplt.colorbar()\nplt.contour(X,Y,p)\nplt.quiver(X[::2,::2],Y[::2,::2],u[::2,::2],v[::2,::2])\nplt.xlabel('X')\nplt.ylabel('Y')\nplt.show()\n```\n\nmatplotlib.animation\u3092\u4f7f\u3046\u3068gif\u30a2\u30cb\u30e1\u304c\u4f5c\u308c\u308b\u3089\u3057\u3044\u306e\u3067\u6311\u6226\u3057\u3066\u307f\u305f\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u3002\u7406\u7531\u3092\u4ee5\u4e0b\u3067\u8aac\u660e\u3059\u308b\u3002\n\ngif\u30a2\u30cb\u30e1\u306f\u3001imagemagick\u304c\u5165\u3063\u3066\u3044\u308c\u3070\u4f5c\u308c\u308b\u3002\u3053\u308c\u306f\u4ee5\u4e0b\u53c2\u7167\u3002\nhttp://kiito.hatenablog.com/entry/2013/11/27/233507\n\n\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3055\u305b\u308b\u305f\u3081\u306e\u5177\u4f53\u7684\u306a\u65b9\u6cd5\u306f\u4ee5\u4e0b\u3002\n>\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3092\u3055\u305b\u308b\u65b9\u6cd5\u306f\u4e8c\u901a\u308a\u306e\u3084\u308a\u65b9\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n>`animation.ArtistAnimation`\n>...\u4e8b\u524d\u306b\u7528\u610f\u3057\u3066\u3042\u308b\u30c7\u30fc\u30bf\u3092\u63cf\u753b\n>`animation.FuncAnimation`\n>...\u968f\u6642\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\n\nfrom http://cflat-inc.hatenablog.com/entry/2014/03/17/214719\n\n\u305d\u306e\u4ed6\u306e\u4f8b\nhttp://qiita.com/HirofumiYashima/items/5864fb9384053b77cf6f\nhttp://d.hatena.ne.jp/xef/20120629/p2\nhttp://stackoverflow.com/questions/24166236/add-text-to-image-animated-with-matplotlib-artistanimation\n\n\u6700\u521d\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u306f`cavityFlow()`\u306e\u4e2d\u3067for\u30eb\u30fc\u30d7\u3092\u56de\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30eb\u30fc\u30d7\u3054\u3068\u306b\u30c7\u30fc\u30bf\u3092\u5410\u304d\u51fa\u3057\u3066\u3001ArtistAnimation\u3067\u63cf\u753b\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3060\u304c\u3001\u63cf\u753b\u7528\u30c7\u30fc\u30bf\u306e\u914d\u5217\u306bcontourf\u3092\u6e21\u3059\u3068\u30d0\u30b0\u304c\u51fa\u308b\u3002\u3053\u308c\u306f\u4ed6\u306e\u3068\u3053\u308d\u3067\u3082\u5831\u544a\u3055\u308c\u3066\u3044\u308b\u306e\u3060\u304c\u3001\u5bfe\u5fdc\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u3069\u3046\u304b\u308f\u304b\u3089\u306a\u3044\u3002\n\nhttp://matplotlib.1069221.n5.nabble.com/Matplotlib-1-1-0-animation-vs-contour-plots-td18703.html\nhttp://stackoverflow.com/questions/23070305/how-can-i-make-an-animation-with-contourf\n\n\u3068\u308a\u3042\u3048\u305aArtistAnimation\u3067\u306f\u306a\u304fFuncAnimation\u3067\u3084\u308c\u3070contourf\u3067\u3082\u30a2\u30cb\u30e1\u306b\u306a\u308b\u3089\u3057\u3044\u304c\u3001ArtistAnimation\u3067\u3082\u3067\u304d\u308b\u3088\u3068\u3044\u3046\u60c5\u5831\u3082\u3042\u308b\u3002\ncontourf\u3092\u9664\u3044\u3066\u3001\u6d41\u7dda\u3060\u3051\u63cf\u5199\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u7121\u4e8b\u4f5c\u6210\u3067\u304d\u305f\u306e\u3067\u3001\u3053\u308c\u306f\u3084\u306f\u308acontourf\u304c\u539f\u56e0\u306e\u30d0\u30b0\u3063\u307d\u3044\u3002\n"}