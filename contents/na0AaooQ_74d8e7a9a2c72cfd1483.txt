{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nAWS\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3001capistrano 3.3 + rbenv + Bundler + Ruby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001capistrano3\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u624b\u9806\u3067\u3059\u3002\ncapistrano3\u30b5\u30fc\u30d0\u4e0a\u3067capistrano\u30bf\u30b9\u30af(task)\u3092\u5b9f\u884c\u3059\u308b\u4e8b\u3067\u3001ssh\u7d4c\u7531\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(CentOS 6.6)\u3078\u63a5\u7d9a\u3057\u3001\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(\u4eca\u56de\u306e\u4f8b\u3067\u306f/etc/hosts\u30d5\u30a1\u30a4\u30eb)\u306e\u5185\u5bb9\u3092\u5909\u66f4\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n\u30fbAmazon Linux AMI 2014.09.1 (HVM) - ami-4985b048\n\n\u69cb\u7bc9\u3057\u305f\u74b0\u5883\n\u4ee5\u4e0b\u306e\u69cb\u6210\u3067capistrano3\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\u30fbAmazon Linux\n\u30fbcapistrano3 (Capistrano 3.3.5)\n\u30fbrbenv\n\u30fbBundler 1.7.12\n\u30fbRuby 2.2.0\n\ncapistrano3\u30b5\u30fc\u30d0\u306b\u8ffd\u52a0\u3059\u308b\u30bf\u30b9\u30af\u3068ssh\u63a5\u7d9a\u5148\u306e\u30b5\u30fc\u30d0\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u7d4c\u7531\u3067\u30ea\u30e2\u30fc\u30c8\u306eCentOS\u30b5\u30fc\u30d0(IP\u30a2\u30c9\u30ec\u30b9\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306e\u4eeeIP\u30a2\u30c9\u30ec\u30b9198.51.100.10\u3067\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059)\u3078\u63a5\u7d9a\u3057\u3001CentOS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u624b\u9806\u307e\u3067\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\ncapistrano3\u30b5\u30fc\u30d0\u304b\u3089CentOS 6.6\u30b5\u30fc\u30d0(198.51.100.10)\u3078ssh\u63a5\u7d9a\u3057\u3001\u4f8b\u3068\u3057\u3066\u3001\u305d\u306e\u30b5\u30fc\u30d0\u306e/etc/hosts\u3092cp\u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u4e0a\u3067\u3001/etc/hosts\u306e\u5185\u5bb9\u3092\u66f8\u304d\u63db\u3048\u308b\u30bf\u30b9\u30af\u3092capistrano3\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u53c2\u8003\u60c5\u5831\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306f\u3001http://qiita.com/kazuph \u69d8\u306e\u4ee5\u4e0b\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3068\u3066\u3082\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/kazuph/items/deeaa7d3f9889674d7fe\n\ncapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u624b\u9806\n\u30fb\u300cAWS Management Console\u300d\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cAWS Management Console\u300d\u2192\u300cIAM\u300d->\u300cRoles\u300d->\u300cCreate New Role\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001capistrano3\u30b5\u30fc\u30d0\u7528\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3000\u4f5c\u6210\u3059\u308bIAM\u30ed\u30fc\u30eb\u540d: capistrano-server-role\nIAM\u30ed\u30fc\u30eb\u4f5c\u6210\u624b\u9806\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/3ec5f8b80150c37a0566\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cAWS Management Console\u300d\u2192\u300cEC2\u300d->\u300cSecurity Groups\u300d->\u300cCreate Security Group\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001capistrano3\u30b5\u30fc\u30d0\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3000\u4f5c\u6210\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u540d: capistrano-server\n\u4f5c\u6210\u3057\u305f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3001capistrano3\u30b5\u30fc\u30d0\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u306eCentOS\u30b5\u30fc\u30d0(\u4eca\u56de\u306e\u4f8b\u3067\u306f198.51.100.10/32)\u3078ssh\u63a5\u7d9a\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u300cOutbound\u300d\u306fAll traffic(\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\u6642\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a)\u3067\u3001\u300cInbound\u300d\u306b\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u3067\u63a5\u7d9a\u3059\u308b\u5bfe\u8c61\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9(198.51.100.10/32)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306eOutBound\u8a2d\u5b9a\u4f8b]\n\n\n\nType\nProtocol\nPort Range\nDestination\n\n\n\n\nAll traffic\nAll\nAll\n0.0.0.0/0\n\n\n\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306eInbound\u8a2d\u5b9a\u4f8b]\n\n\n\nType\nProtocol\nPort Range\nSource\n\n\n\n\nSSH\nTCP\n22\n198.51.100.10/32\n\n\n\n\u5b9f\u969b\u306e\u904b\u7528\u74b0\u5883\u3067\u306f\u3001\u5404\u30b5\u30fc\u30d0\u306essh\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u306f\u30c7\u30d5\u30a9\u30eb\u30c822\u756a\u304b\u3089\u5225\u306e\u30dd\u30fc\u30c8\u306b\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306f\u4e0a\u8a18\u300cInbound\u300d\u306e\u300cPort Range\u300d\u3067\u901a\u4fe1\u8a31\u53ef\u3057\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u309222\u756a\u304b\u3089ssh\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\u30fbcapistrano\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u300cAWS Management Console\u300d\u2192\u300cEC2\u300d->\u300cInstances\u300d->\u300cLaunch Instance\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Amazon Linux\u306eAMI\u3092\u4f7f\u7528\u3057\u3066\u3001capistrano\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u624b\u9806\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u4e0b\u3055\u3044\u3002AMI\u306f\u300cAmazon Linux AMI 2014.09.1 (HVM) - ami-4985b048\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nhttp://qiita.com/na0AaooQ/items/2774f63f540969a55941\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u306f\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u300ccapistrano-server-role\u300d\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u300ccapistrano-server\u300d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u521d\u671f\u8a2d\u5b9a)\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3089\u3001ec2-user\u3067ssh\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fb\u30ab\u30fc\u30cd\u30eb\u3084\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n$ hostname\nip-172-XX-XX-XXX\n$ id\nuid=XXX(ec2-user) gid=XXX(ec2-user) groups=XXX(ec2-user),XX(wheel)\n$\n\n$ sudo yum update\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306e\u52d5\u4f5c\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo yum -y install gcc git tree libyaml libyaml-devel zlib zlib-devel\n\n$ sudo yum -y install readline readline-devel openssl openssl-devel libxml2 libxml2-devel\n\n$ sudo yum -y install libxslt libxslt-devel libxslt libxslt-devel libffi-devel\n\n\u30fb Amazon Linux\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n$ sudo cp -p /etc/localtime /etc/localtime.ORG\n$ diff /etc/localtime /etc/localtime.ORG\n$\n\n$ sudo cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n$\n\n$ date\nTue Jan 27 00:51:09 JST 2015\n$\n\n$ sudo cp -p /etc/sysconfig/clock /etc/sysconfig/clock.ORG\n$ sudo diff /etc/sysconfig/clock /etc/sysconfig/clock.ORG\n$\n\n$ sudo vi /etc/sysconfig/clock\nZONE=\"UTC\"\nUTC=true\n\u3000\u2193\nZONE=\"Asia/Tokyo\" \nUTC=false\nARC=false\n\n$ cat /etc/sysconfig/clock\nZONE=\"Asia/Tokyo\"\nUTC=false\nARC=false\n$\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncapistrano\u30e6\u30fc\u30b6\u3068capistrano\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nuid\u3084gid\u306f\u9069\u5b9c\u30b7\u30b9\u30c6\u30e0\u4e0a\u306b\u5b58\u5728\u3057\u306a\u3044\u756a\u53f7\u3092\u78ba\u8a8d\u306e\u4e0a\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ sudo cp -p /etc/passwd /etc/passwd.ORG\n$ sudo diff /etc/passwd /etc/passwd.ORG\n$ sudo cp -p /etc/shadow /etc/shadow.ORG\n$ sudo diff /etc/shadow /etc/shadow.ORG\n$ sudo cp -p /etc/group /etc/group.ORG\n$ sudo diff /etc/group /etc/group.ORG\n$\n\n$ sudo groupadd -g [capistrano\u30b0\u30eb\u30fc\u30d7\u306b\u6307\u5b9a\u3059\u308bgid] capistrano\n$ sudo useradd -u [capistrano\u30e6\u30fc\u30b6\u306b\u6307\u5b9a\u3059\u308buid] -s /bin/bash -d /home/capistrano -g capistrano -N -c 'Capistrano User' capistrano\n]$\n\n$ id capistrano\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n\u30fbcapistrano\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n$ sudo cp -p /etc/sysconfig/network /etc/sysconfig/network.ORG\n$ diff /etc/sysconfig/network /etc/sysconfig/network.ORG\n$\n\n$ sudo sed -i -e 's/^HOSTNAME=localhost.localdomain/HOSTNAME=example-capistrano-server/g' /etc/sysconfig/network\n$\n\n$ diff /etc/sysconfig/network.ORG /etc/sysconfig/network\n2c2\n< HOSTNAME=localhost.localdomain\n---\n> HOSTNAME=example-capistrano-server\n$\n$ grep HOSTNAME /etc/sysconfig/network\nHOSTNAME=example-capistrano-server\n$\n\n\u4e00\u5ea6\u3001capistrano3\u30b5\u30fc\u30d0\u3092\u30ea\u30d6\u30fc\u30c8\u3057\u307e\u3059\u3002\n$ sudo reboot\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/\u914d\u4e0b\u306brbenv + ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u304d\u305f\u3089\u3001ec2-user\u3067ssh\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306brubygems\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ hostname\nexample-capistrano-server\n$ rpm -qa | grep rubygems\nrubygems20-2.0.14-1.20.amzn1.noarch\n$\n\n\u30fbec2-user\u304b\u3089capistrano\u30e6\u30fc\u30b6\u3078\u30b9\u30a4\u30c3\u30c1\u3057\u307e\u3059\u3002\u3053\u306e\u5f8c\u306e\u624b\u9806\u306f\u57fa\u672c\u7684\u306bcapistrano\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ sudo su -\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306brbenv\u3068ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/\u914d\u4e0b\u306brbenv + ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano\n$ ls -lrta /home/capistrano/rbenv\nls: cannot access /home/capistrano/rbenv: No such file or directory\n$\n\n$ git clone git://github.com/sstephenson/rbenv.git /home/capistrano/rbenv\n$\n\n$ mkdir -p /home/capistrano/rbenv/plugins\n$\n\n$ git clone https://github.com/sstephenson/ruby-build.git /home/capistrano/rbenv/plugins/ruby-build\n$\n\n\u30fbrbenv\u3068ruby-build\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano\n$ rbenv -v\nrbenv 0.4.0-129-g7e0e85b\n$\n\n$ ls -lrta /home/capistrano/\ntotal 28\n-rw-r--r--  1 capistrano capistrano  124 Nov  4 08:09 .bashrc\n-rw-r--r--  1 capistrano capistrano  176 Nov  4 08:09 .bash_profile\n-rw-r--r--  1 capistrano capistrano   18 Nov  4 08:09 .bash_logout\ndrwxr-xr-x  4 root       root       4096 Jan 27 00:59 ..\ndrwxrwxr-x 10 capistrano capistrano 4096 Jan 27 01:18 rbenv\ndrwxrw----  3 capistrano capistrano 4096 Jan 27 01:19 .pki\ndrwx------  4 capistrano capistrano 4096 Jan 27 01:19 .\n$\n\n$ ls -lrta /home/capistrano/rbenv/plugins/ruby-build/\ntotal 52\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:19 ..\n-rw-rw-r-- 1 capistrano capistrano  438 Jan 27 01:19 .travis.yml\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:19 share\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 01:19 script\n-rw-rw-r-- 1 capistrano capistrano 9811 Jan 27 01:19 README.md\n-rw-rw-r-- 1 capistrano capistrano 1063 Jan 27 01:19 LICENSE\n-rwxrwxr-x 1 capistrano capistrano  357 Jan 27 01:19 install.sh\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 01:19 bin\ndrwxrwxr-x 5 capistrano capistrano 4096 Jan 27 01:19 test\ndrwxrwxr-x 8 capistrano capistrano 4096 Jan 27 01:19 .git\ndrwxrwxr-x 7 capistrano capistrano 4096 Jan 27 01:19 .\n$\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u306e.bash_profile\u306brbenv\u306e\u30d1\u30b9\u3068\u300crbenv init -\u300d\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n$ echo $SHELL\n/bin/bash\n$ cp -p /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n$ diff /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n$\n\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n$ vi /home/capistrano/.bash_profile\n\u3000(\u672b\u5c3e\u306e\u8a18\u8ff0\u3092\u5909\u66f4\u3057\u307e\u3059)\nPATH=$PATH:$HOME/bin\n\nexport PATH\n\u3000\u2193\n##### rbenv\nexport RBENV_ROOT=\"/home/capistrano/rbenv\" \nexport PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\" \neval \"$(rbenv init -)\" \n#####\n\n\u30fb\u5909\u66f4\u3057\u305f/home/capistrano/.bash_profile\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ diff /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n10,14c10,12\n< ##### rbenv\n< export RBENV_ROOT=\"/home/capistrano/rbenv\"\n< export PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\"\n< eval \"$(rbenv init -)\"\n< #####\n---\n> PATH=$PATH:$HOME/bin\n>\n> export PATH\n$\n\n$ cat /home/capistrano/.bash_profile\n# .bash_profile\n\n# Get the aliases and functions\nif [ -f ~/.bashrc ]; then\n        . ~/.bashrc\nfi\n\n# User specific environment and startup programs\n\n##### rbenv\nexport RBENV_ROOT=\"/home/capistrano/rbenv\"\nexport PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\"\neval \"$(rbenv init -)\"\n#####\n$\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u306b\u5148\u307b\u3069.bash_profile\u3078\u8ffd\u52a0\u3057\u305f\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ source /home/capistrano/.bash_profile\n$\n\n\u30fb\u5ff5\u306e\u70ba\u3001capistrano\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ exit\n# id\nuid=0(root) gid=0(root) groups=0(root)\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n\u30fb/home/capistrano/rbenv/shims\u3068/home/capistrano/rbenv/versions\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u78ba\u8a8d\u3002\n\u5148\u307b\u3069.bash_profile\u306b\u8a2d\u5b9a\u3057\u305f\u300crbenv init -\u300d\u306b\u3088\u308a/home/capistrano/rbenv/shims\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7a7a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3051\u4f5c\u6210\u3055\u308c\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n$ ls -lrta /home/capistrano/rbenv/shims\ntotal 8\ndrwxrwxr-x 12 capistrano capistrano 4096 Jan 27 01:34 ..\ndrwxrwxr-x  2 capistrano capistrano 4096 Jan 27 01:42 .\n$\n\n$ ls -lrta /home/capistrano/rbenv/versions\ntotal 8\ndrwxrwxr-x 12 capistrano capistrano 4096 Jan 27 01:34 ..\ndrwxrwxr-x  2 capistrano capistrano 4096 Jan 27 01:34 .\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067rbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306aRuby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ rbenv install -l\nAvailable versions:\n  1.8.6-p383\n  1.8.6-p420\n  1.8.7-p249\n  1.8.7-p302\n\u3000\u3000(\u9014\u4e2d\u7701\u7565)\n  2.2.0-dev\n  2.2.0-preview1\n  2.2.0-preview2\n  2.2.0-rc1\n  2.2.0\n  rbx-2.2.0\n\u3000\u3000(\u9014\u4e2d\u7701\u7565)\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067rbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306frbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002/home/capistrano\u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001/home/capistrano/rbenv/versions/2.2.0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ rbenv ruby -v\nrbenv: no such command `ruby'\n$ rbenv versions\n* system (set by /home/capistrano/rbenv/version)\n$\n\n$ rbenv install 2.2.0\nDownloading ruby-2.2.0.tar.gz...\n-> http://dqw8nmjcqpjn7.cloudfront.net/7671e394abfb5d262fbcd3b27a71bf78737c7e9347fa21c39e58b0bb9c4840fc\nInstalling ruby-2.2.0...\nInstalled ruby-2.2.0 to /home/capistrano/rbenv/versions/2.2.0\n\n$\n\n\u30fbrehash\u3057\u307e\u3059\u3002\n$ rbenv rehash\n$\n\n\u30fbrbenv\u3067Ruby 2.2.0\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ls -lrta /home/capistrano/rbenv/versions/2.2.0/\ntotal 24\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:50 ..\ndrwxr-xr-x 4 capistrano capistrano 4096 Jan 27 01:56 lib\ndrwxr-xr-x 2 capistrano capistrano 4096 Jan 27 01:56 bin\ndrwxr-xr-x 3 capistrano capistrano 4096 Jan 27 01:56 include\ndrwxr-xr-x 6 capistrano capistrano 4096 Jan 27 01:56 .\ndrwxr-xr-x 5 capistrano capistrano 4096 Jan 27 01:56 share\n$\n\n\u30fbrbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fRuby 2.2.0\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ ruby -v\nruby 2.0.0p598 (2014-11-13 revision 48408) [x86_64-linux]\n$\n\n$ rbenv version\nsystem (set by /home/capistrano/rbenv/version)\n$\n\n$ rbenv global 2.2.0\n$\n\n$ ruby -v\nruby 2.2.0p0 (2014-12-25 revision 49005) [x86_64-linux]\n$\n\n$ rbenv version\n2.2.0 (set by /home/capistrano/rbenv/version)\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067Bundler\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n\u30fbRuby Gem Bundler\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ exit\nlogout\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n$ pwd\n/home/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n\n$ rbenv exec gem install bundler\nFetching: bundler-1.7.12.gem (100%)\nSuccessfully installed bundler-1.7.12\nParsing documentation for bundler-1.7.12\nInstalling ri documentation for bundler-1.7.12\nDone installing documentation for bundler after 2 seconds\n1 gem installed\n$\n\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n\n\u30fbRuby Gem Bundler\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano\n$ rbenv rehash\n$\n\n$ rbenv exec gem which bundler\n/home/capistrano/rbenv/versions/2.2.0/lib/ruby/gems/2.2.0/gems/bundler-1.7.12/lib/bundler.rb\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067capistrano3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067capistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306e/home/capistrano/capistrano\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$\n\n$ ll /home/capistrano/capistrano\nls: cannot access /home/capistrano/capistrano: No such file or directory\n$\n\n$ mkdir /home/capistrano/capistrano\n$\n\n$ ll /home/capistrano/capistrano\ntotal 0\n$\n\n\u30fb/home/capistrano/capistrano/Gemfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ cd /home/capistrano/capistrano\n$ pwd\n/home/capistrano/capistrano\n$\n\n$ rbenv exec bundle init\nWriting new Gemfile to /home/capistrano/capistrano/Gemfile\n$\n\n$ ls -lrta /home/capistrano/capistrano/\ntotal 12\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:13 .\n$\n$ cat /home/capistrano/capistrano/Gemfile\n# A sample Gemfile\nsource \"https://rubygems.org\"\n\n# gem \"rails\"\n$\n\n$ pwd\n/home/capistrano/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n\n$ cp -p /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n$ diff /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n$\n$ echo \"gem 'capistrano'\" >> /home/capistrano/capistrano/Gemfile\n$\n$ diff /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n5d4\n< gem 'capistrano'\n$\n\n$ cat /home/capistrano/capistrano/Gemfile\n# A sample Gemfile\nsource \"https://rubygems.org\"\n\n# gem \"rails\"\ngem 'capistrano'\n$\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/capistrano\u914d\u4e0b\u306bcapistrano3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano/capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n$ bundle install\nFetching gem metadata from https://rubygems.org/.......\nResolving dependencies...\nUsing rake 10.4.2\nInstalling capistrano-stats 1.1.1\nInstalling i18n 0.7.0\nInstalling colorize 0.7.5\nInstalling net-ssh 2.9.2\nInstalling net-scp 1.2.1\nInstalling sshkit 1.6.1\nInstalling capistrano 3.3.5\nUsing bundler 1.7.12\nYour bundle is complete!\nUse `bundle show [gemname]` to see where a bundled gem is installed.\nPost-install message from capistrano-stats:\n    Capistrano will ask you the next time you run it if you would like to share\n    anonymous usage statistics with the maintainance team to help guide our\n    development efforts. We emplore you to opt-in, but we understand if your\n    privacy is important to you in this regard.\nPost-install message from capistrano:\nCapistrano 3.1 has some breaking changes. Please check the CHANGELOG: http://goo.gl/SxB0lr\n\nIf you're upgrading Capistrano from 2.x, we recommend to read the upgrade guide: http://goo.gl/4536kB\n\nThe `deploy:restart` hook for passenger applications is now in a separate gem called capistrano-passenger.  Just add it to your Gemfile and require it in your Capfile.\n$\n\n\u30fbcapistrano3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ls -lrta /home/capistrano/capistrano/\ntotal 20\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:15 .\n$\n\n$ pwd\n/home/capistrano/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\ncapistrano (3.3.5)\ncapistrano-stats (1.1.1)\ncolorize (0.7.5)\ni18n (0.7.0)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\nnet-scp (1.2.1)\nnet-ssh (2.9.2)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\nsshkit (1.6.1)\ntest-unit (3.0.8)\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067cap install\u3092\u5b9f\u884c\u3057\u3066capistrano3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u3092\u751f\u6210\u3059\u308b)\n\u30fbcap install\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001capistrano3\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u3092\u751f\u6210\u3059\u308b\u3002\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano/capistrano\n$ ls -lrta /home/capistrano/capistrano/\ntotal 20\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:15 .\n$\n\n$ cap install\nmkdir -p config/deploy\ncreate config/deploy.rb\ncreate config/deploy/staging.rb\ncreate config/deploy/production.rb\nmkdir -p lib/capistrano/tasks\ncreate Capfile\nCapified\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u306e\u751f\u6210\u78ba\u8a8d)\n\u30fb\u5148\u307b\u3069\u5b9f\u884c\u3057\u305fcap install\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306acapistrano3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ ls -lrta /home/capistrano/capistrano/\ntotal 32\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 config\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 lib\n-rw-r--r-- 1 capistrano capistrano  837 Jan 27 02:25 Capfile\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/config/\ntotal 16\n-rw-rw-r-- 1 capistrano capistrano 1275 Jan 27 02:25 deploy.rb\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 deploy\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 ..\n$\n\n$ ls -lrta /home/capistrano/capistrano/config/deploy\ntotal 16\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\n-rw-rw-r-- 1 capistrano capistrano 1459 Jan 27 02:25 staging.rb\n-rw-rw-r-- 1 capistrano capistrano 1459 Jan 27 02:25 production.rb\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/\ntotal 12\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 capistrano\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/\ntotal 12\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 tasks\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/tasks/\ntotal 8\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d)\n\u30fbcapistrano3\u304c/home/capistrano/capistrano\u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u3001capistrano3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u81ea\u4f53\u306f\u5b8c\u4e86\u3067\u3059\u3002capistrano3\u306e\u30bf\u30b9\u30af\u8ffd\u52a0\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\u81f4\u3057\u307e\u3059\u3002\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ exit\nlogout\n# id\nuid=0(root) gid=0(root) groups=0(root)\n# su - capistrano\n\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n$ cd /home/capistrano/capistrano/\n$ pwd\n/home/capistrano/capistrano\n$\n\n\u30fbcap -V\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001capistrano\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano/capistrano\n$ cap -V\nCapistrano Version: 3.3.5 (Rake Version: 10.4.2)\n$\n\n\u30fbcap -T\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001capistrano\u306e\u30bf\u30b9\u30af\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ pwd\n/home/capistrano/capistrano\n$ cap -T\ncap deploy                         # Deploy a new release\ncap deploy:check                   # Check required files and directories exist\ncap deploy:check:directories       # Check shared and release directories exist\ncap deploy:check:linked_dirs       # Check directories to be linked exist in shared\ncap deploy:check:linked_files      # Check files to be linked exist in shared\ncap deploy:check:make_linked_dirs  # Check directories of files to be linked exist in shared\ncap deploy:cleanup                 # Clean up old releases\ncap deploy:cleanup_rollback        # Remove and archive rolled-back release\ncap deploy:finished                # Finished\ncap deploy:finishing               # Finish the deployment, clean up server(s)\ncap deploy:finishing_rollback      # Finish the rollback, clean up server(s)\ncap deploy:log_revision            # Log details of the deploy\ncap deploy:published               # Published\ncap deploy:publishing              # Publish the release\ncap deploy:revert_release          # Revert to previous release timestamp\ncap deploy:reverted                # Reverted\ncap deploy:reverting               # Revert server(s) to previous release\ncap deploy:rollback                # Rollback to previous release\ncap deploy:set_current_revision    # Place a REVISION file with the current revision SHA in the current release path\ncap deploy:started                 # Started\ncap deploy:starting                # Start a deployment, make sure server(s) ready\ncap deploy:symlink:linked_dirs     # Symlink linked directories\ncap deploy:symlink:linked_files    # Symlink linked files\ncap deploy:symlink:release         # Symlink release to current\ncap deploy:symlink:shared          # Symlink files and directories from shared to release\ncap deploy:updated                 # Updated\ncap deploy:updating                # Update server(s) by setting up a new release\ncap install                        # Install Capistrano, cap install STAGES=staging,production\n$\n\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (config/deploy.rb)\n\u30fb/home/capistrano/capistrano/config/deploy.rb\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n$ pwd\n/home/capistrano/capistrano\n$ cp -p /home/capistrano/capistrano/config/deploy.rb /home/capistrano/capistrano/config/deploy.rb.ORG\n$ diff /home/capistrano/capistrano/config/deploy.rb /home/capistrano/capistrano/config/deploy.rb.ORG\n$\n\n$ vi /home/capistrano/capistrano/config/deploy.rb\n\u3000(\u4e2d\u8eab\u3092\u5168\u90e8\u6d88\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3060\u3051\u306b\u5909\u66f4\u3057\u307e\u3059)\n\n\u3000\u3000\u2193\n\n#####\n# config valid only for current version of Capistrano\nlock '3.3.5'\nset :pty, true\n#####\n\n$ cat /home/capistrano/capistrano/config/deploy.rb\n#####\n## config valid only for current version of Capistrano\nlock '3.3.5'\nset :pty, true\n######\n$\n\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (config/deploy/develop.rb capistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u3092\u8a18\u8ff0\u3059\u308b)\n\u30fb/home/capistrano/capistrano/config/deploy/develop.rb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3057\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3059\u308b\u30b5\u30fc\u30d0\u306f\u4ee5\u4e0b\u306eIP\u30a2\u30c9\u30ec\u30b9\u3060\u3068\u3057\u307e\u3059\u3002\n\u3000198.51.100.10\ncapistrano\u30b5\u30fc\u30d0\u304b\u3089198.51.100.10\u3078ssh\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306e\u30e6\u30fc\u30b6\u540d\u306fexample\u3068\u3057\u307e\u3059\u3002\n$ ll /home/capistrano/capistrano/config/deploy/develop.rb\nls: cannot access /home/capistrano/capistrano/config/deploy/develop.rb: No such file or directory\n$\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092develop.rb\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n198.51.100.10\u30b5\u30fc\u30d0\u3078\u306eexample\u30e6\u30fc\u30b6\u8ffd\u52a0\u306f\u5f8c\u8ff0\u81f4\u3057\u307e\u3059\u3002\n$ vi /home/capistrano/capistrano/config/deploy/develop.rb\nrole :web, %w{example@198.51.100.10}\n\n$ cat /home/capistrano/capistrano/config/deploy/develop.rb\nrole :web, %w{capistrano@198.51.100.10}\n$\n\n$ ll /home/capistrano/capistrano/config/deploy/develop.rb\n-rw-rw-r-- 1 capistrano capistrano 80 Jan 27 02:53 /home/capistrano/capistrano/config/deploy/develop.rb\n$\n\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (Capfile)\n\u30fb/home/capistrano/capistrano/Capfile\u306e\u78ba\u8a8d\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u3068\u308a\u3042\u3048\u305a\u521d\u671f\u8a2d\u5b9a\u306e\u307e\u307e\u5909\u66f4\u305b\u305a\u306b\u9032\u3081\u307e\u3059\u3002\n$ cat /home/capistrano/capistrano/Capfile\n# Load DSL and set up stages\nrequire 'capistrano/setup'\n\n# Include default deployment tasks\nrequire 'capistrano/deploy'\n\n# Include tasks from other gems included in your Gemfile\n#\n# For documentation on these, see for example:\n#\n#   https://github.com/capistrano/rvm\n#   https://github.com/capistrano/rbenv\n#   https://github.com/capistrano/chruby\n#   https://github.com/capistrano/bundler\n#   https://github.com/capistrano/rails\n#   https://github.com/capistrano/passenger\n#\n# require 'capistrano/rvm'\n# require 'capistrano/rbenv'\n# require 'capistrano/chruby'\n# require 'capistrano/bundler'\n# require 'capistrano/rails/assets'\n# require 'capistrano/rails/migrations'\n# require 'capistrano/passenger'\n\n# Load custom tasks from `lib/capistrano/tasks' if you have any defined\nDir.glob('lib/capistrano/tasks/*.rake').each { |r| import r }\n$\n\n\ncapistrano3\u306e\u30bf\u30b9\u30af\u8ffd\u52a0\u624b\u9806\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3078\u306ecapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001capistrano\u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\u30fb/home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\u3092\u4f5c\u6210\u3057\u3001capistrano\u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u5148\u307b\u3069\u8a18\u8f09\u3057\u305f\u300cexample@198.51.100.10\u300d\u30b5\u30fc\u30d0\u3078ssh\u63a5\u7d9a\u3057\u3066\u3001\u5b9f\u884c\u3055\u305b\u305f\u3044\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30b9\u30af\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u3002\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/tasks/\ntotal 8\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3059\u308brake\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ vi /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n\n\nutils.rake\nnamespace :hosts_file_utils do\n  task :show_hosts_file do\n    on roles(:web) do\n      execute \"cat /etc/hosts\"\n    end\n  end\n  task :backup_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n    end\n  end\n  task :change_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n      execute \"sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\"\n    end\n  end\nend\n\n\nrake\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u305f\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[capistrano@example-capistrano-server ~]$ cat /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\nnamespace :hosts_file_utils do\n  task :show_hosts_file do\n    on roles(:web) do\n      execute \"cat /etc/hosts\"\n    end\n  end\n  task :backup_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n    end\n  end\n  task :change_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n      execute \"sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\"\n    end\n  end\nend\n[capistrano@example-capistrano-server ~]$\n\nrake\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n[capistrano@example-capistrano-server ~]$ ll /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n-rw-rw-r-- 1 capistrano capistrano 548 Jan 27 04:02 /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n[capistrano@example-capistrano-server ~]$\n\n\ncapistrano3\u30b5\u30fc\u30d0\u306bssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u70ba\u306e\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u3092\u4f5c\u6210\u3059\u308b\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089198.51.100.10\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3001ssh\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\ncapistrano3\u30b5\u30fc\u30d0\u3067capistrano\u30e6\u30fc\u30b6\u306e\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n\n$ ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/home/capistrano/.ssh/id_rsa):\nCreated directory '/home/capistrano/.ssh'.\nEnter passphrase (empty for no passphrase):\u3000\u2192\u3000\u4eca\u56de\u306f\u4f8b\u306a\u306e\u3067\u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u5165\u529b\u305b\u305aEnter\u30ad\u30fc\u62bc\u4e0b\u3002\n\n$ ll /home/capistrano/.ssh/\ntotal 8\n-rw------- 1 capistrano capistrano 1679 Jan 27 03:16 id_rsa\n-rw-r--r-- 1 capistrano capistrano  418 Jan 27 03:16 id_rsa.pub\n$\n\n\u30fb\u516c\u958b\u9375\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ cat /home/capistrano/.ssh/id_rsa.pub\nssh-rsa AAAA******** (\u516c\u958b\u9375\u306e\u6587\u5b57\u5217) ***********capistrano@example-capistrano-server\n$\n\n\nssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u306bssh\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6\u4f5c\u6210 + capistrano\u30e6\u30fc\u30b6\u306e\u516c\u958b\u9375\u3092/home/example/.ssh/authorized_keys\u306b\u8ffd\u52a0\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089\u306essh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u3001198.51.100.10\u306bexample\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n198.51.100.10\u306broot\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/passwd /etc/passwd.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/shadow /etc/shadow.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/group /etc/group.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# groupadd example\n[root@not-aws-vpc-server-198-51-100-10 ~]# useradd -s /bin/bash -d /home/example -g example example\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# su - example\n[example@not-aws-vpc-server-198-51-100-10 ~]$ id\nuid=XXX(example) gid=XXX(example) groups=XXX(example) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n\n[example@not-aws-vpc-server-198-51-100-10 ~]$ mkdir /home/example/.ssh\n[example@not-aws-vpc-server-198-51-100-10 ~]$ chmod 700 /home/example/.ssh\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n\n[example@not-aws-vpc-server-198-51-100-10 ~]$ echo \"ssh-rsa AAAA******** (\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fcapistrano3\u30b5\u30fc\u30d0\u306e/home/capistrano/.ssh/id_rsa.pub\u306e\u516c\u958b\u9375\u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\u308b) ********capistrano@example-capistrano-server\" >> /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n\n[example@not-aws-vpc-server-198-51-100-10 ~]$ chmod 600 /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n[example@not-aws-vpc-server-198-51-100-10 ~]$ ll /home/example/.ssh/authorized_keys\n-rw-------. 1 example example 418 Jan 26 18:27 /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u304b\u3089example\u30e6\u30fc\u30b6\u3067ssh\u7d4c\u7531\u3067\u63a5\u7d9a\u3057\u305f\u6642\u3001root\u6a29\u9650\u304c\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u51fa\u6765\u308b\u3088\u3046sudo\u6a29\u9650\u8ffd\u52a0\u3002\n\u203b\u4eca\u56de\u306f\u4f8b\u306a\u306e\u3067sudo\u3067\u5f37\u3044\u6a29\u9650\u3092\u6e21\u3057\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u5b9f\u904b\u7528\u306e\u969b\u306b\u306f\u3001sudo\u3067\u5b9f\u884c\u53ef\u80fd\u306a\u30b3\u30de\u30f3\u30c9\u3092\u7d5e\u308b\u306a\u3069\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/sudoers /etc/sudoers.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/sudoers /etc/sudoers.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# visudo\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0)\n\nUser_Alias  CAPISTRANO_USER    = example\nCAPISTRANO_USER      ALL = (root) NOPASSWD: ALL\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/sudoers /etc/sudoers.ORG\n119,121d118\n<\n< User_Alias  CAPISTRANO_USER    = example\n< CAPISTRANO_USER      ALL = (root) NOPASSWD: ALL\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u304b\u3089\u300cexample@198.51.100.10\u300d\u3067ssh\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n[capistrano@example-capistrano-server ~]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server ~]$ ssh example@198.51.100.10\n\n[example@not-aws-vpc-server-198-51-100-10 ~]$ sudo su -\n[root@not-aws-vpc-server-198-51-100-10 ~]# id\nuid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n\ncapistrano3\u30b5\u30fc\u30d0\u3067\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u3066ssh\u7d4c\u7531\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\ncapistrano3\u30b5\u30fc\u30d0\u3067\u30bf\u30b9\u30af\u5b9f\u884c\u3059\u308b\u524d\u306e\u5909\u66f4\u524d\u306e\u72b6\u614b\u3067\u3059\u3002\n[root@not-aws-vpc-server-198-51-100-10 ~]# hostname\nip-172-31-1-134\n[root@not-aws-vpc-server-198-51-100-10 ~]# ll /etc/hosts*\n-rw-r--r--. 1 root root 193 Jan 26 18:55 /etc/hosts\n-rw-r--r--. 1 root root 370 Jan 12  2010 /etc/hosts.allow\n-rw-r--r--. 1 root root 460 Jan 12  2010 /etc/hosts.deny\n-rw-r--r--. 1 root root 158 Jan 12  2010 /etc/hosts.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u5185\u5bb9\u3092\u8868\u793a\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n[root@example-capistrano-server ~]# hostname\nexample-capistrano-server\n[root@example-capistrano-server ~]# su - capistrano\nLast login: Tue Jan 27 03:47:52 JST 2015 on pts/1\n[capistrano@example-capistrano-server ~]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server ~]$ cd /home/capistrano/capistrano/\n[capistrano@example-capistrano-server capistrano]$ pwd\n/home/capistrano/capistrano\n[capistrano@example-capistrano-server capistrano]$\n\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:show_hosts_file\nINFO [bb1a5f59] Running /usr/bin/env cat /etc/hosts as example@192.51.100.10\nDEBUG [bb1a5f59] Command: cat /etc/hosts\nDEBUG [bb1a5f59]        127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\nDEBUG [bb1a5f59]        ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\nDEBUG [bb1a5f59]\nDEBUG [bb1a5f59]        192.51.100.100 old-example-server\nINFO [bb1a5f59] Finished in 0.334 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:backup_hosts_file\nINFO [2edd70cd] Running /usr/bin/env sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'` as example@192.51.100.10\nDEBUG [2edd70cd] Command: sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\nINFO [2edd70cd] Finished in 0.460 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u5185\u5bb9\u3092\u5909\u66f4\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n[capistrano@example-capistrano-server capistrano]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server capistrano]$ pwd\n/home/capistrano/capistrano\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:change_hosts_file\nINFO [88227421] Running /usr/bin/env sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'` as example@192.51.100.10\nDEBUG [88227421] Command: sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\nINFO [88227421] Finished in 0.408 seconds with exit status 0 (successful).\nINFO [edf52807] Running /usr/bin/env sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts as example@192.51.100.10\nDEBUG [edf52807] Command: sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\nINFO [edf52807] Finished in 0.047 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u305f\u30bf\u30b9\u30af\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002\ncapistrano3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u305f\u30bf\u30b9\u30af\u306b\u3088\u308a\u3001ssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0(192.51.100.220)\u306e/etc/hosts\u304c\u5909\u66f4\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002/etc/hosts\u306e\u5185\u5bb9\u304c\u4ee5\u4e0b\u306b\u5909\u66f4\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n192.51.100.100 old-example-server\u3000\u2192\u3000192.51.100.220 new-example-server\n/etc/hosts\u5909\u66f4\u524d\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb(/etc/hosts.20150127_042209)\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3082\u78ba\u8a8d\u3057\u307e\u3059\u3002\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.220 new-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# ls -lrta /etc/hosts*\n-rw-r--r--. 1 root root 158 Jan 12  2010 /etc/hosts.ORG\n-rw-r--r--. 1 root root 460 Jan 12  2010 /etc/hosts.deny\n-rw-r--r--. 1 root root 370 Jan 12  2010 /etc/hosts.allow\n-rw-r--r--. 1 root root 193 Jan 27 04:19 /etc/hosts.20150127_042209\n-rw-r--r--. 1 root root 193 Jan 27 04:19 /etc/hosts.20150127_042127\n-rw-r--r--. 1 root root 193 Jan 27 04:22 /etc/hosts\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/hosts /etc/hosts.20150127_042209\n4c4\n< 192.51.100.220 new-example-server\n---\n> 192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u306f\u3058\u3081\u306b\n===\n\nAWS\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3001capistrano 3.3 + rbenv + Bundler + Ruby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001capistrano3\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u624b\u9806\u3067\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u4e0a\u3067capistrano\u30bf\u30b9\u30af(task)\u3092\u5b9f\u884c\u3059\u308b\u4e8b\u3067\u3001ssh\u7d4c\u7531\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(CentOS 6.6)\u3078\u63a5\u7d9a\u3057\u3001\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u4e0a\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(\u4eca\u56de\u306e\u4f8b\u3067\u306f/etc/hosts\u30d5\u30a1\u30a4\u30eb)\u306e\u5185\u5bb9\u3092\u5909\u66f4\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n===\n\n\u30fbAmazon Linux AMI 2014.09.1 (HVM) - ami-4985b048\n\n\u69cb\u7bc9\u3057\u305f\u74b0\u5883\n===\n\n\u4ee5\u4e0b\u306e\u69cb\u6210\u3067capistrano3\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30fbAmazon Linux\n\u30fbcapistrano3 (Capistrano 3.3.5)\n\u30fbrbenv\n\u30fbBundler 1.7.12\n\u30fbRuby 2.2.0\n\ncapistrano3\u30b5\u30fc\u30d0\u306b\u8ffd\u52a0\u3059\u308b\u30bf\u30b9\u30af\u3068ssh\u63a5\u7d9a\u5148\u306e\u30b5\u30fc\u30d0\n===\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u7d4c\u7531\u3067\u30ea\u30e2\u30fc\u30c8\u306eCentOS\u30b5\u30fc\u30d0(IP\u30a2\u30c9\u30ec\u30b9\u306f\u30b5\u30f3\u30d7\u30eb\u7528\u306e\u4eeeIP\u30a2\u30c9\u30ec\u30b9198.51.100.10\u3067\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059)\u3078\u63a5\u7d9a\u3057\u3001CentOS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u63db\u3048\u308b\u624b\u9806\u307e\u3067\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u304b\u3089CentOS 6.6\u30b5\u30fc\u30d0(198.51.100.10)\u3078ssh\u63a5\u7d9a\u3057\u3001\u4f8b\u3068\u3057\u3066\u3001\u305d\u306e\u30b5\u30fc\u30d0\u306e/etc/hosts\u3092cp\u30b3\u30de\u30f3\u30c9\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u305f\u4e0a\u3067\u3001/etc/hosts\u306e\u5185\u5bb9\u3092\u66f8\u304d\u63db\u3048\u308b\u30bf\u30b9\u30af\u3092capistrano3\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u53c2\u8003\u60c5\u5831\n===\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u3064\u3044\u3066\u306f\u3001http://qiita.com/kazuph \u69d8\u306e\u4ee5\u4e0b\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u3068\u3066\u3082\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/kazuph/items/deeaa7d3f9889674d7fe\n\ncapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u624b\u9806\n===\n\n\u30fb\u300cAWS Management Console\u300d\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cAWS Management Console\u300d\u2192\u300cIAM\u300d->\u300cRoles\u300d->\u300cCreate New Role\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001capistrano3\u30b5\u30fc\u30d0\u7528\u306eIAM\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u3000\u4f5c\u6210\u3059\u308bIAM\u30ed\u30fc\u30eb\u540d: capistrano-server-role\n\nIAM\u30ed\u30fc\u30eb\u4f5c\u6210\u624b\u9806\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/3ec5f8b80150c37a0566\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cAWS Management Console\u300d\u2192\u300cEC2\u300d->\u300cSecurity Groups\u300d->\u300cCreate Security Group\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001capistrano3\u30b5\u30fc\u30d0\u7528\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u3000\u4f5c\u6210\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u540d: capistrano-server\n\n\u4f5c\u6210\u3057\u305f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3001capistrano3\u30b5\u30fc\u30d0\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u306eCentOS\u30b5\u30fc\u30d0(\u4eca\u56de\u306e\u4f8b\u3067\u306f198.51.100.10/32)\u3078ssh\u63a5\u7d9a\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u300cOutbound\u300d\u306fAll traffic(\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\u6642\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a)\u3067\u3001\u300cInbound\u300d\u306b\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u3067\u63a5\u7d9a\u3059\u308b\u5bfe\u8c61\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9(198.51.100.10/32)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306eOutBound\u8a2d\u5b9a\u4f8b]\n\n| Type          | Protocol    | Port Range   | Destination      |\n|:--------------|:------------|:-------------|:-----------------|\n|All traffic    |All          |All           |0.0.0.0/0         |\n\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306eInbound\u8a2d\u5b9a\u4f8b]\n\n| Type          | Protocol    | Port Range   | Source           |\n|:--------------|:------------|:-------------|:-----------------|\n|SSH            |TCP          |22            |198.51.100.10/32  |\n\n\u5b9f\u969b\u306e\u904b\u7528\u74b0\u5883\u3067\u306f\u3001\u5404\u30b5\u30fc\u30d0\u306essh\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u306f\u30c7\u30d5\u30a9\u30eb\u30c822\u756a\u304b\u3089\u5225\u306e\u30dd\u30fc\u30c8\u306b\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u4e8b\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u306f\u4e0a\u8a18\u300cInbound\u300d\u306e\u300cPort Range\u300d\u3067\u901a\u4fe1\u8a31\u53ef\u3057\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u309222\u756a\u304b\u3089ssh\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u30fbcapistrano\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cAWS Management Console\u300d\u2192\u300cEC2\u300d->\u300cInstances\u300d->\u300cLaunch Instance\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001Amazon Linux\u306eAMI\u3092\u4f7f\u7528\u3057\u3066\u3001capistrano\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u624b\u9806\u306f\u4ee5\u4e0b\u3092\u53c2\u8003\u306b\u3057\u3066\u307f\u3066\u4e0b\u3055\u3044\u3002AMI\u306f\u300cAmazon Linux AMI 2014.09.1 (HVM) - ami-4985b048\u300d\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nhttp://qiita.com/na0AaooQ/items/2774f63f540969a55941\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u306f\u3001\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u300ccapistrano-server-role\u300d\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u300ccapistrano-server\u300d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u521d\u671f\u8a2d\u5b9a)\n===\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3089\u3001ec2-user\u3067ssh\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fb\u30ab\u30fc\u30cd\u30eb\u3084\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n```\n$ hostname\nip-172-XX-XX-XXX\n$ id\nuid=XXX(ec2-user) gid=XXX(ec2-user) groups=XXX(ec2-user),XX(wheel)\n$\n\n$ sudo yum update\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306e\u52d5\u4f5c\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo yum -y install gcc git tree libyaml libyaml-devel zlib zlib-devel\n\n$ sudo yum -y install readline readline-devel openssl openssl-devel libxml2 libxml2-devel\n\n$ sudo yum -y install libxslt libxslt-devel libxslt libxslt-devel libffi-devel\n```\n\n\u30fb Amazon Linux\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\n$ sudo cp -p /etc/localtime /etc/localtime.ORG\n$ diff /etc/localtime /etc/localtime.ORG\n$\n\n$ sudo cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n$\n\n$ date\nTue Jan 27 00:51:09 JST 2015\n$\n```\n\n```\n$ sudo cp -p /etc/sysconfig/clock /etc/sysconfig/clock.ORG\n$ sudo diff /etc/sysconfig/clock /etc/sysconfig/clock.ORG\n$\n```\n\n```\n$ sudo vi /etc/sysconfig/clock\nZONE=\"UTC\"\nUTC=true\n\u3000\u2193\nZONE=\"Asia/Tokyo\" \nUTC=false\nARC=false\n```\n\n```\n$ cat /etc/sysconfig/clock\nZONE=\"Asia/Tokyo\"\nUTC=false\nARC=false\n$\n```\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncapistrano\u30e6\u30fc\u30b6\u3068capistrano\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nuid\u3084gid\u306f\u9069\u5b9c\u30b7\u30b9\u30c6\u30e0\u4e0a\u306b\u5b58\u5728\u3057\u306a\u3044\u756a\u53f7\u3092\u78ba\u8a8d\u306e\u4e0a\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n$ sudo cp -p /etc/passwd /etc/passwd.ORG\n$ sudo diff /etc/passwd /etc/passwd.ORG\n$ sudo cp -p /etc/shadow /etc/shadow.ORG\n$ sudo diff /etc/shadow /etc/shadow.ORG\n$ sudo cp -p /etc/group /etc/group.ORG\n$ sudo diff /etc/group /etc/group.ORG\n$\n\n$ sudo groupadd -g [capistrano\u30b0\u30eb\u30fc\u30d7\u306b\u6307\u5b9a\u3059\u308bgid] capistrano\n$ sudo useradd -u [capistrano\u30e6\u30fc\u30b6\u306b\u6307\u5b9a\u3059\u308buid] -s /bin/bash -d /home/capistrano -g capistrano -N -c 'Capistrano User' capistrano\n]$\n\n$ id capistrano\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n```\n\n\u30fbcapistrano\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n$ sudo cp -p /etc/sysconfig/network /etc/sysconfig/network.ORG\n$ diff /etc/sysconfig/network /etc/sysconfig/network.ORG\n$\n\n$ sudo sed -i -e 's/^HOSTNAME=localhost.localdomain/HOSTNAME=example-capistrano-server/g' /etc/sysconfig/network\n$\n\n$ diff /etc/sysconfig/network.ORG /etc/sysconfig/network\n2c2\n< HOSTNAME=localhost.localdomain\n---\n> HOSTNAME=example-capistrano-server\n$\n$ grep HOSTNAME /etc/sysconfig/network\nHOSTNAME=example-capistrano-server\n$\n```\n\n\u4e00\u5ea6\u3001capistrano3\u30b5\u30fc\u30d0\u3092\u30ea\u30d6\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n```\n$ sudo reboot\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/\u914d\u4e0b\u306brbenv + ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n===\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u7528\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u304d\u305f\u3089\u3001ec2-user\u3067ssh\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306brubygems\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ hostname\nexample-capistrano-server\n$ rpm -qa | grep rubygems\nrubygems20-2.0.14-1.20.amzn1.noarch\n$\n```\n\n\u30fbec2-user\u304b\u3089capistrano\u30e6\u30fc\u30b6\u3078\u30b9\u30a4\u30c3\u30c1\u3057\u307e\u3059\u3002\u3053\u306e\u5f8c\u306e\u624b\u9806\u306f\u57fa\u672c\u7684\u306bcapistrano\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ sudo su -\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u306brbenv\u3068ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/\u914d\u4e0b\u306brbenv + ruby-build\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano\n$ ls -lrta /home/capistrano/rbenv\nls: cannot access /home/capistrano/rbenv: No such file or directory\n$\n```\n\n```\n$ git clone git://github.com/sstephenson/rbenv.git /home/capistrano/rbenv\n$\n```\n\n```\n$ mkdir -p /home/capistrano/rbenv/plugins\n$\n\n$ git clone https://github.com/sstephenson/ruby-build.git /home/capistrano/rbenv/plugins/ruby-build\n$\n```\n\n\u30fbrbenv\u3068ruby-build\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano\n$ rbenv -v\nrbenv 0.4.0-129-g7e0e85b\n$\n\n$ ls -lrta /home/capistrano/\ntotal 28\n-rw-r--r--  1 capistrano capistrano  124 Nov  4 08:09 .bashrc\n-rw-r--r--  1 capistrano capistrano  176 Nov  4 08:09 .bash_profile\n-rw-r--r--  1 capistrano capistrano   18 Nov  4 08:09 .bash_logout\ndrwxr-xr-x  4 root       root       4096 Jan 27 00:59 ..\ndrwxrwxr-x 10 capistrano capistrano 4096 Jan 27 01:18 rbenv\ndrwxrw----  3 capistrano capistrano 4096 Jan 27 01:19 .pki\ndrwx------  4 capistrano capistrano 4096 Jan 27 01:19 .\n$\n\n$ ls -lrta /home/capistrano/rbenv/plugins/ruby-build/\ntotal 52\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:19 ..\n-rw-rw-r-- 1 capistrano capistrano  438 Jan 27 01:19 .travis.yml\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:19 share\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 01:19 script\n-rw-rw-r-- 1 capistrano capistrano 9811 Jan 27 01:19 README.md\n-rw-rw-r-- 1 capistrano capistrano 1063 Jan 27 01:19 LICENSE\n-rwxrwxr-x 1 capistrano capistrano  357 Jan 27 01:19 install.sh\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 01:19 bin\ndrwxrwxr-x 5 capistrano capistrano 4096 Jan 27 01:19 test\ndrwxrwxr-x 8 capistrano capistrano 4096 Jan 27 01:19 .git\ndrwxrwxr-x 7 capistrano capistrano 4096 Jan 27 01:19 .\n$\n```\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u306e.bash_profile\u306brbenv\u306e\u30d1\u30b9\u3068\u300crbenv init -\u300d\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```\n$ echo $SHELL\n/bin/bash\n$ cp -p /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n$ diff /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n$\n\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n```\n\n```\n$ vi /home/capistrano/.bash_profile\n\u3000(\u672b\u5c3e\u306e\u8a18\u8ff0\u3092\u5909\u66f4\u3057\u307e\u3059)\nPATH=$PATH:$HOME/bin\n\nexport PATH\n\u3000\u2193\n##### rbenv\nexport RBENV_ROOT=\"/home/capistrano/rbenv\" \nexport PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\" \neval \"$(rbenv init -)\" \n#####\n```\n\n\u30fb\u5909\u66f4\u3057\u305f/home/capistrano/.bash_profile\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ diff /home/capistrano/.bash_profile /home/capistrano/.bash_profile.ORG\n10,14c10,12\n< ##### rbenv\n< export RBENV_ROOT=\"/home/capistrano/rbenv\"\n< export PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\"\n< eval \"$(rbenv init -)\"\n< #####\n---\n> PATH=$PATH:$HOME/bin\n>\n> export PATH\n$\n```\n\n```\n$ cat /home/capistrano/.bash_profile\n# .bash_profile\n\n# Get the aliases and functions\nif [ -f ~/.bashrc ]; then\n        . ~/.bashrc\nfi\n\n# User specific environment and startup programs\n\n##### rbenv\nexport RBENV_ROOT=\"/home/capistrano/rbenv\"\nexport PATH=\"${RBENV_ROOT}/bin:${PATH}:$HOME/bin\"\neval \"$(rbenv init -)\"\n#####\n$\n```\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u306b\u5148\u307b\u3069.bash_profile\u3078\u8ffd\u52a0\u3057\u305f\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ source /home/capistrano/.bash_profile\n$\n```\n\n\u30fb\u5ff5\u306e\u70ba\u3001capistrano\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ exit\n# id\nuid=0(root) gid=0(root) groups=0(root)\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n```\n\n\u30fb/home/capistrano/rbenv/shims\u3068/home/capistrano/rbenv/versions\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u78ba\u8a8d\u3002\n\n\u5148\u307b\u3069.bash_profile\u306b\u8a2d\u5b9a\u3057\u305f\u300crbenv init -\u300d\u306b\u3088\u308a/home/capistrano/rbenv/shims\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7a7a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3060\u3051\u4f5c\u6210\u3055\u308c\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n```\n$ ls -lrta /home/capistrano/rbenv/shims\ntotal 8\ndrwxrwxr-x 12 capistrano capistrano 4096 Jan 27 01:34 ..\ndrwxrwxr-x  2 capistrano capistrano 4096 Jan 27 01:42 .\n$\n\n$ ls -lrta /home/capistrano/rbenv/versions\ntotal 8\ndrwxrwxr-x 12 capistrano capistrano 4096 Jan 27 01:34 ..\ndrwxrwxr-x  2 capistrano capistrano 4096 Jan 27 01:34 .\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067rbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n===\n\n\u30fb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306aRuby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ rbenv install -l\nAvailable versions:\n  1.8.6-p383\n  1.8.6-p420\n  1.8.7-p249\n  1.8.7-p302\n\u3000\u3000(\u9014\u4e2d\u7701\u7565)\n  2.2.0-dev\n  2.2.0-preview1\n  2.2.0-preview2\n  2.2.0-rc1\n  2.2.0\n  rbx-2.2.0\n\u3000\u3000(\u9014\u4e2d\u7701\u7565)\n```\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067rbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306frbenv\u306b\u3088\u308aRuby 2.2.0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002/home/capistrano\u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001/home/capistrano/rbenv/versions/2.2.0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ rbenv ruby -v\nrbenv: no such command `ruby'\n$ rbenv versions\n* system (set by /home/capistrano/rbenv/version)\n$\n\n$ rbenv install 2.2.0\nDownloading ruby-2.2.0.tar.gz...\n-> http://dqw8nmjcqpjn7.cloudfront.net/7671e394abfb5d262fbcd3b27a71bf78737c7e9347fa21c39e58b0bb9c4840fc\nInstalling ruby-2.2.0...\nInstalled ruby-2.2.0 to /home/capistrano/rbenv/versions/2.2.0\n\n$\n```\n\n\u30fbrehash\u3057\u307e\u3059\u3002\n\n```\n$ rbenv rehash\n$\n```\n\n\u30fbrbenv\u3067Ruby 2.2.0\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ls -lrta /home/capistrano/rbenv/versions/2.2.0/\ntotal 24\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 01:50 ..\ndrwxr-xr-x 4 capistrano capistrano 4096 Jan 27 01:56 lib\ndrwxr-xr-x 2 capistrano capistrano 4096 Jan 27 01:56 bin\ndrwxr-xr-x 3 capistrano capistrano 4096 Jan 27 01:56 include\ndrwxr-xr-x 6 capistrano capistrano 4096 Jan 27 01:56 .\ndrwxr-xr-x 5 capistrano capistrano 4096 Jan 27 01:56 share\n$\n```\n\n\u30fbrbenv\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fRuby 2.2.0\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$ ruby -v\nruby 2.0.0p598 (2014-11-13 revision 48408) [x86_64-linux]\n$\n\n$ rbenv version\nsystem (set by /home/capistrano/rbenv/version)\n$\n```\n\n```\n$ rbenv global 2.2.0\n$\n```\n\n```\n$ ruby -v\nruby 2.2.0p0 (2014-12-25 revision 49005) [x86_64-linux]\n$\n\n$ rbenv version\n2.2.0 (set by /home/capistrano/rbenv/version)\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067Bundler\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n===\n\n\u30fbRuby Gem Bundler\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ exit\nlogout\n# su - capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n```\n\n```\n$ pwd\n/home/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n```\n\n```\n$ rbenv exec gem install bundler\nFetching: bundler-1.7.12.gem (100%)\nSuccessfully installed bundler-1.7.12\nParsing documentation for bundler-1.7.12\nInstalling ri documentation for bundler-1.7.12\nDone installing documentation for bundler after 2 seconds\n1 gem installed\n$\n```\n\n```\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n```\n\n\u30fbRuby Gem Bundler\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano\n$ rbenv rehash\n$\n\n$ rbenv exec gem which bundler\n/home/capistrano/rbenv/versions/2.2.0/lib/ruby/gems/2.2.0/gems/bundler-1.7.12/lib/bundler.rb\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067capistrano3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n===\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067capistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306e/home/capistrano/capistrano\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n$\n\n$ ll /home/capistrano/capistrano\nls: cannot access /home/capistrano/capistrano: No such file or directory\n$\n\n$ mkdir /home/capistrano/capistrano\n$\n\n$ ll /home/capistrano/capistrano\ntotal 0\n$\n```\n\n\u30fb/home/capistrano/capistrano/Gemfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ cd /home/capistrano/capistrano\n$ pwd\n/home/capistrano/capistrano\n$\n```\n\n```\n$ rbenv exec bundle init\nWriting new Gemfile to /home/capistrano/capistrano/Gemfile\n$\n```\n\n```\n$ ls -lrta /home/capistrano/capistrano/\ntotal 12\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:13 .\n$\n$ cat /home/capistrano/capistrano/Gemfile\n# A sample Gemfile\nsource \"https://rubygems.org\"\n\n# gem \"rails\"\n$\n\n$ pwd\n/home/capistrano/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\ntest-unit (3.0.8)\n$\n```\n\n```\n$ cp -p /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n$ diff /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n$\n$ echo \"gem 'capistrano'\" >> /home/capistrano/capistrano/Gemfile\n$\n$ diff /home/capistrano/capistrano/Gemfile /home/capistrano/capistrano/Gemfile.ORG\n5d4\n< gem 'capistrano'\n$\n```\n\n```\n$ cat /home/capistrano/capistrano/Gemfile\n# A sample Gemfile\nsource \"https://rubygems.org\"\n\n# gem \"rails\"\ngem 'capistrano'\n$\n```\n\n\u30fbcapistrano\u30e6\u30fc\u30b6\u3067/home/capistrano/capistrano\u914d\u4e0b\u306bcapistrano3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano/capistrano\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n\n$ bundle install\nFetching gem metadata from https://rubygems.org/.......\nResolving dependencies...\nUsing rake 10.4.2\nInstalling capistrano-stats 1.1.1\nInstalling i18n 0.7.0\nInstalling colorize 0.7.5\nInstalling net-ssh 2.9.2\nInstalling net-scp 1.2.1\nInstalling sshkit 1.6.1\nInstalling capistrano 3.3.5\nUsing bundler 1.7.12\nYour bundle is complete!\nUse `bundle show [gemname]` to see where a bundled gem is installed.\nPost-install message from capistrano-stats:\n    Capistrano will ask you the next time you run it if you would like to share\n    anonymous usage statistics with the maintainance team to help guide our\n    development efforts. We emplore you to opt-in, but we understand if your\n    privacy is important to you in this regard.\nPost-install message from capistrano:\nCapistrano 3.1 has some breaking changes. Please check the CHANGELOG: http://goo.gl/SxB0lr\n\nIf you're upgrading Capistrano from 2.x, we recommend to read the upgrade guide: http://goo.gl/4536kB\n\nThe `deploy:restart` hook for passenger applications is now in a separate gem called capistrano-passenger.  Just add it to your Gemfile and require it in your Capfile.\n$\n```\n\n\u30fbcapistrano3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ls -lrta /home/capistrano/capistrano/\ntotal 20\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:15 .\n$\n\n$ pwd\n/home/capistrano/capistrano\n$ rbenv exec gem list\n\n*** LOCAL GEMS ***\n\nbigdecimal (1.2.6)\nbundler (1.7.12)\ncapistrano (3.3.5)\ncapistrano-stats (1.1.1)\ncolorize (0.7.5)\ni18n (0.7.0)\nio-console (0.4.3)\njson (1.8.1)\nminitest (5.4.3)\nnet-scp (1.2.1)\nnet-ssh (2.9.2)\npower_assert (0.2.2)\npsych (2.0.8)\nrake (10.4.2)\nrdoc (4.2.0)\nsshkit (1.6.1)\ntest-unit (3.0.8)\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano\u30e6\u30fc\u30b6\u3067cap install\u3092\u5b9f\u884c\u3057\u3066capistrano3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u3092\u751f\u6210\u3059\u308b)\n===\n\n\u30fbcap install\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001capistrano3\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u3092\u751f\u6210\u3059\u308b\u3002\n\n```\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano/capistrano\n$ ls -lrta /home/capistrano/capistrano/\ntotal 20\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:15 .\n$\n```\n\n```\n$ cap install\nmkdir -p config/deploy\ncreate config/deploy.rb\ncreate config/deploy/staging.rb\ncreate config/deploy/production.rb\nmkdir -p lib/capistrano/tasks\ncreate Capfile\nCapified\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u306e\u751f\u6210\u78ba\u8a8d)\n===\n\n\u30fb\u5148\u307b\u3069\u5b9f\u884c\u3057\u305fcap install\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306acapistrano3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u985e\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ ls -lrta /home/capistrano/capistrano/\ntotal 32\ndrwx------ 6 capistrano capistrano 4096 Jan 27 02:13 ..\n-rw-r--r-- 1 capistrano capistrano   64 Jan 27 02:13 Gemfile.ORG\n-rw-r--r-- 1 capistrano capistrano   81 Jan 27 02:14 Gemfile\n-rw-rw-r-- 1 capistrano capistrano  448 Jan 27 02:15 Gemfile.lock\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 config\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 lib\n-rw-r--r-- 1 capistrano capistrano  837 Jan 27 02:25 Capfile\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/config/\ntotal 16\n-rw-rw-r-- 1 capistrano capistrano 1275 Jan 27 02:25 deploy.rb\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 deploy\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 ..\n$\n\n$ ls -lrta /home/capistrano/capistrano/config/deploy\ntotal 16\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\n-rw-rw-r-- 1 capistrano capistrano 1459 Jan 27 02:25 staging.rb\n-rw-rw-r-- 1 capistrano capistrano 1459 Jan 27 02:25 production.rb\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/\ntotal 12\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 capistrano\ndrwxrwxr-x 4 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/\ntotal 12\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 tasks\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 .\n$\n\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/tasks/\ntotal 8\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806 (capistrano3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u78ba\u8a8d)\n===\n\n\u30fbcapistrano3\u304c/home/capistrano/capistrano\u914d\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u3001capistrano3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u81ea\u4f53\u306f\u5b8c\u4e86\u3067\u3059\u3002capistrano3\u306e\u30bf\u30b9\u30af\u8ffd\u52a0\u306b\u3064\u3044\u3066\u306f\u5f8c\u8ff0\u81f4\u3057\u307e\u3059\u3002\n\n```\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ exit\nlogout\n# id\nuid=0(root) gid=0(root) groups=0(root)\n# su - capistrano\n\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$\n$ cd /home/capistrano/capistrano/\n$ pwd\n/home/capistrano/capistrano\n$\n```\n\n\u30fbcap -V\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001capistrano\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano/capistrano\n$ cap -V\nCapistrano Version: 3.3.5 (Rake Version: 10.4.2)\n$\n```\n\n\u30fbcap -T\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001capistrano\u306e\u30bf\u30b9\u30af\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano/capistrano\n$ cap -T\ncap deploy                         # Deploy a new release\ncap deploy:check                   # Check required files and directories exist\ncap deploy:check:directories       # Check shared and release directories exist\ncap deploy:check:linked_dirs       # Check directories to be linked exist in shared\ncap deploy:check:linked_files      # Check files to be linked exist in shared\ncap deploy:check:make_linked_dirs  # Check directories of files to be linked exist in shared\ncap deploy:cleanup                 # Clean up old releases\ncap deploy:cleanup_rollback        # Remove and archive rolled-back release\ncap deploy:finished                # Finished\ncap deploy:finishing               # Finish the deployment, clean up server(s)\ncap deploy:finishing_rollback      # Finish the rollback, clean up server(s)\ncap deploy:log_revision            # Log details of the deploy\ncap deploy:published               # Published\ncap deploy:publishing              # Publish the release\ncap deploy:revert_release          # Revert to previous release timestamp\ncap deploy:reverted                # Reverted\ncap deploy:reverting               # Revert server(s) to previous release\ncap deploy:rollback                # Rollback to previous release\ncap deploy:set_current_revision    # Place a REVISION file with the current revision SHA in the current release path\ncap deploy:started                 # Started\ncap deploy:starting                # Start a deployment, make sure server(s) ready\ncap deploy:symlink:linked_dirs     # Symlink linked directories\ncap deploy:symlink:linked_files    # Symlink linked files\ncap deploy:symlink:release         # Symlink release to current\ncap deploy:symlink:shared          # Symlink files and directories from shared to release\ncap deploy:updated                 # Updated\ncap deploy:updating                # Update server(s) by setting up a new release\ncap install                        # Install Capistrano, cap install STAGES=staging,production\n$\n```\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (config/deploy.rb)\n===\n\n\u30fb/home/capistrano/capistrano/config/deploy.rb\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\n$ pwd\n/home/capistrano/capistrano\n$ cp -p /home/capistrano/capistrano/config/deploy.rb /home/capistrano/capistrano/config/deploy.rb.ORG\n$ diff /home/capistrano/capistrano/config/deploy.rb /home/capistrano/capistrano/config/deploy.rb.ORG\n$\n```\n\n```\n$ vi /home/capistrano/capistrano/config/deploy.rb\n\u3000(\u4e2d\u8eab\u3092\u5168\u90e8\u6d88\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u8a18\u8ff0\u3060\u3051\u306b\u5909\u66f4\u3057\u307e\u3059)\n\n\u3000\u3000\u2193\n\n#####\n# config valid only for current version of Capistrano\nlock '3.3.5'\nset :pty, true\n#####\n```\n\n```\n$ cat /home/capistrano/capistrano/config/deploy.rb\n#####\n## config valid only for current version of Capistrano\nlock '3.3.5'\nset :pty, true\n######\n$\n```\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (config/deploy/develop.rb capistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u3092\u8a18\u8ff0\u3059\u308b)\n===\n\n\u30fb/home/capistrano/capistrano/config/deploy/develop.rb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3059\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089ssh\u63a5\u7d9a\u3057\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3059\u308b\u30b5\u30fc\u30d0\u306f\u4ee5\u4e0b\u306eIP\u30a2\u30c9\u30ec\u30b9\u3060\u3068\u3057\u307e\u3059\u3002\n\u3000198.51.100.10\ncapistrano\u30b5\u30fc\u30d0\u304b\u3089198.51.100.10\u3078ssh\u63a5\u7d9a\u3059\u308b\u5834\u5408\u306e\u30e6\u30fc\u30b6\u540d\u306fexample\u3068\u3057\u307e\u3059\u3002\n\n```\n$ ll /home/capistrano/capistrano/config/deploy/develop.rb\nls: cannot access /home/capistrano/capistrano/config/deploy/develop.rb: No such file or directory\n$\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3092develop.rb\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n198.51.100.10\u30b5\u30fc\u30d0\u3078\u306eexample\u30e6\u30fc\u30b6\u8ffd\u52a0\u306f\u5f8c\u8ff0\u81f4\u3057\u307e\u3059\u3002\n\n```\n$ vi /home/capistrano/capistrano/config/deploy/develop.rb\nrole :web, %w{example@198.51.100.10}\n```\n\n```\n$ cat /home/capistrano/capistrano/config/deploy/develop.rb\nrole :web, %w{capistrano@198.51.100.10}\n$\n\n$ ll /home/capistrano/capistrano/config/deploy/develop.rb\n-rw-rw-r-- 1 capistrano capistrano 80 Jan 27 02:53 /home/capistrano/capistrano/config/deploy/develop.rb\n$\n```\n\ncapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306e\u521d\u671f\u8a2d\u5b9a (Capfile)\n===\n\n\u30fb/home/capistrano/capistrano/Capfile\u306e\u78ba\u8a8d\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u3068\u308a\u3042\u3048\u305a\u521d\u671f\u8a2d\u5b9a\u306e\u307e\u307e\u5909\u66f4\u305b\u305a\u306b\u9032\u3081\u307e\u3059\u3002\n\n```\n$ cat /home/capistrano/capistrano/Capfile\n# Load DSL and set up stages\nrequire 'capistrano/setup'\n\n# Include default deployment tasks\nrequire 'capistrano/deploy'\n\n# Include tasks from other gems included in your Gemfile\n#\n# For documentation on these, see for example:\n#\n#   https://github.com/capistrano/rvm\n#   https://github.com/capistrano/rbenv\n#   https://github.com/capistrano/chruby\n#   https://github.com/capistrano/bundler\n#   https://github.com/capistrano/rails\n#   https://github.com/capistrano/passenger\n#\n# require 'capistrano/rvm'\n# require 'capistrano/rbenv'\n# require 'capistrano/chruby'\n# require 'capistrano/bundler'\n# require 'capistrano/rails/assets'\n# require 'capistrano/rails/migrations'\n# require 'capistrano/passenger'\n\n# Load custom tasks from `lib/capistrano/tasks' if you have any defined\nDir.glob('lib/capistrano/tasks/*.rake').each { |r| import r }\n$\n```\n\ncapistrano3\u306e\u30bf\u30b9\u30af\u8ffd\u52a0\u624b\u9806\n===\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3078\u306ecapistrano3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001capistrano\u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u8a18\u8f09\u81f4\u3057\u307e\u3059\u3002\n\n\u30fb/home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\u3092\u4f5c\u6210\u3057\u3001capistrano\u306e\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u5148\u307b\u3069\u8a18\u8f09\u3057\u305f\u300cexample@198.51.100.10\u300d\u30b5\u30fc\u30d0\u3078ssh\u63a5\u7d9a\u3057\u3066\u3001\u5b9f\u884c\u3055\u305b\u305f\u3044\u30b3\u30de\u30f3\u30c9\u3092\u30bf\u30b9\u30af\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n$ ls -lrta /home/capistrano/capistrano/lib/capistrano/tasks/\ntotal 8\ndrwxrwxr-x 3 capistrano capistrano 4096 Jan 27 02:25 ..\ndrwxrwxr-x 2 capistrano capistrano 4096 Jan 27 02:25 .\n$\n```\n\n\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3059\u308brake\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ vi /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n```\n\n```rb:utils.rake\nnamespace :hosts_file_utils do\n  task :show_hosts_file do\n    on roles(:web) do\n      execute \"cat /etc/hosts\"\n    end\n  end\n  task :backup_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n    end\n  end\n  task :change_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n      execute \"sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\"\n    end\n  end\nend\n```\n\nrake\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u305f\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n[capistrano@example-capistrano-server ~]$ cat /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\nnamespace :hosts_file_utils do\n  task :show_hosts_file do\n    on roles(:web) do\n      execute \"cat /etc/hosts\"\n    end\n  end\n  task :backup_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n    end\n  end\n  task :change_hosts_file do\n    on roles(:web) do\n      execute \"sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\"\n      execute \"sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\"\n    end\n  end\nend\n[capistrano@example-capistrano-server ~]$\n```\n\nrake\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n```\n[capistrano@example-capistrano-server ~]$ ll /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n-rw-rw-r-- 1 capistrano capistrano 548 Jan 27 04:02 /home/capistrano/capistrano/lib/capistrano/tasks/utils.rake\n[capistrano@example-capistrano-server ~]$\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u306bssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u3078\u63a5\u7d9a\u3059\u308b\u70ba\u306e\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u3092\u4f5c\u6210\u3059\u308b\n===\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089198.51.100.10\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066\u3001ssh\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u3067capistrano\u30e6\u30fc\u30b6\u306e\u516c\u958b\u9375\u3068\u79d8\u5bc6\u9375\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ hostname\nexample-capistrano-server\n$ id\nuid=XXXXX(capistrano) gid=XXXXX(capistrano) groups=XXXXX(capistrano)\n$ pwd\n/home/capistrano\n\n$ ssh-keygen\nGenerating public/private rsa key pair.\nEnter file in which to save the key (/home/capistrano/.ssh/id_rsa):\nCreated directory '/home/capistrano/.ssh'.\nEnter passphrase (empty for no passphrase):\u3000\u2192\u3000\u4eca\u56de\u306f\u4f8b\u306a\u306e\u3067\u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u5165\u529b\u305b\u305aEnter\u30ad\u30fc\u62bc\u4e0b\u3002\n\n$ ll /home/capistrano/.ssh/\ntotal 8\n-rw------- 1 capistrano capistrano 1679 Jan 27 03:16 id_rsa\n-rw-r--r-- 1 capistrano capistrano  418 Jan 27 03:16 id_rsa.pub\n$\n```\n\n\u30fb\u516c\u958b\u9375\u306e\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ cat /home/capistrano/.ssh/id_rsa.pub\nssh-rsa AAAA******** (\u516c\u958b\u9375\u306e\u6587\u5b57\u5217) ***********capistrano@example-capistrano-server\n$\n```\n\nssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u306bssh\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6\u4f5c\u6210 + capistrano\u30e6\u30fc\u30b6\u306e\u516c\u958b\u9375\u3092/home/example/.ssh/authorized_keys\u306b\u8ffd\u52a0\n===\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306fcapistrano3\u30b5\u30fc\u30d0\u304b\u3089\u306essh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0\u3001198.51.100.10\u306bexample\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n198.51.100.10\u306broot\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/passwd /etc/passwd.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/shadow /etc/shadow.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/group /etc/group.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# groupadd example\n[root@not-aws-vpc-server-198-51-100-10 ~]# useradd -s /bin/bash -d /home/example -g example example\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# su - example\n[example@not-aws-vpc-server-198-51-100-10 ~]$ id\nuid=XXX(example) gid=XXX(example) groups=XXX(example) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n```\n\n```\n[example@not-aws-vpc-server-198-51-100-10 ~]$ mkdir /home/example/.ssh\n[example@not-aws-vpc-server-198-51-100-10 ~]$ chmod 700 /home/example/.ssh\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n```\n\n```\n[example@not-aws-vpc-server-198-51-100-10 ~]$ echo \"ssh-rsa AAAA******** (\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fcapistrano3\u30b5\u30fc\u30d0\u306e/home/capistrano/.ssh/id_rsa.pub\u306e\u516c\u958b\u9375\u306e\u5185\u5bb9\u3092\u8cbc\u308a\u4ed8\u3051\u308b) ********capistrano@example-capistrano-server\" >> /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n```\n\n```\n[example@not-aws-vpc-server-198-51-100-10 ~]$ chmod 600 /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n[example@not-aws-vpc-server-198-51-100-10 ~]$ ll /home/example/.ssh/authorized_keys\n-rw-------. 1 example example 418 Jan 26 18:27 /home/example/.ssh/authorized_keys\n[example@not-aws-vpc-server-198-51-100-10 ~]$\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u304b\u3089example\u30e6\u30fc\u30b6\u3067ssh\u7d4c\u7531\u3067\u63a5\u7d9a\u3057\u305f\u6642\u3001root\u6a29\u9650\u304c\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u51fa\u6765\u308b\u3088\u3046sudo\u6a29\u9650\u8ffd\u52a0\u3002\n\n\u203b\u4eca\u56de\u306f\u4f8b\u306a\u306e\u3067sudo\u3067\u5f37\u3044\u6a29\u9650\u3092\u6e21\u3057\u3066\u304a\u308a\u307e\u3059\u304c\u3001\u5b9f\u904b\u7528\u306e\u969b\u306b\u306f\u3001sudo\u3067\u5b9f\u884c\u53ef\u80fd\u306a\u30b3\u30de\u30f3\u30c9\u3092\u7d5e\u308b\u306a\u3069\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# cp -p /etc/sudoers /etc/sudoers.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/sudoers /etc/sudoers.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# visudo\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0)\n\nUser_Alias  CAPISTRANO_USER    = example\nCAPISTRANO_USER      ALL = (root) NOPASSWD: ALL\n```\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/sudoers /etc/sudoers.ORG\n119,121d118\n<\n< User_Alias  CAPISTRANO_USER    = example\n< CAPISTRANO_USER      ALL = (root) NOPASSWD: ALL\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u304b\u3089\u300cexample@198.51.100.10\u300d\u3067ssh\u30ed\u30b0\u30a4\u30f3\u51fa\u6765\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n\n```\n[capistrano@example-capistrano-server ~]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server ~]$ ssh example@198.51.100.10\n\n[example@not-aws-vpc-server-198-51-100-10 ~]$ sudo su -\n[root@not-aws-vpc-server-198-51-100-10 ~]# id\nuid=0(root) gid=0(root) groups=0(root) context=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\ncapistrano3\u30b5\u30fc\u30d0\u3067\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u3066ssh\u7d4c\u7531\u3067\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\n===\n\ncapistrano3\u30b5\u30fc\u30d0\u3067\u30bf\u30b9\u30af\u5b9f\u884c\u3059\u308b\u524d\u306e\u5909\u66f4\u524d\u306e\u72b6\u614b\u3067\u3059\u3002\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# hostname\nip-172-31-1-134\n[root@not-aws-vpc-server-198-51-100-10 ~]# ll /etc/hosts*\n-rw-r--r--. 1 root root 193 Jan 26 18:55 /etc/hosts\n-rw-r--r--. 1 root root 370 Jan 12  2010 /etc/hosts.allow\n-rw-r--r--. 1 root root 460 Jan 12  2010 /etc/hosts.deny\n-rw-r--r--. 1 root root 158 Jan 12  2010 /etc/hosts.ORG\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u5185\u5bb9\u3092\u8868\u793a\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n[root@example-capistrano-server ~]# hostname\nexample-capistrano-server\n[root@example-capistrano-server ~]# su - capistrano\nLast login: Tue Jan 27 03:47:52 JST 2015 on pts/1\n[capistrano@example-capistrano-server ~]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server ~]$ cd /home/capistrano/capistrano/\n[capistrano@example-capistrano-server capistrano]$ pwd\n/home/capistrano/capistrano\n[capistrano@example-capistrano-server capistrano]$\n```\n\n```\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:show_hosts_file\nINFO [bb1a5f59] Running /usr/bin/env cat /etc/hosts as example@192.51.100.10\nDEBUG [bb1a5f59] Command: cat /etc/hosts\nDEBUG [bb1a5f59]        127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\nDEBUG [bb1a5f59]        ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\nDEBUG [bb1a5f59]\nDEBUG [bb1a5f59]        192.51.100.100 old-example-server\nINFO [bb1a5f59] Finished in 0.334 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:backup_hosts_file\nINFO [2edd70cd] Running /usr/bin/env sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'` as example@192.51.100.10\nDEBUG [2edd70cd] Command: sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\nINFO [2edd70cd] Finished in 0.460 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0(198.51.100.10)\u306e/etc/hosts\u5185\u5bb9\u3092\u5909\u66f4\u3059\u308b\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\n```\n[capistrano@example-capistrano-server capistrano]$ id\nuid=11050(capistrano) gid=11050(capistrano) groups=11050(capistrano)\n[capistrano@example-capistrano-server capistrano]$ pwd\n/home/capistrano/capistrano\n[capistrano@example-capistrano-server capistrano]$ bundle exec cap develop hosts_file_utils:change_hosts_file\nINFO [88227421] Running /usr/bin/env sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'` as example@192.51.100.10\nDEBUG [88227421] Command: sudo -u root cp -p /etc/hosts /etc/hosts.`date '+%Y%m%d_%H%M%S'`\nINFO [88227421] Finished in 0.408 seconds with exit status 0 (successful).\nINFO [edf52807] Running /usr/bin/env sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts as example@192.51.100.10\nDEBUG [edf52807] Command: sudo -u root sed -i -e 's/^192.51.100.100 old-example-server/192.51.100.220 new-example-server/' /etc/hosts\nINFO [edf52807] Finished in 0.047 seconds with exit status 0 (successful).\n[capistrano@example-capistrano-server capistrano]$\n```\n\n\u30fbcapistrano3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u305f\u30bf\u30b9\u30af\u306e\u52d5\u4f5c\u78ba\u8a8d\u3002\n\ncapistrano3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\u3057\u305f\u30bf\u30b9\u30af\u306b\u3088\u308a\u3001ssh\u63a5\u7d9a\u5148\u30b5\u30fc\u30d0(192.51.100.220)\u306e/etc/hosts\u304c\u5909\u66f4\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002/etc/hosts\u306e\u5185\u5bb9\u304c\u4ee5\u4e0b\u306b\u5909\u66f4\u3055\u308c\u305f\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n192.51.100.100 old-example-server\u3000\u2192\u3000192.51.100.220 new-example-server\n\n/etc/hosts\u5909\u66f4\u524d\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb(/etc/hosts.20150127_042209)\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3082\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# cat /etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n\n192.51.100.220 new-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\n```\n[root@not-aws-vpc-server-198-51-100-10 ~]# ls -lrta /etc/hosts*\n-rw-r--r--. 1 root root 158 Jan 12  2010 /etc/hosts.ORG\n-rw-r--r--. 1 root root 460 Jan 12  2010 /etc/hosts.deny\n-rw-r--r--. 1 root root 370 Jan 12  2010 /etc/hosts.allow\n-rw-r--r--. 1 root root 193 Jan 27 04:19 /etc/hosts.20150127_042209\n-rw-r--r--. 1 root root 193 Jan 27 04:19 /etc/hosts.20150127_042127\n-rw-r--r--. 1 root root 193 Jan 27 04:22 /etc/hosts\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n[root@not-aws-vpc-server-198-51-100-10 ~]# diff /etc/hosts /etc/hosts.20150127_042209\n4c4\n< 192.51.100.220 new-example-server\n---\n> 192.51.100.100 old-example-server\n[root@not-aws-vpc-server-198-51-100-10 ~]#\n```\n\n\u9577\u304f\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["capistrano3.3.5", "AWS", "EC2", "Ruby2.2.0"]}