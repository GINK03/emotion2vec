{"context": " More than 1 year has passed since last update.\u4ffa\u3067\u3059\u3002\n\u4e16\u754c70\u5104\u306eterraform\u8077\u4eba\u306e\u7686\u69d8\u3053\u3093\u3070\u3093\u306f\u3002teraform\u8077\u4eba\u306e\u591c\u306f\u9045\u3044\u3067\u3059\u306d\u3002\n\u3055\u3066module\u4f7f\u3063\u3066\u307e\u3059\u304b\uff1f\n\u6700\u8fd1\u3068\u3044\u3063\u3066\u3082\u3064\u3044\u6570\u6642\u9593\u524d\u304b\u3089\u4eca\u307e\u3067\u81ea\u5206\u304c\u4f5c\u3063\u305fterraform tf\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3092\u59cb\u3081\u307e\u3057\u305f\u3002\n\u203b\u540c\u3058\u7d44\u7e54\u306e\u65b9\u306fGHE\u306bpush\u3057\u3066\u308boreno\u30b7\u30ea\u30fc\u30ba\u30ea\u30dd\u30b8\u30c8\u30ea\u307f\u3066\u306d(\u696d\u52d9\u9023\u7d61)\n\u4eca\u56de\u306fIAM User\u3068policy\u3092module\u5316\u3057\u3066\u3001\n\u697d\u3005\u4f7f\u3044\u307e\u308f\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u4f8b\u3092\u8f09\u305b\u3061\u3083\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\u3068\u3044\u3046\u304b\u3053\u305f\u3048\nterraform\u306ecommunity-module\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u308b\u306e\u3067\u30ba\u30d0\u30ea\u3053\u308c\u3067\u3002\nhttps://github.com/terraform-community-modules\n\u3055\u3066\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u30fc\n\nmodule\u306e\u4f5c\u6210\nmodule\u3068\u306a\u308bterraform tf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\n\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u69d8\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n1tf\u306b\u307e\u3068\u3081\u3066\u3082\u3044\u3044\u3093\u3058\u3083\u306d\u3063\u3066\u601d\u3046\u306e\u3067\u3059\u304c\n\u307e\u3042\u30fcresource\u306f\u306a\u304c\u30fc\u304f\u306a\u308b\u3053\u3068\u3082\u3042\u308b\u3057\u3001community-modules\u304c\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u3063\u3066\u308b\u306e\u3067\n\u3053\u306e\u8fba\u306f\u6e96\u62e0\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\u306a\u611f\u3058\u3067\u3059\u304b\u306d\u30fc\u3002\n\u5404\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30eb\u30fc\u30eb\u4f5c\u3063\u3066\u3057\u307e\u3048\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u306d\u3002\n\nmodule\u306e\u30d5\u30a1\u30a4\u30eb\u7528\u9014\n\n\n\n\u30d5\u30a1\u30a4\u30eb\u540d\n\u7528\u9014\n\n\n\n\nvariables.tf\n\u5909\u6570\u5b9a\u7fa9\n\n\niam_***.tf\nresource\u5b9a\u7fa9\n\n\noutputs.tf\n\u623b\u308a\u5024\u5b9a\u7fa9\n\n\n\n\nmodule\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\norenomac$ tree module/iam\nmodule/iam\n\u251c\u2500\u2500 group\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 iam_group.tf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 outputs.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variables.tf\n\u251c\u2500\u2500 policy\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 aws_iam_policy.tf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 outputs.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variables.tf\n\u251c\u2500\u2500 role\n\u2514\u2500\u2500 user\n    \u251c\u2500\u2500 aws_iam_user.tf\n    \u251c\u2500\u2500 outputs.tf\n    \u2514\u2500\u2500 variables.tf\n\n\nIAM Group\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\nvariables.tf\n\nmodule resource\u306e\u5f15\u6570\u306b\u6307\u5b9a\u3059\u308bvariable\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\nvariable \"aws_iam_groupname\" {\n  description = \"iam group name\"\n}\n\nvariable \"aws_iam_grouppath\" {\n  description = \"iam group path(/users/)\"\n  default = \"/\"\n}\n\n\niam_group.tf\n\nmodule\u3067\u52d5\u4f5c\u3059\u308bresource\u3092\u5b9a\u7fa9\u3057\u307e\u3059\nresource \"aws_iam_group\" \"iam-group\" {\n  name = \"${var.aws_iam_groupname}\"\n  path = \"${var.aws_iam_grouppath}\"\n}\n\n\noutputs.tf\n\nmodule\u5916\u304b\u3089\u53c2\u7167\u3055\u308c\u308bresource\u3067module\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306e\u623b\u308a\u5024\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\noutput\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001module\u3067\u4f5c\u3089\u308c\u305fresource\u5185variable\u3092\u3001\u5916\u90e8resource\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\noutput \"name\" {\n  value = \"${aws_iam_group.iam-group.name}\"\n}\n\n\nIAM User\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\nvariables.tf\n\nvariable \"aws_iam_username\" {\n  description = \"iam user name\"\n}\nvariable \"aws_iam_grouppath\" {\n  description = \"iam group path(/users/)\"\n  default = \"/\"\n}\n\n\naws_iam_user.tf\n\nresource \"aws_iam_user\" \"iam-user\" {\n  name = \"${var.aws_iam_username}\"\n  path = \"${var.aws_iam_grouppath}\"\n}\n\n\noutputs.tf\n\noutput \"name\" {\n  value = \"${aws_iam_user.iam-user.name}\"\n}\n\n\nIAM Policy\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\nvariables.tf\n\nvariable \"aws_iam_policy_name\" {\n  description = \"Policy Name\"\n  default = \"iam-policy\"\n}\n\nvariable \"aws_iam_policy_path\" {\n  description = \"iam policy path\"\n  default = \"/policy/\"\n}\n\nvariable \"aws_iam_policy_description\" {\n  description = \"iam policy description\"\n  default = \"iam policy\"\n}\nvariable \"aws_iampolicy_json\" {\n  description = \"iampolicy json filename\"\n  default = \"iam_policy.json\"\n}\n\n\naws_iam_policy.tf\n\npolicy\u306b\u306fjson\u30d5\u30a1\u30a4\u30eb\u3092\u305d\u306e\u307e\u307e\u653e\u308a\u8fbc\u3081\u308b\u3088\u3046\u306b\u7d44\u307f\u8fbc\u307f\u95a2\u6570file\u3092\u4f7f\u3044\u307e\u3059\u3002\nresource \"aws_iam_policy\" \"iam-policy\" {\n  name = \"${var.aws_iam_policy_name}\"\n  path = \"${var.aws_iam_policy_path}\"\n  description = \"${var.aws_iam_policy_description}\"\n  policy = <<EOF\n${file(\"${var.aws_iampolicy_json}\")}\nEOF\n}\n\n\noutputs.tf\n\narn\u3092\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\noutput \"name\" {\n  value = \"${aws_iam_policy.iam-policy.name}\"\n}\n\noutput \"arn\" {\n  value = \"${aws_iam_policy.iam-policy.arn}\"\n}\n\n\nmodule\u3092\u5229\u7528\u3059\u308btf\u306e\u4f5c\u6210\n\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3059\norenomac$ tree examples/\nexamples/\n\u251c\u2500\u2500 datawanwan_policy.json\n\u2514\u2500\u2500 test_terraform.tf\n\n\ntest_terraform.tf\n\n\u30e1\u30a4\u30f3\u3068\u306a\u308btf\u3067\u306fmodule\u306b\u5909\u6570\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u3059\u3002\nsource\u306b\u306f\u4f7f\u7528\u3059\u308bmodule\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u307e\u3067\u306e\u30d1\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u672c\u4f8b\u3067\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u307e\u3059\u304c\u3001github/bitbucket\u306a\u3069\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u540c\u50da\u306e\u7686\u69d8GHE\u306bpush\u3057\u3068\u304f\u306e\u3067\u4f7f\u3063\u3066\u4e0b\u3055\u3044ww(\u696d\u52d9\u9023\u7d61\nprovider \"aws\" {\n  region = \"ap-northeast-1\"\n}\n\nmodule \"iam-group\" {\n  source = \"../module/iam/group\"\n  aws_iam_groupname = \"oreore\"\n  aws_iam_grouppath = \"/oreore/\"\n}\n\nmodule \"iam-user\" {\n  source = \"../module/iam/user\"\n  aws_iam_username = \"iam-user\"\n  aws_iam_grouppath = \"/oreore/users/\"\n}\n\nmodule \"iam-datawanwan\" {\n  source = \"../module/iam/user\"\n  aws_iam_username = \"iam-datawanwan\"\n  aws_iam_grouppath = \"/oreore/users/\"\n}\n\nmodule \"iam-datawanwan_policy\" {\n  source = \"../module/iam/policy/\"\n  aws_iam_policy_name = \"datawanwan\"\n  aws_iam_policy_path = \"/policy/\"\n  aws_iam_policy_description =  \"datawanwan policy\"\n  aws_iampolicy_json = \"datawanwan_policy.json\"\n}\n\n/* module\u3067\u5b9a\u7fa9\u3055\u308c\u305fresource\u306evariables\u3092\u5916\u90e8resource\u304b\u3089\u53c2\u7167\u3059\u308b\u4f8b */\n\nresource \"aws_iam_policy_attachment\" \"datawanwan\" {\n  name = \"datawanwan\"\n  users = [\"${module.iam-datawanwan.name}\"]\n  policy_arn = \"${module.iam-datawanwan_policy.arn}\"\n}\n\n\ndatawanwan_policy.json\n\ndatadog\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u308b\u901a\u308a\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nmodule\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n      {\n        \"Action\": [\n        \"autoscaling:Describe*\",\n        \"cloudformation:DescribeStacks\",\n        \"cloudformation:DescribeStackEvents\",\n        \"cloudformation:DescribeStackResources\",\n        \"cloudformation:GetTemplate\",\n        \"cloudfront:Get*\",\n        \"cloudfront:List*\",\n        \"cloudtrail:DescribeTrails\",\n        \"cloudtrail:GetTrailStatus\",\n        \"cloudwatch:Describe*\",\n        \"cloudwatch:Get*\",\n        \"cloudwatch:List*\",\n        \"dynamodb:GetItem\",\n        \"dynamodb:BatchGetItem\",\n        \"dynamodb:Query\",\n        \"dynamodb:Scan\",\n        \"dynamodb:DescribeTable\",\n        \"dynamodb:ListTables\",\n        \"ec2:Describe*\",\n        \"elasticache:Describe*\",\n        \"elasticbeanstalk:Check*\",\n        \"elasticbeanstalk:Describe*\",\n        \"elasticbeanstalk:List*\",\n        \"elasticbeanstalk:RequestEnvironmentInfo\",\n        \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n        \"elasticloadbalancing:Describe*\",\n        \"iam:List*\",\n        \"iam:Get*\",\n        \"route53:Get*\",\n        \"route53:List*\",\n        \"rds:Describe*\",\n        \"rds:ListTagsForResource\",\n        \"s3:List*\",\n        \"sdb:GetAttributes\",\n        \"sdb:List*\",\n        \"sdb:Select*\",\n        \"ses:Get*\",\n        \"ses:List*\",\n        \"sns:Get*\",\n        \"sns:List*\",\n        \"sqs:GetQueueAttributes\",\n        \"sqs:ListQueues\",\n        \"sqs:ReceiveMessage\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\n\u3044\u3056terraform plan/apply..\u306e\u307e\u3048\u306b\nterraform get\u3067module\u3092\u53d6\u5f97\u3057\u307e\u3059\norenomac$ cd <path>/<to>/examples\norenomac$ terraform get\nGet: file:///orenoterraform/module/iam/group\nGet: file:///orenoterraform/module/iam/user\nGet: file:///orenoterraform/module/iam/user\nGet: file:///orenoterraform/module/iam/policy\n\n\nplan\nplan\u3092\u5b9f\u884c\u3057\u307e\u3059\norenomac$ terraform plan\nRefreshing Terraform state prior to plan...\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_iam_policy_attachment.datawanwan\n    name:             \"\" => \"datawanwan\"\n    policy_arn:       \"\" => \"${module.iam-datawanwan_policy.arn}\"\n    users.#:          \"\" => \"1\"\n    users.XXXXXXXXXXX: \"\" => \"iam-datawanwan\"\n\n+ module.iam-datawanwan_policy.aws_iam_policy.iam-policy\n    arn:         \"\" => \"<computed>\"\n    description: \"\" => \"datawanwan policy\"\n    name:        \"\" => \"datawanwan\"\n..\u7701\u7565..\n\n\napply\napply\u53e9\u304f\u524d\u306bACCESS_KEY\u3068SECRET_KEY\u306f\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u30fc\u3002\ndirenv\u3068\u304b\u74b0\u5883\u5909\u6570\u306eexport\u3067\u3002\norenomac$ terraform apply\nmodule.iam-user.aws_iam_user.iam-user: Creating...\n  arn:       \"\" => \"<computed>\"\n  name:      \"\" => \"iam-user\"\n  path:      \"\" => \"/oreore/users/\"\n  unique_id: \"\" => \"<computed>\"\nmodule.iam-datawanwan_policy.aws_iam_policy.iam-policy: Creating...\n  arn:         \"\" => \"<computed>\"\n..\u7701\u7565..\n\norenomac$ terraform show\naws_iam_policy_attachment.datawanwan:\n  id = datawanwan\n  groups.# = 0\n  name = datawanwan\n  policy_arn = arn:aws:iam::XXXXXXXXXXX:policy/policy/datawanwan\n  roles.# = 0\n  users.# = 1\n  users.XXXXXXXXXXXX = iam-datawanwan\n\n\u3061\u306a\u307f\u306b\nmodule\u306eoutput\u306f\u3001terraform output\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\norenomac$ terraform output\nThe state file has no outputs defined. Define an output\nin your configuration with the `output` directive and re-run\n`terraform apply` for it to become available.\n\n\u307f\u3093\u306aterraform module\u4f7f\u3063\u3066\u697d\u3057\u307e\u3057\u3087\u3046\u7684~\n\u5b8c\n\u4ffa\u3067\u3059\u3002\n\n\u4e16\u754c70\u5104\u306eterraform\u8077\u4eba\u306e\u7686\u69d8\u3053\u3093\u3070\u3093\u306f\u3002teraform\u8077\u4eba\u306e\u591c\u306f\u9045\u3044\u3067\u3059\u306d\u3002\n\n\u3055\u3066module\u4f7f\u3063\u3066\u307e\u3059\u304b\uff1f\n\u6700\u8fd1\u3068\u3044\u3063\u3066\u3082\u3064\u3044\u6570\u6642\u9593\u524d\u304b\u3089\u4eca\u307e\u3067\u81ea\u5206\u304c\u4f5c\u3063\u305fterraform tf\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3092\u59cb\u3081\u307e\u3057\u305f\u3002\n\n\u203b\u540c\u3058\u7d44\u7e54\u306e\u65b9\u306fGHE\u306bpush\u3057\u3066\u308boreno\u30b7\u30ea\u30fc\u30ba\u30ea\u30dd\u30b8\u30c8\u30ea\u307f\u3066\u306d(\u696d\u52d9\u9023\u7d61)\n\n\u4eca\u56de\u306fIAM User\u3068policy\u3092module\u5316\u3057\u3066\u3001\n\u697d\u3005\u4f7f\u3044\u307e\u308f\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u4f8b\u3092\u8f09\u305b\u3061\u3083\u3044\u307e\u3059\u3002\n\n# \u53c2\u8003\u3068\u3044\u3046\u304b\u3053\u305f\u3048\n\nterraform\u306ecommunity-module\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u3042\u308b\u306e\u3067\u30ba\u30d0\u30ea\u3053\u308c\u3067\u3002\nhttps://github.com/terraform-community-modules\n\n\u3055\u3066\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u30fc\n\n# module\u306e\u4f5c\u6210\n\nmodule\u3068\u306a\u308bterraform tf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\n\n\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u69d8\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n1tf\u306b\u307e\u3068\u3081\u3066\u3082\u3044\u3044\u3093\u3058\u3083\u306d\u3063\u3066\u601d\u3046\u306e\u3067\u3059\u304c\n\u307e\u3042\u30fcresource\u306f\u306a\u304c\u30fc\u304f\u306a\u308b\u3053\u3068\u3082\u3042\u308b\u3057\u3001community-modules\u304c\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u3063\u3066\u308b\u306e\u3067\n\u3053\u306e\u8fba\u306f\u6e96\u62e0\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\u306a\u611f\u3058\u3067\u3059\u304b\u306d\u30fc\u3002\n\u5404\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30eb\u30fc\u30eb\u4f5c\u3063\u3066\u3057\u307e\u3048\u3070\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u306d\u3002\n\n## module\u306e\u30d5\u30a1\u30a4\u30eb\u7528\u9014\n\n|\u30d5\u30a1\u30a4\u30eb\u540d|\u7528\u9014|\n|---|---|\n|variables.tf|\u5909\u6570\u5b9a\u7fa9|\n|iam_***.tf|resource\u5b9a\u7fa9|\n|outputs.tf|\u623b\u308a\u5024\u5b9a\u7fa9|\n\n## module\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\n\n```\norenomac$ tree module/iam\nmodule/iam\n\u251c\u2500\u2500 group\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 iam_group.tf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 outputs.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variables.tf\n\u251c\u2500\u2500 policy\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 aws_iam_policy.tf\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 outputs.tf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 variables.tf\n\u251c\u2500\u2500 role\n\u2514\u2500\u2500 user\n    \u251c\u2500\u2500 aws_iam_user.tf\n    \u251c\u2500\u2500 outputs.tf\n    \u2514\u2500\u2500 variables.tf\n```\n\n## IAM Group\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\n- variables.tf\n\nmodule resource\u306e\u5f15\u6570\u306b\u6307\u5b9a\u3059\u308bvariable\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```\nvariable \"aws_iam_groupname\" {\n  description = \"iam group name\"\n}\n\nvariable \"aws_iam_grouppath\" {\n  description = \"iam group path(/users/)\"\n  default = \"/\"\n}\n```\n\n- iam_group.tf\n\nmodule\u3067\u52d5\u4f5c\u3059\u308bresource\u3092\u5b9a\u7fa9\u3057\u307e\u3059\n\n```\nresource \"aws_iam_group\" \"iam-group\" {\n  name = \"${var.aws_iam_groupname}\"\n  path = \"${var.aws_iam_grouppath}\"\n}\n```\n\n- outputs.tf\n\nmodule\u5916\u304b\u3089\u53c2\u7167\u3055\u308c\u308bresource\u3067module\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306e\u623b\u308a\u5024\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\noutput\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001module\u3067\u4f5c\u3089\u308c\u305fresource\u5185variable\u3092\u3001\u5916\u90e8resource\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\n```\noutput \"name\" {\n  value = \"${aws_iam_group.iam-group.name}\"\n}\n```\n\n## IAM User\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\n- variables.tf\n\n```\nvariable \"aws_iam_username\" {\n  description = \"iam user name\"\n}\nvariable \"aws_iam_grouppath\" {\n  description = \"iam group path(/users/)\"\n  default = \"/\"\n}\n```\n\n- aws_iam_user.tf\n\n```\nresource \"aws_iam_user\" \"iam-user\" {\n  name = \"${var.aws_iam_username}\"\n  path = \"${var.aws_iam_grouppath}\"\n}\n```\n\n- outputs.tf\n\n```\noutput \"name\" {\n  value = \"${aws_iam_user.iam-user.name}\"\n}\n```\n\n## IAM Policy\u7528\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u308b\n\n- variables.tf\n\n```\nvariable \"aws_iam_policy_name\" {\n  description = \"Policy Name\"\n  default = \"iam-policy\"\n}\n\nvariable \"aws_iam_policy_path\" {\n  description = \"iam policy path\"\n  default = \"/policy/\"\n}\n\nvariable \"aws_iam_policy_description\" {\n  description = \"iam policy description\"\n  default = \"iam policy\"\n}\nvariable \"aws_iampolicy_json\" {\n  description = \"iampolicy json filename\"\n  default = \"iam_policy.json\"\n}\n```\n\n- aws_iam_policy.tf\n\npolicy\u306b\u306fjson\u30d5\u30a1\u30a4\u30eb\u3092\u305d\u306e\u307e\u307e\u653e\u308a\u8fbc\u3081\u308b\u3088\u3046\u306b\u7d44\u307f\u8fbc\u307f\u95a2\u6570file\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```\nresource \"aws_iam_policy\" \"iam-policy\" {\n  name = \"${var.aws_iam_policy_name}\"\n  path = \"${var.aws_iam_policy_path}\"\n  description = \"${var.aws_iam_policy_description}\"\n  policy = <<EOF\n${file(\"${var.aws_iampolicy_json}\")}\nEOF\n}\n```\n\n- outputs.tf\n\narn\u3092\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\noutput \"name\" {\n  value = \"${aws_iam_policy.iam-policy.name}\"\n}\n\noutput \"arn\" {\n  value = \"${aws_iam_policy.iam-policy.arn}\"\n}\n```\n\n# module\u3092\u5229\u7528\u3059\u308btf\u306e\u4f5c\u6210\n\n\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u3059\n\n```\norenomac$ tree examples/\nexamples/\n\u251c\u2500\u2500 datawanwan_policy.json\n\u2514\u2500\u2500 test_terraform.tf\n```\n\n- test_terraform.tf\n\n\u30e1\u30a4\u30f3\u3068\u306a\u308btf\u3067\u306fmodule\u306b\u5909\u6570\u6307\u5b9a\u3057\u3066\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u3059\u3002\nsource\u306b\u306f\u4f7f\u7528\u3059\u308bmodule\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u307e\u3067\u306e\u30d1\u30b9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u672c\u4f8b\u3067\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u3066\u307e\u3059\u304c\u3001github/bitbucket\u306a\u3069\u306e\u30d1\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u540c\u50da\u306e\u7686\u69d8GHE\u306bpush\u3057\u3068\u304f\u306e\u3067\u4f7f\u3063\u3066\u4e0b\u3055\u3044ww(\u696d\u52d9\u9023\u7d61\n\n```\nprovider \"aws\" {\n  region = \"ap-northeast-1\"\n}\n\nmodule \"iam-group\" {\n  source = \"../module/iam/group\"\n  aws_iam_groupname = \"oreore\"\n  aws_iam_grouppath = \"/oreore/\"\n}\n\nmodule \"iam-user\" {\n  source = \"../module/iam/user\"\n  aws_iam_username = \"iam-user\"\n  aws_iam_grouppath = \"/oreore/users/\"\n}\n\nmodule \"iam-datawanwan\" {\n  source = \"../module/iam/user\"\n  aws_iam_username = \"iam-datawanwan\"\n  aws_iam_grouppath = \"/oreore/users/\"\n}\n\nmodule \"iam-datawanwan_policy\" {\n  source = \"../module/iam/policy/\"\n  aws_iam_policy_name = \"datawanwan\"\n  aws_iam_policy_path = \"/policy/\"\n  aws_iam_policy_description =  \"datawanwan policy\"\n  aws_iampolicy_json = \"datawanwan_policy.json\"\n}\n\n/* module\u3067\u5b9a\u7fa9\u3055\u308c\u305fresource\u306evariables\u3092\u5916\u90e8resource\u304b\u3089\u53c2\u7167\u3059\u308b\u4f8b */\n\nresource \"aws_iam_policy_attachment\" \"datawanwan\" {\n  name = \"datawanwan\"\n  users = [\"${module.iam-datawanwan.name}\"]\n  policy_arn = \"${module.iam-datawanwan_policy.arn}\"\n}\n```\n\n- datawanwan_policy.json\n\ndatadog\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3066\u308b\u901a\u308a\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nmodule\n\n```\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n      {\n        \"Action\": [\n        \"autoscaling:Describe*\",\n        \"cloudformation:DescribeStacks\",\n        \"cloudformation:DescribeStackEvents\",\n        \"cloudformation:DescribeStackResources\",\n        \"cloudformation:GetTemplate\",\n        \"cloudfront:Get*\",\n        \"cloudfront:List*\",\n        \"cloudtrail:DescribeTrails\",\n        \"cloudtrail:GetTrailStatus\",\n        \"cloudwatch:Describe*\",\n        \"cloudwatch:Get*\",\n        \"cloudwatch:List*\",\n        \"dynamodb:GetItem\",\n        \"dynamodb:BatchGetItem\",\n        \"dynamodb:Query\",\n        \"dynamodb:Scan\",\n        \"dynamodb:DescribeTable\",\n        \"dynamodb:ListTables\",\n        \"ec2:Describe*\",\n        \"elasticache:Describe*\",\n        \"elasticbeanstalk:Check*\",\n        \"elasticbeanstalk:Describe*\",\n        \"elasticbeanstalk:List*\",\n        \"elasticbeanstalk:RequestEnvironmentInfo\",\n        \"elasticbeanstalk:RetrieveEnvironmentInfo\",\n        \"elasticloadbalancing:Describe*\",\n        \"iam:List*\",\n        \"iam:Get*\",\n        \"route53:Get*\",\n        \"route53:List*\",\n        \"rds:Describe*\",\n        \"rds:ListTagsForResource\",\n        \"s3:List*\",\n        \"sdb:GetAttributes\",\n        \"sdb:List*\",\n        \"sdb:Select*\",\n        \"ses:Get*\",\n        \"ses:List*\",\n        \"sns:Get*\",\n        \"sns:List*\",\n        \"sqs:GetQueueAttributes\",\n        \"sqs:ListQueues\",\n        \"sqs:ReceiveMessage\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n# \u3044\u3056terraform plan/apply..\u306e\u307e\u3048\u306b\n\nterraform get\u3067module\u3092\u53d6\u5f97\u3057\u307e\u3059\n\n```\norenomac$ cd <path>/<to>/examples\norenomac$ terraform get\nGet: file:///orenoterraform/module/iam/group\nGet: file:///orenoterraform/module/iam/user\nGet: file:///orenoterraform/module/iam/user\nGet: file:///orenoterraform/module/iam/policy\n```\n\n# plan\n\nplan\u3092\u5b9f\u884c\u3057\u307e\u3059\n\n```\norenomac$ terraform plan\nRefreshing Terraform state prior to plan...\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_iam_policy_attachment.datawanwan\n    name:             \"\" => \"datawanwan\"\n    policy_arn:       \"\" => \"${module.iam-datawanwan_policy.arn}\"\n    users.#:          \"\" => \"1\"\n    users.XXXXXXXXXXX: \"\" => \"iam-datawanwan\"\n\n+ module.iam-datawanwan_policy.aws_iam_policy.iam-policy\n    arn:         \"\" => \"<computed>\"\n    description: \"\" => \"datawanwan policy\"\n    name:        \"\" => \"datawanwan\"\n..\u7701\u7565..\n```\n\n# apply\n\napply\u53e9\u304f\u524d\u306bACCESS_KEY\u3068SECRET_KEY\u306f\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u30fc\u3002\ndirenv\u3068\u304b\u74b0\u5883\u5909\u6570\u306eexport\u3067\u3002\n\n```\norenomac$ terraform apply\nmodule.iam-user.aws_iam_user.iam-user: Creating...\n  arn:       \"\" => \"<computed>\"\n  name:      \"\" => \"iam-user\"\n  path:      \"\" => \"/oreore/users/\"\n  unique_id: \"\" => \"<computed>\"\nmodule.iam-datawanwan_policy.aws_iam_policy.iam-policy: Creating...\n  arn:         \"\" => \"<computed>\"\n..\u7701\u7565..\n```\n\n```\norenomac$ terraform show\naws_iam_policy_attachment.datawanwan:\n  id = datawanwan\n  groups.# = 0\n  name = datawanwan\n  policy_arn = arn:aws:iam::XXXXXXXXXXX:policy/policy/datawanwan\n  roles.# = 0\n  users.# = 1\n  users.XXXXXXXXXXXX = iam-datawanwan\n```\n\n\n\u3061\u306a\u307f\u306b\nmodule\u306eoutput\u306f\u3001terraform output\u3067\u53c2\u7167\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n```\norenomac$ terraform output\nThe state file has no outputs defined. Define an output\nin your configuration with the `output` directive and re-run\n`terraform apply` for it to become available.\n```\n\n\u307f\u3093\u306aterraform module\u4f7f\u3063\u3066\u697d\u3057\u307e\u3057\u3087\u3046\u7684~\n\n\u5b8c\n", "tags": ["\u4ffa\u3067\u3082\u308f\u304b\u308b\u30b7\u30ea\u30fc\u30ba", "Terraform", "AWS"]}