{"context": "\u3053\u306e\u8a18\u4e8b\u306fStan Advent Calender\u306e18\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u3084\u6539\u5584\u70b9\u306a\u3069\u3054\u6307\u6458\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u30a2\u30cb\u30e1\u306b\u95a2\u3059\u308b\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306f\u3001\u672c\u7a3f\u5185\u5bb9\u306e\u7d39\u4ecb\u306b\u5fc5\u8981\u6700\u4f4e\u9650\u306a\u7bc4\u56f2\u3067\u4f7f\u7528\u3059\u308b\u3082\u306e\u3068\u3057\u3066\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\u52d5\u4f5c\u74b0\u5883\uff1aWindows, R3.3.1,Rstan2.11.1\n\u307f\u306a\u3055\u3093\u3053\u3093\u306b\u3061\u306f\u3002\u5bd2\u3044\u5b63\u7bc0\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3002\n\u4eca\u56de\u306fStan\u30a2\u30c9\u30ab\u30ec\u3067\u3082 (\u4e00\u90e8\u3067) \u8a71\u984c\u306b\u306a\u3063\u3066\u3044\u308b\u3001\u307f\u3093\u306a\u5927\u597d\u304d\u30e9\u30d6\u30e9\u30a4\u30d6\uff01\u306e\u304a\u8a71\u3067\u3059\u3002\n\u30e9\u30d6\u30e9\u30a4\u30d6\u3068\u306f\uff1a\u300e\u30e9\u30d6\u30e9\u30a4\u30d6! School idol project\u300f\uff08\u30e9\u30d6\u30e9\u30a4\u30d6 \u30b9\u30af\u30fc\u30eb\u30a2\u30a4\u30c9\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3001\u901a\u79f0:\u30e9\u30d6\u30e9\u30a4\u30d6\uff09\u306f\u56fd\u7acb\u97f3\u30ce\u6728\u5742\u5b66\u9662\u3067\u7d50\u6210\u3055\u308c\u305f\u67b6\u7a7a\u306e\u30a2\u30a4\u30c9\u30eb\u30b0\u30eb\u30fc\u30d7\u306e\u596e\u95d8\u3068\u6210\u9577\u3092\u63cf\u304f\u65e5\u672c\u306e\u30e1\u30c7\u30a3\u30a2\u30df\u30c3\u30af\u30b9\u4f5c\u54c1\u7fa4 (\u30a2\u30f3\u30b5\u30a4\u30af\u30ed\u30da\u30c7\u30a3\u30a2\u3088\u308a)\u3002 \n\u305d\u3093\u306a\u30e9\u30d6\u30e9\u30a4\u30d6\u306e\u4eba\u6c17\u306f\u8870\u3048\u308b\u3068\u3053\u308d\u3092\u77e5\u3089\u305a\u3001\u30a2\u30cb\u30e1\u304c\u7d42\u308f\u3063\u305f\u4eca\u3082\u30ea\u30ba\u30e0\u30b2\u30fc\u30e0\u306e\u30a2\u30fc\u30b1\u30fc\u30c9\u7248\u304c\u5168\u56fd\u306e\u30b2\u30fc\u30e0\u30bb\u30f3\u30bf\u30fc\u3067\u597d\u8a55\u7a3c\u50cd\u4e2d\u3089\u3057\u3044\u3067\u3059\u3088\uff01\u307f\u3093\u306a\u304a\u91d1\u6301\u3063\u3066\u30b2\u30fc\u30e0\u30bb\u30f3\u30bf\u30fc\u3078\u6025\u304e\u307e\u3057\u3087\u3046\uff01\n\u3055\u3066\u3055\u3066\u672c\u7a3f\u3067\u306f\u305d\u3093\u306a\u30e9\u30d6\u30e9\u30a4\u30d6\u306b\u767b\u5834\u3059\u308b9\u4eba\u306e\u5973\u306e\u5b50\u306b\u5bfe\u3059\u308b\u9078\u597d\u3068\u9078\u629e\u3057\u305f\u4eba\u7269\u306e\u500b\u4eba\u7279\u6027\u306e\u95a2\u9023\u306b\u95a2\u3057\u3066\u3001Stan\u306b\u3088\u308b\u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u5206\u6790\u3092\u7528\u3044\u3066\u30d9\u30a4\u30ba\u63a8\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u7814\u7a76\u306e\u80cc\u666f\u305d\u306e1\n\u79c1\u306f\u53cb\u9054\u306b\u9023\u308c\u3089\u308c\u3066\u3001\u3053\u306e\u30a2\u30cb\u30e1\u306b\u51fa\u3066\u304f\u308b\u306b\u3053\u3061\u3083\u3093\u3068\u3088\u3070\u308c\u308b\u5b50\u3092\u521d\u3081\u3066\u898b\u305f\u3068\u304d\u306b\u601d\u3044\u307e\u3057\u305f\u3002\n\n\u300c\u3042\u3001\u3053\u308c\u306f\u597d\u304d\u306b\u306a\u308b\u308f\u300d\n\u3068\u3002\n\u6848\u306e\u5b9a\u3001\u30a2\u30cb\u30e1\u306e\u4e2d\u306b\u5f7c\u5973\u304c\u51fa\u3066\u304d\u30662\u5206\u5f8c\u304f\u3089\u3044\u306b\u306f\u3059\u3050\u306b[\u306b\u3053\u63a8\u3057]\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u7121\u7406\u3082\u306a\u3044\u3053\u3068\u3067\u3059\u3002\u304b\u308f\u3044\u3044\u3067\u3059\u304b\u3089\u3002\n\u3067\u3059\u304c\u3001\u30e9\u30d6\u30e9\u30a4\u30d6\u306b\u51fa\u3066\u304f\u308b\u30ad\u30e3\u30e9\u30af\u30bf\u30fc(\u4ee5\u4e0b\u3001\u5f7c\u5973\u305f\u3061\u306e\u30e6\u30cb\u30c3\u30c8\u540d\u3067\u3042\u308b\u03bc's\u3068\u3057\u307e\u3059)\u306f\u3001\u3044\u305a\u308c\u3082\u3068\u3066\u3082\u304b\u308f\u3044\u3044\u5b50\u3070\u304b\u308a\u3067\u3059\u3002\n\n\u305d\u3093\u306a\u03bc's\u306e\u4e2d\u3067\u3001\u8ab0\u3092\u63a8\u3059\u304b\u3068\u3044\u3046\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u629e\u306b\u5916\u5411\u6027\u3084\u795e\u7d4c\u75c7\u50be\u5411\u306a\u3069\u306e\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u7279\u6027\u304c\u3069\u306e\u3088\u3046\u306b\u304b\u304b\u308f\u3063\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002\n\u3053\u308c\u304c\u308f\u304b\u308b\u3068\u3001\u300c\u3042\u306a\u305f\u306f\u03bc's\u306e\u4e2d\u306e\u3060\u308c\u63a8\u3057\u3067\u3059\u304b\uff1f\u300d\u3068\u3044\u3046\u8cea\u554f\u304c\u305d\u306e\u307e\u307e\u300c\u3042\u306a\u305f\u306f\u3069\u3046\u3044\u3063\u305f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u3092\u304a\u6301\u3061\u3067\u3059\u304b\uff1f\u300d\u3068\u3044\u3046\u8cea\u554f\u306b\u751f\u307e\u308c\u5909\u308f\u308b\u306e\u3060\uff01\u3053\u308c\u306f\u3059\u3054\u3044\uff01\u610f\u7fa9\u306b\u5bfe\u3059\u308b\u7591\u5ff5\u306e\u4f59\u5730\u306f\u306a\u3044\uff01\n\u3053\u308c\u307e\u3067\u306e\u5fc3\u7406\u5b66\u7684\u9818\u57df\u3067\u3001\u3082\u3063\u3068\u3082\u77e5\u898b\u306e\u7a4d\u307f\u91cd\u306d\u3089\u308c\u305f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u306e\u7279\u6027\u8ad6\u3067\u3042\u308b\u30d3\u30c3\u30b0\u30d5\u30a1\u30a4\u30d6\u306f\u3001\u4eba\u9593\u306e\u6301\u3064\u7279\u6027\u30925\u3064\u306e\u56e0\u5b50\u3067\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e5\u3064\u306e\u56e0\u5b50\u3068\u306f\u3001\u300c\u7d4c\u9a13\u3078\u306e\u958b\u653e\u6027\uff08O\uff09\u300d\u300c\u8aa0\u5b9f\u6027\uff08C\uff09\u300d\u300c\u5916\u5411\u6027\uff08E\uff09\u300d\u300c\u5354\u8abf\u6027\uff08A\uff09\u300d\u300c\u795e\u7d4c\u75c7\u50be\u5411\uff08N\uff09\u300d\u3067\u3059\u3002\n\u79c1\u306f\u305d\u3053\u305d\u3053\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u306a\u306e\u3067\u3001\n\u300c\u306b\u3053\u3061\u3083\u3093\u3092\u597d\u304d\u306a\u4eba\u306f\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u3067\u3042\u308b\u300d\n\u3068\u3044\u3046\u5927\u80c6\u306a\u4eee\u8aac\u3092\u7acb\u3066\u3066\u3001\u4ee5\u4e0b\u306e\u5206\u6790\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u7814\u7a76\u306e\u80cc\u666f\u305d\u306e2\nGoogle drive\u4f7f\u3063\u305f\u30cd\u30c3\u30c8\u8abf\u67fb\u3092\u3057\u3066\u307f\u305f\u304b\u3063\u305f\uff0b\u5b9f\u30c7\u30fc\u30bf\u3092\u7528\u3044\u305f\u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u30d9\u30a4\u30ba\u3067\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u3093\u3067\u3059\u3002\u3002\u3002\n\n\u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3068\u306f\nK \u7a2e\u985e (\u3053\u3053\u3067\u306f\u03bc's\u306e\u6570:9\u4eba) \u306e\u540d\u7fa9\u5c3a\u5ea6\u306b\u3088\u308b\u76ee\u7684\u5909\u6570 $y_n$ (\u8ab0\u3092\u9078\u629e\u3059\u308b\u304b) \u304c\u3001 D \u6b21\u5143\u306e\u8aac\u660e\u5909\u6570 $x_n$ (\u3053\u3053\u3067\u3044\u3046Big Five\u3084\u6027\u5225\u306a\u3069) \u306b\u3088\u308a\u4e88\u6e2c\u3055\u308c\u308b\u56de\u5e30\u5f0f\u3067\u3042\u308b\u3002\u5f8c\u306e\u30b3\u30fc\u30c9\u306b\u51fa\u3066\u304f\u308bSoftmax\u95a2\u6570\u306e\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u306fStan Reference Manual\u306e386p\u8fba\u308a\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\u30bd\u30d5\u30c8\u30de\u30c3\u30af\u30b9\u56de\u5e30\u3068\u547c\u3070\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e\u56de\u5e30\u5206\u6790\u3067\u306f\u56de\u5e30\u4fc2\u6570\u304c\u4e0d\u78ba\u5b9f\u6027\u3092\u6301\u3064\u305f\u3081\u3001\u4e00\u3064\u306e\u53c2\u7167\u30ab\u30c6\u30b4\u30ea\u30fc $r$ \u306b $0$ \u306e\u5b9a\u6570\u3092\u7f6e\u304f\u3053\u3068\u3067\u76f8\u5bfe\u7684\u306a\u89e3\u91c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002 $r$ \u306b\u95a2\u3057\u3066\u3001 $\u03b2_D = 0$ \u3067\u3059\u306d\u3002\u8a73\u3057\u304f\u306f\u72ac4\u5339\u672c\u306a\u308a\u30b0\u30b0\u308b\u306a\u308a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4eca\u56de\u306e\u53c2\u7167\u30ab\u30c6\u30b4\u30ea\u30fc\u306b\u306f\u3001\u4e3b\u4eba\u516c\u3067\u3042\u308b\u7a42\u4e43\u679c\u3061\u3083\u3093\u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002 \n\n\u65b9\u6cd5\n\u53c2\u52a0\u8005\u3000SNS\uff08twitter, line\uff09\u306a\u3069\u3092\u901a\u3057\u3066\u53ce\u96c6\u3057\u305f92\u540d (\u753744\u4eba\u3001\u597348\u4eba) \u306e\u53c2\u52a0\u8005\uff08\u3054\u5354\u529b\u3044\u305f\u3060\u3044\u305f\u7686\u69d8\u672c\u5f53\u306b\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\uff01\n\u8cea\u554f\u7d19\u3000\u65e5\u672c\u8a9e\u7248Ten Item Personality Inventory\uff08TIPI-J\uff1a\u5c0f\u5869\u4ed6, 2012\uff09\u306e\u8cea\u554f\u7d1910\u9805\u76ee\u3092\u4f7f\u7528\u3002Big Five\u3092\u6e2c\u5b9a\u3059\u308b\u8cea\u554f\u7d19\u3002\n\u624b\u7d9a\u304d\u3000\u53c2\u52a0\u8005\u306b\u306fGoogle form\u306b\u3066\u56de\u7b54\u3092\u3057\u3066\u3082\u3089\u3063\u305f\u3002\u307e\u305a\u5e74\u9f62\u3001\u6027\u5225\u3092\u56de\u7b54\u3057\u3066\u3082\u3089\u3044\u3001\u305d\u306e\u6b21\u306bTIPI-J\u3001\u6700\u5f8c\u306b \u03bc\u2019s 9\u4eba\u304c\u79fb\u3063\u305f\u30dd\u30b9\u30bf\u30fc\u306e\u4e2d\u304b\u3089\u4e00\u4eba\u3060\u3051\u597d\u307f\u306e\u5973\u306e\u5b50\u3092\u9078\u629e\u3057\u3066\u3082\u3089\u3063\u305f\u3002\n\n\u7d50\u679c1. \u307e\u305a\u306f\u9078\u6319\u304b\u3089\u306f\u3058\u3081\u3088\u3046\u3002\n\u307e\u305a\u306f\u6700\u3082\u5f97\u7968\u6570\u304c\u591a\u304b\u3063\u305f\u306e\u306f\u8ab0\u306a\u306e\u304b\u3002\nRstan\u30e6\u30fc\u30b6\u30fc\u306a\u3089\u7121\u99c4\u306b\u4e8b\u5f8c\u5206\u5e03\u3067\u5831\u544a\u3057\u3088\u3046\u3058\u3083\u3042\u308a\u307e\u305b\u3093\u304b\u3002\n\u4ee5\u4e0b\u306f\u304f\u3063\u305d\u5358\u7d14\u306b\u9078\u629e\u7387\u3092\u7b97\u51fa\u3057\u305fStan\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\uff08\u4e8b\u5f8c\u5206\u5e03\u306e\u5dee\u5206\u3092\u6bd4\u8f03\u3057\u3088\u3046\u304b\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u6570\u304c\u591a\u304f\u3066\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u5206\u5e03\u898b\u3066\u3069\u3046\u305e\u3063\u3066\u611f\u3058\u306b\u3057\u3066\u307e\u3059\u3002\n\u203b12/20\u4e8c\u9805\u5206\u5e03\u3067\u51fa\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u591a\u9805\u5206\u5e03\u3067\u7b97\u51fa\u3059\u308b\u30b3\u30fc\u30c9\u306b\u5909\u66f4\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n\nbinom.stan\ndata{\n  int K; //\u5909\u6570\u306e\u6570\n  int D[K]; //\u751f\u8d77\u6570\n}\nparameters{\n  simplex[K] theta;\n}\nmodel{\n  D ~ multinomial(theta); \n}\n\n\n\u307b\u3093\u3067R\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nbinom.r\n#muse\u306e\u8a71\nd <- read.table(\"clipboard\",header=T)\n\n#\u5408\u8a08\u5f97\u70b9\u306e\u4f5c\u6210 \u3053\u3053\u306e\u7121\u99c4\u611f\u534a\u7aef\u306a\u3044\u3067\u3059\u3002\nd <- mutate(d,Ex = 0)\nd <- mutate(d,Ag = 0)\nd <- mutate(d,Co = 0)\nd <- mutate(d,Ne = 0)\nd <- mutate(d,Op = 0)\nforeach(i = 1:nrow(d)) %do% {\n  d[i,14] <- sum(d[i,3]+8-d[i,8])\n  d[i,15] <- sum(d[i,4]+8-d[i,9])\n  d[i,16] <- sum(d[i,5]+8-d[i,10])\n  d[i,17] <- sum(d[i,6]+8-d[i,11])\n  d[i,18] <- sum(d[i,7]+8-d[i,12])\n}\n\n\n\n#\u6570\u3092\u6570\u3048\u308b\nm_n <- matrix(0,9,1)\nforeach(i = 1:9)%do%{\n  m_n[i,] <- as.integer(sum(d[,13] == i))\n}\n\nbimodel <- stan_model(file='bino.stan')\n\nfit <- sampling(bimodel,data=list(K=9, D=m_n[,1]),iter=5000)\n\nstan_hist(fit,pars=c(\"theta\"))\n\n\n\u3061\u306a\u307f\u306b\u3053\u306eStan\u30b3\u30fc\u30c9\u306f\u5358\u7d14\u3059\u304e\u3066\u3001MCMC(*\u00b4\u0414\uff40)\u30cf\u30a2\u30cf\u30a2\u3068\u3046\u3061\u7d42\u308f\u308b\u3053\u308d\u306b\u306f\u89e3\u6790\u304c\u7d42\u4e86\u3057\u307e\u3059\u3002\n\u305d\u306e\u7d50\u679c\u304c\u4ee5\u4e0b\u3067\u3059\u3002\u3069\u3069\u3093\u3002\n\nresult\n4 chains, each with iter=5000; warmup=2500; thin=1; \npost-warmup draws per chain=2500, total post-warmup draws=10000.\n\n            mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat\ntheta[Hon]    0.13    0.00 0.03    0.07    0.11    0.13    0.15    0.20  9373    1\ntheta[Umi]    0.07    0.00 0.02    0.03    0.05    0.07    0.08    0.12  8832    1\ntheta[Kot]    0.16    0.00 0.03    0.10    0.13    0.16    0.18    0.23  8972    1\ntheta[Mak]    0.09    0.00 0.03    0.04    0.07    0.09    0.11    0.15  8996    1\ntheta[Rin]    0.12    0.00 0.03    0.07    0.10    0.12    0.14    0.19  9289    1\ntheta[Han]    0.11    0.00 0.03    0.06    0.09    0.11    0.13    0.17  8948    1\ntheta[Nic]    0.14    0.00 0.03    0.08    0.12    0.14    0.16    0.21  8381    1\ntheta[Noz]    0.10    0.00 0.03    0.05    0.08    0.10    0.12    0.16  9182    1\ntheta[Eli]    0.09    0.00 0.03    0.04    0.07    0.09    0.11    0.15  8748    1\n\n\n\n\u6d77\u672a\u3061\u3083\u3093 (\u4e0a\u6bb5\u5de6) \u304c0.07\u4e2d\u5fc3\u3067\u82e5\u5e72\u4f4e\u3044\u304f\u3089\u3044\u3067\u3001\u4ed6\u306f\u5927\u4f530.1\u304b\u305d\u308c\u4ee5\u4e0a\u3067\u5927\u5dee\u306a\u3044\u611f\u3058\u3067\u3059\u306d\u3002\n\u3061\u306a\u307f\u306b\u30c8\u30c3\u30d7\u306f\u3053\u3068\u308a\u3061\u3083\u3093 (\u4e0a\u6bb5\u771f\u3093\u4e2d) \u3067\u3059\u304c\u30012\u4f4d\u306f\u6211\u3089\u304c\u306b\u3053\u3061\u3083\u3093 (\u4e2d\u6bb5\u53f3) \u306e\u3088\u3046\u3067\u3059\u306d\u3002\n\u307e\u3041\u306b\u3053\u3061\u3083\u3093\u306f\u304b\u308f\u3044\u3044\u3067\u3059\u304b\u3089\u3002\u3057\u3087\u3046\u304c\u306a\u3044\u3067\u3059\u306d\u3002\n\u3053\u3068\u306b\u3053\u3067\u3059\u306d\u3002\n\u3068\u306f\u3044\u3048\u3001\u3055\u3059\u304c \u03bc's \u3002\u5e73\u7b49\u306b\u611b\u3055\u308c\u3066\u308b\u3093\u3067\u3059\u306d (\u6d77\u672a\u3061\u3083\u3093\u306b\u306f\u76ee\u3092\u9038\u3089\u3057\u306a\u304c\u3089)\u3002\n\n\n\u7d50\u679c2\uff0e\u3069\u3093\u306a\u3084\u3064\u304c\u3069\u306e\u30b9\u30af\u30fc\u30eb\u30a2\u30a4\u30c9\u30eb\u3092\u9078\u629e\u3057\u3061\u3083\u3046\u3093\u3060\u308d\u3046\n\u3055\u3066\u304a\u5f85\u3061\u304b\u306d\u3001\u672c\u7a3f\u306e\u30e1\u30a4\u30f3\u3067\u3042\u308b\u500b\u4eba\u7279\u6027\u3068\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u9078\u597d\u306b\u95a2\u3059\u308b\u63a8\u5b9a\u3067\u3059\u3002\nK-1\u306e\u8a2d\u5b9a\u304cStan Reference Manual\u898b\u3066\u3082\u3046\u307e\u304f\u56de\u3089\u3093\u304f\u3066\u82e6\u6226\u3057\u307e\u3057\u305f\u304c\u3001\u306a\u3093\u3068\u304b\u306a\u308a\u307e\u3057\u305f\u3002\nStan\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\nsimple_mlogi.stan\ndata {\n  int<lower=1> N;  // \u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\n  int<lower=1> P;  // \u8aac\u660e\u5909\u6570\u306e\u6570\n  int<lower=1> K;  // \u30bf\u30fc\u30b2\u30c3\u30c8\u30ab\u30c6\u30b4\u30ea\u30fc\u6570\uff1a9\u4eba\u3084\u3001\u30a6\u30c1\u3092\u5165\u308c\u3066\uff01\n  int<lower=1, upper=K> y[N]; // \u76ee\u7684\u5909\u6570\n  vector[P] x[N]; // \u8aac\u660e\u5909\u6570\n}\nparameters {\n  matrix[K-1, P] beta_raw;\n}\ntransformed parameters {\n\n  matrix[K, P] beta;  // K-1 handling\n\n  // beta K-1 handling\n  for (k in 1:(K-1))\n    beta[k] = beta_raw[k];\n  beta = append_row(beta_raw, rep_row_vector(0, P));  //0\u3092\u9811\u5f35\u3063\u3066\u4f5c\u3063\u3066\u5408\u4f53\u3055\u305b\u308b\n}\nmodel {\n\n  for (k in 1:(K-1))\n    beta_raw[k] ~ normal(0, 5);\n\n  for (i in 1:N)\n    y[i] ~ categorical(softmax(beta * x[i])); // categorical_logit\u3067\u3082\u4ee3\u7528\u53ef\u80fd\n}\n\n\n\u307b\u3093\u3067R\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nmlogit.r\n\n#K-1!!\u3067\u304d\u305f\uff01\uff01\nKmodel <- stan_model(file='simple_mlogi.stan')\n\nfit2 <- sampling(Kmodel,data=list(N=nrow(d), P=7, K=9, y=d$muse,\n                                  x=cbind(rep(1,nrow(d)),((d[,14:18])/14),(d[,2]))),iter=5000)\nprint(fit2,pars=c(\"beta\"))\n\n\n\u305d\u306e\u7d50\u679c\u304c\u4ee5\u4e0b\u3067\u3059\u3002\n\u203bB = \u5207\u7247\u3001Ex = \u5916\u5411\u6027\u3001Ag = \u5354\u8abf\u6027\u3001Co = \u52e4\u52c9\u6027\u3001Ne = \u795e\u7d4c\u75c7\u50be\u5411\u3001Op = \u7d4c\u9a13\u3078\u306e\u958b\u653e\u3001sex = \u6027\u5225 (0 = \u5973, 1 = \u7537)\u306e\u56de\u5e30\u4fc2\u6570\n\nresult\n4 chains, each with iter=5000; warmup=2500; thin=1; \npost-warmup draws per chain=2500, total post-warmup draws=10000.\n\n              mean se_mean  sd   2.5%   25%   50%   75% 97.5% n_eff Rhat\nbeta[Umi,B ]  0.25    0.02 2.38 -4.55 -1.32  0.28  1.90  4.74 10000    1\nbeta[Umi,Ex] -2.07    0.02 2.49 -7.13 -3.71 -2.00 -0.35  2.62 10000    1\nbeta[Umi,Ag] -0.79    0.03 2.98 -6.84 -2.78 -0.75  1.25  4.92 10000    1\nbeta[Umi,Co] -0.39    0.02 2.50 -5.40 -2.05 -0.36  1.29  4.37 10000    1\nbeta[Umi,Ne] -0.75    0.02 2.31 -5.23 -2.33 -0.76  0.82  3.80 10000    1\nbeta[Umi,Op]  0.40    0.02 2.49 -4.47 -1.24  0.41  2.07  5.23 10000    1\nbeta[Umi,sex]  0.91    0.01 1.13 -1.23  0.15  0.88  1.63  3.23 10000    1\nbeta[Kot,B ] -1.06    0.02 1.98 -4.92 -2.39 -1.05  0.25  2.84  7798    1\nbeta[Kot,Ex]  2.31    0.02 1.93 -1.43  1.00  2.27  3.62  6.12 10000    1\nbeta[Kot,Ag]  2.42    0.02 2.14 -1.74  0.99  2.41  3.84  6.62 10000    1\nbeta[Kot,Co] -0.71    0.02 2.00 -4.61 -2.06 -0.67  0.66  3.13 10000    1\nbeta[Kot,Ne] -0.22    0.02 1.78 -3.76 -1.40 -0.22  0.95  3.29 10000    1\nbeta[Kot,Op]  0.00    0.02 1.98 -3.82 -1.33  0.01  1.36  3.89 10000    1\nbeta[Kot,sex] -2.28    0.01 1.03 -4.41 -2.94 -2.23 -1.58 -0.38 10000    1\nbeta[Mak,B ] -0.48    0.02 2.28 -4.99 -1.99 -0.47  1.03  4.03 10000    1\nbeta[Mak,Ex]  3.00    0.02 2.21 -1.24  1.47  2.99  4.52  7.39 10000    1\nbeta[Mak,Ag] -0.82    0.03 2.82 -6.52 -2.67 -0.78  1.06  4.66 10000    1\nbeta[Mak,Co] -1.21    0.02 2.37 -5.94 -2.79 -1.19  0.41  3.34 10000    1\nbeta[Mak,Ne] -0.17    0.02 2.10 -4.27 -1.59 -0.16  1.23  3.91 10000    1\nbeta[Mak,Op] -3.15    0.02 2.31 -7.74 -4.66 -3.15 -1.62  1.36 10000    1\nbeta[Mak,sex]  1.27    0.01 1.08 -0.76  0.55  1.25  1.96  3.50 10000    1\nbeta[Rin,B ] -0.93    0.02 2.13 -5.14 -2.35 -0.88  0.52  3.10 10000    1\nbeta[Rin,Ex] -0.08    0.02 2.02 -4.03 -1.45 -0.08  1.30  3.90 10000    1\nbeta[Rin,Ag] -0.29    0.02 2.45 -5.09 -1.98 -0.26  1.41  4.39 10000    1\nbeta[Rin,Co] -2.49    0.02 2.18 -6.80 -3.98 -2.47 -1.00  1.68 10000    1\nbeta[Rin,Ne]  2.15    0.02 1.97 -1.65  0.81  2.08  3.45  6.04 10000    1\nbeta[Rin,Op]  0.33    0.02 2.15 -3.88 -1.14  0.33  1.77  4.54 10000    1\nbeta[Rin,sex]  0.71    0.01 0.88 -0.99  0.12  0.71  1.29  2.48 10000    1\nbeta[Han,B ] -0.52    0.02 2.20 -4.97 -1.98 -0.51  0.96  3.79  8158    1\nbeta[Han,Ex] -2.14    0.02 2.20 -6.50 -3.62 -2.10 -0.62  2.03 10000    1\nbeta[Han,Ag]  1.55    0.02 2.42 -3.20 -0.08  1.58  3.20  6.28 10000    1\nbeta[Han,Co] -0.20    0.02 2.27 -4.71 -1.74 -0.16  1.32  4.24 10000    1\nbeta[Han,Ne]  1.64    0.02 2.03 -2.25  0.25  1.64  3.02  5.60 10000    1\nbeta[Han,Op] -0.46    0.02 2.23 -4.86 -1.95 -0.45  1.06  3.89 10000    1\nbeta[Han,sex] -0.28    0.01 0.92 -2.11 -0.89 -0.26  0.35  1.50 10000    1\nbeta[Nic,B ] -0.57    0.02 1.98 -4.51 -1.89 -0.57  0.78  3.23  7671    1\nbeta[Nic,Ex]  1.45    0.02 1.91 -2.28  0.16  1.44  2.72  5.23 10000    1\nbeta[Nic,Ag]  1.48    0.02 2.27 -3.01 -0.05  1.50  3.01  5.89 10000    1\nbeta[Nic,Co] -1.81    0.02 2.03 -5.86 -3.17 -1.80 -0.44  2.13 10000    1\nbeta[Nic,Ne] -0.03    0.02 1.82 -3.66 -1.24 -0.01  1.20  3.54 10000    1\nbeta[Nic,Op] -0.22    0.02 2.01 -4.20 -1.55 -0.21  1.14  3.63 10000    1\nbeta[Nic,sex]  0.14    0.01 0.85 -1.48 -0.42  0.13  0.70  1.83 10000    1\nbeta[Noz,B ] -2.61    0.03 2.31 -7.32 -4.10 -2.55 -1.04  1.79  8006    1\nbeta[Noz,Ex] -2.07    0.02 2.28 -6.68 -3.57 -2.00 -0.52  2.29 10000    1\nbeta[Noz,Ag]  3.32    0.02 2.47 -1.49  1.67  3.28  4.93  8.19 10000    1\nbeta[Noz,Co] -0.58    0.02 2.26 -5.07 -2.11 -0.55  0.95  3.79 10000    1\nbeta[Noz,Ne]  1.02    0.02 2.12 -3.15 -0.41  0.98  2.42  5.31 10000    1\nbeta[Noz,Op]  2.04    0.02 2.30 -2.46  0.50  2.05  3.53  6.66 10000    1\nbeta[Noz,sex]  0.29    0.01 0.94 -1.54 -0.36  0.30  0.93  2.15 10000    1\nbeta[Eli,B ]  0.17    0.02 2.28 -4.40 -1.35  0.21  1.71  4.56  8342    1\nbeta[Eli,Ex] -0.22    0.02 2.31 -4.73 -1.77 -0.22  1.32  4.35 10000    1\nbeta[Eli,Ag] -4.04    0.03 2.88 -9.81 -5.93 -3.98 -2.10  1.41 10000    1\nbeta[Eli,Co]  0.79    0.02 2.25 -3.62 -0.73  0.79  2.31  5.12 10000    1\nbeta[Eli,Ne]  0.70    0.02 2.07 -3.31 -0.69  0.66  2.09  4.87 10000    1\nbeta[Eli,Op]  0.84    0.02 2.27 -3.57 -0.70  0.83  2.36  5.26 10000    1\nbeta[Eli,sex] -0.65    0.01 0.99 -2.69 -1.29 -0.63  0.01  1.24 10000    1\nbeta[Hon,B ]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ex]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ag]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Co]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ne]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Op]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,sex]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\n\n\n\n\n\u3053\u3093\u306a\u306b\u305f\u304f\u3055\u3093\u3042\u308b\u4e8b\u5f8c\u5206\u5e03\u306e\u4e2d\u3067\u610f\u5473\u306e\u3042\u308b\u4fc2\u6570 (95%\u78ba\u4fe1\u533a\u9593\u306b\u6b63\u8ca0\u4e21\u65b9\u306e\u5024\u3092\u542b\u307e\u306a\u3044\u3082\u306e) \u306f\u306a\u3093\u3068\u3001beta[Kot,sex]\u306e\u3053\u3068\u308a\u3061\u3083\u3093\u306e\u307f\u3067\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u3061\u306a\u307f\u306b\u8ca0\u306e\u5024\u3067\u3057\u305f\u3002\n\u3064\u307e\u308a\u3001\u300c(\u7a42\u4e43\u679c\u3061\u3083\u3093\u3068\u6bd4\u3079\u3066)\u3053\u3068\u308a\u3061\u3083\u3093\u306f\u5973\u306e\u5b50\u306b\u611b\u3055\u308c\u3084\u3059\u3044\u300d \u3068\u3044\u3046\u7d50\u679c\u304c\u89b3\u5bdf\u3055\u308c\u307e\u3057\u305f\u3002\n\u305d\u3057\u3066\n\u300c\u306b\u3053\u3061\u3083\u3093\u3092\u597d\u304d\u306a\u4eba\u306f\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u3067\u3042\u308b\u300d\n\u3068\u3044\u3046\u4eee\u8aac\u306f\u3073\u3063\u304f\u308a\u3059\u308b\u304f\u3089\u3044\u652f\u6301\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u7d50\u679c\u306e\u304a\u307e\u3051. \u968e\u5c64\u30e2\u30c7\u30eb\n\u3053\u308c\u3082\u7d50\u679c\u304c\u51fa\u3066\u306a\u3044\u306e\u3067\u4eca\u5f8c\u5909\u91cf\u8981\u56e0\u3068\u304b\u3076\u3061\u3053\u3093\u3067\u307f\u305f\u3044Rstan\u30e6\u30fc\u30b6\u30fc\u3055\u3093\u306b\u5411\u3051\u3066\u4e00\u5fdc\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30fc\u30c9\u306f\u5e74\u9f62\u3092\u7121\u99c4\u306b\u5909\u91cf\u8981\u56e0\u306b\u7d44\u307f\u8fbc\u3093\u3067\u3044\u308b\u3082\u306e\u3067\u3059\u3002\u7d50\u679c\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\nhi_mlogi.stan\ndata {\n  int<lower=1> N;  // \u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\n  int<lower=1> P;  // \u8aac\u660e\u5909\u6570\u306e\u6570\n  int<lower=1> K;  // \u30ab\u30c6\u30b4\u30ea\u30fc\u6570\n  int<lower=0> n_age; //max\u5e74\u9f62\n  int<lower=1, upper=K> y[N];\n  vector[P] x[N];\n  int<lower=0,upper=n_age> age[N];\n}\nparameters {\n  matrix[K-1, P] beta_raw;\n  vector[n_age] a; //\u5909\u91cf\u8981\u56e0\uff08\u5207\u7247\uff09\n  real<lower=0,upper=100> sigma_a; //\u5909\u91cf\u8981\u56e0\u306e\u5206\u6563\n}\ntransformed parameters {\n\n  matrix[K, P] beta;  // K-1 handling\n\n  // beta K-1 handling\n  for (k in 1:(K-1))\n    beta[k] = beta_raw[k];\n  beta = append_row(beta_raw, rep_row_vector(0, P));  //\u304c\u3093\u3070\u308b\u3084\u3064\n}\nmodel {\n\n  for (k in 1:(K-1))\n    beta_raw[k] ~ normal(0, 5); \n\n  for (i in 1:N)\n    y[i] ~ categorical(softmax(beta * x[i]+a[age[i]]));\n  a ~ normal(0,sigma_a);\n}\n\n\n\n\u8003\u5bdf\n\u672c\u7a3f\u306b\u304a\u3044\u3066\u3001\u8ab0\u3092\u63a8\u3059\u304b\u3068\u3044\u3046\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u629e\u306b\u5916\u5411\u6027\u3084\u795e\u7d4c\u75c7\u50be\u5411\u306a\u3069\u306e\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u7279\u6027\u304c\u3069\u306e\u3088\u3046\u306b\u304b\u304b\u308f\u3063\u3066\u3044\u308b\u306e\u304b\u3002\n\u3068\u3044\u3046\u30ea\u30b5\u30fc\u30c1\u30af\u30a8\u30b9\u30c1\u30e7\u30f3\u306b\u5bfe\u3057\u3066\n\u3053\u3068\u308a\u3061\u3083\u3093\u3060\u3051\u306f\u8f9b\u3046\u3058\u3066\u5973\u306e\u5b50\u304b\u3089\u611b\u3055\u308c\u3084\u3059\u3044\u3088\u3046\u3060\u3002\n\u3068\u3044\u3046\u7d50\u8ad6\u304c\u5f97\u3089\u308c\u305f\u3002\u6027\u5225\u306f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u3058\u3083\u306d\u3048\u3002\n\u3053\u306e\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u8981\u56e0\u3068\u3057\u3066\u3001 \n$\u03bc's$ \u306e\u30e1\u30f3\u30d0\u30fc\u306f\u3069\u3093\u306a\u4eba\u9593\u306b\u3082\u611b\u3055\u308c\u308b\u3002\n\u3068\u3044\u3046\u7d50\u8ad6\u3082\u8003\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u3057\u304b\u3057\u3001\u672c\u7814\u7a76\u306e\u9650\u754c\u3068\u3057\u3066\u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\u304c\u591a\u304f\u306a\u3044\u3053\u3068\u3002\u305d\u3057\u3066\u3055\u3089\u306b\u91cd\u8981\u306a\u8981\u56e0\u3068\u3057\u3066\u3001\u56de\u7b54\u8005\u306e \u03bc's \u30e1\u30f3\u30d0\u30fc\u306b\u5bfe\u3059\u308b\u4e8b\u524d\u77e5\u8b58\u306b\u95a2\u3059\u308b\u9805\u76ee\u3092\u3068\u3063\u3066\u3044\u306a\u304b\u3063\u305f\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u308b\u3002\u5f53\u7136\u3001\u5f7c\u5973\u305f\u3061\u306e\u3053\u3068\u3092\u8a73\u3057\u304f\u77e5\u308b\u4eba\u7269\u3068\u305d\u3046\u3067\u306a\u3044\u4eba\u7269\u3067\u306f\u3001\u30dd\u30b9\u30bf\u30fc\u306b\u5bfe\u3059\u308b\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u9078\u629e\u306f\u7570\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u60f3\u5b9a\u3055\u308c\u308b\u3002\n\u305d\u3046\u3057\u305f\u65b0\u305f\u306a\u8981\u56e0\u30fb\u9805\u76ee\u3092\u542b\u3081\u305f\u3046\u3048\u3067\u518d\u5ea6\u691c\u8a0e\u3059\u308c\u3070\u3001\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u597d\u3068\u500b\u4eba\u7279\u6027\u306e\u95a2\u9023\u3092\u793a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\u4ee5\u4e0a\u3001Stan\u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u5206\u6790\u306e\u4e00\u4f8b\u3067\u3057\u305f\u3002\n\nEnjoy Stan and Love Live!!\n\n\u3053\u306e\u8a18\u4e8b\u306f[Stan Advent Calender](http://qiita.com/advent-calendar/2016/stan)\u306e18\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u3053\u308d\u3084\u6539\u5584\u70b9\u306a\u3069\u3054\u6307\u6458\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u30a2\u30cb\u30e1\u306b\u95a2\u3059\u308b\u30ad\u30e3\u30d7\u30c1\u30e3\u753b\u50cf\u306f\u3001\u672c\u7a3f\u5185\u5bb9\u306e\u7d39\u4ecb\u306b\u5fc5\u8981\u6700\u4f4e\u9650\u306a\u7bc4\u56f2\u3067\u4f7f\u7528\u3059\u308b\u3082\u306e\u3068\u3057\u3066\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\n\u52d5\u4f5c\u74b0\u5883\uff1aWindows, R3.3.1,Rstan2.11.1\n\n\u307f\u306a\u3055\u3093\u3053\u3093\u306b\u3061\u306f\u3002\u5bd2\u3044\u5b63\u7bc0\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3002\n\n\u4eca\u56de\u306fStan\u30a2\u30c9\u30ab\u30ec\u3067\u3082 ([\u4e00\u90e8](https://mrunadon.github.io/stanadvent2016/)\u3067) \u8a71\u984c\u306b\u306a\u3063\u3066\u3044\u308b\u3001\u307f\u3093\u306a\u5927\u597d\u304d\u30e9\u30d6\u30e9\u30a4\u30d6\uff01\u306e\u304a\u8a71\u3067\u3059\u3002\n\u30e9\u30d6\u30e9\u30a4\u30d6\u3068\u306f\uff1a\u300e\u30e9\u30d6\u30e9\u30a4\u30d6! School idol project\u300f\uff08\u30e9\u30d6\u30e9\u30a4\u30d6 \u30b9\u30af\u30fc\u30eb\u30a2\u30a4\u30c9\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3001\u901a\u79f0:\u30e9\u30d6\u30e9\u30a4\u30d6\uff09\u306f\u56fd\u7acb\u97f3\u30ce\u6728\u5742\u5b66\u9662\u3067\u7d50\u6210\u3055\u308c\u305f~~\u67b6\u7a7a\u306e~~\u30a2\u30a4\u30c9\u30eb\u30b0\u30eb\u30fc\u30d7\u306e\u596e\u95d8\u3068\u6210\u9577\u3092\u63cf\u304f\u65e5\u672c\u306e\u30e1\u30c7\u30a3\u30a2\u30df\u30c3\u30af\u30b9\u4f5c\u54c1\u7fa4 (\u30a2\u30f3\u30b5\u30a4\u30af\u30ed\u30da\u30c7\u30a3\u30a2\u3088\u308a)\u3002 \n\n\u305d\u3093\u306a\u30e9\u30d6\u30e9\u30a4\u30d6\u306e\u4eba\u6c17\u306f\u8870\u3048\u308b\u3068\u3053\u308d\u3092\u77e5\u3089\u305a\u3001\u30a2\u30cb\u30e1\u304c\u7d42\u308f\u3063\u305f\u4eca\u3082\u30ea\u30ba\u30e0\u30b2\u30fc\u30e0\u306e[\u30a2\u30fc\u30b1\u30fc\u30c9\u7248](http://www.lovelive-sifac.jp/)\u304c\u5168\u56fd\u306e\u30b2\u30fc\u30e0\u30bb\u30f3\u30bf\u30fc\u3067\u597d\u8a55\u7a3c\u50cd\u4e2d\u3089\u3057\u3044\u3067\u3059\u3088\uff01\u307f\u3093\u306a\u304a\u91d1\u6301\u3063\u3066\u30b2\u30fc\u30e0\u30bb\u30f3\u30bf\u30fc\u3078\u6025\u304e\u307e\u3057\u3087\u3046\uff01\n\n\u3055\u3066\u3055\u3066\u672c\u7a3f\u3067\u306f\u305d\u3093\u306a[\u30e9\u30d6\u30e9\u30a4\u30d6](http://www.lovelive-anime.jp/otonokizaka/)\u306b\u767b\u5834\u3059\u308b9\u4eba\u306e\u5973\u306e\u5b50\u306b\u5bfe\u3059\u308b\u9078\u597d\u3068\u9078\u629e\u3057\u305f\u4eba\u7269\u306e\u500b\u4eba\u7279\u6027\u306e\u95a2\u9023\u306b\u95a2\u3057\u3066\u3001Stan\u306b\u3088\u308b\u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u5206\u6790\u3092\u7528\u3044\u3066\u30d9\u30a4\u30ba\u63a8\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## \u7814\u7a76\u306e\u80cc\u666f\u305d\u306e1\n\n\u79c1\u306f\u53cb\u9054\u306b\u9023\u308c\u3089\u308c\u3066\u3001\u3053\u306e\u30a2\u30cb\u30e1\u306b\u51fa\u3066\u304f\u308b\u306b\u3053\u3061\u3083\u3093\u3068\u3088\u3070\u308c\u308b\u5b50\u3092\u521d\u3081\u3066\u898b\u305f\u3068\u304d\u306b\u601d\u3044\u307e\u3057\u305f\u3002\n![alt](http://articleimage.nicoblomaga.jp/image/217/2013/9/f/9ffcfdae888982f769555f6c7adafe3d0a6d003c1386672659.jpg)\n\n**\u300c\u3042\u3001\u3053\u308c\u306f\u597d\u304d\u306b\u306a\u308b\u308f\u300d**\n\u3068\u3002\n\n\u6848\u306e\u5b9a\u3001\u30a2\u30cb\u30e1\u306e\u4e2d\u306b\u5f7c\u5973\u304c\u51fa\u3066\u304d\u30662\u5206\u5f8c\u304f\u3089\u3044\u306b\u306f\u3059\u3050\u306b[\u306b\u3053\u63a8\u3057]\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u7121\u7406\u3082\u306a\u3044\u3053\u3068\u3067\u3059\u3002\u304b\u308f\u3044\u3044\u3067\u3059\u304b\u3089\u3002\n\n\u3067\u3059\u304c\u3001\u30e9\u30d6\u30e9\u30a4\u30d6\u306b\u51fa\u3066\u304f\u308b\u30ad\u30e3\u30e9\u30af\u30bf\u30fc(\u4ee5\u4e0b\u3001\u5f7c\u5973\u305f\u3061\u306e\u30e6\u30cb\u30c3\u30c8\u540d\u3067\u3042\u308b*\u03bc's*\u3068\u3057\u307e\u3059)\u306f\u3001\u3044\u305a\u308c\u3082\u3068\u3066\u3082\u304b\u308f\u3044\u3044\u5b50\u3070\u304b\u308a\u3067\u3059\u3002\n\n![alt](http://livedoor.4.blogimg.jp/anico_bin/imgs/e/6/e6ebad8d.jpg)\n\n\n\u305d\u3093\u306a*\u03bc's*\u306e\u4e2d\u3067\u3001**\u8ab0\u3092\u63a8\u3059\u304b\u3068\u3044\u3046\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u629e\u306b\u5916\u5411\u6027\u3084\u795e\u7d4c\u75c7\u50be\u5411\u306a\u3069\u306e\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u7279\u6027\u304c\u3069\u306e\u3088\u3046\u306b\u304b\u304b\u308f\u3063\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3002**\n\n\u3053\u308c\u304c\u308f\u304b\u308b\u3068\u3001**\u300c\u3042\u306a\u305f\u306f*\u03bc's*\u306e\u4e2d\u306e\u3060\u308c\u63a8\u3057\u3067\u3059\u304b\uff1f\u300d**\u3068\u3044\u3046\u8cea\u554f\u304c\u305d\u306e\u307e\u307e**\u300c\u3042\u306a\u305f\u306f\u3069\u3046\u3044\u3063\u305f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u3092\u304a\u6301\u3061\u3067\u3059\u304b\uff1f\u300d**\u3068\u3044\u3046\u8cea\u554f\u306b\u751f\u307e\u308c\u5909\u308f\u308b\u306e\u3060\uff01\u3053\u308c\u306f\u3059\u3054\u3044\uff01\u610f\u7fa9\u306b\u5bfe\u3059\u308b\u7591\u5ff5\u306e\u4f59\u5730\u306f\u306a\u3044\uff01\n\n\u3053\u308c\u307e\u3067\u306e\u5fc3\u7406\u5b66\u7684\u9818\u57df\u3067\u3001\u3082\u3063\u3068\u3082\u77e5\u898b\u306e\u7a4d\u307f\u91cd\u306d\u3089\u308c\u305f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u306e\u7279\u6027\u8ad6\u3067\u3042\u308b\u30d3\u30c3\u30b0\u30d5\u30a1\u30a4\u30d6\u306f\u3001\u4eba\u9593\u306e\u6301\u3064\u7279\u6027\u30925\u3064\u306e\u56e0\u5b50\u3067\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e5\u3064\u306e\u56e0\u5b50\u3068\u306f\u3001\u300c\u7d4c\u9a13\u3078\u306e\u958b\u653e\u6027\uff08O\uff09\u300d\u300c\u8aa0\u5b9f\u6027\uff08C\uff09\u300d\u300c\u5916\u5411\u6027\uff08E\uff09\u300d\u300c\u5354\u8abf\u6027\uff08A\uff09\u300d\u300c\u795e\u7d4c\u75c7\u50be\u5411\uff08N\uff09\u300d\u3067\u3059\u3002\n\n\u79c1\u306f\u305d\u3053\u305d\u3053\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u306a\u306e\u3067\u3001\n**\u300c\u306b\u3053\u3061\u3083\u3093\u3092\u597d\u304d\u306a\u4eba\u306f\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u3067\u3042\u308b\u300d**\n\u3068\u3044\u3046\u5927\u80c6\u306a\u4eee\u8aac\u3092\u7acb\u3066\u3066\u3001\u4ee5\u4e0b\u306e\u5206\u6790\u3092\u884c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n## \u7814\u7a76\u306e\u80cc\u666f\u305d\u306e2\n\nGoogle drive\u4f7f\u3063\u305f\u30cd\u30c3\u30c8\u8abf\u67fb\u3092\u3057\u3066\u307f\u305f\u304b\u3063\u305f\uff0b\u5b9f\u30c7\u30fc\u30bf\u3092\u7528\u3044\u305f\u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3092\u30d9\u30a4\u30ba\u3067\u3057\u3066\u307f\u305f\u304b\u3063\u305f\u3093\u3067\u3059\u3002\u3002\u3002\n\n## \u591a\u9805\u30ed\u30b8\u30b9\u30c6\u30a3\u30c3\u30af\u56de\u5e30\u3068\u306f\n\n*K* \u7a2e\u985e (\u3053\u3053\u3067\u306f*\u03bc's*\u306e\u6570:9\u4eba) \u306e\u540d\u7fa9\u5c3a\u5ea6\u306b\u3088\u308b\u76ee\u7684\u5909\u6570 *$y_n$* (\u8ab0\u3092\u9078\u629e\u3059\u308b\u304b) \u304c\u3001 *D* \u6b21\u5143\u306e\u8aac\u660e\u5909\u6570 *$x_n$* (\u3053\u3053\u3067\u3044\u3046Big Five\u3084\u6027\u5225\u306a\u3069) \u306b\u3088\u308a\u4e88\u6e2c\u3055\u308c\u308b\u56de\u5e30\u5f0f\u3067\u3042\u308b\u3002\u5f8c\u306e\u30b3\u30fc\u30c9\u306b\u51fa\u3066\u304f\u308bSoftmax\u95a2\u6570\u306e\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u306f[Stan Reference Manual](http://mc-stan.org/documentation/)\u306e386p\u8fba\u308a\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\u30bd\u30d5\u30c8\u30de\u30c3\u30af\u30b9\u56de\u5e30\u3068\u547c\u3070\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u56de\u5e30\u5206\u6790\u3067\u306f\u56de\u5e30\u4fc2\u6570\u304c\u4e0d\u78ba\u5b9f\u6027\u3092\u6301\u3064\u305f\u3081\u3001\u4e00\u3064\u306e\u53c2\u7167\u30ab\u30c6\u30b4\u30ea\u30fc $r$ \u306b $0$ \u306e\u5b9a\u6570\u3092\u7f6e\u304f\u3053\u3068\u3067\u76f8\u5bfe\u7684\u306a\u89e3\u91c8\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002 $r$ \u306b\u95a2\u3057\u3066\u3001 $\u03b2_D = 0$ \u3067\u3059\u306d\u3002\u8a73\u3057\u304f\u306f\u72ac4\u5339\u672c\u306a\u308a\u30b0\u30b0\u308b\u306a\u308a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4eca\u56de\u306e\u53c2\u7167\u30ab\u30c6\u30b4\u30ea\u30fc\u306b\u306f\u3001\u4e3b\u4eba\u516c\u3067\u3042\u308b\u7a42\u4e43\u679c\u3061\u3083\u3093\u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002 \n\n\n## \u65b9\u6cd5\n\u53c2\u52a0\u8005\u3000SNS\uff08twitter, line\uff09\u306a\u3069\u3092\u901a\u3057\u3066\u53ce\u96c6\u3057\u305f92\u540d (\u753744\u4eba\u3001\u597348\u4eba) \u306e\u53c2\u52a0\u8005\uff08\u3054\u5354\u529b\u3044\u305f\u3060\u3044\u305f\u7686\u69d8\u672c\u5f53\u306b\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\uff01\n\u8cea\u554f\u7d19\u3000\u65e5\u672c\u8a9e\u7248Ten Item Personality Inventory\uff08TIPI-J\uff1a\u5c0f\u5869\u4ed6, 2012\uff09\u306e\u8cea\u554f\u7d1910\u9805\u76ee\u3092\u4f7f\u7528\u3002Big Five\u3092\u6e2c\u5b9a\u3059\u308b\u8cea\u554f\u7d19\u3002\n\u624b\u7d9a\u304d\u3000\u53c2\u52a0\u8005\u306b\u306fGoogle form\u306b\u3066\u56de\u7b54\u3092\u3057\u3066\u3082\u3089\u3063\u305f\u3002\u307e\u305a\u5e74\u9f62\u3001\u6027\u5225\u3092\u56de\u7b54\u3057\u3066\u3082\u3089\u3044\u3001\u305d\u306e\u6b21\u306bTIPI-J\u3001\u6700\u5f8c\u306b *\u03bc\u2019s* 9\u4eba\u304c\u79fb\u3063\u305f\u30dd\u30b9\u30bf\u30fc\u306e\u4e2d\u304b\u3089\u4e00\u4eba\u3060\u3051\u597d\u307f\u306e\u5973\u306e\u5b50\u3092\u9078\u629e\u3057\u3066\u3082\u3089\u3063\u305f\u3002\n\n\n## \u7d50\u679c1. \u307e\u305a\u306f\u9078\u6319\u304b\u3089\u306f\u3058\u3081\u3088\u3046\u3002\n\u307e\u305a\u306f\u6700\u3082\u5f97\u7968\u6570\u304c\u591a\u304b\u3063\u305f\u306e\u306f\u8ab0\u306a\u306e\u304b\u3002\nRstan\u30e6\u30fc\u30b6\u30fc\u306a\u3089\u7121\u99c4\u306b\u4e8b\u5f8c\u5206\u5e03\u3067\u5831\u544a\u3057\u3088\u3046\u3058\u3083\u3042\u308a\u307e\u305b\u3093\u304b\u3002\n\n\u4ee5\u4e0b\u306f\u304f\u3063\u305d\u5358\u7d14\u306b\u9078\u629e\u7387\u3092\u7b97\u51fa\u3057\u305fStan\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\uff08\u4e8b\u5f8c\u5206\u5e03\u306e\u5dee\u5206\u3092\u6bd4\u8f03\u3057\u3088\u3046\u304b\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u6570\u304c\u591a\u304f\u3066\u9762\u5012\u3060\u3063\u305f\u306e\u3067\u5206\u5e03\u898b\u3066\u3069\u3046\u305e\u3063\u3066\u611f\u3058\u306b\u3057\u3066\u307e\u3059\u3002\n\u203b12/20\u4e8c\u9805\u5206\u5e03\u3067\u51fa\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u591a\u9805\u5206\u5e03\u3067\u7b97\u51fa\u3059\u308b\u30b3\u30fc\u30c9\u306b\u5909\u66f4\u3044\u305f\u3057\u307e\u3057\u305f\u3002\n\n```rstan:binom.stan\ndata{\n  int K; //\u5909\u6570\u306e\u6570\n  int D[K]; //\u751f\u8d77\u6570\n}\nparameters{\n  simplex[K] theta;\n}\nmodel{\n  D ~ multinomial(theta); \n}\n```\n\u307b\u3093\u3067R\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n```r:binom.r\n#muse\u306e\u8a71\nd <- read.table(\"clipboard\",header=T)\n\n#\u5408\u8a08\u5f97\u70b9\u306e\u4f5c\u6210 \u3053\u3053\u306e\u7121\u99c4\u611f\u534a\u7aef\u306a\u3044\u3067\u3059\u3002\nd <- mutate(d,Ex = 0)\nd <- mutate(d,Ag = 0)\nd <- mutate(d,Co = 0)\nd <- mutate(d,Ne = 0)\nd <- mutate(d,Op = 0)\nforeach(i = 1:nrow(d)) %do% {\n  d[i,14] <- sum(d[i,3]+8-d[i,8])\n  d[i,15] <- sum(d[i,4]+8-d[i,9])\n  d[i,16] <- sum(d[i,5]+8-d[i,10])\n  d[i,17] <- sum(d[i,6]+8-d[i,11])\n  d[i,18] <- sum(d[i,7]+8-d[i,12])\n}\n\n\n\n#\u6570\u3092\u6570\u3048\u308b\nm_n <- matrix(0,9,1)\nforeach(i = 1:9)%do%{\n  m_n[i,] <- as.integer(sum(d[,13] == i))\n}\n\nbimodel <- stan_model(file='bino.stan')\n\nfit <- sampling(bimodel,data=list(K=9, D=m_n[,1]),iter=5000)\n\nstan_hist(fit,pars=c(\"theta\"))\n```\n\n\u3061\u306a\u307f\u306b\u3053\u306eStan\u30b3\u30fc\u30c9\u306f\u5358\u7d14\u3059\u304e\u3066\u3001MCMC(*\u00b4\u0414\uff40)\u30cf\u30a2\u30cf\u30a2\u3068\u3046\u3061\u7d42\u308f\u308b\u3053\u308d\u306b\u306f\u89e3\u6790\u304c\u7d42\u4e86\u3057\u307e\u3059\u3002\n\u305d\u306e\u7d50\u679c\u304c\u4ee5\u4e0b\u3067\u3059\u3002\u3069\u3069\u3093\u3002\n\n```r:result\n4 chains, each with iter=5000; warmup=2500; thin=1; \npost-warmup draws per chain=2500, total post-warmup draws=10000.\n\n            mean se_mean   sd    2.5%     25%     50%     75%   97.5% n_eff Rhat\ntheta[Hon]    0.13    0.00 0.03    0.07    0.11    0.13    0.15    0.20  9373    1\ntheta[Umi]    0.07    0.00 0.02    0.03    0.05    0.07    0.08    0.12  8832    1\ntheta[Kot]    0.16    0.00 0.03    0.10    0.13    0.16    0.18    0.23  8972    1\ntheta[Mak]    0.09    0.00 0.03    0.04    0.07    0.09    0.11    0.15  8996    1\ntheta[Rin]    0.12    0.00 0.03    0.07    0.10    0.12    0.14    0.19  9289    1\ntheta[Han]    0.11    0.00 0.03    0.06    0.09    0.11    0.13    0.17  8948    1\ntheta[Nic]    0.14    0.00 0.03    0.08    0.12    0.14    0.16    0.21  8381    1\ntheta[Noz]    0.10    0.00 0.03    0.05    0.08    0.10    0.12    0.16  9182    1\ntheta[Eli]    0.09    0.00 0.03    0.04    0.07    0.09    0.11    0.15  8748    1\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/151882/bd523659-7342-23c7-3738-0934ba10b4e4.png)\n\n\u6d77\u672a\u3061\u3083\u3093 (\u4e0a\u6bb5\u5de6) \u304c0.07\u4e2d\u5fc3\u3067\u82e5\u5e72\u4f4e\u3044\u304f\u3089\u3044\u3067\u3001\u4ed6\u306f\u5927\u4f530.1\u304b\u305d\u308c\u4ee5\u4e0a\u3067\u5927\u5dee\u306a\u3044\u611f\u3058\u3067\u3059\u306d\u3002\n\u3061\u306a\u307f\u306b\u30c8\u30c3\u30d7\u306f\u3053\u3068\u308a\u3061\u3083\u3093 (\u4e0a\u6bb5\u771f\u3093\u4e2d) \u3067\u3059\u304c\u30012\u4f4d\u306f\u6211\u3089\u304c\u306b\u3053\u3061\u3083\u3093 (\u4e2d\u6bb5\u53f3) \u306e\u3088\u3046\u3067\u3059\u306d\u3002\n\u307e\u3041\u306b\u3053\u3061\u3083\u3093\u306f\u304b\u308f\u3044\u3044\u3067\u3059\u304b\u3089\u3002\u3057\u3087\u3046\u304c\u306a\u3044\u3067\u3059\u306d\u3002\n~~\u3053\u3068\u306b\u3053\u3067\u3059\u306d\u3002~~\n\n\u3068\u306f\u3044\u3048\u3001\u3055\u3059\u304c *\u03bc's* \u3002\u5e73\u7b49\u306b\u611b\u3055\u308c\u3066\u308b\u3093\u3067\u3059\u306d (\u6d77\u672a\u3061\u3083\u3093\u306b\u306f\u76ee\u3092\u9038\u3089\u3057\u306a\u304c\u3089)\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/151882/b473dfd0-61ee-655e-0204-39465e505caf.png)\n\n## \u7d50\u679c2\uff0e\u3069\u3093\u306a\u3084\u3064\u304c\u3069\u306e\u30b9\u30af\u30fc\u30eb\u30a2\u30a4\u30c9\u30eb\u3092\u9078\u629e\u3057\u3061\u3083\u3046\u3093\u3060\u308d\u3046\n\u3055\u3066\u304a\u5f85\u3061\u304b\u306d\u3001\u672c\u7a3f\u306e\u30e1\u30a4\u30f3\u3067\u3042\u308b\u500b\u4eba\u7279\u6027\u3068\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u9078\u597d\u306b\u95a2\u3059\u308b\u63a8\u5b9a\u3067\u3059\u3002\nK-1\u306e\u8a2d\u5b9a\u304cStan Reference Manual\u898b\u3066\u3082\u3046\u307e\u304f\u56de\u3089\u3093\u304f\u3066\u82e6\u6226\u3057\u307e\u3057\u305f\u304c\u3001\u306a\u3093\u3068\u304b\u306a\u308a\u307e\u3057\u305f\u3002\nStan\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n```rstan:simple_mlogi.stan\ndata {\n  int<lower=1> N;  // \u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\n  int<lower=1> P;  // \u8aac\u660e\u5909\u6570\u306e\u6570\n  int<lower=1> K;  // \u30bf\u30fc\u30b2\u30c3\u30c8\u30ab\u30c6\u30b4\u30ea\u30fc\u6570\uff1a9\u4eba\u3084\u3001\u30a6\u30c1\u3092\u5165\u308c\u3066\uff01\n  int<lower=1, upper=K> y[N]; // \u76ee\u7684\u5909\u6570\n  vector[P] x[N]; // \u8aac\u660e\u5909\u6570\n}\nparameters {\n  matrix[K-1, P] beta_raw;\n}\ntransformed parameters {\n\n  matrix[K, P] beta;  // K-1 handling\n\n  // beta K-1 handling\n  for (k in 1:(K-1))\n    beta[k] = beta_raw[k];\n  beta = append_row(beta_raw, rep_row_vector(0, P));  //0\u3092\u9811\u5f35\u3063\u3066\u4f5c\u3063\u3066\u5408\u4f53\u3055\u305b\u308b\n}\nmodel {\n\n  for (k in 1:(K-1))\n    beta_raw[k] ~ normal(0, 5);\n    \n  for (i in 1:N)\n    y[i] ~ categorical(softmax(beta * x[i])); // categorical_logit\u3067\u3082\u4ee3\u7528\u53ef\u80fd\n}\n```\n\n\u307b\u3093\u3067R\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n```r:mlogit.r\n\n#K-1!!\u3067\u304d\u305f\uff01\uff01\nKmodel <- stan_model(file='simple_mlogi.stan')\n\nfit2 <- sampling(Kmodel,data=list(N=nrow(d), P=7, K=9, y=d$muse,\n                                  x=cbind(rep(1,nrow(d)),((d[,14:18])/14),(d[,2]))),iter=5000)\nprint(fit2,pars=c(\"beta\"))\n```\n\n\u305d\u306e\u7d50\u679c\u304c\u4ee5\u4e0b\u3067\u3059\u3002\n*\u203bB = \u5207\u7247\u3001Ex = \u5916\u5411\u6027\u3001Ag = \u5354\u8abf\u6027\u3001Co = \u52e4\u52c9\u6027\u3001Ne = \u795e\u7d4c\u75c7\u50be\u5411\u3001Op = \u7d4c\u9a13\u3078\u306e\u958b\u653e\u3001sex = \u6027\u5225 (0 = \u5973, 1 = \u7537)\u306e\u56de\u5e30\u4fc2\u6570*\n\n```r:result\n4 chains, each with iter=5000; warmup=2500; thin=1; \npost-warmup draws per chain=2500, total post-warmup draws=10000.\n\n              mean se_mean  sd   2.5%   25%   50%   75% 97.5% n_eff Rhat\nbeta[Umi,B ]  0.25    0.02 2.38 -4.55 -1.32  0.28  1.90  4.74 10000    1\nbeta[Umi,Ex] -2.07    0.02 2.49 -7.13 -3.71 -2.00 -0.35  2.62 10000    1\nbeta[Umi,Ag] -0.79    0.03 2.98 -6.84 -2.78 -0.75  1.25  4.92 10000    1\nbeta[Umi,Co] -0.39    0.02 2.50 -5.40 -2.05 -0.36  1.29  4.37 10000    1\nbeta[Umi,Ne] -0.75    0.02 2.31 -5.23 -2.33 -0.76  0.82  3.80 10000    1\nbeta[Umi,Op]  0.40    0.02 2.49 -4.47 -1.24  0.41  2.07  5.23 10000    1\nbeta[Umi,sex]  0.91    0.01 1.13 -1.23  0.15  0.88  1.63  3.23 10000    1\nbeta[Kot,B ] -1.06    0.02 1.98 -4.92 -2.39 -1.05  0.25  2.84  7798    1\nbeta[Kot,Ex]  2.31    0.02 1.93 -1.43  1.00  2.27  3.62  6.12 10000    1\nbeta[Kot,Ag]  2.42    0.02 2.14 -1.74  0.99  2.41  3.84  6.62 10000    1\nbeta[Kot,Co] -0.71    0.02 2.00 -4.61 -2.06 -0.67  0.66  3.13 10000    1\nbeta[Kot,Ne] -0.22    0.02 1.78 -3.76 -1.40 -0.22  0.95  3.29 10000    1\nbeta[Kot,Op]  0.00    0.02 1.98 -3.82 -1.33  0.01  1.36  3.89 10000    1\nbeta[Kot,sex] -2.28    0.01 1.03 -4.41 -2.94 -2.23 -1.58 -0.38 10000    1\nbeta[Mak,B ] -0.48    0.02 2.28 -4.99 -1.99 -0.47  1.03  4.03 10000    1\nbeta[Mak,Ex]  3.00    0.02 2.21 -1.24  1.47  2.99  4.52  7.39 10000    1\nbeta[Mak,Ag] -0.82    0.03 2.82 -6.52 -2.67 -0.78  1.06  4.66 10000    1\nbeta[Mak,Co] -1.21    0.02 2.37 -5.94 -2.79 -1.19  0.41  3.34 10000    1\nbeta[Mak,Ne] -0.17    0.02 2.10 -4.27 -1.59 -0.16  1.23  3.91 10000    1\nbeta[Mak,Op] -3.15    0.02 2.31 -7.74 -4.66 -3.15 -1.62  1.36 10000    1\nbeta[Mak,sex]  1.27    0.01 1.08 -0.76  0.55  1.25  1.96  3.50 10000    1\nbeta[Rin,B ] -0.93    0.02 2.13 -5.14 -2.35 -0.88  0.52  3.10 10000    1\nbeta[Rin,Ex] -0.08    0.02 2.02 -4.03 -1.45 -0.08  1.30  3.90 10000    1\nbeta[Rin,Ag] -0.29    0.02 2.45 -5.09 -1.98 -0.26  1.41  4.39 10000    1\nbeta[Rin,Co] -2.49    0.02 2.18 -6.80 -3.98 -2.47 -1.00  1.68 10000    1\nbeta[Rin,Ne]  2.15    0.02 1.97 -1.65  0.81  2.08  3.45  6.04 10000    1\nbeta[Rin,Op]  0.33    0.02 2.15 -3.88 -1.14  0.33  1.77  4.54 10000    1\nbeta[Rin,sex]  0.71    0.01 0.88 -0.99  0.12  0.71  1.29  2.48 10000    1\nbeta[Han,B ] -0.52    0.02 2.20 -4.97 -1.98 -0.51  0.96  3.79  8158    1\nbeta[Han,Ex] -2.14    0.02 2.20 -6.50 -3.62 -2.10 -0.62  2.03 10000    1\nbeta[Han,Ag]  1.55    0.02 2.42 -3.20 -0.08  1.58  3.20  6.28 10000    1\nbeta[Han,Co] -0.20    0.02 2.27 -4.71 -1.74 -0.16  1.32  4.24 10000    1\nbeta[Han,Ne]  1.64    0.02 2.03 -2.25  0.25  1.64  3.02  5.60 10000    1\nbeta[Han,Op] -0.46    0.02 2.23 -4.86 -1.95 -0.45  1.06  3.89 10000    1\nbeta[Han,sex] -0.28    0.01 0.92 -2.11 -0.89 -0.26  0.35  1.50 10000    1\nbeta[Nic,B ] -0.57    0.02 1.98 -4.51 -1.89 -0.57  0.78  3.23  7671    1\nbeta[Nic,Ex]  1.45    0.02 1.91 -2.28  0.16  1.44  2.72  5.23 10000    1\nbeta[Nic,Ag]  1.48    0.02 2.27 -3.01 -0.05  1.50  3.01  5.89 10000    1\nbeta[Nic,Co] -1.81    0.02 2.03 -5.86 -3.17 -1.80 -0.44  2.13 10000    1\nbeta[Nic,Ne] -0.03    0.02 1.82 -3.66 -1.24 -0.01  1.20  3.54 10000    1\nbeta[Nic,Op] -0.22    0.02 2.01 -4.20 -1.55 -0.21  1.14  3.63 10000    1\nbeta[Nic,sex]  0.14    0.01 0.85 -1.48 -0.42  0.13  0.70  1.83 10000    1\nbeta[Noz,B ] -2.61    0.03 2.31 -7.32 -4.10 -2.55 -1.04  1.79  8006    1\nbeta[Noz,Ex] -2.07    0.02 2.28 -6.68 -3.57 -2.00 -0.52  2.29 10000    1\nbeta[Noz,Ag]  3.32    0.02 2.47 -1.49  1.67  3.28  4.93  8.19 10000    1\nbeta[Noz,Co] -0.58    0.02 2.26 -5.07 -2.11 -0.55  0.95  3.79 10000    1\nbeta[Noz,Ne]  1.02    0.02 2.12 -3.15 -0.41  0.98  2.42  5.31 10000    1\nbeta[Noz,Op]  2.04    0.02 2.30 -2.46  0.50  2.05  3.53  6.66 10000    1\nbeta[Noz,sex]  0.29    0.01 0.94 -1.54 -0.36  0.30  0.93  2.15 10000    1\nbeta[Eli,B ]  0.17    0.02 2.28 -4.40 -1.35  0.21  1.71  4.56  8342    1\nbeta[Eli,Ex] -0.22    0.02 2.31 -4.73 -1.77 -0.22  1.32  4.35 10000    1\nbeta[Eli,Ag] -4.04    0.03 2.88 -9.81 -5.93 -3.98 -2.10  1.41 10000    1\nbeta[Eli,Co]  0.79    0.02 2.25 -3.62 -0.73  0.79  2.31  5.12 10000    1\nbeta[Eli,Ne]  0.70    0.02 2.07 -3.31 -0.69  0.66  2.09  4.87 10000    1\nbeta[Eli,Op]  0.84    0.02 2.27 -3.57 -0.70  0.83  2.36  5.26 10000    1\nbeta[Eli,sex] -0.65    0.01 0.99 -2.69 -1.29 -0.63  0.01  1.24 10000    1\nbeta[Hon,B ]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ex]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ag]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Co]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Ne]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,Op]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\nbeta[Hon,sex]  0.00    0.00 0.00  0.00  0.00  0.00  0.00  0.00 10000  NaN\n\n```\n\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/151882/7932bf76-a8de-23a2-8d17-b27b0f54232b.png)\n\n\u3053\u3093\u306a\u306b\u305f\u304f\u3055\u3093\u3042\u308b\u4e8b\u5f8c\u5206\u5e03\u306e\u4e2d\u3067\u610f\u5473\u306e\u3042\u308b\u4fc2\u6570 (95%\u78ba\u4fe1\u533a\u9593\u306b\u6b63\u8ca0\u4e21\u65b9\u306e\u5024\u3092\u542b\u307e\u306a\u3044\u3082\u306e) \u306f\u306a\u3093\u3068\u3001beta[Kot,sex]\u306e\u3053\u3068\u308a\u3061\u3083\u3093\u306e\u307f\u3067\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u3061\u306a\u307f\u306b\u8ca0\u306e\u5024\u3067\u3057\u305f\u3002\n\n\u3064\u307e\u308a\u3001**\u300c(\u7a42\u4e43\u679c\u3061\u3083\u3093\u3068\u6bd4\u3079\u3066)\u3053\u3068\u308a\u3061\u3083\u3093\u306f\u5973\u306e\u5b50\u306b\u611b\u3055\u308c\u3084\u3059\u3044\u300d** \u3068\u3044\u3046\u7d50\u679c\u304c\u89b3\u5bdf\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u305d\u3057\u3066\n**\u300c\u306b\u3053\u3061\u3083\u3093\u3092\u597d\u304d\u306a\u4eba\u306f\u7d4c\u9a13\u306b\u958b\u653e\u7684\u304a\u3058\u3055\u3093\u3067\u3042\u308b\u300d**\n\u3068\u3044\u3046\u4eee\u8aac\u306f\u3073\u3063\u304f\u308a\u3059\u308b\u304f\u3089\u3044\u652f\u6301\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n## \u7d50\u679c\u306e\u304a\u307e\u3051. \u968e\u5c64\u30e2\u30c7\u30eb\n\n\u3053\u308c\u3082\u7d50\u679c\u304c\u51fa\u3066\u306a\u3044\u306e\u3067\u4eca\u5f8c\u5909\u91cf\u8981\u56e0\u3068\u304b\u3076\u3061\u3053\u3093\u3067\u307f\u305f\u3044Rstan\u30e6\u30fc\u30b6\u30fc\u3055\u3093\u306b\u5411\u3051\u3066\u4e00\u5fdc\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30fc\u30c9\u306f\u5e74\u9f62\u3092\u7121\u99c4\u306b\u5909\u91cf\u8981\u56e0\u306b\u7d44\u307f\u8fbc\u3093\u3067\u3044\u308b\u3082\u306e\u3067\u3059\u3002\u7d50\u679c\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n```rstan:hi_mlogi.stan\ndata {\n  int<lower=1> N;  // \u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\n  int<lower=1> P;  // \u8aac\u660e\u5909\u6570\u306e\u6570\n  int<lower=1> K;  // \u30ab\u30c6\u30b4\u30ea\u30fc\u6570\n  int<lower=0> n_age; //max\u5e74\u9f62\n  int<lower=1, upper=K> y[N];\n  vector[P] x[N];\n  int<lower=0,upper=n_age> age[N];\n}\nparameters {\n  matrix[K-1, P] beta_raw;\n  vector[n_age] a; //\u5909\u91cf\u8981\u56e0\uff08\u5207\u7247\uff09\n  real<lower=0,upper=100> sigma_a; //\u5909\u91cf\u8981\u56e0\u306e\u5206\u6563\n}\ntransformed parameters {\n\n  matrix[K, P] beta;  // K-1 handling\n\n  // beta K-1 handling\n  for (k in 1:(K-1))\n    beta[k] = beta_raw[k];\n  beta = append_row(beta_raw, rep_row_vector(0, P));  //\u304c\u3093\u3070\u308b\u3084\u3064\n}\nmodel {\n\n  for (k in 1:(K-1))\n    beta_raw[k] ~ normal(0, 5); \n    \n  for (i in 1:N)\n    y[i] ~ categorical(softmax(beta * x[i]+a[age[i]]));\n  a ~ normal(0,sigma_a);\n}\n```\n\n## \u8003\u5bdf\n\n\u672c\u7a3f\u306b\u304a\u3044\u3066\u3001**\u8ab0\u3092\u63a8\u3059\u304b\u3068\u3044\u3046\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u629e\u306b\u5916\u5411\u6027\u3084\u795e\u7d4c\u75c7\u50be\u5411\u306a\u3069\u306e\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u7279\u6027\u304c\u3069\u306e\u3088\u3046\u306b\u304b\u304b\u308f\u3063\u3066\u3044\u308b\u306e\u304b\u3002**\n\u3068\u3044\u3046\u30ea\u30b5\u30fc\u30c1\u30af\u30a8\u30b9\u30c1\u30e7\u30f3\u306b\u5bfe\u3057\u3066\n**\u3053\u3068\u308a\u3061\u3083\u3093\u3060\u3051\u306f\u8f9b\u3046\u3058\u3066\u5973\u306e\u5b50\u304b\u3089\u611b\u3055\u308c\u3084\u3059\u3044\u3088\u3046\u3060\u3002**\n\u3068\u3044\u3046\u7d50\u8ad6\u304c\u5f97\u3089\u308c\u305f\u3002\u6027\u5225\u306f\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u3058\u3083\u306d\u3048\u3002\n\n\u3053\u306e\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u8981\u56e0\u3068\u3057\u3066\u3001 \n**$\u03bc's$ \u306e\u30e1\u30f3\u30d0\u30fc\u306f\u3069\u3093\u306a\u4eba\u9593\u306b\u3082\u611b\u3055\u308c\u308b\u3002**\n\n\u3068\u3044\u3046\u7d50\u8ad6\u3082\u8003\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u3057\u304b\u3057\u3001\u672c\u7814\u7a76\u306e\u9650\u754c\u3068\u3057\u3066\u30b5\u30f3\u30d7\u30eb\u30b5\u30a4\u30ba\u304c\u591a\u304f\u306a\u3044\u3053\u3068\u3002\u305d\u3057\u3066\u3055\u3089\u306b\u91cd\u8981\u306a\u8981\u56e0\u3068\u3057\u3066\u3001\u56de\u7b54\u8005\u306e *\u03bc's* \u30e1\u30f3\u30d0\u30fc\u306b\u5bfe\u3059\u308b\u4e8b\u524d\u77e5\u8b58\u306b\u95a2\u3059\u308b\u9805\u76ee\u3092\u3068\u3063\u3066\u3044\u306a\u304b\u3063\u305f\u3053\u3068\u304c\u6319\u3052\u3089\u308c\u308b\u3002\u5f53\u7136\u3001\u5f7c\u5973\u305f\u3061\u306e\u3053\u3068\u3092\u8a73\u3057\u304f\u77e5\u308b\u4eba\u7269\u3068\u305d\u3046\u3067\u306a\u3044\u4eba\u7269\u3067\u306f\u3001\u30dd\u30b9\u30bf\u30fc\u306b\u5bfe\u3059\u308b\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u9078\u629e\u306f\u7570\u306a\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u60f3\u5b9a\u3055\u308c\u308b\u3002\n\n\u305d\u3046\u3057\u305f\u65b0\u305f\u306a\u8981\u56e0\u30fb\u9805\u76ee\u3092\u542b\u3081\u305f\u3046\u3048\u3067\u518d\u5ea6\u691c\u8a0e\u3059\u308c\u3070\u3001\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u9078\u597d\u3068\u500b\u4eba\u7279\u6027\u306e\u95a2\u9023\u3092\u793a\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n\n\u4ee5\u4e0a\u3001Stan\u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u5206\u6790\u306e\u4e00\u4f8b\u3067\u3057\u305f\u3002\n\n### **Enjoy Stan and Love Live!!**\n", "tags": ["R", "Stan"]}