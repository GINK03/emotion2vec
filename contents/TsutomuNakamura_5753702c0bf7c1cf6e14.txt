{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u4eca\u56de\u7d39\u4ecb\u3059\u308bOpenLDAP \u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u3057\u305f\u65b9\u6cd5\u306fSamba3 \u307e\u3067\u3067\u4e3b\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u305f\u65b9\u6cd5\u3067\u3001\u53e4\u3044\u3067\u3059\u3002\nSamba4 \u3092\u4f7f\u7528\u3057\u305fActive Directory \u306e\u65b9\u6cd5\u304c\u65e2\u306b\u51fa\u3066\u3044\u3066\u3001\u3053\u3061\u3089\u304c\u4eca\u5f8c\u306e\u4e3b\u6d41\u306b\u306a\u308b\u3068\u601d\u308f\u308c\u308b\u306e\u3067\u3001\u7279\u306b\u7406\u7531\u304c\u7121\u3044\u9650\u308a\u306f\u305d\u3061\u3089\u306e\u69cb\u7bc9\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n Samba4 \u3092\u4f7f\u7528\u3057\u305fKerberos \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306aSamba Active Directory \u3092\u69cb\u7bc9\u3059\u308b\n http://qiita.com/TsutomuNakamura/items/07bf2d01e61e316a2a00\n\n\u3053\u308c\u304b\u3089\u7d39\u4ecb\u3059\u308b\u65b9\u6cd5\u306f\u3069\u3046\u3057\u3066\u3082OpenLDAP \u3092\u4f7f\u7528\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u7b49\u306e\u7406\u7531\u304c\u3042\u308b\u5834\u5408\u306b\u69cb\u7bc9\u3059\u308b\u4ee5\u5916\u3001\u7279\u306b\u30e1\u30ea\u30c3\u30c8\u306f\u7121\u3044\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n\u69cb\u7bc9\u74b0\u5883\n\u4eca\u56de\u69cb\u7bc9\u3059\u308b\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\u4eca\u56de\u69cb\u7bc9\u3059\u308b\u74b0\u5883\n\n\n OS\n Debian 8 (jessie)\n\n\n Samba\n version 4.1.17\n\n\n Network Interface\n eth0\n\n\n IP\n 192.168.1.42\n\n\n \u5916\u90e8\u53c2\u7167DNS\n 8.8.8.8\n\n\n Domain\n MYSITE\n\n\n Host Name\n ldap\n\n\n domain component\n dc#mysite,dc=example,dccom\n\n\n Samba \u30b5\u30fc\u30d0\u306eFQDN\n ldap.mysite.example.com\n\n\n Samba client \u3068\u306a\u308bWindows\n Windows7 32bit Ultimate\n\n\n Windows \u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d\n workstation\n\n\n\n\nbindDN\u3001\u8a8d\u8a3c\u306b\u95a2\u3059\u308b\u5b9a\u7fa9\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\n\nbindDN \u8a8d\u8a3c\u306b\u95a2\u3059\u308b\u60c5\u5831\n\n\n bindDN or \u30e6\u30fc\u30b6\u540d\n \u30d1\u30b9\u30ef\u30fc\u30c9\n \u8aac\u660e\n\n\n cn#admin,cnconfig\n password\n olcDatabase#{0}config,cnconfig \u306e\u60c5\u5831\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306ebindDN \u60c5\u5831\n\n\n cn#Manager,dc=mysite,dc=example,dccom\n password2\n dc#mysite,dc=example,dccom \u306eManager\n\n\n uid#root,ou=Users,dc=mysite,dc=example,dccom\n pw-root\n smbldap-populate \u6642\u306b\u4f5c\u6210\u3055\u308c\u308b dn\n\n\n saburo-suzuki\n pw-saburo-suzuki\n Windows \u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\n\n\n\n\n\u4eca\u56de\u306f\u7279\u306b\u65ad\u308a\u304c\u306a\u3044\u9650\u308a\u3001Linux \u4e0a\u3067\u306froot \u30e6\u30fc\u30b6\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\ndebian \u3067\u4e8b\u524d\u306broot \u30e6\u30fc\u30b6\u306b\u306a\u3063\u3066\u304a\u304f\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nroot\n$ sudo apt-get install \n\n\n\u305d\u308c\u3067\u306f\u3001\u3053\u308c\u304b\u3089\u69cb\u7bc9\u4f5c\u696d\u3092\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nSamba, OpenLDAP \u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get update\n# apt-get install slapd ldap-utils libnss-ldap\n# apt-get install acl attr autoconf bison build-essential \\\n        debhelper dnsutils docbook-xml docbook-xsl flex gdb krb5-user \\\n        libacl1-dev libaio-dev libattr1-dev libblkid-dev libbsd-dev \\\n        libcap-dev libcups2-dev libgnutls28-dev libjson-perl \\\n        libldap2-dev libncurses5-dev libpam0g-dev libparse-yapp-perl \\\n        libpopt-dev libreadline-dev perl perl-modules pkg-config \\\n        python-all-dev python-dev python-dnspython python-crypto \\\n        xsltproc zlib1g-dev\n\n\n\nOpenLDAP \u306e\u8d77\u52d5\nOpenLDAP \u3092\u8d77\u52d5\u3057\u3001OS \u8d77\u52d5\u6642\u306b\u3082\u81ea\u52d5\u7684\u306b\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nOpenLDAP\u306e\u8d77\u52d5\n# service slapd start\n# update-rc.d slapd defaults\n\n\nOpenLDAP \u304c\u8d77\u52d5\u3057\u305f\u3089\u3001\u8a66\u3057\u306bldapsearch \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066OpenLDAP \u304b\u3089\u60c5\u5831\u304c\u5f15\u304d\u51fa\u305b\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nOpenLDAP\u306e\u8d77\u52d5\u78ba\u8a8d\n# ldapsearch -LLL -Y EXTERNAL -H ldapi:/// -b \"cn#config\" \"(olcDatabase*)\"\n\nSASL/EXTERNAL authentication started\nSASL username: gidNumber#0+uidNumber=0,cn=peercred,cn=external,cnauth\nSASL SSF: 0\ndn: olcDatabase#{-1}frontend,cnconfig\nobjectClass: olcDatabaseConfig\nobjectClass: olcFrontendConfig\n\n......\n\n   olcDbIndex: member,memberUid eq\n   olcDbMaxSize: 1073741824\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u60c5\u5831\u304c\u5f15\u304d\u51fa\u305b\u308c\u3070OK \u3067\u3059\u3002\n\n\"olcDatabase={0}config,cn=config\" \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\nconfig \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6a5f\u5bc6\u6027\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u306b\u4e8b\u524d\u306bslappasswd \u30b3\u30de\u30f3\u30c9\u3067\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\"password\"\u3068\u3044\u3046\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u6c42\u3081\u308b\u4f8b\n# slappasswd -s password\n{SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n\n\n\u6b21\u306b\u3001slappasswd \u30b3\u30de\u30f3\u30c9\u3067\u751f\u6210\u3057\u305f\u5024\u3092\"dn: olcDatabase#{0}config,cnconfig\" \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n\"dn\uff1aolcDatabase#{0}config,cnconfig\"\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// << '__EOF__'\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n__EOF__\n\n\n\nldapadd \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u767b\u9332\u51e6\u7406\u306b\u3064\u3044\u3066\nldapadd \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u6a19\u6e96\u5165\u529b\u304b\u3089\u5b9a\u7fa9\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u4e8b\u524d\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001\u305d\u308c\u3092ldapadd \u30b3\u30de\u30f3\u30c9\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\nset_config_rootpw.ldif\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n\n\nldapadd \u30b3\u30de\u30f3\u30c9\u3067\u5b9a\u7fa9\u3092\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u8aad\u307f\u8fbc\u3080\u5834\u5408\u306f-f \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066ldapadd\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// -f ./set_config_rootpw.ldif\n\n\n\u3053\u308c\u4ee5\u964d\u306e\u624b\u9806\u3067\u3082\u3001\u57fa\u672c\u7684\u306b\u306f\u6a19\u6e96\u5165\u529b\u304b\u3089\u8aad\u307f\u8fbc\u3080\u65b9\u6cd5\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nolcDatabase={0}config,cn=config \u306eolcRootDN \u3092\u8a2d\u5b9a\u3059\u308b\nolcDatabase#{0}config,cn=config \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306eDN \u3068\u3057\u3066\u3001cn=admin,cnconfig \u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ncn#admin,cnconfig\u3092\u8a2d\u5b9a\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// << '__EOF__'\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn#admin,cnconfig\n__EOF__\n\n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u78ba\u8a8d\n\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8a2d\u5b9a\u3067\u304d\u305f\u3089\u3001ldapsearch \u3067\u8a8d\u8a3c\u304c\u901a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nldapsearch\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u8a8d\u8a3c\u306e\u78ba\u8a8d\n# ldapsearch -LLL -D \"cn#admin,cn=config\" -w password -b \"olcDatabase={0}config,cn=config\" \"(olcDatabase*)\"\ndn: olcDatabase#{0}config,cnconfig\nobjectClass: olcDatabaseConfig\nolcDatabase: {0}config\nolcAccess: {0}to * by dn.exact#gidNumber=0+uidNumber=0,cn=peercred,cnexternal\n ,cn=auth manage by * break\n olcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n olcRootDN: cn#admin,cnconfig\n\n# echo $?\n0\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u60c5\u5831\u304c\u5f15\u3051\u3066\u3001\u623b\u308a\u5024\u304c0 \u3067\u3042\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n\u30b9\u30ad\u30fc\u30de\u306e\u767b\u9332\n\u203b\u30b9\u30ad\u30fc\u30de\u306e\u767b\u9332\u306f\u3001\u4eca\u56de\u81ea\u5206\u304c\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f\u4e0d\u8981\u3067\u3057\u305f\nSamba \u306e\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b\u4e0a\u3067\u5fc5\u8981\u306b\u306a\u308b\u4f9d\u5b58\u30b9\u30ad\u30fc\u30de\u3092\u53d6\u308a\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\n\u30b9\u30ad\u30fc\u30de\u306e\u53d6\u308a\u8fbc\u307f\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/cosine.ldif\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/nis.ldif\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/inetorgperson.ldif\n\n\n\nBackend DB \u5468\u308a\u306e\u8a2d\u5b9a\nOpenLDAP \u306fBackend DB \u3068\u3057\u3066\u3001bdb, hdb, mdb \u306e\u3044\u305a\u308c\u304b\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u73fe\u5728\u306eOpenLDAP \u304c\u3069\u306eBackend DB\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u73fe\u5728\u4f7f\u308f\u308c\u3066\u3044\u308bBackend\u306e\u78ba\u8a8d\n# ldapsearch -LLL -Y EXTERNAL -H ldapi:/// -D \"cn#config\" -b \"cn=config\" 2>/dev/null | egrep --color 'olcDatabase=\\{[0-9]\\}(b|h|m)db,cnconfig'\ndn: olcDatabase#{1}mdb,cnconfig\n\n\n\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001OpenLDAP \u306fmdb \u3092\u4f7f\u7528\u3057\u3066\u304a\u308a\u3001\u30b7\u30fc\u30b1\u30f3\u30b91 ({1}mdb) \u3068\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e\u60c5\u5831\u3092\u5143\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bOpenLDAP \u306b\u60c5\u5831\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\nBackendDB\u5468\u308a\u306e\u8a2d\u5b9a\n# slappasswd -s password2\n{SSHA}70j61M5q2NdnyP9j1LVP+K4H9aTxr1iw\n\n# ldapmodify -Y EXTERNAL -H ldapi:/// << '__EOF__'\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcSuffix\nolcSuffix: dc#mysite,dc=example,dccom\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn#Manager,dc=mysite,dc=example,dccom\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: {SSHA}70j61M5q2NdnyP9j1LVP+K4H9aTxr1iw\n\n__EOF__\n\n\n\nBase DN \u306e\u4f5c\u6210\nBase DN \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nBaseDN\u306e\u767b\u9332\nldapadd -x -D \"cn#Manager,dc=mysite,dc=example,dccom\" -w password2 << '__EOF__'\n\ndn: dc#mysite,dc=example,dccom\nobjectClass: dcObject\nobjectClass: organization\ndc: mysite\no: Example Inc.\n\n__EOF__\n\n\n\nhosts \u306e\u8a2d\u5b9a\n/etc/hosts \u30d5\u30a1\u30a4\u30eb\u306b\u81ea\u5206\u81ea\u8eab\u306eFQDN \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/hosts\n192.168.1.42    ldap.mysite.example.com\n\n\n\nSamba \u3067\u4f7f\u7528\u3059\u308b\u30d9\u30fc\u30b9\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b\nSamba \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bSamba \u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3082\u4e00\u7dd2\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nSamba \u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u306f\u901a\u5e38\u3001/usr/share/doc/samba \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nSamba\u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u7d22\n# find /usr/share/doc/samba -type f -regextype posix-extended -regex '.*/samba.ldif(.gz)?$'\n/usr/share/doc/samba/examples/LDAP/samba.ldif.gz\n\n\ndebian \u306e\u5834\u5408\u3001\"/usr/share/doc/samba/examples/LDAP/samba.ldif.gz\" \u304c\u8a72\u5f53\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u3092OpenLDAP \u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\nSamba\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b\n# gunzip -c /usr/share/doc/samba/examples/LDAP/samba.ldif.gz | ldapadd -Y EXTERNAL -H ldapi:///\n\n\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b\nOpenLDAP \u306e\u57fa\u672c\u60c5\u5831\u3068\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305fSamba \u30b9\u30ad\u30fc\u30de\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nSamba\u30b9\u30ad\u30fc\u30de\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b\n# ldapmodify -x -D \"cn#admin,cnconfig\" -w password << '__EOF__'\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcDbIndex\nolcDbIndex: objectClass eq,pres\nolcDbIndex: ou eq,pres,sub\nolcDbIndex: cn eq,pres,sub\nolcDbIndex: mail eq,pres,sub\nolcDbIndex: surname eq,pres,sub\nolcDbIndex: givenname eq,pres,sub\nolcDbIndex: member pres,eq\nolcDbIndex: uidNumber eq,pres\nolcDbIndex: gidNumber eq,pres\nolcDbIndex: loginShell eq,pres\nolcDbIndex: uid eq,pres,sub\nolcDbIndex: memberUid eq,pres,sub\nolcDbIndex: nisMapName eq,pres,sub\nolcDbIndex: nisMapEntry eq,pres,sub\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcDbIndex\nolcDbIndex: uniqueMember eq,pres\nolcDbIndex: sambaSID eq\nolcDbIndex: sambaPrimaryGroupSID eq\nolcDbIndex: sambaGroupType eq\nolcDbIndex: sambaSIDList eq\nolcDbIndex: sambaDomainName eq\nolcDbIndex: default sub\n__EOF__\n\n\n\nsmb.conf \u306e\u8a2d\u5b9a\nSamba \u306e\u30e1\u30a4\u30f3\u3068\u306a\u308b/etc/samba/smb.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u904e\u7a0b\u306f\u5272\u611b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u7de8\u96c6\u3057\u305f\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/etc/samba/smb.conf\n# egrep -v '(^#|^$)' /etc/samba/smb.conf\n\nroot@ldap:~# cat /etc/samba/smb.conf\n[global]\n        workgroup = MYSITE\n        netbios name = LDAP\n        server role = auto\n        deadtime = 10\n        log level = 1\n        log file = /var/log/samba/log.%m\n        max log size = 5000\n        debug pid = yes\n        debug uid = yes\n        syslog = 3\n        utmp = yes\n        security = user\n        domain logons = yes\n        os level = 64\n        logon path = \n        logon home = \n        logon drive = \n        logon script = \n        passdb backend = ldapsam:\"ldap://ldap.mysite.example.com/\"\n        ldap ssl = off\n        ldap admin dn # cn=Manager,dc=mysite,dc=example,dccom\n        ldap delete dn = no\n        ldap password sync = yes\n        ldap suffix # dc=mysite,dc=example,dccom\n        ldap user suffix # ouUsers\n        ldap group suffix # ouGroups\n        ldap machine suffix # ouComputers\n        ldap idmap suffix # ouIdmap\n        add user script = /usr/sbin/smbldap-useradd -m '%u' -t 1\n        rename user script = /usr/sbin/smbldap-usermod -r '%unew' '%uold'\n        delete user script = /usr/sbin/smbldap-userdel '%u'\n        set primary group script = /usr/sbin/smbldap-usermod -g '%g' '%u'\n        add group script = /usr/sbin/smbldap-groupadd -p '%g'\n        delete group script = /usr/sbin/smbldap-groupdel '%g'\n        add user to group script = /usr/sbin/smbldap-groupmod -m '%u' '%g'\n        delete user from group script = /usr/sbin/smbldap-groupmod -x '%u' '%g'\n        add machine script = /usr/sbin/smbldap-useradd -w '%u' -t 1\n        nt acl support = yes\n        socket options # TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF8192 SO_KEEPALIVE\n[NETLOGON]\n        path = /var/lib/samba/netlogon\n        browseable = no\n        share modes = no\n[PROFILES]\n        path = /var/lib/samba/profiles\n        browseable = no\n        writeable = yes\n        create mask = 0611\n        directory mask = 0700\n        profile acls = yes\n        csc policy = disable\n        map system = yes\n        map hidden = yes\n\n\n\nsmbldap_bind.conf \u306e\u8a2d\u5b9a\nSamba \u306ebind \u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n/etc/smbldap-tools/smbldap_bind.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u4f7f\u7528\u3057\u3066\u3044\u308b\u74b0\u5883\u3067\u306f\u898f\u5b9a\u306e\u5834\u6240\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u7f6e\u304b\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u7528\u610f\n# cp /usr/share/doc/smbldap-tools/examples/smbldap_bind.conf /etc/smbldap-tools/\n# chown root:root /etc/smbldap-tools/smbldap_bind.conf\n# chmod 600 /etc/smbldap-tools/smbldap_bind.conf\n\n\n\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u624b\u9806\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u3057\u305f\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/etc/smbldap-tools/smbldap_bind.conf\n# egrep -v '(^#|^$)' /etc/smbldap-tools/smbldap_bind.conf\nmasterDN#\"cn=Manager,dc=mysite,dc=example,dccom\"\nmasterPw=\"password2\"\n\n\n\nsmbldap-tools \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\n/etc/smbldap-tools/smbldap.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u4eca\u56de\u4f7f\u7528\u3057\u3066\u3044\u308bdebian \u3067\u306f\u898f\u5b9a\u306e\u5834\u6240\u306b\u3042\u3089\u304b\u3058\u3081\u7f6e\u304b\u308c\u3066\u3044\u306a\u3044\u30d0\u30e1\u3001sample \u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n# gunzip -c /usr/share/doc/smbldap-tools/examples/smbldap.conf.gz > /etc/smbldap-tools/smbldap.conf\n# chmod 644 /etc/smbldap-tools/smbldap.conf\n\n\nSID \u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u5f8c\u307b\u3069\u3053\u306e\u5024\u3092smbldap.conf \u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nSID\u306e\u53d6\u5f97\n# net getlocalsid\nSID for domain LDAP is: S-1-5-21-2871212629-2838730456-1868381876\n\n\n/etc/smbldap-tools/smbldap.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u3044\u304d\u307e\u3059\u304c\u3001\u7d30\u304b\u3044\u624b\u9806\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u5f8c\u306e\u5404\u5024\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/etc/smbldap-tools/smbldap.conf\u5b9a\u7fa9\u5185\u5bb9\nSID=\"S-1-5-21-2871212629-2838730456-1868381876\"\nsambaDomain=\"MYSITE\"\nmasterLDAP=\"ldap://ldap.mysite.example.com/\"\nldapTLS=\"0\"\nverify=\"none\"\ncafile=\"/etc/smbldap-tools/ca.pem\"\nclientcert=\"/etc/smbldap-tools/smbldap-tools.example.com.pem\"\nclientkey=\"/etc/smbldap-tools/smbldap-tools.example.com.key\"\nsuffix#\"dc=mysite,dc=example,dccom\"\nusersdn#\"ouUsers,${suffix}\"\ncomputersdn#\"ouComputers,${suffix}\"\ngroupsdn#\"ouGroups,${suffix}\"\nidmapdn#\"ouIdmap,${suffix}\"\nsambaUnixIdPooldn#\"sambaDomainName${sambaDomain},${suffix}\"\nscope=\"sub\"\npassword_hash=\"SSHA\"\npassword_crypt_salt_format=\"%s\"\nuserLoginShell=\"/bin/bash\"\nuserHome=\"/home/%U\"\nuserHomeDirectoryMode=\"700\"\nuserGecos=\"System User\"\ndefaultUserGid=\"513\"\ndefaultComputerGid=\"515\"\nskeletonDir=\"/etc/skel\"\nshadowAccount=\"1\"\ndefaultMaxPasswordAge=\"45\"\nuserSmbHome=\"\\\\PDC-SRV\\%U\"\nuserProfile=\"\\\\PDC-SRV\\profiles\\%U\"\nuserHomeDrive=\"H:\"\nuserScript=\"logon.bat\"\nmailDomain=\"mysite.example.com\"\nwith_smbpasswd=\"0\"\nsmbpasswd=\"/usr/bin/smbpasswd\"\nwith_slappasswd=\"0\"\nslappasswd=\"/usr/sbin/slappasswd\"\n\n\n\nsmbldap-populate \u3092\u4f7f\u7528\u3057\u3066OpenLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u751f\u6210\u3059\u308b\nsmbldap-populate \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066OpenLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# smbldap-populate\nPopulating LDAP directory for domain MYSITE (S-1-5-21-2871212629-2838730456-1868381876)\n(using builtin directory structure)\n\nentry dc#mysite,dc=example,dccom already exist. \nadding new entry: ou#Users,dc=mysite,dc=example,dccom\nadding new entry: ou#Groups,dc=mysite,dc=example,dccom\nadding new entry: ou#Computers,dc=mysite,dc=example,dccom\nadding new entry: ou#Idmap,dc=mysite,dc=example,dccom\nadding new entry: sambaDomainName#MYSITE,dc=mysite,dc=example,dccom\nadding new entry: uid#root,ou=Users,dc=mysite,dc=example,dccom\nadding new entry: uid#nobody,ou=Users,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Admins,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Users,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Guests,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Computers,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Administrators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Account Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Print Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Backup Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Replicators,ou=Groups,dc=mysite,dc=example,dccom\n\nPlease provide a password for the domain root: \nChanging UNIX and samba passwords for root\nNew password:           # <- \"pw-root\nRetype new password:    # <- \"pw-root\n\nLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001smbd \u3068nmbd \u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nsmbd\u3068nmbd\u3092\u518d\u8d77\u52d5\u3059\u308b\n# service smbd restart\n# update-rc.d smbd defaults\n# service nmbd restart\n# update-rc.d nmbd defaults\n\n\n\nSamba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\nSamba \u306e\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u306e\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\n\u73fe\u5728\u306eSamba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u306e\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u78ba\u8a8d\n# net groupmap list\nReplicators (S-1-5-32-552) -> 552\nDomain Users (S-1-5-21-2871212629-2838730456-1868381876-513) -> 513\nDomain Admins (S-1-5-21-2871212629-2838730456-1868381876-512) -> 512\nDomain Guests (S-1-5-21-2871212629-2838730456-1868381876-514) -> 514\nAdministrators (S-1-5-32-544) -> 544\nPrint Operators (S-1-5-32-550) -> 550\nBackup Operators (S-1-5-32-551) -> 551\nDomain Computers (S-1-5-21-2871212629-2838730456-1868381876-515) -> 515\nAccount Operators (S-1-5-32-548) -> 548\n\n\n\u4e0a\u8a18\u306e\u51fa\u529b\u7d50\u679c\u3067\u306f\u3001\u3069\u306eSamba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3082Linux \u306e\u30b0\u30eb\u30fc\u30d7\u3068\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001Samba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u898f\u5247\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\nReplicators\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068smb_replicators\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n# groupadd -g 552 smb_replicators\n\n\n\u3053\u306e\u3088\u3046\u306b\u4ed6\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u3064\u3044\u3066\u3082\u540c\u69d8\u306b\u767b\u9332\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u4ed6\u306e\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n# groupadd -g 513 smb_domain_users\n# groupadd -g 512 smb_domain_admins\n# groupadd -g 514 smb_domain_guests\n# groupadd -g 544 smb_administrators\n# groupadd -g 550 smb_print_operators\n# groupadd -g 551 smb_backup_operators\n# groupadd -g 515 smb_domain_computers\n# groupadd -g 548 smb_account_operators\n\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306e\u7d50\u679c\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u78ba\u8a8d\n# net groupmap list\nReplicators (S-1-5-32-552) -> smb_replicators\nDomain Users (S-1-5-21-2871212629-2838730456-1868381876-513) -> smb_domain_users\nDomain Admins (S-1-5-21-2871212629-2838730456-1868381876-512) -> smb_domain_admins\nDomain Guests (S-1-5-21-2871212629-2838730456-1868381876-514) -> smb_domain_guests\nAdministrators (S-1-5-32-544) -> smb_administrators\nPrint Operators (S-1-5-32-550) -> smb_print_operators\nBackup Operators (S-1-5-32-551) -> smb_backup_operators\nDomain Computers (S-1-5-21-2871212629-2838730456-1868381876-515) -> smb_domain_computers\nAccount Operators (S-1-5-32-548) -> smb_account_operators\n\n\n\n\u30e6\u30fc\u30b6\u306e\u767b\u9332\nWindows \u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001Windows \u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3092Linux \u30e6\u30fc\u30b6\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d\u3092\u767b\u9332\u3059\u308b\u5834\u5408\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d\u306e\u6700\u5f8c\u306b\"$\" \u3092\u3064\u3051\u3066\u767b\u9332\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nWindows\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u306e\u767b\u9332\n# useradd -M -g smb_domain_computers -s /bin/false workstation$\n\n\n\u6b21\u306b\u3001\u305d\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\u30e6\u30fc\u30b6\u306e\u767b\u9332\n# useradd -M saburo-suzuki\n# smbldap-useradd -a -G 'Domain Users' -m -s /bin/bash -d /home/saburo-suzuki -F \"\" -P saburo-suzuki\nChanging UNIX and samba passwords for saburo-suzuki\nNew password:            # <- pw-saburo-suzuki\nRetype new password:     # <- pw-saburo-suzuki\n\n# smbpasswd -e saburo-suzuki\nEnabled user saburo-suzuki.\n\n\n\u30c9\u30e1\u30a4\u30f3\u306b\u30de\u30b7\u30f3\u3092\u53c2\u52a0\u3055\u305b\u308b\u6a29\u5229\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n\u30de\u30b7\u30f3\u306e\u8ffd\u52a0\n# net sam rights grant saburo-suzuki SeMachineAccountPrivilege\nGranted SeMachineAccountPrivilege to MYSITE\\saburo-suzuki\n\n\n\nWindows 7 \u3067\u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b\n\n\u30ec\u30b8\u30b9\u30c8\u30ea\u5024\u306e\u5909\u66f4\n\u65e2\u77e5\u306e\u554f\u984c\u3068\u3057\u3066\u3001Windows 7 \u3067\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u3092\u884c\u3046\u524d\u306b\u30ec\u30b8\u30b9\u30c8\u30ea\u5024\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nWindows 7 \u3067\"\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\" \u304b\u3089\"regedit\" \u3068\u5165\u529b\u3057\u3001\u30ec\u30b8\u30b9\u30c8\u30ea\u30a8\u30c7\u30a3\u30bf\u3092\u958b\u304d\u307e\u3059\u3002\n\u30ec\u30b8\u30b9\u30c8\u30ea\u30a8\u30c7\u30a3\u30bf\u304c\u958b\u3044\u305f\u3089\u3001\u4e0b\u8a18\u306e\u7528\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u5834\u6240:HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\LanmanWorkstation\\Parameters\n\n\n \u5909\u6570\n \u578b\n \u5024\n\n\n DNSNameResolutionRequired\n DWORD\n 0\n\n\n DomainCompatibilityMode\n DWORD\n 1\n\n\n\n\n\n\n\u30c9\u30e1\u30a4\u30f3\u3078\u306e\u53c2\u52a0\n\u203b\u4e00\u90e8\u82f1\u8a9e\u3068\u65e5\u672c\u8a9e\u306e\u8868\u8a18\u304c\u6df7\u3058\u3063\u3066\u3044\u307e\u3059\u3002\nWindows \u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089Computer \u3092\u53f3\u30af\u30ea\u30c3\u30af\u3057\u3001Properties \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\nSystem \u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u5de6\u5074\u306eAdvanced system settings \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\nSystem Properties \u30a6\u30a3\u30f3\u30c9\u30a6\u306eChange \u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n\nComputer Name/Domain Changes \u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u51fa\u3066\u304d\u305f\u3089\u3001\u6b21\u306e\u56f3\u306e\u7528\u306bDomain \u306e\u30e9\u30b8\u30aa\u30dc\u30bf\u30f3\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001MYSITE \u3068\u5165\u529b\u3057\u3001OK \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u3059\u308b\u3068\u3001\u8a8d\u8a3c\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9(saburo-suzuki/pw-saburo-suzuki)\u3092\u5165\u529b\u3057\u3066OK \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u3057\u3070\u3089\u304f\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6210\u529f\u306e\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u73fe\u3057\u3066\u304f\u308c\u3070\u8a8d\u8a3c\u6210\u529f\u3067\u3059\u3002\n\n\u8a8d\u8a3c\u306b\u6210\u529f\u3059\u308b\u3068\u3001\u30de\u30b7\u30f3\u306e\u518d\u8d77\u52d5\u304c\u8981\u6c42\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u306b\u5f93\u3044\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3067\u306e\u30ed\u30b0\u30a4\u30f3\n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304d\u305f\u3089\u3001\"\u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\" -> \"\u305d\u306e\u4ed6\u306e\u30e6\u30fc\u30b6\" \u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b\"\u30c9\u30e1\u30a4\u30f3\u540d\\\u30e6\u30fc\u30b6\u540d\" \u3068\u3044\u3046\u5f62\u5f0f\u3067\u4e0a\u6bb5\u306b\u30e6\u30fc\u30b6\u540d\u3092\u5165\u529b\u3057\u3001\u305d\u306e\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4e0b\u6bb5\u306b\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u6b63\u5e38\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3089\u3001\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u30e6\u30fc\u30b6\u540d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002Domain \u30e6\u30fc\u30b6\u306e\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n> whoami\nmysite\\saburo-suzuki\n\n\n\n\u53c2\u8003\n\n Setup Samba Domain Controller with LDAP Backend in Ubuntu 13.04\n http://www.unixmen.com/setup-samba-domain-controller-with-openldap-backend-in-ubuntu-13-04/\n\n\n HostoForge\n https://www.howtoforge.com/centos-5.x-samba-domain-controller-with-ldap-backend\n\n\n Dependencies\n https://wiki.samba.org/index.php/Operating_system_requirements/Dependencies_-_Libraries_and_programs\n\n# \u306f\u3058\u3081\u306b \n\u4eca\u56de\u7d39\u4ecb\u3059\u308bOpenLDAP \u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306b\u3057\u305f\u65b9\u6cd5\u306fSamba3 \u307e\u3067\u3067\u4e3b\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u305f\u65b9\u6cd5\u3067\u3001\u53e4\u3044\u3067\u3059\u3002\nSamba4 \u3092\u4f7f\u7528\u3057\u305fActive Directory \u306e\u65b9\u6cd5\u304c\u65e2\u306b\u51fa\u3066\u3044\u3066\u3001\u3053\u3061\u3089\u304c\u4eca\u5f8c\u306e\u4e3b\u6d41\u306b\u306a\u308b\u3068\u601d\u308f\u308c\u308b\u306e\u3067\u3001\u7279\u306b\u7406\u7531\u304c\u7121\u3044\u9650\u308a\u306f\u305d\u3061\u3089\u306e\u69cb\u7bc9\u3092\u884c\u3046\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n<dl>\n  <dt> Samba4 \u3092\u4f7f\u7528\u3057\u305fKerberos \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306aSamba Active Directory \u3092\u69cb\u7bc9\u3059\u308b</dt>\n  <dd> http://qiita.com/TsutomuNakamura/items/07bf2d01e61e316a2a00</dd>\n</dl>\n\n\u3053\u308c\u304b\u3089\u7d39\u4ecb\u3059\u308b\u65b9\u6cd5\u306f\u3069\u3046\u3057\u3066\u3082OpenLDAP \u3092\u4f7f\u7528\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u7b49\u306e\u7406\u7531\u304c\u3042\u308b\u5834\u5408\u306b\u69cb\u7bc9\u3059\u308b\u4ee5\u5916\u3001\u7279\u306b\u30e1\u30ea\u30c3\u30c8\u306f\u7121\u3044\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n# \u69cb\u7bc9\u74b0\u5883 \n\u4eca\u56de\u69cb\u7bc9\u3059\u308b\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n* \u4eca\u56de\u69cb\u7bc9\u3059\u308b\u74b0\u5883\n<table><tbody>\n  <tr>\n    <th> OS</th>\n    <td> Debian 8 (jessie)</td>\n  </tr>\n  <tr>\n    <th> Samba</th>\n    <td> version 4.1.17</td>\n  </tr>\n  <tr>\n    <th> Network Interface</th>\n    <td> eth0</td>\n  </tr>\n  <tr>\n    <th> IP</th>\n    <td> 192.168.1.42</td>\n  </tr>\n  <tr>\n    <th> \u5916\u90e8\u53c2\u7167DNS</th>\n    <td> 8.8.8.8</td>\n  </tr>\n  <tr>\n    <th> Domain</th>\n    <td> MYSITE</td>\n  </tr>\n  <tr>\n    <th> Host Name</th>\n    <td> ldap</td>\n  </tr>\n  <tr>\n    <th> domain component</th>\n    <td> dc#mysite,dc=example,dccom</td>\n  </tr>\n  <tr>\n    <th> Samba \u30b5\u30fc\u30d0\u306eFQDN</th>\n    <td> ldap.mysite.example.com</td>\n  </tr>\n  <tr>\n    <th> Samba client \u3068\u306a\u308bWindows</th>\n    <td> Windows7 32bit Ultimate</td>\n  </tr>\n  <tr>\n    <th> Windows \u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d</th>\n    <td> workstation</td>\n  </tr>\n</tbody></table>\n\nbindDN\u3001\u8a8d\u8a3c\u306b\u95a2\u3059\u308b\u5b9a\u7fa9\u306f\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\n\n* bindDN \u8a8d\u8a3c\u306b\u95a2\u3059\u308b\u60c5\u5831\n<table><tbody>\n  </tr>\n  <tr>\n    <th> bindDN or \u30e6\u30fc\u30b6\u540d</th>\n    <th> \u30d1\u30b9\u30ef\u30fc\u30c9</th>\n    <th> \u8aac\u660e</th>\n  </tr>\n  <tr>\n    <td> cn#admin,cnconfig</td>\n    <td> password</td>\n    <td> olcDatabase#{0}config,cnconfig \u306e\u60c5\u5831\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306ebindDN \u60c5\u5831</td>\n  </tr>\n  <tr>\n    <td> cn#Manager,dc=mysite,dc=example,dccom</td>\n    <td> password2</td>\n    <td> dc#mysite,dc=example,dccom \u306eManager</td>\n  </tr>\n  <tr>\n    <td> uid#root,ou=Users,dc=mysite,dc=example,dccom</td>\n    <td> pw-root</td>\n    <td> smbldap-populate \u6642\u306b\u4f5c\u6210\u3055\u308c\u308b dn</td>\n  </tr>\n  <tr>\n    <td> saburo-suzuki</td>\n    <td> pw-saburo-suzuki</td>\n    <td> Windows \u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6</td>\n  </tr>\n</tbody></table>\n\n\u4eca\u56de\u306f\u7279\u306b\u65ad\u308a\u304c\u306a\u3044\u9650\u308a\u3001Linux \u4e0a\u3067\u306froot \u30e6\u30fc\u30b6\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\ndebian \u3067\u4e8b\u524d\u306broot \u30e6\u30fc\u30b6\u306b\u306a\u3063\u3066\u304a\u304f\u306b\u306f\u6b21\u306e\u3088\u3046\u306b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```text:root\n$ sudo apt-get install \n```\n\n\n\u305d\u308c\u3067\u306f\u3001\u3053\u308c\u304b\u3089\u69cb\u7bc9\u4f5c\u696d\u3092\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n# \u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \nSamba, OpenLDAP \u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n```text:\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get update\n# apt-get install slapd ldap-utils libnss-ldap\n# apt-get install acl attr autoconf bison build-essential \\\n        debhelper dnsutils docbook-xml docbook-xsl flex gdb krb5-user \\\n        libacl1-dev libaio-dev libattr1-dev libblkid-dev libbsd-dev \\\n        libcap-dev libcups2-dev libgnutls28-dev libjson-perl \\\n        libldap2-dev libncurses5-dev libpam0g-dev libparse-yapp-perl \\\n        libpopt-dev libreadline-dev perl perl-modules pkg-config \\\n        python-all-dev python-dev python-dnspython python-crypto \\\n        xsltproc zlib1g-dev\n```\n\n\n# OpenLDAP \u306e\u8d77\u52d5 \nOpenLDAP \u3092\u8d77\u52d5\u3057\u3001OS \u8d77\u52d5\u6642\u306b\u3082\u81ea\u52d5\u7684\u306b\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```text:OpenLDAP\u306e\u8d77\u52d5\n# service slapd start\n# update-rc.d slapd defaults\n```\n\n\nOpenLDAP \u304c\u8d77\u52d5\u3057\u305f\u3089\u3001\u8a66\u3057\u306bldapsearch \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066OpenLDAP \u304b\u3089\u60c5\u5831\u304c\u5f15\u304d\u51fa\u305b\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```text:OpenLDAP\u306e\u8d77\u52d5\u78ba\u8a8d\n# ldapsearch -LLL -Y EXTERNAL -H ldapi:/// -b \"cn#config\" \"(olcDatabase*)\"\n\nSASL/EXTERNAL authentication started\nSASL username: gidNumber#0+uidNumber=0,cn=peercred,cn=external,cnauth\nSASL SSF: 0\ndn: olcDatabase#{-1}frontend,cnconfig\nobjectClass: olcDatabaseConfig\nobjectClass: olcFrontendConfig\n\n......\n\n   olcDbIndex: member,memberUid eq\n   olcDbMaxSize: 1073741824\n```\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u60c5\u5831\u304c\u5f15\u304d\u51fa\u305b\u308c\u3070OK \u3067\u3059\u3002\n\n# \"olcDatabase={0}config,cn=config\" \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b \nconfig \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6a5f\u5bc6\u6027\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u306b\u4e8b\u524d\u306bslappasswd \u30b3\u30de\u30f3\u30c9\u3067\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u751f\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\n```text:\"password\"\u3068\u3044\u3046\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u6c42\u3081\u308b\u4f8b\n# slappasswd -s password\n{SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n```\n\n\n\u6b21\u306b\u3001slappasswd \u30b3\u30de\u30f3\u30c9\u3067\u751f\u6210\u3057\u305f\u5024\u3092\"dn: olcDatabase#{0}config,cnconfig\" \u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n\n```text:\"dn\uff1aolcDatabase#{0}config,cnconfig\"\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// << '__EOF__'\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n__EOF__\n```\n\n\n## ldapadd \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u767b\u9332\u51e6\u7406\u306b\u3064\u3044\u3066 \nldapadd \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u6a19\u6e96\u5165\u529b\u304b\u3089\u5b9a\u7fa9\u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u4e8b\u524d\u306b\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001\u305d\u308c\u3092ldapadd \u30b3\u30de\u30f3\u30c9\u306b\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n```text:set_config_rootpw.ldif\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nadd: olcRootPW\nolcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n```\n\n\nldapadd \u30b3\u30de\u30f3\u30c9\u3067\u5b9a\u7fa9\u3092\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u8aad\u307f\u8fbc\u3080\u5834\u5408\u306f`-f` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\n```text:\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066ldapadd\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// -f ./set_config_rootpw.ldif\n```\n\n\n\u3053\u308c\u4ee5\u964d\u306e\u624b\u9806\u3067\u3082\u3001\u57fa\u672c\u7684\u306b\u306f\u6a19\u6e96\u5165\u529b\u304b\u3089\u8aad\u307f\u8fbc\u3080\u65b9\u6cd5\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n# olcDatabase={0}config,cn=config \u306eolcRootDN \u3092\u8a2d\u5b9a\u3059\u308b \nolcDatabase#{0}config,cn=config \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306eDN \u3068\u3057\u3066\u3001cn=admin,cnconfig \u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\n```text:cn#admin,cnconfig\u3092\u8a2d\u5b9a\u3059\u308b\n# ldapadd -Y EXTERNAL -H ldapi:/// << '__EOF__'\ndn: olcDatabase#{0}config,cnconfig\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn#admin,cnconfig\n__EOF__\n```\n\n\n# \u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u78ba\u8a8d \n\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8a2d\u5b9a\u3067\u304d\u305f\u3089\u3001ldapsearch \u3067\u8a8d\u8a3c\u304c\u901a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n```text:ldapsearch\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u8a8d\u8a3c\u306e\u78ba\u8a8d\n# ldapsearch -LLL -D \"cn#admin,cn=config\" -w password -b \"olcDatabase={0}config,cn=config\" \"(olcDatabase*)\"\ndn: olcDatabase#{0}config,cnconfig\nobjectClass: olcDatabaseConfig\nolcDatabase: {0}config\nolcAccess: {0}to * by dn.exact#gidNumber=0+uidNumber=0,cn=peercred,cnexternal\n ,cn=auth manage by * break\n olcRootPW: {SSHA}fHARwUz9Ju7z9vYBDcnDt3rKONSxgLV6\n olcRootDN: cn#admin,cnconfig\n\n# echo $?\n0\n```\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u60c5\u5831\u304c\u5f15\u3051\u3066\u3001\u623b\u308a\u5024\u304c0 \u3067\u3042\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n# \u30b9\u30ad\u30fc\u30de\u306e\u767b\u9332 \n\u203b\u30b9\u30ad\u30fc\u30de\u306e\u767b\u9332\u306f\u3001\u4eca\u56de\u81ea\u5206\u304c\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f\u4e0d\u8981\u3067\u3057\u305f\nSamba \u306e\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b\u4e0a\u3067\u5fc5\u8981\u306b\u306a\u308b\u4f9d\u5b58\u30b9\u30ad\u30fc\u30de\u3092\u53d6\u308a\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\n\n```text:\u30b9\u30ad\u30fc\u30de\u306e\u53d6\u308a\u8fbc\u307f\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/cosine.ldif\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/nis.ldif\n# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/inetorgperson.ldif\n```\n\n\n# Backend DB \u5468\u308a\u306e\u8a2d\u5b9a \nOpenLDAP \u306fBackend DB \u3068\u3057\u3066\u3001bdb, hdb, mdb \u306e\u3044\u305a\u308c\u304b\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u73fe\u5728\u306eOpenLDAP \u304c\u3069\u306eBackend DB\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n```text:\u73fe\u5728\u4f7f\u308f\u308c\u3066\u3044\u308bBackend\u306e\u78ba\u8a8d\n# ldapsearch -LLL -Y EXTERNAL -H ldapi:/// -D \"cn#config\" -b \"cn=config\" 2>/dev/null | egrep --color 'olcDatabase=\\{[0-9]\\}(b|h|m)db,cnconfig'\ndn: olcDatabase#{1}mdb,cnconfig\n```\n\n\n\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001OpenLDAP \u306fmdb \u3092\u4f7f\u7528\u3057\u3066\u304a\u308a\u3001\u30b7\u30fc\u30b1\u30f3\u30b91 ({1}mdb) \u3068\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u306e\u60c5\u5831\u3092\u5143\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306bOpenLDAP \u306b\u60c5\u5831\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\n```text:BackendDB\u5468\u308a\u306e\u8a2d\u5b9a\n# slappasswd -s password2\n{SSHA}70j61M5q2NdnyP9j1LVP+K4H9aTxr1iw\n\n# ldapmodify -Y EXTERNAL -H ldapi:/// << '__EOF__'\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcSuffix\nolcSuffix: dc#mysite,dc=example,dccom\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcRootDN\nolcRootDN: cn#Manager,dc=mysite,dc=example,dccom\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcRootPW\nolcRootPW: {SSHA}70j61M5q2NdnyP9j1LVP+K4H9aTxr1iw\n\n__EOF__\n```\n\n\n# Base DN \u306e\u4f5c\u6210 \nBase DN \u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n```text:BaseDN\u306e\u767b\u9332\nldapadd -x -D \"cn#Manager,dc=mysite,dc=example,dccom\" -w password2 << '__EOF__'\n\ndn: dc#mysite,dc=example,dccom\nobjectClass: dcObject\nobjectClass: organization\ndc: mysite\no: Example Inc.\n\n__EOF__\n```\n\n\n# hosts \u306e\u8a2d\u5b9a \n/etc/hosts \u30d5\u30a1\u30a4\u30eb\u306b\u81ea\u5206\u81ea\u8eab\u306eFQDN \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\n```text:/etc/hosts\n192.168.1.42    ldap.mysite.example.com\n```\n\n\n# Samba \u3067\u4f7f\u7528\u3059\u308b\u30d9\u30fc\u30b9\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b \nSamba \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u6642\u306bSamba \u306e\u30b9\u30ad\u30fc\u30de\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u3082\u4e00\u7dd2\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nSamba \u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u306f\u901a\u5e38\u3001/usr/share/doc/samba \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n```text:Samba\u30b9\u30ad\u30fc\u30de\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u7d22\n# find /usr/share/doc/samba -type f -regextype posix-extended -regex '.*/samba.ldif(.gz)?$'\n/usr/share/doc/samba/examples/LDAP/samba.ldif.gz\n```\n\n\ndebian \u306e\u5834\u5408\u3001\"/usr/share/doc/samba/examples/LDAP/samba.ldif.gz\" \u304c\u8a72\u5f53\u3057\u307e\u3059\u3002\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u30b9\u30ad\u30fc\u30de\u3092OpenLDAP \u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\n\n```text:Samba\u30b9\u30ad\u30fc\u30de\u3092\u767b\u9332\u3059\u308b\n# gunzip -c /usr/share/doc/samba/examples/LDAP/samba.ldif.gz | ldapadd -Y EXTERNAL -H ldapi:///\n```\n\n\n# \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b \nOpenLDAP \u306e\u57fa\u672c\u60c5\u5831\u3068\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305fSamba \u30b9\u30ad\u30fc\u30de\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```text:Samba\u30b9\u30ad\u30fc\u30de\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b\n# ldapmodify -x -D \"cn#admin,cnconfig\" -w password << '__EOF__'\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcDbIndex\nolcDbIndex: objectClass eq,pres\nolcDbIndex: ou eq,pres,sub\nolcDbIndex: cn eq,pres,sub\nolcDbIndex: mail eq,pres,sub\nolcDbIndex: surname eq,pres,sub\nolcDbIndex: givenname eq,pres,sub\nolcDbIndex: member pres,eq\nolcDbIndex: uidNumber eq,pres\nolcDbIndex: gidNumber eq,pres\nolcDbIndex: loginShell eq,pres\nolcDbIndex: uid eq,pres,sub\nolcDbIndex: memberUid eq,pres,sub\nolcDbIndex: nisMapName eq,pres,sub\nolcDbIndex: nisMapEntry eq,pres,sub\n\ndn: olcDatabase#{1}mdb,cnconfig\nchangetype: modify\nreplace: olcDbIndex\nolcDbIndex: uniqueMember eq,pres\nolcDbIndex: sambaSID eq\nolcDbIndex: sambaPrimaryGroupSID eq\nolcDbIndex: sambaGroupType eq\nolcDbIndex: sambaSIDList eq\nolcDbIndex: sambaDomainName eq\nolcDbIndex: default sub\n__EOF__\n```\n\n\n# smb.conf \u306e\u8a2d\u5b9a \nSamba \u306e\u30e1\u30a4\u30f3\u3068\u306a\u308b/etc/samba/smb.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u904e\u7a0b\u306f\u5272\u611b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u7de8\u96c6\u3057\u305f\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```text:/etc/samba/smb.conf\n# egrep -v '(^#|^$)' /etc/samba/smb.conf\n\nroot@ldap:~# cat /etc/samba/smb.conf\n[global]\n        workgroup = MYSITE\n        netbios name = LDAP\n        server role = auto\n        deadtime = 10\n        log level = 1\n        log file = /var/log/samba/log.%m\n        max log size = 5000\n        debug pid = yes\n        debug uid = yes\n        syslog = 3\n        utmp = yes\n        security = user\n        domain logons = yes\n        os level = 64\n        logon path = \n        logon home = \n        logon drive = \n        logon script = \n        passdb backend = ldapsam:\"ldap://ldap.mysite.example.com/\"\n        ldap ssl = off\n        ldap admin dn # cn=Manager,dc=mysite,dc=example,dccom\n        ldap delete dn = no\n        ldap password sync = yes\n        ldap suffix # dc=mysite,dc=example,dccom\n        ldap user suffix # ouUsers\n        ldap group suffix # ouGroups\n        ldap machine suffix # ouComputers\n        ldap idmap suffix # ouIdmap\n        add user script = /usr/sbin/smbldap-useradd -m '%u' -t 1\n        rename user script = /usr/sbin/smbldap-usermod -r '%unew' '%uold'\n        delete user script = /usr/sbin/smbldap-userdel '%u'\n        set primary group script = /usr/sbin/smbldap-usermod -g '%g' '%u'\n        add group script = /usr/sbin/smbldap-groupadd -p '%g'\n        delete group script = /usr/sbin/smbldap-groupdel '%g'\n        add user to group script = /usr/sbin/smbldap-groupmod -m '%u' '%g'\n        delete user from group script = /usr/sbin/smbldap-groupmod -x '%u' '%g'\n        add machine script = /usr/sbin/smbldap-useradd -w '%u' -t 1\n        nt acl support = yes\n        socket options # TCP_NODELAY SO_RCVBUF=8192 SO_SNDBUF8192 SO_KEEPALIVE\n[NETLOGON]\n        path = /var/lib/samba/netlogon\n        browseable = no\n        share modes = no\n[PROFILES]\n        path = /var/lib/samba/profiles\n        browseable = no\n        writeable = yes\n        create mask = 0611\n        directory mask = 0700\n        profile acls = yes\n        csc policy = disable\n        map system = yes\n        map hidden = yes\n```\n\n\n# smbldap_bind.conf \u306e\u8a2d\u5b9a \nSamba \u306ebind \u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n/etc/smbldap-tools/smbldap_bind.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u4f7f\u7528\u3057\u3066\u3044\u308b\u74b0\u5883\u3067\u306f\u898f\u5b9a\u306e\u5834\u6240\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u7f6e\u304b\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n```text:\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u7528\u610f\n# cp /usr/share/doc/smbldap-tools/examples/smbldap_bind.conf /etc/smbldap-tools/\n# chown root:root /etc/smbldap-tools/smbldap_bind.conf\n# chmod 600 /etc/smbldap-tools/smbldap_bind.conf\n```\n\n\n\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u624b\u9806\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u3057\u305f\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```text:/etc/smbldap-tools/smbldap_bind.conf\n# egrep -v '(^#|^$)' /etc/smbldap-tools/smbldap_bind.conf\nmasterDN#\"cn=Manager,dc=mysite,dc=example,dccom\"\nmasterPw=\"password2\"\n```\n\n\n# smbldap-tools \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6 \n/etc/smbldap-tools/smbldap.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\u4eca\u56de\u4f7f\u7528\u3057\u3066\u3044\u308bdebian \u3067\u306f\u898f\u5b9a\u306e\u5834\u6240\u306b\u3042\u3089\u304b\u3058\u3081\u7f6e\u304b\u308c\u3066\u3044\u306a\u3044\u30d0\u30e1\u3001sample \u30d5\u30a1\u30a4\u30eb\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\n```text:\u30b5\u30f3\u30d7\u30eb\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3059\u308b\n# gunzip -c /usr/share/doc/smbldap-tools/examples/smbldap.conf.gz > /etc/smbldap-tools/smbldap.conf\n# chmod 644 /etc/smbldap-tools/smbldap.conf\n```\n\n\nSID \u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\u5f8c\u307b\u3069\u3053\u306e\u5024\u3092smbldap.conf \u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\n```text:SID\u306e\u53d6\u5f97\n# net getlocalsid\nSID for domain LDAP is: S-1-5-21-2871212629-2838730456-1868381876\n```\n\n\n/etc/smbldap-tools/smbldap.conf \u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u3066\u3044\u304d\u307e\u3059\u304c\u3001\u7d30\u304b\u3044\u624b\u9806\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\u7de8\u96c6\u5f8c\u306e\u5404\u5024\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```text:/etc/smbldap-tools/smbldap.conf\u5b9a\u7fa9\u5185\u5bb9\nSID=\"S-1-5-21-2871212629-2838730456-1868381876\"\nsambaDomain=\"MYSITE\"\nmasterLDAP=\"ldap://ldap.mysite.example.com/\"\nldapTLS=\"0\"\nverify=\"none\"\ncafile=\"/etc/smbldap-tools/ca.pem\"\nclientcert=\"/etc/smbldap-tools/smbldap-tools.example.com.pem\"\nclientkey=\"/etc/smbldap-tools/smbldap-tools.example.com.key\"\nsuffix#\"dc=mysite,dc=example,dccom\"\nusersdn#\"ouUsers,${suffix}\"\ncomputersdn#\"ouComputers,${suffix}\"\ngroupsdn#\"ouGroups,${suffix}\"\nidmapdn#\"ouIdmap,${suffix}\"\nsambaUnixIdPooldn#\"sambaDomainName${sambaDomain},${suffix}\"\nscope=\"sub\"\npassword_hash=\"SSHA\"\npassword_crypt_salt_format=\"%s\"\nuserLoginShell=\"/bin/bash\"\nuserHome=\"/home/%U\"\nuserHomeDirectoryMode=\"700\"\nuserGecos=\"System User\"\ndefaultUserGid=\"513\"\ndefaultComputerGid=\"515\"\nskeletonDir=\"/etc/skel\"\nshadowAccount=\"1\"\ndefaultMaxPasswordAge=\"45\"\nuserSmbHome=\"\\\\PDC-SRV\\%U\"\nuserProfile=\"\\\\PDC-SRV\\profiles\\%U\"\nuserHomeDrive=\"H:\"\nuserScript=\"logon.bat\"\nmailDomain=\"mysite.example.com\"\nwith_smbpasswd=\"0\"\nsmbpasswd=\"/usr/bin/smbpasswd\"\nwith_slappasswd=\"0\"\nslappasswd=\"/usr/sbin/slappasswd\"\n```\n\n\n# smbldap-populate \u3092\u4f7f\u7528\u3057\u3066OpenLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u751f\u6210\u3059\u308b \nsmbldap-populate \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066OpenLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\n```text\n# smbldap-populate\nPopulating LDAP directory for domain MYSITE (S-1-5-21-2871212629-2838730456-1868381876)\n(using builtin directory structure)\n\nentry dc#mysite,dc=example,dccom already exist. \nadding new entry: ou#Users,dc=mysite,dc=example,dccom\nadding new entry: ou#Groups,dc=mysite,dc=example,dccom\nadding new entry: ou#Computers,dc=mysite,dc=example,dccom\nadding new entry: ou#Idmap,dc=mysite,dc=example,dccom\nadding new entry: sambaDomainName#MYSITE,dc=mysite,dc=example,dccom\nadding new entry: uid#root,ou=Users,dc=mysite,dc=example,dccom\nadding new entry: uid#nobody,ou=Users,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Admins,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Users,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Guests,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Domain Computers,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Administrators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Account Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Print Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Backup Operators,ou=Groups,dc=mysite,dc=example,dccom\nadding new entry: cn#Replicators,ou=Groups,dc=mysite,dc=example,dccom\n\nPlease provide a password for the domain root: \nChanging UNIX and samba passwords for root\nNew password:           # <- \"pw-root\nRetype new password:    # <- \"pw-root\n```\n\n\nLDAP \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001smbd \u3068nmbd \u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\n```text:smbd\u3068nmbd\u3092\u518d\u8d77\u52d5\u3059\u308b\n# service smbd restart\n# update-rc.d smbd defaults\n# service nmbd restart\n# update-rc.d nmbd defaults\n```\n\n\n\n\n# Samba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0 \nSamba \u306e\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u306e\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u884c\u3044\u307e\u3059\u3002\n\u73fe\u5728\u306eSamba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux \u306e\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\n```text:\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068Linux\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u78ba\u8a8d\n# net groupmap list\nReplicators (S-1-5-32-552) -> 552\nDomain Users (S-1-5-21-2871212629-2838730456-1868381876-513) -> 513\nDomain Admins (S-1-5-21-2871212629-2838730456-1868381876-512) -> 512\nDomain Guests (S-1-5-21-2871212629-2838730456-1868381876-514) -> 514\nAdministrators (S-1-5-32-544) -> 544\nPrint Operators (S-1-5-32-550) -> 550\nBackup Operators (S-1-5-32-551) -> 551\nDomain Computers (S-1-5-21-2871212629-2838730456-1868381876-515) -> 515\nAccount Operators (S-1-5-32-548) -> 548\n```\n\n\n\u4e0a\u8a18\u306e\u51fa\u529b\u7d50\u679c\u3067\u306f\u3001\u3069\u306eSamba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3082Linux \u306e\u30b0\u30eb\u30fc\u30d7\u3068\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067\u3001Samba \u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u898f\u5247\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n\n```text:Replicators\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u3068smb_replicators\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n# groupadd -g 552 smb_replicators\n```\n\n\n\u3053\u306e\u3088\u3046\u306b\u4ed6\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u3064\u3044\u3066\u3082\u540c\u69d8\u306b\u767b\u9332\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n```text:\u4ed6\u306e\u30c9\u30e1\u30a4\u30f3\u30b0\u30eb\u30fc\u30d7\u306e\u30de\u30c3\u30d4\u30f3\u30b0\n# groupadd -g 513 smb_domain_users\n# groupadd -g 512 smb_domain_admins\n# groupadd -g 514 smb_domain_guests\n# groupadd -g 544 smb_administrators\n# groupadd -g 550 smb_print_operators\n# groupadd -g 551 smb_backup_operators\n# groupadd -g 515 smb_domain_computers\n# groupadd -g 548 smb_account_operators\n```\n\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u304c\u7d42\u308f\u3063\u305f\u5f8c\u306e\u7d50\u679c\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```text:\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u78ba\u8a8d\n# net groupmap list\nReplicators (S-1-5-32-552) -> smb_replicators\nDomain Users (S-1-5-21-2871212629-2838730456-1868381876-513) -> smb_domain_users\nDomain Admins (S-1-5-21-2871212629-2838730456-1868381876-512) -> smb_domain_admins\nDomain Guests (S-1-5-21-2871212629-2838730456-1868381876-514) -> smb_domain_guests\nAdministrators (S-1-5-32-544) -> smb_administrators\nPrint Operators (S-1-5-32-550) -> smb_print_operators\nBackup Operators (S-1-5-32-551) -> smb_backup_operators\nDomain Computers (S-1-5-21-2871212629-2838730456-1868381876-515) -> smb_domain_computers\nAccount Operators (S-1-5-32-548) -> smb_account_operators\n```\n\n\n# \u30e6\u30fc\u30b6\u306e\u767b\u9332 \nWindows \u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001Windows \u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3092Linux \u30e6\u30fc\u30b6\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d\u3092\u767b\u9332\u3059\u308b\u5834\u5408\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u540d\u306e\u6700\u5f8c\u306b\"$\" \u3092\u3064\u3051\u3066\u767b\u9332\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n```text:Windows\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u306e\u767b\u9332\n# useradd -M -g smb_domain_computers -s /bin/false workstation$\n```\n\n\n\u6b21\u306b\u3001\u305d\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\n```text:\u30e6\u30fc\u30b6\u306e\u767b\u9332\n# useradd -M saburo-suzuki\n# smbldap-useradd -a -G 'Domain Users' -m -s /bin/bash -d /home/saburo-suzuki -F \"\" -P saburo-suzuki\nChanging UNIX and samba passwords for saburo-suzuki\nNew password:            # <- pw-saburo-suzuki\nRetype new password:     # <- pw-saburo-suzuki\n\n# smbpasswd -e saburo-suzuki\nEnabled user saburo-suzuki.\n```\n\n\n\u30c9\u30e1\u30a4\u30f3\u306b\u30de\u30b7\u30f3\u3092\u53c2\u52a0\u3055\u305b\u308b\u6a29\u5229\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n\n```text:\u30de\u30b7\u30f3\u306e\u8ffd\u52a0\n# net sam rights grant saburo-suzuki SeMachineAccountPrivilege\nGranted SeMachineAccountPrivilege to MYSITE\\saburo-suzuki\n```\n\n\n# Windows 7 \u3067\u30ed\u30b0\u30a4\u30f3\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b \n## \u30ec\u30b8\u30b9\u30c8\u30ea\u5024\u306e\u5909\u66f4 \n\u65e2\u77e5\u306e\u554f\u984c\u3068\u3057\u3066\u3001Windows 7 \u3067\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u3092\u884c\u3046\u524d\u306b\u30ec\u30b8\u30b9\u30c8\u30ea\u5024\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nWindows 7 \u3067\"\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\" \u304b\u3089\"regedit\" \u3068\u5165\u529b\u3057\u3001\u30ec\u30b8\u30b9\u30c8\u30ea\u30a8\u30c7\u30a3\u30bf\u3092\u958b\u304d\u307e\u3059\u3002\n\u30ec\u30b8\u30b9\u30c8\u30ea\u30a8\u30c7\u30a3\u30bf\u304c\u958b\u3044\u305f\u3089\u3001\u4e0b\u8a18\u306e\u7528\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n* \u5834\u6240:HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\services\\LanmanWorkstation\\Parameters\n<table><tbody>\n  </tr>\n  <tr>\n    <th> \u5909\u6570</th>\n    <th> \u578b</th>\n    <th> \u5024</th>\n  </tr>\n  <tr>\n    <td> DNSNameResolutionRequired</td>\n    <td> DWORD</td>\n    <td> 0</td>\n  </tr>\n  <tr>\n    <td> DomainCompatibilityMode</td>\n    <td> DWORD</td>\n    <td> 1</td>\n  </tr>\n</tbody></table>\n\n![SambaBackendsOpenLDAP_0001.png](https://qiita-image-store.s3.amazonaws.com/0/70152/aedcac8c-e7d0-3f4f-85e3-8fbd81ac9eac.png)\n\n\n## \u30c9\u30e1\u30a4\u30f3\u3078\u306e\u53c2\u52a0 \n\u203b\u4e00\u90e8\u82f1\u8a9e\u3068\u65e5\u672c\u8a9e\u306e\u8868\u8a18\u304c\u6df7\u3058\u3063\u3066\u3044\u307e\u3059\u3002\nWindows \u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089Computer \u3092\u53f3\u30af\u30ea\u30c3\u30af\u3057\u3001Properties \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\nSystem \u30a6\u30a3\u30f3\u30c9\u30a6\u306e\u5de6\u5074\u306eAdvanced system settings \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![SambaBackendsOpenLDAP_0002.png](https://qiita-image-store.s3.amazonaws.com/0/70152/859e29a6-dd1c-a855-bf19-199ba619eabe.png)\n\n\nSystem Properties \u30a6\u30a3\u30f3\u30c9\u30a6\u306eChange \u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3057\u307e\u3059\u3002\n![SambaBackendsOpenLDAP_0003.png](https://qiita-image-store.s3.amazonaws.com/0/70152/2b764ecc-db77-d994-af73-688b4e11d7c4.png)\n\nComputer Name/Domain Changes \u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u51fa\u3066\u304d\u305f\u3089\u3001\u6b21\u306e\u56f3\u306e\u7528\u306bDomain \u306e\u30e9\u30b8\u30aa\u30dc\u30bf\u30f3\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001MYSITE \u3068\u5165\u529b\u3057\u3001OK \u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![SambaBackendsOpenLDAP_0004.png](https://qiita-image-store.s3.amazonaws.com/0/70152/88a0fdc2-0193-34b4-9018-db6dde6c92f4.png)\n\n\u3059\u308b\u3068\u3001\u8a8d\u8a3c\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u3066\u304f\u308b\u306e\u3067\u3001\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30e6\u30fc\u30b6\u3068\u30d1\u30b9\u30ef\u30fc\u30c9(saburo-suzuki/pw-saburo-suzuki)\u3092\u5165\u529b\u3057\u3066OK \u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![SambaBackendsOpenLDAP_0005.png](https://qiita-image-store.s3.amazonaws.com/0/70152/3e619866-7f46-edf6-0675-fa98616f8236.png)\n\n\u3057\u3070\u3089\u304f\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6210\u529f\u306e\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u51fa\u73fe\u3057\u3066\u304f\u308c\u3070\u8a8d\u8a3c\u6210\u529f\u3067\u3059\u3002\n![SambaBackendsOpenLDAP_0006.png](https://qiita-image-store.s3.amazonaws.com/0/70152/ed9d4f44-8b35-878c-aa09-6c99b66b2640.png)\n\n\u8a8d\u8a3c\u306b\u6210\u529f\u3059\u308b\u3068\u3001\u30de\u30b7\u30f3\u306e\u518d\u8d77\u52d5\u304c\u8981\u6c42\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u306b\u5f93\u3044\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## \u30c9\u30e1\u30a4\u30f3\u30e6\u30fc\u30b6\u3067\u306e\u30ed\u30b0\u30a4\u30f3 \n\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u304c\u51fa\u3066\u304d\u305f\u3089\u3001\"\u30e6\u30fc\u30b6\u306e\u5207\u308a\u66ff\u3048\" -> \"\u305d\u306e\u4ed6\u306e\u30e6\u30fc\u30b6\" \u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b\"\u30c9\u30e1\u30a4\u30f3\u540d\\\u30e6\u30fc\u30b6\u540d\" \u3068\u3044\u3046\u5f62\u5f0f\u3067\u4e0a\u6bb5\u306b\u30e6\u30fc\u30b6\u540d\u3092\u5165\u529b\u3057\u3001\u305d\u306e\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4e0b\u6bb5\u306b\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n![SambaBackendsOpenLDAP_0007.png](https://qiita-image-store.s3.amazonaws.com/0/70152/22f703b7-f74a-a94d-bb47-df023c3f9114.png)\n\n\n\u6b63\u5e38\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u305f\u3089\u3001\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u30e6\u30fc\u30b6\u540d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002Domain \u30e6\u30fc\u30b6\u306e\u540d\u524d\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```text:\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u30e6\u30fc\u30b6\u306e\u78ba\u8a8d\n> whoami\nmysite\\saburo-suzuki\n```\n\n\n# \u53c2\u8003 \n<dl>\n  <dt> Setup Samba Domain Controller with LDAP Backend in Ubuntu 13.04</dt>\n  <dd> http://www.unixmen.com/setup-samba-domain-controller-with-openldap-backend-in-ubuntu-13-04/</dd>\n</dl>\n\n<dl>\n  <dt> HostoForge</dt>\n  <dd> https://www.howtoforge.com/centos-5.x-samba-domain-controller-with-ldap-backend</dd>\n</dl>\n\n<dl>\n  <dt> Dependencies</dt>\n  <dd> https://wiki.samba.org/index.php/Operating_system_requirements/Dependencies_-_Libraries_and_programs</dd>\n</dl>\n", "tags": ["Linux", "samba", "windows7"]}