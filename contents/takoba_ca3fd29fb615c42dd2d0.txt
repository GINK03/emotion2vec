{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nRedis\u306b\u30e9\u30f3\u30ad\u30f3\u30b0\u30c7\u30fc\u30bf\u3068\u304b\u3092zset\u3067\u683c\u7d0d\u3057\u3066\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u30e9\u30f3\u30ad\u30f3\u30b0\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u8af8\u3005\u30c6\u30b9\u30c8\u3057\u305f\u304f\u306a\u308a\u307e\u3057\u3066\u3002\n\u3068\u306f\u3044\u3048\u3001zset\u3092\u30b3\u30d4\u30fc\u3059\u308b\u8853\u304ccommands\u63a2\u3057\u3066\u3082\u306a\u304b\u3063\u305f\u3002\u304b\u306a\u3057\u3044\u3002\n\u305d\u3093\u306a\u4e2d\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30f3\u30c8\u30ea\u3092\u898b\u3064\u3051\u3066\u3001\u30b5\u30af\u30c3\u3068\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u305f\u3089\u30b3\u30d4\u30fc\u3067\u304d\u3061\u3083\u3063\u305f\u304a\u8a71\u3067\u3059\u3002\nRedis\u306eLua\u30b9\u30af\u30ea\u30d7\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u3064\u3044\u3066 \u00ab Rest Term\n\nRedis\u3067lua script\u66f8\u3051\u308b\nEVAL\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u66f8\u3051\u308b\u3089\u3057\u3044\u3002\n\nbash\n# 127.0.0.1:6379 \u306bredis-server\u304c\u3044\u308b\u3068\u3057\u3066\nredis-cli\n\n\n\nredis-cli\n127.0.0.1:6379> EVAL \"return 'Hello, world!'\" 0\n#=> \"Hello, world!\"\n\n\n\u3053\u308c\u3092\u8aad\u3080\u3068\u3001\u5f15\u6570\u3082\u62fe\u3048\u308b\u3002\n\nredis-cli\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1 key2 1 2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n#=> 3) \"1\"\n#=> 4) \"2\"\n\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1 key2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1\n#=> (error) ERR Number of keys can't be greater than number of args\n\n\n\nSCRIPT LOAD\u3067script\u3092\u767b\u9332\u3057\u3066\u304a\u3051\u308b\nSCRIPT LOAD\u3068EVALSHA\u3092\u4f7f\u3048\u3070\u8af8\u3005\u6357\u308a\u305d\u3046\u3002\n\uff08redis-server\u304c\u843d\u3061\u306a\u3051\u308c\u3070\u767a\u884c\u3055\u308c\u305fhashkey\u306f\u6b8b\u308b\u3063\u307d\u3044\uff09\n\nredis-cli\n127.0.0.1:6379> SCRIPT LOAD \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\"\n#=> \"c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2\"\n\n127.0.0.1:6379> EVALSHA c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2 2 key1 key2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n\n127.0.0.1:6379> exit\n\n\n\nredis-cli\n127.0.0.1:6379> EVALSHA c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2 2 key1 key2 1 2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n#=> 3) \"1\"\n#=> 4) \"2\"\n\n\n\nzset\u3092\u30b3\u30d4\u30fc\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u3053\u306e\u8fba\u3092\u53c2\u8003\u306b\u672c\u984c\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u3066\u307f\u305f\u3002\n\u3068\u308a\u3042\u3048\u305a\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u30b3\u30d4\u30fc\u5143\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3068\u304f\u3002\n\nredis-cli\n127.0.0.1:6379> ZADD key1 10 1\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 20 2\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 50 3\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 100 4\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 30 5\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 1 6\n#=> (integer) 1\n\n127.0.0.1:6379> ZRANGE key1 0 -1\n#=> 1) \"6\"\n#=> 2) \"1\"\n#=> 3) \"2\"\n#=> 4) \"5\"\n#=> 5) \"3\"\n#=> 6) \"4\"\n\n\n\u3067\u3001\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u8d70\u3089\u305b\u308b\u3068...\n\nredis-cli\n127.0.0.1:6379> EVAL \"for i,v in ipairs(redis.call('zrange', KEYS[1], 0, -1)) do redis.call('zadd', KEYS[2], redis.call('zscore', KEYS[1], v), v) end\" 2 key1 key2\n#=> (nil)\n\n127.0.0.1:6379> ZRANGE key2 0 -1\n#=> 1) \"6\"\n#=> 2) \"1\"\n#=> 3) \"2\"\n#=> 4) \"5\"\n#=> 5) \"3\"\n#=> 6) \"4\"\n\n# \u3061\u3083\u3093\u3068`score`\u3082\u30b3\u30d4\u30fc\u3067\u304d\u3066\u308b\u3067\n127.0.0.1:6379> ZSCORE key2 6\n#=> \"1\"\n127.0.0.1:6379> ZSCORE key2 4\n#=> \"100\"\n\n\n\u3068\u3044\u3046\u304b\u3093\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u4fbf\u5229\uff01\n\n\u304a\u308f\u308a\u306b\n\u5225\u306e\u8a00\u8a9e\u3067script\u66f8\u3044\u3066\u5b9f\u884c\u3055\u305b\u3066\u3082\u3088\u3044\u306e\u3060\u3051\u3069\u3001\u30ab\u30b8\u30e5\u30a2\u30eb\u306b\u5b9f\u884c\u3067\u304d\u308b\u306e\u3067\u5272\u3068\u4fbf\u5229\u304b\u306a\u3001\u3068\u3044\u3046\u611f\u60f3\u3067\u3059\u3002\u4ee5\u4e0a\uff01\n\n\u53c2\u8003\n\nEVAL \u2013 Redis\nRedis\u306eLua\u30b9\u30af\u30ea\u30d7\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u3064\u3044\u3066 \u00ab Rest Term\nCopy a redis sorted set to a set - Stack Overflow\n\n\n\n# \u6982\u8981\n\nRedis\u306b\u30e9\u30f3\u30ad\u30f3\u30b0\u30c7\u30fc\u30bf\u3068\u304b\u3092zset\u3067\u683c\u7d0d\u3057\u3066\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u30e9\u30f3\u30ad\u30f3\u30b0\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066\u8af8\u3005\u30c6\u30b9\u30c8\u3057\u305f\u304f\u306a\u308a\u307e\u3057\u3066\u3002\n\u3068\u306f\u3044\u3048\u3001zset\u3092\u30b3\u30d4\u30fc\u3059\u308b\u8853\u304c[commands](http://redis.io/commands)\u63a2\u3057\u3066\u3082\u306a\u304b\u3063\u305f\u3002\u304b\u306a\u3057\u3044\u3002\n\n\u305d\u3093\u306a\u4e2d\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30f3\u30c8\u30ea\u3092\u898b\u3064\u3051\u3066\u3001\u30b5\u30af\u30c3\u3068\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u305f\u3089\u30b3\u30d4\u30fc\u3067\u304d\u3061\u3083\u3063\u305f\u304a\u8a71\u3067\u3059\u3002\n[Redis\u306eLua\u30b9\u30af\u30ea\u30d7\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u3064\u3044\u3066 \u00ab Rest Term](http://rest-term.com/archives/3038/)\n\n\n# Redis\u3067lua script\u66f8\u3051\u308b\n\n`EVAL`\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u66f8\u3051\u308b\u3089\u3057\u3044\u3002\n\n```bash:bash\n# 127.0.0.1:6379 \u306bredis-server\u304c\u3044\u308b\u3068\u3057\u3066\nredis-cli\n```\n\n```bash:redis-cli\n127.0.0.1:6379> EVAL \"return 'Hello, world!'\" 0\n#=> \"Hello, world!\"\n```\n\n[\u3053\u308c](http://redis.io/commands/eval)\u3092\u8aad\u3080\u3068\u3001\u5f15\u6570\u3082\u62fe\u3048\u308b\u3002\n\n```bash:redis-cli\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1 key2 1 2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n#=> 3) \"1\"\n#=> 4) \"2\"\n\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1 key2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n\n127.0.0.1:6379> EVAL \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\" 2 key1\n#=> (error) ERR Number of keys can't be greater than number of args\n```\n\n## `SCRIPT LOAD`\u3067script\u3092\u767b\u9332\u3057\u3066\u304a\u3051\u308b\n\n`SCRIPT LOAD`\u3068`EVALSHA`\u3092\u4f7f\u3048\u3070\u8af8\u3005\u6357\u308a\u305d\u3046\u3002\n\uff08redis-server\u304c\u843d\u3061\u306a\u3051\u308c\u3070\u767a\u884c\u3055\u308c\u305fhashkey\u306f\u6b8b\u308b\u3063\u307d\u3044\uff09\n\n```bash:redis-cli\n127.0.0.1:6379> SCRIPT LOAD \"return {KEYS[1], KEYS[2], ARGV[1], ARGV[2]}\"\n#=> \"c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2\"\n\n127.0.0.1:6379> EVALSHA c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2 2 key1 key2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n\n127.0.0.1:6379> exit\n```\n\n```bash:redis-cli\n127.0.0.1:6379> EVALSHA c0d2d6f81be75d67523d7c8ac69a932fbe1aa4e2 2 key1 key2 1 2\n#=> 1) \"key1\"\n#=> 2) \"key2\"\n#=> 3) \"1\"\n#=> 4) \"2\"\n```\n\n\n# zset\u3092\u30b3\u30d4\u30fc\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001[\u3053\u306e\u8fba](http://stackoverflow.com/questions/14297671/copy-a-redis-sorted-set-to-a-set)\u3092\u53c2\u8003\u306b\u672c\u984c\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u66f8\u3044\u3066\u307f\u305f\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u30b3\u30d4\u30fc\u5143\u30c7\u30fc\u30bf\u3092\u4f5c\u3063\u3068\u304f\u3002\n\n```bash:redis-cli\n127.0.0.1:6379> ZADD key1 10 1\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 20 2\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 50 3\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 100 4\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 30 5\n#=> (integer) 1\n127.0.0.1:6379> ZADD key1 1 6\n#=> (integer) 1\n\n127.0.0.1:6379> ZRANGE key1 0 -1\n#=> 1) \"6\"\n#=> 2) \"1\"\n#=> 3) \"2\"\n#=> 4) \"5\"\n#=> 5) \"3\"\n#=> 6) \"4\"\n```\n\n\u3067\u3001\u3053\u3093\u306a\u304b\u3093\u3058\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u8d70\u3089\u305b\u308b\u3068...\n\n```bash:redis-cli\n127.0.0.1:6379> EVAL \"for i,v in ipairs(redis.call('zrange', KEYS[1], 0, -1)) do redis.call('zadd', KEYS[2], redis.call('zscore', KEYS[1], v), v) end\" 2 key1 key2\n#=> (nil)\n\n127.0.0.1:6379> ZRANGE key2 0 -1\n#=> 1) \"6\"\n#=> 2) \"1\"\n#=> 3) \"2\"\n#=> 4) \"5\"\n#=> 5) \"3\"\n#=> 6) \"4\"\n\n# \u3061\u3083\u3093\u3068`score`\u3082\u30b3\u30d4\u30fc\u3067\u304d\u3066\u308b\u3067\n127.0.0.1:6379> ZSCORE key2 6\n#=> \"1\"\n127.0.0.1:6379> ZSCORE key2 4\n#=> \"100\"\n```\n\n\u3068\u3044\u3046\u304b\u3093\u3058\u306b\u306a\u308a\u307e\u3059\u3002\u4fbf\u5229\uff01\n\n\n# \u304a\u308f\u308a\u306b\n\n\u5225\u306e\u8a00\u8a9e\u3067script\u66f8\u3044\u3066\u5b9f\u884c\u3055\u305b\u3066\u3082\u3088\u3044\u306e\u3060\u3051\u3069\u3001\u30ab\u30b8\u30e5\u30a2\u30eb\u306b\u5b9f\u884c\u3067\u304d\u308b\u306e\u3067\u5272\u3068\u4fbf\u5229\u304b\u306a\u3001\u3068\u3044\u3046\u611f\u60f3\u3067\u3059\u3002\u4ee5\u4e0a\uff01\n\n\n# \u53c2\u8003\n\n- [EVAL \u2013 Redis](http://redis.io/commands/eval)\n- [Redis\u306eLua\u30b9\u30af\u30ea\u30d7\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u3064\u3044\u3066 \u00ab Rest Term](http://rest-term.com/archives/3038/)\n- [Copy a redis sorted set to a set - Stack Overflow](http://stackoverflow.com/questions/14297671/copy-a-redis-sorted-set-to-a-set)\n", "tags": ["Redis", "Lua"]}