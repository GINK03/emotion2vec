{"tags": ["lsyncd2.1.4", "Lua5.1.4"], "context": " More than 1 year has passed since last update.lsyncd.conf\u306e\u30b3\u30e1\u30f3\u30c8\u304cLua\u3063\u307d\u304f\u3066\u3001\u3084\u3063\u3066\u307f\u305f\u3089\u3067\u304d\u305f\u306e\u3067\u899a\u66f8\u3002\n\u8907\u6570\u306e\u30b5\u30fc\u30d0\u306bsync\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u304d\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u9577\u304f\u306a\u3089\u305a\u306b\u3059\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\nCentOS6.5\u3067lsyncd\u3092\u52d5\u304b\u3059\n\u3053\u3061\u3089\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3067\u3059\u3002\n\n\u69cb\u6210\n\n\n\n\u30db\u30b9\u30c8\nIP\u30a2\u30c9\u30ec\u30b9\n\n\n\n\n\u30b5\u30fc\u30d0\n192.168.33.81\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c81\n192.168.33.82\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c82\n192.168.33.83\n\n\n\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nsync\u306e\u5bfe\u8c61\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u305f\u3044\nlsyncd_test/\n\u251c\u2500\u2500 dir1 # lsync\u5bfe\u8c61  \n\u251c\u2500\u2500 dir2 # lsync\u5bfe\u8c61\u5916\n\u2514\u2500\u2500 dir3 # lsync\u5bfe\u8c61\n\n\u305d\u308c\u4ee5\u5916 : lsync\u5bfe\u8c61\u5916\n\nlsyncd_test\u3092\u540c\u671f\u5bfe\u8c61\u306b\u3057\u3066exclude\u3067dir2\u3092\u9664\u5916\u3057\u3066\u3082dir4\u306a\u3069\u304c\u4f5c\u6210\u3055\u308c\u308b\u3068\u540c\u671f\u3055\u308c\u3066\u3057\u307e\u3046\u3002\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u5f62\u5f0f\u3067\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u30af\u30e9\u30a4\u30a2\u30f3\u30c81\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c82\u306b\u540c\u671f\u3059\u308b\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n[\u30b5\u30fc\u30d0]\n$ mkdir /home/vagrant/lsyncd_test/dir1\n$ mkdir /home/vagrant/lsyncd_test/dir2\n$ mkdir /home/vagrant/lsyncd_test/dir3\n\n\n\u8a2d\u5b9a\u3092\u5217\u6319\u3057\u305f\u66f8\u304d\u65b9\n\n/etc/lsyncd/lsyncd.conf\n----\n-- User configuration file for lsyncd.\n--\n-- Simple example for default rsync.\n--\nsettings {\n        logfile    = \"/var/log/lsyncd.log\",\n        statusFile = \"/tmp/lsyncd.stat\",\n        statusInterval = 1,\n        maxProcesses = 2,\n        nodaemon     = false,\n        insist       = 1,\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir1\",\n        target=\"192.168.33.82::test/dir1\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir3\",\n        target=\"192.168.33.82::test/dir3\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir1\",\n        target=\"192.168.33.83::test/dir1\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir3\",\n        target=\"192.168.33.83::test/dir3\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\n\nLua\u306e\u30c6\u30af\u30cb\u30ab\u30eb\u306a\u66f8\u304d\u65b9\n\n/etc/lsyncd/lsyncd.conf\n----\n-- User configuration file for lsyncd.\n--\n-- Simple example for default rsync.\n--\nsettings {\n        logfile    = \"/var/log/lsyncd.log\",\n        statusFile = \"/tmp/lsyncd.stat\",\n        statusInterval = 1,\n        maxProcesses = 2,\n        nodaemon     = false,\n        insist       = 1,\n}\n\n-- Set lsyncd target files.\nlsyncd_target_dirs = {\n\"dir1/\",\n\"dir3\"\n}\n\n-- Read lsyncd_target_hosts.lua\ndofile(\"/etc/lsyncd/lsyncd_target_hosts.lua\")\n\nfor lsyncd_target_host_key, lsyncd_target_host in pairs(lsyncd_target_hosts) do\n  for lsyncd_target_dir_key, lsyncd_target_dir in pairs(lsyncd_target_dirs) do\n    sync{\n      default.rsync,\n      source=\"/home/vagrant/lsyncd_test/\" .. lsyncd_target_dir,\n      target=lsyncd_target_host .. \"::test/\" .. lsyncd_target_dir,\n      rsync = {\n        _extra = {  \"-a\" },\n      }\n    }\n  end\nend\n\n\n/etc/lsyncd/lsyncd_target_hosts.lua\nlsyncd_target_hosts = {\n\"192.168.33.82\",\n\"192.168.33.83\"\n}\n\n\n\u540c\u671f\u524d\u306e\u72b6\u614b\n[\u30b5\u30fc\u30d0]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir2  dir3\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c81]\n$ ls /home/vagrant/lsyncd_test/\n=====================\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c82]\n$ ls /home/vagrant/lsyncd_test/\n=====================\n=====================\n\n\n\u540c\u671f\u5b9f\u884c\u5f8c\n[\u30b5\u30fc\u30d0]\n$ sudo service lsyncd restart\n=====================\nStopping lsyncd:                                           [  OK  ]\nStarting lsyncd:                                           [  OK  ]\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c81]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir3\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c82]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir3\n=====================\n\nLua\u30a4\u30a4\u30cd\uff01\nApache\u3082mod_lua\u3067Lua\u3067\u66f8\u3051\u308b\u3068\u304b\u3002\u3002\nlsyncd.conf\u306e\u30b3\u30e1\u30f3\u30c8\u304cLua\u3063\u307d\u304f\u3066\u3001\u3084\u3063\u3066\u307f\u305f\u3089\u3067\u304d\u305f\u306e\u3067\u899a\u66f8\u3002\n\u8907\u6570\u306e\u30b5\u30fc\u30d0\u306bsync\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u304d\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u9577\u304f\u306a\u3089\u305a\u306b\u3059\u307f\u307e\u3059\u3002\n\n## \u524d\u63d0\n[CentOS6.5\u3067lsyncd\u3092\u52d5\u304b\u3059](http://qiita.com/ftakao2007/items/41c5c0653892d1454c39)\n\u3053\u3061\u3089\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3067\u3059\u3002\n\n## \u69cb\u6210\n| \u30db\u30b9\u30c8 | IP\u30a2\u30c9\u30ec\u30b9 |\n|:-----:|:---------:|\n| \u30b5\u30fc\u30d0 | 192.168.33.81 |\n| \u30af\u30e9\u30a4\u30a2\u30f3\u30c81 | 192.168.33.82|\n| \u30af\u30e9\u30a4\u30a2\u30f3\u30c82 | 192.168.33.83|\n\n## \u3084\u308a\u305f\u3044\u3053\u3068\nsync\u306e\u5bfe\u8c61\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u305f\u3044\n\n```\nlsyncd_test/\n\u251c\u2500\u2500 dir1 # lsync\u5bfe\u8c61  \n\u251c\u2500\u2500 dir2 # lsync\u5bfe\u8c61\u5916\n\u2514\u2500\u2500 dir3 # lsync\u5bfe\u8c61\n\n\u305d\u308c\u4ee5\u5916 : lsync\u5bfe\u8c61\u5916\n```\nlsyncd_test\u3092\u540c\u671f\u5bfe\u8c61\u306b\u3057\u3066exclude\u3067dir2\u3092\u9664\u5916\u3057\u3066\u3082dir4\u306a\u3069\u304c\u4f5c\u6210\u3055\u308c\u308b\u3068\u540c\u671f\u3055\u308c\u3066\u3057\u307e\u3046\u3002\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u5f62\u5f0f\u3067\u7279\u5b9a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u30af\u30e9\u30a4\u30a2\u30f3\u30c81\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c82\u306b\u540c\u671f\u3059\u308b\u3002\n\n## \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n```\n[\u30b5\u30fc\u30d0]\n$ mkdir /home/vagrant/lsyncd_test/dir1\n$ mkdir /home/vagrant/lsyncd_test/dir2\n$ mkdir /home/vagrant/lsyncd_test/dir3\n```\n## \u8a2d\u5b9a\u3092\u5217\u6319\u3057\u305f\u66f8\u304d\u65b9\n### /etc/lsyncd/lsyncd.conf\n\n```\n----\n-- User configuration file for lsyncd.\n--\n-- Simple example for default rsync.\n--\nsettings {\n        logfile    = \"/var/log/lsyncd.log\",\n        statusFile = \"/tmp/lsyncd.stat\",\n        statusInterval = 1,\n        maxProcesses = 2,\n        nodaemon     = false,\n        insist       = 1,\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir1\",\n        target=\"192.168.33.82::test/dir1\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir3\",\n        target=\"192.168.33.82::test/dir3\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir1\",\n        target=\"192.168.33.83::test/dir1\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n\nsync{\n        default.rsync,\n        source=\"/home/vagrant/lsyncd_test/dir3\",\n        target=\"192.168.33.83::test/dir3\",\n        rsync = {\n          _extra = {  \"-a\" },\n        }\n}\n```\n## Lua\u306e\u30c6\u30af\u30cb\u30ab\u30eb\u306a\u66f8\u304d\u65b9\n\n### /etc/lsyncd/lsyncd.conf\n```\n----\n-- User configuration file for lsyncd.\n--\n-- Simple example for default rsync.\n--\nsettings {\n        logfile    = \"/var/log/lsyncd.log\",\n        statusFile = \"/tmp/lsyncd.stat\",\n        statusInterval = 1,\n        maxProcesses = 2,\n        nodaemon     = false,\n        insist       = 1,\n}\n\n-- Set lsyncd target files.\nlsyncd_target_dirs = {\n\"dir1/\",\n\"dir3\"\n}\n\n-- Read lsyncd_target_hosts.lua\ndofile(\"/etc/lsyncd/lsyncd_target_hosts.lua\")\n\nfor lsyncd_target_host_key, lsyncd_target_host in pairs(lsyncd_target_hosts) do\n  for lsyncd_target_dir_key, lsyncd_target_dir in pairs(lsyncd_target_dirs) do\n    sync{\n      default.rsync,\n      source=\"/home/vagrant/lsyncd_test/\" .. lsyncd_target_dir,\n      target=lsyncd_target_host .. \"::test/\" .. lsyncd_target_dir,\n      rsync = {\n        _extra = {  \"-a\" },\n      }\n    }\n  end\nend\n```\n\n## /etc/lsyncd/lsyncd_target_hosts.lua\n```\nlsyncd_target_hosts = {\n\"192.168.33.82\",\n\"192.168.33.83\"\n}\n```\n\n## \u540c\u671f\u524d\u306e\u72b6\u614b\n\n```\n[\u30b5\u30fc\u30d0]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir2  dir3\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c81]\n$ ls /home/vagrant/lsyncd_test/\n=====================\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c82]\n$ ls /home/vagrant/lsyncd_test/\n=====================\n=====================\n```\n\n## \u540c\u671f\u5b9f\u884c\u5f8c\n```\n[\u30b5\u30fc\u30d0]\n$ sudo service lsyncd restart\n=====================\nStopping lsyncd:                                           [  OK  ]\nStarting lsyncd:                                           [  OK  ]\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c81]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir3\n=====================\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c82]\n$ ls /home/vagrant/lsyncd_test/\n=====================\ndir1  dir3\n=====================\n```\n\nLua\u30a4\u30a4\u30cd\uff01\nApache\u3082mod_lua\u3067Lua\u3067\u66f8\u3051\u308b\u3068\u304b\u3002\u3002\n"}