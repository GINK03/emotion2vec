{"context": "\n\n0.\u306f\u3058\u3081\u306b\nAnsible\u3067\n\n\u3042\u308b\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u3092\u5143\u306b\u51e6\u7406\u3092\u5207\u308a\u5206\u3051\u305f\u3044\n\u3042\u308b\u7279\u5b9a\u306e\u6761\u4ef6\u3067\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51e6\u7406\u306f\u6210\u529f\u3057\u3066\u3082\u601d\u3063\u305f\u901a\u308a\u306e\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001\u305d\u306e\u7d50\u679c\u306b\u3088\u3063\u3066\u306f\u51e6\u7406\u3092faild\u3067\u30a8\u30e9\u30fc\u3068\u3057\u305f\u3044\n\n\u3068\u3044\u3046\u601d\u3044\u304b\u3089\u3001\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306b\u3064\u3044\u3066 CentOS6\u4e0a\u3067\u306eopenssl\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1(\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8)\u306eyum\u306e\u30ed\u30fc\u30ab\u30eb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f8b\u3068\u3057\u3066\nblock:/rescue:/always:\u306e\u52d5\u4f5c\u3082\u5408\u308f\u305b\u3066\u52d5\u4f5c\u691c\u8a3c\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n1.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3059\u308b\uff08\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306fskip\u3059\u308b\uff09\n  + when: \"'\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217' not in command1_result.stdout\"\n  + when: command1_result.stdout.find('\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217') == -1\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u4eca\u56de\u306f not in\u3092\u691c\u8a3c\n2.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3092failed\u3055\u305b\u308b\n  + faild_when: \"'\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217' not in command2_result.stdout\"\n  + faild_when: command2_result.stdout.find('\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217') == -1\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u4eca\u56de\u306f not in\u3092\u691c\u8a3c\n\n1.1. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u51e6\u7406\u3059\u308b\uff08\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306fskip\u3059\u308b\uff09\n\u4ee5\u4e0b\u306f\u5909\u6570\uff08check_command\uff09\u3067\u5b9a\u7fa9\u3001\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306e\u6a19\u6e96\u51fa\u529b\uff08command1_result.stdout\uff09\u306b\u5909\u6570\uff08rpm_name\uff09\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u5b9f\u884c\u3057\u3001\u5165\u3063\u3066\u3044\u308c\u3070\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\n\u203b not in \u306e\u90e8\u5206\u3092in\u3000\u3068\u3059\u308c\u3070\u9006\u306e\u610f\u5473\u3067\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306a\u308a\u307e\u3059\u3002\n#  vars:\n#    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n#    check_command: \"rpm -q openssl\"\n  - name: check rpm version\n    command: \"{{ check_command }}\"\n    register: command1_result\n  - block:\n# \u4e2d\u7565 \uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n    when: \"'{{ rpm_name }}' not in command1_result.stdout\"\n#    when: command1_result.stdout.find('{{ rpm_name }}') == -1\n\n\n1.2.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3092failed\u3055\u305b\u308b\n\u4ee5\u4e0b\u306f\u5909\u6570\uff08check_command\uff09\u3067\u5b9a\u7fa9\u3001\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306e\u6a19\u6e96\u51fa\u529b\uff08command2_result.stdout\uff09\u306b\u5909\u6570\uff08rpm_name\uff09\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u306a\u3051\u308c\u3070faild\u3068\u3059\u308b\u51e6\u7406\u3002\u4eca\u56de\u306fblock\u5185\u3067\u306e\u6700\u7d42\u5224\u5b9a\u3067\u5229\u7528\u3002\n\u203b not in \u306e\u90e8\u5206\u3092in\u3000\u3068\u3059\u308c\u3070\u9006\u306e\u610f\u5473\u3067\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306a\u308a\u307e\u3059\u3002\n#  vars:\n#    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n#    check_command: \"rpm -q openssl\"\n      - name: check rpm version\n        command: \"{{ check_command }}\"\n        register: command2_result\n        failed_when: \"'{{ rpm_name }}' not in command2_result.stdout\"\n#        failed_when: command2_result.stdout.find('{{ rpm_name }}') == -1\n\n\n2.1. \u5b9f\u884c\u74b0\u5883\n\u7c21\u7565\u5316\u3059\u308b\u305f\u3081\u3001Ansible \u5b9f\u884c\u30b5\u30fc\u30d0 \u53ca\u3073 Ansible\u30bf\u30fc\u30b2\u30c3\u30c8\u30db\u30b9\u30c8\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1\u306eopenssl\u306erpm\u306b\u3064\u3044\u3066\u306f\u4e8b\u524d\u306bpatch\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n# cat /etc/redhat-release\nCentOS release 6.7 (Final)\n# ansible --version\nansible 2.1.0 (devel d358a22542) last updated 2016/04/04 23:43:05 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD a38bdfc720) last updated 2016/04/04 23:43:15 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 7c3999a92a) last updated 2016/04/04 23:43:22 (GMT +900)\n  config file = /opt/qiita/patch/ex1/ansible.cfg\n  configured module search path = Default w/o overrides\n# tree patch/\npatch/\n- openssl-1.0.1e-16.el6_5.4.x86_64.rpm\n- openssl-1.0.1e-42.el6_7.1.x86_64.rpm\n- openssl-1.0.1e-48.el6_8.1.x86_64.rpm\n\n\n2.2 \u30b5\u30f3\u30d7\u30eb playbook\u7b49\n\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\n\u81ea\u5206\u81ea\u8eab\u306b\u5bfe\u3057\u3066\u5b9f\u65bd\n[local]\nlocalhost ansible_connection=local\n\n\u30c6\u30b9\u30c8\u7528playbook\n\ntest.yml\n---\n- hosts: all\n  become: yes\n  become_user: root\n# Don't gather hosts facts for performance\n  gather_facts: no\n\n# 'vars: to define in playbook Because the priority of 'variable is low,\n# I use the following as a default value. When I overwrite, I define, for example, it in group vars.\n  vars:\n    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n    rpm_src_dr: \"patch\"\n    rpm_dest_dr: \"/opt/work\"\n    rpm_src: \"{{ rpm_src_dr }}/{{ rpm_name }}.rpm\"\n    rpm_dest: \"{{ rpm_dest_dr }}/{{ rpm_name }}.rpm\"\n    check_command: \"rpm -q openssl\"\n\n  tasks:\n  - name: check rpm version\n    command: \"{{ check_command }}\"\n    register: command1_result\n\n  - block:\n      - debug: msg=\"Block START ----------------------\"\n      - name: create directory\n        file: path={{ rpm_dest_dr  }} state=directory\n      - name: copy the file\n        copy: src={{ rpm_src }} dest={{ rpm_dest }} mode=0755\n      - name: install rpm\n        yum: name={{ rpm_dest }} state=present\n      - name: check rpm version\n        command: \"{{ check_command }}\"\n        register: command2_result\n        failed_when: \"'{{ rpm_name }}' not in command2_result.stdout\"\n#        failed_when: command2_result.stdout.find('{{ rpm_name }}') == -1\n      - debug: msg=\"Block END ------------------------\"\n    when: \"'{{ rpm_name }}' not in command1_result.stdout\"\n#    when: command1_result.stdout.find('{{ rpm_name }}') == -1\n\n    rescue:\n      - debug: msg=\"install {{ rpm_name }} is error\"\n\n    always:\n      - debug: msg=\"before {{ check_command }} {{ command1_result.stdout_lines }}\"\n        when: command1_result is defined\n      - debug: msg=\"after  {{ check_command }} {{ command2_result.stdout_lines }}\"\n        when: command2_result is defined\n\n\n\n\n3.1. \u5b9f\u884c\u7d50\u679c1\n\u6307\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306erpm\u304c\u307e\u3060\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u72b6\u6cc1\u304b\u3089\u3001yum\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3059\u308b\u30d1\u30bf\u30fc\u30f3\n\u4ee5\u4e0b\u306f\u53e4\u3044\u3067\u3059\u304c\u3001openssl\u306eheart bleed\u306e\u5bfe\u7b56\u7248\u306bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3092\u884c\u3046\u30b5\u30f3\u30d7\u30eb\n# ansible-playbook -i hosts test.yml -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.067372\", \"end\": \"2016-06-23 14:33:57.949147\", \"rc\": 0, \"start\": \"2016-06-23 14:33:57.881775\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-16.el6_5.4.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-16.el6_5.4.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block START ----------------------\"\n}\n\nTASK [create directory] ********************************************************\nchanged: [localhost] => {\"changed\": true, \"diff\": {\"after\": {\"path\": \"/opt/work\", \"state\": \"directory\"}, \"before\": {\"path\": \"/opt/work\", \"state\": \"absent\"}}, \"gid\": 0, \"group\": \"root\", \"mode\": \"0755\", \"owner\": \"root\", \"path\": \"/opt/work\", \"secontext\": \"unconfined_u:object_r:usr_t:s0\", \"size\": 4096, \"state\": \"directory\", \"uid\": 0}\n\nTASK [copy the file] ***********************************************************\nchanged: [localhost] => {\"changed\": true, \"checksum\": \"a7c21c4303f5efe855133eb40b633fc69d8673ba\", \"dest\": \"/opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"a7a67c0c2c682b19a60d2cfe53e20521\", \"mode\": \"0755\", \"owner\": \"root\", \"secontext\": \"system_u:object_r:usr_t:s0\", \"size\": 1597532, \"src\": \"/root/.ansible/tmp/ansible-tmp-1466660038.73-68923506320964/source\", \"state\": \"file\", \"uid\": 0}\n\nTASK [install rpm] *************************************************************\nchanged: [localhost] => {\"changed\": true, \"msg\": \"Warning: RPMDB altered outside of yum.\\n\", \"rc\": 0, \"results\": [\"Loaded plugins: fastestmirror\\nSetting up Install Process\\nExamining /opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm: openssl-1.0.1e-48.el6_8.1.x86_64\\nMarking /opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm as an update to openssl-1.0.1e-16.el6_5.4.x86_64\\nDetermining fastest mirrors\\n * base: ftp.jaist.ac.jp\\n * epel: epel.scopesky.iq\\n * extras: ftp.jaist.ac.jp\\n * updates: ftp.jaist.ac.jp\\nResolving Dependencies\\n--> Running transaction check\\n---> Package openssl.x86_64 0:1.0.1e-16.el6_5.4 will be updated\\n---> Package openssl.x86_64 0:1.0.1e-48.el6_8.1 will be an update\\n--> Finished Dependency Resolution\\n\\nDependencies Resolved\\n\\n================================================================================\\n Package  Arch    Version              Repository                          Size\\n================================================================================\\nUpdating:\\n openssl  x86_64  1.0.1e-48.el6_8.1    /openssl-1.0.1e-48.el6_8.1.x86_64  4.0 M\\n\\nTransaction Summary\\n================================================================================\\nUpgrade       1 Package(s)\\n\\nTotal size: 4.0 M\\nDownloading Packages:\\nRunning rpm_check_debug\\nRunning Transaction Test\\nTransaction Test Succeeded\\nRunning Transaction\\n\\r  Updating   : openssl-1.0.1e-48.el6_8.1.x86_64                             1/2 \\n\\r  Cleanup    : openssl-1.0.1e-16.el6_5.4.x86_64                             2/2 \\n\\r  Verifying  : openssl-1.0.1e-48.el6_8.1.x86_64                             1/2 \\n\\r  Verifying  : openssl-1.0.1e-16.el6_5.4.x86_64                             2/2 \\n\\nUpdated:\\n  openssl.x86_64 0:1.0.1e-48.el6_8.1                                            \\n\\nComplete!\\n\"]}\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.105701\", \"end\": \"2016-06-23 14:35:03.346040\", \"failed\": false, \"failed_when_result\": false, \"rc\": 0, \"start\": \"2016-06-23 14:35:03.240339\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block END ------------------------\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"before rpm -q openssl [u'openssl-1.0.1e-16.el6_5.4.x86_64']\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"after  rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=9    changed=5    unreachable=0    failed=0\n\n#\n\n\n3.2. \u5b9f\u884c\u7d50\u679c2\n\u3059\u3067\u306bheart bleed\u5bfe\u7b56\u6e08\u307f\u306e\u8a72\u5f53\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\u306e\u307f\u3092\u5b9f\u65bd\u3057\u3066\u5f8c\u306fblock:\u3054\u3068\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u30d1\u30bf\u30fc\u30f3\n# ansible-playbook -i hosts test.yml -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.103351\", \"end\": \"2016-06-23 14:45:07.905116\", \"rc\": 0, \"start\": \"2016-06-23 14:45:07.801765\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [create directory] ********************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [copy the file] ***********************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [install rpm] *************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [check rpm version] *******************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=1    changed=1    unreachable=0    failed=0\n\n#\n\n\n3.3. \u5b9f\u884c\u7d50\u679c3\n\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3088\u308a\u3082\u4e0b\u4f4d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002yum\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5b9f\u884c\u306f\u6210\u529f\u3059\u308b\u304c\u3001\u304a\u305d\u3089\u304f\u4f9d\u5b58\u306e\u95a2\u4fc2\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u30c0\u30a6\u30f3\u304c\u5931\u6557\u3057\u3066\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5b9f\u65bd\u524d\u3068\u5909\u308f\u3089\u306a\u3044\u30d1\u30bf\u30fc\u30f3\uff08rescue:\u3068always:\u304c\u8868\u793a\u3055\u308c\u308b\uff09\n\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001--extra-vars\u3092\u5229\u7528\u3057\u3066\u3001\u5909\u6570rpm_name\u3092\u4e0a\u66f8\u304d\u3057\u3066\u3044\u308b\n# ansible-playbook -i hosts test.yml --extra-vars \"rpm_name='openssl-1.0.1e-42.el6_7.1.x86_64'\" -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.100630\", \"end\": \"2016-06-23 14:48:41.170714\", \"rc\": 0, \"start\": \"2016-06-23 14:48:41.070084\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block START ----------------------\"\n}\n\nTASK [create directory] ********************************************************\nok: [localhost] => {\"changed\": false, \"diff\": {\"after\": {\"path\": \"/opt/work\"}, \"before\": {\"path\": \"/opt/work\"}}, \"gid\": 0, \"group\": \"root\", \"mode\": \"0755\", \"owner\": \"root\", \"path\": \"/opt/work\", \"secontext\": \"unconfined_u:object_r:usr_t:s0\", \"size\": 4096, \"state\": \"directory\", \"uid\": 0}\n\nTASK [copy the file] ***********************************************************\nchanged: [localhost] => {\"changed\": true, \"checksum\": \"4dfba9eb2f646d1fd6fe4ad4ea3e4b38cf9a8ee8\", \"dest\": \"/opt/work/openssl-1.0.1e-42.el6_7.1.x86_64.rpm\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"eb23ba2042b7a7e551e09e16204a00d6\", \"mode\": \"0755\", \"owner\": \"root\", \"secontext\": \"system_u:object_r:usr_t:s0\", \"size\": 1594240, \"src\": \"/root/.ansible/tmp/ansible-tmp-1466660921.9-217212016697998/source\", \"state\": \"file\", \"uid\": 0}\n\nTASK [install rpm] *************************************************************\nok: [localhost] => {\"changed\": false, \"msg\": \"\", \"rc\": 0, \"results\": [\"/opt/work/openssl-1.0.1e-42.el6_7.1.x86_64.rpm: Nothing to do\"]}\n\nTASK [check rpm version] *******************************************************\nfatal: [localhost]: FAILED! => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.087934\", \"end\": \"2016-06-23 14:48:43.558321\", \"failed\": true, \"failed_when_result\": true, \"rc\": 0, \"start\": \"2016-06-23 14:48:43.470387\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"install openssl-1.0.1e-42.el6_7.1.x86_64 is error\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"before rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"after  rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=8    changed=2    unreachable=0    failed=0\n\n#\n\n# 0.\u306f\u3058\u3081\u306b\n\nAnsible\u3067\n\n + \u3042\u308b\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u3092\u5143\u306b\u51e6\u7406\u3092\u5207\u308a\u5206\u3051\u305f\u3044\n + \u3042\u308b\u7279\u5b9a\u306e\u6761\u4ef6\u3067\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u51e6\u7406\u306f\u6210\u529f\u3057\u3066\u3082\u601d\u3063\u305f\u901a\u308a\u306e\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u30c1\u30a7\u30c3\u30af\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3001\u305d\u306e\u7d50\u679c\u306b\u3088\u3063\u3066\u306f\u51e6\u7406\u3092faild\u3067\u30a8\u30e9\u30fc\u3068\u3057\u305f\u3044\n\n\u3068\u3044\u3046\u601d\u3044\u304b\u3089\u3001\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306b\u3064\u3044\u3066 CentOS6\u4e0a\u3067\u306eopenssl\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1(\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8)\u306eyum\u306e\u30ed\u30fc\u30ab\u30eb\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f8b\u3068\u3057\u3066\nblock:/rescue:/always:\u306e\u52d5\u4f5c\u3082\u5408\u308f\u305b\u3066\u52d5\u4f5c\u691c\u8a3c\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n\n1.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3059\u308b\uff08\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306fskip\u3059\u308b\uff09\n  + `when: \"'\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217' not in command1_result.stdout\"`\n  + `when: command1_result.stdout.find('\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217') == -1`\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u4eca\u56de\u306f `not in`\u3092\u691c\u8a3c\n\n2.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3092failed\u3055\u305b\u308b\n  + `faild_when: \"'\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217' not in command2_result.stdout\"`\n  + `faild_when: command2_result.stdout.find('\u8a55\u4fa1\u3057\u305f\u3044\u6587\u5b57\u5217') == -1`\u3082\u540c\u3058\u3067\u3059\u304c\u3001\u4eca\u56de\u306f `not in`\u3092\u691c\u8a3c\n  \n## 1.1. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u51e6\u7406\u3059\u308b\uff08\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306fskip\u3059\u308b\uff09\n\u4ee5\u4e0b\u306f\u5909\u6570\uff08check_command\uff09\u3067\u5b9a\u7fa9\u3001\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306e\u6a19\u6e96\u51fa\u529b\uff08command1_result.stdout\uff09\u306b\u5909\u6570\uff08rpm_name\uff09\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\u5b9f\u884c\u3057\u3001\u5165\u3063\u3066\u3044\u308c\u3070\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\n\u203b `not in` \u306e\u90e8\u5206\u3092`in`\u3000\u3068\u3059\u308c\u3070\u9006\u306e\u610f\u5473\u3067\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n#  vars:\n#    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n#    check_command: \"rpm -q openssl\"\n  - name: check rpm version\n    command: \"{{ check_command }}\"\n    register: command1_result\n  - block:\n# \u4e2d\u7565 \uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n    when: \"'{{ rpm_name }}' not in command1_result.stdout\"\n#    when: command1_result.stdout.find('{{ rpm_name }}') == -1\n```\n\n## 1.2.\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306b\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u306a\u3051\u308c\u3070\uff08\u9006\u3082\u53ef\u80fd\uff09\u51e6\u7406\u3092failed\u3055\u305b\u308b\n\u4ee5\u4e0b\u306f\u5909\u6570\uff08check_command\uff09\u3067\u5b9a\u7fa9\u3001\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u306e\u6a19\u6e96\u51fa\u529b\uff08command2_result.stdout\uff09\u306b\u5909\u6570\uff08rpm_name\uff09\u3067\u6307\u5b9a\u3057\u305f\u6587\u5b57\u5217\u304c\u306a\u3051\u308c\u3070faild\u3068\u3059\u308b\u51e6\u7406\u3002\u4eca\u56de\u306fblock\u5185\u3067\u306e\u6700\u7d42\u5224\u5b9a\u3067\u5229\u7528\u3002\n\u203b `not in` \u306e\u90e8\u5206\u3092`in`\u3000\u3068\u3059\u308c\u3070\u9006\u306e\u610f\u5473\u3067\u7279\u5b9a\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n#  vars:\n#    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n#    check_command: \"rpm -q openssl\"\n      - name: check rpm version\n        command: \"{{ check_command }}\"\n        register: command2_result\n        failed_when: \"'{{ rpm_name }}' not in command2_result.stdout\"\n#        failed_when: command2_result.stdout.find('{{ rpm_name }}') == -1\n```\n\n## 2.1. \u5b9f\u884c\u74b0\u5883\n\u7c21\u7565\u5316\u3059\u308b\u305f\u3081\u3001Ansible \u5b9f\u884c\u30b5\u30fc\u30d0 \u53ca\u3073 Ansible\u30bf\u30fc\u30b2\u30c3\u30c8\u30db\u30b9\u30c8\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30d1\u30c3\u30c1\u306eopenssl\u306erpm\u306b\u3064\u3044\u3066\u306f\u4e8b\u524d\u306bpatch\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n# cat /etc/redhat-release\nCentOS release 6.7 (Final)\n# ansible --version\nansible 2.1.0 (devel d358a22542) last updated 2016/04/04 23:43:05 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD a38bdfc720) last updated 2016/04/04 23:43:15 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 7c3999a92a) last updated 2016/04/04 23:43:22 (GMT +900)\n  config file = /opt/qiita/patch/ex1/ansible.cfg\n  configured module search path = Default w/o overrides\n# tree patch/\npatch/\n- openssl-1.0.1e-16.el6_5.4.x86_64.rpm\n- openssl-1.0.1e-42.el6_7.1.x86_64.rpm\n- openssl-1.0.1e-48.el6_8.1.x86_64.rpm\n```\n\n## 2.2 \u30b5\u30f3\u30d7\u30eb playbook\u7b49\n\n\u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\n\u81ea\u5206\u81ea\u8eab\u306b\u5bfe\u3057\u3066\u5b9f\u65bd\n\n``` hosts\n[local]\nlocalhost ansible_connection=local\n```\n\n\u30c6\u30b9\u30c8\u7528playbook\n\n``` test.yml\n---\n- hosts: all\n  become: yes\n  become_user: root\n# Don't gather hosts facts for performance\n  gather_facts: no\n\n# 'vars: to define in playbook Because the priority of 'variable is low,\n# I use the following as a default value. When I overwrite, I define, for example, it in group vars.\n  vars:\n    rpm_name: \"openssl-1.0.1e-48.el6_8.1.x86_64\"\n    rpm_src_dr: \"patch\"\n    rpm_dest_dr: \"/opt/work\"\n    rpm_src: \"{{ rpm_src_dr }}/{{ rpm_name }}.rpm\"\n    rpm_dest: \"{{ rpm_dest_dr }}/{{ rpm_name }}.rpm\"\n    check_command: \"rpm -q openssl\"\n\n  tasks:\n  - name: check rpm version\n    command: \"{{ check_command }}\"\n    register: command1_result\n\n  - block:\n      - debug: msg=\"Block START ----------------------\"\n      - name: create directory\n        file: path={{ rpm_dest_dr  }} state=directory\n      - name: copy the file\n        copy: src={{ rpm_src }} dest={{ rpm_dest }} mode=0755\n      - name: install rpm\n        yum: name={{ rpm_dest }} state=present\n      - name: check rpm version\n        command: \"{{ check_command }}\"\n        register: command2_result\n        failed_when: \"'{{ rpm_name }}' not in command2_result.stdout\"\n#        failed_when: command2_result.stdout.find('{{ rpm_name }}') == -1\n      - debug: msg=\"Block END ------------------------\"\n    when: \"'{{ rpm_name }}' not in command1_result.stdout\"\n#    when: command1_result.stdout.find('{{ rpm_name }}') == -1\n\n    rescue:\n      - debug: msg=\"install {{ rpm_name }} is error\"\n\n    always:\n      - debug: msg=\"before {{ check_command }} {{ command1_result.stdout_lines }}\"\n        when: command1_result is defined\n      - debug: msg=\"after  {{ check_command }} {{ command2_result.stdout_lines }}\"\n        when: command2_result is defined\n```\n\n---\n\n## 3.1. \u5b9f\u884c\u7d50\u679c1\n\u6307\u5b9a\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306erpm\u304c\u307e\u3060\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u72b6\u6cc1\u304b\u3089\u3001yum\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3059\u308b\u30d1\u30bf\u30fc\u30f3\n\u4ee5\u4e0b\u306f\u53e4\u3044\u3067\u3059\u304c\u3001[openssl\u306eheart bleed](http://heartbleed.com/)\u306e\u5bfe\u7b56\u7248\u306bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3092\u884c\u3046\u30b5\u30f3\u30d7\u30eb\n\n```\n# ansible-playbook -i hosts test.yml -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.067372\", \"end\": \"2016-06-23 14:33:57.949147\", \"rc\": 0, \"start\": \"2016-06-23 14:33:57.881775\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-16.el6_5.4.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-16.el6_5.4.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block START ----------------------\"\n}\n\nTASK [create directory] ********************************************************\nchanged: [localhost] => {\"changed\": true, \"diff\": {\"after\": {\"path\": \"/opt/work\", \"state\": \"directory\"}, \"before\": {\"path\": \"/opt/work\", \"state\": \"absent\"}}, \"gid\": 0, \"group\": \"root\", \"mode\": \"0755\", \"owner\": \"root\", \"path\": \"/opt/work\", \"secontext\": \"unconfined_u:object_r:usr_t:s0\", \"size\": 4096, \"state\": \"directory\", \"uid\": 0}\n\nTASK [copy the file] ***********************************************************\nchanged: [localhost] => {\"changed\": true, \"checksum\": \"a7c21c4303f5efe855133eb40b633fc69d8673ba\", \"dest\": \"/opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"a7a67c0c2c682b19a60d2cfe53e20521\", \"mode\": \"0755\", \"owner\": \"root\", \"secontext\": \"system_u:object_r:usr_t:s0\", \"size\": 1597532, \"src\": \"/root/.ansible/tmp/ansible-tmp-1466660038.73-68923506320964/source\", \"state\": \"file\", \"uid\": 0}\n\nTASK [install rpm] *************************************************************\nchanged: [localhost] => {\"changed\": true, \"msg\": \"Warning: RPMDB altered outside of yum.\\n\", \"rc\": 0, \"results\": [\"Loaded plugins: fastestmirror\\nSetting up Install Process\\nExamining /opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm: openssl-1.0.1e-48.el6_8.1.x86_64\\nMarking /opt/work/openssl-1.0.1e-48.el6_8.1.x86_64.rpm as an update to openssl-1.0.1e-16.el6_5.4.x86_64\\nDetermining fastest mirrors\\n * base: ftp.jaist.ac.jp\\n * epel: epel.scopesky.iq\\n * extras: ftp.jaist.ac.jp\\n * updates: ftp.jaist.ac.jp\\nResolving Dependencies\\n--> Running transaction check\\n---> Package openssl.x86_64 0:1.0.1e-16.el6_5.4 will be updated\\n---> Package openssl.x86_64 0:1.0.1e-48.el6_8.1 will be an update\\n--> Finished Dependency Resolution\\n\\nDependencies Resolved\\n\\n================================================================================\\n Package  Arch    Version              Repository                          Size\\n================================================================================\\nUpdating:\\n openssl  x86_64  1.0.1e-48.el6_8.1    /openssl-1.0.1e-48.el6_8.1.x86_64  4.0 M\\n\\nTransaction Summary\\n================================================================================\\nUpgrade       1 Package(s)\\n\\nTotal size: 4.0 M\\nDownloading Packages:\\nRunning rpm_check_debug\\nRunning Transaction Test\\nTransaction Test Succeeded\\nRunning Transaction\\n\\r  Updating   : openssl-1.0.1e-48.el6_8.1.x86_64                             1/2 \\n\\r  Cleanup    : openssl-1.0.1e-16.el6_5.4.x86_64                             2/2 \\n\\r  Verifying  : openssl-1.0.1e-48.el6_8.1.x86_64                             1/2 \\n\\r  Verifying  : openssl-1.0.1e-16.el6_5.4.x86_64                             2/2 \\n\\nUpdated:\\n  openssl.x86_64 0:1.0.1e-48.el6_8.1                                            \\n\\nComplete!\\n\"]}\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.105701\", \"end\": \"2016-06-23 14:35:03.346040\", \"failed\": false, \"failed_when_result\": false, \"rc\": 0, \"start\": \"2016-06-23 14:35:03.240339\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block END ------------------------\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"before rpm -q openssl [u'openssl-1.0.1e-16.el6_5.4.x86_64']\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"after  rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=9    changed=5    unreachable=0    failed=0\n\n#\n```\n\n## 3.2. \u5b9f\u884c\u7d50\u679c2\n\u3059\u3067\u306bheart bleed\u5bfe\u7b56\u6e08\u307f\u306e\u8a72\u5f53\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\u306e\u307f\u3092\u5b9f\u65bd\u3057\u3066\u5f8c\u306fblock:\u3054\u3068\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u30d1\u30bf\u30fc\u30f3\n\n```\n# ansible-playbook -i hosts test.yml -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.103351\", \"end\": \"2016-06-23 14:45:07.905116\", \"rc\": 0, \"start\": \"2016-06-23 14:45:07.801765\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [create directory] ********************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [copy the file] ***********************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [install rpm] *************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [check rpm version] *******************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nTASK [debug] *******************************************************************\nskipping: [localhost] => {\"changed\": false, \"skip_reason\": \"Conditional check failed\", \"skipped\": true}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=1    changed=1    unreachable=0    failed=0\n\n#\n```\n\n## 3.3. \u5b9f\u884c\u7d50\u679c3\n\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3088\u308a\u3082\u4e0b\u4f4d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002yum\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5b9f\u884c\u306f\u6210\u529f\u3059\u308b\u304c\u3001\u304a\u305d\u3089\u304f\u4f9d\u5b58\u306e\u95a2\u4fc2\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u30c0\u30a6\u30f3\u304c\u5931\u6557\u3057\u3066\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u5b9f\u65bd\u524d\u3068\u5909\u308f\u3089\u306a\u3044\u30d1\u30bf\u30fc\u30f3\uff08rescue:\u3068always:\u304c\u8868\u793a\u3055\u308c\u308b\uff09\n\u30d0\u30fc\u30b8\u30e7\u30f3\u6307\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001--extra-vars\u3092\u5229\u7528\u3057\u3066\u3001\u5909\u6570rpm_name\u3092\u4e0a\u66f8\u304d\u3057\u3066\u3044\u308b\n\n```\n# ansible-playbook -i hosts test.yml --extra-vars \"rpm_name='openssl-1.0.1e-42.el6_7.1.x86_64'\" -v\nUsing /etc/ansible/ansible.cfg as config file\n\nPLAY ***************************************************************************\n\nTASK [check rpm version] *******************************************************\nchanged: [localhost] => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.100630\", \"end\": \"2016-06-23 14:48:41.170714\", \"rc\": 0, \"start\": \"2016-06-23 14:48:41.070084\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n [WARNING]: Consider using yum, dnf or zypper module rather than running rpm\n\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"Block START ----------------------\"\n}\n\nTASK [create directory] ********************************************************\nok: [localhost] => {\"changed\": false, \"diff\": {\"after\": {\"path\": \"/opt/work\"}, \"before\": {\"path\": \"/opt/work\"}}, \"gid\": 0, \"group\": \"root\", \"mode\": \"0755\", \"owner\": \"root\", \"path\": \"/opt/work\", \"secontext\": \"unconfined_u:object_r:usr_t:s0\", \"size\": 4096, \"state\": \"directory\", \"uid\": 0}\n\nTASK [copy the file] ***********************************************************\nchanged: [localhost] => {\"changed\": true, \"checksum\": \"4dfba9eb2f646d1fd6fe4ad4ea3e4b38cf9a8ee8\", \"dest\": \"/opt/work/openssl-1.0.1e-42.el6_7.1.x86_64.rpm\", \"gid\": 0, \"group\": \"root\", \"md5sum\": \"eb23ba2042b7a7e551e09e16204a00d6\", \"mode\": \"0755\", \"owner\": \"root\", \"secontext\": \"system_u:object_r:usr_t:s0\", \"size\": 1594240, \"src\": \"/root/.ansible/tmp/ansible-tmp-1466660921.9-217212016697998/source\", \"state\": \"file\", \"uid\": 0}\n\nTASK [install rpm] *************************************************************\nok: [localhost] => {\"changed\": false, \"msg\": \"\", \"rc\": 0, \"results\": [\"/opt/work/openssl-1.0.1e-42.el6_7.1.x86_64.rpm: Nothing to do\"]}\n\nTASK [check rpm version] *******************************************************\nfatal: [localhost]: FAILED! => {\"changed\": true, \"cmd\": [\"rpm\", \"-q\", \"openssl\"], \"delta\": \"0:00:00.087934\", \"end\": \"2016-06-23 14:48:43.558321\", \"failed\": true, \"failed_when_result\": true, \"rc\": 0, \"start\": \"2016-06-23 14:48:43.470387\", \"stderr\": \"\", \"stdout\": \"openssl-1.0.1e-48.el6_8.1.x86_64\", \"stdout_lines\": [\"openssl-1.0.1e-48.el6_8.1.x86_64\"], \"warnings\": [\"Consider using yum, dnf or zypper module rather than running rpm\"]}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"install openssl-1.0.1e-42.el6_7.1.x86_64 is error\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"before rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nTASK [debug] *******************************************************************\nok: [localhost] => {\n    \"msg\": \"after  rpm -q openssl [u'openssl-1.0.1e-48.el6_8.1.x86_64']\"\n}\n\nPLAY RECAP *********************************************************************\nlocalhost                  : ok=8    changed=2    unreachable=0    failed=0\n\n#\n```\n", "tags": ["Ansible", "CentOS", "\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3", "devops", "infrastructure"]}