{"tags": ["PHP5.4", "PHPUnit4.8.31", "DBUnit", "PostgreSQL9.2.15", "SQL"], "context": "\n\n \u7d50\u8ad6\n\n\nPHPUnit_Extensions_Database_TestCase\u30af\u30e9\u30b9\u306e\u521d\u671f\u5316\u51e6\u7406\u3067\u306f\u3001\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u3042\u308b\u3068\u3046\u307e\u304f\u521d\u671f\u5316\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308b\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3067TRUNCATE\u51e6\u7406\u306bCASCADE\u3092\u8ffd\u52a0\u3067\u304d\u308b\u304c\u3001\u5916\u90e8\u304b\u3089\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u306f\u5236\u5fa1\u3067\u304d\u306a\u3044\n\u5f15\u6570\u306a\u3057\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u3001CASCADE\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3084\u308b\n\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase\n{\n    protected function getSetUpOperation()\n    {\n        // \u5f15\u6570\u306btrue\u3092\u6e21\u3059\u3088\u3046\u306b\u4e0a\u66f8\u304d\n        return \\PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT(true);\n    }\n\n    public function setUp()\n    {\n        parent::setUp();\n    }\n}\n\n\n \u6982\u8981\n\n\u672c\u756a\u3068\u540c\u4e00\u306e\u30c6\u30fc\u30d6\u30eb\u69cb\u9020\u3067\u30c6\u30b9\u30c8\u7528\u306eDB\u3092Postgres\u3067\u4f5c\u308b\n\u5916\u90e8\u30ad\u30fc\u304c\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u76ee\u7684\u30ec\u30b3\u30fc\u30c9\u4ee5\u5916\u306e\u4f9d\u5b58\u3059\u308b\u30c0\u30df\u30fc\u30ec\u30b3\u30fc\u30c9\u3082\u4f5c\u308b\u51e6\u7406\u3092\u542b\u3081\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u30d5\u30a3\u30af\u30b9\u30c1\u30e3(\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8)\u3092\u7528\u610f\u3059\u308b\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\n\n\u5916\u90e8\u30ad\u30fc\u304c\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u8a18\u8ff0\u9806\u3082\u9806\u756a\u306b\u66f8\u304b\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\n\u30c6\u30b9\u30c8\u7d42\u4e86\u5f8c\u306e\u30af\u30ea\u30fc\u30f3\u30ca\u30c3\u30d7\u6642\u306b\u3001\u524a\u9664\u30a8\u30e9\u30fc\u304c\u51fa\u308b\n\u89e3\u6d88\u3057\u305f\u3044\uff01\nCASCADE\u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u3070\u4f9d\u5b58\u95a2\u4fc2\u3092\u81ea\u52d5\u7684\u306b\u8fbf\u3063\u3066\u524a\u9664\u3057\u3066\u304f\u308c\u308b\n\n\n \u691c\u8a3c\u74b0\u5883\n\nPHP5.4\nPHPUnit 4.8.31\nphpunit/dbunit 2.0.3\nPostgres 9.2.15\n\n\n \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u90e8\u5206\u30b5\u30f3\u30d7\u30eb\n(\u3053\u308c\u3060\u3051\u3067\u306f\u3046\u3054\u304d\u307e\u305b\u3093)\n\u521d\u5fc3\u8005\u306a\u306e\u3067\u57fa\u672c\u7684\u306a\u30de\u30cb\u30e5\u30a2\u30eb\u901a\u308a\u3067\u3059\u3002\nPHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8\u5168\u4f53\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase // \u2190DBUnit\u306e\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3059\u308b\n{\n\n    /** @var \\PDO PDO \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u304a\u3088\u3073\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u8aad\u307f\u8fbc\u307f\u306e\u3068\u304d\u306b\u4e00\u5ea6\u3060\u3051 */\n    static private $pdo = null;\n    /** @var PHPUnit_Extensions_Database_DB_IDatabaseConnection \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u4e00\u5ea6\u3060\u3051 */\n    private $conn = null;\n\n    /* @var \\Hoge */\n    private $instance;\n\n    /**\n     * Returns the test database connection.\n     *\n     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection\n     */\n    protected function getConnection()\n    {\n        if ($this->conn !== null) {\n            return $this->conn;\n        }\n        if (self::$pdo == null) {\n            // $GLOBALS\u306fphpunit.xml\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\n            self::$pdo = new \\PDO($GLOBALS['DB_DSN'], $GLOBALS['DB_USER'], $GLOBALS['DB_PASSWD']);\n        }\n        $this->conn = $this->createDefaultDBConnection(self::$pdo, $GLOBALS['DB_DBNAME']);\n        return $this->conn;\n    }\n\n    /**\n     * Returns the test dataset.\n     *\n     * @return PHPUnit_Extensions_Database_DataSet_IDataSet\n     */\n    protected function getDataSet()\n    {\n        $dataset = [\n            '\u30c6\u30fc\u30d6\u30eb' => [\n                [\n                    '\u30ab\u30e9\u30e01'     => '\u5024',\n                    '\u30ab\u30e9\u30e02'     => '\u5024',\n                ],\n            ],\n        ];\n        // \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u914d\u5217\u3067\u5b9a\u7fa9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067yaml\u3068\u304b\u899a\u3048\u306a\u304f\u3066\u826f\u304f\u306a\u3063\u305f\n        return $this->createArrayDataSet($dataset);\n    }\n\n\n    public function setUp()\n    {\n\u3000\u3000\u3000\u3000 // \u3053\u3053\u3067getDataSet\u304c\u4f7f\u308f\u308c\u3001\u30c6\u30fc\u30d6\u30eb\u304c\u4e00\u65e6\u7a7a\u306b\u306a\u308a\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304cINSERT\u3055\u308c\u308b\n        parent::setUp();\n        $this->instance = new Hoge();\n    }\n\n    public function testHoge()\n    {\n        $this->assertTrue(true);\n    }\n}\n\n\n\n\u52d5\u304b\u3059\u3068\u3053\u3093\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n1) HogeTest::testHoge\nPHPUnit_Extensions_Database_Operation_Exception: COMPOSITE[TRUNCATE] operation failed on query:\n                TRUNCATE \"\u30c6\u30fc\u30d6\u30eb\"\n             using args: Array\n(\n)\n [SQLSTATE[0A000]: Feature not supported: 7 ERROR:  cannot truncate a table referenced in a foreign key constraint\nDETAIL:  Table \"\u30c6\u30fc\u30d6\u30ebA\" references \"\u30c6\u30fc\u30d6\u30ebB\".\nHINT:  Truncate table \"\u30c6\u30fc\u30d6\u30eb\" at the same time, or use TRUNCATE ... CASCADE.]\n\n\n(at the same time\u306a\u3069\u3068\u3042\u308b\u306e\u3067)\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u4e26\u3073\u9806\u3092\u5909\u3048\u305f\u308a\u3057\u3066\u3082\u5909\u308f\u3089\u306a\u304b\u3063\u305f\u308a\u5225\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001\u65b9\u5411\u6027\u3092\u5909\u3048\u308b\n\n \u30cd\u30c3\u30c8\u3067\u8abf\u3079\u308b\nTruncate\u3068\u304b\u77e5\u3089\u306a\u3044\u3057\u3001\u3068\u308a\u3042\u3048\u305aforeign key\u304c\u95a2\u4fc2\u3057\u305d\u3046\u306a\u306e\u3067\u305d\u3053\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8 + phpunit\u3067\u30b0\u30b0\u308b\u3002\nphp - PHPUnit and MySQL truncation error - Stack Overflow\n\u30ca\u30eb\u30db\u30c9\uff01\u4e00\u6642\u7684\u306bforeign key\u30c1\u30a7\u30c3\u30af\u3092\u7121\u52b9\u306b\u3057\u3066\u3001\u3042\u3068\u3067\u3082\u3068\u306b\u623b\u305b\u3070\u3044\u3044\u306e\u304b\uff01\nmysql\u307f\u305f\u3044\u306a\u30af\u30a8\u30ea\u306fpsql\u3067\u306f\u3069\u3046\u3059\u308b\u3093\u3060\u3068\u8abf\u3079\u308b\u3002\nforeign key \u7121\u52b9 postgres\n\u3068\u304b\u3067\u8abf\u3079\u308b\nPostgreSQL - PostgreSQL\u3067\u65e2\u5b58\u306e\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306bCASCADE\u7b49\u306e\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3057\u305f\u3044(17854)\uff5cteratail\nPostgreSQL\u3067\u5916\u90e8\u30ad\u30fc(FK)\u3092\u3059\u3079\u3066\u524a\u9664\u3059\u308b\u65b9\u6cd5 - Qiita\n\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306f\u91cd\u8377\u306b\u306a\u308b\u304b - iakio\u306e\u65e5\u8a18\nmysql\u3067\u306f\u30af\u30a8\u30ea\u4e00\u767a\u3067\u5168\u4f53\u3092\u30c1\u30a7\u30c3\u30af\u304b\u3089\u5916\u3057\u305f\u308a\u3064\u3051\u305f\u308a\u3067\u304d\u308b\u304c\u3001postgres\u3067\u306f\u3072\u3068\u3064\u3072\u3068\u3064\u6d88\u3057\u3066\u3064\u3051\u306a\u304a\u3057\u3066\u3092\u3059\u308b\u304b\u3001DB\u5074\u306b\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\u3092\u3064\u3051\u306a\u3051\u308c\u3070\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3089\u3057\u3044\u3002\n\u3069\u3063\u3061\u3082\u5acc\u3060\u306a\u2026\n\n \u653b\u3081\u65b9\u3092\u5909\u3048\u308b\nforeign key\u30c1\u30a7\u30c3\u30af\u3067\u306f\u96e3\u3057\u305d\u3046\u306a\u306e\u3067\u3001\u540c\u6642\u306b\u51fa\u3066\u3044\u305f\u30d2\u30f3\u30c8\u304b\u3089\u8003\u3048\u3066\u307f\u308b\u3002\n\nHINT:  Truncate table \"\u30c6\u30fc\u30d6\u30eb\" at the same time, or use TRUNCATE ... CASCADE.]\n\nTRUNCATE\u3082CASCADE\u3082\u77e5\u3089\u306a\u3044\u306e\u3067\u8abf\u3079\u308b\u3002(\u3069\u3046\u306a\u3093\u3060\u305d\u308c\u306f)\nTRUNCATE\u3068DELETE\u306e\u9055\u3044 | \u30a2\u30e9\u30a4\u30c9\u30a2\u30fc\u30ad\u30c6\u30af\u30c4 \u30a8\u30f3\u30b8\u30cb\u30a2\u30d6\u30ed\u30b0\n\n\u30fbTRUNCATE\u3067\u306fDROP TABLE\u3092\u884c\u3063\u305f\u4e0a\u3067\u518d\u5ea6\u540c\u3058\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\u30fbAUTO_INCREMENT\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306fAUTO_INCREMENT\u306e\u5024\u306f\u521d\u671f\u5316\u3055\u308c\u308b\n\u30fbROLLBACK\u3067\u304d\u306a\u3044\n\n\u306a\u308b\u307b\u3069 \u5168\u524a\u9664\u2192\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u53cd\u6620 \u306e\u5168\u524a\u9664\u90e8\u5206\u306e\u62c5\u5f53\u3002\nAUTO_INCREMENT\u30ba\u30ec\u306a\u3044\u306e\uff1f\u3068\u3044\u3046\u8b0e\u3082\u89e3\u6c7a\u3002\nPostgreSQL 9.1.5\u6587\u66f8 TRUNCATE\n\nCASCADE\n\u6307\u5b9a\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3001\u307e\u305f\u306f\u3001CASCADE\u306b\u3088\u308a\u524a\u9664\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u3068\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u5916\u90e8\u30ad\u30fc\u3092\u6301\u3064\u30c6\u30fc\u30d6\u30eb\u3059\u3079\u3066\u3092\u81ea\u52d5\u7684\u306b\u7a7a\u306b\u3057\u307e\u3059\u3002 \n\nDB\u5074\u3067\u81ea\u52d5\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b\u4fbf\u5229\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3057\u305f\u3002\n\n\u305d\u306e\u30c6\u30fc\u30d6\u30eb\u304c\u4ed6\u306e\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5916\u90e8\u30ad\u30fc\u3067\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u30011\u3064\u306eTRUNCATE\u3067\u305d\u308c\u3089\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u3059\u3079\u3066\u7a7a\u306b\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u9650\u308a\u3001TRUNCATE\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u3053\u306e\u3088\u3046\u306a\u5834\u5408\u306f\u3001\u6709\u52b9\u6027\u3092\u691c\u67fb\u3059\u308b\u305f\u3081\u306b\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u884c\u3046\u306e\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306e\u5229\u70b9\u304c\u306a\u304f\u306a\u308b\u304b\u3089\u3067\u3059\u3002 CASCADE\u3092\u4f7f\u7528\u3057\u3066\u3001\u81ea\u52d5\u7684\u306b\u3059\u3079\u3066\u306e\u4f9d\u5b58\u30c6\u30fc\u30d6\u30eb\u3092\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u3057\u304b\u3057\u3001\u610f\u56f3\u3057\u306a\u3044\u30c7\u30fc\u30bf\u640d\u5931\u306e\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u6642\u306b\u306f\u5341\u5206\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \n\n\u76ee\u7684\u306f\u5168\u30c6\u30fc\u30d6\u30eb\u3092\u7a7a\u306b\u3059\u308b\u3053\u3068\u306a\u306e\u3067\u5927\u4e08\u592b\uff01\n\n PHPUnit\u306e\u521d\u671f\u5316\u306e\u5b9f\u88c5\u3092\u898b\u308b\n\u30d2\u30f3\u30c8\u3092\u898b\u308b\u306b\u3001CASCADE\u3092\u8ffd\u52a0\u3057\u3066\u3084\u308c\u3070\u3044\u3044\u306e\u3060\u304b\u3089\u3001\u307e\u305a\u306f\u3069\u3053\u3067TRUNCATE\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u8abf\u3079\u308b\u3002\n\u3068\u3044\u3063\u3066\u3082\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306esetUp()\u3067\u3042\u308b\u3053\u3068\u306f\u308f\u304b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7d99\u627f\u5143\u3092\u8ffd\u3063\u3066\u3044\u304f\u3060\u3051\u3002PhpStorm\u306a\u308aIDE\u3092\u4f7f\u3048\u3070\u7c21\u5358\u3002\n\u2026\u306a\u306e\u3060\u304c\u3001dbunit\u306ftrait\u99c6\u52d5\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001extends\u3060\u3051\u8ffd\u3048\u3070\u898b\u843d\u3068\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3060\u3002\n\u8ffd\u3046\u306a\u3089use\u3060\u304c\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306bsetUp()\u3092\u66f8\u3044\u3066IDE\u3067\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u5143\u3092\u691c\u77e5\u3057\u3066\u3082\u3089\u3063\u3066\u30b8\u30e3\u30f3\u30d7\u3059\u308b\u306a\u3069\u3082\u5c0f\u6280\u306b\u306a\u308a\u305d\u3046\u3060\u3002\n\ncomposer\\vendor\\phpunit\\dbunit\\src\\Extensions\\Database\\TestCaseTrait.php\n\ntrait PHPUnit_Extensions_Database_TestCase_Trait\n{\n    /**\n     * Performs operation returned by getSetUpOperation().\n     */\n    protected function setUp()\n    {\n        parent::setUp();\n\n        $this->databaseTester = NULL;\n\n        $this->getDatabaseTester()->setSetUpOperation($this->getSetUpOperation());\n        $this->getDatabaseTester()->setDataSet($this->getDataSet());\n        $this->getDatabaseTester()->onSetUp();\n    }\n}\n\n\n\n\u30e2\u30c1\u306e\u30ed\u30f3\u4f55\u304c\u66f8\u3044\u3066\u3042\u308b\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\ngetDataSet()\u304c\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u30c6\u30fc\u30d6\u30eb\u72b6\u614b\u3092\u8fd4\u3059\u306e\u3067\u3001\u305d\u306e\u524d\u304c\u7a7a\u306b\u3059\u308b\u51e6\u7406\u3060\u3068\u8003\u3048\u3066\u307f\u308b\u3002\n\n    protected function getSetUpOperation()\n    {\n        return PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT();\n    }\n\n\n\u4f55\u304c\u66f8\u3044\u3066\u3044\u308b\u306e\u304b\u306f\u5206\u304b\u3089\u306a\u3044\u304c\u3001CLEAN_INSERT\u3068\u3044\u3046\u5b57\u9762\u306f\u521d\u671f\u5316\u306b\u898b\u3048\u308b\u3002\n\ncomposer\\vendor\\phpunit\\dbunit\\src\\Extensions\\Database\\Operation\\Factory.php\nclass PHPUnit_Extensions_Database_Operation_Factory\n{\n\n    /**\n     * Returns a clean insert database operation. It will remove all contents\n     * from the table prior to re-inserting rows.\n     *\n     * @param  bool                                                     $cascadeTruncates Set to true to force truncates to cascade on databases that support this.\n     * @return PHPUnit_Extensions_Database_Operation_IDatabaseOperation\n     */\n    public static function CLEAN_INSERT($cascadeTruncates = FALSE)\n    {\n        return new PHPUnit_Extensions_Database_Operation_Composite([\n            self::TRUNCATE($cascadeTruncates),\n            self::INSERT()\n        ]);\n    }\n\n}\n\n\n\n\n$cascadeTruncates = FALSE\u3068\u3044\u3046\u5f15\u6570\u306btrue\u3092\u6e21\u3057\u3066\u3084\u308c\u3070\u826f\u3055\u305d\u3046\u3060\u3002\n\u3057\u304b\u3057\u3001setUp\u3067\u306f\u5f15\u6570\u306a\u3057\u3067\u5b9f\u884c\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u304b\u3089\u3001\u30b3\u30d4\u30da\u3057\u3066\u624b\u52d5\u3067true\u3092\u6e21\u3057\u3066\u3084\u308d\u3046\u3002\nparent::setUp()\u304c\u547c\u3073\u51fa\u305b\u306a\u304f\u306a\u308b\u90fd\u5408\u3001Trait\u3067\u3057\u3066\u3044\u308bparent::setUp()\u3082\u5b9f\u884c\u3055\u308c\u306a\u304f\u306a\u308b\u304c\u3001\u4eca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3088\u308a\u5148\u7956\u306esetUp()\u306b\u306f\u5b9f\u88c5\u304c\u7121\u3044\u306e\u3067\u4eca\u306f\u554f\u984c\u304c\u7121\u3044\u3002\n\n \u4eee\u7d50\u8ad6\n\n\nPHPUnit_Extensions_Database_TestCase\u30af\u30e9\u30b9\u306e\u521d\u671f\u5316\u51e6\u7406\u3067\u306f\u3001\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u3042\u308b\u3068\u3046\u307e\u304f\u521d\u671f\u5316\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308b\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3067TRUNCATE\u51e6\u7406\u306bCASCADE\u3092\u8ffd\u52a0\u3067\u304d\u308b\u304c\u3001\u5916\u90e8\u304b\u3089\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5236\u5fa1\u3067\u304d\u306a\u3044\n\u3088\u3063\u3066\u3001parent::setUp()\u3067\u306f\u306a\u304f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306b\u51e6\u7406\u3092\u30b3\u30d4\u30da\u3057\u3001\u30ab\u30b9\u30b1\u30fc\u30c9\u30c8\u30e9\u30f3\u30b1\u30fc\u30c8\u3092\u6709\u52b9\u5316\u3057\u3066\u3084\u308b\n\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase\n{\n    public function setUp()\n    {\n        // cascade\u524a\u9664\u306e\u305f\u3081\u306b\u624b\u52d5\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\n        $this->databaseTester = NULL;\n        $this->getDatabaseTester()->setSetUpOperation(\\PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT(true));\n        $this->getDatabaseTester()->setDataSet($this->getDataSet());\n        $this->getDatabaseTester()->onSetUp();\n    }\n}\n\n\u3053\u308c\u3067\u4e0a\u624b\u304f\u884c\u3063\u305f\u3002\n\n \u8a18\u4e8b\u3092\u66f8\u304f\n\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u304f\u3002\n\u898b\u305f\u8cc7\u6599\u3092\u66f8\u304f\u305f\u3081\u306b\u3082\u3046\u4e00\u5ea6\u8abf\u3079\u306a\u304a\u3059\u3002\n\u524d\u306f\u76ee\u306b\u5165\u3089\u306a\u304b\u3063\u305f\u8a18\u4e8b\u304c\u76ee\u306b\u5165\u3063\u3066\u304f\u308b\u3002\nTRUNCATE fails on tables which have foreign key constraints \u00b7 Issue #37 \u00b7 sebastianbergmann/dbunit\n\u30b9\u30ec\u672c\u6587\u3068\u6700\u521d\u306e\u30ec\u30b9\u304b\u3089\u307e\u305fMySQL\u304b\u3068\u601d\u3044\u3001\u305d\u308c\u4ee5\u5f8c\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3084\u308a\u53d6\u308a\u3067\u3059\u304c\u3001\u4eca\u898b\u308b\u3068\u30012\u30ec\u30b9\u76ee\u306e\u610f\u5473\u304c\u308f\u304b\u308a\u307e\u3059\u3088\u306d\u3002\n\u30b3\u30d4\u30da\u306a\u3093\u3066\u3064\u3089\u3044\u306a\u30fc\u3068\u601d\u3063\u305f\u3089\u3001\u305f\u3060\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3067\u5f15\u6570\u3092true\u306b\u3059\u308c\u3070\u3044\u3044\u3082\u3088\u3046\u3002\n\u3053\u3093\u306a\u7c21\u5358\u306a\u3053\u3068\u306b\u3082\u6c17\u3065\u304b\u306a\u3044\u306a\u3093\u3066\u3002\n\u5f53\u6642\u306f\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u306e\u526f\u4f5c\u7528\u3092\u61f8\u5ff5\u3057\u305f\u306e\u304b\u306a\uff1f\n\u6700\u5f8c\u306e\nhttps://github.com/sebastianbergmann/dbunit/issues/37#issuecomment-142094486\n\u306a\u3093\u3066\u307e\u3055\u306bPostgres\u306e\u8a71\u984c\u3002MySQL\u306e\u8a71\u984c\u3060\u3068\u601d\u3063\u3066\u6c17\u3092\u629c\u304f\u3053\u3068\u306a\u304b\u308c\u3002\n1\u30ec\u30b9\u76ee\u306e\nPHPUnit_Extensions_Database_Operation_Truncate\n\u3092\u53c2\u7167\u3059\u308b\u3068\u3001\u307e\u3055\u306bTruncate\u306e\u305f\u3081\u306e\u30af\u30e9\u30b9\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u8907\u96d1\u306a\u306e\u3067\u624b\u3092\u51fa\u3057\u307e\u305b\u3093\u3002CLEAN_INSERT\u3067\u9593\u63a5\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3057\u3002\n\u3088\u3063\u3066\u3001\u7d50\u8ad6\u306e\u30b3\u30fc\u30c9\u306f\u5192\u982d\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u9014\u4e2d\u306b\u3001\u3088\u308a\u7c21\u6f54\u306b\u306a\u308a\u307e\u3057\u305f\u3068\u3055\u3002\n\n\u5b9f\u306f\u30cd\u30c3\u30c8\u3067\u8abf\u3079\u308b\u306e\u9805\u306e\nphp - PHPUnit and MySQL truncation error - Stack Overflow\n\u3067\u30822\u756a\u3081\u306e\u30b3\u30fc\u30c9\u7fa4\u4ee5\u964d\u306b\u540c\u3058\u3088\u3046\u306a\u30b3\u30fc\u30c9\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3093\u3067\u3059\u3051\u3069\u3001\u3053\u306e\u6642\u70b9\u3067\u3042\u308c\u3089\u306e\u30b3\u30fc\u30c9\u306f\u3084\u3063\u3071\u308a\u76ee\u306b\u3057\u305f\u77ac\u9593\u7406\u89e3\u3092\u653e\u68c4\u3059\u308b\u3093\u3067\u3059\u3088\u306d\u3002\n\n# <i class=\"fa fa-graduation-cap\" aria-hidden=\"true\"></i> \u7d50\u8ad6\n\n* `PHPUnit_Extensions_Database_TestCase`\u30af\u30e9\u30b9\u306e\u521d\u671f\u5316\u51e6\u7406\u3067\u306f\u3001\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u3042\u308b\u3068\u3046\u307e\u304f\u521d\u671f\u5316\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308b\n* \u30aa\u30d7\u30b7\u30e7\u30f3\u3067`TRUNCATE`\u51e6\u7406\u306b`CASCADE`\u3092\u8ffd\u52a0\u3067\u304d\u308b\u304c\u3001\u5916\u90e8\u304b\u3089\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u306f\u5236\u5fa1\u3067\u304d\u306a\u3044\n* \u5f15\u6570\u306a\u3057\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u3001CASCADE\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3084\u308b\n\n```php\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase\n{\n    protected function getSetUpOperation()\n    {\n        // \u5f15\u6570\u306btrue\u3092\u6e21\u3059\u3088\u3046\u306b\u4e0a\u66f8\u304d\n        return \\PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT(true);\n    }\n\n    public function setUp()\n    {\n        parent::setUp();\n    }\n}\n```\n\n# <i class=\"fa fa-cubes\"></i> \u6982\u8981\n\n1. \u672c\u756a\u3068\u540c\u4e00\u306e\u30c6\u30fc\u30d6\u30eb\u69cb\u9020\u3067\u30c6\u30b9\u30c8\u7528\u306eDB\u3092**Postgres**\u3067\u4f5c\u308b\n2. \u5916\u90e8\u30ad\u30fc\u304c\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u76ee\u7684\u30ec\u30b3\u30fc\u30c9\u4ee5\u5916\u306e\u4f9d\u5b58\u3059\u308b\u30c0\u30df\u30fc\u30ec\u30b3\u30fc\u30c9\u3082\u4f5c\u308b\u51e6\u7406\u3092\u542b\u3081\u305f\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u30d5\u30a3\u30af\u30b9\u30c1\u30e3(\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8)\u3092\u7528\u610f\u3059\u308b  \n  [PHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8]\n3. \u5916\u90e8\u30ad\u30fc\u304c\u4ed8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u8a18\u8ff0\u9806\u3082\u9806\u756a\u306b\u66f8\u304b\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\n4. \u30c6\u30b9\u30c8\u7d42\u4e86\u5f8c\u306e\u30af\u30ea\u30fc\u30f3\u30ca\u30c3\u30d7\u6642\u306b\u3001\u524a\u9664\u30a8\u30e9\u30fc\u304c\u51fa\u308b\n5. \u89e3\u6d88\u3057\u305f\u3044\uff01\n6. CASCADE\u3068\u3044\u3046\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u3070\u4f9d\u5b58\u95a2\u4fc2\u3092\u81ea\u52d5\u7684\u306b\u8fbf\u3063\u3066\u524a\u9664\u3057\u3066\u304f\u308c\u308b\n\n# <i class=\"fa fa-cogs\"></i> \u691c\u8a3c\u74b0\u5883\n\n* PHP5.4\n* PHPUnit 4.8.31\n* phpunit/dbunit 2.0.3\n* Postgres 9.2.15\n\n# <i class=\"fa fa-cube\"></i> \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u90e8\u5206\u30b5\u30f3\u30d7\u30eb\n\n(\u3053\u308c\u3060\u3051\u3067\u306f\u3046\u3054\u304d\u307e\u305b\u3093)\n\n\u521d\u5fc3\u8005\u306a\u306e\u3067\u57fa\u672c\u7684\u306a\u30de\u30cb\u30e5\u30a2\u30eb\u901a\u308a\u3067\u3059\u3002\n[PHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8]\u5168\u4f53\n\n```php\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase // \u2190DBUnit\u306e\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3059\u308b\n{\n\n    /** @var \\PDO PDO \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u304a\u3088\u3073\u30d5\u30a3\u30af\u30b9\u30c1\u30e3\u8aad\u307f\u8fbc\u307f\u306e\u3068\u304d\u306b\u4e00\u5ea6\u3060\u3051 */\n    static private $pdo = null;\n    /** @var PHPUnit_Extensions_Database_DB_IDatabaseConnection \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210\u306f\u3001\u30c6\u30b9\u30c8\u3054\u3068\u306b\u4e00\u5ea6\u3060\u3051 */\n    private $conn = null;\n\n    /* @var \\Hoge */\n    private $instance;\n\n    /**\n     * Returns the test database connection.\n     *\n     * @return PHPUnit_Extensions_Database_DB_IDatabaseConnection\n     */\n    protected function getConnection()\n    {\n        if ($this->conn !== null) {\n            return $this->conn;\n        }\n        if (self::$pdo == null) {\n            // $GLOBALS\u306fphpunit.xml\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\n            self::$pdo = new \\PDO($GLOBALS['DB_DSN'], $GLOBALS['DB_USER'], $GLOBALS['DB_PASSWD']);\n        }\n        $this->conn = $this->createDefaultDBConnection(self::$pdo, $GLOBALS['DB_DBNAME']);\n        return $this->conn;\n    }\n\n    /**\n     * Returns the test dataset.\n     *\n     * @return PHPUnit_Extensions_Database_DataSet_IDataSet\n     */\n    protected function getDataSet()\n    {\n        $dataset = [\n            '\u30c6\u30fc\u30d6\u30eb' => [\n                [\n                    '\u30ab\u30e9\u30e01'     => '\u5024',\n                    '\u30ab\u30e9\u30e02'     => '\u5024',\n                ],\n            ],\n        ];\n        // \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u914d\u5217\u3067\u5b9a\u7fa9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067yaml\u3068\u304b\u899a\u3048\u306a\u304f\u3066\u826f\u304f\u306a\u3063\u305f\n        return $this->createArrayDataSet($dataset);\n    }\n\n\n    public function setUp()\n    {\n\u3000\u3000\u3000\u3000 // \u3053\u3053\u3067getDataSet\u304c\u4f7f\u308f\u308c\u3001\u30c6\u30fc\u30d6\u30eb\u304c\u4e00\u65e6\u7a7a\u306b\u306a\u308a\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304cINSERT\u3055\u308c\u308b\n        parent::setUp();\n        $this->instance = new Hoge();\n    }\n\n    public function testHoge()\n    {\n        $this->assertTrue(true);\n    }\n}\n\n\n```\n\n\u52d5\u304b\u3059\u3068\u3053\u3093\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n\n```\n1) HogeTest::testHoge\nPHPUnit_Extensions_Database_Operation_Exception: COMPOSITE[TRUNCATE] operation failed on query:\n                TRUNCATE \"\u30c6\u30fc\u30d6\u30eb\"\n             using args: Array\n(\n)\n [SQLSTATE[0A000]: Feature not supported: 7 ERROR:  cannot truncate a table referenced in a foreign key constraint\nDETAIL:  Table \"\u30c6\u30fc\u30d6\u30ebA\" references \"\u30c6\u30fc\u30d6\u30ebB\".\nHINT:  Truncate table \"\u30c6\u30fc\u30d6\u30eb\" at the same time, or use TRUNCATE ... CASCADE.]\n\n```\n\n(at the same time\u306a\u3069\u3068\u3042\u308b\u306e\u3067)\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u4e26\u3073\u9806\u3092\u5909\u3048\u305f\u308a\u3057\u3066\u3082\u5909\u308f\u3089\u306a\u304b\u3063\u305f\u308a\u5225\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001\u65b9\u5411\u6027\u3092\u5909\u3048\u308b\n\n# <i class=\"fa fa-cube\"></i> \u30cd\u30c3\u30c8\u3067\u8abf\u3079\u308b\n\nTruncate\u3068\u304b\u77e5\u3089\u306a\u3044\u3057\u3001\u3068\u308a\u3042\u3048\u305aforeign key\u304c\u95a2\u4fc2\u3057\u305d\u3046\u306a\u306e\u3067\u305d\u3053\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8 + phpunit\u3067\u30b0\u30b0\u308b\u3002\n\n[php - PHPUnit and MySQL truncation error - Stack Overflow]\n\n\u30ca\u30eb\u30db\u30c9\uff01\u4e00\u6642\u7684\u306bforeign key\u30c1\u30a7\u30c3\u30af\u3092\u7121\u52b9\u306b\u3057\u3066\u3001\u3042\u3068\u3067\u3082\u3068\u306b\u623b\u305b\u3070\u3044\u3044\u306e\u304b\uff01\n\nmysql\u307f\u305f\u3044\u306a\u30af\u30a8\u30ea\u306fpsql\u3067\u306f\u3069\u3046\u3059\u308b\u3093\u3060\u3068\u8abf\u3079\u308b\u3002\n\n`foreign key \u7121\u52b9 postgres`\n\u3068\u304b\u3067\u8abf\u3079\u308b\n\n[PostgreSQL - PostgreSQL\u3067\u65e2\u5b58\u306e\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306bCASCADE\u7b49\u306e\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3057\u305f\u3044(17854)\uff5cteratail]\n\n[PostgreSQL\u3067\u5916\u90e8\u30ad\u30fc(FK)\u3092\u3059\u3079\u3066\u524a\u9664\u3059\u308b\u65b9\u6cd5 - Qiita]\n\n[\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306f\u91cd\u8377\u306b\u306a\u308b\u304b - iakio\u306e\u65e5\u8a18]\n\nmysql\u3067\u306f\u30af\u30a8\u30ea\u4e00\u767a\u3067\u5168\u4f53\u3092\u30c1\u30a7\u30c3\u30af\u304b\u3089\u5916\u3057\u305f\u308a\u3064\u3051\u305f\u308a\u3067\u304d\u308b\u304c\u3001postgres\u3067\u306f\u3072\u3068\u3064\u3072\u3068\u3064\u6d88\u3057\u3066\u3064\u3051\u306a\u304a\u3057\u3066\u3092\u3059\u308b\u304b\u3001DB\u5074\u306b\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\u3092\u3064\u3051\u306a\u3051\u308c\u3070\u540c\u69d8\u306e\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3089\u3057\u3044\u3002\n\n\u3069\u3063\u3061\u3082\u5acc\u3060\u306a\u2026\n\n# <i class=\"fa fa-cube\"></i> \u653b\u3081\u65b9\u3092\u5909\u3048\u308b\n\nforeign key\u30c1\u30a7\u30c3\u30af\u3067\u306f\u96e3\u3057\u305d\u3046\u306a\u306e\u3067\u3001\u540c\u6642\u306b\u51fa\u3066\u3044\u305f\u30d2\u30f3\u30c8\u304b\u3089\u8003\u3048\u3066\u307f\u308b\u3002\n\n>HINT:  Truncate table \"\u30c6\u30fc\u30d6\u30eb\" at the same time, or use TRUNCATE ... CASCADE.]\n\n**TRUNCATE**\u3082**CASCADE**\u3082\u77e5\u3089\u306a\u3044\u306e\u3067\u8abf\u3079\u308b\u3002(\u3069\u3046\u306a\u3093\u3060\u305d\u308c\u306f)\n\n[TRUNCATE\u3068DELETE\u306e\u9055\u3044 | \u30a2\u30e9\u30a4\u30c9\u30a2\u30fc\u30ad\u30c6\u30af\u30c4 \u30a8\u30f3\u30b8\u30cb\u30a2\u30d6\u30ed\u30b0]\n\n>\u30fbTRUNCATE\u3067\u306fDROP TABLE\u3092\u884c\u3063\u305f\u4e0a\u3067\u518d\u5ea6\u540c\u3058\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\u30fbAUTO_INCREMENT\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306fAUTO_INCREMENT\u306e\u5024\u306f\u521d\u671f\u5316\u3055\u308c\u308b\n\u30fbROLLBACK\u3067\u304d\u306a\u3044\n\n\u306a\u308b\u307b\u3069 \u5168\u524a\u9664\u2192\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u53cd\u6620 \u306e\u5168\u524a\u9664\u90e8\u5206\u306e\u62c5\u5f53\u3002\nAUTO_INCREMENT\u30ba\u30ec\u306a\u3044\u306e\uff1f\u3068\u3044\u3046\u8b0e\u3082\u89e3\u6c7a\u3002\n\n[PostgreSQL 9.1.5\u6587\u66f8 TRUNCATE]\n\n>CASCADE\n>\n>    \u6307\u5b9a\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3001\u307e\u305f\u306f\u3001CASCADE\u306b\u3088\u308a\u524a\u9664\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u3068\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u5916\u90e8\u30ad\u30fc\u3092\u6301\u3064\u30c6\u30fc\u30d6\u30eb\u3059\u3079\u3066\u3092\u81ea\u52d5\u7684\u306b\u7a7a\u306b\u3057\u307e\u3059\u3002 \n\nDB\u5074\u3067\u81ea\u52d5\u89e3\u6c7a\u3057\u3066\u304f\u308c\u308b\u4fbf\u5229\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3057\u305f\u3002\n\n>\u305d\u306e\u30c6\u30fc\u30d6\u30eb\u304c\u4ed6\u306e\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u5916\u90e8\u30ad\u30fc\u3067\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u30011\u3064\u306eTRUNCATE\u3067\u305d\u308c\u3089\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u3059\u3079\u3066\u7a7a\u306b\u3059\u308b\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044\u9650\u308a\u3001TRUNCATE\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u3053\u306e\u3088\u3046\u306a\u5834\u5408\u306f\u3001\u6709\u52b9\u6027\u3092\u691c\u67fb\u3059\u308b\u305f\u3081\u306b\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u30b9\u30ad\u30e3\u30f3\u3092\u884c\u3046\u306e\u3067\u3042\u308c\u3070\u3001\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306e\u5229\u70b9\u304c\u306a\u304f\u306a\u308b\u304b\u3089\u3067\u3059\u3002 CASCADE\u3092\u4f7f\u7528\u3057\u3066\u3001\u81ea\u52d5\u7684\u306b\u3059\u3079\u3066\u306e\u4f9d\u5b58\u30c6\u30fc\u30d6\u30eb\u3092\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u3057\u304b\u3057\u3001\u610f\u56f3\u3057\u306a\u3044\u30c7\u30fc\u30bf\u640d\u5931\u306e\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u6642\u306b\u306f\u5341\u5206\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002 \n\n\u76ee\u7684\u306f\u5168\u30c6\u30fc\u30d6\u30eb\u3092\u7a7a\u306b\u3059\u308b\u3053\u3068\u306a\u306e\u3067\u5927\u4e08\u592b\uff01\n\n# <i class=\"fa fa-cube\"></i> PHPUnit\u306e\u521d\u671f\u5316\u306e\u5b9f\u88c5\u3092\u898b\u308b\n\n\u30d2\u30f3\u30c8\u3092\u898b\u308b\u306b\u3001CASCADE\u3092\u8ffd\u52a0\u3057\u3066\u3084\u308c\u3070\u3044\u3044\u306e\u3060\u304b\u3089\u3001\u307e\u305a\u306f\u3069\u3053\u3067TRUNCATE\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u8abf\u3079\u308b\u3002\n\u3068\u3044\u3063\u3066\u3082\u30c6\u30b9\u30c8\u30af\u30e9\u30b9\u306e`setUp()`\u3067\u3042\u308b\u3053\u3068\u306f\u308f\u304b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7d99\u627f\u5143\u3092\u8ffd\u3063\u3066\u3044\u304f\u3060\u3051\u3002PhpStorm\u306a\u308aIDE\u3092\u4f7f\u3048\u3070\u7c21\u5358\u3002\n\u2026\u306a\u306e\u3060\u304c\u3001dbunit\u306ftrait\u99c6\u52d5\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001extends\u3060\u3051\u8ffd\u3048\u3070\u898b\u843d\u3068\u3057\u3066\u3057\u307e\u3046\u3088\u3046\u3060\u3002\n\u8ffd\u3046\u306a\u3089use\u3060\u304c\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306b`setUp()`\u3092\u66f8\u3044\u3066IDE\u3067\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u5143\u3092\u691c\u77e5\u3057\u3066\u3082\u3089\u3063\u3066\u30b8\u30e3\u30f3\u30d7\u3059\u308b\u306a\u3069\u3082\u5c0f\u6280\u306b\u306a\u308a\u305d\u3046\u3060\u3002\n\n```php:composer\\vendor\\phpunit\\dbunit\\src\\Extensions\\Database\\TestCaseTrait.php\n\ntrait PHPUnit_Extensions_Database_TestCase_Trait\n{\n    /**\n     * Performs operation returned by getSetUpOperation().\n     */\n    protected function setUp()\n    {\n        parent::setUp();\n\n        $this->databaseTester = NULL;\n\n        $this->getDatabaseTester()->setSetUpOperation($this->getSetUpOperation());\n        $this->getDatabaseTester()->setDataSet($this->getDataSet());\n        $this->getDatabaseTester()->onSetUp();\n    }\n}\n\n```\n\n\u30e2\u30c1\u306e\u30ed\u30f3\u4f55\u304c\u66f8\u3044\u3066\u3042\u308b\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\n`getDataSet()`\u304c\u30e6\u30fc\u30b6\u30fc\u5b9a\u7fa9\u306e\u30c6\u30fc\u30d6\u30eb\u72b6\u614b\u3092\u8fd4\u3059\u306e\u3067\u3001\u305d\u306e\u524d\u304c\u7a7a\u306b\u3059\u308b\u51e6\u7406\u3060\u3068\u8003\u3048\u3066\u307f\u308b\u3002\n\n```php\n\n    protected function getSetUpOperation()\n    {\n        return PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT();\n    }\n\n```\n\n\u4f55\u304c\u66f8\u3044\u3066\u3044\u308b\u306e\u304b\u306f\u5206\u304b\u3089\u306a\u3044\u304c\u3001`CLEAN_INSERT`\u3068\u3044\u3046\u5b57\u9762\u306f\u521d\u671f\u5316\u306b\u898b\u3048\u308b\u3002\n\n```php:composer\\vendor\\phpunit\\dbunit\\src\\Extensions\\Database\\Operation\\Factory.php\nclass PHPUnit_Extensions_Database_Operation_Factory\n{\n\n    /**\n     * Returns a clean insert database operation. It will remove all contents\n     * from the table prior to re-inserting rows.\n     *\n     * @param  bool                                                     $cascadeTruncates Set to true to force truncates to cascade on databases that support this.\n     * @return PHPUnit_Extensions_Database_Operation_IDatabaseOperation\n     */\n    public static function CLEAN_INSERT($cascadeTruncates = FALSE)\n    {\n        return new PHPUnit_Extensions_Database_Operation_Composite([\n            self::TRUNCATE($cascadeTruncates),\n            self::INSERT()\n        ]);\n    }\n\n}\n\n\n```\n\n`$cascadeTruncates = FALSE`\u3068\u3044\u3046\u5f15\u6570\u306b`true`\u3092\u6e21\u3057\u3066\u3084\u308c\u3070\u826f\u3055\u305d\u3046\u3060\u3002\n\u3057\u304b\u3057\u3001`setUp`\u3067\u306f\u5f15\u6570\u306a\u3057\u3067\u5b9f\u884c\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u304b\u3089\u3001\u30b3\u30d4\u30da\u3057\u3066\u624b\u52d5\u3067`true`\u3092\u6e21\u3057\u3066\u3084\u308d\u3046\u3002\n\n`parent::setUp()`\u304c\u547c\u3073\u51fa\u305b\u306a\u304f\u306a\u308b\u90fd\u5408\u3001Trait\u3067\u3057\u3066\u3044\u308b`parent::setUp()`\u3082\u5b9f\u884c\u3055\u308c\u306a\u304f\u306a\u308b\u304c\u3001\u4eca\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3088\u308a\u5148\u7956\u306e`setUp()`\u306b\u306f\u5b9f\u88c5\u304c\u7121\u3044\u306e\u3067\u4eca\u306f\u554f\u984c\u304c\u7121\u3044\u3002\n\n\n# <i class=\"fa fa-cube\"></i> \u4eee\u7d50\u8ad6\n\n* `PHPUnit_Extensions_Database_TestCase`\u30af\u30e9\u30b9\u306e\u521d\u671f\u5316\u51e6\u7406\u3067\u306f\u3001\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u304c\u3042\u308b\u3068\u3046\u307e\u304f\u521d\u671f\u5316\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308b\n* \u30aa\u30d7\u30b7\u30e7\u30f3\u3067`TRUNCATE`\u51e6\u7406\u306b`CASCADE`\u3092\u8ffd\u52a0\u3067\u304d\u308b\u304c\u3001\u5916\u90e8\u304b\u3089\u3053\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5236\u5fa1\u3067\u304d\u306a\u3044\n* \u3088\u3063\u3066\u3001`parent::setUp()`\u3067\u306f\u306a\u304f\u3001\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306b\u51e6\u7406\u3092\u30b3\u30d4\u30da\u3057\u3001\u30ab\u30b9\u30b1\u30fc\u30c9\u30c8\u30e9\u30f3\u30b1\u30fc\u30c8\u3092\u6709\u52b9\u5316\u3057\u3066\u3084\u308b\n\n```php\n\nclass HogeTest extends \\PHPUnit_Extensions_Database_TestCase\n{\n    public function setUp()\n    {\n        // cascade\u524a\u9664\u306e\u305f\u3081\u306b\u624b\u52d5\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\n        $this->databaseTester = NULL;\n        $this->getDatabaseTester()->setSetUpOperation(\\PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT(true));\n        $this->getDatabaseTester()->setDataSet($this->getDataSet());\n        $this->getDatabaseTester()->onSetUp();\n    }\n}\n```\n\n\u3053\u308c\u3067\u4e0a\u624b\u304f\u884c\u3063\u305f\u3002\n\n# <i class=\"fa fa-cube\"></i> \u8a18\u4e8b\u3092\u66f8\u304f\n\n\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u304f\u3002\n\u898b\u305f\u8cc7\u6599\u3092\u66f8\u304f\u305f\u3081\u306b\u3082\u3046\u4e00\u5ea6\u8abf\u3079\u306a\u304a\u3059\u3002\n\u524d\u306f\u76ee\u306b\u5165\u3089\u306a\u304b\u3063\u305f\u8a18\u4e8b\u304c\u76ee\u306b\u5165\u3063\u3066\u304f\u308b\u3002\n\n[TRUNCATE fails on tables which have foreign key constraints \u00b7 Issue #37 \u00b7 sebastianbergmann/dbunit]\n\n\u30b9\u30ec\u672c\u6587\u3068\u6700\u521d\u306e\u30ec\u30b9\u304b\u3089\u307e\u305fMySQL\u304b\u3068\u601d\u3044\u3001\u305d\u308c\u4ee5\u5f8c\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3084\u308a\u53d6\u308a\u3067\u3059\u304c\u3001\u4eca\u898b\u308b\u3068\u30012\u30ec\u30b9\u76ee\u306e\u610f\u5473\u304c\u308f\u304b\u308a\u307e\u3059\u3088\u306d\u3002\n\n\u30b3\u30d4\u30da\u306a\u3093\u3066\u3064\u3089\u3044\u306a\u30fc\u3068\u601d\u3063\u305f\u3089\u3001\u305f\u3060\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3067\u5f15\u6570\u3092`true`\u306b\u3059\u308c\u3070\u3044\u3044\u3082\u3088\u3046\u3002\n\n\u3053\u3093\u306a\u7c21\u5358\u306a\u3053\u3068\u306b\u3082\u6c17\u3065\u304b\u306a\u3044\u306a\u3093\u3066\u3002\n\n\u5f53\u6642\u306f\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u306e\u526f\u4f5c\u7528\u3092\u61f8\u5ff5\u3057\u305f\u306e\u304b\u306a\uff1f\n\n\u6700\u5f8c\u306e\n\nhttps://github.com/sebastianbergmann/dbunit/issues/37#issuecomment-142094486\n\n\u306a\u3093\u3066\u307e\u3055\u306bPostgres\u306e\u8a71\u984c\u3002MySQL\u306e\u8a71\u984c\u3060\u3068\u601d\u3063\u3066\u6c17\u3092\u629c\u304f\u3053\u3068\u306a\u304b\u308c\u3002\n\n1\u30ec\u30b9\u76ee\u306e\n`PHPUnit_Extensions_Database_Operation_Truncate`\n\u3092\u53c2\u7167\u3059\u308b\u3068\u3001\u307e\u3055\u306bTruncate\u306e\u305f\u3081\u306e\u30af\u30e9\u30b9\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u8907\u96d1\u306a\u306e\u3067\u624b\u3092\u51fa\u3057\u307e\u305b\u3093\u3002`CLEAN_INSERT`\u3067\u9593\u63a5\u7684\u306b\u4f7f\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3057\u3002\n\n\u3088\u3063\u3066\u3001\u7d50\u8ad6\u306e\u30b3\u30fc\u30c9\u306f\u5192\u982d\u306b\u3042\u308b\u3088\u3046\u306b\u3001\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3044\u308b\u9014\u4e2d\u306b\u3001\u3088\u308a\u7c21\u6f54\u306b\u306a\u308a\u307e\u3057\u305f\u3068\u3055\u3002\n\n***\n\n\u5b9f\u306f\u30cd\u30c3\u30c8\u3067\u8abf\u3079\u308b\u306e\u9805\u306e\n[php - PHPUnit and MySQL truncation error - Stack Overflow]\n\u3067\u30822\u756a\u3081\u306e\u30b3\u30fc\u30c9\u7fa4\u4ee5\u964d\u306b\u540c\u3058\u3088\u3046\u306a\u30b3\u30fc\u30c9\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3093\u3067\u3059\u3051\u3069\u3001\u3053\u306e\u6642\u70b9\u3067\u3042\u308c\u3089\u306e\u30b3\u30fc\u30c9\u306f\u3084\u3063\u3071\u308a\u76ee\u306b\u3057\u305f\u77ac\u9593\u7406\u89e3\u3092\u653e\u68c4\u3059\u308b\u3093\u3067\u3059\u3088\u306d\u3002\n\n\n*****************************************************\n\n\n[PHPUnit \u30de\u30cb\u30e5\u30a2\u30eb \u2013 \u7b2c8\u7ae0 \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30b9\u30c8]:https://phpunit.de/manual/current/ja/database.html#database.the-four-stages-of-a-database-test\n\n[php - PHPUnit and MySQL truncation error - Stack Overflow]:http://stackoverflow.com/questions/10331445/phpunit-and-mysql-truncation-error\n\n\n[PostgreSQL - PostgreSQL\u3067\u65e2\u5b58\u306e\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306bCASCADE\u7b49\u306e\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3057\u305f\u3044(17854)\uff5cteratail]:https://teratail.com/questions/17854\n\n[PostgreSQL\u3067\u5916\u90e8\u30ad\u30fc(FK)\u3092\u3059\u3079\u3066\u524a\u9664\u3059\u308b\u65b9\u6cd5 - Qiita]:http://qiita.com/msp0310/items/f57c610fda96f1bbcd72\n\n\n[\u5916\u90e8\u30ad\u30fc\u5236\u7d04\u306f\u91cd\u8377\u306b\u306a\u308b\u304b - iakio\u306e\u65e5\u8a18]:http://iakio.hatenablog.com/entry/2013/04/07/221534\n\n[TRUNCATE\u3068DELETE\u306e\u9055\u3044 | \u30a2\u30e9\u30a4\u30c9\u30a2\u30fc\u30ad\u30c6\u30af\u30c4 \u30a8\u30f3\u30b8\u30cb\u30a2\u30d6\u30ed\u30b0]:http://tech.aainc.co.jp/archives/4772\n\n[PostgreSQL 9.1.5\u6587\u66f8 TRUNCATE]:https://www.postgresql.jp/document/9.1/html/sql-truncate.html\n\n\n[TRUNCATE fails on tables which have foreign key constraints \u00b7 Issue #37 \u00b7 sebastianbergmann/dbunit]:https://github.com/sebastianbergmann/dbunit/issues/37\n"}