{"tags": ["Ruby", "ActiveRecord"], "context": "\u8868\u984c\u306e\u901a\u308a\u3002\nactive_record\u306bfind_in_batches\u3068\u3044\u3046\u4fbf\u5229\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3002\n\u901a\u5e38\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u969b\u306feach\u3092\u4f7f\u3046\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u308f\u308c\u308b\u304c\u3001\u305d\u306e\u30c7\u30fc\u30bf\u91cf\u304c\u591a\u3044\u5834\u5408\u306a\u3069\u306f\u30e1\u30e2\u30ea\u3092\u98df\u3063\u3066\u3057\u307e\u3044\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002\n\u3053\u3046\u3044\u3063\u305f\u5834\u5408\u3001find_in_batches\u3092\u4f7f\u3048\u3070\u4e00\u5ea6\u306b\u30e1\u30e2\u30ea\u306b\u30ed\u30fc\u30c9\u3059\u308b\u30c7\u30fc\u30bf\u91cf\u3092\u6291\u3048\u306a\u304c\u3089\u540c\u69d8\u306e\u51e6\u7406\u304c\u3067\u304d\u308b\u306e\u3067\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u969b\u306b\u4fbf\u5229\u3060\u3002\n\u305f\u3060\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u307b\u3057\u3044\u3002\n\nArticle.where(\"id < 100000\").order(:id).reverse_order.find_in_batches(batch_size: 1000) do |articles|\n  // \u9069\u5f53\u306a\u51e6\u7406\u306a\u3069...\nend\n\n\n\u3053\u308c\u306fArticle\u30c6\u30fc\u30d6\u30eb\u306eid\u304c100000\u4ee5\u4e0b\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u964d\u9806\u30671000\u4ef6\u3065\u3064\u51e6\u7406\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3060\u3002\n\u4e00\u898b\u306a\u306b\u3082\u554f\u984c\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b\u3053\u306e\u30b3\u30fc\u30c9\u3060\u304c\u3001\u5b9f\u969b\u306b\u767a\u884c\u3055\u308c\u308bSQL\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308b\u3002\n// 1\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND ORDER BY articles.id DESC LIMIT 1000\n// 2\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND (id > 99000) ORDER BY articles.id ASC LIMIT 1000\n// 3\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND (id > 99001) ORDER BY articles.id ASC LIMIT 1000\n...\n\n\u8981\u306f1\u30eb\u30fc\u30d7\u76ee\u4ee5\u964d\u306forder by\u304c\u7121\u8996\u3055\u308c\u3066\u3044\u308b\u3002\n\u305d\u3053\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u308b\u3068\u3001\n\nNOTE: It's not possible to set the order. That is automatically set to ascending on the primary key (\u201cid ASC\u201d) to make the batch ordering work. This also means that this method only works when the primary key is orderable (e.g. an integer or string).\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3061\u3083\u3093\u3068order\u304c\u7121\u8996\u3055\u308c\u308b\u3053\u3068\u304c\u66f8\u3044\u3066\u3042\u308b\u3002\n\u3057\u305f\u304c\u3063\u3066\u3001find_in_batches\u306f\u964d\u9806\u3067\u51e6\u7406\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u308f\u3051\u3002\n\u3061\u3083\u3093\u3068\u8aad\u3081\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u304c\u6848\u5916\u898b\u843d\u3068\u3057\u304c\u3061\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3068\u3044\u3046\u8a71\u3067\u3057\u305f\u3002\n\u3061\u306a\u307f\u306blimit\u3082\u7121\u8996\u3055\u308c\u3066batch_size\u306e\u307b\u3046\u304c\u512a\u5148\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n\u95a2\u9023\u30ea\u30f3\u30af\n\nfind_in_batches\n\n\u8868\u984c\u306e\u901a\u308a\u3002\n\nactive_record\u306bfind_in_batches\u3068\u3044\u3046\u4fbf\u5229\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u3042\u308b\u3002\n\n\u901a\u5e38\u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u969b\u306feach\u3092\u4f7f\u3046\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u308f\u308c\u308b\u304c\u3001\u305d\u306e\u30c7\u30fc\u30bf\u91cf\u304c\u591a\u3044\u5834\u5408\u306a\u3069\u306f\u30e1\u30e2\u30ea\u3092\u98df\u3063\u3066\u3057\u307e\u3044\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002\n\n\u3053\u3046\u3044\u3063\u305f\u5834\u5408\u3001find_in_batches\u3092\u4f7f\u3048\u3070\u4e00\u5ea6\u306b\u30e1\u30e2\u30ea\u306b\u30ed\u30fc\u30c9\u3059\u308b\u30c7\u30fc\u30bf\u91cf\u3092\u6291\u3048\u306a\u304c\u3089\u540c\u69d8\u306e\u51e6\u7406\u304c\u3067\u304d\u308b\u306e\u3067\u5927\u91cf\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u969b\u306b\u4fbf\u5229\u3060\u3002\n\n\u305f\u3060\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u307b\u3057\u3044\u3002\n\n```rb\n\nArticle.where(\"id < 100000\").order(:id).reverse_order.find_in_batches(batch_size: 1000) do |articles|\n  // \u9069\u5f53\u306a\u51e6\u7406\u306a\u3069...\nend\n\n```\n\n\u3053\u308c\u306fArticle\u30c6\u30fc\u30d6\u30eb\u306eid\u304c100000\u4ee5\u4e0b\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u964d\u9806\u30671000\u4ef6\u3065\u3064\u51e6\u7406\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3060\u3002\n\n\u4e00\u898b\u306a\u306b\u3082\u554f\u984c\u306a\u3044\u3088\u3046\u306b\u898b\u3048\u308b\u3053\u306e\u30b3\u30fc\u30c9\u3060\u304c\u3001\u5b9f\u969b\u306b\u767a\u884c\u3055\u308c\u308bSQL\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u306b\u306a\u308b\u3002\n\n```\n// 1\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND ORDER BY articles.id DESC LIMIT 1000\n// 2\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND (id > 99000) ORDER BY articles.id ASC LIMIT 1000\n// 3\u30eb\u30fc\u30d7\u76ee\nSELECT * FROM articles WHERE (id < 100000) AND (id > 99001) ORDER BY articles.id ASC LIMIT 1000\n...\n```\n\n\u8981\u306f1\u30eb\u30fc\u30d7\u76ee\u4ee5\u964d\u306forder by\u304c\u7121\u8996\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u305d\u3053\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u898b\u308b\u3068\u3001\n\n> NOTE: It's not possible to set the order. That is automatically set to ascending on the primary key (\u201cid ASC\u201d) to make the batch ordering work. This also means that this method only works when the primary key is orderable (e.g. an integer or string).\n\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3061\u3083\u3093\u3068order\u304c\u7121\u8996\u3055\u308c\u308b\u3053\u3068\u304c\u66f8\u3044\u3066\u3042\u308b\u3002\n\n\u3057\u305f\u304c\u3063\u3066\u3001find_in_batches\u306f\u964d\u9806\u3067\u51e6\u7406\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u308f\u3051\u3002\n\n\u3061\u3083\u3093\u3068\u8aad\u3081\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u304c\u6848\u5916\u898b\u843d\u3068\u3057\u304c\u3061\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046\u3068\u3044\u3046\u8a71\u3067\u3057\u305f\u3002\n\n\u3061\u306a\u307f\u306blimit\u3082\u7121\u8996\u3055\u308c\u3066batch_size\u306e\u307b\u3046\u304c\u512a\u5148\u3055\u308c\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n\n## \u95a2\u9023\u30ea\u30f3\u30af\n\n- [find_in_batches](http://api.rubyonrails.org/classes/ActiveRecord/Batches.html#method-i-find_in_batches)\n"}