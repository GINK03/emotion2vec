{"tags": ["rundeck", "PostgreSQL"], "context": "\n\ntl;dr\n\ncron\u306e\u3088\u3046\u306a\u30b8\u30e7\u30d6\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3057\u3066\u304f\u308c\u308b\u3068\u3044\u3046 rundeck \u306e\u30b5\u30fc\u30d0\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3002\n\u5185\u90e8db\u306f\u9078\u629e\u53ef\u80fd\u3068\u306e\u3053\u3068\u3060\u3063\u305f\u306e\u3067\u3001 postgresql \u3092\u4f7f\u7528\u3002\n\n\n\u74b0\u5883\n\nCentOS Linux release 7.2.1511 (Core)\nrundeck 2.7.2\nPostgreSQL 9.6.3\n\n\npostgres9.6 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm\n  \nrpm -ivh pgdg-centos96-9.6-3.noarch.rpm\nyum install postgresql96-server postgresql96-devel postgresql96-contrib\n\n/usr/pgsql-9.6/bin/postgresql96-setup initdb\nsystemctl enable postgresql-9.6\nsystemctl stop postgresql-9.6\n\n\npostgres9.6 \u8a2d\u5b9a\u8abf\u6574\nvi /var/lib/pgsql/9.6/data/pg_hba.conf\n\u203b\u30b8\u30e7\u30d6\u5b9f\u884c\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u3068\u901a\u4fe1\u53ef\u80fd\u306a\u3088\u3046\u306b\u3059\u308b\u3002\n\ncp -pr /var/lib/pgsql/9.6/data /var/lib/pgsql/9.6/data_org\nmount -t xfs /dev/sdb /var/lib/pgsql/9.6/data\n\ncp -pr /var/lib/pgsql/9.6/data_org/* /var/lib/pgsql/9.6/data\nchown -R postgres:postgres /var/lib/pgsql/9.6/data\nchmod 700 /var/lib/pgsql/9.6/data\n\nsystemctl start postgresql-9.6\n\n\nfirewall\u958b\u653e\nsystemctl status firewalld\nfirewall-cmd --add-port=4440/tcp --permanent\nsystemctl restart firewalld\n\n\nvi /etc/fstab\n\n/dev/sdb                                  /var/lib/pgsql/9.6/data xfs     defaults        0 0\n\n\n\nrundeck \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nrpm -Uvh http://repo.rundeck.org/latest.rpm\nyum install -y rundeck\n\n\nrundeck \u8a2d\u5b9a\n\nvi /etc/rundeck/rundeck-config.properties\n\n#loglevel.default is the default log level for jobs: ERROR,WARN,INFO,VERBOSE,DEBUG\nloglevel.default=INFO\nrdeck.base=/var/lib/rundeck\n\n#rss.enabled if set to true enables RSS feeds that are public (non-authenticated)\nrss.enabled=false\n# change hostname here\ngrails.serverURL=http://172.21.XX.XXX:4440\n\n# dataSource.dbCreate = update\n# dataSource.url = jdbc:h2:file:/var/lib/rundeck/data/rundeckdb;MVCC=true\ndataSource.driverClassName = org.postgresql.Driver\ndataSource.url = jdbc:postgresql://localhost/rundeck\ndataSource.username=rundeckuser\ndataSource.password=hogehoge\n\n\nvi /etc/rundeck/framework.properties\n\n\u300cloaclhost\u300d\u3092\u300c172.21.XX.XXX\u300d\u306b\u5909\u66f4\n\n\nrundeck \u30d7\u30e9\u30b0\u30a4\u30f3\uff08\u203b\u3053\u3053\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\uff09\ncd /var/lib/rundeck/libext\n\nwget https://github.com/higanworks/rundeck-slack-incoming-webhook-plugin/releases/download/v0.6.dev/rundeck-slack-incoming-webhook-plugin-0.6.jar\n\nchown rundeck:rundeck rundeck-slack-incoming-webhook-plugin-0.6.jar\n\n\nDB\u3078rundeck db/user\u3092\u8ffd\u52a0\nsudo su postgres -c 'psql postgres'\nCREATE ROLE rundeckuser WITH LOGIN PASSWORD 'hogehoge';\n\ncreate database rundeck;\ngrant ALL privileges on database rundeck to rundeckuser;\n\nvi /var/lib/pgsql/9.6/data/pg_hba.conf\nlocal   all             all                                     trust     #peer\n\nsystemctl restart postgresql-9.6\n\n\nrundeck \u518d\u8d77\u52d5\nsystemctl stop rundeckd\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nhttp://172.21.XX.XXX:4440\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u624b\u9806\u306f\u4ee5\u4e0a\u3067\u3059\u3002\n\u904b\u7528\u6642\u306f\u3001\u3053\u306e\u5f8c\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u3001SSL\u9375\u4f5c\u6210\u7b49\u3042\u308a\u307e\u3059\u3002\n\n\n\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\n\u30d6\u30e9\u30a6\u30b6\u3067\u30a8\u30e9\u30fc\u753b\u9762\u306b\u306a\u308b\u5834\u5408\u2026\nHTTP ERROR: 503\nProblem accessing /user/login. Reason:\n\n    Service Unavailable\n\n\n\u2192\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u78ba\u8a8d\n\nless /var/log/rundeck/service.log\n\n\u89b3\u70b9\n\nDB\u30c9\u30e9\u30a4\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08/etc/rundeck/rundeck-config.properties\uff09\u306e\u5185\u5bb9\u306f\u6b63\u3057\u3044\uff1f\nrundeckuser \u30e6\u30fc\u30b6\u30fc\u3068rundeck db\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\uff1f \n4440\u30dd\u30fc\u30c8\u7a7a\u3044\u3066\u3044\u308b\uff1f\n\n\n\u305d\u306e\u4ed6\u53c2\u7167\n\u30fb\u516c\u5f0f\nhttp://rundeck.org/docs/administration/setting-up-an-rdb-datasource.html\n\u30fb\u7528\u6cd5\nhttp://swfz.hatenablog.com/entry/2015/11/06/235658\n# tl;dr\n\n- cron\u306e\u3088\u3046\u306a\u30b8\u30e7\u30d6\u3092\u7ba1\u7406\u3057\u3084\u3059\u304f\u3057\u3066\u304f\u308c\u308b\u3068\u3044\u3046 rundeck \u306e\u30b5\u30fc\u30d0\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3002\n- \u5185\u90e8db\u306f\u9078\u629e\u53ef\u80fd\u3068\u306e\u3053\u3068\u3060\u3063\u305f\u306e\u3067\u3001 postgresql \u3092\u4f7f\u7528\u3002\n\n### \u74b0\u5883\n\n- CentOS Linux release 7.2.1511 (Core)\n- rundeck 2.7.2\n- PostgreSQL 9.6.3\n\n### postgres9.6 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n<pre>\nwget https://download.postgresql.org/pub/repos/yum/9.6/redhat/rhel-7-x86_64/pgdg-centos96-9.6-3.noarch.rpm\n  \nrpm -ivh pgdg-centos96-9.6-3.noarch.rpm\nyum install postgresql96-server postgresql96-devel postgresql96-contrib\n\n/usr/pgsql-9.6/bin/postgresql96-setup initdb\nsystemctl enable postgresql-9.6\nsystemctl stop postgresql-9.6\n</pre>\n\n### postgres9.6 \u8a2d\u5b9a\u8abf\u6574\n\n<pre>\nvi /var/lib/pgsql/9.6/data/pg_hba.conf\n\u203b\u30b8\u30e7\u30d6\u5b9f\u884c\u5bfe\u8c61\u306e\u30b5\u30fc\u30d0\u3068\u901a\u4fe1\u53ef\u80fd\u306a\u3088\u3046\u306b\u3059\u308b\u3002\n\ncp -pr /var/lib/pgsql/9.6/data /var/lib/pgsql/9.6/data_org\nmount -t xfs /dev/sdb /var/lib/pgsql/9.6/data\n\ncp -pr /var/lib/pgsql/9.6/data_org/* /var/lib/pgsql/9.6/data\nchown -R postgres:postgres /var/lib/pgsql/9.6/data\nchmod 700 /var/lib/pgsql/9.6/data\n\nsystemctl start postgresql-9.6\n</pre>\n\n### firewall\u958b\u653e\n\n<pre>\nsystemctl status firewalld\nfirewall-cmd --add-port=4440/tcp --permanent\nsystemctl restart firewalld\n</pre>\n\n> vi /etc/fstab\n<pre>\n/dev/sdb                                  /var/lib/pgsql/9.6/data xfs     defaults        0 0\n</pre>\n\n\n### rundeck \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n<pre>\nrpm -Uvh http://repo.rundeck.org/latest.rpm\nyum install -y rundeck\n</pre>\n\n### rundeck \u8a2d\u5b9a\n\n> vi /etc/rundeck/rundeck-config.properties\n\n<pre>\n#loglevel.default is the default log level for jobs: ERROR,WARN,INFO,VERBOSE,DEBUG\nloglevel.default=INFO\nrdeck.base=/var/lib/rundeck\n\n#rss.enabled if set to true enables RSS feeds that are public (non-authenticated)\nrss.enabled=false\n# change hostname here\ngrails.serverURL=http://172.21.XX.XXX:4440\n\n# dataSource.dbCreate = update\n# dataSource.url = jdbc:h2:file:/var/lib/rundeck/data/rundeckdb;MVCC=true\ndataSource.driverClassName = org.postgresql.Driver\ndataSource.url = jdbc:postgresql://localhost/rundeck\ndataSource.username=rundeckuser\ndataSource.password=hogehoge\n</pre>\n\n> vi /etc/rundeck/framework.properties\n\n<pre>\n\u300cloaclhost\u300d\u3092\u300c172.21.XX.XXX\u300d\u306b\u5909\u66f4\n</pre>\n\n\n### rundeck \u30d7\u30e9\u30b0\u30a4\u30f3\uff08\u203b\u3053\u3053\u306f\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\uff09\n\n<pre>\ncd /var/lib/rundeck/libext\n\nwget https://github.com/higanworks/rundeck-slack-incoming-webhook-plugin/releases/download/v0.6.dev/rundeck-slack-incoming-webhook-plugin-0.6.jar\n\nchown rundeck:rundeck rundeck-slack-incoming-webhook-plugin-0.6.jar\n</pre>\n\n\n### DB\u3078rundeck db/user\u3092\u8ffd\u52a0\n\n<pre>\nsudo su postgres -c 'psql postgres'\nCREATE ROLE rundeckuser WITH LOGIN PASSWORD 'hogehoge';\n\ncreate database rundeck;\ngrant ALL privileges on database rundeck to rundeckuser;\n</pre>\n\nvi /var/lib/pgsql/9.6/data/pg_hba.conf\n<pre>\nlocal   all             all                                     trust     #peer\n</pre>\n\n<pre>\nsystemctl restart postgresql-9.6\n</pre>\n\n\n### rundeck \u518d\u8d77\u52d5\n\n<pre>\nsystemctl stop rundeckd\n</pre>\n\n### \u52d5\u4f5c\u78ba\u8a8d\n\nhttp://172.21.XX.XXX:4440\n\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u624b\u9806\u306f\u4ee5\u4e0a\u3067\u3059\u3002\n\u904b\u7528\u6642\u306f\u3001\u3053\u306e\u5f8c\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u3001SSL\u9375\u4f5c\u6210\u7b49\u3042\u308a\u307e\u3059\u3002\n\n---\n### \u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u30a8\u30e9\u30fc\u753b\u9762\u306b\u306a\u308b\u5834\u5408\u2026\n\n<pre>\nHTTP ERROR: 503\nProblem accessing /user/login. Reason:\n\n    Service Unavailable\n\n</pre>\n\n\u2192\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u78ba\u8a8d\n> less /var/log/rundeck/service.log\n\n\u89b3\u70b9\n\n- DB\u30c9\u30e9\u30a4\u30d0\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08/etc/rundeck/rundeck-config.properties\uff09\u306e\u5185\u5bb9\u306f\u6b63\u3057\u3044\uff1f\n- rundeckuser \u30e6\u30fc\u30b6\u30fc\u3068rundeck db\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\uff1f \n- 4440\u30dd\u30fc\u30c8\u7a7a\u3044\u3066\u3044\u308b\uff1f\n\n### \u305d\u306e\u4ed6\u53c2\u7167\n\n\u30fb\u516c\u5f0f\nhttp://rundeck.org/docs/administration/setting-up-an-rdb-datasource.html\n\u30fb\u7528\u6cd5\nhttp://swfz.hatenablog.com/entry/2015/11/06/235658\n\n"}