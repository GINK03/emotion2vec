{"context": " More than 1 year has passed since last update.\n\nGoal\n\n\nnew, create, update\u306a\u3069\u3067attributes\u30cf\u30c3\u30b7\u30e5\u3092\u6e21\u3057\u305f\u3068\u304d\u306b\u5f15\u6570attributes\u306b\u5bfe\u3057\u3066\u6bce\u56de\u7279\u5b9a\u306e\u30d5\u30a3\u30eb\u30bf\u51e6\u7406\u3092\u304a\u3053\u306a\u3044\u305f\u3044\n\u901a\u5e38\u306f\u30e2\u30c7\u30eb\u306e\u4ed5\u69d8\u306b\u5408\u308f\u305b\u3066\u547c\u3073\u51fa\u3057\u5074\u3067attributes\u3092\u6e96\u5099\u3059\u308b\u3079\u304d\u3060\u3068\u601d\u3046\u304c\u3001\u6e96\u5099\u3059\u3079\u304d\u5f15\u6570attributes\u304c\u30e2\u30c7\u30eb\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306b\u4f9d\u5b58\u3059\u308b\u5834\u5408\u3001\u5229\u4fbf\u6027\u306e\u305f\u3081\u306b\u30e2\u30c7\u30eb\u5074\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u6301\u305f\u305b\u3066\u304a\u304d\u305f\u3044\n\n\nCode\nassign_attributes\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308c\u3070\u3088\u3044. new, create, update\u3067\u6e21\u3055\u308c\u305f\u5f15\u6570attributes\u306fassign_attributes\u30e1\u30bd\u30c3\u30c9\u3092\u901a\u3057\u3066\u30e2\u30c7\u30eb\u306b\u30bb\u30c3\u30c8\u3055\u308c\u308b.\n\nuser.rb\nclass User < ActiveRecord::Base\n  belongs_to :game\n\n  def self.gender_role( role_name, gender_name )\n    gender_roles = {\n      acting: {\n        male: :actor,\n        female: :actress,\n      },\n      waiting: {\n        male: :waiter,\n        female: :waitress,\n      }\n    }\n    return nil unless gender_roles[role_name]\n    gender_roles[role_name][gender_name]\n  end\n\n  def assign_attributes(attributes)\n    gender_local = gender\n    gender_local = attributes[:gender] if attributes[:gender]\n    attributes[:role] = User.gender_role(attributes[:role], gender_local)\n    super attributes\n  end\nend\n\n\nuser = User.new( role: :acting, gender: :male )\nuser.role # :actor\n\nuser = User.new( role: :acting, gender: :female )\nuser.role # : actress\n\nuser = User.create( gender: :male )\nuser.update( role: :waiting )\nuser.role # :waiter\n\n\nCaution\n\u5f15\u6570\u3064\u304d\u3067new\u3057\u305f\u3068\u304d\u306f\u6bce\u56de\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u91cd\u3044\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306f\u6ce8\u610f.\n\u500b\u5225\u306eattribute\u306b\u76f4\u63a5\u4ee3\u5165\u3059\u308b\u3068\u304d\u306f\u5f53\u7136assign_attributes\u306f\u3088\u3070\u308c\u306a\u3044.\n\nEnvironment\n$ bundle exec rails -v\nRails 4.1.9\n\n\n# Goal\n\n* `new`, `create`, `update`\u306a\u3069\u3067attributes\u30cf\u30c3\u30b7\u30e5\u3092\u6e21\u3057\u305f\u3068\u304d\u306b\u5f15\u6570attributes\u306b\u5bfe\u3057\u3066\u6bce\u56de\u7279\u5b9a\u306e\u30d5\u30a3\u30eb\u30bf\u51e6\u7406\u3092\u304a\u3053\u306a\u3044\u305f\u3044\n* \u901a\u5e38\u306f\u30e2\u30c7\u30eb\u306e\u4ed5\u69d8\u306b\u5408\u308f\u305b\u3066\u547c\u3073\u51fa\u3057\u5074\u3067attributes\u3092\u6e96\u5099\u3059\u308b\u3079\u304d\u3060\u3068\u601d\u3046\u304c\u3001\u6e96\u5099\u3059\u3079\u304d\u5f15\u6570attributes\u304c\u30e2\u30c7\u30eb\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306b\u4f9d\u5b58\u3059\u308b\u5834\u5408\u3001\u5229\u4fbf\u6027\u306e\u305f\u3081\u306b\u30e2\u30c7\u30eb\u5074\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u6301\u305f\u305b\u3066\u304a\u304d\u305f\u3044\n\n# Code\n\n`assign_attributes`\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308c\u3070\u3088\u3044. `new`, `create`, `update`\u3067\u6e21\u3055\u308c\u305f\u5f15\u6570attributes\u306f`assign_attributes`\u30e1\u30bd\u30c3\u30c9\u3092\u901a\u3057\u3066\u30e2\u30c7\u30eb\u306b\u30bb\u30c3\u30c8\u3055\u308c\u308b.\n\n```ruby:user.rb\nclass User < ActiveRecord::Base\n  belongs_to :game\n\n  def self.gender_role( role_name, gender_name )\n    gender_roles = {\n      acting: {\n        male: :actor,\n        female: :actress,\n      },\n      waiting: {\n        male: :waiter,\n        female: :waitress,\n      }\n    }\n    return nil unless gender_roles[role_name]\n    gender_roles[role_name][gender_name]\n  end\n\n  def assign_attributes(attributes)\n    gender_local = gender\n    gender_local = attributes[:gender] if attributes[:gender]\n    attributes[:role] = User.gender_role(attributes[:role], gender_local)\n    super attributes\n  end\nend\n```\n\n```ruby\nuser = User.new( role: :acting, gender: :male )\nuser.role # :actor\n\nuser = User.new( role: :acting, gender: :female )\nuser.role # : actress\n\nuser = User.create( gender: :male )\nuser.update( role: :waiting )\nuser.role # :waiter\n```\n\n# Caution\n\n\u5f15\u6570\u3064\u304d\u3067`new`\u3057\u305f\u3068\u304d\u306f\u6bce\u56de\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u91cd\u3044\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306f\u6ce8\u610f.\n\u500b\u5225\u306eattribute\u306b\u76f4\u63a5\u4ee3\u5165\u3059\u308b\u3068\u304d\u306f\u5f53\u7136`assign_attributes`\u306f\u3088\u3070\u308c\u306a\u3044.\n\n# Environment\n\n```\n$ bundle exec rails -v\nRails 4.1.9\n```\n", "tags": ["ActiveRecord", "Rails"]}