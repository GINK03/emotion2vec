{"tags": ["PHP", "PHP7", "nginx", "php-fpm"], "context": " More than 1 year has passed since last update.\n\nPHP7\u89e6\u3063\u3066\u307f\u305f - GUI\u7de8 -\n\u524d\u56de\u306fPHP7\u3092CentOS7\u306b\u5165\u308c\u3066\u3001CUI\u304b\u3089\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fnginx\u7d4c\u7531\u3067GUI\u304b\u3089PHP\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u4e8b\u524d\u6e96\u5099\ncd ~/vagrant/centos70/\nvagrant up\nvagrant ssh\nphp -v\nPHP 7.0.2-dev (cli) (built: Dec 11 2015 20:27:52) ( NTS )\nCopyright (c) 1997-2015 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies\n\n\nnginx\u306e\u5c0e\u5165\nyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001\u8ffd\u52a0\u767b\u9332\u3057\u307e\u3059\u3002\nvi /etc/yum.repos.d/nginx.repo\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\n[nginx]\nname=nginx repo\n#baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=0\n\n\u3053\u308c\u3067\u6e96\u5099OK\nyum --enablerepo=nginx install nginx\n\n\u5b8c\u4e86\u3002\n\nphp-fpm\u306e\u5c0e\u5165\n\nphp-fpm\u3063\u3066??\n\nPHP\u3068WEB\u30b5\u30fc\u30d0(\u4eca\u56de\u306fnginx)\u3092\u3064\u306a\u3050\u306e\u306b\u5fc5\u8981\u306b\u306a\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\nphp7\u3092yum\u3057\u305f\u969b\u306b,\u30c7\u30d5\u30a9\u30eb\u30c8\u306ephp-fpm\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304cinstall\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\n\u3053\u308c\u3092nginx\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nsudo cp -p /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.conf\n\n\u3053\u306econf\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002default\u306foriginal\u3068\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u306a\u308a\u307e\u3059\u3002\nvi /usr/local/php7/etc/php-fpm.conf\n\n\n\u4e0a\u8a18\u306e17\u884c\u76ee\u306881\u884c\u76ee\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u5916\u3057\u307e\u3059\u3002\n\u7d50\u679c\u3068\u3057\u3066\u3053\u3046\u306a\u308b\n$ diff -u php-fpm.conf php-fpm.conf.default \n--- php-fpm.conf    2015-12-12 20:53:39.684996478 +0900\n+++ php-fpm.conf.default    2015-12-12 05:30:36.000000000 +0900\n@@ -14,7 +14,7 @@\n ; Pid file\n ; Note: the default prefix is /usr/local/php7/var\n ; Default Value: none\n-pid = run/php-fpm.pid\n+;pid = run/php-fpm.pid\n\n ; Error log file\n ; If it's set to \"syslog\", log is sent to syslogd instead of being written\n@@ -78,7 +78,7 @@\n\n ; Send FPM to background. Set to 'no' to keep FPM in foreground for debugging.\n ; Default Value: yes\n-daemonize = yes\n+;daemonize = yes\n\n ; Set open file descriptor rlimit for the master process.\n ; Default Value: system defined value\n\n\u6b21\u3002\nsudo cp -p /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf\nvi /usr/local/php7/etc/php-fpm.d/www.conf\n\n\n\u4e0a\u8a18\u306e23\u306824\u884c\u76ee\u3092\nuser = nginx\ngroup = nginx\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u3001nnginx\u306b\u5bfe\u5fdc\u3059\u308b\u3002\n\u6b21\u306b\u3001php-fpm\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u307f\u307e\u3059\u3002\nvi /etc/init.d/php-fpm\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\u3002\n#! /bin/sh\n### BEGIN INIT INFO\n# Provides:          php--fpm\n# Required-Start:    $all\n# Required-Stop:     $all\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: starts php-fpm\n# Description:       starts the PHP FastCGI Process Manager daemon\n### END INIT INFO\nphp_fpm_BIN=/usr/local/php7/sbin/php-fpm\nphp_fpm_CONF=/usr/local/php7/etc/php-fpm.conf\nphp_fpm_PID=/usr/local/php7/var/run/php-fpm.pid\nphp_opts=\"--fpm-config $php_fpm_CONF\"\nwait_for_pid () {\n        try=0\n        while test $try -lt 35 ; do\n                case \"$1\" in\n                        'created')\n                        if [ -f \"$2\" ] ; then\n                                try=''\n                                break\n                        fi\n                        ;;\n                        'removed')\n                        if [ ! -f \"$2\" ] ; then\n                                try=''\n                                break\n                        fi\n                        ;;\n                esac\n                echo -n .\n                try=`expr $try + 1`\n                sleep 1\n        done\n}\ncase \"$1\" in\n        start)\n                echo -n \"Starting php-fpm \"\n                $php_fpm_BIN $php_opts\n                if [ \"$?\" != 0 ] ; then\n                        echo \" failed\"\n                        exit 1\n                fi\n                wait_for_pid created $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed\"\n                        exit 1\n                else\n                        echo \" done\"\n                fi\n        ;;\n        stop)\n                echo -n \"Gracefully shutting down php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -QUIT `cat $php_fpm_PID`\n                wait_for_pid removed $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed. Use force-exit\"\n                        exit 1\n                else\n                        echo \" done\"\n                       echo \" done\"\n                fi\n        ;;\n        force-quit)\n                echo -n \"Terminating php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -TERM `cat $php_fpm_PID`\n                wait_for_pid removed $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed\"\n                        exit 1\n                else\n                        echo \" done\"\n                fi\n        ;;\n        restart)\n                $0 stop\n                $0 start\n        ;;\n        reload)\n                echo -n \"Reload service php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -USR2 `cat $php_fpm_PID`\n                echo \" done\"\n        ;;\n        *)\n                echo \"Usage: $0 {start|stop|force-quit|restart|reload}\"\n                exit 1\n        ;;\nesac\n\n\u3053\u308c\u3067\u4eca\u5f8c\u3001php-fpm\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306f\nsudo /etc/init.d/php-fpm start\n\n\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\nchkconfig\u306b\u767b\u9332\u3057\u3066\u304a\u3044\u3066\u3082\u826f\u3044\u3067\u3059\u306d\u3002\n\nnginx\u306e\u8a2d\u5b9a\nnginx\u306b\u3082\u3001php\u304c\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nsudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.org\nsudo vi /etc/nginx/conf.d/default.conf\n\n\n\u3053\u3046\u3057\u307e\u3059\u3002\ndiff\u898b\u308b\u3068\n[vagrant@localhost conf.d]$ diff -u default.conf.org default.conf\n--- default.conf.org    2015-12-12 13:23:44.451490369 +0900\n+++ default.conf    2015-12-12 21:21:54.127622046 +0900\n@@ -1,4 +1,5 @@\n server {\n+    root   /usr/share/nginx/html;\n     listen       80;\n     server_name  localhost;\n\n@@ -27,13 +28,13 @@\n\n     # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n     #\n-    #location ~ \\.php$ {\n-    #    root           html;\n-    #    fastcgi_pass   127.0.0.1:9000;\n-    #    fastcgi_index  index.php;\n-    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n-    #    include        fastcgi_params;\n-    #}\n+    location ~ \\.php$ {\n+        #root           html;\n+        fastcgi_pass   127.0.0.1:9000;\n+        fastcgi_index  index.php;\n+        fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;\n+        include        fastcgi_params;\n+    }\n\n     # deny access to .htaccess files, if Apache's document root\n     # concurs with nginx's one\n\n\u3053\u3093\u306a\u611f\u3058\u3002\n\nnginx\u306e\u8d77\u52d5\nsudo nginx -t\nsudo systemctl start nginx\n\n\u6700\u521d\u306e\u30b3\u30de\u30f3\u30c9\u306fconf\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002\napache\u3067\u3044\u3046\napachectl configtest\n\n\u3067\u3059\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u307b\u3044\u3063!!\n\n# PHP7\u89e6\u3063\u3066\u307f\u305f - GUI\u7de8 -\n\n[\u524d\u56de](http://qiita.com/yu_eguchi/items/2405d81086d77eff3329)\u306fPHP7\u3092CentOS7\u306b\u5165\u308c\u3066\u3001CUI\u304b\u3089\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fnginx\u7d4c\u7531\u3067GUI\u304b\u3089PHP\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n## \u4e8b\u524d\u6e96\u5099\n\n```\ncd ~/vagrant/centos70/\nvagrant up\nvagrant ssh\nphp -v\nPHP 7.0.2-dev (cli) (built: Dec 11 2015 20:27:52) ( NTS )\nCopyright (c) 1997-2015 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2015 Zend Technologies\n```\n\n## nginx\u306e\u5c0e\u5165\n\nyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001\u8ffd\u52a0\u767b\u9332\u3057\u307e\u3059\u3002\n\n```\nvi /etc/yum.repos.d/nginx.repo\n```\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\n\n```\n[nginx]\nname=nginx repo\n#baseurl=http://nginx.org/packages/centos/$releasever/$basearch/\nbaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/\ngpgcheck=0\nenabled=0\n```\n\n\u3053\u308c\u3067\u6e96\u5099OK\n\n```\nyum --enablerepo=nginx install nginx\n```\n\n\u5b8c\u4e86\u3002\n\n## php-fpm\u306e\u5c0e\u5165\n\n- php-fpm\u3063\u3066??\n\nPHP\u3068WEB\u30b5\u30fc\u30d0(\u4eca\u56de\u306fnginx)\u3092\u3064\u306a\u3050\u306e\u306b\u5fc5\u8981\u306b\u306a\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\n\nphp7\u3092yum\u3057\u305f\u969b\u306b,\u30c7\u30d5\u30a9\u30eb\u30c8\u306ephp-fpm\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304cinstall\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\n\u3053\u308c\u3092nginx\u7528\u306b\u66f8\u304d\u63db\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nsudo cp -p /usr/local/php7/etc/php-fpm.conf.default /usr/local/php7/etc/php-fpm.conf\n```\n\n\u3053\u306econf\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002default\u306foriginal\u3068\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u306a\u308a\u307e\u3059\u3002\n\n```\nvi /usr/local/php7/etc/php-fpm.conf\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-12 22.09.14.png](https://qiita-image-store.s3.amazonaws.com/0/78857/f003c09b-2ffe-bfd5-8f1c-3936ad1ad2bd.png)\n\n\u4e0a\u8a18\u306e17\u884c\u76ee\u306881\u884c\u76ee\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u5916\u3057\u307e\u3059\u3002\n\n\u7d50\u679c\u3068\u3057\u3066\u3053\u3046\u306a\u308b\n\n```\n$ diff -u php-fpm.conf php-fpm.conf.default \n--- php-fpm.conf\t2015-12-12 20:53:39.684996478 +0900\n+++ php-fpm.conf.default\t2015-12-12 05:30:36.000000000 +0900\n@@ -14,7 +14,7 @@\n ; Pid file\n ; Note: the default prefix is /usr/local/php7/var\n ; Default Value: none\n-pid = run/php-fpm.pid\n+;pid = run/php-fpm.pid\n \n ; Error log file\n ; If it's set to \"syslog\", log is sent to syslogd instead of being written\n@@ -78,7 +78,7 @@\n \n ; Send FPM to background. Set to 'no' to keep FPM in foreground for debugging.\n ; Default Value: yes\n-daemonize = yes\n+;daemonize = yes\n \n ; Set open file descriptor rlimit for the master process.\n ; Default Value: system defined value\n```\n\n\u6b21\u3002\n\n```\nsudo cp -p /usr/local/php7/etc/php-fpm.d/www.conf.default /usr/local/php7/etc/php-fpm.d/www.conf\nvi /usr/local/php7/etc/php-fpm.d/www.conf\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-12 22.25.02.png](https://qiita-image-store.s3.amazonaws.com/0/78857/e2034a47-4dbf-d36f-2856-56098d894735.png)\n\n\u4e0a\u8a18\u306e23\u306824\u884c\u76ee\u3092\n\n```\nuser = nginx\ngroup = nginx\n```\n\n\u3068\u3059\u308b\u3053\u3068\u3067\u3001nnginx\u306b\u5bfe\u5fdc\u3059\u308b\u3002\n\n\u6b21\u306b\u3001php-fpm\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7d44\u307f\u307e\u3059\u3002\n\n```\nvi /etc/init.d/php-fpm\n```\n\n\u4e2d\u8eab\u306f\u4ee5\u4e0b\u3002\n\n```\n#! /bin/sh\n### BEGIN INIT INFO\n# Provides:          php--fpm\n# Required-Start:    $all\n# Required-Stop:     $all\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: starts php-fpm\n# Description:       starts the PHP FastCGI Process Manager daemon\n### END INIT INFO\nphp_fpm_BIN=/usr/local/php7/sbin/php-fpm\nphp_fpm_CONF=/usr/local/php7/etc/php-fpm.conf\nphp_fpm_PID=/usr/local/php7/var/run/php-fpm.pid\nphp_opts=\"--fpm-config $php_fpm_CONF\"\nwait_for_pid () {\n        try=0\n        while test $try -lt 35 ; do\n                case \"$1\" in\n                        'created')\n                        if [ -f \"$2\" ] ; then\n                                try=''\n                                break\n                        fi\n                        ;;\n                        'removed')\n                        if [ ! -f \"$2\" ] ; then\n                                try=''\n                                break\n                        fi\n                        ;;\n                esac\n                echo -n .\n                try=`expr $try + 1`\n                sleep 1\n        done\n}\ncase \"$1\" in\n        start)\n                echo -n \"Starting php-fpm \"\n                $php_fpm_BIN $php_opts\n                if [ \"$?\" != 0 ] ; then\n                        echo \" failed\"\n                        exit 1\n                fi\n                wait_for_pid created $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed\"\n                        exit 1\n                else\n                        echo \" done\"\n                fi\n        ;;\n        stop)\n                echo -n \"Gracefully shutting down php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -QUIT `cat $php_fpm_PID`\n                wait_for_pid removed $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed. Use force-exit\"\n                        exit 1\n                else\n                        echo \" done\"\n                       echo \" done\"\n                fi\n        ;;\n        force-quit)\n                echo -n \"Terminating php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -TERM `cat $php_fpm_PID`\n                wait_for_pid removed $php_fpm_PID\n                if [ -n \"$try\" ] ; then\n                        echo \" failed\"\n                        exit 1\n                else\n                        echo \" done\"\n                fi\n        ;;\n        restart)\n                $0 stop\n                $0 start\n        ;;\n        reload)\n                echo -n \"Reload service php-fpm \"\n                if [ ! -r $php_fpm_PID ] ; then\n                        echo \"warning, no pid file found - php-fpm is not running ?\"\n                        exit 1\n                fi\n                kill -USR2 `cat $php_fpm_PID`\n                echo \" done\"\n        ;;\n        *)\n                echo \"Usage: $0 {start|stop|force-quit|restart|reload}\"\n                exit 1\n        ;;\nesac\n```\n\n\u3053\u308c\u3067\u4eca\u5f8c\u3001php-fpm\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306f\n\n```\nsudo /etc/init.d/php-fpm start\n```\n\n\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\nchkconfig\u306b\u767b\u9332\u3057\u3066\u304a\u3044\u3066\u3082\u826f\u3044\u3067\u3059\u306d\u3002\n\n## nginx\u306e\u8a2d\u5b9a\n\nnginx\u306b\u3082\u3001php\u304c\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nsudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default.conf.org\nsudo vi /etc/nginx/conf.d/default.conf\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-12 22.30.16.png](https://qiita-image-store.s3.amazonaws.com/0/78857/10214bb6-351a-98af-69fc-cf93a1072740.png)\n\n\u3053\u3046\u3057\u307e\u3059\u3002\ndiff\u898b\u308b\u3068\n\n```\n[vagrant@localhost conf.d]$ diff -u default.conf.org default.conf\n--- default.conf.org\t2015-12-12 13:23:44.451490369 +0900\n+++ default.conf\t2015-12-12 21:21:54.127622046 +0900\n@@ -1,4 +1,5 @@\n server {\n+    root\t/usr/share/nginx/html;\n     listen       80;\n     server_name  localhost;\n \n@@ -27,13 +28,13 @@\n \n     # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n     #\n-    #location ~ \\.php$ {\n-    #    root           html;\n-    #    fastcgi_pass   127.0.0.1:9000;\n-    #    fastcgi_index  index.php;\n-    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n-    #    include        fastcgi_params;\n-    #}\n+    location ~ \\.php$ {\n+        #root           html;\n+        fastcgi_pass   127.0.0.1:9000;\n+        fastcgi_index  index.php;\n+        fastcgi_param  SCRIPT_FILENAME  $document_root/$fastcgi_script_name;\n+        include        fastcgi_params;\n+    }\n \n     # deny access to .htaccess files, if Apache's document root\n     # concurs with nginx's one\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3002\n\n## nginx\u306e\u8d77\u52d5\n\n```\nsudo nginx -t\nsudo systemctl start nginx\n```\n\n\u6700\u521d\u306e\u30b3\u30de\u30f3\u30c9\u306fconf\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002\napache\u3067\u3044\u3046\n\n```\napachectl configtest\n```\n\n\u3067\u3059\u3002\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n\u307b\u3044\u3063!!\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-12 21.37.47.png](https://qiita-image-store.s3.amazonaws.com/0/78857/8494d61f-fe7e-ff0b-820f-1f12a235c36b.png)\n"}