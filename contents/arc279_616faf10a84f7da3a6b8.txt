{"context": " More than 1 year has passed since last update.\n\nvagrant + ansible + fabric \u3067python\u306e\u958b\u767a\u74b0\u5883\u4f5c\u308b\n\nvagrant\u3067\u958b\u767a\u30b5\u30fc\u30d0\u4f5c\u3063\u3066\n\u305d\u3053\u306bansible\u3067python\u74b0\u5883\u4f5c\u308b\nflask + uwsgi\u3092\u4f7f\u7528\u3057\u3066\nfabric\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u3088\u3046\u306b\n\n\u307f\u305f\u3044\u306a\u3002\n\u3042\u3093\u307e\u7a81\u3063\u8fbc\u3093\u3060\u5185\u5bb9\u306b\u306f\u89e6\u308c\u3066\u306a\u3044\u3067\u3059\u3002\n\u4e2d\u9014\u534a\u7aef\u3060\u3051\u3069\u3001\u4e00\u901a\u308a\u307e\u3068\u307e\u3063\u305f\u60c5\u5831\u304c\u306a\u304b\u306a\u304b\u7121\u304f\u3066\u3051\u3063\u3053\u3046\u6642\u9593\u8cbb\u3084\u3057\u305f\u306e\u3067\u3001\n\u305d\u306e\u8fba\u306e\u307e\u3068\u3081\u3066\u304a\u3044\u3066\u3082\u3044\u3044\u304b\u306a\u3063\u3066\u3002\n\u30cf\u30de\u308a\u3069\u3053\u308d\u3068\u304btips\u7684\u306b\u3002\n\u6700\u7d42\u7684\u306a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n.\n\u251c\u2500\u2500 Vagrantfile\n\u251c\u2500\u2500 ansible.cfg\n\u251c\u2500\u2500 fabfile.py\n\u251c\u2500\u2500 flask\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 reload.trigger\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 runserver.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 uwsgi.ini\n\u251c\u2500\u2500 inventory\n\u251c\u2500\u2500 playbooks\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 python.yml\n\u2514\u2500\u2500 ssh.config\n\n\nvagrant\u3067\u958b\u767a\u7528\u306evm\u3092\u4f5c\u308b\n\nbox\u8ffd\u52a0\ncentos6 \u3063\u3066\u540d\u524d\u3067vagrant\u306ebox\u3092\u8ffd\u52a0\u3002\n\nbash\nvagrant box add centos6 http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_centos-6.5_chef-provisionerless.box\n\n\n\n\u8a2d\u5b9a\n\u7279\u306b\u7406\u7531\u306f\u7121\u3044\u3051\u30692\u3064\u4f5c\u3063\u3066\u307f\u308b\u3002\nrsync\u3067\u307e\u3068\u3081\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u305f\u3044\u3057\u3002\n1\u500b\u3067\u3088\u3051\u308c\u3070 node1 \u3060\u3051\u3067\u304a\uff4b\u3002\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  config.vm.define :node1 do |node|\n    node.vm.box = \"centos6\"\n    node.vm.network :private_network, ip: \"192.168.33.10\"\n\n    node.vm.provider :virtualbox do |vb|\n        vb.customize [\"modifyvm\", :id, \"--memory\", \"512\"]\n    end\n  end\n\n  config.vm.define :node2 do |node|\n    node.vm.box = \"centos6\"\n    node.vm.network :private_network, ip: \"192.168.33.11\"\n\n    node.vm.provider :virtualbox do |vb|\n        vb.customize [\"modifyvm\", :id, \"--memory\", \"512\"]\n    end\n  end\n\nend\n\n\n\nvm\u306e ssh-config \u3092\u7528\u610f\nssh\u3067\u7e4b\u3050\u6642\u306b\u4fbf\u5229\u306a\u306e\u3067\u3002\n\nbash\nvagrant ssh-config > ssh.config\n\n\n\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308b\u306f\u305a\u3002\n\nssh.config\nHost node1\n  HostName 127.0.0.1\n  User vagrant\n  Port 2222\n  UserKnownHostsFile /dev/null\n  StrictHostKeyChecking no\n  PasswordAuthentication no\n  IdentityFile /Users/kuryu/.vagrant.d/insecure_private_key\n  IdentitiesOnly yes\n  LogLevel FATAL\n\nHost node2\n  HostName 127.0.0.1\n  User vagrant\n  Port 2200\n  UserKnownHostsFile /dev/null\n  StrictHostKeyChecking no\n  PasswordAuthentication no\n  IdentityFile /Users/kuryu/.vagrant.d/insecure_private_key\n  IdentitiesOnly yes\n  LogLevel FATAL\n\n\n\n\u8d77\u52d5\n\nbash\nvagrant up\n\n\n\nansible\u3067python\u74b0\u5883\u4f5c\u308b\n\u9577\u304f\u306a\u308b\u306e\u3067\u8a18\u4e8b\u5206\u3051\u305f\u3002\n\u3053\u3063\u3061\u3092\u53c2\u7167\u3002\nhttp://qiita.com/arc279/items/44ac688a2df24569f8af\n\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\ninventory\n[servers]\nnode1\nnode2\n\n\n\u2191\u306e\u8a18\u4e8b\u306b\u306f\u66f8\u3044\u3066\u306a\u3044\u3051\u3069\u3001\nansible \u3067ssh\u3059\u308b\u6642\u306bconfig\u3092\u53c2\u7167\u3059\u308b\u8a2d\u5b9a\u3092\u3001ansible\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u3066\u304a\u304f\u3002\n\u3064\u3044\u3067\u306b\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u6307\u5b9a\u3082\u3002\n\nansible.cfg\n[defaults]\nhostfile = inventory\n\n[ssh_connection]\nssh_args = -F ssh.config\n\n\nansible.cfg \u306f\u30ab\u30ec\u30f3\u30c8\u306b\u7f6e\u3044\u3066\u304a\u3051\u3070\u52dd\u624b\u306b\u8aad\u3093\u3067\u304f\u308c\u308b\u3002\n\u5b9f\u884c\u306f\u3053\u3046\u3002\nansible-playbook playbooks/python.yml\n\n\nflask + uwsgi\u3092\u4f7f\u7528\n\n\u672c\u4f53\n\nmain.py\n# -*- coding:utf-8 -*-\n\nfrom flask import Flask\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef index():\n    return \"hello flask!!\"\n\n@app.route(\"/foo\")\ndef foo():\n    return \"foo\"\n\n@app.route(\"/foo/bar\")\ndef foo_bar():\n    return \"foobar\"\n\n\n\nWerkzeug \u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\n\nrunserver.py\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\nfrom main import app\n\noptions = {\n    \"debug\": True,\n    \"threaded\": True,\n    \"host\": \"0.0.0.0\",\n}\napp.run(**options)\n\n\nWerkzeug\u3067\u30c7\u30d0\u30c3\u30b0\u8d77\u52d5\u3059\u308b\u306a\u3089\u30b3\u30ec\u306b\u5b9f\u884c\u6a29\u9650\u4ed8\u3051\u3066\u53e9\u3051\u3070\u304a\uff4b\u3002\n\nuwsgi \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\ntouch-reload \u3067\u3001touch\u3055\u308c\u305f\u3089uwsgi\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\n\u5fc5\u8981\u306a\u3089 daemonize \u306e\u6307\u5b9a\u3082\u5165\u308c\u308b\u3068\u3088\u3044\u3068\u601d\u3046\u3002\n\nuwsgi.ini\n[uwsgi]\nsocket = /tmp/flask.wsgi.sock\nmaster = true\nuid = vagrant\ngid = vagrant\nhttp = :5000\npython-path = .      # uwsgi \u8d77\u52d5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30ab\u30ec\u30f3\u30c8\u306b\u306a\u3063\u3066\u308b\nwsgi = main:app\nprocesses = 3\nthreads = 2\npidfile = ./flask.pid\ntouch-reload = ./reload.trigger\nenv = environment=development\n\n\n\u306a\u3093\u304b\u3059\u3054\u3044\u4e0d\u81ea\u7136\u306a\u66f8\u304d\u65b9\u3060\u3051\u3069\u3001\n\u3053\u3053\u3067 env = [key]=[value]\u306e\u5f62\u3067\u6307\u5b9a\u3057\u3066\u304a\u3051\u3070\u3001\n\u8d77\u52d5\u6642\u306b\nimport os\nprint os.environ[\"environment\"]\n\n\u3067\u8aad\u3081\u308b\u3002\n\nuwsgi \u8d77\u52d5\n\u2191\u3067ansible\u3067pyenv\u4f5c\u3063\u305f\u6642\u306b\u4e00\u7dd2\u306bpip\u3067uwsgi\u3082\u5165\u308c\u3066\u308b\u306f\u305a\u306a\u306e\u3067\u3001\nflask\u306e\u30ab\u30ec\u30f3\u30c8\u3067\n\nbash\nuwsgi uwsgi.ini\n\n\n\u3067\u8d77\u52d5\u3059\u308b\u306f\u305a\u3002\n\nfabric + rsync \u3067\u30c7\u30d7\u30ed\u30a4\nrsync\u306f sync\u3059\u308b\u5074 \u3068 sync\u3055\u308c\u308b\u5074 \u4e21\u65b9\u306b\u5165\u3063\u3066\u306a\u3044\u3068\u99c4\u76ee\u3002\n\u2191\u306eansible\u306e\u8a18\u4e8b\u3067rsync\u3082\u4e00\u7dd2\u306b\u5165\u308c\u3066\u308b\u306e\u3067\u3001\n\u3061\u3083\u3093\u3068playbook\u304c\u901a\u3063\u3066\u308c\u3070vm\u5074\u306brsync\u5165\u3063\u3066\u308b\u306f\u305a\u3002\n\nansible\u306e\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u3092fabric\u3067\u3082\u4f7f\u7528\u3057\u305f\u3044\n\u8a73\u7d30\u306f\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3002\nhttp://qiita.com/shivaken/items/c679ae9d15ac1cbebd0b\n\nssh-config \u3092\u53c2\u7167\u3057\u305f\u3044\n\u3053\u3046\u3002\nenv.use_ssh_config = True\nenv.ssh_config_path = \"ssh.config\"\n\nssh-config \u306e\u6307\u5b9a\u3067 vagrant\u30e6\u30fc\u30b6\u3067\u7e4b\u3050\u3088\u3046\u306b\u306a\u3063\u3066\u308b\u306e\u3067\u3001\n\u63a5\u7d9a\u5148\u306e $HOME \u306f /home/vagrant \u306b\u306a\u3063\u3066\u308b\u3002\n\u306a\u306e\u3067\u3001\n\nlocal_dir='./flask/',\n\u624b\u5143\u306eflask\u3092\nremote_dir='~/flask',\nvm\u306e /home/vagrant/flask \u306b\n\nrsync_project() \u3067rysnc\u3059\u308b\u3002\n\nfabfile.py\nfrom fabric.api import *\nfrom fabric.decorators import roles\nfrom fabric.contrib.project import rsync_project\nimport ansible.inventory\n\nenv.use_ssh_config = True\nenv.ssh_config_path = \"ssh.config\"\n\ninventory = ansible.inventory.Inventory('inventory')\nenv.roledefs = inventory.groups_list()\n\ndef hostname():\n    run(\"echo %s\" % env.host)\n\ndef deploy():\n    rsync_project(\n        local_dir='./flask/',\n        remote_dir='~/flask',\n        exclude=['.DS_Tore', '*.tmp'],\n        delete=True\n    )\n    reload()\n\n@roles('servers')\ndef deployall():\n    deploy()\n\ndef reload():\n    run('touch ~/flask/reload.trigger')\n\n\n\nfab\n\n\u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u3066\n-R \u30aa\u30d7\u30b7\u30e7\u30f3\u3067role\u3092\u6307\u5b9a\u3002\nansible\u306e\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u306e\u30b0\u30eb\u30fc\u30d7\u540d\u304crole\u306b\u306a\u3063\u3066\u308b\u3089\u3057\u3044\u3002\n\uff03\u3053\u306e\u8fba\u3042\u307e\u308a\u3061\u3083\u3093\u3068\u8abf\u3079\u3066\u306a\u3044\u3002\n\nbash\nfab -R servers deploy\n\n\n@roles('servers') \u30c7\u30b3\u30ec\u30fc\u30bf\u4ed8\u3051\u3066\u308b\u3053\u3063\u3061\u3067\u3082\u304a\uff4b\u3002\n\nbash\nfab deployall\n\n\n\n\u5358\u4f53\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\n\nbash\nfab -H node1 deploy\n\n\n\n\u3067\n\u306a\u3093\u304b\u307e\u3068\u307e\u308a\u306e\u7121\u3044\u5185\u5bb9\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\u30c7\u30d7\u30ed\u30a4\u306frsync\u3058\u3083\u306a\u304f\u3066 git pull \u306b\u3059\u308b\u3068\u304b\u3001\n\u30e2\u30c0\u30f3\u306a\u30a2\u30ec\u306b\u3057\u3066\u3082\u3088\u3044\u3068\u601d\u3046\u3002\n\u3082\u3063\u3068\u3084\u308b\u306a\u3089\u3001\n\nansible\u3067\u4e00\u7dd2\u306bnginx\u5165\u308c\u3066uwsgi\u306b\u7e4b\u3050\u3068\u304b\nuwsgi \u306e start/stop \u3082fab\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u304b\n\n\u3044\u308d\u3044\u308d\u3042\u308b\u3068\u601d\u3046\u3051\u3069\u3001\u307e\u3041\u305d\u306e\u8fba\u306f\u958b\u767a\u74b0\u5883\u4f5c\u308b\u3063\u3066\u3053\u3068\u3067\u30aa\u30df\u30c3\u30c8\u3002\n# vagrant + ansible + fabric \u3067python\u306e\u958b\u767a\u74b0\u5883\u4f5c\u308b\n\n* vagrant\u3067\u958b\u767a\u30b5\u30fc\u30d0\u4f5c\u3063\u3066\n* \u305d\u3053\u306bansible\u3067python\u74b0\u5883\u4f5c\u308b\n* flask + uwsgi\u3092\u4f7f\u7528\u3057\u3066\n* fabric\u3067\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u308b\u3088\u3046\u306b\n\n\u307f\u305f\u3044\u306a\u3002\n\n\u3042\u3093\u307e\u7a81\u3063\u8fbc\u3093\u3060\u5185\u5bb9\u306b\u306f\u89e6\u308c\u3066\u306a\u3044\u3067\u3059\u3002\n\n\u4e2d\u9014\u534a\u7aef\u3060\u3051\u3069\u3001\u4e00\u901a\u308a\u307e\u3068\u307e\u3063\u305f\u60c5\u5831\u304c\u306a\u304b\u306a\u304b\u7121\u304f\u3066\u3051\u3063\u3053\u3046\u6642\u9593\u8cbb\u3084\u3057\u305f\u306e\u3067\u3001\n\u305d\u306e\u8fba\u306e\u307e\u3068\u3081\u3066\u304a\u3044\u3066\u3082\u3044\u3044\u304b\u306a\u3063\u3066\u3002\n\u30cf\u30de\u308a\u3069\u3053\u308d\u3068\u304btips\u7684\u306b\u3002\n\n\u6700\u7d42\u7684\u306a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n```\n.\n\u251c\u2500\u2500 Vagrantfile\n\u251c\u2500\u2500 ansible.cfg\n\u251c\u2500\u2500 fabfile.py\n\u251c\u2500\u2500 flask\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 reload.trigger\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 runserver.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 uwsgi.ini\n\u251c\u2500\u2500 inventory\n\u251c\u2500\u2500 playbooks\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 python.yml\n\u2514\u2500\u2500 ssh.config\n```\n\n## vagrant\u3067\u958b\u767a\u7528\u306evm\u3092\u4f5c\u308b\n\n### box\u8ffd\u52a0\n\n__centos6__ \u3063\u3066\u540d\u524d\u3067vagrant\u306ebox\u3092\u8ffd\u52a0\u3002\n\n```bash:bash\nvagrant box add centos6 http://opscode-vm-bento.s3.amazonaws.com/vagrant/virtualbox/opscode_centos-6.5_chef-provisionerless.box\n```\n\n### \u8a2d\u5b9a\n\n\u7279\u306b\u7406\u7531\u306f\u7121\u3044\u3051\u30692\u3064\u4f5c\u3063\u3066\u307f\u308b\u3002\nrsync\u3067\u307e\u3068\u3081\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u305f\u3044\u3057\u3002\n\n1\u500b\u3067\u3088\u3051\u308c\u3070 _node1_ \u3060\u3051\u3067\u304a\uff4b\u3002\n\n```ruby:Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(\"2\") do |config|\n\n  config.vm.define :node1 do |node|\n    node.vm.box = \"centos6\"\n    node.vm.network :private_network, ip: \"192.168.33.10\"\n\n    node.vm.provider :virtualbox do |vb|\n        vb.customize [\"modifyvm\", :id, \"--memory\", \"512\"]\n    end\n  end\n\n  config.vm.define :node2 do |node|\n    node.vm.box = \"centos6\"\n    node.vm.network :private_network, ip: \"192.168.33.11\"\n\n    node.vm.provider :virtualbox do |vb|\n        vb.customize [\"modifyvm\", :id, \"--memory\", \"512\"]\n    end\n  end\n\nend\n```\n\n### vm\u306e ssh-config \u3092\u7528\u610f\n\nssh\u3067\u7e4b\u3050\u6642\u306b\u4fbf\u5229\u306a\u306e\u3067\u3002\n\n```bash:bash\nvagrant ssh-config > ssh.config\n```\n\n\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308b\u306f\u305a\u3002\n\n```ssh.config\nHost node1\n  HostName 127.0.0.1\n  User vagrant\n  Port 2222\n  UserKnownHostsFile /dev/null\n  StrictHostKeyChecking no\n  PasswordAuthentication no\n  IdentityFile /Users/kuryu/.vagrant.d/insecure_private_key\n  IdentitiesOnly yes\n  LogLevel FATAL\n\nHost node2\n  HostName 127.0.0.1\n  User vagrant\n  Port 2200\n  UserKnownHostsFile /dev/null\n  StrictHostKeyChecking no\n  PasswordAuthentication no\n  IdentityFile /Users/kuryu/.vagrant.d/insecure_private_key\n  IdentitiesOnly yes\n  LogLevel FATAL\n```\n\n### \u8d77\u52d5\n\n```bash:bash\nvagrant up\n```\n\n## ansible\u3067python\u74b0\u5883\u4f5c\u308b\n\n\u9577\u304f\u306a\u308b\u306e\u3067\u8a18\u4e8b\u5206\u3051\u305f\u3002\n\u3053\u3063\u3061\u3092\u53c2\u7167\u3002\nhttp://qiita.com/arc279/items/44ac688a2df24569f8af\n\n\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n```ini:inventory\n[servers]\nnode1\nnode2\n```\n\n\u2191\u306e\u8a18\u4e8b\u306b\u306f\u66f8\u3044\u3066\u306a\u3044\u3051\u3069\u3001\nansible \u3067ssh\u3059\u308b\u6642\u306bconfig\u3092\u53c2\u7167\u3059\u308b\u8a2d\u5b9a\u3092\u3001ansible\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u3066\u304a\u304f\u3002\n\u3064\u3044\u3067\u306b\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u6307\u5b9a\u3082\u3002\n\n```ini:ansible.cfg\n[defaults]\nhostfile = inventory\n\n[ssh_connection]\nssh_args = -F ssh.config\n```\n\n_ansible.cfg_ \u306f\u30ab\u30ec\u30f3\u30c8\u306b\u7f6e\u3044\u3066\u304a\u3051\u3070\u52dd\u624b\u306b\u8aad\u3093\u3067\u304f\u308c\u308b\u3002\n\n\u5b9f\u884c\u306f\u3053\u3046\u3002\n\n```bash\nansible-playbook playbooks/python.yml\n```\n\n## flask + uwsgi\u3092\u4f7f\u7528\n\n### \u672c\u4f53\n\n```py:main.py\n# -*- coding:utf-8 -*-\n\nfrom flask import Flask\n\napp = Flask(__name__)\n\n@app.route(\"/\")\ndef index():\n    return \"hello flask!!\"\n\n@app.route(\"/foo\")\ndef foo():\n    return \"foo\"\n\n@app.route(\"/foo/bar\")\ndef foo_bar():\n    return \"foobar\"\n```\n\n### Werkzeug \u8d77\u52d5\u30d5\u30a1\u30a4\u30eb\n\n```py:runserver.py\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\n\nfrom main import app\n\noptions = {\n    \"debug\": True,\n    \"threaded\": True,\n    \"host\": \"0.0.0.0\",\n}\napp.run(**options)\n```\n\nWerkzeug\u3067\u30c7\u30d0\u30c3\u30b0\u8d77\u52d5\u3059\u308b\u306a\u3089\u30b3\u30ec\u306b\u5b9f\u884c\u6a29\u9650\u4ed8\u3051\u3066\u53e9\u3051\u3070\u304a\uff4b\u3002\n\n### uwsgi \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n_touch-reload_ \u3067\u3001touch\u3055\u308c\u305f\u3089uwsgi\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\n\u5fc5\u8981\u306a\u3089 _daemonize_ \u306e\u6307\u5b9a\u3082\u5165\u308c\u308b\u3068\u3088\u3044\u3068\u601d\u3046\u3002\n\n```ini:uwsgi.ini\n[uwsgi]\nsocket = /tmp/flask.wsgi.sock\nmaster = true\nuid = vagrant\ngid = vagrant\nhttp = :5000\npython-path = .      # uwsgi \u8d77\u52d5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u30ab\u30ec\u30f3\u30c8\u306b\u306a\u3063\u3066\u308b\nwsgi = main:app\nprocesses = 3\nthreads = 2\npidfile = ./flask.pid\ntouch-reload = ./reload.trigger\nenv = environment=development\n```\n\n\u306a\u3093\u304b\u3059\u3054\u3044\u4e0d\u81ea\u7136\u306a\u66f8\u304d\u65b9\u3060\u3051\u3069\u3001\n\u3053\u3053\u3067 _env =_ __[key]=[value]__\u306e\u5f62\u3067\u6307\u5b9a\u3057\u3066\u304a\u3051\u3070\u3001\n\u8d77\u52d5\u6642\u306b\n\n```py\nimport os\nprint os.environ[\"environment\"]\n```\n\n\u3067\u8aad\u3081\u308b\u3002\n\n### uwsgi \u8d77\u52d5\n\n\u2191\u3067ansible\u3067pyenv\u4f5c\u3063\u305f\u6642\u306b\u4e00\u7dd2\u306bpip\u3067uwsgi\u3082\u5165\u308c\u3066\u308b\u306f\u305a\u306a\u306e\u3067\u3001\n\nflask\u306e\u30ab\u30ec\u30f3\u30c8\u3067\n\n```bash:bash\nuwsgi uwsgi.ini\n```\n\n\u3067\u8d77\u52d5\u3059\u308b\u306f\u305a\u3002\n\n## fabric + rsync \u3067\u30c7\u30d7\u30ed\u30a4\n\nrsync\u306f _sync\u3059\u308b\u5074_ \u3068 _sync\u3055\u308c\u308b\u5074_ \u4e21\u65b9\u306b\u5165\u3063\u3066\u306a\u3044\u3068\u99c4\u76ee\u3002\n\n\u2191\u306eansible\u306e\u8a18\u4e8b\u3067rsync\u3082\u4e00\u7dd2\u306b\u5165\u308c\u3066\u308b\u306e\u3067\u3001\n\u3061\u3083\u3093\u3068playbook\u304c\u901a\u3063\u3066\u308c\u3070vm\u5074\u306brsync\u5165\u3063\u3066\u308b\u306f\u305a\u3002\n\n### ansible\u306e\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u3092fabric\u3067\u3082\u4f7f\u7528\u3057\u305f\u3044\n\n\u8a73\u7d30\u306f\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3002\nhttp://qiita.com/shivaken/items/c679ae9d15ac1cbebd0b\n\n### ssh-config \u3092\u53c2\u7167\u3057\u305f\u3044\n\n\u3053\u3046\u3002\n\n```py\nenv.use_ssh_config = True\nenv.ssh_config_path = \"ssh.config\"\n```\n\n_ssh-config_ \u306e\u6307\u5b9a\u3067 _vagrant_\u30e6\u30fc\u30b6\u3067\u7e4b\u3050\u3088\u3046\u306b\u306a\u3063\u3066\u308b\u306e\u3067\u3001\n\u63a5\u7d9a\u5148\u306e __$HOME__ \u306f _/home/vagrant_ \u306b\u306a\u3063\u3066\u308b\u3002\n\n\u306a\u306e\u3067\u3001\n\n* local_dir='./flask/',\n\u624b\u5143\u306eflask\u3092\n\n* remote_dir='~/flask',\nvm\u306e _/home/vagrant/flask_ \u306b\n\n`rsync_project()` \u3067rysnc\u3059\u308b\u3002\n\n```py:fabfile.py\nfrom fabric.api import *\nfrom fabric.decorators import roles\nfrom fabric.contrib.project import rsync_project\nimport ansible.inventory\n\nenv.use_ssh_config = True\nenv.ssh_config_path = \"ssh.config\"\n\ninventory = ansible.inventory.Inventory('inventory')\nenv.roledefs = inventory.groups_list()\n\ndef hostname():\n    run(\"echo %s\" % env.host)\n\ndef deploy():\n    rsync_project(\n        local_dir='./flask/',\n        remote_dir='~/flask',\n        exclude=['.DS_Tore', '*.tmp'],\n        delete=True\n    )\n    reload()\n\n@roles('servers')\ndef deployall():\n    deploy()\n\ndef reload():\n    run('touch ~/flask/reload.trigger')\n```\n\n### fab\n\n#### \u30ed\u30fc\u30eb\u3092\u6307\u5b9a\u3057\u3066\n\n_-R_ \u30aa\u30d7\u30b7\u30e7\u30f3\u3067role\u3092\u6307\u5b9a\u3002\n\nansible\u306e\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u306e\u30b0\u30eb\u30fc\u30d7\u540d\u304crole\u306b\u306a\u3063\u3066\u308b\u3089\u3057\u3044\u3002\n\uff03\u3053\u306e\u8fba\u3042\u307e\u308a\u3061\u3083\u3093\u3068\u8abf\u3079\u3066\u306a\u3044\u3002\n\n```bash:bash\nfab -R servers deploy\n```\n\n`@roles('servers')` \u30c7\u30b3\u30ec\u30fc\u30bf\u4ed8\u3051\u3066\u308b\u3053\u3063\u3061\u3067\u3082\u304a\uff4b\u3002\n\n```bash:bash\nfab deployall\n```\n\n#### \u5358\u4f53\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\n\n```bash:bash\nfab -H node1 deploy\n```\n\n## \u3067\n\n\u306a\u3093\u304b\u307e\u3068\u307e\u308a\u306e\u7121\u3044\u5185\u5bb9\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\n\u30c7\u30d7\u30ed\u30a4\u306frsync\u3058\u3083\u306a\u304f\u3066 _git pull_ \u306b\u3059\u308b\u3068\u304b\u3001\n\u30e2\u30c0\u30f3\u306a\u30a2\u30ec\u306b\u3057\u3066\u3082\u3088\u3044\u3068\u601d\u3046\u3002\n\n\u3082\u3063\u3068\u3084\u308b\u306a\u3089\u3001\n\n* ansible\u3067\u4e00\u7dd2\u306bnginx\u5165\u308c\u3066uwsgi\u306b\u7e4b\u3050\u3068\u304b\n* uwsgi \u306e start/stop \u3082fab\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u304b\n\n\u3044\u308d\u3044\u308d\u3042\u308b\u3068\u601d\u3046\u3051\u3069\u3001\u307e\u3041\u305d\u306e\u8fba\u306f_\u958b\u767a\u74b0\u5883\u4f5c\u308b_\u3063\u3066\u3053\u3068\u3067\u30aa\u30df\u30c3\u30c8\u3002\n", "tags": ["Python", "fabric", "vagrant"]}