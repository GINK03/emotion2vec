{"context": "\n\nTL;DR\n\n\nminikube addons enable ingress \u3067 Minikube \u3067\u7c21\u5358\u306b Ingress \u3092\u4f7f\u3044\u306f\u3058\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u30ed\u30fc\u30ab\u30eb\u306e\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3067 Ingress \u306b\u8a2d\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u540d\u3092\u540d\u524d\u89e3\u6c7a\u3055\u305b\u3066\u3088\u308a\u5feb\u9069\u306b\u5229\u7528\u3059\u308b\nMinikube \u6a19\u6e96\u306e Ingress Controller \u306e\u4ee3\u308f\u308a\u306b nghttpx-ingress-controller \u3092\u4f7f\u3046\u306e\u3082\u7c21\u5358\u3001\u305d\u306e\u3068\u304d\u30ab\u30b9\u30bf\u30e0 Cluster Add-on \u3092\u4f7f\u3046\u3068\u3088\u308a\u5feb\u9069\u306b\u5229\u7528\u3067\u304d\u308b\n\n\n\u306f\u3058\u3081\u306b\n\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u304a\u3044\u3066 Ingress \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306a\u3089\u30ed\u30fc\u30ab\u30eb\u306e Minikube \u306b\u304a\u3044\u3066\u3082 Ingress \u3092\u5229\u7528\u3057\u3066\u52d5\u4f5c\u3092\u691c\u8a3c\u3057\u305f\u3044\u3002Minikube \u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9\u69cb\u6210\u306e Kubernetes \u30af\u30e9\u30b9\u30bf\u3092\u7c21\u5358\u306b\u69cb\u7bc9\u3067\u304d\u308b\u30c4\u30fc\u30eb\u3067\u3042\u308b\u3002\nIngress \u3092\u4f7f\u3046\u306b\u306f\u3001\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u57fa\u3065\u3044\u3066 L7 LB \u306e\u8a2d\u5b9a\u3092\u884c\u3046 Ingress Controller \u304c\u5fc5\u8981\u3067\u3042\u308b\u3002GKE \u306b\u304a\u3044\u3066\u306f\u3001Google Cloud Load Balancer (GCLB) \u3092\u5236\u5fa1\u3059\u308b Ingress Controller \u304c\u3042\u308a\u3001Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5b9a\u7fa9\u306b\u3057\u305f\u304c\u3063\u3066 GCLB \u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002Minikube \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305f\u30ed\u30fc\u30ab\u30eb\u306e\u30af\u30e9\u30b9\u30bf\u306b\u306f\u5f53\u7136\u306a\u304c\u3089 L7 LB \u306f\u5099\u308f\u3063\u3066\u3044\u306a\u3044\u3002\nMinikube \u306b\u306f addons \u3068\u3044\u3046\u6a5f\u80fd\u304c\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001Kubernetes Dashboard \u3084 heapstar, kube-dns \u306a\u3069\u306e\u30a2\u30c9\u30aa\u30f3\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u30a2\u30c9\u30aa\u30f3\u306e\u3072\u3068\u3064\u3068\u3057\u3066 nginx \u3092 Ingress \u306e L7 LB \u3068\u3057\u3066\u5229\u7528\u3059\u308b nginx-ingress-controller \u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u7c21\u5358\u306b Ingress \u306e\u5229\u7528\u3092\u958b\u59cb\u3067\u304d\u308b\u3002\n\nkubernetes/minikube: Run Kubernetes locally\nnginxinc/kubernetes-ingress: NGINX and NGINX Plus Ingress Controllers for Kubernetes\n\n\nIngress \u3092\u6709\u52b9\u306b\u3059\u308b\nIngress \u3092\u6709\u52b9\u306b\u3059\u308b\u524d\u306b\u3001\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u4e8b\u524d\u306b\u4f5c\u6210\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n$ minikube start\n\n\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u305f\u3089\u3001minikube addons \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u3001Ingress \u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n$ minikube addons enable ingress\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068 nginx-ingress-controller \u3068 default-http-backend \u304c kube-system \u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002\n$ kubectl get po -n kube-system\nNAME                             READY     STATUS    RESTARTS   AGE\ndefault-http-backend-2dmmw       1/1       Running   0          12m\nkube-addon-manager-minikube      1/1       Running   0          13m\nkube-dns-v20-1rr8n               3/3       Running   0          13m\nnginx-ingress-controller-85dql   1/1       Running   0          12m\n\nIngress \u30a2\u30c9\u30aa\u30f3\u306f v0.14.0 \u3067\u63d0\u4f9b\u3055\u308c\u305f\u3002\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u3068\u304d\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nIngress \u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\n\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u3053\u3053\u3067\u306f nginx \u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066 Ingress LB \u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002nginx.minikube.dev \u3068\u3044\u3046\u30db\u30b9\u30c8\u540d\u3067\u5168\u3066\u306e\u30d1\u30b9\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092 nginx \u30b5\u30fc\u30d3\u30b9\u306e80\u756a\u30dd\u30fc\u30c8\u306b\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n$ kubectl run nginx --image=nginx\n$ kubectl expose deploy nginx --port=80 --target-port=80\n$ cat <<EOL | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: nginx\nspec:\n  rules:\n  - host: nginx.minikube.dev\n    http:\n      paths:\n      - backend:\n          serviceName: nginx\n          servicePort: 80\nEOL\n\nMinikube \u3067\u4f5c\u6210\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u306f\u3072\u3068\u3064\u306e\u30de\u30b9\u30bf\u517c\u30ce\u30fc\u30c9\u306e\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3066\u304a\u308a\u3001\u5f53\u7136 Ingress \u306e\u4f7f\u3046 L7 LB (nginx) \u3082\u305d\u306e\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3002\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f\u3001minikube ip \u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u306e IP \u30a2\u30c9\u30ec\u30b9\u306b Host \u30d8\u30c3\u30c0 nginx.minikube.dev \u3092\u4ed8\u4e0e\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n$ curl -I http://`minikube ip` -H 'Host: nginx.minikube.dev'\nHTTP/1.1 200 OK\nServer: nginx/1.11.3\nDate: Fri, 17 Feb 2017 07:59:13 GMT\nContent-Type: text/html\nContent-Length: 612\nConnection: keep-alive\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nETag: \"58a323e4-264\"\nAccept-Ranges: bytes\n\nnginx-ingress-controller \u306e L7 LB \u306f\u30db\u30b9\u30c8\u30dd\u30fc\u30c8\u306e 80, 443 \u3092\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u306e\u65b9\u6cd5\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3002\u6c17\u306b\u306a\u308b\u4eba\u306f\u3001kubectl describe nginx-ingress-controller -n kube-system \u3067\u5b9a\u7fa9\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3088\u3044\u3002\n\u3053\u3053\u307e\u3067\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u3066\u3044\u308b\u304c\u3001curl \u3067\u306f\u306a\u304f\u4f8b\u3048\u3070\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u3068\u304d\u306a\u3069 Host \u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u306f\u9762\u5012\u3067\u3042\u308b\u3002\u6b21\u306b\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3059\u308b\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3092\u4f7f\u3044 Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5b9a\u7fa9\u3057\u305f\u30db\u30b9\u30c8\u540d\u3067\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nIngress \u306e\u30db\u30b9\u30c8\u540d\u3092\u540d\u524d\u89e3\u6c7a\u3059\u308b\n\u540d\u524d\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b\u306f\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u3053\u3053\u3067\u306f\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f dnsmasq \u3092\u305d\u308c\u306b\u5229\u7528\u3059\u308b\u3002\nUbuntu 16.04 LTS / 14.04 LTS\n$ sudo bash -c \"echo address=/minikube.dev/`minikube ip` > /etc/NetworkManager/dnsmasq.d/minikube.conf\"\n# for 16.04 LTS\n$ sudo systemctl restart NetworkManager\n# for 14.04 LTS\n$ sudo restart network-manager\n\nmacOS\n$ brew install dnsmasq\n$ echo address=/minikube.dev/`minikube ip` > /usr/local/etc/dnsmasq.conf\n$ sudo brew services start dnsmasq\n$ sudo mkdir -p /etc/resolver/\n$ sudo bash -c \"echo 'nameserver 127.0.0.1' > /etc/resolver/minikube.dev\"\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067\u3001minikube.dev. \u306e\u540d\u524d\u89e3\u6c7a\u306e\u7d50\u679c\u306b minikube ip \u3067\u51fa\u529b\u3055\u308c\u308b\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u304c\u8fd4\u5374\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u3001Ingress \u3067\u5b9a\u7fa9\u3057\u305f\u30db\u30b9\u30c8\u540d\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n$ nslookup nginx.minikube.dev\nServer:         127.0.1.1\nAddress:        127.0.1.1#53\n\nName:   nginx.minikube.dev\nAddress: 192.168.99.100\n$ curl -I http://nginx.minikube.dev/\nHTTP/1.1 200 OK\nServer: nginx/1.11.3\nDate: Fri, 17 Feb 2017 08:20:45 GMT\nContent-Type: text/html\nContent-Length: 612\nConnection: keep-alive\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nETag: \"58a323e4-264\"\nAccept-Ranges: bytes\n\n\n\u3082\u3061\u308d\u3093\u3053\u306e\u8a2d\u5b9a\u306b\u3088\u3063\u3066\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3082\u6b63\u3057\u304f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\ndnsmasq.conf \u306b\u8a2d\u5b9a\u3057\u305f\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f\u3001\u30af\u30e9\u30b9\u30bf\u3092\u518d\u4f5c\u6210\u3059\u308b\u3068\u5909\u308f\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u305d\u306e\u3068\u304d\u306f\u518d\u5ea6\u4e0a\u66f8\u304d\u3057\u3001dnsmasq \u3092\u518d\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n[PR] HTTP/2 \u3067\u30d5\u30a9\u30ef\u30fc\u30c9\u3067\u304d\u308b nghttpx-ingress-controller \u3092\u4f7f\u3046\nnghttpx-ingress-controller \u306f\u3001nghttpx \u3092 L7 LB \u3068\u3057\u3066\u5229\u7528\u3059\u308b Ingress Controller \u3067\u3042\u308b\u3002nghttpx \u306f\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u3082\u306b HTTP/2 \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001gRPC \u306e\u3088\u3046\u306a HTTP/2 \u3092\u4f7f\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u307e\u3067 HTTP/2 \u3067\u901a\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306a\u3069\u306e\u7279\u5fb4\u304c\u3042\u308b\u3002\u307e\u305f\u3053\u306e Ingress Controller \u81ea\u4f53\u3082 nghttpx \u306e\u958b\u767a\u8005\u81ea\u8eab\u304c\u958b\u767a\u3057\u3066\u304a\u308a\u3001nghttpx \u306e\u6a5f\u80fd\u3092\u4f59\u3059\u3068\u3053\u308d\u306a\u304f\u5229\u7528\u3067\u304d\u308b\u62e1\u5f35\u6027\u304c\u3042\u308b\u3002\n\nnghttpx - HTTP/2 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u30fc / L7 \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc - Qiita\nzlabjp/nghttpx-ingress-lb: nghttpx ingress controller for Kubernetes\nnghttpx Ingress controller // Speaker Deck\n\nnginx-ingress-controller \u306e\u4ee3\u308f\u308a\u306b nghttpx-ingress-controller \u3067\u3082\u3082\u3061\u308d\u3093\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3059\u308b\u3002nginx-ingress-controller \u3092\u7121\u52b9\u306b\u3057\u3066\u3001nghttpx-ingress-controller \u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3060\u3051\u3067\u3042\u308b\u3002\u305f\u3060\u3053\u308c\u3060\u3068\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u305f\u3073\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u76f4\u3059\u5fc5\u8981\u304c\u3042\u308a\u9762\u5012\u3067\u3042\u308b\u3002\nMinikube \u3067\u306f ~/.minikube/addons \u306b\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u304f\u3053\u3068\u3067\u81ea\u52d5\u7684\u306b\u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3002\u3053\u308c\u306f Minikube \u7d44\u307f\u8fbc\u307f\u306e\u30a2\u30c9\u30aa\u30f3\u3082\u540c\u69d8\u3060\u304c\u3001addon-manager \u3067\u5b9f\u73fe\u3055\u308c\u3066\u304a\u308a\u3001\u5358\u306b\u30de\u30b7\u30f3\u5185\u306e /etc/kubernetes/addons \u306b\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u30b3\u30d4\u30fc\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\naddon-manager \u306e\u4ed5\u69d8\u3068\u3057\u3066\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092 Cluster Add-on \u3068\u3057\u3066\u767b\u9332\u3059\u308b\u306b\u306f\u3001\u767b\u9332\u3059\u308b\u5168\u3066\u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u30e9\u30d9\u30eb\u306b kubernetes.io/cluster-service: true \u3068\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u6307\u5b9a\u6e08\u306e nghttpx-ingress-controller \u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092 gist \u306b\u7f6e\u3044\u3066\u304a\u3044\u305f\u306e\u3067\u30af\u30ed\u30fc\u30f3\u3057\u3066\u4f7f\u3046\u3002\n$ minikube addons disable ingress\n\n\u3053\u308c\u307e\u3067\u306e\u7d9a\u304d\u3067\u4f5c\u696d\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u6700\u521d\u306b nginx-ingress-controller \u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u3072\u3068\u3064\u306e\u30af\u30e9\u30b9\u30bf\u306b\u3042\u308b\u8907\u6570\u306e ingress-controller \u3092\u4f7f\u3044\u5206\u3051\u308b\u6a5f\u80fd\u3082\u5b58\u5728\u306f\u3059\u308b\u304c\u3001\u6df7\u4e71\u306e\u5143\u306a\u306e\u3067\u5fc5\u8981\u306a\u3051\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3088\u3044\u3002\n$ git clone https://gist.github.com/1b8b1e6e0dd13acf62be93c6cd329d92.git ~/.minikube/addons/nghttpx-ingress-controller\n$ minikube stop && minikube start\n\n\u30af\u30e9\u30b9\u30bf\u306e\u8d77\u52d5\u6642\u306b ~/.minikube/addons \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u30de\u30b7\u30f3\u5185\u306e /etc/kubernetes/addons \u306b\u30b3\u30d4\u30fc\u3055\u308c\u3001addon-manager \u306b\u3088\u308a\u81ea\u52d5\u7684\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u81ea\u52d5\u7684\u306b nghttpx-ingress-controller \u304c\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001nghttpx \u306e\u30d8\u30c3\u30c0\u304c\u51fa\u529b\u3055\u308c\u3066\u304a\u308a\u3001\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n$ curl -I http://nginx.minikube.dev\nHTTP/1.1 200 OK\nDate: Fri, 17 Feb 2017 08:33:03 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nEtag: \"58a323e4-264\"\nAccept-Ranges: bytes\nServer: nghttpx nghttp2/1.19.0\nVia: 1.1 nghttpx\n\n\n## TL;DR\n\n- `minikube addons enable ingress` \u3067 Minikube \u3067\u7c21\u5358\u306b Ingress \u3092\u4f7f\u3044\u306f\u3058\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n- \u30ed\u30fc\u30ab\u30eb\u306e\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3067 Ingress \u306b\u8a2d\u5b9a\u3057\u305f\u30db\u30b9\u30c8\u540d\u3092\u540d\u524d\u89e3\u6c7a\u3055\u305b\u3066\u3088\u308a\u5feb\u9069\u306b\u5229\u7528\u3059\u308b\n- Minikube \u6a19\u6e96\u306e Ingress Controller \u306e\u4ee3\u308f\u308a\u306b nghttpx-ingress-controller \u3092\u4f7f\u3046\u306e\u3082\u7c21\u5358\u3001\u305d\u306e\u3068\u304d\u30ab\u30b9\u30bf\u30e0 Cluster Add-on \u3092\u4f7f\u3046\u3068\u3088\u308a\u5feb\u9069\u306b\u5229\u7528\u3067\u304d\u308b\n\n## \u306f\u3058\u3081\u306b\n\n\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u304a\u3044\u3066 Ingress \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306a\u3089\u30ed\u30fc\u30ab\u30eb\u306e Minikube \u306b\u304a\u3044\u3066\u3082 Ingress \u3092\u5229\u7528\u3057\u3066\u52d5\u4f5c\u3092\u691c\u8a3c\u3057\u305f\u3044\u3002Minikube \u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9\u69cb\u6210\u306e Kubernetes \u30af\u30e9\u30b9\u30bf\u3092\u7c21\u5358\u306b\u69cb\u7bc9\u3067\u304d\u308b\u30c4\u30fc\u30eb\u3067\u3042\u308b\u3002\n\nIngress \u3092\u4f7f\u3046\u306b\u306f\u3001\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u57fa\u3065\u3044\u3066 L7 LB \u306e\u8a2d\u5b9a\u3092\u884c\u3046 Ingress Controller \u304c\u5fc5\u8981\u3067\u3042\u308b\u3002GKE \u306b\u304a\u3044\u3066\u306f\u3001Google Cloud Load Balancer (GCLB) \u3092\u5236\u5fa1\u3059\u308b Ingress Controller \u304c\u3042\u308a\u3001Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5b9a\u7fa9\u306b\u3057\u305f\u304c\u3063\u3066 GCLB \u306e\u8a2d\u5b9a\u3092\u884c\u3046\u3002Minikube \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305f\u30ed\u30fc\u30ab\u30eb\u306e\u30af\u30e9\u30b9\u30bf\u306b\u306f\u5f53\u7136\u306a\u304c\u3089 L7 LB \u306f\u5099\u308f\u3063\u3066\u3044\u306a\u3044\u3002\n\nMinikube \u306b\u306f addons \u3068\u3044\u3046\u6a5f\u80fd\u304c\u63d0\u4f9b\u3055\u308c\u3066\u304a\u308a\u3001Kubernetes Dashboard \u3084 heapstar, kube-dns \u306a\u3069\u306e\u30a2\u30c9\u30aa\u30f3\u3092\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u30a2\u30c9\u30aa\u30f3\u306e\u3072\u3068\u3064\u3068\u3057\u3066 nginx \u3092 Ingress \u306e L7 LB \u3068\u3057\u3066\u5229\u7528\u3059\u308b nginx-ingress-controller \u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u7c21\u5358\u306b Ingress \u306e\u5229\u7528\u3092\u958b\u59cb\u3067\u304d\u308b\u3002\n\n- [kubernetes/minikube: Run Kubernetes locally](https://github.com/kubernetes/minikube)\n- [nginxinc/kubernetes-ingress: NGINX and NGINX Plus Ingress Controllers for Kubernetes](https://github.com/nginxinc/kubernetes-ingress)\n\n## Ingress \u3092\u6709\u52b9\u306b\u3059\u308b\n\nIngress \u3092\u6709\u52b9\u306b\u3059\u308b\u524d\u306b\u3001\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u4e8b\u524d\u306b\u4f5c\u6210\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n```\n$ minikube start\n```\n\n\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u305f\u3089\u3001`minikube addons` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u3001Ingress \u3092\u6709\u52b9\u306b\u3059\u308b\u3002\n\n```\n$ minikube addons enable ingress\n```\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068 nginx-ingress-controller \u3068 default-http-backend \u304c kube-system \u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n```\n$ kubectl get po -n kube-system\nNAME                             READY     STATUS    RESTARTS   AGE\ndefault-http-backend-2dmmw       1/1       Running   0          12m\nkube-addon-manager-minikube      1/1       Running   0          13m\nkube-dns-v20-1rr8n               3/3       Running   0          13m\nnginx-ingress-controller-85dql   1/1       Running   0          12m\n```\n\n*Ingress \u30a2\u30c9\u30aa\u30f3\u306f [v0.14.0 \u3067\u63d0\u4f9b\u3055\u308c\u305f](https://github.com/kubernetes/minikube/blob/master/CHANGELOG.md#version-0140---12142016)\u3002\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u3068\u304d\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u3002*\n\n## Ingress \u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\n\n\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3001\u3053\u3053\u3067\u306f nginx \u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066 Ingress LB \u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002`nginx.minikube.dev` \u3068\u3044\u3046\u30db\u30b9\u30c8\u540d\u3067\u5168\u3066\u306e\u30d1\u30b9\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092 `nginx` \u30b5\u30fc\u30d3\u30b9\u306e80\u756a\u30dd\u30fc\u30c8\u306b\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b\u3088\u3046\u306b\u5b9a\u7fa9\u3059\u308b\u3002\n\n```\n$ kubectl run nginx --image=nginx\n$ kubectl expose deploy nginx --port=80 --target-port=80\n$ cat <<EOL | kubectl create -f -\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: nginx\nspec:\n  rules:\n  - host: nginx.minikube.dev\n    http:\n      paths:\n      - backend:\n          serviceName: nginx\n          servicePort: 80\nEOL\n```\n\n\nMinikube \u3067\u4f5c\u6210\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u306f\u3072\u3068\u3064\u306e\u30de\u30b9\u30bf\u517c\u30ce\u30fc\u30c9\u306e\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3066\u304a\u308a\u3001\u5f53\u7136 Ingress \u306e\u4f7f\u3046 L7 LB (nginx) \u3082\u305d\u306e\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3002\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f\u3001`minikube ip` \u30b3\u30de\u30f3\u30c9\u3067\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u3053\u306e IP \u30a2\u30c9\u30ec\u30b9\u306b Host \u30d8\u30c3\u30c0 `nginx.minikube.dev` \u3092\u4ed8\u4e0e\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n```\n$ curl -I http://`minikube ip` -H 'Host: nginx.minikube.dev'\nHTTP/1.1 200 OK\nServer: nginx/1.11.3\nDate: Fri, 17 Feb 2017 07:59:13 GMT\nContent-Type: text/html\nContent-Length: 612\nConnection: keep-alive\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nETag: \"58a323e4-264\"\nAccept-Ranges: bytes\n```\n\nnginx-ingress-controller \u306e L7 LB \u306f\u30db\u30b9\u30c8\u30dd\u30fc\u30c8\u306e 80, 443 \u3092\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u306e\u65b9\u6cd5\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3002\u6c17\u306b\u306a\u308b\u4eba\u306f\u3001`kubectl describe nginx-ingress-controller -n kube-system` \u3067\u5b9a\u7fa9\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3088\u3044\u3002\n\n\u3053\u3053\u307e\u3067\u3067\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u51fa\u6765\u3066\u3044\u308b\u304c\u3001curl \u3067\u306f\u306a\u304f\u4f8b\u3048\u3070\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3044\u3068\u304d\u306a\u3069 Host \u30d8\u30c3\u30c0\u3092\u4ed8\u4e0e\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u306f\u9762\u5012\u3067\u3042\u308b\u3002\u6b21\u306b\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3059\u308b\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u3092\u4f7f\u3044 Ingress \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5b9a\u7fa9\u3057\u305f\u30db\u30b9\u30c8\u540d\u3067\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n## Ingress \u306e\u30db\u30b9\u30c8\u540d\u3092\u540d\u524d\u89e3\u6c7a\u3059\u308b\n\n\u540d\u524d\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b\u306f\u30cd\u30fc\u30e0\u30b5\u30fc\u30d0\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u3053\u3053\u3067\u306f\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f dnsmasq \u3092\u305d\u308c\u306b\u5229\u7528\u3059\u308b\u3002\n\n**Ubuntu 16.04 LTS / 14.04 LTS**\n\n```\n$ sudo bash -c \"echo address=/minikube.dev/`minikube ip` > /etc/NetworkManager/dnsmasq.d/minikube.conf\"\n# for 16.04 LTS\n$ sudo systemctl restart NetworkManager\n# for 14.04 LTS\n$ sudo restart network-manager\n```\n\n**macOS**\n\n```\n$ brew install dnsmasq\n$ echo address=/minikube.dev/`minikube ip` > /usr/local/etc/dnsmasq.conf\n$ sudo brew services start dnsmasq\n$ sudo mkdir -p /etc/resolver/\n$ sudo bash -c \"echo 'nameserver 127.0.0.1' > /etc/resolver/minikube.dev\"\n```\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067\u3001`minikube.dev.` \u306e\u540d\u524d\u89e3\u6c7a\u306e\u7d50\u679c\u306b `minikube ip` \u3067\u51fa\u529b\u3055\u308c\u308b\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u304c\u8fd4\u5374\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u3001Ingress \u3067\u5b9a\u7fa9\u3057\u305f\u30db\u30b9\u30c8\u540d\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```\n$ nslookup nginx.minikube.dev\nServer:         127.0.1.1\nAddress:        127.0.1.1#53\n\nName:   nginx.minikube.dev\nAddress: 192.168.99.100\n$ curl -I http://nginx.minikube.dev/\nHTTP/1.1 200 OK\nServer: nginx/1.11.3\nDate: Fri, 17 Feb 2017 08:20:45 GMT\nContent-Type: text/html\nContent-Length: 612\nConnection: keep-alive\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nETag: \"58a323e4-264\"\nAccept-Ranges: bytes\n\n```\n\n\u3082\u3061\u308d\u3093\u3053\u306e\u8a2d\u5b9a\u306b\u3088\u3063\u3066\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3082\u6b63\u3057\u304f\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n![It works!](https://qiita-image-store.s3.amazonaws.com/0/3780/cb981771-cba2-48e9-015f-fc42ef2e3c43.png)\n\n`dnsmasq.conf` \u306b\u8a2d\u5b9a\u3057\u305f\u30de\u30b7\u30f3\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f\u3001\u30af\u30e9\u30b9\u30bf\u3092\u518d\u4f5c\u6210\u3059\u308b\u3068\u5909\u308f\u308b\u3053\u3068\u304c\u3042\u308b\u3002\u305d\u306e\u3068\u304d\u306f\u518d\u5ea6\u4e0a\u66f8\u304d\u3057\u3001dnsmasq \u3092\u518d\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n## [PR] HTTP/2 \u3067\u30d5\u30a9\u30ef\u30fc\u30c9\u3067\u304d\u308b nghttpx-ingress-controller \u3092\u4f7f\u3046\n\nnghttpx-ingress-controller \u306f\u3001nghttpx \u3092 L7 LB \u3068\u3057\u3066\u5229\u7528\u3059\u308b Ingress Controller \u3067\u3042\u308b\u3002nghttpx \u306f\u3001\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u3082\u306b HTTP/2 \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001gRPC \u306e\u3088\u3046\u306a HTTP/2 \u3092\u4f7f\u3063\u305f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u307e\u3067 HTTP/2 \u3067\u901a\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306a\u3069\u306e\u7279\u5fb4\u304c\u3042\u308b\u3002\u307e\u305f\u3053\u306e Ingress Controller \u81ea\u4f53\u3082 nghttpx \u306e\u958b\u767a\u8005\u81ea\u8eab\u304c\u958b\u767a\u3057\u3066\u304a\u308a\u3001nghttpx \u306e\u6a5f\u80fd\u3092\u4f59\u3059\u3068\u3053\u308d\u306a\u304f\u5229\u7528\u3067\u304d\u308b\u62e1\u5f35\u6027\u304c\u3042\u308b\u3002\n\n- [nghttpx \\- HTTP/2 \u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u30fc / L7 \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u30fc \\- Qiita](http://qiita.com/tatsuhiro-t/items/99a2fd61d0fb16d7241b)\n- [zlabjp/nghttpx\\-ingress\\-lb: nghttpx ingress controller for Kubernetes](https://github.com/zlabjp/nghttpx-ingress-lb)\n- [nghttpx Ingress controller // Speaker Deck](https://speakerdeck.com/tatsuhirot/nghttpx-ingress-controller)\n\nnginx-ingress-controller \u306e\u4ee3\u308f\u308a\u306b nghttpx-ingress-controller \u3067\u3082\u3082\u3061\u308d\u3093\u554f\u984c\u306a\u304f\u52d5\u4f5c\u3059\u308b\u3002nginx-ingress-controller \u3092\u7121\u52b9\u306b\u3057\u3066\u3001nghttpx-ingress-controller \u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3060\u3051\u3067\u3042\u308b\u3002\u305f\u3060\u3053\u308c\u3060\u3068\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u305f\u3073\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u76f4\u3059\u5fc5\u8981\u304c\u3042\u308a\u9762\u5012\u3067\u3042\u308b\u3002\n\nMinikube \u3067\u306f `~/.minikube/addons` \u306b\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u304f\u3053\u3068\u3067\u81ea\u52d5\u7684\u306b\u30af\u30e9\u30b9\u30bf\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3002\u3053\u308c\u306f Minikube \u7d44\u307f\u8fbc\u307f\u306e\u30a2\u30c9\u30aa\u30f3\u3082\u540c\u69d8\u3060\u304c\u3001[addon-manager](https://github.com/kubernetes/kubernetes/tree/master/cluster/addons/addon-manager) \u3067\u5b9f\u73fe\u3055\u308c\u3066\u304a\u308a\u3001\u5358\u306b\u30de\u30b7\u30f3\u5185\u306e `/etc/kubernetes/addons` \u306b\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u30b3\u30d4\u30fc\u3055\u308c\u3066\u3044\u308b\u3060\u3051\u3067\u3042\u308b\u3002\naddon-manager \u306e\u4ed5\u69d8\u3068\u3057\u3066\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092 Cluster Add-on \u3068\u3057\u3066\u767b\u9332\u3059\u308b\u306b\u306f\u3001\u767b\u9332\u3059\u308b\u5168\u3066\u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u306e\u30e9\u30d9\u30eb\u306b `kubernetes.io/cluster-service: true` \u3068\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u6307\u5b9a\u6e08\u306e nghttpx-ingress-controller \u306e\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u3092 gist \u306b\u7f6e\u3044\u3066\u304a\u3044\u305f\u306e\u3067\u30af\u30ed\u30fc\u30f3\u3057\u3066\u4f7f\u3046\u3002\n\n```\n$ minikube addons disable ingress\n```\n\n\u3053\u308c\u307e\u3067\u306e\u7d9a\u304d\u3067\u4f5c\u696d\u3057\u3066\u3044\u308b\u306a\u3089\u3001\u6700\u521d\u306b nginx-ingress-controller \u3092\u7121\u52b9\u5316\u3059\u308b\u3002\u3072\u3068\u3064\u306e\u30af\u30e9\u30b9\u30bf\u306b\u3042\u308b\u8907\u6570\u306e ingress-controller \u3092\u4f7f\u3044\u5206\u3051\u308b\u6a5f\u80fd\u3082\u5b58\u5728\u306f\u3059\u308b\u304c\u3001\u6df7\u4e71\u306e\u5143\u306a\u306e\u3067\u5fc5\u8981\u306a\u3051\u308c\u3070\u524a\u9664\u3057\u3066\u304a\u3044\u305f\u307b\u3046\u304c\u3088\u3044\u3002\n\n```\n$ git clone https://gist.github.com/1b8b1e6e0dd13acf62be93c6cd329d92.git ~/.minikube/addons/nghttpx-ingress-controller\n$ minikube stop && minikube start\n```\n\n\u30af\u30e9\u30b9\u30bf\u306e\u8d77\u52d5\u6642\u306b `~/.minikube/addons` \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u30de\u30b7\u30f3\u5185\u306e `/etc/kubernetes/addons` \u306b\u30b3\u30d4\u30fc\u3055\u308c\u3001addon-manager \u306b\u3088\u308a\u81ea\u52d5\u7684\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3002\u3053\u308c\u3067\u6b21\u56de\u304b\u3089\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u81ea\u52d5\u7684\u306b nghttpx-ingress-controller \u304c\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001nghttpx \u306e\u30d8\u30c3\u30c0\u304c\u51fa\u529b\u3055\u308c\u3066\u304a\u308a\u3001\u6b63\u3057\u304f\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```\n$ curl -I http://nginx.minikube.dev\nHTTP/1.1 200 OK\nDate: Fri, 17 Feb 2017 08:33:03 GMT\nContent-Type: text/html\nContent-Length: 612\nLast-Modified: Tue, 14 Feb 2017 15:36:04 GMT\nEtag: \"58a323e4-264\"\nAccept-Ranges: bytes\nServer: nghttpx nghttp2/1.19.0\nVia: 1.1 nghttpx\n\n```\n", "tags": ["kubernetes", "minikube"]}