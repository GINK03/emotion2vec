{"context": " More than 1 year has passed since last update.IPv6\u74b0\u5883\u3067Docker\u3092\u4f7f\u3046\u3068\u304d\u306e\u4f7f\u3044\u65b9\u3068\u5b9f\u88c5\u306e\uff08\u4e00\u90e8\u306e\uff09\u8aac\u660e\u3067\u3059\u3002\n\u74b0\u5883\u306fCentOS7\u4ed8\u5c5e\u306e1.8\u3001IPv4\u3067\u306e\u8a2d\u5b9a\u3001\u64cd\u4f5c\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u73fe\u884c\u30d0\u30fc\u30b8\u30e7\u30f3(1.10)\u3067\u306f\u3044\u304f\u3064\u304b\u5b9f\u88c5\u304c\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u5f8c\u8ff0\u3057\u307e\u3059\u3002\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\nhttps://docs.docker.com/engine/userguide/networking/default_network/ipv6/\n\u65e5\u672c\u8a9e\u306f\u3053\u3061\u3089\nhttp://docs.docker.jp/engine/userguide/networking/default_network/ipv6.html\n\n\u8a2d\u8a08\n\n\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8a18\u8ff0\u3067\u306f/80\u4ee5\u4e0a\u306e\u7a7a\u9593\u3092\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306fLink local address\u540c\u69d8\u306e\u4ed5\u7d44\u307f\u3067MAC\u30a2\u30c9\u30ec\u30b9\u304b\u3089IPv6\u30a2\u30c9\u30ec\u30b9\u3092\u751f\u6210\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002\n\u203b128(IPv6 len) - 48(MAC len) = 80\n\n\u30b3\u30f3\u30c6\u30ca\n# ip addr show\n\u30fb\u30fb\u30fb\n4: eth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:01 brd ff:ff:ff:ff:ff:ff\n    inet6 2001:db8:ffff::242:ac11:1/64 scope global \n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:1/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\nMAC\u30a2\u30c9\u30ec\u30b9\u3068IPv6\uff082001:db8:ffff::/64\uff09\u306e\u4e0b\u4f4d\u304c\u4e00\u81f4\u3057\u3066\u3044\u307e\u3059\u3002\nlink local\u306e\u30a2\u30c9\u30ec\u30b9\u30d0\u30c3\u30c6\u30a3\u30f3\u30b0\u3092\u907f\u3051\u308b\u305f\u3081\u306b/80\u4ee5\u4e0a\u306b\u3059\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u3088\u307b\u3069\u5e83\u5927\u306aL2\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u4f5c\u3089\u306a\u3044\u9650\u308a\u3053\u308c\u3088\u308a\u5c0f\u3055\u3044\u30bb\u30b0\u30e1\u30f3\u30c8\u3067\u3082\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u969b\u3088\u308a/124\u306a\u3069\u306e\u5c0f\u3055\u3044\u30bb\u30b0\u30e1\u30f3\u30c8\u3067\u3082\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\u307e\u305fMAC\u304b\u3089\u751f\u6210\u3055\u308c\u305flink local\u3068\u306f\u5225\u306bfe80::1/64\u304cdocker0\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\n3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:1d:5d:12:0b brd ff:ff:ff:ff:ff:ff\n    inet 172.17.42.1/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:1dff:fe5d:120b/64 scope link \n       valid_lft forever preferred_lft forever\n    inet6 fe80::1/64 scope link \n\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\n\nrouted\uff08IPv6 native\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\uff09\nNDP Proxy\uff08IPv4\u306eproxy arp\uff09\n\n\u306e\u4e8c\u3064\u3067\u3059\u3002\nIPv6\u306f\u5168\u3066\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3082\u304a\u3064\u308a\u304c\u304f\u308b\u304f\u3089\u3044\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u3092\u6301\u3064\u3053\u3068\u304b\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u306f\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u901a\u4fe1\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3082\u8a2d\u5b9a\u81ea\u4f53\u306f\u51fa\u6765\u307e\u3059\u304cIPv4\u3068\u306f\u6319\u52d5\u304c\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u5f8c\u8ff0\u3057\u307e\u3059\u3002\ndocker engine\u8d77\u52d5\u6642\u306e\u30db\u30b9\u30c8\u5074\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\n# ip -6 route show\n2001:db8:1::/64 dev eno16780032  proto kernel  metric 256 \n2001:db8:ffff::/64 dev docker0  metric 1024 \nfe80::/64 dev eno16780032  proto kernel  metric 256 \nfe80::/64 dev docker0  proto kernel  metric 256 \n\n\n\u30b3\u30f3\u30c6\u30ca\u5074\u306fdefault-gateway-v6\u82e5\u3057\u304f\u306f\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306ffe80::1\u306b\u5411\u3051\u3089\u308c\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\n# ip -6 route show\n2001:db8:ffff::/64 dev eth0  proto kernel  metric 256 \nfe80::/64 dev eth0  proto kernel  metric 256 \ndefault via 2001:db8:ffff::1 dev eth0  metric 1024 \n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3001\u8a2d\u5b9a\u5185\u5bb9\u306a\u3069\n\n\u30db\u30b9\u30c8\n\u30a2\u30c9\u30ec\u30b9\u30a2\u30b5\u30a4\u30f3\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u8a2d\u5b9a\u306a\u3069\u3001IPv6\u306e\u4e00\u822c\u7684\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u304cOS\u3068\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u30a2\u30c9\u30ec\u30b9\u304f\u3089\u3044\u3067\u3059\u3002\ndocker engine\u304c\u3044\u308d\u3044\u308d\u3068\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u305f\u308a\u3057\u307e\u3059\u3002\n\nDocker engine\n\u30b3\u30f3\u30c6\u30ca\u306b\u6255\u3044\u3060\u3059IPv6\u30bb\u30b0\u30e1\u30f3\u30c8\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306a\u3069\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u95a2\u9023\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\n\n--ipv6\n\u3000IPv6\u306e\u6709\u52b9\u5316\u3002\u30db\u30b9\u30c8\u5074\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3082\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u203bsysctl net.ipv6.conf.all.forwarding=1 \u76f8\u5f53\n--fixed-cidr-v6\n\u3000\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30b5\u30a4\u30f3\u3059\u308bIPv6\u30a2\u30c9\u30ec\u30b9\u30d6\u30ed\u30c3\u30af\n--default-gateway-v6\n\u3000\u30b3\u30f3\u30c6\u30ca\u306b\u8a2d\u5b9a\u3059\u308bdefault gateway\n\n\n\u30b3\u30f3\u30c6\u30ca\nIPv6\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30b9\u30bf\u30c3\u30af\u81ea\u4f53\u306f\u30db\u30b9\u30c8\u5074\u306e\u5b9f\u88c5\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3059\u306e\u3067\u30a4\u30e1\u30fc\u30b8\u5074\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304cIPv6\u306b\u5bfe\u5fdc\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7cfb\u306e\u30b3\u30de\u30f3\u30c9\uff08ip, ifconfig, netstat\u306a\u3069\uff09\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u78ba\u8a8d\u304c\u697d\u3067\u3059\u3002\ndocker hub\u306e\u30a4\u30e1\u30fc\u30b8\u306a\u3089\u3070IPv6\u95a2\u9023\u30b3\u30de\u30f3\u30c9\u304c\u5165\u3063\u3066\u3044\u308bubuntu\u304c\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u8a2d\u5b9a\n\u5b9f\u969b\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u69cb\u6210\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u60f3\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n\nDocker engine\n\u30db\u30b9\u30c8\u5074\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n/etc/sysconfig/docker\nOPTIONS='--selinux-enabled --ipv6 --fixed-cidr-v6=\"2001:db8:ffff::/64\" --default-gateway-v6=\"2001:db8:ffff::1\"'\n\n\nCentOS7\u306f\u6a19\u6e96\u3067selinux-enabled\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u30db\u30b9\u30c8\n\nIF\u8a2d\u5b9a\n# ip -6 addr add 2001:db8:1::1/64 dev eth0\n\n\n\u691c\u8a3c\u6642\u306b\u306ffirewalld\u306f\u6b62\u3081\u3066\u304a\u3044\u305f\u65b9\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n# systemctl stop firewalld\n\n\n\u30eb\u30fc\u30bf\nIPv6\u30a2\u30c9\u30ec\u30b9\u306f2001:db8:1::2/64\u3068\u3057\u307e\u3059\u3002\n2001:db8:ffff::/64\u3078\u306e\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\u3092\u5fd8\u308c\u305a\u306b\u3002\n\n\u8d77\u52d5\n\u30db\u30b9\u30c8\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6295\u5165\n# systemctl start docker\n# ip -6 addr add 2001:db8:ffff::1/64 dev docker0\n# docker run -it ubuntu /bin/bash\n\n\u305d\u308c\u305e\u308c\n\ndocker engine\u306e\u7acb\u3061\u4e0a\u3052\ndocker0\u306bIPv6\u30a2\u30c9\u30ec\u30b9\u3092\u30a2\u30b5\u30a4\u30f3\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\n\n\u3067\u3059\u3002\ndocker engine\u8d77\u52d5\u6642\u306bdocker0\u306e\u4f5c\u6210\u53ca\u3073IPv4\u30a2\u30c9\u30ec\u30b9\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u304c\u3001IPv6\u30a2\u30c9\u30ec\u30b9\u306f\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u306a\u3044\u305f\u3081\u624b\u52d5\u3067\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u758e\u901a\u78ba\u8a8d\u306f\u7acb\u3061\u4e0a\u3052\u305f\u30b3\u30f3\u30c6\u30ca\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306b\u5bfe\u3057\u3066\u3001\u5bfe\u5411\u304b\u3089ping6\u306a\u3069\u306eIPv6\u7528\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\n# ip addr show\n\u30fb\u30fb\u30fb\n4: eth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:01 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 2001:db8:ffff::242:ac11:1/64 scope global \n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:1/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\n\u30eb\u30fc\u30bf\n> ping6 2001:db8:ffff::1\n\n\n\u758e\u901a\u3067\u304d\u306a\u3044\u3068\u304d\u306ffirewalld(iptables)\u3001selinux\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30bb\u30b0\u30e1\u30f3\u30c8\u9577\u3001docker0\u3078\u306e\u30a2\u30c9\u30ec\u30b9\u4ed8\u4e0e\u5fd8\u308c\u3042\u305f\u308a\u3092\u78ba\u8a8d\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u8a18\u8ff0\u304c\u3042\u308a\u307e\u305b\u3093\u304cIPv6\u3067\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3082\u53ef\u80fd\u3067\u3059\u3002IPv6\u306e\u5834\u5408\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u21d4\u30b3\u30f3\u30c6\u30ca\u304cIPv6\u21d4IPv4\u306etranslate\u306b\u306a\u308a\u307e\u3059\u3002\nL3\u3067\u5909\u63db\u3055\u308c\u308b\u305f\u3081Web\u30b5\u30fc\u30d0\u306a\u3069\u3067\u306fX-Forward\u306a\u3069\u306e\u30d8\u30c3\u30c0\u306f\u4e00\u5207\u4ed8\u52a0\u3055\u308c\u307e\u305b\u3093\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u304c\u5fc5\u8981\u306a\u3089\u3070\u30db\u30b9\u30c8\u5074\u3067nginx\u306a\u3069\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7\u3092\u7acb\u3066\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5909\u63db\u3059\u308b\u306e\u306f\u30db\u30b9\u30c8\u5074\u306edocker-proxy\u306b\u306a\u308a\u307e\u3059\u3002\nex. -p 8080:8080\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u305f\u5834\u5408\u306e\u30db\u30b9\u30c8\u5074\u306e\u30dd\u30fc\u30c8listen\u72b6\u6cc1\n# netstat -anp|grep 8080\ntcp6   0    0 :::8080        :::*      LISTEN     12671/docker-proxy    \n\n\u5916\u90e8\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u30db\u30b9\u30c8\u5074\u3067IPv6\u3068\u3057\u3066\u7d42\u7aef\u3057\u30b3\u30f3\u30c6\u30ca\u5074\u306bIPv4\u3068\u3057\u3066\u6e21\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u969b\u306e\u30bd\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u306f\u30db\u30b9\u30c8\u5074\u30d6\u30ea\u30c3\u30b8\uff08docker0)\u306e\u30a2\u30c9\u30ec\u30b9\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\nex. \u30b3\u30f3\u30c6\u30ca\u3067\u7acb\u3061\u4e0a\u3052\u305fapache\u306e\u30ed\u30b0\n192.168.0.2 - - [28/Jan/2016:00:20:53 +0000] \"GET / HTTP/1.1\" 200 12 \"-\" \"curl/7.29.0\"\n172.17.42.1 - - [28/Jan/2016:00:21:32 +0000] \"GET / HTTP/1.1\" 200 12 \"-\" \"curl/7.29.0\"\n\n\u4e0a\u304cIPv4\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(192.168.0.2)\u3001\u4e0b\u304cIPv6\u3067\u306e\u30ed\u30b0\u306b\u306a\u308a\u307e\u3059\u3002\nIPv6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068docker0(172.17.42.1)\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u59cb\u70b9\u3068\u3057\u305fIPv4\u30a2\u30c9\u30ec\u30b9\u306btranslate\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u307e\u305fIPv4\u306e\u5834\u5408\u306f\u30db\u30b9\u30c8\u5074\u306eiptables\u3067\u30b3\u30f3\u30c6\u30ca\u3078\u306enat\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u304c\u3001IPv6\u306e\u5834\u5408\u306fdocker-proxy\u30d7\u30ed\u30bb\u30b9\u304cIPv6\u3067\u53d7\u3051\u30b3\u30f3\u30c6\u30ca\u5074IPv4\u3078\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002ip6tables\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002\n# iptables -L -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere            !loopback/8           ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nMASQUERADE  all  --  172.17.0.0/16        anywhere            \nMASQUERADE  tcp  --  172.17.0.2           172.17.0.2           tcp dpt:webcache\n\nChain DOCKER (2 references)\ntarget     prot opt source               destination         \nDNAT       tcp  --  anywhere             anywhere             tcp dpt:webcache to:172.17.0.2:8080\n\n# ip6tables -L -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n\n\ndocker network\ndocker 1.9\u4ee5\u964d\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u307e\u308f\u308a\u306e\u6a5f\u80fd\u304c\u5927\u5e45\u306b\u62e1\u5f35\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057IPv6\u306e\u5bfe\u5fdc\u72b6\u6cc1\u306f\u3053\u308c\u304b\u3089\u3068\u3044\u3046\u72b6\u6cc1\u306a\u306e\u3067\u3001\u73fe\u6642\u70b9(2016/2, docker1.10\uff09\u3067\u306f\n\nIPv4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fdocker network\u3067\u4e00\u5143\u7ba1\u7406\nIPv6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u81ea\u524d\u7ba1\u7406\u3001docker\u3067\u7ba1\u7406\u3059\u308b\u306e\u306f\u30b3\u30f3\u30c6\u30ca\u3060\u3051\n\n\u3068\u3044\u3046\u306e\u304c\u73fe\u5b9f\u7684\u306a\u89e3\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305fdocker engine\u3082\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u307e\u308f\u308a\u3067\u624b\u304c\u5165\u3063\u305f\u305f\u3081\u304b\u30d1\u30e9\u30e1\u30fc\u30bf\u8a2d\u5b9a\u6b21\u7b2c\u3067\u52d5\u3044\u305f\u308a\u52d5\u304b\u306a\u304b\u3063\u305f\u308a\u3068\u6319\u52d5\u304c1.8\u4ee5\u524d\u3068\u7570\u306a\u308b\u70b9\u304c\u3042\u308a\u3001\u30db\u30b9\u30c8\u5074\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u79fb\u884c\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n1.8\u4ee5\u524d\u30681.9\u4ee5\u964d\u3068\u306e\u5dee\u5206\u3067\u78ba\u8a8d\u3057\u3066\u3044\u308b\u7bc4\u56f2\u3067\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u3042\u308a\u307e\u3059\n\ndefault-gateway-v6\u3092\u6307\u5b9a\u3059\u308b\u3068docker engine\u304c\u8d77\u52d5\u3057\u306a\u3044\nfixed-cidr-v6\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001docker0\u306b\u82e5\u756a\u3092\u30a2\u30b5\u30a4\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\u5074\u306edefault gateway\u3082\u6307\u5b9a\u3055\u308c\u307e\u3059\u3002\nex. --fixed-cidr-v6=2001:db8:cccc::/80\n\n\u30db\u30b9\u30c8\u5074docker0\n# ip addr show\n11: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN \n    link/ether 02:42:5a:b2:44:1d brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.16/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 2001:db8:cccc::1/80 scope global \n\n\n\n\u30b3\u30f3\u30c6\u30ca\u5074\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\n# ip -6 route show\n2001:db8:cccc::/80 dev eth0  proto kernel  metric 256 \nfe80::/64 dev eth0  proto kernel  metric 256 \ndefault via 2001:db8:cccc::1 dev eth0  metric 1024 \n\n\n\u3053\u3053\u3067\u30aa\u30d7\u30b7\u30e7\u30f3\u306b--default-gateway-v6\u306b2001:db8:cccc::1\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3059\u3067\u306b\u30a2\u30c9\u30ec\u30b9\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u3066\u3044\u308b\u3068\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u529b\u3055\u308cdocker engine\u304c\u8d77\u52d5\u3057\u307e\u305b\u3093\u3002\ndocker0\u3078\u306e\u30a2\u30c9\u30ec\u30b9\u30a2\u30b5\u30a4\u30f3\u304c\u5f37\u5236\u7684\u306b\u884c\u308f\u308c\u308b\u305f\u3081\u56de\u907f\u7b56\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u6319\u3052\u3089\u308c\u307e\u3059\n\ndefault-gateway-v6\u3092\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070fe80::1\uff08docker0\uff09\u304c\u5229\u7528\u3055\u308c\u308b\u306e\u3067\u3053\u3061\u3089\u3092\u4f7f\u3046\u3002\nalias\u3068\u3057\u30662001:db8:ffff::2\u306a\u3069\u306e\u5225\u306eIPv6\u3092\u4ed8\u4e0e\u3057\u3053\u3061\u3089\u3092gateway\u306b\u6307\u5b9a\u3059\u308b(xxx::1\u3067\u306a\u3051\u308c\u3070\u8d77\u52d5\u53ef\u80fd\uff09\ndocker\u5074\u3067\u306f\u306a\u304f\u30db\u30b9\u30c8\u5074\u306eDHCPv6\u3084RA\u306a\u3069\u304b\u3089IPv6\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u5225\u9014\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u884c\u308f\u308c\u308b\u306e\u3067\u30011\u756a\u76ee\u306e\u300c\u6307\u5b9a\u3057\u306a\u3044\u300d\u3068\u3044\u3046\u306e\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u305d\u306e\u4ed6\n\n\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u304d\n\u30a2\u30c9\u30ec\u30b9\u3084\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\u306fdocker engine\u304c\u3046\u307e\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u304c\u524a\u9664\u306b\u95a2\u3057\u3066\u306f\u539f\u5247\u884c\u308f\u308c\u306a\u3044\u305f\u3081\u3001\u691c\u8a3c\u306a\u3069\u3067\u30a2\u30c9\u30ec\u30b9\u3084\u30bb\u30b0\u30e1\u30f3\u30c8\u9577\u306a\u3069\u3092\u5909\u66f4\u3059\u308b\u5834\u5408\u3001\u30db\u30b9\u30c8\u5074\u306e\u30d6\u30ea\u30c3\u30b8\u3084\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u304c\u6c5a\u308c\u3066\u304f\u308b\u306e\u3067\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u3068\u304d\u306f\u30db\u30b9\u30c8\u306e\u518d\u8d77\u52d5\u3067\u3042\u3063\u3055\u308a\u3046\u307e\u304f\u3044\u304f\u3053\u3068\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\n\n\u8a2d\u5b9a\u30b3\u30de\u30f3\u30c9\n\u539f\u5247docker\u30b3\u30de\u30f3\u30c9\u306e\u307f\u3067\u6e08\u307e\u305b\u308b\u3088\u3046\u306b\u8a2d\u8a08\u3059\u3079\u304d\u3067\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u9650\u3089\u305a\u5404\u30ea\u30bd\u30fc\u30b9(name space)\u3092docker\u304c\u72ec\u81ea\u306b\u7ba1\u7406\u3057\u3066\u3044\u308b\u3082\u306e\u304c\u307b\u3068\u3093\u3069\u306a\u306e\u3067\u3001docker\u7ba1\u7406\u5916\u306e\u30b3\u30de\u30f3\u30c9\u3067\u64cd\u4f5c\u3057\u305f\u5834\u5408\u3001\u4e0d\u6574\u5408\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\n\u6b8b\u5ff5\u306a\u304c\u3089IPv6\u306b\u95a2\u3057\u3066\u306f\u672a\u5b9f\u88c5\u306e\u3082\u306e\u304c\u591a\u304f\u5916\u90e8\u30b3\u30de\u30f3\u30c9\u306e\u529b\u3092\u501f\u308a\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u304c\u3001docker\u304c\u8a2d\u5b9a\u3057\u3066\u3057\u307e\u3046\u30e2\u30ce\u30fb\u81ea\u524d\u3067\u8a2d\u5b9a\u3059\u308b\u30e2\u30ce\u3092\u628a\u63e1\u3057\u305f\u3046\u3048\u3067\u5404\u64cd\u4f5c\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\nIPv6\u74b0\u5883\u3067Docker\u3092\u4f7f\u3046\u3068\u304d\u306e\u4f7f\u3044\u65b9\u3068\u5b9f\u88c5\u306e\uff08\u4e00\u90e8\u306e\uff09\u8aac\u660e\u3067\u3059\u3002\n\u74b0\u5883\u306fCentOS7\u4ed8\u5c5e\u306e1.8\u3001IPv4\u3067\u306e\u8a2d\u5b9a\u3001\u64cd\u4f5c\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u73fe\u884c\u30d0\u30fc\u30b8\u30e7\u30f3(1.10)\u3067\u306f\u3044\u304f\u3064\u304b\u5b9f\u88c5\u304c\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u5f8c\u8ff0\u3057\u307e\u3059\u3002\n\n\n\n# \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\nhttps://docs.docker.com/engine/userguide/networking/default_network/ipv6/\n\n\u65e5\u672c\u8a9e\u306f\u3053\u3061\u3089\nhttp://docs.docker.jp/engine/userguide/networking/default_network/ipv6.html\n\n\n\n\n\n# \u8a2d\u8a08\n## \u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8a18\u8ff0\u3067\u306f/80\u4ee5\u4e0a\u306e\u7a7a\u9593\u3092\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306fLink local address\u540c\u69d8\u306e\u4ed5\u7d44\u307f\u3067MAC\u30a2\u30c9\u30ec\u30b9\u304b\u3089IPv6\u30a2\u30c9\u30ec\u30b9\u3092\u751f\u6210\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002\n\u203b128(IPv6 len) - 48(MAC len) = 80\n\n```text:\u30b3\u30f3\u30c6\u30ca\n# ip addr show\n\u30fb\u30fb\u30fb\n4: eth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:01 brd ff:ff:ff:ff:ff:ff\n    inet6 2001:db8:ffff::242:ac11:1/64 scope global \n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:1/64 scope link \n       valid_lft forever preferred_lft forever\n\n```\nMAC\u30a2\u30c9\u30ec\u30b9\u3068IPv6\uff082001:db8:ffff::/64\uff09\u306e\u4e0b\u4f4d\u304c\u4e00\u81f4\u3057\u3066\u3044\u307e\u3059\u3002\n\nlink local\u306e\u30a2\u30c9\u30ec\u30b9\u30d0\u30c3\u30c6\u30a3\u30f3\u30b0\u3092\u907f\u3051\u308b\u305f\u3081\u306b/80\u4ee5\u4e0a\u306b\u3059\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u3088\u307b\u3069\u5e83\u5927\u306aL2\u30bb\u30b0\u30e1\u30f3\u30c8\u3092\u4f5c\u3089\u306a\u3044\u9650\u308a\u3053\u308c\u3088\u308a\u5c0f\u3055\u3044\u30bb\u30b0\u30e1\u30f3\u30c8\u3067\u3082\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u969b\u3088\u308a/124\u306a\u3069\u306e\u5c0f\u3055\u3044\u30bb\u30b0\u30e1\u30f3\u30c8\u3067\u3082\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\n\u307e\u305fMAC\u304b\u3089\u751f\u6210\u3055\u308c\u305flink local\u3068\u306f\u5225\u306bfe80::1/64\u304cdocker0\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u3002\n\n```text:\u30db\u30b9\u30c8\n3: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:1d:5d:12:0b brd ff:ff:ff:ff:ff:ff\n    inet 172.17.42.1/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:1dff:fe5d:120b/64 scope link \n       valid_lft forever preferred_lft forever\n    inet6 fe80::1/64 scope link \n```\n\n\n\n## \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\n\n* routed\uff08IPv6 native\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\uff09\n* NDP Proxy\uff08IPv4\u306eproxy arp\uff09\n\n\u306e\u4e8c\u3064\u3067\u3059\u3002\nIPv6\u306f\u5168\u3066\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3082\u304a\u3064\u308a\u304c\u304f\u308b\u304f\u3089\u3044\u306e\u30a2\u30c9\u30ec\u30b9\u7a7a\u9593\u3092\u6301\u3064\u3053\u3068\u304b\u3089\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u306f\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u901a\u4fe1\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3082\u8a2d\u5b9a\u81ea\u4f53\u306f\u51fa\u6765\u307e\u3059\u304cIPv4\u3068\u306f\u6319\u52d5\u304c\u7570\u306a\u308a\u307e\u3059\u306e\u3067\u5f8c\u8ff0\u3057\u307e\u3059\u3002\ndocker engine\u8d77\u52d5\u6642\u306e\u30db\u30b9\u30c8\u5074\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:\u30db\u30b9\u30c8\n# ip -6 route show\n2001:db8:1::/64 dev eno16780032  proto kernel  metric 256 \n2001:db8:ffff::/64 dev docker0  metric 1024 \nfe80::/64 dev eno16780032  proto kernel  metric 256 \nfe80::/64 dev docker0  proto kernel  metric 256 \n```\n\n\n\u30b3\u30f3\u30c6\u30ca\u5074\u306fdefault-gateway-v6\u82e5\u3057\u304f\u306f\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306ffe80::1\u306b\u5411\u3051\u3089\u308c\u307e\u3059\u3002\n\n```text:\u30b3\u30f3\u30c6\u30ca\n# ip -6 route show\n2001:db8:ffff::/64 dev eth0  proto kernel  metric 256 \nfe80::/64 dev eth0  proto kernel  metric 256 \ndefault via 2001:db8:ffff::1 dev eth0  metric 1024 \n```\n\n\n\n\n# \u30d1\u30e9\u30e1\u30fc\u30bf\u3001\u8a2d\u5b9a\u5185\u5bb9\u306a\u3069\n##\u30db\u30b9\u30c8\n\u30a2\u30c9\u30ec\u30b9\u30a2\u30b5\u30a4\u30f3\u3001\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u8a2d\u5b9a\u306a\u3069\u3001IPv6\u306e\u4e00\u822c\u7684\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u304cOS\u3068\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306f\u30a2\u30c9\u30ec\u30b9\u304f\u3089\u3044\u3067\u3059\u3002\ndocker engine\u304c\u3044\u308d\u3044\u308d\u3068\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u305f\u308a\u3057\u307e\u3059\u3002\n\n\n## Docker engine\n\u30b3\u30f3\u30c6\u30ca\u306b\u6255\u3044\u3060\u3059IPv6\u30bb\u30b0\u30e1\u30f3\u30c8\u3001\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306a\u3069\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u95a2\u9023\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\n\n* --ipv6\n\u3000IPv6\u306e\u6709\u52b9\u5316\u3002\u30db\u30b9\u30c8\u5074\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3082\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u203bsysctl net.ipv6.conf.all.forwarding=1 \u76f8\u5f53\n\n* --fixed-cidr-v6\n\u3000\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30b5\u30a4\u30f3\u3059\u308bIPv6\u30a2\u30c9\u30ec\u30b9\u30d6\u30ed\u30c3\u30af\n\n* --default-gateway-v6\n\u3000\u30b3\u30f3\u30c6\u30ca\u306b\u8a2d\u5b9a\u3059\u308bdefault gateway\n\n\n## \u30b3\u30f3\u30c6\u30ca\nIPv6\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30b9\u30bf\u30c3\u30af\u81ea\u4f53\u306f\u30db\u30b9\u30c8\u5074\u306e\u5b9f\u88c5\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3059\u306e\u3067\u30a4\u30e1\u30fc\u30b8\u5074\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304cIPv6\u306b\u5bfe\u5fdc\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7cfb\u306e\u30b3\u30de\u30f3\u30c9\uff08ip, ifconfig, netstat\u306a\u3069\uff09\u304c\u5165\u3063\u3066\u3044\u308b\u3068\u78ba\u8a8d\u304c\u697d\u3067\u3059\u3002\ndocker hub\u306e\u30a4\u30e1\u30fc\u30b8\u306a\u3089\u3070IPv6\u95a2\u9023\u30b3\u30de\u30f3\u30c9\u304c\u5165\u3063\u3066\u3044\u308bubuntu\u304c\u697d\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n\n\n# \u8a2d\u5b9a\n\u5b9f\u969b\u306b\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n##\u69cb\u6210\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u60f3\u5b9a\u3057\u3066\u307f\u307e\u3059\u3002\n\n![dock.png](https://qiita-image-store.s3.amazonaws.com/0/19360/8ce78f5b-7a96-5bc7-dd42-2c06eb7c2499.png)\n\n\n## Docker engine\n\u30db\u30b9\u30c8\u5074\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n```text:/etc/sysconfig/docker\nOPTIONS='--selinux-enabled --ipv6 --fixed-cidr-v6=\"2001:db8:ffff::/64\" --default-gateway-v6=\"2001:db8:ffff::1\"'\n```\n\nCentOS7\u306f\u6a19\u6e96\u3067selinux-enabled\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\n\n##\u30db\u30b9\u30c8\n\n```text:IF\u8a2d\u5b9a\n# ip -6 addr add 2001:db8:1::1/64 dev eth0\n```\n\n\n\n\u691c\u8a3c\u6642\u306b\u306ffirewalld\u306f\u6b62\u3081\u3066\u304a\u3044\u305f\u65b9\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\n# systemctl stop firewalld\n```\n\n\n\n\n##\u30eb\u30fc\u30bf\nIPv6\u30a2\u30c9\u30ec\u30b9\u306f2001:db8:1::2/64\u3068\u3057\u307e\u3059\u3002\n2001:db8:ffff::/64\u3078\u306e\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\u3092\u5fd8\u308c\u305a\u306b\u3002\n\n\n\n##\u8d77\u52d5\n\n\u30db\u30b9\u30c8\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6295\u5165\n\n```\n# systemctl start docker\n# ip -6 addr add 2001:db8:ffff::1/64 dev docker0\n# docker run -it ubuntu /bin/bash\n```\n\n\u305d\u308c\u305e\u308c\n\n* docker engine\u306e\u7acb\u3061\u4e0a\u3052\n* docker0\u306bIPv6\u30a2\u30c9\u30ec\u30b9\u3092\u30a2\u30b5\u30a4\u30f3\n* \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\n\n\u3067\u3059\u3002\ndocker engine\u8d77\u52d5\u6642\u306bdocker0\u306e\u4f5c\u6210\u53ca\u3073IPv4\u30a2\u30c9\u30ec\u30b9\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u307e\u3059\u304c\u3001IPv6\u30a2\u30c9\u30ec\u30b9\u306f\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u306a\u3044\u305f\u3081\u624b\u52d5\u3067\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u758e\u901a\u78ba\u8a8d\u306f\u7acb\u3061\u4e0a\u3052\u305f\u30b3\u30f3\u30c6\u30ca\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u306b\u5bfe\u3057\u3066\u3001\u5bfe\u5411\u304b\u3089ping6\u306a\u3069\u306eIPv6\u7528\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```text:\u30b3\u30f3\u30c6\u30ca\n# ip addr show\n\u30fb\u30fb\u30fb\n4: eth0@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default \n    link/ether 02:42:ac:11:00:01 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.1/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 2001:db8:ffff::242:ac11:1/64 scope global \n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:1/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n\n```text:\u30eb\u30fc\u30bf\n> ping6 2001:db8:ffff::1\n```\n\n\u758e\u901a\u3067\u304d\u306a\u3044\u3068\u304d\u306ffirewalld(iptables)\u3001selinux\u3001\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30bb\u30b0\u30e1\u30f3\u30c8\u9577\u3001docker0\u3078\u306e\u30a2\u30c9\u30ec\u30b9\u4ed8\u4e0e\u5fd8\u308c\u3042\u305f\u308a\u3092\u78ba\u8a8d\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n# \u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u8a18\u8ff0\u304c\u3042\u308a\u307e\u305b\u3093\u304cIPv6\u3067\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u3082\u53ef\u80fd\u3067\u3059\u3002IPv6\u306e\u5834\u5408\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u21d4\u30b3\u30f3\u30c6\u30ca\u304cIPv6\u21d4IPv4\u306etranslate\u306b\u306a\u308a\u307e\u3059\u3002\nL3\u3067\u5909\u63db\u3055\u308c\u308b\u305f\u3081Web\u30b5\u30fc\u30d0\u306a\u3069\u3067\u306fX-Forward\u306a\u3069\u306e\u30d8\u30c3\u30c0\u306f\u4e00\u5207\u4ed8\u52a0\u3055\u308c\u307e\u305b\u3093\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306eIPv6\u30a2\u30c9\u30ec\u30b9\u304c\u5fc5\u8981\u306a\u3089\u3070\u30db\u30b9\u30c8\u5074\u3067nginx\u306a\u3069\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30ad\u30b7\u3092\u7acb\u3066\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5909\u63db\u3059\u308b\u306e\u306f\u30db\u30b9\u30c8\u5074\u306edocker-proxy\u306b\u306a\u308a\u307e\u3059\u3002\nex. -p 8080:8080\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u305f\u5834\u5408\u306e\u30db\u30b9\u30c8\u5074\u306e\u30dd\u30fc\u30c8listen\u72b6\u6cc1\n\n```text\n# netstat -anp|grep 8080\ntcp6   0    0 :::8080        :::*      LISTEN     12671/docker-proxy    \n```\n\n\n\n\u5916\u90e8\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306f\u30db\u30b9\u30c8\u5074\u3067IPv6\u3068\u3057\u3066\u7d42\u7aef\u3057\u30b3\u30f3\u30c6\u30ca\u5074\u306bIPv4\u3068\u3057\u3066\u6e21\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u969b\u306e\u30bd\u30fc\u30b9\u30a2\u30c9\u30ec\u30b9\u306f\u30db\u30b9\u30c8\u5074\u30d6\u30ea\u30c3\u30b8\uff08docker0)\u306e\u30a2\u30c9\u30ec\u30b9\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\nex. \u30b3\u30f3\u30c6\u30ca\u3067\u7acb\u3061\u4e0a\u3052\u305fapache\u306e\u30ed\u30b0\n\n```\n192.168.0.2 - - [28/Jan/2016:00:20:53 +0000] \"GET / HTTP/1.1\" 200 12 \"-\" \"curl/7.29.0\"\n172.17.42.1 - - [28/Jan/2016:00:21:32 +0000] \"GET / HTTP/1.1\" 200 12 \"-\" \"curl/7.29.0\"\n```\n\n\u4e0a\u304cIPv4\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(192.168.0.2)\u3001\u4e0b\u304cIPv6\u3067\u306e\u30ed\u30b0\u306b\u306a\u308a\u307e\u3059\u3002\nIPv6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068docker0(172.17.42.1)\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u59cb\u70b9\u3068\u3057\u305fIPv4\u30a2\u30c9\u30ec\u30b9\u306btranslate\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n\n\u307e\u305fIPv4\u306e\u5834\u5408\u306f\u30db\u30b9\u30c8\u5074\u306eiptables\u3067\u30b3\u30f3\u30c6\u30ca\u3078\u306enat\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u304c\u3001IPv6\u306e\u5834\u5408\u306fdocker-proxy\u30d7\u30ed\u30bb\u30b9\u304cIPv6\u3067\u53d7\u3051\u30b3\u30f3\u30c6\u30ca\u5074IPv4\u3078\u8ee2\u9001\u3055\u308c\u307e\u3059\u3002ip6tables\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u308c\u307e\u305b\u3093\u3002\n\n```text\n# iptables -L -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER     all  --  anywhere            !loopback/8           ADDRTYPE match dst-type LOCAL\n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \nMASQUERADE  all  --  172.17.0.0/16        anywhere            \nMASQUERADE  tcp  --  172.17.0.2           172.17.0.2           tcp dpt:webcache\n\nChain DOCKER (2 references)\ntarget     prot opt source               destination         \nDNAT       tcp  --  anywhere             anywhere             tcp dpt:webcache to:172.17.0.2:8080\n```\n\n```text\n# ip6tables -L -t nat\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination       \n```\n\n\n\n\n\n\n# docker network\ndocker 1.9\u4ee5\u964d\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u307e\u308f\u308a\u306e\u6a5f\u80fd\u304c\u5927\u5e45\u306b\u62e1\u5f35\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057IPv6\u306e\u5bfe\u5fdc\u72b6\u6cc1\u306f\u3053\u308c\u304b\u3089\u3068\u3044\u3046\u72b6\u6cc1\u306a\u306e\u3067\u3001\u73fe\u6642\u70b9(2016/2, docker1.10\uff09\u3067\u306f\n\n* IPv4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fdocker network\u3067\u4e00\u5143\u7ba1\u7406\n* IPv6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u81ea\u524d\u7ba1\u7406\u3001docker\u3067\u7ba1\u7406\u3059\u308b\u306e\u306f\u30b3\u30f3\u30c6\u30ca\u3060\u3051\n\n\u3068\u3044\u3046\u306e\u304c\u73fe\u5b9f\u7684\u306a\u89e3\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305fdocker engine\u3082\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u307e\u308f\u308a\u3067\u624b\u304c\u5165\u3063\u305f\u305f\u3081\u304b\u30d1\u30e9\u30e1\u30fc\u30bf\u8a2d\u5b9a\u6b21\u7b2c\u3067\u52d5\u3044\u305f\u308a\u52d5\u304b\u306a\u304b\u3063\u305f\u308a\u3068\u6319\u52d5\u304c1.8\u4ee5\u524d\u3068\u7570\u306a\u308b\u70b9\u304c\u3042\u308a\u3001\u30db\u30b9\u30c8\u5074\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u79fb\u884c\u3067\u304d\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n1.8\u4ee5\u524d\u30681.9\u4ee5\u964d\u3068\u306e\u5dee\u5206\u3067\u78ba\u8a8d\u3057\u3066\u3044\u308b\u7bc4\u56f2\u3067\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u3042\u308a\u307e\u3059\n\n## default-gateway-v6\u3092\u6307\u5b9a\u3059\u308b\u3068docker engine\u304c\u8d77\u52d5\u3057\u306a\u3044\n\nfixed-cidr-v6\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3001docker0\u306b\u82e5\u756a\u3092\u30a2\u30b5\u30a4\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\u5074\u306edefault gateway\u3082\u6307\u5b9a\u3055\u308c\u307e\u3059\u3002\n\nex. --fixed-cidr-v6=2001:db8:cccc::/80\n\n```text:\u30db\u30b9\u30c8\u5074docker0\n# ip addr show\n11: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN \n    link/ether 02:42:5a:b2:44:1d brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.16/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 2001:db8:cccc::1/80 scope global \n```\n\n```text:\u30b3\u30f3\u30c6\u30ca\u5074\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\n# ip -6 route show\n2001:db8:cccc::/80 dev eth0  proto kernel  metric 256 \nfe80::/64 dev eth0  proto kernel  metric 256 \ndefault via 2001:db8:cccc::1 dev eth0  metric 1024 \n```\n\n\n\u3053\u3053\u3067\u30aa\u30d7\u30b7\u30e7\u30f3\u306b--default-gateway-v6\u306b2001:db8:cccc::1\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3059\u3067\u306b\u30a2\u30c9\u30ec\u30b9\u304c\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u3066\u3044\u308b\u3068\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u529b\u3055\u308cdocker engine\u304c\u8d77\u52d5\u3057\u307e\u305b\u3093\u3002\ndocker0\u3078\u306e\u30a2\u30c9\u30ec\u30b9\u30a2\u30b5\u30a4\u30f3\u304c\u5f37\u5236\u7684\u306b\u884c\u308f\u308c\u308b\u305f\u3081\u56de\u907f\u7b56\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3082\u306e\u304c\u6319\u3052\u3089\u308c\u307e\u3059\n\n* default-gateway-v6\u3092\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070fe80::1\uff08docker0\uff09\u304c\u5229\u7528\u3055\u308c\u308b\u306e\u3067\u3053\u3061\u3089\u3092\u4f7f\u3046\u3002\n* alias\u3068\u3057\u30662001:db8:ffff::2\u306a\u3069\u306e\u5225\u306eIPv6\u3092\u4ed8\u4e0e\u3057\u3053\u3061\u3089\u3092gateway\u306b\u6307\u5b9a\u3059\u308b(xxx::1\u3067\u306a\u3051\u308c\u3070\u8d77\u52d5\u53ef\u80fd\uff09\n* docker\u5074\u3067\u306f\u306a\u304f\u30db\u30b9\u30c8\u5074\u306eDHCPv6\u3084RA\u306a\u3069\u304b\u3089IPv6\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u5225\u9014\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u884c\u308f\u308c\u308b\u306e\u3067\u30011\u756a\u76ee\u306e\u300c\u6307\u5b9a\u3057\u306a\u3044\u300d\u3068\u3044\u3046\u306e\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n# \u305d\u306e\u4ed6\n## \u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u304d\n\u30a2\u30c9\u30ec\u30b9\u3084\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u8ffd\u52a0\u306fdocker engine\u304c\u3046\u307e\u304f\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u304c\u524a\u9664\u306b\u95a2\u3057\u3066\u306f\u539f\u5247\u884c\u308f\u308c\u306a\u3044\u305f\u3081\u3001\u691c\u8a3c\u306a\u3069\u3067\u30a2\u30c9\u30ec\u30b9\u3084\u30bb\u30b0\u30e1\u30f3\u30c8\u9577\u306a\u3069\u3092\u5909\u66f4\u3059\u308b\u5834\u5408\u3001\u30db\u30b9\u30c8\u5074\u306e\u30d6\u30ea\u30c3\u30b8\u3084\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u30c6\u30fc\u30d6\u30eb\u304c\u6c5a\u308c\u3066\u304f\u308b\u306e\u3067\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u3068\u304d\u306f\u30db\u30b9\u30c8\u306e\u518d\u8d77\u52d5\u3067\u3042\u3063\u3055\u308a\u3046\u307e\u304f\u3044\u304f\u3053\u3068\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\n\n\n## \u8a2d\u5b9a\u30b3\u30de\u30f3\u30c9\n\u539f\u5247docker\u30b3\u30de\u30f3\u30c9\u306e\u307f\u3067\u6e08\u307e\u305b\u308b\u3088\u3046\u306b\u8a2d\u8a08\u3059\u3079\u304d\u3067\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u9650\u3089\u305a\u5404\u30ea\u30bd\u30fc\u30b9(name space)\u3092docker\u304c\u72ec\u81ea\u306b\u7ba1\u7406\u3057\u3066\u3044\u308b\u3082\u306e\u304c\u307b\u3068\u3093\u3069\u306a\u306e\u3067\u3001docker\u7ba1\u7406\u5916\u306e\u30b3\u30de\u30f3\u30c9\u3067\u64cd\u4f5c\u3057\u305f\u5834\u5408\u3001\u4e0d\u6574\u5408\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u591a\u3005\u3042\u308a\u307e\u3059\u3002\n\n\u6b8b\u5ff5\u306a\u304c\u3089IPv6\u306b\u95a2\u3057\u3066\u306f\u672a\u5b9f\u88c5\u306e\u3082\u306e\u304c\u591a\u304f\u5916\u90e8\u30b3\u30de\u30f3\u30c9\u306e\u529b\u3092\u501f\u308a\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u304c\u3001docker\u304c\u8a2d\u5b9a\u3057\u3066\u3057\u307e\u3046\u30e2\u30ce\u30fb\u81ea\u524d\u3067\u8a2d\u5b9a\u3059\u308b\u30e2\u30ce\u3092\u628a\u63e1\u3057\u305f\u3046\u3048\u3067\u5404\u64cd\u4f5c\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n", "tags": ["docker", "IPv6"]}