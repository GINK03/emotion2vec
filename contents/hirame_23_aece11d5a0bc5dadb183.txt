{"context": " More than 1 year has passed since last update.\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3068\u5fc5\u8981\u306a\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3001Java\u30aa\u30d7\u30b7\u30e7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5099\u5fd8\u9332\u3068\u3057\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u74b0\u5883\n\nOS:Amazon Linux 2014.03\napache-tomcat:7.0.55\njava:jdk-7u67\n\n\n\u624b\u9806\n$ sudo yum group install \"Development Tools\"\n\n$ cd /usr/local/src/\n$ sudo wget sudo wget http://ftp.kddilabs.jp/infosystems/apache/tomcat/tomcat-7/v7.0.55/bin/apache-tomcat-7.0.55.tar.gz\n$ sudo wget --no-check-certificate --no-cookies - --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/7u67-b01/jdk-7u67-linux-x64.tar.gz\n$ sudo tar zxvf ./jdk-7u67-linux-x64.tar.gz -C /usr/local/\n$ cd /usr/local\n$ sudo ln -s ./jdk1.7.0_67 ./java\n$ /usr/local/java/bin/java -version\njava version \"1.7.0_67\"\nJava(TM) SE Runtime Environment (build 1.7.0_67-b01)\nJava HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)\n\n$ sudo groupadd -g 53 tomcat\n$ sudo useradd -u 53 -g 53 -s /sbin/nologin -d /var/lib/tomcat -m tomcat\n$ cd /usr/local/src\n$ tar zxvf ./apache-tomcat-7.0.55.tar.gz -C /usr/local/\n$ cd /usr/local/\n$ sudo ln -s ./apache-tomcat-7.0.55 ./tomcat\n$ sudo tar zxvf ./commons-daemon-native.tar.gz\n$ cd ./commons-daemon-1.0.15-native-src/unix/\n$ sudo ./configure --with-java=/usr/local/java\n$ sudo make\n$ sudo mv jsvc /usr/local/tomcat/bin/\n\n$ sudo vi /etc/init.d/jsvc\n// \u4e0b\u8a18\u3092\u53c2\u7167\n$ sudo vi /usr/local/tomcat/bin/setenv.sh\n// \u4e0b\u8a18\u3092\u53c2\u7167\n$ sudo chmod +x /etc/init.d/jsvc\n$ sudo chkconfig --add jsvc\n$ sudo chkconfig jsvc on\n$ sudo chkconfig --list jsvc\njsvc            0:off   1:off   2:on    3:on    4:on    5:on    6:off\n$ sudo chmod +x /usr/local/tomcat/bin/setenv.sh\n$ sudo service jsvc start\nShutting down tomcat:                                      [OK]\n\n\n\u30d5\u30a1\u30a4\u30eb\u95a2\u9023\n\n/etc/init.d/jsvc\n#!/bin/bash\n#\n# chkconfig: - 80 20\n# description: jsvc\n\n. /etc/init.d/functions\n\nJAVA_HOME=/usr/local/java\nCATALINA_HOME=/usr/local/tomcat\nDAEMON=$CATALINA_HOME/bin/jsvc\nTOMCAT_USER=tomcat\n\nTMP_DIR=/tmp\nPIDFILE=/var/run/tomcat.pid\nCATALINA_BASE=$CATALINA_HOME\nLOCKFILE=/var/lock/subsys/tomcat\n\nif [ -r \"$CATALINA_HOME\"/bin/setenv.sh ]; then\n  . \"$CATALINA_HOME\"/bin/setenv.sh\nfi\n\nCLASSPATH=\\\n$JAVA_HOME/lib/tools.jar:\\\n$CATALINA_HOME/bin/tomcat-juli.jar:\\\n$CATALINA_HOME/bin/commons-daemon.jar:\\\n$CATALINA_HOME/bin/bootstrap.jar\n\nstart(){\n    #\n    # Start Tomcat\n    #\n    echo -n \"Starting tomcat: \"\n    ulimit -n 8192\n    $DAEMON $JSVC_OPTS \\\n    -user $TOMCAT_USER \\\n    -home $JAVA_HOME \\\n    -Dcatalina.home=$CATALINA_HOME \\\n    -Dcatalina.base=$CATALINA_BASE \\\n    -Djava.io.tmpdir=$TMP_DIR \\\n    -wait 10 \\\n    -pidfile $PIDFILE \\\n    -outfile $CATALINA_HOME/logs/catalina.out \\\n    -errfile '&1' \\\n    $CATALINA_OPTS \\\n    -cp $CLASSPATH \\\n    org.apache.catalina.startup.Bootstrap\n\n    RETVAL=$?\n    if [ $RETVAL = 0 ]; then\n        echo_success\n        touch $LOCKFILE\n    else\n        echo_failure\n    fi\n    echo\n}\n\nstop(){\n    #\n    # Stop Tomcat\n    #\n    echo -n \"Shutting down tomcat: \"\n    $DAEMON \\\n    -stop \\\n    -pidfile $PIDFILE \\\n    org.apache.catalina.startup.Bootstrap\n    RETVAL=$?\n    if [ $RETVAL = 0 ]; then\n        echo_success\n        rm -f $PIDFILE $LOCKFILE\n    else\n        echo_failure\n    fi\n    echo\n}\n\ncase \"$1\" in\n    start)\n        start\n        ;;\n    stop)\n        stop\n        ;;\n    restart)\n        stop\n        start\n        ;;\n    status)\n        status $DAEMON\n        RETVAL=$?\n        ;;\n    *)\n        echo $\"Usage: tomcat {start|stop|restart|status}\"\n        exit 1\n        ;;\nesac\n\n\n\n/usr/local/tomcat/bin/setenv.sh\n#!/bin/sh\nDATE=`date +'%Y%m%d-%H%M%s'`\n\nCATALINA_OPTS=\"-server -XX:MaxPermSize=256m -XX:PermSize=256m -XX:SurvivorRatio=2 -Xmn256m -Xmx256m -Xms256m\" //JVM\u306e\u30b5\u30a4\u30ba\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fee\u6b63\nCATALINA_OPTS=\"${CATALINA_OPTS} -XX:+PrintGCDetails -Xloggc:${CATALINA_BASE}/logs/gc.log.${DATE}\"\nCATALINA_OPTS=\"${CATALINA_OPTS} -Djava.security.egd=file:/dev/urandom\" //\u3053\u306e\u8a2d\u5b9a\u306f\u691c\u8a3c\u74b0\u5883\u306e\u5834\u5408\n\nexport CATALINA_OPTS\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u3068\u5fc5\u8981\u306a\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3001Java\u30aa\u30d7\u30b7\u30e7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5099\u5fd8\u9332\u3068\u3057\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n## \u74b0\u5883\n- OS:Amazon Linux 2014.03\n- apache-tomcat:7.0.55\n- java:jdk-7u67\n\n## \u624b\u9806\n```/bin/bash\n$ sudo yum group install \"Development Tools\"\n\n$ cd /usr/local/src/\n$ sudo wget sudo wget http://ftp.kddilabs.jp/infosystems/apache/tomcat/tomcat-7/v7.0.55/bin/apache-tomcat-7.0.55.tar.gz\n$ sudo wget --no-check-certificate --no-cookies - --header \"Cookie: oraclelicense=accept-securebackup-cookie\" http://download.oracle.com/otn-pub/java/jdk/7u67-b01/jdk-7u67-linux-x64.tar.gz\n$ sudo tar zxvf ./jdk-7u67-linux-x64.tar.gz -C /usr/local/\n$ cd /usr/local\n$ sudo ln -s ./jdk1.7.0_67 ./java\n$ /usr/local/java/bin/java -version\njava version \"1.7.0_67\"\nJava(TM) SE Runtime Environment (build 1.7.0_67-b01)\nJava HotSpot(TM) 64-Bit Server VM (build 24.65-b04, mixed mode)\n\n$ sudo groupadd -g 53 tomcat\n$ sudo useradd -u 53 -g 53 -s /sbin/nologin -d /var/lib/tomcat -m tomcat\n$ cd /usr/local/src\n$ tar zxvf ./apache-tomcat-7.0.55.tar.gz -C /usr/local/\n$ cd /usr/local/\n$ sudo ln -s ./apache-tomcat-7.0.55 ./tomcat\n$ sudo tar zxvf ./commons-daemon-native.tar.gz\n$ cd ./commons-daemon-1.0.15-native-src/unix/\n$ sudo ./configure --with-java=/usr/local/java\n$ sudo make\n$ sudo mv jsvc /usr/local/tomcat/bin/\n\n$ sudo vi /etc/init.d/jsvc\n// \u4e0b\u8a18\u3092\u53c2\u7167\n$ sudo vi /usr/local/tomcat/bin/setenv.sh\n// \u4e0b\u8a18\u3092\u53c2\u7167\n$ sudo chmod +x /etc/init.d/jsvc\n$ sudo chkconfig --add jsvc\n$ sudo chkconfig jsvc on\n$ sudo chkconfig --list jsvc\njsvc            0:off   1:off   2:on    3:on    4:on    5:on    6:off\n$ sudo chmod +x /usr/local/tomcat/bin/setenv.sh\n$ sudo service jsvc start\nShutting down tomcat:                                      [OK]\n```\n\n## \u30d5\u30a1\u30a4\u30eb\u95a2\u9023\n```/etc/init.d/jsvc\n#!/bin/bash\n#\n# chkconfig: - 80 20\n# description: jsvc\n\n. /etc/init.d/functions\n\nJAVA_HOME=/usr/local/java\nCATALINA_HOME=/usr/local/tomcat\nDAEMON=$CATALINA_HOME/bin/jsvc\nTOMCAT_USER=tomcat\n\nTMP_DIR=/tmp\nPIDFILE=/var/run/tomcat.pid\nCATALINA_BASE=$CATALINA_HOME\nLOCKFILE=/var/lock/subsys/tomcat\n\nif [ -r \"$CATALINA_HOME\"/bin/setenv.sh ]; then\n  . \"$CATALINA_HOME\"/bin/setenv.sh\nfi\n\nCLASSPATH=\\\n$JAVA_HOME/lib/tools.jar:\\\n$CATALINA_HOME/bin/tomcat-juli.jar:\\\n$CATALINA_HOME/bin/commons-daemon.jar:\\\n$CATALINA_HOME/bin/bootstrap.jar\n\nstart(){\n    #\n    # Start Tomcat\n    #\n    echo -n \"Starting tomcat: \"\n    ulimit -n 8192\n    $DAEMON $JSVC_OPTS \\\n    -user $TOMCAT_USER \\\n    -home $JAVA_HOME \\\n    -Dcatalina.home=$CATALINA_HOME \\\n    -Dcatalina.base=$CATALINA_BASE \\\n    -Djava.io.tmpdir=$TMP_DIR \\\n    -wait 10 \\\n    -pidfile $PIDFILE \\\n    -outfile $CATALINA_HOME/logs/catalina.out \\\n    -errfile '&1' \\\n    $CATALINA_OPTS \\\n    -cp $CLASSPATH \\\n    org.apache.catalina.startup.Bootstrap\n\n    RETVAL=$?\n    if [ $RETVAL = 0 ]; then\n        echo_success\n        touch $LOCKFILE\n    else\n        echo_failure\n    fi\n    echo\n}\n\nstop(){\n    #\n    # Stop Tomcat\n    #\n    echo -n \"Shutting down tomcat: \"\n    $DAEMON \\\n    -stop \\\n    -pidfile $PIDFILE \\\n    org.apache.catalina.startup.Bootstrap\n    RETVAL=$?\n    if [ $RETVAL = 0 ]; then\n        echo_success\n        rm -f $PIDFILE $LOCKFILE\n    else\n        echo_failure\n    fi\n    echo\n}\n\ncase \"$1\" in\n    start)\n        start\n        ;;\n    stop)\n        stop\n        ;;\n    restart)\n        stop\n        start\n        ;;\n    status)\n        status $DAEMON\n        RETVAL=$?\n        ;;\n    *)\n        echo $\"Usage: tomcat {start|stop|restart|status}\"\n        exit 1\n        ;;\nesac\n```\n\n```/usr/local/tomcat/bin/setenv.sh\n#!/bin/sh\nDATE=`date +'%Y%m%d-%H%M%s'`\n\nCATALINA_OPTS=\"-server -XX:MaxPermSize=256m -XX:PermSize=256m -XX:SurvivorRatio=2 -Xmn256m -Xmx256m -Xms256m\" //JVM\u306e\u30b5\u30a4\u30ba\u306f\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u4fee\u6b63\nCATALINA_OPTS=\"${CATALINA_OPTS} -XX:+PrintGCDetails -Xloggc:${CATALINA_BASE}/logs/gc.log.${DATE}\"\nCATALINA_OPTS=\"${CATALINA_OPTS} -Djava.security.egd=file:/dev/urandom\" //\u3053\u306e\u8a2d\u5b9a\u306f\u691c\u8a3c\u74b0\u5883\u306e\u5834\u5408\n\nexport CATALINA_OPTS\n```\n", "tags": ["Tomcat", "Java"]}