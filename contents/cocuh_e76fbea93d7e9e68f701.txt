{"context": " More than 1 year has passed since last update.sqlalchemy\u3067schema\u3092\u5ba3\u8a00\u3057\u3066\u3001__init__\u3067\u4ee3\u5165\u3057\u305f\u6642\u306e\u6319\u52d5\u3067\u3061\u3087\u3063\u3068\u8e93\u3044\u305f\u306e\u3067\u3081\u3082\u3067\u3059\u3002\n\n\u554f\u984c\n\u305f\u3068\u3048\u3070\u3001todo\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u4f5c\u308b\u3068\u3057\u3066\u3001Uesr\u3068Task\u3092\u4f5c\u308a\u307e\u3059\u3002\nTask\u306e\u9806\u756a\u3092position\u3068\u3057\u3066\u4fdd\u6301\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u3057\u305f\u3068\u3057\u307e\u3059\u3002\n# coding=utf-8\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import(\n    Column,\n    Integer,\n    String,\n    create_engine,\n    ForeignKey,\n)\nfrom sqlalchemy.orm import (\n    scoped_session,\n    sessionmaker,\n    relationship,\n)\n\nBase = declarative_base()\n\n\nclass User(Base):\n    __tablename__ = 'users'\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    name = Column(String)\n\n    def __init__(self, name):\n        self.name = name\n\n\nclass Task(Base):\n    __tablename__ = 'tasks'\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    name = Column(String)\n\n    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)\n    user = relationship(User, cascade='delete', backref='tasks')\n\n    position = Column(Integer, nullable=False) # \u3053\u3053\u304c\u91cd\u8981\n\n    def __init__(self, user, name):\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) # \u3053\u3053\u304c\u60aa\u3055\u3057\u3066\u308b\n\ndef main():\n    # engine,session\u306e\u5ba3\u8a00\u3068db\u306e\u521d\u671f\u5316\n    engine = create_engine('sqlite://', echo=True)\n    Session = scoped_session(sessionmaker(bind=engine))\n    Base.metadata.create_all(engine)\n\n    # user\u3092\u4f5c\u3063\u3066\n    user = User('E.HOBA')\n    Session.add(user)\n    Session.commit()\n\n    # task\u3092\u4f5c\u308b\n    task = Task(user, name='Hyper Operating System')\n    Session.add(task)\n    Session.commit()\n\n    # \u30c6\u30b9\u30c8\n    print('name: %s'%task.name)\n    print('user: %s'%task.user.name)\n    print('posotion: %d'%task.position)\n\nif __name__ == '__main__':\n    main()\n\n\u4e00\u898b\u3046\u3054\u304d\u305d\u3046\u3067\u3059\u304c\u3001\u3053\u3093\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\nsqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occuring prematurely) (IntegrityError) NOT NULL constraint failed: tasks.position u'INSERT INTO tasks (name, user_id, position) VALUES (?, ?, ?)' ('Hyper Operating System', 1, None)\n\n\u306a\u3093\u304bposition\u304cnullable=False\u306a\u306e\u304c\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\u89e3\u6c7a\u7b56\nnullable=False\u3092\u5916\u3057\u3066\u3082\u3046\u3054\u304d\u307e\u3059\u304c\u3001Task\u306einit\u3092\u3053\u3093\u306a\u3075\u3046\u306b\u5148\u306b\u8a08\u7b97\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3059\u308b\u3068\u6cbb\u305b\u307e\u3059\u3002\nclass Task(Base):\n    def __init__(self, user, name):\n        position = len(user.tasks) ## \u2190\u3053\u3053!\n        self.user = user\n        self.name = name\n        self.position = position\n\nname: Hyper Operating System\nuser: E.HOBA\nposotion: 0\n\n\u305f\u3076\u3093\u3001sqlalchemy\u306e\u932c\u91d1\u8853\u306b\u3088\u308a\u3001\u95a2\u6570\u547c\u3073\u51fa\u3057\u306a\u3069\u304c\u306a\u3044\u90e8\u5206\u306f\u5148\u306b\u4f5c\u3063\u3066\u5fc5\u8981\u306a\u90e8\u5206\u306f\u547c\u3073\u51fa\u3057\u3068\u3057\u3066\u3044\u308b\u69d8\u5b50\u3067\u3001\u305d\u308c\u306b\u3088\u308anullable\u306b\u5f15\u3063\u304b\u304b\u3063\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\n\u6700\u521d\u306e\u30b3\u30fc\u30c9\u306enullable=True\u306b\u3057\u3066\u307f\u308b\u3068\u6700\u521d\u306eposition\u304c1\u3068\u306a\u308a\u3001\u6700\u521d\u306b\u4f5c\u3063\u3066\u304b\u3089len(user.tasks)\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\nname: Hyper Operating System\nuser: E.HOBA\nposotion: 1\n\n\n\u3061\u306a\u307f\u306b\nnullable=False\u306e\u307e\u307e\u3067\u4e0b\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u3059\u308b\u3068\u554f\u984c\u306a\u304f\u3044\u3051\u307e\u3059\u3002\n\ncase01\nclass Task(Base):\n    def __init__(self, user, name):\n        print(user.tasks) ## \u2190\u3053\u3053\u3068\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2190OK!!!\n\n\ncase02\n__init__\u5185\u306e\u6700\u521d\u306e\u65b9\u306b\u95a2\u6570\u547c\u3073\u51fa\u3057\u3084\u4ee3\u5165\u304c\u3042\u308c\u3070\u5927\u4e08\u592b\u306a\u306e\u304b\u306a\u3068\u601d\u3063\u3066\u3053\u3046\u3057\u3066\u307f\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\nclass Task(Base):\n    def __init__(self, user, name):\n        f = lambda:0 # \u610f\u5473\u306e\u306a\u3044\u4ee3\u5165\n        f() # \u610f\u5473\u306e\u306a\u3044\u95a2\u6570\u547c\u3073\u51fa\u3057\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2192\u30a8\u30e9\u30fc\n\n\ncase03\n\u3084\u3063\u3071\u308aDB\u3078\u306e\u53c2\u7167\u304c\u884c\u308f\u308c\u308b\u304b\u3069\u3046\u304b\u304c\u30ad\u30e2\u306a\u306e\u304b\u306a\u3068\u304a\u3082\u3063\u3066\u3053\u3046\u3059\u308b\u3068\nclass Task(Base):\n    def __init__(self, user, name):\n        print(user.name) # \u610f\u5473\u306e\u306a\u3044\u53c2\u7167\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2192\u30a8\u30e9\u30fc\n\n\u3046\u30fc\u3080\u2026\u305f\u3076\u3093sqlalchemy\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3057\u3066\u308b\u306e\u304b\u306a\u2026\nsqlalchemy\u932c\u91d1\u8853\u3060\u2026:;(\u2229\u00b4_`\u2229);:\nsqlalchemy\u3067schema\u3092\u5ba3\u8a00\u3057\u3066\u3001`__init__`\u3067\u4ee3\u5165\u3057\u305f\u6642\u306e\u6319\u52d5\u3067\u3061\u3087\u3063\u3068\u8e93\u3044\u305f\u306e\u3067\u3081\u3082\u3067\u3059\u3002\n\n\n# \u554f\u984c\n\u305f\u3068\u3048\u3070\u3001todo\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u4f5c\u308b\u3068\u3057\u3066\u3001`Uesr`\u3068`Task`\u3092\u4f5c\u308a\u307e\u3059\u3002\n`Task`\u306e\u9806\u756a\u3092`position`\u3068\u3057\u3066\u4fdd\u6301\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u306b\u3057\u305f\u3068\u3057\u307e\u3059\u3002\n\n```py3\n# coding=utf-8\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import(\n    Column,\n    Integer,\n    String,\n    create_engine,\n    ForeignKey,\n)\nfrom sqlalchemy.orm import (\n    scoped_session,\n    sessionmaker,\n    relationship,\n)\n\nBase = declarative_base()\n\n\nclass User(Base):\n    __tablename__ = 'users'\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    name = Column(String)\n    \n    def __init__(self, name):\n        self.name = name\n\n\nclass Task(Base):\n    __tablename__ = 'tasks'\n    id = Column(Integer, primary_key=True, autoincrement=True)\n    name = Column(String)\n    \n    user_id = Column(Integer, ForeignKey('users.id'), nullable=False)\n    user = relationship(User, cascade='delete', backref='tasks')\n\n    position = Column(Integer, nullable=False) # \u3053\u3053\u304c\u91cd\u8981\n    \n    def __init__(self, user, name):\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) # \u3053\u3053\u304c\u60aa\u3055\u3057\u3066\u308b\n\ndef main():\n    # engine,session\u306e\u5ba3\u8a00\u3068db\u306e\u521d\u671f\u5316\n    engine = create_engine('sqlite://', echo=True)\n    Session = scoped_session(sessionmaker(bind=engine))\n    Base.metadata.create_all(engine)\n    \n    # user\u3092\u4f5c\u3063\u3066\n    user = User('E.HOBA')\n    Session.add(user)\n    Session.commit()\n    \n    # task\u3092\u4f5c\u308b\n    task = Task(user, name='Hyper Operating System')\n    Session.add(task)\n    Session.commit()\n    \n    # \u30c6\u30b9\u30c8\n    print('name: %s'%task.name)\n    print('user: %s'%task.user.name)\n    print('posotion: %d'%task.position)\n\nif __name__ == '__main__':\n    main()\n```\n\u4e00\u898b\u3046\u3054\u304d\u305d\u3046\u3067\u3059\u304c\u3001\u3053\u3093\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n```py3\nsqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occuring prematurely) (IntegrityError) NOT NULL constraint failed: tasks.position u'INSERT INTO tasks (name, user_id, position) VALUES (?, ?, ?)' ('Hyper Operating System', 1, None)\n```\n\n\u306a\u3093\u304bposition\u304c`nullable=False`\u306a\u306e\u304c\u3044\u3051\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n## \u89e3\u6c7a\u7b56\n`nullable=False`\u3092\u5916\u3057\u3066\u3082\u3046\u3054\u304d\u307e\u3059\u304c\u3001Task\u306e__init__\u3092\u3053\u3093\u306a\u3075\u3046\u306b\u5148\u306b\u8a08\u7b97\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3059\u308b\u3068\u6cbb\u305b\u307e\u3059\u3002\n\n```py3\nclass Task(Base):\n    def __init__(self, user, name):\n        position = len(user.tasks) ## \u2190\u3053\u3053!\n        self.user = user\n        self.name = name\n        self.position = position\n```\n\n```pytb\nname: Hyper Operating System\nuser: E.HOBA\nposotion: 0\n```\n\n\u305f\u3076\u3093\u3001sqlalchemy\u306e\u932c\u91d1\u8853\u306b\u3088\u308a\u3001\u95a2\u6570\u547c\u3073\u51fa\u3057\u306a\u3069\u304c\u306a\u3044\u90e8\u5206\u306f\u5148\u306b\u4f5c\u3063\u3066\u5fc5\u8981\u306a\u90e8\u5206\u306f\u547c\u3073\u51fa\u3057\u3068\u3057\u3066\u3044\u308b\u69d8\u5b50\u3067\u3001\u305d\u308c\u306b\u3088\u308anullable\u306b\u5f15\u3063\u304b\u304b\u3063\u3066\u3057\u307e\u3046\u3088\u3046\u3067\u3059\u3002\n\n\u6700\u521d\u306e\u30b3\u30fc\u30c9\u306e`nullable=True`\u306b\u3057\u3066\u307f\u308b\u3068\u6700\u521d\u306eposition\u304c1\u3068\u306a\u308a\u3001\u6700\u521d\u306b\u4f5c\u3063\u3066\u304b\u3089`len(user.tasks)`\u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```pytb\nname: Hyper Operating System\nuser: E.HOBA\nposotion: 1\n```\n\n## \u3061\u306a\u307f\u306b\n`nullable=False`\u306e\u307e\u307e\u3067\u4e0b\u307f\u305f\u3044\u306a\u3053\u3068\u3092\u3059\u308b\u3068\u554f\u984c\u306a\u304f\u3044\u3051\u307e\u3059\u3002\n\n### case01\n```py3\nclass Task(Base):\n    def __init__(self, user, name):\n        print(user.tasks) ## \u2190\u3053\u3053\u3068\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2190OK!!!\n```\n\n### case02\n`__init__`\u5185\u306e\u6700\u521d\u306e\u65b9\u306b\u95a2\u6570\u547c\u3073\u51fa\u3057\u3084\u4ee3\u5165\u304c\u3042\u308c\u3070\u5927\u4e08\u592b\u306a\u306e\u304b\u306a\u3068\u601d\u3063\u3066\u3053\u3046\u3057\u3066\u307f\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n```py3\nclass Task(Base):\n    def __init__(self, user, name):\n        f = lambda:0 # \u610f\u5473\u306e\u306a\u3044\u4ee3\u5165\n        f() # \u610f\u5473\u306e\u306a\u3044\u95a2\u6570\u547c\u3073\u51fa\u3057\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2192\u30a8\u30e9\u30fc\n```\n\n### case03\n\u3084\u3063\u3071\u308aDB\u3078\u306e\u53c2\u7167\u304c\u884c\u308f\u308c\u308b\u304b\u3069\u3046\u304b\u304c\u30ad\u30e2\u306a\u306e\u304b\u306a\u3068\u304a\u3082\u3063\u3066\u3053\u3046\u3059\u308b\u3068\n\n```py3\nclass Task(Base):\n    def __init__(self, user, name):\n        print(user.name) # \u610f\u5473\u306e\u306a\u3044\u53c2\u7167\n        self.user = user\n        self.name = name\n        self.position = len(user.tasks) ## \u2192\u30a8\u30e9\u30fc\n```\n\u3046\u30fc\u3080\u2026\u305f\u3076\u3093sqlalchemy\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3057\u3066\u308b\u306e\u304b\u306a\u2026\n\n**sqlalchemy\u932c\u91d1\u8853\u3060\u2026:;(\u2229\u00b4_`\u2229);:**\n", "tags": ["sqlalchemy0.9.4", "Python2.7.6, 3.4.0"]}