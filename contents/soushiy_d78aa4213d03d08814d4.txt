{"context": " More than 1 year has passed since last update.\n\nZooKeeper\u3092DistributedMode\u3067\u52d5\u304b\u3059\n\u52d5\u4f5c\u74b0\u5883\n\n\n\nComponent\nVersion\n\n\n\n\nCentos\n6.6\n\n\nOracle JDK\n7\n\n\n\nOracle JDK7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f\u3053\u3061\u3089\n\n1 Zookeeper\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n0.0 docker\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n1 docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\ndocker run -itd --net=host -v /etc/localtime:/etc/localtime:ro -v /etc/zookeeper/config:/usr/local/zookeeper/conf -v /var/zookeeper/data:/usr/local/zookeeper/data -v /var/log/zookeeper:/usr/local/zookeeper/log --name storm  centos:6 /bin/bash;\ndocker attach storm;\n\n\n2 java\u306a\u3069\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nsu\nyum -y install wget\nyum -y install tar\n\n\n1.1 \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304a\u3088\u3073\u89e3\u51cd\nmkdir /usr/local/download\ncd /usr/local/download\nwget http://www.webhostingreviewjam.com/mirror/apache/zookeeper/stable/zookeeper-3.4.6.tar.gz\ntar xvf zookeeper-3.4.6.tar.gz\nyes | mv -f /usr/local/download/zookeeper-3.4.6 /usr/local/download/zookeeper;\nyes | cp -r -f /usr/local/download/zookeeper /usr/local/;\nyes | rm -r -f /usr/local/download/zookeeper;\necho \"export PATH=\\$PATH:/usr/local/zookeeper/bin\" >> /etc/profile;\nexport PATH=$PATH:/usr/local/zookeeper/bin\n\n\n1.2 Zookeeper\u306e\u8a2d\u5b9a\u3092\u884c\u3046(zoo.cfg)\ncd /usr/local/zookeeper/conf/\nyes | cp -p zoo_sample.cfg zoo.cfg\n\n\n1.2.1 \u30c7\u30fc\u30bf\u4fdd\u5b58\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5909\u66f4(zoo.cfg)\n\u203b\u5f8c\u3067\u79fb\u52d5\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u30c7\u30fc\u30bf\u3082\u542b\u3081\u3066zookeeper\u914d\u4e0b\u306b\u4f5c\u6210\u3059\u308b\u3088\u3046\u4fee\u6b63\u3057\u307e\u3059\u3002\nsed -i -e 's/^dataDir/#dataDir/g' /usr/local/zookeeper/conf/zoo.cfg;\nsed -i -e '/^#dataDir/a dataDir=\\/usr\\/local\\/zookeeper\\/data' /usr/local/zookeeper/conf/zoo.cfg;\n\n\n1.2.2 \u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u306e\u5909\u66f4(zoo.cfg)\nsed -i -e 's/^clientPort/#clientPort/g' /usr/local/zookeeper/conf/zoo.cfg;\nsed -i -e '/^#clientPort/a clientPort=2181' /usr/local/zookeeper/conf/zoo.cfg;\n\n\n1.3 \u30ed\u30b0\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63(usr/local/zookeeper/conf/log4j.properties)\n\u6b21\u306f\u30ed\u30b0\u51fa\u529b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08log4j.properties\uff09\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u306a\u306b\u305b\u3001\u521d\u671f\u8868\u793a\u3060\u3068\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u3057\u304b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\ncp log4j.properties log4j.properties.bak\n# zookeeper.root.logger=INFO, CONSOLE\nsed -i -e 's/^zookeeper\\.root\\.logger/#zookeeper\\.root\\.logger/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.root\\.logger/a zookeeper\\.root\\.logger=INFO, CONSOLE' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.console.threshold=INFO\nsed -i -e 's/^zookeeper\\.console\\.threshold/#zookeeper\\.console\\.threshold/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.console\\.threshold/a zookeeper\\.console\\.threshold=INFO' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.log.dir=/usr/local/zookeeper/log/\nsed -i -e 's/^zookeeper\\.log\\.dir/#zookeeper\\.log\\.dir/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.dir/a zookeeper\\.log\\.dir=\\/usr\\/local\\/zookeeper\\/log\\/' /usr/local/zookeeper/conf/log4j.properties;\n\n\n# zookeeper.log.file=zookeeper.log\nsed -i -e 's/^zookeeper\\.log\\.file/#zookeeper\\.log\\.file/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.file/a zookeeper\\.log\\.file=zookeeper.log' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.log.threshold=DEBUG\nsed -i -e 's/^zookeeper\\.log\\.threshold/#zookeeper\\.log\\.threshold/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.threshold/a zookeeper\\.log\\.threshold=DEBUG' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.tracelog.dir=/usr/local/zookeeper/log/\nsed -i -e 's/^zookeeper\\.tracelog\\.dir/#zookeeper\\.tracelog\\.dir/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.tracelog\\.dir/a zookeeper\\.tracelog\\.dir=\\/usr\\/local\\/zookeeper\\/log\\/' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.tracelog.file=zookeeper_trace.log\nsed -i -e 's/^zookeeper\\.tracelog\\.file/#zookeeper\\.tracelog\\.file/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.tracelog\\.file/a zookeeper\\.tracelog\\.file=zookeeper_trace.log' /usr/local/zookeeper/conf/log4j.properties;\n\n# DEFAULT: console appender only\n#log4j.rootLogger=${zookeeper.root.logger}\nsed -i -e 's/^log4j\\.rootLogger/#log4j\\.rootLogger/g' /usr/local/zookeeper/conf/log4j.properties;\n\n# Rolling log file\nsed -i -e 's/^#log4j\\.rootLogger=DEBUG, CONSOLE, ROLLINGFILE/log4j\\.rootLogger=DEBUG, CONSOLE, ROLLINGFILE/' /usr/local/zookeeper/conf/log4j.properties;\n\n\n\n1.4 \u30c7\u30fc\u30bf\u4fdd\u5b58\u7528\u30d5\u30a9\u30eb\u30c0\u304a\u3088\u3073\u30ed\u30b0\u51fa\u529b\u7528\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\nmkdir /usr/local/zookeeper/data/\nmkdir /usr/local/zookeeper/log/\n\n\n1.5 \u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u8d77\u52d5\n\u203b\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u76f4\u63a5zkServer.sh\u3067\u8d77\u52d5\u3067\u304d\u308b\u3002\nzkServer.sh start\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Starting zookeeper ... STARTED\n\n\n1.6 \u6b63\u5e38\u306b\u8d77\u52d5\u3067\u304d\u305f\u304b\u3092\u78ba\u8a8d\u3059\u308b\n\u203bnc\u30b3\u30de\u30f3\u30c9\u304c\u7121\u3044\u5834\u5408\u306f\u3001yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nyum -y install nc\n\n\n1.6.1 nc\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001zookeeper\u306e\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3067\u3042\u308b2181\u756a\u30dd\u30fc\u30c8\u306b\u5bfe\u3057\u3066\u3001\u300cruok(Are you OK?)\u300d\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u3059\u308b\u3002\n\u203bimok\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5e30\u3063\u3066\u304f\u308c\u3070OK\necho ruok | nc localhost 2181\n#>imok\n\n\n2 ZooKeeper\u3092Distributed mode\u3067\u8d77\u52d5\u3059\u308b\n\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883(\u4f8b:Macbook)\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3002\n\n\n2.1 Zookeeper\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\n\u3053\u3061\u3089\u3092\u53c2\u7167 ZooKeeper\u7ba1\u7406\u8005\u30ac\u30a4\u30c9\n\n2.1.1 Zookeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(zoo.cfg)\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nmkdir ~/tmp/\nscp agent-master1:/etc/zookeeper/config/zoo.cfg ~/tmp/zoo.cfg\n\n\n2.1.2 zoo.cfg\u306b\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3092\u69cb\u6210\u3059\u308b\u5168\u30b5\u30fc\u30d0\u30fc\u306e\u5834\u6240\u3092\u5165\u529b\u3059\u308b\u3002\nZooKeeper \u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3092\u69cb\u6210\u3059\u308b\u5404\u30de\u30b7\u30f3\u306f\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u5185\u306e\u307b\u304b\u306e\u3059\u3079\u3066\u306e\u30de\u30b7\u30f3\u306b\u3064\u3044\u3066\u3082\u77e5\u3063\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3092\u884c\u3046\u306e\u304c\u3001server.id=host:port:port \u3068\u3044\u3046\u5f62\u5f0f\u3067\u8a18\u8ff0\u3055\u308c\u305f\u4e00\u9023\u306e\u884c\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf host \u3068 port \u306b\u3064\u3044\u3066\u306f\u3001\u8aac\u660e\u306e\u5fc5\u8981\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u5404\u30de\u30b7\u30f3\u306b\u30b5\u30fc\u30d0\u30fc id \u3092\u5272\u308a\u5f53\u3066\u308b\u306b\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u3054\u3068\u306b 1 \u3064\u3001myid \u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u305d\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30e9\u30e1\u30fc\u30bf dataDir \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n2.1.2.1 \u74b0\u5883\u5909\u6570\u306b\u30b5\u30fc\u30d0\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3059\u308b\u3002\nSERVER_1=agent-master1:192.168.56.201:2888:3888\nSERVER_2=agent-master2:192.168.56.202:2888:3888\nSERVER_3=agent-master3:192.168.56.203:2888:3888\nSERVER_4=agent-cluster1:192.168.56.171:2888:3888\nSERVER_5=agent-cluster2:192.168.56.172:2888:3888\nSERVER_6=agent-cluster3:192.168.56.173:2888:3888\nSERVER_7=agent-cluster4:192.168.56.174:2888:3888\n\n\n\u5404\u30de\u30b7\u30f3\u306e/usr/local/zookeeper/conf/zoo.cfg\u306e\u8a2d\u5b9a\n\n\u6ce8\u610f\uff01IP\u30a2\u30c9\u30ec\u30b9\u306e\u4ee3\u308f\u308a\u306b\u30db\u30b9\u30c8\u540d\u3092\u5165\u308c\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\necho \"server.1=`echo $SERVER_1 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.2=`echo $SERVER_2 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.3=`echo $SERVER_3 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.4=`echo $SERVER_4 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.5=`echo $SERVER_5 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.6=`echo $SERVER_6 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.7=`echo $SERVER_7 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\n\n\nserver.x=[hostname]:nnnnn[:nnnnn], etc\n(No Java system property)\nservers making up the ZooKeeper ensemble. When the server starts up, it determines which server it is by looking for the file myid in the data directory. That file contains the server number, in ASCII, and it should match x in server.x in the left hand side of this setting.\nThe list of servers that make up ZooKeeper servers that is used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has.\nThere are two port numbers nnnnn. The first followers use to connect to the leader, and the second is for leader election. The leader election port is only necessary if electionAlg is 1, 2, or 3 (default). If electionAlg is 0, then the second port is not necessary. If you want to test multiple servers on a single machine, then different ports can be used for each server.\nelectionAlg\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f3\u3067\u3059\u3002\n\n2.1.3 zoo.cfg\u3092scp\u3067\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\necho \"1\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_1 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_1 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"2\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_2 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_2 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"3\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_3 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_3 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"4\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_4 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_4 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"5\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_5 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_5 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"6\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_6 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_6 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"7\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_7 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_7 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\n\n2.2 \u30af\u30e9\u30b9\u30bf\u306e\u8d77\u52d5\n\n2.2.1 Zookeeper\u3092\u8d77\u52d5\u3059\u308b\u3002\n\nZookeeper\u306e\u30b3\u30de\u30f3\u30c9\u306e\u8aac\u660e\u306f\u3053\u3061\u3089\u304c\u8a73\u3057\u3044\u3002\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u308bvm2\u301cvm5\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3002\n\n\nzkServer.sh start\necho ruok | nc localhost 2181\n#>imok\n\n\n2.2.2 ZooKeeper\u72b6\u614b\u78ba\u8a8d\u65b9\u6cd5\n\n2.2.2.1 4\u6587\u5b57\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\n\u4f7f\u3044\u65b9\necho ruok | nc localhost 2181\n#>imok\n\n\nZookeeper\u306e\u72b6\u614b\u3092\u77e5\u308b\u305f\u3081\u306e4\u6587\u5b57\u30b3\u30de\u30f3\u30c9\u30ea\u30b9\u30c8\n\u30b3\u30de\u30f3\u30c9\u96c6\u306f\u3053\u3061\u3089\n\n\n\ncommand\ndescription\n\n\n\n\nconf\n\nNew in 3.3.0: Print details about serving configuration.\n\n\ncons\n\nNew in 3.3.0: List full connection/session details for all clients connected to this server. Includes information on numbers of packets received/sent, session id, operation latencies, last operation performed, etc...\n\n\ncrst\n\nNew in 3.3.0: Reset connection/session statistics for all connections.\n\n\ndump\nLists the outstanding sessions and ephemeral nodes. This only works on the leader.\n\n\nenvi\nPrint details about serving environment\n\n\nruok\nTests if server is running in a non-error state. The server will respond with imok if it is running. Otherwise it will not respond at all. A response of \"imok\" does not necessarily indicate that the server has joined the quorum, just that the server process is active and bound to the specified client port. Use \"stat\" for details on state wrt quorum and client connection information.\n\n\nsrst\nReset server statistics.\n\n\nsrvr\n\nNew in 3.3.0: Lists full details for the server.\n\n\nstat\nLists brief details for the server and connected clients.\n\n\nwchs\n\nNew in 3.3.0: Lists brief information on watches for the server.\n\n\nwchc\n\nNew in 3.3.0: Lists detailed information on watches for the server, by session. This outputs a list of sessions(connections) with associated watches (paths). Note, depending on the number of watches this operation may be expensive (ie impact server performance), use it carefully.\n\n\nwchp\n\nNew in 3.3.0: Lists detailed information on watches for the server, by path. This outputs a list of paths (znodes) with associated sessions. Note, depending on the number of watches this operation may be expensive (ie impact server performance), use it carefully.\n\n\n\n\n2.2.2.2 zkServer.sh\u306estatus\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\nVM1\u306e\u5834\u5408\u3001Mode: leader\u3068\u306a\u3063\u3066\u3044\u308b\u3002\nzkServer.sh status\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Mode: leader\n\nVM2\u301c5\u306e\u5834\u5408\u3001Mode: follower\u3068\u306a\u3063\u3066\u3044\u308b\u3002\nzkServer.sh status\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Mode: follower\n\n\n2.2.2.3 zkCli.sh\u3067\u540c\u671f\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\n\n2.2.2.3.1 ZooKeeper\u306e\u30b7\u30a7\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\nzkCli.sh -server localhost:2181\n#Zookeeper\u306e\u30b7\u30a7\u30eb\u306b\u5165\u308b\u3002(\u4e0b\u8a18\u304c\u30b7\u30a7\u30eb\u306b\u5165\u3063\u305f\u72b6\u614b)\n[zk: localhost:2181(CONNECTED) 0]\n\n\n2.2.2.3.2 ls\u30b3\u30de\u30f3\u30c9\u3067\u3001\u73fe\u5728\u540c\u671f\u4e2d\u306e\u30d5\u30a9\u30eb\u30c0\u3092ls\n[zk: localhost:2181(CONNECTED) 0]ls /\n[storm, zookeeper]\n\n\n2.2.2.3.3 create\u30b3\u30de\u30f3\u30c9\u3067\u3001test\u30d5\u30a9\u30eb\u30c0\u3092\u8ffd\u52a0\n[zk: localhost:2181(CONNECTED) 1]create /test dummy\nCreated /test\n[zk: localhost:2181(CONNECTED) 2] ls /\n[storm, test, zookeeper]\n\n\n2.2.2.3.4 \u4ed6\u306e\u7aef\u672b(\u4f8b:VM2)\u3067\u3001\u540c\u69d8\u306bls\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u307f\u308b\n\u203b\u3053\u3061\u3089\u306b\u3001test\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u540c\u671f\u6210\u529f\n[zk: localhost:2181(CONNECTED) 0]ls /\n[storm, test, zookeeper]\n\n\n2.2.2.3.5 \u6700\u5f8c\u306b\u3001delete\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664(\u5f8c\u7247\u4ed8\u3051)\n[zk: localhost:2181(CONNECTED) 0]delete /test\n\n\n\nZookeeper\u304c\u3046\u307e\u304f\u52d5\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u306e\u78ba\u8a8d\u9805\u76ee\n\n\nSELINUX,iptables\u304c\u30aa\u30d5\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3002\n\u6642\u523b\u304c\u3042\u3063\u3066\u3044\u308b\u304b(ntpd)\nvm1\u4e0a\u3067\u3001/usr/local/zookeeper/conf/zoo.cfg\u306eserver.?=IP\u30a2\u30c9\u30ec\u30b9\u3068\u306a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3002(\u30db\u30b9\u30c8\u540d\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u53ef\u80fd\u6027\u6709(\u8981\u78ba\u8a8d))\n\u30b3\u30f3\u30c6\u30ca\u306e\u5834\u5408\u3084\u3001\u8907\u6570\u306eI/F\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u3001zookeeper\u304cbind\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3042\u308b\u304b\u3069\u3046\u304b\u3002\n\n/usr/local/zookeeper/conf/zoo.cfg\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/usr/local/zookeeper/data\nclientPort=2181\nclientPortBindAddress=192.168.56.201\nserver.1=192.168.56.201:2888:3888\nserver.2=192.168.56.202:2888:3888\nserver.3=192.168.56.203:2888:3888\n\n\nvm2\u301c5\u4e0a\u306b\u3001/usr/local/zookeeper/data/myid\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3002(myid\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u3001server.1\u3067\u6307\u5b9a\u3057\u305f\u3002\u30ce\u30fc\u30c9\u756a\u53f7(\u4f8b:server.1\u306e\u30de\u30b7\u30f3\u306e\u5834\u5408\u30011))\n\n/usr/local/zookeeper/data/myid\n1\n\n\n\n\u5168\u3066\u306e\u5b9f\u884c\u30b3\u30fc\u30c9\n\n\u7b2c2\u7ae0\u4ee5\u964d\u306f\u3001\u624b\u52d5\u3067\u884c\u3046\u3053\u3068\u3002(\u5225\u306eVM\u4e0a\u3067\u64cd\u4f5c\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044)\n\n#ZooKeeper\u3092DistributedMode\u3067\u52d5\u304b\u3059\n\n\u52d5\u4f5c\u74b0\u5883\n\n|**Component**|**Version**|\n|---|---|\n| Centos | 6.6 |\n| Oracle JDK | 7 |\n[Oracle JDK7\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306b\u306f\u3053\u3061\u3089](http://qiita.com/soushiy/items/b664f67b7383edc2d7db)\n\n##1 Zookeeper\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n###0.0 docker\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u8d77\u52d5\u3059\u308b\u5834\u5408\u3001\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n- 1 docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n~~~sh\ndocker run -itd --net=host -v /etc/localtime:/etc/localtime:ro -v /etc/zookeeper/config:/usr/local/zookeeper/conf -v /var/zookeeper/data:/usr/local/zookeeper/data -v /var/log/zookeeper:/usr/local/zookeeper/log --name storm  centos:6 /bin/bash;\ndocker attach storm;\n~~~\n\n- 2 java\u306a\u3069\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n~~~sh\nsu\nyum -y install wget\nyum -y install tar\n~~~\n\n###1.1 \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304a\u3088\u3073\u89e3\u51cd\n~~~sh\nmkdir /usr/local/download\ncd /usr/local/download\nwget http://www.webhostingreviewjam.com/mirror/apache/zookeeper/stable/zookeeper-3.4.6.tar.gz\ntar xvf zookeeper-3.4.6.tar.gz\nyes | mv -f /usr/local/download/zookeeper-3.4.6 /usr/local/download/zookeeper;\nyes | cp -r -f /usr/local/download/zookeeper /usr/local/;\nyes | rm -r -f /usr/local/download/zookeeper;\necho \"export PATH=\\$PATH:/usr/local/zookeeper/bin\" >> /etc/profile;\nexport PATH=$PATH:/usr/local/zookeeper/bin\n~~~\n\n###1.2 Zookeeper\u306e\u8a2d\u5b9a\u3092\u884c\u3046(zoo.cfg)\n~~~sh\ncd /usr/local/zookeeper/conf/\nyes | cp -p zoo_sample.cfg zoo.cfg\n~~~\n\n####1.2.1 \u30c7\u30fc\u30bf\u4fdd\u5b58\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5909\u66f4(zoo.cfg)\n\u203b\u5f8c\u3067\u79fb\u52d5\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u30c7\u30fc\u30bf\u3082\u542b\u3081\u3066zookeeper\u914d\u4e0b\u306b\u4f5c\u6210\u3059\u308b\u3088\u3046\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n~~~sh\nsed -i -e 's/^dataDir/#dataDir/g' /usr/local/zookeeper/conf/zoo.cfg;\nsed -i -e '/^#dataDir/a dataDir=\\/usr\\/local\\/zookeeper\\/data' /usr/local/zookeeper/conf/zoo.cfg;\n~~~\n\n####1.2.2 \u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u306e\u5909\u66f4(zoo.cfg)\n\n~~~sh\nsed -i -e 's/^clientPort/#clientPort/g' /usr/local/zookeeper/conf/zoo.cfg;\nsed -i -e '/^#clientPort/a clientPort=2181' /usr/local/zookeeper/conf/zoo.cfg;\n~~~\n\n###1.3 \u30ed\u30b0\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63(usr/local/zookeeper/conf/log4j.properties)\n\u6b21\u306f\u30ed\u30b0\u51fa\u529b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff08log4j.properties\uff09\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u306a\u306b\u305b\u3001\u521d\u671f\u8868\u793a\u3060\u3068\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u3057\u304b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n~~~sh\ncp log4j.properties log4j.properties.bak\n# zookeeper.root.logger=INFO, CONSOLE\nsed -i -e 's/^zookeeper\\.root\\.logger/#zookeeper\\.root\\.logger/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.root\\.logger/a zookeeper\\.root\\.logger=INFO, CONSOLE' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.console.threshold=INFO\nsed -i -e 's/^zookeeper\\.console\\.threshold/#zookeeper\\.console\\.threshold/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.console\\.threshold/a zookeeper\\.console\\.threshold=INFO' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.log.dir=/usr/local/zookeeper/log/\nsed -i -e 's/^zookeeper\\.log\\.dir/#zookeeper\\.log\\.dir/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.dir/a zookeeper\\.log\\.dir=\\/usr\\/local\\/zookeeper\\/log\\/' /usr/local/zookeeper/conf/log4j.properties;\n\n\n# zookeeper.log.file=zookeeper.log\nsed -i -e 's/^zookeeper\\.log\\.file/#zookeeper\\.log\\.file/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.file/a zookeeper\\.log\\.file=zookeeper.log' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.log.threshold=DEBUG\nsed -i -e 's/^zookeeper\\.log\\.threshold/#zookeeper\\.log\\.threshold/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.log\\.threshold/a zookeeper\\.log\\.threshold=DEBUG' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.tracelog.dir=/usr/local/zookeeper/log/\nsed -i -e 's/^zookeeper\\.tracelog\\.dir/#zookeeper\\.tracelog\\.dir/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.tracelog\\.dir/a zookeeper\\.tracelog\\.dir=\\/usr\\/local\\/zookeeper\\/log\\/' /usr/local/zookeeper/conf/log4j.properties;\n\n# zookeeper.tracelog.file=zookeeper_trace.log\nsed -i -e 's/^zookeeper\\.tracelog\\.file/#zookeeper\\.tracelog\\.file/g' /usr/local/zookeeper/conf/log4j.properties;\nsed -i -e '/^#zookeeper\\.tracelog\\.file/a zookeeper\\.tracelog\\.file=zookeeper_trace.log' /usr/local/zookeeper/conf/log4j.properties;\n\n# DEFAULT: console appender only\n#log4j.rootLogger=${zookeeper.root.logger}\nsed -i -e 's/^log4j\\.rootLogger/#log4j\\.rootLogger/g' /usr/local/zookeeper/conf/log4j.properties;\n\n# Rolling log file\nsed -i -e 's/^#log4j\\.rootLogger=DEBUG, CONSOLE, ROLLINGFILE/log4j\\.rootLogger=DEBUG, CONSOLE, ROLLINGFILE/' /usr/local/zookeeper/conf/log4j.properties;\n\n~~~\n###1.4 \u30c7\u30fc\u30bf\u4fdd\u5b58\u7528\u30d5\u30a9\u30eb\u30c0\u304a\u3088\u3073\u30ed\u30b0\u51fa\u529b\u7528\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\n~~~sh\nmkdir /usr/local/zookeeper/data/\nmkdir /usr/local/zookeeper/log/\n~~~\n\n###1.5 \u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u8d77\u52d5\n\u203b\u30d1\u30b9\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u76f4\u63a5zkServer.sh\u3067\u8d77\u52d5\u3067\u304d\u308b\u3002\n\n~~~sh\nzkServer.sh start\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Starting zookeeper ... STARTED\n~~~\n\n###1.6 \u6b63\u5e38\u306b\u8d77\u52d5\u3067\u304d\u305f\u304b\u3092\u78ba\u8a8d\u3059\u308b\n\u203bnc\u30b3\u30de\u30f3\u30c9\u304c\u7121\u3044\u5834\u5408\u306f\u3001yum\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n~~~sh\nyum -y install nc\n~~~\n\n####1.6.1 nc\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001zookeeper\u306e\u5f85\u3061\u53d7\u3051\u30dd\u30fc\u30c8\u3067\u3042\u308b2181\u756a\u30dd\u30fc\u30c8\u306b\u5bfe\u3057\u3066\u3001\u300cruok(Are you OK?)\u300d\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u3059\u308b\u3002\n\u203bimok\u3068\u3044\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5e30\u3063\u3066\u304f\u308c\u3070OK\n\n~~~sh\necho ruok | nc localhost 2181\n#>imok\n~~~\n\n#2 ZooKeeper\u3092Distributed mode\u3067\u8d77\u52d5\u3059\u308b\n- *\u30ed\u30fc\u30ab\u30eb\u74b0\u5883(\u4f8b:Macbook)\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3002*\n\n###2.1 Zookeeper\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\n\u3053\u3061\u3089\u3092[\u53c2\u7167 ZooKeeper\u7ba1\u7406\u8005\u30ac\u30a4\u30c9](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperAdmin.html)\n\n####2.1.1 Zookeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(zoo.cfg)\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n~~~sh\nmkdir ~/tmp/\nscp agent-master1:/etc/zookeeper/config/zoo.cfg ~/tmp/zoo.cfg\n~~~\n\n####2.1.2 zoo.cfg\u306b\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3092\u69cb\u6210\u3059\u308b\u5168\u30b5\u30fc\u30d0\u30fc\u306e\u5834\u6240\u3092\u5165\u529b\u3059\u308b\u3002\nZooKeeper \u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3092\u69cb\u6210\u3059\u308b\u5404\u30de\u30b7\u30f3\u306f\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u5185\u306e\u307b\u304b\u306e\u3059\u3079\u3066\u306e\u30de\u30b7\u30f3\u306b\u3064\u3044\u3066\u3082\u77e5\u3063\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3092\u884c\u3046\u306e\u304c\u3001server.id=host:port:port \u3068\u3044\u3046\u5f62\u5f0f\u3067\u8a18\u8ff0\u3055\u308c\u305f\u4e00\u9023\u306e\u884c\u3067\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf host \u3068 port \u306b\u3064\u3044\u3066\u306f\u3001\u8aac\u660e\u306e\u5fc5\u8981\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u3002\u5404\u30de\u30b7\u30f3\u306b\u30b5\u30fc\u30d0\u30fc id \u3092\u5272\u308a\u5f53\u3066\u308b\u306b\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u3054\u3068\u306b 1 \u3064\u3001myid \u3068\u3044\u3046\u540d\u524d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u305d\u306e\u30b5\u30fc\u30d0\u30fc\u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u6210\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30e9\u30e1\u30fc\u30bf dataDir \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n####2.1.2.1 \u74b0\u5883\u5909\u6570\u306b\u30b5\u30fc\u30d0\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3059\u308b\u3002\n\n~~~sh\nSERVER_1=agent-master1:192.168.56.201:2888:3888\nSERVER_2=agent-master2:192.168.56.202:2888:3888\nSERVER_3=agent-master3:192.168.56.203:2888:3888\nSERVER_4=agent-cluster1:192.168.56.171:2888:3888\nSERVER_5=agent-cluster2:192.168.56.172:2888:3888\nSERVER_6=agent-cluster3:192.168.56.173:2888:3888\nSERVER_7=agent-cluster4:192.168.56.174:2888:3888\n~~~\n\n####\u5404\u30de\u30b7\u30f3\u306e/usr/local/zookeeper/conf/zoo.cfg\u306e\u8a2d\u5b9a\n####\u6ce8\u610f\uff01IP\u30a2\u30c9\u30ec\u30b9\u306e\u4ee3\u308f\u308a\u306b\u30db\u30b9\u30c8\u540d\u3092\u5165\u308c\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n~~~sh\necho \"server.1=`echo $SERVER_1 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.2=`echo $SERVER_2 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.3=`echo $SERVER_3 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.4=`echo $SERVER_4 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.5=`echo $SERVER_5 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.6=`echo $SERVER_6 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\necho \"server.7=`echo $SERVER_7 | awk -F ':' '{print $2\":\"$3\":\"$4}'`\" >> ~/tmp/zoo.cfg\n~~~\n\n#####server.x=[hostname]:nnnnn[:nnnnn], etc\n(No Java system property)\nservers making up the ZooKeeper ensemble. When the server starts up, it determines which server it is by looking for the file myid in the data directory. That file contains the server number, in ASCII, and it should match x in server.x in the left hand side of this setting.\nThe list of servers that make up ZooKeeper servers that is used by the clients must match the list of ZooKeeper servers that each ZooKeeper server has.\nThere are two port numbers nnnnn. The first followers use to connect to the leader, and the second is for leader election. The leader election port is only necessary if electionAlg is 1, 2, or 3 (default). If electionAlg is 0, then the second port is not necessary. If you want to test multiple servers on a single machine, then different ports can be used for each server.\nelectionAlg\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f3\u3067\u3059\u3002\n\n####2.1.3 zoo.cfg\u3092scp\u3067\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n~~~sh\necho \"1\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_1 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_1 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"2\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_2 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_2 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"3\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_3 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_3 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"4\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_4 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_4 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"5\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_5 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_5 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"6\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_6 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_6 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n\necho \"7\" > ~/tmp/myid; scp ~/tmp/myid `echo $SERVER_7 | awk -F ':' '{print $1}'`:/var/zookeeper/data/myid;\nscp ~/tmp/zoo.cfg `echo $SERVER_7 | awk -F ':' '{print $1}'`:/etc/zookeeper/config/zoo.cfg;\n~~~\n\n###2.2 \u30af\u30e9\u30b9\u30bf\u306e\u8d77\u52d5\n\n####2.2.1 Zookeeper\u3092\u8d77\u52d5\u3059\u308b\u3002\n#####Zookeeper\u306e\u30b3\u30de\u30f3\u30c9\u306e\u8aac\u660e\u306f[\u3053\u3061\u3089](http://blog.withsin.net/tag/zookeeper-2/page/2/)\u304c\u8a73\u3057\u3044\u3002\n---\n###*\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306a\u308bvm2\u301cvm5\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3002*\n---\n\n~~~sh\nzkServer.sh start\necho ruok | nc localhost 2181\n#>imok\n~~~\n\n####2.2.2 ZooKeeper\u72b6\u614b\u78ba\u8a8d\u65b9\u6cd5\n#####2.2.2.1 4\u6587\u5b57\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\n\u4f7f\u3044\u65b9\n\n~~~sh\necho ruok | nc localhost 2181\n#>imok\n~~~\n\n####Zookeeper\u306e\u72b6\u614b\u3092\u77e5\u308b\u305f\u3081\u306e4\u6587\u5b57\u30b3\u30de\u30f3\u30c9\u30ea\u30b9\u30c8\n\u30b3\u30de\u30f3\u30c9\u96c6\u306f[\u3053\u3061\u3089](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperAdmin.html#sc_zkCommands)\n\n|**command**|**description**|\n|-----------|---------------|\n| conf |**New in 3.3.0:** Print details about serving configuration.|\n| cons |**New in 3.3.0**: List full connection/session details for all clients connected to this server. Includes information on numbers of packets received/sent, session id, operation latencies, last operation performed, etc...|\n| crst |**New in 3.3.0**: Reset connection/session statistics for all connections.|\n| dump |Lists the outstanding sessions and ephemeral nodes. This only works on the leader.|\n| envi |Print details about serving environment|\n| **ruok** |Tests if server is running in a non-error state. The server will respond with imok if it is running. Otherwise it will not respond at all. A response of \"imok\" does not necessarily indicate that the server has joined the quorum, just that the server process is active and bound to the specified client port. Use \"stat\" for details on state wrt quorum and client connection information.|\n| srst |Reset server statistics.|\n| srvr |**New in 3.3.0:** Lists full details for the server.|\n| stat |Lists brief details for the server and connected clients.|\n| wchs |**New in 3.3.0:** Lists brief information on watches for the server.|\n| wchc |**New in 3.3.0:** Lists detailed information on watches for the server, by session. This outputs a list of sessions(connections) with associated watches (paths). Note, depending on the number of watches this operation may be expensive (ie impact server performance), use it carefully.|\n| wchp |**New in 3.3.0:** Lists detailed information on watches for the server, by path. This outputs a list of paths (znodes) with associated sessions. Note, depending on the number of watches this operation may be expensive (ie impact server performance), use it carefully.|\n\n#####2.2.2.2 zkServer.sh\u306estatus\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\nVM1\u306e\u5834\u5408\u3001Mode: leader\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n~~~sh\nzkServer.sh status\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Mode: leader\n~~~\nVM2\u301c5\u306e\u5834\u5408\u3001Mode: follower\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\n~~~sh\nzkServer.sh status\n#>JMX enabled by default\n#>Using config: /usr/local/zookeeper/bin/../conf/zoo.cfg\n#>Mode: follower\n~~~\n\n#####2.2.2.3 zkCli.sh\u3067\u540c\u671f\u3055\u308c\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\n#####2.2.2.3.1 ZooKeeper\u306e\u30b7\u30a7\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\n~~~sh\nzkCli.sh -server localhost:2181\n#Zookeeper\u306e\u30b7\u30a7\u30eb\u306b\u5165\u308b\u3002(\u4e0b\u8a18\u304c\u30b7\u30a7\u30eb\u306b\u5165\u3063\u305f\u72b6\u614b)\n[zk: localhost:2181(CONNECTED) 0]\n~~~\n\n#####2.2.2.3.2 ls\u30b3\u30de\u30f3\u30c9\u3067\u3001\u73fe\u5728\u540c\u671f\u4e2d\u306e\u30d5\u30a9\u30eb\u30c0\u3092ls\n\n~~~sh\n[zk: localhost:2181(CONNECTED) 0]ls /\n[storm, zookeeper]\n~~~\n#####2.2.2.3.3 create\u30b3\u30de\u30f3\u30c9\u3067\u3001test\u30d5\u30a9\u30eb\u30c0\u3092\u8ffd\u52a0\n\n~~~ sh\n[zk: localhost:2181(CONNECTED) 1]create /test dummy\nCreated /test\n[zk: localhost:2181(CONNECTED) 2] ls /\n[storm, test, zookeeper]\n~~~\n\n#####2.2.2.3.4 \u4ed6\u306e\u7aef\u672b(\u4f8b:VM2)\u3067\u3001\u540c\u69d8\u306bls\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3063\u3066\u307f\u308b\n\u203b\u3053\u3061\u3089\u306b\u3001test\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u540c\u671f\u6210\u529f\n\n~~~sh\n[zk: localhost:2181(CONNECTED) 0]ls /\n[storm, test, zookeeper]\n~~~\n\n#####2.2.2.3.5 \u6700\u5f8c\u306b\u3001delete\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30d5\u30a9\u30eb\u30c0\u3092\u524a\u9664(\u5f8c\u7247\u4ed8\u3051)\n\n~~~sh\n[zk: localhost:2181(CONNECTED) 0]delete /test\n~~~\n\n---\n####Zookeeper\u304c\u3046\u307e\u304f\u52d5\u3044\u3066\u3044\u306a\u3044\u5834\u5408\u306e\u78ba\u8a8d\u9805\u76ee\n---\n- SELINUX,iptables\u304c\u30aa\u30d5\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3002\n- \u6642\u523b\u304c\u3042\u3063\u3066\u3044\u308b\u304b(ntpd)\n- vm1\u4e0a\u3067\u3001/usr/local/zookeeper/conf/zoo.cfg\u306eserver.?=IP\u30a2\u30c9\u30ec\u30b9\u3068\u306a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3002(\u30db\u30b9\u30c8\u540d\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u3044\u53ef\u80fd\u6027\u6709(\u8981\u78ba\u8a8d))\n- \u30b3\u30f3\u30c6\u30ca\u306e\u5834\u5408\u3084\u3001\u8907\u6570\u306eI/F\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u3001zookeeper\u304cbind\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3042\u308b\u304b\u3069\u3046\u304b\u3002\n\n/usr/local/zookeeper/conf/zoo.cfg\n\n~~~sh\ntickTime=2000\ninitLimit=10\nsyncLimit=5\ndataDir=/usr/local/zookeeper/data\nclientPort=2181\nclientPortBindAddress=192.168.56.201\nserver.1=192.168.56.201:2888:3888\nserver.2=192.168.56.202:2888:3888\nserver.3=192.168.56.203:2888:3888\n~~~\n\n- vm2\u301c5\u4e0a\u306b\u3001/usr/local/zookeeper/data/myid\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3002(myid\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u3001server.1\u3067\u6307\u5b9a\u3057\u305f\u3002\u30ce\u30fc\u30c9\u756a\u53f7(\u4f8b:server.1\u306e\u30de\u30b7\u30f3\u306e\u5834\u5408\u30011))\n\n/usr/local/zookeeper/data/myid\n\n~~~sh\n1\n~~~\n\n---\n#\u5168\u3066\u306e\u5b9f\u884c\u30b3\u30fc\u30c9\n- \u7b2c2\u7ae0\u4ee5\u964d\u306f\u3001\u624b\u52d5\u3067\u884c\u3046\u3053\u3068\u3002(\u5225\u306eVM\u4e0a\u3067\u64cd\u4f5c\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044)\n", "tags": ["ZooKeeper", "DistributedMode", "CentOS6.x"]}