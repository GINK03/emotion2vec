{"context": "\n\n\u306f\u3058\u3081\u306b\n\u5916\u51fa\u5148\u304b\u3089\u81ea\u5b85\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bOpenVPN\u30b5\u30fc\u30d0\u30fc\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u6c17\u3065\u3044\u305f\u3089\u6b62\u307e\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u4f55\u5ea6\u304b\u3042\u3063\u305f\u305f\u3081\u3001HA\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u7a3c\u50cd\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3001Docker\u30b3\u30f3\u30c6\u30ca\u5316\u3057\u305fOpenVPN\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306fNAS\u3092\u7528\u3044\u3066\u5404\u30db\u30b9\u30c8\u9593\u3067\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\n\u3082\u3057\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u304c\u30c0\u30a6\u30f3\u3057\u305f\u969b\u306b\u306f\u3001\u81ea\u52d5\u7684\u306b\u4ed6\u306e\u30db\u30b9\u30c8\u3067Docker\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3061\u4e0a\u304c\u308b\u3053\u3068\u3067\u3001VPN\u30b5\u30fc\u30d3\u30b9\u3092\u7d99\u7d9a\u3057\u307e\u3059\u3002\n\u30eb\u30fc\u30bf\u30fc\u306e\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u8a2d\u5b9a\u306e\u8ee2\u9001\u5148\u304c\u3001IP\u3067\u3057\u304b\u6307\u5b9a\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u56fa\u5b9aIP\u3092\u5272\u308a\u5f53\u3066\u305fDocker\u30b3\u30f3\u30c6\u30ca\u30921\u4e26\u5217\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\nRaspberry pi\u4e0a\u3067\u3001Docker\u3001Consul\u3001Nomad\u3092\u4f7f\u7528\u3057\u3066\u69cb\u7bc9\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u6b21\u306e\u8981\u7d20\u304c\u7121\u99c4\u306b\u96e3\u3057\u304f\u3057\u3066\u3057\u307e\u3063\u305f\u5370\u8c61\u3067\u3059\u3002\n\nDocker\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n\n\u5197\u9577\u5316\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u5bfe\u5fdc\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068\nRaspberry pi 1\uff08\u975e\u529b\u306aARM\uff09\u3067\u69cb\u7bc9\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n\n\n\u306a\u304b\u306a\u304b\u3001\u53cd\u7701\u70b9\u304c\u591a\u3044\u5185\u5bb9\u3067\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u60f3\u5b9a\u901a\u308a\u306b\u52d5\u304f\u3082\u306e\u304c\u3067\u304d\u307e\u3057\u305f\u3057\u3001\u9762\u767d\u304b\u3063\u305f\u306e\u3067\u624b\u9806\u3092\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u74b0\u5883\n\u69cb\u7bc9\u306b\u7528\u3044\u305f\u74b0\u5883\u3067\u3059\u3002\n\nRaspberry Pi 1 Model B+ \uff1a 3\u53f0\n\n\u5404\u7a2e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u3002\n\n\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\n\nOS\nRASPBIAN JESSIE 2016-05-27\n\n\nDocker\nversion 1.13.0, build 49bf474\n\n\nConsul\nv0.7.2-rc1-rc1 (3468995)\n\n\nNomad\nv0.5.3-rc1\n\n\n\n\n\u624b\u9806\n\nRaspberry pi\n\nOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u56fa\u5b9aIP\u306e\u8a2d\u5b9a\nRaspberry pi\u306eOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u56fa\u5b9aIP\u306e\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\u3053\u3053\u306f\u300cDocker on Raspberry Pi\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068L\u30c1\u30ab\u300d\u306b\u8a18\u8f09\u306e\u624b\u9806\u3068\u540c\u69d8\u3067\u3059\u3002\n\u203b Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u305f\u3081\u3001Docker\u306f\u6b21\u306e\u624b\u9806\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\n\nNAS\u306e\u30de\u30a6\u30f3\u30c8\n\u4eca\u56de\u3001\u5404\u30db\u30b9\u30c8\u9593\u3067OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306a\u3069\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306bNAS\u3092\u7528\u3044\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3092/mnt/vpn\u306b\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3057\u305f\u3002\n$ sudo service rpcbind start\n$ sudo mkdir -p /mnt/vpn\n$ sudo mount -t nfs <NAS\u30db\u30b9\u30c8\u540d(192.168.0.2)>:/XXX /mnt/vpn\n\n\nDocker\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0fHP\u306b\u8a18\u8f09\u306e\u624b\u9806\u3067Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u53c2\u8003\uff1a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\nGPG\u30ad\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n$ sudo apt-get update  \n$ sudo apt-get install apt-transport-https ca-certificates\n$ sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n\n\u30bd\u30fc\u30b9\u30ea\u30b9\u30c8\u306bDocker\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n$ sudo vi /etc/apt/sources.list.d/docker.list\ndeb https://apt.dockerproject.org/repo raspbian-jessie main\n$ sudo apt-get update\n$ sudo apt-cache policy docker-engine\n\nDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002  \n$ sudo apt-get install docker-engine\n\nsudo\u306a\u3057\u3067docker\u304c\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u3092docker\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n$ sudo groupadd docker\n$ sudo gpasswd -a ${USER} docker\n\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002  \n$ sudo service docker start\n\n\nOpenVPN\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u30fb\u8a2d\u5b9a\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u4e3b\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u305d\u306e\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u3084\u69cb\u6210\u306fGithub\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\nDockerfile\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\u9375\u306e\u751f\u6210\u306a\u3069\u306f\u3001EasyRSA\u3092\u7528\u3044\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u7279\u306b\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\nDockerfile\nFROM resin/rpi-raspbian:jessie\n\nRUN apt-get update\nRUN apt-get install wget sed iptables openvpn\n\nWORKDIR /tmp\nRUN wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.0-rc2/EasyRSA-3.0.0-rc2.tgz\n\nRUN mkdir -p /etc/openvpn/ovpn\nADD ./template/template.ovpn /etc/openvpn/ovpn/template.ovpn\nADD ./conf/server.conf /etc/openvpn/server.conf\nRUN cp -ar /etc/openvpn /tmp/\n\nADD ./bin /usr/local/bin\nRUN chmod a+x /usr/local/bin/*\n\nRUN sed -ien \"s/.*net\\.ipv4\\.ip_forward.*$/net.ipv4.ip_forward = 1/g\" /etc/sysctl.conf\n\nEXPOSE 1194/udp\nEXPOSE 443/tcp\n\nVOLUME [\"/etc/openvpn\", \"/usr/local/EasyRSA\"]\n\nCMD [\"ovpn_run\"]\n\n\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306f\u3001server.conf\u306b\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\u30dd\u30fc\u30c8\u3084\u30d7\u30ed\u30c8\u30b3\u30eb\u3001VPN\u63a5\u7d9a\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u304c\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u3067\u3059\u3002\n\nserver.conf\nport <\u30dd\u30fc\u30c8(443)>\nproto <\u30d7\u30ed\u30c8\u30b3\u30eb(tcp)>\ndev tun\nca /etc/openvpn/ca.crt\ncert /etc/openvpn/server.crt\nkey /etc/openvpn/server.key\ndh /etc/openvpn/dh2048.pem\nserver 10.8.0.0 255.255.255.0\nifconfig-pool-persist ipp.txt\npush \"route <\u8ee2\u9001\u5148\u306e\u30a2\u30c9\u30ec\u30b9(192.168.0.0)> 255.255.255.0\"\nkeepalive 10 120\ncomp-lzo\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus /var/log/openvpn-status.log\nlog-append  /var/log/openvpn.log\nverb 3\n\n\nClient\u304c\u63a5\u7d9a\u3059\u308b\u969b\u306b\u5fc5\u8981\u306aovpn\u30d5\u30a1\u30a4\u30eb\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\n\u63a5\u7d9a\u5148\uff08\u81ea\u5b85\uff09\u30c9\u30e1\u30a4\u30f3\u304c\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u3067\u3059\u3002\u307e\u305f\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306b\u3042\u308f\u305b\u3066\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3084\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3082\u5fc5\u8981\u3067\u3059\u3002\n\ntemplate.ovpn\ndev tun\nproto <\u30d7\u30ed\u30c8\u30b3\u30eb(tcp)>\n\nremote <VPN\u63a5\u7d9a\u5148(example.com)> <\u30dd\u30fc\u30c8(443)>\n\n;http-proxy-retry\n;http-proxy [proxy server] [proxy port]\n\ncipher BF-CBC\nauth SHA1\n\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nclient\nverb 3\ncomp-lzo\n# auth-user-pass\n\n\n\u5404\u7a2e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u5f8c\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n$ docker build -t pi-openvpn:latest ./\n\n\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u3057\u305f\u306e\u3061\u3001\u751f\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u521d\u671f\u5316\u3092\u3057\u307e\u3059\u3002\u521d\u671f\u5316\u3067\u306f\u3001\u30de\u30a6\u30f3\u30c8\u3057\u305f\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\u203bRaspberry pi\u304c\u975e\u529b\u306a\u305f\u3081\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n$ docker run -v /mnt/vpn/openvpn:/etc/openvpn -v /mnt/vpn/EasyRSA:/usr/local/EasyRSA --rm -it pi-openvpn:latest ovpn_init_server\n\n\u6b21\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\u3001\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30de\u30a6\u30f3\u30c8\u3057\u305f\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n$ docker run -v /mnt/vpn/openvpn:/etc/openvpn -v /mnt/vpn/EasyRSA:/usr/local/EasyRSA --rm -it pi-openvpn:latest ovpn_add_client <\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d(client)>\n\n\u3053\u308c\u3067\u3001OpenVPN\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u3068\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nDocker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5909\u66f4\nDocker\u3067\u306f\u3001\u30d6\u30ea\u30c3\u30b8docker0\u306b\u3088\u308a\u30b3\u30f3\u30c6\u30ca\u306b\u306f172.17.0.X\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059[\u56f3\u306e\u4e0a\u5074]\u3002\u4eca\u56de\u306f\u3001\u30eb\u30fc\u30bf\u30fc\u306b\u304a\u3051\u308b\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u3092IP\u3067\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306b\u30db\u30b9\u30c8\u3068\u540c\u3058192.168.0.X\u306e\u56fa\u5b9aIP\u3092\u8a2d\u5b9a\u3057\u305f\u3044\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u65b0\u305f\u306b\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059[\u56f3\u306e\u4e0b\u5074]\u3002\n\n\u306a\u304a\u3001\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u306e\u4e2d\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u5207\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001Raspberry pi\u306b\u76f4\u63a5\u30ad\u30fc\u30dc\u30fc\u30c9\u3068\u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u3092\u63a5\u7d9a\u3057\u3066\u4f5c\u696d\u3059\u308b\u65b9\u304c\u5b89\u5168\u3067\u3059\u3002\nbridge-utils\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo apt-get update\n$ sudo apt-get install bridge-utils\n\n\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u203b \u3053\u3053\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u63a5\u7d9a\u304c\u5207\u308c\u307e\u3059\u3002\n$ docker network create --driver bridge --subnet=<\u30b5\u30d6\u30cd\u30c3\u30c8(192.168.0.0/24)> --gateway=<\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)> --opt \"com.docker.network.bridge.name\"=\"br0\" shared_nw\n\n\u30db\u30b9\u30c8\u30a2\u30c0\u30d7\u30bf\uff08eth0\uff09\u3092\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n$ ifconfig eth0 0.0.0.0 promisc up\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ brctl addif br0 eth0\n\n\u3053\u3053\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u306e\u3067\u3001\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo apt-get update\n\n\u63a5\u7d9a\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001Docker\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u4e0a\u8a18\u8a2d\u5b9a\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u30b7\u30a7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3042\u307e\u308a\u826f\u304f\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u3053\u306e\u30b7\u30a7\u30eb\u306e\u4e2d\u3067NAS\u306e\u30de\u30a6\u30f3\u30c8\u3082\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\nstartup.sh\n#!/bin/sh\n\nbr=\"br0\"\neth=\"eth0\"\n\nifconfig $eth 0.0.0.0 promisc up\nbrctl addif $br $eth\n\n/bin/echo 1 > /proc/sys/net/ipv4/ip_forward\n\nsudo service rpcbind start\nsudo mkdir -p /mnt/vpn\nsudo mount -t nfs <NAS\u30db\u30b9\u30c8\u540d(192.168.0.2)>:/XXX /mnt/vpn\n\ndocker restart $(docker ps -q)\n\nexit 0\n\n\n\nshutdown.sh\n#!/bin/sh\n\nbr=\"br0\"\neth=\"eth0\"\n\nip=<\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)>\n\nifconfig $br down\nbrctl delbr $br\n\nifconfig $eth $ip\n\nexit 0\n\n\n\u4e0a\u8a18\u30b7\u30a7\u30eb\u306b\u5b9f\u884c\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n$ chmod +x ~/startup.sh\n$ chmod +x ~/shutdown.sh\n\nDocker\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/lib/systemd/system/docker.service\n[Service]\nExecStartPost=/home/pi/startup.sh\nExecStopPost=/home/pi/shutdown.sh\n\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n$ sudo systemctl daemon-reload\n\n\u3053\u308c\u3067\u3001Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5909\u66f4\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u518d\u8d77\u52d5\u5f8c\u3001\u6b21\u306e\u3088\u3046\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3066PING\u306a\u3069\u3067\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n$ docker run -d --net shared_nw --ip 192.168.0.90 resin/rpi-raspbian:jessie sleep 50\n\n$ ping 192.168.0.90\n\n\n\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n\nConsul\nConsul\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nARM\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n$ wget https://releases.hashicorp.com/consul/0.7.2-rc1/consul_0.7.2-rc1_linux_arm.zip\n$ unzip consul_0.7.2-rc1_linux_arm.zip\n$ sudo mv ./consul /usr/local/bin/\n$ rm consul_0.7.2-rc1_linux_arm.zip\n$ sudo mkdir -p /opt/consul/data\n$ sudo chown -R $(whoami) /opt/consul\n$ sudo mkdir /etc/consul.d\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/etc/consul.d/consul.json\n{\n  \"node_name\":<node\u540d(pi001)>,\n  \"datacenter\":\"dc1\",\n  \"data_dir\":\"/opt/consul/data\",\n  \"start_join\": [ <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.10)>, <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.20)>, <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.30)> ],\n  \"server\":true,\n  \"bootstrap_expect\":<Master\u30b5\u30fc\u30d0\u30fc\u306e\u53f0\u6570(3)>,\n  \"bind_addr\": <\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)>,\n  \"log_level\":\"INFO\"\n}\n\n\n\u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ consul agent -config-dir /etc/consul.d >> /tmp/consul.log &\n\n\u69cb\u7bc9\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n$ consul members\nNode   Address           Status  Type    Build     Protocol  DC\npi001  192.168.0.10:8301  alive   server  0.7.2rc1  2         dc1\npi002  192.168.0.20:8301  alive   server  0.7.2rc1  2         dc1\npi003  192.168.0.30:8301  alive   server  0.7.2rc1  2         dc1\n\nRaspberry pi\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/systemd/system/consul.service\n[Unit]\nDescription=consul agent\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nRestart=on-failure\nExecStart=/usr/local/bin/consul agent -config-dir=/etc/consul.d\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u81ea\u52d5\u8d77\u52d5/\u7d42\u4e86\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n$ sudo systemctl daemon-reload\n$ sudo systemctl enable consul\n\n\u3053\u308c\u3067\u3001Consul\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nNomad\nNomad\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u3082\u3001ARM\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n$ wget https://releases.hashicorp.com/nomad/0.5.3-rc1/nomad_0.5.3-rc1_linux_arm.zip\n$ unzip nomad_0.5.3-rc1_linux_arm.zip\n$ sudo mv ./linux_arm/nomad /usr/local/bin/\n$ rm nomad_0.5.3-rc1_linux_arm.zip\n$ sudo mkdir -p /opt/nomad/data\n$ sudo chown -R $(whoami) /opt/nomad\n$ sudo mkdir /etc/nomad.d\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/etc/nomad.d/nomad.hcl\n# Increase log verbosity\nlog_level = \"INFO\"\nbind_addr = <\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(\"192.168.0.10\")>\ndatacenter = \"dc1\"\nname = <node\u540d(\"pi001\")>\n# Setup data dir\ndata_dir = \"/opt/nomad/data\"\n# Enable the server\nserver {\n    enabled = true\n    bootstrap_expect = <Master\u30b5\u30fc\u30d0\u30fc\u306e\u53f0\u6570(3)>\n}\n# Enable the client\nclient {\n    enabled = true\n    options = {\n      \"docker.privileged.enabled\" = \"true\"\n    }\n}\n\n\n\u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo nomad agent -config=/etc/nomad.d/nomad.hcl >> /tmp/nomad.log &\n\n\u69cb\u7bc9\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n$ nomad server-members -address http://192.168.0.10:4646/\nName          Address      Port  Status  Leader  Protocol  Build     Datacenter  Region\npi001.global  192.168.0.10  4648  alive   true    2         0.5.3rc1  dc1         global\npi002.global  192.168.0.20  4648  alive   false   2         0.5.3rc1  dc1         global\npi003.global  192.168.0.30  4648  alive   false   2         0.5.3rc1  dc1         global\n\nRaspberry pi\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/systemd/system/nomad.service\n[Unit]\nDescription=nomad agent\nRequires=consul.service\nAfter=consul.service\n\n[Service]\nRestart=on-failure\nExecStart=/usr/local/bin/nomad agent -config=/etc/nomad.d/nomad.hcl\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n\n\n\u81ea\u52d5\u8d77\u52d5/\u7d42\u4e86\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n$ sudo systemctl daemon-reload\n$ sudo systemctl enable nomad\n\n\u3053\u308c\u3067\u3001Nomad\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3068\u63a5\u7d9a\n\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\n\u5148\u307b\u3069\u307e\u3067\u306e\u624b\u9806\u3067\u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\u3042\u3068\u306f\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3067\u3059\u3002\n\u307e\u305a\u3001\u8d77\u52d5\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001OpenVPN\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.99)\u304c\u30eb\u30fc\u30bf\u30fc\u306b\u8a2d\u5b9a\u3059\u308b443\u30dd\u30fc\u30c8\u306e\u8ee2\u9001\u5148\u30a2\u30c9\u30ec\u30b9\u3067\u3059\u3002\n\n/opt/nomad/openvpn.nomad\njob \"openvpn\" {\n  datacenters = [\"dc1\"]\n  type = \"service\"\n  update {\n    stagger = \"10s\"\n    max_parallel = 1\n  }\n\n  group \"cache\" {\n    count = 1\n    restart {\n      attempts = 10\n      interval = \"5m\"\n      delay = \"25s\"\n      mode = \"delay\"\n    }\n    ephemeral_disk {\n      size = 300\n    }\n    task \"openvpn\" {\n      driver = \"docker\"\n      config {\n        image = \"pi-openvpn:latest\"\n        privileged = true\n        network_mode = \"shared_nw\"\n        volumes = [\n          \"/mnt/vpn/openvpn:/etc/openvpn\",\n          \"/mnt/vpn/EasyRSA:/usr/local/EasyRSA\"\n        ]\n        port_map {\n          https = 443\n        }\n      }\n      resources {\n        cpu    = 500 # 500 MHz\n        memory = 256 # 256MB\n        network {\n          mbits = 10\n          port \"https\" {\n            static = \"443\"\n          }\n        }\n      }\n      service {\n        name = \"global-openvpn-check\"\n        tags = [\"global\", \"cache\"]\n        port = \"https\"\n        check {\n          name     = \"alive\"\n          type     = \"tcp\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n      env {\n        \"CONTAINER_IP\" = <OpenVPN\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(\"192.168.0.99/24\")>\n        \"DEFAULT_GW\" = <OpenVPN\u30db\u30b9\u30c8\u306e\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4(\"192.168.0.1\")>\n      }\n    }\n  }\n}\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3082\u3068\u306bNomad\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ nomad run -address http://192.168.0.10:4646/ /opt/nomad/openvpn.nomad\n\n\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u52d5\u3044\u3066\u3044\u307e\u3059\u306d\u3002\n$ nomad status -address http://192.168.0.10:4646/\nID       Type     Priority  Status\nopenvpn  service  50        running\n\n\u3061\u306a\u307f\u306b\u3001\u505c\u6b62\u3059\u308b\u969b\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n$ nomad stop -address http://192.168.0.10:4646/ openvpn\n\n\u3053\u308c\u3067\u30af\u30e9\u30b9\u30bf\u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\u78ba\u8a8d\n\u8a66\u3057\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n\u5404\u7aef\u672b\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8868\u793a\u3057\u305f\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u73fe\u5728\u306f\u30db\u30b9\u30c81\u3067\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30db\u30b9\u30c81\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\na69bfb6179c1        1685a2b93253        \"/usr/bin/entry.sh...\"   2 hours ago         Up 2 hours          192.168.0.10:443->443/tcp, 192.168.0.10:443->443/udp, 1194/udp   pi-openvpn-03bcc585-333b-7d24-2be9-2485608d7548\n\n\n\n\u30db\u30b9\u30c82\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n\n\n\n\u30db\u30b9\u30c83\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n\n\n\u3053\u306e\u72b6\u614b\u3067\u30db\u30b9\u30c81\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\u3002\n\n\u30db\u30b9\u30c81\n$ sudo shutdown now\n\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u30db\u30b9\u30c82\u3067\u81ea\u52d5\u7684\u306b\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n\n\u30db\u30b9\u30c82\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\nd8aa46ff4a71        1685a2b93253        \"/usr/bin/entry.sh...\"   34 minutes ago      Up 34 minutes       192.168.0.20:443->443/tcp, 192.168.0.20:443->443/udp, 1194/udp   pi-openvpn-901b63f8-701b-6eca-098c-df1eaf8aee54\n\n\n\n\u30db\u30b9\u30c83\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u63a5\u7d9a\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3001/mnt/vpn/openvpn/ovpn/<\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d>.ovpn\u306b\u63a5\u7d9a\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n$ ls /mnt/vpn/openvpn/ovpn/\ntemplate.ovpn  <\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d>.ovpn\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7aef\u672b\u304b\u3089\u306f\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u3066\u3001VPN\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u304a\u308f\u308a\u306b\n\n\u53cd\u7701\u70b9\n\u5192\u982d\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u304c\u3001\u4e0b\u8a18\u304c\u53cd\u7701\u70b9\u3067\u3059\u3002\n\n\nDocker\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n\u30db\u30b9\u30c8\u74b0\u5883\u3092\u304d\u308c\u3044\u306b\u4fdd\u3061\u305f\u3044\u3068\u3044\u3046\u601d\u3044\u304b\u3089Docker\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8907\u96d1\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n\n\u5197\u9577\u5316\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u5bfe\u5fdc\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001Docker\u30b3\u30f3\u30c6\u30ca\u3092\u3088\u3057\u306a\u306b\u7ba1\u7406\u3067\u304d\u308b\u304b\u306a\u3068\u601d\u3044\u4f7f\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4eca\u56de\u306e\u5229\u7528\u306b\u9069\u3055\u306a\u3044\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3082\u3042\u308a\u3001\u7ba1\u7406\u30fb\u8a2d\u5b9a\u304c\u8907\u96d1\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u4eca\u56de\u306f1\u4e26\u5217\u3067\u3057\u304b\u52d5\u304b\u3055\u306a\u3044\u305f\u3081\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u306f\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\nRaspberry pi 1\uff08\u975e\u529b\u306aARM\uff09\u3067\u69cb\u7bc9\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n\u4f7f\u3048\u308b\u30c4\u30fc\u30eb\u304c\u9650\u3089\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u9078\u3076\u3046\u3048\u3067\u3001\u6b21\u306e\u70b9\u304c\u8ab2\u984c\u3067\u3057\u305f\u3002\n\nARM\u5bfe\u5fdc\uff08\u30b5\u30af\u30c3\u3068\uff09\n\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\n\n\u6b63\u3057\u304f\u306f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u6b21\u306e\u3088\u3046\u306a\u611f\u3058\u3060\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n\n\n\nARM\u5bfe\u5fdc\n\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\n\n\n\n\nSwarm\n\u25cb\n\u00d7\n\n\nKubernetes\n\u00d7\n\u25cb\n\n\nMesos\n\u00d7\n\u25cb\n\n\nNomad\n\u25cb\n\u25cb\n\n\n\nRaspberry pi\u3067\u3082\u30b5\u30af\u30c3\u3068\u3064\u304b\u3048\u3066\u3001\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u304c\u53ef\u80fd\u306aNomad\u306b\u3057\u307e\u3057\u305f\u3002\n\nDDNS\u8a2d\u5b9a\nOpenVPN\u306f\u8a18\u8f09\u3057\u305f\u624b\u9806\u3067\u52d5\u304d\u307e\u3059\u304c\u3001\u305d\u308c\u3060\u3051\u3067\u306f\u5916\u90e8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u6b21\u306e\u3069\u3061\u3089\u304b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\n\u30c0\u30a4\u30ca\u30df\u30c3\u30afDNS\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\n\n\u4eca\u56de\u306f\u30c0\u30a4\u30ca\u30df\u30c3\u30afDNS\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u3067\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u300cMyDNS\u300d\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\nOpenVPN\u74b0\u5883\u3092\u4f5c\u308b\u306b\u3042\u305f\u308a\u3001MyDNS\u306b\u5b9a\u671f\u7684\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3046Docker\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u7c21\u5358\u306a\u3082\u306e\u306a\u306e\u3067\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\u304c\u3001Github\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\n\u5916\u51fa\u5148\u304b\u3089\u81ea\u5b85\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306bOpenVPN\u30b5\u30fc\u30d0\u30fc\u3092\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u6c17\u3065\u3044\u305f\u3089\u6b62\u307e\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u4f55\u5ea6\u304b\u3042\u3063\u305f\u305f\u3081\u3001HA\u30af\u30e9\u30b9\u30bf\u69cb\u6210\u3067\u7a3c\u50cd\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\n\n\u5b8c\u6210\u30a4\u30e1\u30fc\u30b8\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\n\n![final_image.png](https://qiita-image-store.s3.amazonaws.com/0/129013/40c173f6-fd81-f041-afc7-47d711374259.png)\n\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3001Docker\u30b3\u30f3\u30c6\u30ca\u5316\u3057\u305fOpenVPN\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306fNAS\u3092\u7528\u3044\u3066\u5404\u30db\u30b9\u30c8\u9593\u3067\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u3002\n\u3082\u3057\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u304c\u30c0\u30a6\u30f3\u3057\u305f\u969b\u306b\u306f\u3001\u81ea\u52d5\u7684\u306b\u4ed6\u306e\u30db\u30b9\u30c8\u3067Docker\u30b3\u30f3\u30c6\u30ca\u304c\u7acb\u3061\u4e0a\u304c\u308b\u3053\u3068\u3067\u3001VPN\u30b5\u30fc\u30d3\u30b9\u3092\u7d99\u7d9a\u3057\u307e\u3059\u3002\n\n\u30eb\u30fc\u30bf\u30fc\u306e\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u8a2d\u5b9a\u306e\u8ee2\u9001\u5148\u304c\u3001IP\u3067\u3057\u304b\u6307\u5b9a\u3067\u304d\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u56fa\u5b9aIP\u3092\u5272\u308a\u5f53\u3066\u305fDocker\u30b3\u30f3\u30c6\u30ca\u30921\u4e26\u5217\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u3002\n\nRaspberry pi\u4e0a\u3067\u3001Docker\u3001Consul\u3001Nomad\u3092\u4f7f\u7528\u3057\u3066\u69cb\u7bc9\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u6b21\u306e\u8981\u7d20\u304c**\u7121\u99c4\u306b**\u96e3\u3057\u304f\u3057\u3066\u3057\u307e\u3063\u305f\u5370\u8c61\u3067\u3059\u3002\n\n* Docker\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u305f\u3053\u3068  \n* \u5197\u9577\u5316\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u5bfe\u5fdc\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068\n* Raspberry pi 1\uff08\u975e\u529b\u306aARM\uff09\u3067\u69cb\u7bc9\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068  \n\n\u306a\u304b\u306a\u304b\u3001\u53cd\u7701\u70b9\u304c\u591a\u3044\u5185\u5bb9\u3067\u306f\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u60f3\u5b9a\u901a\u308a\u306b\u52d5\u304f\u3082\u306e\u304c\u3067\u304d\u307e\u3057\u305f\u3057\u3001\u9762\u767d\u304b\u3063\u305f\u306e\u3067\u624b\u9806\u3092\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n# \u74b0\u5883\n\n\u69cb\u7bc9\u306b\u7528\u3044\u305f\u74b0\u5883\u3067\u3059\u3002\n\n* Raspberry Pi 1 Model B+ \uff1a 3\u53f0\n\n\u5404\u7a2e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u3002\n\n| | \u30d0\u30fc\u30b8\u30e7\u30f3 | \n|:-----------|------------:|\n| OS | RASPBIAN JESSIE 2016-05-27 |\n| Docker | version 1.13.0, build 49bf474 |\n| Consul | v0.7.2-rc1-rc1 (3468995) |\n| Nomad | v0.5.3-rc1 |\n\n# \u624b\u9806\n## Raspberry pi\n### OS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u56fa\u5b9aIP\u306e\u8a2d\u5b9a\nRaspberry pi\u306eOS\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u56fa\u5b9aIP\u306e\u8a2d\u5b9a\u3092\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\u3053\u3053\u306f\u300c[Docker on Raspberry Pi\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068L\u30c1\u30ab](http://qiita.com/ykshr/items/c78eb72e3ee75664a5fe)\u300d\u306b\u8a18\u8f09\u306e\u624b\u9806\u3068\u540c\u69d8\u3067\u3059\u3002\n\u203b Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u304c\u5909\u308f\u3063\u3066\u3044\u308b\u305f\u3081\u3001Docker\u306f\u6b21\u306e\u624b\u9806\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\n\n### NAS\u306e\u30de\u30a6\u30f3\u30c8\n\u4eca\u56de\u3001\u5404\u30db\u30b9\u30c8\u9593\u3067OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306a\u3069\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306bNAS\u3092\u7528\u3044\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3092`/mnt/vpn`\u306b\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ sudo service rpcbind start\n$ sudo mkdir -p /mnt/vpn\n$ sudo mount -t nfs <NAS\u30db\u30b9\u30c8\u540d(192.168.0.2)>:/XXX /mnt/vpn\n```\n\n## Docker\n### Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0fHP\u306b\u8a18\u8f09\u306e\u624b\u9806\u3067Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\u53c2\u8003\uff1a[\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806](https://docs.docker.com/engine/installation/linux/raspbian/)\n\nGPG\u30ad\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n\n```bash\n$ sudo apt-get update  \n$ sudo apt-get install apt-transport-https ca-certificates\n$ sudo apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D\n```\n\n\u30bd\u30fc\u30b9\u30ea\u30b9\u30c8\u306bDocker\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n\n```bash\n$ sudo vi /etc/apt/sources.list.d/docker.list\ndeb https://apt.dockerproject.org/repo raspbian-jessie main\n$ sudo apt-get update\n$ sudo apt-cache policy docker-engine\n```\n\nDocker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002  \n\n```bash\n$ sudo apt-get install docker-engine\n```\n\nsudo\u306a\u3057\u3067`docker`\u304c\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u3092docker\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002  \n\n```bash\n$ sudo groupadd docker\n$ sudo gpasswd -a ${USER} docker\n```\n\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002  \n\n```bash\n$ sudo service docker start\n```\n\n### OpenVPN\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u30fb\u8a2d\u5b9a\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u4e3b\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u305d\u306e\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u3084\u69cb\u6210\u306f[Github](https://github.com/ykshr/pi-openvpn)\u3092\u53c2\u8003\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\nDockerfile\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\u9375\u306e\u751f\u6210\u306a\u3069\u306f\u3001EasyRSA\u3092\u7528\u3044\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u7279\u306b\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n```bash:Dockerfile\nFROM resin/rpi-raspbian:jessie\n\nRUN apt-get update\nRUN apt-get install wget sed iptables openvpn\n\nWORKDIR /tmp\nRUN wget https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.0-rc2/EasyRSA-3.0.0-rc2.tgz\n\nRUN mkdir -p /etc/openvpn/ovpn\nADD ./template/template.ovpn /etc/openvpn/ovpn/template.ovpn\nADD ./conf/server.conf /etc/openvpn/server.conf\nRUN cp -ar /etc/openvpn /tmp/\n\nADD ./bin /usr/local/bin\nRUN chmod a+x /usr/local/bin/*\n\nRUN sed -ien \"s/.*net\\.ipv4\\.ip_forward.*$/net.ipv4.ip_forward = 1/g\" /etc/sysctl.conf\n\nEXPOSE 1194/udp\nEXPOSE 443/tcp\n\nVOLUME [\"/etc/openvpn\", \"/usr/local/EasyRSA\"]\n\nCMD [\"ovpn_run\"]\n```\n\nOpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306f\u3001server.conf\u306b\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\u30dd\u30fc\u30c8\u3084\u30d7\u30ed\u30c8\u30b3\u30eb\u3001VPN\u63a5\u7d9a\u5148\u306e\u30a2\u30c9\u30ec\u30b9\u306a\u3069\u304c\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u3067\u3059\u3002\n\n```bash:server.conf\nport <\u30dd\u30fc\u30c8(443)>\nproto <\u30d7\u30ed\u30c8\u30b3\u30eb(tcp)>\ndev tun\nca /etc/openvpn/ca.crt\ncert /etc/openvpn/server.crt\nkey /etc/openvpn/server.key\ndh /etc/openvpn/dh2048.pem\nserver 10.8.0.0 255.255.255.0\nifconfig-pool-persist ipp.txt\npush \"route <\u8ee2\u9001\u5148\u306e\u30a2\u30c9\u30ec\u30b9(192.168.0.0)> 255.255.255.0\"\nkeepalive 10 120\ncomp-lzo\nuser nobody\ngroup nogroup\npersist-key\npersist-tun\nstatus /var/log/openvpn-status.log\nlog-append  /var/log/openvpn.log\nverb 3\n```\n\nClient\u304c\u63a5\u7d9a\u3059\u308b\u969b\u306b\u5fc5\u8981\u306aovpn\u30d5\u30a1\u30a4\u30eb\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\n\u63a5\u7d9a\u5148\uff08\u81ea\u5b85\uff09\u30c9\u30e1\u30a4\u30f3\u304c\u5909\u66f4\u304c\u5fc5\u8981\u306a\u7b87\u6240\u3067\u3059\u3002\u307e\u305f\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u306b\u3042\u308f\u305b\u3066\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3084\u30dd\u30fc\u30c8\u306e\u5909\u66f4\u3082\u5fc5\u8981\u3067\u3059\u3002\n\n```bash:template.ovpn\ndev tun\nproto <\u30d7\u30ed\u30c8\u30b3\u30eb(tcp)>\n\nremote <VPN\u63a5\u7d9a\u5148(example.com)> <\u30dd\u30fc\u30c8(443)>\n\n;http-proxy-retry\n;http-proxy [proxy server] [proxy port]\n\ncipher BF-CBC\nauth SHA1\n\nresolv-retry infinite\nnobind\npersist-key\npersist-tun\nclient\nverb 3\ncomp-lzo\n# auth-user-pass\n```\n\n\u5404\u7a2e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u5f8c\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```bash\n$ docker build -t pi-openvpn:latest ./\n```\n\n\u30d3\u30eb\u30c9\u304c\u5b8c\u4e86\u3057\u305f\u306e\u3061\u3001\u751f\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u521d\u671f\u5316\u3092\u3057\u307e\u3059\u3002\u521d\u671f\u5316\u3067\u306f\u3001\u30de\u30a6\u30f3\u30c8\u3057\u305f\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\u203bRaspberry pi\u304c\u975e\u529b\u306a\u305f\u3081\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\n```bash\n$ docker run -v /mnt/vpn/openvpn:/etc/openvpn -v /mnt/vpn/EasyRSA:/usr/local/EasyRSA --rm -it pi-openvpn:latest ovpn_init_server\n```\n\n\u6b21\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\u3001\u5148\u307b\u3069\u3068\u540c\u69d8\u306b\u30de\u30a6\u30f3\u30c8\u3057\u305f\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n```bash\n$ docker run -v /mnt/vpn/openvpn:/etc/openvpn -v /mnt/vpn/EasyRSA:/usr/local/EasyRSA --rm -it pi-openvpn:latest ovpn_add_client <\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d(client)>\n```\n\n\u3053\u308c\u3067\u3001OpenVPN\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u3068\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5909\u66f4\n\nDocker\u3067\u306f\u3001\u30d6\u30ea\u30c3\u30b8`docker0`\u306b\u3088\u308a\u30b3\u30f3\u30c6\u30ca\u306b\u306f`172.17.0.X`\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059[\u56f3\u306e\u4e0a\u5074]\u3002\u4eca\u56de\u306f\u3001\u30eb\u30fc\u30bf\u30fc\u306b\u304a\u3051\u308b\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u3092IP\u3067\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306b\u30db\u30b9\u30c8\u3068\u540c\u3058`192.168.0.X`\u306e\u56fa\u5b9aIP\u3092\u8a2d\u5b9a\u3057\u305f\u3044\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u3001\u65b0\u305f\u306b\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059[\u56f3\u306e\u4e0b\u5074]\u3002\n\n![network.png](https://qiita-image-store.s3.amazonaws.com/0/129013/3146cbb0-80fc-8bea-121b-f843c034ae67.png)\n\n\n\u306a\u304a\u3001\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u306e\u4e2d\u3067\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u5207\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001Raspberry pi\u306b\u76f4\u63a5\u30ad\u30fc\u30dc\u30fc\u30c9\u3068\u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u3092\u63a5\u7d9a\u3057\u3066\u4f5c\u696d\u3059\u308b\u65b9\u304c\u5b89\u5168\u3067\u3059\u3002\n\nbridge-utils\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo apt-get update\n$ sudo apt-get install bridge-utils\n```\n\n\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u203b \u3053\u3053\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u63a5\u7d9a\u304c\u5207\u308c\u307e\u3059\u3002\n\n```bash\n$ docker network create --driver bridge --subnet=<\u30b5\u30d6\u30cd\u30c3\u30c8(192.168.0.0/24)> --gateway=<\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)> --opt \"com.docker.network.bridge.name\"=\"br0\" shared_nw\n```\n\n\u30db\u30b9\u30c8\u30a2\u30c0\u30d7\u30bf\uff08eth0\uff09\u3092\u30d6\u30ea\u30c3\u30b8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n```bash\n$ ifconfig eth0 0.0.0.0 promisc up\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash\n$ brctl addif br0 eth0\n```\n\n\u3053\u3053\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u306e\u3067\u3001\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo apt-get update\n```\n\n\u63a5\u7d9a\u3067\u304d\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3089\u3001Docker\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u4e0a\u8a18\u8a2d\u5b9a\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u30b7\u30a7\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3042\u307e\u308a\u826f\u304f\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u3053\u306e\u30b7\u30a7\u30eb\u306e\u4e2d\u3067NAS\u306e\u30de\u30a6\u30f3\u30c8\u3082\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash:startup.sh\n#!/bin/sh\n\nbr=\"br0\"\neth=\"eth0\"\n\nifconfig $eth 0.0.0.0 promisc up\nbrctl addif $br $eth\n\n/bin/echo 1 > /proc/sys/net/ipv4/ip_forward\n\nsudo service rpcbind start\nsudo mkdir -p /mnt/vpn\nsudo mount -t nfs <NAS\u30db\u30b9\u30c8\u540d(192.168.0.2)>:/XXX /mnt/vpn\n\ndocker restart $(docker ps -q)\n\nexit 0\n```\n\n```bash:shutdown.sh\n#!/bin/sh\n\nbr=\"br0\"\neth=\"eth0\"\n\nip=<\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)>\n\nifconfig $br down\nbrctl delbr $br\n\nifconfig $eth $ip\n\nexit 0\n```\n\n\u4e0a\u8a18\u30b7\u30a7\u30eb\u306b\u5b9f\u884c\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n```bash\n$ chmod +x ~/startup.sh\n$ chmod +x ~/shutdown.sh\n```\n\nDocker\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:/lib/systemd/system/docker.service\n[Service]\nExecStartPost=/home/pi/startup.sh\nExecStopPost=/home/pi/shutdown.sh\n```\n\n\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo systemctl daemon-reload\n```\n\n\u3053\u308c\u3067\u3001Docker\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5909\u66f4\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u518d\u8d77\u52d5\u5f8c\u3001\u6b21\u306e\u3088\u3046\u306a\u30b3\u30f3\u30c6\u30ca\u3092\u7acb\u3061\u4e0a\u3052\u3066PING\u306a\u3069\u3067\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```bash\n$ docker run -d --net shared_nw --ip 192.168.0.90 resin/rpi-raspbian:jessie sleep 50\n```\n\n```bash\n$ ping 192.168.0.90\n```\n\n## \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n### Consul\n\nConsul\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nARM\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n```bash\n$ wget https://releases.hashicorp.com/consul/0.7.2-rc1/consul_0.7.2-rc1_linux_arm.zip\n$ unzip consul_0.7.2-rc1_linux_arm.zip\n$ sudo mv ./consul /usr/local/bin/\n$ rm consul_0.7.2-rc1_linux_arm.zip\n$ sudo mkdir -p /opt/consul/data\n$ sudo chown -R $(whoami) /opt/consul\n$ sudo mkdir /etc/consul.d\n```\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:/etc/consul.d/consul.json\n{\n  \"node_name\":<node\u540d(pi001)>,\n  \"datacenter\":\"dc1\",\n  \"data_dir\":\"/opt/consul/data\",\n  \"start_join\": [ <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.10)>, <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.20)>, <Master\u30b5\u30fc\u30d0\u30fc\u306eIP(192.168.0.30)> ],\n  \"server\":true,\n  \"bootstrap_expect\":<Master\u30b5\u30fc\u30d0\u30fc\u306e\u53f0\u6570(3)>,\n  \"bind_addr\": <\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.10)>,\n  \"log_level\":\"INFO\"\n}\n```\n\n\u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ consul agent -config-dir /etc/consul.d >> /tmp/consul.log &\n```\n\n\u69cb\u7bc9\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash\n$ consul members\nNode   Address           Status  Type    Build     Protocol  DC\npi001  192.168.0.10:8301  alive   server  0.7.2rc1  2         dc1\npi002  192.168.0.20:8301  alive   server  0.7.2rc1  2         dc1\npi003  192.168.0.30:8301  alive   server  0.7.2rc1  2         dc1\n```\n\nRaspberry pi\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:/etc/systemd/system/consul.service\n[Unit]\nDescription=consul agent\nRequires=network-online.target\nAfter=network-online.target\n\n[Service]\nRestart=on-failure\nExecStart=/usr/local/bin/consul agent -config-dir=/etc/consul.d\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u81ea\u52d5\u8d77\u52d5/\u7d42\u4e86\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n```\n$ sudo systemctl daemon-reload\n$ sudo systemctl enable consul\n```\n\n\u3053\u308c\u3067\u3001Consul\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### Nomad\n\nNomad\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u3053\u3061\u3089\u3082\u3001ARM\u7528\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n```bash\n$ wget https://releases.hashicorp.com/nomad/0.5.3-rc1/nomad_0.5.3-rc1_linux_arm.zip\n$ unzip nomad_0.5.3-rc1_linux_arm.zip\n$ sudo mv ./linux_arm/nomad /usr/local/bin/\n$ rm nomad_0.5.3-rc1_linux_arm.zip\n$ sudo mkdir -p /opt/nomad/data\n$ sudo chown -R $(whoami) /opt/nomad\n$ sudo mkdir /etc/nomad.d\n```\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:/etc/nomad.d/nomad.hcl\n# Increase log verbosity\nlog_level = \"INFO\"\nbind_addr = <\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(\"192.168.0.10\")>\ndatacenter = \"dc1\"\nname = <node\u540d(\"pi001\")>\n# Setup data dir\ndata_dir = \"/opt/nomad/data\"\n# Enable the server\nserver {\n    enabled = true\n    bootstrap_expect = <Master\u30b5\u30fc\u30d0\u30fc\u306e\u53f0\u6570(3)>\n}\n# Enable the client\nclient {\n    enabled = true\n    options = {\n      \"docker.privileged.enabled\" = \"true\"\n    }\n}\n```\n\n\u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo nomad agent -config=/etc/nomad.d/nomad.hcl >> /tmp/nomad.log &\n```\n\n\u69cb\u7bc9\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u3059\u3079\u3066\u306e\u30ce\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```bash\n$ nomad server-members -address http://192.168.0.10:4646/\nName          Address      Port  Status  Leader  Protocol  Build     Datacenter  Region\npi001.global  192.168.0.10  4648  alive   true    2         0.5.3rc1  dc1         global\npi002.global  192.168.0.20  4648  alive   false   2         0.5.3rc1  dc1         global\npi003.global  192.168.0.30  4648  alive   false   2         0.5.3rc1  dc1         global\n```\n\nRaspberry pi\u306e\u8d77\u52d5/\u7d42\u4e86\u6642\u306b\u8d77\u52d5\u3055\u308c\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:/etc/systemd/system/nomad.service\n[Unit]\nDescription=nomad agent\nRequires=consul.service\nAfter=consul.service\n\n[Service]\nRestart=on-failure\nExecStart=/usr/local/bin/nomad agent -config=/etc/nomad.d/nomad.hcl\nExecReload=/bin/kill -HUP $MAINPID\nKillSignal=SIGINT\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\u81ea\u52d5\u8d77\u52d5/\u7d42\u4e86\u306e\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n```\n$ sudo systemctl daemon-reload\n$ sudo systemctl enable nomad\n```\n\n\u3053\u308c\u3067\u3001Nomad\u306e\u8a2d\u5b9a\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n## OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3068\u63a5\u7d9a\n### OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\n\n\u5148\u307b\u3069\u307e\u3067\u306e\u624b\u9806\u3067\u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\u3042\u3068\u306f\u3001OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3067\u3059\u3002\n\n\u307e\u305a\u3001\u8d77\u52d5\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001`OpenVPN\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(192.168.0.99)`\u304c\u30eb\u30fc\u30bf\u30fc\u306b\u8a2d\u5b9a\u3059\u308b443\u30dd\u30fc\u30c8\u306e\u8ee2\u9001\u5148\u30a2\u30c9\u30ec\u30b9\u3067\u3059\u3002\n\n```bash:/opt/nomad/openvpn.nomad\njob \"openvpn\" {\n  datacenters = [\"dc1\"]\n  type = \"service\"\n  update {\n    stagger = \"10s\"\n    max_parallel = 1\n  }\n\n  group \"cache\" {\n    count = 1\n    restart {\n      attempts = 10\n      interval = \"5m\"\n      delay = \"25s\"\n      mode = \"delay\"\n    }\n    ephemeral_disk {\n      size = 300\n    }\n    task \"openvpn\" {\n      driver = \"docker\"\n      config {\n        image = \"pi-openvpn:latest\"\n        privileged = true\n        network_mode = \"shared_nw\"\n        volumes = [\n          \"/mnt/vpn/openvpn:/etc/openvpn\",\n          \"/mnt/vpn/EasyRSA:/usr/local/EasyRSA\"\n        ]\n        port_map {\n          https = 443\n        }\n      }\n      resources {\n        cpu    = 500 # 500 MHz\n        memory = 256 # 256MB\n        network {\n          mbits = 10\n          port \"https\" {\n            static = \"443\"\n          }\n        }\n      }\n      service {\n        name = \"global-openvpn-check\"\n        tags = [\"global\", \"cache\"]\n        port = \"https\"\n        check {\n          name     = \"alive\"\n          type     = \"tcp\"\n          interval = \"10s\"\n          timeout  = \"2s\"\n        }\n      }\n      env {\n        \"CONTAINER_IP\" = <OpenVPN\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9(\"192.168.0.99/24\")>\n        \"DEFAULT_GW\" = <OpenVPN\u30db\u30b9\u30c8\u306e\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4(\"192.168.0.1\")>\n      }\n    }\n  }\n}\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3082\u3068\u306bNomad\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ nomad run -address http://192.168.0.10:4646/ /opt/nomad/openvpn.nomad\n```\n\n\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u52d5\u3044\u3066\u3044\u307e\u3059\u306d\u3002\n\n```bash\n$ nomad status -address http://192.168.0.10:4646/\nID       Type     Priority  Status\nopenvpn  service  50        running\n```\n\n\u3061\u306a\u307f\u306b\u3001\u505c\u6b62\u3059\u308b\u969b\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\n```bash\n$ nomad stop -address http://192.168.0.10:4646/ openvpn\n```\n\n\u3053\u308c\u3067\u30af\u30e9\u30b9\u30bf\u74b0\u5883\u306e\u69cb\u7bc9\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n### \u78ba\u8a8d\n\n\u8a66\u3057\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u3092\u843d\u3068\u3057\u3066\u307f\u307e\u3059\u3002\n\u5404\u7aef\u672b\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8868\u793a\u3057\u305f\u7d50\u679c\u306f\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u73fe\u5728\u306f`\u30db\u30b9\u30c81`\u3067\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash:\u30db\u30b9\u30c81\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\na69bfb6179c1        1685a2b93253        \"/usr/bin/entry.sh...\"   2 hours ago         Up 2 hours          192.168.0.10:443->443/tcp, 192.168.0.10:443->443/udp, 1194/udp   pi-openvpn-03bcc585-333b-7d24-2be9-2485608d7548\n```\n\n```bash:\u30db\u30b9\u30c82\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n```\n\n```bash:\u30db\u30b9\u30c83\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n```\n\n\u3053\u306e\u72b6\u614b\u3067`\u30db\u30b9\u30c81`\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u307e\u3059\u3002\n\n```bash:\u30db\u30b9\u30c81\n$ sudo shutdown now\n```\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068`\u30db\u30b9\u30c82`\u3067\u81ea\u52d5\u7684\u306b\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n\n```bash:\u30db\u30b9\u30c82\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\nd8aa46ff4a71        1685a2b93253        \"/usr/bin/entry.sh...\"   34 minutes ago      Up 34 minutes       192.168.0.20:443->443/tcp, 192.168.0.20:443->443/udp, 1194/udp   pi-openvpn-901b63f8-701b-6eca-098c-df1eaf8aee54\n```\n\n```bash:\u30db\u30b9\u30c83\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                                              NAMES\n```\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u306e\u63a5\u7d9a\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u3001`/mnt/vpn/openvpn/ovpn/<\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d>.ovpn`\u306b\u63a5\u7d9a\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u529b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ ls /mnt/vpn/openvpn/ovpn/\ntemplate.ovpn  <\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d>.ovpn\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7aef\u672b\u304b\u3089\u306f\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u3066\u3001VPN\u63a5\u7d9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u304a\u308f\u308a\u306b\n## \u53cd\u7701\u70b9\n\u5192\u982d\u306b\u8a18\u8f09\u3057\u307e\u3057\u305f\u304c\u3001\u4e0b\u8a18\u304c\u53cd\u7701\u70b9\u3067\u3059\u3002\n\n* __Docker\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u305f\u3053\u3068__  \n\u30db\u30b9\u30c8\u74b0\u5883\u3092\u304d\u308c\u3044\u306b\u4fdd\u3061\u305f\u3044\u3068\u3044\u3046\u601d\u3044\u304b\u3089Docker\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8907\u96d1\u306b\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002  \n* __\u5197\u9577\u5316\u3092\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u5bfe\u5fdc\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068__  \n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001Docker\u30b3\u30f3\u30c6\u30ca\u3092\u3088\u3057\u306a\u306b\u7ba1\u7406\u3067\u304d\u308b\u304b\u306a\u3068\u601d\u3044\u4f7f\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4eca\u56de\u306e\u5229\u7528\u306b\u9069\u3055\u306a\u3044\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3082\u3042\u308a\u3001\u7ba1\u7406\u30fb\u8a2d\u5b9a\u304c\u8907\u96d1\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u4eca\u56de\u306f1\u4e26\u5217\u3067\u3057\u304b\u52d5\u304b\u3055\u306a\u3044\u305f\u3081\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u306f\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n* __Raspberry pi 1\uff08\u975e\u529b\u306aARM\uff09\u3067\u69cb\u7bc9\u3057\u3066\u3057\u307e\u3063\u305f\u3053\u3068__  \n\u4f7f\u3048\u308b\u30c4\u30fc\u30eb\u304c\u9650\u3089\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n## \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u9078\u3076\u3046\u3048\u3067\u3001\u6b21\u306e\u70b9\u304c\u8ab2\u984c\u3067\u3057\u305f\u3002\n\n* ARM\u5bfe\u5fdc\uff08\u30b5\u30af\u30c3\u3068\uff09\n* \u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\n\n\u6b63\u3057\u304f\u306f\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u6b21\u306e\u3088\u3046\u306a\u611f\u3058\u3060\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n| | ARM\u5bfe\u5fdc | \u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a | \n|:-----------|:------------:|:------------:|\n| Swarm | \u25cb | \u00d7 |\n| Kubernetes | \u00d7 | \u25cb |\n| Mesos | \u00d7 | \u25cb |\n| Nomad | \u25cb | \u25cb |\n\nRaspberry pi\u3067\u3082\u30b5\u30af\u30c3\u3068\u3064\u304b\u3048\u3066\u3001\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u304c\u53ef\u80fd\u306a`Nomad`\u306b\u3057\u307e\u3057\u305f\u3002\n\n## DDNS\u8a2d\u5b9a\nOpenVPN\u306f\u8a18\u8f09\u3057\u305f\u624b\u9806\u3067\u52d5\u304d\u307e\u3059\u304c\u3001\u305d\u308c\u3060\u3051\u3067\u306f\u5916\u90e8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u6b21\u306e\u3069\u3061\u3089\u304b\u306e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n* \u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\n* \u30c0\u30a4\u30ca\u30df\u30c3\u30afDNS\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\n\n\u4eca\u56de\u306f`\u30c0\u30a4\u30ca\u30df\u30c3\u30afDNS\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528`\u3067\u5bfe\u5fdc\u3057\u3066\u304a\u308a\u3001\u300c[MyDNS](http://www.mydns.jp/)\u300d\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nOpenVPN\u74b0\u5883\u3092\u4f5c\u308b\u306b\u3042\u305f\u308a\u3001MyDNS\u306b\u5b9a\u671f\u7684\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001IP\u30a2\u30c9\u30ec\u30b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3046Docker\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\u7c21\u5358\u306a\u3082\u306e\u306a\u306e\u3067\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\u304c\u3001[Github](https://github.com/ykshr/pi-mydnsclient)\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n", "tags": ["RaspberryPi", "OpenVPN", "docker", "consul", "nomad"]}