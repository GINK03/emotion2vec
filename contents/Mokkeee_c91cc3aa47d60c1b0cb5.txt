{"context": " More than 1 year has passed since last update.\u4ee5\u524d\u306b\u4f5c\u3063\u305fPython\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u3092CSV\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u3002\n\n\u74b0\u5883\n\nCentOS 6.4\nPython 3.3.0\nOracle Client 11.2.0.3.0\n\u30e9\u30a4\u30d6\u30e9\u30ea\uff1a cx_Oracle\n\ncx_Oracle\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u4ee5\u4e0b\u53c2\u7167\u3002\nhttp://mokky14.hatenablog.com/entry/2014/12/17/150854\n\n\u30b9\u30af\u30ea\u30d7\u30c8\n\ntbl2csv.py\n#!/usr/bin/python3\n\nimport cx_Oracle\nimport sys\nimport csv\nfrom itertools import chain\n\nargvs = sys.argv\nargc = len(argvs)\nif argc != 2:\n  print('Usage: %s TableName' % argvs[0])\n  quit()\n\ntable_name = argvs[1].upper()\nfile_name = table_name + '_data.csv'\n\nwith cx_Oracle.connect('scott','tiger','xx.xx.xx.xx/tns_service_name') as conn:\n  # \u30c6\u30fc\u30d6\u30eb\u306e\u5217\u540d\u53d6\u5f97\n  column_name_sql = 'select column_name from user_tab_columns where table_name = :tbl'\n  cur_columns = conn.cursor()\n  cur_columns.execute(column_name_sql, tbl=table_name)\n  columns = cur_columns.fetchall()\n  cur_columns.close()\n  columns = tuple(chain.from_iterable(columns))\n\n  # \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u5168\u4ef6\u53d6\u5f97\n  data_sql = 'select * from %s' % table_name\n  cur_data = conn.cursor()\n  cur_data.execute(data_sql)\n  with open(file_name, 'w') as f:\n    csv_writer = csv.writer(f)\n    csv_writer.writerow(columns)\n    while 1:\n      rows = cur_data.fetchmany(50)\n      if len(rows) == 0:\n        break\n      csv_writer.writerows(rows)\n  cur_data.close()\n\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c950\u4ef6\u305a\u3064fetch\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u51fa\u529b\u3002\u30d5\u30a7\u30c3\u30c1\u4ef6\u6570\u304c0\u4ef6\u306b\u306a\u3063\u305f\u3089\u51e6\u7406\u7d42\u4e86\u3002\n\u30d5\u30a7\u30c3\u30c1\u30eb\u30fc\u30d7\u306e\u66f8\u304d\u65b9\u304c\u3044\u307e\u3044\u3061\u306a\u6c17\u304c\u3059\u308b\u3002\u3002\n\u4ee5\u524d\u306b\u4f5c\u3063\u305fPython\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\u6307\u5b9a\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u3092CSV\u30d5\u30a1\u30a4\u30eb\u306b\u51fa\u529b\u3059\u308b\u3002\n\n# \u74b0\u5883\n\n* CentOS 6.4\n* Python 3.3.0\n* Oracle Client 11.2.0.3.0\n* \u30e9\u30a4\u30d6\u30e9\u30ea\uff1a cx_Oracle\n\ncx_Oracle\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u4ee5\u4e0b\u53c2\u7167\u3002\n http://mokky14.hatenablog.com/entry/2014/12/17/150854\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\n\n```py3:tbl2csv.py\n#!/usr/bin/python3\n\nimport cx_Oracle\nimport sys\nimport csv\nfrom itertools import chain\n\nargvs = sys.argv\nargc = len(argvs)\nif argc != 2:\n  print('Usage: %s TableName' % argvs[0])\n  quit()\n\ntable_name = argvs[1].upper()\nfile_name = table_name + '_data.csv'\n\nwith cx_Oracle.connect('scott','tiger','xx.xx.xx.xx/tns_service_name') as conn:\n  # \u30c6\u30fc\u30d6\u30eb\u306e\u5217\u540d\u53d6\u5f97\n  column_name_sql = 'select column_name from user_tab_columns where table_name = :tbl'\n  cur_columns = conn.cursor()\n  cur_columns.execute(column_name_sql, tbl=table_name)\n  columns = cur_columns.fetchall()\n  cur_columns.close()\n  columns = tuple(chain.from_iterable(columns))\n\n  # \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u5168\u4ef6\u53d6\u5f97\n  data_sql = 'select * from %s' % table_name\n  cur_data = conn.cursor()\n  cur_data.execute(data_sql)\n  with open(file_name, 'w') as f:\n    csv_writer = csv.writer(f)\n    csv_writer.writerow(columns)\n    while 1:\n      rows = cur_data.fetchmany(50)\n      if len(rows) == 0:\n        break\n      csv_writer.writerows(rows)\n  cur_data.close()\n```\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c950\u4ef6\u305a\u3064fetch\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u51fa\u529b\u3002\u30d5\u30a7\u30c3\u30c1\u4ef6\u6570\u304c0\u4ef6\u306b\u306a\u3063\u305f\u3089\u51e6\u7406\u7d42\u4e86\u3002\n\u30d5\u30a7\u30c3\u30c1\u30eb\u30fc\u30d7\u306e\u66f8\u304d\u65b9\u304c\u3044\u307e\u3044\u3061\u306a\u6c17\u304c\u3059\u308b\u3002\u3002\n", "tags": ["oracle", "Python", "CentOS6.x"]}