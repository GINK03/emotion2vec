{"tags": ["Ruby", "Windows", "fluentd"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n0. \u524d\u66f8\u304d\nWindows\u3067\u5229\u7528\u53ef\u80fd\u306aWeb\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066IIS(Microsoft Internet Information Services)\u304c\u3042\u308a\u307e\u3059\u3002Web\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u306fApache\u304c\u5e83\u304f\u8a8d\u77e5\u3055\u308c\u5e83\u304f\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4ee5\u5916\u3068IIS\u3082\u304a\u76ee\u306b\u304b\u304b\u308b\u3082\u306e\u3067\u3059\u3002\n\u3053\u306e\u6295\u7a3f\u3067\u306f\u3001fluentd\u3092\u4f7f\u3063\u3066IIS\u306e\u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308b\u624b\u9806\u30b5\u30f3\u30d7\u30eb\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\u6700\u8fd1\u3067\u306f\u8272\u3005\u306a\u7406\u7531\u3067\u3001Windows(\u306e\u307f)\u3092\u4e2d\u5fc3\u3068\u3057\u3066\u30a4\u30f3\u30d5\u30e9\u5468\u308a\u3092\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3082\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u72b6\u6cc1\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nIIS\u306f2\u53f0\nWindows\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fMySQL\u306b\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308b\nfluentd\u3067\u30ed\u30b0\u3092\u96c6\u7d04\nfluentd\u306eWindows\u30d6\u30e9\u30f3\u30c1\u3092\u4f7f\u7528\n\u53ce\u96c6\u306e\u30d5\u30ed\u30fc\u306bLinux\u306f\u767b\u5834\u3057\u306a\u3044\nRuby\u306f1.9\u7cfb\uff0832bit\uff09\u3092\u4f7f\u7528\n\nfluentd Windows\u7248\u3067\u3000\n\u3000\"forward\u3067\u304d\u308b\u3058\u3083\u3093\uff01\" \n\u3000\"MySQL\u306b\u66f8\u3051\u308b\u3058\u3083\u3093\uff01\"\n\u7684\u306a\u3068\u3053\u308d\u304c\u30dd\u30a4\u30f3\u30c8\u3067\u3057\u3087\u3046\u304b\u3002\nMySQL\u306e\u5c0e\u5165\u3082\u89e6\u308c\u308b\u306e\u3067\u5c11\u3005\u9577\u3081\u306e\u6295\u7a3f\u3067\u3059\u3002\n\u3081\u3056\u3059\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u69d8\u306b\u306a\u308a\u307e\u3059\u3002\n\nfluentd\u306fWindows\u30d6\u30e9\u30f3\u30c1\u7248\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Windows\u3078\u306e\u5c0e\u5165\u306b\u3064\u3044\u3066 WIndows\u3067fluentd\u3092\u52d5\u304b\u3059 \u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6587\u4e2d\u3067\u3082\u540c\u6295\u7a3f\u3092\u53c2\u7167\u3057\u3066\u3044\u307e\u3059\u3002\nIIS\u306f2\u53f0\u3068\u3044\u3046\u8a2d\u5b9a\u306e\u3082\u3068\u3001\u30bf\u30b0\u540d\u306b\u30db\u30b9\u30c8\u540d\u3092\u3064\u3051\u305f\u3044\u306e\u3067\u3001config expander \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f75\u7528\u3057\u307e\u3059\u3002\nIIS\u306e\u30ed\u30b0\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304a\u3088\u3073\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306a\u3069\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3068\u3057\u307e\u3059\u3002\uff08IIS 7.5\uff09\n\nW3C\u5f62\u5f0f\n%SystemDrive%\\inetpub\\logs\\LogFiles\n\u65e5\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u65e5\u4ed8\n\n\n1. IIS\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u308bWindows\u30de\u30b7\u30f3\u306bfluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u307e\u305a\u306fIIS\u304c\u5165\u3063\u3066\u3044\u308b\u30de\u30b7\u30f3\u5074\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u6295\u7a3f\u5185\u5bb9\u3068\u540c\u7b49\u306e\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u308b\u3088\u3046\u306bfluentd\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\nWIndows\u3067fluentd\u3092\u52d5\u304b\u3059\n\u4ee5\u964d\u3001fluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u5834\u6240\u306b\u3042\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\nC:\\fluent\\fluent.conf\n\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\u3000\n\n2. fluent-plugin-config-expander\u3092\u5c0e\u5165\u3059\u308b\n\u8907\u6570\u306eIIS\u306e\u30ed\u30b0\u53ce\u96c6\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u306e\u3082\u3068\u3001fluentd\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30bf\u30b0\u306b\u30db\u30b9\u30c8\u540d\u3092\u52d5\u7684\u306b\u3064\u3051\u308b\u305f\u3081\u3001fluentd\u306econfig expander\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\ntagomoris\u3055\u3093\u8b39\u88fd\u3067\u3059\u3002\u611f\u8b1d\u3002\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30bf\u30a4\u30d7\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002\n> fluent-gem install fluent-plugin-config-expander\n\n\u7279\u306b\u554f\u984c\u306a\u304f\u5165\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5c0e\u5165\u3057\u307e\u3057\u3087\u3046\u3002\n\u3000\n\n3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\nIIS\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u2192  \u2192\u6a19\u6e96\u51fa\u529b\uff08\u4eee\uff09\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3001IIS\u306e\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u5f0f\u3068\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306f\n\nW3C\u5f62\u5f0f\n\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u65e5\u4ed8\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\n\u3067\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n#Software: Microsoft Internet Information Services 7.5\n#Version: 1.0\n#Date: 2014-06-15 00:17:32\n#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) sc-status sc-substatus sc-win32-status time-taken\n2014-06-15 00:17:32 127.0.0.1 GET / - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 1868\n2014-06-15 00:17:32 127.0.0.1 GET /welcome.png - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 1\n2014-06-15 00:19:35 127.0.0.1 GET / - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 7\n\n\u307e\u305f\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6301\u3061\u3001\u65e5\u4ed8\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u304d\u3089\u308c\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u5f8c\u308d\u304cyymmdd\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nfluentd\u306e\u8a2d\u5b9a\u3068\u3057\u3066\u3001\u307e\u305a\u3053\u3053\u3067\u306f\u3001\n\nIIS\u306e\u30ed\u30b0\u306e\u8aad\u307f\u53d6\u308a\n\u65e5\u4ed8\u30d9\u30fc\u30b9\u3067\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u540d\u3078\u306e\u5bfe\u5fdc\n\u30db\u30b9\u30c8\u540d\u3067\u306e\u52d5\u7684\u306a\u30bf\u30b0\u4ed8\u3051\n\u6a19\u6e96\u51fa\u529b\n\n\u3092\u304a\u3053\u306a\u3044\u3001MySQL\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u8ee2\u9001\u8a2d\u5b9a\u306f\u3001\u5f8c\u307b\u3069\u884c\u3044\u307e\u3059\u3002\nC:\\fluent\\fluent.conf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n<source>\n  type config_expander\n  <config>\n    type tail\n    format /^(?<time>[^ ]* [^ ]*) (?<sip>[0-9.]*) (?<csmethod>[^ ]*) (?<csuristem>[^ ]*) (?<csuriquery>[^ ]*) (?<sport>[0-9]*) (?<csusername>[^ ]*) (?<cip>[0-9.]*) (?<csua>[^ ]*) (?<scstatus>[0-9]*) (?<scsubstatus>[0-9]*) (?<scwin32status>[0-9.]*) (?<timetaken>[0-9]*)$$/\n    time_format %Y-%m-%d %H:%M:%S\n    path C:/inetpub/logs/LogFiles/W3SVC1/*\n    tag iislog.__HOSTNAME__\n    pos_file C:/temp/iislog.pos\n    reflesh_interval 1s\n  </config>\n</source>\n\n<match iislog.*>\n  type stdout\n</match>\n\n\u6b63\u898f\u8868\u73fe\u304c\u6c17\u306b\u5165\u3089\u306a\u3044\u7b49\u306f\u3001\u9069\u5f53\u306b\u624b\u76f4\u3057\u3092\u3069\u3046\u305e:)\npos_file\u3092C:\\temp\u30d5\u30a9\u30eb\u30c0\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001C:\\temp\u30d5\u30a9\u30eb\u30c0\u306f\u4e8b\u524d\u306b\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nformat\u3067\uff0a\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u306b\u3088\u308b\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u3066\u5bfe\u8c61\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u524d\u306ftail_ex\u3068\u3057\u3066\u77e5\u3089\u308c\u305f\u6a5f\u80fd\u3067\u3059\u304c\u3001\u672c\u5bb6\u306b\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\u3002Yoshihisa Tanaka\u3055\u3093\u306b\u611f\u8b1d\u3002\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u540c\u69d8\u306b\u5b9f\u65bd\u307e\u3057\u3087\u3046\u3002\n\u540c\u3058\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3044\u3051\u308b\u306f\u305a\u3067\u3059\u3002\n\u3000\n\n4. \u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308b\u5074\u306eWindows\u306bMySQL\u3092\u5c0e\u5165\u3057Ruby\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n4.1 MySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3088\u308aMySQL\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5c0e\u5165\u3057\u307e\u3059\u3002\nDownload MySQL Community Server\n5.5\u7cfb\u306e\"Windows (x86, 32-bit), MSI Installer\"\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fRuby 1.9\u7cfb\u306e32bit\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u300132bit\u7248\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u30df\u30b9\u308b\u3068\u4ee5\u964d\u306e\u74b0\u5883\u3065\u304f\u308a\u3067\u5931\u6557\u3057\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u305f\u3089\u753b\u9762\u306e\u6307\u793a\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089SQL\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u69cb\u6210\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n.\u3000\n\n4.2 Ruby\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\nfluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u4e91\u3005\u4ee5\u524d\u306bRuby\u304b\u3089MySQL\u306e\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u56f0\u308a\u307e\u3059\u3002\u3064\u307e\u308a\u306fRuby\u304b\u3089\u30b3\u30cd\u30af\u30bf\u3092\u53e9\u3051\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306eMySQL\u306e\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u3066\n\n\"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\lib\\libmysql.dll\"\n\nRuby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306ebin\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\"C:\\Ruby193\\bin\"\n\n\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6b21\u306emysql2\u306e\u5c0e\u5165\u6642\u306b\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30a8\u30f3\u30c8\u30ea\u304c\u898b\u3064\u304b\u3089\u305a\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u7279\u306b\u30a8\u30e9\u30fc\u306a\u304f\u5c0e\u5165\u304c\u7d42\u4e86\u3057\u307e\u3059\uff08\u3059\u308b\u306f\u305a\uff09\u3002\n> gem install mysql2 -- '--with-mysql-lib=\"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\lib\" --with-mysql-include=\"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\include\"'\n\nTemporarily enhancing PATH to include DevKit...\nBuilding native extensions.  This could take a while...\nSuccessfully installed mysql2-0.3.16\n1 gem installed\nInstalling ri documentation for mysql2-0.3.16...\nInstalling RDoc documentation for mysql2-0.3.16...\n\n.\u3000\n\n4.3 IIS\u30ed\u30b0\u4fdd\u5b58\u306e\u305f\u3081\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304a\u3088\u3073\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\u307e\u3042\u672c\u984c\u3067\u306f\u306a\u3044\u306e\u3067\u9069\u5f53\u306b\u3002\n\u300c3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u300d\u306e fluent.conf\u3067format\u3067\u5b9a\u7fa9\u3057\u305f\u30a8\u30f3\u30c8\u30ea\u5168\u3066\uff0b\u6642\u9593\u3068\u30bf\u30b0 \u3092\u683c\u7d0d\u3067\u304d\u308b\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u5207\u308a\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306fiislog\n\u30c6\u30fc\u30d6\u30eb\u540d\u306faccesslog\n\n\u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\u6050\u6016\u306evarchar\u30a2\u30bf\u30c3\u30af\u3002\nmysql> create table accesslog(time varchar(255),tag varchar(255),sip varchar(255),csmethod varchar(255),csuristem varchar(255),csuriquery varchar(255),sport varchar(255),csusername varchar(255),cip\u3000varchar(255),csua varchar(255),scstatus varchar(255),scsubstatus varchar(255),scwin32status varchar(255),timetaken varchar(255));\nQuery OK, 0 rows affected (0.38 sec)\n\nmysql> describe accesslog;\n+---------------+--------------+------+-----+---------+-------+\n| Field         | Type         | Null | Key | Default | Extra |\n+---------------+--------------+------+-----+---------+-------+\n| time          | varchar(255) | YES  |     | NULL    |       |\n| tag           | varchar(255) | YES  |     | NULL    |       |\n| sip           | varchar(255) | YES  |     | NULL    |       |\n| csmethod      | varchar(255) | YES  |     | NULL    |       |\n| csuristem     | varchar(255) | YES  |     | NULL    |       |\n| csuriquery    | varchar(255) | YES  |     | NULL    |       |\n| sport         | varchar(255) | YES  |     | NULL    |       |\n| csusername    | varchar(255) | YES  |     | NULL    |       |\n| cip           | varchar(255) | YES  |     | NULL    |       |\n| csua          | varchar(255) | YES  |     | NULL    |       |\n| scstatus      | varchar(255) | YES  |     | NULL    |       |\n| scsubstatus   | varchar(255) | YES  |     | NULL    |       |\n| scwin32status | varchar(255) | YES  |     | NULL    |       |\n| timetaken     | varchar(255) | YES  |     | NULL    |       |\n+---------------+--------------+------+-----+---------+-------+\n14 rows in set (0.02 sec)\n\n\u3000\n\n5. MySQL\u3092\u5c0e\u5165\u3057\u305fWindows\u30de\u30b7\u30f3\u306bfluentd\u3092\u5c0e\u5165\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u6295\u7a3f\u5185\u5bb9\u3068\u540c\u7b49\u306e\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u308b\u3088\u3046\u306bfluentd\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\nWindows\u3067fluentd\u3092\u52d5\u304b\u3059\n\u4ee5\u964d\u3001fluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u5834\u6240\u306b\u3042\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\nC:\\fluent\\fluent.conf\n\n\u3000\n\n6. fluent-plugin-mysql\u3092\u5c0e\u5165\u3059\u308b\nfluent-plungin-mysql\u306ffluentd\u304b\u3089mysql\u306b\u66f8\u304d\u8fbc\u3080\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\u518d\u3073tagomoris\u3055\u3093\u8b39\u88fd\u3002\u611f\u8b1d\u3002\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u5c0e\u5165\u3057\u307e\u3059\u3002\n> fluent-gem install fluent-plugin-mysql\n\nSuccessfully installed mysql2-cs-bind-0.0.6\nSuccessfully installed multi_json-1.10.1\nSuccessfully installed jsonpath-0.5.6\nSuccessfully installed fluent-plugin-mysql-0.0.7\n4 gems installed\nInstalling ri documentation for mysql2-cs-bind-0.0.6...\nInstalling ri documentation for multi_json-1.10.1...\nInstalling ri documentation for jsonpath-0.5.6...\nInstalling ri documentation for fluent-plugin-mysql-0.0.7...\nInstalling RDoc documentation for mysql2-cs-bind-0.0.6...\nInstalling RDoc documentation for multi_json-1.10.1...\nInstalling RDoc documentation for jsonpath-0.5.6...\nInstalling RDoc documentation for fluent-plugin-mysql-0.0.7...\n\n\u3082\u3057\u30a8\u30e9\u30fc\u304c\u3067\u305f\u5834\u5408\u3001\u8868\u793a\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u3042\u308f\u305b\u3066\u5bfe\u51e6\u3057\u307e\u3059\u3002mysql2\u306e\u5c0e\u5165\u306b\u5931\u6557\u3057\u3066\u3044\u308b\u30b1\u30fc\u30b9\u304c\u3088\u304f\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\u3000\n\n7. fluentd\u304b\u3089MySQL\u3078\u306e\u66f8\u304d\u8fbc\u307f\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3063\u3066\u8d77\u52d5\u3059\u308b\nforward\u3055\u308c\u305fIIS\u30ed\u30b0\u2192  \u2192MySQL\nC:\\fluent\\fluent.conf\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\nIn_forward\u3067\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308a\nOut_MySQL\u3067\u306e\u66f8\u304d\u8fbc\u307f\n\u6642\u9593\u3068\u30bf\u30b0\uff08config_expander\u306b\u3088\u308a\u52d5\u7684\u306b\u30db\u30b9\u30c8\u540d\u3092\u542b\u3081\u3089\u308c\u305f\u30bf\u30b0\uff09\u3082\u8a18\u9332\n\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n<source>\n  type forward\n</source>\n\n<match iislog.*>\n  type mysql\n  host 127.0.0.1\n  database iislog\n  username #your mysql user account#\n  password #your mysql user password#\n  flush_interval 1s\n\n  include_time_key yes\n  include_tag_key yes\n\n  table accesslog\n  key_names time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken\n  sql INSERT INTO accesslog (time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)\n</match>\n\n\u305d\u3057\u3066\u3053\u308c\u91cd\u8981\u3002fluentd\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u3046\u3051\u308b\u305f\u3081\u3001Windows\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u30dd\u30fc\u30c8\u756a\u53f724224\u3092\u3042\u3051\u3066\u304f\u3060\u3055\u3044\u3002 TCP,UDP \u53cc\u65b9\u306b\u3064\u3044\u3066\u958b\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\n\u5f53\u305f\u308a\u524d\u3068\u601d\u3046\u3067\u3057\u3087\uff1f\u610f\u5916\u3068\u5fd8\u308c\u3061\u3083\u3046\u3093\u3067\u3059\u3063\u3066\u3002\u3068\u308a\u3042\u3048\u305a\u304a\u8a66\u3057\u3067\u3042\u308c\u3070\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u81ea\u4f53\u3092\u30aa\u30d5\u3063\u3066\u3057\u307e\u3046\u3068\u697d\u3067\u3059\u3002\n\u3053\u3053\u307e\u3067\u5b8c\u4e86\u3057\u305f\u3089MySQL\u30de\u30b7\u30f3\u5074\u306efluentd\u306f\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\u52d5\u304b\u3057\u307e\u3057\u3087\u3046\u3002\n> fluentd -c C:/fluent/fluent.conf\n2014-06-26 21:50:57 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:50:58 +0900 [info]: is windows platform : true\n2014-06-26 21:50:58 +0900 [info]: spawn command to main (windows) : C:/Ruby193/bin/ruby.exe 'C:/Ruby193/bin/fluentd' -c C:/fluent/fluent.conf -u\n2014-06-26 21:50:58 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:50:58 +0900 [info]: is windows platform : true\n2014-06-26 21:50:58 +0900 [info]: reading config file path=\"C:/fluent/fluent.conf\"\n2014-06-26 21:50:58 +0900 [info]: gem 'fluent-plugin-config-expander' version '0.1.5'\n2014-06-26 21:50:58 +0900 [info]: gem 'fluent-plugin-mysql' version '0.0.7'\n2014-06-26 21:50:58 +0900 [info]: gem 'fluentd' version '0.10.46'\n2014-06-26 21:50:58 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    type forward\n  </source>\n  <match iislog.*>\n    type mysql\n    host 127.0.0.1\n    database iislog\n    username #your mysql user accout#\n    password #your mysql user password#\n    flush_interval 1s\n    include_time_key yes\n    include_tag_key yes\n    table accesslog\n    key_names time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken\n    sql INSERT INTO accesslog (time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)\n  </match>\n</ROOT>\n2014-06-26 21:50:58 +0900 [info]: adding source type=\"forward\"\n2014-06-26 21:50:58 +0900 [info]: adding match pattern=\"iislog.*\" type=\"mysql\"\n2014-06-26 21:50:58 +0900 [info]: listening fluent socket on 0.0.0.0:24224\n\n\u5927\u4e08\u592b\u3067\u3059\u306d\u3002\n\u3000\n\n8. IIS\u30de\u30b7\u30f3\u4e0a\u306efluentd\u306b\u3001MySQL\u30de\u30b7\u30f3\u3078\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3063\u3066\u8d77\u52d5\u3059\u308b\nIIS\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u2192  \u2192\u6a19\u6e96\u51fa\u529b\uff08\u4eee\uff09 \u2192\u30d5\u30a9\u30ef\u30fc\u30c9\n\u300c3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u300d\u3067\u8a18\u8ff0\u3057\u3057\u305ffluent.conf\u306ematch\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\n\n\u524d\n...\n<match **>\n  type stdout\n</match>\n...\n\n\n\u3092\n\n\u5f8c\n...\n<match iislog.*>\n  type forward\n  send_timeout 60s\n  recover_wait 10s\n  heartbeat_interval 1s\n  phi_threshold 16\n  hard_timeout 60s\n  flush_interval 1s\n\n  <server>\n    host #your mysql serverip# \n    port 24224\n    weight 60\n  </server>\n</match>\n...\n\n\n\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067IIS\u30de\u30b7\u30f3\u5074\u306efluentd\u8a2d\u5b9a\u3082\u5b8c\u4e86\u3067\u3059\u3002\u52d5\u304b\u3057\u307e\u3057\u3087\u3046\u3002\nServer1, Server2\u3068\u3082\u52d5\u304b\u3057\u307e\u3059\u3002\n> fluentd -c C:/fluent/fluent.conf\n2014-06-26 21:56:35 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:56:35 +0900 [info]: is windows platform : true\n2014-06-26 21:56:35 +0900 [info]: spawn command to main (windows) : C:/Ruby193/bin/ruby.exe 'C:/Ruby193/bin/fluentd' -c C:/fluent/fluent.conf -u\n2014-06-26 21:56:35 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:56:35 +0900 [info]: is windows platform : true\n2014-06-26 21:56:35 +0900 [info]: reading config file path=\"C:/fluent/fluent.conf\"\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-mixin-config-placeholders' version '0.2.4'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-plugin-config-expander' version '0.1.5'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-plugin-growthforecast' version '0.2.7'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluentd' version '0.10.46'\n2014-06-26 21:56:35 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    type config_expander\n    <config>\n      type tail\n      format /^(?<time>[^ ]* [^ ]*) (?<sip>[0-9.]*) (?<csmethod>[^ ]*) (?<csuristem>[^ ]*) (?<csuriquery>[^ ]*) (?<sport>[0-9]*) (?<csusername>[^ ]*) (?<cip>[0-9.]*) (?<csua>[^ ]*) (?<scstatus>[0-9]*) (?<scsubstatus>[0-9]*) (?<scwin32status>[0-9.]*) (?<timetaken>[0-9]*)$$/\n      time_format %Y-%m-%d %H:%M:%S\n      path C:/inetpub/logs/LogFiles/W3SVC1/*\n      tag iislog.__HOSTNAME__\n      pos_file C:/temp/iislog.pos\n      reflesh_interval 1s\n    </config>\n  </source>\n  <match iislog.*>\n    type forward\n    send_timeout 60s\n    recover_wait 10s\n    heartbeat_interval 1s\n    phi_threshold 16\n    hard_timeout 60s\n    flush_interval 1s\n    <server>\n      host #your mysql serverip#\n      port 24224\n      weight 60\n    </server>\n  </match>\n</ROOT>\n2014-06-26 21:56:35 +0900 [info]: adding source type=\"config_expander\"\n2014-06-26 21:56:35 +0900 [info]: adding match pattern=\"iislog.*\" type=\"forward\"\n2014-06-26 21:56:35 +0900 [info]: adding forwarding server '#your mysql serverip#:24224' host=\"#your mysql serverip#\" port=24224 weight=60\n2014-06-26 21:56:35 +0900 [info]: following tail of C:/inetpub/logs/LogFiles/W3SVC1/u_ex140626.log\n\n\u3000\n\n9. \u3044\u3056!\n\n\u9069\u5f53\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30de\u30b7\u30f3\u304b\u3089Server1, Server2\u306e\u30eb\u30fc\u30c8\uff08http://serverip\uff09\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3057\u3087\u3046\u3002IIS\u306e \u5fae\u5999\u306a \u521d\u671f\u30b9\u30af\u30ea\u30fc\u30f3\u304c\u3067\u307e\u3059\u306d\uff08\u4e0a\u8a18\u753b\u50cf\uff09\u3002\n\u3067\u306f\u3001MySQL\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u8997\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30d0\u30fc\u30f3\uff01\nmysql> select * from accesslog;\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n| time                 | tag                    | sip          | csmethod | csuristem    | csuriquery | sport | csusername | cip         | csua                                                                                                          | scstatus | scsubstatus | scwin32status | timetaken |\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /            | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 10        |\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /welcome.png | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 134       |\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /favicon.ico | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 404      | 0           | 2             | 56        |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /            | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 29        |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /welcome.png | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 137       |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /favicon.ico | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 404      | 0           | 2             | 61        |\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n6 rows in set (0.00 sec)\n\n\u305d\u308c\u3063\u307d\u3044\u3067\u3059\u306d\uff01\ntag\u90e8\u5206\u306b\u3082\u3061\u3083\u3093\u3068\u30db\u30b9\u30c8\u540d\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u308f\u30fc\u3044\u3002\n\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u51fa\u3057\u3084\u53ef\u8996\u5316\u3084\u3089\u5206\u6790\u3084\u3089\u306f\u304a\u597d\u307f\u3067\u3002\n\u3000\n\n10. \u6ce8\u610f\u4e8b\u9805\u304a\u3088\u3073\u305d\u306e\u4ed6\n\u8a2d\u5b9a\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306a\u3069\u306f\u74b0\u5883\u3084\u8ca0\u8377\u306b\u3042\u308f\u305b\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\u304a\u308f\u308a\n# 0. \u524d\u66f8\u304d\nWindows\u3067\u5229\u7528\u53ef\u80fd\u306aWeb\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066IIS(Microsoft Internet Information Services)\u304c\u3042\u308a\u307e\u3059\u3002Web\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u306fApache\u304c\u5e83\u304f\u8a8d\u77e5\u3055\u308c\u5e83\u304f\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4ee5\u5916\u3068IIS\u3082\u304a\u76ee\u306b\u304b\u304b\u308b\u3082\u306e\u3067\u3059\u3002\n\n\u3053\u306e\u6295\u7a3f\u3067\u306f\u3001fluentd\u3092\u4f7f\u3063\u3066IIS\u306e\u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308b\u624b\u9806\u30b5\u30f3\u30d7\u30eb\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6700\u8fd1\u3067\u306f\u8272\u3005\u306a\u7406\u7531\u3067\u3001Windows(\u306e\u307f)\u3092\u4e2d\u5fc3\u3068\u3057\u3066\u30a4\u30f3\u30d5\u30e9\u5468\u308a\u3092\u69cb\u7bc9\u3055\u308c\u3066\u3044\u308b\u30b1\u30fc\u30b9\u3082\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u72b6\u6cc1\u3092\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n* IIS\u306f2\u53f0\n* **Windows\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fMySQL\u306b\u30ed\u30b0\u3092\u4fdd\u5b58\u3059\u308b**\n* **fluentd\u3067\u30ed\u30b0\u3092\u96c6\u7d04**\n* fluentd\u306eWindows\u30d6\u30e9\u30f3\u30c1\u3092\u4f7f\u7528\n* **\u53ce\u96c6\u306e\u30d5\u30ed\u30fc\u306bLinux\u306f\u767b\u5834\u3057\u306a\u3044**\n* Ruby\u306f1.9\u7cfb\uff0832bit\uff09\u3092\u4f7f\u7528\n\nfluentd Windows\u7248\u3067\u3000\n\u3000\"forward\u3067\u304d\u308b\u3058\u3083\u3093\uff01\" \n\u3000\"MySQL\u306b\u66f8\u3051\u308b\u3058\u3083\u3093\uff01\"\n\u7684\u306a\u3068\u3053\u308d\u304c\u30dd\u30a4\u30f3\u30c8\u3067\u3057\u3087\u3046\u304b\u3002\nMySQL\u306e\u5c0e\u5165\u3082\u89e6\u308c\u308b\u306e\u3067\u5c11\u3005\u9577\u3081\u306e\u6295\u7a3f\u3067\u3059\u3002\n\n\u3081\u3056\u3059\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u69d8\u306b\u306a\u308a\u307e\u3059\u3002\n\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/b157ae00-419d-a895-3873-ec8535fbc4ed.png)\n\n\nfluentd\u306fWindows\u30d6\u30e9\u30f3\u30c1\u7248\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002Windows\u3078\u306e\u5c0e\u5165\u306b\u3064\u3044\u3066 [WIndows\u3067fluentd\u3092\u52d5\u304b\u3059](http://qiita.com/okahashi117/items/0203badd77c9df564166) \u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6587\u4e2d\u3067\u3082\u540c\u6295\u7a3f\u3092\u53c2\u7167\u3057\u3066\u3044\u307e\u3059\u3002\n\nIIS\u306f2\u53f0\u3068\u3044\u3046\u8a2d\u5b9a\u306e\u3082\u3068\u3001\u30bf\u30b0\u540d\u306b\u30db\u30b9\u30c8\u540d\u3092\u3064\u3051\u305f\u3044\u306e\u3067\u3001config expander \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f75\u7528\u3057\u307e\u3059\u3002\n\n\nIIS\u306e\u30ed\u30b0\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304a\u3088\u3073\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306a\u3069\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3068\u3057\u307e\u3059\u3002\uff08IIS 7.5\uff09\n\n* W3C\u5f62\u5f0f\n* %SystemDrive%\\inetpub\\logs\\LogFiles\n* \u65e5\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u65e5\u4ed8\n\n\n\n\n\n#1. IIS\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u308bWindows\u30de\u30b7\u30f3\u306bfluentd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/3bab61fb-f5c0-3a62-370a-190f77d1d86b.png)\n\n\u307e\u305a\u306fIIS\u304c\u5165\u3063\u3066\u3044\u308b\u30de\u30b7\u30f3\u5074\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u6295\u7a3f\u5185\u5bb9\u3068\u540c\u7b49\u306e\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u308b\u3088\u3046\u306bfluentd\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n[WIndows\u3067fluentd\u3092\u52d5\u304b\u3059]\n(http://qiita.com/okahashi117/items/0203badd77c9df564166)\n\n\u4ee5\u964d\u3001fluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u5834\u6240\u306b\u3042\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\n\n```\nC:\\fluent\\fluent.conf\n```\n\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n\u3000\n#2. fluent-plugin-config-expander\u3092\u5c0e\u5165\u3059\u308b\n\u8907\u6570\u306eIIS\u306e\u30ed\u30b0\u53ce\u96c6\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u306e\u3082\u3068\u3001fluentd\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30bf\u30b0\u306b\u30db\u30b9\u30c8\u540d\u3092\u52d5\u7684\u306b\u3064\u3051\u308b\u305f\u3081\u3001fluentd\u306econfig expander\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\n\ntagomoris\u3055\u3093\u8b39\u88fd\u3067\u3059\u3002\u611f\u8b1d\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30bf\u30a4\u30d7\u3057\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n> fluent-gem install fluent-plugin-config-expander\n```\n\n\u7279\u306b\u554f\u984c\u306a\u304f\u5165\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5c0e\u5165\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u3000\n#3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n*IIS\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u2192* ![\u30ad\u30e3\u30d7\u30c1\u30e35.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/e6f4c313-9a3d-44a3-3d16-70ceb3967b2c.png) *\u2192\u6a19\u6e96\u51fa\u529b\uff08\u4eee\uff09*\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3001IIS\u306e\u30ed\u30b0\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u5f0f\u3068\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u306f\n\n* W3C\u5f62\u5f0f\n* \u30d5\u30a1\u30a4\u30eb\u540d\u306b\u65e5\u4ed8\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\n\u3067\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n```\n#Software: Microsoft Internet Information Services 7.5\n#Version: 1.0\n#Date: 2014-06-15 00:17:32\n#Fields: date time s-ip cs-method cs-uri-stem cs-uri-query s-port cs-username c-ip cs(User-Agent) sc-status sc-substatus sc-win32-status time-taken\n2014-06-15 00:17:32 127.0.0.1 GET / - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 1868\n2014-06-15 00:17:32 127.0.0.1 GET /welcome.png - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 1\n2014-06-15 00:19:35 127.0.0.1 GET / - 80 - 127.0.0.1 Mozilla/5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 304 0 0 7\n```\n\n\u307e\u305f\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6301\u3061\u3001\u65e5\u4ed8\u6bce\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u304d\u3089\u308c\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u5f8c\u308d\u304cyymmdd\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/ad463748-30f4-85be-f265-a2e3e7c14523.png)\n\n\nfluentd\u306e\u8a2d\u5b9a\u3068\u3057\u3066\u3001\u307e\u305a\u3053\u3053\u3067\u306f\u3001\n\n* IIS\u306e\u30ed\u30b0\u306e\u8aad\u307f\u53d6\u308a\n* \u65e5\u4ed8\u30d9\u30fc\u30b9\u3067\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u540d\u3078\u306e\u5bfe\u5fdc\n* \u30db\u30b9\u30c8\u540d\u3067\u306e\u52d5\u7684\u306a\u30bf\u30b0\u4ed8\u3051\n* \u6a19\u6e96\u51fa\u529b\n\n\u3092\u304a\u3053\u306a\u3044\u3001MySQL\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u8ee2\u9001\u8a2d\u5b9a\u306f\u3001\u5f8c\u307b\u3069\u884c\u3044\u307e\u3059\u3002\nC:\\fluent\\fluent.conf\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n<source>\n  type config_expander\n  <config>\n    type tail\n    format /^(?<time>[^ ]* [^ ]*) (?<sip>[0-9.]*) (?<csmethod>[^ ]*) (?<csuristem>[^ ]*) (?<csuriquery>[^ ]*) (?<sport>[0-9]*) (?<csusername>[^ ]*) (?<cip>[0-9.]*) (?<csua>[^ ]*) (?<scstatus>[0-9]*) (?<scsubstatus>[0-9]*) (?<scwin32status>[0-9.]*) (?<timetaken>[0-9]*)$$/\n    time_format %Y-%m-%d %H:%M:%S\n    path C:/inetpub/logs/LogFiles/W3SVC1/*\n    tag iislog.__HOSTNAME__\n    pos_file C:/temp/iislog.pos\n    reflesh_interval 1s\n  </config>\n</source>\n\n<match iislog.*>\n  type stdout\n</match>\n```\n\n\u6b63\u898f\u8868\u73fe\u304c\u6c17\u306b\u5165\u3089\u306a\u3044\u7b49\u306f\u3001\u9069\u5f53\u306b\u624b\u76f4\u3057\u3092\u3069\u3046\u305e:)\npos_file\u3092C:\\temp\u30d5\u30a9\u30eb\u30c0\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001C:\\temp\u30d5\u30a9\u30eb\u30c0\u306f\u4e8b\u524d\u306b\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nformat\u3067\uff0a\u30ef\u30a4\u30eb\u30c9\u30ab\u30fc\u30c9\u306b\u3088\u308b\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5168\u3066\u5bfe\u8c61\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u524d\u306ftail_ex\u3068\u3057\u3066\u77e5\u3089\u308c\u305f\u6a5f\u80fd\u3067\u3059\u304c\u3001\u672c\u5bb6\u306b\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\u3002Yoshihisa Tanaka\u3055\u3093\u306b\u611f\u8b1d\u3002\n\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u540c\u69d8\u306b\u5b9f\u65bd\u307e\u3057\u3087\u3046\u3002\n\u540c\u3058\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3044\u3051\u308b\u306f\u305a\u3067\u3059\u3002\n\n\n\u3000\n#4. \u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308b\u5074\u306eWindows\u306bMySQL\u3092\u5c0e\u5165\u3057Ruby\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n\n\n## 4.1 MySQL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n![Mysql-256.png](https://qiita-image-store.s3.amazonaws.com/0/31816/28fee207-d1a8-f503-6479-e88b91f4da8f.png)\n\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3088\u308aMySQL\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5c0e\u5165\u3057\u307e\u3059\u3002\n\n[Download MySQL Community Server]\n(http://dev.mysql.com/downloads/mysql/5.5.html#downloads)\n\n**5.5\u7cfb\u306e\"Windows (x86, 32-bit), MSI Installer\"\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fRuby 1.9\u7cfb\u306e32bit\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u300132bit\u7248\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u3053\u308c\u3092\u30df\u30b9\u308b\u3068\u4ee5\u964d\u306e\u74b0\u5883\u3065\u304f\u308a\u3067\u5931\u6557\u3057\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044**\n\n\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u305f\u3089\u753b\u9762\u306e\u6307\u793a\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n**\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089SQL\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u69cb\u6210\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002**\n\n\n.\u3000\n## 4.2 Ruby\u304b\u3089\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b \n\n![ruby_to_mysql.png](https://qiita-image-store.s3.amazonaws.com/0/31816/4868986f-8157-4cbb-5573-8542bf334776.png)\n\nfluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u4e91\u3005\u4ee5\u524d\u306bRuby\u304b\u3089MySQL\u306e\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3068\u56f0\u308a\u307e\u3059\u3002\u3064\u307e\u308a\u306fRuby\u304b\u3089\u30b3\u30cd\u30af\u30bf\u3092\u53e9\u3051\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306eMySQL\u306e\u30d5\u30a9\u30eb\u30c0\u304b\u3089\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3057\u3066\n\n> \"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\lib\\libmysql.dll\"\n\nRuby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306ebin\u30d5\u30a9\u30eb\u30c0\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n> \"C:\\Ruby193\\bin\"\n\n\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u6b21\u306emysql2\u306e\u5c0e\u5165\u6642\u306b\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u30a8\u30f3\u30c8\u30ea\u304c\u898b\u3064\u304b\u3089\u305a\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\n\u30b3\u30d4\u30fc\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u7279\u306b\u30a8\u30e9\u30fc\u306a\u304f\u5c0e\u5165\u304c\u7d42\u4e86\u3057\u307e\u3059\uff08\u3059\u308b\u306f\u305a\uff09\u3002\n\n```\n> gem install mysql2 -- '--with-mysql-lib=\"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\lib\" --with-mysql-include=\"C:\\Program Files (x86)\\MySQL\\MySQL Server 5.5\\include\"'\n\nTemporarily enhancing PATH to include DevKit...\nBuilding native extensions.  This could take a while...\nSuccessfully installed mysql2-0.3.16\n1 gem installed\nInstalling ri documentation for mysql2-0.3.16...\nInstalling RDoc documentation for mysql2-0.3.16...\n```\n\n\n.\u3000\n## 4.3 IIS\u30ed\u30b0\u4fdd\u5b58\u306e\u305f\u3081\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304a\u3088\u3073\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n![db-table.png](https://qiita-image-store.s3.amazonaws.com/0/31816/00fbea5e-250d-f8be-b14b-a17b4e2c2fc7.png)\n\n\u307e\u3042\u672c\u984c\u3067\u306f\u306a\u3044\u306e\u3067\u9069\u5f53\u306b\u3002\n\u300c3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u300d\u306e fluent.conf\u3067format\u3067\u5b9a\u7fa9\u3057\u305f\u30a8\u30f3\u30c8\u30ea\u5168\u3066\uff0b\u6642\u9593\u3068\u30bf\u30b0 \u3092\u683c\u7d0d\u3067\u304d\u308b\u3088\u3046\u306b\u30c6\u30fc\u30d6\u30eb\u3092\u5207\u308a\u307e\u3059\u3002\n\n* \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306fiislog\n* \u30c6\u30fc\u30d6\u30eb\u540d\u306faccesslog\n\n\u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\u6050\u6016\u306evarchar\u30a2\u30bf\u30c3\u30af\u3002\n\n```\nmysql> create table accesslog(time varchar(255),tag varchar(255),sip varchar(255),csmethod varchar(255),csuristem varchar(255),csuriquery varchar(255),sport varchar(255),csusername varchar(255),cip\u3000varchar(255),csua varchar(255),scstatus varchar(255),scsubstatus varchar(255),scwin32status varchar(255),timetaken varchar(255));\nQuery OK, 0 rows affected (0.38 sec)\n\nmysql> describe accesslog;\n+---------------+--------------+------+-----+---------+-------+\n| Field         | Type         | Null | Key | Default | Extra |\n+---------------+--------------+------+-----+---------+-------+\n| time          | varchar(255) | YES  |     | NULL    |       |\n| tag           | varchar(255) | YES  |     | NULL    |       |\n| sip           | varchar(255) | YES  |     | NULL    |       |\n| csmethod      | varchar(255) | YES  |     | NULL    |       |\n| csuristem     | varchar(255) | YES  |     | NULL    |       |\n| csuriquery    | varchar(255) | YES  |     | NULL    |       |\n| sport         | varchar(255) | YES  |     | NULL    |       |\n| csusername    | varchar(255) | YES  |     | NULL    |       |\n| cip           | varchar(255) | YES  |     | NULL    |       |\n| csua          | varchar(255) | YES  |     | NULL    |       |\n| scstatus      | varchar(255) | YES  |     | NULL    |       |\n| scsubstatus   | varchar(255) | YES  |     | NULL    |       |\n| scwin32status | varchar(255) | YES  |     | NULL    |       |\n| timetaken     | varchar(255) | YES  |     | NULL    |       |\n+---------------+--------------+------+-----+---------+-------+\n14 rows in set (0.02 sec)\n```\n\n\n\n\n\u3000\n# 5. MySQL\u3092\u5c0e\u5165\u3057\u305fWindows\u30de\u30b7\u30f3\u306bfluentd\u3092\u5c0e\u5165\u3059\u308b\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/e83ae37c-c8a2-787e-2e4f-62f891937a3b.png)\n\n\u4ee5\u4e0b\u306e\u6295\u7a3f\u5185\u5bb9\u3068\u540c\u7b49\u306e\u3068\u3053\u308d\u307e\u3067\u3067\u304d\u308b\u3088\u3046\u306bfluentd\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n[Windows\u3067fluentd\u3092\u52d5\u304b\u3059]\n(http://qiita.com/okahashi117/items/0203badd77c9df564166)\n\n\u4ee5\u964d\u3001fluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u5834\u6240\u306b\u3042\u308b\u3082\u306e\u3068\u3057\u307e\u3059\u3002\n\n```\nC:\\fluent\\fluent.conf\n```\n\n\u3000\n#6. fluent-plugin-mysql\u3092\u5c0e\u5165\u3059\u308b\nfluent-plungin-mysql\u306ffluentd\u304b\u3089mysql\u306b\u66f8\u304d\u8fbc\u3080\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\u518d\u3073tagomoris\u3055\u3093\u8b39\u88fd\u3002\u611f\u8b1d\u3002\n \n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u5c0e\u5165\u3057\u307e\u3059\u3002\n\n```\n> fluent-gem install fluent-plugin-mysql\n\nSuccessfully installed mysql2-cs-bind-0.0.6\nSuccessfully installed multi_json-1.10.1\nSuccessfully installed jsonpath-0.5.6\nSuccessfully installed fluent-plugin-mysql-0.0.7\n4 gems installed\nInstalling ri documentation for mysql2-cs-bind-0.0.6...\nInstalling ri documentation for multi_json-1.10.1...\nInstalling ri documentation for jsonpath-0.5.6...\nInstalling ri documentation for fluent-plugin-mysql-0.0.7...\nInstalling RDoc documentation for mysql2-cs-bind-0.0.6...\nInstalling RDoc documentation for multi_json-1.10.1...\nInstalling RDoc documentation for jsonpath-0.5.6...\nInstalling RDoc documentation for fluent-plugin-mysql-0.0.7...\n```\n\n\u3082\u3057\u30a8\u30e9\u30fc\u304c\u3067\u305f\u5834\u5408\u3001\u8868\u793a\u3055\u308c\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u3042\u308f\u305b\u3066\u5bfe\u51e6\u3057\u307e\u3059\u3002mysql2\u306e\u5c0e\u5165\u306b\u5931\u6557\u3057\u3066\u3044\u308b\u30b1\u30fc\u30b9\u304c\u3088\u304f\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u3000\n#7. fluentd\u304b\u3089MySQL\u3078\u306e\u66f8\u304d\u8fbc\u307f\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3063\u3066\u8d77\u52d5\u3059\u308b\n*forward\u3055\u308c\u305fIIS\u30ed\u30b0\u2192* ![\u30ad\u30e3\u30d7\u30c1\u30e35.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/e6f4c313-9a3d-44a3-3d16-70ceb3967b2c.png)  *\u2192MySQL*\n\nC:\\fluent\\fluent.conf\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n* In_forward\u3067\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308a\n* Out_MySQL\u3067\u306e\u66f8\u304d\u8fbc\u307f\n* \u6642\u9593\u3068\u30bf\u30b0\uff08config_expander\u306b\u3088\u308a\u52d5\u7684\u306b\u30db\u30b9\u30c8\u540d\u3092\u542b\u3081\u3089\u308c\u305f\u30bf\u30b0\uff09\u3082\u8a18\u9332\n\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n<source>\n  type forward\n</source>\n\n<match iislog.*>\n  type mysql\n  host 127.0.0.1\n  database iislog\n  username #your mysql user account#\n  password #your mysql user password#\n  flush_interval 1s\n\n  include_time_key yes\n  include_tag_key yes\n\n  table accesslog\n  key_names time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken\n  sql INSERT INTO accesslog (time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)\n</match>\n```\n\n**\u305d\u3057\u3066\u3053\u308c\u91cd\u8981\u3002fluentd\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u3092\u3046\u3051\u308b\u305f\u3081\u3001Windows\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u30dd\u30fc\u30c8\u756a\u53f724224\u3092\u3042\u3051\u3066\u304f\u3060\u3055\u3044\u3002** TCP,UDP \u53cc\u65b9\u306b\u3064\u3044\u3066\u958b\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\n\n\u5f53\u305f\u308a\u524d\u3068\u601d\u3046\u3067\u3057\u3087\uff1f\u610f\u5916\u3068\u5fd8\u308c\u3061\u3083\u3046\u3093\u3067\u3059\u3063\u3066\u3002\u3068\u308a\u3042\u3048\u305a\u304a\u8a66\u3057\u3067\u3042\u308c\u3070\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u81ea\u4f53\u3092\u30aa\u30d5\u3063\u3066\u3057\u307e\u3046\u3068\u697d\u3067\u3059\u3002\n\n\u3053\u3053\u307e\u3067\u5b8c\u4e86\u3057\u305f\u3089MySQL\u30de\u30b7\u30f3\u5074\u306efluentd\u306f\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\u52d5\u304b\u3057\u307e\u3057\u3087\u3046\u3002\n\n```\n> fluentd -c C:/fluent/fluent.conf\n2014-06-26 21:50:57 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:50:58 +0900 [info]: is windows platform : true\n2014-06-26 21:50:58 +0900 [info]: spawn command to main (windows) : C:/Ruby193/bin/ruby.exe 'C:/Ruby193/bin/fluentd' -c C:/fluent/fluent.conf -u\n2014-06-26 21:50:58 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:50:58 +0900 [info]: is windows platform : true\n2014-06-26 21:50:58 +0900 [info]: reading config file path=\"C:/fluent/fluent.conf\"\n2014-06-26 21:50:58 +0900 [info]: gem 'fluent-plugin-config-expander' version '0.1.5'\n2014-06-26 21:50:58 +0900 [info]: gem 'fluent-plugin-mysql' version '0.0.7'\n2014-06-26 21:50:58 +0900 [info]: gem 'fluentd' version '0.10.46'\n2014-06-26 21:50:58 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    type forward\n  </source>\n  <match iislog.*>\n    type mysql\n    host 127.0.0.1\n    database iislog\n    username #your mysql user accout#\n    password #your mysql user password#\n    flush_interval 1s\n    include_time_key yes\n    include_tag_key yes\n    table accesslog\n    key_names time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken\n    sql INSERT INTO accesslog (time,tag,sip,csmethod,csuristem,csuriquery,sport,csusername,cip,csua,scstatus,scsubstatus,scwin32status,timetaken) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?)\n  </match>\n</ROOT>\n2014-06-26 21:50:58 +0900 [info]: adding source type=\"forward\"\n2014-06-26 21:50:58 +0900 [info]: adding match pattern=\"iislog.*\" type=\"mysql\"\n2014-06-26 21:50:58 +0900 [info]: listening fluent socket on 0.0.0.0:24224\n```\n\n\u5927\u4e08\u592b\u3067\u3059\u306d\u3002\n\n\u3000\n#8. IIS\u30de\u30b7\u30f3\u4e0a\u306efluentd\u306b\u3001MySQL\u30de\u30b7\u30f3\u3078\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3092\u304a\u3053\u306a\u3063\u3066\u8d77\u52d5\u3059\u308b\n\n*IIS\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u2192* ![\u30ad\u30e3\u30d7\u30c1\u30e35.PNG](https://qiita-image-store.s3.amazonaws.com/0/31816/e6f4c313-9a3d-44a3-3d16-70ceb3967b2c.png) ~~\u2192\u6a19\u6e96\u51fa\u529b\uff08\u4eee\uff09~~ *\u2192\u30d5\u30a9\u30ef\u30fc\u30c9*\n\n\u300c3. IIS\u306e\u30ed\u30b0\u3092fluentd\u3067\u8aad\u307f\u53d6\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u300d\u3067\u8a18\u8ff0\u3057\u3057\u305ffluent.conf\u306ematch\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\n\n```lang:\u524d\n...\n<match **>\n  type stdout\n</match>\n...\n```\n\n\u3092\n\n```lang:\u5f8c\n...\n<match iislog.*>\n  type forward\n  send_timeout 60s\n  recover_wait 10s\n  heartbeat_interval 1s\n  phi_threshold 16\n  hard_timeout 60s\n  flush_interval 1s\n\n  <server>\n    host #your mysql serverip# \n    port 24224\n    weight 60\n  </server>\n</match>\n...\n```\n\n\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\nServer1, Server2 \u53cc\u65b9\u3068\u3082\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n\u3053\u308c\u3067IIS\u30de\u30b7\u30f3\u5074\u306efluentd\u8a2d\u5b9a\u3082\u5b8c\u4e86\u3067\u3059\u3002\u52d5\u304b\u3057\u307e\u3057\u3087\u3046\u3002\nServer1, Server2\u3068\u3082\u52d5\u304b\u3057\u307e\u3059\u3002\n\n```\n> fluentd -c C:/fluent/fluent.conf\n2014-06-26 21:56:35 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:56:35 +0900 [info]: is windows platform : true\n2014-06-26 21:56:35 +0900 [info]: spawn command to main (windows) : C:/Ruby193/bin/ruby.exe 'C:/Ruby193/bin/fluentd' -c C:/fluent/fluent.conf -u\n2014-06-26 21:56:35 +0900 [info]: starting fluentd-0.10.46\n2014-06-26 21:56:35 +0900 [info]: is windows platform : true\n2014-06-26 21:56:35 +0900 [info]: reading config file path=\"C:/fluent/fluent.conf\"\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-mixin-config-placeholders' version '0.2.4'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-plugin-config-expander' version '0.1.5'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluent-plugin-growthforecast' version '0.2.7'\n2014-06-26 21:56:35 +0900 [info]: gem 'fluentd' version '0.10.46'\n2014-06-26 21:56:35 +0900 [info]: using configuration file: <ROOT>\n  <source>\n    type config_expander\n    <config>\n      type tail\n      format /^(?<time>[^ ]* [^ ]*) (?<sip>[0-9.]*) (?<csmethod>[^ ]*) (?<csuristem>[^ ]*) (?<csuriquery>[^ ]*) (?<sport>[0-9]*) (?<csusername>[^ ]*) (?<cip>[0-9.]*) (?<csua>[^ ]*) (?<scstatus>[0-9]*) (?<scsubstatus>[0-9]*) (?<scwin32status>[0-9.]*) (?<timetaken>[0-9]*)$$/\n      time_format %Y-%m-%d %H:%M:%S\n      path C:/inetpub/logs/LogFiles/W3SVC1/*\n      tag iislog.__HOSTNAME__\n      pos_file C:/temp/iislog.pos\n      reflesh_interval 1s\n    </config>\n  </source>\n  <match iislog.*>\n    type forward\n    send_timeout 60s\n    recover_wait 10s\n    heartbeat_interval 1s\n    phi_threshold 16\n    hard_timeout 60s\n    flush_interval 1s\n    <server>\n      host #your mysql serverip#\n      port 24224\n      weight 60\n    </server>\n  </match>\n</ROOT>\n2014-06-26 21:56:35 +0900 [info]: adding source type=\"config_expander\"\n2014-06-26 21:56:35 +0900 [info]: adding match pattern=\"iislog.*\" type=\"forward\"\n2014-06-26 21:56:35 +0900 [info]: adding forwarding server '#your mysql serverip#:24224' host=\"#your mysql serverip#\" port=24224 weight=60\n2014-06-26 21:56:35 +0900 [info]: following tail of C:/inetpub/logs/LogFiles/W3SVC1/u_ex140626.log\n```\n\n\n\n\u3000\n#9. \u3044\u3056!\n\n![iis7top.png](https://qiita-image-store.s3.amazonaws.com/0/31816/cd958d35-b933-3ba9-7294-1fc59cab2a58.png)\n\n\u9069\u5f53\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30de\u30b7\u30f3\u304b\u3089Server1, Server2\u306e\u30eb\u30fc\u30c8\uff08http://serverip\uff09\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3057\u3087\u3046\u3002IIS\u306e ~~\u5fae\u5999\u306a~~ \u521d\u671f\u30b9\u30af\u30ea\u30fc\u30f3\u304c\u3067\u307e\u3059\u306d\uff08\u4e0a\u8a18\u753b\u50cf\uff09\u3002\n\n\u3067\u306f\u3001MySQL\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u8997\u3044\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30d0\u30fc\u30f3\uff01\n\n```\nmysql> select * from accesslog;\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n| time                 | tag                    | sip          | csmethod | csuristem    | csuriquery | sport | csusername | cip         | csua                                                                                                          | scstatus | scsubstatus | scwin32status | timetaken |\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /            | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 10        |\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /welcome.png | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 134       |\n| 2014-06-26T04:15:22Z | iislog.WIN-SQB8A3LI55M | xxx.xx.x.x   | GET      | /favicon.ico | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 404      | 0           | 2             | 56        |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /            | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 29        |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /welcome.png | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 200      | 0           | 0             | 137       |\n| 2014-06-26T04:15:43Z | iislog.WIN-JNJ9JSKTQUU | yyy.yy.y.yyy | GET      | /favicon.ico | -          | 80    | -          | ccc.c.ccc.c | Mozilla/5.0+(Windows+NT+6.3;+WOW64)+AppleWebKit/537.36+(KHTML,+like+Gecko)+Chrome/35.0.1916.153+Safari/537.36 | 404      | 0           | 2             | 61        |\n+----------------------+------------------------+--------------+----------+--------------+------------+-------+------------+-------------+---------------------------------------------------------------------------------------------------------------+----------+-------------+---------------+-----------+\n6 rows in set (0.00 sec)\n```\n\n\u305d\u308c\u3063\u307d\u3044\u3067\u3059\u306d\uff01\ntag\u90e8\u5206\u306b\u3082\u3061\u3083\u3093\u3068\u30db\u30b9\u30c8\u540d\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\u308f\u30fc\u3044\u3002\n\n\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u51fa\u3057\u3084\u53ef\u8996\u5316\u3084\u3089\u5206\u6790\u3084\u3089\u306f\u304a\u597d\u307f\u3067\u3002\n\n\u3000\n#10. \u6ce8\u610f\u4e8b\u9805\u304a\u3088\u3073\u305d\u306e\u4ed6\n\u8a2d\u5b9a\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306a\u3069\u306f\u74b0\u5883\u3084\u8ca0\u8377\u306b\u3042\u308f\u305b\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u304a\u308f\u308a\n"}