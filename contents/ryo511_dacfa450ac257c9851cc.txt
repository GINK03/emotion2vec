{"tags": ["Symfony", "Doctrine2", "MongoDB", "PHP", "PHP7"], "context": "Symfony Advent Calendar 2016 8\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nSymfony\u3067MongoDB\u3092\u6271\u3046\u5834\u5408\u3001Doctrine ODM(Object Document Mapper)\u3092\u4f7f\u3046\u3068\u3001ORM\u3068\u540c\u69d8\u306eAPI\u3067MongoDB\u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u5fc5\u8981\u306a\u3082\u306e\n\nMongoDB\nPHP5\u7cfb+ext-mongo \u307e\u305f\u306f PHP7\u7cfb+ext-mongodb\n\n\n$ mongo --version\nMongoDB shell version v3.4.0\n\n$ php -v\nPHP 7.1.0 (cli) (built: Dec  2 2016 11:32:42) ( NTS )\n\n$ php -m | grep mongo\nmongodb\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nDoctrine ODM\u306f\u5358\u72ec\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u3082\u4f7f\u3048\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306fDoctrineMongoDBBundle\u3092\u4f7f\u3063\u3066\u3001Symfony\u3068\u4e00\u7dd2\u306b\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\nSymfony\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u4e0b\u306fSymfony\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3092\u4f7f\u3063\u305f\u4f8b\u3067\u3059\u3002\n$ symfony new doctrine_odm\n$ cd doctrine_odm\n$ php bin/console --version\nSymfony 3.2.0 (kernel: app, env: dev, debug: true)\n\n\u6b21\u306bDoctrineMongoDBBundle\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nPHP5\u306e\u5834\u5408\u3068PHP7\u306e\u5834\u5408\u3067\u624b\u9806\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\nPHP5\u306e\u5834\u5408\ncomposer.json\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n{\n    \"require\": {\n        \"doctrine/mongodb-odm\": \"^1.1\",\n        \"doctrine/mongodb-odm-bundle\": \"^3.2\"\n    }\n}\n\n\u6b21\u306b\u3001composer update\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nPHP7\u306e\u5834\u5408\ncomposer.json\u306b\u4ee5\u4e0b\u306e3\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n{\n    \"require\": {\n        \"alcaeus/mongo-php-adapter\": \"^1.0\",\n        \"doctrine/mongodb-odm\": \"^1.1\",\n        \"doctrine/mongodb-odm-bundle\": \"^3.2\"\n    }\n}\n\nMongoDB\u306e\u30c9\u30e9\u30a4\u30d0\u306f\u3001PHP5\u3068PHP7\u3067\u7570\u306a\u308a\u307e\u3059\u3002\nPHP5\u306eext-mongo\u306f\u3001PHP7\u3067\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002\n\u9006\u306b\u3001PHP7\u306eext-mongodb\u3082PHP5\u3067\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\nalcaeus/mongo-php-adapter\u306f\u3001PHP7\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3092PHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3068\u540c\u69d8\u306eAPI\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u30a2\u30c0\u30d7\u30bf\u3067\u3059\u3002\nDoctrine ODM\u306fPHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001PHP7+Doctrine ODM\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u4f7f\u3046\u306b\u306f\u3001\u3053\u306e\u30a2\u30c0\u30d7\u30bf\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u672c\u30a2\u30c0\u30d7\u30bf\u306e\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u5b9f\u88c5\u306b\u6bd4\u3079\u3066\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059(GitHub Issues)\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306fcomposer update\u3000--ignore-platform-reqs\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n--ignore-platform-reqs\u306f\u3001PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084PHP\u62e1\u5f35\u7b49\u306e\u4f9d\u5b58\u95a2\u4fc2\u30c1\u30a7\u30c3\u30af\u3092\u7121\u8996\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3002\ndoctrine/mongodb\u306ecomposer.json\u306b\u306fext-mongo(PHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0)\u304c\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3048\u306a\u3044PHP7\u3067\u306f\u3001\u4e0a\u8a18\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nSymfony\u306e\u8a2d\u5b9a\n\n\u30aa\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u8a2d\u5b9a\n// app/autoload.php\nuse Doctrine\\ODM\\MongoDB\\Mapping\\Driver\\AnnotationDriver;\nAnnotationDriver::registerAnnotationClasses();\n\n\nAppKernel\u306b\u767b\u9332\n// app/AppKernel.php\npublic function registerBundles()\n{\n    $bundles = [\n        // ...\n        new Doctrine\\Bundle\\MongoDBBundle\\DoctrineMongoDBBundle(),\n    ];\n\n    // ...\n}\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n# app/config/parameters.yml\nparameters:\n    mongodb_server: \"mongodb://localhost:27017\"\n\n# app/config/config.yml\ndoctrine_mongodb:\n    connections:\n        default:\n            server: \"%mongodb_server%\"\n            options: {}\n    default_database: test_database\n    document_managers:\n        default:\n            auto_mapping: true\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30af\u30e9\u30b9\u306e\u8ffd\u52a0\n$ mkdir src/AppBundle/Document\n$ touch src/AppBundle/Document/Product.php\n\nProduct.php\u306e\u4e2d\u8eab\u306f\u4ee5\u4e0b\u3002Doctrine ORM\u3068\u540c\u69d8\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n<?php\n\n// src/AppBundle/Document/Product.php\nnamespace AppBundle\\Document;\n\nuse Doctrine\\ODM\\MongoDB\\Mapping\\Annotations as MongoDB;\n\n/**\n * @MongoDB\\Document\n */\nclass Product\n{\n    /**\n     * @MongoDB\\Id\n     */\n    protected $id;\n\n    /**\n     * @MongoDB\\Field(type=\"string\")\n     */\n    protected $name;\n\n    /**\n     * @MongoDB\\Field(type=\"float\")\n     */\n    protected $price;\n}\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067getter/setter\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u8fba\u3082ORM\u3068\u540c\u3058\u3067\u3059\u306d\u3002\n$ php bin/console doctrine:mongodb:generate:documents AppBundle\n\n\n\u5b9f\u884c\u30c6\u30b9\u30c8\nsrc/AppBundle/Command/MongoDBTestCommand.php \u306b\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n<?php\n\nnamespace AppBundle\\Command;\n\nuse AppBundle\\Document\\Product;\nuse Symfony\\Bundle\\FrameworkBundle\\Command\\ContainerAwareCommand;\nuse Symfony\\Component\\Console\\Input\\InputArgument;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Input\\InputOption;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\nclass MongoDBTestCommand extends ContainerAwareCommand\n{\n    protected function configure()\n    {\n        $this\n            ->setName('app:mongo-test')\n            ->setDescription('...')\n            ->addArgument('argument', InputArgument::OPTIONAL, 'Argument description')\n            ->addOption('option', null, InputOption::VALUE_NONE, 'Option description')\n        ;\n    }\n\n    protected function execute(InputInterface $input, OutputInterface $output)\n    {\n        // \u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\n        $product = new Product();\n        $product->setName('Foobar');\n        $product->setPrice(19.99);\n\n        $dm = $this->getContainer()->get('doctrine_mongodb')->getManager();\n        $dm->persist($product);\n        $dm->flush();\n\n        // \u30c7\u30fc\u30bf\u53d6\u5f97\n        $product = $dm->getRepository('AppBundle:Product')\n            ->findOneBy(['name' => 'Foobar']);\n\n        if (!$product) {\n            $output->writeln('Product not found');\n        }\n\n        var_dump($product->getName(), $product->getPrice());\n    }\n}\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n$ php bin/console app:mongo-test\n\nMongoDB\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3082\u7d50\u679c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n$ mongo test_database\n> db.Product.find();\n{ \"_id\" : ObjectId(\"584559656adfe57b63216d51\"), \"name\" : \"Foobar\", \"price\" : 19.99 }\n\n\u4e0a\u8a18\u624b\u9806\u3067\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306fGitHub\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n\u4ee5\u4e0a\u3001Doctrine ODM\u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3067\u3059\u3002\u57fa\u672c\u7684\u306aAPI\u306fORM\u3068\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001MongoDB\u72ec\u7279\u306eAPI\u3092\u6271\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a73\u7d30\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[Symfony Advent Calendar 2016](http://qiita.com/advent-calendar/2016/symfony) 8\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n---\n\nSymfony\u3067MongoDB\u3092\u6271\u3046\u5834\u5408\u3001Doctrine ODM(Object Document Mapper)\u3092\u4f7f\u3046\u3068\u3001ORM\u3068\u540c\u69d8\u306eAPI\u3067MongoDB\u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n## \u5fc5\u8981\u306a\u3082\u306e\n\n- MongoDB\n- PHP5\u7cfb+[ext-mongo](http://php.net/manual/ja/book.mongo.php) \u307e\u305f\u306f PHP7\u7cfb+[ext-mongodb](http://php.net/manual/ja/class.mongodb.php)\n\n```\n$ mongo --version\nMongoDB shell version v3.4.0\n\n$ php -v\nPHP 7.1.0 (cli) (built: Dec  2 2016 11:32:42) ( NTS )\n\n$ php -m | grep mongo\nmongodb\n```\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nDoctrine ODM\u306f\u5358\u72ec\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u3082\u4f7f\u3048\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f[DoctrineMongoDBBundle](http://symfony.com/doc/current/bundles/DoctrineMongoDBBundle/index.html)\u3092\u4f7f\u3063\u3066\u3001Symfony\u3068\u4e00\u7dd2\u306b\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\nSymfony\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u516c\u5f0f\u30b5\u30a4\u30c8](https://symfony.com/doc/current/setup.html)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u4e0b\u306fSymfony\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3092\u4f7f\u3063\u305f\u4f8b\u3067\u3059\u3002\n\n```\n$ symfony new doctrine_odm\n$ cd doctrine_odm\n$ php bin/console --version\nSymfony 3.2.0 (kernel: app, env: dev, debug: true)\n```\n\n\u6b21\u306bDoctrineMongoDBBundle\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nPHP5\u306e\u5834\u5408\u3068PHP7\u306e\u5834\u5408\u3067\u624b\u9806\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n\n### PHP5\u306e\u5834\u5408\n\ncomposer.json\u306b\u4ee5\u4e0b\u306e2\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n{\n    \"require\": {\n        \"doctrine/mongodb-odm\": \"^1.1\",\n        \"doctrine/mongodb-odm-bundle\": \"^3.2\"\n    }\n}\n```\n\n\u6b21\u306b\u3001`composer update`\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n### PHP7\u306e\u5834\u5408\n\ncomposer.json\u306b\u4ee5\u4e0b\u306e3\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n{\n    \"require\": {\n        \"alcaeus/mongo-php-adapter\": \"^1.0\",\n        \"doctrine/mongodb-odm\": \"^1.1\",\n        \"doctrine/mongodb-odm-bundle\": \"^3.2\"\n    }\n}\n```\n\nMongoDB\u306e\u30c9\u30e9\u30a4\u30d0\u306f\u3001PHP5\u3068PHP7\u3067\u7570\u306a\u308a\u307e\u3059\u3002\nPHP5\u306e[ext-mongo](http://php.net/manual/ja/book.mongo.php)\u306f\u3001PHP7\u3067\u306f\u52d5\u4f5c\u3057\u307e\u305b\u3093\u3002\n\u9006\u306b\u3001PHP7\u306e[ext-mongodb](http://php.net/manual/ja/class.mongodb.php)\u3082PHP5\u3067\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\n\n[alcaeus/mongo-php-adapter](https://github.com/alcaeus/mongo-php-adapter)\u306f\u3001PHP7\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3092PHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3068\u540c\u69d8\u306eAPI\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u30a2\u30c0\u30d7\u30bf\u3067\u3059\u3002\nDoctrine ODM\u306fPHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001PHP7+Doctrine ODM\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u4f7f\u3046\u306b\u306f\u3001\u3053\u306e\u30a2\u30c0\u30d7\u30bf\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u672c\u30a2\u30c0\u30d7\u30bf\u306e\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u5b9f\u88c5\u306b\u6bd4\u3079\u3066\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u3044\u3068\u3044\u3046\u554f\u984c\u304c\u6307\u6458\u3055\u308c\u3066\u3044\u307e\u3059([GitHub Issues](https://github.com/alcaeus/mongo-php-adapter/issues/124))\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f`composer update\u3000--ignore-platform-reqs`\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n`--ignore-platform-reqs`\u306f\u3001PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3084PHP\u62e1\u5f35\u7b49\u306e\u4f9d\u5b58\u95a2\u4fc2\u30c1\u30a7\u30c3\u30af\u3092\u7121\u8996\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3002\ndoctrine/mongodb\u306ecomposer.json\u306b\u306fext-mongo(PHP5\u306eMongoDB\u30c9\u30e9\u30a4\u30d0)\u304c\u4f9d\u5b58\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3048\u306a\u3044PHP7\u3067\u306f\u3001\u4e0a\u8a18\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## Symfony\u306e\u8a2d\u5b9a\n\n### \u30aa\u30fc\u30c8\u30ed\u30fc\u30c0\u30fc\u8a2d\u5b9a\n\n```\n// app/autoload.php\nuse Doctrine\\ODM\\MongoDB\\Mapping\\Driver\\AnnotationDriver;\nAnnotationDriver::registerAnnotationClasses();\n```\n\n### AppKernel\u306b\u767b\u9332\n\n```\n// app/AppKernel.php\npublic function registerBundles()\n{\n    $bundles = [\n        // ...\n        new Doctrine\\Bundle\\MongoDBBundle\\DoctrineMongoDBBundle(),\n    ];\n\n    // ...\n}\n```\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n```\n# app/config/parameters.yml\nparameters:\n    mongodb_server: \"mongodb://localhost:27017\"\n```\n\n```\n# app/config/config.yml\ndoctrine_mongodb:\n    connections:\n        default:\n            server: \"%mongodb_server%\"\n            options: {}\n    default_database: test_database\n    document_managers:\n        default:\n            auto_mapping: true\n```\n\n## \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30af\u30e9\u30b9\u306e\u8ffd\u52a0\n\n```\n$ mkdir src/AppBundle/Document\n$ touch src/AppBundle/Document/Product.php\n```\n\nProduct.php\u306e\u4e2d\u8eab\u306f\u4ee5\u4e0b\u3002Doctrine ORM\u3068\u540c\u69d8\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u30de\u30c3\u30d4\u30f3\u30b0\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n<?php\n\n// src/AppBundle/Document/Product.php\nnamespace AppBundle\\Document;\n\nuse Doctrine\\ODM\\MongoDB\\Mapping\\Annotations as MongoDB;\n\n/**\n * @MongoDB\\Document\n */\nclass Product\n{\n    /**\n     * @MongoDB\\Id\n     */\n    protected $id;\n\n    /**\n     * @MongoDB\\Field(type=\"string\")\n     */\n    protected $name;\n\n    /**\n     * @MongoDB\\Field(type=\"float\")\n     */\n    protected $price;\n}\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067getter/setter\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u8fba\u3082ORM\u3068\u540c\u3058\u3067\u3059\u306d\u3002\n\n```\n$ php bin/console doctrine:mongodb:generate:documents AppBundle\n```\n\n## \u5b9f\u884c\u30c6\u30b9\u30c8\n\nsrc/AppBundle/Command/MongoDBTestCommand.php \u306b\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n<?php\n\nnamespace AppBundle\\Command;\n\nuse AppBundle\\Document\\Product;\nuse Symfony\\Bundle\\FrameworkBundle\\Command\\ContainerAwareCommand;\nuse Symfony\\Component\\Console\\Input\\InputArgument;\nuse Symfony\\Component\\Console\\Input\\InputInterface;\nuse Symfony\\Component\\Console\\Input\\InputOption;\nuse Symfony\\Component\\Console\\Output\\OutputInterface;\n\nclass MongoDBTestCommand extends ContainerAwareCommand\n{\n    protected function configure()\n    {\n        $this\n            ->setName('app:mongo-test')\n            ->setDescription('...')\n            ->addArgument('argument', InputArgument::OPTIONAL, 'Argument description')\n            ->addOption('option', null, InputOption::VALUE_NONE, 'Option description')\n        ;\n    }\n\n    protected function execute(InputInterface $input, OutputInterface $output)\n    {\n        // \u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\n        $product = new Product();\n        $product->setName('Foobar');\n        $product->setPrice(19.99);\n        \n        $dm = $this->getContainer()->get('doctrine_mongodb')->getManager();\n        $dm->persist($product);\n        $dm->flush();\n        \n        // \u30c7\u30fc\u30bf\u53d6\u5f97\n        $product = $dm->getRepository('AppBundle:Product')\n            ->findOneBy(['name' => 'Foobar']);\n        \n        if (!$product) {\n            $output->writeln('Product not found');\n        }\n        \n        var_dump($product->getName(), $product->getPrice());\n    }\n}\n```\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n$ php bin/console app:mongo-test\n```\n\nMongoDB\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3082\u7d50\u679c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\n$ mongo test_database\n> db.Product.find();\n{ \"_id\" : ObjectId(\"584559656adfe57b63216d51\"), \"name\" : \"Foobar\", \"price\" : 19.99 }\n```\n\n\u4e0a\u8a18\u624b\u9806\u3067\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f[GitHub](https://github.com/ryo-utsunomiya/doctrine_odm_with_php7)\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u307e\u3068\u3081\n\n\u4ee5\u4e0a\u3001Doctrine ODM\u306e\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9\u3067\u3059\u3002\u57fa\u672c\u7684\u306aAPI\u306fORM\u3068\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001MongoDB\u72ec\u7279\u306eAPI\u3092\u6271\u3046\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u8a73\u7d30\u306f[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.doctrine-project.org/projects/doctrine-mongodb-odm/en/latest/index.html)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n"}