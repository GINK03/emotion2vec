{"context": " More than 1 year has passed since last update.\n\n Xin ch\u00e0o c\u00e1c b\u1ea1n\nB\u00e0i vi\u1ebft n\u00e0y m\u00ecnh d\u1ecbch t\u1eeb \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6a5f\u80fd\u306e\u5b9f\u88c5 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e\u3010\u7b2c9\u56de\u3011\u30de\u30cb\u30e5\u30a2\u30eb c\u1ee7a t\u00e1c gi\u1ea3 @k_shimoji.\n\n T\u1ea1i sao ch\u00fang ta c\u1ea7n ch\u1ee9c n\u0103ng download / upload\nCh\u1ee9c n\u0103ng n\u00e0y l\u00e0 r\u1ea5t ph\u1ed5 bi\u1ebfn s\u1eed d\u1ee5ng trong c\u00e1c h\u1ec7 th\u1ed1ng, v\u00ec v\u1eady ch\u00fang ta c\u1ea7n nghi\u00ean c\u1ee9u c\u00e1ch \u0111\u1ec3 implement n\u00f3. Ch\u00fang ta bi\u1ebft r\u1eb1ng r\u1eb1ng c\u00e1c web system ch\u1ea1y tr\u00ean \"HTTP\". Vi\u1ec7c implement kh\u00f4ng ph\u1ea3i l\u00e0 m\u1ee5c ti\u00eau c\u1ee7a b\u00e0i h\u1ecdc n\u00e0y, m\u1ee5c ti\u00eau ch\u00ednh l\u00e0 h\u1ecdc c\u00e1ch implement n\u00f3. Hi\u1ec7n t\u1ea1i c\u00f3 r\u1ea5t nhi\u1ec1u framework v\u1edbi nhi\u1ec1u layer gi\u00fap m\u00ecnh ch\u1ec9 c\u1ea7n thao t\u00e1c \u0111\u01a1n gi\u1ea3n \u1edf layer tr\u00ean c\u00f9ng, tuy nhi\u00ean m\u00ecnh s\u1ebd \u0111i s\u00e2u h\u01a1n m\u1ed9t t\u00ed, qua \u0111\u00f3 s\u1ebd hi\u1ec3u s\u00e2u h\u01a1n v\u1ec1 c\u00e1ch l\u00e0m.\nTr\u01b0\u1edbc khi b\u1eaft \u0111\u1ea7u l\u1eadp tr\u00ecnh, m\u00ecnh s\u1ebd xem qua v\u1ec1 HTTP\n\n Download C\u00f4ng vi\u1ec7c\n\u0110\u1ea7u ti\u00ean, \u0111\u1ecbnh ngh\u0129a download l\u00e0 \"L\u01b0u n\u1ed9i dung nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server v\u00e0o m\u00e1y n\u1ed9i b\u1ed9 c\u1ee7a b\u1ea1n (local) \", C\u00f4ng vi\u1ec7c \"l\u01b0u v\u00e0o local\" th\u1ef1c s\u1ef1 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\u00f4ng qua tr\u00ecnh duy\u1ec7t.\nTuy nhi\u00ean nh\u1eefng \"content nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server\" c\u00f3 c\u1ea5u tr\u00fac nh\u01b0 th\u1ebf n\u00e0o, ch\u00fang ta s\u1ebd c\u00f9ng xem.\n\nC\u1ea5u tr\u00fac c\u1ee7a HTTP response\nHTTP l\u00e0 m\u1ed9t giao th\u1ee9c ki\u1ec3u client/server; client \u0111\u01b0a ra c\u00e1c request, v\u00e0 server s\u1ebd tr\u1ea3 l\u1eddi c\u00e1c request n\u00e0y. C\u1ea5u tr\u00fac c\u00e1c HTTP message v\u00ec th\u1ebf c\u0169ng thay \u0111\u1ed5i theo y\u1ebfu t\u1ed1 n\u00e0y. C\u00f3 m\u1ed9t \u0111\u1ecbnh d\u1ea1ng cho HTTP request v\u00e0 cho c\u00e1c response.\n\"N\u1ed9i dung nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server\" l\u00e0 ph\u1ea3n h\u1ed3i HTTP \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 t\u1eeb server, n\u00f3 bao g\u1ed3m nh\u1eefng ph\u1ea7n li\u00ean quan v\u00e0 m\u1ed9t ph\u1ea7n g\u1ecdi l\u00e0 \"response body\".\nNh\u1eefng ph\u1ea3n h\u1ed3i sau \u0111\u00e2y l\u00e0 nh\u1eefng ph\u1ea3n h\u1ed3i nh\u1eadn \u0111\u01b0\u1ee3c khi b\u1ea1n request \u0111\u1ebfn trang ch\u1ee7 c\u1ee7a Yahoo, \u0111\u00e2y l\u00e0 c\u1ea5u tr\u00fac HTTP response c\u1ee7a n\u00f3\n\nD\u00f2ng 1: Protocol / version the response code -> HTTP/1.1 200 OK\n\n2 d\u00f2ng sau: (multi-line) response header -> Server: nginx, Date: Thu, 24 Sep 2015 09:11:53 GMT, Content-Type: text/html; charset=UTF-8...\nM\u1ed9t d\u00f2ng tr\u1ed1ng\nSau d\u00f2ng tr\u1ed1ng l\u00e0 n\u1ed9i dung c\u1ee7a response body -> <!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML...\u301c\n\nC\u1ee5 th\u1ec3 n\u00f3 nh\u01b0 th\u1ebf n\u00e0y\n\n\u4f8b)yahoo\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\nHTTP/1.1 200 OK\nServer: nginx\nDate: Thu, 24 Sep 2015 09:11:53 GMT\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nConnection: close\nP3P: policyref=\"http://privacy.yahoo.co.jp/w3c/p3p_jp.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE GOV\"\nCache-Control: private, no-cache, no-store, must-revalidate\nExpires: -1\nPragma: no-cache\nX-XRDS-Location: https://open.login.yahooapis.jp/openid20/www.yahoo.co.jp/xrds\nVary: Accept-Encoding\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n<meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\">\n<meta http-equiv=\"content-style-type\" content=\"text/css\">\n<meta http-equiv=\"content-script-type\" content=\"text/javascript\">\n<meta name=\"description\" content=\"Japan's largest portal site. Search, auctions, news, mail, community, shopping, more than 80 services, including the deployment. We will continue to aim to \"life engine\" to enrich your life.\">\n<meta name=\"robots\" content=\"noodp\">\n<title>Yahoo! JAPAN</title>\n\n\u301c\u4ee5\u4e0b\u7701\u7565\u301c\n\n\nCh\u1ec9 c\u00f3 n\u1ed9i dung trong ph\u1ea7n body c\u1ee7a HTTP response c\u00f3 th\u1ec3 l\u1ea5y v\u00e0 cho ph\u00e9p \"download\", kh\u00f4ng ph\u1ea3i nh\u1eefng format \u0111\u00e3 thay \u0111\u1ed5i n\u00e0y.\nHay n\u00f3i c\u00e1ch kh\u00e1c, vi\u1ec7c \"download\" c\u0169ng gi\u1ed1ng nh\u01b0 vi\u1ec7c \"l\u01b0u nh\u1eefng response body nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server xu\u1ed1ng local th\u00f4ng qua tr\u00ecnh duy\u1ec7t.\"\n\n\u0110\u1ec3 l\u01b0u response body th\u00f4ng qua tr\u00ecnh duy\u1ec7t\nN\u00f3i chung l\u00e0 \u0111\u1ec3 \"download\" th\u00ec ch\u00fang ta ph\u1ea3i th\u1ef1c hi\u1ec7n l\u01b0u \"response body\" tr\u00ean tr\u00ecnh duy\u1ec7t. \u1ede v\u00ed d\u1ee5 tr\u00ean v\u1ec1 trang ch\u1ee7 yahoo, n\u00f3 \u0111\u00e3 tr\u1ea3 v\u1ec1 HTML tr\u00ean response body. L\u00fac n\u00e0y, tr\u00ecnh duy\u1ec7t ( v\u1edbi m\u1ed9t s\u1ed1 file ngo\u1ea1i l\u1ec7 ) l\u01b0u ch\u00fang xu\u1ed1ng m\u00e1y local, v\u00e0 v\u1ebd l\u1ea1i ch\u00fang \u1edf c\u1eeda s\u1ed5 tr\u00ecnh duy\u1ec7t.\nTr\u00ean tr\u00ecnh duy\u1ec7t, \u0111\u1ec3 \"hi\u1ec3n th\u1ecb\" response body \u0111\u00e3 nh\u1eadn \u0111\u01b0\u1ee3c ho\u1eb7c \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh c\u00f3 l\u01b0u hay kh\u00f4ng.\nC\u00f3 nh\u1eefng l\u1eddi khuy\u00ean r\u1eb1ng, kh\u00f4ng ch\u1ec9 \"response header\" ch\u1ee9a c\u00e1c meta-information v\u1ec1 ph\u1ea3n h\u1ed3i.\nTrong s\u1ed1 ch\u00fang th\u00ec tr\u00ecnh duy\u1ec7t ch\u1ee7 y\u1ebfu x\u00e1c \u0111\u1ecbnh nh\u1eefng th\u00e0nh ph\u1ea7n nh\u01b0 Content-Type v\u00e0 Content-Disposition.\n\nContent-Type\n\n\nN\u1ebfu response body l\u00e0 text/html ngh\u0129a l\u00e0 n\u00f3 l\u00e0 HTML, c\u0169ng nh\u01b0 tr\u00ean server side l\u00e0 JSON n\u1ebfu set l\u00e0 application/json.\nM\u1ed9t khi tr\u00ecnh duy\u1ec7t \u0111\u1ecdc \u0111\u01b0\u1ee3c Content-Type, N\u00f3 s\u1ebd ch\u1ea1y nh\u1eefng h\u00e0nh \u0111\u1ed9ng m\u1eb7c \u0111\u1ecbnh cho c\u00e1c n\u1ed9i dung, v\u00ed d\u1ee5 n\u00f3 s\u1ebd hi\u1ec3n th\u1ecb n\u1ebfu \"display\" l\u00e0 m\u1eb7c \u0111\u1ecbnh, l\u01b0u n\u1ebfu \"save\" l\u00e0 m\u1eb7c \u0111\u1ecbnh.\n\n\nContent-Disposition\n\n\n\nattachment hay inline t\u00f4i s\u1ebd set \u1edf server side. N\u1ebfu b\u1ea1n mu\u1ed1n l\u01b0u attachment, m\u00ecnh kh\u00f4ng c\u1ea7n request t\u1edbi tr\u00ecnh duy\u1ec7t n\u1ebfu b\u1ea1n mu\u1ed1n hi\u1ec3n th\u1ecb inline v\u00e0 n\u00f3 s\u1ebd \u0111\u01b0\u1ee3c set t\u1ea1i server side. V\u00ec nh\u1eefng h\u00e0nh vi m\u1eb7c \u0111\u1ecbnh c\u1ee7a tr\u00ecnh duy\u1ec7t c\u00f3 ch\u00fat kh\u00e1c bi\u1ec7t \u1edf m\u1ed7i tr\u00ecnh duy\u1ec7t, Content-Type n\u00f3 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c set ch\u1ec9 khi Content-Disposition c\u0169ng \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh \u1edf v\u00e0i tr\u00ecnh duy\u1ec7t \u0111\u00e1ng tin c\u1eady l\u00e0 \"\u0110\u01b0\u1ee3c ph\u00e9p download.\"\n\n\n\n\u1ede b\u00e0i h\u1ecdc n\u00e0y,\n\nM\u00ecnh s\u1ebd set n\u1ed9i dung sao cho c\u00f3 th\u1ec3 download \u0111\u01b0\u1ee3c v\u00e0o response body\nN\u00f3 s\u1ebd set gi\u00e1 tr\u1ecb response header\n\nCh\u00fang ta h\u00e3y c\u00f9ng xem v\u1ec1 n\u1ed9i dung c\u1ea7n implement\n\n Ch\u1ee9c n\u0103ng Upload\nV\u1edbi vi\u1ec7c upload, n\u00f3 l\u00e0 c\u00e1ch file \u0111\u01b0\u1ee3c g\u1eedi \u0111i\nH\u00e3y xem c\u1ea5u tr\u00fac c\u1ee7a HTTP request.\n\nC\u1ea5u tr\u00fac c\u1ee7a HTTP request\nC\u1ea5u tr\u00fac c\u1ee7a HTTP request t\u01b0\u01a1ng t\u1ef1 c\u1ea5u tr\u00fac c\u1ee7a HTTP response.\nFile c\u1ea7n di chuy\u1ec3n trong c\u00e1c request \u0111\u01b0\u1ee3c g\u1eedi, n\u00f3 s\u1ebd \u0111\u01b0\u1ee3c g\u1eedi b\u1eb1ng c\u00e1ch include n\u00f3 \u1edf trong m\u1ed9t ph\u1ea7n \u0111\u01b0\u1ee3c tr\u1ecf \u0111\u1ebfn nh\u01b0 l\u00e0 \"request body\".\nRequest khi b\u1ea1n th\u1ef1c s\u1ef1 g\u1eedi 1 file th\u00f4ng qua h\u00e0m upload s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o nh\u01b0 sau.\nM\u00ecnh v\u00ed d\u1ee5 upload 2 file todolist1.txt, todolist2.txt c\u00f9ng m\u1ed9t l\u00fac.\n\nFileUpload'sRequest\nPOST /rest-study/todo_lists/upload.json HTTP/1.1\nHost: 10.0.1.206\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:42.0) Gecko/20100101 Firefox/42.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: ja,en-US;q=0.7,en;q=0.3\nAccept-Encoding: gzip, deflate\nReferer: http://10.0.1.206/rest-study/\nX-Requested-With: XMLHttpRequest\nContent-Length: 779\nContent-Type: multipart/form-data; boundary=---------------------------1395431092341454357747073315\nCookie: CAKEPHP=oo6gj167d4fltodm3nre2lskd2\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n\n-----------------------------1395431092341454357747073315\nContent-Disposition: form-data; name=\"0\"; filename=\"todolist1.txt\"\nContent-Type: text/plain\n\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO1\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO2\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO3\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO4\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO5\n\n\n-----------------------------1395431092341454357747073315\nContent-Disposition: form-data; name=\"1\"; filename=\"todolist2.txt\"\nContent-Type: text/plain\n\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO1\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO2\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO3\n\n\n-----------------------------1395431092341454357747073315--\n\n\nHTTP method l\u00e0 POST, B\u1ea1n c\u1ea7n truy c\u1eadp v\u00e0o URL /rest-study/todo_lists/upload.json.\nCh\u00fa \u00fd\n- Content-Type: multipart/form-data; boundary=---------------------------1395431092341454357747073315\n- Content-Length: 779\nC\u00f3 2 HTTP request header.\n\u0110\u1ea7u ti\u00ean, b\u1ea1n n\u00ean check format c\u1ee7a the HTTP request.\n\nD\u00f2ng 1: HTTP method URI protocol / version -> POST /rest-study/todo_lists/upload.json HTTP / 1.1\n\n2 D\u00f2ng ti\u1ebfp theo: (multi-line) request header -> Host: 10.0.1.206,User-Agent: Mozilla / 5.0 (Macintosh; Intel Mac OS X 10.10; rv: 42.0) Gecko / 20100101 Firefox / 42.0 ...\nD\u00f2ng tr\u1ed1ng\nSau d\u00f2ng tr\u1ed1ng l\u00e0 t\u1ea5t request body -> -----------------------------1395431092341454357747073315\u301c\n\nN\u00f3 s\u1ebd tr\u1edf th\u00e0nh\n\nmultipart/form-data\nN\u1ebfu Content-Type kh\u00f4ng ph\u1ea3i multipart/form-data, V\u00ed d\u1ee5 n\u00f3 l\u00e0 application/json, th\u00ec n\u00f3 s\u1ebd nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y.\n\nV\u00edD\u1ee5C\u00e1cRequestKhiB\u1ea1nTh\u00eamTODO\n{\"todo\":\"Register the TODO in the Add button\",\"status\":0,\"assignee\":\"67\"}\n\n\nNgo\u1ea1i tr\u1eeb multipart/form-data, JSON data c\u1ea7n truy\u1ec1n \u0111i s\u1ebd \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef theo c\u00e1ch c\u1ee7a n\u00f3 t\u1edbi request body.\nRequest body truy\u1ec1n trong multipart/form-data c\u00f3 c\u00e1c chu\u1ed7i ph\u00e2n c\u00e1ch , v\u00ed d\u1ee5 ----------------------------- M\u1ed9t chu\u1ed7i k\u00fd t\u1ef1 nh\u01b0 Ichisankyu5431092341454357747073315.\nFormat n\u00e0y \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh \u1edf request header Content-Type multipart/form-data.\nNh\u01b0 c\u00e1i t\u00ean \u0111\u00e3 n\u00f3i l\u00ean t\u1ea5t c\u1ea3, request body \u0111\u00e3 \u0111\u01b0\u1ee3c chia th\u00e0nh r\u1ea5t nhi\u1ec1u ph\u1ea7n ri\u00eang bi\u1ec7t v\u1edbi r\u1ea5t nhi\u1ec1u chu\u1ed7i ph\u00e2n c\u00e1ch.\nV\u00e0 n\u00f3 tr\u1edf th\u00e0nh m\u1ed9t c\u1ea5u tr\u00fac l\u01b0\u1edbi ch\u1ee9a nh\u1eefng request header v\u00e0 request body cho m\u1ed7i ph\u1ea7n.\n\u1ede b\u00e0i h\u1ecdc n\u00e0y,\n\nTi\u1ebfn h\u00e0nh upload file tr\u00ean Ajax\nL\u1ea5y v\u1ec1 n\u1ed9i dung file t\u1eeb request\nT\u1ea1o TODO t\u1eeb nh\u1eefng n\u1ed9i dung xu\u1ea5t ra\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd xem qua c\u00e1c n\u1ed9i dung c\u1ea7n implement.\nTuy nhi\u00ean, ph\u1ea7n \"nh\u1eadn n\u1ed9i dung file t\u1eeb request\" r\u1ea5t d\u1ec5 d\u00e0ng v\u00ec PHP v\u00e0 CakePHP \u0111\u00e3 gi\u1ea3i quy\u1ebft h\u1ea7u h\u1ebft ch\u00fang r\u1ed3i!\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd implement lu\u00f4n ph\u1ea7n \"Upload file\" tr\u00ean Ajax. N\u1ed9i dung chi ti\u1ebft \u1edf nh\u01b0 sau.\n\n N\u1ed9i dung\n\u0110\u00e2y l\u00e0 h\u00ecnh \u1ea3nh sau khi ho\u00e0n t\u1ea5t vi\u1ec7c implement\n\n\nLink download\n\n\nTODO list xu\u1ea5t hi\u1ec7n khi b\u1ea1n click v\u00e0o download \u1edf \u0111\u1ecbnh d\u1ea1ng CSV.\n\n\nCh\u1ecdn file \u0111\u1ec3 upload\n\n\nN\u1ebfu b\u1ea1n click v\u00e0o n\u00fat \"Ch\u1ecdn file\", m\u1ed9t c\u1eeda s\u1ed5 xu\u1ea5t hi\u1ec7n, c\u00e1c b\u1ea1n h\u00e3y ch\u1ecdn c\u00e1c file b\u1ea1n mu\u1ed1n upload.\n\n\nUpload button\n\n\nCh\u1ea1y vi\u1ec7c upload khi b\u1ea1n click v\u00e0o.\nC\u1ea7n ch\u00fa \u00fd r\u1eb1ng, file b\u1ea1n mu\u1ed1n upload nh\u01b0 \u1edf v\u00ed d\u1ee5 sau, n\u00f3 s\u1ebd l\u00e0 m\u1ed7i n\u1ed9i dung TODO m\u1ed9t d\u00f2ng, kh\u00f4ng k\u00e8m theo owner v\u00e0 assigner, v\u00e0 c\u1ea7n \u0111\u01b0\u1ee3c th\u00eam v\u00e0o v\u1ecb tr\u00ed c\u1ee7a TODO ch\u01b0a ho\u00e0n th\u00e0nh ngh\u0129a l\u00e0 status b\u1eb1ng 0. Khi b\u1ea1n th\u00eam TODO, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng chung validation nh\u01b0 th\u00eam b\u1eb1ng \"Add\" button n\u1ebfu mu\u1ed1n.\n\n\n\n\nViDuUploadFile(todolist1.txt)\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO1\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO2\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO3\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO4\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO5\n\n\n\nM\u1ee5c l\u1ee5c b\u00e0i h\u1ecdc\n\nChu\u1ea9n b\u1ecb\nB\u00e0i 1: Download\nB\u00e0i 2: Upload\n\nB\u00e2y gi\u1edd ch\u00fang ta b\u1eaft \u0111\u1ea7u n\u00e0o\n\n Chu\u1ea9n b\u1ecb\nPh\u1ea7n chu\u1ea9n b\u1ecb s\u1ebd gi\u1ed1ng nhau \u1edf m\u1ed7i b\u00e0i, v\u00ec v\u1eady t\u00f4i \u0111\u00e3 t\u1ed5ng h\u1ee3p n\u00f3 \u1edf m\u1ed9t entry ri\u00eang. C\u00e1c b\u1ea1n vui l\u00f2ng xem \u1edf link n\u00e0y All 12 times of study sessions in do I have use of Git - RESTful application workshops will be built on AWS ~ Web development workshop ~ - Qiita \u0111\u1ec3 chu\u1ea9n b\u1ecb .\n\nGit: B\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u1ea1o branch vol/09 v\u00e0 l\u00e0m vi\u1ec7c tr\u00ean n\u00f3.\n\nOK, b\u01b0\u1edbc \u0111\u1ea7u \u0111\u00e3 xong\n *** T\u00f4i xin nh\u1eafc l\u1ea1i \u1edf b\u00e0i 5 v\u00e0 b\u00e0i 6, ch\u00fang ta \u0111\u00e3 c\u00f3 nh\u1eefng table b\u1ecb thay \u0111\u1ed5i. ***\n\nB\u00e0i 5\n\n\nT\u1ea1o Table d\u00e0nh cho vi\u1ec7c \u0111\u0103ng k\u00fd th\u00e0nh vi\u00ean ( Th\u1ef1c hi\u1ec7n cho ch\u1ee9c n\u0103ng login )\n\n\nB\u00e0i 6\n\n\nTh\u00eam m\u1ed9t c\u1ed9t cho table TODO list ( Th\u00eam c\u1ed9t Owner v\u00e0 c\u1ed9t assignee cho ch\u1ee9c n\u0103ng ph\u00e2n c\u00f4ng c\u00f4ng vi\u1ec7c)\n\n\n\nC\u00e1c b\u1ea1n n\u00ean tham kh\u1ea3o l\u1ea1i c\u00e1c link sau \u0111\u1ec3 r\u00f5 h\u01a1n.\nT\u1ea1o Table d\u00e0nh cho vi\u1ec7c \u0111\u0103ng k\u00fd th\u00e0nh vi\u00ean\nTh\u00eam m\u1ed9t c\u1ed9t cho table TODO list\nB\u1eaft \u0111\u1ea7u \u0111\u1ebfn v\u1edbi b\u00e0i 1 th\u00f4i:\n\n B\u00e0i 1: Download\n\nClient side\n\n\nTh\u00eam download link\n\n\nServer side\n\n\nReturn \u0111\u1ec3 xu\u1ea5t n\u1ed9i dung response body v\u00e0o m\u1ed9t CSV file b\u1eb1ng c\u00e1ch \u0111\u1ecdc TODO t\u1eeb database\n\n\n\nB\u00e2y gi\u1edd t\u00f4i s\u1ebd b\u1eaft \u0111\u1ea7u implement t\u1eebng c\u00e1i m\u1ed9t.\nFile format sau khi download v\u1ec1 n\u00f3 s\u1ebd nh\u01b0 sau, ph\u00e2n c\u00e1ch b\u1eb1ng c\u00e1c d\u1ea5u ph\u1ea9y,\n- id\n- todo: n\u1ed9i dung c\u1ee7a TODO\n- status: tr\u1ea1ng th\u00e1i\n- owner: t\u00ean owner\n- assignee: T\u00ean ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng\n\u0110\u00e2y l\u00e0 c\u1ea5u tr\u00fac file m\u00e0 ch\u00fang ta mu\u1ed1n. D\u00f2ng \u0111\u1ea7u ti\u00ean s\u1ebd l\u00e0 c\u00e1c title (l\u00fac upload kh\u00f4ng ph\u1ea3i \u0111\u1ecbnh d\u1ea1ng n\u00e0y nh\u00e9, file c\u1ea7n upload ch\u1ec9 c\u00f3 n\u1ed9i dung m\u1ed7i TODO m\u1ed7i d\u00f2ng th\u00f4i )\n\nFileFormatTwoDownload\nid, todo, status, owner, assignee\n1, buy the milk, 1, Taro Yamada, Taro Yamada\n2, call home, 1, Tanaka Hanako, Taro Yamada\n3, walk the dog, 1, Taro Yamada, Taro Yamada\n\n\n\nC\u00e1c file c\u1ea7n ch\u1ec9nh s\u1eeda\n\n\n\nThao t\u00e1c\nfile\n\u00dd ngh\u0129a\n\n\n\n\nS\u1eeda\napp/Config/routes.php\nTh\u00eam ti\u1ebfn tr\u00ecnh download v\u00e0o route\n\n\nS\u1eeda\napp/View/Layouts/default.ctp\nTh\u00eam n\u00fat download\n\n\nS\u1eeda\napp/Controller/TodoListsController.php\nC\u00e1c ti\u1ebfn tr\u00ecnh b\u1ed5 sung\n\n\n\n\napp/Config/routes.php\nM\u00ecnh s\u1ebd th\u00eam URL cho ti\u1ebfn tr\u00ecnh download\u3002\n\napp/Config/routes.php\n\n\u301c\u7565\u301c\n\n /*\n  * API\n  */\n\n // \u30ed\u30b0\u30a4\u30f3\n Router::connect('/users/login', array (\n    'controller' => 'users',\n    'action' => 'login',\n    'method' => array (\n        'POST'\n    )\n ));\n\n // \u30ed\u30b0\u30a2\u30a6\u30c8\n Router::connect('/users/logout', array (\n    'controller' => 'users',\n    'action' => 'logout',\n    'method' => 'POST'\n ));\n\n // \u30ed\u30b0\u30a4\u30f3\u30c1\u30a7\u30c3\u30af(\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u53d6\u5f97)\n Router::connect('/users/loggedin', array (\n    'controller' => 'users',\n    'action' => 'loggedIn',\n    'method' => 'GET'\n ));\n\n // \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\n Router::connect('/users/signup', array (\n    'controller' => 'users',\n    'action' => 'signUp',\n    'method' => array (\n        'POST'\n    )\n ));\n\n+// CSV\u30d5\u30a1\u30a4\u30eb\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n+Router::Connect('/todo_lists/download', Array(\n+   'controller' => 'todo_lists',\n+   'action' => 'download',\n+   'method' => 'GET'\n+));\n\n Router::mapResources(array (\n    'todo_lists',\n ));\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\n\nTh\u00eam /todo_lists/download.\nM\u00ecnh s\u1ebd routing khi truy c\u1eadp v\u00e0o download method c\u1ee7a TodoListController.php b\u1eb1ng ph\u01b0\u01a1ng th\u1ee9c GET .\n\n\napp/View/Layouts/default.ctp\nTh\u00eam button \"download\"\n\napp/View/Layouts/default.ctp\n\n\u301c\u7565\u301c\n\n    <!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-composite-template\">\n        <div class=\"row\">\n            <div class=\"col-xs-12\">\n                <span class=\"row form-inline\">\n                    <div class=\"input-group col-sm-6 col-xs-12\">\n                        <label for=\"new-todo\" class=\"visible-xs\">Todo</label>\n                        <textarea class=\"form-control todo-item-text\" rows=\"3\" id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n                    </div>\n                    <div class=\"input-group col-sm-3 col-xs-12\">\n                        <label for=\"user-list\" class=\"visible-xs\">Assignee</label>\n                        <select class=\"form-control\" name=\"assignee\" id=\"user-list\"></select>\n                    </div>\n                    <div class=\"input-group col-sm-3 col-xs-12\">\n                        <label class=\"visible-xs\"></label>\n                        <input type=\"button\" id=\"addTodo\" class=\"btn btn-primary btn-md todo-action-button\" value=\"\u8ffd\u52a0\">\n                    </div>\n                </span>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-xs-12\">\n                <table class=\"table table-striped table-bordered table-hover\">\n                    <thead>\n                        <tr class=\"success\">\n                            <th class=\"col-sm-6\" colspan=\"2\">ToDo</th>\n                            <th class=\"col-sm-2\">Owner</th>\n                            <th class=\"col-sm-2\">Assignee</th>\n                            <th class=\"col-sm-2\" colspan=\"2\"></th>\n                        </tr>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n            </div>\n        </div>\n+       <div class=\"row\">\n+           <div class=\"col-xs-6\">\n+               <a href=\"/rest-study/todo_lists/download\" class=\"alert alert-default pull-left\" id=\"downloadTodo\">Download TODO list</a>\n+           </div>\n+       </div>\n    </script>\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\n\nCh\u1ec9 th\u00eam m\u1ed9t c\u1eb7p th\u1ebb <a>, link m\u00ecnh s\u1ebd set th\u00e0nh /rest-study/todo_lists/download nh\u01b0 \u0111\u00e3 \u0111\u01b0\u1ee3c th\u00eam \u1edf app/Config/routes.php .\n\n\napp/Controller/TodoListsController.php\nB\u1eaft \u0111\u1ea7u ti\u1ebfn tr\u00ecnh download\n\napp/Controller/TodoListsController.php\n\n\u301c\u7565\u301c\n\n    public function index() {\n        $query = array (\n            'fields' => $this->fields,\n            'order' => \"TodoList.id\"\n        );\n        $res = $this->TodoList->find('all', $query);\n        // \u6574\u5f62\n        if (count($res) > 0) {\n            $loginUserId = $this->Auth->user()['id'];\n            foreach ( $res as $key => $row ) {\n                //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n                $res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n                //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n                $res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n            }\n        }\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n\u301c\u4e2d\u7565\u301c\n\n    public function edit($id) {\n        $this->TodoList->id = $id;\n        $data = $this->request->data;\n        $res = $this->TodoList->save($this->request->data);\n        $res = !empty($res);\n        $response = $this->editResponse($res);\n        $this->set(compact('response'));\n        $this->set('_serialize', 'response');\n    }\n\n+   public function download() {\n+       //id\u9806\u3067\u4e00\u89a7\u53d6\u5f97\n+       $query = array (\n+           'fields' => $this->fields,\n+           'order' => \"TodoList.id\"\n+       );\n+       $res = $this->TodoList->find('all', $query);\n+       // CSV\u30d5\u30a1\u30a4\u30eb\u306b\u6574\u5f62\n+       if ($res && is_array($res)) {\n+           $fp = fopen('php://temp', 'w+');\n+           //\u30bf\u30a4\u30c8\u30eb\n+           $fields = array('id', 'todo', 'status', 'owner' ,'assignee');\n+           fputcsv($fp, $fields);\n+           //\u30c7\u30fc\u30bf\n+           foreach ( $res as $record ) {\n+               $fields = array();\n+               $fields[] = $record['TodoList']['id'];\n+               $fields[] = $record['TodoList']['todo'];\n+               $fields[] = $record['TodoList']['status'];\n+               $fields[] = $record['Owner']['name'];\n+               $fields[] = $record['Assignee']['name'];\n+               fputcsv($fp, $fields);\n+           }\n+           //B\u1eaft \u0111\u1ea7u v\u1edbi pointer\n+           rewind($fp);\n+           //\u0110\u1ecdc file\n+           $content = stream_get_contents($fp);\n+           //m\u00e3 hi\u1ec7n t\u1ea1i \u0111ang l\u00e0 UTF-8\n+           //Excel kh\u00f4ng \u0111\u1ecdc \u0111\u01b0\u1ee3c m\u00e3 n\u00e0y, v\u00ec v\u1eady m\u00ecnh s\u1ebd chuy\u1ec3n n\u00f3 th\u00e0nh SJIS-win\n+           //$content =  mb_convert_encoding($content, 'sjis-win', 'UTF-8');\n+           fclose($fp);\n+           //Kh\u00f4ng xem view\n+           $this->autoRender = false;\n+           //\u0110\u1eb7t t\u00ean file download\n+           $this->response->download('todo.csv');\n+           $this->response->type('csv');\n+           $this->response->body($content);\n+       }\n+   }\n+\n    //Edit response\n    private function editResponse($res){\n        if($res){\n            $response = $res;\n        }else{\n            $this->setStatusValidationError();\n            $respnse = array();\n            if(count($this->TodoList->validationErrors) > 0){\n                $response = $this->editErrors($this->TodoList->validationErrors);\n            }else{\n                $response = $this->editErrors('An error occured.');\n            }\n        }\n        return $response;\n    }\n\n \u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nTh\u00eam h\u00e0m download\n\nThu th\u1eadp data\n\nL\u1ea5y todo list \u1edf $this->TodoList->find('all', $query);. N\u00f3 gi\u1ed1ng nh\u1eefng g\u00ec b\u1ea1n \u0111ang l\u00e0m \u1edf h\u00e0m index tr\u00ean kia.\n\n\nH\u00e0m truy c\u1eadp v\u00e0o file php\n\nS\u1eed d\u1ee5ng c\u00e1c h\u00e0m sau \u0111\u00e2y, b\u1ea1n c\u00f3 th\u1ec3 vi\u1ebft php;//temp v\u00e0o cu\u1ed1i csv format data c\u1ee7a TODO list.\n\n\nT\u1ea1i h\u00e0m fopen, php://temp m\u1edf k\u1ebft n\u1ed1i t\u1edbi file output tr\u00ean b\u1ed9 nh\u1edb\nOutput c\u1ee7a CSV format n\u1eb1m b\u00ean tr\u00e1i h\u00e0nh \u0111\u1ed9ng c\u1ee7a h\u00e0m fputcsv.\nS\u1ebd tr\u1ea3 nh\u1eefng ph\u1ea7n \u0111\u1ea7u ti\u00ean c\u1ee7a file pointer \u1edf h\u00e0m rewind,\n\u0110\u1ecdc l\u1ea1i data l\u00e0 output c\u1ee7a h\u00e0m stream_get_contents tr\u00ean m\u1ea3ng.\nH\u00e0m fclose - Manual d\u00f9ng \u0111\u1ec3 \u0111\u00f3ng file.\n\n\n\n\n Ch\u00fa \u00fd\n\u0110\u00e2y l\u00e0  quy tr\u00ecnh\n\u0110\u1ec3 \"download\" file xu\u1ed1ng tr\u00ecnh duy\u1ec7t,\n\nSet n\u00f3 th\u00e0nh CSV file trong Content-Type\n\nX\u00e1c \u0111\u1ecbnh t\u00ean file v\u1edbi c\u00e1c \u0111\u00ednh k\u00e8m c\u1ee5 th\u1ec3 c\u1ea7n download \u1edf Content-Disposition\n\n\nB\u1ea1n c\u1ea7n l\u00e0m c\u1ea3 2.\n\n\n$this->response->download('todo.csv');\n\nM\u00ecnh s\u1ebd s\u1eed d\u1ee5ng method CakeResponse-> download trong CakePHP, Content-Disposition: attachment; filename=\"todo.csv\" s\u1ebd \u0111\u01b0\u1ee3c set\n\n\n\n$this->response->type('csv');\n\nN\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng method CakeResponse-> type c\u1ee7a CakePHP, set th\u00e0nh Content-Type: text/csv; charset=UTF-8\n\n\n\n\n$this->response->body($content)\n\nN\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng method CakeResponse-> body c\u1ee7a CakePHP,  n\u1ed9i dung c\u1ee7a response body s\u1ebd \u0111\u01b0\u1ee3c set b\u1eb1ng bi\u1ebfn $content.\n\n\n\nTr\u00ecnh duy\u1ec7t s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c \"download\" nh\u01b0 tr\u00ean.\n V\u1edbi vi\u1ec7c comment \u0111i ph\u1ea7n return c\u1ee7a $this->response->download('todo.csv'); v\u00e0 $this->response->type('csv'), M\u00ecnh s\u1ebd xem c\u00e1ch x\u1eed l\u00fd tr\u00ean c\u00e1c tr\u00ecnh duy\u1ec7t kh\u00e1c nhau, b\u1ea1n c\u00f3 th\u1ec3 th\u1ea5y m\u1ed9t s\u1ed1 s\u1ef1 kh\u00e1c bi\u1ec7t.\n\nT\u00f3m t\u1eaft b\u00e0i h\u1ecdc\nLet's download the TODO is actually modified.\n\n\n S\u1eeda app/Config/routes.php nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n S\u1eeda app/View/Layouts/default.ctpnh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n S\u1eeda app/Controller/TodoListsController.php nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n Ki\u1ec3m tra k\u1ebft qu\u1ea3\n\n Commit l\u00ean Git\n\n Hi\u1ec3n th\u1ecb d\u01b0\u1edbi d\u1ea1ng Diff nh\u1eefng thay \u0111\u1ed5i tr\u00ean Github\nCh\u01b0\u01a1ng  9: B\u00e0i 1 - Download \u00b7 suzukishouten-study/rest-study@ccb6d14\n\u0110\u00e3 xong ch\u1ee9c n\u0103ng download, chuy\u1ec3n qua b\u00e0i 2 n\u00e0o !\n\n B\u00e0i 2: Upload\n\nClient side\n\n\nTh\u00eam button Upload v\u00e0 ph\u1ea7n \"Ch\u1ecdn file\"\nTh\u00eam ph\u1ea7n x\u1eed l\u00fd Upload b\u1eb1ng ajax\n\n\nServer side\n\n\n\u0110\u1ecdc file \u0111\u01b0\u1ee3c upload l\u00ean v\u00e0 th\u00eam v\u00e0o TODO\n\n\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd implement l\u1ea7n l\u01b0\u1ee3t ch\u00fang.\nFile format c\u00f3 th\u1ec3 t\u1ea3i v\u1ec1 m\u1ed7i d\u00f2ng m\u1ed9t Todo nh\u01b0 sau.\n\nViDuUpload(todolist1.txt)\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO1\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO2\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO3\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO4\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO5\n\n\n\nNh\u1eefng file b\u1ea1n c\u1ea7n thay \u0111\u1ed5i\n\n\n\nThao t\u00e1c\nfile\n\u00dd ngh\u0129a\n\n\n\n\nS\u1eeda\napp/Config/routes.php\nTh\u00eam routing cho ti\u1ebfn tr\u00ecnh download\n\n\nS\u1eeda\napp/View/Layouts/default.ctp\nTh\u00eam button upload v\u00e0 ch\u1ecdn file\n\n\nS\u1eeda\napp/webroot/js/views/todo-composite-view.js\nTh\u00eam ti\u1ebfn tr\u00ecnh upload\n\n\nS\u1eeda\napp/Controller/TodoListsController.php\nTh\u00eam ti\u1ebfn tr\u00ecnh upload file\n\n\n\n\napp/Config/routes.php\nTh\u00eam URL cho ti\u1ebfn tr\u00ecnh Upload.\n\napp/Config/routes.php\n\n\u301c\u7565\u301c\n // CSV file downlaod\n Router::Connect('/todo_lists/download', Array(\n    'controller' => 'todo_lists',\n    'action' => 'download',\n    'method' => 'GET'\n ));\n\n+// CSV file upload\n+Router::Connect('/todo_lists/upload', Array (\n+   'controller' => 'todo_lists',\n+   'action' => 'upload',\n+   'method' => 'POST'\n+));\n+\n Router::mapResources(array (\n    'todo_lists',\n ));\n\n \u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\n\napp/View/Layouts/default.ctp\nTh\u00eam n\u00fat ch\u1ecdn file v\u00e0 upload button.\n\napp/View/Layouts/default.ctp\n\n\u301c\u7565\u301c\n    <!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-composite-template\">\n        <div class=\"row\">\n            <div class=\"col-xs-12\">\n                <span class=\"row form-inline\">\n                    <div class=\"input-group col-sm-6 col-xs-12\">\n                        <label for=\"new-todo\" class=\"visible-xs\">Todo</label>\n                        <textarea class=\"form-control todo-item-text\" rows=\"3\" id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n                    </div>\n                    <div class=\"input-group col-sm-3 col-xs-12\">\n                        <label for=\"user-list\" class=\"visible-xs\">Assignee</label>\n                        <select class=\"form-control\" name=\"assignee\" id=\"user-list\"></select>\n                    </div>\n                    <div class=\"input-group col-sm-3 col-xs-12\">\n                        <label class=\"visible-xs\"></label>\n                        <input type=\"button\" id=\"addTodo\" class=\"btn btn-primary btn-md todo-action-button\" value=\"Add TODO\">\n                    </div>\n                </span>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-xs-12\">\n                <table class=\"table table-striped table-bordered table-hover\">\n                    <thead>\n                        <tr class=\"success\">\n                            <th class=\"col-sm-6\" colspan=\"2\">ToDo</th>\n                            <th class=\"col-sm-2\">Owner</th>\n                            <th class=\"col-sm-2\">Assigner</th>\n                            <th class=\"col-sm-2\" colspan=\"2\"></th>\n                        </tr>\n                    </thead>\n                    <tbody></tbody>\n                </table>\n            </div>\n        </div>\n        <div class=\"row\">\n            <div class=\"col-xs-6\">\n                <a href=\"/rest-study/todo_lists/download\" class=\"alert alert-default pull-left\" id=\"downloadTodo\">Download TODO list</a>\n            </div>\n+           <div class=\"col-xs-6\">\n+               <form class=\"form-inline\">\n+                   <input type=\"file\" id=\"uploadFile\" name=\"uploadFile\" multiple class=\"form-control\">\n+                   <a class=\"btn btn-info pull-right\" id=\"uploadButton\">Upload TODO list</a>\n+               </form>\n+           </div>\n        </div>\n    </script>\n\n \u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\n\nD\u01b0\u1edbi link download, c\u00f3 input type =\" file \", b\u1ea1n s\u1ebd th\u00eam m\u1ed9t button \u1edf th\u1ebb <a>.\n\n\n set input type=\"file\" l\u00e0 multiple \u0111\u1ec3 cho ph\u00e9p ch\u1ecdn upload nhi\u1ec1u file.\n\n\n\n\napp/webroot/js/views/todo-composite-view.js\nM\u00ecnh s\u1ebd implement ph\u1ea7n Upload b\u1eb1ng AJAX\n\napp/webroot/js/views/todo-composite-view.js\n\n\u301c\u7565\u301c\n        ui : {\n            addTodo : '#addTodo',\n            newTodo : '#new-todo',\n-           userList : '#user-list'\n+           userList : '#user-list',\n+           uploadButton : '#uploadButton',\n+           uploadFile : '#uploadFile'\n        },\n\n        events : {\n            'click @ui.addTodo' : 'onCreateTodo',\n+           'click @ui.uploadButton' : 'onClickUploadButton',\n        },\n\n        initialize: function(options){\n @@ -74,7 +77,34 @@ define(function(require) {\n                message += errors.validationError[key];\n            }\n            alert(message);\n-       }\n+       },\n+       \n+       onClickUploadButton : function() {\n+           var i;\n+           var form = new FormData();\n+           var files = this.ui.uploadFile[0].files;\n+           for ( i = 0; i < files.length; i++) {\n+               form.append(i, files[i]);\n+           }\n+           var that = this;\n+           $.ajax({\n+               url : \"todo_lists/upload.json\",\n+               type : \"POST\",\n+               data : form,\n+               processData : false,\n+               contentType : false,\n+               dataType : 'json'\n+           }).done(function(data) {\n+               alert(data);\n+           }).always(function(){\n+               that.collection.fetch({\n+                   reset : true\n+               });\n+               that.ui.uploadFile.attr('type', 'text');\n+               that.ui.uploadFile.attr('type', 'file');\n+           });\n+           return false;\n+       },\n    });\n    return TodoCompositeView;\n }); \n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nTh\u00eam ph\u1ea7n ch\u1ecdn file v\u00e0 upload button v\u00e0o bi\u1ebfn ui.\nB\u1ea1n khai b\u00e1o s\u1ef1 ki\u1ec7n lick v\u00e0o button Upload v\u00e0o bi\u1ebfn events\n\nH\u00e0m OnClickUploadButton ch\u00ednh l\u00e0 ph\u1ea7n upload b\u1eb1ng AJAX m\u00e0 m\u00ecnh s\u1ebd implement.\n\n\nUpload b\u1eb1ng Jquery.ajax()\nTh\u1eddi \u0111i\u1ec3m n\u00e0y, ph\u1ea7n upload m\u00ecnh s\u1eedu d\u1ee5ng h\u00e0m ajax c\u1ee7a jquery. \u0110\u1eb7c \u0111i\u1ec3m c\u1ee7a ch\u00fang nh\u01b0 sau.\n\nN\u00f3 s\u1ebd nh\u1eadn form data c\u1ee7a file \u0111\u01b0\u1ee3c ch\u1ecdn trong html5 c\u1ee7a \u0111\u1ed1i t\u01b0\u1ee3ng FormData.\nPh\u00e0n t\u1eed \u0111\u1ec3 th\u00eam v\u00e0o FormData l\u00e0 m\u1ea3ng this.ui.uploadFile[0].files. N\u1ebfu b\u1ea1n ch\u1ecdn 2 file, v\u00ec n\u00f3 \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef \u1edf this.ui.uploadFile[0].files[0] v\u00e0 this.ui.uploadFile[0]afiles[1] m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng v\u00f2ng l\u1eb7p for \u0111\u1ec3 x\u1eed l\u00fd.\n\nthat.ui.uploadFile.attr('type', 'text'); -> that.ui.uploadFile.attr('type', 'file'); B\u1ea1n \u0111ang g\u1eb7p kh\u00f3 kh\u0103n, tuy nhi\u00ean n\u00f3 ch\u1ec9 x\u1ea3y ra sau khi upload ho\u00e0n t\u1ea5t, b\u1edfi m\u00ecnh m\u00ecnh mu\u1ed1n return file t\u1edbi ph\u1ea7n ch\u01b0a \u0111\u01b0\u1ee3c ch\u1ecdn, c\u00f3 m\u1ed9t hack l\u00e0 m\u00ecnh s\u1ebd cho form tr\u1edf l\u1ea1i t\u1eeb 'text' sang file. N\u00f3 c\u00f3 th\u1ec3 kh\u00f4ng ho\u1ea1t \u0111\u1ed9ng v\u1edbi tr\u00ecnh duy\u1ec7t.\n\n\napp/Controller/TodoListsController.php\nN\u00f3 s\u1ebd x\u1eed l\u00fd file \u0111\u01b0\u1ee3c upload l\u00ean \u0111\u1ec3 \u0111\u01b0a v\u00e0o TODO. .\n\napp/Controller/TodoListsController.php\n\n\u301c\u7565\u301c\n    public function download() {\n\n\n       \u301c\u7565\u301c\n\n    }\n\n+   public function upload() {\n+       $files = $this->request->params['form'];\n+       $owner = $this->Auth->user()['id'];\n+       $numTodos = 0;\n+       foreach ( $files as $file ) {\n+           $fileName = $file['name'];\n+           $filePath = $file['tmp_name'];\n+           $todos = file($filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);\n+           $assignee = $owner;\n+           $errors = array ();\n+           $lineNo = 1;\n+           foreach ( $todos as $todo ) {\n+               $data = array ();\n+               $data['todo'] = $todo;\n+               $data['status'] = 0;\n+               $data['owner'] = $owner;\n+               $data['assignee'] = $assignee;\n+               $res = $this->TodoList->save($data);\n+               if ($res) {\n+                   $numTodos++;\n+               } else {\n+                   if (count($this->TodoList->validationErrors) > 0) {\n+                       foreach ( $this->TodoList->validationErrors as $validationErrorsOfLine ) {\n+                           $title = 'file:' . $fileName . ' - line: ' . $lineNo . ': ';\n+                           foreach ( $validationErrorsOfLine as $validationError ) {\n+                               $errors[] = array (\n+                                               $title . $validationError\n+                               );\n+                           }\n+                       }\n+                   }\n+               }\n+               $this->TodoList->create();\n+               $lineNo++;\n+           }\n+       }\n+       if (count($errors) > 0) {\n+           $this->TodoList->validationErrors = $errors;\n+           $response = $this->editResponse(false);\n+           array_unshift($response['errors'], array (\n+                           'The following error occurred.'\n+           ));\n+           if ($numTodos > 0) {\n+               array_unshift($response['errors'], array (\n+                               $numTodos . ' TODO are registered.'\n+               ));\n+           }\n+       } else {\n+           $response = $numTodos . ' TODO are registered.';\n+       }\n+       $this->set(compact('response'));\n+       $this->set('_serialize', 'response');\n+   }\n+\n    //\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u7de8\u96c6\n    private function editResponse($res){\n        if($res){\n            $response = $res;\n        }else{\n            $this->setStatusValidationError();\n            $respnse = array();\n            if(count($this->TodoList->validationErrors) > 0){\n                $response = $this->editErrors($this->TodoList->validationErrors);\n            }else{\n                $response = $this->editErrors('An error occured.');\n            }\n        }\n        return $response;\n    }\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nNh\u1eadn file sau khi \u0111\u00e3 \u0111\u01b0\u1ee3c upload, khai b\u00e1o \u0111\u1ec3 \u0111\u1ecdc m\u1ed7i h\u00e0ng todo m\u1ed9t ( Up t\u1ea1i file v\u1eeba download kh\u00f4ng \u0111\u01b0\u1ee3c nh\u00e9 v\u00ec c\u1ea5u tr\u00fac n\u00f3 kh\u00e1c, c\u00e1c b\u1ea1n th\u00eam m\u1ed7i h\u00e0ng m\u1ed9t n\u1ed9i dung TODO l\u00e0 \u0111\u01b0\u1ee3c ). X\u1eed l\u00fd validation gi\u1ed1ng nh\u01b0 m\u00ecnh \u0111\u00e3 l\u00e0m v\u1edbi button \"Add\" tr\u00ean m\u00e0n h\u00ecnh, m\u00ecnh s\u1ebd return messsage n\u1ebfu c\u00f3 l\u1ed7i.\n\nNh\u1eadn file \u0111\u00e3 Upload\n\nTh\u00f4ng tin c\u1ee7a c\u00e1c file \u0111\u01b0\u1ee3c upload s\u1ebd \u0111\u01b0\u1ee3c truy\u1ec1n \u0111\u1ebfn m\u1ed9t m\u1ea3ng b\u1eb1ng $this->request->params['form']. N\u1ebfu c\u00f3 2 file \u0111\u01b0\u1ee3c upload, truy\u1ec1n t\u1edbi $this->request->params['form'][0]v\u00e0 $this->request->params['form'][1]\n\nName s\u1ebd n\u1eb1m \u1edf $this->request->params['form'][0]['name'], t\u1ea1i $this->request->params['form'][0]['tmp_name'], path c\u1ee7a file \u0111\u01b0\u1ee3c upload s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o l\u00e0 m\u1ecdt file l\u01b0u tr\u1eef t\u1ea1m th\u1eddi tr\u00ean server.\n\n T\u00ean file v\u00e0 n\u1ed9i dung file \u0111\u01b0\u1ee3c l\u01b0u \u1edf nhi\u1ec1u ph\u1ea7n trong request body v\u00ec v\u1eady tr\u00ecnh bi\u00ean d\u1ecbch c\u00f3 th\u1ec3 d\u1ec5 d\u00e0ng \u0111\u1ecdc n\u00f3, php v\u00e0 CakePHP \u0111\u00e3 gi\u00fap t\u00f4i l\u00e0m m\u1ecdi th\u1ee9.\n\nC\u00e1c h\u00e0m truy c\u1eadp v\u00e0o file c\u1ee7a PHP\n\nL\u01b0u tr\u1eef \u1edf m\u1ea3ng v\u00e0 c\u00f3 th\u1ec3 \u0111\u1ecdc t\u1ea5t c\u1ea3 c\u00e1c file \u0111\u00e3 upload b\u1eb1ng h\u00e0m file\n\n\n\n \u0110\u1eb7c \u0111i\u1ec3m\nNh\u1eefng g\u00ec b\u1ea1n \u0111ang l\u00e0m,\n\n\u0110\u1ecdc c\u00e1c file \u0111\u01b0\u1ee3c upload c\u00f9ng nhau\nM\u1ed7i todo tr\u00ean 1 d\u00f2ng cho t\u1ea5t c\u1ea3 c\u00e1c d\u00f2ng, set status = 0, owner = login user id, set assignee = login user id, save v\u00e0 l\u01b0u tr\u1eef v\u00e0o database b\u1eb1ng c\u00e1c method. V\u00e0 c\u0169ng th\u1ef1c hi\u1ec7n c\u00e1c bi\u1ec7n ph\u00e1p validation n\u00f3.\nV\u1edbi vi\u1ec7c nh\u00fang nh\u1eefng s\u1ed1 c\u00f3 th\u1ec3 khai b\u00e1o \u1edf message s\u1ebd \u0111\u01b0\u1ee3c return nh\u01b0 m\u1ed9t response body.\n\n\nT\u1ed5ng k\u1ebft b\u00e0i h\u1ecdc\nLet's try to upload the TODO is actually modified.\n\n\n app/Config/routes.php s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n app/View/Layouts/default.ctp s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n app/webroot/js/views/todo-composite-view.js s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n app/Controller/TodoListsController.php s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n\n Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n\n Commit l\u00ean Git\n\n Hi\u1ec3n th\u1ecb d\u1ea1ng Diff tr\u00ean Github\nCh\u01b0\u01a1ng 9 : B\u00e0i 2 - Upload \u00b7 suzukishouten-study/rest-study@3edd59f\n\u0110\u00f3 l\u00e0 t\u1ea5t c\u1ea3 b\u00e0i h\u1ecdc n\u00e0y\n\nGi\u1edbi thi\u1ec7u\nB\u00e0i vi\u1ebft ti\u1ebfp theo s\u1ebd l\u00e0 v\u1ec1  \"refactoring (s\u1eeda tr\u00ean server)\".\nM\u1eb7c d\u00f9 \u0111\u00e2y ch\u1ec9 l\u00e0 m\u1ed9t TODO app nh\u1ecf , nh\u01b0ng kh\u1ed1i l\u01b0\u1ee3ng code \u0111\u00e3 t\u0103ng d\u1ea7n t\u1eebng ch\u00fat m\u1ed9t.\nL\u1ea7n t\u1edbi ch\u00fang ta s\u1ebd h\u1ecdc c\u00e1ch l\u00e0m sao \u0111\u1ec3 d\u1ecdn d\u1eb9p code \u0111\u1ec3 chu\u1ea9n b\u1ecb cho c\u00e1c m\u00f4i tr\u01b0\u1eddng l\u1edbn h\u01a1n.\n\nC\u1ea3m \u01a1n c\u00e1c b\u1ea1n\nB\u00e0i vi\u1ebft \u0111\u00e3 k\u1ebft th\u00fac, n\u1ebfu c\u00f3 b\u1ea5t c\u1ee9 ph\u1ea3n h\u00f4i, g\u00f3p \u00fd hay th\u1eafc m\u1eafc n\u00e0o b\u1ea1n vui l\u00f2ng comment \u1edf d\u01b0\u1edbi nh\u00e9, c\u1ea3m \u01a1n c\u00e1c b\u1ea1n \u0111\u00e3 d\u00f5i theo b\u00e0i vi\u1ebft n\u00e0y v\u00e0 to\u00e0n b\u1ed9 series.\n\n## :large_blue_circle: Xin ch\u00e0o c\u00e1c b\u1ea1n\n\nB\u00e0i vi\u1ebft n\u00e0y m\u00ecnh d\u1ecbch t\u1eeb [\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6a5f\u80fd\u306e\u5b9f\u88c5 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e\u3010\u7b2c9\u56de\u3011\u30de\u30cb\u30e5\u30a2\u30eb](http://qiita.com/k_shimoji/items/904480b6aad09321619d) c\u1ee7a t\u00e1c gi\u1ea3 @k_shimoji.\n\n\n\n## :large_blue_circle: T\u1ea1i sao ch\u00fang ta c\u1ea7n ch\u1ee9c n\u0103ng download / upload\n\nCh\u1ee9c n\u0103ng n\u00e0y l\u00e0 r\u1ea5t ph\u1ed5 bi\u1ebfn s\u1eed d\u1ee5ng trong c\u00e1c h\u1ec7 th\u1ed1ng, v\u00ec v\u1eady ch\u00fang ta c\u1ea7n nghi\u00ean c\u1ee9u c\u00e1ch \u0111\u1ec3 implement n\u00f3. Ch\u00fang ta bi\u1ebft r\u1eb1ng r\u1eb1ng c\u00e1c web system ch\u1ea1y tr\u00ean \"HTTP\". Vi\u1ec7c implement kh\u00f4ng ph\u1ea3i l\u00e0 m\u1ee5c ti\u00eau c\u1ee7a b\u00e0i h\u1ecdc n\u00e0y, m\u1ee5c ti\u00eau ch\u00ednh l\u00e0 h\u1ecdc c\u00e1ch implement n\u00f3. Hi\u1ec7n t\u1ea1i c\u00f3 r\u1ea5t nhi\u1ec1u framework v\u1edbi nhi\u1ec1u layer gi\u00fap m\u00ecnh ch\u1ec9 c\u1ea7n thao t\u00e1c \u0111\u01a1n gi\u1ea3n \u1edf layer tr\u00ean c\u00f9ng, tuy nhi\u00ean m\u00ecnh s\u1ebd \u0111i s\u00e2u h\u01a1n m\u1ed9t t\u00ed, qua \u0111\u00f3 s\u1ebd hi\u1ec3u s\u00e2u h\u01a1n v\u1ec1 c\u00e1ch l\u00e0m.\n\nTr\u01b0\u1edbc khi b\u1eaft \u0111\u1ea7u l\u1eadp tr\u00ecnh, m\u00ecnh s\u1ebd xem qua v\u1ec1 HTTP\n\n\n## :large_blue_circle: Download C\u00f4ng vi\u1ec7c\n\n\u0110\u1ea7u ti\u00ean, \u0111\u1ecbnh ngh\u0129a download l\u00e0 \"L\u01b0u n\u1ed9i dung nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server v\u00e0o m\u00e1y n\u1ed9i b\u1ed9 c\u1ee7a b\u1ea1n (local) \", C\u00f4ng vi\u1ec7c \"l\u01b0u v\u00e0o local\" th\u1ef1c s\u1ef1 \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n th\u00f4ng qua tr\u00ecnh duy\u1ec7t.\nTuy nhi\u00ean nh\u1eefng \"content nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server\" c\u00f3 c\u1ea5u tr\u00fac nh\u01b0 th\u1ebf n\u00e0o, ch\u00fang ta s\u1ebd c\u00f9ng xem.\n\n### C\u1ea5u tr\u00fac c\u1ee7a HTTP response\n\nHTTP l\u00e0 m\u1ed9t giao th\u1ee9c ki\u1ec3u client/server; client \u0111\u01b0a ra c\u00e1c request, v\u00e0 server s\u1ebd tr\u1ea3 l\u1eddi c\u00e1c request n\u00e0y. C\u1ea5u tr\u00fac c\u00e1c HTTP message v\u00ec th\u1ebf c\u0169ng thay \u0111\u1ed5i theo y\u1ebfu t\u1ed1 n\u00e0y. C\u00f3 m\u1ed9t \u0111\u1ecbnh d\u1ea1ng cho HTTP request v\u00e0 cho c\u00e1c response.\n\"N\u1ed9i dung nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server\" l\u00e0 ph\u1ea3n h\u1ed3i HTTP \u0111\u01b0\u1ee3c tr\u1ea3 v\u1ec1 t\u1eeb server, n\u00f3 bao g\u1ed3m nh\u1eefng ph\u1ea7n li\u00ean quan v\u00e0 m\u1ed9t ph\u1ea7n g\u1ecdi l\u00e0 \"response body\".\nNh\u1eefng ph\u1ea3n h\u1ed3i sau \u0111\u00e2y l\u00e0 nh\u1eefng ph\u1ea3n h\u1ed3i nh\u1eadn \u0111\u01b0\u1ee3c khi b\u1ea1n request \u0111\u1ebfn trang ch\u1ee7 c\u1ee7a Yahoo, \u0111\u00e2y l\u00e0 c\u1ea5u tr\u00fac HTTP response c\u1ee7a n\u00f3\n\n- D\u00f2ng 1: Protocol / version the response code -> `HTTP/1.1 200 OK`\n- 2 d\u00f2ng sau: (multi-line) response header -> `Server: nginx`, `Date: Thu, 24 Sep 2015 09:11:53 GMT`, `Content-Type: text/html; charset=UTF-8`...\n- M\u1ed9t d\u00f2ng tr\u1ed1ng\n- Sau d\u00f2ng tr\u1ed1ng l\u00e0 n\u1ed9i dung c\u1ee7a response body -> `<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML...`\u301c\n\nC\u1ee5 th\u1ec3 n\u00f3 nh\u01b0 th\u1ebf n\u00e0y\n\n```xml:\u4f8b)yahoo\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\nHTTP/1.1 200 OK\nServer: nginx\nDate: Thu, 24 Sep 2015 09:11:53 GMT\nContent-Type: text/html; charset=UTF-8\nTransfer-Encoding: chunked\nConnection: close\nP3P: policyref=\"http://privacy.yahoo.co.jp/w3c/p3p_jp.xml\", CP=\"CAO DSP COR CUR ADM DEV TAI PSA PSD IVAi IVDi CONi TELo OTPi OUR DELi SAMi OTRi UNRi PUBi IND PHY ONL UNI PUR FIN COM NAV INT DEM CNT STA POL HEA PRE GOV\"\nCache-Control: private, no-cache, no-store, must-revalidate\nExpires: -1\nPragma: no-cache\nX-XRDS-Location: https://open.login.yahooapis.jp/openid20/www.yahoo.co.jp/xrds\nVary: Accept-Encoding\nX-Frame-Options: SAMEORIGIN\n\n<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\" \"http://www.w3.org/TR/html4/loose.dtd\">\n<html>\n<head>\n<meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\">\n<meta http-equiv=\"content-style-type\" content=\"text/css\">\n<meta http-equiv=\"content-script-type\" content=\"text/javascript\">\n<meta name=\"description\" content=\"Japan's largest portal site. Search, auctions, news, mail, community, shopping, more than 80 services, including the deployment. We will continue to aim to \"life engine\" to enrich your life.\">\n<meta name=\"robots\" content=\"noodp\">\n<title>Yahoo! JAPAN</title>\n\n\u301c\u4ee5\u4e0b\u7701\u7565\u301c\n```\n\nCh\u1ec9 c\u00f3 n\u1ed9i dung trong ph\u1ea7n body c\u1ee7a HTTP response c\u00f3 th\u1ec3 l\u1ea5y v\u00e0 cho ph\u00e9p \"download\", kh\u00f4ng ph\u1ea3i nh\u1eefng format \u0111\u00e3 thay \u0111\u1ed5i n\u00e0y.\nHay n\u00f3i c\u00e1ch kh\u00e1c, vi\u1ec7c \"download\" c\u0169ng gi\u1ed1ng nh\u01b0 vi\u1ec7c \"l\u01b0u nh\u1eefng response body nh\u1eadn \u0111\u01b0\u1ee3c t\u1eeb server xu\u1ed1ng local th\u00f4ng qua tr\u00ecnh duy\u1ec7t.\"\n### \u0110\u1ec3 l\u01b0u response body th\u00f4ng qua tr\u00ecnh duy\u1ec7t\n\nN\u00f3i chung l\u00e0 \u0111\u1ec3 \"download\" th\u00ec ch\u00fang ta ph\u1ea3i th\u1ef1c hi\u1ec7n l\u01b0u \"response body\" tr\u00ean tr\u00ecnh duy\u1ec7t. \u1ede v\u00ed d\u1ee5 tr\u00ean v\u1ec1 trang ch\u1ee7 yahoo, n\u00f3 \u0111\u00e3 tr\u1ea3 v\u1ec1 HTML tr\u00ean response body. L\u00fac n\u00e0y, tr\u00ecnh duy\u1ec7t ( v\u1edbi m\u1ed9t s\u1ed1 file ngo\u1ea1i l\u1ec7 ) l\u01b0u ch\u00fang xu\u1ed1ng m\u00e1y local, v\u00e0 v\u1ebd l\u1ea1i ch\u00fang \u1edf c\u1eeda s\u1ed5 tr\u00ecnh duy\u1ec7t.\nTr\u00ean tr\u00ecnh duy\u1ec7t, \u0111\u1ec3 \"hi\u1ec3n th\u1ecb\" response body \u0111\u00e3 nh\u1eadn \u0111\u01b0\u1ee3c ho\u1eb7c \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh c\u00f3 l\u01b0u hay kh\u00f4ng.\nC\u00f3 nh\u1eefng l\u1eddi khuy\u00ean r\u1eb1ng, kh\u00f4ng ch\u1ec9 \"response header\" ch\u1ee9a c\u00e1c meta-information v\u1ec1 ph\u1ea3n h\u1ed3i.\nTrong s\u1ed1 ch\u00fang th\u00ec tr\u00ecnh duy\u1ec7t ch\u1ee7 y\u1ebfu x\u00e1c \u0111\u1ecbnh nh\u1eefng th\u00e0nh ph\u1ea7n nh\u01b0 `Content-Type` v\u00e0 `Content-Disposition`.\n\n- Content-Type\n\t- N\u1ebfu response body l\u00e0 `text/html` ngh\u0129a l\u00e0 n\u00f3 l\u00e0 HTML, c\u0169ng nh\u01b0 tr\u00ean server side l\u00e0 JSON n\u1ebfu set l\u00e0 `application/json`.\nM\u1ed9t khi tr\u00ecnh duy\u1ec7t \u0111\u1ecdc \u0111\u01b0\u1ee3c `Content-Type`, N\u00f3 s\u1ebd ch\u1ea1y nh\u1eefng h\u00e0nh \u0111\u1ed9ng m\u1eb7c \u0111\u1ecbnh cho c\u00e1c n\u1ed9i dung, v\u00ed d\u1ee5 n\u00f3 s\u1ebd hi\u1ec3n th\u1ecb n\u1ebfu \"display\" l\u00e0 m\u1eb7c \u0111\u1ecbnh, l\u01b0u n\u1ebfu \"save\" l\u00e0 m\u1eb7c \u0111\u1ecbnh.\n- Content-Disposition\n\t- `attachment` hay `inline` t\u00f4i s\u1ebd set \u1edf server side. N\u1ebfu b\u1ea1n mu\u1ed1n l\u01b0u `attachment`, m\u00ecnh kh\u00f4ng c\u1ea7n request t\u1edbi tr\u00ecnh duy\u1ec7t n\u1ebfu b\u1ea1n mu\u1ed1n hi\u1ec3n th\u1ecb `inline` v\u00e0 n\u00f3 s\u1ebd \u0111\u01b0\u1ee3c set t\u1ea1i server side. V\u00ec nh\u1eefng h\u00e0nh vi m\u1eb7c \u0111\u1ecbnh c\u1ee7a tr\u00ecnh duy\u1ec7t c\u00f3 ch\u00fat kh\u00e1c bi\u1ec7t \u1edf m\u1ed7i tr\u00ecnh duy\u1ec7t, `Content-Type` n\u00f3 c\u00f3 th\u1ec3 \u0111\u01b0\u1ee3c set ch\u1ec9 khi `Content-Disposition` c\u0169ng \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh \u1edf v\u00e0i tr\u00ecnh duy\u1ec7t \u0111\u00e1ng tin c\u1eady l\u00e0 \"\u0110\u01b0\u1ee3c ph\u00e9p download.\"\n\n\u1ede b\u00e0i h\u1ecdc n\u00e0y,\n\n- M\u00ecnh s\u1ebd set n\u1ed9i dung sao cho c\u00f3 th\u1ec3 download \u0111\u01b0\u1ee3c v\u00e0o response body\n- N\u00f3 s\u1ebd set gi\u00e1 tr\u1ecb response header\n\nCh\u00fang ta h\u00e3y c\u00f9ng xem v\u1ec1 n\u1ed9i dung c\u1ea7n implement\n\n## :large_blue_circle: Ch\u1ee9c n\u0103ng Upload\n\nV\u1edbi vi\u1ec7c upload, n\u00f3 l\u00e0 c\u00e1ch file \u0111\u01b0\u1ee3c g\u1eedi \u0111i\nH\u00e3y xem c\u1ea5u tr\u00fac c\u1ee7a HTTP request.\n\n### C\u1ea5u tr\u00fac c\u1ee7a HTTP request\n\nC\u1ea5u tr\u00fac c\u1ee7a HTTP request t\u01b0\u01a1ng t\u1ef1 c\u1ea5u tr\u00fac c\u1ee7a HTTP response.\nFile c\u1ea7n di chuy\u1ec3n trong c\u00e1c request \u0111\u01b0\u1ee3c g\u1eedi, n\u00f3 s\u1ebd \u0111\u01b0\u1ee3c g\u1eedi b\u1eb1ng c\u00e1ch include n\u00f3 \u1edf trong m\u1ed9t ph\u1ea7n \u0111\u01b0\u1ee3c tr\u1ecf \u0111\u1ebfn nh\u01b0 l\u00e0 \"request body\".\nRequest khi b\u1ea1n th\u1ef1c s\u1ef1 g\u1eedi 1 file th\u00f4ng qua h\u00e0m upload s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o nh\u01b0 sau.\nM\u00ecnh v\u00ed d\u1ee5 upload 2 file `todolist1.txt`, `todolist2.txt` c\u00f9ng m\u1ed9t l\u00fac.\n\n```xml:FileUpload'sRequest\nPOST /rest-study/todo_lists/upload.json HTTP/1.1\nHost: 10.0.1.206\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:42.0) Gecko/20100101 Firefox/42.0\nAccept: application/json, text/javascript, */*; q=0.01\nAccept-Language: ja,en-US;q=0.7,en;q=0.3\nAccept-Encoding: gzip, deflate\nReferer: http://10.0.1.206/rest-study/\nX-Requested-With: XMLHttpRequest\nContent-Length: 779\nContent-Type: multipart/form-data; boundary=---------------------------1395431092341454357747073315\nCookie: CAKEPHP=oo6gj167d4fltodm3nre2lskd2\nConnection: keep-alive\nPragma: no-cache\nCache-Control: no-cache\n\n-----------------------------1395431092341454357747073315\nContent-Disposition: form-data; name=\"0\"; filename=\"todolist1.txt\"\nContent-Type: text/plain\n\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO1\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO2\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO3\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO4\n\u0110\u00e3 upload t\u1eeb todolist1.txt t\u1edbi TODO5\n\n\n-----------------------------1395431092341454357747073315\nContent-Disposition: form-data; name=\"1\"; filename=\"todolist2.txt\"\nContent-Type: text/plain\n\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO1\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO2\n\u0110\u00e3 upload t\u1eeb todolist2.txt t\u1edbi TODO3\n\n\n-----------------------------1395431092341454357747073315--\n```\n\n\nHTTP method l\u00e0 `POST`, B\u1ea1n c\u1ea7n truy c\u1eadp v\u00e0o URL `/rest-study/todo_lists/upload.json`.\nCh\u00fa \u00fd\n- `Content-Type: multipart/form-data; boundary=---------------------------1395431092341454357747073315`\n- `Content-Length: 779`\n\nC\u00f3 2 HTTP request header.\n\n\u0110\u1ea7u ti\u00ean, b\u1ea1n n\u00ean check format c\u1ee7a the HTTP request.\n\n\n- D\u00f2ng 1: HTTP method URI protocol / version -> `POST /rest-study/todo_lists/upload.json HTTP / 1.1`\n- 2 D\u00f2ng ti\u1ebfp theo: (multi-line) request header -> `Host: 10.0.1.206`,` User-Agent: Mozilla / 5.0 (Macintosh; Intel Mac OS X 10.10; rv: 42.0) Gecko / 20100101 Firefox / 42.0` ...\n- D\u00f2ng tr\u1ed1ng\n- Sau d\u00f2ng tr\u1ed1ng l\u00e0 t\u1ea5t request body -> `-----------------------------1395431092341454357747073315`\u301c\n\nN\u00f3 s\u1ebd tr\u1edf th\u00e0nh\n\n### multipart/form-data\n\n\nN\u1ebfu `Content-Type` kh\u00f4ng ph\u1ea3i `multipart/form-data`, V\u00ed d\u1ee5 n\u00f3 l\u00e0 `application/json`, th\u00ec n\u00f3 s\u1ebd nh\u01b0 d\u01b0\u1edbi \u0111\u00e2y.\n\n```json:V\u00edD\u1ee5C\u00e1cRequestKhiB\u1ea1nTh\u00eamTODO\n{\"todo\":\"Register the TODO in the Add button\",\"status\":0,\"assignee\":\"67\"}\n```\n\nNgo\u1ea1i tr\u1eeb multipart/form-data, JSON data c\u1ea7n truy\u1ec1n \u0111i s\u1ebd \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef theo c\u00e1ch c\u1ee7a n\u00f3 t\u1edbi request body.\n\nRequest body truy\u1ec1n trong multipart/form-data c\u00f3 c\u00e1c chu\u1ed7i ph\u00e2n c\u00e1ch , v\u00ed d\u1ee5 `----------------------------- M\u1ed9t chu\u1ed7i k\u00fd t\u1ef1 nh\u01b0 Ichisankyu5431092341454357747073315`.\nFormat n\u00e0y \u0111\u01b0\u1ee3c x\u00e1c \u0111\u1ecbnh \u1edf request header `Content-Type` `multipart/form-data`.\nNh\u01b0 c\u00e1i t\u00ean \u0111\u00e3 n\u00f3i l\u00ean t\u1ea5t c\u1ea3, request body \u0111\u00e3 \u0111\u01b0\u1ee3c chia th\u00e0nh r\u1ea5t nhi\u1ec1u ph\u1ea7n ri\u00eang bi\u1ec7t v\u1edbi r\u1ea5t nhi\u1ec1u chu\u1ed7i ph\u00e2n c\u00e1ch.\nV\u00e0 n\u00f3 tr\u1edf th\u00e0nh m\u1ed9t c\u1ea5u tr\u00fac l\u01b0\u1edbi ch\u1ee9a nh\u1eefng request header v\u00e0 request body cho m\u1ed7i ph\u1ea7n.\n\n\n\u1ede b\u00e0i h\u1ecdc n\u00e0y,\n\n- Ti\u1ebfn h\u00e0nh upload file tr\u00ean Ajax\n- L\u1ea5y v\u1ec1 n\u1ed9i dung file t\u1eeb request\n- T\u1ea1o TODO t\u1eeb nh\u1eefng n\u1ed9i dung xu\u1ea5t ra\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd xem qua c\u00e1c n\u1ed9i dung c\u1ea7n implement.\nTuy nhi\u00ean, ph\u1ea7n \"nh\u1eadn n\u1ed9i dung file t\u1eeb request\" r\u1ea5t d\u1ec5 d\u00e0ng v\u00ec PHP v\u00e0 CakePHP \u0111\u00e3 gi\u1ea3i quy\u1ebft h\u1ea7u h\u1ebft ch\u00fang r\u1ed3i!\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd implement lu\u00f4n ph\u1ea7n \"Upload file\" tr\u00ean Ajax. N\u1ed9i dung chi ti\u1ebft \u1edf nh\u01b0 sau.\n\n## :large_blue_circle: N\u1ed9i dung\n\n\u0110\u00e2y l\u00e0 h\u00ecnh \u1ea3nh sau khi ho\u00e0n t\u1ea5t vi\u1ec7c implement\n\n![demo.PNG](https://qiita-image-store.s3.amazonaws.com/0/94375/62ef6cd0-c2e7-ccb1-029b-82edf7ef9cbb.png)\n\n- Link download\n   - TODO list xu\u1ea5t hi\u1ec7n khi b\u1ea1n click v\u00e0o download \u1edf \u0111\u1ecbnh d\u1ea1ng CSV.\n- Ch\u1ecdn file \u0111\u1ec3 upload\n   - N\u1ebfu b\u1ea1n click v\u00e0o n\u00fat \"Ch\u1ecdn file\", m\u1ed9t c\u1eeda s\u1ed5 xu\u1ea5t hi\u1ec7n, c\u00e1c b\u1ea1n h\u00e3y ch\u1ecdn c\u00e1c file b\u1ea1n mu\u1ed1n upload.\n- Upload button\n   - Ch\u1ea1y vi\u1ec7c upload khi b\u1ea1n click v\u00e0o.\nC\u1ea7n ch\u00fa \u00fd r\u1eb1ng, file b\u1ea1n mu\u1ed1n upload nh\u01b0 \u1edf v\u00ed d\u1ee5 sau, n\u00f3 s\u1ebd l\u00e0 m\u1ed7i n\u1ed9i dung TODO m\u1ed9t d\u00f2ng, kh\u00f4ng k\u00e8m theo owner v\u00e0 assigner, v\u00e0 c\u1ea7n \u0111\u01b0\u1ee3c th\u00eam v\u00e0o v\u1ecb tr\u00ed c\u1ee7a TODO ch\u01b0a ho\u00e0n th\u00e0nh ngh\u0129a l\u00e0 status b\u1eb1ng 0. Khi b\u1ea1n th\u00eam TODO, b\u1ea1n c\u00f3 th\u1ec3 s\u1eed d\u1ee5ng chung validation nh\u01b0 th\u00eam b\u1eb1ng \"Add\" button n\u1ebfu mu\u1ed1n.\n\n```text:ViDuUploadFile(todolist1.txt)\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO1\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO2\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO3\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO4\nUpload t\u1eeb todolist1.txt \u0111\u1ebfn TODO5\n```\n\n### M\u1ee5c l\u1ee5c b\u00e0i h\u1ecdc\n\n- Chu\u1ea9n b\u1ecb\n- B\u00e0i 1: Download\n- B\u00e0i 2: Upload\n\nB\u00e2y gi\u1edd ch\u00fang ta b\u1eaft \u0111\u1ea7u n\u00e0o\n                                                                                                                                                                                     \n\n## :large_blue_circle: Chu\u1ea9n b\u1ecb\n\nPh\u1ea7n chu\u1ea9n b\u1ecb s\u1ebd gi\u1ed1ng nhau \u1edf m\u1ed7i b\u00e0i, v\u00ec v\u1eady t\u00f4i \u0111\u00e3 t\u1ed5ng h\u1ee3p n\u00f3 \u1edf m\u1ed9t entry ri\u00eang. C\u00e1c b\u1ea1n vui l\u00f2ng xem \u1edf link n\u00e0y [All 12 times of study sessions in do I have use of Git - RESTful application workshops will be built on AWS ~ Web development workshop ~ - Qiita](http://qiita.com/k_shimoji/items/6a66dbb93b0553fa7c7f) \u0111\u1ec3 chu\u1ea9n b\u1ecb .\n\n- Git: B\u00e2y gi\u1edd m\u00ecnh s\u1ebd t\u1ea1o branch `vol/09` v\u00e0 l\u00e0m vi\u1ec7c tr\u00ean n\u00f3.\n\nOK, b\u01b0\u1edbc \u0111\u1ea7u \u0111\u00e3 xong\n\n:warning: *** T\u00f4i xin nh\u1eafc l\u1ea1i \u1edf b\u00e0i 5 v\u00e0 b\u00e0i 6, ch\u00fang ta \u0111\u00e3 c\u00f3 nh\u1eefng table b\u1ecb thay \u0111\u1ed5i. ***\n\n- B\u00e0i 5\n  - T\u1ea1o Table d\u00e0nh cho vi\u1ec7c \u0111\u0103ng k\u00fd th\u00e0nh vi\u00ean ( Th\u1ef1c hi\u1ec7n cho ch\u1ee9c n\u0103ng login )\n- B\u00e0i 6\n  - Th\u00eam m\u1ed9t c\u1ed9t cho table TODO list ( Th\u00eam c\u1ed9t Owner v\u00e0 c\u1ed9t assignee cho ch\u1ee9c n\u0103ng ph\u00e2n c\u00f4ng c\u00f4ng vi\u1ec7c)\n\nC\u00e1c b\u1ea1n n\u00ean tham kh\u1ea3o l\u1ea1i c\u00e1c link sau \u0111\u1ec3 r\u00f5 h\u01a1n.\n[T\u1ea1o Table d\u00e0nh cho vi\u1ec7c \u0111\u0103ng k\u00fd th\u00e0nh vi\u00ean](http://qiita.com/Takumi_Kasuga/items/c97e96fb91b83ed68782#t%E1%BA%A1o-table-cho-vi%E1%BB%87c-%C4%91%C4%83ng-k%C3%BD-user)\n[Th\u00eam m\u1ed9t c\u1ed9t cho table TODO list](http://qiita.com/Takumi_Kasuga/items/6d7506f8dc7de511bf14#large_blue_circle-chu%E1%BA%A9n-b%E1%BB%8B)\n\n\n\nB\u1eaft \u0111\u1ea7u \u0111\u1ebfn v\u1edbi b\u00e0i 1 th\u00f4i:\n\n## :large_blue_circle: B\u00e0i 1: Download\n\n- Client side\n  - Th\u00eam download link\n- Server side\n  - Return \u0111\u1ec3 xu\u1ea5t n\u1ed9i dung response body v\u00e0o m\u1ed9t CSV file b\u1eb1ng c\u00e1ch \u0111\u1ecdc TODO t\u1eeb database\n\nB\u00e2y gi\u1edd t\u00f4i s\u1ebd b\u1eaft \u0111\u1ea7u implement t\u1eebng c\u00e1i m\u1ed9t.\n\nFile format sau khi download v\u1ec1 n\u00f3 s\u1ebd nh\u01b0 sau, ph\u00e2n c\u00e1ch b\u1eb1ng c\u00e1c d\u1ea5u ph\u1ea9y,\n- id\n- todo: n\u1ed9i dung c\u1ee7a TODO\n- status: tr\u1ea1ng th\u00e1i\n- owner: t\u00ean owner\n- assignee: T\u00ean ng\u01b0\u1eddi \u0111\u01b0\u1ee3c ph\u00e2n c\u00f4ng\n\n\u0110\u00e2y l\u00e0 c\u1ea5u tr\u00fac file m\u00e0 ch\u00fang ta mu\u1ed1n. D\u00f2ng \u0111\u1ea7u ti\u00ean s\u1ebd l\u00e0 c\u00e1c title (l\u00fac upload kh\u00f4ng ph\u1ea3i \u0111\u1ecbnh d\u1ea1ng n\u00e0y nh\u00e9, file c\u1ea7n upload ch\u1ec9 c\u00f3 n\u1ed9i dung m\u1ed7i TODO m\u1ed7i d\u00f2ng th\u00f4i )\n\n```bash:FileFormatTwoDownload\nid, todo, status, owner, assignee\n1, buy the milk, 1, Taro Yamada, Taro Yamada\n2, call home, 1, Tanaka Hanako, Taro Yamada\n3, walk the dog, 1, Taro Yamada, Taro Yamada\n```\n\n### C\u00e1c file c\u1ea7n ch\u1ec9nh s\u1eeda\n\n|Thao t\u00e1c|file|\u00dd ngh\u0129a|\n|---|:---------------------------------------|:----------------------|\n|S\u1eeda| app/Config/routes.php                  |Th\u00eam ti\u1ebfn tr\u00ecnh download v\u00e0o route\n|S\u1eeda| app/View/Layouts/default.ctp           |Th\u00eam n\u00fat download\n|S\u1eeda| app/Controller/TodoListsController.php |C\u00e1c ti\u1ebfn tr\u00ecnh b\u1ed5 sung\n\n\n\n### app/Config/routes.php\n\nM\u00ecnh s\u1ebd th\u00eam URL cho ti\u1ebfn tr\u00ecnh download\u3002\n\n```diff:app/Config/routes.php\n\n\u301c\u7565\u301c\n \n /*\n  * API\n  */\n \n // \u30ed\u30b0\u30a4\u30f3\n Router::connect('/users/login', array (\n \t'controller' => 'users',\n \t'action' => 'login',\n \t'method' => array (\n \t\t'POST'\n \t)\n ));\n \n // \u30ed\u30b0\u30a2\u30a6\u30c8\n Router::connect('/users/logout', array (\n \t'controller' => 'users',\n \t'action' => 'logout',\n \t'method' => 'POST'\n ));\n \n // \u30ed\u30b0\u30a4\u30f3\u30c1\u30a7\u30c3\u30af(\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u53d6\u5f97)\n Router::connect('/users/loggedin', array (\n \t'controller' => 'users',\n \t'action' => 'loggedIn',\n \t'method' => 'GET'\n ));\n \n // \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\n Router::connect('/users/signup', array (\n \t'controller' => 'users',\n \t'action' => 'signUp',\n \t'method' => array (\n \t\t'POST'\n \t)\n ));\n \n+// CSV\u30d5\u30a1\u30a4\u30eb\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n+Router::Connect('/todo_lists/download', Array(\n+\t'controller' => 'todo_lists',\n+\t'action' => 'download',\n+\t'method' => 'GET'\n+));\n \n Router::mapResources(array (\n \t'todo_lists',\n ));\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n```\n\n- Th\u00eam `/todo_lists/download`.\n- M\u00ecnh s\u1ebd routing khi truy c\u1eadp v\u00e0o `download` method c\u1ee7a `TodoListController.php` b\u1eb1ng ph\u01b0\u01a1ng th\u1ee9c GET .\n\n\n### app/View/Layouts/default.ctp\n\nTh\u00eam button \"download\"\n\n```diff:app/View/Layouts/default.ctp\n\n\u301c\u7565\u301c\n\n \t<!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-composite-template\">\n \t\t<div class=\"row\">\n \t\t\t<div class=\"col-xs-12\">\n \t\t\t\t<span class=\"row form-inline\">\n \t\t\t\t\t<div class=\"input-group col-sm-6 col-xs-12\">\n \t\t\t\t\t\t<label for=\"new-todo\" class=\"visible-xs\">Todo</label>\n \t\t\t\t\t\t<textarea class=\"form-control todo-item-text\" rows=\"3\" id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"input-group col-sm-3 col-xs-12\">\n \t\t\t\t\t\t<label for=\"user-list\" class=\"visible-xs\">Assignee</label>\n \t\t\t\t\t\t<select class=\"form-control\" name=\"assignee\" id=\"user-list\"></select>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"input-group col-sm-3 col-xs-12\">\n \t\t\t\t\t\t<label class=\"visible-xs\"></label>\n \t\t\t\t\t\t<input type=\"button\" id=\"addTodo\" class=\"btn btn-primary btn-md todo-action-button\" value=\"\u8ffd\u52a0\">\n \t\t\t\t\t</div>\n \t\t\t\t</span>\n \t\t\t</div>\n \t\t</div>\n \t\t<div class=\"row\">\n \t\t\t<div class=\"col-xs-12\">\n \t\t\t\t<table class=\"table table-striped table-bordered table-hover\">\n \t\t\t\t\t<thead>\n \t\t\t\t\t\t<tr class=\"success\">\n \t\t\t\t\t\t\t<th class=\"col-sm-6\" colspan=\"2\">ToDo</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\">Owner</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\">Assignee</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\" colspan=\"2\"></th>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t</thead>\n \t\t\t\t\t<tbody></tbody>\n \t\t\t\t</table>\n \t\t\t</div>\n \t\t</div>\n+\t\t<div class=\"row\">\n+\t\t\t<div class=\"col-xs-6\">\n+\t\t\t\t<a href=\"/rest-study/todo_lists/download\" class=\"alert alert-default pull-left\" id=\"downloadTodo\">Download TODO list</a>\n+\t\t\t</div>\n+\t\t</div>\n \t</script>\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n```\n\n- Ch\u1ec9 th\u00eam m\u1ed9t c\u1eb7p th\u1ebb `<a>`, link m\u00ecnh s\u1ebd set th\u00e0nh `/rest-study/todo_lists/download` nh\u01b0 \u0111\u00e3 \u0111\u01b0\u1ee3c th\u00eam \u1edf `app/Config/routes.php` .\n\n\n\n### app/Controller/TodoListsController.php\n\nB\u1eaft \u0111\u1ea7u ti\u1ebfn tr\u00ecnh download\n\n```diff:app/Controller/TodoListsController.php\n\n\u301c\u7565\u301c\n\n \tpublic function index() {\n \t\t$query = array (\n \t\t\t'fields' => $this->fields,\n \t\t\t'order' => \"TodoList.id\"\n \t\t);\n \t\t$res = $this->TodoList->find('all', $query);\n \t\t// \u6574\u5f62\n \t\tif (count($res) > 0) {\n \t\t    $loginUserId = $this->Auth->user()['id'];\n \t\t\tforeach ( $res as $key => $row ) {\n \t\t\t    //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n \t\t\t\t$res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n \t\t\t    //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n \t\t\t\t$res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n \t\t\t}\n \t\t}\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n \t\n\u301c\u4e2d\u7565\u301c\n \t\n \tpublic function edit($id) {\n \t\t$this->TodoList->id = $id;\n \t\t$data = $this->request->data;\n \t\t$res = $this->TodoList->save($this->request->data);\n \t\t$res = !empty($res);\n \t\t$response = $this->editResponse($res);\n \t\t$this->set(compact('response'));\n \t\t$this->set('_serialize', 'response');\n \t}\n \n+\tpublic function download() {\n+\t\t//id\u9806\u3067\u4e00\u89a7\u53d6\u5f97\n+\t\t$query = array (\n+\t\t\t'fields' => $this->fields,\n+\t\t\t'order' => \"TodoList.id\"\n+\t\t);\n+\t\t$res = $this->TodoList->find('all', $query);\n+\t\t// CSV\u30d5\u30a1\u30a4\u30eb\u306b\u6574\u5f62\n+\t\tif ($res && is_array($res)) {\n+\t\t\t$fp = fopen('php://temp', 'w+');\n+\t\t\t//\u30bf\u30a4\u30c8\u30eb\n+\t\t\t$fields = array('id', 'todo', 'status', 'owner' ,'assignee');\n+\t\t\tfputcsv($fp, $fields);\n+\t\t\t//\u30c7\u30fc\u30bf\n+\t\t\tforeach ( $res as $record ) {\n+\t\t\t    $fields = array();\n+\t\t\t    $fields[] = $record['TodoList']['id'];\n+\t\t\t    $fields[] = $record['TodoList']['todo'];\n+\t\t\t    $fields[] = $record['TodoList']['status'];\n+\t\t\t    $fields[] = $record['Owner']['name'];\n+\t\t\t    $fields[] = $record['Assignee']['name'];\n+\t\t\t\tfputcsv($fp, $fields);\n+\t\t\t}\n+\t\t\t//B\u1eaft \u0111\u1ea7u v\u1edbi pointer\n+\t\t\trewind($fp);\n+\t\t\t//\u0110\u1ecdc file\n+\t\t\t$content = stream_get_contents($fp);\n+\t\t\t//m\u00e3 hi\u1ec7n t\u1ea1i \u0111ang l\u00e0 UTF-8\n+\t\t\t//Excel kh\u00f4ng \u0111\u1ecdc \u0111\u01b0\u1ee3c m\u00e3 n\u00e0y, v\u00ec v\u1eady m\u00ecnh s\u1ebd chuy\u1ec3n n\u00f3 th\u00e0nh SJIS-win\n+\t\t\t//$content =  mb_convert_encoding($content, 'sjis-win', 'UTF-8');\n+\t\t\tfclose($fp);\n+\t\t\t//Kh\u00f4ng xem view\n+\t\t\t$this->autoRender = false;\n+\t\t\t//\u0110\u1eb7t t\u00ean file download\n+\t\t\t$this->response->download('todo.csv');\n+\t\t\t$this->response->type('csv');\n+\t\t\t$this->response->body($content);\n+\t\t}\n+\t}\n+\n \t//Edit response\n \tprivate function editResponse($res){\n \t\tif($res){\n \t\t\t$response = $res;\n \t\t}else{\n \t\t\t$this->setStatusValidationError();\n \t\t\t$respnse = array();\n \t\t\tif(count($this->TodoList->validationErrors) > 0){\n \t\t\t\t$response = $this->editErrors($this->TodoList->validationErrors);\n \t\t\t}else{\n \t\t\t\t$response = $this->editErrors('An error occured.');\n \t\t\t}\n \t\t}\n \t\treturn $response;\n \t}\n \n \u301c\u4ee5\u4e0b\u7565\u301c\n \n```\n\nTh\u00eam h\u00e0m `download`\n\n#### Thu th\u1eadp data\n\n- L\u1ea5y todo list \u1edf `$this->TodoList->find('all', $query);`. N\u00f3 gi\u1ed1ng nh\u1eefng g\u00ec b\u1ea1n \u0111ang l\u00e0m \u1edf h\u00e0m `index` tr\u00ean kia.\n\n#### H\u00e0m truy c\u1eadp v\u00e0o file php\n\n- S\u1eed d\u1ee5ng c\u00e1c h\u00e0m sau \u0111\u00e2y, b\u1ea1n c\u00f3 th\u1ec3 vi\u1ebft `php;//temp` v\u00e0o cu\u1ed1i csv format data c\u1ee7a TODO list.\n\t- T\u1ea1i h\u00e0m [fopen](http://php.net/manual/en/function.fopen.php), [php://temp](http://php.net/manual/en/wrappers.php.php) m\u1edf k\u1ebft n\u1ed1i t\u1edbi file output tr\u00ean b\u1ed9 nh\u1edb\n\t- Output c\u1ee7a CSV format n\u1eb1m b\u00ean tr\u00e1i h\u00e0nh \u0111\u1ed9ng c\u1ee7a h\u00e0m [fputcsv](http://php.net/manual/en/function.fputcsv.php).\n\t- S\u1ebd tr\u1ea3 nh\u1eefng ph\u1ea7n \u0111\u1ea7u ti\u00ean c\u1ee7a file pointer \u1edf h\u00e0m [rewind](http://php.net/manual/en/function.rewind.php),\n\t- \u0110\u1ecdc l\u1ea1i data l\u00e0 output c\u1ee7a h\u00e0m [stream_get_contents](http://php.net/manual/en/function.stream-get-contents.php) tr\u00ean m\u1ea3ng.\n\t- H\u00e0m [fclose - Manual](http://php.net/manual/en/function.fclose.php) d\u00f9ng \u0111\u1ec3 \u0111\u00f3ng file.\n\n#### :point_up: Ch\u00fa \u00fd\n\n\u0110\u00e2y l\u00e0  quy tr\u00ecnh\n\u0110\u1ec3 \"download\" file xu\u1ed1ng tr\u00ecnh duy\u1ec7t,\n\n- Set n\u00f3 th\u00e0nh CSV file trong `Content-Type`\n- X\u00e1c \u0111\u1ecbnh t\u00ean file v\u1edbi c\u00e1c \u0111\u00ednh k\u00e8m c\u1ee5 th\u1ec3 c\u1ea7n download \u1edf `Content-Disposition`\n\nB\u1ea1n c\u1ea7n l\u00e0m c\u1ea3 2.\n\n- `$this->response->download('todo.csv');`\n\t- M\u00ecnh s\u1ebd s\u1eed d\u1ee5ng method `CakeResponse`-> `download` trong CakePHP, `Content-Disposition: attachment; filename=\"todo.csv\"` s\u1ebd \u0111\u01b0\u1ee3c set\n- `$this->response->type('csv');`\n\t- N\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng method `CakeResponse`-> `type` c\u1ee7a CakePHP, set th\u00e0nh `Content-Type: text/csv; charset=UTF-8`\n- `$this->response->body($content)`\n\t- N\u1ebfu b\u1ea1n s\u1eed d\u1ee5ng method `CakeResponse`-> `body` c\u1ee7a CakePHP,  n\u1ed9i dung c\u1ee7a response body s\u1ebd \u0111\u01b0\u1ee3c set b\u1eb1ng bi\u1ebfn `$content`.\n\nTr\u00ecnh duy\u1ec7t s\u1ebd th\u1ef1c hi\u1ec7n vi\u1ec7c \"download\" nh\u01b0 tr\u00ean.\n\n:warning: V\u1edbi vi\u1ec7c comment \u0111i ph\u1ea7n return c\u1ee7a `$this->response->download('todo.csv');` v\u00e0 `$this->response->type('csv')`, M\u00ecnh s\u1ebd xem c\u00e1ch x\u1eed l\u00fd tr\u00ean c\u00e1c tr\u00ecnh duy\u1ec7t kh\u00e1c nhau, b\u1ea1n c\u00f3 th\u1ec3 th\u1ea5y m\u1ed9t s\u1ed1 s\u1ef1 kh\u00e1c bi\u1ec7t.\n\n\n### T\u00f3m t\u1eaft b\u00e0i h\u1ecdc\n\nLet's download the TODO is actually modified.\n\n- :white_check_mark: S\u1eeda `app/Config/routes.php` nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: S\u1eeda `app/View/Layouts/default.ctp`nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: S\u1eeda `app/Controller/TodoListsController.php` nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: Ki\u1ec3m tra k\u1ebft qu\u1ea3\n- :white_check_mark: Commit l\u00ean Git\n\n**:warning: Hi\u1ec3n th\u1ecb d\u01b0\u1edbi d\u1ea1ng Diff nh\u1eefng thay \u0111\u1ed5i tr\u00ean Github**\n\n\n[Ch\u01b0\u01a1ng  9: B\u00e0i 1 - Download \u00b7 suzukishouten-study/rest-study@ccb6d14](https://github.com/suzukishouten-study/rest-study/commit/ccb6d14741262fff84e08b2d08b582755b5d742d)\n\n\u0110\u00e3 xong ch\u1ee9c n\u0103ng download, chuy\u1ec3n qua b\u00e0i 2 n\u00e0o !\n\n\n## :large_blue_circle: B\u00e0i 2: Upload\n\n- Client side\n   - Th\u00eam button Upload v\u00e0 ph\u1ea7n \"Ch\u1ecdn file\"\n   - Th\u00eam ph\u1ea7n x\u1eed l\u00fd Upload b\u1eb1ng ajax\n- Server side\n   - \u0110\u1ecdc file \u0111\u01b0\u1ee3c upload l\u00ean v\u00e0 th\u00eam v\u00e0o TODO\n\nB\u00e2y gi\u1edd m\u00ecnh s\u1ebd implement l\u1ea7n l\u01b0\u1ee3t ch\u00fang.\n\nFile format c\u00f3 th\u1ec3 t\u1ea3i v\u1ec1 m\u1ed7i d\u00f2ng m\u1ed9t Todo nh\u01b0 sau.\n\n```bash:ViDuUpload(todolist1.txt)\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO1\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO2\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO3\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO4\n\u0110\u00e3 upload t\u1eeb todolist1.txt v\u00e0o TODO5\n```\n\n\n\n### Nh\u1eefng file b\u1ea1n c\u1ea7n thay \u0111\u1ed5i\n\n| Thao t\u00e1c | file | \u00dd ngh\u0129a |\n|---|:---------------------------------------|:----------------------|\n|S\u1eeda| app/Config/routes.php                  |Th\u00eam routing cho ti\u1ebfn tr\u00ecnh download\n|S\u1eeda| app/View/Layouts/default.ctp           |Th\u00eam button upload v\u00e0 ch\u1ecdn file\n|S\u1eeda| app/webroot/js/views/todo-composite-view.js|Th\u00eam ti\u1ebfn tr\u00ecnh upload\n|S\u1eeda| app/Controller/TodoListsController.php |Th\u00eam ti\u1ebfn tr\u00ecnh upload file\n\n\n\n### app/Config/routes.php\n\nTh\u00eam URL cho ti\u1ebfn tr\u00ecnh Upload.\n\n```diff:app/Config/routes.php\n\n\u301c\u7565\u301c\n // CSV file downlaod\n Router::Connect('/todo_lists/download', Array(\n \t'controller' => 'todo_lists',\n \t'action' => 'download',\n \t'method' => 'GET'\n ));\n \n+// CSV file upload\n+Router::Connect('/todo_lists/upload', Array (\n+\t'controller' => 'todo_lists',\n+\t'action' => 'upload',\n+\t'method' => 'POST'\n+));\n+\n Router::mapResources(array (\n \t'todo_lists',\n ));\n \n \u301c\u4ee5\u4e0b\u7565\u301c\n \n```\n\n\n\n### app/View/Layouts/default.ctp\n\nTh\u00eam n\u00fat ch\u1ecdn file v\u00e0 upload button.\n\n```diff:app/View/Layouts/default.ctp\n\n\u301c\u7565\u301c\n \t<!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-composite-template\">\n \t\t<div class=\"row\">\n \t\t\t<div class=\"col-xs-12\">\n \t\t\t\t<span class=\"row form-inline\">\n \t\t\t\t\t<div class=\"input-group col-sm-6 col-xs-12\">\n \t\t\t\t\t\t<label for=\"new-todo\" class=\"visible-xs\">Todo</label>\n \t\t\t\t\t\t<textarea class=\"form-control todo-item-text\" rows=\"3\" id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"input-group col-sm-3 col-xs-12\">\n \t\t\t\t\t\t<label for=\"user-list\" class=\"visible-xs\">Assignee</label>\n \t\t\t\t\t\t<select class=\"form-control\" name=\"assignee\" id=\"user-list\"></select>\n \t\t\t\t\t</div>\n \t\t\t\t\t<div class=\"input-group col-sm-3 col-xs-12\">\n \t\t\t\t\t\t<label class=\"visible-xs\"></label>\n \t\t\t\t\t\t<input type=\"button\" id=\"addTodo\" class=\"btn btn-primary btn-md todo-action-button\" value=\"Add TODO\">\n \t\t\t\t\t</div>\n \t\t\t\t</span>\n \t\t\t</div>\n \t\t</div>\n \t\t<div class=\"row\">\n \t\t\t<div class=\"col-xs-12\">\n \t\t\t\t<table class=\"table table-striped table-bordered table-hover\">\n \t\t\t\t\t<thead>\n \t\t\t\t\t\t<tr class=\"success\">\n \t\t\t\t\t\t\t<th class=\"col-sm-6\" colspan=\"2\">ToDo</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\">Owner</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\">Assigner</th>\n \t\t\t\t\t\t\t<th class=\"col-sm-2\" colspan=\"2\"></th>\n \t\t\t\t\t\t</tr>\n \t\t\t\t\t</thead>\n \t\t\t\t\t<tbody></tbody>\n \t\t\t\t</table>\n \t\t\t</div>\n \t\t</div>\n \t\t<div class=\"row\">\n \t\t\t<div class=\"col-xs-6\">\n \t\t\t\t<a href=\"/rest-study/todo_lists/download\" class=\"alert alert-default pull-left\" id=\"downloadTodo\">Download TODO list</a>\n \t\t\t</div>\n+\t\t\t<div class=\"col-xs-6\">\n+\t\t\t\t<form class=\"form-inline\">\n+\t\t\t\t\t<input type=\"file\" id=\"uploadFile\" name=\"uploadFile\" multiple class=\"form-control\">\n+\t\t\t\t\t<a class=\"btn btn-info pull-right\" id=\"uploadButton\">Upload TODO list</a>\n+\t\t\t\t</form>\n+\t\t\t</div>\n \t\t</div>\n \t</script>\n \n \u301c\u4ee5\u4e0b\u7565\u301c\n \n```\n\n- D\u01b0\u1edbi link download, c\u00f3 `input type =\" file \"`, b\u1ea1n s\u1ebd th\u00eam m\u1ed9t button \u1edf th\u1ebb `<a>`.\n\t-  set `input type=\"file\"` l\u00e0 `multiple` \u0111\u1ec3 cho ph\u00e9p ch\u1ecdn upload nhi\u1ec1u file.\n\n### app/webroot/js/views/todo-composite-view.js\n\nM\u00ecnh s\u1ebd implement ph\u1ea7n Upload b\u1eb1ng AJAX\n\n```diff:app/webroot/js/views/todo-composite-view.js\n\n\u301c\u7565\u301c\n \t\tui : {\n \t\t\taddTodo : '#addTodo',\n \t\t\tnewTodo : '#new-todo',\n-\t\t\tuserList : '#user-list'\n+\t\t\tuserList : '#user-list',\n+\t\t\tuploadButton : '#uploadButton',\n+\t\t\tuploadFile : '#uploadFile'\n \t\t},\n \n \t\tevents : {\n \t\t\t'click @ui.addTodo' : 'onCreateTodo',\n+\t\t\t'click @ui.uploadButton' : 'onClickUploadButton',\n \t\t},\n \n \t\tinitialize: function(options){\n @@ -74,7 +77,34 @@ define(function(require) {\n \t\t\t\tmessage += errors.validationError[key];\n \t\t\t}\n \t\t\talert(message);\n-\t\t}\n+\t\t},\n+\t\t\n+\t\tonClickUploadButton : function() {\n+\t\t\tvar i;\n+\t\t\tvar form = new FormData();\n+\t\t\tvar files = this.ui.uploadFile[0].files;\n+\t\t\tfor ( i = 0; i < files.length; i++) {\n+\t\t\t\tform.append(i, files[i]);\n+\t\t\t}\n+\t\t\tvar that = this;\n+\t\t\t$.ajax({\n+\t\t\t\turl : \"todo_lists/upload.json\",\n+\t\t\t\ttype : \"POST\",\n+\t\t\t\tdata : form,\n+\t\t\t\tprocessData : false,\n+\t\t\t\tcontentType : false,\n+\t\t\t\tdataType : 'json'\n+\t\t\t}).done(function(data) {\n+\t\t\t\talert(data);\n+\t\t\t}).always(function(){\n+\t\t\t\tthat.collection.fetch({\n+\t\t\t\t\treset : true\n+\t\t\t\t});\n+\t\t\t\tthat.ui.uploadFile.attr('type', 'text');\n+\t\t\t\tthat.ui.uploadFile.attr('type', 'file');\n+\t\t\t});\n+\t\t\treturn false;\n+\t\t},\n \t});\n \treturn TodoCompositeView;\n }); \n\n\u301c\u4ee5\u4e0b\u7565\u301c\n```\n\n\n- Th\u00eam ph\u1ea7n ch\u1ecdn file v\u00e0 upload button v\u00e0o bi\u1ebfn `ui`.\n- B\u1ea1n khai b\u00e1o s\u1ef1 ki\u1ec7n lick v\u00e0o button Upload v\u00e0o bi\u1ebfn `events`\n- H\u00e0m `OnClickUploadButton` ch\u00ednh l\u00e0 ph\u1ea7n upload b\u1eb1ng AJAX m\u00e0 m\u00ecnh s\u1ebd implement.\n\n#### Upload b\u1eb1ng Jquery.ajax()\n\nTh\u1eddi \u0111i\u1ec3m n\u00e0y, ph\u1ea7n upload m\u00ecnh s\u1eedu d\u1ee5ng h\u00e0m ajax c\u1ee7a jquery. \u0110\u1eb7c \u0111i\u1ec3m c\u1ee7a ch\u00fang nh\u01b0 sau.\n\n- N\u00f3 s\u1ebd nh\u1eadn form data c\u1ee7a file \u0111\u01b0\u1ee3c ch\u1ecdn trong html5 c\u1ee7a \u0111\u1ed1i t\u01b0\u1ee3ng `FormData`.\n- Ph\u00e0n t\u1eed \u0111\u1ec3 th\u00eam v\u00e0o FormData l\u00e0 m\u1ea3ng `this.ui.uploadFile[0].files`. N\u1ebfu b\u1ea1n ch\u1ecdn 2 file, v\u00ec n\u00f3 \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef \u1edf `this.ui.uploadFile[0].files[0]` v\u00e0 `this.ui.uploadFile[0]afiles[1]` m\u00ecnh s\u1ebd s\u1eed d\u1ee5ng v\u00f2ng l\u1eb7p for \u0111\u1ec3 x\u1eed l\u00fd.\n- `that.ui.uploadFile.attr('type', 'text');` -> `that.ui.uploadFile.attr('type', 'file');` B\u1ea1n \u0111ang g\u1eb7p kh\u00f3 kh\u0103n, tuy nhi\u00ean n\u00f3 ch\u1ec9 x\u1ea3y ra sau khi upload ho\u00e0n t\u1ea5t, b\u1edfi m\u00ecnh m\u00ecnh mu\u1ed1n return file t\u1edbi ph\u1ea7n ch\u01b0a \u0111\u01b0\u1ee3c ch\u1ecdn, c\u00f3 m\u1ed9t hack l\u00e0 m\u00ecnh s\u1ebd cho form tr\u1edf l\u1ea1i t\u1eeb 'text' sang `file`. N\u00f3 c\u00f3 th\u1ec3 kh\u00f4ng ho\u1ea1t \u0111\u1ed9ng v\u1edbi tr\u00ecnh duy\u1ec7t.\n\n\n### app/Controller/TodoListsController.php\n\nN\u00f3 s\u1ebd x\u1eed l\u00fd file \u0111\u01b0\u1ee3c upload l\u00ean \u0111\u1ec3 \u0111\u01b0a v\u00e0o TODO. .\n\n```diff:app/Controller/TodoListsController.php\n\n\u301c\u7565\u301c\n\tpublic function download() {\n\n\n       \u301c\u7565\u301c\n\n\t}\n\n+\tpublic function upload() {\n+\t\t$files = $this->request->params['form'];\n+\t\t$owner = $this->Auth->user()['id'];\n+\t\t$numTodos = 0;\n+\t\tforeach ( $files as $file ) {\n+\t\t\t$fileName = $file['name'];\n+\t\t\t$filePath = $file['tmp_name'];\n+\t\t\t$todos = file($filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);\n+\t\t\t$assignee = $owner;\n+\t\t\t$errors = array ();\n+\t\t\t$lineNo = 1;\n+\t\t\tforeach ( $todos as $todo ) {\n+\t\t\t\t$data = array ();\n+\t\t\t\t$data['todo'] = $todo;\n+\t\t\t\t$data['status'] = 0;\n+\t\t\t\t$data['owner'] = $owner;\n+\t\t\t\t$data['assignee'] = $assignee;\n+\t\t\t\t$res = $this->TodoList->save($data);\n+\t\t\t\tif ($res) {\n+\t\t\t\t\t$numTodos++;\n+\t\t\t\t} else {\n+\t\t\t\t\tif (count($this->TodoList->validationErrors) > 0) {\n+\t\t\t\t\t\tforeach ( $this->TodoList->validationErrors as $validationErrorsOfLine ) {\n+\t\t\t\t\t\t\t$title = 'file:' . $fileName . ' - line: ' . $lineNo . ': ';\n+\t\t\t\t\t\t\tforeach ( $validationErrorsOfLine as $validationError ) {\n+\t\t\t\t\t\t\t\t$errors[] = array (\n+\t\t\t\t\t\t\t\t\t\t\t\t$title . $validationError\n+\t\t\t\t\t\t\t\t);\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t\t$this->TodoList->create();\n+\t\t\t\t$lineNo++;\n+\t\t\t}\n+\t\t}\n+\t\tif (count($errors) > 0) {\n+\t\t\t$this->TodoList->validationErrors = $errors;\n+\t\t\t$response = $this->editResponse(false);\n+\t\t\tarray_unshift($response['errors'], array (\n+\t\t\t\t\t\t\t'The following error occurred.'\n+\t\t\t));\n+\t\t\tif ($numTodos > 0) {\n+\t\t\t\tarray_unshift($response['errors'], array (\n+\t\t\t\t\t\t\t\t$numTodos . ' TODO are registered.'\n+\t\t\t\t));\n+\t\t\t}\n+\t\t} else {\n+\t\t\t$response = $numTodos . ' TODO are registered.';\n+\t\t}\n+\t\t$this->set(compact('response'));\n+\t\t$this->set('_serialize', 'response');\n+\t}\n+\n \t//\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u7de8\u96c6\n \tprivate function editResponse($res){\n \t\tif($res){\n \t\t\t$response = $res;\n \t\t}else{\n \t\t\t$this->setStatusValidationError();\n \t\t\t$respnse = array();\n \t\t\tif(count($this->TodoList->validationErrors) > 0){\n \t\t\t\t$response = $this->editErrors($this->TodoList->validationErrors);\n \t\t\t}else{\n \t\t\t\t$response = $this->editErrors('An error occured.');\n \t\t\t}\n \t\t}\n \t\treturn $response;\n \t}\n \n\u301c\u4ee5\u4e0b\u7565\u301c\n\n```\n\nNh\u1eadn file sau khi \u0111\u00e3 \u0111\u01b0\u1ee3c upload, khai b\u00e1o \u0111\u1ec3 \u0111\u1ecdc m\u1ed7i h\u00e0ng todo m\u1ed9t ( Up t\u1ea1i file v\u1eeba download kh\u00f4ng \u0111\u01b0\u1ee3c nh\u00e9 v\u00ec c\u1ea5u tr\u00fac n\u00f3 kh\u00e1c, c\u00e1c b\u1ea1n th\u00eam m\u1ed7i h\u00e0ng m\u1ed9t n\u1ed9i dung TODO l\u00e0 \u0111\u01b0\u1ee3c ). X\u1eed l\u00fd validation gi\u1ed1ng nh\u01b0 m\u00ecnh \u0111\u00e3 l\u00e0m v\u1edbi button \"Add\" tr\u00ean m\u00e0n h\u00ecnh, m\u00ecnh s\u1ebd return messsage n\u1ebfu c\u00f3 l\u1ed7i.\n\n#### Nh\u1eadn file \u0111\u00e3 Upload\n\n- Th\u00f4ng tin c\u1ee7a c\u00e1c file \u0111\u01b0\u1ee3c upload s\u1ebd \u0111\u01b0\u1ee3c truy\u1ec1n \u0111\u1ebfn m\u1ed9t m\u1ea3ng b\u1eb1ng `$this->request->params['form']`. N\u1ebfu c\u00f3 2 file \u0111\u01b0\u1ee3c upload, truy\u1ec1n t\u1edbi `$this->request->params['form'][0]`v\u00e0 `$this->request->params['form'][1]`\n- Name s\u1ebd n\u1eb1m \u1edf `$this->request->params['form'][0]['name']`, t\u1ea1i `$this->request->params['form'][0]['tmp_name']`, path c\u1ee7a file \u0111\u01b0\u1ee3c upload s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o l\u00e0 m\u1ecdt file l\u01b0u tr\u1eef t\u1ea1m th\u1eddi tr\u00ean server.\n\n:warning: T\u00ean file v\u00e0 n\u1ed9i dung file \u0111\u01b0\u1ee3c l\u01b0u \u1edf nhi\u1ec1u ph\u1ea7n trong request body v\u00ec v\u1eady tr\u00ecnh bi\u00ean d\u1ecbch c\u00f3 th\u1ec3 d\u1ec5 d\u00e0ng \u0111\u1ecdc n\u00f3, php v\u00e0 CakePHP \u0111\u00e3 gi\u00fap t\u00f4i l\u00e0m m\u1ecdi th\u1ee9.\n\n#### C\u00e1c h\u00e0m truy c\u1eadp v\u00e0o file c\u1ee7a PHP\n\n- L\u01b0u tr\u1eef \u1edf m\u1ea3ng v\u00e0 c\u00f3 th\u1ec3 \u0111\u1ecdc t\u1ea5t c\u1ea3 c\u00e1c file \u0111\u00e3 upload b\u1eb1ng h\u00e0m [file](http://php.net/manual/en/function.file.php)\n\n#### :point_up: \u0110\u1eb7c \u0111i\u1ec3m\n\nNh\u1eefng g\u00ec b\u1ea1n \u0111ang l\u00e0m,\n\n- \u0110\u1ecdc c\u00e1c file \u0111\u01b0\u1ee3c upload c\u00f9ng nhau\n- M\u1ed7i `todo` tr\u00ean 1 d\u00f2ng cho t\u1ea5t c\u1ea3 c\u00e1c d\u00f2ng, set `status = 0`, `owner = login user id`, set `assignee = login user id`, `save` v\u00e0 l\u01b0u tr\u1eef v\u00e0o database b\u1eb1ng c\u00e1c method. V\u00e0 c\u0169ng th\u1ef1c hi\u1ec7n c\u00e1c bi\u1ec7n ph\u00e1p validation n\u00f3.\n- V\u1edbi vi\u1ec7c nh\u00fang nh\u1eefng s\u1ed1 c\u00f3 th\u1ec3 khai b\u00e1o \u1edf message s\u1ebd \u0111\u01b0\u1ee3c return nh\u01b0 m\u1ed9t response body.\n   \n### T\u1ed5ng k\u1ebft b\u00e0i h\u1ecdc\n\nLet's try to upload the TODO is actually modified.\n\n- :white_check_mark: `app/Config/routes.php` s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: `app/View/Layouts/default.ctp` s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: `app/webroot/js/views/todo-composite-view.js` s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: `app/Controller/TodoListsController.php` s\u1eeda nh\u01b0 h\u01b0\u1edbng d\u1eabn tr\u00ean.\n- :white_check_mark: Ki\u1ec3m tra k\u1ebft qu\u1ea3.\n- :white_check_mark: Commit l\u00ean Git\n\n**:warning: Hi\u1ec3n th\u1ecb d\u1ea1ng Diff tr\u00ean Github**\n\n\n[Ch\u01b0\u01a1ng 9 : B\u00e0i 2 - Upload \u00b7 suzukishouten-study/rest-study@3edd59f](https://github.com/suzukishouten-study/rest-study/commit/3edd59f432b77009823e696af046dee46a6ea566?diff=split)\n\n\n\u0110\u00f3 l\u00e0 t\u1ea5t c\u1ea3 b\u00e0i h\u1ecdc n\u00e0y\n\n\n## Gi\u1edbi thi\u1ec7u\n\nB\u00e0i vi\u1ebft ti\u1ebfp theo s\u1ebd l\u00e0 v\u1ec1  \"refactoring (s\u1eeda tr\u00ean server)\".\nM\u1eb7c d\u00f9 \u0111\u00e2y ch\u1ec9 l\u00e0 m\u1ed9t TODO app nh\u1ecf , nh\u01b0ng kh\u1ed1i l\u01b0\u1ee3ng code \u0111\u00e3 t\u0103ng d\u1ea7n t\u1eebng ch\u00fat m\u1ed9t.\nL\u1ea7n t\u1edbi ch\u00fang ta s\u1ebd h\u1ecdc c\u00e1ch l\u00e0m sao \u0111\u1ec3 d\u1ecdn d\u1eb9p code \u0111\u1ec3 chu\u1ea9n b\u1ecb cho c\u00e1c m\u00f4i tr\u01b0\u1eddng l\u1edbn h\u01a1n.\n\n\n\n## C\u1ea3m \u01a1n c\u00e1c b\u1ea1n\nB\u00e0i vi\u1ebft \u0111\u00e3 k\u1ebft th\u00fac, n\u1ebfu c\u00f3 b\u1ea5t c\u1ee9 ph\u1ea3n h\u00f4i, g\u00f3p \u00fd hay th\u1eafc m\u1eafc n\u00e0o b\u1ea1n vui l\u00f2ng comment \u1edf d\u01b0\u1edbi nh\u00e9, c\u1ea3m \u01a1n c\u00e1c b\u1ea1n \u0111\u00e3 d\u00f5i theo b\u00e0i vi\u1ebft n\u00e0y v\u00e0 to\u00e0n b\u1ed9 series.\n", "tags": ["PHPCake", "PHP", "Backbone.js", "AWS", "amazonEC2"]}