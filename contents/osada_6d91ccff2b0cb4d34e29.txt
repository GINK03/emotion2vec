{"context": "\n\n\u52d5\u6a5f\n\u4ee5\u524d\u3001Builder\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u306b\u3064\u3044\u3066\u3054\u7d39\u4ecb\u3057\u307e\u3057\u305f\u304c\u3001\u30de\u30eb\u30c1\u30b7\u30b0\u4ee5\u5916\u306eP2SH\u306e\u30b5\u30dd\u30fc\u30c8\u304c\u306a\u3044\u3053\u3068\u3092\u307f\u307e\u3057\u305f\u3002\n\u305d\u306e\u305f\u3081\u3001\u4efb\u610f\u306eRedeemScript\u3092\u4f7f\u3063\u305fUTXO\u304b\u3089\u9001\u91d1\u306b\u5229\u7528\u3059\u308b\u306b\u306f\u3001\u81ea\u529b\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u624b\u9806\u3092\u3054\u7d39\u4ecb\u3057\u306a\u304c\u3089\u3001\u7f72\u540d\u304c\u3069\u306e\u3088\u3046\u306b\u4ed8\u3051\u3089\u308c\u308b\u306e\u304b\u898b\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u74b0\u5883\n\nbitcoind 0.12.1\nbitcoin-ruby 0.0.8\nopenassets-ruby 0.4.9 # API\u3084Util\u3092\u5229\u7528\n\u5b9f\u884c\u65e5\uff1a\u30002016-07-06\n\n\n\u4e8b\u524d\u77e5\u8b58\n2\u30b5\u30a4\u30c8\u3092\u3054\u7d39\u4ecb\u3002\n\u300cBitcoin\u3092\u6280\u8853\u7684\u306b\u7406\u89e3\u3059\u308b \u300d\nhttp://www.slideshare.net/kenjiurushima/20140602-bitcoin1-201406031222?next_slideshow=1\nP.30\u4ee5\u964d\u3001\u7279\u306b\u3001P.34\u304b\u3089\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u7f72\u540d\u751f\u6210\u65b9\u6cd5\u306f\u5927\u5909\u5206\u304b\u308a\u3084\u3059\u3044\u7d75\u304c\u3042\u308a\u307e\u3059\u3002\nP2PKH\u306e\u57fa\u672c\u7684\u306a\u7f72\u540d\u306e\u3084\u308a\u65b9\u304c\u7406\u89e3\u3067\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u30a4\u30e1\u30fc\u30b8\u3060\u3051\u306a\u3093\u3068\u306a\u304f\u7406\u89e3\u3067\u304d\u308c\u3070OK\u3002\n\u300cCHECKLOCKTIMEVERIFY\u3067\u6307\u5b9a\u671f\u9593\u307e\u3067\u8cc7\u91d1\u3092\u51cd\u7d50\u300d\nhttp://techmedia-think.hatenablog.com/entry/2016/05/31/184257\nP2SH\u306e\u5b9f\u8df5\u7684\u306a\u4f7f\u3044\u65b9\u304c\u7406\u89e3\u3067\u304d\u307e\u3059\u3002\n\u5206\u304b\u308a\u3084\u3059\u3044\u8a18\u4e8b\u3092\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bUrushima\u69d8\u3068\u3001\u696d\u52d9\u3067\u4f7f\u3048\u308b\u5b9f\u8df5\u7684\u306a\u30c6\u30af\u30cb\u30c3\u30af\u3092\u3054\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bAzuchi\u69d8\u306b\u611f\u8b1d\u3044\u305f\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3059\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\n\n\n\n\u756a\u53f7\n\u5165\u529b\u90e8\uff08vin\uff09\n\u51fa\u529b\u90e8\uff08vout\uff09\n\n\n\n\n1\nP2SH\u5b9b\u306b\u9001\u4ed8\u3055\u308c\u305f600satoshi\n\u3042\u308b\u5b9b\u5148A\uff08P2PKH\uff09\u306b600satoshi\n\n\n2\nP2PKH\u5b9b\u306b\u9001\u4ed8\u3055\u308c\u305f1BTC\n\u3042\u308b\u5b9b\u5148A\uff08P2PKH\uff09\u306b0.998BTC\n\n\n\n\u203b \u300c\u5165\u529b\u90e8\u306e\u5408\u8a08\u300d\u3068\u300c\u51fa\u529b\u90e8\u306e\u5408\u8a08\u300d\u3068\u306e\u5dee\u306f\u3001\u624b\u6570\u6599\u306b\u76f8\u5f53\u3002\n\n\u521d\u671f\u8a2d\u5b9a\n# \u30e2\u30b8\u30e5\u30fc\u30eb\u30ed\u30fc\u30c9\nrequire 'bitcoin'\nrequire 'openassets'\nrequire 'pp'\ninclude Bitcoin::Util\n\n# \u304a\u307e\u3058\u306a\u3044\nBitcoin.network = :testnet3\n\n### use zero confirmation\noa_api = OpenAssets::Api.new({:network => 'testnet',\n:provider => 'bitcoind', :cache => 'testnet.db',\n:dust_limit => 600, :default_fees => 10000,\n:min_confirmation => 0, :max_confirmation => 9999999,\n:rpc => {:user => 'osada', :password => 'password', :schema => 'http',\n:port => 18332, :host => 'localhost'}})\n\n\nUTXO\u306e\u6307\u5b9a\nUTXO\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u305f\u3081\u306b\u3001bitcoin-cli\u306elistunspent\u30b3\u30de\u30f3\u30c9\u306a\u3069\u304b\u3089\u3001txid\u3068vout\u3092\u53d6\u308a\u51fa\u3057\u3066\u3001\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3002\n# 0: P2SH\u5b9b\u306b\u9001\u3089\u308c\u305fUTXO(600satoshi)\n# p2sh_addr           = '2NDideGsDwZSZSVo9X87zHB8ijYRzNQgdfR'\n# P2SH\u3067locktime\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\"locked\"\u3068prefix\u3092\u3064\u3051\u308b\u3002\nlocked_prev_txid      = 'a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f'\nlocked_prev_out_index = 1\nfrom_addr             = 'n4ZjDj9GArupgYd5fnCgHbQJYzw6W7EXsg'\n\n# 1: P2PKH\u5b9b\u306b\u9001\u3089\u308c\u305fUTXO(1BTC)\n# \u305f\u304f\u3055\u3093BTC\u3092\u6301\u3064\u306e\u3067\u3001\"rich\"\u3068prefix\u3092\u3064\u3051\u308b\u3002\nrich_prev_txid        = '0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc'\nrich_prev_out_index   = 1\nrich_addr             = 'muFzFv487hXbejWom1AfrmJB79ZWRGVLDK'\n\n# \u9001\u91d1\u5148\uff08P2PKH\u306e\u30a2\u30c9\u30ec\u30b9\uff09\nto = 'mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP'\n\n# Locktime\uff1a\u4eca\u56de\u306eP2SH\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u5229\u7528\u3059\u308b\u3082\u306e\u3002\nlocktime = 117\n\n\u7f72\u540d\u306b\u4f7f\u3046\u9375\uff08\u79d8\u5bc6\u9375\u3068\u516c\u958b\u9375\uff09\u3084RedeemScript\uff08\u672c\u4f53\uff09\u3092\u30bb\u30c3\u30c8\u3002\n\n\u9375\u306e\u751f\u6210\n\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u3001\u79d8\u5bc6\u9375\u3092\u62bd\u51fa\u3059\u308b\u3002\n# P2SH\u306eRedeemScript\u304c\u6307\u5b9a\u3059\u308b\u516c\u958b\u9375\uff08\u306e\u30cf\u30c3\u30b7\u30e5\u306b\u5bfe\u5fdc\u3059\u308b\u30a2\u30c9\u30ec\u30b9\uff09\u3092\u6307\u5b9a\nfrom_priv_key = oa_api.provider.dumpprivkey(from_addr)\n# => \"cV3pVBgTCdZM2Hp3udWsMhS69HRXXYZZZfppb6Hmwu5xgMhtCMvT\" \nfrom_key_obj  = Bitcoin::Key.from_base58(from_priv_key)\n# => #<Bitcoin::Key:0x007fd66b924c50 @key=#<OpenSSL::PKey::EC:0x007fd66b924c00 @group=nil>, @pubkey_compressed=true> \n\n# P2PKH\u306e\u9375\u3092\u62bd\u51fa\nrich_priv_key = oa_api.provider.dumpprivkey(rich_addr)\n# => \"cP3gdtj8ZWDLKaHekhySbYtBDDn97dRvyx9oKnc4mfbpUWUpYFqC\" \nrich_key_obj  = Bitcoin::Key.from_base58(rich_priv_key)\n# => #<Bitcoin::Key:0x007fd66a0e75e8 @key=#<OpenSSL::PKey::EC:0x007fd66a0e7598 @group=#<OpenSSL::PKey::EC::Group:0x007fd66a14f2d8 @key=#<OpenSSL::PKey::EC:0x007fd66a0e7598 ...>>>, @pubkey_compressed=true> \n\n\u3053\u3053\u3067\u3001P2SH\u30a2\u30c9\u30ec\u30b9\u306f\u4f7f\u308f\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3002P2SH\u306f\u3001RedeemScript\u306e\u30cf\u30c3\u30b7\u30e5\u3067\u3042\u3063\u3066\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3067\u306f\u306a\u3044\u3002\u3088\u3063\u3066\u3001\u3053\u308c\u3092\u3082\u3068\u306b\u9375\u3092\u62bd\u51fa\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u306a\u306e\u3067\u3001RedeemScript\u5185\u3067\u6307\u5b9a\u3055\u308c\u308b\u516c\u958b\u9375\u306b\u5bfe\u5fdc\u3059\u308b\u79d8\u5bc6\u9375\u3092\u62bd\u51fa\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f\u3001\u305d\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u300cfrom_addr\u300d\u3068\u547c\u3076\u3002\n\nUTXO\u306e\u53d6\u5f97\ntxid\u304c\u793a\u3059\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3002\n# P2SH\u306eUTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\nlocked_prev_tx_bin = oa_api.provider.getrawtransaction(locked_prev_txid)\n# => \"0100000007969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a000000006a473044022067d3c6fc4cd827ce29647590b89756f349a49bb5574155d0656dea3e715417ed022017f729d07f521b1c5ee6cd805f2889fe839db9abc297a8719f48bb6aa90317f901210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a010000006a473044022047108df8e00b12d392947b6a3c0e96050f4340e3db1c3f2429a1ff0efa0a3fd1022071ca80e4c1706b364c9911f874880b76c85903b25e315f0917749001c54cc44601210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a020000006a47304402206935d1902891f29318a5b8c80626f992e2106e532729413dcc5bc94cba68fade02202c831f182c7b10d13e3fc60cad47df997645a1a41fc1cc6c1e77cb22de565d9a01210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a030000006a473044022015322b898dfde14cdc5b84e8c6dfb2b383236b57a85e36735b99fc84e8eb0cc7022066f5665b77241c3517d2e88a419fa5f64657c757f12299c85b86290689ba259801210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a040000006b48304502210085e176d3bdbbad87791cc9419984d057083b39d48c9c43430d4db48adf51255e02204336ac890e2c53e1c716dac6c725a5632c73c3fa67e5144e04d2d342eded836701210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a050000006b483045022100b7cac45a8dfe0b2eb4d190743d995eaac02baa31b4ef35e50b6730e451a27acf0220630edd8d67eb835204141023da734ba8da161a5765ce3c64f480665b9471fac401210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff38a425c047b095e52b6a78f4cc1407279ddc1f8821d732c5fcbb6099b8e96740010000006b483045022100d4c29b327bd153d45a5546aed214cce6ac31d0d61e21d2b1dba30626187a6f02022059f4076ad8f722fb3655eac159f279943a01f03e7b0d7c6809d6f183cb584f9701210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff080000000000000000146a124f41010006cf03cf03cf03cf03cf03cf0300580200000000000017a914e0917e2b61266ebffcdd931985bf32431409a71887580200000000000017a914f11890e00326c39e91ac4eb63963305b7cc5f0d287580200000000000017a914c1d5eb5b0d3bcfb281e8b4c2b2d500543c7696a587580200000000000017a9145dc04da167645f9e333a2ededf09c399abba279d87580200000000000017a9143b4afd0231eb35a5745a3dd694848c177ddda3e287580200000000000017a914df86617a5d92ef50287d26faca01e3350147b9c187f0b9f505000000001976a914de7ff8730cf8a5533a1e794f214289e5d5fe1e5388ac00000000\" \nlocked_prev_tx     = Bitcoin::Protocol::Tx.new(locked_prev_tx_bin.htb)\n# => #<Bitcoin::Protocol::Tx:0x007fd66a01d810 @scripts=[], @out=[#<Bitcoin::Protocol::TxOut:0x007fd66a01c550 @value=0, @pk_script_length=20, @pk_script=\"j\\x12OA\\x01\\x00\\x06\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\x00\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c3c0 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xE0\\x91~+a&n\\xBF\\xFC\\xDD\\x93\\x19\\x85\\xBF2C\\x14\\t\\xA7\\x18\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c208 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xF1\\x18\\x90\\xE0\\x03&\\xC3\\x9E\\x91\\xACN\\xB69c0[|\\xC5\\xF0\\xD2\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c028 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xC1\\xD5\\xEB[\\r;\\xCF\\xB2\\x81\\xE8\\xB4\\xC2\\xB2\\xD5\\x00T<v\\x96\\xA5\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017e38 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14]\\xC0M\\xA1gd_\\x9E3:.\\xDE\\xDF\\t\\xC3\\x99\\xAB\\xBA'\\x9D\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017c58 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14;J\\xFD\\x021\\xEB5\\xA5tZ=\\xD6\\x94\\x84\\x8C\\x17}\\xDD\\xA3\\xE2\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017ac8 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xDF\\x86az]\\x92\\xEFP(}&\\xFA\\xCA\\x01\\xE35\\x01G\\xB9\\xC1\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017938 @value=99990000, @pk_script_length=25, @pk_script=\"v\\xA9\\x14\\xDE\\x7F\\xF8s\\f\\xF8\\xA5S:\\x1EyO!B\\x89\\xE5\\xD5\\xFE\\x1ES\\x88\\xAC\">], @in=[#<Bitcoin::Protocol::TxIn:0x007fd66a01d608 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=0, @script_sig_length=106, @script_sig=\"G0D\\x02 g\\xD3\\xC6\\xFCL\\xD8'\\xCE)du\\x90\\xB8\\x97V\\xF3I\\xA4\\x9B\\xB5WAU\\xD0em\\xEA>qT\\x17\\xED\\x02 \\x17\\xF7)\\xD0\\x7FR\\e\\x1C^\\xE6\\xCD\\x80_(\\x89\\xFE\\x83\\x9D\\xB9\\xAB\\xC2\\x97\\xA8q\\x9FH\\xBBj\\xA9\\x03\\x17\\xF9\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01d3d8 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=1, @script_sig_length=106, @script_sig=\"G0D\\x02 G\\x10\\x8D\\xF8\\xE0\\v\\x12\\xD3\\x92\\x94{j<\\x0E\\x96\\x05\\x0FC@\\xE3\\xDB\\x1C?$)\\xA1\\xFF\\x0E\\xFA\\n?\\xD1\\x02 q\\xCA\\x80\\xE4\\xC1pk6L\\x99\\x11\\xF8t\\x88\\vv\\xC8Y\\x03\\xB2^1_\\t\\x17t\\x90\\x01\\xC5L\\xC4F\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01d1a8 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=2, @script_sig_length=106, @script_sig=\"G0D\\x02 i5\\xD1\\x90(\\x91\\xF2\\x93\\x18\\xA5\\xB8\\xC8\\x06&\\xF9\\x92\\xE2\\x10nS')A=\\xCC[\\xC9L\\xBAh\\xFA\\xDE\\x02 ,\\x83\\x1F\\x18,{\\x10\\xD1>?\\xC6\\f\\xADG\\xDF\\x99vE\\xA1\\xA4\\x1F\\xC1\\xCCl\\x1Ew\\xCB\\\"\\xDEV]\\x9A\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01cfa0 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=3, @script_sig_length=106, @script_sig=\"G0D\\x02 \\x152+\\x89\\x8D\\xFD\\xE1L\\xDC[\\x84\\xE8\\xC6\\xDF\\xB2\\xB3\\x83#kW\\xA8^6s[\\x99\\xFC\\x84\\xE8\\xEB\\f\\xC7\\x02 f\\xF5f[w$\\x1C5\\x17\\xD2\\xE8\\x8AA\\x9F\\xA5\\xF6FW\\xC7W\\xF1\\\"\\x99\\xC8[\\x86)\\x06\\x89\\xBA%\\x98\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01cd98 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=4, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\x85\\xE1v\\xD3\\xBD\\xBB\\xAD\\x87y\\x1C\\xC9A\\x99\\x84\\xD0W\\b;9\\xD4\\x8C\\x9CCC\\rM\\xB4\\x8A\\xDFQ%^\\x02 C6\\xAC\\x89\\x0E,S\\xE1\\xC7\\x16\\xDA\\xC6\\xC7%\\xA5c,s\\xC3\\xFAg\\xE5\\x14N\\x04\\xD2\\xD3B\\xED\\xED\\x83g\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01caf0 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=5, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xB7\\xCA\\xC4Z\\x8D\\xFE\\v.\\xB4\\xD1\\x90t=\\x99^\\xAA\\xC0+\\xAA1\\xB4\\xEF5\\xE5\\vg0\\xE4Q\\xA2z\\xCF\\x02 c\\x0E\\xDD\\x8Dg\\xEB\\x83R\\x04\\x14\\x10#\\xDAsK\\xA8\\xDA\\x16\\x1AWe\\xCE<d\\xF4\\x80f[\\x94q\\xFA\\xC4\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01c898 @prev_out_hash=\"8\\xA4%\\xC0G\\xB0\\x95\\xE5+jx\\xF4\\xCC\\x14\\a'\\x9D\\xDC\\x1F\\x88!\\xD72\\xC5\\xFC\\xBB`\\x99\\xB8\\xE9g@\", @prev_out_index=1, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xD4\\xC2\\x9B2{\\xD1S\\xD4ZUF\\xAE\\xD2\\x14\\xCC\\xE6\\xAC1\\xD0\\xD6\\x1E!\\xD2\\xB1\\xDB\\xA3\\x06&\\x18zo\\x02\\x02 Y\\xF4\\aj\\xD8\\xF7\\\"\\xFB6U\\xEA\\xC1Y\\xF2y\\x94:\\x01\\xF0>{\\r|h\\t\\xD6\\xF1\\x83\\xCBXO\\x97\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">], @lock_time=0, @ver=1, @enable_bitcoinconsensus=false, @payload=\"\\x01\\x00\\x00\\x00\\a\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x00\\x00\\x00\\x00jG0D\\x02 g\\xD3\\xC6\\xFCL\\xD8'\\xCE)du\\x90\\xB8\\x97V\\xF3I\\xA4\\x9B\\xB5WAU\\xD0em\\xEA>qT\\x17\\xED\\x02 \\x17\\xF7)\\xD0\\x7FR\\e\\x1C^\\xE6\\xCD\\x80_(\\x89\\xFE\\x83\\x9D\\xB9\\xAB\\xC2\\x97\\xA8q\\x9FH\\xBBj\\xA9\\x03\\x17\\xF9\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x01\\x00\\x00\\x00jG0D\\x02 G\\x10\\x8D\\xF8\\xE0\\v\\x12\\xD3\\x92\\x94{j<\\x0E\\x96\\x05\\x0FC@\\xE3\\xDB\\x1C?$)\\xA1\\xFF\\x0E\\xFA\\n?\\xD1\\x02 q\\xCA\\x80\\xE4\\xC1pk6L\\x99\\x11\\xF8t\\x88\\vv\\xC8Y\\x03\\xB2^1_\\t\\x17t\\x90\\x01\\xC5L\\xC4F\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x02\\x00\\x00\\x00jG0D\\x02 i5\\xD1\\x90(\\x91\\xF2\\x93\\x18\\xA5\\xB8\\xC8\\x06&\\xF9\\x92\\xE2\\x10nS')A=\\xCC[\\xC9L\\xBAh\\xFA\\xDE\\x02 ,\\x83\\x1F\\x18,{\\x10\\xD1>?\\xC6\\f\\xADG\\xDF\\x99vE\\xA1\\xA4\\x1F\\xC1\\xCCl\\x1Ew\\xCB\\\"\\xDEV]\\x9A\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x03\\x00\\x00\\x00jG0D\\x02 \\x152+\\x89\\x8D\\xFD\\xE1L\\xDC[\\x84\\xE8\\xC6\\xDF\\xB2\\xB3\\x83#kW\\xA8^6s[\\x99\\xFC\\x84\\xE8\\xEB\\f\\xC7\\x02 f\\xF5f[w$\\x1C5\\x17\\xD2\\xE8\\x8AA\\x9F\\xA5\\xF6FW\\xC7W\\xF1\\\"\\x99\\xC8[\\x86)\\x06\\x89\\xBA%\\x98\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x04\\x00\\x00\\x00kH0E\\x02!\\x00\\x85\\xE1v\\xD3\\xBD\\xBB\\xAD\\x87y\\x1C\\xC9A\\x99\\x84\\xD0W\\b;9\\xD4\\x8C\\x9CCC\\rM\\xB4\\x8A\\xDFQ%^\\x02 C6\\xAC\\x89\\x0E,S\\xE1\\xC7\\x16\\xDA\\xC6\\xC7%\\xA5c,s\\xC3\\xFAg\\xE5\\x14N\\x04\\xD2\\xD3B\\xED\\xED\\x83g\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x05\\x00\\x00\\x00kH0E\\x02!\\x00\\xB7\\xCA\\xC4Z\\x8D\\xFE\\v.\\xB4\\xD1\\x90t=\\x99^\\xAA\\xC0+\\xAA1\\xB4\\xEF5\\xE5\\vg0\\xE4Q\\xA2z\\xCF\\x02 c\\x0E\\xDD\\x8Dg\\xEB\\x83R\\x04\\x14\\x10#\\xDAsK\\xA8\\xDA\\x16\\x1AWe\\xCE<d\\xF4\\x80f[\\x94q\\xFA\\xC4\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF8\\xA4%\\xC0G\\xB0\\x95\\xE5+jx\\xF4\\xCC\\x14\\a'\\x9D\\xDC\\x1F\\x88!\\xD72\\xC5\\xFC\\xBB`\\x99\\xB8\\xE9g@\\x01\\x00\\x00\\x00kH0E\\x02!\\x00\\xD4\\xC2\\x9B2{\\xD1S\\xD4ZUF\\xAE\\xD2\\x14\\xCC\\xE6\\xAC1\\xD0\\xD6\\x1E!\\xD2\\xB1\\xDB\\xA3\\x06&\\x18zo\\x02\\x02 Y\\xF4\\aj\\xD8\\xF7\\\"\\xFB6U\\xEA\\xC1Y\\xF2y\\x94:\\x01\\xF0>{\\r|h\\t\\xD6\\xF1\\x83\\xCBXO\\x97\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\b\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x14j\\x12OA\\x01\\x00\\x06\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\x00X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xE0\\x91~+a&n\\xBF\\xFC\\xDD\\x93\\x19\\x85\\xBF2C\\x14\\t\\xA7\\x18\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xF1\\x18\\x90\\xE0\\x03&\\xC3\\x9E\\x91\\xACN\\xB69c0[|\\xC5\\xF0\\xD2\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xC1\\xD5\\xEB[\\r;\\xCF\\xB2\\x81\\xE8\\xB4\\xC2\\xB2\\xD5\\x00T<v\\x96\\xA5\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14]\\xC0M\\xA1gd_\\x9E3:.\\xDE\\xDF\\t\\xC3\\x99\\xAB\\xBA'\\x9D\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14;J\\xFD\\x021\\xEB5\\xA5tZ=\\xD6\\x94\\x84\\x8C\\x17}\\xDD\\xA3\\xE2\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xDF\\x86az]\\x92\\xEFP(}&\\xFA\\xCA\\x01\\xE35\\x01G\\xB9\\xC1\\x87\\xF0\\xB9\\xF5\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14\\xDE\\x7F\\xF8s\\f\\xF8\\xA5S:\\x1EyO!B\\x89\\xE5\\xD5\\xFE\\x1ES\\x88\\xAC\\x00\\x00\\x00\\x00\", @hash=\"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\"> \n\n# P2PKH\u306eUTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\nrich_prev_tx_bin   = oa_api.provider.getrawtransaction(rich_prev_txid)\n# => \"0100000002d11a536e32c4437cca45d03dd4c35a39c4f9fab074d7a77b7f87f1e789b3e307000000006b483045022100a83f304622fa30e39ec07e6cd234e9225e198918f226f133cae62fb8471d1fd502207d3ef2edd68b8509707ceac1a4ce7771777f210914b73c16b1adcc16d7de19670121035c4c07baacdcf5fd7631f1c27de29811bc86aea7c4bdfd583f397b669edff400feffffffa0443ede7c08f16cebe90b718dc13b32c51e487e295753e5a20109fa9d155aa3000000006b483045022100c846646f5e909af13f4e1f2a13f6b02ca876a25884cb03ed068d6f5f6dd955d9022012d7b773a36a1cce4106da57ccc3e95aac0bc7f927614791a0c460e820ae28870121026fab0d63cf13d6bc57ace182033115a3acf91b6aa70ca70cd7ff753edc9f97defeffffff021070f205000000001976a91466c9312a3564e241605f78f5806a4d9031c3888088ac00e1f505000000001976a91496bd29086134fdc13906eb846b826602a6e0b4bf88ac79000000\"\nrich_prev_tx       = Bitcoin::Protocol::Tx.new(rich_prev_tx_bin.htb)\n# => #<Bitcoin::Protocol::Tx:0x007fd66d0ef538 @scripts=[], @out=[#<Bitcoin::Protocol::TxOut:0x007fd66d0eee80 @value=99774480, @pk_script_length=25, @pk_script=\"v\\xA9\\x14f\\xC91*5d\\xE2A`_x\\xF5\\x80jM\\x901\\xC3\\x88\\x80\\x88\\xAC\">, #<Bitcoin::Protocol::TxOut:0x007fd66d0eecf0 @value=100000000, @pk_script_length=25, @pk_script=\"v\\xA9\\x14\\x96\\xBD)\\ba4\\xFD\\xC19\\x06\\xEB\\x84k\\x82f\\x02\\xA6\\xE0\\xB4\\xBF\\x88\\xAC\">], @in=[#<Bitcoin::Protocol::TxIn:0x007fd66d0ef330 @prev_out_hash=\"\\xD1\\x1ASn2\\xC4C|\\xCAE\\xD0=\\xD4\\xC3Z9\\xC4\\xF9\\xFA\\xB0t\\xD7\\xA7{\\x7F\\x87\\xF1\\xE7\\x89\\xB3\\xE3\\a\", @prev_out_index=0, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xA8?0F\\\"\\xFA0\\xE3\\x9E\\xC0~l\\xD24\\xE9\\\"^\\x19\\x89\\x18\\xF2&\\xF13\\xCA\\xE6/\\xB8G\\x1D\\x1F\\xD5\\x02 }>\\xF2\\xED\\xD6\\x8B\\x85\\tp|\\xEA\\xC1\\xA4\\xCEwqw\\x7F!\\t\\x14\\xB7<\\x16\\xB1\\xAD\\xCC\\x16\\xD7\\xDE\\x19g\\x01!\\x03\\\\L\\a\\xBA\\xAC\\xDC\\xF5\\xFDv1\\xF1\\xC2}\\xE2\\x98\\x11\\xBC\\x86\\xAE\\xA7\\xC4\\xBD\\xFDX?9{f\\x9E\\xDF\\xF4\\x00\", @sequence=\"\\xFE\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66d0ef128 @prev_out_hash=\"\\xA0D>\\xDE|\\b\\xF1l\\xEB\\xE9\\vq\\x8D\\xC1;2\\xC5\\x1EH~)WS\\xE5\\xA2\\x01\\t\\xFA\\x9D\\x15Z\\xA3\", @prev_out_index=0, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xC8Fdo^\\x90\\x9A\\xF1?N\\x1F*\\x13\\xF6\\xB0,\\xA8v\\xA2X\\x84\\xCB\\x03\\xED\\x06\\x8Do_m\\xD9U\\xD9\\x02 \\x12\\xD7\\xB7s\\xA3j\\x1C\\xCEA\\x06\\xDAW\\xCC\\xC3\\xE9Z\\xAC\\v\\xC7\\xF9'aG\\x91\\xA0\\xC4`\\xE8 \\xAE(\\x87\\x01!\\x02o\\xAB\\rc\\xCF\\x13\\xD6\\xBCW\\xAC\\xE1\\x82\\x031\\x15\\xA3\\xAC\\xF9\\ej\\xA7\\f\\xA7\\f\\xD7\\xFFu>\\xDC\\x9F\\x97\\xDE\", @sequence=\"\\xFE\\xFF\\xFF\\xFF\">], @lock_time=121, @ver=1, @enable_bitcoinconsensus=false, @payload=\"\\x01\\x00\\x00\\x00\\x02\\xD1\\x1ASn2\\xC4C|\\xCAE\\xD0=\\xD4\\xC3Z9\\xC4\\xF9\\xFA\\xB0t\\xD7\\xA7{\\x7F\\x87\\xF1\\xE7\\x89\\xB3\\xE3\\a\\x00\\x00\\x00\\x00kH0E\\x02!\\x00\\xA8?0F\\\"\\xFA0\\xE3\\x9E\\xC0~l\\xD24\\xE9\\\"^\\x19\\x89\\x18\\xF2&\\xF13\\xCA\\xE6/\\xB8G\\x1D\\x1F\\xD5\\x02 }>\\xF2\\xED\\xD6\\x8B\\x85\\tp|\\xEA\\xC1\\xA4\\xCEwqw\\x7F!\\t\\x14\\xB7<\\x16\\xB1\\xAD\\xCC\\x16\\xD7\\xDE\\x19g\\x01!\\x03\\\\L\\a\\xBA\\xAC\\xDC\\xF5\\xFDv1\\xF1\\xC2}\\xE2\\x98\\x11\\xBC\\x86\\xAE\\xA7\\xC4\\xBD\\xFDX?9{f\\x9E\\xDF\\xF4\\x00\\xFE\\xFF\\xFF\\xFF\\xA0D>\\xDE|\\b\\xF1l\\xEB\\xE9\\vq\\x8D\\xC1;2\\xC5\\x1EH~)WS\\xE5\\xA2\\x01\\t\\xFA\\x9D\\x15Z\\xA3\\x00\\x00\\x00\\x00kH0E\\x02!\\x00\\xC8Fdo^\\x90\\x9A\\xF1?N\\x1F*\\x13\\xF6\\xB0,\\xA8v\\xA2X\\x84\\xCB\\x03\\xED\\x06\\x8Do_m\\xD9U\\xD9\\x02 \\x12\\xD7\\xB7s\\xA3j\\x1C\\xCEA\\x06\\xDAW\\xCC\\xC3\\xE9Z\\xAC\\v\\xC7\\xF9'aG\\x91\\xA0\\xC4`\\xE8 \\xAE(\\x87\\x01!\\x02o\\xAB\\rc\\xCF\\x13\\xD6\\xBCW\\xAC\\xE1\\x82\\x031\\x15\\xA3\\xAC\\xF9\\ej\\xA7\\f\\xA7\\f\\xD7\\xFFu>\\xDC\\x9F\\x97\\xDE\\xFE\\xFF\\xFF\\xFF\\x02\\x10p\\xF2\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14f\\xC91*5d\\xE2A`_x\\xF5\\x80jM\\x901\\xC3\\x88\\x80\\x88\\xAC\\x00\\xE1\\xF5\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14\\x96\\xBD)\\ba4\\xFD\\xC19\\x06\\xEB\\x84k\\x82f\\x02\\xA6\\xE0\\xB4\\xBF\\x88\\xACy\\x00\\x00\\x00\", @hash=\"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\"> \n\n\nRedeemScript\u306e\u53d6\u5f97\nRedeemScript\u306f\u3001\u4f55\u3089\u304b\u306e\u65b9\u6cd5\uff08\u30e1\u30fc\u30eb\u3084\u5225\u306eWeb\u30b7\u30b9\u30c6\u30e0\u306a\u3069\uff09\u3067\u3082\u3089\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\u3002\nredeem_script_hex = '0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac'\n\nredeem_script     = Bitcoin::Script.new(redeem_script_hex.htb)\n# => #<Bitcoin::Script:0x007fd66e091e28 @raw_byte_sizes=[39, 0], @previous_output_script=nil, @input_script=\"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @raw=\"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @chunks=[\"u\", 177, 117, \"\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\", 172], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# \u3053\u3093\u306a\u30b9\u30af\u30ea\u30d7\u30c8\nredeem_script.to_string\n# => \"75 OP_NOP2 OP_DROP 02057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011b OP_CHECKSIG\" \n\n\nhex\u5f62\u5f0f\u3060\u3068\u3001\u4f55\u304b\u3068\u53d7\u3051\u6e21\u3057\u3057\u3084\u3059\u3044\u306e\u3067\u3001\u3053\u306e\u5f62\u5f0f\u3067\u3082\u3089\u3063\u3066\u3044\u305f\u3068\u4eee\u5b9a\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u89e3\u8aac\u3092\u5c11\u3057\u3059\u308b\u3068\u3001\n\n\u300c75\u300d\u306f\u30ea\u30c8\u30eb\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3\u5f62\u5f0f\u306elocktime\u3002\u5024\u306f117\u3002\n\u300cOP_NOP2\u300d\u306fOP_CHECKLOCKTIMEVERIFY\u306e\u3053\u3068\u3002\n\u300cOP_DROP\u300d\u306f\u30b9\u30bf\u30c3\u30af\u6700\u4e0a\u4f4d\u306e\u8981\u7d20\u3092\u524a\u9664\u3059\u308b\u547d\u4ee4\u3002\n\u300c020...\u300d\u306f\u53d7\u4fe1\u8005\uff08\u305d\u306eUTXO\u304c\u4f7f\u7528\u53ef\u80fd\u306a\u4eba\uff09\u306e\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u3002\n\u300cOP_CHECKSIG\u300d\u306f\u3001P2PKH\u3067\u3082\u304a\u306a\u3058\u307f\u306escriptSig\uff08sig + pubkey\uff09\u306e\u691c\u8a3c\u547d\u4ee4\u3002\n\n\n\u672a\u7f72\u540d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n\nP2PKH\u306e\u4f5c\u6210\nBuilder\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u751f\u6210\u3002\u7f72\u540d\uff08scriptSig\uff09\u306e\u4f5c\u6210\u306f\u3057\u306a\u3044\u306e\u3067\u3001input\u4f5c\u6210\u6642\u306b\u306f\u3001signature_key\u306f\u6307\u5b9a\u3057\u306a\u3044\u3002\ntx_bldr = Bitcoin::Builder::TxBuilder.new\n\n# \u5165\u529b\u90e8\u306e\u4f5c\u6210\ntx_bldr.input do |i|\n  i.prev_out rich_prev_tx\n  i.prev_out_index rich_prev_out_index\nend\n\n# \u51fa\u529b\u90e8\u306e\u4f5c\u6210\ntx_out_bldr = tx_bldr.output do |o|\n   o.value 99800000 # 0.998 BTC in satoshis\n   o.script {|s| s.recipient to }\nend\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u672a\u7f72\u540d\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\npp tx_bldr.tx.to_hash\n\n{\"hash\"=>\"1d3b74cd4933230dff2dbaa91aff119c863c695a225bff1ae2c3495b31d0bfdf\",\n \"ver\"=>1,\n \"vin_sz\"=>1,\n \"vout_sz\"=>1,\n \"lock_time\"=>0,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\"}],\n \"out\"=>\n  [{\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n\n\nP2SH\u306e\u4f5c\u6210\nAzuchi\u69d8\u306e\u30d6\u30ed\u30b0\u3092\u53c2\u8003\u306b\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u751f\u6210\u30e1\u30bd\u30c3\u30c9\u3092\u5b9a\u7fa9\u3057\u3066\u3001\u3088\u3073\u51fa\u3059\u3002\n# LOCKTIME\u4ed8\u304dP2SH\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u751f\u6210\u30e1\u30bd\u30c3\u30c9\ndef spend_unsigned_tx(locktime, txid, vout, address)\n  tx = Bitcoin::Protocol::Tx.new\n  tx.lock_time = locktime   # \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5168\u4f53\u306elock_time\u3092\u6307\u5b9a\u3059\u308b\n  # \u5165\u529b\u90e8\u306e\u4f5c\u6210\uff08\u3053\u308c\u304cP2SH\u3067\u9001\u3089\u308c\u305fUTXO\uff09\n  tx_in = Bitcoin::Protocol::TxIn.from_hex_hash(txid, vout)\n  tx_in.sequence = [0].pack(\"V\")   # ffffffff\u306e\u5834\u5408\u3001\u691c\u8a3c\u306b\u5931\u6557\u3059\u308b\u3002\n  tx.add_in(tx_in)\n  # \u51fa\u529b\u90e8\u306e\u4f5c\u6210\uff08600satoshi\u5206\u306e\u9001\u91d1\uff09\n  tx_out = Bitcoin::Protocol::TxOut.new(600, Bitcoin::Script.new(Bitcoin::Script.to_address_script(address)).to_payload)\n  tx.add_out(tx_out)\n  tx\nend\n\n# \u300c\u51cd\u7d50\u3055\u308c\u305fUTXO\u300d\u3092\u5165\u529b\u3068\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\nunsigned_tx = spend_unsigned_tx(locktime, locked_prev_txid, locked_prev_out_index, to)\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u672a\u7f72\u540d\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3002\npp unsigned_tx.to_hash\n\n{\"hash\"=>\"c04f5ebcccd6fc58e337eb9c0636e8337d90df923cb94c0a975beecdf5648f5d\",\n \"ver\"=>1,\n \"vin_sz\"=>1,\n \"vout_sz\"=>1,\n \"lock_time\"=>117,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\",\n    \"sequence\"=>0}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n\n\nP2PKH\u3068P2SH\u306e\u5408\u4f53\n\"tx\"\u3068\u3044\u3046\u540d\u524d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3059\u308b\u3002\nP2SH\u304c0\u756a\u306b\u3001P2PKH\u304c1\u756a\u306e\u5165\u529b\u306b\u306a\u308b\u3088\u3046\u306b\u3001\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3002\nunsigned_tx.add_in(tx_bldr.tx.in[0])\nunsigned_tx.add_out(tx_bldr.tx.out[0])\n\ntx = unsigned_tx\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u306a\u308b\npp tx.to_hash; nil\n{\"hash\"=>\"c04f5ebcccd6fc58e337eb9c0636e8337d90df923cb94c0a975beecdf5648f5d\",\n \"ver\"=>1,\n \"vin_sz\"=>2,\n \"vout_sz\"=>2,\n \"lock_time\"=>117,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\",\n    \"sequence\"=>0},\n   {\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\"}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"},\n   {\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n\nvin\u304c2\u3064\u672a\u7f72\u540d\u3067\u3002vout\u304c2\u3064\u3042\u308b\u3002\n\n\u7f72\u540d\u5b9f\u884c\n\u3053\u3053\u304c\u30dd\u30a4\u30f3\u30c8\u3002vin\u306escriptSig\u306f\u3001\u300c\u300cvin\u3092\u542b\u3080\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u300d\u3092\u79d8\u5bc6\u9375\u2460\u3067\u6697\u53f7\u5316\u3057\u305f\u3082\u306e\u300d\u3068\u300c\u2460\u306e\u5bfe\u3068\u306a\u308b\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u300d\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\u524d\u8005\u306f\u3001\u3053\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u6539\u7ac4\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u4e3b\u5f35\u3059\u308b\u3082\uff08\u304b\u3064\u3001UTXO\u304c\u6307\u5b9a\u3059\u308b\u516c\u958b\u9375\u7b49\u306b\u3088\u3063\u3066\u305d\u306e\u5229\u7528\u304c\u6b63\u5f53\u3067\u3042\u308b\u3068\u691c\u8a3c\u3067\u304d\u308b\u3082\u306e\uff09\u306e\u3067\u3001\u5f8c\u8005\u306f\u3001\u306e\u3061\u306b\u7b2c\u4e09\u8005\u304c\u305d\u308c\u3092\u691c\u8a3c\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3042\u308b\u3002\n\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u60c5\u5831\u3060\u3051\u307f\u308b\u3068\u3001P2PKH\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u3002\n scriptSig: <sig> <pubKey>\n\nP2SH\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3002\uff08\u305f\u3060\u3057\u3001RedeemScript\u306b\u3088\u3063\u3066\u30b1\u30fc\u30b9\u30d0\u30a4\u30b1\u30fc\u30b9\uff09\nscriptSig: ..signatures... <serialized script>\n\n\nP2PKH\u90e8\u5206\n# \u305d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\u3059\u308b\n# signature_hash_for_input\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u307e\u305a\u3001scriptSig\u3092\"\"\u3067\u5165\u308c\u66ff\u3048\u3066\u3001\n# \u6307\u5b9a\u3057\u305fvin\uff08\u7b2c\u4e00\u5f15\u6570\u3067\u6307\u5b9a\uff09\u306escriptSig\u306b\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3092\u5165\u308c\u305f\n# \u300c\u4eee\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u300d\u306b\u3064\u3044\u3066\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\u3059\u308b\u3002\n# \u3053\u306e\u3068\u304d\u3001lock_time\u3084hash_type\u3001vin/vout\u306e\u6570\u3084\u30da\u30a4\u30ed\u30fc\u30c9\u3082\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u306b\u542b\u307e\u308c\u308b\u305f\u3081\u3001\n# \u3053\u306e\u7f72\u540d\u4ee5\u964d\u3067\u3001vin/vout\u306a\u3069\u306e\u5909\u66f4\u306f\u3067\u304d\u306a\u3044\u3002\nsig_hash = tx.signature_hash_for_input(1, rich_prev_tx,\n  Bitcoin::Script::SIGHASH_TYPE[:all])\n# => \"-\\xE30v@\\x9A\\x03\\xDDt\\xC7s\\x00h;\\x13\\x91n\\x91\\x9D\\fx\\x88\\xD8\\x0F\\x9C\\xD3.\\x89\\x16\\xA4e\\x88\" \n\n# \u8a08\u7b97\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u3092\u3001\u79d8\u5bc6\u9375\u3067\u6697\u53f7\u5316\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u306b\u3001hash_type\u3092\u6307\u5b9a\u3059\u308b\u3002\n# \u3042\u3068\u3067vout\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u306a\u3051\u308c\u3070\u3001:all\u3067\u6307\u5b9a\u3059\u308b\u3002\nsig = rich_key_obj.sign(sig_hash) +\n  [Bitcoin::Script::SIGHASH_TYPE[:all]].pack(\"C\")\n# => \"0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01\" \n\n# hex\u3067\u898b\u308b\u3068\u3053\u3093\u306a\u611f\u3058(tx.to_hash\u306escriptSig\u3067\u78ba\u8a8d\u3067\u304d\u308b\u5024\u3068\u540c\u3058)\n# sig.bth\n# => \"3045022100efe7349c7933bf8e806af646bcebce39dced48e45b2709c841d28c0a929cd26f02203270359ba32c99095b31913744fddcf02dcbe8ea0d5159e1f4b534194e8faa2401\" \n\n# scriptSig\u3092\u4f5c\u6210\u3059\u308b\u3002sig\u306b\u52a0\u3048\u3066\u3001\u305d\u308c\u3092\u7b2c\u4e09\u8005\u304c\u691c\u8a3c\u3059\u308b\u305f\u3081\u306b\u516c\u958b\u9375\u3092\u4ed8\u4e0e\u3059\u308b\u3002\nscript_sig = Bitcoin::Script.new(Bitcoin::Script.pack_pushdata(sig) +\n  Bitcoin::Script.pack_pushdata(rich_key_obj.pub.htb))\n# => #<Bitcoin::Script:0x007fd66ae94560 @raw_byte_sizes=[107, 0], @previous_output_script=nil, @input_script=\"H0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01!\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\", @raw=\"H0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01!\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\", @chunks=[\"0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01\", \"\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\"], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# script_sig.to_string\n# => 3045022100efe7349c7933bf8e806af646bcebce39dced48e45b2709c841d28c0a929cd26f02203270359ba32c99095b31913744fddcf02dcbe8ea0d5159e1f4b534194e8faa2401 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\" \n\n# \u7f72\u540d\u3092\u30bb\u30c3\u30c8\u3059\u308b\ntx.in[1].script_sig = script_sig.to_payload\n\n\u79c1\u306f\u3001P2PKH\u306flocktime\u306f\u95a2\u4fc2\u306a\u3044\uff01\u3068\u601d\u3044\u8fbc\u3093\u3067\u3001\u7f72\u540d\u3057\u305f\u3042\u3068\u306b\u3001\nlocktime\u3092\u5909\u3048\u305f\u308a\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u7d50\u69cb\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\uff08\u5f8c\u8ff0\uff09\n\nP2SH\u90e8\u5206\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\u6642\u3068\u540c\u69d8\u306b\u3001\u5c02\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u7528\u610f\u3002P2PKH\u3068\u7570\u306a\u308a\u3001RedeemScript\u672c\u4f53\u3092\u4f7f\u3063\u3066\u7f72\u540d\u3092\u4f5c\u308b\u3002\uff08\u516c\u958b\u9375\u306e\u4ee3\u308f\u308a\u306b\u306a\u308b\uff09\n# \u30ed\u30c3\u30af\u3055\u308c\u305fUTXO\u306e\u7f72\u540d\u30b9\u30af\u30ea\u30d7\u30c8(scriptSig)\ndef spend_script(priv_key, locktime, unsigned_tx, n, redeem_script)\n  tx = Marshal.load(Marshal.dump(unsigned_tx))\n\n  # vin\u306escript_sig\u306b\u3001RedeemScri\uff50\uff54\u3067\u4eee\u7f6e\u304d\uff08P2PKH\u306e\u3068\u304d\u306f\u3001\u81ea\u8eab\u306e\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\uff09\n  tx.in[0].script_sig = redeem_script.to_payload\n\n  # \u4eee\u7f6e\u304d\u72b6\u614b\u3067\u3001\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u8a08\u7b97\uff08P2PKH\u306e\u3068\u304d\u3068\u540c\u69d8\uff09\n  sig_hash = tx.signature_hash_for_input(n,\n    redeem_script.to_payload, Bitcoin::Script::SIGHASH_TYPE[:all])\n\n  # \u30cf\u30c3\u30b7\u30e5\u5024\u3092\u79d8\u5bc6\u9375\u3067\u6697\u53f7\u5316\u3002P2PKH\u540c\u69d8\u3001hash_type\u306f:all\u306b\u5408\u308f\u305b\u308b\u3002\n  sig = priv_key.sign(sig_hash) +\n    [Bitcoin::Script::SIGHASH_TYPE[:all]].pack(\"C\")\n\n  # \u623b\u308a\u5024\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5f62\u5f0f\u306b\u3057\u3066\u3001sig\u3068RedeemScript\uff08\u672c\u4f53\uff09\u3092\u9001\u308b\u3002\n  # \u4eca\u56de\u306eRedeemScript\u306b\u306f\u3001\u76f8\u624b\u65b9\u306e\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u304c\u542b\u307e\u308c\u308b\u3088\u3046\u306b\u4f5c\u3063\u3066\u3042\u308b\u306e\u3067\u3001\n  # P2PKH\u3068\u540c\u7b49\u306e\u691c\u8a3c\u3092\u884c\u3046\u3053\u3068\u304c\u53ef\u80fd\u3002\n  Bitcoin::Script.new(Bitcoin::Script.pack_pushdata(sig) +\n    Bitcoin::Script.pack_pushdata(redeem_script.to_payload))\nend\n\n# \u30e1\u30bd\u30c3\u30c9\u3067scriptSig\u4f5c\u6210\u3002\nspend_script = spend_script(from_key_obj,\u3000locktime, tx, 0, redeem_script)\n# => #<Bitcoin::Script:0x007fd66d1bc4c0 @raw_byte_sizes=[112, 0], @previous_output_script=nil, @input_script=\"G0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01'\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @raw=\"G0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01'\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @chunks=[\"0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01\", \"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\"], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# spend_script.to_string \n# => \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\" \n\n# \u7f72\u540d\u3092\u30bb\u30c3\u30c8\ntx.in[0].script_sig = spend_script.to_payload\n\n\n\u7f72\u540d\u691c\u8a3c\nverify_input_signature\u304c\u4fbf\u5229\u3002\n\n\u7b2c\u4e00\u5f15\u6570: vin\u306e\u756a\u53f7\n\u7b2c\u4e8c\u5f15\u6570: UTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\n\n# P2SH\u306eUTXO\u3092\u4f7f\u3046vin\ntx.verify_input_signature(0, locked_prev_tx)\n# => true\n\n# P2PKH\u306eUTXO\u3092\u4f7f\u3046vin\ntx.verify_input_signature(1, rich_prev_tx)\n# => true\n\nfalse\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u304d\u306f\u3001\u3069\u3053\u304b\u9593\u9055\u3044\u304c\u3042\u308b\u3002\ntrue\u3068\u8868\u793a\u3055\u308c\u3066\u3082\u3001\u5b89\u5fc3\u306f\u7981\u7269\u3002\nbitcoin-ruby\u306fscript\u306e\u5b9f\u88c5\u304c\u3084\u3084\u9045\u304f\u3001\u4f8b\u3048\u3070\u3001\u4eca\u56de\u4f8b\u793a\u306eOP_NOP2\u306f\u3001\u4f55\u3082\u51e6\u7406\u304c\u304b\u304b\u308c\u3066\u3044\u306a\u3044\u3002\uff08locktime\u306e\u5024\u304c\u5909\u308f\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u5e38\u306btrue\u306b\u306a\u308b\uff09\n\n\u5b8c\u6210\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\npp tx.to_hash\n\n{\"hash\"=>\"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\",\n \"ver\"=>1,\n \"vin_sz\"=>2,\n \"vout_sz\"=>2,\n \"lock_time\"=>117,\n \"size\"=>378,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\n     \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\",\n    \"sequence\"=>0},\n   {\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\n     \"30440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d8201 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\"}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"},\n   {\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n\n\n\u5b9f\u884c\n\n\u9001\u91d1\u5b9f\u884c\nserialzed_tx = tx.to_payload.bth\n# => \"01000000022f6e306cad4753cc7a30a598b6b24f61c16e2bbb383e3a0ed5cc06f76a51e9a0010000007047304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac00000000cced3615422a1fdc82f9944e6181724c865be5fa330a614752378fa79593200d010000006a4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499bffffffff0258020000000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788acc0d3f205000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac75000000\" \n\n# \u9001\u4fe1\noa_api.provider.sendrawtransaction(serialzed_tx)\n# => \"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\" \n\n\n\u78ba\u8a8d\nbitcoin-cli\u304b\u3089\u3001\u5148\u307b\u3069\u306etxid\u3067\u691c\u7d22\u3057\u3066\u307f\u308b\u3002\n% bitcoin-cli getrawtransaction  1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9 1\n{\n  \"hex\": \"01000000022f6e306cad4753cc7a30a598b6b24f61c16e2bbb383e3a0ed5cc06f76a51e9a0010000007047304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac00000000cced3615422a1fdc82f9944e6181724c865be5fa330a614752378fa79593200d010000006a4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499bffffffff0258020000000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788acc0d3f205000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac75000000\",\n  \"txid\": \"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\",\n  \"size\": 378,\n  \"version\": 1,\n  \"locktime\": 117,\n  \"vin\": [\n    {\n      \"txid\": \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"vout\": 1,\n      \"scriptSig\": {\n        \"asm\": \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c23[ALL] 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\",\n        \"hex\": \"47304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\"\n      },\n      \"sequence\": 0\n    }, \n    {\n      \"txid\": \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"vout\": 1,\n      \"scriptSig\": {\n        \"asm\": \"30440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82[ALL] 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\",\n        \"hex\": \"4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\"\n      },\n      \"sequence\": 4294967295\n    }\n  ],\n  \"vout\": [\n    {\n      \"value\": 0.00000600,\n      \"n\": 0,\n      \"scriptPubKey\": {\n        \"asm\": \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\",\n        \"hex\": \"76a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac\",\n        \"reqSigs\": 1,\n        \"type\": \"pubkeyhash\",\n        \"addresses\": [\n          \"mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP\"\n        ]\n      }\n    }, \n    {\n      \"value\": 0.99800000,\n      \"n\": 1,\n      \"scriptPubKey\": {\n        \"asm\": \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\",\n        \"hex\": \"76a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac\",\n        \"reqSigs\": 1,\n        \"type\": \"pubkeyhash\",\n        \"addresses\": [\n          \"mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP\"\n        ]\n      }\n    }\n  ],\n  \"blockhash\": \"26a33829645c4ba52b83da8427022307ee36a9a3fa2c30591cc462d4de2d8518\",\n  \"confirmations\": 1,\n  \"time\": 1467771445,\n  \"blocktime\": 1467771445\n}\n\n\u7121\u4e8b\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u3002\n\n\u767a\u5c55\uff1a\u3082\u3063\u3068\u8a73\u3057\u304f\n\nTx.signature_hash_for_input\n\u30b7\u30b0\u30cd\u30c1\u30e3\u4f5c\u6210\u3092\u62c5\u3063\u3066\u3044\u308b\u3053\u308c\u3092\u898b\u308b\u3002\n      def signature_hash_for_input(input_idx, subscript, hash_type=nil)\n        # \u4e2d\u7565\u3002pin\u306f\u3001\"pseudo vin\"\uff08\u64ec\u4f3cvin\uff09\u3068\u601d\u308f\u308c\u308b\u3002TCP/IP\u306e\u64ec\u4f3c\u30d8\u30c3\u30c0\u3068\u540c\u3058\u3002\n        # \u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u306e\u305f\u3081\u3060\u3051\u306b\u4f5c\u3089\u308c\u308bvin\u3002scriptSig\u304c\u7a7a\u306b\u306a\u308a\u3001\n        # \u6307\u5b9a\u306evin\u306escriptSig\u3060\u3051\u304c\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3092\u57cb\u3081\u3089\u308c\u308b\u3002\n        pin  = @in.map.with_index{|input,idx|\n          if idx == input_idx\n            subscript = subscript.out[ input.prev_out_index ].script if subscript.respond_to?(:out) # legacy api (outpoint_tx)\n            input.to_payload(subscript)\n          else\n            case (hash_type & 0x1f)\n            when SIGHASH_TYPE[:none];   input.to_payload(\"\", \"\\x00\\x00\\x00\\x00\")\n            when SIGHASH_TYPE[:single]; input.to_payload(\"\", \"\\x00\\x00\\x00\\x00\")\n            else;                       input.to_payload(\"\")\n            end\n          end\n        }\n\n        pout = @out.map(&:to_payload)\n        in_size, out_size = Protocol.pack_var_int(@in.size), Protocol.pack_var_int(@out.size)\n\n        case (hash_type & 0x1f)\n        when SIGHASH_TYPE[:none]\n          pout = \"\"\n          out_size = Protocol.pack_var_int(0)\n        when SIGHASH_TYPE[:single]\n          return \"\\x01\".ljust(32, \"\\x00\") if input_idx >= @out.size # ERROR: SignatureHash() : input_idx=%d out of range (SIGHASH_SINGLE)\n          pout = @out[0...(input_idx+1)].map.with_index{|out,idx| (idx==input_idx) ? out.to_payload : out.to_null_payload }.join\n          out_size = Protocol.pack_var_int(input_idx+1)\n        end\n\n        if (hash_type & SIGHASH_TYPE[:anyonecanpay]) != 0\n          in_size, pin = Protocol.pack_var_int(1), [ pin[input_idx] ]\n        end\n\n        # \u3053\u3053\u3067\u3001\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u6a5f\u306b\u304b\u3051\u308b\u5909\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002@lock_time\u304c\u542b\u307e\u308c\u308b\u3002\n        buf = [ [@ver].pack(\"V\"), in_size, pin, out_size, pout, [@lock_time, hash_type].pack(\"VV\") ].join\n        # \u30cf\u30c3\u30b7\u30e5\u306f\u4e8c\u91cd\u3067\u8a08\u7b97\u3055\u308c\u308b\u3002\uff08\u305d\u3046\u3044\u3046\u6c7a\u307e\u308a\uff09\n        Digest::SHA256.digest( Digest::SHA256.digest( buf ) )\n      end\n\n\nTx.verify_input_signature\n\u7f72\u540d\u691c\u8a3c\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u898b\u308b\u3002\u4e00\u90e8\u5272\u611b\u3002\n      def verify_input_signature(in_idx, outpoint_tx_or_script, block_timestamp=Time.now.to_i, opts={})\n        if @enable_bitcoinconsensus\n          return bitcoinconsensus_verify_script(in_idx, outpoint_tx_or_script, block_timestamp, opts)\n        end\n\n        outpoint_idx  = @in[in_idx].prev_out_index\n        script_sig    = @in[in_idx].script_sig\n\n        # outpoint_tx_or_script\u306f\u3001\u901a\u5e38\u3001UTXO\u3092\u542b\u3080\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n        # script_pubkey\u306f\u3001\u305d\u306eUTXO\u304c\u3082\u3064script_pubkey\u3067\u3042\u308b\u3002         \n        # If given an entire previous transaction, take the script from it\n        script_pubkey = if outpoint_tx_or_script.respond_to?(:out) \n          outpoint_tx_or_script.out[outpoint_idx].pk_script\n        else\n          # Otherwise, it's already a script.\n          outpoint_tx_or_script\n        end\n\n        # \u691c\u8a3c\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\u3002\u3053\u3053\u3067\u3044\u3046\u691c\u8a3c\u3068\u306f\u3001\n        # UTXO\u3067\u6307\u5b9a\u3055\u308c\u305fscriptPubKey\u3068\u3001\u81ea\u8eab\u304c\u4f5c\u6210\u3057\u305fvin\u306e\n        # scriptSig\u3092\u5408\u308f\u305b\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u3092\u307f\u3066\u3044\u308b\u3002\n        # \u5272\u7b26\u691c\u8a3c\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u3057\u3066\u3044\u308b\u3002\n        @scripts[in_idx] = Bitcoin::Script.new(script_sig, script_pubkey)\n        # \u3053\u3053\u304c\u5b9f\u884c\u90e8\u5206\u3002\n        # do~end\u53e5\u306f\u3001OP_CKECKSIG\u304c\u5b9f\u884c\u3055\u308c\u305f\u3068\u304d\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3002\n        # OP_CHECKSIG\u5b9f\u884c\u6642\u306b\u3001\u30cf\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u304c\u516c\u958b\u9375\u3067\u5bfe\u5fdc\u958b\u3051\u308b\u304b\u3069\u3046\u304b\u691c\u8a3c\u3057\u3066\u3044\u308b\u3002\n        sig_valid = @scripts[in_idx].run(block_timestamp, opts) do |pubkey,sig,hash_type,subscript|\n          hash = signature_hash_for_input(in_idx, subscript, hash_type)\n          Bitcoin.verify_signature( hash, sig, pubkey.unpack(\"H*\")[0] )\n        end\n\n        return sig_valid\n      end\n\n\u3053\u306e\u8fba\u308a\u306f\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\u306e\u56de\u3067\u8a73\u3057\u304f\u8aac\u660e\u4e88\u5b9a\u3002\n\n\u3042\u3068\u304c\u304d\n\u7f72\u540d\u7cfb\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u5145\u5b9f\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u304c\u3001\u3082\u3046\u5c11\u3057\u30cf\u30a4\u30ec\u30d9\u30eb\u306a\u3068\u3053\u308d\u304b\u3089\u7f72\u540d\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u3044\u3044\u3067\u3059\u306d\u3002\n\u7f72\u540d\u306e\u4ed5\u7d44\u307f\u3092\u77e5\u3089\u306a\u3044\u3068\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u4f7f\u3044\u3053\u306a\u305b\u305a\u3001\u7d50\u679c\u3001\u8907\u96d1\u306a\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u306a\u3044\u73fe\u72b6\u306f\u3001\u521d\u5fc3\u8005\u306b\u306f\u30cf\u30fc\u30c9\u30eb\u304c\u9ad8\u304f\u611f\u3058\u307e\u3059\u3002\n\n\u53c2\u8003\nBitcoin::Builder\u3092\u4f7f\u3063\u3066\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\nhttp://qiita.com/osada/items/edb1f0681735586ca586\nTransaction\u306e\u8aac\u660e\uff08\u516c\u5f0f\u30b5\u30a4\u30c8\uff09\nhttps://en.bitcoin.it/wiki/Transaction#Pay-to-PubkeyHash\n# \u52d5\u6a5f\n\u4ee5\u524d\u3001[Builder\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4f5c\u6210](http://qiita.com/osada/items/edb1f0681735586ca586\n)\u306b\u3064\u3044\u3066\u3054\u7d39\u4ecb\u3057\u307e\u3057\u305f\u304c\u3001\u30de\u30eb\u30c1\u30b7\u30b0\u4ee5\u5916\u306eP2SH\u306e\u30b5\u30dd\u30fc\u30c8\u304c\u306a\u3044\u3053\u3068\u3092\u307f\u307e\u3057\u305f\u3002\n\u305d\u306e\u305f\u3081\u3001\u4efb\u610f\u306eRedeemScript\u3092\u4f7f\u3063\u305fUTXO\u304b\u3089\u9001\u91d1\u306b\u5229\u7528\u3059\u308b\u306b\u306f\u3001\u81ea\u529b\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u624b\u9806\u3092\u3054\u7d39\u4ecb\u3057\u306a\u304c\u3089\u3001\u7f72\u540d\u304c\u3069\u306e\u3088\u3046\u306b\u4ed8\u3051\u3089\u308c\u308b\u306e\u304b\u898b\u3066\u3044\u304d\u307e\u3059\u3002\n\n# \u74b0\u5883\n* bitcoind 0.12.1\n* bitcoin-ruby 0.0.8\n* openassets-ruby 0.4.9 # API\u3084Util\u3092\u5229\u7528\n* \u5b9f\u884c\u65e5\uff1a\u30002016-07-06\n\n# \u4e8b\u524d\u77e5\u8b58\n2\u30b5\u30a4\u30c8\u3092\u3054\u7d39\u4ecb\u3002\n\n\u300cBitcoin\u3092\u6280\u8853\u7684\u306b\u7406\u89e3\u3059\u308b \u300d\nhttp://www.slideshare.net/kenjiurushima/20140602-bitcoin1-201406031222?next_slideshow=1\nP.30\u4ee5\u964d\u3001\u7279\u306b\u3001P.34\u304b\u3089\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u7f72\u540d\u751f\u6210\u65b9\u6cd5\u306f\u5927\u5909\u5206\u304b\u308a\u3084\u3059\u3044\u7d75\u304c\u3042\u308a\u307e\u3059\u3002\nP2PKH\u306e\u57fa\u672c\u7684\u306a\u7f72\u540d\u306e\u3084\u308a\u65b9\u304c\u7406\u89e3\u3067\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u30a4\u30e1\u30fc\u30b8\u3060\u3051\u306a\u3093\u3068\u306a\u304f\u7406\u89e3\u3067\u304d\u308c\u3070OK\u3002\n\n\u300cCHECKLOCKTIMEVERIFY\u3067\u6307\u5b9a\u671f\u9593\u307e\u3067\u8cc7\u91d1\u3092\u51cd\u7d50\u300d\nhttp://techmedia-think.hatenablog.com/entry/2016/05/31/184257\nP2SH\u306e\u5b9f\u8df5\u7684\u306a\u4f7f\u3044\u65b9\u304c\u7406\u89e3\u3067\u304d\u307e\u3059\u3002\n\n\u5206\u304b\u308a\u3084\u3059\u3044\u8a18\u4e8b\u3092\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bUrushima\u69d8\u3068\u3001\u696d\u52d9\u3067\u4f7f\u3048\u308b\u5b9f\u8df5\u7684\u306a\u30c6\u30af\u30cb\u30c3\u30af\u3092\u3054\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bAzuchi\u69d8\u306b\u611f\u8b1d\u3044\u305f\u3057\u307e\u3059\u3002\n\n# \u4f5c\u6210\u3059\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\n\n|\u756a\u53f7| \u5165\u529b\u90e8\uff08vin\uff09       |    \u51fa\u529b\u90e8\uff08vout\uff09    |\n|---:|:-----------------|:------------------|\n|1| P2SH\u5b9b\u306b\u9001\u4ed8\u3055\u308c\u305f600satoshi|\u3042\u308b\u5b9b\u5148A\uff08P2PKH\uff09\u306b600satoshi|\n|2| P2PKH\u5b9b\u306b\u9001\u4ed8\u3055\u308c\u305f1BTC|\u3042\u308b\u5b9b\u5148A\uff08P2PKH\uff09\u306b0.998BTC|\n\u203b \u300c\u5165\u529b\u90e8\u306e\u5408\u8a08\u300d\u3068\u300c\u51fa\u529b\u90e8\u306e\u5408\u8a08\u300d\u3068\u306e\u5dee\u306f\u3001\u624b\u6570\u6599\u306b\u76f8\u5f53\u3002\n\n# \u521d\u671f\u8a2d\u5b9a\n\n```rb\n# \u30e2\u30b8\u30e5\u30fc\u30eb\u30ed\u30fc\u30c9\nrequire 'bitcoin'\nrequire 'openassets'\nrequire 'pp'\ninclude Bitcoin::Util\n\n# \u304a\u307e\u3058\u306a\u3044\nBitcoin.network = :testnet3\n\n### use zero confirmation\noa_api = OpenAssets::Api.new({:network => 'testnet',\n:provider => 'bitcoind', :cache => 'testnet.db',\n:dust_limit => 600, :default_fees => 10000,\n:min_confirmation => 0, :max_confirmation => 9999999,\n:rpc => {:user => 'osada', :password => 'password', :schema => 'http',\n:port => 18332, :host => 'localhost'}})\n```\n\n# UTXO\u306e\u6307\u5b9a\n\nUTXO\u3092\u4e00\u610f\u306b\u7279\u5b9a\u3059\u308b\u305f\u3081\u306b\u3001bitcoin-cli\u306elistunspent\u30b3\u30de\u30f3\u30c9\u306a\u3069\u304b\u3089\u3001txid\u3068vout\u3092\u53d6\u308a\u51fa\u3057\u3066\u3001\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3002\n\n```rb\n# 0: P2SH\u5b9b\u306b\u9001\u3089\u308c\u305fUTXO(600satoshi)\n# p2sh_addr           = '2NDideGsDwZSZSVo9X87zHB8ijYRzNQgdfR'\n# P2SH\u3067locktime\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\u3001\"locked\"\u3068prefix\u3092\u3064\u3051\u308b\u3002\nlocked_prev_txid      = 'a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f'\nlocked_prev_out_index = 1\nfrom_addr             = 'n4ZjDj9GArupgYd5fnCgHbQJYzw6W7EXsg'\n\n# 1: P2PKH\u5b9b\u306b\u9001\u3089\u308c\u305fUTXO(1BTC)\n# \u305f\u304f\u3055\u3093BTC\u3092\u6301\u3064\u306e\u3067\u3001\"rich\"\u3068prefix\u3092\u3064\u3051\u308b\u3002\nrich_prev_txid        = '0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc'\nrich_prev_out_index   = 1\nrich_addr             = 'muFzFv487hXbejWom1AfrmJB79ZWRGVLDK'\n\n# \u9001\u91d1\u5148\uff08P2PKH\u306e\u30a2\u30c9\u30ec\u30b9\uff09\nto = 'mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP'\n\n# Locktime\uff1a\u4eca\u56de\u306eP2SH\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u5229\u7528\u3059\u308b\u3082\u306e\u3002\nlocktime = 117\n```\n\n\u7f72\u540d\u306b\u4f7f\u3046\u9375\uff08\u79d8\u5bc6\u9375\u3068\u516c\u958b\u9375\uff09\u3084RedeemScript\uff08\u672c\u4f53\uff09\u3092\u30bb\u30c3\u30c8\u3002\n\n# \u9375\u306e\u751f\u6210\n\n\u30a2\u30c9\u30ec\u30b9\u304b\u3089\u3001\u79d8\u5bc6\u9375\u3092\u62bd\u51fa\u3059\u308b\u3002\n\n```rb\n# P2SH\u306eRedeemScript\u304c\u6307\u5b9a\u3059\u308b\u516c\u958b\u9375\uff08\u306e\u30cf\u30c3\u30b7\u30e5\u306b\u5bfe\u5fdc\u3059\u308b\u30a2\u30c9\u30ec\u30b9\uff09\u3092\u6307\u5b9a\nfrom_priv_key = oa_api.provider.dumpprivkey(from_addr)\n# => \"cV3pVBgTCdZM2Hp3udWsMhS69HRXXYZZZfppb6Hmwu5xgMhtCMvT\" \nfrom_key_obj  = Bitcoin::Key.from_base58(from_priv_key)\n# => #<Bitcoin::Key:0x007fd66b924c50 @key=#<OpenSSL::PKey::EC:0x007fd66b924c00 @group=nil>, @pubkey_compressed=true> \n\n# P2PKH\u306e\u9375\u3092\u62bd\u51fa\nrich_priv_key = oa_api.provider.dumpprivkey(rich_addr)\n# => \"cP3gdtj8ZWDLKaHekhySbYtBDDn97dRvyx9oKnc4mfbpUWUpYFqC\" \nrich_key_obj  = Bitcoin::Key.from_base58(rich_priv_key)\n# => #<Bitcoin::Key:0x007fd66a0e75e8 @key=#<OpenSSL::PKey::EC:0x007fd66a0e7598 @group=#<OpenSSL::PKey::EC::Group:0x007fd66a14f2d8 @key=#<OpenSSL::PKey::EC:0x007fd66a0e7598 ...>>>, @pubkey_compressed=true> \n```\n\n\u3053\u3053\u3067\u3001P2SH\u30a2\u30c9\u30ec\u30b9\u306f\u4f7f\u308f\u306a\u3044\u3053\u3068\u306b\u6ce8\u610f\u3002P2SH\u306f\u3001RedeemScript\u306e\u30cf\u30c3\u30b7\u30e5\u3067\u3042\u3063\u3066\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3067\u306f\u306a\u3044\u3002\u3088\u3063\u3066\u3001\u3053\u308c\u3092\u3082\u3068\u306b\u9375\u3092\u62bd\u51fa\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\u306a\u306e\u3067\u3001RedeemScript\u5185\u3067\u6307\u5b9a\u3055\u308c\u308b\u516c\u958b\u9375\u306b\u5bfe\u5fdc\u3059\u308b\u79d8\u5bc6\u9375\u3092\u62bd\u51fa\u3059\u308b\u3002\n\u3053\u3053\u3067\u306f\u3001\u305d\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u300cfrom_addr\u300d\u3068\u547c\u3076\u3002\n\n# UTXO\u306e\u53d6\u5f97\ntxid\u304c\u793a\u3059\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3002\n\n```rb\n# P2SH\u306eUTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\nlocked_prev_tx_bin = oa_api.provider.getrawtransaction(locked_prev_txid)\n# => \"0100000007969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a000000006a473044022067d3c6fc4cd827ce29647590b89756f349a49bb5574155d0656dea3e715417ed022017f729d07f521b1c5ee6cd805f2889fe839db9abc297a8719f48bb6aa90317f901210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a010000006a473044022047108df8e00b12d392947b6a3c0e96050f4340e3db1c3f2429a1ff0efa0a3fd1022071ca80e4c1706b364c9911f874880b76c85903b25e315f0917749001c54cc44601210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a020000006a47304402206935d1902891f29318a5b8c80626f992e2106e532729413dcc5bc94cba68fade02202c831f182c7b10d13e3fc60cad47df997645a1a41fc1cc6c1e77cb22de565d9a01210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a030000006a473044022015322b898dfde14cdc5b84e8c6dfb2b383236b57a85e36735b99fc84e8eb0cc7022066f5665b77241c3517d2e88a419fa5f64657c757f12299c85b86290689ba259801210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a040000006b48304502210085e176d3bdbbad87791cc9419984d057083b39d48c9c43430d4db48adf51255e02204336ac890e2c53e1c716dac6c725a5632c73c3fa67e5144e04d2d342eded836701210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff969eeff61091ccc9fdffe74e61d77bcce078d561e99b30d547731cdc4fd3894a050000006b483045022100b7cac45a8dfe0b2eb4d190743d995eaac02baa31b4ef35e50b6730e451a27acf0220630edd8d67eb835204141023da734ba8da161a5765ce3c64f480665b9471fac401210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff38a425c047b095e52b6a78f4cc1407279ddc1f8821d732c5fcbb6099b8e96740010000006b483045022100d4c29b327bd153d45a5546aed214cce6ac31d0d61e21d2b1dba30626187a6f02022059f4076ad8f722fb3655eac159f279943a01f03e7b0d7c6809d6f183cb584f9701210385c92463fea97a458d60baf7270a4eb903f7c8927eddcb389af0c0599179058cffffffff080000000000000000146a124f41010006cf03cf03cf03cf03cf03cf0300580200000000000017a914e0917e2b61266ebffcdd931985bf32431409a71887580200000000000017a914f11890e00326c39e91ac4eb63963305b7cc5f0d287580200000000000017a914c1d5eb5b0d3bcfb281e8b4c2b2d500543c7696a587580200000000000017a9145dc04da167645f9e333a2ededf09c399abba279d87580200000000000017a9143b4afd0231eb35a5745a3dd694848c177ddda3e287580200000000000017a914df86617a5d92ef50287d26faca01e3350147b9c187f0b9f505000000001976a914de7ff8730cf8a5533a1e794f214289e5d5fe1e5388ac00000000\" \nlocked_prev_tx     = Bitcoin::Protocol::Tx.new(locked_prev_tx_bin.htb)\n# => #<Bitcoin::Protocol::Tx:0x007fd66a01d810 @scripts=[], @out=[#<Bitcoin::Protocol::TxOut:0x007fd66a01c550 @value=0, @pk_script_length=20, @pk_script=\"j\\x12OA\\x01\\x00\\x06\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\x00\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c3c0 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xE0\\x91~+a&n\\xBF\\xFC\\xDD\\x93\\x19\\x85\\xBF2C\\x14\\t\\xA7\\x18\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c208 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xF1\\x18\\x90\\xE0\\x03&\\xC3\\x9E\\x91\\xACN\\xB69c0[|\\xC5\\xF0\\xD2\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a01c028 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xC1\\xD5\\xEB[\\r;\\xCF\\xB2\\x81\\xE8\\xB4\\xC2\\xB2\\xD5\\x00T<v\\x96\\xA5\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017e38 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14]\\xC0M\\xA1gd_\\x9E3:.\\xDE\\xDF\\t\\xC3\\x99\\xAB\\xBA'\\x9D\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017c58 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14;J\\xFD\\x021\\xEB5\\xA5tZ=\\xD6\\x94\\x84\\x8C\\x17}\\xDD\\xA3\\xE2\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017ac8 @value=600, @pk_script_length=23, @pk_script=\"\\xA9\\x14\\xDF\\x86az]\\x92\\xEFP(}&\\xFA\\xCA\\x01\\xE35\\x01G\\xB9\\xC1\\x87\">, #<Bitcoin::Protocol::TxOut:0x007fd66a017938 @value=99990000, @pk_script_length=25, @pk_script=\"v\\xA9\\x14\\xDE\\x7F\\xF8s\\f\\xF8\\xA5S:\\x1EyO!B\\x89\\xE5\\xD5\\xFE\\x1ES\\x88\\xAC\">], @in=[#<Bitcoin::Protocol::TxIn:0x007fd66a01d608 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=0, @script_sig_length=106, @script_sig=\"G0D\\x02 g\\xD3\\xC6\\xFCL\\xD8'\\xCE)du\\x90\\xB8\\x97V\\xF3I\\xA4\\x9B\\xB5WAU\\xD0em\\xEA>qT\\x17\\xED\\x02 \\x17\\xF7)\\xD0\\x7FR\\e\\x1C^\\xE6\\xCD\\x80_(\\x89\\xFE\\x83\\x9D\\xB9\\xAB\\xC2\\x97\\xA8q\\x9FH\\xBBj\\xA9\\x03\\x17\\xF9\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01d3d8 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=1, @script_sig_length=106, @script_sig=\"G0D\\x02 G\\x10\\x8D\\xF8\\xE0\\v\\x12\\xD3\\x92\\x94{j<\\x0E\\x96\\x05\\x0FC@\\xE3\\xDB\\x1C?$)\\xA1\\xFF\\x0E\\xFA\\n?\\xD1\\x02 q\\xCA\\x80\\xE4\\xC1pk6L\\x99\\x11\\xF8t\\x88\\vv\\xC8Y\\x03\\xB2^1_\\t\\x17t\\x90\\x01\\xC5L\\xC4F\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01d1a8 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=2, @script_sig_length=106, @script_sig=\"G0D\\x02 i5\\xD1\\x90(\\x91\\xF2\\x93\\x18\\xA5\\xB8\\xC8\\x06&\\xF9\\x92\\xE2\\x10nS')A=\\xCC[\\xC9L\\xBAh\\xFA\\xDE\\x02 ,\\x83\\x1F\\x18,{\\x10\\xD1>?\\xC6\\f\\xADG\\xDF\\x99vE\\xA1\\xA4\\x1F\\xC1\\xCCl\\x1Ew\\xCB\\\"\\xDEV]\\x9A\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01cfa0 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=3, @script_sig_length=106, @script_sig=\"G0D\\x02 \\x152+\\x89\\x8D\\xFD\\xE1L\\xDC[\\x84\\xE8\\xC6\\xDF\\xB2\\xB3\\x83#kW\\xA8^6s[\\x99\\xFC\\x84\\xE8\\xEB\\f\\xC7\\x02 f\\xF5f[w$\\x1C5\\x17\\xD2\\xE8\\x8AA\\x9F\\xA5\\xF6FW\\xC7W\\xF1\\\"\\x99\\xC8[\\x86)\\x06\\x89\\xBA%\\x98\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01cd98 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=4, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\x85\\xE1v\\xD3\\xBD\\xBB\\xAD\\x87y\\x1C\\xC9A\\x99\\x84\\xD0W\\b;9\\xD4\\x8C\\x9CCC\\rM\\xB4\\x8A\\xDFQ%^\\x02 C6\\xAC\\x89\\x0E,S\\xE1\\xC7\\x16\\xDA\\xC6\\xC7%\\xA5c,s\\xC3\\xFAg\\xE5\\x14N\\x04\\xD2\\xD3B\\xED\\xED\\x83g\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01caf0 @prev_out_hash=\"\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\", @prev_out_index=5, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xB7\\xCA\\xC4Z\\x8D\\xFE\\v.\\xB4\\xD1\\x90t=\\x99^\\xAA\\xC0+\\xAA1\\xB4\\xEF5\\xE5\\vg0\\xE4Q\\xA2z\\xCF\\x02 c\\x0E\\xDD\\x8Dg\\xEB\\x83R\\x04\\x14\\x10#\\xDAsK\\xA8\\xDA\\x16\\x1AWe\\xCE<d\\xF4\\x80f[\\x94q\\xFA\\xC4\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66a01c898 @prev_out_hash=\"8\\xA4%\\xC0G\\xB0\\x95\\xE5+jx\\xF4\\xCC\\x14\\a'\\x9D\\xDC\\x1F\\x88!\\xD72\\xC5\\xFC\\xBB`\\x99\\xB8\\xE9g@\", @prev_out_index=1, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xD4\\xC2\\x9B2{\\xD1S\\xD4ZUF\\xAE\\xD2\\x14\\xCC\\xE6\\xAC1\\xD0\\xD6\\x1E!\\xD2\\xB1\\xDB\\xA3\\x06&\\x18zo\\x02\\x02 Y\\xF4\\aj\\xD8\\xF7\\\"\\xFB6U\\xEA\\xC1Y\\xF2y\\x94:\\x01\\xF0>{\\r|h\\t\\xD6\\xF1\\x83\\xCBXO\\x97\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\", @sequence=\"\\xFF\\xFF\\xFF\\xFF\">], @lock_time=0, @ver=1, @enable_bitcoinconsensus=false, @payload=\"\\x01\\x00\\x00\\x00\\a\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x00\\x00\\x00\\x00jG0D\\x02 g\\xD3\\xC6\\xFCL\\xD8'\\xCE)du\\x90\\xB8\\x97V\\xF3I\\xA4\\x9B\\xB5WAU\\xD0em\\xEA>qT\\x17\\xED\\x02 \\x17\\xF7)\\xD0\\x7FR\\e\\x1C^\\xE6\\xCD\\x80_(\\x89\\xFE\\x83\\x9D\\xB9\\xAB\\xC2\\x97\\xA8q\\x9FH\\xBBj\\xA9\\x03\\x17\\xF9\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x01\\x00\\x00\\x00jG0D\\x02 G\\x10\\x8D\\xF8\\xE0\\v\\x12\\xD3\\x92\\x94{j<\\x0E\\x96\\x05\\x0FC@\\xE3\\xDB\\x1C?$)\\xA1\\xFF\\x0E\\xFA\\n?\\xD1\\x02 q\\xCA\\x80\\xE4\\xC1pk6L\\x99\\x11\\xF8t\\x88\\vv\\xC8Y\\x03\\xB2^1_\\t\\x17t\\x90\\x01\\xC5L\\xC4F\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x02\\x00\\x00\\x00jG0D\\x02 i5\\xD1\\x90(\\x91\\xF2\\x93\\x18\\xA5\\xB8\\xC8\\x06&\\xF9\\x92\\xE2\\x10nS')A=\\xCC[\\xC9L\\xBAh\\xFA\\xDE\\x02 ,\\x83\\x1F\\x18,{\\x10\\xD1>?\\xC6\\f\\xADG\\xDF\\x99vE\\xA1\\xA4\\x1F\\xC1\\xCCl\\x1Ew\\xCB\\\"\\xDEV]\\x9A\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x03\\x00\\x00\\x00jG0D\\x02 \\x152+\\x89\\x8D\\xFD\\xE1L\\xDC[\\x84\\xE8\\xC6\\xDF\\xB2\\xB3\\x83#kW\\xA8^6s[\\x99\\xFC\\x84\\xE8\\xEB\\f\\xC7\\x02 f\\xF5f[w$\\x1C5\\x17\\xD2\\xE8\\x8AA\\x9F\\xA5\\xF6FW\\xC7W\\xF1\\\"\\x99\\xC8[\\x86)\\x06\\x89\\xBA%\\x98\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x04\\x00\\x00\\x00kH0E\\x02!\\x00\\x85\\xE1v\\xD3\\xBD\\xBB\\xAD\\x87y\\x1C\\xC9A\\x99\\x84\\xD0W\\b;9\\xD4\\x8C\\x9CCC\\rM\\xB4\\x8A\\xDFQ%^\\x02 C6\\xAC\\x89\\x0E,S\\xE1\\xC7\\x16\\xDA\\xC6\\xC7%\\xA5c,s\\xC3\\xFAg\\xE5\\x14N\\x04\\xD2\\xD3B\\xED\\xED\\x83g\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\x96\\x9E\\xEF\\xF6\\x10\\x91\\xCC\\xC9\\xFD\\xFF\\xE7Na\\xD7{\\xCC\\xE0x\\xD5a\\xE9\\x9B0\\xD5Gs\\x1C\\xDCO\\xD3\\x89J\\x05\\x00\\x00\\x00kH0E\\x02!\\x00\\xB7\\xCA\\xC4Z\\x8D\\xFE\\v.\\xB4\\xD1\\x90t=\\x99^\\xAA\\xC0+\\xAA1\\xB4\\xEF5\\xE5\\vg0\\xE4Q\\xA2z\\xCF\\x02 c\\x0E\\xDD\\x8Dg\\xEB\\x83R\\x04\\x14\\x10#\\xDAsK\\xA8\\xDA\\x16\\x1AWe\\xCE<d\\xF4\\x80f[\\x94q\\xFA\\xC4\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF8\\xA4%\\xC0G\\xB0\\x95\\xE5+jx\\xF4\\xCC\\x14\\a'\\x9D\\xDC\\x1F\\x88!\\xD72\\xC5\\xFC\\xBB`\\x99\\xB8\\xE9g@\\x01\\x00\\x00\\x00kH0E\\x02!\\x00\\xD4\\xC2\\x9B2{\\xD1S\\xD4ZUF\\xAE\\xD2\\x14\\xCC\\xE6\\xAC1\\xD0\\xD6\\x1E!\\xD2\\xB1\\xDB\\xA3\\x06&\\x18zo\\x02\\x02 Y\\xF4\\aj\\xD8\\xF7\\\"\\xFB6U\\xEA\\xC1Y\\xF2y\\x94:\\x01\\xF0>{\\r|h\\t\\xD6\\xF1\\x83\\xCBXO\\x97\\x01!\\x03\\x85\\xC9$c\\xFE\\xA9zE\\x8D`\\xBA\\xF7'\\nN\\xB9\\x03\\xF7\\xC8\\x92~\\xDD\\xCB8\\x9A\\xF0\\xC0Y\\x91y\\x05\\x8C\\xFF\\xFF\\xFF\\xFF\\b\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x14j\\x12OA\\x01\\x00\\x06\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\xCF\\x03\\x00X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xE0\\x91~+a&n\\xBF\\xFC\\xDD\\x93\\x19\\x85\\xBF2C\\x14\\t\\xA7\\x18\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xF1\\x18\\x90\\xE0\\x03&\\xC3\\x9E\\x91\\xACN\\xB69c0[|\\xC5\\xF0\\xD2\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xC1\\xD5\\xEB[\\r;\\xCF\\xB2\\x81\\xE8\\xB4\\xC2\\xB2\\xD5\\x00T<v\\x96\\xA5\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14]\\xC0M\\xA1gd_\\x9E3:.\\xDE\\xDF\\t\\xC3\\x99\\xAB\\xBA'\\x9D\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14;J\\xFD\\x021\\xEB5\\xA5tZ=\\xD6\\x94\\x84\\x8C\\x17}\\xDD\\xA3\\xE2\\x87X\\x02\\x00\\x00\\x00\\x00\\x00\\x00\\x17\\xA9\\x14\\xDF\\x86az]\\x92\\xEFP(}&\\xFA\\xCA\\x01\\xE35\\x01G\\xB9\\xC1\\x87\\xF0\\xB9\\xF5\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14\\xDE\\x7F\\xF8s\\f\\xF8\\xA5S:\\x1EyO!B\\x89\\xE5\\xD5\\xFE\\x1ES\\x88\\xAC\\x00\\x00\\x00\\x00\", @hash=\"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\"> \n\n# P2PKH\u306eUTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\nrich_prev_tx_bin   = oa_api.provider.getrawtransaction(rich_prev_txid)\n# => \"0100000002d11a536e32c4437cca45d03dd4c35a39c4f9fab074d7a77b7f87f1e789b3e307000000006b483045022100a83f304622fa30e39ec07e6cd234e9225e198918f226f133cae62fb8471d1fd502207d3ef2edd68b8509707ceac1a4ce7771777f210914b73c16b1adcc16d7de19670121035c4c07baacdcf5fd7631f1c27de29811bc86aea7c4bdfd583f397b669edff400feffffffa0443ede7c08f16cebe90b718dc13b32c51e487e295753e5a20109fa9d155aa3000000006b483045022100c846646f5e909af13f4e1f2a13f6b02ca876a25884cb03ed068d6f5f6dd955d9022012d7b773a36a1cce4106da57ccc3e95aac0bc7f927614791a0c460e820ae28870121026fab0d63cf13d6bc57ace182033115a3acf91b6aa70ca70cd7ff753edc9f97defeffffff021070f205000000001976a91466c9312a3564e241605f78f5806a4d9031c3888088ac00e1f505000000001976a91496bd29086134fdc13906eb846b826602a6e0b4bf88ac79000000\"\nrich_prev_tx       = Bitcoin::Protocol::Tx.new(rich_prev_tx_bin.htb)\n# => #<Bitcoin::Protocol::Tx:0x007fd66d0ef538 @scripts=[], @out=[#<Bitcoin::Protocol::TxOut:0x007fd66d0eee80 @value=99774480, @pk_script_length=25, @pk_script=\"v\\xA9\\x14f\\xC91*5d\\xE2A`_x\\xF5\\x80jM\\x901\\xC3\\x88\\x80\\x88\\xAC\">, #<Bitcoin::Protocol::TxOut:0x007fd66d0eecf0 @value=100000000, @pk_script_length=25, @pk_script=\"v\\xA9\\x14\\x96\\xBD)\\ba4\\xFD\\xC19\\x06\\xEB\\x84k\\x82f\\x02\\xA6\\xE0\\xB4\\xBF\\x88\\xAC\">], @in=[#<Bitcoin::Protocol::TxIn:0x007fd66d0ef330 @prev_out_hash=\"\\xD1\\x1ASn2\\xC4C|\\xCAE\\xD0=\\xD4\\xC3Z9\\xC4\\xF9\\xFA\\xB0t\\xD7\\xA7{\\x7F\\x87\\xF1\\xE7\\x89\\xB3\\xE3\\a\", @prev_out_index=0, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xA8?0F\\\"\\xFA0\\xE3\\x9E\\xC0~l\\xD24\\xE9\\\"^\\x19\\x89\\x18\\xF2&\\xF13\\xCA\\xE6/\\xB8G\\x1D\\x1F\\xD5\\x02 }>\\xF2\\xED\\xD6\\x8B\\x85\\tp|\\xEA\\xC1\\xA4\\xCEwqw\\x7F!\\t\\x14\\xB7<\\x16\\xB1\\xAD\\xCC\\x16\\xD7\\xDE\\x19g\\x01!\\x03\\\\L\\a\\xBA\\xAC\\xDC\\xF5\\xFDv1\\xF1\\xC2}\\xE2\\x98\\x11\\xBC\\x86\\xAE\\xA7\\xC4\\xBD\\xFDX?9{f\\x9E\\xDF\\xF4\\x00\", @sequence=\"\\xFE\\xFF\\xFF\\xFF\">, #<Bitcoin::Protocol::TxIn:0x007fd66d0ef128 @prev_out_hash=\"\\xA0D>\\xDE|\\b\\xF1l\\xEB\\xE9\\vq\\x8D\\xC1;2\\xC5\\x1EH~)WS\\xE5\\xA2\\x01\\t\\xFA\\x9D\\x15Z\\xA3\", @prev_out_index=0, @script_sig_length=107, @script_sig=\"H0E\\x02!\\x00\\xC8Fdo^\\x90\\x9A\\xF1?N\\x1F*\\x13\\xF6\\xB0,\\xA8v\\xA2X\\x84\\xCB\\x03\\xED\\x06\\x8Do_m\\xD9U\\xD9\\x02 \\x12\\xD7\\xB7s\\xA3j\\x1C\\xCEA\\x06\\xDAW\\xCC\\xC3\\xE9Z\\xAC\\v\\xC7\\xF9'aG\\x91\\xA0\\xC4`\\xE8 \\xAE(\\x87\\x01!\\x02o\\xAB\\rc\\xCF\\x13\\xD6\\xBCW\\xAC\\xE1\\x82\\x031\\x15\\xA3\\xAC\\xF9\\ej\\xA7\\f\\xA7\\f\\xD7\\xFFu>\\xDC\\x9F\\x97\\xDE\", @sequence=\"\\xFE\\xFF\\xFF\\xFF\">], @lock_time=121, @ver=1, @enable_bitcoinconsensus=false, @payload=\"\\x01\\x00\\x00\\x00\\x02\\xD1\\x1ASn2\\xC4C|\\xCAE\\xD0=\\xD4\\xC3Z9\\xC4\\xF9\\xFA\\xB0t\\xD7\\xA7{\\x7F\\x87\\xF1\\xE7\\x89\\xB3\\xE3\\a\\x00\\x00\\x00\\x00kH0E\\x02!\\x00\\xA8?0F\\\"\\xFA0\\xE3\\x9E\\xC0~l\\xD24\\xE9\\\"^\\x19\\x89\\x18\\xF2&\\xF13\\xCA\\xE6/\\xB8G\\x1D\\x1F\\xD5\\x02 }>\\xF2\\xED\\xD6\\x8B\\x85\\tp|\\xEA\\xC1\\xA4\\xCEwqw\\x7F!\\t\\x14\\xB7<\\x16\\xB1\\xAD\\xCC\\x16\\xD7\\xDE\\x19g\\x01!\\x03\\\\L\\a\\xBA\\xAC\\xDC\\xF5\\xFDv1\\xF1\\xC2}\\xE2\\x98\\x11\\xBC\\x86\\xAE\\xA7\\xC4\\xBD\\xFDX?9{f\\x9E\\xDF\\xF4\\x00\\xFE\\xFF\\xFF\\xFF\\xA0D>\\xDE|\\b\\xF1l\\xEB\\xE9\\vq\\x8D\\xC1;2\\xC5\\x1EH~)WS\\xE5\\xA2\\x01\\t\\xFA\\x9D\\x15Z\\xA3\\x00\\x00\\x00\\x00kH0E\\x02!\\x00\\xC8Fdo^\\x90\\x9A\\xF1?N\\x1F*\\x13\\xF6\\xB0,\\xA8v\\xA2X\\x84\\xCB\\x03\\xED\\x06\\x8Do_m\\xD9U\\xD9\\x02 \\x12\\xD7\\xB7s\\xA3j\\x1C\\xCEA\\x06\\xDAW\\xCC\\xC3\\xE9Z\\xAC\\v\\xC7\\xF9'aG\\x91\\xA0\\xC4`\\xE8 \\xAE(\\x87\\x01!\\x02o\\xAB\\rc\\xCF\\x13\\xD6\\xBCW\\xAC\\xE1\\x82\\x031\\x15\\xA3\\xAC\\xF9\\ej\\xA7\\f\\xA7\\f\\xD7\\xFFu>\\xDC\\x9F\\x97\\xDE\\xFE\\xFF\\xFF\\xFF\\x02\\x10p\\xF2\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14f\\xC91*5d\\xE2A`_x\\xF5\\x80jM\\x901\\xC3\\x88\\x80\\x88\\xAC\\x00\\xE1\\xF5\\x05\\x00\\x00\\x00\\x00\\x19v\\xA9\\x14\\x96\\xBD)\\ba4\\xFD\\xC19\\x06\\xEB\\x84k\\x82f\\x02\\xA6\\xE0\\xB4\\xBF\\x88\\xACy\\x00\\x00\\x00\", @hash=\"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\"> \n```\n\n\n# RedeemScript\u306e\u53d6\u5f97\nRedeemScript\u306f\u3001\u4f55\u3089\u304b\u306e\u65b9\u6cd5\uff08\u30e1\u30fc\u30eb\u3084\u5225\u306eWeb\u30b7\u30b9\u30c6\u30e0\u306a\u3069\uff09\u3067\u3082\u3089\u3063\u3066\u3044\u308b\u3082\u306e\u3068\u3059\u308b\u3002\n\n```rb\nredeem_script_hex = '0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac'\n\nredeem_script     = Bitcoin::Script.new(redeem_script_hex.htb)\n# => #<Bitcoin::Script:0x007fd66e091e28 @raw_byte_sizes=[39, 0], @previous_output_script=nil, @input_script=\"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @raw=\"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @chunks=[\"u\", 177, 117, \"\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\", 172], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# \u3053\u3093\u306a\u30b9\u30af\u30ea\u30d7\u30c8\nredeem_script.to_string\n# => \"75 OP_NOP2 OP_DROP 02057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011b OP_CHECKSIG\" \n\n```\nhex\u5f62\u5f0f\u3060\u3068\u3001\u4f55\u304b\u3068\u53d7\u3051\u6e21\u3057\u3057\u3084\u3059\u3044\u306e\u3067\u3001\u3053\u306e\u5f62\u5f0f\u3067\u3082\u3089\u3063\u3066\u3044\u305f\u3068\u4eee\u5b9a\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u89e3\u8aac\u3092\u5c11\u3057\u3059\u308b\u3068\u3001\n\n* \u300c75\u300d\u306f\u30ea\u30c8\u30eb\u30a8\u30f3\u30c7\u30a3\u30a2\u30f3\u5f62\u5f0f\u306elocktime\u3002\u5024\u306f117\u3002\n* \u300cOP_NOP2\u300d\u306fOP_CHECKLOCKTIMEVERIFY\u306e\u3053\u3068\u3002\n* \u300cOP_DROP\u300d\u306f\u30b9\u30bf\u30c3\u30af\u6700\u4e0a\u4f4d\u306e\u8981\u7d20\u3092\u524a\u9664\u3059\u308b\u547d\u4ee4\u3002\n* \u300c020...\u300d\u306f\u53d7\u4fe1\u8005\uff08\u305d\u306eUTXO\u304c\u4f7f\u7528\u53ef\u80fd\u306a\u4eba\uff09\u306e\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u3002\n* \u300cOP_CHECKSIG\u300d\u306f\u3001P2PKH\u3067\u3082\u304a\u306a\u3058\u307f\u306escriptSig\uff08sig + pubkey\uff09\u306e\u691c\u8a3c\u547d\u4ee4\u3002\n\n# \u672a\u7f72\u540d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\n## P2PKH\u306e\u4f5c\u6210\n\nBuilder\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u751f\u6210\u3002\u7f72\u540d\uff08scriptSig\uff09\u306e\u4f5c\u6210\u306f\u3057\u306a\u3044\u306e\u3067\u3001input\u4f5c\u6210\u6642\u306b\u306f\u3001signature_key\u306f\u6307\u5b9a\u3057\u306a\u3044\u3002\n\n```rb\ntx_bldr = Bitcoin::Builder::TxBuilder.new\n\n# \u5165\u529b\u90e8\u306e\u4f5c\u6210\ntx_bldr.input do |i|\n  i.prev_out rich_prev_tx\n  i.prev_out_index rich_prev_out_index\nend\n\n# \u51fa\u529b\u90e8\u306e\u4f5c\u6210\ntx_out_bldr = tx_bldr.output do |o|\n   o.value 99800000 # 0.998 BTC in satoshis\n   o.script {|s| s.recipient to }\nend\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u672a\u7f72\u540d\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\npp tx_bldr.tx.to_hash\n\n{\"hash\"=>\"1d3b74cd4933230dff2dbaa91aff119c863c695a225bff1ae2c3495b31d0bfdf\",\n \"ver\"=>1,\n \"vin_sz\"=>1,\n \"vout_sz\"=>1,\n \"lock_time\"=>0,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\"}],\n \"out\"=>\n  [{\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n```\n\n## P2SH\u306e\u4f5c\u6210\n[Azuchi\u69d8\u306e\u30d6\u30ed\u30b0](http://techmedia-think.hatenablog.com/entry/2016/05/31/184257)\u3092\u53c2\u8003\u306b\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u751f\u6210\u30e1\u30bd\u30c3\u30c9\u3092\u5b9a\u7fa9\u3057\u3066\u3001\u3088\u3073\u51fa\u3059\u3002\n\n```rb\n# LOCKTIME\u4ed8\u304dP2SH\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u751f\u6210\u30e1\u30bd\u30c3\u30c9\ndef spend_unsigned_tx(locktime, txid, vout, address)\n  tx = Bitcoin::Protocol::Tx.new\n  tx.lock_time = locktime   # \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u5168\u4f53\u306elock_time\u3092\u6307\u5b9a\u3059\u308b\n  # \u5165\u529b\u90e8\u306e\u4f5c\u6210\uff08\u3053\u308c\u304cP2SH\u3067\u9001\u3089\u308c\u305fUTXO\uff09\n  tx_in = Bitcoin::Protocol::TxIn.from_hex_hash(txid, vout)\n  tx_in.sequence = [0].pack(\"V\")   # ffffffff\u306e\u5834\u5408\u3001\u691c\u8a3c\u306b\u5931\u6557\u3059\u308b\u3002\n  tx.add_in(tx_in)\n  # \u51fa\u529b\u90e8\u306e\u4f5c\u6210\uff08600satoshi\u5206\u306e\u9001\u91d1\uff09\n  tx_out = Bitcoin::Protocol::TxOut.new(600, Bitcoin::Script.new(Bitcoin::Script.to_address_script(address)).to_payload)\n  tx.add_out(tx_out)\n  tx\nend\n\n# \u300c\u51cd\u7d50\u3055\u308c\u305fUTXO\u300d\u3092\u5165\u529b\u3068\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\nunsigned_tx = spend_unsigned_tx(locktime, locked_prev_txid, locked_prev_out_index, to)\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u672a\u7f72\u540d\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3002\npp unsigned_tx.to_hash\n\n{\"hash\"=>\"c04f5ebcccd6fc58e337eb9c0636e8337d90df923cb94c0a975beecdf5648f5d\",\n \"ver\"=>1,\n \"vin_sz\"=>1,\n \"vout_sz\"=>1,\n \"lock_time\"=>117,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\",\n    \"sequence\"=>0}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n```\n\n## P2PKH\u3068P2SH\u306e\u5408\u4f53\n\n\"tx\"\u3068\u3044\u3046\u540d\u524d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3059\u308b\u3002\nP2SH\u304c0\u756a\u306b\u3001P2PKH\u304c1\u756a\u306e\u5165\u529b\u306b\u306a\u308b\u3088\u3046\u306b\u3001\u6b21\u306e\u3088\u3046\u306b\u3059\u308b\u3002\n\n```rb\nunsigned_tx.add_in(tx_bldr.tx.in[0])\nunsigned_tx.add_out(tx_bldr.tx.out[0])\n\ntx = unsigned_tx\n\n# \u3053\u3093\u306a\u611f\u3058\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u306a\u308b\npp tx.to_hash; nil\n{\"hash\"=>\"c04f5ebcccd6fc58e337eb9c0636e8337d90df923cb94c0a975beecdf5648f5d\",\n \"ver\"=>1,\n \"vin_sz\"=>2,\n \"vout_sz\"=>2,\n \"lock_time\"=>117,\n \"size\"=>85,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\",\n    \"sequence\"=>0},\n   {\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\"\"}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"},\n   {\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n```\n\nvin\u304c2\u3064\u672a\u7f72\u540d\u3067\u3002vout\u304c2\u3064\u3042\u308b\u3002\n\n# \u7f72\u540d\u5b9f\u884c\n\u3053\u3053\u304c\u30dd\u30a4\u30f3\u30c8\u3002vin\u306escriptSig\u306f\u3001\u300c\u300cvin\u3092\u542b\u3080\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u300d\u3092\u79d8\u5bc6\u9375\u2460\u3067\u6697\u53f7\u5316\u3057\u305f\u3082\u306e\u300d\u3068\u300c\u2460\u306e\u5bfe\u3068\u306a\u308b\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u300d\u304c\u683c\u7d0d\u3055\u308c\u308b\u3002\u524d\u8005\u306f\u3001\u3053\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u6539\u7ac4\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u4e3b\u5f35\u3059\u308b\u3082\uff08\u304b\u3064\u3001UTXO\u304c\u6307\u5b9a\u3059\u308b\u516c\u958b\u9375\u7b49\u306b\u3088\u3063\u3066\u305d\u306e\u5229\u7528\u304c\u6b63\u5f53\u3067\u3042\u308b\u3068\u691c\u8a3c\u3067\u304d\u308b\u3082\u306e\uff09\u306e\u3067\u3001\u5f8c\u8005\u306f\u3001\u306e\u3061\u306b\u7b2c\u4e09\u8005\u304c\u305d\u308c\u3092\u691c\u8a3c\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3042\u308b\u3002\n\n\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u60c5\u5831\u3060\u3051\u307f\u308b\u3068\u3001P2PKH\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u3002\n\n```\n scriptSig: <sig> <pubKey>\n```\n\nP2SH\u306e\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3002\uff08\u305f\u3060\u3057\u3001RedeemScript\u306b\u3088\u3063\u3066\u30b1\u30fc\u30b9\u30d0\u30a4\u30b1\u30fc\u30b9\uff09\n\n```\nscriptSig: ..signatures... <serialized script>\n```\n\n## P2PKH\u90e8\u5206\n\n```rb\n# \u305d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\u3059\u308b\n# signature_hash_for_input\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u307e\u305a\u3001scriptSig\u3092\"\"\u3067\u5165\u308c\u66ff\u3048\u3066\u3001\n# \u6307\u5b9a\u3057\u305fvin\uff08\u7b2c\u4e00\u5f15\u6570\u3067\u6307\u5b9a\uff09\u306escriptSig\u306b\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3092\u5165\u308c\u305f\n# \u300c\u4eee\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u300d\u306b\u3064\u3044\u3066\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\u3059\u308b\u3002\n# \u3053\u306e\u3068\u304d\u3001lock_time\u3084hash_type\u3001vin/vout\u306e\u6570\u3084\u30da\u30a4\u30ed\u30fc\u30c9\u3082\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u306b\u542b\u307e\u308c\u308b\u305f\u3081\u3001\n# \u3053\u306e\u7f72\u540d\u4ee5\u964d\u3067\u3001vin/vout\u306a\u3069\u306e\u5909\u66f4\u306f\u3067\u304d\u306a\u3044\u3002\nsig_hash = tx.signature_hash_for_input(1, rich_prev_tx,\n  Bitcoin::Script::SIGHASH_TYPE[:all])\n# => \"-\\xE30v@\\x9A\\x03\\xDDt\\xC7s\\x00h;\\x13\\x91n\\x91\\x9D\\fx\\x88\\xD8\\x0F\\x9C\\xD3.\\x89\\x16\\xA4e\\x88\" \n\n# \u8a08\u7b97\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u3092\u3001\u79d8\u5bc6\u9375\u3067\u6697\u53f7\u5316\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u306b\u3001hash_type\u3092\u6307\u5b9a\u3059\u308b\u3002\n# \u3042\u3068\u3067vout\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u306a\u3051\u308c\u3070\u3001:all\u3067\u6307\u5b9a\u3059\u308b\u3002\nsig = rich_key_obj.sign(sig_hash) +\n  [Bitcoin::Script::SIGHASH_TYPE[:all]].pack(\"C\")\n# => \"0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01\" \n\n# hex\u3067\u898b\u308b\u3068\u3053\u3093\u306a\u611f\u3058(tx.to_hash\u306escriptSig\u3067\u78ba\u8a8d\u3067\u304d\u308b\u5024\u3068\u540c\u3058)\n# sig.bth\n# => \"3045022100efe7349c7933bf8e806af646bcebce39dced48e45b2709c841d28c0a929cd26f02203270359ba32c99095b31913744fddcf02dcbe8ea0d5159e1f4b534194e8faa2401\" \n\n# scriptSig\u3092\u4f5c\u6210\u3059\u308b\u3002sig\u306b\u52a0\u3048\u3066\u3001\u305d\u308c\u3092\u7b2c\u4e09\u8005\u304c\u691c\u8a3c\u3059\u308b\u305f\u3081\u306b\u516c\u958b\u9375\u3092\u4ed8\u4e0e\u3059\u308b\u3002\nscript_sig = Bitcoin::Script.new(Bitcoin::Script.pack_pushdata(sig) +\n  Bitcoin::Script.pack_pushdata(rich_key_obj.pub.htb))\n# => #<Bitcoin::Script:0x007fd66ae94560 @raw_byte_sizes=[107, 0], @previous_output_script=nil, @input_script=\"H0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01!\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\", @raw=\"H0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01!\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\", @chunks=[\"0E\\x02!\\x00\\xEF\\xE74\\x9Cy3\\xBF\\x8E\\x80j\\xF6F\\xBC\\xEB\\xCE9\\xDC\\xEDH\\xE4['\\t\\xC8A\\xD2\\x8C\\n\\x92\\x9C\\xD2o\\x02 2p5\\x9B\\xA3,\\x99\\t[1\\x917D\\xFD\\xDC\\xF0-\\xCB\\xE8\\xEA\\rQY\\xE1\\xF4\\xB54\\x19N\\x8F\\xAA$\\x01\", \"\\x02\\x89_M\\xA6AN\\x946\\x80fq\\\\E\\xBC8\\xC7\\xFFK?\\xB9|\\xEC\\xA7\\x18$\\x15\\x88Q\\x9C\\x05I\\x9B\"], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# script_sig.to_string\n# => 3045022100efe7349c7933bf8e806af646bcebce39dced48e45b2709c841d28c0a929cd26f02203270359ba32c99095b31913744fddcf02dcbe8ea0d5159e1f4b534194e8faa2401 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\" \n\n# \u7f72\u540d\u3092\u30bb\u30c3\u30c8\u3059\u308b\ntx.in[1].script_sig = script_sig.to_payload\n```\n\n\u79c1\u306f\u3001P2PKH\u306flocktime\u306f\u95a2\u4fc2\u306a\u3044\uff01\u3068\u601d\u3044\u8fbc\u3093\u3067\u3001\u7f72\u540d\u3057\u305f\u3042\u3068\u306b\u3001\nlocktime\u3092\u5909\u3048\u305f\u308a\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u7d50\u69cb\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\uff08\u5f8c\u8ff0\uff09\n\n## P2SH\u90e8\u5206\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4f5c\u6210\u6642\u3068\u540c\u69d8\u306b\u3001\u5c02\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u7528\u610f\u3002P2PKH\u3068\u7570\u306a\u308a\u3001RedeemScript\u672c\u4f53\u3092\u4f7f\u3063\u3066\u7f72\u540d\u3092\u4f5c\u308b\u3002\uff08\u516c\u958b\u9375\u306e\u4ee3\u308f\u308a\u306b\u306a\u308b\uff09\n\n```rb\n# \u30ed\u30c3\u30af\u3055\u308c\u305fUTXO\u306e\u7f72\u540d\u30b9\u30af\u30ea\u30d7\u30c8(scriptSig)\ndef spend_script(priv_key, locktime, unsigned_tx, n, redeem_script)\n  tx = Marshal.load(Marshal.dump(unsigned_tx))\n\n  # vin\u306escript_sig\u306b\u3001RedeemScri\uff50\uff54\u3067\u4eee\u7f6e\u304d\uff08P2PKH\u306e\u3068\u304d\u306f\u3001\u81ea\u8eab\u306e\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\uff09\n  tx.in[0].script_sig = redeem_script.to_payload\n\n  # \u4eee\u7f6e\u304d\u72b6\u614b\u3067\u3001\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u8a08\u7b97\uff08P2PKH\u306e\u3068\u304d\u3068\u540c\u69d8\uff09\n  sig_hash = tx.signature_hash_for_input(n,\n    redeem_script.to_payload, Bitcoin::Script::SIGHASH_TYPE[:all])\n\n  # \u30cf\u30c3\u30b7\u30e5\u5024\u3092\u79d8\u5bc6\u9375\u3067\u6697\u53f7\u5316\u3002P2PKH\u540c\u69d8\u3001hash_type\u306f:all\u306b\u5408\u308f\u305b\u308b\u3002\n  sig = priv_key.sign(sig_hash) +\n    [Bitcoin::Script::SIGHASH_TYPE[:all]].pack(\"C\")\n\n  # \u623b\u308a\u5024\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5f62\u5f0f\u306b\u3057\u3066\u3001sig\u3068RedeemScript\uff08\u672c\u4f53\uff09\u3092\u9001\u308b\u3002\n  # \u4eca\u56de\u306eRedeemScript\u306b\u306f\u3001\u76f8\u624b\u65b9\u306e\u516c\u958b\u9375\uff08\u672c\u4f53\uff09\u304c\u542b\u307e\u308c\u308b\u3088\u3046\u306b\u4f5c\u3063\u3066\u3042\u308b\u306e\u3067\u3001\n  # P2PKH\u3068\u540c\u7b49\u306e\u691c\u8a3c\u3092\u884c\u3046\u3053\u3068\u304c\u53ef\u80fd\u3002\n  Bitcoin::Script.new(Bitcoin::Script.pack_pushdata(sig) +\n    Bitcoin::Script.pack_pushdata(redeem_script.to_payload))\nend\n\n# \u30e1\u30bd\u30c3\u30c9\u3067scriptSig\u4f5c\u6210\u3002\nspend_script = spend_script(from_key_obj,\u3000locktime, tx, 0, redeem_script)\n# => #<Bitcoin::Script:0x007fd66d1bc4c0 @raw_byte_sizes=[112, 0], @previous_output_script=nil, @input_script=\"G0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01'\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @raw=\"G0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01'\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\", @chunks=[\"0D\\x02 ZO\\xD0}\\x19\\xDF\\x121\\xF1\\x03\\xADx\\xA1q\\xDD\\xCC\\xAC#1\\bcK\\xF34\\x19\\x13\\xE3^I\\xB5h\\xB4\\x02 \\x1D}\\xFBI\\x81\\xA4\\xA6\\xBE\\xD4 6\\xE4\\x95\\xBD16\\x83W\\x9C\\x99\\xBF\\xDF\\xBD\\x17\\xD6}\\xA6\\xE1X\\xF9\\\\#\\x01\", \"\\x01u\\xB1u!\\x02\\x05x q\\x06w\\xD9g\\xD1;k\\xE4\\x04\\xA2b$\\x98\\xCE\\x0F\\x84\\xCB\\xB1\\a\\xB9\\x00?\\x833zm\\x01\\e\\xAC\"], @exec_stack=[], @stack_alt=[], @stack=[], @last_codeseparator_index=0, @do_exec=true> \n\n# spend_script.to_string \n# => \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\" \n\n# \u7f72\u540d\u3092\u30bb\u30c3\u30c8\ntx.in[0].script_sig = spend_script.to_payload\n```\n\n# \u7f72\u540d\u691c\u8a3c\n\nverify_input_signature\u304c\u4fbf\u5229\u3002\n\n* \u7b2c\u4e00\u5f15\u6570: vin\u306e\u756a\u53f7\n* \u7b2c\u4e8c\u5f15\u6570: UTXO\u304c\u542b\u307e\u308c\u308b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\n\n```rb\n# P2SH\u306eUTXO\u3092\u4f7f\u3046vin\ntx.verify_input_signature(0, locked_prev_tx)\n# => true\n\n# P2PKH\u306eUTXO\u3092\u4f7f\u3046vin\ntx.verify_input_signature(1, rich_prev_tx)\n# => true\n```\nfalse\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u304d\u306f\u3001\u3069\u3053\u304b\u9593\u9055\u3044\u304c\u3042\u308b\u3002\ntrue\u3068\u8868\u793a\u3055\u308c\u3066\u3082\u3001\u5b89\u5fc3\u306f\u7981\u7269\u3002\nbitcoin-ruby\u306fscript\u306e\u5b9f\u88c5\u304c\u3084\u3084\u9045\u304f\u3001\u4f8b\u3048\u3070\u3001\u4eca\u56de\u4f8b\u793a\u306eOP_NOP2\u306f\u3001\u4f55\u3082\u51e6\u7406\u304c\u304b\u304b\u308c\u3066\u3044\u306a\u3044\u3002\uff08locktime\u306e\u5024\u304c\u5909\u308f\u3063\u305f\u3068\u3057\u3066\u3082\u3001\u5e38\u306btrue\u306b\u306a\u308b\uff09\n\n\n# \u5b8c\u6210\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\n\n```rb\npp tx.to_hash\n\n{\"hash\"=>\"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\",\n \"ver\"=>1,\n \"vin_sz\"=>2,\n \"vout_sz\"=>2,\n \"lock_time\"=>117,\n \"size\"=>378,\n \"in\"=>\n  [{\"prev_out\"=>\n     {\"hash\"=>\n       \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"n\"=>1},\n    \"scriptSig\"=>\n     \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\",\n    \"sequence\"=>0},\n   {\"prev_out\"=>\n     {\"hash\"=>\n       \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"n\"=>1},\n    \"scriptSig\"=>\n     \"30440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d8201 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\"}],\n \"out\"=>\n  [{\"value\"=>\"0.00000600\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"},\n   {\"value\"=>\"0.99800000\",\n    \"scriptPubKey\"=>\n     \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\"}]}\n```\n\n# \u5b9f\u884c\n\n## \u9001\u91d1\u5b9f\u884c\n\n```rb\nserialzed_tx = tx.to_payload.bth\n# => \"01000000022f6e306cad4753cc7a30a598b6b24f61c16e2bbb383e3a0ed5cc06f76a51e9a0010000007047304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac00000000cced3615422a1fdc82f9944e6181724c865be5fa330a614752378fa79593200d010000006a4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499bffffffff0258020000000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788acc0d3f205000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac75000000\" \n\n# \u9001\u4fe1\noa_api.provider.sendrawtransaction(serialzed_tx)\n# => \"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\" \n```\n\n## \u78ba\u8a8d\n\nbitcoin-cli\u304b\u3089\u3001\u5148\u307b\u3069\u306etxid\u3067\u691c\u7d22\u3057\u3066\u307f\u308b\u3002\n\n```shell-session\n% bitcoin-cli getrawtransaction  1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9 1\n{\n  \"hex\": \"01000000022f6e306cad4753cc7a30a598b6b24f61c16e2bbb383e3a0ed5cc06f76a51e9a0010000007047304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac00000000cced3615422a1fdc82f9944e6181724c865be5fa330a614752378fa79593200d010000006a4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499bffffffff0258020000000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788acc0d3f205000000001976a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac75000000\",\n  \"txid\": \"1f82c103226a2a49d7e1c06b8484e8914ae88de4267643aa963f553af71d12a9\",\n  \"size\": 378,\n  \"version\": 1,\n  \"locktime\": 117,\n  \"vin\": [\n    {\n      \"txid\": \"a0e9516af706ccd50e3a3e38bb2b6ec1614fb2b698a5307acc5347ad6c306e2f\",\n      \"vout\": 1,\n      \"scriptSig\": {\n        \"asm\": \"304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c23[ALL] 0175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\",\n        \"hex\": \"47304402205a4fd07d19df1231f103ad78a171ddccac233108634bf3341913e35e49b568b402201d7dfb4981a4a6bed42036e495bd313683579c99bfdfbd17d67da6e158f95c2301270175b1752102057820710677d967d13b6be404a2622498ce0f84cbb107b9003f83337a6d011bac\"\n      },\n      \"sequence\": 0\n    }, \n    {\n      \"txid\": \"0d209395a78f375247610a33fae55b864c7281614e94f982dc1f2a421536edcc\",\n      \"vout\": 1,\n      \"scriptSig\": {\n        \"asm\": \"30440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82[ALL] 02895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\",\n        \"hex\": \"4730440220258cd9031851a454756ef1bd61226231f0b554e39e9efb77a119d1df9fbc955c02203eada6fa9e2ea0339a39229b8e5bea71acc080d9dfc9c6b3842d4a7447674d82012102895f4da6414e94368066715c45bc38c7ff4b3fb97ceca718241588519c05499b\"\n      },\n      \"sequence\": 4294967295\n    }\n  ],\n  \"vout\": [\n    {\n      \"value\": 0.00000600,\n      \"n\": 0,\n      \"scriptPubKey\": {\n        \"asm\": \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\",\n        \"hex\": \"76a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac\",\n        \"reqSigs\": 1,\n        \"type\": \"pubkeyhash\",\n        \"addresses\": [\n          \"mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP\"\n        ]\n      }\n    }, \n    {\n      \"value\": 0.99800000,\n      \"n\": 1,\n      \"scriptPubKey\": {\n        \"asm\": \"OP_DUP OP_HASH160 bd12e4492be5b2c65b21cb38fad62851397c81f7 OP_EQUALVERIFY OP_CHECKSIG\",\n        \"hex\": \"76a914bd12e4492be5b2c65b21cb38fad62851397c81f788ac\",\n        \"reqSigs\": 1,\n        \"type\": \"pubkeyhash\",\n        \"addresses\": [\n          \"mxkgdvxkTyPQDzBHYFnSJhcsHM3qaEFmsP\"\n        ]\n      }\n    }\n  ],\n  \"blockhash\": \"26a33829645c4ba52b83da8427022307ee36a9a3fa2c30591cc462d4de2d8518\",\n  \"confirmations\": 1,\n  \"time\": 1467771445,\n  \"blocktime\": 1467771445\n}\n```\n\n\u7121\u4e8b\u3001\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u3002\n\n\n# \u767a\u5c55\uff1a\u3082\u3063\u3068\u8a73\u3057\u304f\n## Tx.signature_hash_for_input\n\n\u30b7\u30b0\u30cd\u30c1\u30e3\u4f5c\u6210\u3092\u62c5\u3063\u3066\u3044\u308b\u3053\u308c\u3092\u898b\u308b\u3002\n\n```rb\n      def signature_hash_for_input(input_idx, subscript, hash_type=nil)\n        # \u4e2d\u7565\u3002pin\u306f\u3001\"pseudo vin\"\uff08\u64ec\u4f3cvin\uff09\u3068\u601d\u308f\u308c\u308b\u3002TCP/IP\u306e\u64ec\u4f3c\u30d8\u30c3\u30c0\u3068\u540c\u3058\u3002\n        # \u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u306e\u305f\u3081\u3060\u3051\u306b\u4f5c\u3089\u308c\u308bvin\u3002scriptSig\u304c\u7a7a\u306b\u306a\u308a\u3001\n        # \u6307\u5b9a\u306evin\u306escriptSig\u3060\u3051\u304c\u3001\u516c\u958b\u9375\u30cf\u30c3\u30b7\u30e5\u3092\u57cb\u3081\u3089\u308c\u308b\u3002\n        pin  = @in.map.with_index{|input,idx|\n          if idx == input_idx\n            subscript = subscript.out[ input.prev_out_index ].script if subscript.respond_to?(:out) # legacy api (outpoint_tx)\n            input.to_payload(subscript)\n          else\n            case (hash_type & 0x1f)\n            when SIGHASH_TYPE[:none];   input.to_payload(\"\", \"\\x00\\x00\\x00\\x00\")\n            when SIGHASH_TYPE[:single]; input.to_payload(\"\", \"\\x00\\x00\\x00\\x00\")\n            else;                       input.to_payload(\"\")\n            end\n          end\n        }\n\n        pout = @out.map(&:to_payload)\n        in_size, out_size = Protocol.pack_var_int(@in.size), Protocol.pack_var_int(@out.size)\n\n        case (hash_type & 0x1f)\n        when SIGHASH_TYPE[:none]\n          pout = \"\"\n          out_size = Protocol.pack_var_int(0)\n        when SIGHASH_TYPE[:single]\n          return \"\\x01\".ljust(32, \"\\x00\") if input_idx >= @out.size # ERROR: SignatureHash() : input_idx=%d out of range (SIGHASH_SINGLE)\n          pout = @out[0...(input_idx+1)].map.with_index{|out,idx| (idx==input_idx) ? out.to_payload : out.to_null_payload }.join\n          out_size = Protocol.pack_var_int(input_idx+1)\n        end\n\n        if (hash_type & SIGHASH_TYPE[:anyonecanpay]) != 0\n          in_size, pin = Protocol.pack_var_int(1), [ pin[input_idx] ]\n        end\n\n        # \u3053\u3053\u3067\u3001\u30cf\u30c3\u30b7\u30e5\u8a08\u7b97\u6a5f\u306b\u304b\u3051\u308b\u5909\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u308b\u3002@lock_time\u304c\u542b\u307e\u308c\u308b\u3002\n        buf = [ [@ver].pack(\"V\"), in_size, pin, out_size, pout, [@lock_time, hash_type].pack(\"VV\") ].join\n        # \u30cf\u30c3\u30b7\u30e5\u306f\u4e8c\u91cd\u3067\u8a08\u7b97\u3055\u308c\u308b\u3002\uff08\u305d\u3046\u3044\u3046\u6c7a\u307e\u308a\uff09\n        Digest::SHA256.digest( Digest::SHA256.digest( buf ) )\n      end\n```\n\n## Tx.verify_input_signature\n\n\u7f72\u540d\u691c\u8a3c\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u898b\u308b\u3002\u4e00\u90e8\u5272\u611b\u3002\n\n```rb\n      def verify_input_signature(in_idx, outpoint_tx_or_script, block_timestamp=Time.now.to_i, opts={})\n        if @enable_bitcoinconsensus\n          return bitcoinconsensus_verify_script(in_idx, outpoint_tx_or_script, block_timestamp, opts)\n        end\n\n        outpoint_idx  = @in[in_idx].prev_out_index\n        script_sig    = @in[in_idx].script_sig\n\n        # outpoint_tx_or_script\u306f\u3001\u901a\u5e38\u3001UTXO\u3092\u542b\u3080\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n        # script_pubkey\u306f\u3001\u305d\u306eUTXO\u304c\u3082\u3064script_pubkey\u3067\u3042\u308b\u3002         \n        # If given an entire previous transaction, take the script from it\n        script_pubkey = if outpoint_tx_or_script.respond_to?(:out) \n          outpoint_tx_or_script.out[outpoint_idx].pk_script\n        else\n          # Otherwise, it's already a script.\n          outpoint_tx_or_script\n        end\n\n        # \u691c\u8a3c\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308b\u3002\u3053\u3053\u3067\u3044\u3046\u691c\u8a3c\u3068\u306f\u3001\n        # UTXO\u3067\u6307\u5b9a\u3055\u308c\u305fscriptPubKey\u3068\u3001\u81ea\u8eab\u304c\u4f5c\u6210\u3057\u305fvin\u306e\n        # scriptSig\u3092\u5408\u308f\u305b\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u304b\u3092\u307f\u3066\u3044\u308b\u3002\n        # \u5272\u7b26\u691c\u8a3c\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u3057\u3066\u3044\u308b\u3002\n        @scripts[in_idx] = Bitcoin::Script.new(script_sig, script_pubkey)\n        # \u3053\u3053\u304c\u5b9f\u884c\u90e8\u5206\u3002\n        # do~end\u53e5\u306f\u3001OP_CKECKSIG\u304c\u5b9f\u884c\u3055\u308c\u305f\u3068\u304d\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3055\u308c\u308b\u30e1\u30bd\u30c3\u30c9\u3002\n        # OP_CHECKSIG\u5b9f\u884c\u6642\u306b\u3001\u30cf\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u3001\u305d\u308c\u304c\u516c\u958b\u9375\u3067\u5bfe\u5fdc\u958b\u3051\u308b\u304b\u3069\u3046\u304b\u691c\u8a3c\u3057\u3066\u3044\u308b\u3002\n        sig_valid = @scripts[in_idx].run(block_timestamp, opts) do |pubkey,sig,hash_type,subscript|\n          hash = signature_hash_for_input(in_idx, subscript, hash_type)\n          Bitcoin.verify_signature( hash, sig, pubkey.unpack(\"H*\")[0] )\n        end\n\n        return sig_valid\n      end\n```\n\n\u3053\u306e\u8fba\u308a\u306f\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\u306e\u56de\u3067\u8a73\u3057\u304f\u8aac\u660e\u4e88\u5b9a\u3002\n\n# \u3042\u3068\u304c\u304d\n\n\u7f72\u540d\u7cfb\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u5145\u5b9f\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u304c\u3001\u3082\u3046\u5c11\u3057\u30cf\u30a4\u30ec\u30d9\u30eb\u306a\u3068\u3053\u308d\u304b\u3089\u7f72\u540d\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u3044\u3044\u3067\u3059\u306d\u3002\n\n\u7f72\u540d\u306e\u4ed5\u7d44\u307f\u3092\u77e5\u3089\u306a\u3044\u3068\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u4f7f\u3044\u3053\u306a\u305b\u305a\u3001\u7d50\u679c\u3001\u8907\u96d1\u306a\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u308c\u306a\u3044\u73fe\u72b6\u306f\u3001\u521d\u5fc3\u8005\u306b\u306f\u30cf\u30fc\u30c9\u30eb\u304c\u9ad8\u304f\u611f\u3058\u307e\u3059\u3002\n\n# \u53c2\u8003\nBitcoin::Builder\u3092\u4f7f\u3063\u3066\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\nhttp://qiita.com/osada/items/edb1f0681735586ca586\n\nTransaction\u306e\u8aac\u660e\uff08\u516c\u5f0f\u30b5\u30a4\u30c8\uff09\nhttps://en.bitcoin.it/wiki/Transaction#Pay-to-PubkeyHash\n\n\n\n", "tags": ["Bitcoin", "Ruby", "OpenAssets"]}