{"context": " More than 1 year has passed since last update.AWS\u4e0a\u3067Serverspec\u3092\u8a66\u3057\u3066\u307f\u305f\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30922\u53f0\u4f5c\u6210(t2.micro,OS\u306fAmazonLinux)\n\n\n\u3053\u3053\u3067\u306fServerspec\u5b9f\u884c\u5074\u306eEC2\u3092server01,Serverspec\u3067\u30c6\u30b9\u30c8\u3055\u308c\u308b\u5074\u306eEC2\u3092server02\u3068\u3057\u307e\u3059\u3002\n\n\nserver01\u306eEC2\u306eSecuretyGroup\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u611f\u3058\u3067\u8a2d\u5b9a\u3092\u8ffd\u52a0(FTP\u7528),\u5de6\u304b\u3089Type,Protocol,PortRange,Source\n\nCustom TCP Rule TCP 21 0.0.0.0/0\nCustom TCP Rule TCP 60000 - 60010 0.0.0.0/0\n\n\nec2-user\u3067server01\u306bSSH\u30ed\u30b0\u30a4\u30f3\n\u65e2\u306bgem\u3068Ruby\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u4e00\u5fdc\u78ba\u8a8d\n\nruby -v\ngem -v\n\n\n\u8db3\u308a\u306a\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\n\nsudo su -\nyum update\nyum vsftpd\ngem install rake\ngem install serverspec\n\n\nFTP\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u70ba\u306b\u4ee5\u4e0b\u3092\u5b9f\u884c\n\nuseradd ftpuser\n\npasswd ftpuser\nNew UNIX password: *********\nRetype new UNIX password: *********\npasswd: all authentication tokens updated successfully\n\nservice vsftpd start\n\n\nSSH\u9375\u3092\u4ee5\u4e0b\u306e\u30d1\u30b9\u306bFTP\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n/root/.ssh/\nmv {\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fSSHKey\u306e\u30d5\u30a1\u30a4\u30eb\u540d} serverspec\n\n\nSSH\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u8a18\u8f09\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\nvi /root/.ssh/config\n\n\n/root/.ssh/config\nHost server02\n  HostName {server02\u306ePrivateIPs\u3092\u8a18\u8f09}\n  Port 22\n  User ec2-user\n  IdentityFile ~/.ssh/serverspec-key\n\n\n\nServerspec\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u305f\u3044\u30d1\u30b9\u306b\u79fb\u52d5\u5f8c\u3001Serverspec\u30b3\u30fc\u30c9\u751f\u6210\n\nmkdir /etc/severspec\ncd /etc/severspec\nserverspec-init\n\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: n\nInput target host name: server02\n + spec/\n + spec/server02/\n + spec/server02/httpd_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n\n[root@XXX.XX.XX.XX serverspec]# ls -l\ntotal 8\n-rw-r--r-- 1 root root  148 Aug 19 21:24 Rakefile\ndrwxr-xr-x 3 root root 4096 Aug 19 21:24 spec\n\n\n\n\n\u4ee5\u4e0b\u306e\u901a\u308a\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\n/etc/serverspec/spec/spec_helper.rb\n\n\nspec_helper.rb\n\nrequire 'serverspec'\nrequire 'pathname'\nrequire 'net/ssh'\n\ninclude SpecInfra::Helper::Ssh\ninclude SpecInfra::Helper::DetectOS\n\nRSpec.configure do |c|\n  if ENV['ASK_SUDO_PASSWORD']\n    require 'highline/import'\n    c.sudo_password = ask(\"Enter sudo password: \") { |q| q.echo = false }\n  else\n    c.sudo_password = ENV['SUDO_PASSWORD']\n  end\n  c.before :all do\n    block = self.class.metadata[:example_group_block]\n    if RUBY_VERSION.start_with?('1.8')\n      file = block.to_s.match(/.*@(.*):[0-9]+>/)[1]\n    else\n      file = block.source_location.first\n    end\n    host  = File.basename(Pathname.new(file).dirname)\n    if c.host != host\n      c.ssh.close if c.ssh\n      c.host  = host\n      options = Net::SSH::Config.for(c.host)\n      user    = options[:user] || Etc.getlogin\n      c.ssh   = Net::SSH.start(host, user, options)\n\n      c.request_pty = true\u3000\u2605\u2605\u2605 \u3053\u306e\u4e00\u884c\u3092\u8ffd\u8a18\u3059\u308b! \u2605\u2605\u2605\n\n    end\n  end\nend\n\n\n\u203b\u4e0a\u8a18\u8a2d\u5b9a\u3092\u5165\u308c\u306a\u3044\u3068Serverspec\u5b9f\u884c\u6642\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\nPlease set \"SpecInfra.configuration.request_pty = true\" or \"c.request_pty = true\" in your spec_helper.rb or other appropriate file.\n\n\n\u4e00\u5fdc\u4ee5\u4e0b\u306b\u30c6\u30b9\u30c8\u5185\u5bb9\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n/etc/serverspec/spec/server02/httpd_spec.rb\n\n\nhttpd_spec.rb\nrequire 'spec_helper'\n\ndescribe package('httpd') do\n  it { should be_installed }\nend\n\ndescribe service('httpd') do\n  it { should be_enabled   }\n  it { should be_running   }\nend\n\ndescribe port(80) do\n  it { should be_listening }\nend\n\ndescribe file('/etc/httpd/conf/httpd.conf') do\n  it { should be_file }\n  its(:content) { should match /ServerName server02/ }\nend\n\n\n\u3053\u308c\u3067server01\u5074\u306e\u8a2d\u5b9a\u306fOK\u3002\n\n\u7d9a\u3044\u3066\u3001server02\u306bSSH\u30ed\u30b0\u30a4\u30f3(ec2-user)\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\nsudo yum install httpd\nsudo service httpd start\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u6e96\u5099OK\u3001\u3042\u3068\u306f\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\n\nserver01\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n\nrake spec\n\n\n\nAWS\u4e0a\u3067Serverspec\u3092\u8a66\u3057\u3066\u307f\u305f\u3002\n\n* EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30922\u53f0\u4f5c\u6210(t2.micro,OS\u306fAmazonLinux)\n * \u3053\u3053\u3067\u306fServerspec\u5b9f\u884c\u5074\u306eEC2\u3092server01,Serverspec\u3067\u30c6\u30b9\u30c8\u3055\u308c\u308b\u5074\u306eEC2\u3092server02\u3068\u3057\u307e\u3059\u3002\n* server01\u306eEC2\u306eSecuretyGroup\u306f\u4ee5\u4e0b\u306e\u69d8\u306a\u611f\u3058\u3067\u8a2d\u5b9a\u3092\u8ffd\u52a0(FTP\u7528),\u5de6\u304b\u3089Type,Protocol,PortRange,Source\n\n```\nCustom TCP Rule TCP 21 0.0.0.0/0\nCustom TCP Rule TCP 60000 - 60010 0.0.0.0/0\n```\n\n* ec2-user\u3067server01\u306bSSH\u30ed\u30b0\u30a4\u30f3\n* \u65e2\u306bgem\u3068Ruby\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u4e00\u5fdc\u78ba\u8a8d\n\n```\nruby -v\ngem -v\n```\n\n* \u8db3\u308a\u306a\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8ffd\u52a0\n\n```\nsudo su -\nyum update\nyum vsftpd\ngem install rake\ngem install serverspec\n```\n\n\n* FTP\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u70ba\u306b\u4ee5\u4e0b\u3092\u5b9f\u884c\n\n```\nuseradd ftpuser\n\npasswd ftpuser\nNew UNIX password: *********\nRetype new UNIX password: *********\npasswd: all authentication tokens updated successfully\n\nservice vsftpd start\n```\n\n* SSH\u9375\u3092\u4ee5\u4e0b\u306e\u30d1\u30b9\u306bFTP\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n```\n/root/.ssh/\nmv {\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305fSSHKey\u306e\u30d5\u30a1\u30a4\u30eb\u540d} serverspec\n```\n\n* SSH\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u8a18\u8f09\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n```\nvi /root/.ssh/config\n```\n\n```/root/.ssh/config\nHost server02\n  HostName {server02\u306ePrivateIPs\u3092\u8a18\u8f09}\n  Port 22\n  User ec2-user\n  IdentityFile ~/.ssh/serverspec-key\n```\n\n* Serverspec\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u305f\u3044\u30d1\u30b9\u306b\u79fb\u52d5\u5f8c\u3001Serverspec\u30b3\u30fc\u30c9\u751f\u6210\n\n```\nmkdir /etc/severspec\ncd /etc/severspec\nserverspec-init\n\nSelect OS type:\n\n  1) UN*X\n  2) Windows\n\nSelect number: 1\n\nSelect a backend type:\n\n  1) SSH\n  2) Exec (local)\n\nSelect number: 1\n\nVagrant instance y/n: n\nInput target host name: server02\n + spec/\n + spec/server02/\n + spec/server02/httpd_spec.rb\n + spec/spec_helper.rb\n + Rakefile\n\n[root@XXX.XX.XX.XX serverspec]# ls -l\ntotal 8\n-rw-r--r-- 1 root root  148 Aug 19 21:24 Rakefile\ndrwxr-xr-x 3 root root 4096 Aug 19 21:24 spec\n\n\n```\n\n* \u4ee5\u4e0b\u306e\u901a\u308a\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\n/etc/serverspec/spec/spec_helper.rb\n\n```ruby:spec_helper.rb\n\nrequire 'serverspec'\nrequire 'pathname'\nrequire 'net/ssh'\n\ninclude SpecInfra::Helper::Ssh\ninclude SpecInfra::Helper::DetectOS\n\nRSpec.configure do |c|\n  if ENV['ASK_SUDO_PASSWORD']\n    require 'highline/import'\n    c.sudo_password = ask(\"Enter sudo password: \") { |q| q.echo = false }\n  else\n    c.sudo_password = ENV['SUDO_PASSWORD']\n  end\n  c.before :all do\n    block = self.class.metadata[:example_group_block]\n    if RUBY_VERSION.start_with?('1.8')\n      file = block.to_s.match(/.*@(.*):[0-9]+>/)[1]\n    else\n      file = block.source_location.first\n    end\n    host  = File.basename(Pathname.new(file).dirname)\n    if c.host != host\n      c.ssh.close if c.ssh\n      c.host  = host\n      options = Net::SSH::Config.for(c.host)\n      user    = options[:user] || Etc.getlogin\n      c.ssh   = Net::SSH.start(host, user, options)\n\n      c.request_pty = true\u3000\u2605\u2605\u2605 \u3053\u306e\u4e00\u884c\u3092\u8ffd\u8a18\u3059\u308b! \u2605\u2605\u2605\n\n    end\n  end\nend\n```\n\n\u203b\u4e0a\u8a18\u8a2d\u5b9a\u3092\u5165\u308c\u306a\u3044\u3068Serverspec\u5b9f\u884c\u6642\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```\nPlease set \"SpecInfra.configuration.request_pty = true\" or \"c.request_pty = true\" in your spec_helper.rb or other appropriate file.\n```\n\n\n* \u4e00\u5fdc\u4ee5\u4e0b\u306b\u30c6\u30b9\u30c8\u5185\u5bb9\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n/etc/serverspec/spec/server02/httpd_spec.rb\n\n```ruby:httpd_spec.rb\nrequire 'spec_helper'\n\ndescribe package('httpd') do\n  it { should be_installed }\nend\n\ndescribe service('httpd') do\n  it { should be_enabled   }\n  it { should be_running   }\nend\n\ndescribe port(80) do\n  it { should be_listening }\nend\n\ndescribe file('/etc/httpd/conf/httpd.conf') do\n  it { should be_file }\n  its(:content) { should match /ServerName server02/ }\nend\n```\n\n\n\u3053\u308c\u3067server01\u5074\u306e\u8a2d\u5b9a\u306fOK\u3002\n\n\n* \u7d9a\u3044\u3066\u3001server02\u306bSSH\u30ed\u30b0\u30a4\u30f3(ec2-user)\n* \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n```\nsudo yum install httpd\nsudo service httpd start\n```\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u6e96\u5099OK\u3001\u3042\u3068\u306f\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\n\n* server01\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n```\nrake spec\n```\n", "tags": ["serverspec", "AWS"]}