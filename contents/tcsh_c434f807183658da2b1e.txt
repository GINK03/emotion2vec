{"context": " More than 1 year has passed since last update.https://jawsug-cli.doorkeeper.jp/events/20523 \u3067\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\u3067\u3059\u3002\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001DynamoDB\u30c6\u30fc\u30d6\u30eb\u306e\u300c\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u300d\u306e\u4f7f\u7528\u91cf\u304c\u95be\u5024\u306b\u9054\u3057\u305f\u3068\u304d\u306b\u901a\u77e5\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u307f\u307e\u3059\u3002\n\u53c2\u8003: http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/DeveloperGuide/dynamo-metricscollected.html\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u6642\u3001Thrughput Alarms\u306e\u8a2d\u5b9a\u306780%\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4e00\u5b9a\u671f\u9593\u306e\u671f\u9593\u5185(period * evaluation-periods = \u3053\u306e\u8a2d\u5b9a\u3067\u306f60\u5206\u5f8c)\u306b\n\u30c7\u30fc\u30bf\u306eput\u3084get\u304c\u7121\u3044\u3068\u3001INSUFFICIENT_DATA\u306b\u306a\u308b(OK\u306b\u306a\u3089\u306a\u304f\u306a\u308b)\u3088\u3046\u3067\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n\nCloudWatch\u3078\u306e\u6a29\u9650\nCloudWatch\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u306e\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n(\u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u4f7f\u308f\u306a\u3044\u6a29\u9650\u3082\u3042\u308a\u307e\u3059\u3002)\n      {\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"cloudwatch:DescribeAlarmHistory\",\n              \"cloudwatch:DescribeAlarms\",\n              \"cloudwatch:DescribeAlarmsForMetric\",\n              \"cloudwatch:GetMetricStatistics\",\n              \"cloudwatch:ListMetrics\",\n              \"cloudwatch:PutMetricAlarm\",\n              \"cloudwatch:SetAlarmState\",\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          }\n        ]\n      }\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.7.18\nAWS CLI 1.7.8\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\naws-cli/1.7.18 Python/2.7.5 Darwin/13.4.0\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\u4f5c\u6210\u3059\u308b\u30e6\u30fc\u30b6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n\u30b3\u30de\u30f3\u30c9(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408)\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile      iam_full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\nDYNAMO_TABLE_NAME:  ${DYNAMO_TABLE_NAME}\nSNS_TOPIC_ARN:      ${SNS_TOPIC_ARN}\n\nETX\n\n\n\n1.2. DynamoDB\u30c6\u30fc\u30d6\u30eb\u540d\u306e\u6307\u5b9a\nDYNAMO_TABLE_NAME\u304c\u7a7a\u304b\u3001\u60f3\u5b9a\u3068\u7570\u306a\u308b\u5834\u5408\u306f\u6307\u5b9a\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9(\u4f8b)\nDYNAMO_TABLE_NAME='Thread'\n\n\n\n1.3. \u901a\u77e5\u5148SNS\u306e\u6c7a\u5b9a\nSNS_TOPIC_NAME\u304c\u7a7a\u304b\u3001\u60f3\u5b9a\u3068\u7570\u306a\u308b\u5834\u5408\u306f\u6307\u5b9a\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\n\u65b0\u898f\u306bSNS\u30c8\u30d4\u30c3\u30af\u3092\u4f5c\u6210\u3001\u8cfc\u8aad\u3059\u308b\u5834\u5408\u306f\u3001\u5225\u9014\u4f5c\u6210\u4f5c\u696d\u3092\u3057\u3066\u304a\u304f\u3053\u3068 \u3002\n\n\nhttp://qiita.com/tcsh/items/e05e21e7338668cbf3b8\nhttp://qiita.com/tcsh/items/ca81576b0018bfa32cbe\n\n\n\n\n\u30b3\u30de\u30f3\u30c9\nSNS_TOPIC_NAME='dynamodb'\n\n\n\nSNS\u30c8\u30d4\u30c3\u30af\u306eARN\u53d6\u5f97\n\n\n\u30b3\u30de\u30f3\u30c9\nSNS_TOPIC_ARN=`aws sns list-topics | jq -r .Topics[].TopicArn | grep ${SNS_TOPIC_NAME}` \\\n  && echo ${SNS_TOPIC_ARN}\n\n\n\n1.4. \u5909\u6570\u306e\u78ba\u8a8d (\u518d)\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\nDYNAMO_TABLE_NAME:  ${DYNAMO_TABLE_NAME}\nSNS_TOPIC_ARN:      ${SNS_TOPIC_ARN}\n\nETX\n\n\n\n2. \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u78ba\u8a8d (\u30c6\u30fc\u30d6\u30eb\u306b\u5165\u51fa\u529b\u304c\u3042\u3063\u305f\u5834\u5408)\n\nNote: \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u5f8c\u3001\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u307e\u306715\u5206\u307b\u3069\u5fc5\u8981\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n\n2.1. \u540d\u524d\u7a7a\u9593\u3001\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_NAMESPACE='AWS/DynamoDB'\nCWATCH_DIMENSIONS=\"Name=TableName,Value=${DYNAMO_TABLE_NAME}\"\n\n\n\n2.2. \u4e00\u89a7\u306e\u53d6\u5f97\n\u5165\u529b\u5024\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u78ba\u8a8d\ncat << ETX\n\n      CWATCH_NAMESPACE:  ${CWATCH_NAMESPACE}\n      CWATCH_DIMENSIONS: ${CWATCH_DIMENSIONS}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudwatch list-metrics \\\n        --namespace ${CWATCH_NAMESPACE} \\\n        --dimensions ${CWATCH_DIMENSIONS}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"Metrics\": [\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ProvisionedReadCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ProvisionedWriteCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ConsumedReadCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ConsumedWriteCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"PutItem\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"SuccessfulRequestLatency\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"Scan\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"SuccessfulRequestLatency\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"Scan\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ReturnedItemCount\"\n          }\n        ]\n      }\n\n\n\n3. CloudWatch\u30a2\u30e9\u30fc\u30e0\u306e\u8a2d\u5b9a (ReadCapacity)\n\n3.1. \u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9(\u4f8b)\nDYNAMO_READ_UNIT='10'\n\n\n\n3.2. \u30a2\u30e9\u30fc\u30e0\u540d(\u305d\u306e\u6982\u8981)\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_ALARM_NAME=\"${DYNAMO_TABLE_NAME}-ReadCapacityUnitsLimit-BasicAlarm\"\nCWATCH_ALARM_DESC=\"Read Capacity Units Limit Basic Alarm for ${DYNAMO_TABLE_NAME}\"\n\n\n\n3.3. \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6307\u5b9a\n\u540d\u524d\u7a7a\u9593:\n   AWS/DynamoDB\n\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3:\n   \u30c6\u30fc\u30d6\u30eb\u540d\n\u30e1\u30c8\u30ea\u30c3\u30af\u540d:\n   ConsumedWriteCapacityUnits\n\u30e1\u30c8\u30ea\u30c3\u30af\u5358\u4f4d:\n   Count\n\u7d71\u8a08\u65b9\u6cd5:\n   Sum\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_NAMESPACE='AWS/DynamoDB'\nCWATCH_DIMENSIONS=\"Name=TableName,Value=${DYNAMO_TABLE_NAME}\"\nCWATCH_METRIC_NAME='ConsumedReadCapacityUnits'\nCWATCH_METRIC_UNIT='Count'\nCWATCH_STATISTICS='Sum'\n\n\n\n3.4. \u30a2\u30e9\u30fc\u30e0\u8a2d\u5b9a\u5024\u306e\u6307\u5b9a\n\u95be\u5024:\n   80%\n\u76e3\u8996\u5468\u671f:\n   300\u79d2\n\u8a55\u4fa1\u671f\u9593:\n   12\u5468\u671f (300\u79d2x12\u56de=1\u6642\u9593)\n\u6bd4\u8f03\u65b9\u6cd5:\n   \u95be\u5024\u4ee5\u4e0a\n\n\u30b3\u30de\u30f3\u30c9\nDYNAMO_READ_RATE='80'\nCWATCH_ALARM_PERIOD='300'\nCWATCH_EVALUATION_PERIOD='12'\nCWATCH_COMPARISON='GreaterThanOrEqualToThreshold'\n\n\n\n3.5. \u30a2\u30e9\u30fc\u30e0\u95be\u5024\u306e\u7b97\u51fa\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_THRESHOLD=`echo \"scale=1; ${CWATCH_ALARM_PERIOD} * ${DYNAMO_READ_UNIT} * ${DYNAMO_READ_RATE}/100;\" | bc`;\n      echo ${CWATCH_THRESHOLD}\n\n\n\n3.6. \u30a2\u30e9\u30fc\u30e0\u901a\u77e5\u5148\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_ALARM_TOPIC=${SNS_TOPIC_ARN}\n\n\n\n3.7. \u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\ncat << ETX\n\n        CWATCH_NAMESPACE:         ${CWATCH_NAMESPACE}\n        CWATCH_METRIC_NAME:       ${CWATCH_METRIC_NAME}\n        CWATCH_METRIC_UNIT:       ${CWATCH_METRIC_UNIT}\n        CWATCH_STATISTICS:        ${CWATCH_STATISTICS}\n        CWATCH_DIMENSIONS:        ${CWATCH_DIMENSIONS}\n        CWATCH_ALARM_PERIOD:      ${CWATCH_ALARM_PERIOD}\n        CWATCH_EVALUATION_PERIOD: ${CWATCH_EVALUATION_PERIOD}\n        CWATCH_THRESHOLD:         ${CWATCH_THRESHOLD}\n        CWATCH_COMPARISON:        ${CWATCH_COMPARISON}\n        CWATCH_ALARM_NAME:        ${CWATCH_ALARM_NAME}\n        CWATCH_ALARM_DESC:       \"${CWATCH_ALARM_DESC}\"\n        CWATCH_ALARM_TOPIC:       ${CWATCH_ALARM_TOPIC}\n\nETX\n\n\n\ncommand\naws cloudwatch put-metric-alarm \\\n        --namespace           ${CWATCH_NAMESPACE} \\\n        --metric-name         ${CWATCH_METRIC_NAME} \\\n        --unit                ${CWATCH_METRIC_UNIT} \\\n        --statistic           ${CWATCH_STATISTICS} \\\n        --dimensions          ${CWATCH_DIMENSIONS} \\\n        --period              ${CWATCH_ALARM_PERIOD} \\\n        --evaluation-periods  ${CWATCH_EVALUATION_PERIOD} \\\n        --threshold           ${CWATCH_THRESHOLD} \\\n        --comparison-operator ${CWATCH_COMPARISON} \\\n        --alarm-name          ${CWATCH_ALARM_NAME} \\\n        --alarm-description  \"${CWATCH_ALARM_DESC}\" \\\n        --alarm-actions       ${CWATCH_ALARM_TOPIC}\n\n\n\nresult\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n3.8. \u30a2\u30e9\u30fc\u30e0\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws cloudwatch describe-alarms --alarm-names ${CWATCH_ALARM_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"MetricAlarms\": [\n          {\n              \"EvaluationPeriods\": 12,\n              \"AlarmArn\": \"arn:aws:cloudwatch:us-west-2:XXXXXXXXXXXX:alarm:ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"StateUpdatedTimestamp\": \"2015-02-15T07:24:06.461Z\",\n              \"AlarmConfigurationUpdatedTimestamp\": \"2015-02-15T07:23:28.223Z\",\n              \"ComparisonOperator\": \"GreaterThanOrEqualToThreshold\",\n              \"AlarmActions\": [\n                  \"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\"\n              ],\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"AlarmDescription\": \"Read Capacity Units Limit Basic Alarm for ProductCatalog\",\n              \"StateReasonData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-15T07:24:06.455+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[],\\\"threshold\\\":2400.0}\",\n              \"Period\": 300,\n              \"StateValue\": \"INSUFFICIENT_DATA\",\n              \"Threshold\": 2400.0,\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"Unit\": \"Count\",\n              \"Statistic\": \"Sum\",\n              \"StateReason\": \"Unchecked: Initial alarm creation\",\n              \"InsufficientDataActions\": [],\n              \"OKActions\": [],\n              \"ActionsEnabled\": true,\n              \"MetricName\": \"ConsumedReadCapacityUnits\"\n          }\n        ]\n      }\n\n\n\n3.9. history\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_MAX_ITEMS='2'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudwatch describe-alarm-history \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --max-items ${CWATCH_MAX_ITEMS}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"AlarmHistoryItems\": [\n          {\n              \"Timestamp\": \"2015-02-14T06:37:59.453Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"INSUFFICIENT_DATA\\\",\\\"stateReason\\\":\\\"Unchecked: Initial alarm creation\\\"},\\\"newState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:37:59.447+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:22:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}}}\",\n              \"HistorySummary\": \"Alarm updated from INSUFFICIENT_DATA to OK\"\n\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:37:58.808Z\",\n              \"HistoryItemType\": \"ConfigurationUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"type\\\":\\\"Create\\\",\\\"createdAlarm\\\":{\\\"threshold\\\":240.0,\\\"stateValue\\\":\\\"INSUFFICIENT_DATA\\\",\\\"metricName\\\":\\\"ConsumedReadCapacityUnits\\\",\\\"period\\\":300,\\\"dimensions\\\":[{\\\"name\\\":\\\"TableName\\\",\\\"value\\\":\\\"ProductCatalog\\\"}],\\\"alarmName\\\":\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\",\\\"unit\\\":\\\"Count\\\",\\\"actionsEnabled\\\":true,\\\"okactions\\\":[],\\\"alarmActions\\\":[\\\"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\\\"],\\\"namespace\\\":\\\"AWS/DynamoDB\\\",\\\"evaluationPeriods\\\":12,\\\"comparisonOperator\\\":\\\"GreaterThanOrEqualToThreshold\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"alarmArn\\\":\\\"arn:aws:cloudwatch:us-west-2:XXXXXXXXXXXX:alarm:ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\",\\\"insufficientDataActions\\\":[],\\\"alarmDescription\\\":\\\"Read Capacity Units Limit Basic Alarm for ProductCatalog\",\\\"alarmConfigurationUpdatedTimestamp\\\":\\\"2015-02-14T06:37:58.808+0000\\\",\\\"stateUpdatedTimestamp\\\":\\\"2015-02-14T06:37:58.808+0000\\\"}}\",\n              \"HistorySummary\": \"Alarm \\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\" created\"\n          }\n        ]\n      }\n\n\n\n3.10. \u30a2\u30e9\u30fc\u30e0\u306e\u9001\u4fe1\u30c6\u30b9\u30c8\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_STATE_VALUE='ALARM'\nCWATCH_STATE_REASON='test alarm.'\n\n\n\ncommand\naws cloudwatch set-alarm-state \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --state-value ${CWATCH_STATE_VALUE} \\\n        --state-reason \"${CWATCH_STATE_REASON}\"\n\n\n\nresult\n      (\u623b\u308a\u5024\u306a\u3057)\n\n\n\n3.11. history\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nCWATCH_MAX_ITEMS='3'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws cloudwatch describe-alarm-history \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --max-items ${CWATCH_MAX_ITEMS}\n\n\n\n\u7d50\u679c(\u4f8b)\n      {\n        \"AlarmHistoryItems\": [\n          {\n              \"Timestamp\": \"2015-02-14T06:45:27.209Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"ALARM\\\",\\\"stateReason\\\":\\\"test alarm.\\\"},\\\"newState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:45:27.200+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:25:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}}}\",\n              \"HistorySummary\": \"Alarm updated from ALARM to OK\"\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:45:26.465Z\",\n              \"HistoryItemType\": \"Action\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"actionState\\\":\\\"Succeeded\\\",\\\"notificationResource\\\":\\\"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\\\",\\\"stateUpdateTimestamp\\\":\\\"2015-02-14T06:45:26.450+0000\\\",\\\"publishedMessage\\\":\\\"{\\\\\\\"default\\\\\\\":\\\\\\\"{\\\\\\\\\\\\\\\"AlarmName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AlarmDescription\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Read Capacity Units Limit Basic Alarm for ProductCatalog\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AWSAccountId\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"XXXXXXXXXXXX\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ALARM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateReason\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"test alarm.\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"StateChangeTime\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"2015-02-14T06:45:26.450+0000\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Region\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"US-West-2\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"OldStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"OK\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Trigger\\\\\\\\\\\\\\\":{\\\\\\\\\\\\\\\"MetricName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ConsumedReadCapacityUnits\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Namespace\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"AWS/DynamoDB\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Statistic\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"SUM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Unit\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Count\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Dimensions\\\\\\\\\\\\\\\":[{\\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"TableName\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"value\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ProductCatalog\\\\\\\\\\\\\\\"}],\\\\\\\\\\\\\\\"Period\\\\\\\\\\\\\\\":300,\\\\\\\\\\\\\\\"EvaluationPeriods\\\\\\\\\\\\\\\":12,\\\\\\\\\\\\\\\"ComparisonOperator\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"GreaterThanOrEqualToThreshold\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Threshold\\\\\\\\\\\\\\\":240.0}}\\\\\\\",\\\\\\\"sms\\\\\\\":\\\\\\\"ALARM: \\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\" in US-West-2\\\\\\\",\\\\\\\"email\\\\\\\":\\\\\\\"You are receiving this email because your Amazon CloudWatch Alarm \\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\" in the US-West-2 region has entered the ALARM state, because \\\\\\\\\\\\\\\"test alarm.\\\\\\\\\\\\\\\" at \\\\\\\\\\\\\\\"Saturday 14 February, 2015 06:45:26 UTC\\\\\\\\\\\\\\\".\\\\\\\\n\\\\\\\\nView this alarm in the AWS Management Console:\\\\\\\\nhttps://console.aws.amazon.com/cloudwatch/home?region=us-west-2#s=Alarms&alarm=ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\n\\\\\\\\nAlarm Details:\\\\\\\\n- Name:                       ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\n- Description:                Read Capacity Units Limit Basic Alarm for ProductCatalog\\\\\\\\n- State Change:               OK -> ALARM\\\\\\\\n- Reason for State Change:    test alarm.\\\\\\\\n- Timestamp:                  Saturday 14 February, 2015 06:45:26 UTC\\\\\\\\n- AWS Account:                XXXXXXXXXXXX\\\\\\\\n\\\\\\\\nThreshold:\\\\\\\\n- The alarm is in the ALARM state when the metric is GreaterThanOrEqualToThreshold 240.0 for 300 seconds. \\\\\\\\n\\\\\\\\nMonitored Metric:\\\\\\\\n- MetricNamespace:            AWS/DynamoDB\\\\\\\\n- MetricName:                 ConsumedReadCapacityUnits\\\\\\\\n- Dimensions:                 [TableName = ProductCatalog]\\\\\\\\n- Period:                     300 seconds\\\\\\\\n- Statistic:                  Sum\\\\\\\\n- Unit:                       Count\\\\\\\\n\\\\\\\\nState Change Actions:\\\\\\\\n- OK: \\\\\\\\n- ALARM: [arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb]\\\\\\\\n- INSUFFICIENT_DATA: \\\\\\\\n\\\\\\\"}\\\"}\",\n              \"HistorySummary\": \"Successfully executed action arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\"\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:45:26.450Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:37:59.447+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:22:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}},\\\"newState\\\":{\\\"stateValue\\\":\\\"ALARM\\\",\\\"stateReason\\\":\\\"test alarm.\\\"}}\",\n              \"HistorySummary\": \"Alarm updated from OK to ALARM\"\n          }\n        ],\n        \"NextToken\": \"None___3\"\n      }\n\n\n\n\u5b8c\u4e86\nhttps://jawsug-cli.doorkeeper.jp/events/20523 \u3067\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u8cc7\u6599\u3067\u3059\u3002\n\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001DynamoDB\u30c6\u30fc\u30d6\u30eb\u306e\u300c\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u300d\u306e\u4f7f\u7528\u91cf\u304c\u95be\u5024\u306b\u9054\u3057\u305f\u3068\u304d\u306b\u901a\u77e5\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u53c2\u8003: http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/DeveloperGuide/dynamo-metricscollected.html\n\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u6642\u3001Thrughput Alarms\u306e\u8a2d\u5b9a\u306780%\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\n>  \u4e00\u5b9a\u671f\u9593\u306e\u671f\u9593\u5185(period * evaluation-periods = \u3053\u306e\u8a2d\u5b9a\u3067\u306f60\u5206\u5f8c)\u306b\n> \u30c7\u30fc\u30bf\u306eput\u3084get\u304c\u7121\u3044\u3068\u3001INSUFFICIENT_DATA\u306b\u306a\u308b(OK\u306b\u306a\u3089\u306a\u304f\u306a\u308b)\u3088\u3046\u3067\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n## CloudWatch\u3078\u306e\u6a29\u9650\n\nCloudWatch\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u306e\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n(\u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u4f7f\u308f\u306a\u3044\u6a29\u9650\u3082\u3042\u308a\u307e\u3059\u3002)\n\n```json:\n      {\n        \"Version\": \"2012-10-17\",\n        \"Statement\": [\n          {\n            \"Action\": [\n              \"cloudwatch:DescribeAlarmHistory\",\n              \"cloudwatch:DescribeAlarms\",\n              \"cloudwatch:DescribeAlarmsForMetric\",\n              \"cloudwatch:GetMetricStatistics\",\n              \"cloudwatch:ListMetrics\",\n              \"cloudwatch:PutMetricAlarm\",\n              \"cloudwatch:SetAlarmState\",\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n          }\n        ]\n      }\n```\n\n## AWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.7.18\n* AWS CLI 1.7.8\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\naws-cli/1.7.18 Python/2.7.5 Darwin/13.4.0\n```\n0. \u6e96\u5099\n=======\n\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n---------------------\n\n\u4f5c\u6210\u3059\u308b\u30e6\u30fc\u30b6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6c7a\u3081\u307e\u3059\u3002\n(\u30ab\u30ec\u30f3\u30c8\u30e6\u30fc\u30b6\u304c\u5229\u7528\u3059\u308b\u30ab\u30ec\u30f3\u30c8\u30ea\u30fc\u30b8\u30e7\u30f3\u3082\u5207\u308a\u5909\u308f\u308a\u307e\u3059\u3002)\n\n```bash:\u30b3\u30de\u30f3\u30c9(\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u5834\u5408):\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n---------------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b):\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile      iam_full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n1.1. \u5909\u6570\u306e\u78ba\u8a8d\n------------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\nDYNAMO_TABLE_NAME:  ${DYNAMO_TABLE_NAME}\nSNS_TOPIC_ARN:      ${SNS_TOPIC_ARN}\n\nETX\n```\n\n1.2. DynamoDB\u30c6\u30fc\u30d6\u30eb\u540d\u306e\u6307\u5b9a\n------------------------\n\nDYNAMO_TABLE_NAME\u304c\u7a7a\u304b\u3001\u60f3\u5b9a\u3068\u7570\u306a\u308b\u5834\u5408\u306f\u6307\u5b9a\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9(\u4f8b):\nDYNAMO_TABLE_NAME='Thread'\n```\n\n\n\n1.3. \u901a\u77e5\u5148SNS\u306e\u6c7a\u5b9a\n--------------------\n\nSNS_TOPIC_NAME\u304c\u7a7a\u304b\u3001\u60f3\u5b9a\u3068\u7570\u306a\u308b\u5834\u5408\u306f\u6307\u5b9a\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\n* \u65b0\u898f\u306bSNS\u30c8\u30d4\u30c3\u30af\u3092\u4f5c\u6210\u3001\u8cfc\u8aad\u3059\u308b\u5834\u5408\u306f\u3001\u5225\u9014\u4f5c\u6210\u4f5c\u696d\u3092\u3057\u3066\u304a\u304f\u3053\u3068 \u3002\n  * http://qiita.com/tcsh/items/e05e21e7338668cbf3b8\n  * http://qiita.com/tcsh/items/ca81576b0018bfa32cbe\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nSNS_TOPIC_NAME='dynamodb'\n```\n\n* SNS\u30c8\u30d4\u30c3\u30af\u306eARN\u53d6\u5f97\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nSNS_TOPIC_ARN=`aws sns list-topics | jq -r .Topics[].TopicArn | grep ${SNS_TOPIC_NAME}` \\\n  && echo ${SNS_TOPIC_ARN}\n```\n\n1.4. \u5909\u6570\u306e\u78ba\u8a8d (\u518d)\n------------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\nDYNAMO_TABLE_NAME:  ${DYNAMO_TABLE_NAME}\nSNS_TOPIC_ARN:      ${SNS_TOPIC_ARN}\n\nETX\n```\n\n\n2. \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u78ba\u8a8d (\u30c6\u30fc\u30d6\u30eb\u306b\u5165\u51fa\u529b\u304c\u3042\u3063\u305f\u5834\u5408)\n===================\n\n> Note: \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u5f8c\u3001\u4e00\u89a7\u8868\u793a\u3055\u308c\u308b\u307e\u306715\u5206\u307b\u3069\u5fc5\u8981\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n\n2.1. \u540d\u524d\u7a7a\u9593\u3001\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\n-----------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_NAMESPACE='AWS/DynamoDB'\nCWATCH_DIMENSIONS=\"Name=TableName,Value=${DYNAMO_TABLE_NAME}\"\n```\n\n2.2. \u4e00\u89a7\u306e\u53d6\u5f97\n---------------\n\n\u5165\u529b\u5024\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u78ba\u8a8d:\ncat << ETX\n\n      CWATCH_NAMESPACE:  ${CWATCH_NAMESPACE}\n      CWATCH_DIMENSIONS: ${CWATCH_DIMENSIONS}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudwatch list-metrics \\\n        --namespace ${CWATCH_NAMESPACE} \\\n        --dimensions ${CWATCH_DIMENSIONS}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"Metrics\": [\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ProvisionedReadCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ProvisionedWriteCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ConsumedReadCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ConsumedWriteCapacityUnits\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"PutItem\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"SuccessfulRequestLatency\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"Scan\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"SuccessfulRequestLatency\"\n          },\n          {\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"Operation\",\n                      \"Value\": \"Scan\"\n                  },\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"MetricName\": \"ReturnedItemCount\"\n          }\n        ]\n      }\n```\n\n\n\n3. CloudWatch\u30a2\u30e9\u30fc\u30e0\u306e\u8a2d\u5b9a (ReadCapacity)\n===========\n\n\n3.1. \u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u6307\u5b9a\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9(\u4f8b):\nDYNAMO_READ_UNIT='10'\n```\n\n\n\n3.2. \u30a2\u30e9\u30fc\u30e0\u540d(\u305d\u306e\u6982\u8981)\u306e\u6307\u5b9a\n-------------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_ALARM_NAME=\"${DYNAMO_TABLE_NAME}-ReadCapacityUnitsLimit-BasicAlarm\"\nCWATCH_ALARM_DESC=\"Read Capacity Units Limit Basic Alarm for ${DYNAMO_TABLE_NAME}\"\n```\n\n\n3.3. \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u6307\u5b9a\n---------------------\n\n\u540d\u524d\u7a7a\u9593:\n   AWS/DynamoDB\n\n\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3:\n   \u30c6\u30fc\u30d6\u30eb\u540d\n\n\u30e1\u30c8\u30ea\u30c3\u30af\u540d:\n   ConsumedWriteCapacityUnits\n\n\u30e1\u30c8\u30ea\u30c3\u30af\u5358\u4f4d:\n   Count\n\n\u7d71\u8a08\u65b9\u6cd5:\n   Sum\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_NAMESPACE='AWS/DynamoDB'\nCWATCH_DIMENSIONS=\"Name=TableName,Value=${DYNAMO_TABLE_NAME}\"\nCWATCH_METRIC_NAME='ConsumedReadCapacityUnits'\nCWATCH_METRIC_UNIT='Count'\nCWATCH_STATISTICS='Sum'\n```\n\n\n3.4. \u30a2\u30e9\u30fc\u30e0\u8a2d\u5b9a\u5024\u306e\u6307\u5b9a\n-------------------------\n\n\u95be\u5024:\n   80%\n\n\u76e3\u8996\u5468\u671f:\n   300\u79d2\n\n\u8a55\u4fa1\u671f\u9593:\n   12\u5468\u671f (300\u79d2x12\u56de=1\u6642\u9593)\n\n\u6bd4\u8f03\u65b9\u6cd5:\n   \u95be\u5024\u4ee5\u4e0a\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nDYNAMO_READ_RATE='80'\nCWATCH_ALARM_PERIOD='300'\nCWATCH_EVALUATION_PERIOD='12'\nCWATCH_COMPARISON='GreaterThanOrEqualToThreshold'\n```\n\n\n3.5. \u30a2\u30e9\u30fc\u30e0\u95be\u5024\u306e\u7b97\u51fa\n-----------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_THRESHOLD=`echo \"scale=1; ${CWATCH_ALARM_PERIOD} * ${DYNAMO_READ_UNIT} * ${DYNAMO_READ_RATE}/100;\" | bc`;\n      echo ${CWATCH_THRESHOLD}\n```\n\n3.6. \u30a2\u30e9\u30fc\u30e0\u901a\u77e5\u5148\n-------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_ALARM_TOPIC=${SNS_TOPIC_ARN}\n```\n\n\n3.7. \u30a2\u30e9\u30fc\u30e0\u306e\u4f5c\u6210\n-------------------\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\n\ncat << ETX\n\n        CWATCH_NAMESPACE:         ${CWATCH_NAMESPACE}\n        CWATCH_METRIC_NAME:       ${CWATCH_METRIC_NAME}\n        CWATCH_METRIC_UNIT:       ${CWATCH_METRIC_UNIT}\n        CWATCH_STATISTICS:        ${CWATCH_STATISTICS}\n        CWATCH_DIMENSIONS:        ${CWATCH_DIMENSIONS}\n        CWATCH_ALARM_PERIOD:      ${CWATCH_ALARM_PERIOD}\n        CWATCH_EVALUATION_PERIOD: ${CWATCH_EVALUATION_PERIOD}\n        CWATCH_THRESHOLD:         ${CWATCH_THRESHOLD}\n        CWATCH_COMPARISON:        ${CWATCH_COMPARISON}\n        CWATCH_ALARM_NAME:        ${CWATCH_ALARM_NAME}\n        CWATCH_ALARM_DESC:       \"${CWATCH_ALARM_DESC}\"\n        CWATCH_ALARM_TOPIC:       ${CWATCH_ALARM_TOPIC}\n\nETX\n```\n\n```bash:command:\naws cloudwatch put-metric-alarm \\\n        --namespace           ${CWATCH_NAMESPACE} \\\n        --metric-name         ${CWATCH_METRIC_NAME} \\\n        --unit                ${CWATCH_METRIC_UNIT} \\\n        --statistic           ${CWATCH_STATISTICS} \\\n        --dimensions          ${CWATCH_DIMENSIONS} \\\n        --period              ${CWATCH_ALARM_PERIOD} \\\n        --evaluation-periods  ${CWATCH_EVALUATION_PERIOD} \\\n        --threshold           ${CWATCH_THRESHOLD} \\\n        --comparison-operator ${CWATCH_COMPARISON} \\\n        --alarm-name          ${CWATCH_ALARM_NAME} \\\n        --alarm-description  \"${CWATCH_ALARM_DESC}\" \\\n        --alarm-actions       ${CWATCH_ALARM_TOPIC}\n```\n\n```text:result:\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n3.8. \u30a2\u30e9\u30fc\u30e0\u306e\u78ba\u8a8d\n-------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudwatch describe-alarms --alarm-names ${CWATCH_ALARM_NAME}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"MetricAlarms\": [\n          {\n              \"EvaluationPeriods\": 12,\n              \"AlarmArn\": \"arn:aws:cloudwatch:us-west-2:XXXXXXXXXXXX:alarm:ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"StateUpdatedTimestamp\": \"2015-02-15T07:24:06.461Z\",\n              \"AlarmConfigurationUpdatedTimestamp\": \"2015-02-15T07:23:28.223Z\",\n              \"ComparisonOperator\": \"GreaterThanOrEqualToThreshold\",\n              \"AlarmActions\": [\n                  \"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\"\n              ],\n              \"Namespace\": \"AWS/DynamoDB\",\n              \"AlarmDescription\": \"Read Capacity Units Limit Basic Alarm for ProductCatalog\",\n              \"StateReasonData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-15T07:24:06.455+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[],\\\"threshold\\\":2400.0}\",\n              \"Period\": 300,\n              \"StateValue\": \"INSUFFICIENT_DATA\",\n              \"Threshold\": 2400.0,\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"Dimensions\": [\n                  {\n                      \"Name\": \"TableName\",\n                      \"Value\": \"ProductCatalog\"\n                  }\n              ],\n              \"Unit\": \"Count\",\n              \"Statistic\": \"Sum\",\n              \"StateReason\": \"Unchecked: Initial alarm creation\",\n              \"InsufficientDataActions\": [],\n              \"OKActions\": [],\n              \"ActionsEnabled\": true,\n              \"MetricName\": \"ConsumedReadCapacityUnits\"\n          }\n        ]\n      }\n```\n\n\n3.9. history\u306e\u78ba\u8a8d\n------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_MAX_ITEMS='2'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudwatch describe-alarm-history \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --max-items ${CWATCH_MAX_ITEMS}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"AlarmHistoryItems\": [\n          {\n              \"Timestamp\": \"2015-02-14T06:37:59.453Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"INSUFFICIENT_DATA\\\",\\\"stateReason\\\":\\\"Unchecked: Initial alarm creation\\\"},\\\"newState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:37:59.447+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:22:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}}}\",\n              \"HistorySummary\": \"Alarm updated from INSUFFICIENT_DATA to OK\"\n\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:37:58.808Z\",\n              \"HistoryItemType\": \"ConfigurationUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"type\\\":\\\"Create\\\",\\\"createdAlarm\\\":{\\\"threshold\\\":240.0,\\\"stateValue\\\":\\\"INSUFFICIENT_DATA\\\",\\\"metricName\\\":\\\"ConsumedReadCapacityUnits\\\",\\\"period\\\":300,\\\"dimensions\\\":[{\\\"name\\\":\\\"TableName\\\",\\\"value\\\":\\\"ProductCatalog\\\"}],\\\"alarmName\\\":\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\",\\\"unit\\\":\\\"Count\\\",\\\"actionsEnabled\\\":true,\\\"okactions\\\":[],\\\"alarmActions\\\":[\\\"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\\\"],\\\"namespace\\\":\\\"AWS/DynamoDB\\\",\\\"evaluationPeriods\\\":12,\\\"comparisonOperator\\\":\\\"GreaterThanOrEqualToThreshold\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"alarmArn\\\":\\\"arn:aws:cloudwatch:us-west-2:XXXXXXXXXXXX:alarm:ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\",\\\"insufficientDataActions\\\":[],\\\"alarmDescription\\\":\\\"Read Capacity Units Limit Basic Alarm for ProductCatalog\",\\\"alarmConfigurationUpdatedTimestamp\\\":\\\"2015-02-14T06:37:58.808+0000\\\",\\\"stateUpdatedTimestamp\\\":\\\"2015-02-14T06:37:58.808+0000\\\"}}\",\n              \"HistorySummary\": \"Alarm \\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\" created\"\n          }\n        ]\n      }\n```\n\n3.10. \u30a2\u30e9\u30fc\u30e0\u306e\u9001\u4fe1\u30c6\u30b9\u30c8\n-------------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_STATE_VALUE='ALARM'\nCWATCH_STATE_REASON='test alarm.'\n```\n\n```bash:command:\naws cloudwatch set-alarm-state \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --state-value ${CWATCH_STATE_VALUE} \\\n        --state-reason \"${CWATCH_STATE_REASON}\"\n```\n\n```text:result:\n      (\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n3.11. history\u306e\u78ba\u8a8d\n------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nCWATCH_MAX_ITEMS='3'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws cloudwatch describe-alarm-history \\\n        --alarm-name ${CWATCH_ALARM_NAME} \\\n        --max-items ${CWATCH_MAX_ITEMS}\n```\n\n```json:\u7d50\u679c(\u4f8b):\n      {\n        \"AlarmHistoryItems\": [\n          {\n              \"Timestamp\": \"2015-02-14T06:45:27.209Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"ALARM\\\",\\\"stateReason\\\":\\\"test alarm.\\\"},\\\"newState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:45:27.200+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:25:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}}}\",\n              \"HistorySummary\": \"Alarm updated from ALARM to OK\"\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:45:26.465Z\",\n              \"HistoryItemType\": \"Action\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"actionState\\\":\\\"Succeeded\\\",\\\"notificationResource\\\":\\\"arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\\\",\\\"stateUpdateTimestamp\\\":\\\"2015-02-14T06:45:26.450+0000\\\",\\\"publishedMessage\\\":\\\"{\\\\\\\"default\\\\\\\":\\\\\\\"{\\\\\\\\\\\\\\\"AlarmName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AlarmDescription\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Read Capacity Units Limit Basic Alarm for ProductCatalog\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"AWSAccountId\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"XXXXXXXXXXXX\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ALARM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"NewStateReason\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"test alarm.\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"StateChangeTime\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"2015-02-14T06:45:26.450+0000\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Region\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"US-West-2\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"OldStateValue\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"OK\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Trigger\\\\\\\\\\\\\\\":{\\\\\\\\\\\\\\\"MetricName\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ConsumedReadCapacityUnits\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Namespace\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"AWS/DynamoDB\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Statistic\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"SUM\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Unit\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"Count\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Dimensions\\\\\\\\\\\\\\\":[{\\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"TableName\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"value\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"ProductCatalog\\\\\\\\\\\\\\\"}],\\\\\\\\\\\\\\\"Period\\\\\\\\\\\\\\\":300,\\\\\\\\\\\\\\\"EvaluationPeriods\\\\\\\\\\\\\\\":12,\\\\\\\\\\\\\\\"ComparisonOperator\\\\\\\\\\\\\\\":\\\\\\\\\\\\\\\"GreaterThanOrEqualToThreshold\\\\\\\\\\\\\\\",\\\\\\\\\\\\\\\"Threshold\\\\\\\\\\\\\\\":240.0}}\\\\\\\",\\\\\\\"sms\\\\\\\":\\\\\\\"ALARM: \\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\" in US-West-2\\\\\\\",\\\\\\\"email\\\\\\\":\\\\\\\"You are receiving this email because your Amazon CloudWatch Alarm \\\\\\\\\\\\\\\"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\\\\\\\\" in the US-West-2 region has entered the ALARM state, because \\\\\\\\\\\\\\\"test alarm.\\\\\\\\\\\\\\\" at \\\\\\\\\\\\\\\"Saturday 14 February, 2015 06:45:26 UTC\\\\\\\\\\\\\\\".\\\\\\\\n\\\\\\\\nView this alarm in the AWS Management Console:\\\\\\\\nhttps://console.aws.amazon.com/cloudwatch/home?region=us-west-2#s=Alarms&alarm=ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\n\\\\\\\\nAlarm Details:\\\\\\\\n- Name:                       ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\\\\\\\\n- Description:                Read Capacity Units Limit Basic Alarm for ProductCatalog\\\\\\\\n- State Change:               OK -> ALARM\\\\\\\\n- Reason for State Change:    test alarm.\\\\\\\\n- Timestamp:                  Saturday 14 February, 2015 06:45:26 UTC\\\\\\\\n- AWS Account:                XXXXXXXXXXXX\\\\\\\\n\\\\\\\\nThreshold:\\\\\\\\n- The alarm is in the ALARM state when the metric is GreaterThanOrEqualToThreshold 240.0 for 300 seconds. \\\\\\\\n\\\\\\\\nMonitored Metric:\\\\\\\\n- MetricNamespace:            AWS/DynamoDB\\\\\\\\n- MetricName:                 ConsumedReadCapacityUnits\\\\\\\\n- Dimensions:                 [TableName = ProductCatalog]\\\\\\\\n- Period:                     300 seconds\\\\\\\\n- Statistic:                  Sum\\\\\\\\n- Unit:                       Count\\\\\\\\n\\\\\\\\nState Change Actions:\\\\\\\\n- OK: \\\\\\\\n- ALARM: [arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb]\\\\\\\\n- INSUFFICIENT_DATA: \\\\\\\\n\\\\\\\"}\\\"}\",\n              \"HistorySummary\": \"Successfully executed action arn:aws:sns:us-west-2:XXXXXXXXXXXX:dynamodb\"\n          },\n          {\n              \"Timestamp\": \"2015-02-14T06:45:26.450Z\",\n              \"HistoryItemType\": \"StateUpdate\",\n              \"AlarmName\": \"ProductCatalog-ReadCapacityUnitsLimit-BasicAlarm\",\n              \"HistoryData\": \"{\\\"version\\\":\\\"1.0\\\",\\\"oldState\\\":{\\\"stateValue\\\":\\\"OK\\\",\\\"stateReason\\\":\\\"Threshold Crossed: 1 datapoint (8.0) was not greater than or equal to the threshold (240.0).\\\",\\\"stateReasonData\\\":{\\\"version\\\":\\\"1.0\\\",\\\"queryDate\\\":\\\"2015-02-14T06:37:59.447+0000\\\",\\\"startDate\\\":\\\"2015-02-14T06:22:00.000+0000\\\",\\\"unit\\\":\\\"Count\\\",\\\"statistic\\\":\\\"Sum\\\",\\\"period\\\":300,\\\"recentDatapoints\\\":[8.0],\\\"threshold\\\":240.0}},\\\"newState\\\":{\\\"stateValue\\\":\\\"ALARM\\\",\\\"stateReason\\\":\\\"test alarm.\\\"}}\",\n              \"HistorySummary\": \"Alarm updated from OK to ALARM\"\n          }\n        ],\n        \"NextToken\": \"None___3\"\n      }\n```\n\n\n \n\u5b8c\u4e86\n====\n", "tags": ["AWS", "aws-cli", "CloudWatch", "DynamoDB"]}