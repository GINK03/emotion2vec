{"tags": ["Git", "GitBucket", "CentOS"], "context": "\u500b\u4eba\u7684\u306a\u30e1\u30e2\u3002\n\njdk \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ntomcat \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ngitbucket \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nfirewall(iptables)\u8a2d\u5b9a\n\n\njdk \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo  yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel-1.8.0-devel\n\n\u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306a\u3051\u308c\u3070epel\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u8ffd\u52a0\u3059\u308b\u3002\n\ntomcat \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30d0\u30a4\u30ca\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u914d\u7f6e\u3059\u308b\n\ncd /usr/local/src\nsudo wget http://ftp.tsukuba.wide.ad.jp/software/apache/tomcat/tomcat-8/v8.5.9/bin/apache-tomcat-8.5.9.tar.gz\nsudo tar -xvzf apache-tomcat-8.5.9.tar.gz\nsudo useradd -r tomcat8 --shell /bin/false\nsudo mv apache-tomcat-8.5.9 /usr/local/tomca8\nsudo chown -R tomcat8 /usr/local/tomca8\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\nsudo vi /etc/init.d/tomcat8\n\n\u5185\u5bb9\u306f\u4ee5\u4e0b\n#!/bin/bash\n#\n# tomcat8\n#\n# chkconfig: - 80 20\n#\n### BEGIN INIT INFO\n# Provides: tomcat8\n# Required-Start: $network $syslog\n# Required-Stop: $network $syslog\n# Default-Start:\n# Default-Stop:\n# Description: Tomcat 8\n# Short-Description: start and stop tomcat\n### END INIT INFO\n\n## Source function library.\n#. /etc/rc.d/init.d/functions\nexport JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.x86_64/bin/\nexport JRE_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.x86_64\n\nexport JAVA_OPTS=\"-Dfile.encoding=UTF-8 \\\n  -Dnet.sf.ehcache.skipUpdateCheck=true \\\n  -Djava.net.preferIPv4Stack=true  \\\n  -XX:+UseConcMarkSweepGC \\\n  -XX:+CMSClassUnloadingEnabled \\\n  -XX:+UseParNewGC \\\n  -XX:MaxPermSize=128m \\\n  -Xms512m -Xmx512m\"\nexport PATH=$JAVA_HOME/bin:$PATH\nTOMCAT_HOME=/usr/local/tomcat8\nTOMCAT_USER=tomcat8\nSHUTDOWN_WAIT=20\n\ntomcat_pid() {\n  echo `ps aux | grep org.apache.catalina.startup.Bootstrap | grep -v grep | awk '{ print $2 }'`\n}\nstart() {\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Tomcat is already running (pid: $pid)\"\n  else\n    # Start tomcat\n    echo \"Starting tomcat\"\n    ulimit -n 100000\n    umask 007\n    /bin/su -p -s /bin/sh $TOMCAT_USER $TOMCAT_HOME/bin/startup.sh\n  fi\n\n\n  return 0\n}\nstop() {\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Stoping Tomcat\"\n    /bin/su -p -s /bin/sh $TOMCAT_USER $TOMCAT_HOME/bin/shutdown.sh\n\n    let kwait=$SHUTDOWN_WAIT\n    count=0;\n    until [ `ps -p $pid | grep -c $pid` = '0' ] || [ $count -gt $kwait ]\n    do\n      echo -n -e \"\\nwaiting for processes to exit\";\n      sleep 1\n      let count=$count+1;\n    done\n\n    if [ $count -gt $kwait ]; then\n      echo -n -e \"\\nkilling processes which didn't stop after $SHUTDOWN_WAIT seconds\"\n      kill -9 $pid\n    fi\n  else\n    echo \"Tomcat is not running\"\n  fi\n\n  return 0\n}\ncase $1 in\nstart)\n  start\n;;\nstop)\n  stop\n;;\nrestart)\n  stop\n  start\n;;\nstatus)\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Tomcat is running with pid: $pid\"\n  else\n    echo \"Tomcat is not running\"\n  fi\n;;\nesac\nexit 0\n\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u53ef\u80fd\u306b\u3059\u308b\n\nsudo chmod +x /etc/init.d/tomcat8\n\n\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n sudo chkconfig tomcat8 on\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n\nsudo service tomcat8 start\n\n\u30b5\u30fc\u30d3\u30b9\u505c\u6b62\n\nsudo service tomcat8 stop\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u8d77\u52d5\u30dd\u30fc\u30c8\u306f8080\n\ngitbucket \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30d0\u30a4\u30ca\u30ea\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089 war \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nwar\u30d5\u30a1\u30a4\u30eb\u3092 tomcat webapp\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\ngitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001tomcat8\u30e6\u30fc\u30b6\u30fc\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\ngitbucket/WEB-INF/web.xml \u3092\u7de8\u96c6\u3057\u3001gitbucket.home \u306e\u5024\u3092gitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u8a2d\u5b9a\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30d0\u30a4\u30ca\u30ea\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089 war \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nhttps://github.com/gitbucket/gitbucket/releases\ngitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001tomcat8\u30e6\u30fc\u30b6\u30fc\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\nmkdir /var/gitbucket\nchown -R tomcat8 /var/gitbucket\n\ngitbucket/WEB-INF/web.xml \u3092\u7de8\u96c6\u3057\u3001gitbucket.home \u306e\u5024\u3092gitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u8a2d\u5b9a\u3059\u308b\n\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b\n <context-param>\n    <param-name>gitbucket.home</param-name>\n    <param-value>/var/gitbucket</param-value>\n  </context-param>\n\n\nfirewall(iptables)\u8a2d\u5b9a\nAJP \u3067apache\u3068\u9023\u643a\u3059\u308b\u5834\u5408\u306f port 80\u3001tomcat 8080 \u30dd\u30fc\u30c8\u306e\u307e\u307e\u3064\u304b\u3046\u306a\u3089port8080 \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u3002\nCentOS7(firewall-cmd\u306b\u3088\u308a\u8a31\u53ef\u30dd\u30fc\u30c8\u3092\u8ffd\u52a0)\n\nfirewall-cmd --add-port=8080\n\nCentOS6(/etc/sysconfig/iptables\u3092\u7de8\u96c6\u3057\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b)\n\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT\n\n\u500b\u4eba\u7684\u306a\u30e1\u30e2\u3002\n\n* jdk \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* tomcat \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* gitbucket \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* firewall(iptables)\u8a2d\u5b9a\n\n## jdk \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nsudo  yum install java-1.8.0-openjdk java-1.8.0-openjdk-devel-1.8.0-devel\n```\n\n\u6a19\u6e96\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306a\u3051\u308c\u3070epel\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089\u8ffd\u52a0\u3059\u308b\u3002\n\n## tomcat \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30d0\u30a4\u30ca\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u914d\u7f6e\u3059\u308b\n```\ncd /usr/local/src\nsudo wget http://ftp.tsukuba.wide.ad.jp/software/apache/tomcat/tomcat-8/v8.5.9/bin/apache-tomcat-8.5.9.tar.gz\nsudo tar -xvzf apache-tomcat-8.5.9.tar.gz\nsudo useradd -r tomcat8 --shell /bin/false\nsudo mv apache-tomcat-8.5.9 /usr/local/tomca8\nsudo chown -R tomcat8 /usr/local/tomca8\n```\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\n\n```\nsudo vi /etc/init.d/tomcat8\n```\n\n\u5185\u5bb9\u306f\u4ee5\u4e0b\n\n```\n#!/bin/bash\n#\n# tomcat8\n#\n# chkconfig: - 80 20\n#\n### BEGIN INIT INFO\n# Provides: tomcat8\n# Required-Start: $network $syslog\n# Required-Stop: $network $syslog\n# Default-Start:\n# Default-Stop:\n# Description: Tomcat 8\n# Short-Description: start and stop tomcat\n### END INIT INFO\n\n## Source function library.\n#. /etc/rc.d/init.d/functions\nexport JAVA_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.x86_64/bin/\nexport JRE_HOME=/usr/lib/jvm/jre-1.8.0-openjdk.x86_64\n\nexport JAVA_OPTS=\"-Dfile.encoding=UTF-8 \\\n  -Dnet.sf.ehcache.skipUpdateCheck=true \\\n  -Djava.net.preferIPv4Stack=true  \\\n  -XX:+UseConcMarkSweepGC \\\n  -XX:+CMSClassUnloadingEnabled \\\n  -XX:+UseParNewGC \\\n  -XX:MaxPermSize=128m \\\n  -Xms512m -Xmx512m\"\nexport PATH=$JAVA_HOME/bin:$PATH\nTOMCAT_HOME=/usr/local/tomcat8\nTOMCAT_USER=tomcat8\nSHUTDOWN_WAIT=20\n\ntomcat_pid() {\n  echo `ps aux | grep org.apache.catalina.startup.Bootstrap | grep -v grep | awk '{ print $2 }'`\n}\nstart() {\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Tomcat is already running (pid: $pid)\"\n  else\n    # Start tomcat\n    echo \"Starting tomcat\"\n    ulimit -n 100000\n    umask 007\n    /bin/su -p -s /bin/sh $TOMCAT_USER $TOMCAT_HOME/bin/startup.sh\n  fi\n\n\n  return 0\n}\nstop() {\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Stoping Tomcat\"\n    /bin/su -p -s /bin/sh $TOMCAT_USER $TOMCAT_HOME/bin/shutdown.sh\n\n    let kwait=$SHUTDOWN_WAIT\n    count=0;\n    until [ `ps -p $pid | grep -c $pid` = '0' ] || [ $count -gt $kwait ]\n    do\n      echo -n -e \"\\nwaiting for processes to exit\";\n      sleep 1\n      let count=$count+1;\n    done\n\n    if [ $count -gt $kwait ]; then\n      echo -n -e \"\\nkilling processes which didn't stop after $SHUTDOWN_WAIT seconds\"\n      kill -9 $pid\n    fi\n  else\n    echo \"Tomcat is not running\"\n  fi\n\n  return 0\n}\ncase $1 in\nstart)\n  start\n;;\nstop)\n  stop\n;;\nrestart)\n  stop\n  start\n;;\nstatus)\n  pid=$(tomcat_pid)\n  if [ -n \"$pid\" ]\n  then\n    echo \"Tomcat is running with pid: $pid\"\n  else\n    echo \"Tomcat is not running\"\n  fi\n;;\nesac\nexit 0\n```\n\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u53ef\u80fd\u306b\u3059\u308b\n```\nsudo chmod +x /etc/init.d/tomcat8\n```\n\n\u30b5\u30fc\u30d3\u30b9\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n```\n sudo chkconfig tomcat8 on\n```\n\n\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n```\nsudo service tomcat8 start\n```\n\n\u30b5\u30fc\u30d3\u30b9\u505c\u6b62\n```\nsudo service tomcat8 stop\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u8d77\u52d5\u30dd\u30fc\u30c8\u306f8080\n\n## gitbucket \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n* \u30d0\u30a4\u30ca\u30ea\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089 war \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n* war\u30d5\u30a1\u30a4\u30eb\u3092 tomcat webapp\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u914d\u7f6e\n* gitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001tomcat8\u30e6\u30fc\u30b6\u30fc\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n* gitbucket/WEB-INF/web.xml \u3092\u7de8\u96c6\u3057\u3001gitbucket.home \u306e\u5024\u3092gitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u8a2d\u5b9a\u3059\u308b\n\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304b\u3089\u30d0\u30a4\u30ca\u30ea\u914d\u5e03\u30b5\u30a4\u30c8\u304b\u3089 war \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nhttps://github.com/gitbucket/gitbucket/releases\n\n\ngitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001tomcat8\u30e6\u30fc\u30b6\u30fc\u304c\u8aad\u307f\u66f8\u304d\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n```\nmkdir /var/gitbucket\nchown -R tomcat8 /var/gitbucket\n```\n\ngitbucket/WEB-INF/web.xml \u3092\u7de8\u96c6\u3057\u3001gitbucket.home \u306e\u5024\u3092gitbucket \u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u8a2d\u5b9a\u3059\u308b\n\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b\n\n```\n <context-param>\n    <param-name>gitbucket.home</param-name>\n    <param-value>/var/gitbucket</param-value>\n  </context-param>\n```\n\n## firewall(iptables)\u8a2d\u5b9a\n\nAJP \u3067apache\u3068\u9023\u643a\u3059\u308b\u5834\u5408\u306f port 80\u3001tomcat 8080 \u30dd\u30fc\u30c8\u306e\u307e\u307e\u3064\u304b\u3046\u306a\u3089port8080 \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3059\u308b\u3002\n\nCentOS7(firewall-cmd\u306b\u3088\u308a\u8a31\u53ef\u30dd\u30fc\u30c8\u3092\u8ffd\u52a0)\n```\nfirewall-cmd --add-port=8080\n```\nCentOS6(/etc/sysconfig/iptables\u3092\u7de8\u96c6\u3057\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3059\u308b)\n```\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 8080 -j ACCEPT\n```\n"}