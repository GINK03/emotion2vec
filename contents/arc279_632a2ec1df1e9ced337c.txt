{"context": "nginx\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306b\u3057\u3066\u3001\u7279\u5b9a\u306e\u30d8\u30c3\u30c0\u306e\u5024\u3067apache2\u306b\u30d7\u30ed\u30ad\u30b7\u3059\u308b\u3084\u3064\u3002\n\u8a2d\u5b9a\u5024\u3068\u304b\u306f\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u8a2d\u5b9a\nCentOS 6.6 \u3067\u8a66\u3057\u305f\u3002\n\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u306e\u30ad\u30fc\u306f X-BACKEND-PORT \u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u3053\u5909\u66f4\u3059\u308b\u306a\u3089 nginx \u306e\u8a2d\u5b9a\u306e $http_x_backend_port \u3082\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\nnginx\nnginx version: nginx/1.10.1\n\n\n/etc/nginx/conf.d/site.conf\nserver {\n        listen       80;\n        server_name  hoge.example.com;\n\n        access_log  /var/log/nginx/hoge.example.com.access.log;\n        error_log /var/log/nginx/hoge.example.com.aerror.log;\n\n        location / {\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-Host $host;\n                proxy_set_header X-Forwarded-Proto $scheme;\n                proxy_set_header X-Forwarded-Server $host;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n                proxy_pass  http://127.0.0.1:$http_x_backend_port;\n        }\n}\n\n\n\n\u4f59\u8ac7\nproxy_pass \u306e upstream \u3092 localhost \u3067\u6307\u5b9a\u3059\u308b\u3068\u4f55\u6545\u304b IPv6 \u3067\u30d7\u30ed\u30ad\u30b7\u3057\u3088\u3046\u3068\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001\n\u7279\u306b\u7406\u7531\u304c\u7121\u3051\u308c\u3070 127.0.0.1 \u306b\u3057\u3066\u304a\u304f\u3068\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\napache2\nServer version: Apache/2.2.15 (Unix)\nServer built:   Jul 18 2016 15:24:00\n\n2.4 \u3060\u3068\u66f8\u304d\u65b9\u9055\u3046\u304b\u3082\u3002\n\n/etc/httpd/conf.d/site.conf\nListen 8000\nListen 8001\nListen 8002\n\n<VirtualHost *:8000>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test0\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test0.error_log\n    CustomLog logs/test0.access_log common\n</VirtualHost>\n\n<VirtualHost *:8001>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test1\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test1.error_log\n    CustomLog logs/test1.access_log common\n</VirtualHost>\n\n<VirtualHost *:8002>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test2\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test2.error_log\n    CustomLog logs/test2.access_log common\n</VirtualHost>\n\n\n\n\u914d\u7f6e\n/var/www/html\n\u251c\u2500\u2500 test0\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 info.php\n\u251c\u2500\u2500 test1\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 info.php -> ../test0/info.php\n\u2514\u2500\u2500 test2\n    \u2514\u2500\u2500 info.php -> ../test0/info.php\n\n\n/var/www/html/test0/info.php\n<?php\nvar_dump(getcwd());\nvar_dump($_SERVER);\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u30b5\u30fc\u30d0\u304c 192.168.33.30 \u306e\u5834\u5408\u3002\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8000\"\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8001\"\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8002\"\n\nnginx\u3092\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u306b\u3057\u3066\u3001\u7279\u5b9a\u306e\u30d8\u30c3\u30c0\u306e\u5024\u3067apache2\u306b\u30d7\u30ed\u30ad\u30b7\u3059\u308b\u3084\u3064\u3002\n\u8a2d\u5b9a\u5024\u3068\u304b\u306f\u9069\u5b9c\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n# \u8a2d\u5b9a\n\n*CentOS 6.6* \u3067\u8a66\u3057\u305f\u3002\n\n\u30ab\u30b9\u30bf\u30e0\u30d8\u30c3\u30c0\u306e\u30ad\u30fc\u306f `X-BACKEND-PORT` \u3068\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u3053\u5909\u66f4\u3059\u308b\u306a\u3089 nginx \u306e\u8a2d\u5b9a\u306e `$http_x_backend_port` \u3082\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n## nginx\n\n```\nnginx version: nginx/1.10.1\n```\n\n```conf:/etc/nginx/conf.d/site.conf\nserver {\n        listen       80;\n        server_name  hoge.example.com;\n\n        access_log  /var/log/nginx/hoge.example.com.access.log;\n        error_log /var/log/nginx/hoge.example.com.aerror.log;\n\n        location / {\n                proxy_set_header Host $host;\n                proxy_set_header X-Real-IP $remote_addr;\n                proxy_set_header X-Forwarded-Host $host;\n                proxy_set_header X-Forwarded-Proto $scheme;\n                proxy_set_header X-Forwarded-Server $host;\n                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n\n                proxy_pass  http://127.0.0.1:$http_x_backend_port;\n        }\n}\n```\n\n### \u4f59\u8ac7\n\nproxy_pass \u306e upstream \u3092 _localhost_ \u3067\u6307\u5b9a\u3059\u308b\u3068\u4f55\u6545\u304b *IPv6* \u3067\u30d7\u30ed\u30ad\u30b7\u3057\u3088\u3046\u3068\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3001\n\u7279\u306b\u7406\u7531\u304c\u7121\u3051\u308c\u3070 _127.0.0.1_ \u306b\u3057\u3066\u304a\u304f\u3068\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## apache2\n\n```\nServer version: Apache/2.2.15 (Unix)\nServer built:   Jul 18 2016 15:24:00\n```\n\n2.4 \u3060\u3068\u66f8\u304d\u65b9\u9055\u3046\u304b\u3082\u3002\n\n```conf:/etc/httpd/conf.d/site.conf\nListen 8000\nListen 8001\nListen 8002\n\n<VirtualHost *:8000>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test0\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test0.error_log\n    CustomLog logs/test0.access_log common\n</VirtualHost>\n\n<VirtualHost *:8001>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test1\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test1.error_log\n    CustomLog logs/test1.access_log common\n</VirtualHost>\n\n<VirtualHost *:8002>\n    ServerAdmin webmaster@hoge.example.com\n    DocumentRoot /var/www/html/test2\n    ServerName  hoge.example.com;\n\n    ErrorLog logs/test2.error_log\n    CustomLog logs/test2.access_log common\n</VirtualHost>\n```\n\n# \u914d\u7f6e\n\n```\n/var/www/html\n\u251c\u2500\u2500 test0\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 info.php\n\u251c\u2500\u2500 test1\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 info.php -> ../test0/info.php\n\u2514\u2500\u2500 test2\n    \u2514\u2500\u2500 info.php -> ../test0/info.php\n```\n\n```php:/var/www/html/test0/info.php\n<?php\nvar_dump(getcwd());\nvar_dump($_SERVER);\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n\u30b5\u30fc\u30d0\u304c _192.168.33.30_ \u306e\u5834\u5408\u3002\n\n```\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8000\"\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8001\"\ncurl -s -v 192.168.33.30/info.php -H \"X-BACKEND-PORT: 8002\"\n```\n", "tags": ["nginx", "apache2"]}