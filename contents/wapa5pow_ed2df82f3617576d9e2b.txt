{"tags": ["Rails", "JavaScript", "GoogleAppsScript", "Slack"], "context": "\n\n\u80cc\u666f\n\u6700\u8fd1\u306frails\u3067\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6bce\u671dPR\u306e\u30ea\u30b9\u30c8\u3092slack\u306b\u306a\u3052\u3066\u304f\u308c\u305f\u3089\u697d\u3060\u306a\u30fc\u3068\u601d\u3044\u3001Google Apps Script\u3067\u3064\u304f\u308a\u307e\u3057\u305f\u3002\n\u6bce\u65e5\u5b9a\u6642\u306b\u884c\u3046\u3068\u3044\u3046\u51e6\u7406\u306fcron\u304c\u5fc5\u8981\u3067\u30b5\u30fc\u30d0\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001Google Apps Script\u306fcron\u306e\u3088\u3046\u306b\u5b9a\u671f\u51e6\u7406\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30ec\u30b9\u304b\u3064\u7121\u6599\u3067\u3044\u3051\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306bslack\u306b\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n\n\u51e6\u7406\u306e\u6d41\u308c\n\nApps Script\u304b\u3089Github API\u3092\u8aad\u3093\u3067PR\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\n\u7d50\u679c\u3092Script\u5185\u3067\u3001\u51e6\u7406\u3057\u3066\u3001Slack\u306b\u306a\u3052\u308b\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3059\u308b\u306e\u3067\u3001slack\u3068github\u306eAPI\u30c8\u30fc\u30af\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u5b9f\u88c5\u624b\u9806\n\nToken\u306e\u53d6\u5f97\n\n\nSlack\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u307f\u306a\u304c\u3089token\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002xoxp-\u301c\u3068\u3044\u3046\u3088\u3046\u306a\u30c8\u30fc\u30af\u30f3\u306a\u306f\u305a\u3067\u3059\n\n\nhttp://qiita.com/rubytomato@github/items/6558bfdb37d982891c09\nhttp://qiita.com/Yinaura/items/5f00e025a95d0ff11bbd\n\n\n\nGithub\u306f\u4ee5\u4e0b\u3092\u307f\u306a\u304c\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\nhttps://github.com/blog/1509-personal-api-tokens\n\n\n\ngithub\u306b\u95a2\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\nApps Script\u306e\u6e96\u5099\n\u4ee5\u4e0b\u3092\u307f\u306a\u304c\u3089Apps Script\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092Google Drive\u4e0a\u306b\u65b0\u898f\u4f5c\u6210\u3092\u3057\u307e\u3059\nhttp://qiita.com/wapa5pow/items/3b55a19659d61abcfd96\n\n\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30d4\u30da\u3057\u307e\u3059\u3002\nslack_token, github_token, owner, repo, channel\u306f\u9069\u5b9c\u304b\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3068\u3048\u3070\u3001github\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306eurl\u304c https://github.com/xxx/yyy \u306a\u3089\u3001owner\u306fxxx\u3067repo\u306fyyy\u3067\u3059\u3002\nfunction execute() {\n  var slack_token = \"xxx\";\n  var github_token = \"xxx\";\n  var owner = \"xxx\";\n  var repo = \"xxx\";\n  var channel = \"xxx\";\n  notifyPullRequestToSlack(slack_token, channel, github_token, owner, repo);\n}\n\n\nfunction notifyPullRequestToSlack(slack_token, channel, github_token, owner, repo) {\n  var result = getPullRequestLists(github_token, owner, repo);\n  var messages = [];\n  for (var i = 0; i < result.length; i++) {\n    messages.push(\"<\" + result[i][\"url\"] + \"|\" + result[i][\"title\"] + \" by \" + result[i][\"user\"] + \">\");\n  }\n  slack(slack_token, channel, messages.join(\"\\n\"));\n}\n\nfunction slack(slack_token, channel, message) {\n  var url        = 'https://slack.com/api/chat.postMessage';\n  var channel    = '#' + channel;\n  var icon_url   = \"https://h2.slack-edge.com/3429/plugins/github/assets/service_96.png\";\n  var method     = 'post';\n\n  var payload = {\n    \"token\": slack_token,\n    \"channel\": channel,\n    \"text\": message,\n    \"icon_url\": icon_url,\n    \"username\": \"PR\u304f\u3093\"\n  };\n\n  var params = {\n    'method' : method,\n    'payload' : payload\n  };\n\n  var response = UrlFetchApp.fetch(url, params);\n}\n\nfunction getPullRequestLists(token, owner, repo) {\n  var resultList = [];\n  var options =\n  {\n    \"method\" : \"get\",\n    \"headers\" : {\n      \"Authorization\": \"token \" + token \n    }\n  };\n  var url = \"https://api.github.com/repos/\" + owner + \"/\" + repo + \"/pulls\";\n  var response = UrlFetchApp.fetch(url, options);\n  var json = JSON.parse(response.getContentText());\n  for (var i = 0; i < json.length; i++) {\n    var hash = json[i];\n\n    if (hash && \"url\" in hash) {\n      resultList.push({\n        \"url\": hash[\"html_url\"],\n        \"title\": hash[\"title\"],\n        \"user\": hash[\"user\"][\"login\"],\n        \"avatar_url\": hash[\"user\"][\"avatar_url\"]\n      });\n    }\n  }\n  return resultList;\n}\n\n\nApps Script\u4e0a\u3067cron\u306e\u8a2d\u5b9a\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\u6ce8\u610f\u70b9\u3068\u3057\u3066cron\u306e\u5b9f\u884c\u6642\u9593\u306f1\u6642\u9593\u306e\u3046\u3061\u306e\u3069\u3053\u304b\u3068\u3044\u3046\u3075\u3046\u306b\u3057\u304b\u9078\u3079\u307e\u305b\u3093\u3002\n\u4f8b\u3048\u3070\u30019-10pm\u306a\u3089\u5348\u5f8c9-10\u6642\u306e\u3046\u3061\u306e\u3069\u3053\u304b\u306b\u767a\u52d5\u3059\u308b\u306e\u3067\u6b63\u78ba\u306acron\u306b\u306f\u5411\u3044\u3066\u307e\u305b\u3093\u3002\n\n\n\u4ee5\u4e0b\u3067\u81ea\u5206\u304c\u8a2d\u5b9a\u3057\u305f\u3044\u3082\u306e\u306b\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\u7d50\u3073\nGoogle Apps Script\u3092\u3064\u304b\u3046\u3068\u30b5\u30fc\u30d0\u30ec\u30b9\uff06\u7121\u6599\u3067\u3044\u308d\u3044\u308d\u3067\u304d\u3061\u3083\u3044\u307e\u3059\u3002\n\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/8de51f3b-b9b7-0bb7-6533-502737cfae6c.png)\n\n\n# \u80cc\u666f\n\n\u6700\u8fd1\u306frails\u3067\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6bce\u671dPR\u306e\u30ea\u30b9\u30c8\u3092slack\u306b\u306a\u3052\u3066\u304f\u308c\u305f\u3089\u697d\u3060\u306a\u30fc\u3068\u601d\u3044\u3001Google Apps Script\u3067\u3064\u304f\u308a\u307e\u3057\u305f\u3002\n\n\u6bce\u65e5\u5b9a\u6642\u306b\u884c\u3046\u3068\u3044\u3046\u51e6\u7406\u306fcron\u304c\u5fc5\u8981\u3067\u30b5\u30fc\u30d0\u3092\u7528\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001Google Apps Script\u306fcron\u306e\u3088\u3046\u306b\u5b9a\u671f\u51e6\u7406\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30ec\u30b9\u304b\u3064\u7121\u6599\u3067\u3044\u3051\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306bslack\u306b\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/98da51bb-ff3d-9916-41c6-1be4599d36ea.png)\n\n\n# \u51e6\u7406\u306e\u6d41\u308c\n\n1. Apps Script\u304b\u3089Github API\u3092\u8aad\u3093\u3067PR\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\n2. \u7d50\u679c\u3092Script\u5185\u3067\u3001\u51e6\u7406\u3057\u3066\u3001Slack\u306b\u306a\u3052\u308b\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3059\u308b\u306e\u3067\u3001slack\u3068github\u306eAPI\u30c8\u30fc\u30af\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n# \u5b9f\u88c5\u624b\u9806\n\n## Token\u306e\u53d6\u5f97\n\n* **Slack**\u306f\u4ee5\u4e0b\u306a\u3069\u3092\u307f\u306a\u304c\u3089token\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002xoxp-\u301c\u3068\u3044\u3046\u3088\u3046\u306a\u30c8\u30fc\u30af\u30f3\u306a\u306f\u305a\u3067\u3059\n    * http://qiita.com/rubytomato@github/items/6558bfdb37d982891c09\n    * http://qiita.com/Yinaura/items/5f00e025a95d0ff11bbd\n* **Github**\u306f\u4ee5\u4e0b\u3092\u307f\u306a\u304c\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n    * https://github.com/blog/1509-personal-api-tokens\n\ngithub\u306b\u95a2\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/5f93dee9-7fb3-98f0-7f6d-4b55c920d49c.png)\n\n## Apps Script\u306e\u6e96\u5099\n\n\u4ee5\u4e0b\u3092\u307f\u306a\u304c\u3089Apps Script\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092Google Drive\u4e0a\u306b\u65b0\u898f\u4f5c\u6210\u3092\u3057\u307e\u3059\n\nhttp://qiita.com/wapa5pow/items/3b55a19659d61abcfd96\n\n## \u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30d4\u30da\u3057\u307e\u3059\u3002\n```slack_token```, ```github_token```, ```owner```, ```repo```, ```channel```\u306f\u9069\u5b9c\u304b\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3068\u3048\u3070\u3001github\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306eurl\u304c https://github.com/xxx/yyy \u306a\u3089\u3001owner\u306fxxx\u3067repo\u306fyyy\u3067\u3059\u3002\n\n```js\nfunction execute() {\n  var slack_token = \"xxx\";\n  var github_token = \"xxx\";\n  var owner = \"xxx\";\n  var repo = \"xxx\";\n  var channel = \"xxx\";\n  notifyPullRequestToSlack(slack_token, channel, github_token, owner, repo);\n}\n\n\nfunction notifyPullRequestToSlack(slack_token, channel, github_token, owner, repo) {\n  var result = getPullRequestLists(github_token, owner, repo);\n  var messages = [];\n  for (var i = 0; i < result.length; i++) {\n    messages.push(\"<\" + result[i][\"url\"] + \"|\" + result[i][\"title\"] + \" by \" + result[i][\"user\"] + \">\");\n  }\n  slack(slack_token, channel, messages.join(\"\\n\"));\n}\n  \nfunction slack(slack_token, channel, message) {\n  var url        = 'https://slack.com/api/chat.postMessage';\n  var channel    = '#' + channel;\n  var icon_url   = \"https://h2.slack-edge.com/3429/plugins/github/assets/service_96.png\";\n  var method     = 'post';\n  \n  var payload = {\n    \"token\": slack_token,\n    \"channel\": channel,\n    \"text\": message,\n    \"icon_url\": icon_url,\n    \"username\": \"PR\u304f\u3093\"\n  };\n  \n  var params = {\n    'method' : method,\n    'payload' : payload\n  };\n  \n  var response = UrlFetchApp.fetch(url, params);\n}\n\nfunction getPullRequestLists(token, owner, repo) {\n  var resultList = [];\n  var options =\n  {\n    \"method\" : \"get\",\n    \"headers\" : {\n      \"Authorization\": \"token \" + token \n    }\n  };\n  var url = \"https://api.github.com/repos/\" + owner + \"/\" + repo + \"/pulls\";\n  var response = UrlFetchApp.fetch(url, options);\n  var json = JSON.parse(response.getContentText());\n  for (var i = 0; i < json.length; i++) {\n    var hash = json[i];\n    \n    if (hash && \"url\" in hash) {\n      resultList.push({\n        \"url\": hash[\"html_url\"],\n        \"title\": hash[\"title\"],\n        \"user\": hash[\"user\"][\"login\"],\n        \"avatar_url\": hash[\"user\"][\"avatar_url\"]\n      });\n    }\n  }\n  return resultList;\n}\n```\n\n\n## Apps Script\u4e0a\u3067cron\u306e\u8a2d\u5b9a\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\u6ce8\u610f\u70b9\u3068\u3057\u3066cron\u306e\u5b9f\u884c\u6642\u9593\u306f1\u6642\u9593\u306e\u3046\u3061\u306e\u3069\u3053\u304b\u3068\u3044\u3046\u3075\u3046\u306b\u3057\u304b\u9078\u3079\u307e\u305b\u3093\u3002\n\u4f8b\u3048\u3070\u30019-10pm\u306a\u3089\u5348\u5f8c9-10\u6642\u306e\u3046\u3061\u306e\u3069\u3053\u304b\u306b\u767a\u52d5\u3059\u308b\u306e\u3067\u6b63\u78ba\u306acron\u306b\u306f\u5411\u3044\u3066\u307e\u305b\u3093\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/d387393e-e06e-5d18-6af3-171f75e9e7f8.png)\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/43753deb-d73c-e281-0a21-ce454d2e426a.png)\n\n\u4ee5\u4e0b\u3067\u81ea\u5206\u304c\u8a2d\u5b9a\u3057\u305f\u3044\u3082\u306e\u306b\u9069\u5207\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/30079/7f98f587-f2d4-4c83-8d9f-277443885511.png)\n\n# \u7d50\u3073\n\nGoogle Apps Script\u3092\u3064\u304b\u3046\u3068\u30b5\u30fc\u30d0\u30ec\u30b9\uff06\u7121\u6599\u3067\u3044\u308d\u3044\u308d\u3067\u304d\u3061\u3083\u3044\u307e\u3059\u3002\n\n"}