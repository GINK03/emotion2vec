{"context": " More than 1 year has passed since last update.\u30ed\u30fc\u30ab\u30eb\u74b0\u5883+PHP\u3067\u3001Twilio\u304b\u3089\u643a\u5e2f\u96fb\u8a71\u306a\u3069\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001S3\u3092\u5229\u7528\u3057\u3066\u3001\u65e5\u672c\u8a9e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u53c2\u8003\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1ahttps://jp.twilio.com/docs/api/twiml/say\n\n\n\n\u524d\u63d0\u6761\u4ef6\n\nTwilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\nTwilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4fdd\u6709\u3057\u3066\u3044\u308b\u3053\u3068\u3002\n\n\nTwilio\u306e\u96fb\u8a71\u756a\u53f7\nTwilio\u306e\u8a8d\u8a3c\u60c5\u5831 (ACCOUNT SID / AUTH TOKEN)\n\n\n\n\nTwilio+PHP\u74b0\u5883\n\nPHP (5.4\u4ee5\u4e0a\u3092\u60f3\u5b9a)\nTwilio PHP SDK\n\n(\u53c2\u8003) Twilio\u3067\u96fb\u8a71\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b (\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883: Twilio PHP SDK): http://qiita.com/tcsh/items/d0449909f20916fff159\n\nS3\u3078\u306e\u6a29\u9650\nS3\u30d0\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eread/write\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.8.11\nAWS CLI 1.7.40\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\naws-cli/1.8.11 Python/2.7.5 Darwin/13.4.0\n\n\n\n0. \u4e8b\u524d\u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile        s3Full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\nprofile\u304c '' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n\n\n\n0.3. \u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nORG=<\u7d44\u7e54\u540d>\nS3_BUCKET_NAME=\"${ORG}-handson-`date +%Y%m%d`\"\n\necho ${S3_BUCKET_NAME}\n\n\n\u307e\u3060\u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n\u30cf\u30a4\u30ec\u30d9\u30ebS3\u30b3\u30de\u30f3\u30c9\u3067\u9759\u7684Web\u30db\u30b9\u30c6\u30a3\u30f3\u30b0: http://qiita.com/tcsh/items/70694da357c1738c6bf8\n\n\n\u307e\u305f\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u95b2\u89a7\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3082\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30f3\u30c4\u7528\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a (\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7): http://qiita.com/tcsh/items/bcf93244b675faecd6c4#6-\u30b3\u30f3\u30c6\u30f3\u30c4\u7528\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a-\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\n\n\n\u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u306eWeb\u30db\u30b9\u30c6\u30a3\u30f3\u30b0endpoint\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nS3_BUCKET_ENDPOINT=\"${S3_BUCKET_NAME}.s3-website-`aws s3api get-bucket-location --bucket ${S3_BUCKET_NAME} --output text`.amazonaws.com\" \\\n        && echo ${S3_BUCKET_ENDPOINT}\n\n\n\n\u7d50\u679c(\u4f8b)\n      example-handson-20151008.s3-website-ap-northeast-1.amazonaws.com\n\n\n\n\u30b3\u30de\u30f3\u30c9\nHOST_DEF=\"${S3_BUCKET_ENDPOINT}\" \\\n  && echo ${HOST_DEF}\n\n\n\n0.4. Twilio\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u8a2d\u5b9a\nTwilio\u306e\u300c\u306f\u3058\u3081\u3088\u3046\u300d\u753b\u9762\u304b\u3089\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u5909\u6570\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\nACCOUNT SID\nAUTH TOKEN\n\u96fb\u8a71\u756a\u53f7\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTWILIO_ACCOUNT_SID='ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTWILIO_AUTH_TOKEN='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTEL_TWILIO_ORIGIN=<Twilio\u3067\u53d6\u5f97\u3057\u305f\u96fb\u8a71\u756a\u53f7>\n\n\n\n0.5. \u30b3\u30fc\u30eb\u5148\u96fb\u8a71\u756a\u53f7\u306e\u6307\u5b9a\nTwilio\u304b\u3089\u306e\u901a\u77e5\u3092\u53d7\u4fe1\u3057\u305f\u3044\u96fb\u8a71(\u643a\u5e2f\u306a\u3069)\u306e\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTEL_DEST_ORIGIN=<\u5b9b\u5148\u306e\u96fb\u8a71\u756a\u53f7>\n\n\n\u9593\u9055\u3044\u96fb\u8a71\u3092\u3057\u306a\u3044\u3088\u3046\u306b\u614e\u91cd\u306b\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n1. \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n1.1. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nDIR_TWILIO_APP=\"${HOME}/app/twilio-s3-app\" \\\n  && echo ${DIR_TWILIO_APP}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nmkdir -p ${DIR_TWILIO_APP}\n\n\n\n1.2. composer\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30b3\u30de\u30f3\u30c9\ncd ${DIR_TWILIO_APP} \\\n        && mkdir bin \\\n        && curl -sS https://getcomposer.org/installer | \\\n          php -- --install-dir=bin --filename=composer\n\n\n\n\u7d50\u679c(\u4f8b)\n      #!/usr/bin/env php\n      All settings correct for using Composer\n      Downloading...\n\n      Composer successfully installed to: /Users/taro/app/twilio-php/composer.phar\n      Use it: php bin/composer\n\n\n\n1.3. Twilio PHP SDK\u306e\u5c0e\u5165\n\u53c2\u8003: https://jp.twilio.com/docs/php/install\n\n\u30b3\u30de\u30f3\u30c9\ncd ${DIR_TWILIO_APP} \\\n        && ./bin/composer require twilio/sdk\n\n\n\n\u7d50\u679c(\u4f8b)\n      Using version ^4.2 for twilio/sdk\n      ./composer.json has been created\n      Loading composer repositories with package information\n      Updating dependencies (including require-dev)\n        - Installing twilio/sdk (4.2.1)\n          Downloading: 100%\n\n      Writing lock file\n      Generating autoload files\n\n\n\n\u30b3\u30de\u30f3\u30c9\nls ${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php > /dev/null 2>&1 \\\n        && echo $?\n\n\n\n\u7d50\u679c(\u4f8b\n0\n\n\nTwilio PHP\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f4d\u7f6e\u3092\u5909\u6570\u306b\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_LIB_TWILIO=\"${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php\"\n\n\n\n1.4. \u9001\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4f5c\u6210\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nDIR_TWILIO_XML=\"${DIR_TWILIO_APP}/config\" \\\n  && echo ${DIR_TWILIO_XML}\n\n\n\n\u30b3\u30de\u30f3\u30c9\nmkdir -p ${DIR_TWILIO_XML} \\\n  && cd ${DIR_TWILIO_XML}\n\n\n\n\u5909\u6570\u306e\u6307\u5b9a\nFILE_TWILIO_XML='say.xml'\nMSG_TWILIO='\u30c6\u30ad\u30b9\u30c8\u3092\u97f3\u58f0\u306b\u5909\u63db\u3057\u307e\u3059\u3002'\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_TWILIO_XML}\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response>\n   <Say language=\"ja-jp\">${MSG_TWILIO}</Say>\n</Response>\nEOF\n\ncat ${FILE_TWILIO_XML}\n\n\nXML\u3092\u4f5c\u6210\u3057\u305f\u3068\u304d\u306f\u3001\u306a\u308b\u3079\u304fxmllint\u3067\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\nxmllint ${FILE_TWILIO_XML} --noout\n\n\n\u4f55\u3082\u8868\u793a\u3055\u308c\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\n1.5. \u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306eS3\u3078\u306e\u8ee2\u9001\n\n\u30b3\u30de\u30f3\u30c9\naws s3 sync . s3://${S3_BUCKET_NAME}/xml/ \\\n        && aws s3 ls ${S3_BUCKET_NAME}/xml/\n\n\n\n\u7d50\u679c(\u4f8b)\nupload: ./say.xml to s3://example-handson-20151008/xml/say.xml\n2015-10-08 21:34:26        136 say.xml\n\n\n\n\u30b3\u30de\u30f3\u30c9\necho \"http://${S3_BUCKET_ENDPOINT}/xml/${FILE_TWILIO_XML}\"\n\n\n\n1.6. \u9001\u4fe1\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\ncd ${DIR_TWILIO_APP}\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_PHP='say.php'\nURL_DEF=\"http://${HOST_DEF}/xml/say.xml\"\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTEL_DEST=$( \\\n  echo ${TEL_DEST_ORIGIN} |\\\n  sed 's/^0/81/') \\\n  && echo ${TEL_DEST}\n\n\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nTEL_TWILIO=$( \\\n  echo ${TEL_TWILIO_ORIGIN} |\\\n  sed 's/^0/81/') \\\n  && echo ${TEL_TWILIO}\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        FILE_PHP:           ${FILE_PHP}\n        FILE_LIB_TWILIO:    ${FILE_LIB_TWILIO}\n        TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID}\n        TWILIO_AUTH_TOKEN:  ${TWILIO_AUTH_TOKEN}\n        TEL_TWILIO:         ${TEL_TWILIO}\n        TEL_DEST:           ${TEL_DEST}\n        URL_DEF:            ${URL_DEF}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat << EOF > ${FILE_PHP}\n<?php\n\nrequire( '${FILE_LIB_TWILIO}' );\n\n\\$account_sid = '${TWILIO_ACCOUNT_SID}';\n\\$auth_token  = '${TWILIO_AUTH_TOKEN}';\n\n\\$client = new Services_Twilio( \n    \\$account_sid, \n    \\$auth_token\n);\n\n\\$call = \\$client->account->calls->create(\n    '+${TEL_TWILIO}',\n    '+${TEL_DEST}',\n    '${URL_DEF}',\n    array(\"Method\" => \"GET\")\n);\necho \\$call->sid;\nEOF\n\ncat ${FILE_PHP}\n\n\n\n2. \u96fb\u8a71\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u767a\u4fe1\n${TEL_DEST}\u5b9b\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u96fb\u8a71\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nphp ${FILE_PHP}\n\n\n\n\u5b8c\u4e86\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883+PHP\u3067\u3001Twilio\u304b\u3089\u643a\u5e2f\u96fb\u8a71\u306a\u3069\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f\u3001S3\u3092\u5229\u7528\u3057\u3066\u3001\u65e5\u672c\u8a9e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u307f\u307e\u3059\u3002\n\n\n* \u53c2\u8003\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1ahttps://jp.twilio.com/docs/api/twiml/say\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n\n## Twilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\n* Twilio\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4fdd\u6709\u3057\u3066\u3044\u308b\u3053\u3068\u3002\n  * Twilio\u306e\u96fb\u8a71\u756a\u53f7\n  * Twilio\u306e\u8a8d\u8a3c\u60c5\u5831 (ACCOUNT SID / AUTH TOKEN)\n\n\n## Twilio+PHP\u74b0\u5883\n\n* PHP (5.4\u4ee5\u4e0a\u3092\u60f3\u5b9a)\n* Twilio PHP SDK\n\n(\u53c2\u8003) Twilio\u3067\u96fb\u8a71\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b (\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883: Twilio PHP SDK): http://qiita.com/tcsh/items/d0449909f20916fff159\n\n\n## S3\u3078\u306e\u6a29\u9650\n\nS3\u30d0\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eread/write\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\n## AWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.8.11\n* AWS CLI 1.7.40\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\naws-cli/1.8.11 Python/2.7.5 Darwin/13.4.0\n```\n\n\n\n# 0. \u4e8b\u524d\u6e96\u5099\n\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n\n## 0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b):\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile        s3Full-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\nprofile\u304c '<not set>' \u3068\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nexport AWS_DEFAULT_PROFILE=<IAM\u30e6\u30fc\u30b6\u540d>\n```\n\n\n## 0.3. \u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u306e\u6307\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nORG=<\u7d44\u7e54\u540d>\nS3_BUCKET_NAME=\"${ORG}-handson-`date +%Y%m%d`\"\n\necho ${S3_BUCKET_NAME}\n```\n\n\u307e\u3060\u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n* \u30cf\u30a4\u30ec\u30d9\u30ebS3\u30b3\u30de\u30f3\u30c9\u3067\u9759\u7684Web\u30db\u30b9\u30c6\u30a3\u30f3\u30b0: http://qiita.com/tcsh/items/70694da357c1738c6bf8\n\n\u307e\u305f\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u95b2\u89a7\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3082\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n* \u30b3\u30f3\u30c6\u30f3\u30c4\u7528\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a (\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7): http://qiita.com/tcsh/items/bcf93244b675faecd6c4#6-\u30b3\u30f3\u30c6\u30f3\u30c4\u7528\u30d0\u30b1\u30c3\u30c8\u306e\u8a2d\u5b9a-\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\n\n\u30d5\u30a1\u30a4\u30eb\u516c\u958b\u7528S3\u30d0\u30b1\u30c3\u30c8\u306eWeb\u30db\u30b9\u30c6\u30a3\u30f3\u30b0endpoint\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nS3_BUCKET_ENDPOINT=\"${S3_BUCKET_NAME}.s3-website-`aws s3api get-bucket-location --bucket ${S3_BUCKET_NAME} --output text`.amazonaws.com\" \\\n        && echo ${S3_BUCKET_ENDPOINT}\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      example-handson-20151008.s3-website-ap-northeast-1.amazonaws.com\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nHOST_DEF=\"${S3_BUCKET_ENDPOINT}\" \\\n  && echo ${HOST_DEF}\n```\n\n\n## 0.4. Twilio\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u8a2d\u5b9a\n\nTwilio\u306e\u300c\u306f\u3058\u3081\u3088\u3046\u300d\u753b\u9762\u304b\u3089\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u5909\u6570\u306b\u683c\u7d0d\u3057\u307e\u3059\u3002\n\n* ACCOUNT SID\n\n* AUTH TOKEN\n\n* \u96fb\u8a71\u756a\u53f7\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTWILIO_ACCOUNT_SID='ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTWILIO_AUTH_TOKEN='xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'\nTEL_TWILIO_ORIGIN=<Twilio\u3067\u53d6\u5f97\u3057\u305f\u96fb\u8a71\u756a\u53f7>\n```\n\n## 0.5. \u30b3\u30fc\u30eb\u5148\u96fb\u8a71\u756a\u53f7\u306e\u6307\u5b9a\n\nTwilio\u304b\u3089\u306e\u901a\u77e5\u3092\u53d7\u4fe1\u3057\u305f\u3044\u96fb\u8a71(\u643a\u5e2f\u306a\u3069)\u306e\u756a\u53f7\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTEL_DEST_ORIGIN=<\u5b9b\u5148\u306e\u96fb\u8a71\u756a\u53f7>\n```\n\n\u9593\u9055\u3044\u96fb\u8a71\u3092\u3057\u306a\u3044\u3088\u3046\u306b\u614e\u91cd\u306b\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n# 1. \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n## 1.1. \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nDIR_TWILIO_APP=\"${HOME}/app/twilio-s3-app\" \\\n  && echo ${DIR_TWILIO_APP}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nmkdir -p ${DIR_TWILIO_APP}\n```\n\n\n\n## 1.2. composer\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncd ${DIR_TWILIO_APP} \\\n        && mkdir bin \\\n        && curl -sS https://getcomposer.org/installer | \\\n          php -- --install-dir=bin --filename=composer\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      #!/usr/bin/env php\n      All settings correct for using Composer\n      Downloading...\n\n      Composer successfully installed to: /Users/taro/app/twilio-php/composer.phar\n      Use it: php bin/composer\n```\n\n\n## 1.3. Twilio PHP SDK\u306e\u5c0e\u5165\n\n\u53c2\u8003: https://jp.twilio.com/docs/php/install\n\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncd ${DIR_TWILIO_APP} \\\n        && ./bin/composer require twilio/sdk\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      Using version ^4.2 for twilio/sdk\n      ./composer.json has been created\n      Loading composer repositories with package information\n      Updating dependencies (including require-dev)\n        - Installing twilio/sdk (4.2.1)\n          Downloading: 100%\n\n      Writing lock file\n      Generating autoload files\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\nls ${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php > /dev/null 2>&1 \\\n        && echo $?\n```\n\n```text:\u7d50\u679c(\u4f8b:\n0\n```\n\nTwilio PHP\u30e9\u30a4\u30d6\u30e9\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u4f4d\u7f6e\u3092\u5909\u6570\u306b\u53d6\u308a\u8fbc\u307f\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_LIB_TWILIO=\"${DIR_TWILIO_APP}/vendor/twilio/sdk/Services/Twilio.php\"\n```\n\n\n## 1.4. \u9001\u4fe1\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u4f5c\u6210\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nDIR_TWILIO_XML=\"${DIR_TWILIO_APP}/config\" \\\n  && echo ${DIR_TWILIO_XML}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nmkdir -p ${DIR_TWILIO_XML} \\\n  && cd ${DIR_TWILIO_XML}\n```\n\n```bash:\u5909\u6570\u306e\u6307\u5b9a:\nFILE_TWILIO_XML='say.xml'\nMSG_TWILIO='\u30c6\u30ad\u30b9\u30c8\u3092\u97f3\u58f0\u306b\u5909\u63db\u3057\u307e\u3059\u3002'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_TWILIO_XML}\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<Response>\n   <Say language=\"ja-jp\">${MSG_TWILIO}</Say>\n</Response>\nEOF\n\ncat ${FILE_TWILIO_XML}\n```\n\nXML\u3092\u4f5c\u6210\u3057\u305f\u3068\u304d\u306f\u3001\u306a\u308b\u3079\u304fxmllint\u3067\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nxmllint ${FILE_TWILIO_XML} --noout\n```\n\n\u4f55\u3082\u8868\u793a\u3055\u308c\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\n\n\n## 1.5. \u30e1\u30c3\u30bb\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306eS3\u3078\u306e\u8ee2\u9001\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws s3 sync . s3://${S3_BUCKET_NAME}/xml/ \\\n        && aws s3 ls ${S3_BUCKET_NAME}/xml/\n```\n\n```text:\u7d50\u679c(\u4f8b):\nupload: ./say.xml to s3://example-handson-20151008/xml/say.xml\n2015-10-08 21:34:26        136 say.xml\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\necho \"http://${S3_BUCKET_ENDPOINT}/xml/${FILE_TWILIO_XML}\"\n```\n\n## 1.6. \u9001\u4fe1\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncd ${DIR_TWILIO_APP}\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_PHP='say.php'\nURL_DEF=\"http://${HOST_DEF}/xml/say.xml\"\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTEL_DEST=$( \\\n  echo ${TEL_DEST_ORIGIN} |\\\n  sed 's/^0/81/') \\\n  && echo ${TEL_DEST}\n```\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nTEL_TWILIO=$( \\\n  echo ${TEL_TWILIO_ORIGIN} |\\\n  sed 's/^0/81/') \\\n  && echo ${TEL_TWILIO}\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n        FILE_PHP:           ${FILE_PHP}\n        FILE_LIB_TWILIO:    ${FILE_LIB_TWILIO}\n        TWILIO_ACCOUNT_SID: ${TWILIO_ACCOUNT_SID}\n        TWILIO_AUTH_TOKEN:  ${TWILIO_AUTH_TOKEN}\n        TEL_TWILIO:         ${TEL_TWILIO}\n        TEL_DEST:           ${TEL_DEST}\n        URL_DEF:            ${URL_DEF}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat << EOF > ${FILE_PHP}\n<?php\n\nrequire( '${FILE_LIB_TWILIO}' );\n\n\\$account_sid = '${TWILIO_ACCOUNT_SID}';\n\\$auth_token  = '${TWILIO_AUTH_TOKEN}';\n\n\\$client = new Services_Twilio( \n    \\$account_sid, \n    \\$auth_token\n);\n\n\\$call = \\$client->account->calls->create(\n    '+${TEL_TWILIO}',\n    '+${TEL_DEST}',\n    '${URL_DEF}',\n    array(\"Method\" => \"GET\")\n);\necho \\$call->sid;\nEOF\n\ncat ${FILE_PHP}\n```\n\n\n# 2. \u96fb\u8a71\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u767a\u4fe1\n\n${TEL_DEST}\u5b9b\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u96fb\u8a71\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nphp ${FILE_PHP}\n```\n\n# \u5b8c\u4e86\n", "tags": ["twilio", "aws-cli", "S3", "PHP"]}