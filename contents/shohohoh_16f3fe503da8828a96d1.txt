{"tags": ["AWS", "aws-cli", "cli", "jq"], "context": "\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u4f7f\u3063\u305f\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u5f15\u7528\u3057\u3066\u3044\u308b\u306e\u3067\n\u4ee5\u4e0b$\u306e\u3064\u3044\u3066\u308b\u5909\u6570\u90e8\u5206\u306f\u81ea\u5206\u7528\u306b\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\nEC2\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\naws ec2 run-instances --image-id $IMAGE_ID --security-groups $SECURITY_GROUP --instance-type $INSTANCE_TYPE --region $REGION --count 1 --key-name $KEY_NAME\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\naws ec2 start-instances --instance-ids $INSTANCE_ID --region $REGION\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u505c\u6b62\naws ec2 stop-instances --instance-ids $INSTANCE_ID --region $REGION\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u5909\u66f4\naws ec2 modify-instance-attribute --instance-id $INSTANCE_ID --region $REGION --attribute instanceType --value $NEW_INSTANCE_TYPE\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9id\u3092\u53d6\u5f97\naws ec2 run-instances --image-id $IMAGE_ID --security-groups $SECURITY_GROUP --instance-type $INSTANCE_TYPE --region $REGION --count 1 --key-name $KEY_NAME | jq -r .Instances[].InstanceId\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306epublicIP\u53d6\u5f97\naws ec2 describe-instances --instance-id $INSTANCE_ID --region $REGION | jq -r .Reservations[].Instances[].PublicIpAddress\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u3092\u8ffd\u52a0\naws ec2 create-tags --resources $INSTANCE_ID --tag Key=$TAG_NAME,Value=$TAG_VALUE --region $REGION\n\n\u30fb\u30bf\u30b0\u540d\u306b\u4e00\u81f4\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eid\u3092\u53d6\u5f97\naws ec2 describe-instances --region $REGION --filter \"Name=tag:$TAG_NAME,Values=$TAG_VALUE\" \"Name=tag:$ANOTHER_TAG_NAME,Values=$ANOTHER_TAG_VALUE\" | jq -r .Reservations[].Instances[].InstanceId\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306estate\u3092\u53d6\u5f97\naws ec2 describe-instances --instance-id $INSTANCE_ID --region $REGION | jq -r '.Reservations[].Instances[].State.Name'\n\n\u30fbstate\u304crunning\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eID\u53d6\u5f97\naws ec2 describe-instances --region $REGION --filters \"Name=instance-state-name,Values=running\" | jq '.Reservations[].Instances[].InstanceId'\n\n\u30fbElasticIP\u306e\u5272\u308a\u5f53\u3066\naws ec2 allocate-address --region $REGION\n\n\u30fbElasticIP\u306e\u5272\u308a\u5f53\u3066 & \u95a2\u9023\u4ed8\u3051\nALLOCATION_ID=$(aws ec2 allocate-address --region $REGION | jq -r .AllocationId)\naws ec2 associate-address --instance-id $INSTANCE_ID --allocation-id $ALLOCATION_ID --region $REGION\n\n\nELB\n\u30fbELB\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eID\u53d6\u5f97\naws elb describe-instance-health --load-balancer-name $ELB_NAME --region $REGION | jq -r .InstanceStates[].InstanceId\n\n\u30fbELB\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\naws elb register-instances-with-load-balancer --load-balancer-name $ELB_NAME --region $REGION --instances $INSTANCE_ID\n\n\u30fbELB\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\naws elb deregister-instances-from-load-balancer --load-balancer-name $ELB_NAME --region $REGION --instances $INSTANCE_ID\n\n\nRoute53\n\u30fb\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\uff08A\u30ec\u30b3\u30fc\u30c9\uff09\n# \u30be\u30fc\u30f3ID\u306e\u53d6\u5f97\nZONE_ID=$(aws route53 list-hosted-zones-by-name --dns-name $DOMAIN --max-items 1 | jq -r '.HostedZones[] | .Id')\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nZONE_ID=${ZONE_ID##*/}\ncat <<EOT > /tmp/recordset.json\n{\n  \"Comment\": \"create A record\",\n  \"Changes\": [\n    {\n      \"Action\": \"UPSERT\",\n      \"ResourceRecordSet\": {\n        \"Name\": \"${DOMAIN}\",\n        \"Type\": \"A\",\n        \"TTL\": 300 ,\n        \"ResourceRecords\": [\n         {\n           \"Value\": \"${IP_ADDRESS}\"\n         }\n        ]\n      }\n    }\n  ]\n}\nEOT\naws route53 change-resource-record-sets --hosted-zone-id $ZONE_ID --change-batch file:///tmp/recordset.json\nrm -rf /tmp/recordset.json\n\n\u30fb\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\uff08Alias\uff09\n# \u30be\u30fc\u30f3ID\u306e\u53d6\u5f97\nZONE_ID=$(aws route53 list-hosted-zones-by-name --dns-name $DOMAIN --max-items 1 | jq -r '.HostedZones[] | .Id')\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nZONE_ID=${ZONE_ID##*/}\ncat <<EOT > /tmp/alias_recordset.json\n{\n  \"Comment\": \"create alias A record\",\n  \"Changes\": [\n    {\n      \"Action\": \"UPSERT\",\n      \"ResourceRecordSet\": {\n        \"Name\": \"${ALIAS_DOMAIN}\",\n        \"Type\": \"A\",\n        \"AliasTarget\": {\n          \"HostedZoneId\": \"${ZONE_ID}\",\n          \"DNSName\": \"${ALIAS_TARGET}\",\n          \"EvaluateTargetHealth\": false\n        }\n      }\n    }\n  ]\n}\nEOT\naws route53 change-resource-record-sets --hosted-zone-id $ZONE_ID --change-batch file:///tmp/alias_recordset.json\nrm -rf /tmp/alias_recordset.json\n\n\n\u756a\u5916\u7de8\n\u30fb\u6307\u5b9a\u3057\u305f\u30bf\u30b0\u3092\u6301\u3064\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5168\u3066\u8d77\u52d5\u3059\u308b\u30ef\u30f3\u30e9\u30a4\u30ca\u30fc\naws ec2 describe-instances --region $REGION --filter \"Name=tag:$TAG_NAME,Values=$TAG_VALUE\" | jq -r .Reservations[].Instances[].InstanceId | xargs aws ec2 start-instances --region $REGION --instance-ids\n\n\n\u53c2\u8003\nAWS CLI\u3092\u4f7f\u3063\u3066EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\nAWS Cli\u81ea\u5206\u7528Tips\n\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u4f7f\u3063\u305f\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u5f15\u7528\u3057\u3066\u3044\u308b\u306e\u3067\n\u4ee5\u4e0b$\u306e\u3064\u3044\u3066\u308b\u5909\u6570\u90e8\u5206\u306f\u81ea\u5206\u7528\u306b\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n# EC2\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\n```\naws ec2 run-instances --image-id $IMAGE_ID --security-groups $SECURITY_GROUP --instance-type $INSTANCE_TYPE --region $REGION --count 1 --key-name $KEY_NAME\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\n```\naws ec2 start-instances --instance-ids $INSTANCE_ID --region $REGION\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u505c\u6b62\n\n```\naws ec2 stop-instances --instance-ids $INSTANCE_ID --region $REGION\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u5909\u66f4\n\n```\naws ec2 modify-instance-attribute --instance-id $INSTANCE_ID --region $REGION --attribute instanceType --value $NEW_INSTANCE_TYPE\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9id\u3092\u53d6\u5f97\n\n```\naws ec2 run-instances --image-id $IMAGE_ID --security-groups $SECURITY_GROUP --instance-type $INSTANCE_TYPE --region $REGION --count 1 --key-name $KEY_NAME | jq -r .Instances[].InstanceId\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306epublicIP\u53d6\u5f97\n\n```\naws ec2 describe-instances --instance-id $INSTANCE_ID --region $REGION | jq -r .Reservations[].Instances[].PublicIpAddress\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u3092\u8ffd\u52a0\n\n```\naws ec2 create-tags --resources $INSTANCE_ID --tag Key=$TAG_NAME,Value=$TAG_VALUE --region $REGION\n```\n\n\u30fb\u30bf\u30b0\u540d\u306b\u4e00\u81f4\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eid\u3092\u53d6\u5f97\n\n```\naws ec2 describe-instances --region $REGION --filter \"Name=tag:$TAG_NAME,Values=$TAG_VALUE\" \"Name=tag:$ANOTHER_TAG_NAME,Values=$ANOTHER_TAG_VALUE\" | jq -r .Reservations[].Instances[].InstanceId\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306estate\u3092\u53d6\u5f97\n\n```\naws ec2 describe-instances --instance-id $INSTANCE_ID --region $REGION | jq -r '.Reservations[].Instances[].State.Name'\n```\n\n\u30fbstate\u304crunning\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eID\u53d6\u5f97\n\n```\naws ec2 describe-instances --region $REGION --filters \"Name=instance-state-name,Values=running\" | jq '.Reservations[].Instances[].InstanceId'\n```\n\n\u30fbElasticIP\u306e\u5272\u308a\u5f53\u3066\n\n```\naws ec2 allocate-address --region $REGION\n```\n\n\u30fbElasticIP\u306e\u5272\u308a\u5f53\u3066 & \u95a2\u9023\u4ed8\u3051\n\n```\nALLOCATION_ID=$(aws ec2 allocate-address --region $REGION | jq -r .AllocationId)\naws ec2 associate-address --instance-id $INSTANCE_ID --allocation-id $ALLOCATION_ID --region $REGION\n```\n\n# ELB\n\u30fbELB\u306b\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eID\u53d6\u5f97\n\n```\naws elb describe-instance-health --load-balancer-name $ELB_NAME --region $REGION | jq -r .InstanceStates[].InstanceId\n```\n\n\u30fbELB\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\n\n```\naws elb register-instances-with-load-balancer --load-balancer-name $ELB_NAME --region $REGION --instances $INSTANCE_ID\n```\n\n\u30fbELB\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u524a\u9664\n\n```\naws elb deregister-instances-from-load-balancer --load-balancer-name $ELB_NAME --region $REGION --instances $INSTANCE_ID\n```\n\n# Route53\n\n\u30fb\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\uff08A\u30ec\u30b3\u30fc\u30c9\uff09\n\n```\n# \u30be\u30fc\u30f3ID\u306e\u53d6\u5f97\nZONE_ID=$(aws route53 list-hosted-zones-by-name --dns-name $DOMAIN --max-items 1 | jq -r '.HostedZones[] | .Id')\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nZONE_ID=${ZONE_ID##*/}\ncat <<EOT > /tmp/recordset.json\n{\n  \"Comment\": \"create A record\",\n  \"Changes\": [\n    {\n      \"Action\": \"UPSERT\",\n      \"ResourceRecordSet\": {\n        \"Name\": \"${DOMAIN}\",\n        \"Type\": \"A\",\n        \"TTL\": 300 ,\n        \"ResourceRecords\": [\n         {\n           \"Value\": \"${IP_ADDRESS}\"\n         }\n        ]\n      }\n    }\n  ]\n}\nEOT\naws route53 change-resource-record-sets --hosted-zone-id $ZONE_ID --change-batch file:///tmp/recordset.json\nrm -rf /tmp/recordset.json\n```\n\n\u30fb\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\uff08Alias\uff09\n\n```\n# \u30be\u30fc\u30f3ID\u306e\u53d6\u5f97\nZONE_ID=$(aws route53 list-hosted-zones-by-name --dns-name $DOMAIN --max-items 1 | jq -r '.HostedZones[] | .Id')\n# \u30be\u30fc\u30f3 ID \u304b\u3089\u4f59\u8a08\u306a\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u9664\u53bb\nZONE_ID=${ZONE_ID##*/}\ncat <<EOT > /tmp/alias_recordset.json\n{\n  \"Comment\": \"create alias A record\",\n  \"Changes\": [\n    {\n      \"Action\": \"UPSERT\",\n      \"ResourceRecordSet\": {\n        \"Name\": \"${ALIAS_DOMAIN}\",\n        \"Type\": \"A\",\n        \"AliasTarget\": {\n          \"HostedZoneId\": \"${ZONE_ID}\",\n          \"DNSName\": \"${ALIAS_TARGET}\",\n          \"EvaluateTargetHealth\": false\n        }\n      }\n    }\n  ]\n}\nEOT\naws route53 change-resource-record-sets --hosted-zone-id $ZONE_ID --change-batch file:///tmp/alias_recordset.json\nrm -rf /tmp/alias_recordset.json\n```\n\n\n## \u756a\u5916\u7de8\n\u30fb\u6307\u5b9a\u3057\u305f\u30bf\u30b0\u3092\u6301\u3064\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5168\u3066\u8d77\u52d5\u3059\u308b\u30ef\u30f3\u30e9\u30a4\u30ca\u30fc\n\n```\naws ec2 describe-instances --region $REGION --filter \"Name=tag:$TAG_NAME,Values=$TAG_VALUE\" | jq -r .Reservations[].Instances[].InstanceId | xargs aws ec2 start-instances --region $REGION --instance-ids\n```\n\n## \u53c2\u8003\n[AWS CLI\u3092\u4f7f\u3063\u3066EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b](http://qiita.com/toshiro3/items/37821bdcc50c8b6d06dc)\n[AWS Cli\u81ea\u5206\u7528Tips](http://qiita.com/takachan/items/421928dc61c51af97fb1)\n\n\n\n\n"}