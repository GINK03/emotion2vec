{"context": " More than 1 year has passed since last update.\n\n\u74b0\u5883\u69cb\u7bc9\n\n\u74b0\u5883\u69cb\u7bc9\u624b\u9806\n\n\n\u30c7\u30fc\u30bf\u3092\u6e96\u5099\n\ntweet\u53d6\u5f97\n\nhttps://github.com/Tatzyr/alltweets\n\u4ed6\u4eba\u306etweet\u306f\u30013000\u4ef6\u307e\u3067\u53d6\u308c\u308b\u307f\u305f\u3044\n\u8a71\u984c\u306ebecky_bekiko\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\n\n$ git clone https://github.com/Tatzyr/alltweets.git\n$ cd alltweets\n$ ./bin/setup\n$ ./exe/alltweets becky_bekiko --retweets --json\n$ ls alltweets_becky_bekiko.json\nalltweets_becky_bekiko.json\n\n\n\u30c7\u30fc\u30bf\u6574\u5f62\n\u6574\u5f62\u305b\u305a\u306b\u305d\u306e\u307e\u307e\u7a81\u3063\u8fbc\u307f\u305f\u304b\u3063\u305f\u304c\u3001geo_point\u304c\u914d\u5217\u3092\u53d7\u3051\u5165\u308c\u3066\u304f\u308c\u306a\u304b\u3063\u305f\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\"location\": [ -71.34, 41.12 ]\u306fOK\u305d\u3046\u306a\u306e\u3060\u304c\u3002\n\u3069\u3046\u305b\u6574\u5f62\u3059\u308b\u306a\u3089\u6271\u3044\u3084\u3059\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u306bjq\u30b3\u30de\u30f3\u30c9\u3067\u6574\u5f62\u3057\u305f\u3002\n$ cat alltweets_becky_bekiko.json | jq ' .[] |\n{\n  id:                     .id_str,\n  created_at:             .created_at,\n  text:                   .text,\n  analyze_text:           .text,\n  source:                 .source,\n  in_reply: {\n    status:               .in_reply_to_status_id_str,\n    user_id:              .in_reply_to_user_id_str,\n    screen_name:          .in_reply_to_screen_name\n  },\n  user: {\n    id:                   .user.id_str,\n    name:                 .user.name,\n    screen_name:          .user.screen_name,\n    location:             .user.location,\n    description:          .user.description,\n    url:                  .user.url,\n    followers_count:      .user.followers_count,\n    friends_count:        .user.friends_count,\n    listed_count:         .user.listed_count,\n    created_at:           .user.created_at,\n    favourites_count:     .user.favourites_count,\n    statuses_count:       .user.statuses_count,\n    lang:                 .user.lang,\n    profile_image_url:    .user.profile_image_url_https,\n    profile_banner_url:   .user.profile_banner_url\n  },\n  geo: {\n    lat:                  (.geo.coordinates[0] // 0),\n    lon:                  (.geo.coordinates[1] // 0)\n  },\n  place: {\n    id:                   .place.id,\n    url:                  .place.url,\n    place_type:           .place.place_type,\n    name:                 .place.name,\n    full_name:            .place.full_name,\n    country_code:         .place.country_code,\n    country:              .place.country\n  },\n  retweet_count:          .retweet_count,\n  favorite_count:         .favorite_count,\n  lang:                   .lang,\n  hashtags:               .entities.hashtags,\n  user_mentions:          .entities.user_mentions,\n  media:                  .entities.media,\n  retweeted_status: {\n    created_at:           .retweeted_status.created_at,\n    id:                   .retweeted_status.id_str,\n    text:                 .retweeted_status.text,\n    source:               .retweeted_status.source,\n    in_reply: {\n      status:             .retweeted_status.in_reply_to_status_id_str,\n      user_id:            .retweeted_status.in_reply_to_user_id_str,\n      screen_name:        .retweeted_status.in_reply_to_screen_name\n    },\n    user: {\n      id:                 .retweeted_status.user.id_str,\n      name:               .retweeted_status.user.name,\n      screen_name:        .retweeted_status.user.screen_name,\n      location:           .retweeted_status.user.location,\n      description:        .retweeted_status.user.description,\n      url:                .retweeted_status.user.url,\n      followers_count:    .retweeted_status.user.followers_count,\n      friends_count:      .retweeted_status.user.friends_count,\n      listed_count:       .retweeted_status.user.listed_count,\n      created_at:         .retweeted_status.user.created_at,\n      favourites_count:   .retweeted_status.user.favourites_count,\n      statuses_count:     .retweeted_status.user.statuses_count,\n      lang:               .retweeted_status.user.lang,\n      profile_image_url:  .retweeted_status.user.profile_image_url_https,\n      profile_banner_url: .retweeted_status.user.profile_banner_url\n    }\n  }\n}\n' > becky_bekiko.json \n\n\nbulk\u306b\u6574\u5f62\n\n\nbulk\u7528\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u6574\u5f62\u3059\u308b\u3002\n\u96d1\u306a\u6574\u5f62\u30d7\u30ed\u30b0\u30e9\u30e0\n\nrequire 'json'\n\nFile.open('./becky_bekiko.json', 'w') do |f|\n  open('./bulk_becky_bekiko.json').each do |line|\n    json=JSON.load(line)\n    index = { \"index\" => { \"_index\" => \"twitter\", \"_type\" => \"tweet\", \"_id\" => json[\"id\"]} }\n    f.puts index.to_json\n    f.puts line\n  end\nend\n\n$ ruby to_bulk.rb\n$ ls bulk_becky_bekiko.json\nbulk_becky_bekiko.json\n\n\n\nstream2es\u3092\u4f7f\u3048\u3070\u6574\u5f62\u305b\u305a\u306b\u3044\u3051\u308b\u3068\u3042\u3063\u305f\u304c\u3001_id\u306emappings\u3067\"reason\": \"Failed to parse mapping [tweet]: _id is not configurable\"\u3068\u6012\u3089\u308c\u305f\u306e\u3067\u3042\u304d\u3089\u3081\u305f\u3002\n\n\nIndex\u3068Mapping\u306e\u4f5c\u6210\n\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3001\u3053\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u305f\n\n$ curl -XPOST 'http://192.168.33.10:9200/twitter' -d '\n{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"ngram_analyzer\": {\n          \"type\": \"custom\",\n          \"char_filter\": [\"html_strip\"],\n          \"tokenizer\": \"ngram_tokenizer\",\n          \"filter\": [\"cjk_width\", \"lowercase\"]\n        },\n        \"facet_analyzer\": {\n          \"type\": \"custom\",\n          \"char_filter\": [\"html_strip\"],\n          \"tokenizer\": \"keyword\",\n          \"filter\": [\"cjk_width\", \"lowercase\"]\n        }\n      },\n      \"tokenizer\": {\n        \"ngram_tokenizer\": {\n          \"type\": \"nGram\",\n          \"min_gram\": 2,\n          \"max_gram\": 3,\n          \"token_chars\": [\"letter\", \"digit\"]\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"tweet\": {\n      \"properties\": {\n        \"created_at\": {\n          \"type\": \"date\",\n          \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n        },\n        \"text\": {\n          \"type\": \"string\",\n          \"index\": \"analyzed\",\n          \"analyzer\": \"ngram_analyzer\"\n        },\n        \"analyze_text\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        },\n        \"source\": {\n          \"type\": \"string\",\n          \"index\": \"analyzed\",\n          \"analyzer\": \"facet_analyzer\"\n        },\n        \"in_reply\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"status\": {\n              \"type\": \"long\"\n            },\n            \"user_id\": {\n              \"type\": \"long\"\n            },\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            }\n          }\n        },\n        \"user\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"location\": {\n              \"type\": \"string\"\n            },\n            \"description\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"url\": {\n              \"type\": \"string\"\n            },\n            \"followers_count\": {\n              \"type\": \"long\"\n            },\n            \"friends_count\": {\n              \"type\": \"long\"\n            },\n            \"listed_count\": {\n              \"type\": \"long\"\n            },\n            \"created_at\": {\n              \"type\": \"date\",\n              \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n            },\n            \"favourites_count\": {\n              \"type\": \"long\"\n            },\n            \"statuses_count\": {\n              \"type\": \"long\"\n            },\n            \"lang\": {\n              \"type\": \"string\"\n            },\n            \"profile_image_url\": {\n              \"type\": \"string\"\n            },\n            \"profile_banner_url\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"geo\": {\n          \"type\": \"geo_point\",\n          \"ignore_malformed\": true\n        },\n        \"place\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"id\": {\n              \"type\": \"string\"\n            },\n            \"url\": {\n              \"type\": \"string\"\n            },\n            \"place_type\": {\n              \"type\": \"string\"\n            },\n            \"name\": {\n              \"type\": \"string\"\n            },\n            \"full_name\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"country_code\": {\n              \"type\": \"string\"\n            },\n            \"country\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"retweet_count\": {\n          \"type\": \"long\"\n        },\n        \"favorite_count\": {\n          \"type\": \"long\"\n        },\n        \"lang\": {\n          \"type\": \"string\"\n        },\n        \"hashtags\": {\n          \"properties\": {\n            \"text\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"facet_analyzer\"\n            }\n          }\n        },\n        \"user_mentions\": {\n          \"properties\": {\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"id\": {\n              \"type\": \"long\"\n            }\n          }\n        },\n        \"media\": {\n          \"properties\": {\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"media_url_https\": {\n              \"type\": \"string\"\n            },\n            \"expanded_url\": {\n              \"type\": \"string\"\n            },\n            \"type\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"retweeted_status\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"created_at\": {\n              \"type\": \"date\",\n              \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n            },\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"text\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"source\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"facet_analyzer\"\n            },\n            \"in_reply\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"status\": {\n                  \"type\": \"long\"\n                },\n                \"user_id\": {\n                  \"type\": \"long\"\n                },\n                \"screen_name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                }\n              }\n            },\n            \"user\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"id\": {\n                  \"type\": \"long\"\n                },\n                \"name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                },\n                \"screen_name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                },\n                \"location\": {\n                  \"type\": \"string\"\n                },\n                \"description\": {\n                  \"type\": \"string\",\n                  \"index\": \"analyzed\",\n                  \"analyzer\": \"ngram_analyzer\"\n                },\n                \"url\": {\n                  \"type\": \"string\"\n                },\n                \"followers_count\": {\n                  \"type\": \"long\"\n                },\n                \"friends_count\": {\n                  \"type\": \"long\"\n                },\n                \"listed_count\": {\n                  \"type\": \"long\"\n                },\n                \"created_at\": {\n                  \"type\": \"date\",\n                  \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n                },\n                \"favourites_count\": {\n                  \"type\": \"long\"\n                },\n                \"statuses_count\": {\n                  \"type\": \"long\"\n                },\n                \"lang\": {\n                  \"type\": \"string\"\n                },\n                \"profile_image_url\": {\n                  \"type\": \"string\"\n                },\n                \"profile_banner_url\": {\n                  \"type\": \"string\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n'\n\n\n\u30c7\u30fc\u30bf\u306e\u767b\u9332\n$ curl -s -XPOST 192.168.33.10:9200/_bulk --data-binary \"@bulk_becky_bekiko.json\"; echo\n\n\nkibana\n\n\u8a2d\u5b9a\n\n\u300cIndex name or patter\u300d\u306b\u300ctwitter\u300d\n\u300cTime-field name\u300d\u306b\u300ccreated_at\u300d\n\n\n\nDiscover\u30da\u30fc\u30b8\n\n\u300cDiscover\u300d\u3092\u9078\u629e\n\n\n\nGeo\n\n\u300cVisualize\u300d\u21d2\u300cTile map\u300d\ngeo_point\u306bnull(\"ignore_malformed\": true)\u306f\u53d7\u3051\u5165\u308c\u3066\u3082\u3089\u3048\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u9069\u5f53\u306a\u521d\u671f\u5024\u306egeo\u3067\u3059\n\n\n\n\u5186\u30b0\u30e9\u30d5\n\n\u300cVisualize\u300d\u21d2\u300cPie chart\u300d\n\n\n\u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u6570\n\nField\u300chashtags.text\u300d\n\n\n\n\u30e1\u30f3\u30b7\u30e7\u30f3\u3057\u305f\u30e6\u30fc\u30b6\u306e\u591a\u3044\u6570\n\nField\u300cin_reply.screen_name\u300d\n\n\n\nRT\u3057\u305f\u30e6\u30fc\u30b6\u306e\u591a\u3044\u6570\n\nField\u300cretweeted_status.user.name\u300d\n\n\n\n\u7e26\u68d2\u30b0\u30e9\u30d5\n\n\u300cVisualize\u300d\u21d2\u300cVertical bar chart\u300d\n\n\nFav\u6570\u306e\u591a\u3044tweet\n\n\n\u30b2\u30b9\u306e\u6975\u307f\u4e59\u5973\u3002\u3055\u3093\u306e\u65b0\u8b5c\u3092\u8074\u304f\u6642\u306e\u3042\u306e\u30c9\u30ad\u30c9\u30ad\u611f\u306f\u306a\u3093\u3066\u3044\u3046\u3093\u3060\u308d\u3046\u3002\n\n\u3082\u3046\u3001\u604b\u306e\u30c9\u30ad\u30c9\u30ad\u3068\u540c\u3058\u306a\u3093\u3067\u3059\u3088\u306d\u3002\n\n\u80f8\u304c\u304d\u3085\u30fc\u3093\u3063\u3066\u3002\n\n\u305d\u306e\u3042\u3068\u306b\n\n\u3059\u304d\u3059\u304d\u3059\u304d\u3043\u30fc\uff01\u3063\u3066\u3002\n\n\u4eca\u5e74\u3001\u30e9\u30a4\u30d6\u3092\u62dd\u898b\u3059\u308b\u306e\u304c\u76ee\u6a19\u3067\u3059\u3002\n\n\u306f\u3041\u3002\u3002\u3002\u5e78\u305b\u306a\u305f\u3081\u3044\u304d\u3002\u3002\u3002\u2014 \u30d9\u30c3\u30ad\u30fc\u266a\u266f (@Becky_bekiko) June 26, 2015\n\n\n\u307e\u3068\u3081\n\n\u30c7\u30fc\u30bf\u6574\u5f62\u3068mappings\u3092\u6574\u7406\u3059\u308b\u306e\u304c\u5927\u5909\u3060\u3063\u305f\n\u65e5\u672c\u8a9e\u691c\u7d22\u306e\u7cbe\u5ea6\u304c\u9069\u5f53\u306a\u306e\u3067\u3001analysis\u306e\u7406\u89e3\u6df1\u3081\u305f\u3044\n\n# \u74b0\u5883\u69cb\u7bc9\n\n+ [\u74b0\u5883\u69cb\u7bc9\u624b\u9806](http://qiita.com/takaheraw@github/items/a5a36916ed2e87d54d1a)\n\n# \u30c7\u30fc\u30bf\u3092\u6e96\u5099\n\n## tweet\u53d6\u5f97\n\n+ https://github.com/Tatzyr/alltweets\n+ \u4ed6\u4eba\u306etweet\u306f\u30013000\u4ef6\u307e\u3067\u53d6\u308c\u308b\u307f\u305f\u3044\n+ \u8a71\u984c\u306e[becky_bekiko](https://twitter.com/becky_bekiko)\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\n\n```\n$ git clone https://github.com/Tatzyr/alltweets.git\n$ cd alltweets\n$ ./bin/setup\n$ ./exe/alltweets becky_bekiko --retweets --json\n$ ls alltweets_becky_bekiko.json\nalltweets_becky_bekiko.json\n```\n\n## \u30c7\u30fc\u30bf\u6574\u5f62\n\n\u6574\u5f62\u305b\u305a\u306b\u305d\u306e\u307e\u307e\u7a81\u3063\u8fbc\u307f\u305f\u304b\u3063\u305f\u304c\u3001geo_point\u304c\u914d\u5217\u3092\u53d7\u3051\u5165\u308c\u3066\u304f\u308c\u306a\u304b\u3063\u305f\u3002[\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://www.elastic.co/guide/en/elasticsearch/reference/2.x/geo-point.html#geo-point)\u306b\u306f```\"location\": [ -71.34, 41.12 ]```\u306fOK\u305d\u3046\u306a\u306e\u3060\u304c\u3002\n\u3069\u3046\u305b\u6574\u5f62\u3059\u308b\u306a\u3089\u6271\u3044\u3084\u3059\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u306bjq\u30b3\u30de\u30f3\u30c9\u3067\u6574\u5f62\u3057\u305f\u3002\n\n```\n$ cat alltweets_becky_bekiko.json | jq ' .[] |\n{\n  id:                     .id_str,\n  created_at:             .created_at,\n  text:                   .text,\n  analyze_text:           .text,\n  source:                 .source,\n  in_reply: {\n    status:               .in_reply_to_status_id_str,\n    user_id:              .in_reply_to_user_id_str,\n    screen_name:          .in_reply_to_screen_name\n  },\n  user: {\n    id:                   .user.id_str,\n    name:                 .user.name,\n    screen_name:          .user.screen_name,\n    location:             .user.location,\n    description:          .user.description,\n    url:                  .user.url,\n    followers_count:      .user.followers_count,\n    friends_count:        .user.friends_count,\n    listed_count:         .user.listed_count,\n    created_at:           .user.created_at,\n    favourites_count:     .user.favourites_count,\n    statuses_count:       .user.statuses_count,\n    lang:                 .user.lang,\n    profile_image_url:    .user.profile_image_url_https,\n    profile_banner_url:   .user.profile_banner_url\n  },\n  geo: {\n    lat:                  (.geo.coordinates[0] // 0),\n    lon:                  (.geo.coordinates[1] // 0)\n  },\n  place: {\n    id:                   .place.id,\n    url:                  .place.url,\n    place_type:           .place.place_type,\n    name:                 .place.name,\n    full_name:            .place.full_name,\n    country_code:         .place.country_code,\n    country:              .place.country\n  },\n  retweet_count:          .retweet_count,\n  favorite_count:         .favorite_count,\n  lang:                   .lang,\n  hashtags:               .entities.hashtags,\n  user_mentions:          .entities.user_mentions,\n  media:                  .entities.media,\n  retweeted_status: {\n    created_at:           .retweeted_status.created_at,\n    id:                   .retweeted_status.id_str,\n    text:                 .retweeted_status.text,\n    source:               .retweeted_status.source,\n    in_reply: {\n      status:             .retweeted_status.in_reply_to_status_id_str,\n      user_id:            .retweeted_status.in_reply_to_user_id_str,\n      screen_name:        .retweeted_status.in_reply_to_screen_name\n    },\n    user: {\n      id:                 .retweeted_status.user.id_str,\n      name:               .retweeted_status.user.name,\n      screen_name:        .retweeted_status.user.screen_name,\n      location:           .retweeted_status.user.location,\n      description:        .retweeted_status.user.description,\n      url:                .retweeted_status.user.url,\n      followers_count:    .retweeted_status.user.followers_count,\n      friends_count:      .retweeted_status.user.friends_count,\n      listed_count:       .retweeted_status.user.listed_count,\n      created_at:         .retweeted_status.user.created_at,\n      favourites_count:   .retweeted_status.user.favourites_count,\n      statuses_count:     .retweeted_status.user.statuses_count,\n      lang:               .retweeted_status.user.lang,\n      profile_image_url:  .retweeted_status.user.profile_image_url_https,\n      profile_banner_url: .retweeted_status.user.profile_banner_url\n    }\n  }\n}\n' > becky_bekiko.json \n```\n\n## bulk\u306b\u6574\u5f62\n\n+ [bulk\u7528\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8](https://www.elastic.co/guide/en/elasticsearch/reference/2.x/docs-bulk.html#docs-bulk)\u306b\u6574\u5f62\u3059\u308b\u3002\n+ \u96d1\u306a\u6574\u5f62\u30d7\u30ed\u30b0\u30e9\u30e0\n\n```rb\nrequire 'json'\n\nFile.open('./becky_bekiko.json', 'w') do |f|\n  open('./bulk_becky_bekiko.json').each do |line|\n    json=JSON.load(line)\n    index = { \"index\" => { \"_index\" => \"twitter\", \"_type\" => \"tweet\", \"_id\" => json[\"id\"]} }\n    f.puts index.to_json\n    f.puts line\n  end\nend\n```\n```\n$ ruby to_bulk.rb\n$ ls bulk_becky_bekiko.json\nbulk_becky_bekiko.json\n```\n\n+ [stream2es](http://blog.johtani.info/blog/2014/04/24/usage-stream2es/)\u3092\u4f7f\u3048\u3070\u6574\u5f62\u305b\u305a\u306b\u3044\u3051\u308b\u3068\u3042\u3063\u305f\u304c\u3001_id\u306emappings\u3067```\"reason\": \"Failed to parse mapping [tweet]: _id is not configurable\"```\u3068\u6012\u3089\u308c\u305f\u306e\u3067\u3042\u304d\u3089\u3081\u305f\u3002\n\n# Index\u3068Mapping\u306e\u4f5c\u6210\n\n+ [\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](https://www.elastic.co/guide/en/elasticsearch/reference/2.x/mapping.html)\u3001[\u3053\u306e\u30b5\u30a4\u30c8](https://medium.com/hello-elasticsearch/elasticsearch-kibana-6ad80550939f)\u3092\u53c2\u8003\u306b\u3057\u305f\n\n```\n$ curl -XPOST 'http://192.168.33.10:9200/twitter' -d '\n{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"ngram_analyzer\": {\n          \"type\": \"custom\",\n          \"char_filter\": [\"html_strip\"],\n          \"tokenizer\": \"ngram_tokenizer\",\n          \"filter\": [\"cjk_width\", \"lowercase\"]\n        },\n        \"facet_analyzer\": {\n          \"type\": \"custom\",\n          \"char_filter\": [\"html_strip\"],\n          \"tokenizer\": \"keyword\",\n          \"filter\": [\"cjk_width\", \"lowercase\"]\n        }\n      },\n      \"tokenizer\": {\n        \"ngram_tokenizer\": {\n          \"type\": \"nGram\",\n          \"min_gram\": 2,\n          \"max_gram\": 3,\n          \"token_chars\": [\"letter\", \"digit\"]\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"tweet\": {\n      \"properties\": {\n        \"created_at\": {\n          \"type\": \"date\",\n          \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n        },\n        \"text\": {\n          \"type\": \"string\",\n          \"index\": \"analyzed\",\n          \"analyzer\": \"ngram_analyzer\"\n        },\n        \"analyze_text\": {\n          \"type\": \"string\",\n          \"index\": \"not_analyzed\"\n        },\n        \"source\": {\n          \"type\": \"string\",\n          \"index\": \"analyzed\",\n          \"analyzer\": \"facet_analyzer\"\n        },\n        \"in_reply\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"status\": {\n              \"type\": \"long\"\n            },\n            \"user_id\": {\n              \"type\": \"long\"\n            },\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            }\n          }\n        },\n        \"user\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"location\": {\n              \"type\": \"string\"\n            },\n            \"description\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"url\": {\n              \"type\": \"string\"\n            },\n            \"followers_count\": {\n              \"type\": \"long\"\n            },\n            \"friends_count\": {\n              \"type\": \"long\"\n            },\n            \"listed_count\": {\n              \"type\": \"long\"\n            },\n            \"created_at\": {\n              \"type\": \"date\",\n              \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n            },\n            \"favourites_count\": {\n              \"type\": \"long\"\n            },\n            \"statuses_count\": {\n              \"type\": \"long\"\n            },\n            \"lang\": {\n              \"type\": \"string\"\n            },\n            \"profile_image_url\": {\n              \"type\": \"string\"\n            },\n            \"profile_banner_url\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"geo\": {\n          \"type\": \"geo_point\",\n          \"ignore_malformed\": true\n        },\n        \"place\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"id\": {\n              \"type\": \"string\"\n            },\n            \"url\": {\n              \"type\": \"string\"\n            },\n            \"place_type\": {\n              \"type\": \"string\"\n            },\n            \"name\": {\n              \"type\": \"string\"\n            },\n            \"full_name\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"country_code\": {\n              \"type\": \"string\"\n            },\n            \"country\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"retweet_count\": {\n          \"type\": \"long\"\n        },\n        \"favorite_count\": {\n          \"type\": \"long\"\n        },\n        \"lang\": {\n          \"type\": \"string\"\n        },\n        \"hashtags\": {\n          \"properties\": {\n            \"text\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"facet_analyzer\"\n            }\n          }\n        },\n        \"user_mentions\": {\n          \"properties\": {\n            \"screen_name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"name\": {\n              \"type\": \"string\",\n              \"index\": \"not_analyzed\"\n            },\n            \"id\": {\n              \"type\": \"long\"\n            }\n          }\n        },\n        \"media\": {\n          \"properties\": {\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"media_url_https\": {\n              \"type\": \"string\"\n            },\n            \"expanded_url\": {\n              \"type\": \"string\"\n            },\n            \"type\": {\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"retweeted_status\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"created_at\": {\n              \"type\": \"date\",\n              \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n            },\n            \"id\": {\n              \"type\": \"long\"\n            },\n            \"text\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"ngram_analyzer\"\n            },\n            \"source\": {\n              \"type\": \"string\",\n              \"index\": \"analyzed\",\n              \"analyzer\": \"facet_analyzer\"\n            },\n            \"in_reply\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"status\": {\n                  \"type\": \"long\"\n                },\n                \"user_id\": {\n                  \"type\": \"long\"\n                },\n                \"screen_name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                }\n              }\n            },\n            \"user\": {\n              \"type\": \"object\",\n              \"properties\": {\n                \"id\": {\n                  \"type\": \"long\"\n                },\n                \"name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                },\n                \"screen_name\": {\n                  \"type\": \"string\",\n                  \"index\": \"not_analyzed\"\n                },\n                \"location\": {\n                  \"type\": \"string\"\n                },\n                \"description\": {\n                  \"type\": \"string\",\n                  \"index\": \"analyzed\",\n                  \"analyzer\": \"ngram_analyzer\"\n                },\n                \"url\": {\n                  \"type\": \"string\"\n                },\n                \"followers_count\": {\n                  \"type\": \"long\"\n                },\n                \"friends_count\": {\n                  \"type\": \"long\"\n                },\n                \"listed_count\": {\n                  \"type\": \"long\"\n                },\n                \"created_at\": {\n                  \"type\": \"date\",\n                  \"format\" : \"EE MMM d HH:mm:ss Z yyyy\"\n                },\n                \"favourites_count\": {\n                  \"type\": \"long\"\n                },\n                \"statuses_count\": {\n                  \"type\": \"long\"\n                },\n                \"lang\": {\n                  \"type\": \"string\"\n                },\n                \"profile_image_url\": {\n                  \"type\": \"string\"\n                },\n                \"profile_banner_url\": {\n                  \"type\": \"string\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n'\n```\n\n# \u30c7\u30fc\u30bf\u306e\u767b\u9332\n\n```\n$ curl -s -XPOST 192.168.33.10:9200/_bulk --data-binary \"@bulk_becky_bekiko.json\"; echo\n```\n\n# kibana\n\n## \u8a2d\u5b9a\n\n+ \u300cIndex name or patter\u300d\u306b\u300ctwitter\u300d\n+ \u300cTime-field name\u300d\u306b\u300ccreated_at\u300d\n\n![1.png](https://qiita-image-store.s3.amazonaws.com/0/7086/4d1fd0de-f3aa-295a-977f-deb79d6ee387.png)\n\n## Discover\u30da\u30fc\u30b8\n\n+ \u300cDiscover\u300d\u3092\u9078\u629e\n\n![2.png](https://qiita-image-store.s3.amazonaws.com/0/7086/da364b98-685d-17ce-a939-df9d3c607b20.png)\n\n\n## Geo\n\n+ \u300cVisualize\u300d\u21d2\u300cTile map\u300d\n+ geo_point\u306bnull(```\"ignore_malformed\": true```)\u306f\u53d7\u3051\u5165\u308c\u3066\u3082\u3089\u3048\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u9069\u5f53\u306a\u521d\u671f\u5024\u306egeo\u3067\u3059\n\n![3.png](https://qiita-image-store.s3.amazonaws.com/0/7086/dc11e33e-1be4-51c4-4a6f-f69578f68e42.png)\n\n\n## \u5186\u30b0\u30e9\u30d5\n\n+ \u300cVisualize\u300d\u21d2\u300cPie chart\u300d\n\n### \u30cf\u30c3\u30b7\u30e5\u30bf\u30b0\u6570\n\n+ Field\u300chashtags.text\u300d\n\n![4.png](https://qiita-image-store.s3.amazonaws.com/0/7086/398427d3-80ae-1a47-e80a-d99f9e69bad3.png)\n\n\n### \u30e1\u30f3\u30b7\u30e7\u30f3\u3057\u305f\u30e6\u30fc\u30b6\u306e\u591a\u3044\u6570\n\n+ Field\u300cin_reply.screen_name\u300d\n\n![5.png](https://qiita-image-store.s3.amazonaws.com/0/7086/5903c907-fe19-0b92-3dfc-902d0628ebf4.png)\n\n\n### RT\u3057\u305f\u30e6\u30fc\u30b6\u306e\u591a\u3044\u6570\n\n+ Field\u300cretweeted_status.user.name\u300d\n\n![6.png](https://qiita-image-store.s3.amazonaws.com/0/7086/f06c7feb-e3b4-028a-2c7a-ddc070aa0e6a.png)\n\n## \u7e26\u68d2\u30b0\u30e9\u30d5\n\n+ \u300cVisualize\u300d\u21d2\u300cVertical bar chart\u300d\n\n### Fav\u6570\u306e\u591a\u3044tweet\n\n![7.png](https://qiita-image-store.s3.amazonaws.com/0/7086/4a6e1ed4-7df9-e1c3-63e2-ca6533f24183.png)\n\n<blockquote class=\"twitter-tweet\" lang=\"en\"><p lang=\"ja\" dir=\"ltr\">\u30b2\u30b9\u306e\u6975\u307f\u4e59\u5973\u3002\u3055\u3093\u306e\u65b0\u8b5c\u3092\u8074\u304f\u6642\u306e\u3042\u306e\u30c9\u30ad\u30c9\u30ad\u611f\u306f\u306a\u3093\u3066\u3044\u3046\u3093\u3060\u308d\u3046\u3002&#10;&#10;\u3082\u3046\u3001\u604b\u306e\u30c9\u30ad\u30c9\u30ad\u3068\u540c\u3058\u306a\u3093\u3067\u3059\u3088\u306d\u3002&#10;&#10;\u80f8\u304c\u304d\u3085\u30fc\u3093\u3063\u3066\u3002&#10;&#10;\u305d\u306e\u3042\u3068\u306b&#10;&#10;\u3059\u304d\u3059\u304d\u3059\u304d\u3043\u30fc\uff01\u3063\u3066\u3002&#10;&#10;\u4eca\u5e74\u3001\u30e9\u30a4\u30d6\u3092\u62dd\u898b\u3059\u308b\u306e\u304c\u76ee\u6a19\u3067\u3059\u3002&#10;&#10;\u306f\u3041\u3002\u3002\u3002\u5e78\u305b\u306a\u305f\u3081\u3044\u304d\u3002\u3002\u3002</p>&mdash; \u30d9\u30c3\u30ad\u30fc\u266a\u266f (@Becky_bekiko) <a href=\"https://twitter.com/Becky_bekiko/status/614390603116232704\">June 26, 2015</a></blockquote>\n<script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n\n# \u307e\u3068\u3081\n\n+ \u30c7\u30fc\u30bf\u6574\u5f62\u3068mappings\u3092\u6574\u7406\u3059\u308b\u306e\u304c\u5927\u5909\u3060\u3063\u305f\n+ \u65e5\u672c\u8a9e\u691c\u7d22\u306e\u7cbe\u5ea6\u304c\u9069\u5f53\u306a\u306e\u3067\u3001[analysis](https://www.elastic.co/guide/en/elasticsearch/reference/2.x/analysis.html#analysis)\u306e\u7406\u89e3\u6df1\u3081\u305f\u3044\n", "tags": ["Twitter", "Elasticsearch", "Kibana4"]}