{"context": "\n\nwebpack\u3067\u7d20\u306eWebComponents\u3092\u4f5c\u308b\npolymer\u3092\u7528\u3044\u306a\u3044\u7d20\u306ewebcomponents\u3092\u8a66\u3057\u3066\u307f\u305f\u304f\u306a\u3063\u305f\u306e\u3067webpack\u3067\u958b\u767a\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\ntest-elm\n|-- lib\n|-- src\n|  |-- test-elm.html\n|  `-- test-elm.js\n|-- package.json\n`-- webpack.config.js\n\n\npackage.json\n{\n  \"name\": \"test-elm\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"lib/test-elm.html\",\n  \"scripts\": {\n    \"setup\": \"npm install -g webpack babel\",\n    \"link\": \"npm link webpack babel\",\n    \"watch\": \"webpack-dev-server -d --display-modules --progress --watch\",\n    \"build\": \"webpack -p --display-modules --progress\"\n  },\n  \"license\": \"MIT\",\n  \"dependencies\": {\n    \"webcomponents.js\": \"^0.7.22\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^6.9.1\",\n    \"babel-loader\": \"^6.2.4\",\n    \"babel-plugin-add-module-exports\": \"^0.2.1\",\n    \"babel-preset-es2015\": \"^6.9.0\",\n    \"babel-preset-stage-0\": \"^6.5.0\",\n    \"html-webpack-plugin\": \"^2.19.0\"\n  }\n}\n\n\u5b9f\u884c\u65b9\u6cd5\nnpm run setup\nnpm run link\nnpm update\nnpm run watch\nopen localhost:8080\n\n\nwebpack.config.js\nvar path = require('path');\nvar HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n  entry: './src/test-elm.js',\n  output: {\n    filename: './lib/test-elm.js'\n  },\n  resolve: {\n    root: [path.join(__dirname,'node_modules')],\n    extensions: [\n      '',\n      '.js',\n      '.html'\n    ]\n  },\n  externals: {\n  },\n  module: {\n    loaders: [\n      { test: /\\.js$/, loader: 'babel', exclude: /(node_modules|bower_components)/, query: { presets: ['es2015'] } }\n    ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: './src/test-elm.html',\n      filename: \"./lib/test-elm.html\",\n      inject: false\n    })\n  ]\n}\n\nsrc\u304b\u3089lib\u3078html\u30d5\u30a1\u30a4\u30eb\u3092\u79fb\u52d5\u3059\u308b\u306e\u306b HTML Webpack Plugin \u3092\u4f7f\u3063\u305f\u3002\n\nsrc/test-elm.html\n<!DOCTYPE html>\n<template id=\"test-elm\">\n  <style>\n  </style>\n  <div>\n    <content></content>\n  </div>\n</template>\n<script src=\"test-elm.js\"></script>\n\n<content></content>\u304c<p>content</p>\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u308b\u3002\n\nsrc/test-elm.js\nlet PrototypeElement = Object.create(HTMLElement.prototype);\nlet ownerDocument = window.document.currentScript.ownerDocument;\n\nPrototypeElement.createdCallback = function createdCallback() {\n  console.log(\"createdCallback\");\n  console.dir(this);\n  let shadowRoot = this.createShadowRoot();\n  let template = ownerDocument.querySelector('#test-elm');\n  let clone = document.importNode(template.content, true);\n  shadowRoot.appendChild(clone);\n};\n\nPrototypeElement.attachedCallback = function attachedCallback(){\n  console.log(\"attachedCallback\");\n};\n\nPrototypeElement.detachedCallback = function detachedCallback(){\n  console.log(\"detachedCallback\");\n};\n\nPrototypeElement.attributeChangedCallback = function attributeChangedCallback(attr){\n  console.log(\"attributeChangedCallback\", attr);\n};\n\n//\u8981\u7d20\u306b\u30e1\u30bd\u30c3\u30c9\u3082\u5b9a\u7fa9\u3067\u304d\u308b\nPrototypeElement.foo = function foo() {\n  console.log('foo() called');\n};\n\ndocument.registerElement('test-elm', {\n  prototype: PrototypeElement\n});\n\n\nindex.html\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>webcomponents test</title>\n  <script src=\"/node_modules/webcomponents.js/webcomponents.js\"></script>\n  <link rel=\"import\" href=\"/lib/test-elm.html\" />\n</head>\n<body>\n  <test-elm id=\"hoge\">\n    <p>content</p>\n  </test-elm>\n</body>\n</html>\n\n\n\u7d50\u679c\nShadow DOM\u304c\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067 hoge.foo() \u3068\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n\n\u611f\u60f3\nlib/test-elm.html\u306escript\u8981\u7d20\u306e\u4e2d\u306b\u30d0\u30d9\u3063\u305fjs\u3092\u76f4\u63a5\u66f8\u304d\u8fbc\u307f\u305f\u304b\u3063\u305f\u304c\u30b9\u30de\u30fc\u30c8\u306a\u65b9\u6cd5\u304c\u898b\u3064\u3051\u3089\u308c\u306a\u304b\u3063\u305f\u3002\n\n\u53c2\u8003\n\nhttp://webcomponents.org/\nhttps://www.polymer-project.org/1.0/\nhttps://html5experts.jp/1000ch/11142/\nhttp://qiita.com/ko2ic/items/2aa3090dec040bd78eeb\n\n# webpack\u3067\u7d20\u306eWebComponents\u3092\u4f5c\u308b\n\npolymer\u3092\u7528\u3044\u306a\u3044\u7d20\u306ewebcomponents\u3092\u8a66\u3057\u3066\u307f\u305f\u304f\u306a\u3063\u305f\u306e\u3067webpack\u3067\u958b\u767a\u74b0\u5883\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\n\n## \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\n\n```\ntest-elm\n|-- lib\n|-- src\n|  |-- test-elm.html\n|  `-- test-elm.js\n|-- package.json\n`-- webpack.config.js\n```\n\n### package.json\n\n```json\n{\n  \"name\": \"test-elm\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"lib/test-elm.html\",\n  \"scripts\": {\n    \"setup\": \"npm install -g webpack babel\",\n    \"link\": \"npm link webpack babel\",\n    \"watch\": \"webpack-dev-server -d --display-modules --progress --watch\",\n    \"build\": \"webpack -p --display-modules --progress\"\n  },\n  \"license\": \"MIT\",\n  \"dependencies\": {\n    \"webcomponents.js\": \"^0.7.22\"\n  },\n  \"devDependencies\": {\n    \"babel-core\": \"^6.9.1\",\n    \"babel-loader\": \"^6.2.4\",\n    \"babel-plugin-add-module-exports\": \"^0.2.1\",\n    \"babel-preset-es2015\": \"^6.9.0\",\n    \"babel-preset-stage-0\": \"^6.5.0\",\n    \"html-webpack-plugin\": \"^2.19.0\"\n  }\n}\n```\n\n\u5b9f\u884c\u65b9\u6cd5\n\n```bash\nnpm run setup\nnpm run link\nnpm update\nnpm run watch\nopen localhost:8080\n```\n\n### webpack.config.js\n\n```js\nvar path = require('path');\nvar HtmlWebpackPlugin = require('html-webpack-plugin');\n\nmodule.exports = {\n  entry: './src/test-elm.js',\n  output: {\n    filename: './lib/test-elm.js'\n  },\n  resolve: {\n    root: [path.join(__dirname,'node_modules')],\n    extensions: [\n      '',\n      '.js',\n      '.html'\n    ]\n  },\n  externals: {\n  },\n  module: {\n    loaders: [\n      { test: /\\.js$/, loader: 'babel', exclude: /(node_modules|bower_components)/, query: { presets: ['es2015'] } }\n    ]\n  },\n  plugins: [\n    new HtmlWebpackPlugin({\n      template: './src/test-elm.html',\n      filename: \"./lib/test-elm.html\",\n      inject: false\n    })\n  ]\n}\n```\n\nsrc\u304b\u3089lib\u3078html\u30d5\u30a1\u30a4\u30eb\u3092\u79fb\u52d5\u3059\u308b\u306e\u306b [HTML Webpack Plugin](https://github.com/ampedandwired/html-webpack-plugin) \u3092\u4f7f\u3063\u305f\u3002\n\n\n### src/test-elm.html\n\n```html\n<!DOCTYPE html>\n<template id=\"test-elm\">\n  <style>\n  </style>\n  <div>\n    <content></content>\n  </div>\n</template>\n<script src=\"test-elm.js\"></script>\n```\n\n`<content></content>`\u304c`<p>content</p>`\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u308b\u3002\n\n\n### src/test-elm.js\n\n```js\nlet PrototypeElement = Object.create(HTMLElement.prototype);\nlet ownerDocument = window.document.currentScript.ownerDocument;\n\nPrototypeElement.createdCallback = function createdCallback() {\n  console.log(\"createdCallback\");\n  console.dir(this);\n  let shadowRoot = this.createShadowRoot();\n  let template = ownerDocument.querySelector('#test-elm');\n  let clone = document.importNode(template.content, true);\n  shadowRoot.appendChild(clone);\n};\n\nPrototypeElement.attachedCallback = function attachedCallback(){\n  console.log(\"attachedCallback\");\n};\n\nPrototypeElement.detachedCallback = function detachedCallback(){\n  console.log(\"detachedCallback\");\n};\n\nPrototypeElement.attributeChangedCallback = function attributeChangedCallback(attr){\n  console.log(\"attributeChangedCallback\", attr);\n};\n\n//\u8981\u7d20\u306b\u30e1\u30bd\u30c3\u30c9\u3082\u5b9a\u7fa9\u3067\u304d\u308b\nPrototypeElement.foo = function foo() {\n  console.log('foo() called');\n};\n\ndocument.registerElement('test-elm', {\n  prototype: PrototypeElement\n});\n```\n\n### index.html\n\n```html\n<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"utf-8\">\n  <title>webcomponents test</title>\n  <script src=\"/node_modules/webcomponents.js/webcomponents.js\"></script>\n  <link rel=\"import\" href=\"/lib/test-elm.html\" />\n</head>\n<body>\n  <test-elm id=\"hoge\">\n    <p>content</p>\n  </test-elm>\n</body>\n</html>\n```\n\n## \u7d50\u679c\nShadow DOM\u304c\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n![shadow dom](https://i.gyazo.com/6b5a447e5e24bf4b1667bb6aa5238d80.png)\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067 `hoge.foo()` \u3068\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n![method call](https://i.gyazo.com/5f0a358b92a3a0b1b67f61b936593e07.png)\n\n\n## \u611f\u60f3\n\n`lib/test-elm.html`\u306e`script\u8981\u7d20`\u306e\u4e2d\u306b\u30d0\u30d9\u3063\u305fjs\u3092\u76f4\u63a5\u66f8\u304d\u8fbc\u307f\u305f\u304b\u3063\u305f\u304c\u30b9\u30de\u30fc\u30c8\u306a\u65b9\u6cd5\u304c\u898b\u3064\u3051\u3089\u308c\u306a\u304b\u3063\u305f\u3002\n\n\n## \u53c2\u8003\n\n* http://webcomponents.org/\n* https://www.polymer-project.org/1.0/\n* https://html5experts.jp/1000ch/11142/\n* http://qiita.com/ko2ic/items/2aa3090dec040bd78eeb\n", "tags": ["WebComponents"]}