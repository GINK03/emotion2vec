{"tags": ["docker1.9.1", "Debian8.2", "IDCF\u30af\u30e9\u30a6\u30c9", "consul0.6.0", "DockerSwarm1.0.1"], "context": " More than 1 year has passed since last update.\u3000\u524d\u56de\u69cb\u7bc9\u3057\u305fDocker1.9\u306eOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306bDocker Swarm\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002AWS\u3084DigitalOcean\u306a\u3069Docker Machine\u306e\u4f8b\u304c\u591a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306fIDCF\u30af\u30e9\u30a6\u30c9\u4e0a\u306bConsul\u3092\u4f7f\u3044\u30b7\u30f3\u30d7\u30eb\u306aSwarm\u30af\u30e9\u30b9\u30bf\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3053\u306e\u30b7\u30ea\u30fc\u30ba\n\nIDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 1: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\nIDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 2: Docker Swarm\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\nIDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 3: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068Docker Swarm\u3068Docker Compose\u3067RethinkDB\u3092\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b\n\n\n\u53c2\u8003\n\u3000\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\nCreate a swarm for development\nDocker cluster swarm with consul\ndocker network\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a66\u3057\u3066\u307f\u305f(docker-1.9.0)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\n\u3000\u524d\u56de\u3068\u540c\u3058\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002minion-[1-3]\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305fminion-1\u306b\u306fSwarm Manager\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n\nDocker\u30db\u30b9\u30c8\u306ehostname\nDocker\u30db\u30b9\u30c8\u306eeth0\nDocker Swarm\n\n\n\n\nminion-1\n10.3.0.101\nSwarm Manager/Agent\n\n\nminion-2\n10.3.0.102\nSwarm Agent\n\n\nminion-3\n10.3.0.103\nSwarm Agent\n\n\n\n\nDocker\u30c7\u30fc\u30e2\u30f3\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\n\u3000minion-[1-3]\u306eDocker\u30c7\u30fc\u30e2\u30f3\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u306b\u52a0\u3048\u3066-H tcp://0.0.0.0:2375\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308aSwarm agent\u306e\u30ea\u30e2\u30fc\u30c8API\u3092TCP\u304b\u3089Swarm manager\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305f-H unix:///var/run/docker.sock\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306eUNIX\u30bd\u30b1\u30c3\u30c8\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n/etc/default/docker\n#DOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376\"\nDOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n\n\n\nSwarm Manager\u30b3\u30f3\u30c6\u30ca\n\u3000minion-1\u306eDocker\u30db\u30b9\u30c8\u306bSwarm Manager\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Swarm\u306fDocker\u30a4\u30e1\u30fc\u30b8\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002Swarm Manager\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306eDocker\u30db\u30b9\u30c8\u304b\u3089-H\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u30dd\u30fc\u30c8\u3092\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e2375\u3068\u533a\u5225\u3059\u308b\u305f\u3081\u306b3333\u306b\u3057\u307e\u3057\u305f\u3002\n$ docker pull swarm\n$ docker run -d \\\n  --name swarm-manage \\\n  -p 3333:2375 \\\n  swarm \\\n  manage \\\n  consul://10.3.0.101:8500/swarm\n\n\nSwarm Agent\u30b3\u30f3\u30c6\u30ca\n\nminion-1\n\u3000Swarm\u30af\u30e9\u30b9\u30bf\u3078join\u3059\u308b\u305f\u3081\u306bminion-[1-3]\u306e\u5404Docker\u30db\u30b9\u30c8\u306bSwarm Agent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Docker\u30a4\u30e1\u30fc\u30b8\u306fManager\u3082Agent\u3082\u540c\u3058Docker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3044\u307e\u3059\u3002\u6700\u521d\u306bSwarm Manager\u3068\u540c\u3058minion-1\u3067\u3059\u3002\n\u3000--addr\u30d5\u30e9\u30b0\u306fSwarm Manager\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308bIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002minion-1\u306fSwarm Manager\u3068Swarm Agent\u306e\u4e21\u65b9\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u304c\u3001localhost\u3067\u306f\u306a\u304feth0\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u307e\u305fSwarm\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u7ba1\u7406\u3059\u308b\u5206\u6563KVS\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u7bc9\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u540c\u3058Consul\u30af\u30e9\u30b9\u30bf\u3092\u4f7f\u3044\u307e\u3059\u3002\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.101:2375 \\\n  consul://10.3.0.101:8500/swarm\n\n\u3000minion-1\u306eDocker\u30db\u30b9\u30c8\u304b\u3089-H\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Docker\u30c7\u30fc\u30e2\u30f3\u3092Docker Manager\u306b\u6307\u5b9a\u3057\u3066\u304b\u3089info\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Docker Swarm\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 2\nImages: 2\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 1\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 2\nTotal Memory: 8.202 GiB\nName: 397912e89a4d\n\n\nminion-[2-3]\n\u3000minion-2\u3068minion-3\u306eDocker\u30db\u30b9\u30c8\u306b\u306fSwarm Agent\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306fminion-2\u306e\u4f8b\u3067\u3059\u3002\n$ docker pull swarm\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.102:2375 \\\n  consul://10.3.0.102:8500/swarm\n\n\u3000minion-2\u304b\u3089minion-1\u306eSwarm Manager\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3066info\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Swarm\u30af\u30e9\u30b9\u30bf\u306fNodes: 2\u306b\u306a\u308aminion-1\u3068minion-2\u304c\u53c2\u52a0\u3057\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 3\nImages: 4\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-2: 10.3.0.102:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 4\nTotal Memory: 16.4 GiB\nName: 397912e89a4d\n\n\u3000\u540c\u69d8\u306bminion-3\u306b\u3082Swarm Agent\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.103:2375 \\\n  consul://10.3.0.103:8500/swarm\n\n\u3000minion-3\u304b\u3089minion-1\u306eSwarm Manager\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3066info\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Swarm\u30af\u30e9\u30b9\u30bf\u306fNodes: 3\u306b\u306a\u308a\u3001IDCF\u30af\u30e9\u30a6\u30c9\u306estandard.M8 (2 CPU 8GB RAM)\u306e3\u53f0\u5206\u304c\u5408\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nCPU: 6 CPU\n\u30e1\u30e2\u30ea\u30fc: 24.61 GiB\n\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 4\nImages: 6\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-2: 10.3.0.102:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-3: 10.3.0.103:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 6\nTotal Memory: 24.61 GiB\nName: 397912e89a4d\n\n\ndocker network\n\u3000Docker Swarm\u30af\u30e9\u30b9\u30bf\u3067\u306fdocker network\u3092\u30ea\u30b9\u30c8\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002dn\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306a\u306e\u3067minion-[1-3]\u3067\u5171\u901a\u306eNETWORK ID\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 network ls\nNETWORK ID          NAME                       DRIVER\nb68b118036d2        minion-1/bridge            bridge\nf10c0f7978af        dn                         overlay\n636664a4f746        minion-1/docker_gwbridge   bridge\n5d0368bb1be6        minion-3/host              host\nd839af5031ca        minion-3/bridge            bridge\nbc09b464b0c5        minion-1/host              host\na67f3a364d5b        minion-2/bridge            bridge\n63b1b125bd29        minion-2/docker_gwbridge   bridge\nb29394e7420d        minion-2/none              null\n1d85b701a383        minion-2/host              host\n8a4889033015        minion-3/none              null\n87ac747fad87        minion-3/docker_gwbridge   bridge\n6e0cf0387184        minion-1/none              null\n\n\n\u30c6\u30b9\u30c8\u7528\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\n\nminion-1\n\u3000minion-1\u306eDocker\u30db\u30b9\u30c8\u304b\u3089\u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u30922\u3064\u8d77\u52d5\u3057\u307e\u3059\u3002amb1\u30b3\u30f3\u30c6\u30ca\u306f-H\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Swarm Manager\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3057\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 \\\n  run -d -it \\\n  --name amb1 \\\n  -h amb1 \\\n  --net dn \\\n  debian:jessie\n\n\u3000amb2\u30b3\u30f3\u30c6\u30ca\u306flocalhost\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker \\\n  run -d -it \\\n  --name amb2 \\\n  -h amb2 \\\n  --net dn \\\n  debian:jessie\n\n\u3000ps\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068localhost(minion-1)\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u3066\u3044\u308bamb2\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"              40 seconds ago      Up 39 seconds                                amb2\n7c328c08df7a        swarm               \"/swarm join --addr=1\"   20 minutes ago      Up 20 minutes       2375/tcp                 dreamy_liskov\n397912e89a4d        swarm               \"/swarm manage consul\"   24 minutes ago      Up 24 minutes       0.0.0.0:3333->2375/tcp   swarm-manage\n\n\u3000-H\u30d5\u30e9\u30b0\u3067Swarm Manager\u3092\u6307\u5b9a\u3057\u3066ps\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001minion-2\u30db\u30b9\u30c8\u3067\u8d77\u52d5\u3057\u305famb1\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         7 seconds ago       Up 6 seconds                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         4 minutes ago       Up 4 minutes                            minion-2/amb1\n\n\u3000amb1\u30b3\u30f3\u30c6\u30ca\u306fminion-1\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u306e\u3067Swarm Manager\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\n$ docker exec amb1 cat /etc/hosts\nError response from daemon: no such id: amb1\n\n\u3000-H\u30d5\u30e9\u30b0\u3092\u6307\u5b9a\u3057\u3066amb1\u30b3\u30f3\u30c6\u30ca\u306e/etc/hosts\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002amb1\u3068amb2\u306e\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 exec amb1 cat /etc/hosts\n192.168.0.2     amb1\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n192.168.0.3     amb2\n192.168.0.3     amb2.dn\n\n\u3000amb2\u306e/etc/hosts\u306b\u306famb1\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n$ docker exec amb2 cat /etc/hosts\n192.168.0.3     amb2\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n192.168.0.2     amb1\n192.168.0.2     amb1.dn\n\n\u3000\u307e\u3068\u3081\u308b\u3068\u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u306ehostname\n\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9\nDocker\u30db\u30b9\u30c8\nDocker\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n\n\n\namb1\n192.168.0.2\nminion-2\n10.3.0.102\n\n\namb2\n192.168.0.3\nminion-1\n10.3.0.101\n\n\n\n\nminion-2\n\u3000\u6b21\u306bminion-2\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u8abf\u3079\u3066\u307f\u307e\u3059\u3002amb2\u30b3\u30f3\u30c6\u30ca\u306fminion-2\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES\nb505e4526019        debian:jessie       \"/bin/bash\"              About a minute ago   Up About a minute                       amb1\nce9217effebd        swarm               \"/swarm join --addr=1\"   15 minutes ago       Up 15 minutes       2375/tcp            furious_leakey\n\n\u3000-H\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Swarm Manager\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3059\u308b\u3068\u3001minion-1\u3067\u8d77\u52d5\u3057\u305famb2\u3082\u5408\u308f\u305b\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         2 minutes ago       Up 2 minutes                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         6 minutes ago       Up 5 minutes                            minion-2/amb1\n\n\nminion-3\n\u3000\u6700\u5f8c\u306bminion-3\u306eDocker\u30db\u30b9\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002minion-3\u3067\u306fSwarm Agent\u30b3\u30f3\u30c6\u30ca\u4ee5\u5916\u8d77\u52d5\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n$  docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n62458254ec86        swarm               \"/swarm join --addr=1\"   15 minutes ago      Up 15 minutes       2375/tcp            awesome_babbage\n\n\u3000Swarm Manager\u3092\u6307\u5b9a\u3059\u308b\u3068minion-[1-3]\u306f\u3059\u3079\u3066\u540c\u3058\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         2 minutes ago       Up 2 minutes                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         6 minutes ago       Up 6 minutes                            minion-2/amb1\n\n\n\u3000[\u524d\u56de](http://qiita.com/masato/items/6a1fa797b6c25d4c5745)\u69cb\u7bc9\u3057\u305fDocker1.9\u306eOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b[Docker Swarm](https://docs.docker.com/swarm/)\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002AWS\u3084DigitalOcean\u306a\u3069[Docker Machine](https://docs.docker.com/machine/)\u306e\u4f8b\u304c\u591a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306fIDCF\u30af\u30e9\u30a6\u30c9\u4e0a\u306b[Consul](https://www.consul.io/)\u3092\u4f7f\u3044\u30b7\u30f3\u30d7\u30eb\u306aSwarm\u30af\u30e9\u30b9\u30bf\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u3053\u306e\u30b7\u30ea\u30fc\u30ba\n\n* [IDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 1: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210](http://qiita.com/masato/items/6a1fa797b6c25d4c5745)\n* [IDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 2: Docker Swarm\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210](http://qiita.com/masato/items/a047798e48ccc1e56eb8)\n* [IDCF\u30af\u30e9\u30a6\u30c9\u306eDebian Jessie\u3067Multi-Host Docker Networking - Part 3: Overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068Docker Swarm\u3068Docker Compose\u3067RethinkDB\u3092\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u308b](http://qiita.com/masato/items/bd3d50b31f16a00eac47)\n\n## \u53c2\u8003\n\n\u3000\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\n* [Create a swarm for development](https://docs.docker.com/swarm/install-manual/)\n* [Docker cluster swarm with consul](http://blog.tfm.ro/docker-cluster-swarm-with-consul/)\n* [docker network\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8a66\u3057\u3066\u307f\u305f(docker-1.9.0)](http://qiita.com/irotoris/items/8c62b11624319e3f19f4)\n\n\n## \u4eee\u60f3\u30de\u30b7\u30f3\n\n\u3000[\u524d\u56de](http://qiita.com/masato/items/6a1fa797b6c25d4c5745)\u3068\u540c\u3058\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002`minion-[1-3]`\u306b`Swarm Agent`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305f`minion-1`\u306b\u306f`Swarm Manager`\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n|Docker\u30db\u30b9\u30c8\u306ehostname|Docker\u30db\u30b9\u30c8\u306eeth0| Docker Swarm |\n|:--|:--|:--|\n|minion-1|10.3.0.101| Swarm Manager/Agent |\n|minion-2|10.3.0.102| Swarm Agent |\n|minion-3|10.3.0.103| Swarm Agent |\n\n\n### Docker\u30c7\u30fc\u30e2\u30f3\u306e\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\n\n\u3000`minion-[1-3]`\u306eDocker\u30c7\u30fc\u30e2\u30f3\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u306b\u52a0\u3048\u3066`-H tcp://0.0.0.0:2375`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a`Swarm agent`\u306e\u30ea\u30e2\u30fc\u30c8API\u3092TCP\u304b\u3089`Swarm manager`\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u307e\u305f`-H unix:///var/run/docker.sock`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306eUNIX\u30bd\u30b1\u30c3\u30c8\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```bash:/etc/default/docker\n#DOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376\"\nDOCKER_OPTS=\"--cluster-store=consul://localhost:8500 --cluster-advertise=eth0:2376 -H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock\"\n```\n\n## Swarm Manager\u30b3\u30f3\u30c6\u30ca\n \n\u3000`minion-1`\u306eDocker\u30db\u30b9\u30c8\u306b`Swarm Manager`\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Swarm\u306f[Docker\u30a4\u30e1\u30fc\u30b8](https://hub.docker.com/_/swarm/)\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002`Swarm Manager`\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306eDocker\u30db\u30b9\u30c8\u304b\u3089`-H`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u30dd\u30fc\u30c8\u3092\u30de\u30c3\u30d7\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e`2375`\u3068\u533a\u5225\u3059\u308b\u305f\u3081\u306b`3333`\u306b\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker pull swarm\n$ docker run -d \\\n  --name swarm-manage \\\n  -p 3333:2375 \\\n  swarm \\\n  manage \\\n  consul://10.3.0.101:8500/swarm\n```\n\n## Swarm Agent\u30b3\u30f3\u30c6\u30ca\n\n### minion-1\n\n\u3000Swarm\u30af\u30e9\u30b9\u30bf\u3078`join`\u3059\u308b\u305f\u3081\u306b`minion-[1-3]`\u306e\u5404Docker\u30db\u30b9\u30c8\u306b`Swarm Agent`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Docker\u30a4\u30e1\u30fc\u30b8\u306fManager\u3082Agent\u3082\u540c\u3058[Docker\u30a4\u30e1\u30fc\u30b8](https://hub.docker.com/_/swarm/)\u3092\u4f7f\u3044\u307e\u3059\u3002\u6700\u521d\u306b`Swarm Manager`\u3068\u540c\u3058`minion-1`\u3067\u3059\u3002\n\n\u3000`--addr`\u30d5\u30e9\u30b0\u306f`Swarm Manager`\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308bIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002`minion-1`\u306f`Swarm Manager`\u3068`Swarm Agent`\u306e\u4e21\u65b9\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u304c\u3001`localhost`\u3067\u306f\u306a\u304feth0\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u307e\u305fSwarm\u30af\u30e9\u30b9\u30bf\u306e\u60c5\u5831\u7ba1\u7406\u3059\u308b\u5206\u6563KVS\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u7bc9\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3068\u540c\u3058Consul\u30af\u30e9\u30b9\u30bf\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```bash\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.101:2375 \\\n  consul://10.3.0.101:8500/swarm\n```\n\n\u3000`minion-1`\u306eDocker\u30db\u30b9\u30c8\u304b\u3089`-H`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066Docker\u30c7\u30fc\u30e2\u30f3\u3092`Docker Manager`\u306b\u6307\u5b9a\u3057\u3066\u304b\u3089`info`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002`Docker Swarm`\u304c\u6b63\u5e38\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 2\nImages: 2\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 1\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 2\nTotal Memory: 8.202 GiB\nName: 397912e89a4d\n```\n\n\n### minion-[2-3]\n\n\u3000`minion-2`\u3068`minion-3`\u306eDocker\u30db\u30b9\u30c8\u306b\u306f`Swarm Agent`\u3060\u3051\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f`minion-2`\u306e\u4f8b\u3067\u3059\u3002\n\n```bash\n$ docker pull swarm\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.102:2375 \\\n  consul://10.3.0.102:8500/swarm\n```\n\n\u3000`minion-2`\u304b\u3089`minion-1`\u306e`Swarm Manager`\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3066`info`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Swarm\u30af\u30e9\u30b9\u30bf\u306f`Nodes: 2`\u306b\u306a\u308a`minion-1`\u3068`minion-2`\u304c\u53c2\u52a0\u3057\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 3\nImages: 4\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-2: 10.3.0.102:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 4\nTotal Memory: 16.4 GiB\nName: 397912e89a4d\n```\n\n\u3000\u540c\u69d8\u306b`minion-3`\u306b\u3082`Swarm Agent`\u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ docker run -d \\\n  swarm \\\n  join \\\n  --addr=10.3.0.103:2375 \\\n  consul://10.3.0.103:8500/swarm\n```\n\n\u3000`minion-3`\u304b\u3089`minion-1`\u306e`Swarm Manager`\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3066`info`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002Swarm\u30af\u30e9\u30b9\u30bf\u306f`Nodes: 3`\u306b\u306a\u308a\u3001IDCF\u30af\u30e9\u30a6\u30c9\u306e[standard.M8 (2 CPU 8GB RAM)](http://www.idcf.jp/cloud/price.html#price-section)\u306e3\u53f0\u5206\u304c\u5408\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* CPU: 6 CPU\n* \u30e1\u30e2\u30ea\u30fc: 24.61 GiB\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 info\nContainers: 4\nImages: 6\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n minion-1: 10.3.0.101:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-2: 10.3.0.102:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\n minion-3: 10.3.0.103:2375\n  \u2514 Status: Healthy\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 8.202 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.16.0-4-amd64, operatingsystem=Debian GNU/Linux 8 (jessie), storagedriver=aufs\nCPUs: 6\nTotal Memory: 24.61 GiB\nName: 397912e89a4d\n```\n\n## docker network\n\n\u3000Docker Swarm\u30af\u30e9\u30b9\u30bf\u3067\u306f`docker network`\u3092\u30ea\u30b9\u30c8\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002`dn`\u306fOverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306a\u306e\u3067`minion-[1-3]`\u3067\u5171\u901a\u306e`NETWORK ID`\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 network ls\nNETWORK ID          NAME                       DRIVER\nb68b118036d2        minion-1/bridge            bridge\nf10c0f7978af        dn                         overlay\n636664a4f746        minion-1/docker_gwbridge   bridge\n5d0368bb1be6        minion-3/host              host\nd839af5031ca        minion-3/bridge            bridge\nbc09b464b0c5        minion-1/host              host\na67f3a364d5b        minion-2/bridge            bridge\n63b1b125bd29        minion-2/docker_gwbridge   bridge\nb29394e7420d        minion-2/none              null\n1d85b701a383        minion-2/host              host\n8a4889033015        minion-3/none              null\n87ac747fad87        minion-3/docker_gwbridge   bridge\n6e0cf0387184        minion-1/none              null\n```\n\n\n## \u30c6\u30b9\u30c8\u7528\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\n\n\n### minion-1\n\n\u3000`minion-1`\u306eDocker\u30db\u30b9\u30c8\u304b\u3089\u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u30922\u3064\u8d77\u52d5\u3057\u307e\u3059\u3002`amb1`\u30b3\u30f3\u30c6\u30ca\u306f`-H`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066`Swarm Manager`\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3057\u3057\u307e\u3059\u3002\n\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 \\\n  run -d -it \\\n  --name amb1 \\\n  -h amb1 \\\n  --net dn \\\n  debian:jessie\n```\n\n\u3000`amb2`\u30b3\u30f3\u30c6\u30ca\u306flocalhost\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ docker \\\n  run -d -it \\\n  --name amb2 \\\n  -h amb2 \\\n  --net dn \\\n  debian:jessie\n```\n\n\u3000`ps`\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3068localhost(`minion-1`)\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b`amb2`\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"              40 seconds ago      Up 39 seconds                                amb2\n7c328c08df7a        swarm               \"/swarm join --addr=1\"   20 minutes ago      Up 20 minutes       2375/tcp                 dreamy_liskov\n397912e89a4d        swarm               \"/swarm manage consul\"   24 minutes ago      Up 24 minutes       0.0.0.0:3333->2375/tcp   swarm-manage\n```\n\n\u3000`-H`\u30d5\u30e9\u30b0\u3067`Swarm Manager`\u3092\u6307\u5b9a\u3057\u3066`ps`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001`minion-2`\u30db\u30b9\u30c8\u3067\u8d77\u52d5\u3057\u305f`amb1`\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         7 seconds ago       Up 6 seconds                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         4 minutes ago       Up 4 minutes                            minion-2/amb1\n```\n\n\u3000`amb1`\u30b3\u30f3\u30c6\u30ca\u306f`minion-1`\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u306e\u3067`Swarm Manager`\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\n\n```bash\n$ docker exec amb1 cat /etc/hosts\nError response from daemon: no such id: amb1\n```\n\n\u3000`-H`\u30d5\u30e9\u30b0\u3092\u6307\u5b9a\u3057\u3066`amb1`\u30b3\u30f3\u30c6\u30ca\u306e`/etc/hosts`\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002`amb1`\u3068`amb2`\u306e\u540d\u524d\u89e3\u6c7a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 exec amb1 cat /etc/hosts\n192.168.0.2     amb1\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n192.168.0.3     amb2\n192.168.0.3     amb2.dn\n```\n\n\u3000`amb2`\u306e`/etc/hosts`\u306b\u306f`amb1`\u306e\u30a8\u30f3\u30c8\u30ea\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\n```bash\n$ docker exec amb2 cat /etc/hosts\n192.168.0.3     amb2\n127.0.0.1       localhost\n::1     localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n192.168.0.2     amb1\n192.168.0.2     amb1.dn\n```\n\n\u3000\u307e\u3068\u3081\u308b\u3068\u30c6\u30b9\u30c8\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n|\u30b3\u30f3\u30c6\u30ca\u306ehostname|\u30b3\u30f3\u30c6\u30ca\u306eIP\u30a2\u30c9\u30ec\u30b9|Docker\u30db\u30b9\u30c8| Docker\u30db\u30b9\u30c8\u306eIP\u30a2\u30c9\u30ec\u30b9 |\n|:--|:--|:--|:--|\n|amb1|192.168.0.2|minion-2|10.3.0.102|\n|amb2|192.168.0.3|minion-1|10.3.0.101|\n\n\n### minion-2\n\n\u3000\u6b21\u306b`minion-2`\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u614b\u3092\u8abf\u3079\u3066\u307f\u307e\u3059\u3002`amb2`\u30b3\u30f3\u30c6\u30ca\u306f`minion-2`\u306eDocker\u30c7\u30fc\u30e2\u30f3\u3067\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES\nb505e4526019        debian:jessie       \"/bin/bash\"              About a minute ago   Up About a minute                       amb1\nce9217effebd        swarm               \"/swarm join --addr=1\"   15 minutes ago       Up 15 minutes       2375/tcp            furious_leakey\n```\n\n\u3000`-H`\u30d5\u30e9\u30b0\u3092\u3064\u3051\u3066`Swarm Manager`\u3092Docker\u30c7\u30fc\u30e2\u30f3\u306b\u6307\u5b9a\u3059\u308b\u3068\u3001`minion-1`\u3067\u8d77\u52d5\u3057\u305f`amb2`\u3082\u5408\u308f\u305b\u3066\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         2 minutes ago       Up 2 minutes                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         6 minutes ago       Up 5 minutes                            minion-2/amb1\n```\n\n\n\n### minion-3\n\n\u3000\u6700\u5f8c\u306b`minion-3`\u306eDocker\u30db\u30b9\u30c8\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002`minion-3`\u3067\u306f`Swarm Agent`\u30b3\u30f3\u30c6\u30ca\u4ee5\u5916\u8d77\u52d5\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\n```bash\n$  docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n62458254ec86        swarm               \"/swarm join --addr=1\"   15 minutes ago      Up 15 minutes       2375/tcp            awesome_babbage\n```\n\n\u3000`Swarm Manager`\u3092\u6307\u5b9a\u3059\u308b\u3068`minion-[1-3]`\u306f\u3059\u3079\u3066\u540c\u3058\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n```bash\n$ docker -H tcp://10.3.0.101:3333 ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nadb34e982686        debian:jessie       \"/bin/bash\"         2 minutes ago       Up 2 minutes                            minion-1/amb2\nb505e4526019        debian:jessie       \"/bin/bash\"         6 minutes ago       Up 6 minutes                            minion-2/amb1\n```\n"}