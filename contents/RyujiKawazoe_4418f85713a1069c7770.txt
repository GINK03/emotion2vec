{"context": "\n\n\u3082\u3063\u3068\u7dba\u9e97\u306b\u66f8\u3051\u305f\u306e\u3067\u3001\u8a18\u4e8b\u3092\u66f8\u304d\u76f4\u3057\u307e\u3057\u305f\n\u2192\u65b0\u3057\u3044\u8a18\u4e8b\nid\u3060\u3051\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\u304c\u3042\u308a\u3001\u305d\u308c\u3092Spark\u4e0a\u3067id\u304b\u3089value\u3092\u5f15\u3063\u5f35\u3063\u3066\u304d\u3066\u3001\u300c\uff1a\u300d\u3067\u3064\u306a\u3052\u308b\u51e6\u7406\u3092\u3057\u305f\u304b\u3063\u305f\u3002\n\u5177\u4f53\u7684\u306a\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306f\n[1, 3, 5, 7]\n\n\u3068\u3044\u3063\u305f\u30c7\u30fc\u30bf\u3092\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306b\u5909\u66f4\u3057\u305f\u304b\u3063\u305f\u3002\n\u308a\u3093\u3054\uff1a\u3082\u3082\uff1a\u30d0\u30ca\u30ca\uff1a\u30d1\u30a4\u30ca\u30c3\u30d7\u30eb\n\n\n\u74b0\u5883\n\nspark(2.0.0)\nscala(2.11.5)\n\n\n\u3084\u3063\u305f\u3053\u3068\n\nflatMapValues\u3067\u914d\u5217\u3092\u5c55\u958b\n\u5546\u54c1\u304c\u8f09\u3063\u3066\u3044\u308bRDD\u3092\u5916\u90e8\u7d50\u5408\ngroupByKey\u3067\u30ad\u30fc\u3054\u3068\u306b\u5024\u3092\u307e\u3068\u3081\u308b\n\n\n\u5177\u4f53\u4f8b\n\n\u30e6\u30fc\u30b6\u30fc\u8cfc\u5165\u30c7\u30fc\u30bf\n\n\n\n\nuser_id\nbuy_list\n\n\n\n\n1\n[1, 2, 3]\n\n\n2\n[2, 4]\n\n\n\n\n\u5546\u54c1\u30c7\u30fc\u30bf\n\n\n\n\nproduct_id\nproduct_name\n\n\n\n\n1\n\u308a\u3093\u3054\n\n\n2\n\u30d0\u30ca\u30ca\n\n\n3\n\u30ec\u30e2\u30f3\n\n\n4\n\u307f\u304b\u3093\n\n\n\n\u5546\u54c1\u30c7\u30fc\u30bf\u3092RDD\u306b\n    val productRDD = productDF\n      .select(\"product_id\",\"product_name\")\n      .rdd\n      .map(x => {\n        // tuple\u306e\u4e00\u756a\u76ee\u306fid\u306b\uff01\n        (x.getString(0), x.getString(1))\n      })\n\n\n\u30e6\u30fc\u30b6\u30fc\u8cfc\u5165\u30c7\u30fc\u30bf\u3092RDD\u306b\u3057\u3066\u3001\u5546\u54c1\u30c7\u30fc\u30bf\u3092\u5916\u90e8\u7d50\u5408\n    /**\n      * \u7d4c\u7531\u99c5\u3092\u9023\u7d50\u3057\u3066\u8868\u793a\u3059\u308b\u305f\u3081\u3001\u5206\u89e3\n      */\n    val userBuylistRDD = userBuylistRDD.select(\"user_id\", \"buy_list\").rdd.map(x => {\n      val id = x.getString(0)\n      val codes = x.getSeq[String](1)\n      (id, codes)\n    }).flatMapValues(x => x) // \u3053\u3053\u3067\u5e73\u5766\u306b\u3057\u3066\u3044\u308b\u3088\n      .map(x => (x._2, x._1))\u3000// \u5916\u90e8\u7d50\u5408\u3059\u308b\u305f\u3081\u306b\u3001\u5546\u54c1ID\u3092tuple\u306e\u4e00\u756a\u76ee\u306e\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u3088\n      .leftOuterJoin(stationRDDCodeAndName)\n      .map(x => {\n\n        // \u306a\u3093\u304b\u9069\u5f53\u306a\u51e6\u7406\n      })\n\n\n\u3053\u306e\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u306a\u3063\u3066\u3044\u308b\n\n\n\nuser_id\nbuy_list\n\n\n\n\n1\n\u308a\u3093\u3054\n\n\n1\n\u30ec\u30e2\u30f3\n\n\n1\n\u30d0\u30ca\u30ca\n\n\n2\n\u30d0\u30ca\u30ca\n\n\n2\n\u307f\u304b\u3093\n\n\n\n\u3053\u306e\u5f8c\u306bgroupByKey\u3092\u4f7f\u3063\u3066\u30ad\u30fc\u3054\u3068\u306b\u5024\u3092\u307e\u3068\u3081\u308b\u4f5c\u696d\u3092\u3059\u308c\u3070\u3001\u5f53\u521d\u76ee\u7684\u3068\u3057\u3066\u3044\u305f\u300c\uff1a\u300d\u3067\u3064\u306a\u3052\u308b\u51e6\u7406\u304c\u5b8c\u6210\u3059\u308b\n    val userBuylistRDD = userBuylistRDD.select(\"user_id\", \"buy_list\").rdd.map(x => {\n      val id = x.getString(0)\n      val codes = x.getSeq[String](1)\n      (id, codes)\n    }).flatMapValues(x => x) // \u3053\u3053\u3067\u5e73\u5766\u306b\u3057\u3066\u3044\u308b\u3088\n      .map(x => (x._2, x._1))\u3000// \u5916\u90e8\u7d50\u5408\u3059\u308b\u305f\u3081\u306b\u3001\u5546\u54c1ID\u3092tuple\u306e\u4e00\u756a\u76ee\u306e\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u3088\n      .leftOuterJoin(stationRDDCodeAndName)\n      .map(x => {\n            //\u3055\u3063\u304d\u306e\u3068\u3053\u308d\u3092\u5177\u4f53\u7684\u306b\u3002\n        (x._2._1, x._2._2.getOrElse(\"\"))\n      }).groupByKey().map(x => (x._1, x._2.mkString(\":\")))\n\n\u3093\u3067\u3053\u308c\u306f\u6700\u7d42\u7684\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u306b\u306a\u308b\n\n\n\nuser_id\nbuy_list\n\n\n\n\n1\n\u308a\u3093\u3054\uff1a\u30ec\u30e2\u30f3\uff1a\u30d0\u30ca\u30ca\n\n\n2\n\u30d0\u30ca\u30ca\uff1a\u307f\u304b\u3093\n\n\n\n\n\u6ce8\u610f\ngroupByKey\u3067\u307e\u3068\u3081\u308b\u6642\u306b\u914d\u5217\u306e\u9806\u756a\u306f\u5909\u308f\u3063\u3066\u308b\u3063\u307d\u3044\u3002\n\u9806\u756a\u3092\u91cd\u8996\u3059\u308b\u30c7\u30fc\u30bf\u306a\u3089\u3070\u3001\u5c11\u3057\u9055\u3063\u305f\u3084\u308a\u65b9\u304c\u5fc5\u8981\u304b\u3082\uff1f\n\n\u3082\u3063\u3068\u7dba\u9e97\u306b\u66f8\u3051\u305f\u306e\u3067\u3001\u8a18\u4e8b\u3092\u66f8\u304d\u76f4\u3057\u307e\u3057\u305f\n---\n\n\u2192[\u65b0\u3057\u3044\u8a18\u4e8b](http://qiita.com/RyujiKawazoe/items/bd051f551cc3776c4cd3)\n\nid\u3060\u3051\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\u304c\u3042\u308a\u3001\u305d\u308c\u3092Spark\u4e0a\u3067id\u304b\u3089value\u3092\u5f15\u3063\u5f35\u3063\u3066\u304d\u3066\u3001\u300c\uff1a\u300d\u3067\u3064\u306a\u3052\u308b\u51e6\u7406\u3092\u3057\u305f\u304b\u3063\u305f\u3002\n\n\u5177\u4f53\u7684\u306a\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u306f\n\n```\n[1, 3, 5, 7]\n```\n\n\u3068\u3044\u3063\u305f\u30c7\u30fc\u30bf\u3092\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306b\u5909\u66f4\u3057\u305f\u304b\u3063\u305f\u3002\n\n```\n\u308a\u3093\u3054\uff1a\u3082\u3082\uff1a\u30d0\u30ca\u30ca\uff1a\u30d1\u30a4\u30ca\u30c3\u30d7\u30eb\n```\n\n\n\u74b0\u5883\n---\n\n* spark(2.0.0)\n* scala(2.11.5)\n\n\u3084\u3063\u305f\u3053\u3068\n---\n\n* flatMapValues\u3067\u914d\u5217\u3092\u5c55\u958b\n* \u5546\u54c1\u304c\u8f09\u3063\u3066\u3044\u308bRDD\u3092\u5916\u90e8\u7d50\u5408\n* groupByKey\u3067\u30ad\u30fc\u3054\u3068\u306b\u5024\u3092\u307e\u3068\u3081\u308b\n\n\n\u5177\u4f53\u4f8b\n---\n\n* \u30e6\u30fc\u30b6\u30fc\u8cfc\u5165\u30c7\u30fc\u30bf\n\n| user_id | buy_list |\n| --- | --- |\n| 1 | [1, 2, 3] |\n| 2 | [2, 4] |\n\n* \u5546\u54c1\u30c7\u30fc\u30bf\n\n| product_id | product_name |\n| --- | --- |\n| 1 | \u308a\u3093\u3054 |\n| 2 | \u30d0\u30ca\u30ca |\n| 3 | \u30ec\u30e2\u30f3 |\n| 4 | \u307f\u304b\u3093 |\n\n\n\u5546\u54c1\u30c7\u30fc\u30bf\u3092RDD\u306b\n\n~~~~\n    val productRDD = productDF\n      .select(\"product_id\",\"product_name\")\n      .rdd\n      .map(x => {\n      \t// tuple\u306e\u4e00\u756a\u76ee\u306fid\u306b\uff01\n        (x.getString(0), x.getString(1))\n      })\n      \n~~~~\n\n\u30e6\u30fc\u30b6\u30fc\u8cfc\u5165\u30c7\u30fc\u30bf\u3092RDD\u306b\u3057\u3066\u3001\u5546\u54c1\u30c7\u30fc\u30bf\u3092\u5916\u90e8\u7d50\u5408\n\n~~~~\n    /**\n      * \u7d4c\u7531\u99c5\u3092\u9023\u7d50\u3057\u3066\u8868\u793a\u3059\u308b\u305f\u3081\u3001\u5206\u89e3\n      */\n    val userBuylistRDD = userBuylistRDD.select(\"user_id\", \"buy_list\").rdd.map(x => {\n      val id = x.getString(0)\n      val codes = x.getSeq[String](1)\n      (id, codes)\n    }).flatMapValues(x => x) // \u3053\u3053\u3067\u5e73\u5766\u306b\u3057\u3066\u3044\u308b\u3088\n      .map(x => (x._2, x._1))\u3000// \u5916\u90e8\u7d50\u5408\u3059\u308b\u305f\u3081\u306b\u3001\u5546\u54c1ID\u3092tuple\u306e\u4e00\u756a\u76ee\u306e\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u3088\n      .leftOuterJoin(stationRDDCodeAndName)\n      .map(x => {\n      \n        // \u306a\u3093\u304b\u9069\u5f53\u306a\u51e6\u7406\n      })\n      \n~~~~\n\n\u3053\u306e\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u306a\u3063\u3066\u3044\u308b\n\n| user_id | buy_list |\n| --- | --- |\n| 1 |  \u308a\u3093\u3054|\n| 1 |  \u30ec\u30e2\u30f3|\n| 1 |  \u30d0\u30ca\u30ca|\n| 2 |  \u30d0\u30ca\u30ca|\n| 2 |  \u307f\u304b\u3093|\n\n\u3053\u306e\u5f8c\u306bgroupByKey\u3092\u4f7f\u3063\u3066\u30ad\u30fc\u3054\u3068\u306b\u5024\u3092\u307e\u3068\u3081\u308b\u4f5c\u696d\u3092\u3059\u308c\u3070\u3001\u5f53\u521d\u76ee\u7684\u3068\u3057\u3066\u3044\u305f\u300c\uff1a\u300d\u3067\u3064\u306a\u3052\u308b\u51e6\u7406\u304c\u5b8c\u6210\u3059\u308b\n\n```\n    val userBuylistRDD = userBuylistRDD.select(\"user_id\", \"buy_list\").rdd.map(x => {\n      val id = x.getString(0)\n      val codes = x.getSeq[String](1)\n      (id, codes)\n    }).flatMapValues(x => x) // \u3053\u3053\u3067\u5e73\u5766\u306b\u3057\u3066\u3044\u308b\u3088\n      .map(x => (x._2, x._1))\u3000// \u5916\u90e8\u7d50\u5408\u3059\u308b\u305f\u3081\u306b\u3001\u5546\u54c1ID\u3092tuple\u306e\u4e00\u756a\u76ee\u306e\u5f15\u6570\u306b\u3057\u3066\u3044\u308b\u3088\n      .leftOuterJoin(stationRDDCodeAndName)\n      .map(x => {\n      \t\t//\u3055\u3063\u304d\u306e\u3068\u3053\u308d\u3092\u5177\u4f53\u7684\u306b\u3002\n        (x._2._1, x._2._2.getOrElse(\"\"))\n      }).groupByKey().map(x => (x._1, x._2.mkString(\":\")))\n```\n\n\u3093\u3067\u3053\u308c\u306f\u6700\u7d42\u7684\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u306b\u306a\u308b\n\n| user_id | buy_list |\n| --- | --- |\n| 1 |  \u308a\u3093\u3054\uff1a\u30ec\u30e2\u30f3\uff1a\u30d0\u30ca\u30ca|\n| 2 |  \u30d0\u30ca\u30ca\uff1a\u307f\u304b\u3093|\n\n\n\n\u6ce8\u610f\n---\n\ngroupByKey\u3067\u307e\u3068\u3081\u308b\u6642\u306b\u914d\u5217\u306e\u9806\u756a\u306f\u5909\u308f\u3063\u3066\u308b\u3063\u307d\u3044\u3002\n\u9806\u756a\u3092\u91cd\u8996\u3059\u308b\u30c7\u30fc\u30bf\u306a\u3089\u3070\u3001\u5c11\u3057\u9055\u3063\u305f\u3084\u308a\u65b9\u304c\u5fc5\u8981\u304b\u3082\uff1f\n\n\n\n\n\n", "tags": ["Spark"]}