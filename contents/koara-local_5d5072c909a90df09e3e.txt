{"tags": ["GitLab", "Mattermost"], "context": "\n\n2.2.0 => 3.1.0 \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nGitLab Documentation\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306e \u300cUpgrading GitLab Mattermost from versions prior to 8.9\u300d \u3092\u53c2\u7167\u3002\n\u203b\u4ee5\u4e0b\u306e\u624b\u9806\u306f\u3042\u304f\u307e\u3067\u3082\u79c1\u306e\u74b0\u5883\u3067\u306e\u78ba\u8a8d\u306e\u307f\u3057\u304b\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u4e0a\u8a18\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u53c2\u7167\u306e\u3082\u3068\u3001\u81ea\u5df1\u8cac\u4efb\u3067\u5b9f\u884c\u9858\u3044\u307e\u3059\u3002\n\n1. Confirm you are starting with version GitLab 8.8.\n\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u74b0\u5883\u304b\u3089\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\n$ dpkg -l gitlab-ce\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                        Version                    Architecture               Description\n+++-===========================================-==========================-==========================-===========================================================================================\nii  gitlab-ce                                   8.8.5-ce.1                 amd64                      GitLab Community Edition and GitLab CI (including NGINX, Postgres, Redis)\n\n\n2. Backup your Mattermost database.\n\u5931\u6557\u3057\u305f\u6642\u7528\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo -u gitlab-psql -- /opt/gitlab/embedded/bin/pg_dump -h /var/opt/gitlab/postgresql mattermost_production | gzip > mattermost_dbdump_$(date --rfc-3339=date).sql.gz\n\n\n\u5b9f\u884c\u4f8b\n$ sudo -u gitlab-psql -- /opt/gitlab/embedded/bin/pg_dump -h /var/opt/gitlab/postgresql mattermost_production | gzip > mattermost_dbdump_$(date --rfc-3339=date).sql.gz\n$ ls\nmattermost_dbdump_2016-08-12.sql.gz\n\n\n\n3. Configure two settings.\ngitlab.rb \u3092 3.1 \u306b\u5408\u308f\u305b\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n$ sudo vi /etc/gitlab/gitlab.rb\n\n\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/gitlab/gitlab.rb\nmattermost['db2_backup_created'] = true\nmattermost['db2_team_name'] = \"TEAMNAME\"\n\n\nTEAMNAME\u306f\u4f7f\u7528\u3057\u3066\u3044\u308b\u30c1\u30fc\u30e0\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n3.1 \u3088\u308a\u3001\u8907\u6570\u30c1\u30fc\u30e0\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30e1\u30a4\u30f3\u306e\u30c1\u30fc\u30e0\u540d\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nIf you use multiple teams, this should be the name of the team most commonly used. \u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\n4. Run your GitLab 8.9 upgrade as normal.\n8.9.0-ce.0 \u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n$ sudo apt-get update\n$ sudo apt-get install gitlab-ce=8.9.0-ce.0\n$ sudo gitlab-ctl restart\n\n\u3053\u308c\u3067\u6210\u529f\u3059\u308c\u3070\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 3.1.0 \u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n\n3.1.0 => 3.2.0 \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u3053\u306e\u307e\u307e 3.2.0 \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3082\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n$ sudo apt-get update --fix-missing\n$ sudo apt-get install gitlab-ce\n$ sudo gitlab-ctl restart\n$ dpkg -l gitlab-ce\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                        Version                    Architecture               Description\n+++-===========================================-==========================-==========================-===========================================================================================\nii  gitlab-ce                                   8.10.5-ce.0                amd64                      GitLab Community Edition and GitLab CI (including NGINX, Postgres, Redis)\n\n\n# 2.2.0 => 3.1.0 \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n[GitLab Documentation](http://docs.gitlab.com/omnibus/gitlab-mattermost/)\n\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306e \u300cUpgrading GitLab Mattermost from versions prior to 8.9\u300d \u3092\u53c2\u7167\u3002\n\n\u203b\u4ee5\u4e0b\u306e\u624b\u9806\u306f\u3042\u304f\u307e\u3067\u3082\u79c1\u306e\u74b0\u5883\u3067\u306e\u78ba\u8a8d\u306e\u307f\u3057\u304b\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\u4e0a\u8a18\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u53c2\u7167\u306e\u3082\u3068\u3001\u81ea\u5df1\u8cac\u4efb\u3067\u5b9f\u884c\u9858\u3044\u307e\u3059\u3002\n\n## 1. Confirm you are starting with version GitLab 8.8.\n\n\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u74b0\u5883\u304b\u3089\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3044\u307e\u3059\u3002\n\n```console\n$ dpkg -l gitlab-ce\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                        Version                    Architecture               Description\n+++-===========================================-==========================-==========================-===========================================================================================\nii  gitlab-ce                                   8.8.5-ce.1                 amd64                      GitLab Community Edition and GitLab CI (including NGINX, Postgres, Redis)\n```\n\n## 2. Backup your Mattermost database.\n\u5931\u6557\u3057\u305f\u6642\u7528\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo -u gitlab-psql -- /opt/gitlab/embedded/bin/pg_dump -h /var/opt/gitlab/postgresql mattermost_production | gzip > mattermost_dbdump_$(date --rfc-3339=date).sql.gz\n```\n\n```console:\u5b9f\u884c\u4f8b\n$ sudo -u gitlab-psql -- /opt/gitlab/embedded/bin/pg_dump -h /var/opt/gitlab/postgresql mattermost_production | gzip > mattermost_dbdump_$(date --rfc-3339=date).sql.gz\n$ ls\nmattermost_dbdump_2016-08-12.sql.gz\n```\n\n## 3. Configure two settings.\n\n`gitlab.rb` \u3092 `3.1` \u306b\u5408\u308f\u305b\u3066\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```\n$ sudo vi /etc/gitlab/gitlab.rb\n```\n\n\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```rb:/etc/gitlab/gitlab.rb\nmattermost['db2_backup_created'] = true\nmattermost['db2_team_name'] = \"TEAMNAME\"\n```\n\nTEAMNAME\u306f\u4f7f\u7528\u3057\u3066\u3044\u308b\u30c1\u30fc\u30e0\u540d\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3057\u3066\u4e0b\u3055\u3044\u3002\n`3.1` \u3088\u308a\u3001\u8907\u6570\u30c1\u30fc\u30e0\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30e1\u30a4\u30f3\u306e\u30c1\u30fc\u30e0\u540d\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n`If you use multiple teams, this should be the name of the team most commonly used.` \u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\n## 4. Run your GitLab 8.9 upgrade as normal.\n\n`8.9.0-ce.0` \u306b\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n```console\n$ sudo apt-get update\n$ sudo apt-get install gitlab-ce=8.9.0-ce.0\n$ sudo gitlab-ctl restart\n```\n\n\u3053\u308c\u3067\u6210\u529f\u3059\u308c\u3070\u30d0\u30fc\u30b8\u30e7\u30f3\u304c `3.1.0` \u306b\u306a\u3063\u3066\u3044\u308b\u306f\u305a\u3067\u3059\u3002\n\n![\u7121\u984c.png](https://qiita-image-store.s3.amazonaws.com/0/37721/d16e6e04-0837-892d-18e6-30d3b5ccd6c2.png)\n\n# 3.1.0 => 3.2.0 \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n\u3053\u306e\u307e\u307e `3.2.0` \u3078\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3082\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n```\n$ sudo apt-get update --fix-missing\n$ sudo apt-get install gitlab-ce\n$ sudo gitlab-ctl restart\n$ dpkg -l gitlab-ce\nDesired=Unknown/Install/Remove/Purge/Hold\n| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend\n|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)\n||/ Name                                        Version                    Architecture               Description\n+++-===========================================-==========================-==========================-===========================================================================================\nii  gitlab-ce                                   8.10.5-ce.0                amd64                      GitLab Community Edition and GitLab CI (including NGINX, Postgres, Redis)\n```\n\n"}