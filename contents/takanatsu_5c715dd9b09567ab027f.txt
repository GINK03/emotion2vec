{"tags": ["Ruby", "RubyOnRails", "\u30c9\u30c3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb", "Rails", "Rails4"], "context": "\n\n\uff03 \u306f\u3058\u3081\u306b\n\u30c9\u30c3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306eRuby on Rails 4\u5165\u9580\u3067\u306f\u3001\u300cProject\u300d\u3068\u300cTask\u300d\u306e\uff12\u3064\u306e\u5165\u529b\u753b\u9762\u304c\u3042\u308a\u3001\u30ec\u30c3\u30b9\u30f3\u5185\u3067\u306f\u3001Project\u5074\u306e\u307f\u3001\u5165\u529b\u30a8\u30e9\u30fc\u6642\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3055\u305b\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001Project\u5074\u306e\u5b9f\u88c5\u3092\u53c2\u8003\u306bTask\u5074\u306e\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u3061\u3087\u3063\u3068\u3064\u307e\u305a\u3044\u305f\u306e\u3067\u3001\u305d\u306e\u3068\u304d\u306e\u5099\u5fd8\u9332\u3067\u3059\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\n% ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n\n% rails -v\nRails 4.2.7.1\n\n\n\u4f5c\u696d\u306e\u6d41\u308c\n\ntask.rb \u4fee\u6b63\u524d\n\n\n/app/models/task.rb\n  class Task < ActiveRecord::Base\n    belongs_to :project\n-   validates :title, presence: true\n    scope :unfinished, -> { where(done: false) }\n  end\n\n\n\ntask.rb \u4fee\u6b63\u5f8c\n\n\n/app/models/task.rb\n  class Task < ActiveRecord::Base\n    belongs_to :project\n+   validates :title,\n+     presence: { message: \"\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\" },\n+     length: { minimum: 3, message: \"\u77ed\u3059\u304e\uff01\" }\n    scope :unfinished, -> { where(done: false) }\n  end\n\n\n\n\ntasks_controller.rb \u4fee\u6b63\u524d\n\n\n/app/controllers/tasks_controller.rb\n  class TasksController < ApplicationController\n    def create\n      @project = Project.find(params[:project_id])\n-     @task = @project.tasks.create(task_params)\n-     redirect_to project_path(@project.id)\n    end\n\n\n\ntasks_controller.rb \u4fee\u6b63\u5f8c\n\n\n/app/controllers/tasks_controller.rb\n  class TasksController < ApplicationController\n    def create\n      @project = Project.find(params[:project_id])\n+     @task = @project.tasks.build(task_params)\n+     if @task.save\n+       redirect_to project_path(@project.id)\n+     else\n+       # @project.tasks.build \u3067 tasks \u306b1\u884c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\n+       # \u305d\u306e\u307e\u307e\u3060\u3068\u4e00\u89a7\u306b\u30a8\u30e9\u30fc\u306e\u5206\u3082\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u518d\u53d6\u5f97\u3059\u308b\n+       @project = Project.find(params[:project_id])\n+       render 'projects/show'\n+     end\n    end\n\n\n\n\nshow.html.erb \u4fee\u6b63\u524d\n\n\n/app/views/projects/show.html.erb\n- <%= form_for [@project, @project.tasks.build] do |f| %>\n  <p>\n    <%= f.text_field :title %>\n  </p>\n\n\n\nshow.html.erb \u4fee\u6b63\u5f8c\n\n\n/app/views/projects/show.html.erb\n+ <%# @project.tasks.build \u3060\u3068 @task.errors \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5165\u3089\u306a\u3044\u305f\u3081 @task \u306b\u5909\u66f4 %>\n+ <%= form_for [@project, @task] do |f| %>\n  <p>\n    <%= f.text_field :title %>\n+   <% if @task.errors.any? %>\n+     <%= @task.errors.messages[:title][0] %>\n+   <% end %>\n  </p>\n\n\n\n\nprojects_controller.rb \u4fee\u6b63\u524d\n\n\n/app/controllers/projects_controller.rb\n  class ProjectsController < ApplicationController\n    def show\n    end\n\n\n\nprojects_controller.rb \u4fee\u6b63\u5f8c\n\n\n/app/controllers/projects_controller.rb\n  class ProjectsController < ApplicationController\n    def show\n+     # show.html.erb \u306e @project.tasks.build \u3092 @task \u306b\u5909\u66f4\u3057\u305f\u305f\u3081\u8ffd\u52a0\n+     @task = Task.new\n    end\n\n\n\n\u6700\u5f8c\u306b\n\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092 flash \u3067 ProjectsController \u306b\u6e21\u3059\u65b9\u6cd5\u3082\u8a66\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306f\u3053\u306e\u65b9\u6cd5\u304c\u3057\u3063\u304f\u308a\u304d\u307e\u3057\u305f\u3002\n\u307e\u3060\u307e\u3060\u3001Rails\u521d\u5fc3\u8005\u306a\u306e\u3067\u3001\u4ed6\u306b\u3082\u3063\u3068\u30d9\u30bf\u30fc\u306a\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u3001\u6559\u3048\u3066\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n#\uff03 \u306f\u3058\u3081\u306b\n\u30c9\u30c3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e[Ruby on Rails 4\u5165\u9580](http://dotinstall.com/lessons/basic_rails_v2)\u3067\u306f\u3001\u300cProject\u300d\u3068\u300cTask\u300d\u306e\uff12\u3064\u306e\u5165\u529b\u753b\u9762\u304c\u3042\u308a\u3001\u30ec\u30c3\u30b9\u30f3\u5185\u3067\u306f\u3001Project\u5074\u306e\u307f\u3001\u5165\u529b\u30a8\u30e9\u30fc\u6642\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3055\u305b\u308b\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001Project\u5074\u306e\u5b9f\u88c5\u3092\u53c2\u8003\u306bTask\u5074\u306e\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u3061\u3087\u3063\u3068\u3064\u307e\u305a\u3044\u305f\u306e\u3067\u3001\u305d\u306e\u3068\u304d\u306e\u5099\u5fd8\u9332\u3067\u3059\u3002\n\n## \u30d0\u30fc\u30b8\u30e7\u30f3\n    % ruby -v\n    ruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n\n    % rails -v\n    Rails 4.2.7.1\n\n## \u4f5c\u696d\u306e\u6d41\u308c\n##### <font color=\"red\">task.rb \u4fee\u6b63\u524d</font>\n```ruby:/app/models/task.rb\n  class Task < ActiveRecord::Base\n    belongs_to :project\n-   validates :title, presence: true\n    scope :unfinished, -> { where(done: false) }\n  end\n```\n\n##### <font color=\"blue\">task.rb \u4fee\u6b63\u5f8c</font>\n```ruby:/app/models/task.rb\n  class Task < ActiveRecord::Base\n    belongs_to :project\n+   validates :title,\n+     presence: { message: \"\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\" },\n+     length: { minimum: 3, message: \"\u77ed\u3059\u304e\uff01\" }\n    scope :unfinished, -> { where(done: false) }\n  end\n```\n<br>\n\n##### <font color=\"red\">tasks_controller.rb \u4fee\u6b63\u524d</font>\n```ruby:/app/controllers/tasks_controller.rb\n  class TasksController < ApplicationController\n    def create\n      @project = Project.find(params[:project_id])\n-     @task = @project.tasks.create(task_params)\n-     redirect_to project_path(@project.id)\n    end\n```\n\n##### <font color=\"blue\">tasks_controller.rb \u4fee\u6b63\u5f8c</font>\n```ruby:/app/controllers/tasks_controller.rb\n  class TasksController < ApplicationController\n    def create\n      @project = Project.find(params[:project_id])\n+     @task = @project.tasks.build(task_params)\n+     if @task.save\n+       redirect_to project_path(@project.id)\n+     else\n+       # @project.tasks.build \u3067 tasks \u306b1\u884c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u308b\n+       # \u305d\u306e\u307e\u307e\u3060\u3068\u4e00\u89a7\u306b\u30a8\u30e9\u30fc\u306e\u5206\u3082\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u518d\u53d6\u5f97\u3059\u308b\n+       @project = Project.find(params[:project_id])\n+       render 'projects/show'\n+     end\n    end\n```\n\n<br>\n\n##### <font color=\"red\">show.html.erb \u4fee\u6b63\u524d</font>\n```erb:/app/views/projects/show.html.erb\n- <%= form_for [@project, @project.tasks.build] do |f| %>\n  <p>\n    <%= f.text_field :title %>\n  </p>\n```\n\n##### <font color=\"blue\">show.html.erb \u4fee\u6b63\u5f8c</font>\n```erb:/app/views/projects/show.html.erb\n+ <%# @project.tasks.build \u3060\u3068 @task.errors \u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u5165\u3089\u306a\u3044\u305f\u3081 @task \u306b\u5909\u66f4 %>\n+ <%= form_for [@project, @task] do |f| %>\n  <p>\n    <%= f.text_field :title %>\n+   <% if @task.errors.any? %>\n+     <%= @task.errors.messages[:title][0] %>\n+   <% end %>\n  </p>\n```\n\n<br>\n\n##### <font color=\"red\">projects_controller.rb \u4fee\u6b63\u524d</font>\n```ruby:/app/controllers/projects_controller.rb\n  class ProjectsController < ApplicationController\n    def show\n    end\n```\n\n##### <font color=\"blue\">projects_controller.rb \u4fee\u6b63\u5f8c</font>\n```ruby:/app/controllers/projects_controller.rb\n  class ProjectsController < ApplicationController\n    def show\n+     # show.html.erb \u306e @project.tasks.build \u3092 @task \u306b\u5909\u66f4\u3057\u305f\u305f\u3081\u8ffd\u52a0\n+     @task = Task.new\n    end\n```\n\n## \u6700\u5f8c\u306b\n\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092 flash \u3067 ProjectsController \u306b\u6e21\u3059\u65b9\u6cd5\u3082\u8a66\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u500b\u4eba\u7684\u306b\u306f\u3053\u306e\u65b9\u6cd5\u304c\u3057\u3063\u304f\u308a\u304d\u307e\u3057\u305f\u3002\n\u307e\u3060\u307e\u3060\u3001Rails\u521d\u5fc3\u8005\u306a\u306e\u3067\u3001\u4ed6\u306b\u3082\u3063\u3068\u30d9\u30bf\u30fc\u306a\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u3001\u6559\u3048\u3066\u3044\u305f\u3060\u3051\u308b\u3068\u52a9\u304b\u308a\u307e\u3059\u3002\n\n"}