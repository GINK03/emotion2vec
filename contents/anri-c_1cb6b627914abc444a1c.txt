{"tags": ["VPN", "gcp"], "context": "\u74b0\u5883\n\n\n\n\nIP \u30a2\u30c9\u30ec\u30b9\n\n\n\n\nRTX1200\naaa.bbb.ccc.ddd(192.168.0.x/24)\n\n\nGCP\nAAA.BBB.CCC.DDD(10.140.0.0/20)\n\n\n\nRTX1200 \u306f NAT \u914d\u4e0b\u306b\u3042\u3063\u3066\u4e0a\u4f4d\u306e FW \u3067\u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9 aaa.bbb.ccc.ddd \u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\nGCP \u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff0810.140.0.0/20\uff09\u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u3057\u3066 VPN \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u306f\u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9 AAA.BBB.CCC.DDD \u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u308b \n\nGCP VPN \u306e\u8a2d\u5b9a\n\nGCP \u5074\u3067 VPN \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\u30c8\u30f3\u30cd\u30eb\u306e\u4f5c\u6210\n\n\n\nRTX1200 \u306e\u8a2d\u5b9a\ntunnle \u306e ID \u306f\u9069\u5f53\u306b\ntunnel select 100\n description tunnel VPNGCP\n ipsec tunnel 1100\n  ipsec sa policy 1100 100 esp aes-cbc sha-hmac\n  ipsec ike version 100 2\n  ipsec ike always-on 100 on\n  ipsec ike encryption 100 aes-cbc\n  ipsec ike group 100 modp1024\n  ipsec ike hash 100 sha\n  ipsec ike keepalive log 100 on\n  ipsec ike keepalive use 100 on rfc4306\n  ipsec ike local address 100 aaa.bbb.ccc.ddd\n  ipsec ike local name 100 aaa.bbb.ccc.ddd ipv4-addr\n  ipsec ike nat-traversal 100 on\n  ipsec ike pfs 100 on\n  ipsec ike pre-shared-key 100 text ***************** # Preshared Key\n  ipsec ike remote address 100 AAA.BBB.CCC.DDD\n  ipsec ike remote name 100 AAA.BBB.CCC.DDD ipv4-addr\n  ipsec auto refresh 100 on\n ip tunnel tcp mss limit auto\n tunnel enable 100\n\n\u72b6\u6cc1\u306e\u78ba\u8a8d\n> show ipsec sa\n\nsa   sgw isakmp connection   dir  life[s] remote-id\n-----------------------------------------------------------------------------\n5     100  -    ike          -    26867   AAA.BBB.CCC.DDD\n23    100  5    tun[100]esp  send 26867   AAA.BBB.CCC.DDD\n24    100  5    tun[100]esp  recv 26867   AAA.BBB.CCC.DDD\n\n\u8a73\u7d30\u306e\u78ba\u8a8d\n> show ipsec sa gateway 100 detail\nSA[5] Status: Establised  Duration: 26725s\nProtocol: IKEv2\nLocal Host: 192.168.0.x:4500\nRemote Host: AAA.BBB.CCC.DDD:4500\nEncryption Algorithm    : AES256_CBC         PRF     : HMAC_SHA2_256\nAuthentication Algorithm: HMAC_SHA2_256_128  DH Group: MODP_2048\nSPI: 9f 2c ee 14 09 82 41 8c 7a 7d e8 53 7d dd e4 71\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\nSA[23] Status: Establised  Duration: 26725s\nDirection: send\nProtocol: ESP (Mode: tunnel)\nLocal ID : aaa.bbb.ccc.ddd (IPv4_ADDR)\nRemote ID: AAA.BBB.CCC.DDD:4500 (IPv4_ADDR)\nEncryption Algorithm    : AES256_CBC\nAuthentication Algorithm: HMAC_SHA1_96       ESN: DISABLE\nSource Traffic Selector (type / protocol / port / address)\n IPv4-range / any / 0-65535     / 192.168.0.0-192.168.0.255\n IPv4-range / any / 0-65535     / 192.168.0.0-192.168.0.255\nDestination Traffic Selector (type / protocol / port / address)\n IPv4-range / any / 0-65535     / 10.140.0.0-10.140.15.255\n IPv4-range / any / 0-65535     / 10.140.0.0-10.140.15.255\nSPI: 75 22 42 12\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\nSA[24] Status: Establised  Duration: 26725s\nDirection: receive\nProtocol: ESP (Mode: tunnel)\nLocal ID : aaa.bbb.ccc.ddd (IPv4_ADDR)\nRemote ID: AAA.BBB.CCC.DDD:4500 (IPv4_ADDR)\nEncryption Algorithm    : AES256_CBC\nAuthentication Algorithm: HMAC_SHA1_96       ESN: DISABLE\nSPI: 69 92 43 b6\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\n\n\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u306e\u8ffd\u52a0\n# ip route 10.140.0.0/20 gateway tunnel 100\n\n\u3042\u3068\u306f\u3001GCP \u5074\u3067\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u306e\u8abf\u6574\u3092\u884c\u3046\n\u74b0\u5883\n\n|                  |        IP \u30a2\u30c9\u30ec\u30b9  |\n|:-----------------|------------------:|\n| RTX1200          | aaa.bbb.ccc.ddd(192.168.0.x/24)       |\n| GCP     | AAA.BBB.CCC.DDD(10.140.0.0/20)   |\n\nRTX1200 \u306f NAT \u914d\u4e0b\u306b\u3042\u3063\u3066\u4e0a\u4f4d\u306e FW \u3067\u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9 aaa.bbb.ccc.ddd \u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u308b\n\nGCP \u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff0810.140.0.0/20\uff09\u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u3057\u3066 VPN \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306b\u306f\u30b0\u30ed\u30fc\u30d0\u30eb IP \u30a2\u30c9\u30ec\u30b9 AAA.BBB.CCC.DDD \u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u308b \n\n# GCP VPN \u306e\u8a2d\u5b9a\n### GCP \u5074\u3067 VPN \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3068\u30c8\u30f3\u30cd\u30eb\u306e\u4f5c\u6210\n\n<img width=\"527\" alt=\"gateway-gcp.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/5763/eb0fd400-0ccf-2b2a-3849-eb1a1908dad3.png\">\n\n<img width=\"503\" alt=\"tunnel-gcp.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/5763/0f84132e-5788-91c7-46a4-46000d764a90.png\">\n\n\n# RTX1200 \u306e\u8a2d\u5b9a\n\ntunnle \u306e ID \u306f\u9069\u5f53\u306b\n\n``` text\ntunnel select 100\n description tunnel VPNGCP\n ipsec tunnel 1100\n  ipsec sa policy 1100 100 esp aes-cbc sha-hmac\n  ipsec ike version 100 2\n  ipsec ike always-on 100 on\n  ipsec ike encryption 100 aes-cbc\n  ipsec ike group 100 modp1024\n  ipsec ike hash 100 sha\n  ipsec ike keepalive log 100 on\n  ipsec ike keepalive use 100 on rfc4306\n  ipsec ike local address 100 aaa.bbb.ccc.ddd\n  ipsec ike local name 100 aaa.bbb.ccc.ddd ipv4-addr\n  ipsec ike nat-traversal 100 on\n  ipsec ike pfs 100 on\n  ipsec ike pre-shared-key 100 text ***************** # Preshared Key\n  ipsec ike remote address 100 AAA.BBB.CCC.DDD\n  ipsec ike remote name 100 AAA.BBB.CCC.DDD ipv4-addr\n  ipsec auto refresh 100 on\n ip tunnel tcp mss limit auto\n tunnel enable 100\n```\n\n\n\u72b6\u6cc1\u306e\u78ba\u8a8d\n\n```\n> show ipsec sa\n\nsa   sgw isakmp connection   dir  life[s] remote-id\n-----------------------------------------------------------------------------\n5     100  -    ike          -    26867   AAA.BBB.CCC.DDD\n23    100  5    tun[100]esp  send 26867   AAA.BBB.CCC.DDD\n24    100  5    tun[100]esp  recv 26867   AAA.BBB.CCC.DDD\n```\n\n\u8a73\u7d30\u306e\u78ba\u8a8d\n\n```\n> show ipsec sa gateway 100 detail\nSA[5] Status: Establised  Duration: 26725s\nProtocol: IKEv2\nLocal Host: 192.168.0.x:4500\nRemote Host: AAA.BBB.CCC.DDD:4500\nEncryption Algorithm    : AES256_CBC         PRF     : HMAC_SHA2_256\nAuthentication Algorithm: HMAC_SHA2_256_128  DH Group: MODP_2048\nSPI: 9f 2c ee 14 09 82 41 8c 7a 7d e8 53 7d dd e4 71\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\nSA[23] Status: Establised  Duration: 26725s\nDirection: send\nProtocol: ESP (Mode: tunnel)\nLocal ID : aaa.bbb.ccc.ddd (IPv4_ADDR)\nRemote ID: AAA.BBB.CCC.DDD:4500 (IPv4_ADDR)\nEncryption Algorithm    : AES256_CBC\nAuthentication Algorithm: HMAC_SHA1_96       ESN: DISABLE\nSource Traffic Selector (type / protocol / port / address)\n IPv4-range / any / 0-65535     / 192.168.0.0-192.168.0.255\n IPv4-range / any / 0-65535     / 192.168.0.0-192.168.0.255\nDestination Traffic Selector (type / protocol / port / address)\n IPv4-range / any / 0-65535     / 10.140.0.0-10.140.15.255\n IPv4-range / any / 0-65535     / 10.140.0.0-10.140.15.255\nSPI: 75 22 42 12\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\nSA[24] Status: Establised  Duration: 26725s\nDirection: receive\nProtocol: ESP (Mode: tunnel)\nLocal ID : aaa.bbb.ccc.ddd (IPv4_ADDR)\nRemote ID: AAA.BBB.CCC.DDD:4500 (IPv4_ADDR)\nEncryption Algorithm    : AES256_CBC\nAuthentication Algorithm: HMAC_SHA1_96       ESN: DISABLE\nSPI: 69 92 43 b6\nKey: ** ** ** ** **  (confidential)   ** ** ** ** **\n----------------------------------------------------\n```\n\n\n\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u306e\u8ffd\u52a0\n\n```\n# ip route 10.140.0.0/20 gateway tunnel 100\n```\n\n\u3042\u3068\u306f\u3001GCP \u5074\u3067\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u30eb\u30fc\u30eb\u306e\u8abf\u6574\u3092\u884c\u3046\n\n"}