{"context": " More than 1 year has passed since last update.http://qiita.com/items/1596\n\u306e\u6295\u7a3f\u3067\u77e5\u3063\u305f\u30d0\u30b0\u4e88\u6e2c\u30c4\u30fc\u30eb\u306e\u8a08\u7b97\u5f0f\u3092\u5143\u306bTFS\u7ba1\u7406\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3066\u3001\u8a08\u7b97\u3092\u884c\u3046\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3002TFS\u3092\u7ba1\u7406\u3059\u308bSQLServer\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u3002\n\nBugTfs.sql\nDECLARE @T_FILE table (\n    ID int identity(1, 1),\n    ItemId int,\n    [PATH] nvarchar(4000),\n    [FILENAME] nvarchar(4000),\n    COUNT_CHECKIN int,\n    DATE_CREATE] datetime,\n    DATE_LAST_UPDATE datetime,\n    ALIVE_MINUTES money\n)\n\nDECLARE @T_CHECKIN table (\n    ID int identity(1, 1),\n    FileId int,\n    ItemId int,\n    DATE_CHECKIN datetime,\n    DATE_CREATE_AS_SAMEFILE datetime,\n    TIMING float(53)\n)\n\nINSERT INTO @T_FILE\nSELECT\n    tbl_VersionedItem.ItemId,\n    REPLACE(REPLACE(tbl_VersionedItem.ParentPath, '>', '_'), '\\', '/') AS [PATH],\n    REPLACE(REPLACE(tbl_VersionedItem.ChildItem, '>', '_'), '\\', '') AS [FILENAME],\n    T_FILE.[COUNT] AS COUNT_CHECKIN,\n    T_FILE.MIN_DATE_UPDATE,\n    T_FILE.MAX_DATE_UPDATE,\n    DATEDIFF(D, T_FILE.MIN_DATE_UPDATE, T_FILE.MAX_DATE_UPDATE)\nFROM\n    tbl_VersionedItem\n    INNER JOIN (\n        SELECT\n            tbl_File.ItemId,\n            COUNT(*) AS [COUNT],\n            MIN(tbl_File.CreationDate) AS MIN_DATE_UPDATE,\n            MAX(tbl_File.CreationDate) AS MAX_DATE_UPDATE\n        FROM\n            tbl_File\n        GROUP BY\n            tbl_File.ItemId\n    ) AS T_FILE ON tbl_VersionedItem.ItemId = T_FILE.ItemId\n\nINSERT INTO @T_CHECKIN\nSELECT\n    tbl_File.FileId,\n    tbl_File.ItemId,\n    tbl_File.CreationDate,\n    A_FILE.DATE_CREATE] AS DATE_CREATE_AS_SAMEFILE,\n    null\nFROM\n    tbl_File\n    LEFT OUTER JOIN @T_FILE AS A_FILE ON tbl_File.ItemId = A_FILE.ItemId\n\nUPDATE @T_CHECKIN\nSET DATE_CREATE_AS_SAMEFILE = ISNULL(MIN_CHECKIN.MIN_DATE, NULL)\nFROM\n    @T_CHECKIN AS A_CHECKIN\n    LEFT OUTER JOIN (\n        SELECT\n            tbl_File.ItemId,\n            MIN(tbl_File.CreationDate) AS MIN_DATE\n        FROM\n            tbl_File\n        GROUP BY\n            tbl_File.ItemId\n    ) AS MIN_CHECKIN ON A_CHECKIN.ItemId = MIN_CHECKIN.ItemId\n\nUPDATE @T_CHECKIN\nSET TIMING = CONVERT(float(53), DATEDIFF(D, DATE_CREATE_AS_SAMEFILE, DATE_CHECKIN)) / CONVERT(float(53), DATEDIFF(D, DATE_CREATE_AS_SAMEFILE, GETDATE()))\nWHERE\n    DATEDIFF(D, DATE_CREATE_AS_SAMEFILE, GETDATE()) <> 0\n\n\n\nSELECT\n    A_FILE.[PATH],\n    A_FILE.[FILENAME],\n    T_SCORE.SCORE\nFROM\n    @T_FILE AS A_FILE\n    INNER JOIN (\n        SELECT\n            A_CHECKIN.ItemId AS ItemId,\n            SUM(1/(1+EXP(-12*TIMING+12))) AS SCORE\n        FROM\n            @T_CHECKIN AS A_CHECKIN\n        GROUP BY\n            A_CHECKIN.ItemId\n    ) AS T_SCORE ON A_FILE.ItemId = T_SCORE.ItemId\nORDER BY\n    T_SCORE.SCORE desc\n\n\nhttp://qiita.com/items/1596\n\u306e\u6295\u7a3f\u3067\u77e5\u3063\u305f\u30d0\u30b0\u4e88\u6e2c\u30c4\u30fc\u30eb\u306e\u8a08\u7b97\u5f0f\u3092\u5143\u306bTFS\u7ba1\u7406\u3057\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3057\u3066\u3001\u8a08\u7b97\u3092\u884c\u3046\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3002TFS\u3092\u7ba1\u7406\u3059\u308bSQLServer\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u3002\n\n```sql:BugTfs.sql\nDECLARE @T_FILE table (\n\tID int identity(1, 1),\n\tItemId int,\n\t[PATH] nvarchar(4000),\n\t[FILENAME] nvarchar(4000),\n\tCOUNT_CHECKIN int,\n\tDATE_CREATE] datetime,\n\tDATE_LAST_UPDATE datetime,\n\tALIVE_MINUTES money\n)\n\nDECLARE @T_CHECKIN table (\n\tID int identity(1, 1),\n\tFileId int,\n\tItemId int,\n\tDATE_CHECKIN datetime,\n\tDATE_CREATE_AS_SAMEFILE datetime,\n\tTIMING float(53)\n)\n\nINSERT INTO @T_FILE\nSELECT\n\ttbl_VersionedItem.ItemId,\n\tREPLACE(REPLACE(tbl_VersionedItem.ParentPath, '>', '_'), '\\', '/') AS [PATH],\n\tREPLACE(REPLACE(tbl_VersionedItem.ChildItem, '>', '_'), '\\', '') AS [FILENAME],\n\tT_FILE.[COUNT] AS COUNT_CHECKIN,\n\tT_FILE.MIN_DATE_UPDATE,\n\tT_FILE.MAX_DATE_UPDATE,\n\tDATEDIFF(D, T_FILE.MIN_DATE_UPDATE, T_FILE.MAX_DATE_UPDATE)\nFROM\n\ttbl_VersionedItem\n\tINNER JOIN (\n\t\tSELECT\n\t\t\ttbl_File.ItemId,\n\t\t\tCOUNT(*) AS [COUNT],\n\t\t\tMIN(tbl_File.CreationDate) AS MIN_DATE_UPDATE,\n\t\t\tMAX(tbl_File.CreationDate) AS MAX_DATE_UPDATE\n\t\tFROM\n\t\t\ttbl_File\n\t\tGROUP BY\n\t\t\ttbl_File.ItemId\n\t) AS T_FILE ON tbl_VersionedItem.ItemId = T_FILE.ItemId\n\nINSERT INTO @T_CHECKIN\nSELECT\n\ttbl_File.FileId,\n\ttbl_File.ItemId,\n\ttbl_File.CreationDate,\n\tA_FILE.DATE_CREATE] AS DATE_CREATE_AS_SAMEFILE,\n\tnull\nFROM\n\ttbl_File\n\tLEFT OUTER JOIN @T_FILE AS A_FILE ON tbl_File.ItemId = A_FILE.ItemId\n\nUPDATE @T_CHECKIN\nSET DATE_CREATE_AS_SAMEFILE = ISNULL(MIN_CHECKIN.MIN_DATE, NULL)\nFROM\n\t@T_CHECKIN AS A_CHECKIN\n\tLEFT OUTER JOIN (\n\t\tSELECT\n\t\t\ttbl_File.ItemId,\n\t\t\tMIN(tbl_File.CreationDate) AS MIN_DATE\n\t\tFROM\n\t\t\ttbl_File\n\t\tGROUP BY\n\t\t\ttbl_File.ItemId\n\t) AS MIN_CHECKIN ON A_CHECKIN.ItemId = MIN_CHECKIN.ItemId\n\nUPDATE @T_CHECKIN\nSET TIMING = CONVERT(float(53), DATEDIFF(D, DATE_CREATE_AS_SAMEFILE, DATE_CHECKIN)) / CONVERT(float(53), DATEDIFF(D, DATE_CREATE_AS_SAMEFILE, GETDATE()))\nWHERE\n\tDATEDIFF(D, DATE_CREATE_AS_SAMEFILE, GETDATE()) <> 0\n\n\n\nSELECT\n\tA_FILE.[PATH],\n\tA_FILE.[FILENAME],\n\tT_SCORE.SCORE\nFROM\n\t@T_FILE AS A_FILE\n\tINNER JOIN (\n\t\tSELECT\n\t\t\tA_CHECKIN.ItemId AS ItemId,\n\t\t\tSUM(1/(1+EXP(-12*TIMING+12))) AS SCORE\n\t\tFROM\n\t\t\t@T_CHECKIN AS A_CHECKIN\n\t\tGROUP BY\n\t\t\tA_CHECKIN.ItemId\n\t) AS T_SCORE ON A_FILE.ItemId = T_SCORE.ItemId\nORDER BY\n\tT_SCORE.SCORE desc\n```", "tags": ["SQLServer", "TFS"]}