{"context": " More than 1 year has passed since last update.DD-WRT\u3068\u306f\u3001OpenWRT\u304b\u3089\u6d3e\u751f\u3057\u3066\u958b\u767a\u3055\u308c\u305f\u30b3\u30f3\u30d1\u30af\u30c8\u306aLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30eb\u30fc\u30bf\u306a\u3069\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u66f8\u304d\u63db\u3048\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3084\u308b\u3053\u3068\n\u81ea\u5b85\u306eDD-WRT\u304b\u3089\u3001\u3055\u304f\u3089\u306eVPS\u306bOpenVPN\u3092\u4f7f\u3063\u3066VPN(L3\u30c8\u30f3\u30cd\u30eb)\u3092\u5f35\u308a\u307e\u3059\u3002\n\u8a8d\u8a3c\u306b\u306f\u5171\u6709\u9375\u65b9\u5f0f\u3092\u63a1\u7528\u3057\u307e\u3059\u3002\n\u30c8\u30f3\u30cd\u30eb\u78ba\u7acb\u5f8c\u3001\u758e\u901a\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\u203bDD-WRT\u81ea\u4f53\u306e\u5c0e\u5165\u306b\u306f\u89e6\u308c\u307e\u305b\u3093\u3002\n\u203bOpenVPN\u306f\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u72b6\u614b\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\n\u74b0\u5883\n\n\u30b5\u30fc\u30d0(\u5927\u962a)\n\n\n\u3055\u304f\u3089\u306eVPS 1GB\u30d7\u30e9\u30f3\n(CentOS 6.7 x86_64)\nOpenVPN \u30d0\u30fc\u30b8\u30e7\u30f32.2.2\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8(\u6771\u4eac)\n\n\u7121\u7ddaLAN\u30eb\u30fc\u30bf BUFFALO WZR-HP-G300NH2 \n(DD-WRT v24SP2-MULTI (06/03/12) std - build 19154)\nOpenVPN \u30d0\u30fc\u30b8\u30e7\u30f32.2.1\n\n\n\u4e8b\u524d\u4f5c\u696d\n\n\u5171\u6709\u9375\u306e\u4f5c\u6210\n\u30b5\u30fc\u30d0\u304b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u3044\u305a\u308c\u304b\u3067\u5171\u901a\u9375\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n$ openvpn --genkey --secret /tmp/static.key\n\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306e\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n#\n# 2048 bit OpenVPN static key\n#\n-----BEGIN OpenVPN Static key V1-----\n \u3000\u3000\u3000\u3000\u3000\u3000\u3000(\u7565)\n-----END OpenVPN Static key V1-----\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u901a\u9375\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u540c\u4e00\u306e\u9375\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u76f8\u624b\u306e\u7aef\u672b\u306b\u3082SCP\u306a\u3069\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u8a2d\u5b9a\n\n\u5171\u901a\u8a2d\u5b9a\n\u30b5\u30fc\u30d0\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e21\u65b9\u3067\u6307\u5b9a\u3059\u308bOpenVPN\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\n\u8a2d\u5b9a\u5024\n\u30e1\u30e2\n\n\n\n\ndev\ntun\n\u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9\n\n\nproto\nudp\n\u901a\u4fe1\u306b\u4f7f\u7528\u3059\u308b\u30d7\u30ed\u30c8\u30b3\u30eb\n\n\nifconfig\nIP1 IP2\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u6307\u5b9a\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9 (IP1:\u30ed\u30fc\u30ab\u30eb, IP2:\u30ea\u30e2\u30fc\u30c8)\n\n\nsecret\n\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\n\u751f\u6210\u3057\u305f\u5171\u6709\u9375\u3092\u6307\u5b9a\n\n\nauth\nSHA1\nHMAC\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n\n\ncipher\nBF-CBC\n\u30d1\u30b1\u30c3\u30c8\u6697\u53f7\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n\n\ncomp-lzo\n-\nLZO\u5727\u7e2e\u3092\u6709\u52b9\n\n\n\n\n\u30b5\u30fc\u30d0\n\n\u8a2d\u5b9a\n\n\u5171\u6709\u9375\u3092\u914d\u7f6e\n\n\u4e8b\u524d\u8a2d\u5b9a\u3067\u751f\u6210\u3057\u305f\u5171\u901a\u9375\u3092\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u79fb\u52d5\u3057\u3001\u6240\u6709\u8005\u3068\u6a29\u9650\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n$ sudo mkdir /etc/openvpn/ddwrt\n$ sudo mv /tmp/static.key /etc/openvpn/ddwrt/static.key\n$ sudo chown root:root /etc/openvpn/ddwrt/static.key\n$ sudo chmod 600 /etc/openvpn/ddwrt/static.key\n\n\n\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u6295\u5165\n\n\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncat > /etc/openvpn/ddwrt.conf << EOL\ndev tun\nproto udp\nport 11194\n\nifconfig 192.168.99.1 192.168.99.2\nsecret /etc/openvpn/ddwrt/static.key\ncomp-lzo\n\n# \u6a29\u9650\nuser nobody\ngroup nobody\npersist-tun\npersist-key\n\n# \u30ed\u30b0\nlog-append /var/log/static_openvpn.log\nEOL\n\n\n\u8d77\u52d5\nOpenVPN\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo service restart openvpn\nopenvpn \u3092\u505c\u6b62\u4e2d:                                          [  OK  ]\nopenvpn \u3092\u8d77\u52d5\u4e2d:                                          [  OK  ]\n$\n\n\u8d77\u52d5OK\u3092\u78ba\u8a8d\u3057\u3001\u30ed\u30b0\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u306a\u3051\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b \u30dd\u30fc\u30c811194(UDP) \u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n\n\u8a2d\u5b9a\n\nDD-WRT\u306b\u30ed\u30b0\u30a4\u30f3\n\n\u30d6\u30e9\u30a6\u30b6\u3067DD-WRT\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fDD-WRT\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092 192.168.0.77 \u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nhttp://192.168.0.77/\n\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u306f\u30c7\u30b6\u30a4\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n(\u3053\u3053\u3067\u306f\u3001\u7c73BUFFALO\u304cDD-WRT\u3092\u30ab\u30b9\u30bf\u30e0\u3057\u3066\u516c\u958b\u3057\u3066\u3044\u308b\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002)\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u6295\u5165\n\n\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u306f\u3001\u30e1\u30e2\u30ea\u4e0a\u306b\u3042\u308b\u305f\u3081\u96fb\u6e90\u3092\u843d\u3068\u3059\u304b\u518d\u8d77\u52d5\u3092\u3059\u308b\u3068\u6d88\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3057\u3066\u3001\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u7528\u306envram\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\u30e1\u30cb\u30e5\u30fc[Administration] -> \u30b5\u30d6\u30e1\u30cb\u30e5\u30fc[Commands] \u3092\u958b\u304d\u307e\u3059\u3002\n[Command Shell] \u306b\u63a5\u7d9a\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8cbc\u308a\u4ed8\u3051\u307e\u3059\u3002\nmkdir /tmp/openvpn\n\ncat > /tmp/openvpn/vps.conf << EOL\ndev tun\nproto udp\nremote \u63a5\u7d9a\u5148(VPN\u30b5\u30fc\u30d0)IP 11194\nifconfig 192.168.99.2 192.168.99.1\nsecret /tmp/openvpn/secret.key\ndaemon\nnobind\ncomp-lzo\nEOL\n\ncat > /tmp/openvpn/secret.key << EOL\n-----BEGIN OpenVPN Static key V1-----\n             (\u4e2d\u7565)\n-----END OpenVPN Static key V1-----\nEOL\n\ncat > /tmp/openvpn/startup << EOL\n#!/bin/sh\nPROCESS=\\`ps w | grep openvpn | egrep -v 'grep|/bin/sh' | wc -l\\`\nif [ \\$PROCESS -eq 0 ]; then\n  /usr/sbin/openvpn --config /tmp/openvpn/vps.conf &\nfi\nEOL\n\nchmod a+x /tmp/openvpn/startup\n\necho \"* * * * * root /tmp/openvpn/startup\" > /tmp/cron.d/openvpn\n\nstopservice cron && startservice cron\n\nexit 0\n\n\n[Save Startup]\u3092\u62bc\u4e0b\u3059\u308b\u3068\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u304d\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\nOpenVPN\u63a5\u7d9a\u7528\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\u5171\u901a\u9375\u3092\u4f5c\u6210\n\u63a5\u7d9a\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210(\u591a\u91cd\u63a5\u7d9a\u3057\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059)\n\u63a5\u7d9a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6bce\u5206\u5b9f\u884c\u3059\u308bcron\u3092\u4f5c\u6210\ncron\u3092\u30ea\u30ed\u30fc\u30c9(\u4f5c\u6210\u3057\u305fcron\u304c\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093)\n\n\n\u8d77\u52d5\nDD-WRT\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001cron\u306b\u3088\u3063\u3066OpenVPN\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n\u78ba\u8a8d\nVPN\u304c\u78ba\u7acb\u3059\u308b\u3068\u3001\u30b5\u30fc\u30d0\u5074\u306b\u4ee5\u4e0b\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\nSun Dec  6 01:49:41 2015 Peer Connection Initiated with xxx.xxx.xxx.xxx:34579\nSun Dec  6 01:49:41 2015 Initialization Sequence Completed\n\n\u758e\u901a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8 -> \u30b5\u30fc\u30d0\n\nroot@DD-WRT:~# ping 192.168.99.1\nPING 192.168.99.1 (192.168.99.1): 56 data bytes\n64 bytes from 192.168.99.1: seq=0 ttl=64 time=11.667 ms\n64 bytes from 192.168.99.1: seq=1 ttl=64 time=11.647 ms\n64 bytes from 192.168.99.1: seq=2 ttl=64 time=11.410 ms\n64 bytes from 192.168.99.1: seq=3 ttl=64 time=11.319 ms\n^C\n--- 192.168.99.1 ping statistics ---\n4 packets transmitted, 4 packets received, 0% packet loss\nround-trip min/avg/max = 11.319/11.510/11.667 ms\nroot@DD-WRT:~#\n\n\n\u30b5\u30fc\u30d0 -> \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n\n[XXX@www openvpn]$ ping 192.168.99.2\nPING 192.168.99.2 (192.168.99.2) 56(84) bytes of data.\n64 bytes from 192.168.99.2: icmp_seq=1 ttl=64 time=12.0 ms\n64 bytes from 192.168.99.2: icmp_seq=2 ttl=64 time=11.3 ms\n64 bytes from 192.168.99.2: icmp_seq=3 ttl=64 time=10.9 ms\n64 bytes from 192.168.99.2: icmp_seq=4 ttl=64 time=11.4 ms\n^C\n--- 192.168.99.2 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3290ms\nrtt min/avg/max/mdev = 10.903/11.441/12.081/0.433 ms\n[XXX@www openvpn]$\n\nVPN\u304c\u78ba\u7acb\u3055\u308c\u3001\u758e\u901a\u304c\u3068\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\nVPN\u3092\u7d4c\u7531\u305b\u305a\u76f4\u63a5ping\u3057\u305f\u5834\u5408\u300111ms\u304f\u3089\u3044\u3067\u3057\u305f\u3002\n\n\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\niperf\u3092\u4f7f\u3063\u3066\u6e2c\u5b9a\u3057\u307e\u3057\u305f\u3002\nroot@DD-WRT:~# iperf -c 192.168.99.1 -t 60 -i 2\n------------------------------------------------------------\nClient connecting to 192.168.99.1, TCP port 5001\nTCP window size: 19.1 KByte (default)\n------------------------------------------------------------\n[  3] local 192.168.99.2 port 39459 connected with 192.168.99.1 port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  3]  0.0- 2.0 sec  4.09 MBytes  17.1 Mbits/sec\n[  3]  2.0- 4.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3]  4.0- 6.0 sec  4.14 MBytes  17.4 Mbits/sec\n[  3]  6.0- 8.0 sec  4.15 MBytes  17.4 Mbits/sec\n[  3]  8.0-10.0 sec  4.10 MBytes  17.2 Mbits/sec\n[  3] 10.0-12.0 sec  4.12 MBytes  17.3 Mbits/sec\n[  3] 12.0-14.0 sec  4.05 MBytes  17.0 Mbits/sec\n[  3] 14.0-16.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 16.0-18.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 18.0-20.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 20.0-22.0 sec  4.11 MBytes  17.2 Mbits/sec\n[  3] 22.0-24.0 sec  4.02 MBytes  16.8 Mbits/sec\n[  3] 24.0-26.0 sec  4.09 MBytes  17.1 Mbits/sec\n[  3] 26.0-28.0 sec  4.14 MBytes  17.4 Mbits/sec\n[  3] 28.0-30.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 30.0-32.0 sec  4.11 MBytes  17.2 Mbits/sec\n[  3] 32.0-34.0 sec  4.03 MBytes  16.9 Mbits/sec\n[  3] 34.0-36.0 sec  4.07 MBytes  17.1 Mbits/sec\n[  3] 36.0-38.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 38.0-40.0 sec  4.02 MBytes  16.8 Mbits/sec\n[  3] 40.0-42.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 42.0-44.0 sec  4.07 MBytes  17.1 Mbits/sec\n[  3] 44.0-46.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 46.0-48.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 48.0-50.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 50.0-52.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 52.0-54.0 sec  4.00 MBytes  16.8 Mbits/sec\n[  3] 54.0-56.0 sec  3.84 MBytes  16.1 Mbits/sec\n[  3] 56.0-58.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 58.0-60.0 sec  4.06 MBytes  17.0 Mbits/sec\n[  3]  0.0-60.0 sec   122 MBytes  17.1 Mbits/sec\nroot@DD-WRT:~#\n\n\ntop(DD-WRT)\nroot@DD-WRT:~# top\nMem: 20448K used, 40988K free, 0K shrd, 2952K buff, 7924K cached\nCPU: 46.7% usr 32.4% sys  0.0% nic  8.1% idle  0.0% io  0.0% irq 12.7% sirq\nLoad average: 1.42 0.59 0.22 3/48 1795\n  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND\n 1788     1 root     R     3012  4.8   0 84.9 /usr/sbin/openvpn --config /tmp/o\n 1793  1755 root     S     6128  9.9   0  5.9 iperf -c 192.168.99.1 -t 60 -i 2\n  892     1 root     S     2332  3.7   0  0.2 hostapd -B -P /var/run/ath0_hosta\n 1792  1791 root     R     1336  2.1   0  0.2 top\n 1531     1 root     S     2460  3.9   0  0.0 startservice_f run_rc_startup\n 1749     1 root     S     2164  3.5   0  0.0 httpd -p 80\n  547     1 root     S     1720  2.7   0  0.0 watchdog\n 1520     1 root     S     1708  2.7   0  0.0 wland\n 1754     1 root     S     1680  2.7   0  0.0 resetbutton\n 1127     1 root     S     1468  2.3   0  0.0 process_monitor\n 1791  1756 root     S     1336  2.1   0  0.0 -sh\n 1755  1354 root     S     1336  2.1   0  0.0 -sh\n  964     1 root     S     1324  2.1   0  0.0 telnetd\n    1     0 root     S     1304  2.1   0  0.0 /sbin/init\n 1354  1005 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1756  1005 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1005     1 root     S     1196  1.9   0  0.0 dropbear -b /tmp/loginprompt -r /\n  989     1 root     S      884  1.4   0  0.0 dnsmasq --conf-file=/tmp/dnsmasq.\n  543     1 root     S      844  1.3   0  0.0 /sbin/mstpd\n  529     1 root     S      796  1.2   0  0.0 /sbin/hotplug2 --set-rules-file /\n\n\n\n60\u79d2\u9593\u6e2c\u5b9a\u3057\u5e73\u5747\u304c 17.1 Mbits/sec \u3068\u3044\u3046\u30b9\u30b3\u30a2\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u8ca0\u8377\u3092\u898b\u305f\u611f\u3058DD-WRT\u306eCPU\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3044\u305d\u3046\u3067\u3059\u3002\n\u76f4\u63a5\u63a5\u7d9a\u3067\u6e2c\u5b9a\u3057\u305f\u5834\u5408\u300123.8Mbits/sec\u3067\u3057\u305f\u3002\n\n\u307e\u3068\u3081\n\u7121\u4e8b\u3001\u758e\u901a\u306e\u78ba\u8a8d\u304c\u884c\u3048\u305f\u3002\nOpenVPN\u306f\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2VPN\u306e\u305f\u3081\u3001CPU\u8ca0\u8377\u306b\u3088\u3063\u3066\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306b\u30d0\u30e9\u3064\u304d\u304c\u3067\u305d\u3046\u3002\n\u4eca\u56de\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u304b\u3092\u716e\u8a70\u3081\u308b\u3068\u307e\u3060\u3044\u3044\u5024\u304c\u3067\u305f\u304b\u3082\u3002\n\n\u53c2\u8003\u30da\u30fc\u30b8\nStatic Key Mini-HOWTO\nOpenVPN 2.0.x\n\n\u304a\u307e\u3051\n\u5b89\u5168\u3067\u306f\u306a\u304f\u306a\u308a\u307e\u3059\u304c\u3001\u8a8d\u8a3c\u3068\u6697\u53f7\u3092\u7121\u52b9\u306b\u3057\u3066\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u6e2c\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nauth none\ncipher none\n\n\niperf(DD-WRT)\nroot@DD-WRT:~# iperf -c 192.168.99.1 -t 60 -i 2\n------------------------------------------------------------\nClient connecting to 192.168.99.1, TCP port 5001\nTCP window size: 19.5 KByte (default)\n------------------------------------------------------------\n[  3] local 192.168.99.2 port 44942 connected with 192.168.99.1 port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  3]  0.0- 2.0 sec  4.00 MBytes  16.8 Mbits/sec\n[  3]  2.0- 4.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3]  4.0- 6.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3]  6.0- 8.0 sec  4.30 MBytes  18.1 Mbits/sec\n[  3]  8.0-10.0 sec  4.34 MBytes  18.2 Mbits/sec\n[  3] 10.0-12.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 12.0-14.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 14.0-16.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 16.0-18.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 18.0-20.0 sec  4.35 MBytes  18.3 Mbits/sec\n[  3] 20.0-22.0 sec  4.35 MBytes  18.3 Mbits/sec\n[  3] 22.0-24.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 24.0-26.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 26.0-28.0 sec  4.31 MBytes  18.1 Mbits/sec\n[  3] 28.0-30.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 30.0-32.0 sec  4.31 MBytes  18.1 Mbits/sec\n[  3] 32.0-34.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3] 34.0-36.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3] 36.0-38.0 sec  4.38 MBytes  18.4 Mbits/sec\n[  3] 38.0-40.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 40.0-42.0 sec  4.23 MBytes  17.7 Mbits/sec\n[  3] 42.0-44.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 44.0-46.0 sec  4.21 MBytes  17.7 Mbits/sec\n[  3] 46.0-48.0 sec  4.36 MBytes  18.3 Mbits/sec\n[  3] 48.0-50.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 50.0-52.0 sec  4.34 MBytes  18.2 Mbits/sec\n[  3] 52.0-54.0 sec  4.28 MBytes  18.0 Mbits/sec\n[  3] 54.0-56.0 sec  4.30 MBytes  18.0 Mbits/sec\n[  3] 56.0-58.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 58.0-60.0 sec  4.30 MBytes  18.1 Mbits/sec\n[  3]  0.0-60.0 sec   128 MBytes  17.9 Mbits/sec\nroot@DD-WRT:~#\n\n\n\ntop(DD-WRT)\nMem: 22032K used, 39404K free, 0K shrd, 3284K buff, 9200K cached\nCPU: 14.0% usr 22.0% sys  0.0% nic 51.9% idle  0.0% io  0.0% irq 11.9% sirq\nLoad average: 0.64 0.25 0.16 3/47 2302\n  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND\n 1816     1 root     R     3004  4.8   0 35.0 /usr/sbin/openvpn --config /tmp/o\n 2266  2220 root     S     6128  9.9   0  8.9 iperf -c 192.168.99.1 -t 60 -i 2\n 1744     1 root     S     2660  4.3   0  0.5 httpd -p 80\n 2255  2252 root     R     1336  2.1   0  0.2 top\n  888     1 root     S     2332  3.7   0  0.0 hostapd -B -P /var/run/ath0_hosta\n  544     1 root     S     1720  2.7   0  0.0 watchdog\n 1506     1 root     S     1708  2.7   0  0.0 wland\n 1749     1 root     S     1680  2.7   0  0.0 resetbutton\n 1141     1 root     S     1468  2.3   0  0.0 process_monitor\n 2220  2217 root     S     1336  2.1   0  0.0 -sh\n 2252  2251 root     S     1336  2.1   0  0.0 -sh\n  963     1 root     S     1324  2.1   0  0.0 telnetd\n    1     0 root     S     1304  2.1   0  0.0 /sbin/init\n 2251  1029 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 2217  1029 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1029     1 root     S     1196  1.9   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1002     1 root     S      884  1.4   0  0.0 dnsmasq --conf-file=/tmp/dnsmasq.\n  540     1 root     S      844  1.3   0  0.0 /sbin/mstpd\n  513     1 root     S      796  1.2   0  0.0 /sbin/hotplug2 --set-rules-file /\n 1566     1 root     S      792  1.2   0  0.0 cron\n\n\n\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u4f5c\u6210\u3059\u308b\u51e6\u7406\u304c\u306a\u304f\u306a\u308b\u306e\u3067\u3001CPU\u8ca0\u8377\u304c\u4e0b\u304c\u3063\u3066\u3001\u901f\u5ea6\u3082\u5897\u52a0\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n[DD-WRT](http://www.dd-wrt.com/site/index)\u3068\u306f\u3001OpenWRT\u304b\u3089\u6d3e\u751f\u3057\u3066\u958b\u767a\u3055\u308c\u305f\u30b3\u30f3\u30d1\u30af\u30c8\u306aLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30eb\u30fc\u30bf\u306a\u3069\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u66f8\u304d\u63db\u3048\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# \u3084\u308b\u3053\u3068\n\u81ea\u5b85\u306eDD-WRT\u304b\u3089\u3001\u3055\u304f\u3089\u306eVPS\u306bOpenVPN\u3092\u4f7f\u3063\u3066VPN(L3\u30c8\u30f3\u30cd\u30eb)\u3092\u5f35\u308a\u307e\u3059\u3002\n\u8a8d\u8a3c\u306b\u306f\u5171\u6709\u9375\u65b9\u5f0f\u3092\u63a1\u7528\u3057\u307e\u3059\u3002\n\u30c8\u30f3\u30cd\u30eb\u78ba\u7acb\u5f8c\u3001\u758e\u901a\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002\n\u203bDD-WRT\u81ea\u4f53\u306e\u5c0e\u5165\u306b\u306f\u89e6\u308c\u307e\u305b\u3093\u3002\n\u203bOpenVPN\u306f\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308b\u72b6\u614b\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\n# \u74b0\u5883\n## \u30b5\u30fc\u30d0(\u5927\u962a)\n* [\u3055\u304f\u3089\u306eVPS](http://vps.sakura.ad.jp/) 1GB\u30d7\u30e9\u30f3<br>\n (CentOS 6.7 x86_64)\n* OpenVPN \u30d0\u30fc\u30b8\u30e7\u30f32.2.2\n\n## \u30af\u30e9\u30a4\u30a2\u30f3\u30c8(\u6771\u4eac)\n* \u7121\u7ddaLAN\u30eb\u30fc\u30bf [BUFFALO WZR-HP-G300NH2](http://buffalo.jp/products/catalog/network/wzr-hp-g300nh/) <br>\n (DD-WRT v24SP2-MULTI (06/03/12) std - build 19154)\n* OpenVPN \u30d0\u30fc\u30b8\u30e7\u30f32.2.1\n\n# \u4e8b\u524d\u4f5c\u696d\n## \u5171\u6709\u9375\u306e\u4f5c\u6210\n\u30b5\u30fc\u30d0\u304b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u3044\u305a\u308c\u304b\u3067\u5171\u901a\u9375\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n`$ openvpn --genkey --secret /tmp/static.key`\n\u4ee5\u4e0b\u306e\u5f62\u5f0f\u306e\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n```\n#\n# 2048 bit OpenVPN static key\n#\n-----BEGIN OpenVPN Static key V1-----\n \u3000\u3000\u3000\u3000\u3000\u3000\u3000(\u7565)\n-----END OpenVPN Static key V1-----\n```\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u901a\u9375\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u540c\u4e00\u306e\u9375\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u76f8\u624b\u306e\u7aef\u672b\u306b\u3082SCP\u306a\u3069\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n# \u8a2d\u5b9a\n## \u5171\u901a\u8a2d\u5b9a\n\u30b5\u30fc\u30d0\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u4e21\u65b9\u3067\u6307\u5b9a\u3059\u308bOpenVPN\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3059\u3002\n\n| \u30d1\u30e9\u30e1\u30fc\u30bf | \u8a2d\u5b9a\u5024 | \u30e1\u30e2 |\n|:-----------|:---------|:------|\n| dev | tun | \u4eee\u60f3\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9 |\n| proto | udp | \u901a\u4fe1\u306b\u4f7f\u7528\u3059\u308b\u30d7\u30ed\u30c8\u30b3\u30eb |\n| ifconfig | IP1 IP2| \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c7\u30d0\u30a4\u30b9\u306b\u6307\u5b9a\u3059\u308bIP\u30a2\u30c9\u30ec\u30b9 (IP1:\u30ed\u30fc\u30ab\u30eb, IP2:\u30ea\u30e2\u30fc\u30c8)  |\n| secret | \u30d5\u30a1\u30a4\u30eb\u30d1\u30b9 | \u751f\u6210\u3057\u305f\u5171\u6709\u9375\u3092\u6307\u5b9a |\n| auth | SHA1 | HMAC\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024) |\n| cipher| BF-CBC | \u30d1\u30b1\u30c3\u30c8\u6697\u53f7\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024) |\n| comp-lzo | - | LZO\u5727\u7e2e\u3092\u6709\u52b9 |\n\n## \u30b5\u30fc\u30d0\n### \u8a2d\u5b9a\n\n* \u5171\u6709\u9375\u3092\u914d\u7f6e\n\n\u4e8b\u524d\u8a2d\u5b9a\u3067\u751f\u6210\u3057\u305f\u5171\u901a\u9375\u3092\u8a2d\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u79fb\u52d5\u3057\u3001\u6240\u6709\u8005\u3068\u6a29\u9650\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n$ sudo mkdir /etc/openvpn/ddwrt\n$ sudo mv /tmp/static.key /etc/openvpn/ddwrt/static.key\n$ sudo chown root:root /etc/openvpn/ddwrt/static.key\n$ sudo chmod 600 /etc/openvpn/ddwrt/static.key\n```\n\n\n* \u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u6295\u5165\n\n\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\ncat > /etc/openvpn/ddwrt.conf << EOL\ndev tun\nproto udp\nport 11194\n\nifconfig 192.168.99.1 192.168.99.2\nsecret /etc/openvpn/ddwrt/static.key\ncomp-lzo\n\n# \u6a29\u9650\nuser nobody\ngroup nobody\npersist-tun\npersist-key\n\n# \u30ed\u30b0\nlog-append /var/log/static_openvpn.log\nEOL\n```\n\n### \u8d77\u52d5\nOpenVPN\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ sudo service restart openvpn\nopenvpn \u3092\u505c\u6b62\u4e2d:                                          [  OK  ]\nopenvpn \u3092\u8d77\u52d5\u4e2d:                                          [  OK  ]\n$\n```\n\n\u8d77\u52d5OK\u3092\u78ba\u8a8d\u3057\u3001\u30ed\u30b0\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u306a\u3051\u308c\u3070\u8a2d\u5b9a\u5b8c\u4e86\u3067\u3059\u3002\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306f\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b \u30dd\u30fc\u30c811194(UDP) \u3092\u8a31\u53ef\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n## \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n### \u8a2d\u5b9a\n\n* DD-WRT\u306b\u30ed\u30b0\u30a4\u30f3\n\n\u30d6\u30e9\u30a6\u30b6\u3067DD-WRT\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306fDD-WRT\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092 192.168.0.77 \u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n[http://192.168.0.77/](http://192.168.0.77)\n\n\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u306f\u30c7\u30b6\u30a4\u30f3\u304c\u7570\u306a\u308a\u307e\u3059\u3002\n*(\u3053\u3053\u3067\u306f\u3001[\u7c73BUFFALO](http://www.buffalotech.com/)\u304cDD-WRT\u3092\u30ab\u30b9\u30bf\u30e0\u3057\u3066\u516c\u958b\u3057\u3066\u3044\u308b\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002)*\n![dd-wrt1.png](https://qiita-image-store.s3.amazonaws.com/0/103186/30d39f02-7bfe-8660-3491-ce6663f57f7a.png)\n\n\n* \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u6295\u5165\n\n\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u306f\u3001\u30e1\u30e2\u30ea\u4e0a\u306b\u3042\u308b\u305f\u3081\u96fb\u6e90\u3092\u843d\u3068\u3059\u304b\u518d\u8d77\u52d5\u3092\u3059\u308b\u3068\u6d88\u3048\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30b3\u30f3\u30d5\u30a3\u30b0\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3057\u3066\u3001\u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u7528\u306envram\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n\u30e1\u30cb\u30e5\u30fc[Administration] -> \u30b5\u30d6\u30e1\u30cb\u30e5\u30fc[Commands] \u3092\u958b\u304d\u307e\u3059\u3002\n[Command Shell] \u306b\u63a5\u7d9a\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8cbc\u308a\u4ed8\u3051\u307e\u3059\u3002\n\n```bash\nmkdir /tmp/openvpn\n\ncat > /tmp/openvpn/vps.conf << EOL\ndev tun\nproto udp\nremote \u63a5\u7d9a\u5148(VPN\u30b5\u30fc\u30d0)IP 11194\nifconfig 192.168.99.2 192.168.99.1\nsecret /tmp/openvpn/secret.key\ndaemon\nnobind\ncomp-lzo\nEOL\n\ncat > /tmp/openvpn/secret.key << EOL\n-----BEGIN OpenVPN Static key V1-----\n             (\u4e2d\u7565)\n-----END OpenVPN Static key V1-----\nEOL\n\ncat > /tmp/openvpn/startup << EOL\n#!/bin/sh\nPROCESS=\\`ps w | grep openvpn | egrep -v 'grep|/bin/sh' | wc -l\\`\nif [ \\$PROCESS -eq 0 ]; then\n  /usr/sbin/openvpn --config /tmp/openvpn/vps.conf &\nfi\nEOL\n\nchmod a+x /tmp/openvpn/startup\n\necho \"* * * * * root /tmp/openvpn/startup\" > /tmp/cron.d/openvpn\n\nstopservice cron && startservice cron\n\nexit 0\n\n```\n\n[Save Startup]\u3092\u62bc\u4e0b\u3059\u308b\u3068\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u52d5\u304d\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n0. OpenVPN\u63a5\u7d9a\u7528\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n0. \u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n0. \u5171\u901a\u9375\u3092\u4f5c\u6210\n0. \u63a5\u7d9a\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210(\u591a\u91cd\u63a5\u7d9a\u3057\u306a\u3044\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059)\n0. \u63a5\u7d9a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6bce\u5206\u5b9f\u884c\u3059\u308bcron\u3092\u4f5c\u6210\n0. cron\u3092\u30ea\u30ed\u30fc\u30c9(\u4f5c\u6210\u3057\u305fcron\u304c\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093)\n\n### \u8d77\u52d5\nDD-WRT\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u3001cron\u306b\u3088\u3063\u3066OpenVPN\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n# \u78ba\u8a8d\nVPN\u304c\u78ba\u7acb\u3059\u308b\u3068\u3001\u30b5\u30fc\u30d0\u5074\u306b\u4ee5\u4e0b\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```\nSun Dec  6 01:49:41 2015 Peer Connection Initiated with xxx.xxx.xxx.xxx:34579\nSun Dec  6 01:49:41 2015 Initialization Sequence Completed\n```\n\n**\u758e\u901a\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002**\n\n* \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 -> \u30b5\u30fc\u30d0\n\n```\nroot@DD-WRT:~# ping 192.168.99.1\nPING 192.168.99.1 (192.168.99.1): 56 data bytes\n64 bytes from 192.168.99.1: seq=0 ttl=64 time=11.667 ms\n64 bytes from 192.168.99.1: seq=1 ttl=64 time=11.647 ms\n64 bytes from 192.168.99.1: seq=2 ttl=64 time=11.410 ms\n64 bytes from 192.168.99.1: seq=3 ttl=64 time=11.319 ms\n^C\n--- 192.168.99.1 ping statistics ---\n4 packets transmitted, 4 packets received, 0% packet loss\nround-trip min/avg/max = 11.319/11.510/11.667 ms\nroot@DD-WRT:~#\n```\n\n* \u30b5\u30fc\u30d0 -> \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n\n```\n[XXX@www openvpn]$ ping 192.168.99.2\nPING 192.168.99.2 (192.168.99.2) 56(84) bytes of data.\n64 bytes from 192.168.99.2: icmp_seq=1 ttl=64 time=12.0 ms\n64 bytes from 192.168.99.2: icmp_seq=2 ttl=64 time=11.3 ms\n64 bytes from 192.168.99.2: icmp_seq=3 ttl=64 time=10.9 ms\n64 bytes from 192.168.99.2: icmp_seq=4 ttl=64 time=11.4 ms\n^C\n--- 192.168.99.2 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3290ms\nrtt min/avg/max/mdev = 10.903/11.441/12.081/0.433 ms\n[XXX@www openvpn]$\n```\n\nVPN\u304c\u78ba\u7acb\u3055\u308c\u3001\u758e\u901a\u304c\u3068\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\nVPN\u3092\u7d4c\u7531\u305b\u305a\u76f4\u63a5ping\u3057\u305f\u5834\u5408\u300111ms\u304f\u3089\u3044\u3067\u3057\u305f\u3002\n\n# \u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\niperf\u3092\u4f7f\u3063\u3066\u6e2c\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n```\nroot@DD-WRT:~# iperf -c 192.168.99.1 -t 60 -i 2\n------------------------------------------------------------\nClient connecting to 192.168.99.1, TCP port 5001\nTCP window size: 19.1 KByte (default)\n------------------------------------------------------------\n[  3] local 192.168.99.2 port 39459 connected with 192.168.99.1 port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  3]  0.0- 2.0 sec  4.09 MBytes  17.1 Mbits/sec\n[  3]  2.0- 4.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3]  4.0- 6.0 sec  4.14 MBytes  17.4 Mbits/sec\n[  3]  6.0- 8.0 sec  4.15 MBytes  17.4 Mbits/sec\n[  3]  8.0-10.0 sec  4.10 MBytes  17.2 Mbits/sec\n[  3] 10.0-12.0 sec  4.12 MBytes  17.3 Mbits/sec\n[  3] 12.0-14.0 sec  4.05 MBytes  17.0 Mbits/sec\n[  3] 14.0-16.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 16.0-18.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 18.0-20.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 20.0-22.0 sec  4.11 MBytes  17.2 Mbits/sec\n[  3] 22.0-24.0 sec  4.02 MBytes  16.8 Mbits/sec\n[  3] 24.0-26.0 sec  4.09 MBytes  17.1 Mbits/sec\n[  3] 26.0-28.0 sec  4.14 MBytes  17.4 Mbits/sec\n[  3] 28.0-30.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 30.0-32.0 sec  4.11 MBytes  17.2 Mbits/sec\n[  3] 32.0-34.0 sec  4.03 MBytes  16.9 Mbits/sec\n[  3] 34.0-36.0 sec  4.07 MBytes  17.1 Mbits/sec\n[  3] 36.0-38.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 38.0-40.0 sec  4.02 MBytes  16.8 Mbits/sec\n[  3] 40.0-42.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 42.0-44.0 sec  4.07 MBytes  17.1 Mbits/sec\n[  3] 44.0-46.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 46.0-48.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 48.0-50.0 sec  4.08 MBytes  17.1 Mbits/sec\n[  3] 50.0-52.0 sec  4.09 MBytes  17.2 Mbits/sec\n[  3] 52.0-54.0 sec  4.00 MBytes  16.8 Mbits/sec\n[  3] 54.0-56.0 sec  3.84 MBytes  16.1 Mbits/sec\n[  3] 56.0-58.0 sec  4.13 MBytes  17.3 Mbits/sec\n[  3] 58.0-60.0 sec  4.06 MBytes  17.0 Mbits/sec\n[  3]  0.0-60.0 sec   122 MBytes  17.1 Mbits/sec\nroot@DD-WRT:~#\n```\n\n```text:top(DD-WRT)\nroot@DD-WRT:~# top\nMem: 20448K used, 40988K free, 0K shrd, 2952K buff, 7924K cached\nCPU: 46.7% usr 32.4% sys  0.0% nic  8.1% idle  0.0% io  0.0% irq 12.7% sirq\nLoad average: 1.42 0.59 0.22 3/48 1795\n  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND\n 1788     1 root     R     3012  4.8   0 84.9 /usr/sbin/openvpn --config /tmp/o\n 1793  1755 root     S     6128  9.9   0  5.9 iperf -c 192.168.99.1 -t 60 -i 2\n  892     1 root     S     2332  3.7   0  0.2 hostapd -B -P /var/run/ath0_hosta\n 1792  1791 root     R     1336  2.1   0  0.2 top\n 1531     1 root     S     2460  3.9   0  0.0 startservice_f run_rc_startup\n 1749     1 root     S     2164  3.5   0  0.0 httpd -p 80\n  547     1 root     S     1720  2.7   0  0.0 watchdog\n 1520     1 root     S     1708  2.7   0  0.0 wland\n 1754     1 root     S     1680  2.7   0  0.0 resetbutton\n 1127     1 root     S     1468  2.3   0  0.0 process_monitor\n 1791  1756 root     S     1336  2.1   0  0.0 -sh\n 1755  1354 root     S     1336  2.1   0  0.0 -sh\n  964     1 root     S     1324  2.1   0  0.0 telnetd\n    1     0 root     S     1304  2.1   0  0.0 /sbin/init\n 1354  1005 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1756  1005 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1005     1 root     S     1196  1.9   0  0.0 dropbear -b /tmp/loginprompt -r /\n  989     1 root     S      884  1.4   0  0.0 dnsmasq --conf-file=/tmp/dnsmasq.\n  543     1 root     S      844  1.3   0  0.0 /sbin/mstpd\n  529     1 root     S      796  1.2   0  0.0 /sbin/hotplug2 --set-rules-file /\n\n```\n\n60\u79d2\u9593\u6e2c\u5b9a\u3057\u5e73\u5747\u304c 17.1 Mbits/sec \u3068\u3044\u3046\u30b9\u30b3\u30a2\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u8ca0\u8377\u3092\u898b\u305f\u611f\u3058DD-WRT\u306eCPU\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u3066\u3044\u305d\u3046\u3067\u3059\u3002\n\u76f4\u63a5\u63a5\u7d9a\u3067\u6e2c\u5b9a\u3057\u305f\u5834\u5408\u300123.8Mbits/sec\u3067\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\u7121\u4e8b\u3001\u758e\u901a\u306e\u78ba\u8a8d\u304c\u884c\u3048\u305f\u3002\nOpenVPN\u306f\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2VPN\u306e\u305f\u3081\u3001CPU\u8ca0\u8377\u306b\u3088\u3063\u3066\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306b\u30d0\u30e9\u3064\u304d\u304c\u3067\u305d\u3046\u3002\n\u4eca\u56de\u30b3\u30f3\u30d5\u30a3\u30b0\u3067\u6307\u5b9a\u3057\u306a\u304b\u3063\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u304b\u3092\u716e\u8a70\u3081\u308b\u3068\u307e\u3060\u3044\u3044\u5024\u304c\u3067\u305f\u304b\u3082\u3002\n\n# \u53c2\u8003\u30da\u30fc\u30b8\n[Static Key Mini-HOWTO](https://openvpn.net/index.php/open-source/documentation/miscellaneous/78-static-key-mini-howto.html)\n[OpenVPN 2.0.x](https://openvpn.net/index.php/open-source/documentation/manuals/65-openvpn-20x-manpage.html)\n\n# \u304a\u307e\u3051\n\u5b89\u5168\u3067\u306f\u306a\u304f\u306a\u308a\u307e\u3059\u304c\u3001\u8a8d\u8a3c\u3068\u6697\u53f7\u3092\u7121\u52b9\u306b\u3057\u3066\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u6e2c\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```\nauth none\ncipher none\n```\n\n```text:iperf(DD-WRT)\nroot@DD-WRT:~# iperf -c 192.168.99.1 -t 60 -i 2\n------------------------------------------------------------\nClient connecting to 192.168.99.1, TCP port 5001\nTCP window size: 19.5 KByte (default)\n------------------------------------------------------------\n[  3] local 192.168.99.2 port 44942 connected with 192.168.99.1 port 5001\n[ ID] Interval       Transfer     Bandwidth\n[  3]  0.0- 2.0 sec  4.00 MBytes  16.8 Mbits/sec\n[  3]  2.0- 4.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3]  4.0- 6.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3]  6.0- 8.0 sec  4.30 MBytes  18.1 Mbits/sec\n[  3]  8.0-10.0 sec  4.34 MBytes  18.2 Mbits/sec\n[  3] 10.0-12.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 12.0-14.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 14.0-16.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 16.0-18.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 18.0-20.0 sec  4.35 MBytes  18.3 Mbits/sec\n[  3] 20.0-22.0 sec  4.35 MBytes  18.3 Mbits/sec\n[  3] 22.0-24.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 24.0-26.0 sec  4.18 MBytes  17.5 Mbits/sec\n[  3] 26.0-28.0 sec  4.31 MBytes  18.1 Mbits/sec\n[  3] 28.0-30.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 30.0-32.0 sec  4.31 MBytes  18.1 Mbits/sec\n[  3] 32.0-34.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3] 34.0-36.0 sec  4.26 MBytes  17.9 Mbits/sec\n[  3] 36.0-38.0 sec  4.38 MBytes  18.4 Mbits/sec\n[  3] 38.0-40.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 40.0-42.0 sec  4.23 MBytes  17.7 Mbits/sec\n[  3] 42.0-44.0 sec  4.25 MBytes  17.8 Mbits/sec\n[  3] 44.0-46.0 sec  4.21 MBytes  17.7 Mbits/sec\n[  3] 46.0-48.0 sec  4.36 MBytes  18.3 Mbits/sec\n[  3] 48.0-50.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 50.0-52.0 sec  4.34 MBytes  18.2 Mbits/sec\n[  3] 52.0-54.0 sec  4.28 MBytes  18.0 Mbits/sec\n[  3] 54.0-56.0 sec  4.30 MBytes  18.0 Mbits/sec\n[  3] 56.0-58.0 sec  4.27 MBytes  17.9 Mbits/sec\n[  3] 58.0-60.0 sec  4.30 MBytes  18.1 Mbits/sec\n[  3]  0.0-60.0 sec   128 MBytes  17.9 Mbits/sec\nroot@DD-WRT:~#\n```\n\n```text:top(DD-WRT)\nMem: 22032K used, 39404K free, 0K shrd, 3284K buff, 9200K cached\nCPU: 14.0% usr 22.0% sys  0.0% nic 51.9% idle  0.0% io  0.0% irq 11.9% sirq\nLoad average: 0.64 0.25 0.16 3/47 2302\n  PID  PPID USER     STAT   VSZ %VSZ CPU %CPU COMMAND\n 1816     1 root     R     3004  4.8   0 35.0 /usr/sbin/openvpn --config /tmp/o\n 2266  2220 root     S     6128  9.9   0  8.9 iperf -c 192.168.99.1 -t 60 -i 2\n 1744     1 root     S     2660  4.3   0  0.5 httpd -p 80\n 2255  2252 root     R     1336  2.1   0  0.2 top\n  888     1 root     S     2332  3.7   0  0.0 hostapd -B -P /var/run/ath0_hosta\n  544     1 root     S     1720  2.7   0  0.0 watchdog\n 1506     1 root     S     1708  2.7   0  0.0 wland\n 1749     1 root     S     1680  2.7   0  0.0 resetbutton\n 1141     1 root     S     1468  2.3   0  0.0 process_monitor\n 2220  2217 root     S     1336  2.1   0  0.0 -sh\n 2252  2251 root     S     1336  2.1   0  0.0 -sh\n  963     1 root     S     1324  2.1   0  0.0 telnetd\n    1     0 root     S     1304  2.1   0  0.0 /sbin/init\n 2251  1029 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 2217  1029 root     S     1260  2.0   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1029     1 root     S     1196  1.9   0  0.0 dropbear -b /tmp/loginprompt -r /\n 1002     1 root     S      884  1.4   0  0.0 dnsmasq --conf-file=/tmp/dnsmasq.\n  540     1 root     S      844  1.3   0  0.0 /sbin/mstpd\n  513     1 root     S      796  1.2   0  0.0 /sbin/hotplug2 --set-rules-file /\n 1566     1 root     S      792  1.2   0  0.0 cron\n```\n\n\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u4f5c\u6210\u3059\u308b\u51e6\u7406\u304c\u306a\u304f\u306a\u308b\u306e\u3067\u3001CPU\u8ca0\u8377\u304c\u4e0b\u304c\u3063\u3066\u3001\u901f\u5ea6\u3082\u5897\u52a0\u3057\u305f\u3088\u3046\u3067\u3059\u3002\n", "tags": ["dd-wrt", "OpenVPN"]}