{"context": " More than 1 year has passed since last update.ELB\u3067EC2\u306e\u5197\u9577\u69cb\u6210\u3092\u3068\u308b\u3068\u304d\u306b\u3001\u30b5\u30fc\u30d0\u30fc\uff11\u2192\u30b5\u30fc\u30d0\u30fc\uff12\u306b\u5909\u66f4\u304c\u81ea\u52d5\u53cd\u6620\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\n\u540c\u671f\u5148\u30b5\u30fc\u30d0\u30fc\nrsync\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308b\u305f\u3081\u306bwww\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3059\u308b\n# useradd rsync\n# usermod -G www rsync \n\nsudo \u304c\u3067\u304d\u308b\u3088\u3046\u306b/etc/sudoers\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\n# sudo visudo\n\n\u2193\u3053\u308c\u3092root\u306e\u540c\u3058\u8a2d\u5b9a\u306e\u4e0b\u306b\u8ffd\u52a0\nrsync   ALL=(ALL)   ALL\n\n\nSSH\u306e\u8a2d\u5b9a\n\n\u540c\u671f\u5143\u30b5\u30fc\u30d0\n\u9375\u306e\u4f5c\u6210\n\u30eb\u30fc\u30c8\u3067\n# ssh-keygen -t rsa\n\n\u516c\u958b\u9375\u306e\u53d6\u5f97\uff08\u3042\u3068\u3067\u540c\u671f\u5148\u306b\u767b\u9332\u3059\u308b\u306e\u3067\u30b3\u30d4\u3063\u3066\u304a\u304f\uff09\n# cat .ssh/id_rsa.pub\n\n\n\u540c\u671f\u5148\u30b5\u30fc\u30d0\n\u3055\u304d\u307b\u3069\u53d6\u5f97\u3057\u305f\u9375\u3092authorized_keys\u306b\u767b\u9332(\u672b\u5c3e\u306b\u6539\u884c\u3057\u3066\u8cbc\u308a\u4ed8\u3051)\n# cd /home/rsync\n# mkdir .ssh\n# cd .ssh\n# touch authorized_keys\n# vi authorized_keys \u2190\u3053\u3053\u3067\u8cbc\u308a\u4ed8\u3051 \n\n\u6a29\u9650\u306e\u5909\u66f4\n# chmod 600 authorized_keys\n# cd ../\n# chmod 700 .ssh\n\nSSH\u306e\u8a2d\u5b9a\u5909\u66f4\u3002\nPubkeyAuthentication yes\n\nSSH\u306e\u518d\u8d77\u52d5\n# /etc/rc.d/init.d/sshd restart\n\n\n\u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n\u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b\n# ssh rsync@xxx.xxx.xxx.xxx \n\n\nlsyncd\u306e\u8a2d\u5b9a\n\n\u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n\nlsyncd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install --enablerepo=epel lsyncd\n\n\nlsyncd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\ntarget \u306e\u3068\u3053\u306f\u540c\u671f\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n/etc/lsyncd.conf\nsettings{\n        insist = true,\n        statusFile = \"/tmp/lsyncd.stat\",\n        logfile = \"/var/log/lsyncd/lsyncd.log\",\n        statusInterval = 1,\n}\n\nsync {\n   default.rsync,\n   source = \"/var/www/\",\n   target = \"rsync@xxx.xxx.xxx.xxx:/var/www/\",\n   rsync = {\n      archive = true\n   }\n}\n\n\n\nlsyncd\u3092\u518d\u8d77\u52d5\n# /etc/rc.d/init.d/lsyncd restart\n\n\n\u78ba\u8a8d\n\n\u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n$ tail /var/log/lsyncd/lsyncd.log\n\n\u3053\u308c\u3067\u540c\u671f\u5143\u306e/var/www\u4ee5\u4e0b\u306b\u5909\u66f4\u304c\u751f\u3058\u305f\u3089\u3001\u81ea\u52d5\u7684\u306b\u540c\u671f\u5148\u306b\u53cd\u6620\u3055\u308c\u308b\u306f\u305a\u3002\n\nELB\u3067EC2\u306e\u5197\u9577\u69cb\u6210\u3092\u3068\u308b\u3068\u304d\u306b\u3001\u30b5\u30fc\u30d0\u30fc\uff11\u2192\u30b5\u30fc\u30d0\u30fc\uff12\u306b\u5909\u66f4\u304c\u81ea\u52d5\u53cd\u6620\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n# \u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n## \u540c\u671f\u5148\u30b5\u30fc\u30d0\u30fc\n\nrsync\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001\u66f8\u304d\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308b\u305f\u3081\u306bwww\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\u3059\u308b\n\n```\n# useradd rsync\n# usermod -G www rsync \n```\n\n\nsudo \u304c\u3067\u304d\u308b\u3088\u3046\u306b/etc/sudoers\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\n\n```\n# sudo visudo\n```\n\u2193\u3053\u308c\u3092root\u306e\u540c\u3058\u8a2d\u5b9a\u306e\u4e0b\u306b\u8ffd\u52a0\n\n```\nrsync   ALL=(ALL)   ALL\n```\n\n\n\n# SSH\u306e\u8a2d\u5b9a\n## \u540c\u671f\u5143\u30b5\u30fc\u30d0\n\u9375\u306e\u4f5c\u6210\n\n\u30eb\u30fc\u30c8\u3067\n\n```\n# ssh-keygen -t rsa\n```\n\n\u516c\u958b\u9375\u306e\u53d6\u5f97\uff08\u3042\u3068\u3067\u540c\u671f\u5148\u306b\u767b\u9332\u3059\u308b\u306e\u3067\u30b3\u30d4\u3063\u3066\u304a\u304f\uff09\n\n```\n# cat .ssh/id_rsa.pub\n```\n## \u540c\u671f\u5148\u30b5\u30fc\u30d0\n\u3055\u304d\u307b\u3069\u53d6\u5f97\u3057\u305f\u9375\u3092authorized_keys\u306b\u767b\u9332(\u672b\u5c3e\u306b\u6539\u884c\u3057\u3066\u8cbc\u308a\u4ed8\u3051)\n\n```\n# cd /home/rsync\n# mkdir .ssh\n# cd .ssh\n# touch authorized_keys\n# vi authorized_keys \u2190\u3053\u3053\u3067\u8cbc\u308a\u4ed8\u3051 \n```\n\n\u6a29\u9650\u306e\u5909\u66f4\n\n```\n# chmod 600 authorized_keys\n# cd ../\n# chmod 700 .ssh\n```\n\n\nSSH\u306e\u8a2d\u5b9a\u5909\u66f4\u3002\n\n```/etc/ssh/sshd_config\nPubkeyAuthentication yes\n```\n\nSSH\u306e\u518d\u8d77\u52d5\n\n```\n# /etc/rc.d/init.d/sshd restart\n```\n\n\n## \u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n\u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n\n```\n# ssh rsync@xxx.xxx.xxx.xxx \n```\n\n# lsyncd\u306e\u8a2d\u5b9a\n## \u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n\n### lsyncd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n$ sudo yum install --enablerepo=epel lsyncd\n```\n### lsyncd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\ntarget \u306e\u3068\u3053\u306f\u540c\u671f\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\n```conf:/etc/lsyncd.conf\nsettings{\n        insist = true,\n        statusFile = \"/tmp/lsyncd.stat\",\n        logfile = \"/var/log/lsyncd/lsyncd.log\",\n        statusInterval = 1,\n}\n\nsync {\n   default.rsync,\n   source = \"/var/www/\",\n   target = \"rsync@xxx.xxx.xxx.xxx:/var/www/\",\n   rsync = {\n      archive = true\n   }\n}\n\n```\n\nlsyncd\u3092\u518d\u8d77\u52d5\n\n```\n# /etc/rc.d/init.d/lsyncd restart\n```\n\n# \u78ba\u8a8d\n## \u540c\u671f\u5143\u30b5\u30fc\u30d0\u30fc\n\n```\n$ tail /var/log/lsyncd/lsyncd.log\n```\n\n\u3053\u308c\u3067\u540c\u671f\u5143\u306e/var/www\u4ee5\u4e0b\u306b\u5909\u66f4\u304c\u751f\u3058\u305f\u3089\u3001\u81ea\u52d5\u7684\u306b\u540c\u671f\u5148\u306b\u53cd\u6620\u3055\u308c\u308b\u306f\u305a\u3002\n", "tags": ["rsync", "\u540c\u671f", "lsyncd"]}