{"context": "CentOS6.7\u4e0a\u306bnginx\u3067SSL\u8a2d\u5b9a\u3059\u308b\u969b\u306bHTTP/2\u3082\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001Google Chrome\u3067\u306fHTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u305a\u3068\u3066\u3082\u5927\u5909\u3060\u3063\u305f\u306e\u3067\u4eca\u56de\u306e\u624b\u9806\u3092\u8a18\u9332\u3057\u307e\u3059\u3002\n\u8ffd\u8a18 2016/09/05 nginx stable(1.10\u4ee5\u4e0b)\u3067HTTP/2\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001iOS Safari\u3067Post\u3059\u308b\u5834\u5408\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u5f8c\u8ff0\u53c2\u7167\u3002\n\u8ffd\u8a18 2016/09/30 mainline\u30d0\u30fc\u30b8\u30e7\u30f3\u3092SRPM\u304b\u3089\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3057\u305f\u3002(\u30b3\u30e1\u30f3\u30c8\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002) \n\nGoogle Chrome\u3067HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u7406\u7531\nGoogle Chrome51(2016/4)\u3067 SPDY/3.1,NPN\u304c\u524a\u9664\u3055\u308c ALPN\u306e\u307f\u5bfe\u5fdc \u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\nRemove Support for SPDY/3.1\nRemove TLS Next Protocol Negotiation (NPN)\n\nAPI Deprecations and Removals in Chrome 51 | Web Updates - Google Developers\n\nCentOS6.7\u306byum\u3067nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3001NPN\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u304a\u308aALPN\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002Chrome\u306fALPN\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3068\u3001HTTP/2\u63a5\u7d9a\u3092\u3042\u304d\u3089\u3081HTTP/1.1\u306b\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002\n\uff08Firefox48.0.2\u306fNPM\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u3067\u3001HTTP/2\u3067\u63a5\u7d9a\u3055\u308c\u307e\u3059\u3002\uff09\n\nNPN\u30fbALPN\u3068\u306f\uff1f\n\u30d6\u30e9\u30a6\u30b6\u3068WEB\u30b5\u30fc\u30d0\u30fc\u306e\u9593\u3067\u63a5\u7d9a\u65b9\u5f0f\u3092\u6c7a\u5b9a\u3059\u308b\u624b\u9806\u3067\u3059\u3002ALPN\u3067\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cHTTP/2\u30fbSPDY\u30fbHTTP/1.1\u7b49\u306e\u63a5\u7d9a\u65b9\u5f0f\u30ea\u30b9\u30c8\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u63d0\u793a\u3057\u3001\u305d\u306e\u4e2d\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u304c\u63a5\u7d9a\u65b9\u5f0f\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\nTLS\u4e0a\u3067\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30cd\u30b4\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u4ed5\u7d44\u307f\u3001NPN\u3068ALPN - \u3042\u3059\u306e\u304b\u305c\n\n\nnginx\u3067ALPN\u306b\u5bfe\u5fdc\u3059\u308b\u65b9\u6cd5\nnginx\u306f1.9.5\u3067HTTP/2\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\nThe ngx_http_v2_module module (1.9.5) provides support for HTTP/2 and supersedes the ngx_http_spdy_module module.\nModule ngx_http_v2_module\n\n\u305f\u3060\u3057\u3001nginx\u306fTLS\u63a5\u7d9a\u306bOpenSSL\u3092\u5229\u7528\u3057\u3066\u304a\u308a\u3001OpenSSL\u306f 1.0.2\u4ee5\u4e0a\u3067ALPN\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\nOpenSSL 1.0.2\u4ee5\u4e0a\u3092\u5229\u7528\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u73fe\u6642\u70b9\u3067\u306eLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u307b\u3068\u3093\u3069\u306fALPN\u672a\u5bfe\u5fdc\u306eOpenSSL1.0.1\u7cfb\u3067\u3059\u3002\n\nThe table summarizes operating system support for ALPN and NPN.\n\n\n\nOperating System\nOpenSSL Version\nALPN and NPN Support\n\n\nCentOS/Oracle Linux/RHEL 5.10+\n0.9.8e\nNeither\n\n\nCentOS/Oracle Linux/RHEL 6.5+, 7.0+\n1.0.1e\nNPN\n\n\nUbuntu 12.04 LTS\n1.0.1\nNPN\n\n\nUbuntu 14.04 LTS\n1.0.1f\nNPN\n\n\nUbuntu 16.04 LTS\n1.0.2g\nALPN and NPN\n\n\nDebian 7.0\n1.0.1e\nNPN\n\n\nDebian 8.0\n1.0.1k\nNPN\n\n\n\nSupporting HTTP/2 for Google Chrome Users | NGINX\n\n\u8a66\u3057\u306b nginx -V \u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u306fOpenSSL1.0.1\u7cfb\u3067\u3059\u3002\n# nginx -V\nnginx version: nginx/1.10.1\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC)\nbuilt with OpenSSL 1.0.1e-fips 11 Feb 2013\n\nOS\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fOpenSSL\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u3068\u3001OpenSSL\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u5f71\u97ff\u304c\u51fa\u305d\u3046\u3067\u56f0\u96e3\u305d\u3046\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081nginx\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3001--with-openssl\u3067OpenSSL 1.0.2\u3092\u9759\u7684\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u6ce8 OpenSSL\u3084nginx\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u518d\u5ea6\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nThe NGINX sources support OpenSSL 1.0.2 (and the forthcoming 1.1.0 release), so another option is to recompile NGINX from source and link against a private OpenSSL\u00a01.0.2 build by including the --with-openssl argument.\nSupporting HTTP/2 for Google Chrome Users | NGINX\n\n\nnginx\u30bd\u30fc\u30b9\u30d3\u30eb\u30c9\nnginx\u306e\u30bd\u30fc\u30b9\u4e00\u5f0f\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u624b\u9806\u3067\u3059\u3002\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u30fb\u4f9d\u5b58\u95a2\u4fc2\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\uff08root\u6a29\u9650\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\uff09\n# yum groupinstall  \"Development Tools\"\n# yum install  pcre pcre-devel zlib zlib-devel\n\nopenssl-1.0.2\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\u3057\u307e\u3059\u3002\n# curl -L -O https://www.openssl.org/source/openssl-1.0.2h.tar.gz\n# tar xvfz openssl-1.0.2h.tar.gz\n\nnginx-1.10.1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\u3057\u307e\u3059\u3002\n# curl -L -O https://nginx.org/download/nginx-1.10.1.tar.gz\n# tar xvfz nginx-1.10.1.tar.gz\n\n./configure\u3057\u307e\u3059\u3002\n\u672b\u5c3e\u306e \u300c --with-openssl=../openssl-1.0.2h/ \u300d \u3067OpenSSL\u4e00\u5f0f\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n# cd nginx-1.10.1\n# ./configure  \\\n  --prefix=/etc/nginx \\\n  --sbin-path=/usr/sbin/nginx \\\n  --conf-path=/etc/nginx/nginx.conf \\\n  --error-log-path=/var/log/nginx/error.log \\\n  --http-log-path=/var/log/nginx/access.log \\\n  --pid-path=/var/run/nginx.pid \\\n  --lock-path=/var/run/nginx.lock \\\n  --http-client-body-temp-path=/var/cache/nginx/client_temp \\\n  --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\\n  --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\\n  --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\\n  --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\\n  --user=nginx \\\n  --group=nginx \\\n  --with-http_ssl_module \\\n  --with-http_realip_module \\\n  --with-http_addition_module \\\n  --with-http_sub_module \\\n  --with-http_dav_module \\\n  --with-http_flv_module \\\n  --with-http_mp4_module \\\n  --with-http_gunzip_module \\\n  --with-http_gzip_static_module \\\n  --with-http_random_index_module \\\n  --with-http_secure_link_module \\\n  --with-http_stub_status_module \\\n  --with-http_auth_request_module \\\n  --with-threads \\\n  --with-stream \\\n  --with-stream_ssl_module \\\n  --with-http_slice_module \\\n  --with-mail \\\n  --with-mail_ssl_module \\\n  --with-file-aio \\\n  --with-http_v2_module \\\n  --with-ipv6 \\\n  --with-openssl=../openssl-1.0.2h/\n\nmake\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n# make \n# make install\n\nnginx -V \u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001 OpenSSL 1.0.2\u7cfb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n# nginx -V\nnginx version: nginx/1.10.1\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-17) (GCC)\nbuilt with OpenSSL 1.0.2h  3 May 2016 \nTLS SNI support enabled\n\n\u53c2\u8003\uff09\n- Configure\u30aa\u30d7\u30b7\u30e7\u30f3\u306fnginx.org\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nnginx: Linux packages\u3000Configure Arguments\n\n\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002(\u52d5\u4f5c\u672a\u78ba\u8a8d)\n\n\nRed Hat NGINX Init Script | NGINX\n\n\nlogrotate\u7b49\u306f\u5225\u9014\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\nnginx\u306eSRPM\u30d3\u30eb\u30c9\n\u904b\u7528\u30b5\u30fc\u30d0\u30fc\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u306b\u306f\u3084\u306f\u308arpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u65b9\u304c\u4fbf\u5229\u3067\u3059\u3002nginx\u3067\u306fSourceRPM\u3082\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001rpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u53ef\u80fd\u3067\u3059\u3002\n\uff08\u6700\u7d42\u7684\u306b\u306f virtualPC\u4e0a\u306eCentOS\u3067rpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3001\u30b5\u30fc\u30d0\u30fc\u306b\u306frpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u9069\u7528\u3057\u307e\u3057\u305f\u3002\uff09\n\u4ee5\u4e0b\u3001nginx\u306erpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4f5c\u6210\u624b\u9806\u3067\u3059\u3002\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u30fb\u4f9d\u5b58\u95a2\u4fc2\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u203b GeoIP-devel\u306f epel \u304b\u3089\u914d\u5e03\u3055\u308c\u308b\u306e\u3067epel \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n# rpm -ivh http://ftp.riken.jp/Linux/fedora/epel/6/i386/epel-release-6-8.noarch.rpm\n\n# yum install rpm-build  \n\n# yum groupinstall \"Development Tools\"\n\n# yum install zlib-devel pcre-devel perl-devel perl-ExtUtils-Embed GeoIP-devel libxslt-devel gd-devel \n\nrpm\u30d3\u30eb\u30c9\u306froot\u6a29\u9650\u3067\u884c\u3046\u3068\u5371\u967a\u3089\u3057\u3044\u306e\u3067\u3001builder\u3068\u3044\u3046\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nuseradd builder  \n\nbuilder\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\nsu builder -\n\n.rpmmacros \uff08rpmbuild\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncd \necho '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros \n\nnginx\u306eSRPM\u3092\u53d6\u5f97\u3057\u5c55\u958b\u3057\u307e\u3059\u3002\ncurl -L -O http://nginx.org/packages/centos/6/SRPMS/nginx-1.10.1-1.el6.ngx.src.rpm\nrpm -ivh nginx-1.10.1-1.el6.ngx.src.rpm\n\n\u203b nginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046\u5834\u5408\u3001http://nginx.org/packages/mainline/centos/6/SRPMS/ \u304b\u3089SRPMS\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\ncurl -L -O http://nginx.org/packages/mainline/centos/6/SRPMS/nginx-1.11.4-1.el6.ngx.src.rpm\nrpm -ivh nginx-1.11.4-1.el6.ngx.src.rpm\n\n\u203b nginx\u306e\u30bd\u30fc\u30b9\u3092\u9069\u7528\u3057\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u3048\u308b\u5834\u5408\u306f\u3001\u8a72\u5f53\u306e\u30bd\u30fc\u30b9\u4e00\u5f0f\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002 \n\u4f8b\u3067\u306fnginx-1.11.3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e00\u5f0f\u3092\u4f7f\u3046\u5834\u5408\ncd rpmbuild/SOURCES\ncurl -L -O https://nginx.org/download/nginx-1.11.3.tar.gz\n\n\nnginx.spec\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002(\u2605\u306e\u7b87\u6240\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002)\n\n~/rpmbuild/SPECS/nginx.spec\n%if 0%{?rhel}  == 6\n%define _group System Environment/Daemons\n%define with_http2 1\nRequires(pre): shadow-utils\nRequires: initscripts >= 8.36\nRequires(post): chkconfig\n\n\u2605 openssl\u3092\u30b3\u30e1\u30f3\u30c8\u306b\n# Requires: openssl >= 1.0.1\n# BuildRequires: openssl-devel >= 1.0.1\n\nBuildRequires: perl-devel\nBuildRequires: perl-ExtUtils-Embed\nBuildRequires: GeoIP-devel\n%endif\n\n\uff5e \u4e2d\u7565 \uff5e \n\n%define COMMON_CONFIGURE_ARGS $(echo \"\\\n        --prefix=%{_sysconfdir}/nginx \\\n        --sbin-path=%{_sbindir}/nginx \\\n        --modules-path=%{_libdir}/nginx/modules \\\n        --conf-path=%{_sysconfdir}/nginx/nginx.conf \\\n        --error-log-path=%{_localstatedir}/log/nginx/error.log \\\n        --http-log-path=%{_localstatedir}/log/nginx/access.log \\\n        --pid-path=%{_localstatedir}/run/nginx.pid \\\n        --lock-path=%{_localstatedir}/run/nginx.lock \\\n        --http-client-body-temp-path=%{_localstatedir}/cache/nginx/client_temp \\\n        --http-proxy-temp-path=%{_localstatedir}/cache/nginx/proxy_temp \\\n        --http-fastcgi-temp-path=%{_localstatedir}/cache/nginx/fastcgi_temp \\\n        --http-uwsgi-temp-path=%{_localstatedir}/cache/nginx/uwsgi_temp \\\n        --http-scgi-temp-path=%{_localstatedir}/cache/nginx/scgi_temp \\\n        --user=%{nginx_user} \\\n        --group=%{nginx_group} \\\n        --with-http_ssl_module \\\n        --with-http_realip_module \\\n        --with-http_addition_module \\\n        --with-http_sub_module \\\n        --with-http_dav_module \\\n        --with-http_flv_module \\\n        --with-http_mp4_module \\\n        --with-http_gunzip_module \\\n        --with-http_gzip_static_module \\\n        --with-http_random_index_module \\\n        --with-http_secure_link_module \\\n        --with-http_stub_status_module \\\n        --with-http_auth_request_module \\\n        --with-http_xslt_module=dynamic \\\n        --with-http_image_filter_module=dynamic \\\n        --with-http_geoip_module=dynamic \\\n        --with-http_perl_module=dynamic \\\n        --add-dynamic-module=njs-%{module_njs_shaid}/nginx \\\n        --with-threads \\\n        --with-stream \\\n        --with-stream_ssl_module \\\n        --with-http_slice_module \\\n        --with-mail \\\n        --with-mail_ssl_module \\\n        --with-file-aio \\\n        --with-ipv6 \\\n        --with-openssl=/home/builder/openssl-1.0.2h/ \\  \u2605\u8ffd\u52a0\n        %{?with_http2:--with-http_v2_module}\")\n\n\n\uff5e \u4e2d\u7565 \uff5e \n\n# end of distribution specific definitions\n\n\u2605 main_version \u3092\u5909\u66f4\u3057\u307e\u3059\u3002\uff08nginx\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u3048\u308b\u5834\u5408\u306e\u307f\uff09\n#%define main_version                 1.10.1\n%define main_version                 1.11.3\n%define main_release                 1%{?dist}.ngx\n%define module_xslt_version          %{main_version}\n%define module_xslt_release          1%{?dist}.ngx\n%define module_geoip_version         %{main_version}\n%define module_geoip_release         1%{?dist}.ngx\n\n\n\n\n\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002(\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u306f\u6ce8\u91c8\u53c2\u7167\u3002 1 2\uff09\nrpmbuild -bb rpmbuild/SPECS/nginx.spec -D 'debug_package %{nil}'\n\n\u6210\u529f\u3059\u308b\u3068 rpm\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\nrpmbuild/RPMS/x86_64/nginx-1.10.1-1.el6.ngx.x86_64.rpm\n\n\u4f5c\u6210\u3057\u305frpm\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\nrpm -ihv nginx-1.10.1-1.el6.ngx.x86_64.rpm\n\nnginx\u306e default.conf\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002(SSL\u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\u3068\u3001HTTP/2\u306e\u8a2d\u5b9a)\n\n/etc/nginx/conf.d/default.conf\nserver {\n    server_name  XXXX.com;\n    listen       80;\n    listen      443  ssl http2;\n    ssl_certificate      /etc/pki/tls/certs/XXXX.crt;\n    ssl_certificate_key  /etc/pki/tls/private/XXXX.private.key;\n\n     \u30fb\n     \u30fb\n     \u30fb\n\n\nnginx\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n/etc/init.d/nginx start\n\n\nHTTP/2\u306e\u63a5\u7d9a\u78ba\u8a8d\nSSL\u3067\u63a5\u7d9a\u3057\u3066\u3001HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002developper tool\u3067protocol\u5217\u3092\u8868\u793a\u3059\u308b\u3068\u2019h2\u2019\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u307e\u305fChrome\u62e1\u5f35 HTTP/2 and SPDY indicator \u3067\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n\u8ffd\u8a18) Mac OS X\u3067\u306e\u6ce8\u610f\u4e8b\u9805\uff08Windows\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3042\u308b\u53ef\u80fd\u6027\u3042\u308a\u3002\uff09\n\u4f7f\u3063\u3066\u3044\u308b\u30a6\u30a4\u30eb\u30b9\u5bfe\u7b56\u30bd\u30d5\u30c8\u306b\u3088\u3063\u3066\u306fHTTP/2\u304c\u4f7f\u3048\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3057\u305f\u3002\nMac OS X\u3067HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\n\n\u8ffd\u8a18) iOS Safari\u3067POST\u3059\u308b\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002\niOS\u306eSafari\u3067AjaxPost\u3059\u308b\u969b\u306bnginx + HTTP/2\u3060\u3068\u30d6\u30e9\u30a6\u30b6\u3067\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n(nginx\u5074\u306e\u30ed\u30b0\u306b\u306f\u8a18\u9332\u3055\u308c\u307e\u305b\u3093\u3002)\n\njavascript\nFailed to load resource: request body stream exhausted\nFailed to load resource: Could not connect to the server.\n\n\n\u6b21\u306enginx\u306eissue\u304c\u95a2\u4fc2\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n#959 (Permit post before acking settings) \u2013 nginx\nHTTP/2: implemented preread buffer for request body\n\nMS IE/Edge, Safari, iOS applications\u304c\u5f71\u97ff\u3092\u53d7\u3051\u308b\u3088\u3046\u3067\u3059\u3002\n\n\nSome clients (notably MS IE/Edge, Safari, iOS applications) show an error\nor even crash if a stream is rejected;\n\n\n\u5bfe\u7b56\u3068\u3057\u3066\u8003\u3048\u3089\u308c\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\nnginx\u306e\u30bd\u30fc\u30b9\u306b\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u308b\uff08\u672a\u78ba\u8a8d\u3067\u3059\uff09\nnginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046 \uff08\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\uff09\n\n\nnginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046\n\u73fe\u5728\u306e\u3068\u3053\u308d(2016.09.06) nginx-1.11.0\u306b\u3053\u306e\u4fee\u6b63\u304c\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\nHTTP/2: implemented preread buffer for request body (closes #959).  \u2026\nHTTP/2\u306b\u306f\u305d\u306e\u5f8c\u3082\u4fee\u6b63\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002(segfault\u3082\u5165\u3063\u3066\u3044\u308b)\nnginx-1.11.3\u3092\u8a66\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001iOS Saferi\u304b\u3089HTTP/2\u3067POST\u6642\u306b\u30a8\u30e9\u30fc\u306f\u51fa\u306a\u304b\u3063\u305f\u3067\u3059\u3002\nnginx-1.11.3\u3067rpm\u3092\u4f5c\u308b\u65b9\u6cd5\u306f\u300cnginx\u306eSRPM\u30d3\u30eb\u30c9\u300d\u306b\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u53c2\u8003\u30b5\u30a4\u30c8\u30fb\u611f\u60f3\n\u5358\u306bnginx\u306e\u8a2d\u5b9a\u3067http2\u3068\u8a18\u8ff0\u3059\u308b\u3060\u3051\u306e\u3064\u3082\u308a\u3060\u3063\u305f\u306e\u3067\u3068\u3066\u3082\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002Apache2.4\u7cfb\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u30b5\u30a4\u30c8\u3001\u7d20\u6674\u3089\u3057\u3044\u60c5\u5831\u3092\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n\u3044\u307e\u3055\u3089\u805e\u3051\u306a\u3044rpmbuild\u3053\u3068\u306f\u3058\u3081 - hack in 3 minutes\nnginx\u3067srpm\u304b\u3089\u306econfigure\u5909\u66f4\n\n\n\u6ce8\u91c8\n\n\n\n\n-bb\u30aa\u30d7\u30b7\u30e7\u30f3\u306f Build a binary package (after doing the %prep, %build, and %install stages).rpmbuild\u00a0\u21a9\n\n\n-D 'debug_package %{nil}'\u306f debug\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u3089\u306a\u3044\u3002\u672a\u6307\u5b9a\u3060\u3068\u9014\u4e2d\u3067debugedit\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002extracting debug info from /home/builder/rpmbuild/BUILDROOT/nginx-1.10.1-1.el6.ngx.x86_64/usr/lib64/perl5/vendor_perl/auto/nginx/nginx.so /usr/lib/rpm/debugedit: canonicalization unexpectedly shrank by one character error: Bad exit status from /var/tmp/rpm-tmp.Ibuv0o (%install)\u00a0\u21a9\n\n\n\nCentOS6.7\u4e0a\u306bnginx\u3067SSL\u8a2d\u5b9a\u3059\u308b\u969b\u306bHTTP/2\u3082\u8a2d\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001**Google Chrome\u3067\u306fHTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u305a**\u3068\u3066\u3082\u5927\u5909\u3060\u3063\u305f\u306e\u3067\u4eca\u56de\u306e\u624b\u9806\u3092\u8a18\u9332\u3057\u307e\u3059\u3002\n\n**\u8ffd\u8a18 2016/09/05 nginx stable(1.10\u4ee5\u4e0b)\u3067HTTP/2\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001iOS Safari\u3067Post\u3059\u308b\u5834\u5408\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u5f8c\u8ff0\u53c2\u7167\u3002**\n\n**\u8ffd\u8a18 2016/09/30 mainline\u30d0\u30fc\u30b8\u30e7\u30f3\u3092SRPM\u304b\u3089\u30d3\u30eb\u30c9\u3067\u304d\u307e\u3057\u305f\u3002(\u30b3\u30e1\u30f3\u30c8\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002)** \n\n# Google Chrome\u3067HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u306a\u3044\u7406\u7531\n\nGoogle Chrome51(2016/4)\u3067 SPDY/3.1,NPN\u304c\u524a\u9664\u3055\u308c **ALPN\u306e\u307f\u5bfe\u5fdc** \u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n<blockquote>\n<p>\nRemove Support for SPDY/3.1<br>\nRemove TLS Next Protocol Negotiation (NPN)<br>\n</p>\n\n <footer>\n <cite title=\"https://developers.google.com/web/updates/2016/04/chrome-51-deprecations#remove-tls-next-protocol-negotiation-npn\">\n <a href=\"https://developers.google.com/web/updates/2016/04/chrome-51-deprecations#remove-tls-next-protocol-negotiation-npn\" target=\"_blank\">API Deprecations and Removals in Chrome 51 | Web Updates - Google Developers</a> </cite>\n</footer>\n</blockquote>\n\nCentOS6.7\u306byum\u3067nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5834\u5408\u3001NPN\u306e\u307f\u5bfe\u5fdc\u3057\u3066\u304a\u308aALPN\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002Chrome\u306fALPN\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3068\u3001HTTP/2\u63a5\u7d9a\u3092\u3042\u304d\u3089\u3081HTTP/1.1\u306b\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3057\u307e\u3059\u3002\n\uff08Firefox48.0.2\u306fNPM\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u306e\u3067\u3001HTTP/2\u3067\u63a5\u7d9a\u3055\u308c\u307e\u3059\u3002\uff09\n\n## NPN\u30fbALPN\u3068\u306f\uff1f\n\u30d6\u30e9\u30a6\u30b6\u3068WEB\u30b5\u30fc\u30d0\u30fc\u306e\u9593\u3067\u63a5\u7d9a\u65b9\u5f0f\u3092\u6c7a\u5b9a\u3059\u308b\u624b\u9806\u3067\u3059\u3002ALPN\u3067\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304cHTTP/2\u30fbSPDY\u30fbHTTP/1.1\u7b49\u306e\u63a5\u7d9a\u65b9\u5f0f\u30ea\u30b9\u30c8\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u63d0\u793a\u3057\u3001\u305d\u306e\u4e2d\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u304c\u63a5\u7d9a\u65b9\u5f0f\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n<blockquote>\n <footer>\n <cite title=\"TLS\u4e0a\u3067\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30cd\u30b4\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u4ed5\u7d44\u307f\u3001NPN\u3068ALPN - \u3042\u3059\u306e\u304b\u305c\">\n <a href=\"http://d.hatena.ne.jp/ASnoKaze/20130207/1360249692\" target=\"_blank\">TLS\u4e0a\u3067\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30cd\u30b4\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u4ed5\u7d44\u307f\u3001NPN\u3068ALPN - \u3042\u3059\u306e\u304b\u305c</a> </cite>\n</footer>\n</blockquote>\n\n\n## nginx\u3067ALPN\u306b\u5bfe\u5fdc\u3059\u308b\u65b9\u6cd5\n\nnginx\u306f1.9.5\u3067HTTP/2\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\n\n<blockquote>\n <p>The ngx_http_v2_module module (1.9.5) provides support for HTTP/2 and supersedes the ngx_http_spdy_module module.</p>\n <footer>\n <cite title=\"Module ngx_http_v2_module\">\n <a href=\"https://nginx.org/en/docs/http/ngx_http_v2_module.html\" target=\"_blank\">Module ngx_http_v2_module</a></cite>\n</footer>\n</blockquote>\n\n\u305f\u3060\u3057\u3001nginx\u306fTLS\u63a5\u7d9a\u306bOpenSSL\u3092\u5229\u7528\u3057\u3066\u304a\u308a\u3001OpenSSL\u306f 1.0.2\u4ee5\u4e0a\u3067ALPN\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\nOpenSSL 1.0.2\u4ee5\u4e0a\u3092\u5229\u7528\u3059\u308c\u3070\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u73fe\u6642\u70b9\u3067\u306eLinux\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u307b\u3068\u3093\u3069\u306fALPN\u672a\u5bfe\u5fdc\u306eOpenSSL1.0.1\u7cfb\u3067\u3059\u3002\n\n\n<blockquote>\n <p>The table summarizes operating system support for ALPN and NPN.</p>\n<table border=\"1\" style=\"width:100%\">\n<tbody>\n<tr>\n<th>Operating System</th>\n<th>OpenSSL Version</th>\n<th>ALPN and NPN Support</th>\n</tr>\n<tr>\n<td>CentOS/Oracle Linux/RHEL 5.10+</td>\n<td>0.9.8e</td>\n<td>Neither</td>\n</tr>\n<tr>\n<td>CentOS/Oracle Linux/RHEL 6.5+, 7.0+</td>\n<td>1.0.1e</td>\n<td>NPN</td>\n</tr>\n<tr>\n<td>Ubuntu 12.04 LTS</td>\n<td>1.0.1</td>\n<td>NPN</td>\n</tr>\n<tr>\n<td>Ubuntu 14.04 LTS</td>\n<td>1.0.1f</td>\n<td>NPN</td>\n</tr>\n<tr>\n<td style=\"color:#f2a900\">Ubuntu 16.04 LTS</td>\n<td style=\"color:#f2a900\">1.0.2g</td>\n<td style=\"color:#f2a900\">ALPN and NPN</td>\n</tr>\n<tr>\n<td>Debian 7.0</td>\n<td>1.0.1e</td>\n<td>NPN</td>\n</tr>\n<tr>\n<td>Debian 8.0</td>\n<td>1.0.1k</td>\n<td>NPN</td>\n</tr>\n</tbody>\n</table>\n\n <footer>\n <cite title=\"Supporting HTTP/2 for Google Chrome Users | NGINX\">\n <a href=\"https://www.nginx.com/blog/supporting-http2-google-chrome-users/\" target=\"_blank\">Supporting HTTP/2 for Google Chrome Users | NGINX</a> </cite>\n</footer>\n</blockquote>\n\n\n\n\u8a66\u3057\u306b nginx -V \u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u306fOpenSSL1.0.1\u7cfb\u3067\u3059\u3002\n\n```\n# nginx -V\nnginx version: nginx/1.10.1\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC)\nbuilt with OpenSSL 1.0.1e-fips 11 Feb 2013\n```\n\nOS\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fOpenSSL\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u3068\u3001OpenSSL\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u4ed6\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u5f71\u97ff\u304c\u51fa\u305d\u3046\u3067\u56f0\u96e3\u305d\u3046\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081nginx\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3001**--with-openssl\u3067OpenSSL 1.0.2\u3092\u9759\u7684\u30ea\u30f3\u30af\u3057\u307e\u3059**\u3002\n\u6ce8 OpenSSL\u3084nginx\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u518d\u5ea6\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n<blockquote>\n <p>The NGINX sources support OpenSSL 1.0.2 (and the forthcoming 1.1.0 release), so another option is to recompile NGINX from source and link against a private OpenSSL\u00a01.0.2 build by including the --with-openssl argument.</p>\n <footer>\n <cite title=\"Supporting HTTP/2 for Google Chrome Users | NGINX\">\n <a href=\"https://www.nginx.com/blog/supporting-http2-google-chrome-users/\" target=\"_blank\">Supporting HTTP/2 for Google Chrome Users | NGINX</a></cite>\n</footer>\n</blockquote>\n\n\n# nginx\u30bd\u30fc\u30b9\u30d3\u30eb\u30c9\nnginx\u306e\u30bd\u30fc\u30b9\u4e00\u5f0f\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u624b\u9806\u3067\u3059\u3002\n\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u30fb\u4f9d\u5b58\u95a2\u4fc2\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\uff08root\u6a29\u9650\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\uff09\n\n```\n# yum groupinstall  \"Development Tools\"\n# yum install  pcre pcre-devel zlib zlib-devel\n```\n\nopenssl-1.0.2\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\u3057\u307e\u3059\u3002\n\n```\n# curl -L -O https://www.openssl.org/source/openssl-1.0.2h.tar.gz\n# tar xvfz openssl-1.0.2h.tar.gz\n```\n\nnginx-1.10.1\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30fb\u5c55\u958b\u3057\u307e\u3059\u3002\n\n```\n# curl -L -O https://nginx.org/download/nginx-1.10.1.tar.gz\n# tar xvfz nginx-1.10.1.tar.gz\n```\n\n./configure\u3057\u307e\u3059\u3002\n\u672b\u5c3e\u306e **\u300c --with-openssl=../openssl-1.0.2h/ \u300d** \u3067OpenSSL\u4e00\u5f0f\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n# cd nginx-1.10.1\n# ./configure  \\\n  --prefix=/etc/nginx \\\n  --sbin-path=/usr/sbin/nginx \\\n  --conf-path=/etc/nginx/nginx.conf \\\n  --error-log-path=/var/log/nginx/error.log \\\n  --http-log-path=/var/log/nginx/access.log \\\n  --pid-path=/var/run/nginx.pid \\\n  --lock-path=/var/run/nginx.lock \\\n  --http-client-body-temp-path=/var/cache/nginx/client_temp \\\n  --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\\n  --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\\n  --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\\n  --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\\n  --user=nginx \\\n  --group=nginx \\\n  --with-http_ssl_module \\\n  --with-http_realip_module \\\n  --with-http_addition_module \\\n  --with-http_sub_module \\\n  --with-http_dav_module \\\n  --with-http_flv_module \\\n  --with-http_mp4_module \\\n  --with-http_gunzip_module \\\n  --with-http_gzip_static_module \\\n  --with-http_random_index_module \\\n  --with-http_secure_link_module \\\n  --with-http_stub_status_module \\\n  --with-http_auth_request_module \\\n  --with-threads \\\n  --with-stream \\\n  --with-stream_ssl_module \\\n  --with-http_slice_module \\\n  --with-mail \\\n  --with-mail_ssl_module \\\n  --with-file-aio \\\n  --with-http_v2_module \\\n  --with-ipv6 \\\n  --with-openssl=../openssl-1.0.2h/\n```\n\n\nmake\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n# make \n# make install\n```\n\n\nnginx -V \u3067\u78ba\u8a8d\u3059\u308b\u3068\u3001 OpenSSL 1.0.2\u7cfb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\n# nginx -V\nnginx version: nginx/1.10.1\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-17) (GCC)\nbuilt with OpenSSL 1.0.2h  3 May 2016 \nTLS SNI support enabled\n```\n\n\n\u53c2\u8003\uff09\n- Configure\u30aa\u30d7\u30b7\u30e7\u30f3\u306fnginx.org\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n> [nginx: Linux packages\u3000Configure Arguments](https://nginx.org/en/linux_packages.html)\n\n\n- \u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u4ee5\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002(\u52d5\u4f5c\u672a\u78ba\u8a8d)\n \n<blockquote>\n <footer>\n <cite title=\"Red Hat NGINX Init Script | NGINX\">\n <a href=\"https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/\" target=\"_blank\">Red Hat NGINX Init Script | NGINX</a></cite>\n</footer>\n</blockquote>\n\n- logrotate\u7b49\u306f\u5225\u9014\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\n\n\n# nginx\u306eSRPM\u30d3\u30eb\u30c9\n\u904b\u7528\u30b5\u30fc\u30d0\u30fc\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u306b\u306f\u3084\u306f\u308arpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u65b9\u304c\u4fbf\u5229\u3067\u3059\u3002nginx\u3067\u306fSourceRPM\u3082\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001rpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u518d\u4f5c\u6210\u53ef\u80fd\u3067\u3059\u3002\n\uff08\u6700\u7d42\u7684\u306b\u306f virtualPC\u4e0a\u306eCentOS\u3067rpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3001\u30b5\u30fc\u30d0\u30fc\u306b\u306frpm\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u9069\u7528\u3057\u307e\u3057\u305f\u3002\uff09\n\n\u4ee5\u4e0b\u3001nginx\u306erpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u4f5c\u6210\u624b\u9806\u3067\u3059\u3002\n\n\n\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u30fb\u4f9d\u5b58\u95a2\u4fc2\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u203b GeoIP-devel\u306f epel \u304b\u3089\u914d\u5e03\u3055\u308c\u308b\u306e\u3067epel \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\n# rpm -ivh http://ftp.riken.jp/Linux/fedora/epel/6/i386/epel-release-6-8.noarch.rpm\n```\n\n```\n# yum install rpm-build  \n```\n\n```\n# yum groupinstall \"Development Tools\"\n```\n\n```\n# yum install zlib-devel pcre-devel perl-devel perl-ExtUtils-Embed GeoIP-devel libxslt-devel gd-devel \n```\n\nrpm\u30d3\u30eb\u30c9\u306froot\u6a29\u9650\u3067\u884c\u3046\u3068\u5371\u967a\u3089\u3057\u3044\u306e\u3067\u3001builder\u3068\u3044\u3046\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nuseradd builder  \n```\n\nbuilder\u30e6\u30fc\u30b6\u30fc\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\n```\nsu builder -\n```\n\n\n.rpmmacros \uff08rpmbuild\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\ncd \necho '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros \n```\n\n\n\nnginx\u306eSRPM\u3092\u53d6\u5f97\u3057\u5c55\u958b\u3057\u307e\u3059\u3002\n\n```\ncurl -L -O http://nginx.org/packages/centos/6/SRPMS/nginx-1.10.1-1.el6.ngx.src.rpm\nrpm -ivh nginx-1.10.1-1.el6.ngx.src.rpm\n```\n\n\u203b nginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046\u5834\u5408\u3001http://nginx.org/packages/mainline/centos/6/SRPMS/ \u304b\u3089SRPMS\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u3059\u3002\n\n```\ncurl -L -O http://nginx.org/packages/mainline/centos/6/SRPMS/nginx-1.11.4-1.el6.ngx.src.rpm\nrpm -ivh nginx-1.11.4-1.el6.ngx.src.rpm\n```\n\n\n\u203b nginx\u306e\u30bd\u30fc\u30b9\u3092\u9069\u7528\u3057\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u3048\u308b\u5834\u5408\u306f\u3001\u8a72\u5f53\u306e\u30bd\u30fc\u30b9\u4e00\u5f0f\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002 \n\u4f8b\u3067\u306fnginx-1.11.3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e00\u5f0f\u3092\u4f7f\u3046\u5834\u5408\n\n```\ncd rpmbuild/SOURCES\ncurl -L -O https://nginx.org/download/nginx-1.11.3.tar.gz\n\n```\n\n\nnginx.spec\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002(\u2605\u306e\u7b87\u6240\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002)\n\n\n```~/rpmbuild/SPECS/nginx.spec\n%if 0%{?rhel}  == 6\n%define _group System Environment/Daemons\n%define with_http2 1\nRequires(pre): shadow-utils\nRequires: initscripts >= 8.36\nRequires(post): chkconfig\n\n\u2605 openssl\u3092\u30b3\u30e1\u30f3\u30c8\u306b\n# Requires: openssl >= 1.0.1\n# BuildRequires: openssl-devel >= 1.0.1\n\nBuildRequires: perl-devel\nBuildRequires: perl-ExtUtils-Embed\nBuildRequires: GeoIP-devel\n%endif\n\n\uff5e \u4e2d\u7565 \uff5e \n\n%define COMMON_CONFIGURE_ARGS $(echo \"\\\n        --prefix=%{_sysconfdir}/nginx \\\n        --sbin-path=%{_sbindir}/nginx \\\n        --modules-path=%{_libdir}/nginx/modules \\\n        --conf-path=%{_sysconfdir}/nginx/nginx.conf \\\n        --error-log-path=%{_localstatedir}/log/nginx/error.log \\\n        --http-log-path=%{_localstatedir}/log/nginx/access.log \\\n        --pid-path=%{_localstatedir}/run/nginx.pid \\\n        --lock-path=%{_localstatedir}/run/nginx.lock \\\n        --http-client-body-temp-path=%{_localstatedir}/cache/nginx/client_temp \\\n        --http-proxy-temp-path=%{_localstatedir}/cache/nginx/proxy_temp \\\n        --http-fastcgi-temp-path=%{_localstatedir}/cache/nginx/fastcgi_temp \\\n        --http-uwsgi-temp-path=%{_localstatedir}/cache/nginx/uwsgi_temp \\\n        --http-scgi-temp-path=%{_localstatedir}/cache/nginx/scgi_temp \\\n        --user=%{nginx_user} \\\n        --group=%{nginx_group} \\\n        --with-http_ssl_module \\\n        --with-http_realip_module \\\n        --with-http_addition_module \\\n        --with-http_sub_module \\\n        --with-http_dav_module \\\n        --with-http_flv_module \\\n        --with-http_mp4_module \\\n        --with-http_gunzip_module \\\n        --with-http_gzip_static_module \\\n        --with-http_random_index_module \\\n        --with-http_secure_link_module \\\n        --with-http_stub_status_module \\\n        --with-http_auth_request_module \\\n        --with-http_xslt_module=dynamic \\\n        --with-http_image_filter_module=dynamic \\\n        --with-http_geoip_module=dynamic \\\n        --with-http_perl_module=dynamic \\\n        --add-dynamic-module=njs-%{module_njs_shaid}/nginx \\\n        --with-threads \\\n        --with-stream \\\n        --with-stream_ssl_module \\\n        --with-http_slice_module \\\n        --with-mail \\\n        --with-mail_ssl_module \\\n        --with-file-aio \\\n        --with-ipv6 \\\n        --with-openssl=/home/builder/openssl-1.0.2h/ \\  \u2605\u8ffd\u52a0\n        %{?with_http2:--with-http_v2_module}\")\n\n\n\uff5e \u4e2d\u7565 \uff5e \n\n# end of distribution specific definitions\n\n\u2605 main_version \u3092\u5909\u66f4\u3057\u307e\u3059\u3002\uff08nginx\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5909\u3048\u308b\u5834\u5408\u306e\u307f\uff09\n#%define main_version                 1.10.1\n%define main_version                 1.11.3\n%define main_release                 1%{?dist}.ngx\n%define module_xslt_version          %{main_version}\n%define module_xslt_release          1%{?dist}.ngx\n%define module_geoip_version         %{main_version}\n%define module_geoip_release         1%{?dist}.ngx\n\n\n```\n\n\n\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002(\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u306f\u6ce8\u91c8\u53c2\u7167\u3002 [^1] [^2]\uff09\n\n```\nrpmbuild -bb rpmbuild/SPECS/nginx.spec -D 'debug_package %{nil}'\n```\n\n[^1]: -bb\u30aa\u30d7\u30b7\u30e7\u30f3\u306f Build a binary package (after doing the %prep, %build, and %install stages).[rpmbuild](http://www.rpm.org/max-rpm-snapshot/rpmbuild.8.html)\n\n[^2]: -D 'debug_package %{nil}'\u306f debug\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u3089\u306a\u3044\u3002\u672a\u6307\u5b9a\u3060\u3068\u9014\u4e2d\u3067debugedit\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002extracting debug info from /home/builder/rpmbuild/BUILDROOT/nginx-1.10.1-1.el6.ngx.x86_64/usr/lib64/perl5/vendor_perl/auto/nginx/nginx.so /usr/lib/rpm/debugedit: canonicalization unexpectedly shrank by one character error: Bad exit status from /var/tmp/rpm-tmp.Ibuv0o (%install)\n\n\n\n\u6210\u529f\u3059\u308b\u3068 rpm\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n```\nrpmbuild/RPMS/x86_64/nginx-1.10.1-1.el6.ngx.x86_64.rpm\n```\n\n\n\u4f5c\u6210\u3057\u305frpm\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```\nrpm -ihv nginx-1.10.1-1.el6.ngx.x86_64.rpm\n```\n\nnginx\u306e default.conf\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002(SSL\u8a3c\u660e\u66f8\u306e\u8a2d\u5b9a\u3068\u3001HTTP/2\u306e\u8a2d\u5b9a)\n\n```/etc/nginx/conf.d/default.conf\nserver {\n    server_name  XXXX.com;\n    listen       80;\n    listen      443  ssl http2;\n    ssl_certificate      /etc/pki/tls/certs/XXXX.crt;\n    ssl_certificate_key  /etc/pki/tls/private/XXXX.private.key;\n\n     \u30fb\n     \u30fb\n     \u30fb\n```\n\n\nnginx\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n/etc/init.d/nginx start\n```\n\n# HTTP/2\u306e\u63a5\u7d9a\u78ba\u8a8d\nSSL\u3067\u63a5\u7d9a\u3057\u3066\u3001HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002developper tool\u3067protocol\u5217\u3092\u8868\u793a\u3059\u308b\u3068**\u2019h2\u2019**\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![http2enable.png](https://qiita-image-store.s3.amazonaws.com/0/100465/cbd60170-4752-73ce-c251-9af15eff4e52.png)\n\n\n\n\u307e\u305fChrome\u62e1\u5f35 [HTTP/2 and SPDY indicator](https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin) \u3067\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n![chrome_http.png](https://qiita-image-store.s3.amazonaws.com/0/100465/ca44c7e6-0211-eb65-c428-a02728da8c36.png)\n\n\n# \u8ffd\u8a18) Mac OS X\u3067\u306e\u6ce8\u610f\u4e8b\u9805\uff08Windows\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3042\u308b\u53ef\u80fd\u6027\u3042\u308a\u3002\uff09\n\u4f7f\u3063\u3066\u3044\u308b\u30a6\u30a4\u30eb\u30b9\u5bfe\u7b56\u30bd\u30d5\u30c8\u306b\u3088\u3063\u3066\u306fHTTP/2\u304c\u4f7f\u3048\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n[Mac OS X\u3067HTTP/2\u304c\u6709\u52b9\u306b\u306a\u3089\u306a\u3044](https://ah-2.com/2016/09/04/osx_browser_http2.html)\n\n# \u8ffd\u8a18) iOS Safari\u3067POST\u3059\u308b\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002\niOS\u306eSafari\u3067AjaxPost\u3059\u308b\u969b\u306bnginx + HTTP/2\u3060\u3068\u30d6\u30e9\u30a6\u30b6\u3067\u6b21\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n(nginx\u5074\u306e\u30ed\u30b0\u306b\u306f\u8a18\u9332\u3055\u308c\u307e\u305b\u3093\u3002)\n\n```js:javascript\nFailed to load resource: request body stream exhausted\nFailed to load resource: Could not connect to the server.\n```\n\n\u6b21\u306enginx\u306eissue\u304c\u95a2\u4fc2\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n- [\\#959 \\(Permit post before acking settings\\) \u2013 nginx](https://trac.nginx.org/nginx/ticket/959)\n- [HTTP/2: implemented preread buffer for request body](https://trac.nginx.org/nginx/changeset/ce94f07d50826fcc8d48f046fe19d59329420fdb/nginx)\n\nMS IE/Edge, Safari, iOS applications\u304c\u5f71\u97ff\u3092\u53d7\u3051\u308b\u3088\u3046\u3067\u3059\u3002\n\n>  1. Some clients (notably MS IE/Edge, Safari, iOS applications) show an error\n    or even crash if a stream is rejected;\n>\n\n\n\u5bfe\u7b56\u3068\u3057\u3066\u8003\u3048\u3089\u308c\u308b\u65b9\u6cd5\u3067\u3059\u3002\n\n- nginx\u306e\u30bd\u30fc\u30b9\u306b\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u308b\uff08**\u672a\u78ba\u8a8d\u3067\u3059**\uff09\n- nginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046 \uff08\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\uff09\n\n\n## nginx1.11\u7cfb\uff08mainline\uff09\u3092\u4f7f\u3046\n\n\u73fe\u5728\u306e\u3068\u3053\u308d(2016.09.06) nginx-1.11.0\u306b\u3053\u306e\u4fee\u6b63\u304c\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n[HTTP/2: implemented preread buffer for request body \\(closes \\#959\\)\\.  \u2026](https://github.com/nginx/nginx/commit/5429140c018726e8b28c724b06daaf0fe33d2205)\n\n\nHTTP/2\u306b\u306f\u305d\u306e\u5f8c\u3082\u4fee\u6b63\u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002(segfault\u3082\u5165\u3063\u3066\u3044\u308b)\nnginx-1.11.3\u3092\u8a66\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001iOS Saferi\u304b\u3089HTTP/2\u3067POST\u6642\u306b\u30a8\u30e9\u30fc\u306f\u51fa\u306a\u304b\u3063\u305f\u3067\u3059\u3002\nnginx-1.11.3\u3067rpm\u3092\u4f5c\u308b\u65b9\u6cd5\u306f\u300cnginx\u306eSRPM\u30d3\u30eb\u30c9\u300d\u306b\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\u30fb\u611f\u60f3\n\u5358\u306bnginx\u306e\u8a2d\u5b9a\u3067http2\u3068\u8a18\u8ff0\u3059\u308b\u3060\u3051\u306e\u3064\u3082\u308a\u3060\u3063\u305f\u306e\u3067\u3068\u3066\u3082\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002Apache2.4\u7cfb\u3067\u3082\u540c\u69d8\u306e\u3053\u3068\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u30b5\u30a4\u30c8\u3001\u7d20\u6674\u3089\u3057\u3044\u60c5\u5831\u3092\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\n- [\u3044\u307e\u3055\u3089\u805e\u3051\u306a\u3044rpmbuild\u3053\u3068\u306f\u3058\u3081 \\- hack in 3 minutes](https://blog.tnmt.info/2011/04/28/rpmbuild-for-beginner/)\n \n- [nginx\u3067srpm\u304b\u3089\u306econfigure\u5909\u66f4](http://qiita.com/nofrmm/items/33d3f0bc5d7d60ad9b54)\n\n\n\n# \u6ce8\u91c8\n\n", "tags": ["nginx", "http2", "ALPN", "CentOS6.x", "openssl"]}