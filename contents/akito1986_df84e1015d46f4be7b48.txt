{"context": "\n\n\u306f\u3058\u3081\u306b\n\n\u4eca\u56de\u3084\u308b\u3053\u3068\nCloudStack(IDCF\u30af\u30e9\u30a6\u30c9)\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092Terraform\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3002\n\nVM\u4f5c\u6210\nPublicIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\nPortForwarding\u306e\u8a2d\u5b9a\nFirewall\u306e\u8a2d\u5b9a\n\n\u4e0a\u8a18\u3092\u884c\u3046\u3053\u3068\u3067VM\u306b\u5bfe\u3057\u3066ssh\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\n\u4ed5\u4e8b\u67c4CloudStack\u4e0a\u3067VM\u3092\u4f5c\u6210\u3057\u3066\u7c21\u5358\u306a\u30c4\u30fc\u30eb\u306e\u691c\u8a3c\u74b0\u5883\u306a\u3069\u3092\u69cb\u7bc9\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002\u3000\u3000\n\u4eca\u307e\u3067\u306f\u81ea\u5206GUI\u4e0a\u3084API\u4e0a\u304b\u3089\u3001\u64cd\u4f5c\u3057\u3066\u3044\u305f\u304c\u3001\u691c\u8a3c\u74b0\u5883\u306e\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u3084OS\u306f\u5927\u4f53\u540c\u3058\u306a\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u3084\u308a\u305f\u3044\u306a\u3068\u3044\u3046\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\n\u5099\u8003\nHashiCorp\u793e\u304c\u958b\u767a\u3057\u3066\u3044\u308b Terraform \u3092 \u4f7f\u3063\u305f\u4f7f\u304a\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u307e\u307e\u3067\u306fIDCF\u30af\u30e9\u30a6\u30c9\u306e CloudStack \u3067\u306f\u52d5\u304b\u306a\u304b\u3063\u305f\u3067\u3001\u4eca\u56de\u306fterraform\u3068\u305d\u3053\u3067\u5229\u7528\u3057\u3066\u3044\u308bCloudStack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092fork\u3057\u3066\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\nterraform\u306e\u65b9\u306e\u4fee\u6b63\u306e\u4e00\u90e8\u306f\u8a66\u9a13\u3092\u66f8\u3044\u305f\u3089PullRequest\u3092\u51fa\u3059\u3064\u3082\u308a\u3067\u3059\u3002\n\u305f\u3060CloudStack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3064\u3044\u3066\u306fCloudStack\u306e\u958b\u767a\u5143\u3068Version\u306b\u3088\u3063\u3066\u306f\u65e2\u5b58\u306e\u5b9f\u88c5\u306e\u307e\u307e\u3067\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u3001\u3068\u3044\u3046\u3084\u308a\u53d6\u308a\u304cGithub\u4e0a\u3067\u3055\u308c\u3066\u304a\u308a\u3001\u30de\u30fc\u30b8\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u4f4e\u3044\u306e\u3067PullRequest\u306f\u51fa\u3055\u306a\u3044\u4e88\u5b9a\u3067\u3059\u3002\n\n\n\u524d\u63d0\n\nIDCF\u30af\u30e9\u30a6\u30c9\u306e\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u3053\u3068\n\nAPIKey\nSecretKey\n\n\nGo\u306e\u30d3\u30eb\u30c9\u74b0\u5883\u304c\u3042\u308b\u3053\u3068\n\n\nTerraform\u3068\u306f\nhttps://www.terraform.io/intro/\n\u3053\u3053\u3092\u898b\u308b\u3068\u30a4\u30f3\u30d5\u30e9\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u3066\u72b6\u614b\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3089\u3057\u3044\u3002\n\u72b6\u614b \u3092\u7ba1\u7406\u3059\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u30a4\u30f3\u30d5\u30e9\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u3089\u305d\u306e\u5909\u66f4\u90e8\u5206\u3060\u3051\u3092\u9069\u7528\u3057\u3066\u304f\u308c\u308b\u611f\u3058\u304b\u306a\u3002\n\n\u624b\u9806\n\n\u74b0\u5883\n\nOSX: 10.11.1\nGo: 1.7.3\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nGOPATH\u306e\u78ba\u8a8d\n$ env | grep GOPATH\nGOPATH=/Users/aueno/.go\n$ \n\n\n\u30bd\u30fc\u30b9\u306e\u914d\u7f6e\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30af\u30ec\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002  \n$ mkdir -p $GOPATH/src/github.com/akito1986\n\n\u4ee5\u4e0b\u3067\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u3092 git clone \u3057\u3066\u304f\u308b\u3002\n$ cd $GOPATH/src/github.com/akito1986\n$ git clone https://github.com/akito1986/terraform.git\n\n\n\u30d3\u30eb\u30c9\n\u30d3\u30eb\u30c9\u3059\u308b\u524d\u306b\u4f9d\u5b58\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u3002\n$ cd terraform/\n$ go get -u\n$ ls -1 $GOPATH/src/github.com\nakito1986/\nhashicorp/\n$ \n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u5f8c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\n\u30d3\u30eb\u30c9\u5f8c\u306f-o\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9f\u884c\u3059\u308b\u3068\u30b3\u30de\u30f3\u30c9\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n$ go build -o /usr/local/bin/terraform\n$ /usr/local/bin/terraform\nUsage: terraform [--version] [--help] <command> [args]\n\nThe available commands for execution are listed below.\nThe most common, useful commands are shown first, followed by\nless common or more advanced commands. If you're just getting\nstarted with Terraform, stick with the common commands. For the\nother commands, please read the help and docs before usage.\n\nCommon commands:\n    apply              Builds or changes infrastructure\n    console            Interactive console for Terraform interpolations\n    destroy            Destroy Terraform-managed infrastructure\n    fmt                Rewrites config files to canonical format\n    get                Download and install modules for the configuration\n    graph              Create a visual graph of Terraform resources\n    import             Import existing infrastructure into Terraform\n    init               Initializes Terraform configuration from a module\n    output             Read an output from a state file\n    plan               Generate and show an execution plan\n    push               Upload this Terraform module to Atlas to run\n    refresh            Update local state file against real resources\n    remote             Configure remote state storage\n    show               Inspect Terraform state or plan\n    taint              Manually mark a resource for recreation\n    untaint            Manually unmark a resource as tainted\n    validate           Validates the Terraform files\n    version            Prints the Terraform version\n\nAll other commands:\n    state              Advanced state management\n$\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308c\u3070\u6b63\u5e38\u306b\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u8a2d\u5b9a\nTerraform\u306fHCL\u304bJson\u3067\u30a4\u30f3\u30d5\u30e9\u3092\u7ba1\u7406\u3059\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u306fHCL\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nHCL(Hashicorp Configuration Language)\n\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nhttp://dev.classmethod.jp/cloud/terraform-getting-started-with-aws/\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3067\u304d\u308b\u3089\u3057\u3044\u3067\u3059\u3002\n// comment_1\n# comment_2\n\nvariable \"uri\" {\n  default = \"https://compute.jp-east.idcfcloud.com/client/api\"\n}\n\nvariable \"api_key\" {} // TF_VAR_xxx\u306e\u5f62\u5f0f\u3067\u74b0\u5883\u5909\u6570\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3059\u308b\u3002\nvariable \"secret_key\" {} // \u5024\u306fTF_VAR_secret_key\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\u3002\n\nprovider \"cloudstack\" {                                                                     \n  api_url = \"${var.uri}\" // \u5909\u6570uri\u306e\u53c2\u7167\n  api_key = \"${var.api_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\n/* A multi\n   line comment. */\nresource \"cloudstack_instance\" \"vm_1\" {\n  name = \"terraform-test-1\"\n  service_offering= \"light.S1\" // name\u3067\u6307\u5b9a\u3067\u304d\u308b\u306e\u304c\u826f\u3044\u3067\u3059\u3088\u306d\u3002\n  network_id = \"${var.network_id}\"\n  template = \"CentOS 7.2 64-bit\"\n  zone = \"pascal\"\n  keypair = \"aueno\"\n}\n\nresource \"cloudstack_port_forward\" \"pf_ssh\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n  forward {\n    protocol = \"tcp\"\n    private_port = 22\n    public_port = 10022\n    virtual_machine_id = \"${cloudstack_instance.vm.id}\" // \u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5909\u6570\u306f\u300cresource\u7a2e\u5225.resource\u540d.\u5c5e\u6027\u540d\u300d\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n}\n...\n\n\u4ee5\u4e0b\u5909\u6570\u306b\u3064\u3044\u3066\u306e\u81ea\u5206\u306a\u308a\u306e\u7406\u89e3\u3067\u3059\u3002\n\nprovider: \u3069\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308b\u306e\u304b\u3092\u8a18\u8f09\u3059\u308b\u3002CloudStack\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u5834\u5408\u306fcloudstack\u3068\u8a18\u8f09\nresource: \u64cd\u4f5c\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8a18\u8f09\u3002\u7b2c\u4e00\u5f15\u6570\u306b\u64cd\u4f5c\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u7a2e\u5225\u3001\u7b2c\u4e8c\u5f15\u6570\u306b\u305d\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\nCloudStack\u306e\u8a2d\u5b9a\nhttps://www.terraform.io/docs/providers/cloudstack/index.html\n\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3059\u308b\u3002\n\u4eca\u56de\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u4ee5\u4e0b\u306a\u306e\u3067\u3001\n\nVM\u4f5c\u6210\nFirewall\u8a2d\u5b9a\nPortForwarding\u8a2d\u5b9a\n\n\u306a\u306e\u3067\u5fc5\u8981\u306acloudstack\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u3068\u306a\u308a\u307e\u3059\u3002\n\ninstance\nipaddress\nport_forward\nfirewall\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\nterraform\u306f\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e.tf\u3068\u3044\u3046\u62e1\u5f35\u5b50\u3092\u898b\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3092\u5224\u65ad\u3059\u308b\u3089\u3057\u3044\u306e\u3067\u672b\u5c3e\u306f .tf \u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\ncloudstack.tf\nvariable myip {}\nvariable api_key {}\nvariable secret_key {}\nvariable network_id { default = \"957483e1-7e8f-4b0a-849b-84425e582130\" }\nprovider \"cloudstack\" {\n  api_url = \"https://compute.jp-east.idcfcloud.com/client/api\"\n  api_key = \"${var.api_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nresource \"cloudstack_instance\" \"vm\" {\n  name = \"terraform-test-1\"\n  service_offering= \"light.S1\"\n  network_id = \"${var.network_id}\"\n  template = \"CentOS 7.2 64-bit\"\n  zone = \"pascal\"\n  keypair = \"aueno\"\n}\n\nresource \"cloudstack_ipaddress\" \"public_ipaddress\" {\n  network_id = \"${var.network_id}\"\n  zone = \"pascal\"\n}\n\nresource \"cloudstack_port_forward\" \"pf_ssh\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n  forward {\n    protocol = \"tcp\"\n    private_port = 22\n    public_port = 22\n    virtual_machine_id = \"${cloudstack_instance.vm.id}\"\n  }\n}\n\nresource \"cloudstack_firewall\" \"myip\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n\n  rule {\n    cidr_list = [\"${var.myip}/32\"]\n    protocol = \"tcp\"\n    ports = [\"1-65535\"]\n  }\n}\n\noutput \"public_ipaddress\" {\n  value = \"${cloudstack_ipaddress.public_ipaddress.ip_address}\"\n}\n\n\n\u4e0a\u8a18\u306fterraform-test-1(VM)\u3092\u4f5c\u6210\u3057\u3066\u3001public_ipaddress(public ipaddress)\u3092\u53d6\u5f97\u3057\u3066\u3001public_ipaddress\u306e22\u756aport\u3092terraform-test-1\u306e22\u756aport\u306bforwarding\u3057\u3066\u3001\u6700\u5f8c\u306bpublic_ipaddress\u306efirewall\u306b\u3064\u3044\u3066\u6307\u5b9a\u3057\u305fmyip\u30a2\u30c9\u30ec\u30b9\u304b\u30891-65535\u30dd\u30fc\u30c8\u307e\u3067\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u5b9f\u884c\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Terraform\u3067\u4f55\u3092\u3059\u308b\u306e\u304b\u3092\u4e8b\u524d\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\napi_key\u3068secret_key\u3001myip\u306b\u3064\u3044\u3066\u306f\u305d\u308c\u305e\u308c\u3001IDCF\u30af\u30e9\u30a6\u30c9\u306eAPIKey\u3001SecretKey\u3001\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u306b\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ cloudstack_firewall.myip\n    ip_address_id:                        \"<computed>\"\n    managed:                              \"false\"\n    parallelism:                          \"2\"\n    rule.#:                               \"1\"\n    rule.1438695593.cidr_list.#:          \"1\"\n    rule.1438695593.cidr_list.3084607623: \"126.112.54.50/32\"\n    rule.1438695593.icmp_code:            \"<computed>\"\n    rule.1438695593.icmp_type:            \"<computed>\"\n    rule.1438695593.ports.#:              \"1\"\n    rule.1438695593.ports.1101440173:     \"1-65535\"\n    rule.1438695593.protocol:             \"tcp\"\n    rule.1438695593.uuids.%:              \"<computed>\"\n\n+ cloudstack_instance.vm\n    display_name:     \"<computed>\"\n    expunge:          \"false\"\n    group:            \"<computed>\"\n    ip_address:       \"<computed>\"\n    keypair:          \"aueno\"\n    name:             \"terraform-test-1\"\n    network_id:       \"957483e1-7e8f-4b0a-849b-84425e582130\"\n    project:          \"<computed>\"\n    service_offering: \"light.S1\"\n    template:         \"CentOS 7.2 64-bit\"\n    zone:             \"pascal\"\n\n+ cloudstack_ipaddress.public_ipaddress\n    ip_address: \"<computed>\"\n    network_id: \"957483e1-7e8f-4b0a-849b-84425e582130\"\n    project:    \"<computed>\"\n    zone:       \"pascal\"\n\n+ cloudstack_port_forward.pf_ssh\n    forward.#:                              \"1\"\n    forward.~1715957168.private_port:       \"22\"\n    forward.~1715957168.protocol:           \"tcp\"\n    forward.~1715957168.public_port:        \"22\"\n    forward.~1715957168.uuid:               \"<computed>\"\n    forward.~1715957168.virtual_machine_id: \"<computed>\"\n    ip_address_id:                          \"<computed>\"\n    managed:                                \"false\"\n\n\nPlan: 4 to add, 0 to change, 0 to destroy.\n$\n\n4\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\napply\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u969b\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform apply\ncloudstack_ipaddress.public_ipaddress: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_firewall.myip: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_instance.vm: Creating...\n  display_name:     \"\" => \"<computed>\"\n  expunge:          \"\" => \"false\"\n  group:            \"\" => \"<computed>\"\n  ip_address:       \"\" => \"<computed>\"\n  keypair:          \"\" => \"aueno\"\n  name:             \"\" => \"terraform-test-1\"\n  network_id:       \"\" => \"957483e1-7e8f-4b0a-849b-84425e582130\"\n  project:          \"\" => \"<computed>\"\n  service_offering: \"\" => \"light.S1\"\n  template:         \"\" => \"CentOS 7.2 64-bit\"\n  zone:             \"\" => \"pascal\"\n.....\ncloudstack_instance.vm: Creation complete\ncloudstack_port_forward.pf_ssh: Creating...\n  forward.#:                             \"\" => \"1\"\n  forward.2467112059.private_port:       \"\" => \"22\"\n  forward.2467112059.protocol:           \"\" => \"tcp\"\n  forward.2467112059.public_port:        \"\" => \"22\"\n  forward.2467112059.uuid:               \"\" => \"<computed>\"\n  forward.2467112059.virtual_machine_id: \"\" => \"zzzzzzzzzzz\"\n  ip_address_id:                         \"\" => \"fb5fc420-0cbb-4599-be01-feb9766f0587\"\n  managed:                               \"\" => \"false\"\ncloudstack_port_forward.pf_ssh: Creation complete\n\nApply complete! Resources: 2 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\nOutputs:\n\npublic_ipaddress = sss.sss.sss.sss // \u5b9f\u969b\u306epublic ipaddress\u304c\u8868\u793a\u3055\u308c\u308b\n$ ssh root@sss.sss.sss.sss\nThe authenticity of host 'sss.sss.sss.sss (sss.sss.sss.sss)' can't be established.\nECDSA key fingerprint is SHA256:BN7g57iY4sfhMyiDOMbmSi+fBS19/vxRH8rd36X2h0M.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added 'sss.sss.sss.sss' (ECDSA) to the list of known hosts.\n    ________  ______   ______                 __  _          \n   /  _/ __ \\/ ____/  / ____/________  ____  / /_(_)__  _____\n   / // / / / /      / /_  / ___/ __ \\/ __ \\/ __/ / _ \\/ ___/\n _/ // /_/ / /___   / __/ / /  / /_/ / / / / /_/ /  __/ /    \n/___/_____/\\____/  /_/   /_/   \\____/_/ /_/\\__/_/\\___/_/     \n\n[root@terraform-test-1 ~]#\n\n\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u308c\u3067\u3044\u3061\u3044\u3061\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30c4\u30fc\u30eb\u3067\u3061\u307e\u3061\u307e\u8a2d\u5b9a\u3057\u305f\u308a\u3001\u30d6\u30e9\u30a6\u30b6\u7acb\u3061\u4e0a\u3052\u3066\u30dd\u30c1\u30dd\u30c1\u3057\u306a\u304f\u3066\u3082\u826f\u3044\u3067\u3059\u306d\n\u3088\u308a\u81ea\u5206\u304c\u3084\u308a\u305f\u3044\u3053\u3068\u306b\u5c02\u5ff5\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u88dc\u8db3\n\n\u73fe\u5728\u306e\u8a2d\u5b9a\u306e\u78ba\u8a8d\nshow\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz \ncloudstack_firewall.myip:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  ip_address_id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  managed = false\n  parallelism = 2\n  rule.# = 1\n  rule.1438695593.cidr_list.# = 1\n  rule.1438695593.cidr_list.3084607623 = zzz.zzz.zzz.zzz/32\n  rule.1438695593.icmp_code = 0\n  rule.1438695593.icmp_type = 0\n  rule.1438695593.ports.# = 1\n  rule.1438695593.ports.1101440173 = 1-65535\n  rule.1438695593.protocol = tcp\n  rule.1438695593.uuids.% = 1\n  rule.1438695593.uuids.1-65535 = 67f70c34-d1de-4b49-99f5-e3df7ffbf2b7\ncloudstack_instance.vm:\n  id = c67aa47e-e928-4302-b665-b50edd455720\n  display_name = terraform-test-1\n  expunge = false\n  group = \n  ip_address = 10.6.1.5\n  keypair = aueno\n  name = terraform-test-1\n  network_id = 957483e1-7e8f-4b0a-849b-84425e582130\n  project = \n  service_offering = light.S1\n  template = CentOS 7.2 64-bit\n  zone = pascal\ncloudstack_ipaddress.public_ipaddress:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  ip_address = 210.140.78.47\n  network_id = 957483e1-7e8f-4b0a-849b-84425e582130\n  project = \n  zone = pascal\ncloudstack_port_forward.pf_ssh:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  forward.# = 1\n  forward.2467112059.private_port = 22\n  forward.2467112059.protocol = tcp\n  forward.2467112059.public_port = 22\n  forward.2467112059.uuid = 41792d57-e6ea-40cc-8fef-8506ad54375b\n  forward.2467112059.virtual_machine_id = c67aa47e-e928-4302-b665-b50edd455720\n  ip_address_id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  managed = false\n\n\nOutputs:\n\npublic_ipaddress = sss.sss.sss.sss\n\n\n\u518d\u5b9f\u884c\u306e\u3068\u304d\u306e\u52d5\u4f5c\nplan\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\ncloudstack_instance.vm: Refreshing state... (ID: c67aa47e-e928-4302-b665-b50edd455720)\ncloudstack_ipaddress.public_ipaddress: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_firewall.myip: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_port_forward.pf_ssh: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\n\nNo changes. Infrastructure is up-to-date. This means that Terraform\ncould not detect any differences between your configuration and\nthe real physical resources that exist. As a result, Terraform\ndoesn't need to do anything.\n$ \n\n\u8a2d\u5b9a\u304c\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u3067\u306fterraform\u306f\u4f55\u3082\u3057\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u304a\u308f\u308a\u306b\n\u304a\u3057\u307e\u3044\u3002\n\n# \u306f\u3058\u3081\u306b\n## \u4eca\u56de\u3084\u308b\u3053\u3068\nCloudStack(IDCF\u30af\u30e9\u30a6\u30c9)\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092Terraform\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3002\n\n- VM\u4f5c\u6210\n- PublicIP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\n- PortForwarding\u306e\u8a2d\u5b9a\n- Firewall\u306e\u8a2d\u5b9a\n\n\u4e0a\u8a18\u3092\u884c\u3046\u3053\u3068\u3067VM\u306b\u5bfe\u3057\u3066`ssh`\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n## \u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\n\u4ed5\u4e8b\u67c4CloudStack\u4e0a\u3067VM\u3092\u4f5c\u6210\u3057\u3066\u7c21\u5358\u306a\u30c4\u30fc\u30eb\u306e\u691c\u8a3c\u74b0\u5883\u306a\u3069\u3092\u69cb\u7bc9\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002\u3000\u3000\n\u4eca\u307e\u3067\u306f\u81ea\u5206GUI\u4e0a\u3084API\u4e0a\u304b\u3089\u3001\u64cd\u4f5c\u3057\u3066\u3044\u305f\u304c\u3001\u691c\u8a3c\u74b0\u5883\u306e\u30de\u30b7\u30f3\u30b9\u30da\u30c3\u30af\u3084OS\u306f\u5927\u4f53\u540c\u3058\u306a\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u4e00\u767a\u3067\u3084\u308a\u305f\u3044\u306a\u3068\u3044\u3046\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\n## \u5099\u8003\nHashiCorp\u793e\u304c\u958b\u767a\u3057\u3066\u3044\u308b `Terraform` \u3092 ~~\u4f7f\u3063\u305f~~\u4f7f\u304a\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u307e\u307e\u3067\u306fIDCF\u30af\u30e9\u30a6\u30c9\u306e `CloudStack` \u3067\u306f\u52d5\u304b\u306a\u304b\u3063\u305f\u3067\u3001\u4eca\u56de\u306fterraform\u3068\u305d\u3053\u3067\u5229\u7528\u3057\u3066\u3044\u308bCloudStack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092fork\u3057\u3066\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n> terraform\u306e\u65b9\u306e\u4fee\u6b63\u306e\u4e00\u90e8\u306f\u8a66\u9a13\u3092\u66f8\u3044\u305f\u3089PullRequest\u3092\u51fa\u3059\u3064\u3082\u308a\u3067\u3059\u3002\n\u305f\u3060CloudStack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3064\u3044\u3066\u306fCloudStack\u306e\u958b\u767a\u5143\u3068Version\u306b\u3088\u3063\u3066\u306f\u65e2\u5b58\u306e\u5b9f\u88c5\u306e\u307e\u307e\u3067\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\u3001\u3068\u3044\u3046\u3084\u308a\u53d6\u308a\u304cGithub\u4e0a\u3067\u3055\u308c\u3066\u304a\u308a\u3001\u30de\u30fc\u30b8\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u4f4e\u3044\u306e\u3067PullRequest\u306f\u51fa\u3055\u306a\u3044\u4e88\u5b9a\u3067\u3059\u3002\n\n# \u524d\u63d0\n- IDCF\u30af\u30e9\u30a6\u30c9\u306e\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u3053\u3068  \n  - APIKey\n  - SecretKey\n- Go\u306e\u30d3\u30eb\u30c9\u74b0\u5883\u304c\u3042\u308b\u3053\u3068\n\n# Terraform\u3068\u306f\nhttps://www.terraform.io/intro/\n\n\u3053\u3053\u3092\u898b\u308b\u3068\u30a4\u30f3\u30d5\u30e9\u3092\u30b3\u30fc\u30c9\u3067\u7ba1\u7406\u3057\u3066\u72b6\u614b\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3089\u3057\u3044\u3002\n`\u72b6\u614b` \u3092\u7ba1\u7406\u3059\u308b\u306e\u3067\u3001\u4f8b\u3048\u3070\u30a4\u30f3\u30d5\u30e9\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u3089\u305d\u306e\u5909\u66f4\u90e8\u5206\u3060\u3051\u3092\u9069\u7528\u3057\u3066\u304f\u308c\u308b\u611f\u3058\u304b\u306a\u3002\n\n# \u624b\u9806\n## \u74b0\u5883\n- OSX: 10.11.1\n- Go: 1.7.3\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n### GOPATH\u306e\u78ba\u8a8d\n```\n$ env | grep GOPATH\nGOPATH=/Users/aueno/.go\n$ \n```\n\n### \u30bd\u30fc\u30b9\u306e\u914d\u7f6e\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30af\u30ec\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002  \n\n```\n$ mkdir -p $GOPATH/src/github.com/akito1986\n```\n\n\u4ee5\u4e0b\u3067\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u3092 `git clone` \u3057\u3066\u304f\u308b\u3002\n\n```\n$ cd $GOPATH/src/github.com/akito1986\n$ git clone https://github.com/akito1986/terraform.git\n```\n \n### \u30d3\u30eb\u30c9\n\u30d3\u30eb\u30c9\u3059\u308b\u524d\u306b\u4f9d\u5b58\u3059\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u3002\n\n```\n$ cd terraform/\n$ go get -u\n$ ls -1 $GOPATH/src/github.com\nakito1986/\nhashicorp/\n$ \n```\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u5f8c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\n\u30d3\u30eb\u30c9\u5f8c\u306f`-o`\u3067\u6307\u5b9a\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9f\u884c\u3059\u308b\u3068\u30b3\u30de\u30f3\u30c9\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```\n$ go build -o /usr/local/bin/terraform\n$ /usr/local/bin/terraform\nUsage: terraform [--version] [--help] <command> [args]\n\nThe available commands for execution are listed below.\nThe most common, useful commands are shown first, followed by\nless common or more advanced commands. If you're just getting\nstarted with Terraform, stick with the common commands. For the\nother commands, please read the help and docs before usage.\n\nCommon commands:\n    apply              Builds or changes infrastructure\n    console            Interactive console for Terraform interpolations\n    destroy            Destroy Terraform-managed infrastructure\n    fmt                Rewrites config files to canonical format\n    get                Download and install modules for the configuration\n    graph              Create a visual graph of Terraform resources\n    import             Import existing infrastructure into Terraform\n    init               Initializes Terraform configuration from a module\n    output             Read an output from a state file\n    plan               Generate and show an execution plan\n    push               Upload this Terraform module to Atlas to run\n    refresh            Update local state file against real resources\n    remote             Configure remote state storage\n    show               Inspect Terraform state or plan\n    taint              Manually mark a resource for recreation\n    untaint            Manually unmark a resource as tainted\n    validate           Validates the Terraform files\n    version            Prints the Terraform version\n\nAll other commands:\n    state              Advanced state management\n$\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308c\u3070\u6b63\u5e38\u306b\u30d3\u30eb\u30c9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n## \u8a2d\u5b9a\nTerraform\u306f`HCL`\u304b`Json`\u3067\u30a4\u30f3\u30d5\u30e9\u3092\u7ba1\u7406\u3059\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u306f`HCL`\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n### HCL(Hashicorp Configuration Language)\n\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nhttp://dev.classmethod.jp/cloud/terraform-getting-started-with-aws/\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3067\u304d\u308b\u3089\u3057\u3044\u3067\u3059\u3002\n\n```\n// comment_1\n# comment_2\n\nvariable \"uri\" {\n  default = \"https://compute.jp-east.idcfcloud.com/client/api\"\n}\n\nvariable \"api_key\" {} // TF_VAR_xxx\u306e\u5f62\u5f0f\u3067\u74b0\u5883\u5909\u6570\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3059\u308b\u3002\nvariable \"secret_key\" {} // \u5024\u306fTF_VAR_secret_key\u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\u3002\n\nprovider \"cloudstack\" {                                                                     \n  api_url = \"${var.uri}\" // \u5909\u6570uri\u306e\u53c2\u7167\n  api_key = \"${var.api_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\n/* A multi\n   line comment. */\nresource \"cloudstack_instance\" \"vm_1\" {\n  name = \"terraform-test-1\"\n  service_offering= \"light.S1\" // name\u3067\u6307\u5b9a\u3067\u304d\u308b\u306e\u304c\u826f\u3044\u3067\u3059\u3088\u306d\u3002\n  network_id = \"${var.network_id}\"\n  template = \"CentOS 7.2 64-bit\"\n  zone = \"pascal\"\n  keypair = \"aueno\"\n}\n\nresource \"cloudstack_port_forward\" \"pf_ssh\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n  forward {\n    protocol = \"tcp\"\n    private_port = 22\n    public_port = 10022\n    virtual_machine_id = \"${cloudstack_instance.vm.id}\" // \u4ed6\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u5909\u6570\u306f\u300cresource\u7a2e\u5225.resource\u540d.\u5c5e\u6027\u540d\u300d\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n}\n...\n```\n\n\u4ee5\u4e0b\u5909\u6570\u306b\u3064\u3044\u3066\u306e\u81ea\u5206\u306a\u308a\u306e\u7406\u89e3\u3067\u3059\u3002\n\n- provider: \u3069\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308b\u306e\u304b\u3092\u8a18\u8f09\u3059\u308b\u3002`CloudStack`\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u5834\u5408\u306f`cloudstack`\u3068\u8a18\u8f09\n- resource: \u64cd\u4f5c\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8a18\u8f09\u3002\u7b2c\u4e00\u5f15\u6570\u306b\u64cd\u4f5c\u5bfe\u8c61\u306e\u30ea\u30bd\u30fc\u30b9\u7a2e\u5225\u3001\u7b2c\u4e8c\u5f15\u6570\u306b\u305d\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u540d\u524d\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n### CloudStack\u306e\u8a2d\u5b9a\nhttps://www.terraform.io/docs/providers/cloudstack/index.html\n\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a18\u8f09\u3059\u308b\u3002\n\u4eca\u56de\u3084\u308a\u305f\u3044\u3053\u3068\u306f\u4ee5\u4e0b\u306a\u306e\u3067\u3001\n\n- VM\u4f5c\u6210\n- Firewall\u8a2d\u5b9a\n- PortForwarding\u8a2d\u5b9a\n\n\u306a\u306e\u3067\u5fc5\u8981\u306a`cloudstack`\u306e\u30ea\u30bd\u30fc\u30b9\u306f\u4ee5\u4e0b\u3068\u306a\u308a\u307e\u3059\u3002\n\n- instance\n- ipaddress\n- port_forward\n- firewall\n\n#### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\nterraform\u306f\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e`.tf`\u3068\u3044\u3046\u62e1\u5f35\u5b50\u3092\u898b\u3066\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3092\u5224\u65ad\u3059\u308b\u3089\u3057\u3044\u306e\u3067\u672b\u5c3e\u306f `.tf` \u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```cloudstack.tf\nvariable myip {}\nvariable api_key {}\nvariable secret_key {}\nvariable network_id { default = \"957483e1-7e8f-4b0a-849b-84425e582130\" }\nprovider \"cloudstack\" {\n  api_url = \"https://compute.jp-east.idcfcloud.com/client/api\"\n  api_key = \"${var.api_key}\"\n  secret_key = \"${var.secret_key}\"\n}\n\nresource \"cloudstack_instance\" \"vm\" {\n  name = \"terraform-test-1\"\n  service_offering= \"light.S1\"\n  network_id = \"${var.network_id}\"\n  template = \"CentOS 7.2 64-bit\"\n  zone = \"pascal\"\n  keypair = \"aueno\"\n}\n\nresource \"cloudstack_ipaddress\" \"public_ipaddress\" {\n  network_id = \"${var.network_id}\"\n  zone = \"pascal\"\n}\n\nresource \"cloudstack_port_forward\" \"pf_ssh\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n  forward {\n    protocol = \"tcp\"\n    private_port = 22\n    public_port = 22\n    virtual_machine_id = \"${cloudstack_instance.vm.id}\"\n  }\n}\n\nresource \"cloudstack_firewall\" \"myip\" {\n  ip_address_id = \"${cloudstack_ipaddress.public_ipaddress.id}\"\n\n  rule {\n    cidr_list = [\"${var.myip}/32\"]\n    protocol = \"tcp\"\n    ports = [\"1-65535\"]\n  }\n}\n\noutput \"public_ipaddress\" {\n  value = \"${cloudstack_ipaddress.public_ipaddress.ip_address}\"\n}\n```\n\n\u4e0a\u8a18\u306f`terraform-test-1`(VM)\u3092\u4f5c\u6210\u3057\u3066\u3001`public_ipaddress`(public ipaddress)\u3092\u53d6\u5f97\u3057\u3066\u3001`public_ipaddress`\u306e22\u756aport\u3092`terraform-test-1`\u306e22\u756aport\u306bforwarding\u3057\u3066\u3001\u6700\u5f8c\u306b`public_ipaddress`\u306efirewall\u306b\u3064\u3044\u3066\u6307\u5b9a\u3057\u305f`myip`\u30a2\u30c9\u30ec\u30b9\u304b\u30891-65535\u30dd\u30fc\u30c8\u307e\u3067\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n## \u5b9f\u884c\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067Terraform\u3067\u4f55\u3092\u3059\u308b\u306e\u304b\u3092\u4e8b\u524d\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\napi_key\u3068secret_key\u3001myip\u306b\u3064\u3044\u3066\u306f\u305d\u308c\u305e\u308c\u3001IDCF\u30af\u30e9\u30a6\u30c9\u306eAPIKey\u3001SecretKey\u3001\u8a31\u53ef\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u306b\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ cloudstack_firewall.myip\n    ip_address_id:                        \"<computed>\"\n    managed:                              \"false\"\n    parallelism:                          \"2\"\n    rule.#:                               \"1\"\n    rule.1438695593.cidr_list.#:          \"1\"\n    rule.1438695593.cidr_list.3084607623: \"126.112.54.50/32\"\n    rule.1438695593.icmp_code:            \"<computed>\"\n    rule.1438695593.icmp_type:            \"<computed>\"\n    rule.1438695593.ports.#:              \"1\"\n    rule.1438695593.ports.1101440173:     \"1-65535\"\n    rule.1438695593.protocol:             \"tcp\"\n    rule.1438695593.uuids.%:              \"<computed>\"\n\n+ cloudstack_instance.vm\n    display_name:     \"<computed>\"\n    expunge:          \"false\"\n    group:            \"<computed>\"\n    ip_address:       \"<computed>\"\n    keypair:          \"aueno\"\n    name:             \"terraform-test-1\"\n    network_id:       \"957483e1-7e8f-4b0a-849b-84425e582130\"\n    project:          \"<computed>\"\n    service_offering: \"light.S1\"\n    template:         \"CentOS 7.2 64-bit\"\n    zone:             \"pascal\"\n\n+ cloudstack_ipaddress.public_ipaddress\n    ip_address: \"<computed>\"\n    network_id: \"957483e1-7e8f-4b0a-849b-84425e582130\"\n    project:    \"<computed>\"\n    zone:       \"pascal\"\n\n+ cloudstack_port_forward.pf_ssh\n    forward.#:                              \"1\"\n    forward.~1715957168.private_port:       \"22\"\n    forward.~1715957168.protocol:           \"tcp\"\n    forward.~1715957168.public_port:        \"22\"\n    forward.~1715957168.uuid:               \"<computed>\"\n    forward.~1715957168.virtual_machine_id: \"<computed>\"\n    ip_address_id:                          \"<computed>\"\n    managed:                                \"false\"\n\n\nPlan: 4 to add, 0 to change, 0 to destroy.\n$\n```\n\n4\u3064\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n`apply`\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u969b\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n\n```\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform apply\ncloudstack_ipaddress.public_ipaddress: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_firewall.myip: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_instance.vm: Creating...\n  display_name:     \"\" => \"<computed>\"\n  expunge:          \"\" => \"false\"\n  group:            \"\" => \"<computed>\"\n  ip_address:       \"\" => \"<computed>\"\n  keypair:          \"\" => \"aueno\"\n  name:             \"\" => \"terraform-test-1\"\n  network_id:       \"\" => \"957483e1-7e8f-4b0a-849b-84425e582130\"\n  project:          \"\" => \"<computed>\"\n  service_offering: \"\" => \"light.S1\"\n  template:         \"\" => \"CentOS 7.2 64-bit\"\n  zone:             \"\" => \"pascal\"\n.....\ncloudstack_instance.vm: Creation complete\ncloudstack_port_forward.pf_ssh: Creating...\n  forward.#:                             \"\" => \"1\"\n  forward.2467112059.private_port:       \"\" => \"22\"\n  forward.2467112059.protocol:           \"\" => \"tcp\"\n  forward.2467112059.public_port:        \"\" => \"22\"\n  forward.2467112059.uuid:               \"\" => \"<computed>\"\n  forward.2467112059.virtual_machine_id: \"\" => \"zzzzzzzzzzz\"\n  ip_address_id:                         \"\" => \"fb5fc420-0cbb-4599-be01-feb9766f0587\"\n  managed:                               \"\" => \"false\"\ncloudstack_port_forward.pf_ssh: Creation complete\n\nApply complete! Resources: 2 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\nOutputs:\n\npublic_ipaddress = sss.sss.sss.sss // \u5b9f\u969b\u306epublic ipaddress\u304c\u8868\u793a\u3055\u308c\u308b\n$ ssh root@sss.sss.sss.sss\nThe authenticity of host 'sss.sss.sss.sss (sss.sss.sss.sss)' can't be established.\nECDSA key fingerprint is SHA256:BN7g57iY4sfhMyiDOMbmSi+fBS19/vxRH8rd36X2h0M.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added 'sss.sss.sss.sss' (ECDSA) to the list of known hosts.\n    ________  ______   ______                 __  _          \n   /  _/ __ \\/ ____/  / ____/________  ____  / /_(_)__  _____\n   / // / / / /      / /_  / ___/ __ \\/ __ \\/ __/ / _ \\/ ___/\n _/ // /_/ / /___   / __/ / /  / /_/ / / / / /_/ /  __/ /    \n/___/_____/\\____/  /_/   /_/   \\____/_/ /_/\\__/_/\\___/_/     \n                                                             \n[root@terraform-test-1 ~]#\n```\n\n\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3068\u3053\u308d\u307e\u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u3053\u308c\u3067\u3044\u3061\u3044\u3061\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30c4\u30fc\u30eb\u3067\u3061\u307e\u3061\u307e\u8a2d\u5b9a\u3057\u305f\u308a\u3001\u30d6\u30e9\u30a6\u30b6\u7acb\u3061\u4e0a\u3052\u3066\u30dd\u30c1\u30dd\u30c1\u3057\u306a\u304f\u3066\u3082\u826f\u3044\u3067\u3059\u306d:smile:\n\u3088\u308a\u81ea\u5206\u304c\u3084\u308a\u305f\u3044\u3053\u3068\u306b\u5c02\u5ff5\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n# \u88dc\u8db3\n## \u73fe\u5728\u306e\u8a2d\u5b9a\u306e\u78ba\u8a8d\n`show`\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz \ncloudstack_firewall.myip:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  ip_address_id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  managed = false\n  parallelism = 2\n  rule.# = 1\n  rule.1438695593.cidr_list.# = 1\n  rule.1438695593.cidr_list.3084607623 = zzz.zzz.zzz.zzz/32\n  rule.1438695593.icmp_code = 0\n  rule.1438695593.icmp_type = 0\n  rule.1438695593.ports.# = 1\n  rule.1438695593.ports.1101440173 = 1-65535\n  rule.1438695593.protocol = tcp\n  rule.1438695593.uuids.% = 1\n  rule.1438695593.uuids.1-65535 = 67f70c34-d1de-4b49-99f5-e3df7ffbf2b7\ncloudstack_instance.vm:\n  id = c67aa47e-e928-4302-b665-b50edd455720\n  display_name = terraform-test-1\n  expunge = false\n  group = \n  ip_address = 10.6.1.5\n  keypair = aueno\n  name = terraform-test-1\n  network_id = 957483e1-7e8f-4b0a-849b-84425e582130\n  project = \n  service_offering = light.S1\n  template = CentOS 7.2 64-bit\n  zone = pascal\ncloudstack_ipaddress.public_ipaddress:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  ip_address = 210.140.78.47\n  network_id = 957483e1-7e8f-4b0a-849b-84425e582130\n  project = \n  zone = pascal\ncloudstack_port_forward.pf_ssh:\n  id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  forward.# = 1\n  forward.2467112059.private_port = 22\n  forward.2467112059.protocol = tcp\n  forward.2467112059.public_port = 22\n  forward.2467112059.uuid = 41792d57-e6ea-40cc-8fef-8506ad54375b\n  forward.2467112059.virtual_machine_id = c67aa47e-e928-4302-b665-b50edd455720\n  ip_address_id = fb5fc420-0cbb-4599-be01-feb9766f0587\n  managed = false\n\n\nOutputs:\n\npublic_ipaddress = sss.sss.sss.sss\n```\n\n## \u518d\u5b9f\u884c\u306e\u3068\u304d\u306e\u52d5\u4f5c\n`plan`\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ TF_VAR_api_key=xxxx TF_VAR_secret_key=yyyy TF_VAR_myip=zzz.zzz.zzz.zzz terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\ncloudstack_instance.vm: Refreshing state... (ID: c67aa47e-e928-4302-b665-b50edd455720)\ncloudstack_ipaddress.public_ipaddress: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_firewall.myip: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\ncloudstack_port_forward.pf_ssh: Refreshing state... (ID: fb5fc420-0cbb-4599-be01-feb9766f0587)\n\nNo changes. Infrastructure is up-to-date. This means that Terraform\ncould not detect any differences between your configuration and\nthe real physical resources that exist. As a result, Terraform\ndoesn't need to do anything.\n$ \n```\n\n\u8a2d\u5b9a\u304c\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u3067\u306fterraform\u306f\u4f55\u3082\u3057\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u304a\u308f\u308a\u306b\n\u304a\u3057\u307e\u3044\u3002\n\n\n\n\n\n\n\n\n", "tags": ["Terraform", "CloudStack", "IDCF\u30af\u30e9\u30a6\u30c9"]}