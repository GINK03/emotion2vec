{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\nDevise\u3067\u8a8d\u8a3c\u3059\u308bRails\u30a2\u30d7\u30ea\u3067User\u30e2\u30c7\u30eb\u306bconfirmable\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\u30e6\u30fc\u30b6\u30fc\u304c\u78ba\u8a8d\u30e1\u30fc\u30eb\u306b\u3042\u308b\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u5373\u30b5\u30a4\u30f3\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\n\u3084\u308a\u304b\u305f\nConfirmationsController#show\u3092\u30aa\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3002\n\u30b5\u30a4\u30f3\u30a4\u30f3\u3055\u305b\u305f\u3044\u30bf\u30a4\u30df\u30f3\u30b0\u3067sign_in(resource)\u3092\u547c\u3076\u3002\n\n/app/controllers/confirmations_controller.rb\n# Override\nclass ConfirmationsController < Devise::ConfirmationsController\n  def show\n    self.resource = resource_class.confirm_by_token(params[:confirmation_token])\n    yield resource if block_given?\n\n    if resource.errors.empty?\n      set_flash_message(:notice, :confirmed) if is_flashing_format?\n\n      sign_in(resource) # \u3053\u306e\u4e00\u884c\u3092\u52a0\u3048\u308b\u306e\u307f\n\n      respond_with_navigational(resource){ redirect_to after_confirmation_path_for(resource_name, resource) }\n    else\n      respond_with_navigational(resource.errors, :status => :unprocessable_entity){ render :new }\n    end\n  end\nend\n\n\ndevise\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u5916\u306b\u5b58\u5728\u3059\u308bconfirmations_controller.rb\u306b\u3064\u3044\u3066Devise\u306b\u77e5\u3089\u305b\u308b\u305f\u3081\u3001devise_for\u306b\u767b\u9332\u3059\u308b\u3002\n\n/config/routes.rb\nRails.application.routes.draw do\n  # ...\n\n  devise_for :users, controllers: { confirmations: 'confirmations' }\n\n  # ...\nend\n\n\n\n\u6f5c\u5728\u7684\u5371\u967a\u6027\n\u30e6\u30fc\u30b6\u30fc\u304c\u65b0\u898f\u767b\u9332\u6642\u306b\u9593\u9055\u3063\u305femail\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u5165\u3057\u305f\u5834\u5408\u3001\u305f\u307e\u305f\u307e\u305d\u306eemail\u3092\u53d7\u3051\u53d6\u3063\u305f\u7b2c\u4e09\u8005\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4e57\u3063\u53d6\u3089\u308c\u3066\u3057\u307e\u3059\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n\u53c2\u8003\u6587\u732e\n\nhttp://stackoverflow.com/questions/18655334/avoid-sign-in-after-confirmation-link-click-using-devise-gem/20961042#20961042\nhttp://www.rubydoc.info/github/plataformatec/devise/\n\n![Screenshot 2015-08-02 15.53.07.png](https://qiita-image-store.s3.amazonaws.com/0/82804/400f0587-6da3-d791-94f1-83f0d2897a5e.png)\n\n#\u524d\u63d0\n\nDevise\u3067\u8a8d\u8a3c\u3059\u308bRails\u30a2\u30d7\u30ea\u3067[User\u30e2\u30c7\u30eb\u306b`confirmable`\u30e2\u30b8\u30e5\u30fc\u30eb](https://github.com/plataformatec/devise/wiki/How-To:-Add-:confirmable-to-Users)\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u3002\n\n#\u3084\u308a\u305f\u3044\u3053\u3068\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u78ba\u8a8d\u30e1\u30fc\u30eb\u306b\u3042\u308b\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u5373\u30b5\u30a4\u30f3\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\n#\u3084\u308a\u304b\u305f\n\n`ConfirmationsController#show`\u3092\u30aa\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3002\n\u30b5\u30a4\u30f3\u30a4\u30f3\u3055\u305b\u305f\u3044\u30bf\u30a4\u30df\u30f3\u30b0\u3067`sign_in(resource)`\u3092\u547c\u3076\u3002\n\n```rb:/app/controllers/confirmations_controller.rb\n# Override\nclass ConfirmationsController < Devise::ConfirmationsController\n  def show\n    self.resource = resource_class.confirm_by_token(params[:confirmation_token])\n    yield resource if block_given?\n\n    if resource.errors.empty?\n      set_flash_message(:notice, :confirmed) if is_flashing_format?\n\n      sign_in(resource) # \u3053\u306e\u4e00\u884c\u3092\u52a0\u3048\u308b\u306e\u307f\n\n      respond_with_navigational(resource){ redirect_to after_confirmation_path_for(resource_name, resource) }\n    else\n      respond_with_navigational(resource.errors, :status => :unprocessable_entity){ render :new }\n    end\n  end\nend\n```\n\ndevise\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u5916\u306b\u5b58\u5728\u3059\u308b`confirmations_controller.rb`\u306b\u3064\u3044\u3066Devise\u306b\u77e5\u3089\u305b\u308b\u305f\u3081\u3001devise_for\u306b\u767b\u9332\u3059\u308b\u3002\n\n```rb:/config/routes.rb\nRails.application.routes.draw do\n  # ...\n\n  devise_for :users, controllers: { confirmations: 'confirmations' }\n\n  # ...\nend\n```\n\n#\u6f5c\u5728\u7684\u5371\u967a\u6027\n\n\u30e6\u30fc\u30b6\u30fc\u304c\u65b0\u898f\u767b\u9332\u6642\u306b\u9593\u9055\u3063\u305femail\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u5165\u3057\u305f\u5834\u5408\u3001\u305f\u307e\u305f\u307e\u305d\u306eemail\u3092\u53d7\u3051\u53d6\u3063\u305f\u7b2c\u4e09\u8005\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4e57\u3063\u53d6\u3089\u308c\u3066\u3057\u307e\u3059\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\n\n#\u53c2\u8003\u6587\u732e\n\n- http://stackoverflow.com/questions/18655334/avoid-sign-in-after-confirmation-link-click-using-devise-gem/20961042#20961042\n- http://www.rubydoc.info/github/plataformatec/devise/\n", "tags": ["Rails", "devise"]}