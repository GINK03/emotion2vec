{"context": " More than 1 year has passed since last update.\n\n\u53c2\u8003\u6587\u732e\n\nLPIC\u30ec\u30d9\u30eb3 304\u6280\u8853\u89e3\u8aac\u30bb\u30df\u30ca\u30fc\nPacemaker\u3067\u7c21\u5358\u30fb\u624b\u8efd\u306b\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0  \u3057\u3066\u307f\u3088\u3046\uff01\n\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff11\n\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff12\n\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff13\n\n\n\u3084\u3063\u305f\u3053\u3068\n\ncorosync\u3068pacemaker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncorosync\u306e\u57fa\u672c\u8a2d\u5b9a\n\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u3044\u308b\u3053\u3068\u3092crm\u3067\u78ba\u8a8d\n\n\n1. \u3068\u308a\u3042\u3048\u305a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u308b\n$ sudo apt-get install corosync\n$ sudo apt-get install pacemaker\n$ vi /etc/corosync/corosync.conf\n\n\u4e0b\u8a18\u3092\u8ffd\u52a0\nservice {\n    name: pacemaker\n    ver: 0\n    use_mgmtd: yes\n}\n\u4e0b\u8a18\u3092\u7de8\u96c6\ninterface {\n      # The following values need to be set based on your environment\n      ringnumber: 0\n      bindnetaddr: 192.168.5.0 <= \u9069\u5b9c\u7de8\u96c6\n      mcastaddr: 226.94.1.1\n      mcastport: 5405\n}\n\n\n$ sudo service corosync start\n => \u4f55\u3082\u8d77\u3053\u3089\u306a\u3044\u30fb\u30fb\u30fb\u30fb\n$ sudo /etc/init.d corosync start\n => \u4f55\u3082\u8d77\u3053\u3089\u306a\u3044\n$ ps ax | grep corosync\n => corosync\u304c\u304d\u3061\u3093\u3068\u52d5\u3044\u3066\u306a\u3044\u3063\u307d\u3044\n\n\u305d\u3082\u305d\u3082\u3001corosync\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u3066\u308b\u3002\u3002\u3002\u3002\ninit\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u3066\u307f\u308b\n\n/etc/init.d/corosync\n#! /bin/sh\n#\n### BEGIN INIT INFO\n# Provides:          corosync\n# Required-Start:    $network $remote_fs $syslog\n# Required-Stop:     $network $remote_fs $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: corosync cluster framework\n### END INIT INFO\n\n# Author: Fabio M. Di Nitto <fabbione@ubuntu.com>\n\n# PATH should only include /usr/* if it runs after the mountnfs.sh script\nPATH=/usr/sbin:/usr/bin:/sbin:/bin\nDESC=\"corosync daemon\"\nNAME=corosync\nDAEMON=/usr/sbin/$NAME\nDAEMON_ARGS=\"\"\nPIDFILE=/var/run/$NAME.pid\nSCRIPTNAME=/etc/init.d/$NAME\nPIDFILE=/var/run/corosync.pid\nRARUNDIR=/var/run/resource-agents\n\n# Exit if the package is not installed\n[ -x \"$DAEMON\" ] || exit 0\n\n# Read configuration variable file if it is present\n[ -r /etc/default/corosync ] && . /etc/default/corosync\n\n# Make sure the Resource Agents run dir exists. Otherwise create it.\n[ -d \"$RARUNDIR\" ] || mkdir -p $RARUNDIR\n\nif [ \"$START\" != \"yes\" ]; then\n    exit 0\nfi\n\n# Define LSB log_* functions.\n# Depend on lsb-base (>= 3.0-6) to ensure that this file is present.\n. /lib/lsb/init-functions\n\n^^^^^^^^^^\n\u7701\u7565\n^^^^^^^^^^\n\n\n\u3042\u301c\u306a\u308b\u307b\u3069\u3001\u3053\u3053\u3067\u6b62\u307e\u3063\u3066\u3044\u308b\u3088\u3046\u3002\n\n/etc/init.d/corosync\nif [ \"$START\" != \"yes\" ]; then\n    exit 0\nfi\n\n\nSTART\u306f\u3069\u3053\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u8abf\u3079\u308b\u3068/etc/default/corosync\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3088\u3046\n# start corosync at boot [yes|no]\nSTART=no\n\n\u30b3\u30e1\u30f3\u30c8\u306bstart corosync at boot\u3068\u304b\u66f8\u3044\u3066\u3042\u308b\u3051\u3069\u3001\u3053\u308c\u304cno\u3060\u3068\u3001\u3054\u89a7\u306e\u901a\u308a\n\u666e\u901a\u306b/etc/init.d/corosync\u304b\u3089\u3082service\u304b\u3089\u3082\u8d77\u52d5\u3067\u304d\u306a\u3044\u3002\n\u3053\u308c\u3063\u3066\u3001\u3042\u3048\u3066\u3053\u3093\u306a\u98a8\u306b\u3057\u3066\u308b\u306e\u304b\u306a\uff1f\n/etc/default/corosync\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\n# start corosync at boot [yes|no]\nSTART=yes\n\ncorosync\u3092\u8d77\u52d5\n$ sudo service corosync start\n * Starting corosync daemon corosync                        [ OK ]\n\n\u304a\u304a\u52d5\u3044\u305f\u52d5\u3044\u305f\u3001\u7d9a\u3044\u3066pacemaker\u3082\u8d77\u52d5\n$ sudo service pacemaker start\nStarting Pacemaker Cluster Manager: [  OK  ]\n\n\n2. crm\u3067\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\u3057\u3088\u3046\u3068\u3057\u305f\u304c\u3001\u52d5\u304b\u306a\u3044\u3002\u3002\u3002\n$ crm status\nCould not establish cib_ro connection: Connection refused (111)\nERROR: crm_mon exited with code 107 and said: Connection to cluster failed: Transport endpoint is not connected\n\n\u305d\u308c\u3082\u305d\u306e\u306f\u305a\u3001/etc/corosync/corosync.conf\u3067multicast\u3067\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u304c\u3001\u307e\u3060\u3001mutlicast\u30a2\u30c9\u30ec\u30b9\u3092nic\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3057\u305f\u30fb\u30fb\u30fb\u30fb\n$ ip maddr add 226.94.1.1 dev eth0\n$ ip maddr show eth0\n2:  eth0\n    link  01:00:5e:00:00:01\n    link  33:33:00:00:00:01\n    link  33:33:ff:91:14:ca\n    inet  224.0.0.1\n    inet6 ff02::1:ff91:14ca\n    inet6 ff02::1\n    inet6 ff01::1\n\n\u601d\u3063\u305f\u901a\u308a\u3001Multicast IP\u30a2\u30c9\u30ec\u30b9\u304c\u632f\u308c\u306a\u3044\u3002\u3002\u3002\n\u65ad\u5ff5\u3057\u3066\u3001/etc/corosync/corosync.conf\u3092\u5909\u66f4\u3057\u3066\u3001unicast\u3067\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\u3053\u3068\u306b\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u66f4\n$diff -u /etc/corosync/corosync.conf.old /etc/corosync/corosync.conf\n--- /etc/corosync/corosync.conf.old 2015-04-20 13:00:58.684539742 +0000\n+++ /etc/corosync/corosync.conf 2015-04-20 13:37:59.006067011 +0000\n@@ -43,10 +43,15 @@\n    rrp_mode: none\n\n    interface {\n+       member {\n+           memberaddr: 192.168.5.10\n+       }\n+       member {\n+           memberaddr: 192.168.5.11\n+       }\n        # The following values need to be set based on your environment\n        ringnumber: 0\n        bindnetaddr: 192.168.5.0\n-       mcastaddr: 226.94.1.1\n        mcastport: 5405\n    }\n    transport: udp\n\n\u3093\u3067\u3001\u3044\u308d\u3044\u308d\u518d\u8d77\u52d5\n$ sudo service corosync start\n$ sudo service pacemaker start\n\n\u78ba\u8a8d\u3059\u308b\u3068\u3001\n$ crm status\nLast updated: Mon Apr 20 13:41:49 2015\nLast change: Mon Apr 20 13:03:35 2015 via crmd on pace-test-one\nStack: corosync\nCurrent DC: pace-test-one (1084753162) - partition with quorum\nVersion: 1.1.10-42f2063\n2 Nodes configured\n0 Resources configured\n\n\nOnline: [ pace-test-one pace-test-two ]\n\n\u304a\u304a\u3001\u30af\u30e9\u30b9\u30bf\u306b\uff12\u3064\u767b\u9332\u3055\u308c\u3066\u3044\u308b\uff01\uff01\u3053\u3053\u306b\u306fhostname\u304c\u51fa\u308b\u307f\u305f\u3044\n\n##\u53c2\u8003\u6587\u732e\n- [LPIC\u30ec\u30d9\u30eb3 304\u6280\u8853\u89e3\u8aac\u30bb\u30df\u30ca\u30fc](http://www.lpi.or.jp/news/event/page/20140622_01_report/20140622_01_report_01.pdf)\n\n- [Pacemaker\u3067\u7c21\u5358\u30fb\u624b\u8efd\u306b\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\t\u3057\u3066\u307f\u3088\u3046\uff01](http://sourceforge.jp/projects/linux-ha/docs/Pacemaker_OSC2010Hokkaido_20100626/ja/1/Pacemaker_OSC2010Hokkaido_20100626.pdf)\n- [\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff11](http://linux-ha.sourceforge.jp/wp/archives/3786)\n- [\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff12](http://linux-ha.sourceforge.jp/wp/archives/3855)\n- [\u52d5\u304b\u3057\u3066\u7406\u89e3\u3059\u308bPacemaker \uff5eCRM\u8a2d\u5b9a\u7de8\uff5e \u305d\u306e\uff13](http://linux-ha.sourceforge.jp/wp/archives/3868)\n\n\n\n##\u3084\u3063\u305f\u3053\u3068\n - corosync\u3068pacemaker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n - corosync\u306e\u57fa\u672c\u8a2d\u5b9a\n - \u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u3044\u308b\u3053\u3068\u3092crm\u3067\u78ba\u8a8d\n\n\n\n\n##1. \u3068\u308a\u3042\u3048\u305a\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u308b\n```\n$ sudo apt-get install corosync\n$ sudo apt-get install pacemaker\n$ vi /etc/corosync/corosync.conf\n\n\u4e0b\u8a18\u3092\u8ffd\u52a0\nservice {\n    name: pacemaker\n    ver: 0\n    use_mgmtd: yes\n}\n\u4e0b\u8a18\u3092\u7de8\u96c6\ninterface {\n      # The following values need to be set based on your environment\n      ringnumber: 0\n      bindnetaddr: 192.168.5.0 <= \u9069\u5b9c\u7de8\u96c6\n      mcastaddr: 226.94.1.1\n      mcastport: 5405\n}\n\n\n$ sudo service corosync start\n => \u4f55\u3082\u8d77\u3053\u3089\u306a\u3044\u30fb\u30fb\u30fb\u30fb\n$ sudo /etc/init.d corosync start\n => \u4f55\u3082\u8d77\u3053\u3089\u306a\u3044\n$ ps ax | grep corosync\n => corosync\u304c\u304d\u3061\u3093\u3068\u52d5\u3044\u3066\u306a\u3044\u3063\u307d\u3044\n```\n\n\u305d\u3082\u305d\u3082\u3001corosync\u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u3066\u308b\u3002\u3002\u3002\u3002\ninit\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u3066\u307f\u308b\n\n```/etc/init.d/corosync\n#! /bin/sh\n#\n### BEGIN INIT INFO\n# Provides:          corosync\n# Required-Start:    $network $remote_fs $syslog\n# Required-Stop:     $network $remote_fs $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: corosync cluster framework\n### END INIT INFO\n\n# Author: Fabio M. Di Nitto <fabbione@ubuntu.com>\n\n# PATH should only include /usr/* if it runs after the mountnfs.sh script\nPATH=/usr/sbin:/usr/bin:/sbin:/bin\nDESC=\"corosync daemon\"\nNAME=corosync\nDAEMON=/usr/sbin/$NAME\nDAEMON_ARGS=\"\"\nPIDFILE=/var/run/$NAME.pid\nSCRIPTNAME=/etc/init.d/$NAME\nPIDFILE=/var/run/corosync.pid\nRARUNDIR=/var/run/resource-agents\n\n# Exit if the package is not installed\n[ -x \"$DAEMON\" ] || exit 0\n\n# Read configuration variable file if it is present\n[ -r /etc/default/corosync ] && . /etc/default/corosync\n\n# Make sure the Resource Agents run dir exists. Otherwise create it.\n[ -d \"$RARUNDIR\" ] || mkdir -p $RARUNDIR\n\nif [ \"$START\" != \"yes\" ]; then\n\texit 0\nfi\n\n# Define LSB log_* functions.\n# Depend on lsb-base (>= 3.0-6) to ensure that this file is present.\n. /lib/lsb/init-functions\n\n^^^^^^^^^^\n\u7701\u7565\n^^^^^^^^^^\n```\n\n\u3042\u301c\u306a\u308b\u307b\u3069\u3001\u3053\u3053\u3067\u6b62\u307e\u3063\u3066\u3044\u308b\u3088\u3046\u3002\n\n```/etc/init.d/corosync\nif [ \"$START\" != \"yes\" ]; then\n\texit 0\nfi\n```\nSTART\u306f\u3069\u3053\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u8abf\u3079\u308b\u3068/etc/default/corosync\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3088\u3046\n\n```/etc/default/corosync\n# start corosync at boot [yes|no]\nSTART=no\n```\n\u30b3\u30e1\u30f3\u30c8\u306bstart corosync at boot\u3068\u304b\u66f8\u3044\u3066\u3042\u308b\u3051\u3069\u3001\u3053\u308c\u304cno\u3060\u3068\u3001\u3054\u89a7\u306e\u901a\u308a\n\u666e\u901a\u306b/etc/init.d/corosync\u304b\u3089\u3082service\u304b\u3089\u3082\u8d77\u52d5\u3067\u304d\u306a\u3044\u3002\n\n\u3053\u308c\u3063\u3066\u3001\u3042\u3048\u3066\u3053\u3093\u306a\u98a8\u306b\u3057\u3066\u308b\u306e\u304b\u306a\uff1f\n\n/etc/default/corosync\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u7de8\u96c6\n\n```/etc/default/corosync\n# start corosync at boot [yes|no]\nSTART=yes\n```\n\ncorosync\u3092\u8d77\u52d5\n\n```\n$ sudo service corosync start\n * Starting corosync daemon corosync                        [ OK ]\n```\n\n\u304a\u304a\u52d5\u3044\u305f\u52d5\u3044\u305f\u3001\u7d9a\u3044\u3066pacemaker\u3082\u8d77\u52d5\n\n```\n$ sudo service pacemaker start\nStarting Pacemaker Cluster Manager: [  OK  ]\n```\n\n\n\n\n## 2. crm\u3067\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u3081\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\u3057\u3088\u3046\u3068\u3057\u305f\u304c\u3001\u52d5\u304b\u306a\u3044\u3002\u3002\u3002\n\n```\n$ crm status\nCould not establish cib_ro connection: Connection refused (111)\nERROR: crm_mon exited with code 107 and said: Connection to cluster failed: Transport endpoint is not connected\n```\n\n\u305d\u308c\u3082\u305d\u306e\u306f\u305a\u3001/etc/corosync/corosync.conf\u3067multicast\u3067\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u304c\u3001\u307e\u3060\u3001mutlicast\u30a2\u30c9\u30ec\u30b9\u3092nic\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u3057\u305f\u30fb\u30fb\u30fb\u30fb\n\n```\n$ ip maddr add 226.94.1.1 dev eth0\n$ ip maddr show eth0\n2:\teth0\n\tlink  01:00:5e:00:00:01\n\tlink  33:33:00:00:00:01\n\tlink  33:33:ff:91:14:ca\n\tinet  224.0.0.1\n\tinet6 ff02::1:ff91:14ca\n\tinet6 ff02::1\n\tinet6 ff01::1\n```\n\n\u601d\u3063\u305f\u901a\u308a\u3001Multicast IP\u30a2\u30c9\u30ec\u30b9\u304c\u632f\u308c\u306a\u3044\u3002\u3002\u3002\n\u65ad\u5ff5\u3057\u3066\u3001/etc/corosync/corosync.conf\u3092\u5909\u66f4\u3057\u3066\u3001unicast\u3067\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\u3053\u3068\u306b\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u66f4\n\n```\n$diff -u /etc/corosync/corosync.conf.old /etc/corosync/corosync.conf\n--- /etc/corosync/corosync.conf.old\t2015-04-20 13:00:58.684539742 +0000\n+++ /etc/corosync/corosync.conf\t2015-04-20 13:37:59.006067011 +0000\n@@ -43,10 +43,15 @@\n  \trrp_mode: none\n\n  \tinterface {\n+\t\tmember {\n+\t\t\tmemberaddr: 192.168.5.10\n+\t\t}\n+\t\tmember {\n+\t\t\tmemberaddr: 192.168.5.11\n+\t\t}\n \t\t# The following values need to be set based on your environment\n \t\tringnumber: 0\n \t\tbindnetaddr: 192.168.5.0\n-\t\tmcastaddr: 226.94.1.1\n \t\tmcastport: 5405\n \t}\n \ttransport: udp\n```\n\n\n\n\u3093\u3067\u3001\u3044\u308d\u3044\u308d\u518d\u8d77\u52d5\n\n\n```\n$ sudo service corosync start\n$ sudo service pacemaker start\n```\n\n\u78ba\u8a8d\u3059\u308b\u3068\u3001\n\n```\n$ crm status\nLast updated: Mon Apr 20 13:41:49 2015\nLast change: Mon Apr 20 13:03:35 2015 via crmd on pace-test-one\nStack: corosync\nCurrent DC: pace-test-one (1084753162) - partition with quorum\nVersion: 1.1.10-42f2063\n2 Nodes configured\n0 Resources configured\n\n\nOnline: [ pace-test-one pace-test-two ]\n```\n\n\u304a\u304a\u3001\u30af\u30e9\u30b9\u30bf\u306b\uff12\u3064\u767b\u9332\u3055\u308c\u3066\u3044\u308b\uff01\uff01\u3053\u3053\u306b\u306fhostname\u304c\u51fa\u308b\u307f\u305f\u3044\n\n\n\n\n", "tags": ["corosync", "pacemaker"]}