{"context": "Play Framework \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e HTTPS \u306e\u8a2d\u5b9a\u306e\u9805\u76ee\u304c\u3042\u307e\u308a\u306b\u3082\u30a8\u30b9\u30d1\u30fc\u5411\u3051\u306a\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u67fb\u3057\u3066\u307f\u305f\u306e\u306e\u307e\u3068\u3081\u3002Let's Encrypt \u3068 Play \u3067 https \u3092\u3084\u308a\u307e\u3059\u3002\u8a3c\u660e\u66f8\u66f4\u65b0\u7b49\u5404\u7a2e\u30b9\u30af\u30ea\u30d7\u30c8\u4ed8\u304d\u3002\n(\u305f\u3060\u3057\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3088\u3063\u3066\u767a\u751f\u3057\u305f\u3044\u304b\u306a\u308b\u4e0d\u5177\u5408\u30fb\u640d\u5bb3\u306b\u3064\u3044\u3066\u3082\u8cac\u4efb\u306f\u8ca0\u3044\u307e\u305b\u3093\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u5ff5\u306e\u305f\u3081)\u3002\n\n\u691c\u8a3c\u74b0\u5883\n\nUbuntu 16.04\nPlay 2.5\nOpenJDK 1.8\n\n\nLet's Encrypt \u304b\u3089\u8a3c\u660e\u66f8\u3092\u3082\u3089\u3046\nLet's Encrypt \u3067\u306f\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u306b\u95a2\u3059\u308b\u3044\u308d\u3044\u308d\u3092\u81ea\u52d5\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u3002\u307e\u305a\u305d\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u3068\u3044\u3063\u3066\u3082 git clone \u3059\u308b\u3060\u3051\u3002\n$ git clone https://github.com/certbot/certbot\n\n\u3042\u3068\u306f\u30af\u30ed\u30fc\u30f3\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e certbot-auto \u30b3\u30de\u30f3\u30c9\u3092\u57fa\u672c\u7684\u306b\u306f\u4f7f\u3046\u3002\u8a73\u3057\u304f\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u53c2\u7167\u3002\n\u4eca\u56de\u306f example.com \u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u3067 SSL \u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b\u3002\n$ ./certbot-auto certonly --standalone -d example.com -d www.example.com\n\nLet's Encrypt \u3067\u306f\u8a3c\u660e\u66f8\u306e\u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u5b9f\u969b\u306b\u305d\u3053\u3067\u7533\u8acb\u306b\u7528\u3044\u3089\u308c\u305f certbot \u3068\u901a\u4fe1\u3059\u308b\u3053\u3068\u3067\u3001\u30b5\u30fc\u30d0\u30fc/\u30c9\u30e1\u30a4\u30f3\u306e\u5b58\u5728\u8a3c\u660e\u3092\u3057\u3066\u3044\u308b\u306e\u3067\n\n\u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u304c\u5229\u7528\u3059\u308b\u3064\u3082\u308a\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\ncertbot \u304c\u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u306e\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3055\u308c\u308b\ncertbot \u7528\u306b 80 / 443 port \u304c\u958b\u653e\u3057\u3066\u3042\u308b(iptables\u30fbufw)\n\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u304c 80 / 443 port \u306b\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u3066\u3044\u306a\u3044(httpd \u3068\u304b\u3044\u305f\u3089\u3068\u3081\u3066\u304a\u304f)\n\n\u3053\u3068\u304c\u5fc5\u8981\u3002\n\u3044\u308d\u3044\u308d\u6307\u793a\u306b\u5f93\u3063\u3066\u5165\u529b\u3057\u3066\u3044\u3051\u3070\u8a3c\u660e\u66f8\u304c\u3082\u3089\u3048\u308b\u3002\u8a3c\u660e\u66f8\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c /etc/letsencrypt/live/<domain name>/ \u4ee5\u4e0b\u306b\u751f\u6210\u3055\u308c\u308b\u3002\u4eca\u56de\u306e\u5834\u5408\u306f /etc/letsencrypt/live/example.com/ \u4ee5\u4e0b\u306b\u3001\u6b21\u306e4\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\nprivkey.pem\ncert.pem\nchain.pem\nfullchain.pem\n\n\u898b\u3066\u5206\u304b\u308b\u901a\u308a\u3001PEM \u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c\u305f\u8a3c\u660e\u66f8\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\nPEM \u304b\u3089 Java Keystore (JKS) \u3092\u751f\u6210\u3059\u308b\n\u8a3c\u660e\u66f8\u304c\u5165\u624b\u51fa\u6765\u305f\u306e\u3067\u3001Play Framework \u306b\u3053\u306e\u8a3c\u660e\u66f8\u3092\u4f7f\u3063\u305fSSL\u901a\u4fe1\u3092\u3055\u305b\u305f\u3044\u3002Play \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b Configuring HTTPS \u3068\u3044\u3046\u30da\u30fc\u30b8\u304c\u3042\u308b\u3093\u3060\u3051\u308c\u3069 PEM \u306a\u3093\u3066\u5358\u8a9e\u306f\u5168\u304f\u51fa\u3066\u3053\u306a\u3044\u3057\u3001privkey \u3084 chain \u306a\u3069\u3044\u308d\u3044\u308d\u306a\u30d5\u30a1\u30a4\u30eb\u540d\u3082\u51fa\u3066\u3053\u306a\u3044\u3002\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u3093\u3060\u2026\n\u30dd\u30a4\u30f3\u30c8\u306f Java Keystore (JKS) \u3067\u3001Java \u3067\u8a3c\u660e\u66f8\u3092\u7528\u3044\u305f\u30bb\u30ad\u30e5\u30a2\u306a\u901a\u4fe1\u3092\u3059\u308b\u5834\u5408\u3001\u57fa\u672c\u7684\u306b\u306f\u3053\u306e JKS \u306b\u8a3c\u660e\u66f8\u3084\u30ad\u30fc\u3092\u683c\u7d0d\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u3089\u3057\u3044\u3002\u306a\u306e\u3067\u3001PEM \u304b\u3089 JKS \u306b\u5909\u63db\u3092\u3057\u307e\u3059\u3002\nPEM \u304b\u3089 JKS \u306b\u5909\u63db\u3059\u308b\u305f\u3081\u306b\u306f PEM -> PKCS -> JKS \u3068\u3044\u3046\u4e8c\u6bb5\u968e\u306e\u5909\u63db\u3092\u3059\u308b\u3002\n\nPEM -> PKCS\nopenssl \u3092\u5229\u7528\u3059\u308b\u3002\n$ openssl pkcs12 -export -passout pass:hogepiyofuga\n  -in /etc/letsencrypt/live/example.com/fullchain.pem\n  -inkey /etc/letsencrypt/live/example.com/privkey.pem\n  -out fullchain_and_key.p12 -name play\n\n(\u898b\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u8907\u6570\u884c\u306b\u6539\u884c\u3057\u305f\u304c1\u884c\u3067\u5165\u529b\u3059\u308b)\n\u591a\u5206\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f /etc/letsencrypt/ \u4ee5\u4e0b\u306e\u8a3c\u660e\u66f8\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea archive \u3068\u304b live \u306f\u6240\u6709\u6a29/\u30a2\u30af\u30bb\u30b9\u6a29\u304c root:root rwx------ \u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ea\u30fc\u30c9\u3060\u3051\u3067\u304d\u308b\u3088\u3046\u306b\u3044\u3044\u611f\u3058\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u308f\u308c\u308b(cron\u7528)\u3002\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u306f\u3044\u3044\u3093\u3060\u308d\u3046\u304b\u2026\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3067\u304d\u308b\u3068\u73fe\u5728\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b fullchain_and_key.p12 \u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\u306f\u305a\u3002\n\nPKCS -> JKS\nJava keytool \u3092\u4f7f\u3046\u3002JDK\u5165\u308c\u3066\u308c\u3070\u5165\u3063\u3066\u308b\u306f\u305a\u3002\nkeytool -importkeystore\n  -deststorepass <\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u308c\u308b>\n  -destkeypass <\uff01\uff01storepass\u3068\u540c\u3058\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u308c\u308b\uff01\uff01>\n  -destkeystore MyDSKeyStore.jks\n  -srckeystore fullchain_and_key.p12\n  -srcstoretype PKCS12\n  -srcstorepass hogepiyofuga\n  -alias play\n\n(\u898b\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u8907\u6570\u884c\u306b\u6539\u884c\u3057\u305f\u304c1\u884c\u3067\u5165\u529b\u3059\u308b)\n\u30dd\u30a4\u30f3\u30c8\u306f -deststorepass \u3068 -destkeypass \u306b\u306f \u5fc5\u305a \u540c\u3058\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3002\u3053\u308c\u3001\u6700\u521d Play \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u3082\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001Play \u306e SSL \u306e\u8a2d\u5b9a\u306b\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u30ad\u30fc\u304c play.server.https.keyStore.password \u3057\u304b\u306a\u304f\u3066\u3001\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3060\u3089\u3053\u306e\u30ad\u30fc\u306e\u5024\u3092 storepass \u3068 keypass \u4e21\u65b9\u306b\u4f7f\u3063\u3066\u3044\u305f... \u306e\u3067\u5fc5\u305a\u540c\u3058\u306b\u3057\u3066\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3068\u3044\u3066\u304f\u308c\u3088...\n\u3053\u308c\u3067\u3046\u307e\u304f\u884c\u3051\u3070 MyDSKeyStore.jks \u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\nPlay \u306b SSL/TLS \u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u3059\u308b\n\u7528\u610f\u3059\u3079\u304d\u3082\u306e\u306f5\u3064\u3002\n\nPlay application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\n\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb prod.conf\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\n\u30b5\u30fc\u30d0\u30fc\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\ncertbot \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u30b9\u30af\u30ea\u30d7\u30c8\u3068 cron \u8a2d\u5b9a\n\n\nPlay application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3068\u30c7\u30d7\u30ed\u30a4\n\u3068\u308a\u3042\u3048\u305a Play application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3092\u3059\u308b\u3002\u3053\u308c\u3082 Play 2.4 \u7cfb\u304b\u3089\u5909\u308f\u3063\u3066\u308b\u307f\u305f\u3044\u3067\u3001\u73fe\u5728\u306f dist \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\ndist \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u9069\u5f53\u306a\u3068\u3053\u308d\u306b target/universal/<project name>.zip \u304c\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u8ee2\u9001\u3057\u3066\u5c55\u958b\u3059\u308b\u3002\u5c55\u958b\u3057\u305f\u914d\u4e0b\u306b bin/<project name> \u3068\u3044\u3046\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u547c\u3073\u51fa\u305b\u3070\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3059\u308b\u3002\n\n\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb prod.conf\n\u304a\u305d\u3089\u304f\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3067\u8d77\u52d5\u3057\u3088\u3046\u3068\u3059\u308b\u3068 play.crypto.secret \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u306a\u3044\u304b\u3089\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3067\u304d\u306a\u3044\u3088\uff01\u3068\u6012\u3089\u308c\u308b\u3002\u306e\u3067\u3001play.crypto.secret \u3092\u8a2d\u5b9a\u3059\u308b\u3002\napplicaiton.conf \u306b\u306f\u30ed\u30fc\u30ab\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u8a2d\u5b9a / \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3068\u5171\u7528\u306e\u8a2d\u5b9a\u3060\u3051\u66f8\u3044\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306b\u307e\u3064\u308f\u308b\u3082\u306e\u306a\u3069\u306f\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u5c02\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3059\u308b\u3079\u304d\u306a\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nprod.conf\ninclude \"application\" \n\nplay.crypto.secret = \"<\u9069\u5f53\u306b\u751f\u6210\u3057\u305f secretkey>\" \n\nhttp.port = \"disabled\" \nhttps.port = 443 \n\nplay.server.https.keyStore.path = \"/path/to/your/keystore.jks\" \nplay.server.https.keyStore.type = \"JKS\" \nplay.server.https.keyStore.password = \"<JKS \u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u4f7f\u3063\u305f\u30d1\u30b9\u30ef\u30fc\u30c9>\" \n\n\n1\u884c\u76ee\u3067\u3001\u3082\u3068\u3082\u3068\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b application.conf \u3092 include \u3057\u3066\u3044\u308b\u3002\u3053\u308c\u3067 application.conf \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5185\u5bb9\u304c\u53d6\u308a\u8fbc\u307e\u308c\u308b\u3002Play \u306e conf \u30d5\u30a1\u30a4\u30eb\u3067\u306f HOCON Syntax \u304c\u5229\u7528\u3055\u308c\u3066\u3044\u3066\u3001\u65e2\u5b58\u306e\u9805\u76ee\u306b\u3064\u3044\u3066\u306f\u4e0b\u306b\u8a18\u8ff0\u306e\u3042\u308b\u65b9\u3067\u4e0a\u66f8\u304d\u3055\u308c\u308b(\u9806\u5e8f\u6027\u304c\u3042\u308b\uff01)\u306e\u3067\u3001\u5148\u982d\u3067 include \u3059\u308b\u3002\nplay.crypto.secret \u306b\u306f\u9069\u5f53\u306a\u30ad\u30fc\u3092\u6e21\u3057\u3066\u304f\u3060\u3055\u3044\u3002Generationg Appication Secret \u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308b\u3002\n\u4eca\u56de\u306f\u30b5\u30fc\u30d0\u30fc\u306b SSL/TLS \u3067\u901a\u4fe1\u3055\u305b\u305f\u3044\u306e\u3067\u3001http \u3092\u585e\u3044\u3067\u3001https \u306e well-known \u30dd\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\u3055\u3089\u306b SSL/TLS \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\u524d\u306e\u7ae0\u3067\u3064\u304f\u3063\u305f JKS \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u3082\u3053\u3053\u3067\u3057\u3066\u3044\u308b\u3002\n\u3053\u308c\u3067\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u6210\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\n\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u3001\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3002JSSE \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u304b\u3001\u4e0a\u8a18\u306e prod.conf \u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8aad\u307f\u3053\u3080\u3088\u3046\u306b Play application \u306b\u6307\u793a\u3059\u308b\u3002\n$ sudo ./start.sh server-0.0.1/\n\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u4f7f\u3046\u3002\n\nstart.sh\n#!/bin/bash\n\npath=\"/tekitou/na/server/you/folder\"\n\nif [ $# == 1 ]; then\n    temptarget=$1\n    newtarget=${temptarget%/}\n    echo $newtarget > $path/target.path\nelse\n    echo \"Usage: ./start.sh server-path/\"\n    exit 0\nfi\n\ntarget=`cat $path/target.path`\n\nif [ -d \"$path/$target/\" ]; then\n    echo \"Start $target server.\"\nelse\n    echo \"$target not found.\"\n    exit 0\nfi\n\nnohup $path/$target/bin/<project name> -Djdk.tls.ephemeralDHKeySize=2048 -Djdk.tls.rejectClientInitiatedRenegotiation=true -Dconfig.file=/path/to/your/prod.conf &\n\n\nnohup \u306f\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u9589\u3058\u3066\u3082\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u3092\u6bba\u3055\u306a\u3044\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3002\u8a73\u3057\u304f\u306f\u30b0\u30b0\u30c3\u3066\u3002<project name> \u306e\u3068\u3053\u308d\u306f\u9069\u5b9c\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u6642\u70b9\u3067\u304a\u5bdf\u3057\u304b\u3082\u77e5\u308c\u306a\u3044\u304c\u3001Play \u306b\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a http \u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c7\u30fc\u30e2\u30f3\u307f\u305f\u3044\u306a\u3082\u306e\u304c\u3044\u306a\u304f\u3066\u3001\u3059\u3079\u3066\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u3002\u305d\u3057\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3067\u304d\u308b\u307f\u305f\u3044\u306a\u6c17\u306e\u5229\u3044\u305f\u3082\u306e\u306f\u306a\u3044\u3002\u30d5\u30ed\u30f3\u30c8\u30bf\u30b9\u30af\u306b\u3044\u308b\u6642\u306b Ctrl-c \u3059\u308b\u304b\u3001kill  \u3059\u308b\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u81ea\u4f5c\u3059\u308b\u3002\n\nstop.sh\n#!/bin/bash\n\npath=\"/tekitou/na/server/you/folder\"\ntargetpath=`cat $path/target.path`\n\nif [ ! -f $path/$targetpath/RUNNING_PID ]; then\n    echo \"Cannot find RUNNING_PID\"\n    exit 0\nfi\n\necho \"Stop $targetpath server.\"\n\nkill `cat $targetpath/RUNNING_PID`\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3060\u3068\u30b5\u30fc\u30d0\u30fc\u5b9f\u884c\u4e2d\u306b\u3001\u5c55\u958b\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u306e\u30d5\u30a9\u30eb\u30c0\u306b RUNNING_PID \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u3053\u306e\u5185\u5bb9\u3092\u53c2\u7167\u3057\u3066 kill \u30b3\u30de\u30f3\u30c9\u3092\u9001\u308b\u3060\u3051\u3002\n\nLet's Encrypt \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u30b9\u30af\u30ea\u30d7\u30c8\u3068 cron \u8a2d\u5b9a\n\u3053\u3053\u307e\u3067\u3084\u308c\u3070\u3001\u4e0a\u8a18\u306e start / stop \u30b9\u30af\u30ea\u30d7\u30c8\u3067 Play \u3067 https \u901a\u4fe1\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\u304c\u3001Let's Encrypt \u306e\u8a3c\u660e\u66f8\u306f\u5bff\u547d\u304c\u306a\u3093\u306890\u65e5\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3092\u308f\u308a\u3068\u983b\u7e41\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u5fd8\u308c\u305f\u3089\u8a3c\u660e\u66f8\u671f\u9650\u5207\u308c\u306e\u60b2\u5287\u306b\u306a\u308b\u306e\u3067\u81ea\u52d5\u5316\u3057\u305f\u3044\u3002\n\n\u66f4\u65b0\u3057\u305f\u8a3c\u660e\u66f8\u304b\u3089 JKS \u3078\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u81ea\u52d5\u5316\n\u307e\u305a\u3001Let's Encrypt \u3067\u8a3c\u660e\u66f8\u3092\u66f4\u65b0\u51fa\u6765\u3066\u3082 Play \u306f JKS \u5f62\u5f0f\u3067\u306a\u3044\u3068\u56f0\u308b\u306e\u3067\u3001PEM -> JKS \u306e\u5909\u63db\u3092\u81ea\u52d5\u5316\u3059\u308b\u3002\n\ncreate_jks.sh\n#!/bin/sh\n\ncallpath=`pwd`\nrelativepath=`dirname $0`\npasspath=\"<\u9069\u5f53\u306a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f8\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9>\"\npass=`cat $passpath`\npempath=\"/etc/letsencrypt/live/<\u30c9\u30e1\u30a4\u30f3\u540d>\"\npkcsname=\"chain_and_key.p12\"\nkeyalias=\"play\"\njksname=\"keystore.jks\"\n\ncd $relativepath\n\nif [ -f $pkcsname ]; then\n    rm $pkcsname\nfi\n\nif [ -f $jksname ]; then\n    rm $jksname\nfi\n\nopenssl pkcs12 -export -passout pass:$pass -in $pempath/fullchain.pem -inkey $pempath/privkey.pem -out $pkcsname -name $keyalias\nkeytool -importkeystore -deststorepass $pass -destkeypass $pass -destkeystore $jksname -srckeystore $pkcsname -srcstoretype PKCS12 -srcstorepass $pass -alias $keyalias\n\nchmod 660 $pkcsname\nchmod 660 $jksname\nchown biacco42:root $pkcsname\nchown biacco42:root $jksname\n\ncd $callpath\n\n\n\u57fa\u672c\u7684\u306b\u306f\u3001\u3059\u3067\u306b\u8aac\u660e\u3057\u305f PEM -> JKS \u5909\u63db\u306e\u624b\u7d9a\u304d\u3092\u66f8\u3044\u3066\u3001\u5229\u4fbf\u6027\u306e\u305f\u3081\u306b\u30a2\u30af\u30bb\u30b9\u6a29\u7b49\u3092\u8a2d\u5b9a\u3057\u3066\u308b\u3060\u3051\u3002\n\nLet's Encrypt \u306e\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\n\u57fa\u672c\u7684\u306b\u306f certbot-auto renew \u3067\u304a\u3063\u3051\u30fc\u306a\u3093\u3060\u3051\u3069\u3001\u81ea\u52d5\u5316\u3057\u3088\u3046\u3068\u601d\u3046\u3068\u3044\u304f\u3064\u304b\u554f\u984c\u304c\u3042\u308b\u3002\n\ncertbot \u306f Let's Encrypt \u30b5\u30fc\u30d0\u30fc\u3068\u5bfe\u8a71\u3057\u3066\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3059\u308b\u306e\u3067\u3001\u5bfe\u8a71\u306b\u7528\u3044\u308b\u30dd\u30fc\u30c8(443)\u3092\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u5229\u7528\u3057\u3066\u3044\u3066\u306f\u3044\u3051\u306a\u3044\ncertbot \u306f root \u6a29\u9650\u3092\u8981\u6c42\u3059\u308b(1024\u756a\u4ee5\u4e0b\u306e\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b Privilege Permission \u304c\u5fc5\u8981)\n\n\n1. certbot \u306e\u305f\u3081\u306b Play \u3092\u505c\u6b62\u3001\u518d\u8d77\u52d5\u3059\u308b\n\u307e\u305a\u306f 1. \u304b\u3089\u3002\u5f53\u7136\u306e\u3053\u3068\u306a\u304c\u3089\u3001\u5b9f\u884c\u4e2d\u306e Play application \u306f 443 \u30dd\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001certbot \u3092\u52d5\u304b\u3059\u3068\u304d\u306b\u306f\u4e00\u6642\u7684\u306b\u505c\u6b62\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\u3002\n\nrenew.sh\n#!/bin/sh\n\nhome=\"<home>\"\npath=\"$home/server\"\ntargetpath=`cat $path/target.path`\npid=`cat $path/$targetpath/RUNNING_PID`\n\n$path/stop.sh\nwait $pid\n\n$home/tools/certbot/certbot-auto renew --standalone --quiet\n\n$path/cert/create_jks.sh\n$path/start.sh $targetpath/\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4e0b\u8a18\u3092\u4eee\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n<HOME>\n\u251c tools\n\u2502 \u2514 certbot\n\u2514 server\n  \u251c start.sh\n  \u251c stop.sh\n  \u2514 cert\n    \u2514 create_jks.sh\n\n\u672c\u5f53\u306f\u3001certbot-auto renew \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b --pre-hook\u3001--post-hook \u3068\u3044\u3046\u306e\u304c\u3042\u308b\u3093\u3060\u3051\u308c\u3069\u3001\u30d1\u30b9\u6307\u5b9a\u3057\u305f\u308a\u3001\u3084\u308b\u3053\u3068\u304c\u591a\u304b\u3063\u305f\u308a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u307e\u3068\u3081\u3066\u3057\u307e\u3063\u305f\u3002\u3042\u307e\u308a\u3088\u304f\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\ncron \u3092 sudo \u3067\u5b9f\u884c\u3059\u308b\n\u6b21\u306b 2.\u3002\u3053\u308c\u306f crontab \u3067\u306e\u767b\u9332\u3092 sudo \u3067\u884c\u3046\u3053\u3068\u3067\u3001\u305d\u306e\u30e6\u30fc\u30b6\u30fc\u3067 cron \u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001OK\u3002\u3068\u7c21\u5358\u306b\u306f\u3044\u304b\u306a\u3044\u3002\n\u5f53\u7136\u306e\u3053\u3068\u306a\u304c\u3089\u3001\u901a\u5e38\u901a\u308a sudo \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001sudo \u3092\u547c\u3073\u51fa\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306b\u5bfe\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u6c42\u304c\u767a\u751f\u3059\u308b\u306e\u3067\u3001\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u56f0\u308b\u3002\u307e\u305f\u3001sudo \u306f tty (\u30bf\u30fc\u30df\u30ca\u30eb) \u304b\u3089\u306e\u307f\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001cron \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6012\u3089\u308c\u308b\u3002\u8a73\u3057\u304f\u306f \u30d0\u30c3\u30af\u30a2\u30c3\u30d7cron\u3067sudo\u3092\u4f7f\u3046 \u3042\u305f\u308a\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001sudo visodo \u3042\u305f\u308a\u3067\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\nDefaults:<cron \u3092\u767b\u9332\u3059\u308b\u30e6\u30fc\u30b6\u30fc>      !requiretty\n<cron \u3092\u767b\u9332\u3059\u308b\u30e6\u30fc\u30b6\u30fc> ALL=(ALL)     NOPASSWD: /path/to/renew.sh\n\n\u3053\u308c\u3067\u3001cron \u767b\u9332\u30e6\u30fc\u30b6\u30fc\u306f tty \u3092\u901a\u3055\u305a sudo \u3067\u304d\u3066\u3001renew.sh \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u306b\u969b\u3057\u3066 \u3060\u3051 \u306f sudo \u3067\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u6c42\u304c\u4e0d\u8981\u306b\u306a\u308b\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u3084\u3063\u3068 cron \u306b\u30bf\u30b9\u30af\u3092\u767b\u9332\u3067\u304d\u308b\u3002certbot-auto \u306f\u8a3c\u660e\u66f8\u306e\u671f\u9650\u3092\u78ba\u8a8d\u3057\u3066\u3001\u6b8b\u308a\u671f\u9650\u304c 30 \u65e5\u4ee5\u4e0b\u306e\u5834\u5408\u306e\u307f\u8a3c\u660e\u66f8\u3092\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u9593\u9694\u3067\u547c\u3093\u3060\u3089\u3044\u3044\u3060\u308d\u3046\u3002\n$ sudo crontab -e\n\n00 5 1,15 * * /path/to/renew.sh\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001Let's Encrypt \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u30c6\u30b9\u30c8\u5b9f\u884c\u3068\u3057\u3066 renew.sh \u306e certbot-auto renew \u306b --force-renew \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3068\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u6319\u52d5\u78ba\u8a8d\u304c\u3067\u304d\u308b\u3068\u601d\u3046\u3002\n\n\u307e\u3068\u3081\n\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3067 Play + Let's Encrypt \u3067 https \u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n\u3088\u304b\u3063\u305f\u306d\u3002\nPlay Framework \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e [HTTPS \u306e\u8a2d\u5b9a\u306e\u9805\u76ee](https://www.playframework.com/documentation/2.5.x/ConfiguringHttps)\u304c\u3042\u307e\u308a\u306b\u3082\u30a8\u30b9\u30d1\u30fc\u5411\u3051\u306a\u306e\u3067\u3001\u3044\u308d\u3044\u308d\u8abf\u67fb\u3057\u3066\u307f\u305f\u306e\u306e\u307e\u3068\u3081\u3002Let's Encrypt \u3068 Play \u3067 https \u3092\u3084\u308a\u307e\u3059\u3002\u8a3c\u660e\u66f8\u66f4\u65b0\u7b49\u5404\u7a2e\u30b9\u30af\u30ea\u30d7\u30c8\u4ed8\u304d\u3002\n(\u305f\u3060\u3057\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u3088\u3063\u3066\u767a\u751f\u3057\u305f\u3044\u304b\u306a\u308b\u4e0d\u5177\u5408\u30fb\u640d\u5bb3\u306b\u3064\u3044\u3066\u3082\u8cac\u4efb\u306f\u8ca0\u3044\u307e\u305b\u3093\u3002\u81ea\u5df1\u8cac\u4efb\u3067\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u5ff5\u306e\u305f\u3081)\u3002\n\n# \u691c\u8a3c\u74b0\u5883\n\n- Ubuntu 16.04\n- Play 2.5\n- OpenJDK 1.8\n\n# Let's Encrypt \u304b\u3089\u8a3c\u660e\u66f8\u3092\u3082\u3089\u3046\n\nLet's Encrypt \u3067\u306f\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u306b\u95a2\u3059\u308b\u3044\u308d\u3044\u308d\u3092\u81ea\u52d5\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3092\u63d0\u4f9b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u3002\u307e\u305a\u305d\u308c\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\u3068\u3044\u3063\u3066\u3082 git clone \u3059\u308b\u3060\u3051\u3002\n\n```\n$ git clone https://github.com/certbot/certbot\n```\n\n\u3042\u3068\u306f\u30af\u30ed\u30fc\u30f3\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e certbot-auto \u30b3\u30de\u30f3\u30c9\u3092\u57fa\u672c\u7684\u306b\u306f\u4f7f\u3046\u3002\u8a73\u3057\u304f\u306f[\u516c\u5f0f\u30da\u30fc\u30b8](https://letsencrypt.jp/usage/)\u53c2\u7167\u3002\n\n\u4eca\u56de\u306f example.com \u3068\u3044\u3046\u30c9\u30e1\u30a4\u30f3\u3067 SSL \u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b\u3002\n\n```\n$ ./certbot-auto certonly --standalone -d example.com -d www.example.com\n```\n\nLet's Encrypt \u3067\u306f\u8a3c\u660e\u66f8\u306e\u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u5b9f\u969b\u306b\u305d\u3053\u3067\u7533\u8acb\u306b\u7528\u3044\u3089\u308c\u305f certbot \u3068\u901a\u4fe1\u3059\u308b\u3053\u3068\u3067\u3001\u30b5\u30fc\u30d0\u30fc/\u30c9\u30e1\u30a4\u30f3\u306e\u5b58\u5728\u8a3c\u660e\u3092\u3057\u3066\u3044\u308b\u306e\u3067\n\n- \u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u304c\u5229\u7528\u3059\u308b\u3064\u3082\u308a\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\n- certbot \u304c\u7533\u8acb\u30c9\u30e1\u30a4\u30f3\u306e\u5272\u308a\u5f53\u3066\u3089\u308c\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3055\u308c\u308b\n- certbot \u7528\u306b 80 / 443 port \u304c\u958b\u653e\u3057\u3066\u3042\u308b(iptables\u30fbufw)\n- \u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u304c 80 / 443 port \u306b\u30d0\u30a4\u30f3\u30c9\u3055\u308c\u3066\u3044\u306a\u3044(httpd \u3068\u304b\u3044\u305f\u3089\u3068\u3081\u3066\u304a\u304f)\n\n\u3053\u3068\u304c\u5fc5\u8981\u3002\n\n\u3044\u308d\u3044\u308d\u6307\u793a\u306b\u5f93\u3063\u3066\u5165\u529b\u3057\u3066\u3044\u3051\u3070\u8a3c\u660e\u66f8\u304c\u3082\u3089\u3048\u308b\u3002\u8a3c\u660e\u66f8\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u304c ```/etc/letsencrypt/live/<domain name>/``` \u4ee5\u4e0b\u306b\u751f\u6210\u3055\u308c\u308b\u3002\u4eca\u56de\u306e\u5834\u5408\u306f ```/etc/letsencrypt/live/example.com/``` \u4ee5\u4e0b\u306b\u3001\u6b21\u306e4\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\n- privkey.pem\n- cert.pem\n- chain.pem\n- fullchain.pem\n\n\u898b\u3066\u5206\u304b\u308b\u901a\u308a\u3001PEM \u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c\u305f\u8a3c\u660e\u66f8\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n# PEM \u304b\u3089 Java Keystore (JKS) \u3092\u751f\u6210\u3059\u308b\n\n\u8a3c\u660e\u66f8\u304c\u5165\u624b\u51fa\u6765\u305f\u306e\u3067\u3001Play Framework \u306b\u3053\u306e\u8a3c\u660e\u66f8\u3092\u4f7f\u3063\u305fSSL\u901a\u4fe1\u3092\u3055\u305b\u305f\u3044\u3002Play \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b [Configuring HTTPS](https://www.playframework.com/documentation/2.5.x/ConfiguringHttps) \u3068\u3044\u3046\u30da\u30fc\u30b8\u304c\u3042\u308b\u3093\u3060\u3051\u308c\u3069 PEM \u306a\u3093\u3066\u5358\u8a9e\u306f\u5168\u304f\u51fa\u3066\u3053\u306a\u3044\u3057\u3001privkey \u3084 chain \u306a\u3069\u3044\u308d\u3044\u308d\u306a\u30d5\u30a1\u30a4\u30eb\u540d\u3082\u51fa\u3066\u3053\u306a\u3044\u3002\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u3093\u3060\u2026\n\n\u30dd\u30a4\u30f3\u30c8\u306f Java Keystore (JKS) \u3067\u3001Java \u3067\u8a3c\u660e\u66f8\u3092\u7528\u3044\u305f\u30bb\u30ad\u30e5\u30a2\u306a\u901a\u4fe1\u3092\u3059\u308b\u5834\u5408\u3001\u57fa\u672c\u7684\u306b\u306f\u3053\u306e JKS \u306b\u8a3c\u660e\u66f8\u3084\u30ad\u30fc\u3092\u683c\u7d0d\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u3089\u3057\u3044\u3002\u306a\u306e\u3067\u3001PEM \u304b\u3089 JKS \u306b\u5909\u63db\u3092\u3057\u307e\u3059\u3002\n\nPEM \u304b\u3089 JKS \u306b\u5909\u63db\u3059\u308b\u305f\u3081\u306b\u306f PEM -> PKCS -> JKS \u3068\u3044\u3046\u4e8c\u6bb5\u968e\u306e\u5909\u63db\u3092\u3059\u308b\u3002\n\n## PEM -> PKCS\n\nopenssl \u3092\u5229\u7528\u3059\u308b\u3002\n\n```\n$ openssl pkcs12 -export -passout pass:hogepiyofuga\n  -in /etc/letsencrypt/live/example.com/fullchain.pem\n  -inkey /etc/letsencrypt/live/example.com/privkey.pem\n  -out fullchain_and_key.p12 -name play\n```\n\n(\u898b\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u8907\u6570\u884c\u306b\u6539\u884c\u3057\u305f\u304c1\u884c\u3067\u5165\u529b\u3059\u308b)\n\n\u591a\u5206\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f ```/etc/letsencrypt/``` \u4ee5\u4e0b\u306e\u8a3c\u660e\u66f8\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea ```archive``` \u3068\u304b ```live``` \u306f\u6240\u6709\u6a29/\u30a2\u30af\u30bb\u30b9\u6a29\u304c ```root:root rwx------``` \u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30ea\u30fc\u30c9\u3060\u3051\u3067\u304d\u308b\u3088\u3046\u306b\u3044\u3044\u611f\u3058\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u308f\u308c\u308b(cron\u7528)\u3002\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u7684\u306b\u306f\u3044\u3044\u3093\u3060\u308d\u3046\u304b\u2026\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3067\u304d\u308b\u3068\u73fe\u5728\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b ```fullchain_and_key.p12``` \u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\u306f\u305a\u3002\n\n## PKCS -> JKS\n\nJava keytool \u3092\u4f7f\u3046\u3002JDK\u5165\u308c\u3066\u308c\u3070\u5165\u3063\u3066\u308b\u306f\u305a\u3002\n\n```\nkeytool -importkeystore\n  -deststorepass <\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u308c\u308b>\n  -destkeypass <\uff01\uff01storepass\u3068\u540c\u3058\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u308c\u308b\uff01\uff01>\n  -destkeystore MyDSKeyStore.jks\n  -srckeystore fullchain_and_key.p12\n  -srcstoretype PKCS12\n  -srcstorepass hogepiyofuga\n  -alias play\n```\n\n(\u898b\u3084\u3059\u3055\u306e\u305f\u3081\u306b\u8907\u6570\u884c\u306b\u6539\u884c\u3057\u305f\u304c1\u884c\u3067\u5165\u529b\u3059\u308b)\n\n\u30dd\u30a4\u30f3\u30c8\u306f ```-deststorepass``` \u3068 ```-destkeypass``` \u306b\u306f __\u5fc5\u305a__ \u540c\u3058\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3002\u3053\u308c\u3001\u6700\u521d Play \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u3082\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001Play \u306e SSL \u306e\u8a2d\u5b9a\u306b\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3059\u308b\u30ad\u30fc\u304c ```play.server.https.keyStore.password``` \u3057\u304b\u306a\u304f\u3066\u3001\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3060\u3089\u3053\u306e\u30ad\u30fc\u306e\u5024\u3092 storepass \u3068 keypass \u4e21\u65b9\u306b\u4f7f\u3063\u3066\u3044\u305f... \u306e\u3067\u5fc5\u305a\u540c\u3058\u306b\u3057\u3066\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u3044\u3068\u3044\u3066\u304f\u308c\u3088...\n\n\u3053\u308c\u3067\u3046\u307e\u304f\u884c\u3051\u3070 ```MyDSKeyStore.jks``` \u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n# Play \u306b SSL/TLS \u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u3059\u308b\n\n\u7528\u610f\u3059\u3079\u304d\u3082\u306e\u306f5\u3064\u3002\n\n- Play application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\n- \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb prod.conf\n- \u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\n- \u30b5\u30fc\u30d0\u30fc\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\n- certbot \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u30b9\u30af\u30ea\u30d7\u30c8\u3068 cron \u8a2d\u5b9a\n\n## Play application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3068\u30c7\u30d7\u30ed\u30a4\n\n\u3068\u308a\u3042\u3048\u305a Play application \u306e\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3092\u3059\u308b\u3002\u3053\u308c\u3082 Play 2.4 \u7cfb\u304b\u3089\u5909\u308f\u3063\u3066\u308b\u307f\u305f\u3044\u3067\u3001\u73fe\u5728\u306f [dist](https://www.playframework.com/documentation/2.5.x/Deploying#using-the-dist-task) \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u308f\u308c\u3066\u3044\u308b\u3002\n\ndist \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u9069\u5f53\u306a\u3068\u3053\u308d\u306b ```target/universal/<project name>.zip``` \u304c\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u30b5\u30fc\u30d0\u30fc\u306b\u8ee2\u9001\u3057\u3066\u5c55\u958b\u3059\u308b\u3002\u5c55\u958b\u3057\u305f\u914d\u4e0b\u306b ```bin/<project name>``` \u3068\u3044\u3046\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u547c\u3073\u51fa\u305b\u3070\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3059\u308b\u3002\n\n## \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb prod.conf\n\n\u304a\u305d\u3089\u304f\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3067\u8d77\u52d5\u3057\u3088\u3046\u3068\u3059\u308b\u3068 ```play.crypto.secret``` \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u306a\u3044\u304b\u3089\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3067\u304d\u306a\u3044\u3088\uff01\u3068\u6012\u3089\u308c\u308b\u3002\u306e\u3067\u3001```play.crypto.secret``` \u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\napplicaiton.conf \u306b\u306f\u30ed\u30fc\u30ab\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u8a2d\u5b9a / \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u3068\u5171\u7528\u306e\u8a2d\u5b9a\u3060\u3051\u66f8\u3044\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306b\u307e\u3064\u308f\u308b\u3082\u306e\u306a\u3069\u306f\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u5c02\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3059\u308b\u3079\u304d\u306a\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```prod.conf\ninclude \"application\" \n\nplay.crypto.secret = \"<\u9069\u5f53\u306b\u751f\u6210\u3057\u305f secretkey>\" \n\nhttp.port = \"disabled\" \nhttps.port = 443 \n \nplay.server.https.keyStore.path = \"/path/to/your/keystore.jks\" \nplay.server.https.keyStore.type = \"JKS\" \nplay.server.https.keyStore.password = \"<JKS \u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u4f7f\u3063\u305f\u30d1\u30b9\u30ef\u30fc\u30c9>\" \n```\n\n1\u884c\u76ee\u3067\u3001\u3082\u3068\u3082\u3068\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b ```application.conf``` \u3092 include \u3057\u3066\u3044\u308b\u3002\u3053\u308c\u3067 ```application.conf``` \u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u5185\u5bb9\u304c\u53d6\u308a\u8fbc\u307e\u308c\u308b\u3002Play \u306e conf \u30d5\u30a1\u30a4\u30eb\u3067\u306f [HOCON Syntax](https://www.playframework.com/documentation/2.5.x/ConfigFile#hocon-syntax) \u304c\u5229\u7528\u3055\u308c\u3066\u3044\u3066\u3001\u65e2\u5b58\u306e\u9805\u76ee\u306b\u3064\u3044\u3066\u306f\u4e0b\u306b\u8a18\u8ff0\u306e\u3042\u308b\u65b9\u3067\u4e0a\u66f8\u304d\u3055\u308c\u308b(\u9806\u5e8f\u6027\u304c\u3042\u308b\uff01)\u306e\u3067\u3001\u5148\u982d\u3067 include \u3059\u308b\u3002\n\nplay.crypto.secret \u306b\u306f\u9069\u5f53\u306a\u30ad\u30fc\u3092\u6e21\u3057\u3066\u304f\u3060\u3055\u3044\u3002[Generationg Appication Secret](https://www.playframework.com/documentation/2.5.x/ApplicationSecret#generating-an-application-secret) \u306b\u8a73\u3057\u304f\u66f8\u3044\u3066\u3042\u308b\u3002\n\n\u4eca\u56de\u306f\u30b5\u30fc\u30d0\u30fc\u306b SSL/TLS \u3067\u901a\u4fe1\u3055\u305b\u305f\u3044\u306e\u3067\u3001http \u3092\u585e\u3044\u3067\u3001https \u306e well-known \u30dd\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3002\u3055\u3089\u306b SSL/TLS \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u3001\u524d\u306e\u7ae0\u3067\u3064\u304f\u3063\u305f JKS \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\u3082\u3053\u3053\u3067\u3057\u3066\u3044\u308b\u3002\n\n\u3053\u308c\u3067\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5b8c\u6210\u3002\n\n## \u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u3092\u5c55\u958b\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306b\u5bfe\u3057\u3066\u3001\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3002JSSE \u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u304b\u3001\u4e0a\u8a18\u306e prod.conf \u3092\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u8aad\u307f\u3053\u3080\u3088\u3046\u306b Play application \u306b\u6307\u793a\u3059\u308b\u3002\n\n```\n$ sudo ./start.sh server-0.0.1/\n```\n\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u4f7f\u3046\u3002\n\n```bash:start.sh\n#!/bin/bash\n\npath=\"/tekitou/na/server/you/folder\"\n\nif [ $# == 1 ]; then\n\ttemptarget=$1\n\tnewtarget=${temptarget%/}\n\techo $newtarget > $path/target.path\nelse\n\techo \"Usage: ./start.sh server-path/\"\n\texit 0\nfi\n\ntarget=`cat $path/target.path`\n\nif [ -d \"$path/$target/\" ]; then\n\techo \"Start $target server.\"\nelse\n\techo \"$target not found.\"\n\texit 0\nfi\n\nnohup $path/$target/bin/<project name> -Djdk.tls.ephemeralDHKeySize=2048 -Djdk.tls.rejectClientInitiatedRenegotiation=true -Dconfig.file=/path/to/your/prod.conf &\n```\n\nnohup \u306f\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u9589\u3058\u3066\u3082\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u3092\u6bba\u3055\u306a\u3044\u305f\u3081\u306e\u30b3\u30de\u30f3\u30c9\u3002\u8a73\u3057\u304f\u306f\u30b0\u30b0\u30c3\u3066\u3002```<project name>``` \u306e\u3068\u3053\u308d\u306f\u9069\u5b9c\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n## \u30b5\u30fc\u30d0\u30fc\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u6642\u70b9\u3067\u304a\u5bdf\u3057\u304b\u3082\u77e5\u308c\u306a\u3044\u304c\u3001Play \u306b\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a http \u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u30c7\u30fc\u30e2\u30f3\u307f\u305f\u3044\u306a\u3082\u306e\u304c\u3044\u306a\u304f\u3066\u3001\u3059\u3079\u3066\u30ea\u30ea\u30fc\u30b9\u30d3\u30eb\u30c9\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u3002\u305d\u3057\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u3067\u304d\u308b\u307f\u305f\u3044\u306a\u6c17\u306e\u5229\u3044\u305f\u3082\u306e\u306f\u306a\u3044\u3002\u30d5\u30ed\u30f3\u30c8\u30bf\u30b9\u30af\u306b\u3044\u308b\u6642\u306b Ctrl-c \u3059\u308b\u304b\u3001kill <pid> \u3059\u308b\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u505c\u6b62\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u81ea\u4f5c\u3059\u308b\u3002\n\n```bash:stop.sh\n#!/bin/bash\n\npath=\"/tekitou/na/server/you/folder\"\ntargetpath=`cat $path/target.path`\n\nif [ ! -f $path/$targetpath/RUNNING_PID ]; then\n\techo \"Cannot find RUNNING_PID\"\n\texit 0\nfi\n\necho \"Stop $targetpath server.\"\n\nkill `cat $targetpath/RUNNING_PID`\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u3060\u3068\u30b5\u30fc\u30d0\u30fc\u5b9f\u884c\u4e2d\u306b\u3001\u5c55\u958b\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u306e\u30d5\u30a9\u30eb\u30c0\u306b ```RUNNING_PID``` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u3067\u3001\u3053\u306e\u5185\u5bb9\u3092\u53c2\u7167\u3057\u3066 kill \u30b3\u30de\u30f3\u30c9\u3092\u9001\u308b\u3060\u3051\u3002\n\n## Let's Encrypt \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u30b9\u30af\u30ea\u30d7\u30c8\u3068 cron \u8a2d\u5b9a\n\n\u3053\u3053\u307e\u3067\u3084\u308c\u3070\u3001\u4e0a\u8a18\u306e start / stop \u30b9\u30af\u30ea\u30d7\u30c8\u3067 Play \u3067 https \u901a\u4fe1\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\u304c\u3001Let's Encrypt \u306e\u8a3c\u660e\u66f8\u306f\u5bff\u547d\u304c\u306a\u3093\u306890\u65e5\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\u3092\u308f\u308a\u3068\u983b\u7e41\u306b\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u5fd8\u308c\u305f\u3089\u8a3c\u660e\u66f8\u671f\u9650\u5207\u308c\u306e\u60b2\u5287\u306b\u306a\u308b\u306e\u3067\u81ea\u52d5\u5316\u3057\u305f\u3044\u3002\n\n### \u66f4\u65b0\u3057\u305f\u8a3c\u660e\u66f8\u304b\u3089 JKS \u3078\u306e\u30a4\u30f3\u30dd\u30fc\u30c8\u306e\u81ea\u52d5\u5316\n\n\u307e\u305a\u3001Let's Encrypt \u3067\u8a3c\u660e\u66f8\u3092\u66f4\u65b0\u51fa\u6765\u3066\u3082 Play \u306f JKS \u5f62\u5f0f\u3067\u306a\u3044\u3068\u56f0\u308b\u306e\u3067\u3001PEM -> JKS \u306e\u5909\u63db\u3092\u81ea\u52d5\u5316\u3059\u308b\u3002\n\n```bash:create_jks.sh\n#!/bin/sh\n\ncallpath=`pwd`\nrelativepath=`dirname $0`\npasspath=\"<\u9069\u5f53\u306a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f8\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9>\"\npass=`cat $passpath`\npempath=\"/etc/letsencrypt/live/<\u30c9\u30e1\u30a4\u30f3\u540d>\"\npkcsname=\"chain_and_key.p12\"\nkeyalias=\"play\"\njksname=\"keystore.jks\"\n\ncd $relativepath\n\nif [ -f $pkcsname ]; then\n\trm $pkcsname\nfi\n\nif [ -f $jksname ]; then\n\trm $jksname\nfi\n\nopenssl pkcs12 -export -passout pass:$pass -in $pempath/fullchain.pem -inkey $pempath/privkey.pem -out $pkcsname -name $keyalias\nkeytool -importkeystore -deststorepass $pass -destkeypass $pass -destkeystore $jksname -srckeystore $pkcsname -srcstoretype PKCS12 -srcstorepass $pass -alias $keyalias\n\nchmod 660 $pkcsname\nchmod 660 $jksname\nchown biacco42:root $pkcsname\nchown biacco42:root $jksname\n\ncd $callpath\n```\n\n\u57fa\u672c\u7684\u306b\u306f\u3001\u3059\u3067\u306b\u8aac\u660e\u3057\u305f PEM -> JKS \u5909\u63db\u306e\u624b\u7d9a\u304d\u3092\u66f8\u3044\u3066\u3001\u5229\u4fbf\u6027\u306e\u305f\u3081\u306b\u30a2\u30af\u30bb\u30b9\u6a29\u7b49\u3092\u8a2d\u5b9a\u3057\u3066\u308b\u3060\u3051\u3002\n\n### Let's Encrypt \u306e\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\n\n\u57fa\u672c\u7684\u306b\u306f ```certbot-auto renew``` \u3067\u304a\u3063\u3051\u30fc\u306a\u3093\u3060\u3051\u3069\u3001\u81ea\u52d5\u5316\u3057\u3088\u3046\u3068\u601d\u3046\u3068\u3044\u304f\u3064\u304b\u554f\u984c\u304c\u3042\u308b\u3002\n\n1. certbot \u306f Let's Encrypt \u30b5\u30fc\u30d0\u30fc\u3068\u5bfe\u8a71\u3057\u3066\u8a3c\u660e\u66f8\u3092\u767a\u884c\u3059\u308b\u306e\u3067\u3001\u5bfe\u8a71\u306b\u7528\u3044\u308b\u30dd\u30fc\u30c8(443)\u3092\u307b\u304b\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u5229\u7528\u3057\u3066\u3044\u3066\u306f\u3044\u3051\u306a\u3044\n1. certbot \u306f root \u6a29\u9650\u3092\u8981\u6c42\u3059\u308b(1024\u756a\u4ee5\u4e0b\u306e\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b Privilege Permission \u304c\u5fc5\u8981)\n\n#### 1. certbot \u306e\u305f\u3081\u306b Play \u3092\u505c\u6b62\u3001\u518d\u8d77\u52d5\u3059\u308b\n\n\u307e\u305a\u306f 1. \u304b\u3089\u3002\u5f53\u7136\u306e\u3053\u3068\u306a\u304c\u3089\u3001\u5b9f\u884c\u4e2d\u306e Play application \u306f 443 \u30dd\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001certbot \u3092\u52d5\u304b\u3059\u3068\u304d\u306b\u306f\u4e00\u6642\u7684\u306b\u505c\u6b62\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u306e\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\u3002\n\n```bash:renew.sh\n#!/bin/sh\n\nhome=\"<home>\"\npath=\"$home/server\"\ntargetpath=`cat $path/target.path`\npid=`cat $path/$targetpath/RUNNING_PID`\n\n$path/stop.sh\nwait $pid\n\n$home/tools/certbot/certbot-auto renew --standalone --quiet\n\n$path/cert/create_jks.sh\n$path/start.sh $targetpath/\n```\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4e0b\u8a18\u3092\u4eee\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u9069\u5b9c\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n<HOME>\n\u251c tools\n\u2502 \u2514 certbot\n\u2514 server\n  \u251c start.sh\n  \u251c stop.sh\n  \u2514 cert\n    \u2514 create_jks.sh\n```\n\n\u672c\u5f53\u306f\u3001certbot-auto renew \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b ```--pre-hook```\u3001```--post-hook``` \u3068\u3044\u3046\u306e\u304c[\u3042\u308b\u3093\u3060\u3051\u308c\u3069](http://letsencrypt.readthedocs.io/en/latest/using.html#renewal)\u3001\u30d1\u30b9\u6307\u5b9a\u3057\u305f\u308a\u3001\u3084\u308b\u3053\u3068\u304c\u591a\u304b\u3063\u305f\u308a\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u307e\u3068\u3081\u3066\u3057\u307e\u3063\u305f\u3002\u3042\u307e\u308a\u3088\u304f\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n#### cron \u3092 sudo \u3067\u5b9f\u884c\u3059\u308b\n\n\u6b21\u306b 2.\u3002\u3053\u308c\u306f crontab \u3067\u306e\u767b\u9332\u3092 sudo \u3067\u884c\u3046\u3053\u3068\u3067\u3001\u305d\u306e\u30e6\u30fc\u30b6\u30fc\u3067 cron \u30bf\u30b9\u30af\u304c\u5b9f\u884c\u3055\u308c\u308b\u306e\u3067\u3001OK\u3002\u3068\u7c21\u5358\u306b\u306f\u3044\u304b\u306a\u3044\u3002\n\n\u5f53\u7136\u306e\u3053\u3068\u306a\u304c\u3089\u3001\u901a\u5e38\u901a\u308a sudo \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001sudo \u3092\u547c\u3073\u51fa\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306b\u5bfe\u3057\u3066\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u6c42\u304c\u767a\u751f\u3059\u308b\u306e\u3067\u3001\u81ea\u52d5\u5b9f\u884c\u3059\u308b\u3068\u304d\u306b\u56f0\u308b\u3002\u307e\u305f\u3001sudo \u306f tty (\u30bf\u30fc\u30df\u30ca\u30eb) \u304b\u3089\u306e\u307f\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u521d\u671f\u8a2d\u5b9a\u3067\u306f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001cron \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u6012\u3089\u308c\u308b\u3002\u8a73\u3057\u304f\u306f [\u30d0\u30c3\u30af\u30a2\u30c3\u30d7cron\u3067sudo\u3092\u4f7f\u3046](http://tech-blog.aloha-inc.jp/tech/22) \u3042\u305f\u308a\u3092\u898b\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001```sudo visodo``` \u3042\u305f\u308a\u3067\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\n\n```\nDefaults:<cron \u3092\u767b\u9332\u3059\u308b\u30e6\u30fc\u30b6\u30fc>      !requiretty\n<cron \u3092\u767b\u9332\u3059\u308b\u30e6\u30fc\u30b6\u30fc> ALL=(ALL)     NOPASSWD: /path/to/renew.sh\n```\n\n\u3053\u308c\u3067\u3001cron \u767b\u9332\u30e6\u30fc\u30b6\u30fc\u306f tty \u3092\u901a\u3055\u305a sudo \u3067\u304d\u3066\u3001renew.sh \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u306b\u969b\u3057\u3066 __\u3060\u3051__ \u306f sudo \u3067\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u6c42\u304c\u4e0d\u8981\u306b\u306a\u308b\u3002\n\n\u3053\u306e\u72b6\u614b\u3067\u3001\u3084\u3063\u3068 cron \u306b\u30bf\u30b9\u30af\u3092\u767b\u9332\u3067\u304d\u308b\u3002certbot-auto \u306f\u8a3c\u660e\u66f8\u306e\u671f\u9650\u3092\u78ba\u8a8d\u3057\u3066\u3001\u6b8b\u308a\u671f\u9650\u304c 30 \u65e5\u4ee5\u4e0b\u306e\u5834\u5408\u306e\u307f\u8a3c\u660e\u66f8\u3092\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u9069\u5f53\u306a\u9593\u9694\u3067\u547c\u3093\u3060\u3089\u3044\u3044\u3060\u308d\u3046\u3002\n\n```\n$ sudo crontab -e\n```\n\n```\n00 5 1,15 * * /path/to/renew.sh\n```\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001Let's Encrypt \u306e\u8a3c\u660e\u66f8\u81ea\u52d5\u66f4\u65b0\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u30c6\u30b9\u30c8\u5b9f\u884c\u3068\u3057\u3066 renew.sh \u306e certbot-auto renew \u306b ```--force-renew``` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3068\u304b\u3057\u3066\u307f\u308b\u3068\u3001\u6319\u52d5\u78ba\u8a8d\u304c\u3067\u304d\u308b\u3068\u601d\u3046\u3002\n\n# \u307e\u3068\u3081\n\n\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3067 Play + Let's Encrypt \u3067 https \u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\uff01\n\n\u3088\u304b\u3063\u305f\u306d\u3002\n", "tags": ["PlayFramework", "letsencrypt", "Java", "SSL"]}