{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\nheroku-docker \u306e\u307e\u307e\u3060\u3068\u3001\u5909\u66f4\u304c\u3042\u308b\u305f\u3073 heroku docker:start \u3057\u306a\u3044\u3068\u3044\u3051\u306a\u304f\u3066\u3081\u3093\u3069\u304f\u3055\u3044\u3002\n\u307e\u305f\u3001heroku docker:exec \u3067\u306f rails g migration \u306a\u3069\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u3092\u4f34\u3046\u30b3\u30de\u30f3\u30c9\u306e\u6069\u6075\u3092\u5f97\u3089\u308c\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001Dockerfile \u81ea\u4f53\u306f heroku docker:init \u3067\u5410\u304b\u308c\u305f\u3082\u306e\u3092\u4f7f\u3044\u3064\u3064\u3082\u3001\u958b\u767a\u7528\u306b\u30b3\u30fc\u30c9\u3092 mount \u3057\u305f\u308a\u3059\u308b docker-compose.yml \u3092\u7528\u610f\u3057\u3001\u9069\u6642\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067 docker exec \u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3002\n\u307e\u305f\u3001rails \u306e\u30b3\u30f3\u30c6\u30ca\u304c\u30c0\u30df\u30fc\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u305f\u307e\u307e\u306b\u3059\u308b\u3053\u3068\u3067\u3001spring \u306e\u6069\u6075\u3082\u5f97\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n\u30d5\u30a1\u30a4\u30eb\n\nDockerfile\nheroku docker:init \u3057\u305f\u307e\u307e\u3002\n\ndocker-compose.yml\ndbdata:\n  image: postgres\n  command: true\n  volumes:\n  - /var/lib/postgresql/data\n\ndb:\n  image: postgres\n  volumes_from:\n   - dbdata\n  ports:\n  - 5432:5432\n\ngemdata:\n  build: .\n  volumes:\n  - /app/heroku/bundler\n\nweb:\n  build: .\n  command: watch echo # \u30c0\u30df\u30fc\u30b3\u30de\u30f3\u30c9\u3067 web container \u3092\u8d77\u52d5\u3057\u305f\u307e\u307e\u306b\u3059\u308b\n  ports:\n   - 8080:3000\n  environment:\n    PATH: /app/src/bin:/app/heroku/node/bin:/app/heroku/bundler/bin:/app/heroku/ruby/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin # ./bin \u306b\u30d1\u30b9\u3092\u901a\u3057\u305f\u3044\n    GEM_HOME: /app/heroku/bundler\n    TERM: xterm # rails console \u306a\u3069\u3067\u8272\u3092\u3064\u3051\u308b\u305f\u3081\n  links:\n  - db\n  volumes:\n  - $PWD:/app/src\n  volumes_from:\n  - gemdata\n\n\n\u4f7f\u3044\u65b9\ndocker-compose up\ndocker exec -it hogehoge_web_1 bundle install\ndocker exec -it hogehoge_web_1 rails s -b 0.0.0.0\n\ndocker exec -it hogehoge_web_1 \u3068\u3044\u3046\u306e\u3092\u30b3\u30de\u30f3\u30c9\u524d\u306b\u3064\u3051\u308b\u3053\u3068\u306b\u306a\u308b\u3002\nspring \u3044\u3089\u306a\u3044\u306a\u3089\u3001docker-compose run \u3067\u4e00\u8cab\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3046\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b dr \u3068 de \u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3068\u4fbf\u5229\u304b\u3082\u3002\nalias dr='docker-compose run web'\nfunction de() {\n  local image_name=$(basename $PWD | sed -e 's/\\-//')_web\n  local container_id=$(docker ps -f name=$image_name -f status=running -l -q)\n  if [ -n \"$container_id\" ]; then\n    docker exec -it $container_id $@\n  else\n    echo \"$image_name is not running\" 1>&2\n    return 1\n  fi\n}\n\n# \u80cc\u666f\n\nheroku-docker \u306e\u307e\u307e\u3060\u3068\u3001\u5909\u66f4\u304c\u3042\u308b\u305f\u3073 `heroku docker:start` \u3057\u306a\u3044\u3068\u3044\u3051\u306a\u304f\u3066\u3081\u3093\u3069\u304f\u3055\u3044\u3002\n\u307e\u305f\u3001`heroku docker:exec` \u3067\u306f `rails g migration` \u306a\u3069\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\u3092\u4f34\u3046\u30b3\u30de\u30f3\u30c9\u306e\u6069\u6075\u3092\u5f97\u3089\u308c\u306a\u3044\u3002\n\n\u305d\u3053\u3067\u3001Dockerfile \u81ea\u4f53\u306f `heroku docker:init` \u3067\u5410\u304b\u308c\u305f\u3082\u306e\u3092\u4f7f\u3044\u3064\u3064\u3082\u3001\u958b\u767a\u7528\u306b\u30b3\u30fc\u30c9\u3092 mount \u3057\u305f\u308a\u3059\u308b docker-compose.yml \u3092\u7528\u610f\u3057\u3001\u9069\u6642\u30b3\u30f3\u30c6\u30ca\u4e0a\u3067 `docker exec` \u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u305f\u3002\n\u307e\u305f\u3001rails \u306e\u30b3\u30f3\u30c6\u30ca\u304c\u30c0\u30df\u30fc\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u305f\u307e\u307e\u306b\u3059\u308b\u3053\u3068\u3067\u3001spring \u306e\u6069\u6075\u3082\u5f97\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n# \u30d5\u30a1\u30a4\u30eb\n\n## Dockerfile\n\n`heroku docker:init` \u3057\u305f\u307e\u307e\u3002\n\n## docker-compose.yml\n\n```\ndbdata:\n  image: postgres\n  command: true\n  volumes:\n  - /var/lib/postgresql/data\n\ndb:\n  image: postgres\n  volumes_from:\n   - dbdata\n  ports:\n  - 5432:5432\n\ngemdata:\n  build: .\n  volumes:\n  - /app/heroku/bundler\n\nweb:\n  build: .\n  command: watch echo # \u30c0\u30df\u30fc\u30b3\u30de\u30f3\u30c9\u3067 web container \u3092\u8d77\u52d5\u3057\u305f\u307e\u307e\u306b\u3059\u308b\n  ports:\n   - 8080:3000\n  environment:\n    PATH: /app/src/bin:/app/heroku/node/bin:/app/heroku/bundler/bin:/app/heroku/ruby/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin # ./bin \u306b\u30d1\u30b9\u3092\u901a\u3057\u305f\u3044\n    GEM_HOME: /app/heroku/bundler\n    TERM: xterm # rails console \u306a\u3069\u3067\u8272\u3092\u3064\u3051\u308b\u305f\u3081\n  links:\n  - db\n  volumes:\n  - $PWD:/app/src\n  volumes_from:\n  - gemdata\n```\n\n## \u4f7f\u3044\u65b9\n\n```\ndocker-compose up\ndocker exec -it hogehoge_web_1 bundle install\ndocker exec -it hogehoge_web_1 rails s -b 0.0.0.0\n```\n\n`docker exec -it hogehoge_web_1` \u3068\u3044\u3046\u306e\u3092\u30b3\u30de\u30f3\u30c9\u524d\u306b\u3064\u3051\u308b\u3053\u3068\u306b\u306a\u308b\u3002\nspring \u3044\u3089\u306a\u3044\u306a\u3089\u3001`docker-compose run` \u3067\u4e00\u8cab\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3046\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b `dr` \u3068 `de` \u3092\u7528\u610f\u3057\u3066\u304a\u304f\u3068\u4fbf\u5229\u304b\u3082\u3002\n\n```\nalias dr='docker-compose run web'\nfunction de() {\n  local image_name=$(basename $PWD | sed -e 's/\\-//')_web\n  local container_id=$(docker ps -f name=$image_name -f status=running -l -q)\n  if [ -n \"$container_id\" ]; then\n    docker exec -it $container_id $@\n  else\n    echo \"$image_name is not running\" 1>&2\n    return 1\n  fi\n}\n```\n", "tags": ["docker-compose", "docker", "Heroku", "Rails"]}