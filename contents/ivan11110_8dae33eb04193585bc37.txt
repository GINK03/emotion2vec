{"context": "\n\n\u76ee\u6a19\n\u4ee5\u4e0b\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u3001\u89aa\u5b50\u95a2\u4fc2\u304c\u3042\u308a\u3001\uff11\u3064\u306e\u89aa\u306b\u5bfe\u3057\u3066\u3001\u8907\u6570\u306e\u5b50\u304c\u3042\u308b\u3088\u3046\u306a\u30c7\u30fc\u30bf\uff08\u30e2\u30c7\u30eb\uff09\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n\u305d\u306e\u3068\u304d\u306b\u3001\u4ee5\u4e0b\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u3001\uff11\u3064\u306e\u30da\u30fc\u30b8\u3067\u89aa\uff08\u3053\u306e\u5834\u5408\u306fTeam\uff09\u3068\u3001\u8907\u6570\u3042\u308b\u5b50\uff08\u3053\u306e\u5834\u5408\u306fMember\uff09\u3092\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u304c\u76ee\u6a19\u3067\u3059\u3002\n\n\u3055\u3089\u306b\u3001\u5b50\u3092\u7de8\u96c6\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u306fJavaScript\u3067\u52d5\u7684\u306b\u65b0\u3057\u3044\u884c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u5b50\u306e\u4e00\u89a7\u306b HTML \u306e table \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\u76ee\u6a19\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001Django \u306e inline formset \u3068\u3044\u3046\u3082\u306e\u3092\u4f7f\u3044\u307e\u3059\u3002\ninline formset \u306f formset \u304c\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nformset \u306f\u540c\u3058\u7a2e\u985e\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u8907\u6570\u4e26\u3079\u3066\u7de8\u96c6\u3067\u304d\u308b\u6a5f\u80fd\u3067\u3059\u3002\ninline formset \u306f \u5916\u90e8\u30ad\u30fc\u3067\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u30e2\u30c7\u30eb\u3092\u6271\u3046\u5834\u5408\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u4e0a\u306e\u753b\u50cf\u3067\u3044\u3046\u3068\u3001\u30e1\u30f3\u30d0\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u304c inline formset \u3092\u4f7f\u3063\u3066\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001view \u306f\u30af\u30e9\u30b9\u30d9\u30fc\u30b9(ListView\u3084CreateView\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9)\u3067\u306f\u306a\u304f\u3001\u95a2\u6570\u30d9\u30fc\u30b9(teams_update\u95a2\u6570)\u3067\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u74b0\u5883\n\nPython 3.5\nDjango 1.10\n\n\nStep 1: \u89aa\uff08Team\uff09\u306e\u307f\u4f5c\u308b\n\u307e\u305a\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u89aa\u3067\u3042\u308bTeam\u3060\u3051\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306f\u3001Team \u306e\u65b0\u898f\u8ffd\u52a0\u3068\u65e2\u306b\u3042\u308b\u30c1\u30fc\u30e0\u306e\u7de8\u96c6\u306e\u307f\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u4e00\u89a7\u8868\u793a\u3084\u524a\u9664\u306f\u3001\u4eca\u56de\u306e\u76ee\u6a19\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u3001\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3057\u305f\u3002\nStep 1 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3001github\u3067\u8aad\u3081\u307e\u3059\u3002\n\u4ee5\u4e0b\u306b\u63b2\u8f09\u3059\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3001\u5fc5\u8981\u306a\u7b87\u6240\u306e\u307f\u3092\u629c\u7c8b\u3057\u3066\u3044\u307e\u3059\u3002\n\u30e2\u30c7\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u540d\u524d\u306e\u307f\u3092\u6587\u5b57\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u3057\u3066\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\nmodels.py\nclass Team(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u30bd\u30fc\u30b9\u3082\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\nforms.py\nclass TeamForm(forms.models.ModelForm):\n    class Meta:\n        model = Team\n        fields = '__all__'\n\n\n\u30d3\u30e5\u30fc\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nteams_create \u306f\u30c1\u30fc\u30e0\u306e\u65b0\u898f\u4f5c\u6210\u3092\u62c5\u5f53\u3057\u3001\nteams_update \u306f\u30c1\u30fc\u30e0\u306e\u66f4\u65b0\u3092\u62c5\u5f53\u3057\u307e\u3059\u3002\n\nviews.py\ndef teams_create(request):\n    if request.method == 'POST':\n        form = TeamForm(request.POST)\n\n        if form.is_valid():\n            form.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm()\n\n    return render(request, 'teams_edit.html', {'form': form})\n\ndef teams_update(request, pk):\n    team = get_object_or_404(Team, pk=pk)\n\n    if request.method == 'POST':\n        form = TeamForm(request.POST, instance=team)\n\n        if form.is_valid():\n            form.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm(instance=team)\n\n    return render(request, 'teams_edit.html', {'form': form})\n\n\n\u3053\u3053\u306f\u3001\u5b9a\u578b\u7684\u306a view \u95a2\u6570\u306e\u51e6\u7406\u306a\u306e\u3067\u7d30\u304b\u3044\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3059\u3002\nteams_update \u95a2\u6570\u306e\u5f15\u6570 pk \u306f\u3001Team \u30e2\u30c7\u30eb\u306e\u4e3b\u30ad\u30fc\u304c\u6e21\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7406\u306f\u3001\u4ee5\u4e0b\u306eurls.py\u306b\u3088\u3063\u3066\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nurls.py\n    url(r'^edit/(?P<pk>\\d+)$', teams_update),\n\n\n\u7de8\u96c6\u753b\u9762\u306f\u3001teams_edit.html\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3063\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\ntemplates/teams_edit.html\n<h1>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</h1>\n\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n\n\nStep 1 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\nStep 2: \u5b50\uff08Member\uff09\u306e\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n\nmodels.py\nclass Member(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n    team = models.ForeignKey(Team)\n\n\nForeinKey(Team)\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306a\u95a2\u4fc2\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u56f3\u306b\u66f8\u3044\u3066\u3042\u308b position\uff08\u5b88\u5099\u4f4d\u7f6e\uff09\u306f\u3001\u307e\u3060\u30e2\u30c7\u30eb\u306b\u8ffd\u52a0\u3057\u3066\u307e\u305b\u3093\u3002\n\u8a18\u4e8b\u306e\u4e00\u756a\u6700\u5f8c\u3067\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30e2\u30c7\u30eb\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u306b\u3001makemigrations \u3068 migrate \u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nStep 2 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 1 \u3068\u306e\u5dee\u5206\n\nStep 3: inline formset \u3092\u4f5c\u3063\u3066\uff11\u753b\u9762\u3067\u89aa\u5b50\u3092\u540c\u6642\u306b\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\u6b21\u306b\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u5f79\u3067\u3042\u308b inline formset \u3092 forms.py \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nforms.py\nfrom django.forms import inlineformset_factory\n\nMemberFormSet = inlineformset_factory(Team, Member,\n        fields=('name',), extra=1)\n\n\ninlineformset_factory \u306b\u6e21\u3057\u3066\u3044\u308b\u5f15\u6570\u306f\u3001\u305d\u308c\u305e\u308c\u3001\n\nTeam: \u89aa\u30e2\u30c7\u30eb\nMember: \u5b50\u30e2\u30c7\u30eb\nfields=('name',): \u5b50\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u3046\u3061\u3001\u8868\u793a\u3057\u305f\u3044field\u306e\u540d\u524d\u3092\u30ea\u30b9\u30c8\u306b\u3059\u308b\nextra=1: \u5b50\u30e2\u30c7\u30eb\u306eformset\u306b\u3044\u304f\u3064\u4f59\u5206\u306b\u7a7a\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3059\u308b\u304b\u3002\u4f8b\u3048\u3070\u3001\u3053\u306e\u5834\u5408\u306f1\u306a\u306e\u3067\u3001\u65b0\u898f\u306b\u30c1\u30fc\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u3001Member \uff11\u4eba\u5206\u304c\u8ffd\u52a0\u3067\u304d\u308b\u3002\u30c1\u30fc\u30e0\u306b\u3059\u3067\u306b3\u4eba\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u305d\u306e\uff13\u4eba\u5206\u304c\u8868\u793a\u3055\u308c\u305f\u3042\u3068\u306b\u3001\uff11\u4eba\u5206\u3092\u8ffd\u52a0\u306e\u305f\u3081\u306e\u30d5\u30a9\u30fc\u30e0\u304c\u3067\u304d\u308b\u3002\n\n\u6b21\u306b\u3001\u4eca\u3064\u304f\u3063\u305f MemberFormSet \u3092\u4f7f\u3063\u3066 formset \u3092\u4f5c\u308a\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\nviews.py\ndef teams_create(request):\n    if request.method == 'POST':\n        form = TeamForm(request.POST)\n        formset = MemberFormSet(request.POST)\n\n        if form.is_valid() and formset.is_valid():\n            team = form.save()\n            formset.instance = team\n            formset.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm()\n        formset = MemberFormSet()\n\n    context = {'form': form, 'formset': formset}\n    return render(request, 'teams_edit.html', context)\n\ndef teams_update(request, pk):\n    team = get_object_or_404(Team, pk=pk)\n\n    if request.method == 'POST':\n        form = TeamForm(request.POST, instance=team)\n        formset = MemberFormSet(request.POST, instance=team)\n\n        if form.is_valid() and formset.is_valid():\n            form.save()\n            formset.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm(instance=team)\n        formset = MemberFormSet(instance=team)\n\n    context = {'form': form, 'formset': formset}\n    return render(request, 'teams_edit.html', context)\n\n\nformset\u3082form\u3068\u307b\u307c\u540c\u3058\u3088\u3046\u306a\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\uff11\u3064\u9055\u3046\u306e\u306f\u3001\u65b0\u898f\u4f5c\u6210\u6642\u306bformset\u3092\u4fdd\u5b58\u3059\u308b\u3068\u304d\u306f\u3001\u89aa\u3068\u306a\u308bteam\u3092instance\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304b\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\u3067\u3059\u3002\n\u305d\u3046\u3057\u306a\u3044\u3068\u3001Member\u304c\u3069\u306eteam\u306b\u6240\u5c5e\u3059\u308b\u304b\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\u4f5c\u3063\u305f formset \u306f\u3001\u4ee5\u4e0b\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\ntemplates/teams_edit.html\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in formset %}\n      <tr>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n\n\n\u89e3\u8aac\u306e\u524d\u306b\u3001\u5b9f\u884c\u7d50\u679c\u3092\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u65b0\u898f\u8ffd\u52a0\u3057\u305f\u3042\u3068\u3001\u30c1\u30fc\u30e0\u306e\u7de8\u96c6\u3067\u6570\u4eba\u306e Member \u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\nMember \u306e\u540d\u524d\u3092\u7a7a\u6b04\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3068\u3001Member \u3092\u8ffd\u52a0\u3057\u306a\u3044\u3067\u4fdd\u5b58\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u89e3\u8aac\u306b\u623b\u308a\u307e\u3059\u3002\n{% for member_form in formset %} \u3068\u30eb\u30fc\u30d7\u3059\u308b\u3053\u3068\u3067\u3001formset\u306e\u4e2d\u306e\uff11\u3064\uff11\u3064\u306eMember\u30d5\u30a9\u30fc\u30e0\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\nHTML\u30c6\u30fc\u30d6\u30eb\u306e\uff11\u884c\u3067\u3001\uff11\u3064\u306eMember\u30d5\u30a9\u30fc\u30e0\u3092\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4e2d\u3067\u3001\u7279\u306b\u91cd\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u3067\u3059\u3002\n\n{{ formset.management_form }}\n{% for hidden in member_form.hidden_fields %} {{ hidden }} {% endfor %}\n\n\n\u91cd\u8981\u306a\u7b87\u6240\uff11\uff1a\u3000formset \u306e\u7ba1\u7406\u60c5\u5831\n{{ formset.management_form }}\nrunserver \u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067HTML\u306e\u30bd\u30fc\u30b9\u3092\u898b\u308b\u3068\u308f\u304b\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u306fformset\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u304c\u96a0\u3057input\u8981\u7d20\uff08type\u5c5e\u6027\u304chidden\u3068\u306a\u3063\u3066\u3044\u308b\u8981\u7d20\uff09\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001formset \u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30d5\u30a9\u30fc\u30e0\u306e\u6570\u306a\u3069\u304c\u7ba1\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nmanagement_form \u3092POST\u60c5\u5831\u306b\u5165\u308c\u306a\u3044\u3068\uff08HTML\u306eform\u8981\u7d20\u306b\u542b\u3081\u306a\u3044\u3068\uff09 formset.is_valid() \u3067\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\n\u91cd\u8981\u306a\u7b87\u6240\uff12\uff1a\u3000formset \u5185\u306b\u542b\u307e\u308c\u308b\u30d5\u30a9\u30fc\u30e0\u306e\u7ba1\u7406\u60c5\u5831\n{% for hidden in member_form.hidden_fields %}\n  {{ hidden }}\n{% endfor %}\n\n\u3053\u308c\u3082\u540c\u3058\u3088\u3046\u306b\u7ba1\u7406\u60c5\u5831\u304c\u96a0\u3057input\u8981\u7d20\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\nmanagement_form \u306f\u3001formset\u5168\u4f53\u306e\u60c5\u5831\u3067\u3059\u304c\u3001\u3053\u3063\u3061\u306fMember\uff11\u4eba\u5206\u306e\u60c5\u5831\u3067\u3059\u3002\n\u5185\u5bb9\u306fhidden_fields\u3068\u3044\u3046\u540d\u524d\u304c\u3042\u3089\u308f\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u96a0\u3057\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3059\u3002\n\u4e3b\u30ad\u30fc\u306a\u3069\u304c\u542b\u307e\u308c\u3066\u3044\u3066\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\u3068\u304d\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n\u3053\u308c\u3089\uff12\u3064\u306e\u60c5\u5831\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u57cb\u3081\u8fbc\u3093\u3067\u306a\u3044\u3068\u3001\u3046\u307e\u304f\u52d5\u304b\u305a\u60a9\u3080\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4e2d\u3067\u3001formset \u306e fields \u3092\uff11\u3064\uff11\u3064\u81ea\u5206\u3067\u8868\u793a\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001{{ formset }} \u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3067\u8868\u793a\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u4e0a\u306e\uff12\u3064\u306f\u81ea\u52d5\u3067\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\nStep 3 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 2 \u3068\u306e\u5dee\u5206\n\nStep 4: \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\nStep 3 \u306e teams_create \u95a2\u6570\u3068teams_update \u95a2\u6570\u3067\u306f\u3001form\u3068formset\u3092\u7d9a\u3051\u3066\u4fdd\u5b58\u3057\u3066\u3044\u307e\u3059\u3002\n\nviews.py\n            form.save()\n            formset.save()\n\n\n\u3082\u3057\u3082\u3001form.save() \u3067 Team \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u305f\u3042\u3068\u3067\u3001formset.save() \u304c\u5931\u6557\u3057\u3066 Member \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u306a\u304b\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u3067\u3057\u3087\u3046\u304b\uff1f\nTeam \u306e\u5909\u66f4\u306f\u4fdd\u5b58\u3055\u308c\u3066\u3001Member \u306e\u5909\u66f4\u306f\u4fdd\u5b58\u3055\u308c\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u305d\u3053\u307e\u3067\u91cd\u8981\u306a\u60c5\u5831\u3067\u306a\u3044\u306e\u3067\u3044\u3044\u3067\u3059\u304c\u3001\u3082\u3063\u3068\u5927\u5207\u306a\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u306f\u3001\u89aa\u5b50\u306e\u6574\u5408\u6027\u304c\u53d6\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001\u5fc5\u8981\u306b\u306a\u308b\u306e\u304c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3088\u308a\u3001\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u3044\u305a\u308c\u304b\u306b\u306a\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002\n\n\u89aa\u3068\u5b50\u306e\u4e21\u65b9\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u308b\n\u89aa\u3068\u5b50\u306e\u4e21\u65b9\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u306a\u3044\n\n\u3064\u307e\u308a\u3001\u89aa\u3060\u3051\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3001\u5b50\u306f\u4fdd\u5b58\u3055\u308c\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u304c\u8d77\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u969b\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nviews.py\nfrom django.db import transaction\n\n# \u7701\u7565\n\n            with transaction.atomic():\n                form.save()\n                formset.save()\n\n\n\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\nStep 4 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 3 \u3068\u306e\u5dee\u5206\n\nStep 5: \u5b50\u3092\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\nTeam \u306b\u8ffd\u52a0\u3057\u305f Member \u3092\u524a\u9664\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001inlineformset_factory \u306e\u5f15\u6570\u306b\u3001can_delete=True \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nforms.py\nMemberFormSet = inlineformset_factory(Team, Member, can_delete=True,\n        fields=('name',), extra=1)\n\n\n\u6b21\u306b\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u7de8\u96c6\u3057\u3066\u3001HTML\u30c6\u30fc\u30d6\u30eb\u306e\u5217\u3092\u5897\u3084\u3057\u3001\u524a\u9664\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\ntemplates/teams_edit.html\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th><th>\u524a\u9664</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in formset %}\n      <tr>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n        <td align=\"center\">{{ member_form.DELETE }}</td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n\n\nforms.py \u3067 can_delete=True \u3092\u8ffd\u52a0\u3057\u305f\u306e\u3067\u3001formset \u306b DELETE \u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3067\u304d\u3066\u3044\u307e\u3059\uff08{{ member_form.DELETE }}\uff09\u3002\n\u5b9f\u884c\u7d50\u679c\u306f\u3053\u3061\u3089\u3002\n\n\u30c1\u30fc\u30e0\u304b\u3089\u306f\u305a\u3057\u305f\u3044 Member \u306e\u524a\u9664\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304b\u3089\u3001\u4fdd\u5b58\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3053\u3068\u3067\u305d\u306e Member \u304c\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\u5b9f\u969b\u306e\u524a\u9664\u51e6\u7406\u306f\u3001views.py \u3067 formset.save() \u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3055\u308c\u307e\u3059\u3002\nStep 5 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 4 \u3068\u306e\u5dee\u5206\n\nStep 6: JavaScript \u3067\u5b50\u306e\u5165\u529b\u884c\u3092\u8ffd\u52a0\u3059\u308b\n\u3044\u307e\u307e\u3067\u306f\u3001\u65b0\u3057\u3044 Member \u3092\u8ffd\u52a0\u3059\u308b\u884c\uff08\u30d5\u30a9\u30fc\u30e0\uff09\u304c\uff11\u3064\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u6b21\u306f\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3089\u3001JavaScript \u3067\u52d5\u7684\u306b Memeber \u306e\u5165\u529b\u884c\u3092\u5897\u3084\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\ndjango-dynamic-formset\u3092\u4f7f\u3046\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8ffd\u52a0\u3060\u3051\u306a\u306e\u3067\u81ea\u4f5c\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\ndjango-dynamic-formset\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\njQuery\u3067Django\u306eformset\u306e\u8868\u793a\u3092\u5236\u5fa1\u3059\u308bjquery.formset.js\u3092\u8a66\u3057\u3066\u307f\u305f\nDjango Inline formsets example: mybook\nTutorial : Implementing Django Formsets\n\n\u3069\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u307e\u305aHTML\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u982d\u884c\uff08\u30d8\u30c3\u30c0\u30fc\u884c\u306f\u9664\u304f\uff09\u306b\u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u96a0\u3057\u884c\u3068\u3057\u3066\u633f\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u8ffd\u52a0\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3068\u304d\u3001JavaScript \u3067\u305d\u306e\u96a0\u3057\u3066\u304a\u3044\u305f\u96db\u5f62\u884c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u306e\u6700\u7d42\u884c\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u3001\u30b3\u30d4\u30fc\u3057\u305f\u884c\u306b\u542b\u307e\u308c\u3066\u3044\u308b id \u306e\u540d\u524d\u306a\u3069\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u96db\u5f62\u3068\u306a\u308b\u884c\u3092\u96a0\u3055\u306a\u3044\u3067\u8ffd\u52a0\u3059\u308b\u3068\u3069\u3046\u306a\u308b\u304b\u307f\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nview \u3067\u306f\u3001 \u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3068 formset \u306e\u4e2d\u306e\u30d5\u30a9\u30fc\u30e0\u3092\uff11\u3064\u306e list \u306b\u3057\u3066\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\nviews.py\n    forms = [formset.empty_form] + formset.forms\n    context = {'form': form, 'formset': formset, 'forms': forms}\n    return render(request, 'teams_edit.html', context)\n\n\nformset.empty_form \u3067\u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3059\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u540d\u524d\u304cform\u3084\u3089forms\u3084\u3089\u3068\u4f3c\u305f\u3088\u3046\u306a\u540d\u524d\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u307f\u306a\u3055\u3093\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u306a\u3044\u3088\u3046\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u540d\u524d\u3092\u3064\u3051\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u306d\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\uff11\u884c\u5909\u3048\u308b\u3060\u3051\u3067\u3059\u3002\n\ntemplates/teams_edit.html\n      {% for member_form in forms %}\n\n\n\u7d50\u679c\u753b\u9762\u306f\u3053\u3061\u3089\u3002\n\n\u6700\u521d\u306e\u884c\u304c\u96db\u5f62\u3067\u3059\u3002\n\u7a7a\u767d\u306a\u3060\u3051\u3067\u3001\u4ed6\u306e\u884c\u3068\u540c\u3058\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\n\u8868\u793a\u3055\u308c\u305fHTML\u306e\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n\u4e0a\u534a\u5206\u304c\u3001\u96db\u5f62\u884c\u3067\u3001\u4e0b\u534a\u5206\u304c\u300c\u306a\u304b\u3082\u3068\u5de5\u4e8b\u300d\u3055\u3093\u306e\u884c\u3067\u3059\u3002\nid \u3084 name \u306e\u6587\u5b57\u5217\u304c __prefix__ \u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3001\u305d\u308c\u3068\u3082formset\u306e\u4e2d\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u304c\u9055\u3044\u307e\u3059\u3002\n\u96db\u5f62\u3092\u30b3\u30d4\u30fc\u3057\u305f\u3042\u3068\u306f\u3001\u3053\u306e __prefix__ \u3092\u9069\u5207\u306a\u5024\u306b\u5909\u3048\u308c\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u8ffd\u52a0\u30dc\u30bf\u30f3\u3068 JavaScript \u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002\n\ntemplates/teams_edit.html\n{% load static %}\n\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"UTF-8\">\n<title>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</title>\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n<script src=\"{% static \"js/addform.js\" %}\"></script>\n</head>\n\n<body>\n\n<h1>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</h1>\n\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\" id=\"id_team_table\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th><th>\u524a\u9664</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in forms %}\n      <tr {% if forloop.first %}style=\"display:none;\"{% endif %}>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n        <td align=\"center\">{{ member_form.DELETE }}</td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <p>\n    <button type=\"button\" onclick=\"addNewForm('#id_team_table tbody', '{{ formset.prefix }}')\">\u5165\u529b\u884c\u306e\u8ffd\u52a0</button>\n  </p>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n\n</body>\n</html>\n\n\nhead \u30bf\u30b0\u5185\u3067\u306f\u3001jquery \u3068\u4ee5\u4e0b\u3067\u4f5c\u308b JavaScript \u30d5\u30a1\u30a4\u30eb addform.js \u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\ntr \u306e\u4e2d\u306e {% if forloop.first %}style=\"display:none;\"{% endif %} \u306b\u3088\u308a\u3001\u96db\u5f62\u884c\u3092\u96a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u306e\u4e0b\u306b\u306f\u30dc\u30bf\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u3066\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e addNewForm \u95a2\u6570\u304c\u547c\u3070\u308c\u307e\u3059\u3002\n\nstatic/js/addform.js\nfunction addNewForm(tbody_selector, prefix) {\n    var total_elem = $('#id_' + prefix + '-TOTAL_FORMS');\n    var total = total_elem.val();\n\n    var $tbody = $(tbody_selector);\n    var $newRow = $tbody.find('tr:first').clone();\n    $newRow.html($newRow.html().replace(/__prefix__/g, total));\n    $newRow.show();\n    $tbody.find('tr:last').after($newRow);\n\n    total_elem.val(parseInt(total) + 1);\n}\n\n\ntotal \u5909\u6570\u306b\u306f\u3001__prefix__\u3068\u7f6e\u304d\u63db\u3048\u308b\u305f\u3081\u306e\u5024\u304c\u5165\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001{{ formset.management_form }} \u3067\u8ffd\u52a0\u3055\u308c\u305f\u96a0\u3057\u60c5\u5831\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u3069\u306e\u8981\u7d20\u304b\u3089\u53d6\u308b\u304b\u3068\u3044\u3046\u3068\u3001id \u304c id_member_set-TOTAL_FORMS \u306e\u8981\u7d20\u304b\u3089\u3067\u3059\u3002\n\u5165\u529b\u884c\u3092\u8ffd\u52a0\u3057\u305f\u3042\u3068\u306f\u3001\u3053\u306e\u5024\u30921\u5897\u3084\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u306e\u771f\u3093\u4e2d\u306e\u65b9\u3067\u306f\u3001\u5148\u982d\u884c\u306e\u96db\u5f62\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001\u6700\u7d42\u884c\u306b\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u3057\u305f\u3042\u3068\u306f\u3001\u975e\u8868\u793a\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001 show \u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u898b\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u5b9f\u884c\u753b\u9762\u306f\u3053\u3061\u3089\u3002\n\n\u8907\u6570\u56de\u300c\u5165\u529b\u884c\u3092\u8ffd\u52a0\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u306e\u3067\u3001\u5165\u529b\u884c\u304c\u305f\u304f\u3055\u3093\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u3001\u4e00\u901a\u308a\u8aac\u660e\u304c\u7d42\u308f\u308a\u307e\u3057\u305f\u3002\n\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\u4ee5\u4e0b\u3067\u306f\u3001\u79c1\u304c\u3057\u3066\u3057\u307e\u3063\u305f\u30df\u30b9\u3092\u793a\u3059\u305f\u3081\u306b\u3001\u5b88\u5099\u4f4d\u7f6e\u3068\u3044\u3046 field \u3092 Member \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\nStep 6 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 5 \u3068\u306e\u5dee\u5206\n\n\u756a\u5916\u7de8: \u79c1\u306e\u30df\u30b9\nMember \u306e\u5b88\u5099\u4f4d\u7f6e\u3092\u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u9078\u3079\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nmodels.py\nPOSITION_CHOICES = (\n('1', '\u30d4\u30c3\u30c1\u30e3\u30fc'),\n('2', '\u30ad\u30e3\u30c3\u30c1\u30e3\u30fc'),\n('3', '\u30d5\u30a1\u30fc\u30b9\u30c8'),\n('4', '\u30bb\u30ab\u30f3\u30c9'),\n('5', '\u30b5\u30fc\u30c9'),\n('6', '\u30b7\u30e7\u30fc\u30c8'),\n('7', '\u30ec\u30d5\u30c8'),\n('8', '\u30bb\u30f3\u30bf\u30fc'),\n('9', '\u30e9\u30a4\u30c8'),\n)\n\nclass Member(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n    team = models.ForeignKey(Team)\n    position = models.CharField('\u5b88\u5099\u4f4d\u7f6e', default='', max_length=1,\n            choices=POSITION_CHOICES)\n\n\nCharField \u306e choices \u3067\u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u306b\u8868\u793a\u3059\u308b\u9805\u76ee\u3068\u5024\u3092\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u5909\u66f4\u5f8c\u306f\u3001 makemigrations \u3068 migrate \u3092\u3057\u307e\u3059\u3002\n\nforms.py\nMemberFormSet = inlineformset_factory(Team, Member, can_delete=True,\n        fields=('name', 'position'), extra=1)\n\n\n\u4e0a\u3067\u306f\u3001fields \u306b position \u3092\u8ffd\u52a0\u3057\u3066\u307e\u3059\u3002\n\ntemplates/teams_edit.html\n        <td>{{ member_form.position.errors }} {{ member_form.position }}</td>\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u3001\u5b88\u5099\u4f4d\u7f6e\u306e\u305f\u3081\u306e\u5217\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u3053\u3053\u306b\u306f\u3001\u8f09\u305b\u3066\u3044\u307e\u305b\u3093\u304c\u30d8\u30c3\u30c0\u30fc\u884c\u306b\u5217\u540d\u3082\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u30d0\u30b0\u304c\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u8ffd\u52a0\u306e Member \u306e\u5165\u529b\u884c\u306e\u540d\u524d\u304c\u7a7a\u6b04\u306e\u307e\u307e\u3060\u3068\u3001\u4fdd\u5b58\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u3082\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u306a\u305c\u3001\u3053\u308c\u304c\u8d77\u304d\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u8ffd\u52a0\u306e Member \u306e\u5b88\u5099\u4f4d\u7f6e\u306e\u521d\u671f\u5024\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e\u7a7a\u6587\u5b57\uff08models.py\u3092\u53c2\u7167\uff09\u3067\u3059\u304c\u3001\u30d5\u30a9\u30fc\u30e0\u3067\u306f\u30d4\u30c3\u30c1\u30e3\u30fc\u304c\u9078\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001Django \u306f\u3053\u306e\u884c\u3067\u3001\u5909\u66f4\u304c\u3042\u3063\u305f\u3068\u8a8d\u8b58\u3057\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001\u5fc5\u9808\u9805\u76ee\u306e\u540d\u524d\u6b04\u304c\u7a7a\u767d\u306a\u306e\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3068\u306a\u3063\u305f\u306e\u3067\u3059\u3002\n\u3053\u306e\u554f\u984c\u3092\u4fee\u6b63\u3059\u308b\u306e\u306f\u7c21\u5358\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u9069\u5207\u306a\u5024\u306b\u306a\u308b\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\nmodels.py\n    position = models.CharField('\u5b88\u5099\u4f4d\u7f6e', default='5', max_length=1,\n            choices=POSITION_CHOICES)\n\n\nposition \u306f'1'\u304b\u3089'9'\u306e\u5024\u3057\u304b\u3068\u3089\u306a\u3044\u306e\u306b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u7a7a\u6587\u5b57\u306b\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u5358\u7d14\u306a\u30df\u30b9\u3067\u3057\u305f\nmakemigrations \u3068 migrate \u3092\u3057\u307e\u3059\u3002\n\u5916\u4f1d\u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nStep 6 \u3068\u306e\u5dee\u5206\n\u4ee5\u4e0a\n# \u76ee\u6a19\n\n\u4ee5\u4e0b\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u3001\u89aa\u5b50\u95a2\u4fc2\u304c\u3042\u308a\u3001\uff11\u3064\u306e\u89aa\u306b\u5bfe\u3057\u3066\u3001\u8907\u6570\u306e\u5b50\u304c\u3042\u308b\u3088\u3046\u306a\u30c7\u30fc\u30bf\uff08\u30e2\u30c7\u30eb\uff09\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n![team-model.png](https://qiita-image-store.s3.amazonaws.com/0/2812/340dac04-14a4-10e8-c84f-96245144dacc.png)\n\n\u305d\u306e\u3068\u304d\u306b\u3001\u4ee5\u4e0b\u306e\u753b\u50cf\u306e\u3088\u3046\u306b\u3001\uff11\u3064\u306e\u30da\u30fc\u30b8\u3067\u89aa\uff08\u3053\u306e\u5834\u5408\u306fTeam\uff09\u3068\u3001\u8907\u6570\u3042\u308b\u5b50\uff08\u3053\u306e\u5834\u5408\u306fMember\uff09\u3092\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u304c\u76ee\u6a19\u3067\u3059\u3002\n\n![mokuhyo.png](https://qiita-image-store.s3.amazonaws.com/0/2812/f4c21fc2-b887-58aa-8db4-0b0d092a6cf4.png)\n\n\u3055\u3089\u306b\u3001\u5b50\u3092\u7de8\u96c6\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u306fJavaScript\u3067\u52d5\u7684\u306b\u65b0\u3057\u3044\u884c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u5b50\u306e\u4e00\u89a7\u306b HTML \u306e table \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n\u76ee\u6a19\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001Django \u306e inline formset \u3068\u3044\u3046\u3082\u306e\u3092\u4f7f\u3044\u307e\u3059\u3002\ninline formset \u306f formset \u304c\u30d9\u30fc\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nformset \u306f\u540c\u3058\u7a2e\u985e\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u8907\u6570\u4e26\u3079\u3066\u7de8\u96c6\u3067\u304d\u308b\u6a5f\u80fd\u3067\u3059\u3002\n\ninline formset \u306f \u5916\u90e8\u30ad\u30fc\u3067\u3064\u306a\u304c\u3063\u3066\u3044\u308b\u30e2\u30c7\u30eb\u3092\u6271\u3046\u5834\u5408\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u4e0a\u306e\u753b\u50cf\u3067\u3044\u3046\u3068\u3001\u30e1\u30f3\u30d0\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u304c inline formset \u3092\u4f7f\u3063\u3066\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001view \u306f\u30af\u30e9\u30b9\u30d9\u30fc\u30b9(ListView\u3084CreateView\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9)\u3067\u306f\u306a\u304f\u3001\u95a2\u6570\u30d9\u30fc\u30b9(teams_update\u95a2\u6570)\u3067\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n# \u52d5\u4f5c\u78ba\u8a8d\u3057\u305f\u74b0\u5883\n\n- Python 3.5\n- Django 1.10\n\n# Step 1: \u89aa\uff08Team\uff09\u306e\u307f\u4f5c\u308b\n\n\u307e\u305a\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u89aa\u3067\u3042\u308bTeam\u3060\u3051\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n![step1-edit.png](https://qiita-image-store.s3.amazonaws.com/0/2812/8a6cb906-704f-ba51-416b-588f26403a16.png)\n\n\u4ee5\u4e0b\u306f\u3001Team \u306e\u65b0\u898f\u8ffd\u52a0\u3068\u65e2\u306b\u3042\u308b\u30c1\u30fc\u30e0\u306e\u7de8\u96c6\u306e\u307f\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u4e00\u89a7\u8868\u793a\u3084\u524a\u9664\u306f\u3001\u4eca\u56de\u306e\u76ee\u6a19\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u3001\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3057\u305f\u3002\n[Step 1 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step1)\u306f\u3001github\u3067\u8aad\u3081\u307e\u3059\u3002\n\u4ee5\u4e0b\u306b\u63b2\u8f09\u3059\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3001\u5fc5\u8981\u306a\u7b87\u6240\u306e\u307f\u3092\u629c\u7c8b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30e2\u30c7\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u540d\u524d\u306e\u307f\u3092\u6587\u5b57\u30d5\u30a3\u30fc\u30eb\u30c9\u3068\u3057\u3066\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\n```py3:models.py\nclass Team(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n```\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u30bd\u30fc\u30b9\u3082\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n```py3:forms.py\nclass TeamForm(forms.models.ModelForm):\n    class Meta:\n        model = Team\n        fields = '__all__'\n```\n\n\u30d3\u30e5\u30fc\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nteams_create \u306f\u30c1\u30fc\u30e0\u306e\u65b0\u898f\u4f5c\u6210\u3092\u62c5\u5f53\u3057\u3001\nteams_update \u306f\u30c1\u30fc\u30e0\u306e\u66f4\u65b0\u3092\u62c5\u5f53\u3057\u307e\u3059\u3002\n\n```py3:views.py\ndef teams_create(request):\n    if request.method == 'POST':\n        form = TeamForm(request.POST)\n\n        if form.is_valid():\n            form.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm()\n\n    return render(request, 'teams_edit.html', {'form': form})\n\ndef teams_update(request, pk):\n    team = get_object_or_404(Team, pk=pk)\n\n    if request.method == 'POST':\n        form = TeamForm(request.POST, instance=team)\n\n        if form.is_valid():\n            form.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm(instance=team)\n\n    return render(request, 'teams_edit.html', {'form': form})\n```\n\n\u3053\u3053\u306f\u3001\u5b9a\u578b\u7684\u306a view \u95a2\u6570\u306e\u51e6\u7406\u306a\u306e\u3067\u7d30\u304b\u3044\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\nteams_update \u95a2\u6570\u306e\u5f15\u6570 pk \u306f\u3001Team \u30e2\u30c7\u30eb\u306e\u4e3b\u30ad\u30fc\u304c\u6e21\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u51e6\u7406\u306f\u3001\u4ee5\u4e0b\u306eurls.py\u306b\u3088\u3063\u3066\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```py3:urls.py\n    url(r'^edit/(?P<pk>\\d+)$', teams_update),\n```\n\n\u7de8\u96c6\u753b\u9762\u306f\u3001teams_edit.html\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u3063\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\n```html+django:templates/teams_edit.html\n<h1>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</h1>\n\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n```\n\n[Step 1 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step1)\n\n# Step 2: \u5b50\uff08Member\uff09\u306e\u30e2\u30c7\u30eb\u3092\u4f5c\u308b\n\n```py3:models.py\nclass Member(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n    team = models.ForeignKey(Team)\n```\n\nForeinKey(Team)\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306a\u95a2\u4fc2\u306b\u306a\u308a\u307e\u3059\u3002\n\n![team-model.png](https://qiita-image-store.s3.amazonaws.com/0/2812/340dac04-14a4-10e8-c84f-96245144dacc.png)\n\n\u56f3\u306b\u66f8\u3044\u3066\u3042\u308b position\uff08\u5b88\u5099\u4f4d\u7f6e\uff09\u306f\u3001\u307e\u3060\u30e2\u30c7\u30eb\u306b\u8ffd\u52a0\u3057\u3066\u307e\u305b\u3093\u3002\n\u8a18\u4e8b\u306e\u4e00\u756a\u6700\u5f8c\u3067\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30e2\u30c7\u30eb\u3092\u53cd\u6620\u3059\u308b\u305f\u3081\u306b\u3001makemigrations \u3068 migrate \u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n[Step 2 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step2)\n[Step 1 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step1...step2)\n\n# Step 3: inline formset \u3092\u4f5c\u3063\u3066\uff11\u753b\u9762\u3067\u89aa\u5b50\u3092\u540c\u6642\u306b\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n\u6b21\u306b\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u5f79\u3067\u3042\u308b inline formset \u3092 forms.py \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```py3:forms.py\nfrom django.forms import inlineformset_factory\n\nMemberFormSet = inlineformset_factory(Team, Member,\n        fields=('name',), extra=1)\n```\n\ninlineformset_factory \u306b\u6e21\u3057\u3066\u3044\u308b\u5f15\u6570\u306f\u3001\u305d\u308c\u305e\u308c\u3001\n\n- Team: \u89aa\u30e2\u30c7\u30eb\n- Member: \u5b50\u30e2\u30c7\u30eb\n- fields=('name',): \u5b50\u30e2\u30c7\u30eb\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u3046\u3061\u3001\u8868\u793a\u3057\u305f\u3044field\u306e\u540d\u524d\u3092\u30ea\u30b9\u30c8\u306b\u3059\u308b\n- extra=1: \u5b50\u30e2\u30c7\u30eb\u306eformset\u306b\u3044\u304f\u3064\u4f59\u5206\u306b\u7a7a\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u8868\u793a\u3059\u308b\u304b\u3002\u4f8b\u3048\u3070\u3001\u3053\u306e\u5834\u5408\u306f1\u306a\u306e\u3067\u3001\u65b0\u898f\u306b\u30c1\u30fc\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u3001Member \uff11\u4eba\u5206\u304c\u8ffd\u52a0\u3067\u304d\u308b\u3002\u30c1\u30fc\u30e0\u306b\u3059\u3067\u306b3\u4eba\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u305d\u306e\uff13\u4eba\u5206\u304c\u8868\u793a\u3055\u308c\u305f\u3042\u3068\u306b\u3001\uff11\u4eba\u5206\u3092\u8ffd\u52a0\u306e\u305f\u3081\u306e\u30d5\u30a9\u30fc\u30e0\u304c\u3067\u304d\u308b\u3002\n\n\u6b21\u306b\u3001\u4eca\u3064\u304f\u3063\u305f MemberFormSet \u3092\u4f7f\u3063\u3066 formset \u3092\u4f5c\u308a\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\n```py3:views.py\ndef teams_create(request):\n    if request.method == 'POST':\n        form = TeamForm(request.POST)\n        formset = MemberFormSet(request.POST)\n\n        if form.is_valid() and formset.is_valid():\n            team = form.save()\n            formset.instance = team\n            formset.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm()\n        formset = MemberFormSet()\n\n    context = {'form': form, 'formset': formset}\n    return render(request, 'teams_edit.html', context)\n\ndef teams_update(request, pk):\n    team = get_object_or_404(Team, pk=pk)\n\n    if request.method == 'POST':\n        form = TeamForm(request.POST, instance=team)\n        formset = MemberFormSet(request.POST, instance=team)\n\n        if form.is_valid() and formset.is_valid():\n            form.save()\n            formset.save()\n\n            return redirect('/teams/')\n    else:\n        form = TeamForm(instance=team)\n        formset = MemberFormSet(instance=team)\n\n    context = {'form': form, 'formset': formset}\n    return render(request, 'teams_edit.html', context)\n```\n\nformset\u3082form\u3068\u307b\u307c\u540c\u3058\u3088\u3046\u306a\u51e6\u7406\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\uff11\u3064\u9055\u3046\u306e\u306f\u3001\u65b0\u898f\u4f5c\u6210\u6642\u306bformset\u3092\u4fdd\u5b58\u3059\u308b\u3068\u304d\u306f\u3001\u89aa\u3068\u306a\u308bteam\u3092instance\u30d5\u30a3\u30fc\u30eb\u30c9\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304b\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\u3067\u3059\u3002\n\u305d\u3046\u3057\u306a\u3044\u3068\u3001Member\u304c\u3069\u306eteam\u306b\u6240\u5c5e\u3059\u308b\u304b\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n\n\u4f5c\u3063\u305f formset \u306f\u3001\u4ee5\u4e0b\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\n```html+django:templates/teams_edit.html\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in formset %}\n      <tr>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n```\n\n\u89e3\u8aac\u306e\u524d\u306b\u3001\u5b9f\u884c\u7d50\u679c\u3092\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n![step3.png](https://qiita-image-store.s3.amazonaws.com/0/2812/65459d88-8a9f-2096-68d4-fbc84cb35bce.png)\n\n\u65b0\u898f\u8ffd\u52a0\u3057\u305f\u3042\u3068\u3001\u30c1\u30fc\u30e0\u306e\u7de8\u96c6\u3067\u6570\u4eba\u306e Member \u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\nMember \u306e\u540d\u524d\u3092\u7a7a\u6b04\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3068\u3001Member \u3092\u8ffd\u52a0\u3057\u306a\u3044\u3067\u4fdd\u5b58\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u89e3\u8aac\u306b\u623b\u308a\u307e\u3059\u3002\n\n`{% for member_form in formset %}` \u3068\u30eb\u30fc\u30d7\u3059\u308b\u3053\u3068\u3067\u3001formset\u306e\u4e2d\u306e\uff11\u3064\uff11\u3064\u306eMember\u30d5\u30a9\u30fc\u30e0\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\nHTML\u30c6\u30fc\u30d6\u30eb\u306e\uff11\u884c\u3067\u3001\uff11\u3064\u306eMember\u30d5\u30a9\u30fc\u30e0\u3092\u7de8\u96c6\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4e2d\u3067\u3001\u7279\u306b\u91cd\u8981\u306a\u306e\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u3067\u3059\u3002\n\n- `{{ formset.management_form }}`\n- `{% for hidden in member_form.hidden_fields %} {{ hidden }} {% endfor %}`\n\n## \u91cd\u8981\u306a\u7b87\u6240\uff11\uff1a\u3000formset \u306e\u7ba1\u7406\u60c5\u5831\n\n`{{ formset.management_form }}`\n\nrunserver \u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067HTML\u306e\u30bd\u30fc\u30b9\u3092\u898b\u308b\u3068\u308f\u304b\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u306fformset\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u60c5\u5831\u304c\u96a0\u3057input\u8981\u7d20\uff08type\u5c5e\u6027\u304chidden\u3068\u306a\u3063\u3066\u3044\u308b\u8981\u7d20\uff09\u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001formset \u306b\u542b\u307e\u308c\u3066\u3044\u308b\u30d5\u30a9\u30fc\u30e0\u306e\u6570\u306a\u3069\u304c\u7ba1\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n![manageform.png](https://qiita-image-store.s3.amazonaws.com/0/2812/4ce2175e-7112-490f-03e5-986a7a914a7d.png)\n\nmanagement_form \u3092POST\u60c5\u5831\u306b\u5165\u308c\u306a\u3044\u3068\uff08HTML\u306eform\u8981\u7d20\u306b\u542b\u3081\u306a\u3044\u3068\uff09 formset.is_valid() \u3067\u4f8b\u5916\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\n## \u91cd\u8981\u306a\u7b87\u6240\uff12\uff1a\u3000formset \u5185\u306b\u542b\u307e\u308c\u308b\u30d5\u30a9\u30fc\u30e0\u306e\u7ba1\u7406\u60c5\u5831\n\n```py3\n{% for hidden in member_form.hidden_fields %}\n  {{ hidden }}\n{% endfor %}\n```\n\n\u3053\u308c\u3082\u540c\u3058\u3088\u3046\u306b\u7ba1\u7406\u60c5\u5831\u304c\u96a0\u3057input\u8981\u7d20\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\nmanagement_form \u306f\u3001formset\u5168\u4f53\u306e\u60c5\u5831\u3067\u3059\u304c\u3001\u3053\u3063\u3061\u306fMember\uff11\u4eba\u5206\u306e\u60c5\u5831\u3067\u3059\u3002\n\n\u5185\u5bb9\u306fhidden_fields\u3068\u3044\u3046\u540d\u524d\u304c\u3042\u3089\u308f\u3057\u3066\u3044\u308b\u3088\u3046\u306b\u3001\u96a0\u3057\u30d5\u30a3\u30fc\u30eb\u30c9\u3067\u3059\u3002\n\u4e3b\u30ad\u30fc\u306a\u3069\u304c\u542b\u307e\u308c\u3066\u3044\u3066\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\u3059\u308b\u3068\u304d\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n![hiddenfields.png](https://qiita-image-store.s3.amazonaws.com/0/2812/81f8a78b-c916-7f7a-478c-c160cd900c79.png)\n\n\u3053\u308c\u3089\uff12\u3064\u306e\u60c5\u5831\u3092\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u57cb\u3081\u8fbc\u3093\u3067\u306a\u3044\u3068\u3001\u3046\u307e\u304f\u52d5\u304b\u305a\u60a9\u3080\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4e2d\u3067\u3001formset \u306e fields \u3092\uff11\u3064\uff11\u3064\u81ea\u5206\u3067\u8868\u793a\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001`{{ formset }}` \u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3067\u8868\u793a\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u4e0a\u306e\uff12\u3064\u306f\u81ea\u52d5\u3067\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n\n[Step 3 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step3)\n[Step 2 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step2...step3)\n\n# Step 4: \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\n\nStep 3 \u306e teams_create \u95a2\u6570\u3068teams_update \u95a2\u6570\u3067\u306f\u3001form\u3068formset\u3092\u7d9a\u3051\u3066\u4fdd\u5b58\u3057\u3066\u3044\u307e\u3059\u3002\n\n```py3:views.py\n            form.save()\n            formset.save()\n```\n\n\u3082\u3057\u3082\u3001form.save() \u3067 Team \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u305f\u3042\u3068\u3067\u3001formset.save() \u304c\u5931\u6557\u3057\u3066 Member \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u306a\u304b\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u3067\u3057\u3087\u3046\u304b\uff1f\nTeam \u306e\u5909\u66f4\u306f\u4fdd\u5b58\u3055\u308c\u3066\u3001Member \u306e\u5909\u66f4\u306f\u4fdd\u5b58\u3055\u308c\u306a\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u305d\u3053\u307e\u3067\u91cd\u8981\u306a\u60c5\u5831\u3067\u306a\u3044\u306e\u3067\u3044\u3044\u3067\u3059\u304c\u3001\u3082\u3063\u3068\u5927\u5207\u306a\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u5834\u5408\u306f\u3001\u89aa\u5b50\u306e\u6574\u5408\u6027\u304c\u53d6\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067\u3001\u5fc5\u8981\u306b\u306a\u308b\u306e\u304c\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3088\u308a\u3001\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u3044\u305a\u308c\u304b\u306b\u306a\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002\n\n- \u89aa\u3068\u5b50\u306e\u4e21\u65b9\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u308b\n- \u89aa\u3068\u5b50\u306e\u4e21\u65b9\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u306a\u3044\n\n\u3064\u307e\u308a\u3001\u89aa\u3060\u3051\u304c\u4fdd\u5b58\u3055\u308c\u3066\u3001\u5b50\u306f\u4fdd\u5b58\u3055\u308c\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u304c\u8d77\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3001\u5b9f\u969b\u306b\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```py3:views.py\nfrom django.db import transaction\n\n# \u7701\u7565\n\n            with transaction.atomic():\n                form.save()\n                formset.save()\n```\n\n\u7c21\u5358\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\n\n[Step 4 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step4)\n[Step 3 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step3...step4)\n\n# Step 5: \u5b50\u3092\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\nTeam \u306b\u8ffd\u52a0\u3057\u305f Member \u3092\u524a\u9664\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u3001inlineformset_factory \u306e\u5f15\u6570\u306b\u3001`can_delete=True` \u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```py3:forms.py\nMemberFormSet = inlineformset_factory(Team, Member, can_delete=True,\n        fields=('name',), extra=1)\n```\n\n\u6b21\u306b\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u7de8\u96c6\u3057\u3066\u3001HTML\u30c6\u30fc\u30d6\u30eb\u306e\u5217\u3092\u5897\u3084\u3057\u3001\u524a\u9664\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```html+django:templates/teams_edit.html\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th><th>\u524a\u9664</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in formset %}\n      <tr>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n        <td align=\"center\">{{ member_form.DELETE }}</td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n```\n\nforms.py \u3067 `can_delete=True` \u3092\u8ffd\u52a0\u3057\u305f\u306e\u3067\u3001formset \u306b DELETE \u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3067\u304d\u3066\u3044\u307e\u3059\uff08`{{ member_form.DELETE }}`\uff09\u3002\n\n\u5b9f\u884c\u7d50\u679c\u306f\u3053\u3061\u3089\u3002\n\n![deletemember.png](https://qiita-image-store.s3.amazonaws.com/0/2812/a17f738e-9072-b2d6-2b0b-716f4c104e1b.png)\n\n\u30c1\u30fc\u30e0\u304b\u3089\u306f\u305a\u3057\u305f\u3044 Member \u306e\u524a\u9664\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304b\u3089\u3001\u4fdd\u5b58\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3053\u3068\u3067\u305d\u306e Member \u304c\u524a\u9664\u3055\u308c\u307e\u3059\u3002\n\n\u5b9f\u969b\u306e\u524a\u9664\u51e6\u7406\u306f\u3001views.py \u3067 formset.save() \u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3055\u308c\u307e\u3059\u3002\n\n[Step 5 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step5)\n[Step 4 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step4...step5)\n\n# Step 6: JavaScript \u3067\u5b50\u306e\u5165\u529b\u884c\u3092\u8ffd\u52a0\u3059\u308b\n\n\u3044\u307e\u307e\u3067\u306f\u3001\u65b0\u3057\u3044 Member \u3092\u8ffd\u52a0\u3059\u308b\u884c\uff08\u30d5\u30a9\u30fc\u30e0\uff09\u304c\uff11\u3064\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u6b21\u306f\u3001\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3089\u3001JavaScript \u3067\u52d5\u7684\u306b Memeber \u306e\u5165\u529b\u884c\u3092\u5897\u3084\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n[django-dynamic-formset](https://github.com/elo80ka/django-dynamic-formset)\u3092\u4f7f\u3046\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8ffd\u52a0\u3060\u3051\u306a\u306e\u3067\u81ea\u4f5c\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n[django-dynamic-formset](https://github.com/elo80ka/django-dynamic-formset)\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\n- [jQuery\u3067Django\u306eformset\u306e\u8868\u793a\u3092\u5236\u5fa1\u3059\u308bjquery.formset.js\u3092\u8a66\u3057\u3066\u307f\u305f](http://y0m0r.hateblo.jp/entry/20120821/1345554213)\n- [Django Inline formsets example: mybook](https://medium.com/@adandan01/django-inline-formsets-example-mybook-420cc4b6225d#.tdnt5kgeb)\n- [Tutorial : Implementing Django Formsets](http://whoisnicoleharris.com/2015/01/06/implementing-django-formsets.html)\n\n\u3069\u306e\u3088\u3046\u306a\u51e6\u7406\u3092\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u307e\u305aHTML\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u982d\u884c\uff08\u30d8\u30c3\u30c0\u30fc\u884c\u306f\u9664\u304f\uff09\u306b\u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u96a0\u3057\u884c\u3068\u3057\u3066\u633f\u5165\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u8ffd\u52a0\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u3068\u304d\u3001JavaScript \u3067\u305d\u306e\u96a0\u3057\u3066\u304a\u3044\u305f\u96db\u5f62\u884c\u3092\u30b3\u30d4\u30fc\u3057\u3066\u30c6\u30fc\u30d6\u30eb\u306e\u6700\u7d42\u884c\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u3001\u30b3\u30d4\u30fc\u3057\u305f\u884c\u306b\u542b\u307e\u308c\u3066\u3044\u308b id \u306e\u540d\u524d\u306a\u3069\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u3001\u96db\u5f62\u3068\u306a\u308b\u884c\u3092\u96a0\u3055\u306a\u3044\u3067\u8ffd\u52a0\u3059\u308b\u3068\u3069\u3046\u306a\u308b\u304b\u307f\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nview \u3067\u306f\u3001 \u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3068 formset \u306e\u4e2d\u306e\u30d5\u30a9\u30fc\u30e0\u3092\uff11\u3064\u306e list \u306b\u3057\u3066\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3057\u307e\u3059\u3002\n\n```py3:views.py\n    forms = [formset.empty_form] + formset.forms\n    context = {'form': form, 'formset': formset, 'forms': forms}\n    return render(request, 'teams_edit.html', context)\n```\n\n`formset.empty_form` \u3067\u96db\u5f62\u3068\u306a\u308b\u30d5\u30a9\u30fc\u30e0\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u6e21\u3059\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u540d\u524d\u304cform\u3084\u3089forms\u3084\u3089\u3068\u4f3c\u305f\u3088\u3046\u306a\u540d\u524d\u304c\u3044\u3063\u3071\u3044\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u307f\u306a\u3055\u3093\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u306a\u3044\u3088\u3046\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u540d\u524d\u3092\u3064\u3051\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u306d:slight_smile:\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306f\uff11\u884c\u5909\u3048\u308b\u3060\u3051\u3067\u3059\u3002\n\n```html+django:templates/teams_edit.html\n      {% for member_form in forms %}\n```\n\n\u7d50\u679c\u753b\u9762\u306f\u3053\u3061\u3089\u3002\n\n![hinagata.png](https://qiita-image-store.s3.amazonaws.com/0/2812/fc8af871-23ee-a8db-d515-b3403e7e72cc.png)\n\n\u6700\u521d\u306e\u884c\u304c\u96db\u5f62\u3067\u3059\u3002\n\u7a7a\u767d\u306a\u3060\u3051\u3067\u3001\u4ed6\u306e\u884c\u3068\u540c\u3058\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\n\u8868\u793a\u3055\u308c\u305fHTML\u306e\u30bd\u30fc\u30b9\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n![hinagatasrc.png](https://qiita-image-store.s3.amazonaws.com/0/2812/c97f3175-7f7e-78c6-b1e4-4018e572d742.png)\n\n\u4e0a\u534a\u5206\u304c\u3001\u96db\u5f62\u884c\u3067\u3001\u4e0b\u534a\u5206\u304c\u300c\u306a\u304b\u3082\u3068\u5de5\u4e8b\u300d\u3055\u3093\u306e\u884c\u3067\u3059\u3002\nid \u3084 name \u306e\u6587\u5b57\u5217\u304c `__prefix__` \u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3001\u305d\u308c\u3068\u3082formset\u306e\u4e2d\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u304c\u9055\u3044\u307e\u3059\u3002\n\u96db\u5f62\u3092\u30b3\u30d4\u30fc\u3057\u305f\u3042\u3068\u306f\u3001\u3053\u306e `__prefix__` \u3092\u9069\u5207\u306a\u5024\u306b\u5909\u3048\u308c\u3070\u3088\u3055\u305d\u3046\u3067\u3059\u3002\n\n\u305d\u308c\u3067\u306f\u3001\u8ffd\u52a0\u30dc\u30bf\u30f3\u3068 JavaScript \u3092\u8ffd\u52a0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```html+django:templates/teams_edit.html\n{% load static %}\n\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n<meta charset=\"UTF-8\">\n<title>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</title>\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n<script src=\"{% static \"js/addform.js\" %}\"></script>\n</head>\n\n<body>\n\n<h1>\u30c1\u30fc\u30e0\u306e\u7de8\u96c6</h1>\n\n<form method=\"POST\">{% csrf_token %}\n  {{ form.as_p }}\n\n  <table border=\"1px\" id=\"id_team_table\">\n    {{ formset.management_form }}\n\n    <thead>\n      <tr><th>\u540d\u524d</th><th>\u524a\u9664</th></tr>\n    </thead>\n\n    <tbody>\n      {% for member_form in forms %}\n      <tr {% if forloop.first %}style=\"display:none;\"{% endif %}>\n        <td>\n          {% for hidden in member_form.hidden_fields %}\n            {{ hidden }}\n          {% endfor %}\n\n          {{ member_form.name.errors }} {{ member_form.name }}\n        </td>\n        <td align=\"center\">{{ member_form.DELETE }}</td>\n      </tr>\n      {% endfor %}\n    </tbody>\n  </table>\n\n  <p>\n    <button type=\"button\" onclick=\"addNewForm('#id_team_table tbody', '{{ formset.prefix }}')\">\u5165\u529b\u884c\u306e\u8ffd\u52a0</button>\n  </p>\n\n  <input type=\"submit\" value=\"\u4fdd\u5b58\" />\n</form>\n\n</body>\n</html>\n```\n\nhead \u30bf\u30b0\u5185\u3067\u306f\u3001jquery \u3068\u4ee5\u4e0b\u3067\u4f5c\u308b JavaScript \u30d5\u30a1\u30a4\u30eb addform.js \u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n\ntr \u306e\u4e2d\u306e `{% if forloop.first %}style=\"display:none;\"{% endif %}` \u306b\u3088\u308a\u3001\u96db\u5f62\u884c\u3092\u96a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c6\u30fc\u30d6\u30eb\u306e\u4e0b\u306b\u306f\u30dc\u30bf\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u3066\u3044\u3066\u3001\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e addNewForm \u95a2\u6570\u304c\u547c\u3070\u308c\u307e\u3059\u3002\n\n```js:static/js/addform.js\nfunction addNewForm(tbody_selector, prefix) {\n    var total_elem = $('#id_' + prefix + '-TOTAL_FORMS');\n    var total = total_elem.val();\n\n    var $tbody = $(tbody_selector);\n    var $newRow = $tbody.find('tr:first').clone();\n    $newRow.html($newRow.html().replace(/__prefix__/g, total));\n    $newRow.show();\n    $tbody.find('tr:last').after($newRow);\n\n    total_elem.val(parseInt(total) + 1);\n}\n```\n\ntotal \u5909\u6570\u306b\u306f\u3001`__prefix__`\u3068\u7f6e\u304d\u63db\u3048\u308b\u305f\u3081\u306e\u5024\u304c\u5165\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001`{{ formset.management_form }}` \u3067\u8ffd\u52a0\u3055\u308c\u305f\u96a0\u3057\u60c5\u5831\u304b\u3089\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u3069\u306e\u8981\u7d20\u304b\u3089\u53d6\u308b\u304b\u3068\u3044\u3046\u3068\u3001id \u304c id_member_set-TOTAL_FORMS \u306e\u8981\u7d20\u304b\u3089\u3067\u3059\u3002\n\u5165\u529b\u884c\u3092\u8ffd\u52a0\u3057\u305f\u3042\u3068\u306f\u3001\u3053\u306e\u5024\u30921\u5897\u3084\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u771f\u3093\u4e2d\u306e\u65b9\u3067\u306f\u3001\u5148\u982d\u884c\u306e\u96db\u5f62\u3092\u30b3\u30d4\u30fc\u3057\u3066\u3001\u6700\u7d42\u884c\u306b\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30d4\u30fc\u3057\u305f\u3042\u3068\u306f\u3001\u975e\u8868\u793a\u306e\u307e\u307e\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001 `show` \u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3066\u898b\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u5b9f\u884c\u753b\u9762\u306f\u3053\u3061\u3089\u3002\n\n![addform.png](https://qiita-image-store.s3.amazonaws.com/0/2812/516db32a-e28e-8bc9-3649-504987f88075.png)\n\n\u8907\u6570\u56de\u300c\u5165\u529b\u884c\u3092\u8ffd\u52a0\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u305f\u306e\u3067\u3001\u5165\u529b\u884c\u304c\u305f\u304f\u3055\u3093\u5897\u3048\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u308c\u3067\u3001\u4e00\u901a\u308a\u8aac\u660e\u304c\u7d42\u308f\u308a\u307e\u3057\u305f\u3002\n\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\n\u4ee5\u4e0b\u3067\u306f\u3001\u79c1\u304c\u3057\u3066\u3057\u307e\u3063\u305f\u30df\u30b9\u3092\u793a\u3059\u305f\u3081\u306b\u3001\u5b88\u5099\u4f4d\u7f6e\u3068\u3044\u3046 field \u3092 Member \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n[Step 6 \u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/step6)\n[Step 5 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step5...step6)\n\n# \u756a\u5916\u7de8: \u79c1\u306e\u30df\u30b9\n\nMember \u306e\u5b88\u5099\u4f4d\u7f6e\u3092\u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u304b\u3089\u9078\u3079\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```py3:models.py\nPOSITION_CHOICES = (\n('1', '\u30d4\u30c3\u30c1\u30e3\u30fc'),\n('2', '\u30ad\u30e3\u30c3\u30c1\u30e3\u30fc'),\n('3', '\u30d5\u30a1\u30fc\u30b9\u30c8'),\n('4', '\u30bb\u30ab\u30f3\u30c9'),\n('5', '\u30b5\u30fc\u30c9'),\n('6', '\u30b7\u30e7\u30fc\u30c8'),\n('7', '\u30ec\u30d5\u30c8'),\n('8', '\u30bb\u30f3\u30bf\u30fc'),\n('9', '\u30e9\u30a4\u30c8'),\n)\n\nclass Member(models.Model):\n    name = models.CharField('\u540d\u524d', default='', max_length=32)\n    team = models.ForeignKey(Team)\n    position = models.CharField('\u5b88\u5099\u4f4d\u7f6e', default='', max_length=1,\n            choices=POSITION_CHOICES)\n```\n\nCharField \u306e choices \u3067\u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u30ea\u30b9\u30c8\u306b\u8868\u793a\u3059\u308b\u9805\u76ee\u3068\u5024\u3092\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u5909\u66f4\u5f8c\u306f\u3001 makemigrations \u3068 migrate \u3092\u3057\u307e\u3059\u3002\n\n```py3:forms.py\nMemberFormSet = inlineformset_factory(Team, Member, can_delete=True,\n        fields=('name', 'position'), extra=1)\n```\n\n\u4e0a\u3067\u306f\u3001fields \u306b position \u3092\u8ffd\u52a0\u3057\u3066\u307e\u3059\u3002\n\n```html+django:templates/teams_edit.html\n        <td>{{ member_form.position.errors }} {{ member_form.position }}</td>\n```\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u3001\u5b88\u5099\u4f4d\u7f6e\u306e\u305f\u3081\u306e\u5217\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u3053\u3053\u306b\u306f\u3001\u8f09\u305b\u3066\u3044\u307e\u305b\u3093\u304c\u30d8\u30c3\u30c0\u30fc\u884c\u306b\u5217\u540d\u3082\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n![myfault.png](https://qiita-image-store.s3.amazonaws.com/0/2812/11e3fb58-d797-0237-eca9-2d695962f80b.png)\n\n\u3053\u3053\u3067\u30d0\u30b0\u304c\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u8ffd\u52a0\u306e Member \u306e\u5165\u529b\u884c\u306e\u540d\u524d\u304c\u7a7a\u6b04\u306e\u307e\u307e\u3060\u3068\u3001\u4fdd\u5b58\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u3082\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u304c\u3067\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u306a\u305c\u3001\u3053\u308c\u304c\u8d77\u304d\u308b\u304b\u3068\u3044\u3046\u3068\u3001\u8ffd\u52a0\u306e Member \u306e\u5b88\u5099\u4f4d\u7f6e\u306e\u521d\u671f\u5024\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e\u7a7a\u6587\u5b57\uff08models.py\u3092\u53c2\u7167\uff09\u3067\u3059\u304c\u3001\u30d5\u30a9\u30fc\u30e0\u3067\u306f\u30d4\u30c3\u30c1\u30e3\u30fc\u304c\u9078\u3070\u308c\u3066\u3044\u308b\u306e\u3067\u3001Django \u306f\u3053\u306e\u884c\u3067\u3001\u5909\u66f4\u304c\u3042\u3063\u305f\u3068\u8a8d\u8b58\u3057\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001\u5fc5\u9808\u9805\u76ee\u306e\u540d\u524d\u6b04\u304c\u7a7a\u767d\u306a\u306e\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3068\u306a\u3063\u305f\u306e\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u3092\u4fee\u6b63\u3059\u308b\u306e\u306f\u7c21\u5358\u3067\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u9069\u5207\u306a\u5024\u306b\u306a\u308b\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n```py3:models.py\n    position = models.CharField('\u5b88\u5099\u4f4d\u7f6e', default='5', max_length=1,\n            choices=POSITION_CHOICES)\n```\n\nposition \u306f'1'\u304b\u3089'9'\u306e\u5024\u3057\u304b\u3068\u3089\u306a\u3044\u306e\u306b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u7a7a\u6587\u5b57\u306b\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u5358\u7d14\u306a\u30df\u30b9\u3067\u3057\u305f:sweat_smile:\n\nmakemigrations \u3068 migrate \u3092\u3057\u307e\u3059\u3002\n\n\n[\u5916\u4f1d\u306e\u3059\u3079\u3066\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://github.com/ivan111/inlineformset/tree/sidestory)\n[Step 6 \u3068\u306e\u5dee\u5206](https://github.com/ivan111/inlineformset/compare/step6...sidestory)\n\n\u4ee5\u4e0a\n", "tags": ["Django"]}