{"tags": ["PHPUnit", "cakephp2", "NetCommons3"], "context": "\u30e2\u30c3\u30af\u3092\u4f5c\u3063\u3066\u304b\u3089\u306fPHPUnit\u307e\u307e\u306a\u306e\u3067\u3001CakePHP2\u3060\u3051\u3067\u306a\u304fPHPUnit\u3067\u3082\u540c\u3058\u4e8b\u3067\u304d\u307e\u3059\n\n\u547c\u3070\u308c\u308b\u56de\u6570\n$mock->expects($this->never()) //1\u5ea6\u3082\u547c\u3070\u308c\u306a\u3044\n    ->method('_getSiteTimezone')\n    ->will($this->returnValue('Asia/Tokyo'));\n\n\n\n```php\n$mock->expects($this->once()) //1\u56de\u3060\u3051\u547c\u3070\u308c\u308b\n    ->method('_getSiteTimezone')\n    ->will($this->returnValue('Asia/Tokyo'));\n\n$mock->expects($this->exactly(2)) //2\u56de\u547c\u3070\u308c\u308b\n    ->method('_getSiteTimezone')\n    ->will($this->returnValue('Asia/Tokyo'));\n\n$mock->expects($this->any()) // \u4f55\u56de\u304b\u547c\u3070\u308c\u308b\n    ->method('_getSiteTimezone')\n    ->will($this->returnValue('Asia/Tokyo'));\n\n\nmethod\u306e\u623b\u308a\u5024\u6307\u5b9a\n$mock->expects($this->once())\n    ->method('_getSiteTimezone') // \u30e1\u30bd\u30c3\u30c9\u540d\n    ->will($this->returnValue('Asia/Tokyo'));\u3000// \u623b\u308a\u5024\u6307\u5b9a\n\n$map = array(\n    ['public_type', true],\n    ['publish_start', true],\n    ['publish_end', false]\n);\n$mock->method('hasField'')\n    ->will($this->returnValueMap($map));\n\n\n\u7279\u5b9a\u306e\u5f15\u6570\u3067\u547c\u3070\u308c\u305f\u304b\n$mock->expects($this->once()) // 1\u56de\u3060\u3051\n    ->method('get') // \u30e1\u30bd\u30c3\u30c9\u540d\n    ->with($this->equalTo('\u6307\u5b9a\u5f15\u6570'));\n\n\n\n\u30d3\u30d8\u30a4\u30d3\u30a2\u3092\u30e2\u30c3\u30af\u306b\u5dee\u3057\u66ff\u3048\u308b\n        // \u307e\u305a\u53d6\u308a\u9664\u304f\n        $this->UploadFile->Behaviors->unload('Upload');\n\n        // \u30e2\u30c3\u30af\u751f\u6210\n        $uploadBehaviorMock = $this->getMock('UploadBehavior', ['uploadSettings']);\n        $uploadBehaviorMock->expects($this->once()) //1\u56de\u3060\u3051\u547c\u3070\u308c\u308b\n            ->method('uploadSettings')\n            ->with(\n                $this->isInstanceOf('Model'),\n                $this->equalTo('real_file_name'),\n                $this->equalTo($options));\n\n        // ClassRegistory\u3092\u4f7f\u3063\u3066\u30e2\u30c3\u30af\u3092\u767b\u9332\u3002\n        // \u307e\u305aremoveObject\u3057\u306a\u3044\u3068addObject\u3067\u304d\u306a\u3044\u306e\u3067removeObject\u3059\u308b  \n        ClassRegistry::removeObject('UploadBehavior');\n        // addObject\u3067UploadBehavior\u3067Mock\u304c\u4f7f\u308f\u308c\u308b \n        ClassRegistry::addObject('UploadBehavior', $uploadBehaviorMock);\n\n        // \u3053\u306eload\u3067\u306f\u30e2\u30c3\u30af\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\n        $this->UploadFile->Behaviors->load('Upload');\n\n\ntest\u306b\u4e0b\u8a18\u7a81\u3063\u8fbc\u3093\u3067\u3082\u3044\u3044\u304b\u3082\n    protected function _behaviorMock($model, $mockBehaviorName, $mockMethod) {\n        // \u307e\u305a\u53d6\u308a\u9664\u304f\n        $model->Behaviors->unload($mockBehaviorName);\n\n        // \u30e2\u30c3\u30af\u751f\u6210\n        $mockBehavior = $this->getMock($mockBehaviorName . 'Behavior', [$mockMethod]);\n\n        // ClassRegistory\u3092\u4f7f\u3063\u3066\u30e2\u30c3\u30af\u3092\u767b\u9332\u3002\n        // \u307e\u305aremoveObject\u3057\u306a\u3044\u3068addObject\u3067\u304d\u306a\u3044\u306e\u3067removeObject\u3059\u308b\n        ClassRegistry::removeObject($mockBehaviorName . 'Behavior');\n        // addObject\u3067UploadBehavior\u3067Mock\u304c\u4f7f\u308f\u308c\u308b\n        ClassRegistry::addObject($mockBehaviorName . 'Behavior', $mockBehavior);\n\n        // \u3053\u306eload\u3067\u306f\u30e2\u30c3\u30af\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\n        $model->Behaviors->load($mockBehaviorName);\n        return $mockBehavior;\n    }\n\n\n\u30e2\u30c3\u30af\u3092\u4f5c\u3063\u3066\u304b\u3089\u306fPHPUnit\u307e\u307e\u306a\u306e\u3067\u3001CakePHP2\u3060\u3051\u3067\u306a\u304fPHPUnit\u3067\u3082\u540c\u3058\u4e8b\u3067\u304d\u307e\u3059\n\n## \u547c\u3070\u308c\u308b\u56de\u6570\n\n\n```php\n$mock->expects($this->never()) //1\u5ea6\u3082\u547c\u3070\u308c\u306a\u3044\n\t->method('_getSiteTimezone')\n\t->will($this->returnValue('Asia/Tokyo'));\n\n\n\n```php\n$mock->expects($this->once()) //1\u56de\u3060\u3051\u547c\u3070\u308c\u308b\n\t->method('_getSiteTimezone')\n\t->will($this->returnValue('Asia/Tokyo'));\n```\n\n\n```php\n$mock->expects($this->exactly(2)) //2\u56de\u547c\u3070\u308c\u308b\n\t->method('_getSiteTimezone')\n\t->will($this->returnValue('Asia/Tokyo'));\n```\n\n```php\n$mock->expects($this->any()) // \u4f55\u56de\u304b\u547c\u3070\u308c\u308b\n\t->method('_getSiteTimezone')\n\t->will($this->returnValue('Asia/Tokyo'));\n```\n\n## method\u306e\u623b\u308a\u5024\u6307\u5b9a\n\n```php\n$mock->expects($this->once())\n\t->method('_getSiteTimezone') // \u30e1\u30bd\u30c3\u30c9\u540d\n\t->will($this->returnValue('Asia/Tokyo'));\u3000// \u623b\u308a\u5024\u6307\u5b9a\n```\n\n```php\n$map = array(\n\t['public_type', true],\n\t['publish_start', true],\n\t['publish_end', false]\n);\n$mock->method('hasField'')\n\t->will($this->returnValueMap($map));\n```\n\n## \u7279\u5b9a\u306e\u5f15\u6570\u3067\u547c\u3070\u308c\u305f\u304b\n```php\n$mock->expects($this->once()) // 1\u56de\u3060\u3051\n\t->method('get') // \u30e1\u30bd\u30c3\u30c9\u540d\n\t->with($this->equalTo('\u6307\u5b9a\u5f15\u6570'));\n\n```\n\n## \u30d3\u30d8\u30a4\u30d3\u30a2\u3092\u30e2\u30c3\u30af\u306b\u5dee\u3057\u66ff\u3048\u308b\n\n```php\n\t\t// \u307e\u305a\u53d6\u308a\u9664\u304f\n\t\t$this->UploadFile->Behaviors->unload('Upload');\n\n\t\t// \u30e2\u30c3\u30af\u751f\u6210\n\t\t$uploadBehaviorMock = $this->getMock('UploadBehavior', ['uploadSettings']);\n\t\t$uploadBehaviorMock->expects($this->once()) //1\u56de\u3060\u3051\u547c\u3070\u308c\u308b\n\t\t\t->method('uploadSettings')\n\t\t\t->with(\n\t\t\t\t$this->isInstanceOf('Model'),\n\t\t\t\t$this->equalTo('real_file_name'),\n\t\t\t\t$this->equalTo($options));\n\n\t\t// ClassRegistory\u3092\u4f7f\u3063\u3066\u30e2\u30c3\u30af\u3092\u767b\u9332\u3002\n\t\t// \u307e\u305aremoveObject\u3057\u306a\u3044\u3068addObject\u3067\u304d\u306a\u3044\u306e\u3067removeObject\u3059\u308b\t\n\t\tClassRegistry::removeObject('UploadBehavior');\n\t\t// addObject\u3067UploadBehavior\u3067Mock\u304c\u4f7f\u308f\u308c\u308b\t\n\t\tClassRegistry::addObject('UploadBehavior', $uploadBehaviorMock);\n\n\t\t// \u3053\u306eload\u3067\u306f\u30e2\u30c3\u30af\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\n\t\t$this->UploadFile->Behaviors->load('Upload');\n\n```\n\ntest\u306b\u4e0b\u8a18\u7a81\u3063\u8fbc\u3093\u3067\u3082\u3044\u3044\u304b\u3082\n\n```\n\tprotected function _behaviorMock($model, $mockBehaviorName, $mockMethod) {\n\t\t// \u307e\u305a\u53d6\u308a\u9664\u304f\n\t\t$model->Behaviors->unload($mockBehaviorName);\n\n\t\t// \u30e2\u30c3\u30af\u751f\u6210\n\t\t$mockBehavior = $this->getMock($mockBehaviorName . 'Behavior', [$mockMethod]);\n\n\t\t// ClassRegistory\u3092\u4f7f\u3063\u3066\u30e2\u30c3\u30af\u3092\u767b\u9332\u3002\n\t\t// \u307e\u305aremoveObject\u3057\u306a\u3044\u3068addObject\u3067\u304d\u306a\u3044\u306e\u3067removeObject\u3059\u308b\n\t\tClassRegistry::removeObject($mockBehaviorName . 'Behavior');\n\t\t// addObject\u3067UploadBehavior\u3067Mock\u304c\u4f7f\u308f\u308c\u308b\n\t\tClassRegistry::addObject($mockBehaviorName . 'Behavior', $mockBehavior);\n\n\t\t// \u3053\u306eload\u3067\u306f\u30e2\u30c3\u30af\u304c\u30ed\u30fc\u30c9\u3055\u308c\u308b\n\t\t$model->Behaviors->load($mockBehaviorName);\n\t\treturn $mockBehavior;\n\t}\n```\n\n"}