{"context": " More than 1 year has passed since last update.\uff0aSDK 2.1.0\u304b\u3089\uff1f\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3001ScrollView.scale\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u7121\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3088\u3046\u306a\u306e\u3067\u3001\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\uff0aportrait\u306a\u753b\u50cf\u306e\u5834\u5408\u306b\u3001\u4e0a\u4e0b\u304c\u9078\u629e\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\uff0a\u8907\u6570\u56deopenPhotoGallery\u3092\u547c\u3073\u51fa\u3057\u305f\u3068\u304d\u306e\u6319\u52d5\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n\u306a\u3093\u306a\u306e\u3001\u3053\u308c\uff1f\nTi.Media.openPhotoGallery()\u3067allowEditing\u30d7\u30ed\u30d1\u30c6\u30a3\u3092true\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u6b63\u65b9\u5f62\u3067crop\u3059\u308b\u7de8\u96c6UI\u304c\u73fe\u308c\u308b\u306e\u3060\u304c\u3001\u5927\u304d\u306a\u30a4\u30e1\u30fc\u30b8(1920pixel\u3092\u8d85\u3048\u308b\u3088\u3046\u306a)\u3092\u6271\u3048\u306a\u3044\u3002(iOS\u306e\u4ed5\u69d8\u307f\u305f\u3044\u306a\u3082\u306e.)\n\u3067\u3001\u5927\u304d\u306a\u30a4\u30e1\u30fc\u30b8\u3092\u305d\u306e\u307e\u307e\u306e\u30b5\u30a4\u30ba\u3067\u6b63\u65b9\u5f62\u306bcrop\u3059\u308b\u305f\u3081\u306eCommonJS\u30e2\u30b8\u30e5\u30fc\u30eb\u3002\n\n\u4f7f\u3044\u65b9\n\napp.js\nvar imagePicker = require('imagePicker');\nimagePicker.openPhotoGallery({\n    allowEditing:true,\n    success:function(e){\n        e.media; // \u53d6\u5f97\u3057\u305f\u30a4\u30e1\u30fc\u30b8\n        e.original; // \u7de8\u96c6\u524d\u306e\u30aa\u30ea\u30b8\u30ca\u30eb\u306a\u30a4\u30e1\u30fc\u30b8\n        e.cropRect; // crop\u3057\u305f\u9818\u57df\n    }\n});\n\n\n\n\u30b3\u30fc\u30c9\n\nimagePicker.js\nvar createEditingWindow = function(image){\n    var window = Ti.UI.createWindow({\n        navBarHidden:true,\n        backgroundColor:'black',\n        orientationModes:[\n            Ti.UI.PORTRAIT\n        ]\n    });\n\n    var flexSpace = Titanium.UI.createButton({\n        systemButton:Titanium.UI.iPhone.SystemButton.FLEXIBLE_SPACE\n    });\n\n    var cancel = Ti.UI.createButton({\n        title:'Cancel',\n        style:Titanium.UI.iPhone.SystemButtonStyle.BORDERED     \n    });\n\n    var choose = Ti.UI.createButton({\n        title:'Choose',\n        style:Titanium.UI.iPhone.SystemButtonStyle.DONE     \n    });\n\n    var title = Ti.UI.createLabel({\n        text:'Move and Scale',\n        color:'white',\n        font:{\n            fontWeight:'bold',\n            fontSize:16,\n        },\n        shadowColor:'#555555',\n        shadowOffset:{x:0.0, y:1.0}         \n    });\n\n    var occupiedHeight = 64; // toolbar:44 statusbar:20\n\n    var platform = {\n        width:Ti.Platform.displayCaps.platformWidth,\n        height:Ti.Platform.displayCaps.platformHeight - occupiedHeight\n    }\n\n    var zoomScale = 1.0;\n    var contentSize = { width:image.width, height:image.height };\n    var contentOffset = { x:0, y:0 };\n\n    zoomScale = platform.width / image.width; // fit to shorter side\n    contentSize.height = platform.height / zoomScale + 2;\n\n    // For portrait image\n    if(image.width < image.height){\n        // Targeting into square frame\n        contentSize.height += ((platform.height - platform.width) + 2) / zoomScale;\n        // Display centerized\n        contentOffset.y = (contentSize.height - image.height) * zoomScale / 2.0;\n    }\n\n    var scrollView = Ti.UI.createScrollView({\n        top:0,\n        width:platform.width,\n        height:platform.height,\n        contentWidth:contentSize.width,\n        contentHeight:contentSize.height,\n        minZoomScale:zoomScale,\n        maxZoomScale:1.0,\n        zoomScale:zoomScale,\n    });\n    window.add(scrollView);\n    scrollView.contentOffset = contentOffset;\n\n    var squareFrame = Ti.UI.createView({\n        center:{\n            x:platform.width / 2.0,\n            y:platform.height / 2.0\n        },\n        backgroundColor:'transparent',\n        borderWidth:1,\n        borderColor:'white',\n        touchEnabled:false,\n        width:Math.min(platform.width, platform.height),\n        height:Math.min(platform.width, platform.height)\n    });\n    window.add(squareFrame);\n\n    var topPlate = Ti.UI.createView({\n        backgroundColor:'black',\n        opacity:0.5\n    });\n\n    if(platform.width > platform.height){\n        topPlate.left = 0;      \n        topPlate.width = (platform.width - platform.height) / 2.0;\n        topPlate.top = 0;\n        topPlate.height = platform.height;\n    }else{\n        topPlate.top = 0;\n        topPlate.height = (platform.height - platform.width) / 2.0;\n    }   \n    window.add(topPlate);\n\n    var bottomPlate = Ti.UI.createView({\n        backgroundColor:'black',\n        opacity:0.5\n    });\n\n    if(platform.width > platform.height){\n        bottomPlate.right = 0;\n        bottomPlate.width = (platform.width - platform.height) / 2.0;\n        bottomPlate.top = 0;\n        bottomPlate.height = platform.height;\n    }else{\n        bottomPlate.bottom = 44;\n        bottomPlate.height = (platform.height - platform.width) / 2.0;\n    }\n    window.add(bottomPlate);\n\n    var imageView = Ti.UI.createImageView({\n        width:image.width,\n        height:image.height\n    });\n    scrollView.add(imageView);\n\n    var toolBar = Ti.UI.createToolbar({\n        items:[cancel, flexSpace, title, flexSpace, choose],\n        bottom:0,\n        height:44\n    });\n    window.add(toolBar);\n\n    var cropImage = function(image){\n        var offset = { x:0.0, y:0.0 }\n        if(scrollView.contentOffset){\n            offset = scrollView.contentOffset;\n        }\n\n        var x = offset.x / scrollView.zoomScale;\n        var y = offset.y / scrollView.zoomScale; \n        var w = scrollView.width / scrollView.zoomScale;\n        var h = scrollView.height / scrollView.zoomScale;\n\n        if(platform.width > platform.height){\n            x -= (scrollView.contentWidth - image.width) / 2.0;\n            x += (w - h) / 2.0;         \n        }else{\n            y -= (scrollView.contentHeight - image.height) / 2.0;\n            y += (h - w) / 2.0;\n        }\n\n        if(x < 0.0) { \n            x = 0.0; \n        }\n\n        if(y < 0.0) {\n            y = 0.0; \n        }\n        return image.imageAsResized(image.width, image.height).imageAsCropped({ \n            x:x, \n            y:y, \n            width:Math.min(w, h), \n            height:Math.min(w, h) \n        });\n    };\n\n    var choosed = null;\n\n    choose.addEventListener('click', function(){\n        if(choosed){\n            return;\n        }\n        choosed = cropImage(image);\n        window.close();\n    });\n\n    cancel.addEventListener('click', function(){\n        choosed = null;\n        window.close();\n    });\n\n    window.addEventListener('open', function(){\n        imageView.image = image;\n    });\n\n    window.addEventListener('close', function(){\n        if(choosed){\n            window.fireEvent('choose', { \n                media:choosed,\n                original:image\n            });     \n        }else{\n            window.fireEvent('cancel', {\n                original:image\n            });\n        }\n    });\n\n    return window;\n}\n\nvar nowOpening = false;\n\nvar openPhotoGallery = function(args){\n    if(nowOpening){\n        Ti.API.warn(\"imagePicker is still active. ignore this call.\");\n        return;\n    }\n    nowOpening = true;\n\n    var allowEditing = false;\n\n    if(args && typeof args.allowEditing !== 'undefined'){\n        allowEditing = args.allowEditing;\n    }\n\n    var success = function(e) {\n        if(allowEditing){\n            var editingWindow = createEditingWindow(e.media);\n\n            editingWindow.addEventListener('choose', function(e){\n                if(args && args.success){\n                    args.success(e);\n                }\n                nowOpening = false;\n            });\n\n            editingWindow.addEventListener('cancel', function(e){\n                if(args && args.cancel){\n                    args.cancel(e);                 \n                }\n                nowOpening = false;\n            });\n            editingWindow.open({ modal:true })\n        }else{\n            if(args && args.success){\n                args.success(e);\n            }\n            nowOpening = false;\n        }\n    };  \n\n    var cancel = function(e){\n        if(args.cancel){\n            args.cancel(e);\n        }\n        nowOpening = false;\n    };  \n\n    var error = function(e) {\n        if(args.error){\n            args.error(e);          \n        }\n        nowOpening = false;\n    };\n\n    Ti.Media.openPhotoGallery({\n        allowEditing:false,\n        success:success,\n        cancel:cancel,\n        error:error\n    });\n};\n\nexports.openPhotoGallery = openPhotoGallery;\n\n\n\uff0aSDK 2.1.0\u304b\u3089\uff1f\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3001ScrollView.scale\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u7121\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3088\u3046\u306a\u306e\u3067\u3001\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\uff0aportrait\u306a\u753b\u50cf\u306e\u5834\u5408\u306b\u3001\u4e0a\u4e0b\u304c\u9078\u629e\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\uff0a\u8907\u6570\u56deopenPhotoGallery\u3092\u547c\u3073\u51fa\u3057\u305f\u3068\u304d\u306e\u6319\u52d5\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n#\u306a\u3093\u306a\u306e\u3001\u3053\u308c\uff1f\nTi.Media.openPhotoGallery()\u3067allowEditing\u30d7\u30ed\u30d1\u30c6\u30a3\u3092true\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u6b63\u65b9\u5f62\u3067crop\u3059\u308b\u7de8\u96c6UI\u304c\u73fe\u308c\u308b\u306e\u3060\u304c\u3001\u5927\u304d\u306a\u30a4\u30e1\u30fc\u30b8(1920pixel\u3092\u8d85\u3048\u308b\u3088\u3046\u306a)\u3092\u6271\u3048\u306a\u3044\u3002(iOS\u306e\u4ed5\u69d8\u307f\u305f\u3044\u306a\u3082\u306e.)\n\u3067\u3001\u5927\u304d\u306a\u30a4\u30e1\u30fc\u30b8\u3092\u305d\u306e\u307e\u307e\u306e\u30b5\u30a4\u30ba\u3067\u6b63\u65b9\u5f62\u306bcrop\u3059\u308b\u305f\u3081\u306eCommonJS\u30e2\u30b8\u30e5\u30fc\u30eb\u3002\n\n#\u4f7f\u3044\u65b9\n``` app.js\nvar imagePicker = require('imagePicker');\nimagePicker.openPhotoGallery({\n\tallowEditing:true,\n\tsuccess:function(e){\n\t\te.media; // \u53d6\u5f97\u3057\u305f\u30a4\u30e1\u30fc\u30b8\n\t\te.original; // \u7de8\u96c6\u524d\u306e\u30aa\u30ea\u30b8\u30ca\u30eb\u306a\u30a4\u30e1\u30fc\u30b8\n\t\te.cropRect; // crop\u3057\u305f\u9818\u57df\n\t}\n});\n```\n#\u30b3\u30fc\u30c9\n``` imagePicker.js\nvar createEditingWindow = function(image){\n\tvar window = Ti.UI.createWindow({\n\t\tnavBarHidden:true,\n\t\tbackgroundColor:'black',\n\t\torientationModes:[\n\t\t\tTi.UI.PORTRAIT\n\t\t]\n\t});\n\t\n\tvar flexSpace = Titanium.UI.createButton({\n\t\tsystemButton:Titanium.UI.iPhone.SystemButton.FLEXIBLE_SPACE\n\t});\n\t\n\tvar cancel = Ti.UI.createButton({\n\t\ttitle:'Cancel',\n\t\tstyle:Titanium.UI.iPhone.SystemButtonStyle.BORDERED\t\t\n\t});\n\t\n\tvar choose = Ti.UI.createButton({\n\t\ttitle:'Choose',\n\t\tstyle:Titanium.UI.iPhone.SystemButtonStyle.DONE\t\t\n\t});\n\t\n\tvar title = Ti.UI.createLabel({\n\t\ttext:'Move and Scale',\n\t\tcolor:'white',\n\t\tfont:{\n\t\t\tfontWeight:'bold',\n\t\t\tfontSize:16,\n\t\t},\n\t\tshadowColor:'#555555',\n\t\tshadowOffset:{x:0.0, y:1.0}\t\t\t\n\t});\n\n\tvar occupiedHeight = 64; // toolbar:44 statusbar:20\n\n\tvar platform = {\n\t\twidth:Ti.Platform.displayCaps.platformWidth,\n\t\theight:Ti.Platform.displayCaps.platformHeight - occupiedHeight\n\t}\n\t\n\tvar zoomScale = 1.0;\n\tvar contentSize = { width:image.width, height:image.height };\n\tvar contentOffset = { x:0, y:0 };\n\t\n\tzoomScale = platform.width / image.width; // fit to shorter side\n\tcontentSize.height = platform.height / zoomScale + 2;\n\n\t// For portrait image\n\tif(image.width < image.height){\n\t\t// Targeting into square frame\n\t\tcontentSize.height += ((platform.height - platform.width) + 2) / zoomScale;\n\t\t// Display centerized\n\t\tcontentOffset.y = (contentSize.height - image.height) * zoomScale / 2.0;\n\t}\n\t\n\tvar scrollView = Ti.UI.createScrollView({\n\t\ttop:0,\n\t\twidth:platform.width,\n\t\theight:platform.height,\n\t\tcontentWidth:contentSize.width,\n\t\tcontentHeight:contentSize.height,\n\t\tminZoomScale:zoomScale,\n\t\tmaxZoomScale:1.0,\n\t\tzoomScale:zoomScale,\n\t});\n\twindow.add(scrollView);\n\tscrollView.contentOffset = contentOffset;\n\t\n\tvar squareFrame = Ti.UI.createView({\n\t\tcenter:{\n\t\t\tx:platform.width / 2.0,\n\t\t\ty:platform.height / 2.0\n\t\t},\n\t\tbackgroundColor:'transparent',\n\t\tborderWidth:1,\n\t\tborderColor:'white',\n\t\ttouchEnabled:false,\n\t\twidth:Math.min(platform.width, platform.height),\n\t\theight:Math.min(platform.width, platform.height)\n\t});\n\twindow.add(squareFrame);\n\t\n\tvar topPlate = Ti.UI.createView({\n\t\tbackgroundColor:'black',\n\t\topacity:0.5\n\t});\n\t\n\tif(platform.width > platform.height){\n\t\ttopPlate.left = 0;\t\t\n\t\ttopPlate.width = (platform.width - platform.height) / 2.0;\n\t\ttopPlate.top = 0;\n\t\ttopPlate.height = platform.height;\n\t}else{\n\t\ttopPlate.top = 0;\n\t\ttopPlate.height = (platform.height - platform.width) / 2.0;\n\t}\t\n\twindow.add(topPlate);\n\t\n\tvar bottomPlate = Ti.UI.createView({\n\t\tbackgroundColor:'black',\n\t\topacity:0.5\n\t});\n\t\n\tif(platform.width > platform.height){\n\t\tbottomPlate.right = 0;\n\t\tbottomPlate.width = (platform.width - platform.height) / 2.0;\n\t\tbottomPlate.top = 0;\n\t\tbottomPlate.height = platform.height;\n\t}else{\n\t\tbottomPlate.bottom = 44;\n\t\tbottomPlate.height = (platform.height - platform.width) / 2.0;\n\t}\n\twindow.add(bottomPlate);\n\n\tvar imageView = Ti.UI.createImageView({\n\t\twidth:image.width,\n\t\theight:image.height\n\t});\n\tscrollView.add(imageView);\n\n\tvar toolBar = Ti.UI.createToolbar({\n\t\titems:[cancel, flexSpace, title, flexSpace, choose],\n\t\tbottom:0,\n\t\theight:44\n\t});\n\twindow.add(toolBar);\n\t\n\tvar cropImage = function(image){\n\t\tvar offset = { x:0.0, y:0.0 }\n\t\tif(scrollView.contentOffset){\n\t\t\toffset = scrollView.contentOffset;\n\t\t}\n\t\t\n\t\tvar x = offset.x / scrollView.zoomScale;\n\t\tvar y = offset.y / scrollView.zoomScale; \n\t\tvar w = scrollView.width / scrollView.zoomScale;\n\t\tvar h = scrollView.height / scrollView.zoomScale;\n\n\t\tif(platform.width > platform.height){\n\t\t\tx -= (scrollView.contentWidth - image.width) / 2.0;\n\t\t\tx += (w - h) / 2.0;\t\t\t\n\t\t}else{\n\t\t\ty -= (scrollView.contentHeight - image.height) / 2.0;\n\t\t\ty += (h - w) / 2.0;\n\t\t}\n\n\t\tif(x < 0.0) { \n\t\t\tx = 0.0; \n\t\t}\n\t\t\n\t\tif(y < 0.0) {\n\t\t\ty = 0.0; \n\t\t}\n\t\treturn image.imageAsResized(image.width, image.height).imageAsCropped({ \n\t\t\tx:x, \n\t\t\ty:y, \n\t\t\twidth:Math.min(w, h), \n\t\t\theight:Math.min(w, h) \n\t\t});\n\t};\n\n\tvar choosed = null;\n\t\n\tchoose.addEventListener('click', function(){\n\t\tif(choosed){\n\t\t\treturn;\n\t\t}\n\t\tchoosed = cropImage(image);\n\t\twindow.close();\n\t});\n\t\n\tcancel.addEventListener('click', function(){\n\t\tchoosed = null;\n\t\twindow.close();\n\t});\n\t\n\twindow.addEventListener('open', function(){\n\t\timageView.image = image;\n\t});\n\t\n\twindow.addEventListener('close', function(){\n\t\tif(choosed){\n\t\t\twindow.fireEvent('choose', { \n\t\t\t\tmedia:choosed,\n\t\t\t\toriginal:image\n\t\t\t});\t\t\n\t\t}else{\n\t\t\twindow.fireEvent('cancel', {\n\t\t\t\toriginal:image\n\t\t\t});\n\t\t}\n\t});\n\t\n\treturn window;\n}\n\nvar nowOpening = false;\n\nvar openPhotoGallery = function(args){\n\tif(nowOpening){\n\t\tTi.API.warn(\"imagePicker is still active. ignore this call.\");\n\t\treturn;\n\t}\n\tnowOpening = true;\n\n\tvar allowEditing = false;\n\t\n\tif(args && typeof args.allowEditing !== 'undefined'){\n\t\tallowEditing = args.allowEditing;\n\t}\n\n\tvar success = function(e) {\n\t\tif(allowEditing){\n\t\t\tvar editingWindow = createEditingWindow(e.media);\n\t\t\t\n\t\t\teditingWindow.addEventListener('choose', function(e){\n\t\t\t\tif(args && args.success){\n\t\t\t\t\targs.success(e);\n\t\t\t\t}\n\t\t\t\tnowOpening = false;\n\t\t\t});\n\t\t\t\n\t\t\teditingWindow.addEventListener('cancel', function(e){\n\t\t\t\tif(args && args.cancel){\n\t\t\t\t\targs.cancel(e);\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\tnowOpening = false;\n\t\t\t});\n\t\t\teditingWindow.open({ modal:true })\n\t\t}else{\n\t\t\tif(args && args.success){\n\t\t\t\targs.success(e);\n\t\t\t}\n\t\t\tnowOpening = false;\n\t\t}\n\t};\t\n\t\n\tvar cancel = function(e){\n\t\tif(args.cancel){\n\t\t\targs.cancel(e);\n\t\t}\n\t\tnowOpening = false;\n\t};\t\n\t\n\tvar error = function(e) {\n\t\tif(args.error){\n\t\t\targs.error(e);\t\t\t\n\t\t}\n\t\tnowOpening = false;\n\t};\n\t\n\tTi.Media.openPhotoGallery({\n\t\tallowEditing:false,\n\t\tsuccess:success,\n\t\tcancel:cancel,\n\t\terror:error\n\t});\n};\n\nexports.openPhotoGallery = openPhotoGallery;\n```", "tags": ["iPhone", "Titanium", "JavaScript"]}