{"tags": ["JavaScript", "PhantomJS1.7.0"], "context": " More than 1 year has passed since last update.\n\n\u52d5\u6a5f\n7\u6708\u3042\u305f\u308a\u304b\u3089\u30b3\u30b3\u30ed\u30b0\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u3044\u305f\u3060\u3044\u3066\u3044\u305f\u304c\u3001\n\u30ac\u30f3\u7121\u8996\u3057\u3066\u3044\u305f\u3053\u3068\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\n\u305d\u3093\u306a\u3072\u3069\u3044\u5974\u304c\u7ba1\u7406\u3057\u3066\u308b\u30d6\u30ed\u30b0\u306f\u3053\u3061\u3089\nhttp://kjunichi.cocolog-nifty.com/misc/\n\n\u30bd\u30fc\u30b9\n\u3072\u3069\u3044\u30bd\u30fc\u30b9\u3060\u304c\u3001PhantomJS\u3067\u306e\u753b\u9762\u9077\u79fb\u306e\u5099\u5fd8\u9332\u3082\u517c\u306d\u3066\u3001\u3055\u3089\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ncocoCmt.js\nvar COCOLOG_ID = \"your id\";\nvar COCOLOG_PWD = \"your password\";\nvar COCOLOG_BLOG_ID = \"your blog id\"\n\nvar page = require('webpage').create();\n\nvar url = \"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\";\nvar counter = 0;\nvar loginCnt = 0;\npage.open(url, function (status) {\n//console.log(\"page.open status = \"+status + \", url = \"+page.url);\n//page.render(\"cocologin_\"+(counter++)+\".png\");\nif(status != \"success\") {\n//console.log(\"0:network error \"+status);\n        phantom.exit(1);\n}\n//console.log(\"ans = \"+page.url.indexOf(\"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\"));\nif(page.url.indexOf(\"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\") > -1) {\n// \u30ed\u30b0\u30a2\u30a6\u30c8\u753b\u9762\n//console.log(\"logout start\");\n//page.render(\"cocologin0.png\");\nurl=\"https://login.nifty.com/service/login?s=cocoapp\";\npage.evaluate(function() {\nlocation.href=\"https://login.nifty.com/service/login?s=cocoapp\";\n});\n//console.log(\"logout end\");\nreturn;\n}\n//console.log(\"ans2 = \"+page.url.indexOf(\"https://login.nifty.com/service/login?s=cocoapp\"));\nif(page.url.indexOf(\"https://login.nifty.com/service/login?s=cocoapp\") == 0) {\n//if(loginCnt > 0) {\n//console.log(\"start login\");\n//page.render(\"cocologin.png\");\n\nvar result = evaluate(page,function (id,pwd) {\nif(document.getElementById(\"username\")==null) {\nreturn \"false\";\n}\ndocument.getElementById(\"username\").value = id;\n     document.getElementById(\"password\").value = pwd;\n         document.getElementById(\"form1\").submit();\n         return \"success\";\n     },COCOLOG_ID,COCOLOG_PWD);\n     //console.log(\"login : \"+result);\n     //page.render(\"cocologin2.png\");\n//console.log(\"end login\");\n\n//}\n//loginCnt++;\nreturn;\n}\n//console.log(\"ans 3 = \" + page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/\"));\n\nif(page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/weblog/post?__mode=list_comments&blog_id=\") == 0) {\n//page.render(\"cocologComment.png\");\nvar cmtTbl = page.evaluate(function(){\nreturn document.getElementsByClassName(\"tableselect\")[0].innerHTML;\n});\nconsole.log(cmtTbl);\nphantom.exit(0);\n}\nif(page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/\") == 0) {\n//console.log(\"http://app.cocolog-nifty.com/t/app/\");\nevaluate(page,function(blog_id) {\nlocation.href=\"http://app.cocolog-nifty.com/t/app/weblog/post?__mode=list_comments&blog_id=\"+blog_id;\n},COCOLOG_BLOG_ID);\nreturn;\n}\n\n});\n\n/*\n* This function wraps WebPage.evaluate, and offers the possibility to pass\n* parameters into the webpage function. The PhantomJS issue is here:\n*\n* http://code.google.com/p/phantomjs/issues/detail?id=132\n*\n* This is from comment #43.\n*/\nfunction evaluate(page, func) {\n    var args = [].slice.call(arguments, 2);\n    var fn = \"function() { return (\" + func.toString() + \").apply(this, \" + JSON.stringify(args) + \");}\";\n    return page.evaluate(fn);\n}\n\n\n\n\u306f\u3081\u3089\u308c\u305f\u4e8b\n\nwaitfor.js\nexample\u306b\u5165\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u52d5\u304b\u306d\u3047\u3058\u3083\u306d\u3047\u304b\uff01\uff01\n\npage.open\u306f\u4f55\u5ea6\u3082\u547c\u3070\u308c\u308b\nlocation.href\u3084submit\u3057\u305f\u3089\u305d\u306e\u90fd\u5ea6\u547c\u3070\u308c\u308b\u3002\n\u3053\u308c\u306b\u6c17\u304c\u4ed8\u304b\u306a\u3044\u3068\u4eca\u56de\u306e\u5b9f\u88c5\u306f\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\n\nphantom1.7\u4ee5\u964d\u304c\u697d\u30c1\u30f3\npage.url\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001\u4ffa\u306e\u30b9\u30ad\u30eb\u3067\u306f\u5b9f\u73fe\u304c\u96e3\u3057\u305d\u3046\u3002\u3002\n\n\u53c2\u8003\u30da\u30fc\u30b8\n\nphantomjs page.evaluate \u304b\u3089\u5916\u306e\u30b9\u30b3\u30fc\u30d7\u306e\u5909\u6570\u3092\u53c2\u7167\u3059\u308b\nPhantomJS \u3067\u306f\u3066\u306a\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3051\u3069\u6319\u52d5\u304c\u4e0d\u660e\u306a\u4ef6\u306b\u3064\u3044\u3066\n\n#\u52d5\u6a5f\n7\u6708\u3042\u305f\u308a\u304b\u3089\u30b3\u30b3\u30ed\u30b0\u306b\u30b3\u30e1\u30f3\u30c8\u3092\u3044\u305f\u3060\u3044\u3066\u3044\u305f\u304c\u3001\n\u30ac\u30f3\u7121\u8996\u3057\u3066\u3044\u305f\u3053\u3068\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\n##\u305d\u3093\u306a\u3072\u3069\u3044\u5974\u304c\u7ba1\u7406\u3057\u3066\u308b\u30d6\u30ed\u30b0\u306f\u3053\u3061\u3089\n[http://kjunichi.cocolog-nifty.com/misc/](http://kjunichi.cocolog-nifty.com/misc/)\n\n#\u30bd\u30fc\u30b9\n\u3072\u3069\u3044\u30bd\u30fc\u30b9\u3060\u304c\u3001PhantomJS\u3067\u306e\u753b\u9762\u9077\u79fb\u306e\u5099\u5fd8\u9332\u3082\u517c\u306d\u3066\u3001\u3055\u3089\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n``` cocoCmt.js\nvar COCOLOG_ID = \"your id\";\nvar COCOLOG_PWD = \"your password\";\nvar COCOLOG_BLOG_ID = \"your blog id\"\n\nvar page = require('webpage').create();\n\nvar url = \"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\";\nvar counter = 0;\nvar loginCnt = 0;\npage.open(url, function (status) {\n//console.log(\"page.open status = \"+status + \", url = \"+page.url);\n//page.render(\"cocologin_\"+(counter++)+\".png\");\nif(status != \"success\") {\n//console.log(\"0:network error \"+status);\n        phantom.exit(1);\n}\n//console.log(\"ans = \"+page.url.indexOf(\"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\"));\nif(page.url.indexOf(\"https://login.nifty.com/service/logout?s=cocoapp&subs=cocolog\") > -1) {\n// \u30ed\u30b0\u30a2\u30a6\u30c8\u753b\u9762\n//console.log(\"logout start\");\n//page.render(\"cocologin0.png\");\nurl=\"https://login.nifty.com/service/login?s=cocoapp\";\npage.evaluate(function() {\nlocation.href=\"https://login.nifty.com/service/login?s=cocoapp\";\n});\n//console.log(\"logout end\");\nreturn;\n}\n//console.log(\"ans2 = \"+page.url.indexOf(\"https://login.nifty.com/service/login?s=cocoapp\"));\nif(page.url.indexOf(\"https://login.nifty.com/service/login?s=cocoapp\") == 0) {\n//if(loginCnt > 0) {\n//console.log(\"start login\");\n//page.render(\"cocologin.png\");\n\nvar result = evaluate(page,function (id,pwd) {\nif(document.getElementById(\"username\")==null) {\nreturn \"false\";\n}\ndocument.getElementById(\"username\").value = id;\n     document.getElementById(\"password\").value = pwd;\n         document.getElementById(\"form1\").submit();\n         return \"success\";\n     },COCOLOG_ID,COCOLOG_PWD);\n     //console.log(\"login : \"+result);\n     //page.render(\"cocologin2.png\");\n//console.log(\"end login\");\n\n//}\n//loginCnt++;\nreturn;\n}\n//console.log(\"ans 3 = \" + page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/\"));\n\nif(page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/weblog/post?__mode=list_comments&blog_id=\") == 0) {\n//page.render(\"cocologComment.png\");\nvar cmtTbl = page.evaluate(function(){\nreturn document.getElementsByClassName(\"tableselect\")[0].innerHTML;\n});\nconsole.log(cmtTbl);\nphantom.exit(0);\n}\nif(page.url.indexOf(\"http://app.cocolog-nifty.com/t/app/\") == 0) {\n//console.log(\"http://app.cocolog-nifty.com/t/app/\");\nevaluate(page,function(blog_id) {\nlocation.href=\"http://app.cocolog-nifty.com/t/app/weblog/post?__mode=list_comments&blog_id=\"+blog_id;\n},COCOLOG_BLOG_ID);\nreturn;\n}\n\n});\n\n/*\n* This function wraps WebPage.evaluate, and offers the possibility to pass\n* parameters into the webpage function. The PhantomJS issue is here:\n*\n* http://code.google.com/p/phantomjs/issues/detail?id=132\n*\n* This is from comment #43.\n*/\nfunction evaluate(page, func) {\n    var args = [].slice.call(arguments, 2);\n    var fn = \"function() { return (\" + func.toString() + \").apply(this, \" + JSON.stringify(args) + \");}\";\n    return page.evaluate(fn);\n}\n```\n\n#\u306f\u3081\u3089\u308c\u305f\u4e8b\n##waitfor.js\nexample\u306b\u5165\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u52d5\u304b\u306d\u3047\u3058\u3083\u306d\u3047\u304b\uff01\uff01\n\n## page.open\u306f\u4f55\u5ea6\u3082\u547c\u3070\u308c\u308b\nlocation.href\u3084submit\u3057\u305f\u3089\u305d\u306e\u90fd\u5ea6\u547c\u3070\u308c\u308b\u3002\n\u3053\u308c\u306b\u6c17\u304c\u4ed8\u304b\u306a\u3044\u3068\u4eca\u56de\u306e\u5b9f\u88c5\u306f\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\n\n##phantom1.7\u4ee5\u964d\u304c\u697d\u30c1\u30f3\npage.url\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001\u4ffa\u306e\u30b9\u30ad\u30eb\u3067\u306f\u5b9f\u73fe\u304c\u96e3\u3057\u305d\u3046\u3002\u3002\n\n\n#\u53c2\u8003\u30da\u30fc\u30b8\n- [phantomjs page.evaluate \u304b\u3089\u5916\u306e\u30b9\u30b3\u30fc\u30d7\u306e\u5909\u6570\u3092\u53c2\u7167\u3059\u308b](http://superbrothers.hatenablog.com/entry/2012/06/16/120249)\n- [PhantomJS \u3067\u306f\u3066\u306a\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3051\u3069\u6319\u52d5\u304c\u4e0d\u660e\u306a\u4ef6\u306b\u3064\u3044\u3066](http://d.hatena.ne.jp/kiririmode/20121028/p1)\n"}