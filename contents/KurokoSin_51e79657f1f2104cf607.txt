{"context": "\n\n\u3053\u306e\u8a18\u4e8b\u306f\n\u30b9\u30de\u30db\u30b2\u30fc\u30e0\u3092\u4f5c\u3063\u3066\u3044\u308b\u4e2d\u3067\u30b5\u30fc\u30d0\u304c\u8981\u308b\u306e\u3067\u3001\nWebAPI\u30b5\u30fc\u30d0\u3068DB\u30b5\u30fc\u30d0\u306e\u571f\u53f0\u3092\u4f5c\u308d\u3046\u3068\u601d\u3044\u7acb\u3061\u3001\n\u3044\u308d\u3044\u308d\u306a\u30b5\u30a4\u30c8\u3068\u81ea\u5206\u306e\u904e\u53bb\u306e\u7d4c\u9a13\u30fb\u77e5\u8b58\u304b\u3089\u306e\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u305f\u65e5\u8a18\u3067\u3059\u3002  \n\u4e3b\u306b\u81ea\u5206\u304c\u3084\u3063\u305f\u4e8b\u3092\u4e2d\u5fc3\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\u8a2d\u5b9a\u5185\u5bb9\u306b\u3064\u3044\u3066\u306e\u8aac\u660e\u306f\u304b\u306a\u308a\u7701\u7565\u3057\u3066\u66f8\u3044\u3066\u304a\u308a\u307e\u3059\u3002\n\u3054\u4e0d\u660e\u306a\u70b9\u304c\u3054\u3056\u3044\u307e\u3057\u305f\u3089\u3001\u30b3\u30e1\u30f3\u30c8\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n\u672c\u8a18\u4e8b\u3067\u3084\u3063\u3066\u3044\u308b\u4e8b\nMacOSX 10.11.3 \u3092\u30db\u30b9\u30c8OS\u3068\u3057\u3001VirtualBox 5.0.16 \u4e0a\u306b CentOS7.1 \uff081503\uff09 minimal \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb1\n\u305d\u306e\u72b6\u614b\u3067\u30bb\u30ad\u30e5\u30a2\u306b\u3084\u308c\u308b\u8a2d\u5b9a\u306b\u624b\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n * \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d3\u30b9\u306fssh\u306e\u307f\u3067\u3059\u3002\uff08SNMP\u3001Web\u30b5\u30fc\u30d0\u3001DB\u7b49\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u305b\u3093\uff09\n * SELinux\u306f\u6709\u52b9\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3086\u308b\u3081\u306e\u8a2d\u5b9a\u3067\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n * \u305d\u306e\u4ed6\u76e3\u8996\u7cfb\u306e\u30bd\u30d5\u30c8\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u8a2d\u5b9a\u9805\u76ee\u6982\u8981\nip\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\nIP\u8a2d\u5b9a\n\u8efd\u304f\u8a2d\u5b9a\n\n\n\nSELinux\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\n\u30dd\u30fc\u30c8\u8a2d\u5b9a\nssh\u7528\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u5bfe\u5fdc\u3000\n\n\n\nsshd    \n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\nssh\u30dd\u30fc\u30c8\u5909\u66f4\n\u63a5\u7d9a\u5148\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\n\n\nssh\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5236\u9650\nsshd\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30922\u306b\u9650\u5b9a\n\n\n\u516c\u958b\u9375\u306e\u8a2d\u5b9a\nRSA\u306e\u9375\u3067\u306f\u306a\u304f\u3066ED25519\u3067\u9375\u3092\u4f5c\u6210\n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u5207\u308b\n\u516c\u958b\u9375\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\n\n\nroot\u3067login\u51fa\u6765\u306a\u304f\u3059\u308b\n\u5de6\u8a18\u306e\u901a\u308a\n\n\n\u8a8d\u8a3c\u5468\u308a\u306e\u8a2d\u5b9a\n\u8a8d\u8a3c\u306e\u7336\u4e88\u6642\u9593\u3084\u8a8d\u8a3c\u56de\u6570\u306a\u3069\n\n\n\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306e\u5236\u9650\n\u6307\u5b9a\u30e6\u30fc\u30b6\u306e\u307f\u304c\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\n\n\n\u63a5\u7d9a\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5236\u9650\nX11\u3001\u4eee\u60f3\u7aef\u672b\u306e\u4f7f\u7528\u5236\u9650\n\n\n\nfirewall ( iptables )\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\n\u7834\u68c4\u8a2d\u5b9a\nip spoofing\u3001port scan\u3001Flood\u653b\u6483 \u7b49\u3092DROP\n\n\n\u6761\u4ef6\u4ed8\u304d\u306e\u63a5\u7d9a\n\uff11\u56de\u76ee\u306f\u3088\u304f\u3066\u3082\u7acb\u3066\u7d9a\u3051\u306b\u6765\u305f\u653b\u6483\u7b49\u306e\u5bfe\u5fdc\n\n\n\u63a5\u7d9a\u8a2d\u5b9a\n\u81ea\u5206\u304c\u4f7f\u3046\u3082\u306e\u306f\u7121\u6761\u4ef6\u306b\u63a5\u7d9a\u3000\n\n\n\nTCPWrapper\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\nhost.allow\n\u30b5\u30fc\u30d3\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u7d10\u4ed8\u3051\u3066\u63a5\u7d9a\u306e\u8a31\u53ef\n\n\nhost.deny\nallow\u3067\u8a31\u53ef\u3055\u308c\u306a\u304b\u3063\u305f\u901a\u4fe1\u306e\u62d2\u5426\n\n\n\nsudo\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\n\u5229\u7528\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u306e\u5236\u9650\n\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5236\u9650\u3059\u308b\n\n\n\u63a5\u7d9a\u5236\u9650\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u6301\u305f\u306a\u3044\u63a5\u7d9a\u306f\u62d2\u5426\n\n\n\u30b7\u30a7\u30eb\u5b9f\u884c\u7981\u6b62\nsudo \u3067\u306e\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u3092\u7981\u6b62\n\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e\u6642\u9593\u8a2d\u5b9a\n\u8a8d\u8a3c\u6709\u52b9\u671f\u9593\u306e\u8a2d\u5b9a\n\n\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u8a2d\u5b9a\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc\nTCP SYN Flood\u3001Sumrf\u653b\u6483\u5bfe\u5fdc\u7b49\u3005\n\n\n\n\u305d\u306e\u4ed6\n\n\n\n\u30bf\u30a4\u30c8\u30eb\n\u6982\u8981\n\n\n\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u9069\u7528\nyum update\n\n\n\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n\n\nlogwatch\u306e\u5c0e\u5165\n\u4eca\u56de\u306f\u898b\u9001\u3063\u3066\u3044\u307e\u3059\n\n\n\u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef\n\u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef\n\n\numask\u306e\u8a2d\u5b9a\n\u95a2\u4fc2\u306a\u3044\u30e6\u30fc\u30b6\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30af\u30bb\u30b9\u5236\u9650\n\n\n\n\n\nip\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\n\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3067\u3084\u308c\u305f\u3089\u30ab\u30c3\u30b3\u3088\u304b\u3063\u305f\u3051\u3069\u3001\u3001\u3001TUI\u3067\u8a2d\u5b9a\uff08\u309c\u309c\n# nmtui\n\nEdit a Connection\u3000\u2190\u9078\u629e\n\uff08NIC\u30ab\u30fc\u30c9\u3092\u9078\u629e\uff09\nIPv4 Configuration <Show> \u2190\u9078\u629e\nRequire IPv4 addressing for this connection \u2190\u3000\u30c1\u30a7\u30c3\u30af\nAutomatically Connect \u2190\u3000\u30c1\u30a7\u30c3\u30af\nOK\u3000\u2190\u3000\u9078\u629e\nQuit\u3000\u2190\u3000\u9078\u629e\n\n\u78ba\u8a8d\n# ip addr\n\n\u53c2\u8003\nCentOS7 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u5909\u66f4\n\nSELinux\u306e\u8a2d\u5b9a\n\u3053\u3053\u3067\u306f\u30dd\u30fc\u30c8\u306e\u7a74\u3042\u3051 \u3092\u3084\u3063\u3066\u3044\u307e\u3059\u3002\nssh\u3067\u901a\u4fe1\u3059\u308b\u4e88\u5b9a\u306e\u30dd\u30fc\u30c8\uff08=49152\uff09\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305a\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068ssh\u901a\u4fe1\u304c\u3067\u304d\u305a\u3001\u614c\u3066\u308b\u3053\u3068\u306b\u3002\n\uff08\u3068\u3044\u3046\u304b\u5b9f\u969b\u3001\u6570\u6642\u9593iptables\u3068sshd_config\u306e\u8a2d\u5b9a\u306e\u898b\u76f4\u3057\u3070\u3063\u304b\u308a\u3084\u3063\u3066\u6642\u9593\u3092\u6d6a\u8cbb\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\uff09\n\u7de8\u96c6\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install policycoreutils-python\n\n\u30dd\u30fc\u30c8\u306e\u8ffd\u52a0\n$ semanage port -a -t ssh_port_t -p tcp 49152\n\n\u8a2d\u5b9a\u78ba\u8a8d\n$ semanage port -l | grep ssh\n\nSELinux\u306e\u30ed\u30b0\n$ cat /var/log/audit/audit.log\n\n\nssh\u306e\u8a2d\u5b9a\nssh\u306e\u8a2d\u5b9a\u3092\u4ed5\u4e0a\u3052\u3066\u306a\u3044\u3068\u4f55\u304b\u3068\u4e0d\u4fbf\u306a\u306e\u3067\u3001\n\u6700\u521d\u306bssh\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nssh\u63a5\u7d9a\u7528\u30e6\u30fc\u30b6(=ssher)\u306e\u4f5c\u6210 \n# groupadd -g 1900 mainte\n# useradd -G mainte,wheel -u 1901  ssher #<ssh\u3067\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u3000and \u30eb\u30fc\u30c8\u6a29\u9650\u306b\u6607\u683c\u3067\u304d\u308b\u30e6\u30fc\u30b6> \n# mkdir /home/ssher/.ssh\n# chmod 700 /home/ssher/.ssh                          # <- \u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\n\n\u79d8\u5bc6\u9375/\u516c\u958b\u9375\u306e\u4f5c\u6210\nRSA\u306f\u3082\u3046\u53e4\u3044\u306e\u3067ED25519\u3067\u4f5c\u308a\u307e\u3059\u3002\uff08\u30df\u30fc\u30cf\u30fc\uff09\nMacOSX\u3067\u9375\uff08\u79d8\u5bc6\u9375/\u516c\u958b\u9375\uff09\u3092\u4f5c\u3063\u3066\u30b5\u30fc\u30d0\u5074\u3078\u516c\u958b\u9375\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n(\u30b5\u30fc\u30d0\u5074\u3067\u4f5c\u3063\u3066MacOSX\u306b\u79d8\u5bc6\u9375\u3092\u30b3\u30d4\u30fc\u3063\u3066\u65b9\u6cd5\u3082\u3084\u308a\u307e\u3057\u305f\u304c\u3001\nMacOSX\u306essh\u63a5\u7d9a\u3068\u76f8\u6027\u304c\u60aa\u304f\u3066\u3046\u307e\u304f\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\uff09\n$ sshe-keygen -t ed25519\nGenerating public/private ed25519 key pair.\nEnter file in which to save the key (/Users/hogehoge/.ssh/id_ed25519):\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in /Users/hogehoge/.ssh/id_ed25519.\nYour public key has been saved in /Users/hogehoge/.ssh/id_ed25519.pub.\nThe key fingerprint is:\nSHA256:FiublKpEQNgXnoVhogehogefugafugayWT74RSIRJEY hogehoge@MacOSX.local\nThe key's randomart image is:\n+--[ED25519 256]--+\n|      .   +oo    |\n|     . . = * .   |\n|    . sos = =    |\n|   . o = B + .   |\n|. ... o S * o    |\n| o .o.   = o     |\n|..++.   +        |\n|.oBoss o         |\n|Eo.=*+o          |\n+----[SHA256]-----+\n$\n$ # \u30b5\u30fc\u30d0\u5074\u3078\u516c\u958b\u9375\u3092\u30b3\u30d4\u30fc\n$ scp /Users/hogehoge/.ssh/id_ed25519.pub root@localhost:/home/ssher/.ssh/\nroot@localhost's password:\n$\n\n\uff08\u3061\u306a\u307f\u306b\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u9375\u306f\u4f5c\u308a\u76f4\u3057\u3066\u3044\u307e\u3059\u3002\u4e00\u90e8\u8868\u793a\u3092\u4f0f\u305b\u3066\u3044\u307e\u3059\u3002\uff09\n\u30b5\u30fc\u30d0\u5074\u3067\u53d7\u3051\u53d6\u3063\u305f\u516c\u958b\u9375\u3092authorized_keys\u3078\u767b\u9332\n\nssh\u306e\u8a2d\u5b9a\uff08\u516c\u958b\u9375\u306e\u767b\u9332\uff09\n# su - ssher\n$ cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys\n$ chmod 0600 ~/.ssh/authorized_keys\n$ chown ssher:ssher ~/.ssh/authorized_keys\n$ exit       #\u3000ssher\u30e6\u30fc\u30b6\u3092\u629c\u3051\u308b\n\n\nsshd_config\u306e\u8a2d\u5b9a\n\u57fa\u672c\u8a2d\u5b9a\u306f\u7d42\u308f\u3063\u305f\u306e\u3067\u3053\u3053\u304b\u3089\u672c\u683c\u7684\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306b\u5165\u308b\n\nssh\u306e\u8a2d\u5b9a\uff08\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff09\n# vi /etc/ssh/sshd_config\n Protocol 2                              # Protocol 1 \u306f\u4f7f\u308f\u306a\u3044\uff08Protocol 1\u3067\u7e4b\u3050\u30bd\u30d5\u30c8\u3092\u4f7f\u7528\u3059\u308b\u4e88\u5b9a\u304c\u4e00\u5207\u7121\u3044\uff09\n Port 49152                             # ssh\u6a19\u6e96\u306e\u756a\u53f7\u3092\u4f7f\u308f\u306a\u3044(\u81ea\u7531\u306b\u4f7f\u3048\u308b\u30dd\u30fc\u30c8\u756a\u53f7 = 49152\u3000\u301c\u300065535 )\n\n# ed25519\u306e\u9375\u3060\u3051\u6709\u52b9\u306b\u3059\u308b\n# HostKeys for protocol version 2\n# HostKey /etc/ssh/ssh_host_rsa_key\n# HostKey /etc/ssh/ssh_host_dsa_key\n# HostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key \n\n# Logging\nSyslogFacility AUTHPRIV\n\n# \u8a8d\u8a3c\u6642\u306e\u6319\u52d5\u8a2d\u5b9a\n LoginGraceTime 10               # \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u8cbc\u3063\u3066\u8a8d\u8a3c\u3059\u308b\u307e\u3067\u306e\u7336\u4e88\u6642\u9593(s)\n PermitRootLogin no              # root\u3000\u30e6\u30fc\u30b6\u304cssh\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n MaxAuthTries 3                     # \u6700\u5927\u8a8d\u8a3c\u8a66\u884c\u56de\u6570\n MaxStartups 2:90:4              # 2\u3064\u3092\u8d85\u3048\u308b\u8a8d\u8a3c\u53d7\u4ed8\u306f90%\u306e\u78ba\u7387\u3067\u906e\u65ad\u30024\u3064\u3092\u8d85\u3048\u308b\u3068\u5168\u3066\u906e\u65ad\n\n# \u8a8d\u8a3c\u65b9\u5f0f\u306e\u8a2d\u5b9a\n PasswordAuthentication no  # \u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\n ChallengeResponseAuthentication no #\u3000\u30c1\u30e3\u30ec\u30f3\u30b8\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\n PermitEmptyPasswords no   # \u7a7a\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u306f\u63a5\u7d9a\u62d2\u5426\n RSAAuthentication no           # \u304a\u305d\u3089\u304fProtocol 1\u306e\u6642\u4ee3\u5c02\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\n PubkeyAuthentication yes    # \u9375\u8a8d\u8a3c\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\n\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\nAuthorizedKeysFile      .ssh/authorized_keys\n\n\n# \u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3\u306e\u8a2d\u5b9a\uff08GSSAPI options\uff09\u3000\u4f7f\u7528\u4e88\u5b9a\u7121\u3057\nGSSAPIAuthentication no\nGSSAPICleanupCredentials no\n\n\n# WARNING: 'UsePAM no' is not supported in Red Hat Enterprise Linux\n# and may cause several problems.\nUsePAM yes\u3000\u3000# \u7121\u52b9\u306b\u3059\u308b\u3068\u6319\u52d5\u4e0d\u5be9\u306b\u306a\u308b\u304f\u3055\u3044\u306e\u3067yes\u306e\u307e\u307e\n\n# \u63a5\u7d9a\u5236\u9650\nAllowUsers ssher   \u3000            # \u63a5\u7d9a\u3067\u304d\u308b\u30e6\u30fc\u30b6\u306e\u5236\u9650\n#AllowAgentForwarding no\n#AllowTcpForwarding yes\n#GatewayPorts no\nX11Forwarding no                 # GUI\u3067\u30b5\u30fc\u30d0\u3092\u64cd\u4f5c\u3057\u306a\u3044\nPermitTTY yes                      # \u4eee\u60f3\u7aef\u672b\u306e\u8a31\u53ef\u3002tmux\uff1f\u306a\u306b\u305d\u308c\uff1f\u306a\u65b9\u306fno\n\n# DNS\u63a5\u7d9a\u8a2d\u5b9a\nUsePrivilegeSeparation sandbox          # Default for new installations.\nUseDNS  no                           # IP\u30a2\u30c9\u30ec\u30b9\u3092\u4f7f\u7528\u3057\u3066\u63a5\u7d9a\u3059\u308b\u305f\u3081\u3001FQDN\u306e\u691c\u7d22\u306b\u304b\u304b\u308b\u5f85\u6a5f\u6642\u9593\u3092\u7121\u304f\u3059\u3002\n\n# \u4ee5\u4e0b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3002\uff08\u6b63\u76f4\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044\uff09\n# Accept locale-related environment variables\nAcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES\nAcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT\nAcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE\nAcceptEnv XMODIFIERS\n\n# override default of no subsystems\nSubsystem       sftp    /usr/libexec/openssh/sftp-server\n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u4ef6\u3067\u3059\u304c\u3001\u6709\u52b9\u306b\u3057\u305f\u307e\u307e\u3060\u3068\u9375\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u305f\u6642\u3001\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u6d41\u308c\u3066\u3044\u304f\u3088\u3046\u3067\u3059\u3002\u9375\u8a8d\u8a3c\u306b\u3059\u308b\u5834\u5408\u3001\u5fc5\u305a\u7121\u52b9\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u8a2d\u5b9a\u306e\u78ba\u8a8d\n$ sshd -t\n\n\u8a2d\u5b9a\u306b\u30df\u30b9\u304c\u3042\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u69d8\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\uff08\u554f\u984c\u306a\u3044\u5834\u5408\u3001\u4f55\u3082\u51fa\u529b\u3055\u308c\u307e\u305b\u3093\uff09\n/etc/ssh/sshd_config: line 36: Bad configuration option: hogehoge\n/etc/ssh/sshd_config: terminating, 1 bad configuration options\n\n\u8a2d\u5b9a\u306e\u53cd\u6620 \n$ systemctl restart sshd\n\n\u7e4b\u3050\u3068\u304d\u306e\u30b3\u30de\u30f3\u30c9 \n$ ssh -i ~/.ssh/id_ed25519 ssher@\u63a5\u7d9a\u5148IP\u30a2\u30c9\u30ec\u30b9 -p 49152\n\n\u3061\u306a\u307f\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u8a2d\u5b9a\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304f\u3068\u30b3\u30de\u30f3\u30c9\u304c\u77ed\u304f\u306a\u3063\u3066\u5e78\u305b\u3067\u3059\u3002\n\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u4e57\u3063\u53d6\u3089\u308c\u305f\u6642\u306f\u3001\u7c21\u5358\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a4\u3092\u9ad8\u304f\u4fdd\u3064\u306a\u3089\u30aa\u30b9\u30b9\u30e1\u3057\u307e\u305b\u3093\uff09\n\n~/.ssh/config\nHost \u63a5\u7d9a\u5148\u306e\u4efb\u610f\u306e\u540d\u524d\n  HostName \u63a5\u7d9a\u5148\u306eIP\u30a2\u30c9\u30ec\u30b9\n  User ssher\n  IdentityFile ~/.ssh/id_ed25519\n  Port 49152\n\n\n\u63a5\u7d9a\u30b3\u30de\u30f3\u30c9\n$ ssh \u63a5\u7d9a\u5148\u306e\u4efb\u610f\u306e\u540d\u524d\n\n\u5931\u6557\u30e1\u30e2\n\u74b0\u5883\u69cb\u7bc9\u4e2d\u3001\u30b5\u30fc\u30d0\u306b\u758e\u901a\u3067\u304d\u308b\u306b\u3082\u95a2\u308f\u3089\u305a\u3001\u8a3c\u660e\u66f8\u3092\u53d7\u3051\u4ed8\u3051\u3066\u3082\u3089\u3048\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n/var/log/secure \u306b\u8a8d\u8a3c\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u30ed\u30b0\uff08\u4ee5\u4e0b\u5185\u5bb9\uff09\u3092\u898b\u3064\u3051\u305f\u3002\nAuthentication refused: bad ownership or modes for directory /home/ssher/.ssh\n\n\u539f\u56e0\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u8a2d\u5b9a\u3067\u3057\u305f\u3002\n755\u3067\u52d5\u3044\u305f\u65b9\u3082\u304a\u3089\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u79c1\u306e\u5834\u5408\u3059\u3067\u306b755\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\n700\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n$ chmod 700 .ssh\n\n\nssh\u53c2\u8003\u30b5\u30a4\u30c8\n\nSSH\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u30a2\u30bf\u30c3\u30af\uff08ID, PASS \u7dcf\u5f53\u305f\u308a\u653b\u6483\u3001\u8f9e\u66f8\u653b\u6483\uff09\u306b\u8ca0\u3051\u306a\u3044\u8a2d\u5b9a\u306b\u3059\u308b\nOpenSSH 6.5 \u3067\u8ffd\u52a0\u3055\u308c\u305f\u6a5f\u80fd\u3092\u8a66\u3059\n\n\niptables\u306e\u8a2d\u5b9a\nCentOS7\u304b\u3089\u306f\u5f93\u6765\u306eiptables \u306b\u5909\u308f\u308a\u3001firewall-cmd\u3000\u306b\u306a\u3063\u3066\u307e\u3059\u306e\u3067\u3001\n\u3053\u3061\u3089\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nfirewall-cmd \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u308a\u3001\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u308a\u3001\u3053\u308c\u304c\u672c\u5f53\u306b\u8272\u3005\u82e6\u52b4\u3057\u307e\u3057\u305f\u30021 \n\u7834\u68c4\u8a2d\u5b9a\nDROP\u306e\u8a2d\u5b9a\u306fdirect\u30b3\u30de\u30f3\u30c9\u3067\u30ac\u30c4\u30ac\u30c4\u5165\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n\uff08direct\u30b3\u30de\u30f3\u30c9\u306f\u512a\u5148\u5ea6\u304c\u9ad8\u3044\u306e\u3067\u3053\u3061\u3089\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff09\n\nfirewall\u7a74\u3042\u3051\n# firewall-cmd --remove-service=ssh --permanent   # \u901a\u5e38\u306essh\u30dd\u30fc\u30c8\u306f\u585e\u3050\n\n# # \u30c7\u30fc\u30bf\u3092\u6301\u305f\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u306e\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd  --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --tcp-flags ALL NONE -j DROP \n# # SYNflood\u653b\u6483\u3068\u601d\u308f\u308c\u308b\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp ! --syn -m state --state NEW -j DROP \n# # \u30b9\u30c6\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u3068\u601d\u308f\u308c\u308b\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --tcp-flags ALL ALL -j DROP  \n# # \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m pkttype --pkt-type broadcast -j DROP\n# # \u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m pkttype --pkt-type multicast -j DROP \n# # IP Spoofing(\u306a\u308a\u3059\u307e\u3057) \u306e\u5bfe\u5fdc(\u5916\u90e8\u304b\u3089\u3084\u3063\u3066\u304f\u308b\u30ed\u30fc\u30ab\u30ebIP\u306f\u7834\u68c4)\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 127.0.0.1/8 -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 10.0.0.0/8 -j DROP #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 172.16.0.0/12 -j DROP\n# # firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 192.168.0.0/16 -j DROP  #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# # firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 192.168.0.0/24  -j DROP #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# # Ping of Death \u653b\u6483\u5bfe\u7b56\uff08firewall-cmd\u306b\u4fee\u6b63\u3059\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u306a\u3063\u305f\u306e\u3067\u5272\u611b\u3002\u53c2\u8003\u30b5\u30a4\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n# # Ping\u306b\u4e0d\u8981\u306aicmp\u30bf\u30a4\u30d7\u306e\u30d6\u30ed\u30c3\u30af(echo-request\u3001echo-reply \u4ee5\u5916)\n# firewall-cmd --permanent --add-icmp-block=destination-unreachable\n# firewall-cmd --permanent --add-icmp-block=parameter-problem\n# firewall-cmd --permanent --add-icmp-block=redirect\n# firewall-cmd --permanent --add-icmp-block=router-advertisement\n# firewall-cmd --permanent --add-icmp-block=router-solicitation\n# firewall-cmd --permanent --add-icmp-block=source-quench\n# firewall-cmd --permanent --add-icmp-block=time-exceeded\n# # invalid \u30d1\u30b1\u30c3\u30c8\u3092\u7834\u68c4\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m state --state INVALID -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -m state --state INVALID -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -m state --state INVALID -j DROP\n\n\n\u6761\u4ef6\u4ed8\u304d\u3067\u8a31\u53ef \n# # Ping Flood\u653b\u6483\u5bfe\u7b56\uff084\u56de\u4ee5\u4e0aping\u3092\u53d7\u4fe1\u3057\u305f\u5834\u5408\u3001\u4ee5\u964d\u306f1\u79d2\u9593\u306b1\u5ea6\u3060\u3051\u8a31\u53ef\u3057\u307e\u3059\u3002\uff09\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p icmp --icmp-type 8 -m length --length :85 -m limit --limit 1/s --limit-burst 4 -j ACCEPT\n# # flooding of RST packets, smurf attack Rejection\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp -m tcp --tcp-flags RST RST -m limit --limit 2/second --limit-burst 2 -j ACCEPT\n\n# # Protecting portscans\n# # Attacking IP will be locked for 24 hours (3600 x 24 = 86400 Seconds)\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m recent --name portscan --rcheck --seconds 86400 -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -m recent --name portscan --rcheck --seconds 86400 -j DROP\n\n# Remove attacking IP after 24 hours\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m recent --name portscan --remove\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD  0 -m recent --name portscan --remove\n\n\u8a31\u53ef \n# firewall-cmd --add-port=49152/tcp --permanent  # 49152\u756a\u306e\u901a\u4fe1\u8a31\u53ef(\u3053\u306e\u30b5\u30fc\u30d0\u306essh\u306e\u30dd\u30fc\u30c8\u756a\u53f7\uff09\n\n\u57fa\u672c\u52d5\u4f5c \n\u4e0b\u8a18\u8a2d\u5b9a\u306fssh\u306e\u63a5\u7d9a\u304c\u78ba\u8a8d\u3055\u308c\u3066\u304b\u3089\u884c\u3046\u4e8b\u3002\uff08\u3067\u306a\u3044\u3068\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304f\u306a\u308b\u3002\uff09\n# # \u30eb\u30fc\u30eb\u306b\u5f53\u3066\u306f\u307e\u3089\u306a\u3044\u53d7\u4fe1\u3092\u7834\u68c4(\u3053\u308c\u3067\u3001INPUT\u3001FORWARD\u4e21\u65b9\u306bDROP)\n# firewall-cmd --permanent --zone=public --set-target=DROP  \n\n\u8a2d\u5b9a\u53cd\u6620 \n# firewall-cmd --reload\n\n\u30ed\u30b0\u306e\u8a2d\u5b9a\n\u6c17\u529b\u304c\u5c3d\u304d\u305f\u306e\u3067\u305d\u306e\u5185\u3001\u4e0b\u8a18\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3057\u307e\u3059\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* iptables\u3067\u30ed\u30b0\u51fa\u529b\u8a2d\u5b9a\n*  iptables\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u52d5\u7684\u306b\u4f5c\u6210\n* \u305d\u3053\u305d\u3053\u30bb\u30ad\u30e5\u30a2\u306alinux\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b\n* * How to protect from port scanning and smurf attack in Linux Server by iptables\n* \u3055\u304f\u3089\u306e\u30b5\u30dd\u30fc\u30c8\u60c5\u5831\u3000iptables\u306e\u8a2d\u5b9a\u65b9\u6cd5\n* \u81ea\u5206\u4ed5\u69d8\u306ebox\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n* \u7acb\u3061\u4e0a\u3052\u76f4\u5f8c\u306eiptables\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n* iptables\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u52d5\u7684\u306b\u4f5c\u6210\n\nTCPWrapper(hosts.allow\u3001hosts.deny)\u306e\u8a2d\u5b9a\nsshd\u306e\u63a5\u7d9a\u306f\u8a31\u53ef\u3057\u3001\u305d\u306e\u4ed6\u306e\u63a5\u7d9a\u306f\u62d2\u5426\u3057\u307e\u3059 \nhosts.allow \u2192 hosts.deny \u306e\u9806\u306b\u51e6\u7406\u3057\u307e\u3059\n\n/etc/hosts.allow\nsshd : ALL\n\n\n\n/etc/hosts.deny\n\nALL  : ALL\n\n\n\nsudo\u306e\u8a2d\u5b9a\nsudo \u3092\u4f7f\u3063\u3066\u30b7\u30a7\u30eb\u30ed\u30b0\u30a4\u30f3\u3055\u308c\u308b\u3068\u30ed\u30b0\u306b\u3082\u6b8b\u3089\u306a\u3044\u307e\u307e\u3001\u3000\u3000\n\u5168\u6a29\u9650\u3092\u6301\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3055\u308c\u308b\u3068\u3000\u5177\u5408\u304c\u60aa\u3044\u306e\u3067\u5b9f\u884c\u7981\u6b62\u306b\u3057\u307e\u3059\n\u3064\u3044\u3067\u306b\u4ed6\u306e\u8a2d\u5b9a\u3082\u3061\u3087\u3053\u3063\u3068\u3060\u3051\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nshell \u30b3\u30de\u30f3\u30c9 \n\nsudo\u306e\u7de8\u96c6\n# visudo\n\n\n\u8a18\u8ff0\u5185\u5bb9 \nDefaults    requiretty   # \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u6301\u305f\u306a\u3044ssh\u306e\u63a5\u7d9a\u306f\u3055\u305b\u306a\u3044\n#Defaults:vagrant    !requiretty   #\u3000vagrant\u30e6\u30fc\u30b6\u3060\u3051\u8a31\u53ef\u3059\u308b\u5834\u5408\u306f\u3053\u306e\u884c\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3059\u3002\n\nDefaults timestamp_timeout = 0  # sudo\u3059\u308b\u3068\u6bce\u56de\u5fc5\u305a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6c42\u3081\u308b\u3088\u3046\u306b\u3059\u308b\nDefaults rootpw                 # sudo\u3092\u5b9f\u884c\u3059\u308b\u969b\u306froot\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6c42\u3081\u308b\n# \u6700\u521d\u306b\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u3042\u308b\u7a0b\u5ea6\u5236\u9650\u3059\u308b\nCmnd_Alias ALLOWCMND = /usr/sbin/\n# sudo\u3067\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3055\u305b\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\uff08\u8d77\u52d5\u3057\u305f\u30b7\u30a7\u30eb\u5185\u3067\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u304c\u30ed\u30b0\u306b\u6b8b\u3089\u306a\u3044\u305f\u3081\u3002\uff09\nCmnd_Alias SHELLS = /bin/sh, /bin/csh, /bin/tcsh, /bin/bash, /usr/local/bin/bash\nCmnd_Alias SHELLS_NONINTERACTIVE = /bin/sh -c *, /bin/csh -c *, /bin/tcsh -c *, /bin/bash -c *\nCmnd_Alias SU = /bin/su, /usr/sbin/visudo\n# %wheel ALL=(ALL)       NOPASSWD: ALL, !SU, !SHELLS, SHELLS_NONINTERACTIVE\n%wheel ALL=(ALL)       ALLOWCMND, !SU, !SHELLS, SHELLS_NONINTERACTIVE\n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* \u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30ad\u30e5\u30a2\u306b\u3059\u308b\u305f\u3081\u306e\u5229\u7528\u5236\u9650\uff083\uff09\n* sudo\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\n\n\u30ab\u30fc\u30cd\u30eb\u8a2d\u5b9a\n\u8a2d\u5b9a\u59cb\u3081\u305f\u5f53\u521d\u306f\u3053\u3053\u307e\u3067\u624b\u3092\u51fa\u3059\u4e88\u5b9a\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\n\u8abf\u3079\u3066\u304f\u3046\u3061\u306b\u51fa\u3066\u304d\u3061\u3083\u3063\u305f\u306e\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002  \n# SYN Cookies\u3092\u6709\u52b9\u306b\u3059\u308b\n# \u203bTCP SYN Flood\u653b\u6483\u5bfe\u7b56\nsed -i '/net.ipv4.tcp_syncookies/d' /etc/sysctl.conf\necho \"net.ipv4.tcp_syncookies=1\" >> /etc/sysctl.conf\n\n# \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u5b9bping\u306b\u306f\u5fdc\u7b54\u3057\u306a\u3044\n# \u203bSmurf\u653b\u6483\u5bfe\u7b56\nsed -i \u2018/net.ipv4.icmp_echo_ignore_broadcasts/d\u2019 /etc/sysctl.conf\necho \u201cnet.ipv4.icmp_echo_ignore_broadcasts=1\u201d >> /etc/sysctl.conf\n\n# ICMP Redirect\u30d1\u30b1\u30c3\u30c8\u306f\u62d2\u5426\nsed -i '/net.ipv4.conf.*.accept_redirects/d' /etc/sysctl.conf\nsed -i '/net.ipv6.conf.*.accept_redirects/d' /etc/sysctl.conf\nfor dev in `ls /proc/sys/net/ipv4/conf/`\ndo\nsysctl -w net.ipv4.conf.$dev.accept_redirects=0 > /dev/null\necho \"net.ipv4.conf.$dev.accept_redirects=0\" >> /etc/sysctl.conf\ndone\nfor dev in `ls /proc/sys/net/ipv6/conf/`\ndo\nsysctl -w net.ipv6.conf.$dev.accept_redirects=0 > /dev/null\necho \"net.ipv6.conf.$dev.accept_redirects=0\" >> /etc/sysctl.conf\ndone\n\n# Source Routed\u30d1\u30b1\u30c3\u30c8\u306f\u62d2\u5426\nsed -i \u2018/net.ipv4.conf.*.accept_source_route/d\u2019 /etc/sysctl.conf\nfor dev in `ls /proc/sys/net/ipv4/conf/`\ndo\nsysctl -w net.ipv4.conf.$dev.accept_source_route=0 > /dev/null\necho \u201cnet.ipv4.conf.$dev.accept_source_route=0\u201d >> /etc/sysctl.conf\ndone\n\n\n\u8a2d\u5b9a\u53cd\u6620\n# sysctl -p\n\n\u78ba\u8a8d\u65b9\u6cd5\nSYN Cookies\u3092\u6709\u52b9\u306b\u3059\u308b\n# sysctl -a | grep net.ipv4.tcp_syncookies\nnet.ipv4.tcp_syncookies = 1\n\n\u4e0a\u8a18\u306f\u30b5\u30a4\u30c8\u304b\u3089\u62fe\u3063\u3066\u304d\u305f\u5185\u5bb9\u305d\u306e\u307e\u307e\u3067\u3059\u304c\u3001\n\u8a2d\u5b9a\u5909\u66f4\u524d\u306b\u5fc5\u8981\u306a\u306e\u306f ICMP\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u30d1\u30b1\u30c3\u30c8\u306e\u62d2\u5426\u306e\u307f\u3067\u3057\u305f\u3002\n\u305d\u306e\u4ed6\u306f\u8a2d\u5b9a\u6e08\u307f\u3067\u3057\u305f\u3002  \n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* RHEL 7 beta\u306b\u6311\u6226\u305d\u306e4(firewalld)\n* Linux\u3067\u4f5c\u308b\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\uff3b\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a\u7de8\uff3d \n\n\u305d\u306e\u4ed6\n\u3053\u3053\u304b\u3089\u4e00\u6c17\u306b \u624b\u629c\u304d\u3001\u3001\u3001\u30b2\u30d5\u30f3\u30b2\u30d5\u30f3\n\n\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u66f4\u65b0\n\n\u30d1\u30c3\u30c1\u5f53\u3066\n$ yum update\n\n\n\n\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\nsystemctl \u3067active\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u78ba\u8a8d\u3057\u3064\u3064\n\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u304c\u3001\u3061\u3087\u3063\u3068\u529b\u5c3d\u304d\u305f\u306e\u3067\u7701\u7565\n\u6c17\u529b\u304c\u51fa\u3066\u304d\u305f\u3089\u66f4\u65b0\u3057\u307e\u3059\u3002\n\nlogwatch\u3092\u5165\u308c\u308b\n\u3068\u308a\u3042\u3048\u305a\u9632\u3052\u3066\u305f\u3089\u3044\u3044\u306e\u3068\u3001\n\u307e\u3060\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306e\u958b\u767a\u3088\u3046\u306b\u3057\u304b\u4f7f\u308f\u306a\u3044\u306e\u3067\u3001\u898b\u9001\u308a\u3057\u307e\u3059\u3002\n\u516c\u958b\u524d\u3050\u3089\u3044\u306b\u307e\u305f\u898b\u76f4\u3057\u307e\u3059\n\n\u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef\u306b\u3059\u308b\n\u5272\u3068\u3069\u306e\u30e6\u30fc\u30b6\u3082/nologin\u306b\u306a\u3063\u3066\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u306f\u826f\u3055\u3052\u3002\n\numask\u3092027\nothers\u304b\u3089\u306f\u597d\u304d\u306b\u898b\u308c\u306a\u3044\u3088\u3046\u306b007\u3001027\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n# By default, we want umask to get set. This sets it for login shell\n# Current threshold for system reserved uid/gids is 200\n# You could check uidgid reservation validity in\n# /usr/share/doc/setup-*/uidgid file\n\n# Before\n# if [ $UID -gt 199 ] && [ \"`id -gn`\" = \"`id -un`\" ]; then\n#     umask 007\n# else\n#     umask 027\n# fi\n\n# After\nif [ $UID -gt 199 ] && [ \"`id -gn`\" = \"`id -un`\" ]; then\n    umask 007\nelse\n    umask 027\nfi\n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* \u305d\u3053\u305d\u3053\u30bb\u30ad\u30e5\u30a2\u306alinux\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b\n\n\n\u7d42\u308f\u308a\u306b\n\u3053\u3053\u307e\u3067\u8aad\u3093\u3067\u9802\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\u6700\u5f8c\u306e\u65b9\u306f\u660e\u3089\u304b\u306b\u624b\u629c\u304d\u611f\u304c\u6f02\u3063\u3066\u3044\u307e\u3059\u304c\u3001\n\u307e\u305f\u6a5f\u4f1a\u3092\u898b\u3064\u3051\u3066\u898b\u76f4\u3057\u3066\u3044\u3053\u3046\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u4e16\u754c\u306f\u697d\u3057\u3044\u3067\u3059\u3088\u306d\u3002\n\u672c\u8a18\u4e8b\u3067\u306f\u3084\u3063\u3066\u308b\u4e8b\u3070\u304b\u308a\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001  \u8a2d\u5b9a\u306e\u5fc5\u8981\u6027\u304b\u3089\u6df1\u304f\u52c9\u5f37\u3057\u3066\u3044\u304f\u3068\u3001\n\u4eba\u3068\u4eba\u306e\u30ac\u30c1\u306e\u77e5\u6075\u6bd4\u3079\u306e\u6b74\u53f2\u304c\u51dd\u7e2e\u3055\u308c\u3066\u3044\u308b\u69d8\u304c\u898b\u3048\u3066\u304d\u305f\u308a\u3057\u307e\u3059\u3002 \n\u307e\u3055\u306b\u53e1\u667a\u306e\u7d50\u6676\u3002\n(\u4e0d\u8b39\u614e\u3067\u3059\u307f\u307e\u305b\u3093\uff09\n\u3053\u3053\u3067\u66f8\u3044\u305f\u8a2d\u5b9a\u3082\u6642\u9593\u304c\u7d4c\u3066\u3070\u3001\u305d\u308c\u3092\u7834\u308b\u653b\u6483\u65b9\u6cd5\u3068\u304b\u898b\u3064\u3051\u3089\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u3082\u5927\u3044\u306b\u3042\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u305d\u306e\u653b\u6483\u3092\u9632\u3050\u305f\u3081\u306e\u65b0\u3057\u3044\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002 \n\u3084\u308b\u3053\u3068\u304c\u5909\u308f\u308c\u3070\u3001\u8a2d\u5b9a\u3082\u5909\u308f\u308a\u307e\u3059\u3002\n\u3053\u306e\u8a2d\u5b9a\u3092\u9d5c\u5451\u307f\u306b\u8a2d\u5b9a\u3057\u306a\u3044\u3067\u3001\u3054\u81ea\u8eab\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066 \n\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u307e\u3059\u3088\u3046\u304a\u9858\u3044\u3057\u307e\u3059\u30022\n\u7686\u69d8\u306e\u4f55\u304b\u306e\u304a\u5f79\u306b\u7acb\u3066\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u307e\u305f\u3001\u30b5\u30fc\u30d0\u306e\u69cb\u7bc9\u53ca\u3073\u672c\u8a18\u4e8b\u3092\u66f8\u304f\u306b\u3042\u305f\u308a\u3001\u591a\u304f\u306e\u30b5\u30a4\u30c8\u304b\u3089\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u3001\u30b5\u30a4\u30c8\u7ba1\u7406\u8005\u69d8\u306b\u611f\u8b1d\u3044\u305f\u3057\u307e\u3059\u3002\n\n\n\n\n\nCentOS7.2\u3000minimal\u306ffirewalld\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u53c2\u8003\u30b5\u30a4\u30c8  \u00a0\u21a9\n\n\n\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u95a2\u4fc2\u4e0a\u30b3\u30d4\u30fc\uff06\u30da\u30fc\u30b9\u30c8\u3067\u306f\u9ad8\u3044\u78ba\u7387\u3067\u5931\u6557\u3059\u308b\u7b87\u6240\u304c\u672c\u8a18\u4e8b\u5185\u306b\u3082\u3042\u308a\u307e\u3059\u3002 \u8868\u8a18\u306b\u60a9\u3093\u3060\u306e\u3067 \u3042\u3048\u3066\u3069\u3053\u304b\u306f\u66f8\u304d\u307e\u305b\u3093\u3002\u00a0\u21a9\n\n\n\n## \u3053\u306e\u8a18\u4e8b\u306f\n\u30b9\u30de\u30db\u30b2\u30fc\u30e0\u3092\u4f5c\u3063\u3066\u3044\u308b\u4e2d\u3067\u30b5\u30fc\u30d0\u304c\u8981\u308b\u306e\u3067\u3001\nWebAPI\u30b5\u30fc\u30d0\u3068DB\u30b5\u30fc\u30d0\u306e\u571f\u53f0\u3092\u4f5c\u308d\u3046\u3068\u601d\u3044\u7acb\u3061\u3001\n\u3044\u308d\u3044\u308d\u306a\u30b5\u30a4\u30c8\u3068\u81ea\u5206\u306e\u904e\u53bb\u306e\u7d4c\u9a13\u30fb\u77e5\u8b58\u304b\u3089\u306e\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u305f\u65e5\u8a18\u3067\u3059\u3002  \n\n\u4e3b\u306b\u81ea\u5206\u304c\u3084\u3063\u305f\u4e8b\u3092\u4e2d\u5fc3\u306b\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\n\u8a2d\u5b9a\u5185\u5bb9\u306b\u3064\u3044\u3066\u306e\u8aac\u660e\u306f\u304b\u306a\u308a\u7701\u7565\u3057\u3066\u66f8\u3044\u3066\u304a\u308a\u307e\u3059\u3002\n\u3054\u4e0d\u660e\u306a\u70b9\u304c\u3054\u3056\u3044\u307e\u3057\u305f\u3089\u3001\u30b3\u30e1\u30f3\u30c8\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n## \u672c\u8a18\u4e8b\u3067\u3084\u3063\u3066\u3044\u308b\u4e8b\nMacOSX 10.11.3 \u3092\u30db\u30b9\u30c8OS\u3068\u3057\u3001VirtualBox 5.0.16 \u4e0a\u306b CentOS7.1 \uff081503\uff09 minimal \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb[^1]\n\u305d\u306e\u72b6\u614b\u3067\u30bb\u30ad\u30e5\u30a2\u306b\u3084\u308c\u308b\u8a2d\u5b9a\u306b\u624b\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n * \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b5\u30fc\u30d3\u30b9\u306fssh\u306e\u307f\u3067\u3059\u3002\uff08SNMP\u3001Web\u30b5\u30fc\u30d0\u3001DB\u7b49\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u305b\u3093\uff09\n * SELinux\u306f\u6709\u52b9\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3086\u308b\u3081\u306e\u8a2d\u5b9a\u3067\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n * \u305d\u306e\u4ed6\u76e3\u8996\u7cfb\u306e\u30bd\u30d5\u30c8\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n \n## \u8a2d\u5b9a\u9805\u76ee\u6982\u8981\nip\n\n|\u30bf\u30a4\u30c8\u30eb |\u6982\u8981 |\n|:--|:--|\n|IP\u8a2d\u5b9a |\u8efd\u304f\u8a2d\u5b9a |\n\nSELinux\n\n|\u30bf\u30a4\u30c8\u30eb | \u6982\u8981 |\n|:--|:--|\n|\u30dd\u30fc\u30c8\u8a2d\u5b9a | ssh\u7528\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u5bfe\u5fdc\u3000|\n\n\nsshd\t\n\n|\u30bf\u30a4\u30c8\u30eb | \u6982\u8981 |\n|:--|:--|\n|ssh\u30dd\u30fc\u30c8\u5909\u66f4 |\u63a5\u7d9a\u5148\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4 |\n|ssh\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5236\u9650 | sshd\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u30922\u306b\u9650\u5b9a |\n|\u516c\u958b\u9375\u306e\u8a2d\u5b9a |RSA\u306e\u9375\u3067\u306f\u306a\u304f\u3066ED25519\u3067\u9375\u3092\u4f5c\u6210 |\n|\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u5207\u308b |\u516c\u958b\u9375\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a |\n|root\u3067login\u51fa\u6765\u306a\u304f\u3059\u308b | \u5de6\u8a18\u306e\u901a\u308a |\n|\u8a8d\u8a3c\u5468\u308a\u306e\u8a2d\u5b9a |\u8a8d\u8a3c\u306e\u7336\u4e88\u6642\u9593\u3084\u8a8d\u8a3c\u56de\u6570\u306a\u3069 |\n|\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306e\u5236\u9650 | \u6307\u5b9a\u30e6\u30fc\u30b6\u306e\u307f\u304c\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b |\n|\u63a5\u7d9a\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5236\u9650 |X11\u3001\u4eee\u60f3\u7aef\u672b\u306e\u4f7f\u7528\u5236\u9650 |\n\nfirewall ( iptables )\n\n|\u30bf\u30a4\u30c8\u30eb|\u6982\u8981|\n|:--|:--|\n|\u7834\u68c4\u8a2d\u5b9a | ip spoofing\u3001port scan\u3001Flood\u653b\u6483 \u7b49\u3092DROP |\n|\u6761\u4ef6\u4ed8\u304d\u306e\u63a5\u7d9a |\uff11\u56de\u76ee\u306f\u3088\u304f\u3066\u3082\u7acb\u3066\u7d9a\u3051\u306b\u6765\u305f\u653b\u6483\u7b49\u306e\u5bfe\u5fdc |\n|\u63a5\u7d9a\u8a2d\u5b9a|\u81ea\u5206\u304c\u4f7f\u3046\u3082\u306e\u306f\u7121\u6761\u4ef6\u306b\u63a5\u7d9a\u3000|\n\nTCPWrapper\n\n|\u30bf\u30a4\u30c8\u30eb|\u6982\u8981|\n|:--|:--|\n|host.allow|\u30b5\u30fc\u30d3\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u7d10\u4ed8\u3051\u3066\u63a5\u7d9a\u306e\u8a31\u53ef |\n|host.deny|allow\u3067\u8a31\u53ef\u3055\u308c\u306a\u304b\u3063\u305f\u901a\u4fe1\u306e\u62d2\u5426 |\n\nsudo\n\n|\u30bf\u30a4\u30c8\u30eb|\u6982\u8981|\n|:--|:--|\n|\u5229\u7528\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u306e\u5236\u9650|\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5236\u9650\u3059\u308b|\n|\u63a5\u7d9a\u5236\u9650|\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u6301\u305f\u306a\u3044\u63a5\u7d9a\u306f\u62d2\u5426 |\n|\u30b7\u30a7\u30eb\u5b9f\u884c\u7981\u6b62 |sudo \u3067\u306e\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u3092\u7981\u6b62 |\n|\u30bb\u30c3\u30b7\u30e7\u30f3\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306e\u6642\u9593\u8a2d\u5b9a|\u8a8d\u8a3c\u6709\u52b9\u671f\u9593\u306e\u8a2d\u5b9a |\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u8a2d\u5b9a\n\n|\u30bf\u30a4\u30c8\u30eb|\u6982\u8981|\n|:--|:--|\n|\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5bfe\u5fdc |TCP SYN Flood\u3001Sumrf\u653b\u6483\u5bfe\u5fdc\u7b49\u3005 |\n\n\u305d\u306e\u4ed6\n\n|\u30bf\u30a4\u30c8\u30eb|\u6982\u8981|\n|:--|:--|\n|\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u9069\u7528 |yum update |\n| \u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62 |\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62 |\n| logwatch\u306e\u5c0e\u5165 |\u4eca\u56de\u306f\u898b\u9001\u3063\u3066\u3044\u307e\u3059 |\n|\u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef |\u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef |\n|umask\u306e\u8a2d\u5b9a |\u95a2\u4fc2\u306a\u3044\u30e6\u30fc\u30b6\u306e\u30d5\u30a1\u30a4\u30eb\u30a2\u30af\u30bb\u30b9\u5236\u9650 |\n\n----\n## ip\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\n\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3067\u3084\u308c\u305f\u3089\u30ab\u30c3\u30b3\u3088\u304b\u3063\u305f\u3051\u3069\u3001\u3001\u3001TUI\u3067\u8a2d\u5b9a\uff08\u309c\u309c\n\n```\n# nmtui\n\nEdit a Connection\u3000\u2190\u9078\u629e\n\uff08NIC\u30ab\u30fc\u30c9\u3092\u9078\u629e\uff09\nIPv4 Configuration <Show> \u2190\u9078\u629e\nRequire IPv4 addressing for this connection \u2190\u3000\u30c1\u30a7\u30c3\u30af\nAutomatically Connect \u2190\u3000\u30c1\u30a7\u30c3\u30af\nOK\u3000\u2190\u3000\u9078\u629e\nQuit\u3000\u2190\u3000\u9078\u629e\n```\n\n\u78ba\u8a8d\n\n```\n# ip addr\n```\n\u53c2\u8003\n [CentOS7 \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u5909\u66f4](http://www.unix-power.net/centos7/network.html)\n\n## SELinux\u306e\u8a2d\u5b9a\n\u3053\u3053\u3067\u306f\u30dd\u30fc\u30c8\u306e\u7a74\u3042\u3051 \u3092\u3084\u3063\u3066\u3044\u307e\u3059\u3002\nssh\u3067\u901a\u4fe1\u3059\u308b\u4e88\u5b9a\u306e\u30dd\u30fc\u30c8\uff08=49152\uff09\u306b\u306a\u308a\u307e\u3059\u3002\n\u307e\u305a\u3053\u308c\u3092\u3084\u3063\u3066\u304a\u304b\u306a\u3044\u3068ssh\u901a\u4fe1\u304c\u3067\u304d\u305a\u3001\u614c\u3066\u308b\u3053\u3068\u306b\u3002\n\uff08\u3068\u3044\u3046\u304b\u5b9f\u969b\u3001\u6570\u6642\u9593iptables\u3068sshd_config\u306e\u8a2d\u5b9a\u306e\u898b\u76f4\u3057\u3070\u3063\u304b\u308a\u3084\u3063\u3066\u6642\u9593\u3092\u6d6a\u8cbb\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\uff09\n\n\n**\u7de8\u96c6\u7528\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\n\n```\n$ yum install policycoreutils-python\n```\n\n**\u30dd\u30fc\u30c8\u306e\u8ffd\u52a0**\n\n```\n$ semanage port -a -t ssh_port_t -p tcp 49152\n```\n\n**\u8a2d\u5b9a\u78ba\u8a8d**\n\n```\n$ semanage port -l | grep ssh\n```\n\n**SELinux\u306e\u30ed\u30b0**\n\n```\n$ cat /var/log/audit/audit.log\n```\n\n## ssh\u306e\u8a2d\u5b9a\n\nssh\u306e\u8a2d\u5b9a\u3092\u4ed5\u4e0a\u3052\u3066\u306a\u3044\u3068\u4f55\u304b\u3068\u4e0d\u4fbf\u306a\u306e\u3067\u3001\n\u6700\u521d\u306bssh\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\n**ssh\u63a5\u7d9a\u7528\u30e6\u30fc\u30b6(=ssher)\u306e\u4f5c\u6210** \n\n```\n# groupadd -g 1900 mainte\n# useradd -G mainte,wheel -u 1901  ssher #<ssh\u3067\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u3000and \u30eb\u30fc\u30c8\u6a29\u9650\u306b\u6607\u683c\u3067\u304d\u308b\u30e6\u30fc\u30b6> \n# mkdir /home/ssher/.ssh\n# chmod 700 /home/ssher/.ssh                          # <- \u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\n```\n\n**\u79d8\u5bc6\u9375/\u516c\u958b\u9375\u306e\u4f5c\u6210**\n  \n[RSA\u306f\u3082\u3046\u53e4\u3044](http://d.hatena.ne.jp/hnw/20140705)\u306e\u3067ED25519\u3067\u4f5c\u308a\u307e\u3059\u3002\uff08\u30df\u30fc\u30cf\u30fc\uff09\nMacOSX\u3067\u9375\uff08\u79d8\u5bc6\u9375/\u516c\u958b\u9375\uff09\u3092\u4f5c\u3063\u3066\u30b5\u30fc\u30d0\u5074\u3078\u516c\u958b\u9375\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n(\u30b5\u30fc\u30d0\u5074\u3067\u4f5c\u3063\u3066MacOSX\u306b\u79d8\u5bc6\u9375\u3092\u30b3\u30d4\u30fc\u3063\u3066\u65b9\u6cd5\u3082\u3084\u308a\u307e\u3057\u305f\u304c\u3001\nMacOSX\u306essh\u63a5\u7d9a\u3068\u76f8\u6027\u304c\u60aa\u304f\u3066\u3046\u307e\u304f\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\uff09\n\n```\n$ sshe-keygen -t ed25519\nGenerating public/private ed25519 key pair.\nEnter file in which to save the key (/Users/hogehoge/.ssh/id_ed25519):\nEnter passphrase (empty for no passphrase):\nEnter same passphrase again:\nYour identification has been saved in /Users/hogehoge/.ssh/id_ed25519.\nYour public key has been saved in /Users/hogehoge/.ssh/id_ed25519.pub.\nThe key fingerprint is:\nSHA256:FiublKpEQNgXnoVhogehogefugafugayWT74RSIRJEY hogehoge@MacOSX.local\nThe key's randomart image is:\n+--[ED25519 256]--+\n|      .   +oo    |\n|     . . = * .   |\n|    . sos = =    |\n|   . o = B + .   |\n|. ... o S * o    |\n| o .o.   = o     |\n|..++.   +        |\n|.oBoss o         |\n|Eo.=*+o          |\n+----[SHA256]-----+\n$\n$ # \u30b5\u30fc\u30d0\u5074\u3078\u516c\u958b\u9375\u3092\u30b3\u30d4\u30fc\n$ scp /Users/hogehoge/.ssh/id_ed25519.pub root@localhost:/home/ssher/.ssh/\nroot@localhost's password:\n$\n```\n\n\uff08\u3061\u306a\u307f\u306b\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305f\u9375\u306f\u4f5c\u308a\u76f4\u3057\u3066\u3044\u307e\u3059\u3002\u4e00\u90e8\u8868\u793a\u3092\u4f0f\u305b\u3066\u3044\u307e\u3059\u3002\uff09\n\n**\u30b5\u30fc\u30d0\u5074\u3067\u53d7\u3051\u53d6\u3063\u305f\u516c\u958b\u9375\u3092authorized_keys\u3078\u767b\u9332**\n  \n```bash:ssh\u306e\u8a2d\u5b9a\uff08\u516c\u958b\u9375\u306e\u767b\u9332\uff09\n# su - ssher\n$ cat ~/.ssh/id_ed25519.pub >> ~/.ssh/authorized_keys\n$ chmod 0600 ~/.ssh/authorized_keys\n$ chown ssher:ssher ~/.ssh/authorized_keys\n$ exit       #\u3000ssher\u30e6\u30fc\u30b6\u3092\u629c\u3051\u308b\n```\n\n**sshd_config\u306e\u8a2d\u5b9a**  \n\u57fa\u672c\u8a2d\u5b9a\u306f\u7d42\u308f\u3063\u305f\u306e\u3067\u3053\u3053\u304b\u3089\u672c\u683c\u7684\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u306b\u5165\u308b\n\n```bash:ssh\u306e\u8a2d\u5b9a\uff08\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u3067\u304d\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\uff09\n# vi /etc/ssh/sshd_config\n Protocol 2                              # Protocol 1 \u306f\u4f7f\u308f\u306a\u3044\uff08Protocol 1\u3067\u7e4b\u3050\u30bd\u30d5\u30c8\u3092\u4f7f\u7528\u3059\u308b\u4e88\u5b9a\u304c\u4e00\u5207\u7121\u3044\uff09\n Port 49152                             # ssh\u6a19\u6e96\u306e\u756a\u53f7\u3092\u4f7f\u308f\u306a\u3044(\u81ea\u7531\u306b\u4f7f\u3048\u308b\u30dd\u30fc\u30c8\u756a\u53f7 = 49152\u3000\u301c\u300065535 )\n\n# ed25519\u306e\u9375\u3060\u3051\u6709\u52b9\u306b\u3059\u308b\n# HostKeys for protocol version 2\n# HostKey /etc/ssh/ssh_host_rsa_key\n# HostKey /etc/ssh/ssh_host_dsa_key\n# HostKey /etc/ssh/ssh_host_ecdsa_key\nHostKey /etc/ssh/ssh_host_ed25519_key \n\n# Logging\nSyslogFacility AUTHPRIV\n\n# \u8a8d\u8a3c\u6642\u306e\u6319\u52d5\u8a2d\u5b9a\n LoginGraceTime 10               # \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u8cbc\u3063\u3066\u8a8d\u8a3c\u3059\u308b\u307e\u3067\u306e\u7336\u4e88\u6642\u9593(s)\n PermitRootLogin no              # root\u3000\u30e6\u30fc\u30b6\u304cssh\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n MaxAuthTries 3                     # \u6700\u5927\u8a8d\u8a3c\u8a66\u884c\u56de\u6570\n MaxStartups 2:90:4              # 2\u3064\u3092\u8d85\u3048\u308b\u8a8d\u8a3c\u53d7\u4ed8\u306f90%\u306e\u78ba\u7387\u3067\u906e\u65ad\u30024\u3064\u3092\u8d85\u3048\u308b\u3068\u5168\u3066\u906e\u65ad\n\n# \u8a8d\u8a3c\u65b9\u5f0f\u306e\u8a2d\u5b9a\n PasswordAuthentication no  # \u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\n ChallengeResponseAuthentication no #\u3000\u30c1\u30e3\u30ec\u30f3\u30b8\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u7981\u6b62\n PermitEmptyPasswords no   # \u7a7a\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u306f\u63a5\u7d9a\u62d2\u5426\n RSAAuthentication no           # \u304a\u305d\u3089\u304fProtocol 1\u306e\u6642\u4ee3\u5c02\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\n PubkeyAuthentication yes    # \u9375\u8a8d\u8a3c\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\n\n# The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2\nAuthorizedKeysFile      .ssh/authorized_keys\n\n\n# \u30b7\u30f3\u30b0\u30eb\u30b5\u30a4\u30f3\u30aa\u30f3\u306e\u8a2d\u5b9a\uff08GSSAPI options\uff09\u3000\u4f7f\u7528\u4e88\u5b9a\u7121\u3057\nGSSAPIAuthentication no\nGSSAPICleanupCredentials no\n\n\n# WARNING: 'UsePAM no' is not supported in Red Hat Enterprise Linux\n# and may cause several problems.\nUsePAM yes\u3000\u3000# \u7121\u52b9\u306b\u3059\u308b\u3068\u6319\u52d5\u4e0d\u5be9\u306b\u306a\u308b\u304f\u3055\u3044\u306e\u3067yes\u306e\u307e\u307e\n\n# \u63a5\u7d9a\u5236\u9650\nAllowUsers ssher   \u3000            # \u63a5\u7d9a\u3067\u304d\u308b\u30e6\u30fc\u30b6\u306e\u5236\u9650\n#AllowAgentForwarding no\n#AllowTcpForwarding yes\n#GatewayPorts no\nX11Forwarding no                 # GUI\u3067\u30b5\u30fc\u30d0\u3092\u64cd\u4f5c\u3057\u306a\u3044\nPermitTTY yes                      # \u4eee\u60f3\u7aef\u672b\u306e\u8a31\u53ef\u3002tmux\uff1f\u306a\u306b\u305d\u308c\uff1f\u306a\u65b9\u306fno\n \n# DNS\u63a5\u7d9a\u8a2d\u5b9a\nUsePrivilegeSeparation sandbox          # Default for new installations.\nUseDNS  no                           # IP\u30a2\u30c9\u30ec\u30b9\u3092\u4f7f\u7528\u3057\u3066\u63a5\u7d9a\u3059\u308b\u305f\u3081\u3001FQDN\u306e\u691c\u7d22\u306b\u304b\u304b\u308b\u5f85\u6a5f\u6642\u9593\u3092\u7121\u304f\u3059\u3002\n\n# \u4ee5\u4e0b\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3002\uff08\u6b63\u76f4\u3088\u304f\u308f\u304b\u3063\u3066\u306a\u3044\uff09\n# Accept locale-related environment variables\nAcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES\nAcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT\nAcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE\nAcceptEnv XMODIFIERS\n\n# override default of no subsystems\nSubsystem       sftp    /usr/libexec/openssh/sftp-server\n```\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306e\u4ef6\u3067\u3059\u304c\u3001\u6709\u52b9\u306b\u3057\u305f\u307e\u307e\u3060\u3068\u9375\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u305f\u6642\u3001\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u6d41\u308c\u3066\u3044\u304f\u3088\u3046\u3067\u3059\u3002\u9375\u8a8d\u8a3c\u306b\u3059\u308b\u5834\u5408\u3001\u5fc5\u305a\u7121\u52b9\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n**\u8a2d\u5b9a\u306e\u78ba\u8a8d**\n\n```\n$ sshd -t\n```\n\n\u8a2d\u5b9a\u306b\u30df\u30b9\u304c\u3042\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u69d8\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\uff08\u554f\u984c\u306a\u3044\u5834\u5408\u3001\u4f55\u3082\u51fa\u529b\u3055\u308c\u307e\u305b\u3093\uff09\n\n```\n/etc/ssh/sshd_config: line 36: Bad configuration option: hogehoge\n/etc/ssh/sshd_config: terminating, 1 bad configuration options\n```\n\n**\u8a2d\u5b9a\u306e\u53cd\u6620**  \n\n```\n$ systemctl restart sshd\n```\n\n**\u7e4b\u3050\u3068\u304d\u306e\u30b3\u30de\u30f3\u30c9**  \n\n```\n$ ssh -i ~/.ssh/id_ed25519 ssher@\u63a5\u7d9a\u5148IP\u30a2\u30c9\u30ec\u30b9 -p 49152\n```\n\n\u3061\u306a\u307f\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306b\u8a2d\u5b9a\u3092\u3076\u3061\u8fbc\u3093\u3067\u304a\u304f\u3068\u30b3\u30de\u30f3\u30c9\u304c\u77ed\u304f\u306a\u3063\u3066\u5e78\u305b\u3067\u3059\u3002\n\uff08\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u4e57\u3063\u53d6\u3089\u308c\u305f\u6642\u306f\u3001\u7c21\u5358\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3057\u307e\u3046\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a4\u3092\u9ad8\u304f\u4fdd\u3064\u306a\u3089\u30aa\u30b9\u30b9\u30e1\u3057\u307e\u305b\u3093\uff09\n\n```MAcOSX:~/.ssh/config\nHost \u63a5\u7d9a\u5148\u306e\u4efb\u610f\u306e\u540d\u524d\n  HostName \u63a5\u7d9a\u5148\u306eIP\u30a2\u30c9\u30ec\u30b9\n  User ssher\n  IdentityFile ~/.ssh/id_ed25519\n  Port 49152\n```\n\n**\u63a5\u7d9a\u30b3\u30de\u30f3\u30c9**\n\n```\n$ ssh \u63a5\u7d9a\u5148\u306e\u4efb\u610f\u306e\u540d\u524d\n```\n\n**\u5931\u6557\u30e1\u30e2**  \n\u74b0\u5883\u69cb\u7bc9\u4e2d\u3001\u30b5\u30fc\u30d0\u306b\u758e\u901a\u3067\u304d\u308b\u306b\u3082\u95a2\u308f\u3089\u305a\u3001\u8a3c\u660e\u66f8\u3092\u53d7\u3051\u4ed8\u3051\u3066\u3082\u3089\u3048\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n/var/log/secure \u306b\u8a8d\u8a3c\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u304b\u3063\u305f\u30ed\u30b0\uff08\u4ee5\u4e0b\u5185\u5bb9\uff09\u3092\u898b\u3064\u3051\u305f\u3002\n\n```\nAuthentication refused: bad ownership or modes for directory /home/ssher/.ssh\n```\n\n\u539f\u56e0\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6a29\u9650\u8a2d\u5b9a\u3067\u3057\u305f\u3002  \n755\u3067\u52d5\u3044\u305f\u65b9\u3082\u304a\u3089\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u79c1\u306e\u5834\u5408\u3059\u3067\u306b755\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001  \n700\u306b\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n\n```\n$ chmod 700 .ssh\n```\n\n### ssh\u53c2\u8003\u30b5\u30a4\u30c8\n\n* [SSH\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u30a2\u30bf\u30c3\u30af\uff08ID, PASS \u7dcf\u5f53\u305f\u308a\u653b\u6483\u3001\u8f9e\u66f8\u653b\u6483\uff09\u306b\u8ca0\u3051\u306a\u3044\u8a2d\u5b9a\u306b\u3059\u308b](http://blog.ybbo.net/2013/12/18/ssh\u30d6\u30eb\u30fc\u30c8\u30d5\u30a9\u30fc\u30b9\u30a2\u30bf\u30c3\u30af\uff08id-pass-\u7dcf\u5f53\u305f\u308a\u653b\u6483\u3001/)\n* [OpenSSH 6.5 \u3067\u8ffd\u52a0\u3055\u308c\u305f\u6a5f\u80fd\u3092\u8a66\u3059](http://togakushi.bitbucket.org/build/html/openssh-6.5.html)\n\n## iptables\u306e\u8a2d\u5b9a\nCentOS7\u304b\u3089\u306f\u5f93\u6765\u306e```iptables``` \u306b\u5909\u308f\u308a\u3001```firewall-cmd```\u3000\u306b\u306a\u3063\u3066\u307e\u3059\u306e\u3067\u3001\n\u3053\u3061\u3089\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002  \n```firewall-cmd``` \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5165\u3063\u3066\u306a\u304b\u3063\u305f\u308a\u3001\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u308a\u3001\u3053\u308c\u304c\u672c\u5f53\u306b\u8272\u3005\u82e6\u52b4\u3057\u307e\u3057\u305f\u3002[^1]  \n\n**\u7834\u68c4\u8a2d\u5b9a**\nDROP\u306e\u8a2d\u5b9a\u306fdirect\u30b3\u30de\u30f3\u30c9\u3067\u30ac\u30c4\u30ac\u30c4\u5165\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n\uff08direct\u30b3\u30de\u30f3\u30c9\u306f\u512a\u5148\u5ea6\u304c\u9ad8\u3044\u306e\u3067\u3053\u3061\u3089\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff09\n\n```bash:firewall\u7a74\u3042\u3051\n# firewall-cmd --remove-service=ssh --permanent   # \u901a\u5e38\u306essh\u30dd\u30fc\u30c8\u306f\u585e\u3050\n\n# # \u30c7\u30fc\u30bf\u3092\u6301\u305f\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u306e\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd  --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --tcp-flags ALL NONE -j DROP \n# # SYNflood\u653b\u6483\u3068\u601d\u308f\u308c\u308b\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp ! --syn -m state --state NEW -j DROP \n# # \u30b9\u30c6\u30eb\u30b9\u30b9\u30ad\u30e3\u30f3\u3068\u601d\u308f\u308c\u308b\u63a5\u7d9a\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp --tcp-flags ALL ALL -j DROP  \n# # \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m pkttype --pkt-type broadcast -j DROP\n# # \u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u7834\u68c4\u3059\u308b\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m pkttype --pkt-type multicast -j DROP \n# # IP Spoofing(\u306a\u308a\u3059\u307e\u3057) \u306e\u5bfe\u5fdc(\u5916\u90e8\u304b\u3089\u3084\u3063\u3066\u304f\u308b\u30ed\u30fc\u30ab\u30ebIP\u306f\u7834\u68c4)\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 127.0.0.1/8 -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 10.0.0.0/8 -j DROP #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 172.16.0.0/12 -j DROP\n# # firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 192.168.0.0/16 -j DROP  #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# # firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -i enp0s3 -s 192.168.0.0/24  -j DROP #\u958b\u767a\u74b0\u5883\u3067\u306f\u8a31\u53ef\n# # Ping of Death \u653b\u6483\u5bfe\u7b56\uff08firewall-cmd\u306b\u4fee\u6b63\u3059\u308b\u306e\u304c\u3081\u3093\u3069\u304f\u306a\u3063\u305f\u306e\u3067\u5272\u611b\u3002\u53c2\u8003\u30b5\u30a4\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n# # Ping\u306b\u4e0d\u8981\u306aicmp\u30bf\u30a4\u30d7\u306e\u30d6\u30ed\u30c3\u30af(echo-request\u3001echo-reply \u4ee5\u5916)\n# firewall-cmd --permanent --add-icmp-block=destination-unreachable\n# firewall-cmd --permanent --add-icmp-block=parameter-problem\n# firewall-cmd --permanent --add-icmp-block=redirect\n# firewall-cmd --permanent --add-icmp-block=router-advertisement\n# firewall-cmd --permanent --add-icmp-block=router-solicitation\n# firewall-cmd --permanent --add-icmp-block=source-quench\n# firewall-cmd --permanent --add-icmp-block=time-exceeded\n# # invalid \u30d1\u30b1\u30c3\u30c8\u3092\u7834\u68c4\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m state --state INVALID -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -m state --state INVALID -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter OUTPUT 0 -m state --state INVALID -j DROP\n```\n\n**\u6761\u4ef6\u4ed8\u304d\u3067\u8a31\u53ef** \n\n```\n# # Ping Flood\u653b\u6483\u5bfe\u7b56\uff084\u56de\u4ee5\u4e0aping\u3092\u53d7\u4fe1\u3057\u305f\u5834\u5408\u3001\u4ee5\u964d\u306f1\u79d2\u9593\u306b1\u5ea6\u3060\u3051\u8a31\u53ef\u3057\u307e\u3059\u3002\uff09\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p icmp --icmp-type 8 -m length --length :85 -m limit --limit 1/s --limit-burst 4 -j ACCEPT\n# # flooding of RST packets, smurf attack Rejection\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -p tcp -m tcp --tcp-flags RST RST -m limit --limit 2/second --limit-burst 2 -j ACCEPT\n\n# # Protecting portscans\n# # Attacking IP will be locked for 24 hours (3600 x 24 = 86400 Seconds)\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m recent --name portscan --rcheck --seconds 86400 -j DROP\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD 0 -m recent --name portscan --rcheck --seconds 86400 -j DROP\n\n# Remove attacking IP after 24 hours\n# firewall-cmd --permanent --direct --add-rule ipv4 filter INPUT 0 -m recent --name portscan --remove\n# firewall-cmd --permanent --direct --add-rule ipv4 filter FORWARD  0 -m recent --name portscan --remove\n```\n \n**\u8a31\u53ef** \n\n```\n# firewall-cmd --add-port=49152/tcp --permanent  # 49152\u756a\u306e\u901a\u4fe1\u8a31\u53ef(\u3053\u306e\u30b5\u30fc\u30d0\u306essh\u306e\u30dd\u30fc\u30c8\u756a\u53f7\uff09\n```\n\n**\u57fa\u672c\u52d5\u4f5c** \n\u4e0b\u8a18\u8a2d\u5b9a\u306fssh\u306e\u63a5\u7d9a\u304c\u78ba\u8a8d\u3055\u308c\u3066\u304b\u3089\u884c\u3046\u4e8b\u3002\uff08\u3067\u306a\u3044\u3068\u3001\u30bf\u30fc\u30df\u30ca\u30eb\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304f\u306a\u308b\u3002\uff09\n\n```\n# # \u30eb\u30fc\u30eb\u306b\u5f53\u3066\u306f\u307e\u3089\u306a\u3044\u53d7\u4fe1\u3092\u7834\u68c4(\u3053\u308c\u3067\u3001INPUT\u3001FORWARD\u4e21\u65b9\u306bDROP)\n# firewall-cmd --permanent --zone=public --set-target=DROP  \n```\n \n**\u8a2d\u5b9a\u53cd\u6620** \n\n```\n# firewall-cmd --reload\n```\n\n\n**\u30ed\u30b0\u306e\u8a2d\u5b9a**\n\u6c17\u529b\u304c\u5c3d\u304d\u305f\u306e\u3067\u305d\u306e\u5185\u3001\u4e0b\u8a18\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3057\u307e\u3059\n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* [iptables\u3067\u30ed\u30b0\u51fa\u529b\u8a2d\u5b9a](http://wokowa.net/blog/archives/63)\n*  [iptables\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u52d5\u7684\u306b\u4f5c\u6210](http://oxynotes.com/?p=6401)\n* [\u305d\u3053\u305d\u3053\u30bb\u30ad\u30e5\u30a2\u306alinux\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b](http://qiita.com/cocuh/items/e7c305ccffb6841d109c#3-passprompt\u3092\u5909\u3048\u308b)\n* * [How to protect from port scanning and smurf attack in Linux Server by iptables](http://sharadchhetri.com/2013/06/15/how-to-protect-from-port-scanning-and-smurf-attack-in-linux-server-by-iptables/)\n* [\u3055\u304f\u3089\u306e\u30b5\u30dd\u30fc\u30c8\u60c5\u5831\u3000iptables\u306e\u8a2d\u5b9a\u65b9\u6cd5](https://help.sakura.ad.jp/app/answers/detail/a_id/2423/~/iptables\u306e\u8a2d\u5b9a\u65b9\u6cd5)\n* [\u81ea\u5206\u4ed5\u69d8\u306ebox\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b](http://qiita.com/darwin/items/c473b7c54e61b2acb7e5)\n* [\u7acb\u3061\u4e0a\u3052\u76f4\u5f8c\u306eiptables\u3092\u8a2d\u5b9a\u3059\u308b\u3002](http://qiita.com/shimohiko/items/ec672655edb84578a82e)\n* [iptables\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5229\u7528\u3057\u3066\u52d5\u7684\u306b\u4f5c\u6210](http://oxynotes.com/?p=6401)\n\n\n\n## TCPWrapper(hosts.allow\u3001hosts.deny)\u306e\u8a2d\u5b9a\n\nsshd\u306e\u63a5\u7d9a\u306f\u8a31\u53ef\u3057\u3001\u305d\u306e\u4ed6\u306e\u63a5\u7d9a\u306f\u62d2\u5426\u3057\u307e\u3059 \nhosts.allow \u2192 hosts.deny \u306e\u9806\u306b\u51e6\u7406\u3057\u307e\u3059\n\n```/etc/hosts.allow\nsshd : ALL\n```\n\n```/etc/hosts.deny\n\nALL  : ALL\n```\n\n## sudo\u306e\u8a2d\u5b9a\nsudo \u3092\u4f7f\u3063\u3066\u30b7\u30a7\u30eb\u30ed\u30b0\u30a4\u30f3\u3055\u308c\u308b\u3068\u30ed\u30b0\u306b\u3082\u6b8b\u3089\u306a\u3044\u307e\u307e\u3001\u3000\u3000\n\u5168\u6a29\u9650\u3092\u6301\u3063\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3055\u308c\u308b\u3068\u3000\u5177\u5408\u304c\u60aa\u3044\u306e\u3067\u5b9f\u884c\u7981\u6b62\u306b\u3057\u307e\u3059\n\u3064\u3044\u3067\u306b\u4ed6\u306e\u8a2d\u5b9a\u3082\u3061\u3087\u3053\u3063\u3068\u3060\u3051\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n**shell \u30b3\u30de\u30f3\u30c9**  \n\n```bash:sudo\u306e\u7de8\u96c6\n# visudo\n```\n**\u8a18\u8ff0\u5185\u5bb9**  \n\n```\nDefaults    requiretty   # \u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u6301\u305f\u306a\u3044ssh\u306e\u63a5\u7d9a\u306f\u3055\u305b\u306a\u3044\n#Defaults:vagrant    !requiretty   #\u3000vagrant\u30e6\u30fc\u30b6\u3060\u3051\u8a31\u53ef\u3059\u308b\u5834\u5408\u306f\u3053\u306e\u884c\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u5916\u3059\u3002\n\nDefaults timestamp_timeout = 0  # sudo\u3059\u308b\u3068\u6bce\u56de\u5fc5\u305a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6c42\u3081\u308b\u3088\u3046\u306b\u3059\u308b\nDefaults rootpw                 # sudo\u3092\u5b9f\u884c\u3059\u308b\u969b\u306froot\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6c42\u3081\u308b\n# \u6700\u521d\u306b\u5b9f\u884c\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u3092\u3042\u308b\u7a0b\u5ea6\u5236\u9650\u3059\u308b\nCmnd_Alias ALLOWCMND = /usr/sbin/\n# sudo\u3067\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3055\u305b\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\uff08\u8d77\u52d5\u3057\u305f\u30b7\u30a7\u30eb\u5185\u3067\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u304c\u30ed\u30b0\u306b\u6b8b\u3089\u306a\u3044\u305f\u3081\u3002\uff09\nCmnd_Alias SHELLS = /bin/sh, /bin/csh, /bin/tcsh, /bin/bash, /usr/local/bin/bash\nCmnd_Alias SHELLS_NONINTERACTIVE = /bin/sh -c *, /bin/csh -c *, /bin/tcsh -c *, /bin/bash -c *\nCmnd_Alias SU = /bin/su, /usr/sbin/visudo\n# %wheel ALL=(ALL)       NOPASSWD: ALL, !SU, !SHELLS, SHELLS_NONINTERACTIVE\n%wheel ALL=(ALL)       ALLOWCMND, !SU, !SHELLS, SHELLS_NONINTERACTIVE\n```\n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* [\u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30ad\u30e5\u30a2\u306b\u3059\u308b\u305f\u3081\u306e\u5229\u7528\u5236\u9650\uff083\uff09](http://www.atmarkit.co.jp/ait/articles/0311/05/news001.html)\n* [sudo\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3](http://qiita.com/KurokoSin/items/e96475c475ab59b5244f)\n\n\n## \u30ab\u30fc\u30cd\u30eb\u8a2d\u5b9a\n\u8a2d\u5b9a\u59cb\u3081\u305f\u5f53\u521d\u306f\u3053\u3053\u307e\u3067\u624b\u3092\u51fa\u3059\u4e88\u5b9a\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\n\u8abf\u3079\u3066\u304f\u3046\u3061\u306b\u51fa\u3066\u304d\u3061\u3083\u3063\u305f\u306e\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002  \n\n```\n# SYN Cookies\u3092\u6709\u52b9\u306b\u3059\u308b\n# \u203bTCP SYN Flood\u653b\u6483\u5bfe\u7b56\nsed -i '/net.ipv4.tcp_syncookies/d' /etc/sysctl.conf\necho \"net.ipv4.tcp_syncookies=1\" >> /etc/sysctl.conf\n\n# \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\u5b9bping\u306b\u306f\u5fdc\u7b54\u3057\u306a\u3044\n# \u203bSmurf\u653b\u6483\u5bfe\u7b56\nsed -i \u2018/net.ipv4.icmp_echo_ignore_broadcasts/d\u2019 /etc/sysctl.conf\necho \u201cnet.ipv4.icmp_echo_ignore_broadcasts=1\u201d >> /etc/sysctl.conf\n\n# ICMP Redirect\u30d1\u30b1\u30c3\u30c8\u306f\u62d2\u5426\nsed -i '/net.ipv4.conf.*.accept_redirects/d' /etc/sysctl.conf\nsed -i '/net.ipv6.conf.*.accept_redirects/d' /etc/sysctl.conf\nfor dev in `ls /proc/sys/net/ipv4/conf/`\ndo\nsysctl -w net.ipv4.conf.$dev.accept_redirects=0 > /dev/null\necho \"net.ipv4.conf.$dev.accept_redirects=0\" >> /etc/sysctl.conf\ndone\nfor dev in `ls /proc/sys/net/ipv6/conf/`\ndo\nsysctl -w net.ipv6.conf.$dev.accept_redirects=0 > /dev/null\necho \"net.ipv6.conf.$dev.accept_redirects=0\" >> /etc/sysctl.conf\ndone\n\n# Source Routed\u30d1\u30b1\u30c3\u30c8\u306f\u62d2\u5426\nsed -i \u2018/net.ipv4.conf.*.accept_source_route/d\u2019 /etc/sysctl.conf\nfor dev in `ls /proc/sys/net/ipv4/conf/`\ndo\nsysctl -w net.ipv4.conf.$dev.accept_source_route=0 > /dev/null\necho \u201cnet.ipv4.conf.$dev.accept_source_route=0\u201d >> /etc/sysctl.conf\ndone\n\n```\n\n**\u8a2d\u5b9a\u53cd\u6620**\n\n```\n# sysctl -p\n```\n\n**\u78ba\u8a8d\u65b9\u6cd5**\nSYN Cookies\u3092\u6709\u52b9\u306b\u3059\u308b\n\n```\n# sysctl -a | grep net.ipv4.tcp_syncookies\nnet.ipv4.tcp_syncookies = 1\n```\n\n\u4e0a\u8a18\u306f\u30b5\u30a4\u30c8\u304b\u3089\u62fe\u3063\u3066\u304d\u305f\u5185\u5bb9\u305d\u306e\u307e\u307e\u3067\u3059\u304c\u3001\n\u8a2d\u5b9a\u5909\u66f4\u524d\u306b\u5fc5\u8981\u306a\u306e\u306f ICMP\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u30d1\u30b1\u30c3\u30c8\u306e\u62d2\u5426\u306e\u307f\u3067\u3057\u305f\u3002\n\u305d\u306e\u4ed6\u306f\u8a2d\u5b9a\u6e08\u307f\u3067\u3057\u305f\u3002  \n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* [RHEL 7 beta\u306b\u6311\u6226\u305d\u306e4(firewalld)](https://www.superweibu.com/archives/3817.html)\n* [Linux\u3067\u4f5c\u308b\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\uff3b\u30d1\u30b1\u30c3\u30c8\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u8a2d\u5b9a\u7de8\uff3d](http://www.atmarkit.co.jp/ait/articles/0112/18/news002_2.html)  \n\n\n## \u305d\u306e\u4ed6 \n\u3053\u3053\u304b\u3089\u4e00\u6c17\u306b ~~\u624b\u629c\u304d\u3001\u3001\u3001~~\u30b2\u30d5\u30f3\u30b2\u30d5\u30f3\n\n### \u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u66f4\u65b0\n\n```bash:\u30d1\u30c3\u30c1\u5f53\u3066\n$ yum update\n```\n\n### \u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u505c\u6b62\n```systemctl``` \u3067active\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u78ba\u8a8d\u3057\u3064\u3064\n\u4e0d\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u505c\u6b62\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u304c\u3001\u3061\u3087\u3063\u3068\u529b\u5c3d\u304d\u305f\u306e\u3067\u7701\u7565\n\u6c17\u529b\u304c\u51fa\u3066\u304d\u305f\u3089\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n### logwatch\u3092\u5165\u308c\u308b\n\u3068\u308a\u3042\u3048\u305a\u9632\u3052\u3066\u305f\u3089\u3044\u3044\u306e\u3068\u3001\n\u307e\u3060\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306e\u958b\u767a\u3088\u3046\u306b\u3057\u304b\u4f7f\u308f\u306a\u3044\u306e\u3067\u3001\u898b\u9001\u308a\u3057\u307e\u3059\u3002\n\u516c\u958b\u524d\u3050\u3089\u3044\u306b\u307e\u305f\u898b\u76f4\u3057\u307e\u3059\n\n### \u4f7f\u308f\u306a\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u30ed\u30b0\u30a4\u30f3\u4e0d\u53ef\u306b\u3059\u308b\n\u5272\u3068\u3069\u306e\u30e6\u30fc\u30b6\u3082/nologin\u306b\u306a\u3063\u3066\u305f\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u306f\u826f\u3055\u3052\u3002\n\n### umask\u3092027\nothers\u304b\u3089\u306f\u597d\u304d\u306b\u898b\u308c\u306a\u3044\u3088\u3046\u306b007\u3001027\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```\n# By default, we want umask to get set. This sets it for login shell\n# Current threshold for system reserved uid/gids is 200\n# You could check uidgid reservation validity in\n# /usr/share/doc/setup-*/uidgid file\n\n# Before\n# if [ $UID -gt 199 ] && [ \"`id -gn`\" = \"`id -un`\" ]; then\n#     umask 007\n# else\n#     umask 027\n# fi\n\n# After\nif [ $UID -gt 199 ] && [ \"`id -gn`\" = \"`id -un`\" ]; then\n    umask 007\nelse\n    umask 027\nfi\n```\n\n\u53c2\u8003\u30b5\u30a4\u30c8\uff1a\n* [\u305d\u3053\u305d\u3053\u30bb\u30ad\u30e5\u30a2\u306alinux\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u308b](http://qiita.com/cocuh/items/e7c305ccffb6841d109c#3-passprompt\u3092\u5909\u3048\u308b)\n  \n  \n  \n-----\n## \u7d42\u308f\u308a\u306b\n\n\u3053\u3053\u307e\u3067\u8aad\u3093\u3067\u9802\u304d\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\u6700\u5f8c\u306e\u65b9\u306f\u660e\u3089\u304b\u306b\u624b\u629c\u304d\u611f\u304c\u6f02\u3063\u3066\u3044\u307e\u3059\u304c\u3001\n\u307e\u305f\u6a5f\u4f1a\u3092\u898b\u3064\u3051\u3066\u898b\u76f4\u3057\u3066\u3044\u3053\u3046\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u4e16\u754c\u306f\u697d\u3057\u3044\u3067\u3059\u3088\u306d\u3002\n\u672c\u8a18\u4e8b\u3067\u306f\u3084\u3063\u3066\u308b\u4e8b\u3070\u304b\u308a\u66f8\u3044\u3066\u3044\u307e\u3059\u304c\u3001  \u8a2d\u5b9a\u306e\u5fc5\u8981\u6027\u304b\u3089\u6df1\u304f\u52c9\u5f37\u3057\u3066\u3044\u304f\u3068\u3001\n\u4eba\u3068\u4eba\u306e\u30ac\u30c1\u306e\u77e5\u6075\u6bd4\u3079\u306e\u6b74\u53f2\u304c\u51dd\u7e2e\u3055\u308c\u3066\u3044\u308b\u69d8\u304c\u898b\u3048\u3066\u304d\u305f\u308a\u3057\u307e\u3059\u3002 \n\u307e\u3055\u306b\u53e1\u667a\u306e\u7d50\u6676\u3002\n(\u4e0d\u8b39\u614e\u3067\u3059\u307f\u307e\u305b\u3093\uff09\n\n\u3053\u3053\u3067\u66f8\u3044\u305f\u8a2d\u5b9a\u3082\u6642\u9593\u304c\u7d4c\u3066\u3070\u3001\u305d\u308c\u3092\u7834\u308b\u653b\u6483\u65b9\u6cd5\u3068\u304b\u898b\u3064\u3051\u3089\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u3082\u5927\u3044\u306b\u3042\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066\u305d\u306e\u653b\u6483\u3092\u9632\u3050\u305f\u3081\u306e\u65b0\u3057\u3044\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002 \n\n\u3084\u308b\u3053\u3068\u304c\u5909\u308f\u308c\u3070\u3001\u8a2d\u5b9a\u3082\u5909\u308f\u308a\u307e\u3059\u3002\n\u3053\u306e\u8a2d\u5b9a\u3092\u9d5c\u5451\u307f\u306b\u8a2d\u5b9a\u3057\u306a\u3044\u3067\u3001\u3054\u81ea\u8eab\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066 \n\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u307e\u3059\u3088\u3046\u304a\u9858\u3044\u3057\u307e\u3059\u3002[^2]\n\n\u7686\u69d8\u306e\u4f55\u304b\u306e\u304a\u5f79\u306b\u7acb\u3066\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u307e\u305f\u3001\u30b5\u30fc\u30d0\u306e\u69cb\u7bc9\u53ca\u3073\u672c\u8a18\u4e8b\u3092\u66f8\u304f\u306b\u3042\u305f\u308a\u3001\u591a\u304f\u306e\u30b5\u30a4\u30c8\u304b\u3089\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u3001\u30b5\u30a4\u30c8\u7ba1\u7406\u8005\u69d8\u306b\u611f\u8b1d\u3044\u305f\u3057\u307e\u3059\u3002\n\n-----\n[^1]: CentOS7.2\u3000minimal\u306ffirewalld\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002[\u53c2\u8003\u30b5\u30a4\u30c8](https://teratail.com/questions/28908)  \n[^2]: \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u95a2\u4fc2\u4e0a\u30b3\u30d4\u30fc\uff06\u30da\u30fc\u30b9\u30c8\u3067\u306f\u9ad8\u3044\u78ba\u7387\u3067\u5931\u6557\u3059\u308b\u7b87\u6240\u304c\u672c\u8a18\u4e8b\u5185\u306b\u3082\u3042\u308a\u307e\u3059\u3002 ~~\u8868\u8a18\u306b\u60a9\u3093\u3060\u306e\u3067~~ \u3042\u3048\u3066\u3069\u3053\u304b\u306f\u66f8\u304d\u307e\u305b\u3093\u3002\n", "tags": ["centos7", "\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3"]}