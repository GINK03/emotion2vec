{"context": " More than 1 year has passed since last update.\u3053\u306e\u8a18\u4e8b\u306f F# Advent Calendar 2015 \u306e19\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002 18\u65e5\u76ee\u306f @CallMeKohei \u3055\u3093\u306e \u300c\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30de\u30ea\u30aa\u3092\u63cf\u3044\u3066\u307f\u305f\uff01\u300d\u3067\u3057\u305f\u3002\n\nThe Lazy.Force Awakens\n\u6700\u8fd1\u306a\u3093\u304b\u300cForce\u306e\u899a\u9192\u300d\u3068\u304b\u300cForce\u3092\u4f7f\u3048\u300d\u3068\u3044\u3046\u8a00\u8449\u3092\u805e\u304d\u307e\u3059\u3002\u305d\u3046\u3044\u3048\u3070F#\u306b\u3082Force\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u4eca\u65e5\u306fF#\u306eForce\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u307e\u3059\u3002\n\nLazy.Force()\nF#\u306f\u6b63\u683c\u8a55\u4fa1\u306e\u8a00\u8a9e\u3067\u3059\u304c\u3001\u305f\u307e\u306b\u306f\u9045\u5ef6\u8a55\u4fa1\u3092\u4f7f\u3044\u305f\u3044\u6642\u3082\u3042\u308a\u307e\u3059\u3002\u305d\u3093\u306a\u6642\u306f\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5f0f\u3092lazy (\u5f0f)\u3068\u3044\u3046\u98a8\u306blazy\u3067\u304f\u308b\u307f\u307e\u3059\u3002\nlazy\u3067\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u304c'a\u578b\u3092\u8fd4\u3059\u5834\u5408\u3001lazy\u5168\u4f53\u306e\u5f0f\u304c\u8fd4\u3059\u578b\u306fLazy<'a>\u578b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u306flazy\u306b\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u306f\u307e\u3060\u8a55\u4fa1\u3055\u308c\u307e\u305b\u3093\u3002\n\u305d\u3057\u3066Lazy<'a>\u578b\u306e\u5024\u304b\u3089\u5143\u306e'a\u578b\u306e\u5024\u3092\u53d6\u308a\u51fa\u3059\u969b\u306b\u521d\u3081\u3066lazy\u306b\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u6642\u3001\u5143\u306e\u5024\u3092\u53d6\u308a\u51fa\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\u304cForce()\u3067\u3059\u3002\n\u306a\u304a\u3001\u4e00\u5ea6\u65e2\u306b\u8a55\u4fa1\u3055\u308c\u305f\u5f0f\u306e\u5024\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u30012\u56de\u76ee\u4ee5\u964d\u306eForce()\u306e\u547c\u3073\u51fa\u3057\u306b\u306f\u5358\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5024\u3092\u8fd4\u3059\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002\nlet lazy1 = lazy (printfn \"hoge\"; 1)\n// val lazy1 : Lazy<int> = \u5024\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n// The Force Awakens\nlazy1.Force()\n// hoge\n// val it : int = 1\n\nlazy1.Force()\n// val it : int = 1\n\n1\u56de\u76ee\u306elazy1.Force()\u306e\u547c\u3073\u51fa\u3057\u6642\u306b\u521d\u3081\u3066lazy\u3067\u304f\u308b\u307e\u308c\u305f\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u3001\u526f\u4f5c\u7528\u306eprintfn \"hoge\"\u304c\u5b9f\u884c\u3055\u308c\u305f\u5f8c\u306b\u5f0f\u306e\u7d50\u679c\u306e1\u3092\u8fd4\u3057\u307e\u3059\u3002\n2\u56de\u76ee\u306elazy1.Force()\u306e\u547c\u3073\u51fa\u3057\u6642\u306f\u5358\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5f0f\u306e\u7d50\u679c1\u3092\u8fd4\u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u526f\u4f5c\u7528\u306eprintfn \"hoge\"\u306f\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u306a\u304a\u3001lazy\u306f\u95a2\u6570\u3067\u306f\u306a\u304f\u69cb\u6587\u306a\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u6e21\u3059\u3088\u3046\u306a\u66f8\u304d\u65b9\u306f\u3067\u304d\u307e\u305b\u3093\u3002\nlet lazy1 = (printfn \"hoge\"; 1) |> lazy\n\n\n\u5f0f\u306e\u95a2\u6570\u5316\u306b\u3088\u308b\u9045\u5ef6\u5b9f\u884c\u3068\u306e\u9055\u3044\n\u308f\u3056\u308f\u3056lazy\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u3001\u4f3c\u305f\u3088\u3046\u306a\u9045\u5ef6\u5b9f\u884c\u3092\u884c\u3046\u3053\u3068\u306f\u5b9f\u306f\u53ef\u80fd\u3067\u3059\u3002\u5358\u306b\u9045\u5ef6\u5b9f\u884c\u3055\u305b\u305f\u3044\u5f0f\u3092\u95a2\u6570\u5316\u3057\u3066\u3057\u307e\u3048\u3070\u3044\u3044\u3060\u3051\u3067\u3059\u3002\n\u305f\u3060lazy\u3092\u4f7f\u3063\u305f\u5834\u5408\u3068\u7570\u306a\u308b\u306e\u306f\u3001\u5f0f\u306e\u8a55\u4fa1\u7d50\u679c\u304c\u81ea\u52d5\u7684\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u305f\u3081\u6bce\u56de\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nlet func1 = fun () -> printfn \"fuga\"; 2\n// val func1 : unit -> int\n\nfunc1()\n// fuga\n// val it : int = 2\n\nfunc1()\n// fuga\n// val it : int = 2\n\n\u4ed6\u306e\u4f8b\u3068\u3057\u3066\u3001mutable\u306a\u5024\u3092\u53c2\u7167\u3059\u308b\u5f0f\u306b\u3064\u3044\u3066\u3001\u4e21\u8005\u306e\u9055\u3044\u3092\u898b\u3066\u307f\u307e\u3059\u3002\nlet mutable s = \"hoge\"\nlet lazy2 = lazy (s)\nlet func2 = fun () -> s\n\nlazy2.Force()\n// val it : string = \"hoge\"\nfunc2()\n// val it : string = \"hoge\"\n\ns <- \"fuga\"\nlazy2.Force()\n// val it : string = \"hoge\"\nfunc2()\n// val it : string = \"fuga\"\n\n\u526f\u4f5c\u7528\u304c\u306a\u3044\u5f0f\u306f\u6bce\u56de\u8a55\u4fa1\u3057\u3066\u3082\u5fc5\u305a\u540c\u3058\u5024\u3092\u8fd4\u3059\u306e\u3067\u30012\u56de\u76ee\u4ee5\u964d\u306f\u8a08\u7b97\u305b\u305a\u3068\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8fd4\u305b\u3070\u4e8b\u8db3\u308a\u308b\u306f\u305a\u3067\u3059\u3002\u5f93\u3063\u3066\u526f\u4f5c\u7528\u304c\u306a\u3044\u5f0f\u306e\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5834\u5408\u306flazy\u3092\u4f7f\u3048\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u9006\u306b\u526f\u4f5c\u7528\u304c\u3042\u308b\u5f0f\u306e\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5834\u5408\u306f\u5f0f\u306e\u95a2\u6570\u304b\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nLazy<'a> \u3068 unit -> 'a \u306e\u76f8\u4e92\u5909\u63db\nunit -> 'a\u306e\u95a2\u6570\u3092Lazy<'a>\u306b\u5909\u63db\u3057\u305f\u308a\u3001\u305d\u306e\u9006\u5909\u63db\u3092\u884c\u3046\u3053\u3068\u306f\u53ef\u80fd\u3067\u3057\u3087\u3046\u304b\uff1f\n\u307e\u305aunit -> 'a\u2192Lazy<'a>\u306e\u5909\u63db\u3067\u3059\u304c\u3001\u305d\u308c\u3092\u53ef\u80fd\u3068\u3059\u308b\u95a2\u6570Lazy.Create\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n// unit -> 'a \u3092 Lazy<'a> \u306b\u5909\u63db\u3059\u308b\u95a2\u6570\nlet lazy3 = func1 |> Lazy.Create\n// val lazy3 : Lazy<int> = \u5024\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\nlazy3.Force()\n// fuga\n// val it : int = 2\n\nlazy3.Force()\n// val it : int = 2\n\n\u5b9f\u306fLazy.Create\u3068\u540c\u3058\u3053\u3068\u304cLazy\u578b\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u547c\u3073\u51fa\u3057\u3067\u53ef\u80fd\u3067\u3059\u3002F# 4\u4ee5\u964d\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u95a2\u6570\u3068\u540c\u3058\u6271\u3044\u3068\u306a\u308a\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u6271\u3044\u3084\u3059\u304f\u306a\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u3082\u306f\u3084Lazy.Create\u3092\u4f7f\u3046\u610f\u5473\u306f\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n// System.Lazy\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u547c\u3073\u51fa\u3057\u3002F#4\u4ee5\u964d\u306f\u95a2\u6570\u306e\u3088\u3046\u306b\u6271\u3048\u308b\nlet lazy3' = func1 |> Lazy\n\n\u9006\u306bLazy<'a>\u2192unit -> 'a\u306e\u5909\u63db\u3067\u3059\u304c\u3001\u30b7\u30b0\u30cd\u30c1\u30e3\u4e0a\u306e\u5909\u63db\u3067\u3042\u308c\u3070Lazy.Force\u304c\u305d\u308c\u306b\u5f53\u305f\u308a\u307e\u3059\u3002\n\u3057\u304b\u3057\u95a2\u6570\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u306b\u5909\u63db\u3055\u308c\u305f\u5f8c\u3067\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u6a5f\u80fd\u306f\u6b8b\u3063\u305f\u307e\u307e\u306a\u306e\u3067\u3001\u7d50\u5c40\u5909\u63db\u5f8c\u306e\u95a2\u6570\u3092\u4f55\u5ea6\u547c\u3073\u51fa\u3057\u3066\u3082\u5f0f\u306e\u8a55\u4fa1\u306f\u521d\u56de\u3057\u304b\u3055\u308c\u307e\u305b\u3093\u3002\n// Lazy<'a> \u3092 unit -> 'a \u306b(\u30b7\u30b0\u30cd\u30c1\u30e3\u3060\u3051)\u5909\u63db\u3059\u308b\u65b9\u6cd5\nlet func3 = lazy1.Force\n// val func3 : (unit -> int)\n\nfunc3()\n// hoge\n// val it : int = 1\n\nfunc3()\n// val it : int = 1\n\n\nThe dark side of the Force\nForce\u3092\u4f7f\u3046\u3082\u306e\u306f\u6642\u3068\u3057\u3066\u300c\u4f8b\u5916\u300d\u3068\u3044\u3046\u6697\u9ed2\u9762\u306b\u5815\u3061\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\nlazy\u5185\u306e\u5f0f\u306e\u8a55\u4fa1\u4e2d\u306b\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\u7d50\u8ad6\u3068\u3057\u3066\u306f\u3001Force()\u5b9f\u884c\u6642\u306b\u666e\u901a\u306b\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u3053\u306e\u4f8b\u5916\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u30012\u56de\u76ee\u4ee5\u964d\u306e\u547c\u3073\u51fa\u3057\u6642\u306f\u5373\u5ea7\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n(\u305f\u3060\u3057\u4f8b\u5916\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u306f\u5f8c\u8ff0\u3059\u308bLazyThreadSafetyMode\u304cPublicationOnly\u4ee5\u5916\u306e\u5834\u5408\u3001\u304b\u3064\u3001Lazy\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u8a55\u4fa1\u7528\u306e\u95a2\u6570\u3092\u6e21\u3057\u305f\u5834\u5408\u306e\u307f\u3067\u3059\u3002lazy\u69cb\u6587\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u666e\u901a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3059)\n// lazy\u5185\u3067\u4f8b\u5916\u304c\u51fa\u305f\u5834\u5408\u306f\u4f8b\u5916\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3001\u8a55\u4fa1\u306e\u305f\u3073\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u308b\nlet mutable x = \"Jedi\"\nlet f() = if x = \"Jedi\" then 0 else failwithf \"oops! : %s\" x\nlet lazyDarkSide = f |> Lazy\n\nx <- \"Darth Vador\"\nlazyDarkSide.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n   \u5834\u6240 System.Lazy`1.LazyInitValue()\n   \u5834\u6240 <StartupCode$FSI_0234>.$FSI_0234.main@() \u5834\u6240 force.fsx:\u884c 69\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Jedi\"\nlazyDarkSide.Force()\n(*\n> System.Exception: oops! : Darth Vador\n   \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n--- \u76f4\u524d\u306b\u4f8b\u5916\u304c\u30b9\u30ed\u30fc\u3055\u308c\u305f\u5834\u6240\u304b\u3089\u306e\u30b9\u30bf\u30c3\u30af \u30c8\u30ec\u30fc\u30b9\u306e\u7d42\u308f\u308a ---\n   \u5834\u6240 System.Lazy`1.get_Value()\n   \u5834\u6240 <StartupCode$FSI_0236>.$FSI_0236.main@() \u5834\u6240 force.fsx:\u884c 80\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Anakin Skywalker\"\nlazyDarkSide.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n--- \u76f4\u524d\u306b\u4f8b\u5916\u304c\u30b9\u30ed\u30fc\u3055\u308c\u305f\u5834\u6240\u304b\u3089\u306e\u30b9\u30bf\u30c3\u30af \u30c8\u30ec\u30fc\u30b9\u306e\u7d42\u308f\u308a ---\n   \u5834\u6240 System.Lazy`1.get_Value()\n   \u5834\u6240 <StartupCode$FSI_0240>.$FSI_0240.main@() \u5834\u6240 force.fsx:\u884c 92\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\n\nThe Multi-thread of the Force\nlazy\u5185\u306e\u5f0f\u306e\u8a55\u4fa1\u6642\u306b\u306f\u30ed\u30c3\u30af\u3092\u53d6\u3063\u3066\u884c\u308f\u308c\u308b\u305f\u3081\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306b\u306a\u308a\u307e\u3059(lazy\u5185\u3067\u306e\u5f0f\u4e2d\u306b\u3066\u4f7f\u7528\u3055\u308c\u308b\u578b\u304c\u3059\u3079\u3066\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u3067\u3042\u308b\u524d\u63d0\u3067\u3059\u304c)\u3002\n\u305f\u3060\u3057\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5024\u3092\u53d6\u5f97\u3059\u308b\u3060\u3051\u306e\u5834\u5408\u3067\u3082\u30ed\u30c3\u30af\u3092\u53d6\u308b\u3053\u3068\u306b\u306a\u308b\u305f\u3081\u3001\u305d\u306e\u5206\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u5f71\u97ff\u3092\u53ca\u307c\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u30ed\u30c3\u30af\u304c\u767a\u751f\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u5f53\u7136\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u5371\u967a\u6027\u3082\u3042\u308a\u307e\u3059\u3002\nlazy\u69cb\u6587\u3092\u4f7f\u308f\u305a\u306bLazy<'a>\u578b\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30ed\u30c3\u30af\u3092\u53d6\u308b\u304b\u3069\u3046\u304b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u7528\nlet lazy4 = Lazy((fun () -> printfn \"piyo\"; 3), false)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u521d\u671f\u5316\u51e6\u7406\u306f\u540c\u6642\u306b\u884c\u308f\u308c\u308b\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306f1\u3064\u3060\u3051\u4f5c\u6210\u3055\u308c\u308b\nlet lazy5 = Lazy((fun () -> printfn \"foo\"; 4), System.Threading.LazyThreadSafetyMode.PublicationOnly)\n\n\u6307\u5b9a\u306e\u65b9\u6cd5\u306fbool\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u6e21\u3059\u65b9\u6cd5\u3068System.Threading.LazyThreadSafetyMode\u3092\u6e21\u3059\u65b9\u6cd5\u306e2\u7a2e\u985e\u304c\u3042\u308a\u307e\u3059\u3002\n\n\ntrue\u307e\u305f\u306fLazyThreadSafetyMode.ExecutionAndPublication\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u6700\u521d\u306b\u5b9f\u884c\u3059\u308b\u30b9\u30ec\u30c3\u30c9\u304c\u30ed\u30c3\u30af\u3092\u53d6\u3063\u3066\u5f0f\u306e\u8a55\u4fa1\u3068\u8a55\u4fa1\u7d50\u679c\u306e\u5024\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u884c\u3044\u307e\u3059\u30022\u56de\u76ee\u4ee5\u964d\u306e\u5b9f\u884c\u6642\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u306b\u30ed\u30c3\u30af\u3092\u53d6\u308a\u307e\u3059\u3002lazy\u69cb\u6587\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u3053\u308c\u306b\u306a\u308a\u307e\u3059\u3002\n\nfalse\u307e\u305f\u306fLazyThreadSafetyMode.None\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3067\u4f7f\u7528\u3055\u308c\u308b\u524d\u63d0\u3068\u306a\u308a\u3001\u30ed\u30c3\u30af\u3092\u53d6\u308a\u307e\u305b\u3093\u3002\u8907\u6570\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u4f7f\u7528\u3055\u308c\u305f\u5834\u5408\u306e\u52d5\u4f5c\u306f\u672a\u5b9a\u7fa9\u3067\u3059\u3002\n\nLazyThreadSafetyMode.PublicationOnly\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u540c\u6642\u306b\u5f0f\u306e\u8a55\u4fa1\u304c\u884c\u308f\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u306f\u6700\u521d\u306b\u5b9f\u884c\u3055\u308c\u305f\u30b9\u30ec\u30c3\u30c9\u3067\u306e\u7d50\u679c\u306e\u307f\u3067\u3001\u4ed6\u306e\u30b9\u30ec\u30c3\u30c9\u3067\u306e\u5b9f\u884c\u7d50\u679c\u306f\u6368\u3066\u3089\u308c\u307e\u3059\u3002\n\n\u901a\u5e38\u306flazy\u69cb\u6587\u3092\u4f7f\u3044\u3001\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u306e\u307f\u3067\u4f7f\u308f\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u3066\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u91cd\u8996\u306e\u5834\u5408\u306ffalse\u3092\u6e21\u3059\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u4f7f\u7528\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\nLazy\u578b\u306e\u305d\u306e\u4ed6\u306e\u64cd\u4f5c\nLazy<'a>\u578b\u306b\u306f\u4eca\u307e\u3067\u7d39\u4ecb\u3057\u305f\u4ee5\u5916\u306b\u3082\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3084\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4e00\u6c17\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\u3064\u3044\u3067\u306b\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306bLazyThreadSafetyMode.PublicationOnly\u3092\u6e21\u3057\u305f\u5834\u5408\u306b\u4f8b\u5916\u304c\u30ad\u30e3\u30b7\u30e5\u3055\u308c\u306a\u3044\u3053\u3068\u306e\u78ba\u8a8d\u3082\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u7528\nlet lazy4 = Lazy((fun () -> printfn \"piyo\"; 3), false)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u521d\u671f\u5316\u51e6\u7406\u306f\u540c\u6642\u306b\u884c\u308f\u308c\u308b\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306f1\u3064\u3060\u3051\u4f5c\u6210\u3055\u308c\u308b\nlet lazy5 = Lazy((fun () -> printfn \"foo\"; 4), System.Threading.LazyThreadSafetyMode.PublicationOnly)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u6307\u5b9a\u3057\u305f\u578b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u9045\u5ef6\u547c\u3073\u51fa\u3057\u3059\u308b\nlet lazyDefaultInt = Lazy<int>()\n\nlazy4.IsValueCreated\n// val it : bool = false\n\n// Force()\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082Value\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u8a55\u4fa1\u3067\u304d\u308b\nlazy4.Value\n// piyo\n// val it : int = 3\n\nlazy4.Value\n// val it : int = 3\n\nlazy4.IsValueCreated\n// val it : bool = true\n\n// Force()\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u8a55\u4fa1\u3067\u304d\u308b\nlazy5 |> fun (Lazy x) -> x\n// foo\n// val it : int = 4\n\nlet lazy6 = Lazy(f, System.Threading.LazyThreadSafetyMode.PublicationOnly)\n\nx <- \"Darth Vador\"\nlazy6.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n   \u5834\u6240 System.Lazy`1.LazyInitValue()\n   \u5834\u6240 <StartupCode$FSI_0243>.$FSI_0243.main@() \u5834\u6240 force.fsx:\u884c 126\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Jedi\"\nlazy6.Force()\n// val it : int = 0\n\n\u5b9f\u306fForce()\u4f7f\u308f\u306a\u304f\u3066\u3082Value\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3088\u304b\u3063\u305f\u3093\u3067\u3059\u306d\u3002Force\u3068\u306f\u3044\u3063\u305f\u3044\u2026\u2026\u3046\u3054\u3054\u3054\uff01\uff01\n\u3053\u306e\u8a18\u4e8b\u3067\u4f7f\u7528\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\u3053\u306e\u8a18\u4e8b\u306f [F# Advent Calendar 2015](http://connpass.com/event/22056/) \u306e19\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002 18\u65e5\u76ee\u306f @CallMeKohei \u3055\u3093\u306e \u300c[\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30de\u30ea\u30aa\u3092\u63cf\u3044\u3066\u307f\u305f\uff01](http://callmekohei.hatenablog.com/entry/2015/12/17/123955)\u300d\u3067\u3057\u305f\u3002\n\n# The Lazy.Force Awakens\n\n\u6700\u8fd1\u306a\u3093\u304b\u300cForce\u306e\u899a\u9192\u300d\u3068\u304b\u300cForce\u3092\u4f7f\u3048\u300d\u3068\u3044\u3046\u8a00\u8449\u3092\u805e\u304d\u307e\u3059\u3002\u305d\u3046\u3044\u3048\u3070F#\u306b\u3082Force\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u4eca\u65e5\u306fF#\u306eForce\u306b\u3064\u3044\u3066\u8abf\u3079\u3066\u307f\u307e\u3059\u3002\n\n## Lazy.Force()\n\nF#\u306f\u6b63\u683c\u8a55\u4fa1\u306e\u8a00\u8a9e\u3067\u3059\u304c\u3001\u305f\u307e\u306b\u306f\u9045\u5ef6\u8a55\u4fa1\u3092\u4f7f\u3044\u305f\u3044\u6642\u3082\u3042\u308a\u307e\u3059\u3002\u305d\u3093\u306a\u6642\u306f\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5f0f\u3092`lazy (\u5f0f)`\u3068\u3044\u3046\u98a8\u306blazy\u3067\u304f\u308b\u307f\u307e\u3059\u3002\n\n`lazy`\u3067\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u304c`'a`\u578b\u3092\u8fd4\u3059\u5834\u5408\u3001`lazy`\u5168\u4f53\u306e\u5f0f\u304c\u8fd4\u3059\u578b\u306f`Lazy<'a>`\u578b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u306f`lazy`\u306b\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u306f\u307e\u3060\u8a55\u4fa1\u3055\u308c\u307e\u305b\u3093\u3002\n\n\u305d\u3057\u3066`Lazy<'a>`\u578b\u306e\u5024\u304b\u3089\u5143\u306e`'a`\u578b\u306e\u5024\u3092\u53d6\u308a\u51fa\u3059\u969b\u306b\u521d\u3081\u3066`lazy`\u306b\u304f\u308b\u307e\u308c\u305f\u4e2d\u306e\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u6642\u3001\u5143\u306e\u5024\u3092\u53d6\u308a\u51fa\u3059\u305f\u3081\u306e\u30e1\u30bd\u30c3\u30c9\u304c`Force()`\u3067\u3059\u3002\n\n\u306a\u304a\u3001\u4e00\u5ea6\u65e2\u306b\u8a55\u4fa1\u3055\u308c\u305f\u5f0f\u306e\u5024\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u30012\u56de\u76ee\u4ee5\u964d\u306e`Force()`\u306e\u547c\u3073\u51fa\u3057\u306b\u306f\u5358\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5024\u3092\u8fd4\u3059\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002\n\n```fsharp\nlet lazy1 = lazy (printfn \"hoge\"; 1)\n// val lazy1 : Lazy<int> = \u5024\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n// The Force Awakens\nlazy1.Force()\n// hoge\n// val it : int = 1\n\nlazy1.Force()\n// val it : int = 1\n```\n\n1\u56de\u76ee\u306e`lazy1.Force()`\u306e\u547c\u3073\u51fa\u3057\u6642\u306b\u521d\u3081\u3066`lazy`\u3067\u304f\u308b\u307e\u308c\u305f\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u3001\u526f\u4f5c\u7528\u306e`printfn \"hoge\"`\u304c\u5b9f\u884c\u3055\u308c\u305f\u5f8c\u306b\u5f0f\u306e\u7d50\u679c\u306e`1`\u3092\u8fd4\u3057\u307e\u3059\u3002\n\n2\u56de\u76ee\u306e`lazy1.Force()`\u306e\u547c\u3073\u51fa\u3057\u6642\u306f\u5358\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5f0f\u306e\u7d50\u679c`1`\u3092\u8fd4\u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u526f\u4f5c\u7528\u306e`printfn \"hoge\"`\u306f\u5b9f\u884c\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u306a\u304a\u3001`lazy`\u306f\u95a2\u6570\u3067\u306f\u306a\u304f\u69cb\u6587\u306a\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u6e21\u3059\u3088\u3046\u306a\u66f8\u304d\u65b9\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n```fsharp\nlet lazy1 = (printfn \"hoge\"; 1) |> lazy\n```\n\n## \u5f0f\u306e\u95a2\u6570\u5316\u306b\u3088\u308b\u9045\u5ef6\u5b9f\u884c\u3068\u306e\u9055\u3044\n\n\u308f\u3056\u308f\u3056`lazy`\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u3001\u4f3c\u305f\u3088\u3046\u306a\u9045\u5ef6\u5b9f\u884c\u3092\u884c\u3046\u3053\u3068\u306f\u5b9f\u306f\u53ef\u80fd\u3067\u3059\u3002\u5358\u306b\u9045\u5ef6\u5b9f\u884c\u3055\u305b\u305f\u3044\u5f0f\u3092\u95a2\u6570\u5316\u3057\u3066\u3057\u307e\u3048\u3070\u3044\u3044\u3060\u3051\u3067\u3059\u3002\n\n\u305f\u3060`lazy`\u3092\u4f7f\u3063\u305f\u5834\u5408\u3068\u7570\u306a\u308b\u306e\u306f\u3001\u5f0f\u306e\u8a55\u4fa1\u7d50\u679c\u304c\u81ea\u52d5\u7684\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u305f\u3081\u6bce\u56de\u5f0f\u304c\u8a55\u4fa1\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n```fsharp\nlet func1 = fun () -> printfn \"fuga\"; 2\n// val func1 : unit -> int\n\nfunc1()\n// fuga\n// val it : int = 2\n\nfunc1()\n// fuga\n// val it : int = 2\n```\n\n\u4ed6\u306e\u4f8b\u3068\u3057\u3066\u3001mutable\u306a\u5024\u3092\u53c2\u7167\u3059\u308b\u5f0f\u306b\u3064\u3044\u3066\u3001\u4e21\u8005\u306e\u9055\u3044\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```fsharp\nlet mutable s = \"hoge\"\nlet lazy2 = lazy (s)\nlet func2 = fun () -> s\n\nlazy2.Force()\n// val it : string = \"hoge\"\nfunc2()\n// val it : string = \"hoge\"\n\ns <- \"fuga\"\nlazy2.Force()\n// val it : string = \"hoge\"\nfunc2()\n// val it : string = \"fuga\"\n```\n\n\u526f\u4f5c\u7528\u304c\u306a\u3044\u5f0f\u306f\u6bce\u56de\u8a55\u4fa1\u3057\u3066\u3082\u5fc5\u305a\u540c\u3058\u5024\u3092\u8fd4\u3059\u306e\u3067\u30012\u56de\u76ee\u4ee5\u964d\u306f\u8a08\u7b97\u305b\u305a\u3068\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8fd4\u305b\u3070\u4e8b\u8db3\u308a\u308b\u306f\u305a\u3067\u3059\u3002\u5f93\u3063\u3066\u526f\u4f5c\u7528\u304c\u306a\u3044\u5f0f\u306e\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5834\u5408\u306f`lazy`\u3092\u4f7f\u3048\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\u9006\u306b\u526f\u4f5c\u7528\u304c\u3042\u308b\u5f0f\u306e\u8a55\u4fa1\u3092\u9045\u5ef6\u3055\u305b\u305f\u3044\u5834\u5408\u306f\u5f0f\u306e\u95a2\u6570\u304b\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n## Lazy<'a> \u3068 unit -> 'a \u306e\u76f8\u4e92\u5909\u63db\n\n`unit -> 'a`\u306e\u95a2\u6570\u3092`Lazy<'a>`\u306b\u5909\u63db\u3057\u305f\u308a\u3001\u305d\u306e\u9006\u5909\u63db\u3092\u884c\u3046\u3053\u3068\u306f\u53ef\u80fd\u3067\u3057\u3087\u3046\u304b\uff1f\n\n\u307e\u305a`unit -> 'a`\u2192`Lazy<'a>`\u306e\u5909\u63db\u3067\u3059\u304c\u3001\u305d\u308c\u3092\u53ef\u80fd\u3068\u3059\u308b\u95a2\u6570`Lazy.Create`\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```fsharp\n// unit -> 'a \u3092 Lazy<'a> \u306b\u5909\u63db\u3059\u308b\u95a2\u6570\nlet lazy3 = func1 |> Lazy.Create\n// val lazy3 : Lazy<int> = \u5024\u306f\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\nlazy3.Force()\n// fuga\n// val it : int = 2\n\nlazy3.Force()\n// val it : int = 2\n```\n\n\u5b9f\u306f`Lazy.Create`\u3068\u540c\u3058\u3053\u3068\u304c`Lazy`\u578b\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u547c\u3073\u51fa\u3057\u3067\u53ef\u80fd\u3067\u3059\u3002F# 4\u4ee5\u964d\u306f\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u304c\u95a2\u6570\u3068\u540c\u3058\u6271\u3044\u3068\u306a\u308a\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u6271\u3044\u3084\u3059\u304f\u306a\u3063\u305f\u308a\u3057\u305f\u306e\u3067\u3001\u3082\u306f\u3084`Lazy.Create`\u3092\u4f7f\u3046\u610f\u5473\u306f\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```fsharp\n// System.Lazy\u30af\u30e9\u30b9\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u547c\u3073\u51fa\u3057\u3002F#4\u4ee5\u964d\u306f\u95a2\u6570\u306e\u3088\u3046\u306b\u6271\u3048\u308b\nlet lazy3' = func1 |> Lazy\n```\n\n\u9006\u306b`Lazy<'a>`\u2192`unit -> 'a`\u306e\u5909\u63db\u3067\u3059\u304c\u3001\u30b7\u30b0\u30cd\u30c1\u30e3\u4e0a\u306e\u5909\u63db\u3067\u3042\u308c\u3070`Lazy.Force`\u304c\u305d\u308c\u306b\u5f53\u305f\u308a\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u95a2\u6570\u306e\u30b7\u30b0\u30cd\u30c1\u30e3\u306b\u5909\u63db\u3055\u308c\u305f\u5f8c\u3067\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u6a5f\u80fd\u306f\u6b8b\u3063\u305f\u307e\u307e\u306a\u306e\u3067\u3001\u7d50\u5c40\u5909\u63db\u5f8c\u306e\u95a2\u6570\u3092\u4f55\u5ea6\u547c\u3073\u51fa\u3057\u3066\u3082\u5f0f\u306e\u8a55\u4fa1\u306f\u521d\u56de\u3057\u304b\u3055\u308c\u307e\u305b\u3093\u3002\n\n```fsharp\n// Lazy<'a> \u3092 unit -> 'a \u306b(\u30b7\u30b0\u30cd\u30c1\u30e3\u3060\u3051)\u5909\u63db\u3059\u308b\u65b9\u6cd5\nlet func3 = lazy1.Force\n// val func3 : (unit -> int)\n\nfunc3()\n// hoge\n// val it : int = 1\n\nfunc3()\n// val it : int = 1\n```\n\n## The dark side of the Force\n\nForce\u3092\u4f7f\u3046\u3082\u306e\u306f\u6642\u3068\u3057\u3066\u300c\u4f8b\u5916\u300d\u3068\u3044\u3046\u6697\u9ed2\u9762\u306b\u5815\u3061\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n`lazy`\u5185\u306e\u5f0f\u306e\u8a55\u4fa1\u4e2d\u306b\u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f\u3069\u3046\u306a\u308b\u306e\u3067\u3057\u3087\u3046\u304b\uff1f\n\n\u7d50\u8ad6\u3068\u3057\u3066\u306f\u3001`Force()`\u5b9f\u884c\u6642\u306b\u666e\u901a\u306b\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u3053\u306e\u4f8b\u5916\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u30012\u56de\u76ee\u4ee5\u964d\u306e\u547c\u3073\u51fa\u3057\u6642\u306f\u5373\u5ea7\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n\n(\u305f\u3060\u3057\u4f8b\u5916\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u306f\u5f8c\u8ff0\u3059\u308b`LazyThreadSafetyMode`\u304c`PublicationOnly`\u4ee5\u5916\u306e\u5834\u5408\u3001\u304b\u3064\u3001Lazy\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u8a55\u4fa1\u7528\u306e\u95a2\u6570\u3092\u6e21\u3057\u305f\u5834\u5408\u306e\u307f\u3067\u3059\u3002`lazy`\u69cb\u6587\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u666e\u901a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3059)\n\n```fsharp\n// lazy\u5185\u3067\u4f8b\u5916\u304c\u51fa\u305f\u5834\u5408\u306f\u4f8b\u5916\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3001\u8a55\u4fa1\u306e\u305f\u3073\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u4f8b\u5916\u304c\u6295\u3052\u3089\u308c\u308b\nlet mutable x = \"Jedi\"\nlet f() = if x = \"Jedi\" then 0 else failwithf \"oops! : %s\" x\nlet lazyDarkSide = f |> Lazy\n\nx <- \"Darth Vador\"\nlazyDarkSide.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n   \u5834\u6240 System.Lazy`1.LazyInitValue()\n   \u5834\u6240 <StartupCode$FSI_0234>.$FSI_0234.main@() \u5834\u6240 force.fsx:\u884c 69\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Jedi\"\nlazyDarkSide.Force()\n(*\n> System.Exception: oops! : Darth Vador\n   \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n--- \u76f4\u524d\u306b\u4f8b\u5916\u304c\u30b9\u30ed\u30fc\u3055\u308c\u305f\u5834\u6240\u304b\u3089\u306e\u30b9\u30bf\u30c3\u30af \u30c8\u30ec\u30fc\u30b9\u306e\u7d42\u308f\u308a ---\n   \u5834\u6240 System.Lazy`1.get_Value()\n   \u5834\u6240 <StartupCode$FSI_0236>.$FSI_0236.main@() \u5834\u6240 force.fsx:\u884c 80\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Anakin Skywalker\"\nlazyDarkSide.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n--- \u76f4\u524d\u306b\u4f8b\u5916\u304c\u30b9\u30ed\u30fc\u3055\u308c\u305f\u5834\u6240\u304b\u3089\u306e\u30b9\u30bf\u30c3\u30af \u30c8\u30ec\u30fc\u30b9\u306e\u7d42\u308f\u308a ---\n   \u5834\u6240 System.Lazy`1.get_Value()\n   \u5834\u6240 <StartupCode$FSI_0240>.$FSI_0240.main@() \u5834\u6240 force.fsx:\u884c 92\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n```\n\n## The Multi-thread of the Force\n\n`lazy`\u5185\u306e\u5f0f\u306e\u8a55\u4fa1\u6642\u306b\u306f\u30ed\u30c3\u30af\u3092\u53d6\u3063\u3066\u884c\u308f\u308c\u308b\u305f\u3081\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306b\u306a\u308a\u307e\u3059(`lazy`\u5185\u3067\u306e\u5f0f\u4e2d\u306b\u3066\u4f7f\u7528\u3055\u308c\u308b\u578b\u304c\u3059\u3079\u3066\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u3067\u3042\u308b\u524d\u63d0\u3067\u3059\u304c)\u3002\n\n\u305f\u3060\u3057\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u5024\u3092\u53d6\u5f97\u3059\u308b\u3060\u3051\u306e\u5834\u5408\u3067\u3082\u30ed\u30c3\u30af\u3092\u53d6\u308b\u3053\u3068\u306b\u306a\u308b\u305f\u3081\u3001\u305d\u306e\u5206\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u5f71\u97ff\u3092\u53ca\u307c\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u30ed\u30c3\u30af\u304c\u767a\u751f\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u306f\u5f53\u7136\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u5371\u967a\u6027\u3082\u3042\u308a\u307e\u3059\u3002\n\n`lazy`\u69cb\u6587\u3092\u4f7f\u308f\u305a\u306b`Lazy<'a>`\u578b\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30ed\u30c3\u30af\u3092\u53d6\u308b\u304b\u3069\u3046\u304b\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```fsharp\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u7528\nlet lazy4 = Lazy((fun () -> printfn \"piyo\"; 3), false)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u521d\u671f\u5316\u51e6\u7406\u306f\u540c\u6642\u306b\u884c\u308f\u308c\u308b\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306f1\u3064\u3060\u3051\u4f5c\u6210\u3055\u308c\u308b\nlet lazy5 = Lazy((fun () -> printfn \"foo\"; 4), System.Threading.LazyThreadSafetyMode.PublicationOnly)\n```\n\n\u6307\u5b9a\u306e\u65b9\u6cd5\u306f`bool`\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u6e21\u3059\u65b9\u6cd5\u3068`System.Threading.LazyThreadSafetyMode`\u3092\u6e21\u3059\u65b9\u6cd5\u306e2\u7a2e\u985e\u304c\u3042\u308a\u307e\u3059\u3002\n\n* `true`\u307e\u305f\u306f`LazyThreadSafetyMode.ExecutionAndPublication`\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u6700\u521d\u306b\u5b9f\u884c\u3059\u308b\u30b9\u30ec\u30c3\u30c9\u304c\u30ed\u30c3\u30af\u3092\u53d6\u3063\u3066\u5f0f\u306e\u8a55\u4fa1\u3068\u8a55\u4fa1\u7d50\u679c\u306e\u5024\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u884c\u3044\u307e\u3059\u30022\u56de\u76ee\u4ee5\u964d\u306e\u5b9f\u884c\u6642\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u8aad\u307f\u8fbc\u307f\u306e\u305f\u3081\u306b\u30ed\u30c3\u30af\u3092\u53d6\u308a\u307e\u3059\u3002`lazy`\u69cb\u6587\u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u306f\u3053\u308c\u306b\u306a\u308a\u307e\u3059\u3002\n* `false`\u307e\u305f\u306f`LazyThreadSafetyMode.None`\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3067\u4f7f\u7528\u3055\u308c\u308b\u524d\u63d0\u3068\u306a\u308a\u3001\u30ed\u30c3\u30af\u3092\u53d6\u308a\u307e\u305b\u3093\u3002\u8907\u6570\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u4f7f\u7528\u3055\u308c\u305f\u5834\u5408\u306e\u52d5\u4f5c\u306f\u672a\u5b9a\u7fa9\u3067\u3059\u3002\n* `LazyThreadSafetyMode.PublicationOnly`\u3092\u6e21\u3057\u305f\u5834\u5408\u3001\u540c\u6642\u306b\u5f0f\u306e\u8a55\u4fa1\u304c\u884c\u308f\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u306e\u306f\u6700\u521d\u306b\u5b9f\u884c\u3055\u308c\u305f\u30b9\u30ec\u30c3\u30c9\u3067\u306e\u7d50\u679c\u306e\u307f\u3067\u3001\u4ed6\u306e\u30b9\u30ec\u30c3\u30c9\u3067\u306e\u5b9f\u884c\u7d50\u679c\u306f\u6368\u3066\u3089\u308c\u307e\u3059\u3002\n\n\u901a\u5e38\u306f`lazy`\u69cb\u6587\u3092\u4f7f\u3044\u3001\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u306e\u307f\u3067\u4f7f\u308f\u308c\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u3066\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u91cd\u8996\u306e\u5834\u5408\u306f`false`\u3092\u6e21\u3059\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u4f7f\u7528\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\n## Lazy\u578b\u306e\u305d\u306e\u4ed6\u306e\u64cd\u4f5c\n\n`Lazy<'a>`\u578b\u306b\u306f\u4eca\u307e\u3067\u7d39\u4ecb\u3057\u305f\u4ee5\u5916\u306b\u3082\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3084\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u4e00\u6c17\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\u3064\u3044\u3067\u306b\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b`LazyThreadSafetyMode.PublicationOnly`\u3092\u6e21\u3057\u305f\u5834\u5408\u306b\u4f8b\u5916\u304c\u30ad\u30e3\u30b7\u30e5\u3055\u308c\u306a\u3044\u3053\u3068\u306e\u78ba\u8a8d\u3082\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```fsharp\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u7528\nlet lazy4 = Lazy((fun () -> printfn \"piyo\"; 3), false)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u521d\u671f\u5316\u51e6\u7406\u306f\u540c\u6642\u306b\u884c\u308f\u308c\u308b\u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u306f1\u3064\u3060\u3051\u4f5c\u6210\u3055\u308c\u308b\nlet lazy5 = Lazy((fun () -> printfn \"foo\"; 4), System.Threading.LazyThreadSafetyMode.PublicationOnly)\n// Lazy\u306e\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306e\u5225\u30d0\u30fc\u30b8\u30e7\u30f3\u3002\u6307\u5b9a\u3057\u305f\u578b\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u9045\u5ef6\u547c\u3073\u51fa\u3057\u3059\u308b\nlet lazyDefaultInt = Lazy<int>()\n\nlazy4.IsValueCreated\n// val it : bool = false\n\n// Force()\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082Value\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u8a55\u4fa1\u3067\u304d\u308b\nlazy4.Value\n// piyo\n// val it : int = 3\n\nlazy4.Value\n// val it : int = 3\n\nlazy4.IsValueCreated\n// val it : bool = true\n\n// Force()\u3092\u4f7f\u308f\u306a\u304f\u3066\u3082\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u8a55\u4fa1\u3067\u304d\u308b\nlazy5 |> fun (Lazy x) -> x\n// foo\n// val it : int = 4\n\nlet lazy6 = Lazy(f, System.Threading.LazyThreadSafetyMode.PublicationOnly)\n\nx <- \"Darth Vador\"\nlazy6.Force()\n(*\nSystem.Exception: oops! : Darth Vador\n>    \u5834\u6240 FSI_0233.f@65-11.Invoke(String message) \u5834\u6240 force.fsx:\u884c 65\n   \u5834\u6240 System.Lazy`1.CreateValue()\n   \u5834\u6240 System.Lazy`1.LazyInitValue()\n   \u5834\u6240 <StartupCode$FSI_0243>.$FSI_0243.main@() \u5834\u6240 force.fsx:\u884c 126\n\u30a8\u30e9\u30fc\u306e\u305f\u3081\u505c\u6b62\u3057\u307e\u3057\u305f\n*)\n\nx <- \"Jedi\"\nlazy6.Force()\n// val it : int = 0\n```\n\n\u5b9f\u306f`Force()`\u4f7f\u308f\u306a\u304f\u3066\u3082`Value`\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3088\u304b\u3063\u305f\u3093\u3067\u3059\u306d\u3002`Force`\u3068\u306f\u3044\u3063\u305f\u3044\u2026\u2026\u3046\u3054\u3054\u3054\uff01\uff01\n\n[\u3053\u306e\u8a18\u4e8b\u3067\u4f7f\u7528\u3057\u305f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9](https://gist.github.com/adacola/e6d5acfbde0b5d042047)\n", "tags": ["F#", "F#AdventCalendar"]}