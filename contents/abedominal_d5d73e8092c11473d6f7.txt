{"tags": ["VBA"], "context": " More than 1 year has passed since last update.Option Explicit\n\n\nDim header() As String\nDim i As Long\nDim row As Long\nDim col As Long\n\nSub getHeader()\n    i = 1\n    Do While Worksheets(\"Sheet1\").Cells(1, i).Value <> \"\"\n        ReDim Preserve header(i)\n        header(i) = Worksheets(\"Sheet1\").Cells(1, i).Value\n        i = i + 1\n    Loop\nEnd Sub\nSub showHeader()\n    Dim str As String: str = \"\"\n    For i = 1 To UBound(header)\n        str = str & header(i)\n    Next\n    MsgBox str\nEnd Sub\n\nSub create()\n    Dim writer As Object: Set writer = CreateObject(\"MSXML2.MXXMLWriter\")\n    Dim reader As Object: Set reader = CreateObject(\"MSXML2.SAXXMLReader\")\n    writer.indent = True\n    writer.standalone = True\n    writer.Encoding = \"shift_jis\" '\u7121\u8996\u3055\u308c\u308b\uff0cUTF16\u306b\u306a\u308b\n    Set reader.contentHandler = writer\n    Call reader.putProperty(\"http://xml.org/sax/properties/lexical-handler\", writer)\n    Dim xmlNode As Object\n    Dim xmlObj  As Object: Set xmlObj = CreateObject(\"MSXML2.DOMDocument\")\n    Dim xml2 As Object: Set xml2 = CreateObject(\"MSXML2.DOMDocument\")\n\n\n    xmlObj.async = False\n    xmlObj.setProperty \"SelectionLanguage\", \"XPath\"\n    xmlObj.appendChild xmlObj.createProcessingInstruction(\"xml\", \"version='1.0' encoding='UTF-8'\")\n    Dim node1 As Object\n    Dim node2 As Object\n    Dim node3 As Object\n    Dim xmlAttr As Object\n\n    Call getHeader\n    row = 2\n    With Worksheets(\"Sheet1\")\n        col = 1\n        Set main = xmlObj.appendChild(xmlObj.CreateElement(\"node1\"))\n        node1.Attributes.setNamedItem(xmlObj.createAttribute(header(col))).NodeValue = .Cells(row, col).Value\n\n            col = 2\n            node1.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n\n            col = 3\n            Set node2 = node1.appendChild(xmlObj.CreateElement(\"Sub\"))\n            node2.Attributes.setNamedItem(xmlObj.createAttribute(header(col))).NodeValue = .Cells(row, col).Value\n\n                col = 4\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                col = 5\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                col = 6\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n\n                Set node3 = node2.appendChild(xmlObj.CreateElement(\"node3\"))\n                    col = 7\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 8\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 9\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 10\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n\n\n    End With\n    reader.Parse xmlObj.XML\n    xml2.LoadXML (writer.output)\n    xml2.Save (ThisWorkbook.Path & \"\\result.xml\")\n    Set xmlNode = Nothing\n    Set xmlObj = Nothing\n    Set xmlAttr = Nothing\nEnd Sub\n\n\n\n```vbnet\nOption Explicit\n\n\nDim header() As String\nDim i As Long\nDim row As Long\nDim col As Long\n\nSub getHeader()\n    i = 1\n    Do While Worksheets(\"Sheet1\").Cells(1, i).Value <> \"\"\n        ReDim Preserve header(i)\n        header(i) = Worksheets(\"Sheet1\").Cells(1, i).Value\n        i = i + 1\n    Loop\nEnd Sub\nSub showHeader()\n    Dim str As String: str = \"\"\n    For i = 1 To UBound(header)\n        str = str & header(i)\n    Next\n    MsgBox str\nEnd Sub\n\nSub create()\n    Dim writer As Object: Set writer = CreateObject(\"MSXML2.MXXMLWriter\")\n    Dim reader As Object: Set reader = CreateObject(\"MSXML2.SAXXMLReader\")\n    writer.indent = True\n    writer.standalone = True\n    writer.Encoding = \"shift_jis\" '\u7121\u8996\u3055\u308c\u308b\uff0cUTF16\u306b\u306a\u308b\n    Set reader.contentHandler = writer\n    Call reader.putProperty(\"http://xml.org/sax/properties/lexical-handler\", writer)\n    Dim xmlNode As Object\n    Dim xmlObj  As Object: Set xmlObj = CreateObject(\"MSXML2.DOMDocument\")\n    Dim xml2 As Object: Set xml2 = CreateObject(\"MSXML2.DOMDocument\")\n    \n    \n    xmlObj.async = False\n    xmlObj.setProperty \"SelectionLanguage\", \"XPath\"\n    xmlObj.appendChild xmlObj.createProcessingInstruction(\"xml\", \"version='1.0' encoding='UTF-8'\")\n    Dim node1 As Object\n    Dim node2 As Object\n    Dim node3 As Object\n    Dim xmlAttr As Object\n    \n    Call getHeader\n    row = 2\n    With Worksheets(\"Sheet1\")\n        col = 1\n        Set main = xmlObj.appendChild(xmlObj.CreateElement(\"node1\"))\n        node1.Attributes.setNamedItem(xmlObj.createAttribute(header(col))).NodeValue = .Cells(row, col).Value\n        \n            col = 2\n            node1.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n            \n            col = 3\n            Set node2 = node1.appendChild(xmlObj.CreateElement(\"Sub\"))\n            node2.Attributes.setNamedItem(xmlObj.createAttribute(header(col))).NodeValue = .Cells(row, col).Value\n               \n                col = 4\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                col = 5\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                col = 6\n                node2.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                \n                Set node3 = node2.appendChild(xmlObj.CreateElement(\"node3\"))\n                    col = 7\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 8\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 9\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n                    col = 10\n                    node3.appendChild(xmlObj.CreateElement(header(col))).appendChild (xmlObj.createTextNode(.Cells(row, col).Value))\n        \n        \n    End With\n    reader.Parse xmlObj.XML\n    xml2.LoadXML (writer.output)\n    xml2.Save (ThisWorkbook.Path & \"\\result.xml\")\n    Set xmlNode = Nothing\n    Set xmlObj = Nothing\n    Set xmlAttr = Nothing\nEnd Sub\n\n\n```\n"}