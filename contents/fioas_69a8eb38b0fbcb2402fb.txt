{"context": " More than 1 year has passed since last update.\u5099\u5fd8\u9332\n\u30ed\u30fc\u30ab\u30eb\u3067\u5b9f\u884c\u3057\u3066\u3082\u3044\u3044\u3051\u308c\u3069\u3001\u6700\u7d42\u7684\u306bnginx\u3092\u30d5\u30ed\u30f3\u30c8\u306b\u7f6e\u304f\u69cb\u6210\u3092\u60f3\u5b9a\u3057\u3066\u3044\u305f\u306e\u3067Vagrant\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3002\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u69cb\u6210\u3092\u51fa\u6765\u308b\u9650\u308a\u518d\u73fe\u3059\u308b\u305f\u3081Docker\u7d4c\u7531\u306e\u69cb\u6210\u307e\u3067\u4f5c\u3063\u305f\u3002\nVagrant\u306e\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3067\u30ed\u30fc\u30ab\u30eb\u306esrc\u3092\u542b\u3080\u30d1\u30b9\u3092GOPATH\u3068\u3057\u3066\u53c2\u7167\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u7de8\u96c6\u301cDocker\u518d\u8d77\u52d5\u3067\u30d3\u30eb\u30c9\u3057\u3066\u5b9f\u884c\u304c\u53ef\u80fd\u3068\u3057\u3066\u3044\u308b\u3002\n\u30db\u30b9\u30c8OS\uff1aMacOS X El Capitan\nVagrant: CoreOS 976.0.0\n\nDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\n\u958b\u767a\u6642\u306f\u30d3\u30eb\u30c9\u304c\u3067\u304d\u308b\u3088\u3046\u306bgb\u3092\u5165\u308c\u308b\u3002\nFROM golang:1.6.0\n\nRUN go get github.com/constabulary/gb/...\nRUN mv /go/bin/gb /usr/local/go/bin\nRUN mv /go/bin/gb-vendor /usr/local/go/bin\n\nEXPOSE 9090\n\nCOPY entrypoint.sh /entrypoint.sh\n\nENTRYPOINT [\"/entrypoint.sh\"]\n\nentrypoint.sh\u306fsrc/\u304c\u3042\u308c\u3070\u30d3\u30eb\u30c9\u3057\u3066\u304b\u3089\u30a2\u30d7\u30ea(bin/app)\u3092\u5b9f\u884c\u3002\n#!/bin/bash\nset -e\n\ncd /go\nif [ -e src ]; then\n  gb build\nfi\nbin/app\n\nDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066docker push\u3059\u308b\u3002\n\ncloud-config\u3092\u4f5c\u6210\nNginx\u3068Go\u30a2\u30d7\u30ea\u3092\u5c0e\u5165\u3002-v\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u30db\u30b9\u30c8OS\u3068\u63a5\u7d9a\u3059\u308b\u3002Docker\u5074\u3067\u306f/go\u304cGOPATH\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n#cloud-config\n\n---\ncoreos:\n  units:\n  - name: docker-tcp.socket\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=Docker Socket for the API\n\n      [Socket]\n      ListenStream=2375\n      Service=docker.service\n      BindIPv6Only=both\n\n      [Install]\n      WantedBy=sockets.target\n  - name: nginx.service\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=Nginx\n      After=docker.service\n      Requires=docker.service\n\n      [Service]\n      TimeoutStartSec=15m\n      ExecStartPre=-/usr/bin/docker kill nginx\n      ExecStartPre=-/usr/bin/docker rm nginx\n      ExecStartPre=-/usr/bin/docker pull danday74/nginx-lua\n      ExecStart=/bin/bash -c \"\\\n        /usr/bin/docker run --name nginx \\\n        -p 80:80 \\\n        -v /nginx/conf:/nginx/conf:ro \\\n        -v /nginx/html:/nginx/html:ro \\\n        -v /nginx/log:/var/log/nginx \\\n        danday74/nginx-lua\"\n      ExecStop=/usr/bin/docker stop nginx\n\n      [Install]\n      WantedBy=multi-user.target\n  - name: app.service\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=App\n      After=docker.service\n      Requires=docker.service\n\n      [Service]\n      TimeoutStartSec=15m\n      ExecStartPre=-/usr/bin/docker kill app\n      ExecStartPre=-/usr/bin/docker rm app\n      ExecStartPre=-/usr/bin/docker pull sample/app:1.0\n      ExecStart=/bin/bash -c \"\\\n        /usr/bin/docker run --name app \\\n        -p 9090:9090 \\\n        -v /go:/go \\\n        sample/app:1.0\"\n      ExecStop=/usr/bin/docker stop app\n\n      [Install]\n      WantedBy=multi-user.target\n\n\nVagrantfile\u3092\u4f5c\u6210\ncoreos/coreos-vagrant\u3092\u4f7f\u7528\u3059\u308b\nDocker\u306e-v\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u3092Vagrant\u306e\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3067\u30ed\u30fc\u30ab\u30eb\u5074\u3068\u63a5\u7d9a\u3059\u308b\u3068\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3092Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3002\u4ee5\u4e0b\u3067\u306fapp/\u3092GOPATH\u3068\u3057\u3066\u3044\u308b\u3002\nROOT_PATH = File.dirname(__FILE__)\nLOG_PATH = File.join(ROOT_PATH, \"log\")\nNGINX_CONF = File.join(ROOT_PATH, \"config/nginx\")\nNGINX_ROOT = File.join(ROOT_PATH, \"html\")\nGOPATH = File.join(ROOT_PATH, \"app\")\n\n$shared_folders = {\n  \"#{LOG_PATH}\" => \"/nginx/log\",\n  \"#{NGINX_CONF}\" => \"/nginx/conf\",\n  \"#{NGINX_ROOT}\" => \"/nginx/html\",\n  \"#{GOPATH}\" => \"/go\"\n}\n\n\nVagrant\u3092\u8d77\u52d5\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n$ vagrant up\n$ vagrant ssh\n\n\nCoreOS\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n$ systemctl | grep app\napp.service                        loaded active running   App\n\n\n\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\n\u30ed\u30fc\u30ab\u30eb\u5074\u3067app/src\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u3001CoreOS\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\u3092\u884c\u3046\u3068Docker\u5185\u3067\u30d3\u30eb\u30c9\u3092\u5b9f\u65bd\u3059\u308b\n$ sudo systemctl restart app\n\n\n\u5099\u5fd8\u9332\n\n\u30ed\u30fc\u30ab\u30eb\u3067\u5b9f\u884c\u3057\u3066\u3082\u3044\u3044\u3051\u308c\u3069\u3001\u6700\u7d42\u7684\u306bnginx\u3092\u30d5\u30ed\u30f3\u30c8\u306b\u7f6e\u304f\u69cb\u6210\u3092\u60f3\u5b9a\u3057\u3066\u3044\u305f\u306e\u3067Vagrant\u3067\u74b0\u5883\u3092\u69cb\u7bc9\u3002\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u69cb\u6210\u3092\u51fa\u6765\u308b\u9650\u308a\u518d\u73fe\u3059\u308b\u305f\u3081Docker\u7d4c\u7531\u306e\u69cb\u6210\u307e\u3067\u4f5c\u3063\u305f\u3002\n\nVagrant\u306e\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3067\u30ed\u30fc\u30ab\u30eb\u306esrc\u3092\u542b\u3080\u30d1\u30b9\u3092GOPATH\u3068\u3057\u3066\u53c2\u7167\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u7de8\u96c6\u301cDocker\u518d\u8d77\u52d5\u3067\u30d3\u30eb\u30c9\u3057\u3066\u5b9f\u884c\u304c\u53ef\u80fd\u3068\u3057\u3066\u3044\u308b\u3002\n\n\u30db\u30b9\u30c8OS\uff1aMacOS X El Capitan\nVagrant: CoreOS 976.0.0\n\n## Docker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\n\n\u958b\u767a\u6642\u306f\u30d3\u30eb\u30c9\u304c\u3067\u304d\u308b\u3088\u3046\u306b[gb](https://getgb.io/)\u3092\u5165\u308c\u308b\u3002\n\n```docker\nFROM golang:1.6.0\n\nRUN go get github.com/constabulary/gb/...\nRUN mv /go/bin/gb /usr/local/go/bin\nRUN mv /go/bin/gb-vendor /usr/local/go/bin\n\nEXPOSE 9090\n\nCOPY entrypoint.sh /entrypoint.sh\n\nENTRYPOINT [\"/entrypoint.sh\"]\n```\n\nentrypoint.sh\u306fsrc/\u304c\u3042\u308c\u3070\u30d3\u30eb\u30c9\u3057\u3066\u304b\u3089\u30a2\u30d7\u30ea(bin/app)\u3092\u5b9f\u884c\u3002\n\n```bash\n#!/bin/bash\nset -e\n\ncd /go\nif [ -e src ]; then\n  gb build\nfi\nbin/app\n```\n\nDocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066docker push\u3059\u308b\u3002\n\n## cloud-config\u3092\u4f5c\u6210\n\nNginx\u3068Go\u30a2\u30d7\u30ea\u3092\u5c0e\u5165\u3002-v\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u30db\u30b9\u30c8OS\u3068\u63a5\u7d9a\u3059\u308b\u3002Docker\u5074\u3067\u306f/go\u304cGOPATH\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```bash\n#cloud-config\n\n---\ncoreos:\n  units:\n  - name: docker-tcp.socket\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=Docker Socket for the API\n\n      [Socket]\n      ListenStream=2375\n      Service=docker.service\n      BindIPv6Only=both\n\n      [Install]\n      WantedBy=sockets.target\n  - name: nginx.service\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=Nginx\n      After=docker.service\n      Requires=docker.service\n\n      [Service]\n      TimeoutStartSec=15m\n      ExecStartPre=-/usr/bin/docker kill nginx\n      ExecStartPre=-/usr/bin/docker rm nginx\n      ExecStartPre=-/usr/bin/docker pull danday74/nginx-lua\n      ExecStart=/bin/bash -c \"\\\n        /usr/bin/docker run --name nginx \\\n        -p 80:80 \\\n        -v /nginx/conf:/nginx/conf:ro \\\n        -v /nginx/html:/nginx/html:ro \\\n        -v /nginx/log:/var/log/nginx \\\n        danday74/nginx-lua\"\n      ExecStop=/usr/bin/docker stop nginx\n\n      [Install]\n      WantedBy=multi-user.target\n  - name: app.service\n    command: start\n    enable: true\n    content: |\n      [Unit]\n      Description=App\n      After=docker.service\n      Requires=docker.service\n\n      [Service]\n      TimeoutStartSec=15m\n      ExecStartPre=-/usr/bin/docker kill app\n      ExecStartPre=-/usr/bin/docker rm app\n      ExecStartPre=-/usr/bin/docker pull sample/app:1.0\n      ExecStart=/bin/bash -c \"\\\n        /usr/bin/docker run --name app \\\n        -p 9090:9090 \\\n        -v /go:/go \\\n        sample/app:1.0\"\n      ExecStop=/usr/bin/docker stop app\n\n      [Install]\n      WantedBy=multi-user.target\n```\n\n## Vagrantfile\u3092\u4f5c\u6210\n\n[coreos/coreos-vagrant](https://github.com/coreos/coreos-vagrant)\u3092\u4f7f\u7528\u3059\u308b\n\nDocker\u306e-v\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u3092Vagrant\u306e\u5171\u6709\u30d5\u30a9\u30eb\u30c0\u3067\u30ed\u30fc\u30ab\u30eb\u5074\u3068\u63a5\u7d9a\u3059\u308b\u3068\u3001\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3092Docker\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u63a5\u7d9a\u3067\u304d\u308b\u3002\u4ee5\u4e0b\u3067\u306fapp/\u3092GOPATH\u3068\u3057\u3066\u3044\u308b\u3002\n\n```bash\nROOT_PATH = File.dirname(__FILE__)\nLOG_PATH = File.join(ROOT_PATH, \"log\")\nNGINX_CONF = File.join(ROOT_PATH, \"config/nginx\")\nNGINX_ROOT = File.join(ROOT_PATH, \"html\")\nGOPATH = File.join(ROOT_PATH, \"app\")\n\n$shared_folders = {\n  \"#{LOG_PATH}\" => \"/nginx/log\",\n  \"#{NGINX_CONF}\" => \"/nginx/conf\",\n  \"#{NGINX_ROOT}\" => \"/nginx/html\",\n  \"#{GOPATH}\" => \"/go\"\n}\n```\n\n## Vagrant\u3092\u8d77\u52d5\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\n\n```bash\n$ vagrant up\n$ vagrant ssh\n```\n\n### CoreOS\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n```bash\n$ systemctl | grep app\napp.service                        loaded active running   App\n```\n\n### \u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\n\n\u30ed\u30fc\u30ab\u30eb\u5074\u3067app/src\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u3001CoreOS\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u306e\u518d\u8d77\u52d5\u3092\u884c\u3046\u3068Docker\u5185\u3067\u30d3\u30eb\u30c9\u3092\u5b9f\u65bd\u3059\u308b\n\n```bash\n$ sudo systemctl restart app\n```\n\n\n\n", "tags": ["golang", "CoreOS", "vagrant", "docker"]}