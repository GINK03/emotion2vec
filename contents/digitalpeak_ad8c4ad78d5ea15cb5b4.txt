{"context": "\n\n\u76ee\u7684\nterraform\u3092\u4f7f\u7528\u3057\u3001\u540c\u3058\u69cb\u6210\u306e\u74b0\u5883\u3092\u4f5c\u6210\u3059\u308b\n\n\u69cb\u6210\u56f3\n\n\n\u65b9\u6cd5\n\u74b0\u5883\u6bce\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u7de8\u96c6\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u6a5f\u80fd\u6bce\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n\u8a2d\u5b9a\n\nTemplates\n\nconfig.tf\n\n///config\n\nprovider \"aws\" {\n    access_key = \"${var.access_key}\"\n    secret_key = \"${var.secret_key}\"\n    region = \"${var.region}\"\n}\n\n\neip.tf\n\n/// eip allocate\nresource \"aws_eip\" \"natgw\" {\n    vpc = true\n}\n\n\nigw.tf\n\nresource \"aws_internet_gateway\" \"practice2-igw\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    tags {\n      Name = \"practice2-igw\"\n    }\n}\n\n\ninstance.tf\n\n/// bastion-server\u4f5c\u6210\n\nresource \"aws_instance\" \"bastion\" {\n    ami = \"ami-0c11b26d\"\n    instance_type = \"t2.nano\"\n    key_name = \"xxxxxx\"\n    security_groups = [\"${aws_security_group.ssh-limited.id}\"]\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n    tags {\n        Name = \"bastion\"\n    }\n}\n\n\nnat-gw.tf\n\nresource \"aws_nat_gateway\" \"practice2-natgw\" {\n    allocation_id = \"${aws_eip.natgw.id}\"\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n}\n\n\noutput.tf\n\n/// instance\u3068NatGateway\u306b\u4f7f\u308f\u308c\u308bGIP\u3092output\u3055\u305b\u308b\noutput \"eip.natgw.id\" {\n  value = \"${aws_eip.natgw.id}\"\n}\n\noutput \"public ip of bastion\" {\n  value = \"${aws_instance.bastion.public_ip}\"\n}\n\n\nroutetable.tf\n\n/// dmz-1a routetable\nresource \"aws_route_table\" \"practice2-dmz-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        gateway_id = \"${aws_internet_gateway.practice2-igw.id}\"\n    }\n    tags {\n      Name = \"practice2-dmz-1a\"\n    }\n}\n\n/// dmz-1c routetable\nresource \"aws_route_table\" \"practice2-dmz-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        gateway_id = \"${aws_internet_gateway.practice2-igw.id}\"\n    }\n    tags {\n      Name = \"practice2-dmz-1c\"\n    }\n}\n\n/// trust-1a routetable\nresource \"aws_route_table\" \"practice2-trust-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        nat_gateway_id = \"${aws_nat_gateway.practice2-natgw.id}\"\n    }\n    tags {\n      Name = \"practice2-trust-1a\"\n    }\n}\n\n/// trust-1c routetable\nresource \"aws_route_table\" \"practice2-trust-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        nat_gateway_id = \"${aws_nat_gateway.practice2-natgw.id}\"\n    }\n    tags {\n      Name = \"practice2-trust-1c\"\n    }\n}\n\n/// practice2-dmz-1a\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-dmz-1a\" {\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n    route_table_id = \"${aws_route_table.practice2-dmz-1a.id}\"\n}\n\n/// practice2-dmz-1c\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-dmz-1c\" {\n    subnet_id = \"${aws_subnet.practice2-dmz-1c.id}\"\n    route_table_id = \"${aws_route_table.practice2-dmz-1c.id}\"\n}\n\n/// practice2-trust-1a\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-trust-1a\" {\n    subnet_id = \"${aws_subnet.practice2-trust-1a.id}\"\n    route_table_id = \"${aws_route_table.practice2-trust-1a.id}\"\n}\n\n/// practice2-trust-1c\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-trust-1c\" {\n    subnet_id = \"${aws_subnet.practice2-trust-1c.id}\"\n    route_table_id = \"${aws_route_table.practice2-trust-1c.id}\"\n}\n\n\nsecurity-g.tf\n\nresource \"aws_security_group\" \"ssh-limited\" {\n  vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n  name = \"ssh-limited\"\n  description = \"ssh_limited inbound traffic\"\n\n  ingress {\n      from_port = 22\n      to_port = 22\n      protocol = \"tcp\"\n      cidr_blocks = [\"***.***.***.***/32\"]\n  }\n  egress {\n      from_port = 0\n      to_port = 0\n      protocol = \"-1\"\n      cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  tags {\n    Name = \"ssh-limited\"\n  }\n}\n\n\nsubnet.tf\n\n/// dmz-1a subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-dmz-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.0.0/24\"\n    map_public_ip_on_launch = \"true\" # dmz\u3067\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fPublicIP\u3092\u6301\u305f\u3059\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n      Name = \"practice2-dmz-1a\"\n    }\n}\n\n/// dmz-1c subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-dmz-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.1.0/24\"\n    map_public_ip_on_launch = \"true\" # dmz\u3067\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fPublicIP\u3092\u6301\u305f\u3059\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n      Name = \"practice2-dmz-1c\"\n    }\n}\n\n/// trust-1a subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-trust-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.2.0/24\"\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n      Name = \"practice2-trust-1a\"\n    }\n}\n\n/// trust-1c subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-trust-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.3.0/24\"\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n      Name = \"practice2-trust-1c\"\n    }\n}\n\n\nterraform.tfvars\n\n///iam-user-key\n\naccess_key = \"********\"\nsecret_key = \"***************\"\n\n\nvariables.tf\n\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n    default = \"ap-northeast-1\"\n}\n\n\nvpc.tf\n\nresource \"aws_vpc\" \"practice2-vpc\" {\n    cidr_block = \"10.0.0.0/16\"\n    instance_tenancy = \"default\"\n    enable_dns_support = \"true\"\n    enable_dns_hostnames = \"true\" #\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cdns-name\u3092\u6301\u3064\u3088\u3046\u306b\u3059\u308b\n    tags {\n      Name = \"practice2-vpc\"\n    }\n}\n\n\nDryRun\n\n\u30a8\u30e9\u30fc\u304c\u7121\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n$ terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_eip.natgw\n    allocation_id:     \"<computed>\"\n    association_id:    \"<computed>\"\n    domain:            \"<computed>\"\n    instance:          \"<computed>\"\n    network_interface: \"<computed>\"\n    private_ip:        \"<computed>\"\n    public_ip:         \"<computed>\"\n    vpc:               \"true\"\n\n+ aws_instance.stg-bastion\n    ami:                         \"ami-0c11b26d\"\n    associate_public_ip_address: \"<computed>\"\n    availability_zone:           \"<computed>\"\n    ebs_block_device.#:          \"<computed>\"\n    ephemeral_block_device.#:    \"<computed>\"\n    instance_state:              \"<computed>\"\n    instance_type:               \"t2.nano\"\n    key_name:                    \"**********\"\n    network_interface_id:        \"<computed>\"\n    placement_group:             \"<computed>\"\n    private_dns:                 \"<computed>\"\n    private_ip:                  \"<computed>\"\n    public_dns:                  \"<computed>\"\n    public_ip:                   \"<computed>\"\n    root_block_device.#:         \"<computed>\"\n    security_groups.#:           \"<computed>\"\n    source_dest_check:           \"true\"\n    subnet_id:                   \"<computed>\"\n    tags.%:                      \"1\"\n    tags.Name:                   \"bastion\"\n    tenancy:                     \"<computed>\"\n    vpc_security_group_ids.#:    \"<computed>\"\n\n+ aws_internet_gateway.practice2-igw\n    tags.%:    \"1\"\n    tags.Name: \"practice2-igw\"\n    vpc_id:    \"<computed>\"\n\n+ aws_nat_gateway.practice2-natgw\n    allocation_id:        \"<computed>\"\n    network_interface_id: \"<computed>\"\n    private_ip:           \"<computed>\"\n    public_ip:            \"<computed>\"\n    subnet_id:            \"<computed>\"\n\n+ aws_route_table.practice2-dmz-1a\n    route.#:                                     \"1\"\n    route.~2406728767.cidr_block:                \"0.0.0.0/0\"\n    route.~2406728767.gateway_id:                \"<computed>\"\n    route.~2406728767.instance_id:               \"\"\n    route.~2406728767.nat_gateway_id:            \"\"\n    route.~2406728767.network_interface_id:      \"\"\n    route.~2406728767.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-dmz-1a\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-dmz-1c\n    route.#:                                     \"1\"\n    route.~2406728767.cidr_block:                \"0.0.0.0/0\"\n    route.~2406728767.gateway_id:                \"<computed>\"\n    route.~2406728767.instance_id:               \"\"\n    route.~2406728767.nat_gateway_id:            \"\"\n    route.~2406728767.network_interface_id:      \"\"\n    route.~2406728767.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-dmz-1c\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-trust-1a\n    route.#:                                     \"1\"\n    route.~2120687611.cidr_block:                \"0.0.0.0/0\"\n    route.~2120687611.gateway_id:                \"\"\n    route.~2120687611.instance_id:               \"\"\n    route.~2120687611.nat_gateway_id:            \"<computed>\"\n    route.~2120687611.network_interface_id:      \"\"\n    route.~2120687611.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-trust-1a\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-trust-1c\n    route.#:                                     \"1\"\n    route.~2120687611.cidr_block:                \"0.0.0.0/0\"\n    route.~2120687611.gateway_id:                \"\"\n    route.~2120687611.instance_id:               \"\"\n    route.~2120687611.nat_gateway_id:            \"<computed>\"\n    route.~2120687611.network_interface_id:      \"\"\n    route.~2120687611.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-trust-1c\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table_association.practice2-dmz-1a\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-dmz-1c\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-trust-1a\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-trust-1c\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_security_group.ssh-limited\n    description:                          \"ssh_limited inbound traffic\"\n    egress.#:                             \"1\"\n    egress.482069346.cidr_blocks.#:       \"1\"\n    egress.482069346.cidr_blocks.0:       \"0.0.0.0/0\"\n    egress.482069346.from_port:           \"0\"\n    egress.482069346.prefix_list_ids.#:   \"0\"\n    egress.482069346.protocol:            \"-1\"\n    egress.482069346.security_groups.#:   \"0\"\n    egress.482069346.self:                \"false\"\n    egress.482069346.to_port:             \"0\"\n    ingress.#:                            \"1\"\n    ingress.3925595496.cidr_blocks.#:     \"1\"\n    ingress.3925595496.cidr_blocks.0:     \"***.***.***.***./32\"\n    ingress.3925595496.from_port:         \"22\"\n    ingress.3925595496.protocol:          \"tcp\"\n    ingress.3925595496.security_groups.#: \"0\"\n    ingress.3925595496.self:              \"false\"\n    ingress.3925595496.to_port:           \"22\"\n    name:                                 \"ssh-limited\"\n    owner_id:                             \"<computed>\"\n    tags.%:                               \"1\"\n    tags.Name:                            \"ssh-limited\"\n    vpc_id:                               \"<computed>\"\n\n+ aws_subnet.practice2-dmz-1a\n    availability_zone:       \"ap-northeast-1a\"\n    cidr_block:              \"10.0.0.0/24\"\n    map_public_ip_on_launch: \"true\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-dmz-1a\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-dmz-1c\n    availability_zone:       \"ap-northeast-1c\"\n    cidr_block:              \"10.0.1.0/24\"\n    map_public_ip_on_launch: \"true\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-dmz-1c\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-trust-1a\n    availability_zone:       \"ap-northeast-1a\"\n    cidr_block:              \"10.0.2.0/24\"\n    map_public_ip_on_launch: \"false\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-trust-1a\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-trust-1c\n    availability_zone:       \"ap-northeast-1c\"\n    cidr_block:              \"10.0.3.0/24\"\n    map_public_ip_on_launch: \"false\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-trust-1c\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_vpc.practice2-vpc\n    cidr_block:                \"10.0.0.0/16\"\n    default_network_acl_id:    \"<computed>\"\n    default_route_table_id:    \"<computed>\"\n    default_security_group_id: \"<computed>\"\n    dhcp_options_id:           \"<computed>\"\n    enable_classiclink:        \"<computed>\"\n    enable_dns_hostnames:      \"true\"\n    enable_dns_support:        \"true\"\n    instance_tenancy:          \"default\"\n    main_route_table_id:       \"<computed>\"\n    tags.%:                    \"1\"\n    tags.Name:                 \"practice2-vpc\"\n\n\nPlan: 18 to add, 0 to change, 0 to destroy.\n\n\n\u5b9f\u884c\n$ terraform apply\naws_eip.natgw: Creating...\n  allocation_id:     \"\" => \"<computed>\"\n  association_id:    \"\" => \"<computed>\"\n  domain:            \"\" => \"<computed>\"\n  instance:          \"\" => \"<computed>\"\n  network_interface: \"\" => \"<computed>\"\n  private_ip:        \"\" => \"<computed>\"\n  public_ip:         \"\" => \"<computed>\"\n  vpc:               \"\" => \"true\"\naws_vpc.practice2-vpc: Creating...\n  cidr_block:                \"\" => \"10.0.0.0/16\"\n  default_network_acl_id:    \"\" => \"<computed>\"\n  default_route_table_id:    \"\" => \"<computed>\"\n  default_security_group_id: \"\" => \"<computed>\"\n  dhcp_options_id:           \"\" => \"<computed>\"\n  enable_classiclink:        \"\" => \"<computed>\"\n  enable_dns_hostnames:      \"\" => \"true\"\n  enable_dns_support:        \"\" => \"true\"\n  instance_tenancy:          \"\" => \"default\"\n  main_route_table_id:       \"\" => \"<computed>\"\n  tags.%:                    \"\" => \"1\"\n  tags.Name:                 \"\" => \"practice2-vpc\"\naws_eip.natgw: Creation complete\naws_vpc.practice2-vpc: Creation complete\naws_internet_gateway.practice2-igw: Creating...\n  tags.%:    \"0\" => \"1\"\n  tags.Name: \"\" => \"practice2-igw\"\n  vpc_id:    \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1a: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1a\"\n  cidr_block:              \"\" => \"10.0.2.0/24\"\n  map_public_ip_on_launch: \"\" => \"false\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-trust-1a\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-dmz-1c: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1c\"\n  cidr_block:              \"\" => \"10.0.1.0/24\"\n  map_public_ip_on_launch: \"\" => \"true\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-dmz-1c\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1c: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1c\"\n  cidr_block:              \"\" => \"10.0.3.0/24\"\n  map_public_ip_on_launch: \"\" => \"false\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-trust-1c\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-dmz-1a: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1a\"\n  cidr_block:              \"\" => \"10.0.0.0/24\"\n  map_public_ip_on_launch: \"\" => \"true\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-dmz-1a\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_security_group.ssh-limited: Creating...\n  description:                          \"\" => \"ssh_limited inbound traffic\"\n  egress.#:                             \"\" => \"1\"\n  egress.482069346.cidr_blocks.#:       \"\" => \"1\"\n  egress.482069346.cidr_blocks.0:       \"\" => \"0.0.0.0/0\"\n  egress.482069346.from_port:           \"\" => \"0\"\n  egress.482069346.prefix_list_ids.#:   \"\" => \"0\"\n  egress.482069346.protocol:            \"\" => \"-1\"\n  egress.482069346.security_groups.#:   \"\" => \"0\"\n  egress.482069346.self:                \"\" => \"false\"\n  egress.482069346.to_port:             \"\" => \"0\"\n  ingress.#:                            \"\" => \"1\"\n  ingress.3925595496.cidr_blocks.#:     \"\" => \"1\"\n  ingress.3925595496.cidr_blocks.0:     \"\" => \"***.***.***.***/32\"\n  ingress.3925595496.from_port:         \"\" => \"22\"\n  ingress.3925595496.protocol:          \"\" => \"tcp\"\n  ingress.3925595496.security_groups.#: \"\" => \"0\"\n  ingress.3925595496.self:              \"\" => \"false\"\n  ingress.3925595496.to_port:           \"\" => \"22\"\n  name:                                 \"\" => \"ssh-limited\"\n  owner_id:                             \"\" => \"<computed>\"\n  tags.%:                               \"\" => \"1\"\n  tags.Name:                            \"\" => \"ssh-limited\"\n  vpc_id:                               \"\" => \"vpc-7e905e1a\"\naws_internet_gateway.practice2-igw: Creation complete\naws_route_table.practice2-dmz-1c: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.4294384048.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.4294384048.gateway_id:                \"\" => \"igw-0ecf986b\"\n  route.4294384048.instance_id:               \"\" => \"\"\n  route.4294384048.nat_gateway_id:            \"\" => \"\"\n  route.4294384048.network_interface_id:      \"\" => \"\"\n  route.4294384048.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-dmz-1c\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-dmz-1a: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.4294384048.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.4294384048.gateway_id:                \"\" => \"igw-0ecf986b\"\n  route.4294384048.instance_id:               \"\" => \"\"\n  route.4294384048.nat_gateway_id:            \"\" => \"\"\n  route.4294384048.network_interface_id:      \"\" => \"\"\n  route.4294384048.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-dmz-1a\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1a: Creation complete\naws_subnet.practice2-dmz-1a: Creation complete\naws_nat_gateway.practice2-natgw: Creating...\n  allocation_id:        \"\" => \"eipalloc-2898ae4d\"\n  network_interface_id: \"\" => \"<computed>\"\n  private_ip:           \"\" => \"<computed>\"\n  public_ip:            \"\" => \"<computed>\"\n  subnet_id:            \"\" => \"subnet-20c24b56\"\naws_subnet.practice2-trust-1c: Creation complete\naws_subnet.practice2-dmz-1c: Creation complete\naws_route_table.practice2-dmz-1c: Creation complete\naws_route_table_association.practice2-dmz-1c: Creating...\n  route_table_id: \"\" => \"rtb-04c74b60\"\n  subnet_id:      \"\" => \"subnet-b81ccce0\"\naws_route_table_association.practice2-dmz-1c: Creation complete\naws_route_table.practice2-dmz-1a: Creation complete\naws_route_table_association.practice2-dmz-1a: Creating...\n  route_table_id: \"\" => \"rtb-05c74b61\"\n  subnet_id:      \"\" => \"subnet-20c24b56\"\naws_security_group.ssh-limited: Creation complete\naws_instance.stg-bastion: Creating...\n  ami:                         \"\" => \"ami-0c11b26d\"\n  associate_public_ip_address: \"\" => \"<computed>\"\n  availability_zone:           \"\" => \"<computed>\"\n  ebs_block_device.#:          \"\" => \"<computed>\"\n  ephemeral_block_device.#:    \"\" => \"<computed>\"\n  instance_state:              \"\" => \"<computed>\"\n  instance_type:               \"\" => \"t2.nano\"\n  key_name:                    \"\" => \"**********\"\n  network_interface_id:        \"\" => \"<computed>\"\n  placement_group:             \"\" => \"<computed>\"\n  private_dns:                 \"\" => \"<computed>\"\n  private_ip:                  \"\" => \"<computed>\"\n  public_dns:                  \"\" => \"<computed>\"\n  public_ip:                   \"\" => \"<computed>\"\n  root_block_device.#:         \"\" => \"<computed>\"\n  security_groups.#:           \"\" => \"1\"\n  security_groups.1593894738:  \"\" => \"sg-0ade0c6d\"\n  source_dest_check:           \"\" => \"true\"\n  subnet_id:                   \"\" => \"subnet-20c24b56\"\n  tags.%:                      \"\" => \"1\"\n  tags.Name:                   \"\" => \"bastion\"\n  tenancy:                     \"\" => \"<computed>\"\n  vpc_security_group_ids.#:    \"\" => \"<computed>\"\naws_route_table_association.practice2-dmz-1a: Creation complete\naws_nat_gateway.practice2-natgw: Still creating... (10s elapsed)\naws_instance.stg-bastion: Still creating... (10s elapsed)\naws_instance.stg-bastion: Creation complete\naws_nat_gateway.practice2-natgw: Still creating... (20s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (30s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (40s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (50s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m0s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m10s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m20s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m30s elapsed)\naws_nat_gateway.practice2-natgw: Creation complete\naws_route_table.practice2-trust-1c: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.1966172565.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.1966172565.gateway_id:                \"\" => \"\"\n  route.1966172565.instance_id:               \"\" => \"\"\n  route.1966172565.nat_gateway_id:            \"\" => \"nat-0ef9a3396c1bd932e\"\n  route.1966172565.network_interface_id:      \"\" => \"\"\n  route.1966172565.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-trust-1c\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-trust-1a: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.1966172565.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.1966172565.gateway_id:                \"\" => \"\"\n  route.1966172565.instance_id:               \"\" => \"\"\n  route.1966172565.nat_gateway_id:            \"\" => \"nat-0ef9a3396c1bd932e\"\n  route.1966172565.network_interface_id:      \"\" => \"\"\n  route.1966172565.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-trust-1a\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-trust-1a: Creation complete\naws_route_table_association.practice2-trust-1a: Creating...\n  route_table_id: \"\" => \"rtb-e1c74b85\"\n  subnet_id:      \"\" => \"subnet-21c24b57\"\naws_route_table_association.practice2-trust-1a: Creation complete\naws_route_table.practice2-trust-1c: Creation complete\naws_route_table_association.practice2-trust-1c: Creating...\n  route_table_id: \"\" => \"rtb-e0c74b84\"\n  subnet_id:      \"\" => \"subnet-871cccdf\"\naws_route_table_association.practice2-trust-1c: Creation complete\n\nApply complete! Resources: 18 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\nOutputs:\n\neip.natgw.id = eipalloc-2898ae4d\npublic ip of stg-bastion = 52.***.***.***\n\n\n\u78ba\u8a8d\n$ terraform show\naws_eip.natgw:\n  id = eipalloc-2898ae4d\n  association_id = \n  domain = vpc\n  instance = \n  network_interface = \n  private_ip = \n  public_ip = 52.***.***.***\n  vpc = true\naws_instance.stg-bastion:\n  id = i-**************\n  ami = ami-0c11b26d\n  associate_public_ip_address = true\n  availability_zone = ap-northeast-1a\n  disable_api_termination = false\n  ebs_block_device.# = 0\n  ebs_optimized = false\n  ephemeral_block_device.# = 0\n  iam_instance_profile = \n  instance_state = running\n  instance_type = t2.nano\n  key_name = ***********\n  monitoring = false\n  network_interface_id = eni-ba4034f7\n  private_dns = ip-10-0-0-164.ap-northeast-1.compute.internal\n  private_ip = 10.0.0.164\n  public_dns = ec2-52-***-***-***.ap-northeast-1.compute.amazonaws.com\n  public_ip = 52.***.***.***\n  root_block_device.# = 1\n  root_block_device.0.delete_on_termination = true\n  root_block_device.0.iops = 100\n  root_block_device.0.volume_size = 8\n  root_block_device.0.volume_type = gp2\n  security_groups.# = 0\n  source_dest_check = true\n  subnet_id = subnet-20c24b56\n  tags.% = 1\n  tags.Name = bastion\n  tenancy = default\n  vpc_security_group_ids.# = 1\n  vpc_security_group_ids.1593894738 = sg-0ade0c6d\naws_internet_gateway.practice2-igw:\n  id = igw-0ecf986b\n  tags.% = 1\n  tags.Name = practice2-igw\n  vpc_id = vpc-7e905e1a\naws_nat_gateway.practice2-natgw:\n  id = nat-0ef9a3396c1bd932e\n  allocation_id = eipalloc-2898ae4d\n  network_interface_id = eni-a75b2fea\n  private_ip = 10.0.0.45\n  public_ip = 52.***.***.***\n  subnet_id = subnet-20c24b56\naws_route_table.practice2-dmz-1a:\n  id = rtb-05c74b61\n  propagating_vgws.# = 0\n  route.# = 1\n  route.4294384048.cidr_block = 0.0.0.0/0\n  route.4294384048.gateway_id = igw-0ecf986b\n  route.4294384048.instance_id = \n  route.4294384048.nat_gateway_id = \n  route.4294384048.network_interface_id = \n  route.4294384048.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-dmz-1a\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-dmz-1c:\n  id = rtb-04c74b60\n  propagating_vgws.# = 0\n  route.# = 1\n  route.4294384048.cidr_block = 0.0.0.0/0\n  route.4294384048.gateway_id = igw-0ecf986b\n  route.4294384048.instance_id = \n  route.4294384048.nat_gateway_id = \n  route.4294384048.network_interface_id = \n  route.4294384048.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-dmz-1c\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-trust-1a:\n  id = rtb-e1c74b85\n  propagating_vgws.# = 0\n  route.# = 1\n  route.1966172565.cidr_block = 0.0.0.0/0\n  route.1966172565.gateway_id = \n  route.1966172565.instance_id = \n  route.1966172565.nat_gateway_id = nat-0ef9a3396c1bd932e\n  route.1966172565.network_interface_id = \n  route.1966172565.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-trust-1a\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-trust-1c:\n  id = rtb-e0c74b84\n  propagating_vgws.# = 0\n  route.# = 1\n  route.1966172565.cidr_block = 0.0.0.0/0\n  route.1966172565.gateway_id = \n  route.1966172565.instance_id = \n  route.1966172565.nat_gateway_id = nat-0ef9a3396c1bd932e\n  route.1966172565.network_interface_id = \n  route.1966172565.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-trust-1c\n  vpc_id = vpc-7e905e1a\naws_route_table_association.practice2-dmz-1a:\n  id = rtbassoc-8d3001e9\n  route_table_id = rtb-05c74b61\n  subnet_id = subnet-20c24b56\naws_route_table_association.practice2-dmz-1c:\n  id = rtbassoc-8c3001e8\n  route_table_id = rtb-04c74b60\n  subnet_id = subnet-b81ccce0\naws_route_table_association.practice2-trust-1a:\n  id = rtbassoc-71330215\n  route_table_id = rtb-e1c74b85\n  subnet_id = subnet-21c24b57\naws_route_table_association.practice2-trust-1c:\n  id = rtbassoc-72330216\n  route_table_id = rtb-e0c74b84\n  subnet_id = subnet-871cccdf\naws_security_group.ssh-limited:\n  id = sg-0ade0c6d\n  description = ssh_limited inbound traffic\n  egress.# = 1\n  egress.482069346.cidr_blocks.# = 1\n  egress.482069346.cidr_blocks.0 = 0.0.0.0/0\n  egress.482069346.from_port = 0\n  egress.482069346.prefix_list_ids.# = 0\n  egress.482069346.protocol = -1\n  egress.482069346.security_groups.# = 0\n  egress.482069346.self = false\n  egress.482069346.to_port = 0\n  ingress.# = 1\n  ingress.3925595496.cidr_blocks.# = 1\n  ingress.3925595496.cidr_blocks.0 = ***.***.***.***/32\n  ingress.3925595496.from_port = 22\n  ingress.3925595496.protocol = tcp\n  ingress.3925595496.security_groups.# = 0\n  ingress.3925595496.self = false\n  ingress.3925595496.to_port = 22\n  name = ssh-limited\n  owner_id = 385997410181\n  tags.% = 1\n  tags.Name = ssh-limited\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-dmz-1a:\n  id = subnet-20c24b56\n  availability_zone = ap-northeast-1a\n  cidr_block = 10.0.0.0/24\n  map_public_ip_on_launch = true\n  tags.% = 1\n  tags.Name = practice2-dmz-1a\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-dmz-1c:\n  id = subnet-b81ccce0\n  availability_zone = ap-northeast-1c\n  cidr_block = 10.0.1.0/24\n  map_public_ip_on_launch = true\n  tags.% = 1\n  tags.Name = practice2-dmz-1c\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-trust-1a:\n  id = subnet-21c24b57\n  availability_zone = ap-northeast-1a\n  cidr_block = 10.0.2.0/24\n  map_public_ip_on_launch = false\n  tags.% = 1\n  tags.Name = practice2-trust-1a\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-trust-1c:\n  id = subnet-871cccdf\n  availability_zone = ap-northeast-1c\n  cidr_block = 10.0.3.0/24\n  map_public_ip_on_launch = false\n  tags.% = 1\n  tags.Name = practice2-trust-1c\n  vpc_id = vpc-7e905e1a\naws_vpc.practice2-vpc:\n  id = vpc-7e905e1a\n  cidr_block = 10.0.0.0/16\n  default_network_acl_id = acl-903f86f4\n  default_route_table_id = rtb-3bc74b5f\n  default_security_group_id = sg-0bde0c6c\n  dhcp_options_id = dopt-851a0fe7\n  enable_classiclink = false\n  enable_dns_hostnames = true\n  enable_dns_support = true\n  instance_tenancy = default\n  main_route_table_id = rtb-3bc74b5f\n  tags.% = 1\n  tags.Name = practice2-vpc\n\n\nOutputs:\n\neip.natgw.id = eipalloc-2898ae4d\npublic ip of stg-bastion = 52.***.***.***\n\n\n\u524a\u9664\n\n\u524a\u9664\u78ba\u8a8d\n\n$ terraform plan --destroy\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_vpc.practice2-vpc: Refreshing state... (ID: vpc-7e905e1a)\naws_eip.natgw: Refreshing state... (ID: eipalloc-2898ae4d)\naws_internet_gateway.practice2-igw: Refreshing state... (ID: igw-0ecf986b)\naws_security_group.ssh-limited: Refreshing state... (ID: sg-0ade0c6d)\naws_subnet.practice2-trust-1c: Refreshing state... (ID: subnet-871cccdf)\naws_subnet.practice2-dmz-1c: Refreshing state... (ID: subnet-b81ccce0)\naws_subnet.practice2-trust-1a: Refreshing state... (ID: subnet-21c24b57)\naws_subnet.practice2-dmz-1a: Refreshing state... (ID: subnet-20c24b56)\naws_nat_gateway.practice2-natgw: Refreshing state... (ID: nat-0ef9a3396c1bd932e)\naws_instance.bastion: Refreshing state... (ID: i-*********)\naws_route_table.practice2-dmz-1a: Refreshing state... (ID: rtb-05c74b61)\naws_route_table.practice2-dmz-1c: Refreshing state... (ID: rtb-04c74b60)\naws_route_table_association.practice2-dmz-1c: Refreshing state... (ID: rtbassoc-8c3001e8)\naws_route_table_association.practice2-dmz-1a: Refreshing state... (ID: rtbassoc-8d3001e9)\naws_route_table.practice2-trust-1a: Refreshing state... (ID: rtb-e1c74b85)\naws_route_table.practice2-trust-1c: Refreshing state... (ID: rtb-e0c74b84)\naws_route_table_association.practice2-trust-1a: Refreshing state... (ID: rtbassoc-71330215)\naws_route_table_association.practice2-trust-1c: Refreshing state... (ID: rtbassoc-72330216)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n- aws_eip.natgw\n\n- aws_instance.stg-bastion\n\n- aws_internet_gateway.practice2-igw\n\n- aws_nat_gateway.practice2-natgw\n\n- aws_route_table.practice2-dmz-1a\n\n- aws_route_table.practice2-dmz-1c\n\n- aws_route_table.practice2-trust-1a\n\n- aws_route_table.practice2-trust-1c\n\n- aws_route_table_association.practice2-dmz-1a\n\n- aws_route_table_association.practice2-dmz-1c\n\n- aws_route_table_association.practice2-trust-1a\n\n- aws_route_table_association.practice2-trust-1c\n\n- aws_security_group.ssh-limited\n\n- aws_subnet.practice2-dmz-1a\n\n- aws_subnet.practice2-dmz-1c\n\n- aws_subnet.practice2-trust-1a\n\n- aws_subnet.practice2-trust-1c\n\n- aws_vpc.practice2-vpc\n\n\nPlan: 0 to add, 0 to change, 18 to destroy.\n\n*\u3000\u524a\u9664\u5b9f\u884c\n$ terraform destroy\nDo you really want to destroy?\n  Terraform will delete all your managed infrastructure.\n  There is no undo. Only 'yes' will be accepted to confirm.\n\n  Enter a value: yes\n\naws_eip.natgw: Refreshing state... (ID: eipalloc-2898ae4d)\naws_vpc.practice2-vpc: Refreshing state... (ID: vpc-7e905e1a)\naws_security_group.ssh-limited: Refreshing state... (ID: sg-0ade0c6d)\naws_subnet.practice2-dmz-1a: Refreshing state... (ID: subnet-20c24b56)\naws_subnet.practice2-dmz-1c: Refreshing state... (ID: subnet-b81ccce0)\naws_internet_gateway.practice2-igw: Refreshing state... (ID: igw-0ecf986b)\naws_subnet.practice2-trust-1c: Refreshing state... (ID: subnet-871cccdf)\naws_subnet.practice2-trust-1a: Refreshing state... (ID: subnet-21c24b57)\naws_route_table.practice2-dmz-1a: Refreshing state... (ID: rtb-05c74b61)\naws_route_table.practice2-dmz-1c: Refreshing state... (ID: rtb-04c74b60)\naws_route_table_association.practice2-dmz-1c: Refreshing state... (ID: rtbassoc-8c3001e8)\naws_nat_gateway.practice2-natgw: Refreshing state... (ID: nat-0ef9a3396c1bd932e)\naws_instance.stg-bastion: Refreshing state... (ID: i-************)\naws_route_table.practice2-trust-1c: Refreshing state... (ID: rtb-e0c74b84)\naws_route_table.practice2-trust-1a: Refreshing state... (ID: rtb-e1c74b85)\naws_route_table_association.practice2-trust-1c: Refreshing state... (ID: rtbassoc-72330216)\naws_route_table_association.practice2-trust-1a: Refreshing state... (ID: rtbassoc-71330215)\naws_route_table_association.practice2-dmz-1a: Refreshing state... (ID: rtbassoc-8d3001e9)\naws_route_table_association.practice2-dmz-1a: Destroying...\naws_route_table_association.practice2-trust-1a: Destroying...\naws_route_table_association.practice2-dmz-1c: Destroying...\naws_route_table_association.practice2-trust-1c: Destroying...\naws_instance.stg-bastion: Destroying...\naws_route_table_association.practice2-trust-1c: Destruction complete\naws_subnet.practice2-trust-1c: Destroying...\naws_route_table_association.practice2-dmz-1a: Destruction complete\naws_route_table.practice2-trust-1c: Destroying...\naws_route_table.practice2-dmz-1a: Destroying...\naws_route_table_association.practice2-trust-1a: Destruction complete\naws_route_table.practice2-trust-1a: Destroying...\naws_subnet.practice2-trust-1a: Destroying...\naws_subnet.practice2-trust-1a: Destruction complete\naws_subnet.practice2-trust-1c: Destruction complete\naws_route_table_association.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-dmz-1c: Destroying...\naws_subnet.practice2-dmz-1c: Destroying...\naws_route_table.practice2-trust-1a: Destruction complete\naws_subnet.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-trust-1c: Destruction complete\naws_nat_gateway.practice2-natgw: Destroying...\naws_route_table.practice2-dmz-1a: Destruction complete\naws_internet_gateway.practice2-igw: Destroying...\naws_instance.stg-bastion: Still destroying... (10s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (10s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (10s elapsed)\naws_instance.stg-bastion: Still destroying... (20s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (20s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (20s elapsed)\naws_instance.stg-bastion: Still destroying... (30s elapsed)\naws_instance.stg-bastion: Destruction complete\naws_security_group.ssh-limited: Destroying...\naws_security_group.ssh-limited: Destruction complete\naws_nat_gateway.practice2-natgw: Still destroying... (30s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (30s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (40s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (40s elapsed)\naws_internet_gateway.practice2-igw: Destruction complete\naws_nat_gateway.practice2-natgw: Still destroying... (50s elapsed)\naws_nat_gateway.practice2-natgw: Destruction complete\naws_subnet.practice2-dmz-1a: Destroying...\naws_eip.natgw: Destroying...\naws_eip.natgw: Destruction complete\naws_subnet.practice2-dmz-1a: Destruction complete\naws_vpc.practice2-vpc: Destroying...\naws_vpc.practice2-vpc: Destruction complete\n\nDestroy complete! Resources: 18 destroyed.\n\n\n\u3082\u3063\u3068\u7de8\u96c6\u3057\u3066\u7d30\u304b\u3044\u8981\u4ef6\u306b\u6cbf\u3063\u3066\u904b\u7528\u3067\u304d\u307e\u3059\u306d\uff01\n\n# \u76ee\u7684\nterraform\u3092\u4f7f\u7528\u3057\u3001\u540c\u3058\u69cb\u6210\u306e\u74b0\u5883\u3092\u4f5c\u6210\u3059\u308b\n\n## \u69cb\u6210\u56f3\n![terraform1.png](https://qiita-image-store.s3.amazonaws.com/0/58788/d9821909-1b19-999c-f5d6-0dad1a4ea991.png)\n\n\n# \u65b9\u6cd5\n\u74b0\u5883\u6bce\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u7de8\u96c6\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u6a5f\u80fd\u6bce\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n# \u8a2d\u5b9a\n## Templates\n* config.tf\n\n```bash\n///config\n\nprovider \"aws\" {\n    access_key = \"${var.access_key}\"\n    secret_key = \"${var.secret_key}\"\n    region = \"${var.region}\"\n}\n```\n\n* eip.tf\n\n```bash\n/// eip allocate\nresource \"aws_eip\" \"natgw\" {\n    vpc = true\n}\n```\n\n* igw.tf\n\n```bash\nresource \"aws_internet_gateway\" \"practice2-igw\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    tags {\n      Name = \"practice2-igw\"\n    }\n}\n```\n\n* instance.tf\n\n```bash\n/// bastion-server\u4f5c\u6210\n\nresource \"aws_instance\" \"bastion\" {\n    ami = \"ami-0c11b26d\"\n    instance_type = \"t2.nano\"\n    key_name = \"xxxxxx\"\n    security_groups = [\"${aws_security_group.ssh-limited.id}\"]\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n    tags {\n        Name = \"bastion\"\n    }\n}\n```\n\n* nat-gw.tf\n\n```bash\nresource \"aws_nat_gateway\" \"practice2-natgw\" {\n    allocation_id = \"${aws_eip.natgw.id}\"\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n}\n```\n\n* output.tf\n\n```bash\n/// instance\u3068NatGateway\u306b\u4f7f\u308f\u308c\u308bGIP\u3092output\u3055\u305b\u308b\noutput \"eip.natgw.id\" {\n  value = \"${aws_eip.natgw.id}\"\n}\n\noutput \"public ip of bastion\" {\n  value = \"${aws_instance.bastion.public_ip}\"\n}\n```\n\n* routetable.tf\n\n```bash\n/// dmz-1a routetable\nresource \"aws_route_table\" \"practice2-dmz-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        gateway_id = \"${aws_internet_gateway.practice2-igw.id}\"\n    }\n    tags {\n      Name = \"practice2-dmz-1a\"\n    }\n}\n\n/// dmz-1c routetable\nresource \"aws_route_table\" \"practice2-dmz-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        gateway_id = \"${aws_internet_gateway.practice2-igw.id}\"\n    }\n    tags {\n      Name = \"practice2-dmz-1c\"\n    }\n}\n\n/// trust-1a routetable\nresource \"aws_route_table\" \"practice2-trust-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        nat_gateway_id = \"${aws_nat_gateway.practice2-natgw.id}\"\n    }\n    tags {\n      Name = \"practice2-trust-1a\"\n    }\n}\n\n/// trust-1c routetable\nresource \"aws_route_table\" \"practice2-trust-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    route {\n        cidr_block = \"0.0.0.0/0\"\n        nat_gateway_id = \"${aws_nat_gateway.practice2-natgw.id}\"\n    }\n    tags {\n      Name = \"practice2-trust-1c\"\n    }\n}\n\n/// practice2-dmz-1a\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-dmz-1a\" {\n    subnet_id = \"${aws_subnet.practice2-dmz-1a.id}\"\n    route_table_id = \"${aws_route_table.practice2-dmz-1a.id}\"\n}\n\n/// practice2-dmz-1c\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-dmz-1c\" {\n    subnet_id = \"${aws_subnet.practice2-dmz-1c.id}\"\n    route_table_id = \"${aws_route_table.practice2-dmz-1c.id}\"\n}\n\n/// practice2-trust-1a\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-trust-1a\" {\n    subnet_id = \"${aws_subnet.practice2-trust-1a.id}\"\n    route_table_id = \"${aws_route_table.practice2-trust-1a.id}\"\n}\n\n/// practice2-trust-1c\u3092\u95a2\u9023\u4ed8\u3051\nresource \"aws_route_table_association\" \"practice2-trust-1c\" {\n    subnet_id = \"${aws_subnet.practice2-trust-1c.id}\"\n    route_table_id = \"${aws_route_table.practice2-trust-1c.id}\"\n}\n```\n\n* security-g.tf\n\n```bash\nresource \"aws_security_group\" \"ssh-limited\" {\n  vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n  name = \"ssh-limited\"\n  description = \"ssh_limited inbound traffic\"\n\n  ingress {\n      from_port = 22\n      to_port = 22\n      protocol = \"tcp\"\n      cidr_blocks = [\"***.***.***.***/32\"]\n  }\n  egress {\n      from_port = 0\n      to_port = 0\n      protocol = \"-1\"\n      cidr_blocks = [\"0.0.0.0/0\"]\n  }\n\n  tags {\n    Name = \"ssh-limited\"\n  }\n}\n```\n\n* subnet.tf\n\n```bash\n/// dmz-1a subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-dmz-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.0.0/24\"\n    map_public_ip_on_launch = \"true\" # dmz\u3067\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fPublicIP\u3092\u6301\u305f\u3059\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n      Name = \"practice2-dmz-1a\"\n    }\n}\n\n/// dmz-1c subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-dmz-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.1.0/24\"\n    map_public_ip_on_launch = \"true\" # dmz\u3067\u8d77\u52d5\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fPublicIP\u3092\u6301\u305f\u3059\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n      Name = \"practice2-dmz-1c\"\n    }\n}\n\n/// trust-1a subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-trust-1a\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.2.0/24\"\n    availability_zone = \"ap-northeast-1a\"\n    tags {\n      Name = \"practice2-trust-1a\"\n    }\n}\n\n/// trust-1c subnet\u65b0\u898f\u4f5c\u6210\nresource \"aws_subnet\" \"practice2-trust-1c\" {\n    vpc_id = \"${aws_vpc.practice2-vpc.id}\"\n    cidr_block = \"10.0.3.0/24\"\n    availability_zone = \"ap-northeast-1c\"\n    tags {\n      Name = \"practice2-trust-1c\"\n    }\n}\n```\n\n* terraform.tfvars\n\n```bash\n///iam-user-key\n\naccess_key = \"********\"\nsecret_key = \"***************\"\n```\n\n* variables.tf\n\n```bash\nvariable \"access_key\" {}\nvariable \"secret_key\" {}\nvariable \"region\" {\n    default = \"ap-northeast-1\"\n}\n```\n\n* vpc.tf\n\n```bash\nresource \"aws_vpc\" \"practice2-vpc\" {\n    cidr_block = \"10.0.0.0/16\"\n    instance_tenancy = \"default\"\n    enable_dns_support = \"true\"\n    enable_dns_hostnames = \"true\" #\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304cdns-name\u3092\u6301\u3064\u3088\u3046\u306b\u3059\u308b\n    tags {\n      Name = \"practice2-vpc\"\n    }\n}\n```\n\n# DryRun\n\n* \u30a8\u30e9\u30fc\u304c\u7121\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n```bash\n$ terraform plan\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n+ aws_eip.natgw\n    allocation_id:     \"<computed>\"\n    association_id:    \"<computed>\"\n    domain:            \"<computed>\"\n    instance:          \"<computed>\"\n    network_interface: \"<computed>\"\n    private_ip:        \"<computed>\"\n    public_ip:         \"<computed>\"\n    vpc:               \"true\"\n\n+ aws_instance.stg-bastion\n    ami:                         \"ami-0c11b26d\"\n    associate_public_ip_address: \"<computed>\"\n    availability_zone:           \"<computed>\"\n    ebs_block_device.#:          \"<computed>\"\n    ephemeral_block_device.#:    \"<computed>\"\n    instance_state:              \"<computed>\"\n    instance_type:               \"t2.nano\"\n    key_name:                    \"**********\"\n    network_interface_id:        \"<computed>\"\n    placement_group:             \"<computed>\"\n    private_dns:                 \"<computed>\"\n    private_ip:                  \"<computed>\"\n    public_dns:                  \"<computed>\"\n    public_ip:                   \"<computed>\"\n    root_block_device.#:         \"<computed>\"\n    security_groups.#:           \"<computed>\"\n    source_dest_check:           \"true\"\n    subnet_id:                   \"<computed>\"\n    tags.%:                      \"1\"\n    tags.Name:                   \"bastion\"\n    tenancy:                     \"<computed>\"\n    vpc_security_group_ids.#:    \"<computed>\"\n\n+ aws_internet_gateway.practice2-igw\n    tags.%:    \"1\"\n    tags.Name: \"practice2-igw\"\n    vpc_id:    \"<computed>\"\n\n+ aws_nat_gateway.practice2-natgw\n    allocation_id:        \"<computed>\"\n    network_interface_id: \"<computed>\"\n    private_ip:           \"<computed>\"\n    public_ip:            \"<computed>\"\n    subnet_id:            \"<computed>\"\n\n+ aws_route_table.practice2-dmz-1a\n    route.#:                                     \"1\"\n    route.~2406728767.cidr_block:                \"0.0.0.0/0\"\n    route.~2406728767.gateway_id:                \"<computed>\"\n    route.~2406728767.instance_id:               \"\"\n    route.~2406728767.nat_gateway_id:            \"\"\n    route.~2406728767.network_interface_id:      \"\"\n    route.~2406728767.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-dmz-1a\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-dmz-1c\n    route.#:                                     \"1\"\n    route.~2406728767.cidr_block:                \"0.0.0.0/0\"\n    route.~2406728767.gateway_id:                \"<computed>\"\n    route.~2406728767.instance_id:               \"\"\n    route.~2406728767.nat_gateway_id:            \"\"\n    route.~2406728767.network_interface_id:      \"\"\n    route.~2406728767.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-dmz-1c\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-trust-1a\n    route.#:                                     \"1\"\n    route.~2120687611.cidr_block:                \"0.0.0.0/0\"\n    route.~2120687611.gateway_id:                \"\"\n    route.~2120687611.instance_id:               \"\"\n    route.~2120687611.nat_gateway_id:            \"<computed>\"\n    route.~2120687611.network_interface_id:      \"\"\n    route.~2120687611.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-trust-1a\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table.practice2-trust-1c\n    route.#:                                     \"1\"\n    route.~2120687611.cidr_block:                \"0.0.0.0/0\"\n    route.~2120687611.gateway_id:                \"\"\n    route.~2120687611.instance_id:               \"\"\n    route.~2120687611.nat_gateway_id:            \"<computed>\"\n    route.~2120687611.network_interface_id:      \"\"\n    route.~2120687611.vpc_peering_connection_id: \"\"\n    tags.%:                                      \"1\"\n    tags.Name:                                   \"practice2-trust-1c\"\n    vpc_id:                                      \"<computed>\"\n\n+ aws_route_table_association.practice2-dmz-1a\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-dmz-1c\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-trust-1a\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_route_table_association.practice2-trust-1c\n    route_table_id: \"<computed>\"\n    subnet_id:      \"<computed>\"\n\n+ aws_security_group.ssh-limited\n    description:                          \"ssh_limited inbound traffic\"\n    egress.#:                             \"1\"\n    egress.482069346.cidr_blocks.#:       \"1\"\n    egress.482069346.cidr_blocks.0:       \"0.0.0.0/0\"\n    egress.482069346.from_port:           \"0\"\n    egress.482069346.prefix_list_ids.#:   \"0\"\n    egress.482069346.protocol:            \"-1\"\n    egress.482069346.security_groups.#:   \"0\"\n    egress.482069346.self:                \"false\"\n    egress.482069346.to_port:             \"0\"\n    ingress.#:                            \"1\"\n    ingress.3925595496.cidr_blocks.#:     \"1\"\n    ingress.3925595496.cidr_blocks.0:     \"***.***.***.***./32\"\n    ingress.3925595496.from_port:         \"22\"\n    ingress.3925595496.protocol:          \"tcp\"\n    ingress.3925595496.security_groups.#: \"0\"\n    ingress.3925595496.self:              \"false\"\n    ingress.3925595496.to_port:           \"22\"\n    name:                                 \"ssh-limited\"\n    owner_id:                             \"<computed>\"\n    tags.%:                               \"1\"\n    tags.Name:                            \"ssh-limited\"\n    vpc_id:                               \"<computed>\"\n\n+ aws_subnet.practice2-dmz-1a\n    availability_zone:       \"ap-northeast-1a\"\n    cidr_block:              \"10.0.0.0/24\"\n    map_public_ip_on_launch: \"true\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-dmz-1a\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-dmz-1c\n    availability_zone:       \"ap-northeast-1c\"\n    cidr_block:              \"10.0.1.0/24\"\n    map_public_ip_on_launch: \"true\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-dmz-1c\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-trust-1a\n    availability_zone:       \"ap-northeast-1a\"\n    cidr_block:              \"10.0.2.0/24\"\n    map_public_ip_on_launch: \"false\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-trust-1a\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_subnet.practice2-trust-1c\n    availability_zone:       \"ap-northeast-1c\"\n    cidr_block:              \"10.0.3.0/24\"\n    map_public_ip_on_launch: \"false\"\n    tags.%:                  \"1\"\n    tags.Name:               \"practice2-trust-1c\"\n    vpc_id:                  \"<computed>\"\n\n+ aws_vpc.practice2-vpc\n    cidr_block:                \"10.0.0.0/16\"\n    default_network_acl_id:    \"<computed>\"\n    default_route_table_id:    \"<computed>\"\n    default_security_group_id: \"<computed>\"\n    dhcp_options_id:           \"<computed>\"\n    enable_classiclink:        \"<computed>\"\n    enable_dns_hostnames:      \"true\"\n    enable_dns_support:        \"true\"\n    instance_tenancy:          \"default\"\n    main_route_table_id:       \"<computed>\"\n    tags.%:                    \"1\"\n    tags.Name:                 \"practice2-vpc\"\n\n\nPlan: 18 to add, 0 to change, 0 to destroy.\n```\n\n# \u5b9f\u884c\n\n```bash\n$ terraform apply\naws_eip.natgw: Creating...\n  allocation_id:     \"\" => \"<computed>\"\n  association_id:    \"\" => \"<computed>\"\n  domain:            \"\" => \"<computed>\"\n  instance:          \"\" => \"<computed>\"\n  network_interface: \"\" => \"<computed>\"\n  private_ip:        \"\" => \"<computed>\"\n  public_ip:         \"\" => \"<computed>\"\n  vpc:               \"\" => \"true\"\naws_vpc.practice2-vpc: Creating...\n  cidr_block:                \"\" => \"10.0.0.0/16\"\n  default_network_acl_id:    \"\" => \"<computed>\"\n  default_route_table_id:    \"\" => \"<computed>\"\n  default_security_group_id: \"\" => \"<computed>\"\n  dhcp_options_id:           \"\" => \"<computed>\"\n  enable_classiclink:        \"\" => \"<computed>\"\n  enable_dns_hostnames:      \"\" => \"true\"\n  enable_dns_support:        \"\" => \"true\"\n  instance_tenancy:          \"\" => \"default\"\n  main_route_table_id:       \"\" => \"<computed>\"\n  tags.%:                    \"\" => \"1\"\n  tags.Name:                 \"\" => \"practice2-vpc\"\naws_eip.natgw: Creation complete\naws_vpc.practice2-vpc: Creation complete\naws_internet_gateway.practice2-igw: Creating...\n  tags.%:    \"0\" => \"1\"\n  tags.Name: \"\" => \"practice2-igw\"\n  vpc_id:    \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1a: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1a\"\n  cidr_block:              \"\" => \"10.0.2.0/24\"\n  map_public_ip_on_launch: \"\" => \"false\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-trust-1a\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-dmz-1c: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1c\"\n  cidr_block:              \"\" => \"10.0.1.0/24\"\n  map_public_ip_on_launch: \"\" => \"true\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-dmz-1c\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1c: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1c\"\n  cidr_block:              \"\" => \"10.0.3.0/24\"\n  map_public_ip_on_launch: \"\" => \"false\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-trust-1c\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-dmz-1a: Creating...\n  availability_zone:       \"\" => \"ap-northeast-1a\"\n  cidr_block:              \"\" => \"10.0.0.0/24\"\n  map_public_ip_on_launch: \"\" => \"true\"\n  tags.%:                  \"\" => \"1\"\n  tags.Name:               \"\" => \"practice2-dmz-1a\"\n  vpc_id:                  \"\" => \"vpc-7e905e1a\"\naws_security_group.ssh-limited: Creating...\n  description:                          \"\" => \"ssh_limited inbound traffic\"\n  egress.#:                             \"\" => \"1\"\n  egress.482069346.cidr_blocks.#:       \"\" => \"1\"\n  egress.482069346.cidr_blocks.0:       \"\" => \"0.0.0.0/0\"\n  egress.482069346.from_port:           \"\" => \"0\"\n  egress.482069346.prefix_list_ids.#:   \"\" => \"0\"\n  egress.482069346.protocol:            \"\" => \"-1\"\n  egress.482069346.security_groups.#:   \"\" => \"0\"\n  egress.482069346.self:                \"\" => \"false\"\n  egress.482069346.to_port:             \"\" => \"0\"\n  ingress.#:                            \"\" => \"1\"\n  ingress.3925595496.cidr_blocks.#:     \"\" => \"1\"\n  ingress.3925595496.cidr_blocks.0:     \"\" => \"***.***.***.***/32\"\n  ingress.3925595496.from_port:         \"\" => \"22\"\n  ingress.3925595496.protocol:          \"\" => \"tcp\"\n  ingress.3925595496.security_groups.#: \"\" => \"0\"\n  ingress.3925595496.self:              \"\" => \"false\"\n  ingress.3925595496.to_port:           \"\" => \"22\"\n  name:                                 \"\" => \"ssh-limited\"\n  owner_id:                             \"\" => \"<computed>\"\n  tags.%:                               \"\" => \"1\"\n  tags.Name:                            \"\" => \"ssh-limited\"\n  vpc_id:                               \"\" => \"vpc-7e905e1a\"\naws_internet_gateway.practice2-igw: Creation complete\naws_route_table.practice2-dmz-1c: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.4294384048.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.4294384048.gateway_id:                \"\" => \"igw-0ecf986b\"\n  route.4294384048.instance_id:               \"\" => \"\"\n  route.4294384048.nat_gateway_id:            \"\" => \"\"\n  route.4294384048.network_interface_id:      \"\" => \"\"\n  route.4294384048.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-dmz-1c\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-dmz-1a: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.4294384048.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.4294384048.gateway_id:                \"\" => \"igw-0ecf986b\"\n  route.4294384048.instance_id:               \"\" => \"\"\n  route.4294384048.nat_gateway_id:            \"\" => \"\"\n  route.4294384048.network_interface_id:      \"\" => \"\"\n  route.4294384048.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-dmz-1a\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_subnet.practice2-trust-1a: Creation complete\naws_subnet.practice2-dmz-1a: Creation complete\naws_nat_gateway.practice2-natgw: Creating...\n  allocation_id:        \"\" => \"eipalloc-2898ae4d\"\n  network_interface_id: \"\" => \"<computed>\"\n  private_ip:           \"\" => \"<computed>\"\n  public_ip:            \"\" => \"<computed>\"\n  subnet_id:            \"\" => \"subnet-20c24b56\"\naws_subnet.practice2-trust-1c: Creation complete\naws_subnet.practice2-dmz-1c: Creation complete\naws_route_table.practice2-dmz-1c: Creation complete\naws_route_table_association.practice2-dmz-1c: Creating...\n  route_table_id: \"\" => \"rtb-04c74b60\"\n  subnet_id:      \"\" => \"subnet-b81ccce0\"\naws_route_table_association.practice2-dmz-1c: Creation complete\naws_route_table.practice2-dmz-1a: Creation complete\naws_route_table_association.practice2-dmz-1a: Creating...\n  route_table_id: \"\" => \"rtb-05c74b61\"\n  subnet_id:      \"\" => \"subnet-20c24b56\"\naws_security_group.ssh-limited: Creation complete\naws_instance.stg-bastion: Creating...\n  ami:                         \"\" => \"ami-0c11b26d\"\n  associate_public_ip_address: \"\" => \"<computed>\"\n  availability_zone:           \"\" => \"<computed>\"\n  ebs_block_device.#:          \"\" => \"<computed>\"\n  ephemeral_block_device.#:    \"\" => \"<computed>\"\n  instance_state:              \"\" => \"<computed>\"\n  instance_type:               \"\" => \"t2.nano\"\n  key_name:                    \"\" => \"**********\"\n  network_interface_id:        \"\" => \"<computed>\"\n  placement_group:             \"\" => \"<computed>\"\n  private_dns:                 \"\" => \"<computed>\"\n  private_ip:                  \"\" => \"<computed>\"\n  public_dns:                  \"\" => \"<computed>\"\n  public_ip:                   \"\" => \"<computed>\"\n  root_block_device.#:         \"\" => \"<computed>\"\n  security_groups.#:           \"\" => \"1\"\n  security_groups.1593894738:  \"\" => \"sg-0ade0c6d\"\n  source_dest_check:           \"\" => \"true\"\n  subnet_id:                   \"\" => \"subnet-20c24b56\"\n  tags.%:                      \"\" => \"1\"\n  tags.Name:                   \"\" => \"bastion\"\n  tenancy:                     \"\" => \"<computed>\"\n  vpc_security_group_ids.#:    \"\" => \"<computed>\"\naws_route_table_association.practice2-dmz-1a: Creation complete\naws_nat_gateway.practice2-natgw: Still creating... (10s elapsed)\naws_instance.stg-bastion: Still creating... (10s elapsed)\naws_instance.stg-bastion: Creation complete\naws_nat_gateway.practice2-natgw: Still creating... (20s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (30s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (40s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (50s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m0s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m10s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m20s elapsed)\naws_nat_gateway.practice2-natgw: Still creating... (1m30s elapsed)\naws_nat_gateway.practice2-natgw: Creation complete\naws_route_table.practice2-trust-1c: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.1966172565.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.1966172565.gateway_id:                \"\" => \"\"\n  route.1966172565.instance_id:               \"\" => \"\"\n  route.1966172565.nat_gateway_id:            \"\" => \"nat-0ef9a3396c1bd932e\"\n  route.1966172565.network_interface_id:      \"\" => \"\"\n  route.1966172565.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-trust-1c\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-trust-1a: Creating...\n  route.#:                                    \"\" => \"1\"\n  route.1966172565.cidr_block:                \"\" => \"0.0.0.0/0\"\n  route.1966172565.gateway_id:                \"\" => \"\"\n  route.1966172565.instance_id:               \"\" => \"\"\n  route.1966172565.nat_gateway_id:            \"\" => \"nat-0ef9a3396c1bd932e\"\n  route.1966172565.network_interface_id:      \"\" => \"\"\n  route.1966172565.vpc_peering_connection_id: \"\" => \"\"\n  tags.%:                                     \"\" => \"1\"\n  tags.Name:                                  \"\" => \"practice2-trust-1a\"\n  vpc_id:                                     \"\" => \"vpc-7e905e1a\"\naws_route_table.practice2-trust-1a: Creation complete\naws_route_table_association.practice2-trust-1a: Creating...\n  route_table_id: \"\" => \"rtb-e1c74b85\"\n  subnet_id:      \"\" => \"subnet-21c24b57\"\naws_route_table_association.practice2-trust-1a: Creation complete\naws_route_table.practice2-trust-1c: Creation complete\naws_route_table_association.practice2-trust-1c: Creating...\n  route_table_id: \"\" => \"rtb-e0c74b84\"\n  subnet_id:      \"\" => \"subnet-871cccdf\"\naws_route_table_association.practice2-trust-1c: Creation complete\n\nApply complete! Resources: 18 added, 0 changed, 0 destroyed.\n\nThe state of your infrastructure has been saved to the path\nbelow. This state is required to modify and destroy your\ninfrastructure, so keep it safe. To inspect the complete state\nuse the `terraform show` command.\n\nState path: terraform.tfstate\n\nOutputs:\n\neip.natgw.id = eipalloc-2898ae4d\npublic ip of stg-bastion = 52.***.***.***\n```\n\n# \u78ba\u8a8d\n\n```bash\n$ terraform show\naws_eip.natgw:\n  id = eipalloc-2898ae4d\n  association_id = \n  domain = vpc\n  instance = \n  network_interface = \n  private_ip = \n  public_ip = 52.***.***.***\n  vpc = true\naws_instance.stg-bastion:\n  id = i-**************\n  ami = ami-0c11b26d\n  associate_public_ip_address = true\n  availability_zone = ap-northeast-1a\n  disable_api_termination = false\n  ebs_block_device.# = 0\n  ebs_optimized = false\n  ephemeral_block_device.# = 0\n  iam_instance_profile = \n  instance_state = running\n  instance_type = t2.nano\n  key_name = ***********\n  monitoring = false\n  network_interface_id = eni-ba4034f7\n  private_dns = ip-10-0-0-164.ap-northeast-1.compute.internal\n  private_ip = 10.0.0.164\n  public_dns = ec2-52-***-***-***.ap-northeast-1.compute.amazonaws.com\n  public_ip = 52.***.***.***\n  root_block_device.# = 1\n  root_block_device.0.delete_on_termination = true\n  root_block_device.0.iops = 100\n  root_block_device.0.volume_size = 8\n  root_block_device.0.volume_type = gp2\n  security_groups.# = 0\n  source_dest_check = true\n  subnet_id = subnet-20c24b56\n  tags.% = 1\n  tags.Name = bastion\n  tenancy = default\n  vpc_security_group_ids.# = 1\n  vpc_security_group_ids.1593894738 = sg-0ade0c6d\naws_internet_gateway.practice2-igw:\n  id = igw-0ecf986b\n  tags.% = 1\n  tags.Name = practice2-igw\n  vpc_id = vpc-7e905e1a\naws_nat_gateway.practice2-natgw:\n  id = nat-0ef9a3396c1bd932e\n  allocation_id = eipalloc-2898ae4d\n  network_interface_id = eni-a75b2fea\n  private_ip = 10.0.0.45\n  public_ip = 52.***.***.***\n  subnet_id = subnet-20c24b56\naws_route_table.practice2-dmz-1a:\n  id = rtb-05c74b61\n  propagating_vgws.# = 0\n  route.# = 1\n  route.4294384048.cidr_block = 0.0.0.0/0\n  route.4294384048.gateway_id = igw-0ecf986b\n  route.4294384048.instance_id = \n  route.4294384048.nat_gateway_id = \n  route.4294384048.network_interface_id = \n  route.4294384048.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-dmz-1a\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-dmz-1c:\n  id = rtb-04c74b60\n  propagating_vgws.# = 0\n  route.# = 1\n  route.4294384048.cidr_block = 0.0.0.0/0\n  route.4294384048.gateway_id = igw-0ecf986b\n  route.4294384048.instance_id = \n  route.4294384048.nat_gateway_id = \n  route.4294384048.network_interface_id = \n  route.4294384048.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-dmz-1c\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-trust-1a:\n  id = rtb-e1c74b85\n  propagating_vgws.# = 0\n  route.# = 1\n  route.1966172565.cidr_block = 0.0.0.0/0\n  route.1966172565.gateway_id = \n  route.1966172565.instance_id = \n  route.1966172565.nat_gateway_id = nat-0ef9a3396c1bd932e\n  route.1966172565.network_interface_id = \n  route.1966172565.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-trust-1a\n  vpc_id = vpc-7e905e1a\naws_route_table.practice2-trust-1c:\n  id = rtb-e0c74b84\n  propagating_vgws.# = 0\n  route.# = 1\n  route.1966172565.cidr_block = 0.0.0.0/0\n  route.1966172565.gateway_id = \n  route.1966172565.instance_id = \n  route.1966172565.nat_gateway_id = nat-0ef9a3396c1bd932e\n  route.1966172565.network_interface_id = \n  route.1966172565.vpc_peering_connection_id = \n  tags.% = 1\n  tags.Name = practice2-trust-1c\n  vpc_id = vpc-7e905e1a\naws_route_table_association.practice2-dmz-1a:\n  id = rtbassoc-8d3001e9\n  route_table_id = rtb-05c74b61\n  subnet_id = subnet-20c24b56\naws_route_table_association.practice2-dmz-1c:\n  id = rtbassoc-8c3001e8\n  route_table_id = rtb-04c74b60\n  subnet_id = subnet-b81ccce0\naws_route_table_association.practice2-trust-1a:\n  id = rtbassoc-71330215\n  route_table_id = rtb-e1c74b85\n  subnet_id = subnet-21c24b57\naws_route_table_association.practice2-trust-1c:\n  id = rtbassoc-72330216\n  route_table_id = rtb-e0c74b84\n  subnet_id = subnet-871cccdf\naws_security_group.ssh-limited:\n  id = sg-0ade0c6d\n  description = ssh_limited inbound traffic\n  egress.# = 1\n  egress.482069346.cidr_blocks.# = 1\n  egress.482069346.cidr_blocks.0 = 0.0.0.0/0\n  egress.482069346.from_port = 0\n  egress.482069346.prefix_list_ids.# = 0\n  egress.482069346.protocol = -1\n  egress.482069346.security_groups.# = 0\n  egress.482069346.self = false\n  egress.482069346.to_port = 0\n  ingress.# = 1\n  ingress.3925595496.cidr_blocks.# = 1\n  ingress.3925595496.cidr_blocks.0 = ***.***.***.***/32\n  ingress.3925595496.from_port = 22\n  ingress.3925595496.protocol = tcp\n  ingress.3925595496.security_groups.# = 0\n  ingress.3925595496.self = false\n  ingress.3925595496.to_port = 22\n  name = ssh-limited\n  owner_id = 385997410181\n  tags.% = 1\n  tags.Name = ssh-limited\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-dmz-1a:\n  id = subnet-20c24b56\n  availability_zone = ap-northeast-1a\n  cidr_block = 10.0.0.0/24\n  map_public_ip_on_launch = true\n  tags.% = 1\n  tags.Name = practice2-dmz-1a\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-dmz-1c:\n  id = subnet-b81ccce0\n  availability_zone = ap-northeast-1c\n  cidr_block = 10.0.1.0/24\n  map_public_ip_on_launch = true\n  tags.% = 1\n  tags.Name = practice2-dmz-1c\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-trust-1a:\n  id = subnet-21c24b57\n  availability_zone = ap-northeast-1a\n  cidr_block = 10.0.2.0/24\n  map_public_ip_on_launch = false\n  tags.% = 1\n  tags.Name = practice2-trust-1a\n  vpc_id = vpc-7e905e1a\naws_subnet.practice2-trust-1c:\n  id = subnet-871cccdf\n  availability_zone = ap-northeast-1c\n  cidr_block = 10.0.3.0/24\n  map_public_ip_on_launch = false\n  tags.% = 1\n  tags.Name = practice2-trust-1c\n  vpc_id = vpc-7e905e1a\naws_vpc.practice2-vpc:\n  id = vpc-7e905e1a\n  cidr_block = 10.0.0.0/16\n  default_network_acl_id = acl-903f86f4\n  default_route_table_id = rtb-3bc74b5f\n  default_security_group_id = sg-0bde0c6c\n  dhcp_options_id = dopt-851a0fe7\n  enable_classiclink = false\n  enable_dns_hostnames = true\n  enable_dns_support = true\n  instance_tenancy = default\n  main_route_table_id = rtb-3bc74b5f\n  tags.% = 1\n  tags.Name = practice2-vpc\n\n\nOutputs:\n\neip.natgw.id = eipalloc-2898ae4d\npublic ip of stg-bastion = 52.***.***.***\n```\n\n# \u524a\u9664\n* \u524a\u9664\u78ba\u8a8d\n\n```bash\n$ terraform plan --destroy\nRefreshing Terraform state in-memory prior to plan...\nThe refreshed state will be used to calculate this plan, but\nwill not be persisted to local or remote state storage.\n\naws_vpc.practice2-vpc: Refreshing state... (ID: vpc-7e905e1a)\naws_eip.natgw: Refreshing state... (ID: eipalloc-2898ae4d)\naws_internet_gateway.practice2-igw: Refreshing state... (ID: igw-0ecf986b)\naws_security_group.ssh-limited: Refreshing state... (ID: sg-0ade0c6d)\naws_subnet.practice2-trust-1c: Refreshing state... (ID: subnet-871cccdf)\naws_subnet.practice2-dmz-1c: Refreshing state... (ID: subnet-b81ccce0)\naws_subnet.practice2-trust-1a: Refreshing state... (ID: subnet-21c24b57)\naws_subnet.practice2-dmz-1a: Refreshing state... (ID: subnet-20c24b56)\naws_nat_gateway.practice2-natgw: Refreshing state... (ID: nat-0ef9a3396c1bd932e)\naws_instance.bastion: Refreshing state... (ID: i-*********)\naws_route_table.practice2-dmz-1a: Refreshing state... (ID: rtb-05c74b61)\naws_route_table.practice2-dmz-1c: Refreshing state... (ID: rtb-04c74b60)\naws_route_table_association.practice2-dmz-1c: Refreshing state... (ID: rtbassoc-8c3001e8)\naws_route_table_association.practice2-dmz-1a: Refreshing state... (ID: rtbassoc-8d3001e9)\naws_route_table.practice2-trust-1a: Refreshing state... (ID: rtb-e1c74b85)\naws_route_table.practice2-trust-1c: Refreshing state... (ID: rtb-e0c74b84)\naws_route_table_association.practice2-trust-1a: Refreshing state... (ID: rtbassoc-71330215)\naws_route_table_association.practice2-trust-1c: Refreshing state... (ID: rtbassoc-72330216)\n\nThe Terraform execution plan has been generated and is shown below.\nResources are shown in alphabetical order for quick scanning. Green resources\nwill be created (or destroyed and then created if an existing resource\nexists), yellow resources are being changed in-place, and red resources\nwill be destroyed. Cyan entries are data sources to be read.\n\nNote: You didn't specify an \"-out\" parameter to save this plan, so when\n\"apply\" is called, Terraform can't guarantee this is what will execute.\n\n- aws_eip.natgw\n\n- aws_instance.stg-bastion\n\n- aws_internet_gateway.practice2-igw\n\n- aws_nat_gateway.practice2-natgw\n\n- aws_route_table.practice2-dmz-1a\n\n- aws_route_table.practice2-dmz-1c\n\n- aws_route_table.practice2-trust-1a\n\n- aws_route_table.practice2-trust-1c\n\n- aws_route_table_association.practice2-dmz-1a\n\n- aws_route_table_association.practice2-dmz-1c\n\n- aws_route_table_association.practice2-trust-1a\n\n- aws_route_table_association.practice2-trust-1c\n\n- aws_security_group.ssh-limited\n\n- aws_subnet.practice2-dmz-1a\n\n- aws_subnet.practice2-dmz-1c\n\n- aws_subnet.practice2-trust-1a\n\n- aws_subnet.practice2-trust-1c\n\n- aws_vpc.practice2-vpc\n\n\nPlan: 0 to add, 0 to change, 18 to destroy.\n```\n*\u3000\u524a\u9664\u5b9f\u884c\n\n```bash\n$ terraform destroy\nDo you really want to destroy?\n  Terraform will delete all your managed infrastructure.\n  There is no undo. Only 'yes' will be accepted to confirm.\n\n  Enter a value: yes\n\naws_eip.natgw: Refreshing state... (ID: eipalloc-2898ae4d)\naws_vpc.practice2-vpc: Refreshing state... (ID: vpc-7e905e1a)\naws_security_group.ssh-limited: Refreshing state... (ID: sg-0ade0c6d)\naws_subnet.practice2-dmz-1a: Refreshing state... (ID: subnet-20c24b56)\naws_subnet.practice2-dmz-1c: Refreshing state... (ID: subnet-b81ccce0)\naws_internet_gateway.practice2-igw: Refreshing state... (ID: igw-0ecf986b)\naws_subnet.practice2-trust-1c: Refreshing state... (ID: subnet-871cccdf)\naws_subnet.practice2-trust-1a: Refreshing state... (ID: subnet-21c24b57)\naws_route_table.practice2-dmz-1a: Refreshing state... (ID: rtb-05c74b61)\naws_route_table.practice2-dmz-1c: Refreshing state... (ID: rtb-04c74b60)\naws_route_table_association.practice2-dmz-1c: Refreshing state... (ID: rtbassoc-8c3001e8)\naws_nat_gateway.practice2-natgw: Refreshing state... (ID: nat-0ef9a3396c1bd932e)\naws_instance.stg-bastion: Refreshing state... (ID: i-************)\naws_route_table.practice2-trust-1c: Refreshing state... (ID: rtb-e0c74b84)\naws_route_table.practice2-trust-1a: Refreshing state... (ID: rtb-e1c74b85)\naws_route_table_association.practice2-trust-1c: Refreshing state... (ID: rtbassoc-72330216)\naws_route_table_association.practice2-trust-1a: Refreshing state... (ID: rtbassoc-71330215)\naws_route_table_association.practice2-dmz-1a: Refreshing state... (ID: rtbassoc-8d3001e9)\naws_route_table_association.practice2-dmz-1a: Destroying...\naws_route_table_association.practice2-trust-1a: Destroying...\naws_route_table_association.practice2-dmz-1c: Destroying...\naws_route_table_association.practice2-trust-1c: Destroying...\naws_instance.stg-bastion: Destroying...\naws_route_table_association.practice2-trust-1c: Destruction complete\naws_subnet.practice2-trust-1c: Destroying...\naws_route_table_association.practice2-dmz-1a: Destruction complete\naws_route_table.practice2-trust-1c: Destroying...\naws_route_table.practice2-dmz-1a: Destroying...\naws_route_table_association.practice2-trust-1a: Destruction complete\naws_route_table.practice2-trust-1a: Destroying...\naws_subnet.practice2-trust-1a: Destroying...\naws_subnet.practice2-trust-1a: Destruction complete\naws_subnet.practice2-trust-1c: Destruction complete\naws_route_table_association.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-dmz-1c: Destroying...\naws_subnet.practice2-dmz-1c: Destroying...\naws_route_table.practice2-trust-1a: Destruction complete\naws_subnet.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-dmz-1c: Destruction complete\naws_route_table.practice2-trust-1c: Destruction complete\naws_nat_gateway.practice2-natgw: Destroying...\naws_route_table.practice2-dmz-1a: Destruction complete\naws_internet_gateway.practice2-igw: Destroying...\naws_instance.stg-bastion: Still destroying... (10s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (10s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (10s elapsed)\naws_instance.stg-bastion: Still destroying... (20s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (20s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (20s elapsed)\naws_instance.stg-bastion: Still destroying... (30s elapsed)\naws_instance.stg-bastion: Destruction complete\naws_security_group.ssh-limited: Destroying...\naws_security_group.ssh-limited: Destruction complete\naws_nat_gateway.practice2-natgw: Still destroying... (30s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (30s elapsed)\naws_nat_gateway.practice2-natgw: Still destroying... (40s elapsed)\naws_internet_gateway.practice2-igw: Still destroying... (40s elapsed)\naws_internet_gateway.practice2-igw: Destruction complete\naws_nat_gateway.practice2-natgw: Still destroying... (50s elapsed)\naws_nat_gateway.practice2-natgw: Destruction complete\naws_subnet.practice2-dmz-1a: Destroying...\naws_eip.natgw: Destroying...\naws_eip.natgw: Destruction complete\naws_subnet.practice2-dmz-1a: Destruction complete\naws_vpc.practice2-vpc: Destroying...\naws_vpc.practice2-vpc: Destruction complete\n\nDestroy complete! Resources: 18 destroyed.\n```\n\n* \u3082\u3063\u3068\u7de8\u96c6\u3057\u3066\u7d30\u304b\u3044\u8981\u4ef6\u306b\u6cbf\u3063\u3066\u904b\u7528\u3067\u304d\u307e\u3059\u306d\uff01\n", "tags": ["Terraform", "AWS"]}