{"context": "\u524d\u56de\u300c\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u306f\u30ca\u30a1\u30e9\u30c6\u30a3\u30d6\u306b\u300d\u306e\u7d9a\u304d\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u306f\u3058\u3081\u306b\n\u79c1\u306e\u4fe1\u6761\u306f\u300e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u7269\u8a9e\u306e\u3088\u3046\u306b\u66f8\u304f\u300f\u3067\u3059\u3002\n\u96e3\u8aad\u3001\u307e\u305f\u306f\u5197\u9577\u306b\u306a\u308a\u3084\u3059\u3044\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\u4e0a\u3067\u6b20\u304b\u305b\u306a\u3044\u306e\u304c\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3067\u3059\u3002\n\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306f\u30b2\u30fc\u30e0\u3067\u306e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u7c21\u6f54\u306b\u8868\u73fe\u3067\u304d\u3001\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u4e00\u3064\u306e\u30af\u30e9\u30b9\u5185\u306b\u7e8f\u3081\u3066\u8a18\u8ff0\u3067\u304d\u3001\u30b9\u30c6\u30fc\u30c8\u9593\u306e\u5171\u6709\u30c7\u30fc\u30bf\u3092\u7c21\u5358\u306b\u4fdd\u6301\u3067\u304d\u308b\u4fbf\u5229\u306a\u624b\u6cd5\u3067\u3059\u3002\n\u4eca\u5ea6\u306f\u3053\u306e\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3092\u3082\u3046\u4e00\u5de5\u592b\u3057\u3001\u3010\u30d0\u30c3\u30c1\u51e6\u7406\u3011\u3078\u5bfe\u5fdc\u3059\u308b\u624b\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30c8\u306e\u30d0\u30c3\u30c1\u51e6\u7406\n\u30b9\u30c6\u30fc\u30c8\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u306f\u3001\u3042\u3089\u304b\u3058\u3081\u4e00\u9023\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u4ed8\u304d\u3067\u767b\u9332\u3057\u3066\u304a\u304d\u3001\u305d\u308c\u3092\u81ea\u52d5\u3067\u4e00\u6c17\u306b\u51e6\u7406\u3057\u307e\u3059\u3002\n\u203b\u305f\u3060\u3057\u30b9\u30c6\u30fc\u30c8\u306f\u540c\u6642\u306b\u8907\u6570\u3092\u5b9f\u884c\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30b9\u30c6\u30fc\u30c8\u306e\u5b8c\u4e86\u3092\u5f85\u3063\u3066\u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3010\u540c\u671f\u51e6\u7406\u3011\u3068\u3057\u307e\u3059\u3002\n\n\u767b\u9332\u95a2\u6570\u3010Command\u3011\n\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u306e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u306f\u3001\u30b9\u30c6\u30fc\u30c8\u540d\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e00\u7d44\u3068\u306a\u308a\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u767b\u9332\u95a2\u6570\u304cCommand\u3067\u3059\u3002\n\u66f8\u5f0f\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n    Command(\u30b9\u30c6\u30fc\u30c8\u540d,[\u30d1\u30e9\u30e1\u30fc\u30bf[,...]]);\n\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6226\u95d8\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\u2460 \u30ab\u30e1\u30e9\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\"\u30de\u30ea\u30fc\"\u306b\u8a2d\u5b9a\u3057\u30010.2\u79d2\u3067\u30d5\u30a9\u30fc\u30ab\u30b9\u5b8c\u4e86\n\u2461 \u6b66\u5668\"UZI\" \u3067\uff12\u56de\u653b\u6483\n\u2462 \u6b66\u5668\"\u624b\u88cf\u5263\" \u3067\uff11\u56de\u653b\u6483\n\u2463 \u30bf\u30fc\u30f3\u5236\u5fa1\u3078\nCommand\u95a2\u6570\u3092\u4f7f\u3044\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3067\u51e6\u7406\u3092\u8868\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\n   Command(S_FOCUS,\"MARRY\",0.2);      //\u30ab\u30e1\u30e9\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\"\u30de\u30ea\u30fc\"\u306b\u8a2d\u5b9a\u3057\u30010.2\u79d2\u3067\u30d5\u30a9\u30fc\u30ab\u30b9\u5b8c\u4e86\n   Command(S_ATTACK,\"UZI\",2);         //\u6b66\u5668\"UZI\" \u3067\uff12\u56de\u653b\u6483\n   Command(S_ATTACK,\"SHURIKEN\",1);    //\u6b66\u5668\"\u624b\u88cf\u5263\" \u3067\uff11\u56de\u653b\u6483\n   Command(S_TURN_CONTROL);           //\u30bf\u30fc\u30f3\u5236\u5fa1\u3078\n\n\u4e0a\u8a18\u306e\u901a\u308a\u5206\u304b\u308a\u6613\u304f\u8868\u73fe\u3067\u304d\u3001\u30b9\u30c6\u30fc\u30c8\u304c\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6271\u3046\u3053\u3068\u3067\u3001\u6c4e\u7528\u6027\u306e\u9ad8\u3044\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306b\u30d0\u30c3\u30c1\u7528\u306e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u3068\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\n\u524d\u56de\u7d39\u4ecb\u3057\u305f\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3092\u30d0\u30c3\u30c1\u51e6\u7406\u7528\u306b\u6539\u9020\u3057\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u6642\u9593\u3092\u5f15\u6570\u306b\n\u524d\u56de\u306e\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306e\u300e\u521d\u56de\u547c\u51fa\u3057\u3092\u77e5\u3089\u305b\u308b'bool\u5024'\u300f\u304c\u3001\u300e\u30b9\u30c6\u30fc\u30c8\u6642\u9593'float\u5024'\u300f\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\u30b2\u30fc\u30e0\u306b\u304a\u3044\u3066\u306f\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u6271\u3046\u3053\u3068\u304c\u591a\u3044\u305f\u3081\u3001\u300e\u30b9\u30c6\u30fc\u30c8\u6642\u9593\uff08\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u306e\u7d4c\u904e\u6642\u9593\uff09\u300f\u304c\u3042\u308b\u3068\u4f55\u304b\u3068\u4fbf\u5229\u306a\u306e\u3067\u3059\u3002\n\u6700\u521d\u306e\u66f4\u65b0\u6642\u3092\uff10\u79d2\u3068\u3057\u3001\u305d\u306e\u5f8c\u306f\u7d4c\u904e\u6642\u9593\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u5f15\u6570\u306e\u8ffd\u52a0\n\u767b\u9332\u6642\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u308b\u305f\u3081\u306e\u5f15\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30c8\u6642\u9593\uff10\u304c\u521d\u671f\u51e6\u7406\u306e\u30bf\u30a4\u30df\u30f3\u30b0\n\u5ec3\u6b62\u3055\u308c\u305fbool\u5024\u306b\u4ee3\u308f\u308a\u3001\u30b9\u30c6\u30fc\u30c8\u6642\u9593\u304c\uff10\u306e\u6642\u306b\u521d\u671f\u5316\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u7d42\u4e86\u901a\u77e5\u306e\u8ffd\u52a0\n\u30b9\u30c6\u30fc\u30c8\u306e\u7d42\u4e86\u901a\u77e5\u95a2\u6570\u3010Done\u3011\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u306f\u7ba1\u7406\u30af\u30e9\u30b9\u304c\u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u3088\u3063\u3066\u300e\u524d\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306e\u6b21\u30b9\u30c6\u30fc\u30c8\u6307\u5b9a\u95a2\u6570\u3010Goto\u3011\u306f\u5ec3\u6b62\u3057\u307e\u3059\u3002\n\n\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u8a18\u3057\u307e\u3059\u3002\n    void S_HOGE(float t,string p1, string p2) //\u4f8b\u3068\u3057\u3066string\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\uff12\u500b\u306b\u9650\u5b9a\n    {\n        if (t == 0)\n        {\n            //\u521d\u671f\u51e6\u7406\n        }\n        else\n        {\n            //\u66f4\u65b0\u51e6\u7406\n\n            if (\u7d42\u4e86\uff1f){\n                Done(); //\u30b9\u30c6\u30fc\u30c8\u5b8c\u4e86\u901a\u77e5\n            }\n        }\n    }\n\n\n\u30d0\u30c3\u30c1\u7528\u306b\u30b9\u30c6\u30fc\u30c8\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u6539\u9020\n\u7ba1\u7406\u30af\u30e9\u30b9\u306b\u300e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u3068\u5b9f\u884c\u6a5f\u80fd\u300f\u3092\u8ffd\u52a0\u3057\u3001\u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u7528\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u300e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u3068\u5b9f\u884c\u6a5f\u80fd\u300f\u306e\u8ffd\u52a0\n\u30b9\u30c6\u30fc\u30c8\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e00\u7d44\u306e\u30a2\u30a4\u30c6\u30e0\u3068\u3057\u3001\u305d\u306e\u767b\u9332\u30ad\u30e5\u30fc\u304c\u7528\u610f\u3055\u308c\u307e\u3059\u3002\n\u767b\u9332\u95a2\u6570\u3010Command\u3011\u304c\u3001\u767b\u9332\u30ad\u30e5\u30fc\u3078\u306e\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002\n\u66f4\u65b0\u95a2\u6570\u3010Update\u3011\u306f\u3001\u5b9f\u884c\u4e2d\u30b9\u30c6\u30fc\u30c8\u304c\u306a\u3044\u5834\u5408\u306b\u3001\u767b\u9332\u30ad\u30e5\u30fc\u304b\u3089\u6b21\u30a2\u30a4\u30c6\u30e0\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\u6b21\u30a2\u30a4\u30c6\u30e0\u306e\u30b9\u30c6\u30fc\u30c8\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5b9f\u884c\u7528\u3068\u3057\u3066\u53d6\u308a\u6271\u308f\u308c\u307e\u3059\u3002\n\n\u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3078\u306e\u5bfe\u5fdc\n\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\uff08\u7d4c\u904e\uff09\u6642\u9593(m_elapsed)\u304c\u30e1\u30f3\u30d0\u5909\u6570\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30b9\u30c6\u30fc\u30c8\u306e\u521d\u56de\u66f4\u65b0\u6642\u306b\uff10\u3001\u305d\u308c\u4ee5\u964d\u306f\u66f4\u65b0\u6642\u9593\u306e\u5dee\u5206\u3092\u52a0\u7b97\u3057\u305f\u5024\u306b\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\u30b9\u30c6\u30fc\u30c8\u306e\u5b8c\u4e86\u901a\u77e5\u3092\u3059\u308bDone\u95a2\u6570\u304c\u7528\u610f\u3055\u308c\u307e\u3059\u3002\n\n\u30d0\u30c3\u30c1\u7528\u7ba1\u7406\u30af\u30e9\u30b9\u3010\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u3011\u306e\u8a18\u8ff0\u4f8b (Unity)\n\u4f8b\u3068\u3057\u3066Unity\u3067\u4f5c\u6210\u3057\u305f\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\u30bd\u30fc\u30b9\u4e0a\u3067\u306f\u30d0\u30c3\u30c1\u7528\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u3001\u90fd\u5408\u4e0a\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\u3068\u547d\u540d\u3057\u3066\u3044\u307e\u3059\u3002\n\nStateSequencer.cs\npublic class StateSequencer {\n\n    public class Item {\n        public Action<float, string, string> state; //\u4f8b\u3068\u3057\u3066\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\uff12\u500b\n        public string p1;\n        public string p2;\n    }\n\n    Queue<Item> m_queue; //\u4fdd\u6301\u7528\u30ad\u30e5\u30fc\n    float m_elapsed;     //\u30b9\u30c6\u30fc\u30c8\u7d4c\u904e\u6642\u9593\n\n    Item m_curState;     //\u73fe\u5728\u5b9f\u884c\u4e2d\u30bb\u30c3\u30c8\n    Item m_nextState;    //\u6b21\u5b9f\u884c\u306e\u30bb\u30c3\u30c8\n\n    public StateSequencer()\n    { \n        m_queue = new Queue<Item>();\n        m_curState  = null;\n        m_nextState = null;\n    }\n\n    //\u5b9f\u884c\u767b\u9332\n    public void Command(Action<float,string,string> func,string p1=null, string p2=null)\n    {\n        var i = new Item();\n        i.state = func;\n        i.p1 = p1;\n        i.p2 = p2;\n        m_queue.Enqueue(i);\n    }\n\n    //\u66f4\u65b0\u51e6\u7406\u3000\u4e0a\u4f4d\u95a2\u6570\u304b\u3089\u66f4\u65b0\u6642\u547c\u3073\u51fa\u3057\u3092\u60f3\u5b9a\n    public void Update()\n    {\n        m_elapsed += Time.deltaTime;\n\n        if (m_curState == null)\n        {\n            if (m_queue.Count != 0)\n            {\n                m_nextState = m_queue.Dequeue();\n            }\n        }\n        if (m_nextState != null)\n        {\n            m_curState  = m_nextState;\n            m_nextState = null;\n            m_elapsed = 0;\n        }\n        if(m_curState != null)\n        {\n            m_curState.state(m_elapsed, m_curState.p1, m_curState.p2);\n        }\n    }\n\n    //\u30b9\u30c6\u30fc\u30c8\u306e\u7d42\u4e86\u544a\u77e5\u7528\n    public void Done()\n    {\n        m_curState = null;\n    }\n}\n\n\n\n\n\u4f7f\u7528\u4f8b (Unity)\n\u30b5\u30f3\u30d7\u30eb\u306e\u6982\u8981\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\nStart()\u306b\u3066\u3001\u5b9f\u884c\u3059\u308b\u30b9\u30c6\u30fc\u30c8\u3092\u767b\u9332\u3002\n\u4ee5\u4e0b\u306e\uff14\u3064\u30b9\u30c6\u30fc\u30c8\u3092Command\u3067\u547c\u3073\u51fa\u3059\u3002\nS_START : \u5f15\u6570\u306a\u3057\u3001\uff11\u79d2\u5f85\u3061\nS_WORK1 : \u5f15\u6570\uff11\u500b\u3001\u5f15\u6570\u8868\u793a\u3001\uff11\u79d2\u5f85\u3061\u3000\u2026\u3000\u5f15\u6570\u3092\u5909\u3048\uff12\u56de\u547c\u51fa\u3057\nS_WORK2 : \u5f15\u6570\uff12\u500b\u3001\u5f15\u6570\u8868\u793a\u3001\uff12\u756a\u76ee\u5f15\u6570\u306e\u6307\u5b9a\u6642\u9593\u5f85\u3061\u3000\u2026\u3000\u5f15\u6570\u3092\u5909\u3048\uff12\u56de\u547c\u51fa\u3057\nS_END   : \u5f15\u6570\u306a\u3057\u3001\u5f15\u6570\u8868\u793a\u3001\uff11\u79d2\u5f85\u3061\nUpdate()\u306b\u3066\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u306e\u66f4\u65b0\u95a2\u6570(Update)\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001\uff23\uff03\u306b\u3088\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u4f8b\u3068\u306a\u308a\u307e\u3059\u3002\n\nHoge.cs\npublic class Hoge : MonoBehaviour {\n\n    StateSequencer m_ss;\n\n    void Start()\n    {\n        m_ss = new StateSequencer();\n\n        // \u51e6\u7406\u306e\u767b\u9332\n        m_ss.Command(S_START);\n\n        m_ss.Command(S_WORK1, \"1st\");\n        m_ss.Command(S_WORK1, \"2nd\");\n        m_ss.Command(S_WORK2, \"3rd\",\"0.5\");\n        m_ss.Command(S_WORK2, \"4th\", \"0.2\");\n\n        m_ss.Command(S_END);\n\n    }\n\n    void Update()\n    {\n        m_ss.Update();\n    }\n\n    // \u4ee5\u4e0b\u3001\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\n    void S_START(float t,string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_START Initailize\");\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_WORK1(float t, string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_WORK1 Initialize :\" );\n            Debug.Log(\">PARAM=\" + p1);\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_WORK2(float t, string p1, string p2)\n    {\n        string s = p1;\n        float wait = float.Parse(p2);\n\n        if (t == 0)\n        {\n            Debug.Log(\"S_WORK2 Initialize :\");\n            Debug.Log(\">PARAM=\" + s + \",\" + wait);\n        }\n        else if (t > wait)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_END(float t, string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_END Initailize\");\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n}\n\n\n\n\nC++\u306e\u5834\u5408\nC++\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc (C++)\n\nStateSequencer.hpp\ntemplate<typename  T> class StateSequencer\n{\npublic:\n    typedef void (T::*STATE_T)(float t, char* p1, char *p2);//\u4f8b\u3068\u3057\u3066char*\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\uff12\u500b\n    struct Item { \n        STATE_T state; \n        char *p1; \n        char *p2; \n    };\n\nprivate:\n    T *m_base;\n\n    queue<Item*>    m_queue;\n    float          m_elapsed;\n\n    Item           *m_curState;\n    Item           *m_nextState;\n\npublic:\n    StateSequencer(T *base)\n        :\n        m_base(base),\n        m_queue(),\n        m_elapsed(0),\n        m_curState(NULL),\n        m_nextState(NULL) {}\n\n        // \u30b9\u30c6\u30fc\u30c8\u767b\u9332\n    void Command(STATE_T state, char *p1 = NULL, char *p2 = NULL)\n    {\n        Item* i = new Item();\n        i->state = state;\n        i->p1    = p1;\n        i->p2    = p2;\n        m_queue.push(i);\n    }\n        //\u66f4\u65b0\u95a2\u6570\u3000\u4e0a\u4f4d\u95a2\u6570\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u4e8b\u3092\u60f3\u5b9a\n    void Update()\n    {\n        m_elapsed += 0.016f; // 1/60 sec\n\n        if (m_curState == NULL)\n        {\n            if (!m_queue.empty())\n            {\n                m_nextState = m_queue.front();\n                m_queue.pop();\n            }\n            if (m_nextState != NULL)\n            {\n                m_curState = m_nextState;\n                m_nextState = NULL;\n                m_elapsed = 0;\n            }\n        }\n\n        if (m_curState != NULL)\n        {\n            (m_base->*(m_curState->state))(m_elapsed, m_curState->p1, m_curState->p2);\n        }\n    }\n\n    void Done()\n    {\n        if (m_curState != NULL)\n        {\n            free(m_curState);\n            m_curState = NULL;\n        }\n    }\n};\n\n\n\n\u4f7f\u7528\u4f8b (C++)\n\nHoge.cpp\n#include <stdio.h>\n#include <stdlib.h>\n#include <queue>\n#include <Windows.h>\n\nusing namespace std;\n\n#include \"StateSequencer.h\"\n\n\nclass HOGE\n{\n    StateSequencer<HOGE> m_ss;\n#define STATE(X)    (&HOGE::X) \n\npublic:\n\n    HOGE() : m_ss(this) {}\n\n    void Start()\n    {\n                // \u51e6\u7406\u306e\u767b\u9332\n\n        m_ss.Command(STATE(S_START));\n\n        m_ss.Command(STATE(S_WORK1), \"1st\");\n        m_ss.Command(STATE(S_WORK1), \"2nd\");\n        m_ss.Command(STATE(S_WORK2), \"3rd\", \"0.5\");\n        m_ss.Command(STATE(S_WORK2), \"4th\", \"0.2\");\n\n        m_ss.Command(STATE(S_END));\n    }\n    void Update()\n    {\n        m_ss.Update();\n    }\n\nprivate:\n\n        // \u4ee5\u4e0b\u3001\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\n    void S_START(float t, char* p1, char *p2)\n    {\n        if (t == 0)\n        {\n            printf(\"S_START Initialize\\n\");\n        }\n        else\n        {\n            if (t>1) m_ss.Done();\n        }\n    }\n    void S_WORK1(float t, char *p1, char *p2)\n    {\n        if (t == 0) {\n            printf(\"S_WORK Initialize\\n\");\n            printf(\">PARAM=%s\\n\", p1);\n        }\n        else\n        {\n            if (t > 1) m_ss.Done();\n        }\n    }\n    void S_WORK2(float t, char *p1, char *p2)\n    {\n        char *s = p1;\n        double wait = atof(p2);\n\n        if (t == 0) {\n            printf(\"S_WORK2 Initialize\\n\");\n            printf(\">PARAM=%s,%f\\n\", s, wait);\n        }\n        else\n        {\n            if (t > wait) m_ss.Done();\n        }\n    }\n    void S_END(float t, char *p1, char *p2)\n    {\n        if (t == 0) {\n            printf(\"S_END Initialize\\n\");\n        }\n        else\n        {\n            if (t > 1) m_ss.Done();\n        }\n    }\n};\n\nint main()\n{\n    HOGE task;\n    task.Start();\n\n    while (true)\n    {\n        Sleep(16);\n        task.Update();\n    }\n\n    return 0;\n}\n\n\n\n\n\u6700\u5f8c\u306b\n\n\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u300f\u306b\u3064\u3044\u3066\n\u30d0\u30c3\u30c1\u51e6\u7406\u306f\u300e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u90e8\u54c1\u5316\u300f\u3057\u3001\u300e\u30d7\u30ed\u30b0\u30e9\u30e0\u5185\u306b\u30d0\u30c3\u30c1\u3068\u3057\u3066\u8a18\u8ff0\u300f\u3057\u3066\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u4f5c\u696d\u3092\u6357\u3089\u305b\u308b\u5927\u5909\u4fbf\u5229\u306a\u624b\u6cd5\u3067\u3059\u3002\n\u3055\u3089\u306b\u5916\u90e8\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306e\u767b\u9332\u3092\u53ef\u80fd\u306b\u3059\u308c\u3070\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066\u306e\u5fdc\u7528\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u5316\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30de\u4ee5\u5916\u306e\u30c1\u30fc\u30e0\u30e1\u30f3\u30d0\u3068\u306e\u30c7\u30fc\u30bf\u9023\u643a\u3092\u7c21\u5358\u306b\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u300e\u30b9\u30c6\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u300f\u3068\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\n\u524d\u56de\u306e\u8a18\u4e8b\u3067\u7d39\u4ecb\u3057\u305f\u624b\u6cd5\u3092\uff08\u7ba1\u7406\u30af\u30e9\u30b9\u540d\u304b\u3089\uff09\u300e\u30b9\u30c6\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u300f\u3001\u4eca\u56de\u3092\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\u7d39\u4ecb\u3057\u305f\uff12\u3064\u306e\u624b\u6cd5\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u5927\u6982\u306e\u30b2\u30fc\u30e0\u306e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3088\u308d\u3057\u3051\u308c\u3070\u3001\u3069\u3046\u305e\u3054\u81ea\u7531\u306b\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002\n\u4ee5\u4e0a\n\u524d\u56de[\u300c\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u306f\u30ca\u30a1\u30e9\u30c6\u30a3\u30d6\u306b\u300d](http://qiita.com/tohmas/items/4fde6c9370dac5f19e55)\u306e\u7d9a\u304d\u306b\u306a\u308a\u307e\u3059\u3002\n\n#\u306f\u3058\u3081\u306b\n\n\u79c1\u306e\u4fe1\u6761\u306f\u300e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u7269\u8a9e\u306e\u3088\u3046\u306b\u66f8\u304f\u300f\u3067\u3059\u3002\n\n\u96e3\u8aad\u3001\u307e\u305f\u306f\u5197\u9577\u306b\u306a\u308a\u3084\u3059\u3044\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\u4e0a\u3067\u6b20\u304b\u305b\u306a\u3044\u306e\u304c\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3067\u3059\u3002\n\n\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306f\u30b2\u30fc\u30e0\u3067\u306e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u7c21\u6f54\u306b\u8868\u73fe\u3067\u304d\u3001\u8907\u6570\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u4e00\u3064\u306e\u30af\u30e9\u30b9\u5185\u306b\u7e8f\u3081\u3066\u8a18\u8ff0\u3067\u304d\u3001\u30b9\u30c6\u30fc\u30c8\u9593\u306e\u5171\u6709\u30c7\u30fc\u30bf\u3092\u7c21\u5358\u306b\u4fdd\u6301\u3067\u304d\u308b\u4fbf\u5229\u306a\u624b\u6cd5\u3067\u3059\u3002\n\n\u4eca\u5ea6\u306f\u3053\u306e\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3092\u3082\u3046\u4e00\u5de5\u592b\u3057\u3001\u3010\u30d0\u30c3\u30c1\u51e6\u7406\u3011\u3078\u5bfe\u5fdc\u3059\u308b\u624b\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n#\u30b9\u30c6\u30fc\u30c8\u306e\u30d0\u30c3\u30c1\u51e6\u7406\n\n\u30b9\u30c6\u30fc\u30c8\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u306f\u3001\u3042\u3089\u304b\u3058\u3081\u4e00\u9023\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u4ed8\u304d\u3067\u767b\u9332\u3057\u3066\u304a\u304d\u3001\u305d\u308c\u3092\u81ea\u52d5\u3067\u4e00\u6c17\u306b\u51e6\u7406\u3057\u307e\u3059\u3002\n\n\u203b\u305f\u3060\u3057\u30b9\u30c6\u30fc\u30c8\u306f\u540c\u6642\u306b\u8907\u6570\u3092\u5b9f\u884c\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30b9\u30c6\u30fc\u30c8\u306e\u5b8c\u4e86\u3092\u5f85\u3063\u3066\u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3010\u540c\u671f\u51e6\u7406\u3011\u3068\u3057\u307e\u3059\u3002\n\n### \u767b\u9332\u95a2\u6570\u3010Command\u3011\n\n\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u306e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u306f\u3001\u30b9\u30c6\u30fc\u30c8\u540d\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e00\u7d44\u3068\u306a\u308a\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n\u305d\u306e\u767b\u9332\u95a2\u6570\u304cCommand\u3067\u3059\u3002\n\n\u66f8\u5f0f\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n    Command(\u30b9\u30c6\u30fc\u30c8\u540d,[\u30d1\u30e9\u30e1\u30fc\u30bf[,...]]);\n```\n\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6226\u95d8\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u6307\u5b9a\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n\u2460 \u30ab\u30e1\u30e9\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\"\u30de\u30ea\u30fc\"\u306b\u8a2d\u5b9a\u3057\u30010.2\u79d2\u3067\u30d5\u30a9\u30fc\u30ab\u30b9\u5b8c\u4e86\n\u2461 \u6b66\u5668\"UZI\" \u3067\uff12\u56de\u653b\u6483\n\u2462 \u6b66\u5668\"\u624b\u88cf\u5263\" \u3067\uff11\u56de\u653b\u6483\n\u2463 \u30bf\u30fc\u30f3\u5236\u5fa1\u3078\n\nCommand\u95a2\u6570\u3092\u4f7f\u3044\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3067\u51e6\u7406\u3092\u8868\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```c#:\n   Command(S_FOCUS,\"MARRY\",0.2);      //\u30ab\u30e1\u30e9\u30d5\u30a9\u30fc\u30ab\u30b9\u3092\"\u30de\u30ea\u30fc\"\u306b\u8a2d\u5b9a\u3057\u30010.2\u79d2\u3067\u30d5\u30a9\u30fc\u30ab\u30b9\u5b8c\u4e86\n   Command(S_ATTACK,\"UZI\",2);         //\u6b66\u5668\"UZI\" \u3067\uff12\u56de\u653b\u6483\n   Command(S_ATTACK,\"SHURIKEN\",1);    //\u6b66\u5668\"\u624b\u88cf\u5263\" \u3067\uff11\u56de\u653b\u6483\n   Command(S_TURN_CONTROL);           //\u30bf\u30fc\u30f3\u5236\u5fa1\u3078\n```\n\n\u4e0a\u8a18\u306e\u901a\u308a\u5206\u304b\u308a\u6613\u304f\u8868\u73fe\u3067\u304d\u3001\u30b9\u30c6\u30fc\u30c8\u304c\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6271\u3046\u3053\u3068\u3067\u3001\u6c4e\u7528\u6027\u306e\u9ad8\u3044\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u53ef\u80fd\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u6b21\u306b\u30d0\u30c3\u30c1\u7528\u306e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u3068\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n#\u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\n\n\u524d\u56de\u7d39\u4ecb\u3057\u305f\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3092\u30d0\u30c3\u30c1\u51e6\u7406\u7528\u306b\u6539\u9020\u3057\u307e\u3059\u3002\n\n### \u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u6642\u9593\u3092\u5f15\u6570\u306b\n\n\u524d\u56de\u306e\u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306e\u300e\u521d\u56de\u547c\u51fa\u3057\u3092\u77e5\u3089\u305b\u308b'bool\u5024'\u300f\u304c\u3001\u300e\u30b9\u30c6\u30fc\u30c8\u6642\u9593'float\u5024'\u300f\u306b\u5909\u308f\u308a\u307e\u3059\u3002\n\n\u30b2\u30fc\u30e0\u306b\u304a\u3044\u3066\u306f\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u6271\u3046\u3053\u3068\u304c\u591a\u3044\u305f\u3081\u3001\u300e\u30b9\u30c6\u30fc\u30c8\u6642\u9593\uff08\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u306e\u7d4c\u904e\u6642\u9593\uff09\u300f\u304c\u3042\u308b\u3068\u4f55\u304b\u3068\u4fbf\u5229\u306a\u306e\u3067\u3059\u3002\n\n\u6700\u521d\u306e\u66f4\u65b0\u6642\u3092\uff10\u79d2\u3068\u3057\u3001\u305d\u306e\u5f8c\u306f\u7d4c\u904e\u6642\u9593\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n### \u30d1\u30e9\u30e1\u30fc\u30bf\u5f15\u6570\u306e\u8ffd\u52a0\n\n\u767b\u9332\u6642\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d7\u3051\u308b\u305f\u3081\u306e\u5f15\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n### \u30b9\u30c6\u30fc\u30c8\u6642\u9593\uff10\u304c\u521d\u671f\u51e6\u7406\u306e\u30bf\u30a4\u30df\u30f3\u30b0\n\n\u5ec3\u6b62\u3055\u308c\u305fbool\u5024\u306b\u4ee3\u308f\u308a\u3001\u30b9\u30c6\u30fc\u30c8\u6642\u9593\u304c\uff10\u306e\u6642\u306b\u521d\u671f\u5316\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002\n\n### \u7d42\u4e86\u901a\u77e5\u306e\u8ffd\u52a0\n\n\u30b9\u30c6\u30fc\u30c8\u306e\u7d42\u4e86\u901a\u77e5\u95a2\u6570\u3010Done\u3011\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30d0\u30c3\u30c1\u51e6\u7406\u3067\u306f\u7ba1\u7406\u30af\u30e9\u30b9\u304c\u6b21\u306e\u30b9\u30c6\u30fc\u30c8\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u3088\u3063\u3066\u300e\u524d\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u306e\u6b21\u30b9\u30c6\u30fc\u30c8\u6307\u5b9a\u95a2\u6570\u3010Goto\u3011\u306f\u5ec3\u6b62\u3057\u307e\u3059\u3002\n\n### \u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\n\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u8a18\u3057\u307e\u3059\u3002\n\n```\n    void S_HOGE(float t,string p1, string p2) //\u4f8b\u3068\u3057\u3066string\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\uff12\u500b\u306b\u9650\u5b9a\n    {\n        if (t == 0)\n        {\n            //\u521d\u671f\u51e6\u7406\n        }\n        else\n        {\n            //\u66f4\u65b0\u51e6\u7406\n\n            if (\u7d42\u4e86\uff1f){\n                Done(); //\u30b9\u30c6\u30fc\u30c8\u5b8c\u4e86\u901a\u77e5\n            }\n        }\n    }\n```\n\n#\u30d0\u30c3\u30c1\u7528\u306b\u30b9\u30c6\u30fc\u30c8\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u6539\u9020\n\n\u7ba1\u7406\u30af\u30e9\u30b9\u306b\u300e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u3068\u5b9f\u884c\u6a5f\u80fd\u300f\u3092\u8ffd\u52a0\u3057\u3001\u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u7528\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n\n### \u300e\u30b9\u30c6\u30fc\u30c8\u767b\u9332\u3068\u5b9f\u884c\u6a5f\u80fd\u300f\u306e\u8ffd\u52a0\n\n\u30b9\u30c6\u30fc\u30c8\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4e00\u7d44\u306e\u30a2\u30a4\u30c6\u30e0\u3068\u3057\u3001\u305d\u306e\u767b\u9332\u30ad\u30e5\u30fc\u304c\u7528\u610f\u3055\u308c\u307e\u3059\u3002\n\n\u767b\u9332\u95a2\u6570\u3010Command\u3011\u304c\u3001\u767b\u9332\u30ad\u30e5\u30fc\u3078\u306e\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u66f4\u65b0\u95a2\u6570\u3010Update\u3011\u306f\u3001\u5b9f\u884c\u4e2d\u30b9\u30c6\u30fc\u30c8\u304c\u306a\u3044\u5834\u5408\u306b\u3001\u767b\u9332\u30ad\u30e5\u30fc\u304b\u3089\u6b21\u30a2\u30a4\u30c6\u30e0\u3092\u53d6\u308a\u51fa\u3057\u307e\u3059\u3002\n\n\n\u6b21\u30a2\u30a4\u30c6\u30e0\u306e\u30b9\u30c6\u30fc\u30c8\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5b9f\u884c\u7528\u3068\u3057\u3066\u53d6\u308a\u6271\u308f\u308c\u307e\u3059\u3002\n\n### \u300e\u30d0\u30c3\u30c1\u7528\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u300f\u3078\u306e\u5bfe\u5fdc\n\n\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\uff08\u7d4c\u904e\uff09\u6642\u9593(m_elapsed)\u304c\u30e1\u30f3\u30d0\u5909\u6570\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30b9\u30c6\u30fc\u30c8\u306e\u521d\u56de\u66f4\u65b0\u6642\u306b\uff10\u3001\u305d\u308c\u4ee5\u964d\u306f\u66f4\u65b0\u6642\u9593\u306e\u5dee\u5206\u3092\u52a0\u7b97\u3057\u305f\u5024\u306b\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n\u30b9\u30c6\u30fc\u30c8\u306e\u5b8c\u4e86\u901a\u77e5\u3092\u3059\u308bDone\u95a2\u6570\u304c\u7528\u610f\u3055\u308c\u307e\u3059\u3002\n\n### \u30d0\u30c3\u30c1\u7528\u7ba1\u7406\u30af\u30e9\u30b9\u3010\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u3011\u306e\u8a18\u8ff0\u4f8b (Unity)\n\n\u4f8b\u3068\u3057\u3066Unity\u3067\u4f5c\u6210\u3057\u305f\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\n\u30bd\u30fc\u30b9\u4e0a\u3067\u306f\u30d0\u30c3\u30c1\u7528\u7ba1\u7406\u30af\u30e9\u30b9\u3092\u3001\u90fd\u5408\u4e0a\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\u3068\u547d\u540d\u3057\u3066\u3044\u307e\u3059\u3002\n\n```c#:StateSequencer.cs\npublic class StateSequencer {\n\n    public class Item {\n        public Action<float, string, string> state; //\u4f8b\u3068\u3057\u3066\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\uff12\u500b\n        public string p1;\n        public string p2;\n    }\n\n    Queue<Item> m_queue; //\u4fdd\u6301\u7528\u30ad\u30e5\u30fc\n    float m_elapsed;     //\u30b9\u30c6\u30fc\u30c8\u7d4c\u904e\u6642\u9593\n\n    Item m_curState;     //\u73fe\u5728\u5b9f\u884c\u4e2d\u30bb\u30c3\u30c8\n    Item m_nextState;    //\u6b21\u5b9f\u884c\u306e\u30bb\u30c3\u30c8\n\n    public StateSequencer()\n    { \n        m_queue = new Queue<Item>();\n        m_curState  = null;\n        m_nextState = null;\n    }\n\n    //\u5b9f\u884c\u767b\u9332\n    public void Command(Action<float,string,string> func,string p1=null, string p2=null)\n    {\n        var i = new Item();\n        i.state = func;\n        i.p1 = p1;\n        i.p2 = p2;\n        m_queue.Enqueue(i);\n    }\n\n    //\u66f4\u65b0\u51e6\u7406\u3000\u4e0a\u4f4d\u95a2\u6570\u304b\u3089\u66f4\u65b0\u6642\u547c\u3073\u51fa\u3057\u3092\u60f3\u5b9a\n    public void Update()\n    {\n        m_elapsed += Time.deltaTime;\n\n        if (m_curState == null)\n        {\n            if (m_queue.Count != 0)\n            {\n                m_nextState = m_queue.Dequeue();\n            }\n        }\n        if (m_nextState != null)\n        {\n            m_curState  = m_nextState;\n            m_nextState = null;\n            m_elapsed = 0;\n        }\n        if(m_curState != null)\n        {\n            m_curState.state(m_elapsed, m_curState.p1, m_curState.p2);\n        }\n    }\n\n    //\u30b9\u30c6\u30fc\u30c8\u306e\u7d42\u4e86\u544a\u77e5\u7528\n    public void Done()\n    {\n        m_curState = null;\n    }\n}\n\n```\n\n\n### \u4f7f\u7528\u4f8b (Unity)\n\n\u30b5\u30f3\u30d7\u30eb\u306e\u6982\u8981\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\nStart()\u306b\u3066\u3001\u5b9f\u884c\u3059\u308b\u30b9\u30c6\u30fc\u30c8\u3092\u767b\u9332\u3002\n\u4ee5\u4e0b\u306e\uff14\u3064\u30b9\u30c6\u30fc\u30c8\u3092Command\u3067\u547c\u3073\u51fa\u3059\u3002\n\nS_START : \u5f15\u6570\u306a\u3057\u3001\uff11\u79d2\u5f85\u3061\nS_WORK1 : \u5f15\u6570\uff11\u500b\u3001\u5f15\u6570\u8868\u793a\u3001\uff11\u79d2\u5f85\u3061\u3000\u2026\u3000\u5f15\u6570\u3092\u5909\u3048\uff12\u56de\u547c\u51fa\u3057\nS_WORK2 : \u5f15\u6570\uff12\u500b\u3001\u5f15\u6570\u8868\u793a\u3001\uff12\u756a\u76ee\u5f15\u6570\u306e\u6307\u5b9a\u6642\u9593\u5f85\u3061\u3000\u2026\u3000\u5f15\u6570\u3092\u5909\u3048\uff12\u56de\u547c\u51fa\u3057\nS_END   : \u5f15\u6570\u306a\u3057\u3001\u5f15\u6570\u8868\u793a\u3001\uff11\u79d2\u5f85\u3061\n\nUpdate()\u306b\u3066\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u306e\u66f4\u65b0\u95a2\u6570(Update)\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u3001\uff23\uff03\u306b\u3088\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u4f8b\u3068\u306a\u308a\u307e\u3059\u3002\n\n```c#:Hoge.cs\npublic class Hoge : MonoBehaviour {\n\n    StateSequencer m_ss;\n\n    void Start()\n    {\n        m_ss = new StateSequencer();\n\n        // \u51e6\u7406\u306e\u767b\u9332\n        m_ss.Command(S_START);\n\n        m_ss.Command(S_WORK1, \"1st\");\n        m_ss.Command(S_WORK1, \"2nd\");\n        m_ss.Command(S_WORK2, \"3rd\",\"0.5\");\n        m_ss.Command(S_WORK2, \"4th\", \"0.2\");\n\n        m_ss.Command(S_END);\n\n    }\n\n    void Update()\n    {\n        m_ss.Update();\n    }\n\n    // \u4ee5\u4e0b\u3001\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\n    void S_START(float t,string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_START Initailize\");\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_WORK1(float t, string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_WORK1 Initialize :\" );\n            Debug.Log(\">PARAM=\" + p1);\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_WORK2(float t, string p1, string p2)\n    {\n        string s = p1;\n        float wait = float.Parse(p2);\n\n        if (t == 0)\n        {\n            Debug.Log(\"S_WORK2 Initialize :\");\n            Debug.Log(\">PARAM=\" + s + \",\" + wait);\n        }\n        else if (t > wait)\n        {\n            m_ss.Done();\n        }\n    }\n\n    void S_END(float t, string p1, string p2)\n    {\n        if (t == 0)\n        {\n            Debug.Log(\"S_END Initailize\");\n        }\n        else if (t > 1)\n        {\n            m_ss.Done();\n        }\n    }\n}\n\n```\n\n# C++\u306e\u5834\u5408\n\nC++\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n### \u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc (C++)\n\n\n```cpp:StateSequencer.hpp\ntemplate<typename  T> class StateSequencer\n{\npublic:\n\ttypedef void (T::*STATE_T)(float t, char* p1, char *p2);//\u4f8b\u3068\u3057\u3066char*\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\uff12\u500b\n\tstruct Item { \n\t\tSTATE_T state; \n\t\tchar *p1; \n\t\tchar *p2; \n\t};\n\nprivate:\n\tT *m_base;\n\n\tqueue<Item*>    m_queue;\n\tfloat          m_elapsed;\n\n\tItem           *m_curState;\n\tItem           *m_nextState;\n\npublic:\n\tStateSequencer(T *base)\n\t\t:\n\t\tm_base(base),\n\t\tm_queue(),\n\t\tm_elapsed(0),\n\t\tm_curState(NULL),\n\t\tm_nextState(NULL) {}\n        \n        // \u30b9\u30c6\u30fc\u30c8\u767b\u9332\n\tvoid Command(STATE_T state, char *p1 = NULL, char *p2 = NULL)\n\t{\n\t\tItem* i = new Item();\n\t\ti->state = state;\n\t\ti->p1    = p1;\n\t\ti->p2    = p2;\n\t\tm_queue.push(i);\n\t}\n        //\u66f4\u65b0\u95a2\u6570\u3000\u4e0a\u4f4d\u95a2\u6570\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u308b\u4e8b\u3092\u60f3\u5b9a\n\tvoid Update()\n\t{\n\t\tm_elapsed += 0.016f; // 1/60 sec\n\n\t\tif (m_curState == NULL)\n\t\t{\n\t\t\tif (!m_queue.empty())\n\t\t\t{\n\t\t\t\tm_nextState = m_queue.front();\n\t\t\t\tm_queue.pop();\n\t\t\t}\n\t\t\tif (m_nextState != NULL)\n\t\t\t{\n\t\t\t\tm_curState = m_nextState;\n\t\t\t\tm_nextState = NULL;\n\t\t\t\tm_elapsed = 0;\n\t\t\t}\n\t\t}\n\n\t\tif (m_curState != NULL)\n\t\t{\n\t\t\t(m_base->*(m_curState->state))(m_elapsed, m_curState->p1, m_curState->p2);\n\t\t}\n\t}\n\n\tvoid Done()\n\t{\n\t\tif (m_curState != NULL)\n\t\t{\n\t\t\tfree(m_curState);\n\t\t\tm_curState = NULL;\n\t\t}\n\t}\n};\n```\n\n###\u4f7f\u7528\u4f8b (C++)\n\n```cpp:Hoge.cpp\n#include <stdio.h>\n#include <stdlib.h>\n#include <queue>\n#include <Windows.h>\n\nusing namespace std;\n\n#include \"StateSequencer.h\"\n\n\nclass HOGE\n{\n\tStateSequencer<HOGE> m_ss;\n#define STATE(X)    (&HOGE::X) \n\npublic:\n\n\tHOGE() : m_ss(this) {}\n\n\tvoid Start()\n\t{\n                // \u51e6\u7406\u306e\u767b\u9332\n\n\t\tm_ss.Command(STATE(S_START));\n\n\t\tm_ss.Command(STATE(S_WORK1), \"1st\");\n\t\tm_ss.Command(STATE(S_WORK1), \"2nd\");\n\t\tm_ss.Command(STATE(S_WORK2), \"3rd\", \"0.5\");\n\t\tm_ss.Command(STATE(S_WORK2), \"4th\", \"0.2\");\n\n\t\tm_ss.Command(STATE(S_END));\n\t}\n\tvoid Update()\n\t{\n\t\tm_ss.Update();\n\t}\n\nprivate:\n\n        // \u4ee5\u4e0b\u3001\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\n\n\tvoid S_START(float t, char* p1, char *p2)\n\t{\n\t\tif (t == 0)\n\t\t{\n\t\t\tprintf(\"S_START Initialize\\n\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (t>1) m_ss.Done();\n\t\t}\n\t}\n\tvoid S_WORK1(float t, char *p1, char *p2)\n\t{\n\t\tif (t == 0) {\n\t\t\tprintf(\"S_WORK Initialize\\n\");\n\t\t\tprintf(\">PARAM=%s\\n\", p1);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (t > 1) m_ss.Done();\n\t\t}\n\t}\n\tvoid S_WORK2(float t, char *p1, char *p2)\n\t{\n\t\tchar *s = p1;\n\t\tdouble wait = atof(p2);\n\n\t\tif (t == 0) {\n\t\t\tprintf(\"S_WORK2 Initialize\\n\");\n\t\t\tprintf(\">PARAM=%s,%f\\n\", s, wait);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (t > wait) m_ss.Done();\n\t\t}\n\t}\n\tvoid S_END(float t, char *p1, char *p2)\n\t{\n\t\tif (t == 0) {\n\t\t\tprintf(\"S_END Initialize\\n\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (t > 1) m_ss.Done();\n\t\t}\n\t}\n};\n\nint main()\n{\n\tHOGE task;\n\ttask.Start();\n\n\twhile (true)\n\t{\n\t\tSleep(16);\n\t\ttask.Update();\n\t}\n\n\treturn 0;\n}\n\n```\n\n\n\n#\u6700\u5f8c\u306b\n\n### \u300e\u30b9\u30c6\u30fc\u30c8\u95a2\u6570\u306e\u30d0\u30c3\u30c1\u51e6\u7406\u300f\u306b\u3064\u3044\u3066\n\n\u30d0\u30c3\u30c1\u51e6\u7406\u306f\u300e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u90e8\u54c1\u5316\u300f\u3057\u3001\u300e\u30d7\u30ed\u30b0\u30e9\u30e0\u5185\u306b\u30d0\u30c3\u30c1\u3068\u3057\u3066\u8a18\u8ff0\u300f\u3057\u3066\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u4f5c\u696d\u3092\u6357\u3089\u305b\u308b\u5927\u5909\u4fbf\u5229\u306a\u624b\u6cd5\u3067\u3059\u3002\n\n\u3055\u3089\u306b\u5916\u90e8\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306e\u767b\u9332\u3092\u53ef\u80fd\u306b\u3059\u308c\u3070\u3001\u30b9\u30af\u30ea\u30d7\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3057\u3066\u306e\u5fdc\u7528\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u5316\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30de\u4ee5\u5916\u306e\u30c1\u30fc\u30e0\u30e1\u30f3\u30d0\u3068\u306e\u30c7\u30fc\u30bf\u9023\u643a\u3092\u7c21\u5358\u306b\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n### \u300e\u30b9\u30c6\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u300f\u3068\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\n\n\u524d\u56de\u306e\u8a18\u4e8b\u3067\u7d39\u4ecb\u3057\u305f\u624b\u6cd5\u3092\uff08\u7ba1\u7406\u30af\u30e9\u30b9\u540d\u304b\u3089\uff09\u300e\u30b9\u30c6\u30fc\u30c8\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u300f\u3001\u4eca\u56de\u3092\u300e\u30b9\u30c6\u30fc\u30c8\u30b7\u30fc\u30b1\u30f3\u30b5\u30fc\u300f\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u3002\n\n\u7d39\u4ecb\u3057\u305f\uff12\u3064\u306e\u624b\u6cd5\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u5927\u6982\u306e\u30b2\u30fc\u30e0\u306e\u30b9\u30c6\u30fc\u30c8\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u3088\u308d\u3057\u3051\u308c\u3070\u3001\u3069\u3046\u305e\u3054\u81ea\u7531\u306b\u6d3b\u7528\u304f\u3060\u3055\u3044\u3002\n\n\u4ee5\u4e0a\n", "tags": ["game", "gamedev", "C++", "Unity", "C#"]}