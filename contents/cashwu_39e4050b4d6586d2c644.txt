{"tags": ["SQLServer"], "context": " More than 1 year has passed since last update.\u4eca\u5929\u5beb\u7a0b\u5f0f\u6642\uff0c\u9047\u5230\u50b3\u7d66 SqlServer \u7684SP\u53c3\u6578\uff0c\u4e0d\u77e5\u9053\u662f\u8981\u4f7f\u7528 DateTime.Now \u6bd4\u8f03\u597d\uff0c\u9084\u662f\u4f7f\u7528 DateTime.Today \u6bd4\u8f03\u597d\u3002\u5982\u679c Where \u689d\u4ef6\u5c31\u53ea\u8981\u7b49\u65bc\u90a3\u4e00\u5929\u5c31\u597d\u4e86\uff0c\u5f9e\u9019\u500b\u65b9\u9762\u4f86\u770b\uff0c\u597d\u50cf\u4f7f\u7528 DateTime.Today \u6703\u6bd4\u8f03\u597d\u4e5f\u6bd4\u8f03\u76f4\u89ba\uff0c\u771f\u7684\u662f\u9019\u6a23\u5b50\u55ce ?? \u8b93\u6211\u5011\u770b\u4e0b\u53bb\u3002\n\u6240\u4ee5\u5c31\u5beb\u500b\u5c0f\u6e2c\u8a66\u7a0b\u5f0f\u4f86\u770b\u4e00\u4e0b\u4e0d\u540c\u7684\u5dee\u7570\u3002\n\u4e0b\u9762\u70ba Table \u7684 Schema \u548c \u6e2c\u8a66\u8cc7\u6599\n\n\n\u4e0b\u9762\u70ba\u6e2c\u8a66\u7684\u4e09\u500b SP\uff0c\u539f\u5247\u4e0a\u5c31\u50b3\u5165\u6642\u7684\u53c3\u6578\u578b\u614b\u4e0d\u540c\u800c\u5df2 (\u5c0d\u61c9\u5230 Table \u88e1\u9762\u7684\u4e09\u500b\u6642\u9593\u7684\u578b\u614b)\n\n\n\n\u4e0b\u9762\u70ba\u4f7f\u7528 Linqpad \u6e2c\u8a66\u7684\u56de\u50b3\u7d50\u679c\n\n\n\n\u5176\u5be6\u5f88\u660e\u986f\u53ef\u4ee5\u770b\u7684\u51fa\u4f86\uff0c\u5982\u679c\u53ea\u662f\u4f7f\u7528\u7b49\u65bc\u7684\u8a71\uff0c\u9664\u975e\u50b3\u5165\u53c3\u6578\u7684\u578b\u614b\u548c\u8cc7\u6599\u6b04\u4f4d\u7684\u578b\u614b\u4e00\u6a23\u90fd\u662f Date\uff0c\n\u800c\u4e14\u7a0b\u5f0f\u7aef\u9700\u8981\u4f7f\u7528 DateTime.Today \u50b3\u5165\uff0c\u4e0d\u7136\u7684\u8a71\u90fd\u67e5\u4e0d\u5230\u8cc7\u6599\u3002\u6240\u4ee5\u5176\u5be6\u5f71\u97ff\u67e5\u8a62\u7684\u91cd\u9ede\u6709\u4e09\u500b\uff1a\u7a0b\u5f0f\u7aef\u53c3\u6578\u3001SP\u53c3\u6578\u548c\u8cc7\u6599\u6b04\u4f4d\uff0c\u4e0d\u5149\u53ea\u6709\u7a0b\u5f0f\u7aef\u6ce8\u610f\u5c31\u597d\u4e86\uff0cSP\u4e5f\u662f\u5f88\u5927\u7684\u91cd\u9ede\u3002\n\u5982\u679c\u4ee5\u7a0b\u5f0f\u7aef\u4e0d\u7ba1\u8cc7\u6599\u7aef\u600e\u9ebc\u5beb\u7684\u8a71\uff0c\u5176\u5be6\u7a0b\u5f0f\u7aef\u61c9\u8a72\u662f\u4f7f\u7528\u90a3\u4e00\u500b\u4f86\u50b3\u90fd\u6c92\u6709\u5dee\uff0c\u4e5f\u5c31\u662f\u8aaa\u4f60\u6839\u672c\u4e0d\u77e5\u9053(\u4e0d\u5728\u610f) SP \u662f\u7528\u4ec0\u9ebc\u578b\u614b\u4f86\u63a5\u53c3\u6578\u7684\u3002\u5176\u5be6\u7ad9\u5728 SP \u7684\u89d2\u5ea6\u4f86\u770b\u7684\u8a71\uff0c\u61c9\u8a72\u4e5f\u662f\u4e0d\u7ba1\u7a0b\u5f0f\u7aef\u50b3\u4ec0\u9ebc\u6211\u9084\u662f\u8981\u67e5\u7684\u5230\u8cc7\u6599\uff0c\u6240\u4ee5\uff0c\u6211\u89ba\u5f97\u9019\u500b\u554f\u984c\u7684\u91cd\u9ede\u61c9\u8a72\u662f SP \u8981\u600e\u9ebc Design \u6703\u6bd4\u8f03\u597d\uff0c\u800c\u4e14\u6bd4\u8f03\u67e5\u7684\u5230\u8cc7\u6599\uff0c\n\u4e0b\u9762\u70ba\u4fee\u6539\u5f8c\u7684 SP\uff1a\nDECLARE  @fromDate Date, @toDate DATE;\n\nSET @fromDate = DATEADD(dd ,DATEDIFF(dd, 0, @date), 0); -- \u53ea\u6709\u65e5\u671f\u6c92\u6709\u6642\u9593\nSET @toDate = DATEADD(dd ,DATEDIFF(dd, 0, @date), 1); -- \u53ea\u6709\u65e5\u671f\u6c92\u6709\u6642\u9593\n\nSELECT @date;\nSELECT @fromDate;\nSELECT @toDate;\n\nSELECT * FROM Test t\nWHERE t.Date >= @fromDate AND t.Date < @toDate;\n\nSELECT * FROM Test t\nWHERE t.SmallDateTime >= @fromDate AND t.SmallDateTime < @toDate;\n\nSELECT * FROM Test t\nWHERE t.DateTime >= @fromDate AND t.DateTime < @toDate;\n\n\u7528\u9019\u7a2e\u65b9\u5f0f\u7684\u8a71\uff0c\u5c31\u90fd\u53ef\u4ee5\u67e5\u7684\u5230\u8cc7\u6599\uff0c\u4e5f\u4e0d\u7528\u5728\u610f SP \u4f7f\u7528\u4ec0\u9ebc Parameter \u6216\u662f\u7a0b\u5f0f\u7aef\u50b3\u4ec0\u9ebc\u9032\u4f86\u4e86\u3002\n\u4eca\u5929\u5beb\u7a0b\u5f0f\u6642\uff0c\u9047\u5230\u50b3\u7d66 SqlServer \u7684SP\u53c3\u6578\uff0c\u4e0d\u77e5\u9053\u662f\u8981\u4f7f\u7528 `DateTime.Now` \u6bd4\u8f03\u597d\uff0c\u9084\u662f\u4f7f\u7528 `DateTime.Today` \u6bd4\u8f03\u597d\u3002\u5982\u679c `Where` \u689d\u4ef6\u5c31\u53ea\u8981\u7b49\u65bc\u90a3\u4e00\u5929\u5c31\u597d\u4e86\uff0c\u5f9e\u9019\u500b\u65b9\u9762\u4f86\u770b\uff0c\u597d\u50cf\u4f7f\u7528 `DateTime.Today` \u6703\u6bd4\u8f03\u597d\u4e5f\u6bd4\u8f03\u76f4\u89ba\uff0c\u771f\u7684\u662f\u9019\u6a23\u5b50\u55ce ?? \u8b93\u6211\u5011\u770b\u4e0b\u53bb\u3002\n\n\u6240\u4ee5\u5c31\u5beb\u500b\u5c0f\u6e2c\u8a66\u7a0b\u5f0f\u4f86\u770b\u4e00\u4e0b\u4e0d\u540c\u7684\u5dee\u7570\u3002\n\n\u4e0b\u9762\u70ba Table \u7684 Schema \u548c \u6e2c\u8a66\u8cc7\u6599\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_01-1445961825720.png)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_02-1445961837692.png)\n\n\u4e0b\u9762\u70ba\u6e2c\u8a66\u7684\u4e09\u500b SP\uff0c\u539f\u5247\u4e0a\u5c31\u50b3\u5165\u6642\u7684\u53c3\u6578\u578b\u614b\u4e0d\u540c\u800c\u5df2 (\u5c0d\u61c9\u5230 Table \u88e1\u9762\u7684\u4e09\u500b\u6642\u9593\u7684\u578b\u614b)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_03-1445961940947.png)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_04-1445961956718.png)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_05-1445961921266.png)\n\n\u4e0b\u9762\u70ba\u4f7f\u7528 Linqpad \u6e2c\u8a66\u7684\u56de\u50b3\u7d50\u679c\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_06-1445962169374.png)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_07-1445962176311.png)\n\n![](https://cashghostblog.s3.amazonaws.com/2015/Oct/sqlserver_storeprocedure_input_date_parameter_08-1445962183850.png)\n\n\u5176\u5be6\u5f88\u660e\u986f\u53ef\u4ee5\u770b\u7684\u51fa\u4f86\uff0c\u5982\u679c\u53ea\u662f\u4f7f\u7528\u7b49\u65bc\u7684\u8a71\uff0c\u9664\u975e\u50b3\u5165\u53c3\u6578\u7684\u578b\u614b\u548c\u8cc7\u6599\u6b04\u4f4d\u7684\u578b\u614b\u4e00\u6a23\u90fd\u662f `Date`\uff0c\n\u800c\u4e14\u7a0b\u5f0f\u7aef\u9700\u8981\u4f7f\u7528 `DateTime.Today` \u50b3\u5165\uff0c\u4e0d\u7136\u7684\u8a71\u90fd\u67e5\u4e0d\u5230\u8cc7\u6599\u3002\u6240\u4ee5\u5176\u5be6\u5f71\u97ff\u67e5\u8a62\u7684\u91cd\u9ede\u6709\u4e09\u500b\uff1a\u7a0b\u5f0f\u7aef\u53c3\u6578\u3001SP\u53c3\u6578\u548c\u8cc7\u6599\u6b04\u4f4d\uff0c\u4e0d\u5149\u53ea\u6709\u7a0b\u5f0f\u7aef\u6ce8\u610f\u5c31\u597d\u4e86\uff0cSP\u4e5f\u662f\u5f88\u5927\u7684\u91cd\u9ede\u3002\n\n\u5982\u679c\u4ee5\u7a0b\u5f0f\u7aef\u4e0d\u7ba1\u8cc7\u6599\u7aef\u600e\u9ebc\u5beb\u7684\u8a71\uff0c\u5176\u5be6\u7a0b\u5f0f\u7aef\u61c9\u8a72\u662f\u4f7f\u7528\u90a3\u4e00\u500b\u4f86\u50b3\u90fd\u6c92\u6709\u5dee\uff0c\u4e5f\u5c31\u662f\u8aaa\u4f60\u6839\u672c\u4e0d\u77e5\u9053(\u4e0d\u5728\u610f) SP \u662f\u7528\u4ec0\u9ebc\u578b\u614b\u4f86\u63a5\u53c3\u6578\u7684\u3002\u5176\u5be6\u7ad9\u5728 SP \u7684\u89d2\u5ea6\u4f86\u770b\u7684\u8a71\uff0c\u61c9\u8a72\u4e5f\u662f\u4e0d\u7ba1\u7a0b\u5f0f\u7aef\u50b3\u4ec0\u9ebc\u6211\u9084\u662f\u8981\u67e5\u7684\u5230\u8cc7\u6599\uff0c\u6240\u4ee5\uff0c\u6211\u89ba\u5f97\u9019\u500b\u554f\u984c\u7684\u91cd\u9ede\u61c9\u8a72\u662f SP \u8981\u600e\u9ebc Design \u6703\u6bd4\u8f03\u597d\uff0c\u800c\u4e14\u6bd4\u8f03\u67e5\u7684\u5230\u8cc7\u6599\uff0c\n\n\u4e0b\u9762\u70ba\u4fee\u6539\u5f8c\u7684 SP\uff1a\n\n```\nDECLARE  @fromDate Date, @toDate DATE;\n\t\nSET @fromDate = DATEADD(dd ,DATEDIFF(dd, 0, @date), 0); -- \u53ea\u6709\u65e5\u671f\u6c92\u6709\u6642\u9593\nSET @toDate = DATEADD(dd ,DATEDIFF(dd, 0, @date), 1); -- \u53ea\u6709\u65e5\u671f\u6c92\u6709\u6642\u9593\n\nSELECT @date;\nSELECT @fromDate;\nSELECT @toDate;\n\nSELECT * FROM Test t\nWHERE t.Date >= @fromDate AND t.Date < @toDate;\n\nSELECT * FROM Test t\nWHERE t.SmallDateTime >= @fromDate AND t.SmallDateTime < @toDate;\n\nSELECT * FROM Test t\nWHERE t.DateTime >= @fromDate AND t.DateTime < @toDate;\n```\n\n\u7528\u9019\u7a2e\u65b9\u5f0f\u7684\u8a71\uff0c\u5c31\u90fd\u53ef\u4ee5\u67e5\u7684\u5230\u8cc7\u6599\uff0c\u4e5f\u4e0d\u7528\u5728\u610f SP \u4f7f\u7528\u4ec0\u9ebc Parameter \u6216\u662f\u7a0b\u5f0f\u7aef\u50b3\u4ec0\u9ebc\u9032\u4f86\u4e86\u3002\n"}