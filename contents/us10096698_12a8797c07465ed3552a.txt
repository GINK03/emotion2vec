{"context": " More than 1 year has passed since last update.\u5165\u9580Chef Solo\u306e\u52c9\u5f373\u56de\u76ee\u3067\u3059\u3002\nWeb\u30b5\u30fc\u30d0(nginx)\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3059\u3002\n\ncookbook\u4f5c\u6210\n\u65b0\u898f\u306bcookbook\u3092\u4f5c\u308a\u307e\u3059\u3002\nvagrant@precise64:~/chef-repo$ knife cookbook create nginx -o cookbooks\n** Creating cookbook nginx\n** Creating README for cookbook: nginx\n** Creating CHANGELOG for cookbook: nginx\n** Creating metadata for cookbook: nginx\n\n\n\u30ec\u30b7\u30d4\u7de8\u96c6\n\u30ec\u30b7\u30d4\u30d5\u30a1\u30a4\u30ebcookbooks/nginx/recipes/default.rb\u3092\u7de8\u96c6\u3057\u3066nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u8a18\u8ff0\u3092\u884c\u3044\u307e\u3059\u3002nginx.conf\u3092erb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u7528\u610f\u3057\u3066\u304a\u304d\u3001\u30ec\u30b7\u30d4\u306b\u305d\u308c\u3092\u4f7f\u3046\u3088\u3046\u306b\u66f8\u3044\u3066\u304a\u304f\u3068\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304cnginx.conf\u3068\u3057\u3066\u6307\u5b9a\u30d1\u30b9\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\ndefault.rb\n#\n# Cookbook Name:: nginx\n# Recipe:: default\n#\n# Copyright 2013, YOUR_COMPANY_NAME\n#\n# All rights reserved - Do Not Redistribute\n#\npackage \"nginx\" do\n        action :install\nend\n\nservice \"nginx\" do\n        supports:status=>true,:restart=> true,:reload=>true\n        action [:enable,:start]\nend\n\ntemplate \"nginx.conf\" do\n        path \"/etc/nginx/nginx.conf\"\n        source \"nginx.conf.erb\"\n        owner \"root\"\n        group \"root\"\n        mode 0644\n        notifies :reload,'service[nginx]'\nend\n\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30ebcookbooks/nginx/templates/default/nginx.conf.erb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nnginx.conf.erb\nuser nginx;\nworker_processes 1;\nerror_log /var/log/nginx/error.log;\npid     /var/run/nginx.pid;\n\nevents {\n        worker_connections 1024;\n}\n\nhttp {\n        include /etc/nginx/mime.types;\n        default_type application/octet-stream;\n\n        server {\n                listen  <%=node['nginx']['port'] %>;\n                server_name localhost;\n                location / {\n                        root /usr/share/nginx/html;\n                        index index.html index.htm;\n                }\n        }\n}\n\n\n<% \u301c %>\u306f\u5909\u6570\u5c55\u958b\u8981\u306e\u30bf\u30b0\u3067\u3059\u3002\u3053\u306e\u5909\u6570\u90e8\u5206\u306f\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308bJSON\u30d5\u30a1\u30a4\u30eb(\u5f8c\u8ff0)\u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30dd\u30fc\u30c8\u306fChef\u5b9f\u884c\u6642\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u624b\u3092\u5165\u308c\u308b\u3053\u3068\u306a\u304f\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nJSON\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\"nginx\"\u30ce\u30fc\u30c9\u306e\"port\"\u5c5e\u6027\u306b 80 \u756a\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u3001nginx.conf\u5c55\u958b\u6642\u306b\u5148\u307b\u3069\u306e\u5909\u6570\u30bf\u30b0\u90e8\u5206\u304c 80 \u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\n\nnginx.json\n{\n        \"nginx\":{\n                \"port\":80\n        },\n\n        \"run_list\":[\n                \"nginx\"\n        ]\n}\n\n\n\n\u5b9f\u884c\n\u5148\u307b\u3069\u306eJSON\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\nvagrant@precise64:~/chef-repo$ sudo chef-solo -c config.rb -j ./nginx.json\nStarting Chef Client, version 11.6.2\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: nginx::default\n  * package[nginx] action install\n================================================================================\nError executing action `install` on resource 'package[nginx]'\n================================================================================\n\n\nChef::Exceptions::Exec\n----------------------\napt-get -q -y install nginx=1.1.19-1ubuntu0.1 returned 100, expected 0\n\n\nResource Declaration:\n---------------------\n# In /home/vagrant/chef-repo/cookbooks/nginx/recipes/default.rb\n\n  9: package \"nginx\" do\n 10:    action :install\n 11: end\n 12: \n\n\n\nCompiled Resource:\n------------------\n# Declared in /home/vagrant/chef-repo/cookbooks/nginx/recipes/default.rb:9:in `from_file'\n\npackage(\"nginx\") do\n  action [:install]\n  retries 0\n  retry_delay 2\n  package_name \"nginx\"\n  version \"1.1.19-1ubuntu0.1\"\n  cookbook_name :nginx\n  recipe_name \"default\"\nend\n\n\n\n[2013-10-19T18:49:18-07:00] ERROR: Running exception handlers\n[2013-10-19T18:49:18-07:00] ERROR: Exception handlers complete\n[2013-10-19T18:49:18-07:00] FATAL: Stacktrace dumped to /tmp/chef-solo/chef-stacktrace.out\nChef Client failed. 0 resources updated\n[2013-10-19T18:49:18-07:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\u30b0\u30b0\u3063\u305f\u3068\u3053\u308d\u3001\u4f3c\u305f\u3088\u3046\u306aQA\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u3002\nnginx\u306e\u6307\u5b9a\u30d0\u30fc\u30b8\u30e7\u30f3\u304capt\u306e\u30ea\u30b9\u30c8\u4e0a\u306b\u898b\u3064\u304b\u3089\u306a\u3044\u306e\u304c\u539f\u56e0\u306a\u306e\u3067\u3001\u5148\u306b$sudo apt-get update\u3057\u3066\u30ea\u30b9\u30c8\u3092\u66f4\u65b0\u3057\u3066\u304a\u3051\u3070\u3044\u3044\u3067\u3059\u3088\u3001\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u306b\u518d\u6311\u6226\u3002\nvagrant@precise64:~/chef-repo$ sudo chef-solo -c config.rb -j ./nginx.json\nStarting Chef Client, version 11.6.2\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: nginx::default\n  * package[nginx] action install\n    - install version 1.1.19-1ubuntu0.2 of package nginx\n\n  * service[nginx] action enable (up to date)\n  * service[nginx] action start\n    - start service service[nginx]\n\n  * template[nginx.conf] action create\n    - update content in file /etc/nginx/nginx.conf from 38154b to 406356\n        --- /etc/nginx/nginx.conf   2012-03-28 19:50:24.000000000 -0700\n        +++ /tmp/chef-rendered-template20131019-6018-1tfg5gj    2013-10-19 19:22:46.336623985 -0700\n        @@ -1,95 +1,23 @@\n        -user www-data;\n        -worker_processes 4;\n        -pid /var/run/nginx.pid;\n        +user nginx;\n        +worker_processes 1;\n        +error_log /var/log/nginx/error.log\n        +pid    /var/run/nginx.pid;\n\n        -events {\n        -   worker_connections 768;\n        -   # multi_accept on;\n        +events{\n        +   worker_connections 1024;\n         }\n \uff08\u7701\u7565\uff09\n\n\u4eca\u5ea6\u306f\u3046\u307e\u304f\u5165\u308a\u307e\u3057\u305f\u3002\nnginx.conf\u304c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(+JSON\u306eAttribute)\u3067\u6307\u5b9a\u3057\u305f\u5185\u5bb9\u3067\u7f6e\u304d\u63db\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u30bf\u30a4\u30dd\u3068\u306e\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u7d30\u304b\u3044\u30ed\u30b0\u306f\u7701\u7565\u3057\u3066\u307e\u3059\u3002\n\u30db\u30b9\u30c8\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089\u3053\u306eVM\u306e80\u756a\u30dd\u30fc\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001nginx\u306e\u30b9\u30bf\u30fc\u30c8\u30da\u30fc\u30b8(Welcome to nginx\uff01)\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n[\u5165\u9580Chef Solo](http://www.amazon.co.jp/%E5%85%A5%E9%96%80Chef-Solo-Infrastructure-as-Code-ebook/dp/B00BSPH158)\u306e\u52c9\u5f373\u56de\u76ee\u3067\u3059\u3002\nWeb\u30b5\u30fc\u30d0(nginx)\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u307e\u3059\u3002\n\n## cookbook\u4f5c\u6210\n\n\u65b0\u898f\u306bcookbook\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```Bash:\nvagrant@precise64:~/chef-repo$ knife cookbook create nginx -o cookbooks\n** Creating cookbook nginx\n** Creating README for cookbook: nginx\n** Creating CHANGELOG for cookbook: nginx\n** Creating metadata for cookbook: nginx\n```\n## \u30ec\u30b7\u30d4\u7de8\u96c6\n\n\u30ec\u30b7\u30d4\u30d5\u30a1\u30a4\u30eb`cookbooks/nginx/recipes/default.rb`\u3092\u7de8\u96c6\u3057\u3066nginx\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3001\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u8a18\u8ff0\u3092\u884c\u3044\u307e\u3059\u3002`nginx.conf`\u3092erb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u7528\u610f\u3057\u3066\u304a\u304d\u3001\u30ec\u30b7\u30d4\u306b\u305d\u308c\u3092\u4f7f\u3046\u3088\u3046\u306b\u66f8\u3044\u3066\u304a\u304f\u3068\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c`nginx.conf`\u3068\u3057\u3066\u6307\u5b9a\u30d1\u30b9\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\n```default.rb\n#\n# Cookbook Name:: nginx\n# Recipe:: default\n#\n# Copyright 2013, YOUR_COMPANY_NAME\n#\n# All rights reserved - Do Not Redistribute\n#\npackage \"nginx\" do\n        action :install\nend\n\nservice \"nginx\" do\n        supports:status=>true,:restart=> true,:reload=>true\n        action [:enable,:start]\nend\n\ntemplate \"nginx.conf\" do\n        path \"/etc/nginx/nginx.conf\"\n        source \"nginx.conf.erb\"\n        owner \"root\"\n        group \"root\"\n        mode 0644\n        notifies :reload,'service[nginx]'\nend\n```\n##\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30d5\u30a1\u30a4\u30eb`cookbooks/nginx/templates/default/nginx.conf.erb`\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```nginx.conf.erb\nuser nginx;\nworker_processes 1;\nerror_log /var/log/nginx/error.log;\npid     /var/run/nginx.pid;\n\nevents {\n        worker_connections 1024;\n}\n\nhttp {\n        include /etc/nginx/mime.types;\n        default_type application/octet-stream;\n\n        server {\n                listen  <%=node['nginx']['port'] %>;\n                server_name localhost;\n                location / {\n                        root /usr/share/nginx/html;\n                        index index.html index.htm;\n                }\n        }\n}\n```\n<% \u301c %>\u306f\u5909\u6570\u5c55\u958b\u8981\u306e\u30bf\u30b0\u3067\u3059\u3002\u3053\u306e\u5909\u6570\u90e8\u5206\u306f\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3059\u308bJSON\u30d5\u30a1\u30a4\u30eb(\u5f8c\u8ff0)\u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\u3053\u3046\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30dd\u30fc\u30c8\u306fChef\u5b9f\u884c\u6642\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u624b\u3092\u5165\u308c\u308b\u3053\u3068\u306a\u304f\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nJSON\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\"nginx\"\u30ce\u30fc\u30c9\u306e\"port\"\u5c5e\u6027\u306b 80 \u756a\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u3067\u3001`nginx.conf`\u5c55\u958b\u6642\u306b\u5148\u307b\u3069\u306e\u5909\u6570\u30bf\u30b0\u90e8\u5206\u304c 80 \u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u307e\u3059\u3002\n\n```nginx.json\n{\n        \"nginx\":{\n                \"port\":80\n        },\n\n        \"run_list\":[\n                \"nginx\"\n        ]\n}\n```\n\n## \u5b9f\u884c\n\u5148\u307b\u3069\u306eJSON\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nvagrant@precise64:~/chef-repo$ sudo chef-solo -c config.rb -j ./nginx.json\nStarting Chef Client, version 11.6.2\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: nginx::default\n  * package[nginx] action install\n================================================================================\nError executing action `install` on resource 'package[nginx]'\n================================================================================\n\n\nChef::Exceptions::Exec\n----------------------\napt-get -q -y install nginx=1.1.19-1ubuntu0.1 returned 100, expected 0\n\n\nResource Declaration:\n---------------------\n# In /home/vagrant/chef-repo/cookbooks/nginx/recipes/default.rb\n\n  9: package \"nginx\" do\n 10: \taction :install\n 11: end\n 12: \n\n\n\nCompiled Resource:\n------------------\n# Declared in /home/vagrant/chef-repo/cookbooks/nginx/recipes/default.rb:9:in `from_file'\n\npackage(\"nginx\") do\n  action [:install]\n  retries 0\n  retry_delay 2\n  package_name \"nginx\"\n  version \"1.1.19-1ubuntu0.1\"\n  cookbook_name :nginx\n  recipe_name \"default\"\nend\n\n\n\n[2013-10-19T18:49:18-07:00] ERROR: Running exception handlers\n[2013-10-19T18:49:18-07:00] ERROR: Exception handlers complete\n[2013-10-19T18:49:18-07:00] FATAL: Stacktrace dumped to /tmp/chef-solo/chef-stacktrace.out\nChef Client failed. 0 resources updated\n[2013-10-19T18:49:18-07:00] FATAL: Chef::Exceptions::ChildConvergeError: Chef run process exited unsuccessfully (exit code 1)\n```\n\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\n\u30b0\u30b0\u3063\u305f\u3068\u3053\u308d\u3001[\u4f3c\u305f\u3088\u3046\u306aQA](http://stackoverflow.com/questions/8937351/chef-isnt-running-the-apt-apt-get-update-recipe-apt-returns-100)\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f\u3002\nnginx\u306e\u6307\u5b9a\u30d0\u30fc\u30b8\u30e7\u30f3\u304capt\u306e\u30ea\u30b9\u30c8\u4e0a\u306b\u898b\u3064\u304b\u3089\u306a\u3044\u306e\u304c\u539f\u56e0\u306a\u306e\u3067\u3001\u5148\u306b`$sudo apt-get update`\u3057\u3066\u30ea\u30b9\u30c8\u3092\u66f4\u65b0\u3057\u3066\u304a\u3051\u3070\u3044\u3044\u3067\u3059\u3088\u3001\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u306b\u518d\u6311\u6226\u3002\n\n```\nvagrant@precise64:~/chef-repo$ sudo chef-solo -c config.rb -j ./nginx.json\nStarting Chef Client, version 11.6.2\nCompiling Cookbooks...\nConverging 3 resources\nRecipe: nginx::default\n  * package[nginx] action install\n    - install version 1.1.19-1ubuntu0.2 of package nginx\n\n  * service[nginx] action enable (up to date)\n  * service[nginx] action start\n    - start service service[nginx]\n\n  * template[nginx.conf] action create\n    - update content in file /etc/nginx/nginx.conf from 38154b to 406356\n        --- /etc/nginx/nginx.conf\t2012-03-28 19:50:24.000000000 -0700\n        +++ /tmp/chef-rendered-template20131019-6018-1tfg5gj\t2013-10-19 19:22:46.336623985 -0700\n        @@ -1,95 +1,23 @@\n        -user www-data;\n        -worker_processes 4;\n        -pid /var/run/nginx.pid;\n        +user nginx;\n        +worker_processes 1;\n        +error_log /var/log/nginx/error.log\n        +pid\t/var/run/nginx.pid;\n         \n        -events {\n        -\tworker_connections 768;\n        -\t# multi_accept on;\n        +events{\n        +\tworker_connections 1024;\n         }\n \uff08\u7701\u7565\uff09\n```\n\u4eca\u5ea6\u306f\u3046\u307e\u304f\u5165\u308a\u307e\u3057\u305f\u3002\nnginx.conf\u304c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8(+JSON\u306eAttribute)\u3067\u6307\u5b9a\u3057\u305f\u5185\u5bb9\u3067\u7f6e\u304d\u63db\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u30bf\u30a4\u30dd\u3068\u306e\u30d0\u30c8\u30eb\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u7d30\u304b\u3044\u30ed\u30b0\u306f\u7701\u7565\u3057\u3066\u307e\u3059\u3002\n\n\u30db\u30b9\u30c8\u306e\u30d6\u30e9\u30a6\u30b6\u7b49\u304b\u3089\u3053\u306eVM\u306e80\u756a\u30dd\u30fc\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001nginx\u306e\u30b9\u30bf\u30fc\u30c8\u30da\u30fc\u30b8(Welcome to nginx\uff01)\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n", "tags": ["chef", "chef-solo"]}