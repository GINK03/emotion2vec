{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nDevise gem \u3067\u51fa\u6765\u308b\u3053\u3068\n\nweb\u306e\u4f1a\u54e1\u767b\u9332\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u7c21\u5358\u306b\u4f5c\u308c\u308b(\u65b0\u898f\u767b\u9332\u753b\u9762\u30fblogin\u753b\u9762\u30fbetc...)\nsign_in filter\u306a\u3069\u4f1a\u54e1\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u304d\u306b\u5fc5\u8981\u306ahelper\u304c\u591a\u304f\u7528\u610f\u3055\u308c\u3066\u3044\u308b\nfacebook\u306a\u3069\u306eominiauth\u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\n\n\u3053\u3093\u306a\u3053\u3068\u304c\u51fa\u6765\u308bDevise gem\u3092\u4f7f\u3063\u3066\u307f\u305f\u3044\uff01\u3063\u3066\u3053\u3068\u3067\u8abf\u3079\u305f\u3082\u306e\u306e\u307e\u3068\u3081\u3067\u3059\u3002\u4eca\u56de\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u3092\u8abf\u3079\u307e\u3057\u305f\u306e\u3067\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u306f\u516c\u5f0f\u3068\u307b\u307c\u5909\u308f\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u2b07\u304b\u3089\u65e9\u901f\u8aac\u660e\u306b\u306a\u308a\u307e\u3059\u3002\n\ndevise\u3092\u4f7f\u3046\ndivise3.0\u306frails3.2\u4ee5\u4e0a\u3067\u52d5\u304d\u307e\u3059\u3002Gemfile\u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\ngem 'devise'\n\n\u305d\u3057\u305f\u3089bundle\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066install\u3057\u3066\u304f\u3060\u3055\u3044\ndevise\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068Gemfile\u306e\u8ffd\u52a0\u304c\u7d42\u308f\u3063\u305f\u3089generator\u3092\u8d70\u3089\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nrails generate devise:install\n\ngenarator\u306f\u3059\u3079\u3066\u306edevise\u306e\u8a2d\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u4e00\u56de\u78ba\u8a8d\u3057\u3068\u3044\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u304c\u7d42\u308f\u3063\u305f\u306e\u306a\u3089devise model\u3092\u4f7f\u3046\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\nrails generate devise MODEL\n\nMODEL\u306e\u90e8\u5206\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4f7f\u3046\u540d\u524d\u3067\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u591a\u304f\u306e\u5834\u5408\u306fUse\u3084Admin\u3068\u8a00\u3063\u305f\u3082\u306e\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u3082\u3057\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u65b0\u898f\u306bmodel\u3092\u4f5c\u308a\u3001devise\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u6b21\u306brake db:migrate\u3092\u3057\u3066migration\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\u307e\u305fgenerator\u306fDevise controller\u3092\u793a\u3059\u3088\u3046\u306b config/routes.rb\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n( \u6ce8\u610f)\u65e2\u306bapp\u3092\u4f5c\u308a\u59cb\u3081\u3066\u3044\u305f\u306e\u306a\u3089\u3084\u308a\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3055\u3082\u306a\u3051\u308c\u3070route helper\u306e\u30a8\u30e9\u30fc\u3084login\u3067\u304d\u306a\u3044\u3068\u3044\u3063\u305f\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3067\u3057\u3087\u3046\u3002\n\ncontroller\u306efilter\u3068helpers\nDevise\u306fcontroller\u3068View\u306e\u4e2d\u3067\u4f7f\u3048\u308bhelper\u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002controller\u3092set up\u3059\u308b\u3068\u304d\u306bbefore_filter\u3092\u52a0\u3048\u308b\u3060\u3051\u3067user\u304cauthenticate\u304b\u5224\u65ad\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nbefore_filter :authenticate_user!\n\nuser\u304csign_in\u3057\u3066\u3044\u308b\u304b\u5224\u65ad\u3067\u304d\u308bhelper\u3082\u3042\u308a\u307e\u3059\u3002\nuser_signed_in?\n\n\u73fe\u5728sign-in\u3057\u3066\u3044\u308buser\u3092\u5f97\u308bhelper\u3082\u3042\u308a\u307e\u3059\u3002\ncurrent_user\n\n\u307e\u305fuser\u306e\u6d3b\u52d5\u7bc4\u56f2\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\nuser_session\n\nuser\u304csign-in\u3057\u305f\u308a\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f4\u65b0\u3057\u305f\u3089root_path\u306bredirect\u3055\u308c\u307e\u3059\u3002\u4f8b\u3048\u3070user:resource\u306a\u3089\u3070user_root_path\u304c\u5b58\u5728\u3059\u308c\u3070\u305d\u3053\u306b\u3001\u306a\u3051\u308c\u3070defalt\u306eroot_path\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\nroot to: \"home#index\"\n\n\u307e\u305fafter_sign_in_path_for\u3084after_sign_out_path_for\u3092\u4f7f\u3063\u3066redirect\u5148\u3092\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u3001mailer\u306e\u70ba\u306burl_option\u3092\u3059\u3079\u3066\u306e\u74b0\u5883\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f\"config/environments/development.rb\"\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nconfig.action_mailer.default_url_options = { :host => 'localhost:3000' }\n\n(\u30e1\u30e2)\u3082\u3057user\u3068\u3044\u3063\u305f devise model \u3092\u4f7f\u308f\u305a\u306b member \u3092\u4f7f\u3046\u306e\u306a\u3089\u3070helper\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\nbefore_filter :authenticate_member!\n\nmember_signed_in?\n\ncurrent_member\n\nmember_session\n\n\nModel\u306e\u8a2d\u5b9a\nmodel\u306e devise method \u306f modules \u306e\u8a2d\u5b9a\u3092\u53d7\u3051\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u6697\u53f7\u5316\u3059\u308b\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u3044\u305f\u3044\u306e\u306a\u3089\ndevise :database_authenticatable, :registerable, :confirmable, :recoverable, :stretches => 20\n\n:stretches\u3092\u9664\u304d\u3001:pepper, :encryptor, :confirm_within, :remember_for, :timeout_in, :unlock_in, other values\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002devise:install \u304c\u4f7f\u308f\u308c\u305f\u3068\u304d\u306b\u4f5c\u3089\u308c\u305ffile\u3067\u8a73\u7d30\u3092\u898b\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u5f37\u8abf\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n\u3042\u306a\u305f\u306eview\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3068\u304d\u30d5\u30a9\u30fc\u30e0\u306b\u65b0\u3057\u3044\u7279\u5fb4\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u306esanitization\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306fRails4\u306b\u306a\u3063\u3066model\u304b\u3089controller\u306b\u79fb\u52d5\u3057\u307e\u3057\u305f\u3002Devise\u304c\u30b3\u30ec\u306b\u95a2\u3059\u308b\u6271\u3044\u3092\u3059\u308b\u3082\u306e\u306f\u540c\u69d8\u306bcontroller\u306b\u79fb\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3063\u305f\uff13\u3064\u306eaction\u3067\u3069\u3093\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u3082model\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u305d\u308c\u6545sanitization\u3092\u5fc5\u8981\u3068\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540d\u524d\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u8a31\u53ef\u306fdefault\u3067\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nsign_in((Devise::SessionsController#new) - email\u306e\u3088\u3046\u306a\u627f\u8a8d\u30ad\u30fc\u304c\u3042\u308b\u5834\u5408\u306e\u307f\u8a31\u53ef\u3055\u308c\u307e\u3059\nsign_up(Devise::RegistrationsController#create) - \u8a3c\u660e\u30ad\u30fc\u306bpassword\u3068password_confirmation\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3092\u8a31\u53ef\u3057\u307e\u3059\naccount_update(Devise::RegistrationsController#update) - \u8a3c\u660e\u30ad\u30fc\u306bpassword, password_confirmation, current_password\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002(the lazy way\u2122)\u306e\u3088\u3046\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8ffd\u52a0\u3067\u8a31\u53ef\u3057\u305f\u3044\u5834\u5408\u306fApplicationController\u306b\u7c21\u5358\u306abefore_filter\u3092\u3059\u308b\u3053\u3068\u3067\u3067\u304d\u307e\u3059\u3002\n\nclass ApplicationController < ActionController::Base\n  before_filter :configure_permitted_parameters, if: :devise_controller?\n\n  protected\n\n  def configure_permitted_parameters\n    devise_parameter_sanitizer.for(:sign_up) << :username\n  end\nend\n\ndefalt\u306e\u8a2d\u5b9a\u3092\u5b8c\u5168\u306b\u5909\u3048\u305f\u308a\u3001\u7fd2\u6163\u7684\u632f\u308b\u821e\u3044\u3092\u4f5c\u308b\u305f\u3081\u306bpass a block\u3092\u4f5c\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\ndef configure_permitted_parameters\n  devise_parameter_sanitizer.for(:sign_in) { |u| u.permit(:username, :email) }\nend\n\n\u3082\u3057\u3042\u306a\u305f\u304c\u8907\u6570\u306eDevise\u3000model\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u306a\u3089model\u3054\u3068\u306b\u7570\u306a\u3063\u305fsanitizer\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092set up\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u3001\u79c1\u305f\u3061\u306fDevise::ParameterSanitizer\u304b\u3089\u7d99\u627f\u3057\u3001\u81ea\u8eab\u306e\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\nclass User::ParameterSanitizer < Devise::ParameterSanitizer\n  def sign_in\n    default_params.permit(:username, :email)\n  end\nend\n\n\u3053\u306e\u3068\u304d\u306bcontroller\u306b\u4f7f\u3046\u3053\u3068\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nclass ApplicationController < ActionController::Base\n  protected\n\n  def devise_parameter_sanitizer\n    if resource_class == User\n      User::ParameterSanitizer.new(User, :user, params)\n    else\n      super # Use the default one\n    end\n  end\nend\n\n\u4e0a\u8a18\u306e\u4f8b\u3067\u306f:username\u3068:email\u306e\u4e21\u65b9\u3092\u4f7f\u3046\u305f\u3081\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a31\u53ef\u3057\u3066\u307e\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u611a\u304b\u3067\u306a\u3044\u65b9\u6cd5\u306fcustom controller\u306e\u4e0a\u306bbefore_filter\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u51fa\u6765\u308b\u3067\u3057\u3087\u3046\u3002\u79c1\u305f\u3061\u306f\u8a2d\u5b9a\u306e\u4ed5\u65b9\u3068controller\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u65b9\u6cd5\u3092section\u306e\u6d41\u308c\u306b\u5f93\u3063\u3066\u8a18\u8ff0\u3057\u307e\u3057\u305f\u3002\n\nView\u306e\u8a2d\u5b9a\n\u79c1\u305f\u3061\u306fDevise\u3092\u4f7f\u3044\u7c21\u5358\u306buser\u8a8d\u8a3c\u753b\u9762\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u65b9\u6cd5\u3067\u306a\u304f\u3066\u3082\u81ea\u5206\u3067\u4f5c\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002Devise\u306fengine\u3067\u3059\u304b\u3089\u3001\u3059\u3079\u3066\u306eView\u306fgem\u306e\u5185\u5074\u306b\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3089\u306eview\u306f\u4f5c\u308a\u59cb\u3081\u3092\u52a9\u3051\u308c\u304f\u308c\u307e\u3059\u304c\u3001\u5f8c\u306b\u5909\u3048\u305f\u3044\u3068\u601d\u3046\u3067\u3057\u3087\u3046\u3002\u305d\u306e\u5834\u5408\u306fgenerator\u3092\u4f7f\u3046\u3053\u3068\u3067view\u3092\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u308c\u307e\u3059\u3002\nrails generate devise:views\n\n\u3082\u3057User\u3084Admin\u3068\u3044\u3063\u305fDevise model\u304c\u3042\u308b\u306e\u306a\u3089model\u3082view\u3068\u540c\u3058\u3088\u3046\u306b\u7de8\u96c6\u3057\u305f\u3044\u3068\u601d\u3046\u3067\u3057\u3087\u3046\u3002\u5e78\u904b\u306a\u3053\u3068\u306bmodel\u3092\u6539\u9020\u3059\u308b\u306e\u306fview\u3088\u308a\u3082\u7c21\u5358\u3067\u3059\u3002\"config.scoped_views = true\"\u3092 \"config/initializers/devise.rb\"\u306e\u4e2d\u306b\u66f8\u304f\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u3059\u3002\n\u3053\u308c\u304c\u7d42\u308f\u308b\u3068\"users/sessions/new\" \u3084 \"admins/sessions/new\"\u306b\u57fa\u3065\u3044\u305fview\u3092\u6301\u3064\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 scope\u306e\u4e2d\u306bview\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3089\"devise/sessions/new\"\u3068\u3044\u3046default\u306eview\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u307e\u305f\u9078\u3093\u3060view\u3092\u4f7f\u3046\u305f\u3081\u306bgenerator\u3092\u4f7f\u3046\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\nrails generate devise:views users\n\n\ncontroller\u306e\u8a2d\u5b9a\nview\u306ecustomization\u30ec\u30d9\u30eb\u304c\u5341\u5206\u3067\u306a\u3044\u306e\u306a\u3089\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u3059\u3079\u3066\u306econtroller\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n1,Admins::SessionsController:\u306e\u3088\u3046\u306acustom controller \u3092\u4f5c\u308a\u307e\u3059\u3002\nclass Admins::SessionsController < Devise::SessionsController\nend\n\n(\u6ce8\u610f)\u3053\u306e\u4f8b\u306fapp/controller/admins/\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u65e2\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u9032\u3081\u3066\u3044\u307e\u3059\n2,\u4f7f\u3046controller\u306erouter\u3092\u66f8\u304d\u307e\u3059\ndevise_for :admins, :controllers => { :sessions => \"admins/sessions\" }\n\n3.controller\u306b\u5909\u5316\u3092\u52a0\u3048\u308b\u3068\"devise/sessions\"\u306eview\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u306e\u3067\u5fd8\u308c\u305a\u306b\"devise/sessions\"\u3092\"admins/sessions\"\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nDevise\u306fsign_in\u304c\u6210\u529f\u3057\u305f\u304b\u5931\u6557\u3057\u305f\u304bflash message\u3067user\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u899a\u3048\u3066\u3044\u3066\u304f\u3060\u3055\u3044\u3002Devise\u306f\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u304c\u9069\u5207\u306a\u306b\"flash[:notice]\"\u3084\"flash[:alert]\"\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\u3059\u3079\u3066\u306eflash hash \u3092\u51fa\u529b\u3057\u305f\u308a\u3001Devise\u306ehash key\u304b\u3089:timedout key\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u306e\u7121\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nRoutes\u306e\u8a2d\u5b9a\nDevise\u306fdafalut\u306eroutes\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057\u305d\u308c\u3089\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u5fc5\u8981\u3042\u308b\u306e\u306a\u3089devise_for method\u3092\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f :class_name, :path_prefix\u3068\u3044\u3063\u305fname_path\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\ndevise_for :users, :path => \"auth\", :path_names => { :sign_in => 'login', :sign_out => 'logout', :password => 'secret', :confirmation => 'verification', :unlock => 'unblock', :registration => 'register', :sign_up => 'cmon_let_me_in' }\n\n\u8a73\u7d30\u306fdevise_for\u3068\u3044\u3046documentation\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3082\u3057 \"/sign_in\"\u3060\u3051\u3067\u306a\u304f\"/users/sign_in\"\u306e\u3088\u3046\u306b\u3082\u3063\u3068\u6df1\u304f\u5909\u66f4\u3092\u52a0\u3048\u305f\u3044\u306e\u306a\u3089devise_scope\u3092router\u306b\u52a0\u3048\u3066\u304f\u3060\u3055\u3044\u3002\ndevise_scope :user do\n  get \"sign_in\", :to => \"devise/sessions#new\"\nend\n\n\u3053\u306e\u3088\u3046\u306b \"/sign_in\" \u3092\u3059\u308b\u3068scope\u306f:user\u306b\u9650\u5b9a\u3055\u308c\u307e\u3059\u3002(\u6ce8\u610f)devise_scope\u306f\u901a\u79f0\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\n\nI18n\nDevise\u306eflash message \u306fI18n\u3067\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nen:\n  devise:\n    sessions:\n      signed_in: 'Signed in successfully.'\n\n\u3042\u306a\u305f\u306fresourse\u306b\u57fa\u3065\u304f\u56fa\u6709\u306emessage\u3092route\u306e\u8a2d\u5b9a\u306e\u4e2d\u306b\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\nen:\n  devise:\n    sessions:\n      user:\n        signed_in: 'Welcome user, you are signed in.'\n      admin:\n        signed_in: 'Hello admin!'\n\nDevise mailer\u306fsubject message\u306b\u4f3c\u305f\u30e2\u30ce\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\nen:\n  devise:\n    mailer:\n      confirmation_instructions:\n        subject: 'Hello everybody!'\n        user_subject: 'Hello User! Please confirm your email'\n      reset_password_instructions:\n        subject: 'Reset instructions'\n\nlocal file\u3092\u898b\u308b\u3053\u3068\u3067\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u3069\u306e\u3088\u3046\u306b\u7ffb\u8a33\u3055\u308c\u3066\u3044\u308b\u304b\u8208\u5473\u304c\u3042\u308b\u306a\u3089\u3053\u306ewiki\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nhttps://github.com/plataformatec/devise/wiki/I18n\n\nTest helper\nDevise\u306fspec\u6a5f\u80fd\u3092\u4f7f\u3063\u305f\u3044\u304f\u3064\u304b\u306ehelper\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u3092\u4f7f\u3046\u306b\u306f test/test_helper.rbfile\u306b\u4ee5\u4e0b\u3092\u4ed8\u3051\u52a0\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nclass ActionController::TestCase\n  include Devise::TestHelpers\nend\n\n\u3082\u3057\u3042\u306a\u305f\u304cRspec\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306a\u3089spec/support/devise.rb:\u306e\u5185\u5074\u306b\u4ee5\u4e0b\u3092\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\nRSpec.configure do |config|\n  config.include Devise::TestHelpers, :type => :controller\nend\n\n\u3053\u308c\u3067sign_in\u3068sign_out\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3053\u308c\u306fcontroller\u3068\u540c\u3058\u69d8\u306a\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\nsign_in :user, @user   # sign_in(scope, resource)\nsign_in @user          # sign_in(resource)\n\nsign_out :user         # sign_out(scope)\nsign_out @user         # sign_out(resource)\n\n\u3042\u306a\u305f\u306f\uff12\u3064\u306e\u3053\u3068\u3092\u5fc3\u306b\u3068\u3069\u3081\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n1.\u3053\u306ehelper\u306fcapybara\u306a\u3069\u3068\u306f\u7d71\u4e00\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u6a5f\u80fd\u7684\u306a\u30c6\u30b9\u30c8\u3060\u3051\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u305d\u306e\u304b\u308f\u308auser form\u306f\u65e2\u306b\u57cb\u307e\u3063\u305f\u72b6\u614b\u3067\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\n2.\u3082\u3057Devise controller\u3084Devise\u3092\u7d99\u627f\u3057\u305fcontrolelr\u306e\u30c6\u30b9\u30c8\u3092\u3057\u305f\u3044\u306e\u306a\u3089\u3070\u3001\u4f7f\u3046\u524d\u306brequest\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002Devise\u306froutes\u304b\u3089\u60c5\u5831\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u306f\u4e0d\u53ef\u6b20\u3067\u3059\u3002\u3057\u304b\u3057\u3001test\u306frouter\u3092\u4f7f\u308f\u306a\u3044\u306e\u3067\u4f7f\u3046\u3053\u3068\u3092\u660e\u78ba\u306b\u793a\u3059\u3053\u3068\u304c\u5fc5\u8981\u3068\u6210\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001user scope\u306etest\u3092\u3057\u305f\u3044\u306e\u306a\u3089\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n@request.env[\"devise.mapping\"] = Devise.mappings[:user]\nget :new\n\n\nOmniauth\nDevise\u306fominiauth\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u4f7f\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u4f7f\u3046\u306b\u306fconfig/initializers/devise.rb\u306bominiauth\u306e\u8a2d\u5b9a\u3092\u660e\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nconfig.omniauth :github, 'APP_ID', 'APP_SECRET', :scope => 'user,public_repo'\n\nominiautho\u306e\u6a5f\u80fd\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u5c02\u7528\u306ewiki\u304c\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u826f\u304f\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\n\nhttps://github.com/plataformatec/devise/wiki/OmniAuth:-Overview\n\u79c1\u304c\u307e\u3068\u3081\u305f\u3082\u306e\n\n\nmultiple model\u8a2d\u5b9a\nDevise\u306f\u597d\u304d\u306a\u6570\u3060\u3051Devise model\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002User model \u4ee5\u5916\u306bauthentication\u3068time out\u6a5f\u80fd\u3092\u4ed8\u3051\u52a0\u3048\u305fAdmin model\u3092\u4f5c\u308a\u305f\u3044\u306e\u306a\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n# Create a migration with the required fields\ncreate_table :admins do |t|\n  t.string :email\n  t.string :encrypted_password\n  t.timestamps\nend\n\n# Inside your Admin model\ndevise :database_authenticatable, :timeoutable\n\n# Inside your routes\ndevise_for :admins\n\n# Inside your protected controller\nbefore_filter :authenticate_admin!\n\n# Inside your controllers and views\nadmin_signed_in?\ncurrent_admin\nadmin_session\n\n\u3053\u306e\u4ee3\u308f\u308a\u306bDevise generator\u3092\u4f7f\u3046\u3060\u3051\u3067\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\n\u3053\u306e\u3088\u3046\u306amodel\u306f\u7570\u306a\u3063\u305froute\u3092\u6301\u3064\u3053\u3068\u3092\u899a\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002sign_in\u3084sign_out\u306a\u3069\u3068\u540c\u3058controller\u3092\u5171\u6709\u3057\u3066\u4f7f\u3046\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\u540c\u3058action\u3067\u7570\u306a\u3063\u305frole\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f role-based approach\u3000\u3092\u4f7f\u3046\u3053\u3068\u3092\u52e7\u3081\u307e\u3059\u3002\n\n\u8ffd\u52a0\u60c5\u5831\n\nHeroku(\u91cd\u8981)\nRails3.1\u3067Devise\u3092heroku\u3067\u4f7f\u3044\u305f\u3044\u306e\u306a\u3089\u3053\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\nconfig.assets.initialize_on_precompile = false\n\n\u305d\u306e\u4ed6\u306e\u6f5c\u5728\u7684\u554f\u984c\u306b\u3064\u3044\u3066\u306f\u30b3\u30ec\u3092\u8aad\u3093\u3067\u304f\u3060\u3055\u3044 http://guides.rubyonrails.org/asset_pipeline.html\n\n##\u306f\u3058\u3081\u306b\nDevise gem \u3067\u51fa\u6765\u308b\u3053\u3068\n\n- web\u306e\u4f1a\u54e1\u767b\u9332\u306e\u30d5\u30a9\u30fc\u30e0\u3092\u7c21\u5358\u306b\u4f5c\u308c\u308b(\u65b0\u898f\u767b\u9332\u753b\u9762\u30fblogin\u753b\u9762\u30fbetc...)\n- sign_in filter\u306a\u3069\u4f1a\u54e1\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u304d\u306b\u5fc5\u8981\u306ahelper\u304c\u591a\u304f\u7528\u610f\u3055\u308c\u3066\u3044\u308b\n- facebook\u306a\u3069\u306eominiauth\u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\n\n\u3053\u3093\u306a\u3053\u3068\u304c\u51fa\u6765\u308bDevise gem\u3092\u4f7f\u3063\u3066\u307f\u305f\u3044\uff01\u3063\u3066\u3053\u3068\u3067\u8abf\u3079\u305f\u3082\u306e\u306e\u307e\u3068\u3081\u3067\u3059\u3002\u4eca\u56de\u306f[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3](https://github.com/plataformatec/devise)\u3092\u8abf\u3079\u307e\u3057\u305f\u306e\u3067\u66f8\u3044\u3066\u3042\u308b\u3053\u3068\u306f\u516c\u5f0f\u3068\u307b\u307c\u5909\u308f\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u2b07\u304b\u3089\u65e9\u901f\u8aac\u660e\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\n##devise\u3092\u4f7f\u3046\ndivise3.0\u306frails3.2\u4ee5\u4e0a\u3067\u52d5\u304d\u307e\u3059\u3002Gemfile\u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\n\n```\ngem 'devise'\n```\n\u305d\u3057\u305f\u3089bundle\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066install\u3057\u3066\u304f\u3060\u3055\u3044\n\ndevise\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068Gemfile\u306e\u8ffd\u52a0\u304c\u7d42\u308f\u3063\u305f\u3089generator\u3092\u8d70\u3089\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nrails generate devise:install\n```\ngenarator\u306f\u3059\u3079\u3066\u306edevise\u306e\u8a2d\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u3067\u4e00\u56de\u78ba\u8a8d\u3057\u3068\u3044\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u304c\u7d42\u308f\u3063\u305f\u306e\u306a\u3089devise model\u3092\u4f7f\u3046\u6e96\u5099\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n```\nrails generate devise MODEL\n```\nMODEL\u306e\u90e8\u5206\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4f7f\u3046\u540d\u524d\u3067\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u591a\u304f\u306e\u5834\u5408\u306fUse\u3084Admin\u3068\u8a00\u3063\u305f\u3082\u306e\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u3082\u3057\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u65b0\u898f\u306bmodel\u3092\u4f5c\u308a\u3001devise\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u8a2d\u5b9a\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u6b21\u306b```rake db:migrate```\u3092\u3057\u3066migration\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\u307e\u305fgenerator\u306fDevise controller\u3092\u793a\u3059\u3088\u3046\u306b config/routes.rb\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n( \u6ce8\u610f)\u65e2\u306bapp\u3092\u4f5c\u308a\u59cb\u3081\u3066\u3044\u305f\u306e\u306a\u3089\u3084\u308a\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3055\u3082\u306a\u3051\u308c\u3070route helper\u306e\u30a8\u30e9\u30fc\u3084login\u3067\u304d\u306a\u3044\u3068\u3044\u3063\u305f\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3067\u3057\u3087\u3046\u3002\n\n###controller\u306efilter\u3068helpers\nDevise\u306fcontroller\u3068View\u306e\u4e2d\u3067\u4f7f\u3048\u308bhelper\u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002controller\u3092set up\u3059\u308b\u3068\u304d\u306bbefore_filter\u3092\u52a0\u3048\u308b\u3060\u3051\u3067user\u304cauthenticate\u304b\u5224\u65ad\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```\nbefore_filter :authenticate_user!\n```\nuser\u304csign_in\u3057\u3066\u3044\u308b\u304b\u5224\u65ad\u3067\u304d\u308bhelper\u3082\u3042\u308a\u307e\u3059\u3002\n\n```\nuser_signed_in?\n```\n\u73fe\u5728sign-in\u3057\u3066\u3044\u308buser\u3092\u5f97\u308bhelper\u3082\u3042\u308a\u307e\u3059\u3002\n\n```\ncurrent_user\n```\n\u307e\u305fuser\u306e\u6d3b\u52d5\u7bc4\u56f2\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\n\n```\nuser_session\n```\nuser\u304csign-in\u3057\u305f\u308a\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u66f4\u65b0\u3057\u305f\u3089root_path\u306bredirect\u3055\u308c\u307e\u3059\u3002\u4f8b\u3048\u3070user:resource\u306a\u3089\u3070user_root_path\u304c\u5b58\u5728\u3059\u308c\u3070\u305d\u3053\u306b\u3001\u306a\u3051\u308c\u3070defalt\u306eroot_path\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n```\nroot to: \"home#index\"\n```\n\u307e\u305f```after_sign_in_path_for```\u3084```after_sign_out_path_for```\u3092\u4f7f\u3063\u3066redirect\u5148\u3092\u4e0a\u66f8\u304d\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u3001mailer\u306e\u70ba\u306burl_option\u3092\u3059\u3079\u3066\u306e\u74b0\u5883\u306b\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f\"config/environments/development.rb\"\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n \n```\nconfig.action_mailer.default_url_options = { :host => 'localhost:3000' }\n```\n\n(\u30e1\u30e2)\u3082\u3057user\u3068\u3044\u3063\u305f devise model \u3092\u4f7f\u308f\u305a\u306b member \u3092\u4f7f\u3046\u306e\u306a\u3089\u3070helper\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\n\n```ruby:\nbefore_filter :authenticate_member!\n\nmember_signed_in?\n\ncurrent_member\n\nmember_session\n```\n##Model\u306e\u8a2d\u5b9a\nmodel\u306e devise method \u306f modules \u306e\u8a2d\u5b9a\u3092\u53d7\u3051\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u6697\u53f7\u5316\u3059\u308b\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u3044\u305f\u3044\u306e\u306a\u3089\n\n```\ndevise :database_authenticatable, :registerable, :confirmable, :recoverable, :stretches => 20\n```\n :stretches\u3092\u9664\u304d\u3001:pepper, :encryptor, :confirm_within, :remember_for, :timeout_in, :unlock_in, other values\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002devise:install \u304c\u4f7f\u308f\u308c\u305f\u3068\u304d\u306b\u4f5c\u3089\u308c\u305ffile\u3067\u8a73\u7d30\u3092\u898b\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n##\u5f37\u8abf\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\n\u3042\u306a\u305f\u306eview\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3068\u304d\u30d5\u30a9\u30fc\u30e0\u306b\u65b0\u3057\u3044\u7279\u5fb4\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u306esanitization\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306fRails4\u306b\u306a\u3063\u3066model\u304b\u3089controller\u306b\u79fb\u52d5\u3057\u307e\u3057\u305f\u3002Devise\u304c\u30b3\u30ec\u306b\u95a2\u3059\u308b\u6271\u3044\u3092\u3059\u308b\u3082\u306e\u306f\u540c\u69d8\u306bcontroller\u306b\u79fb\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3063\u305f\uff13\u3064\u306eaction\u3067\u3069\u3093\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u3082model\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u305d\u308c\u6545sanitization\u3092\u5fc5\u8981\u3068\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540d\u524d\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u8a31\u53ef\u306fdefault\u3067\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n- sign_in((Devise::SessionsController#new) - email\u306e\u3088\u3046\u306a\u627f\u8a8d\u30ad\u30fc\u304c\u3042\u308b\u5834\u5408\u306e\u307f\u8a31\u53ef\u3055\u308c\u307e\u3059\n- sign_up(Devise::RegistrationsController#create) - \u8a3c\u660e\u30ad\u30fc\u306bpassword\u3068password_confirmation\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3092\u8a31\u53ef\u3057\u307e\u3059\n- account_update(Devise::RegistrationsController#update) - \u8a3c\u660e\u30ad\u30fc\u306bpassword, password_confirmation, current_password\u3092\u8ffd\u52a0\u3059\u308b\u306e\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002(the lazy way\u2122)\u306e\u3088\u3046\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8ffd\u52a0\u3067\u8a31\u53ef\u3057\u305f\u3044\u5834\u5408\u306fApplicationController\u306b\u7c21\u5358\u306abefore_filter\u3092\u3059\u308b\u3053\u3068\u3067\u3067\u304d\u307e\u3059\u3002\n\n```\nclass ApplicationController < ActionController::Base\n  before_filter :configure_permitted_parameters, if: :devise_controller?\n\n  protected\n\n  def configure_permitted_parameters\n    devise_parameter_sanitizer.for(:sign_up) << :username\n  end\nend\n```\ndefalt\u306e\u8a2d\u5b9a\u3092\u5b8c\u5168\u306b\u5909\u3048\u305f\u308a\u3001\u7fd2\u6163\u7684\u632f\u308b\u821e\u3044\u3092\u4f5c\u308b\u305f\u3081\u306bpass a block\u3092\u4f5c\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n\n```ruby:\ndef configure_permitted_parameters\n  devise_parameter_sanitizer.for(:sign_in) { |u| u.permit(:username, :email) }\nend\n```\n\u3082\u3057\u3042\u306a\u305f\u304c\u8907\u6570\u306eDevise\u3000model\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u306a\u3089model\u3054\u3068\u306b\u7570\u306a\u3063\u305fsanitizer\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092set up\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u305d\u306e\u5834\u5408\u3001\u79c1\u305f\u3061\u306fDevise::ParameterSanitizer\u304b\u3089\u7d99\u627f\u3057\u3001\u81ea\u8eab\u306e\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3092\u63a8\u5968\u3057\u307e\u3059\n\n```ruby:\nclass User::ParameterSanitizer < Devise::ParameterSanitizer\n  def sign_in\n    default_params.permit(:username, :email)\n  end\nend\n```\n\u3053\u306e\u3068\u304d\u306bcontroller\u306b\u4f7f\u3046\u3053\u3068\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```ruby:\nclass ApplicationController < ActionController::Base\n  protected\n\n  def devise_parameter_sanitizer\n    if resource_class == User\n      User::ParameterSanitizer.new(User, :user, params)\n    else\n      super # Use the default one\n    end\n  end\nend\n```\n\u4e0a\u8a18\u306e\u4f8b\u3067\u306f:username\u3068:email\u306e\u4e21\u65b9\u3092\u4f7f\u3046\u305f\u3081\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u8a31\u53ef\u3057\u3066\u307e\u3059\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u611a\u304b\u3067\u306a\u3044\u65b9\u6cd5\u306fcustom controller\u306e\u4e0a\u306bbefore_filter\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u51fa\u6765\u308b\u3067\u3057\u3087\u3046\u3002\u79c1\u305f\u3061\u306f\u8a2d\u5b9a\u306e\u4ed5\u65b9\u3068controller\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u65b9\u6cd5\u3092section\u306e\u6d41\u308c\u306b\u5f93\u3063\u3066\u8a18\u8ff0\u3057\u307e\u3057\u305f\u3002\n\n##View\u306e\u8a2d\u5b9a\n\u79c1\u305f\u3061\u306fDevise\u3092\u4f7f\u3044\u7c21\u5358\u306buser\u8a8d\u8a3c\u753b\u9762\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u65b9\u6cd5\u3067\u306a\u304f\u3066\u3082\u81ea\u5206\u3067\u4f5c\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002Devise\u306fengine\u3067\u3059\u304b\u3089\u3001\u3059\u3079\u3066\u306eView\u306fgem\u306e\u5185\u5074\u306b\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3089\u306eview\u306f\u4f5c\u308a\u59cb\u3081\u3092\u52a9\u3051\u308c\u304f\u308c\u307e\u3059\u304c\u3001\u5f8c\u306b\u5909\u3048\u305f\u3044\u3068\u601d\u3046\u3067\u3057\u3087\u3046\u3002\u305d\u306e\u5834\u5408\u306fgenerator\u3092\u4f7f\u3046\u3053\u3068\u3067view\u3092\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n```\nrails generate devise:views\n```\n\u3082\u3057User\u3084Admin\u3068\u3044\u3063\u305fDevise model\u304c\u3042\u308b\u306e\u306a\u3089model\u3082view\u3068\u540c\u3058\u3088\u3046\u306b\u7de8\u96c6\u3057\u305f\u3044\u3068\u601d\u3046\u3067\u3057\u3087\u3046\u3002\u5e78\u904b\u306a\u3053\u3068\u306bmodel\u3092\u6539\u9020\u3059\u308b\u306e\u306fview\u3088\u308a\u3082\u7c21\u5358\u3067\u3059\u3002``` \"config.scoped_views = true\"```\u3092 \"config/initializers/devise.rb\"\u306e\u4e2d\u306b\u66f8\u304f\u3060\u3051\u3067\u3044\u3044\u306e\u3067\u3059\u3002\n\u3053\u308c\u304c\u7d42\u308f\u308b\u3068\"users/sessions/new\" \u3084 \"admins/sessions/new\"\u306b\u57fa\u3065\u3044\u305fview\u3092\u6301\u3064\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 scope\u306e\u4e2d\u306bview\u304c\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3089\"devise/sessions/new\"\u3068\u3044\u3046default\u306eview\u304c\u4f7f\u308f\u308c\u307e\u3059\u3002\u307e\u305f\u9078\u3093\u3060view\u3092\u4f7f\u3046\u305f\u3081\u306bgenerator\u3092\u4f7f\u3046\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\n\n```\nrails generate devise:views users\n```\n\n##controller\u306e\u8a2d\u5b9a\nview\u306ecustomization\u30ec\u30d9\u30eb\u304c\u5341\u5206\u3067\u306a\u3044\u306e\u306a\u3089\u3001\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u3059\u3079\u3066\u306econtroller\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n1,Admins::SessionsController:\u306e\u3088\u3046\u306acustom controller \u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\nclass Admins::SessionsController < Devise::SessionsController\nend\n```\n(\u6ce8\u610f)\u3053\u306e\u4f8b\u306fapp/controller/admins/\u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u65e2\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u9032\u3081\u3066\u3044\u307e\u3059\n\n2,\u4f7f\u3046controller\u306erouter\u3092\u66f8\u304d\u307e\u3059\n\n```\ndevise_for :admins, :controllers => { :sessions => \"admins/sessions\" }\n```\n\n3.controller\u306b\u5909\u5316\u3092\u52a0\u3048\u308b\u3068\"devise/sessions\"\u306eview\u304c\u4f7f\u3048\u306a\u304f\u306a\u308b\u306e\u3067\u5fd8\u308c\u305a\u306b\"devise/sessions\"\u3092\"admins/sessions\"\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nDevise\u306fsign_in\u304c\u6210\u529f\u3057\u305f\u304b\u5931\u6557\u3057\u305f\u304bflash message\u3067user\u306b\u4f1d\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u899a\u3048\u3066\u3044\u3066\u304f\u3060\u3055\u3044\u3002Devise\u306f\u3042\u306a\u305f\u306e\u30a2\u30d7\u30ea\u304c\u9069\u5207\u306a\u306b\"flash[:notice]\"\u3084\"flash[:alert]\"\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3092\u671f\u5f85\u3057\u3066\u3044\u307e\u3059\u3002\u3059\u3079\u3066\u306eflash hash \u3092\u51fa\u529b\u3057\u305f\u308a\u3001Devise\u306ehash key\u304b\u3089:timedout key\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u306e\u7121\u3044\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n##Routes\u306e\u8a2d\u5b9a\nDevise\u306fdafalut\u306eroutes\u304c\u3042\u308a\u307e\u3059\u3002\u3082\u3057\u305d\u308c\u3089\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u5fc5\u8981\u3042\u308b\u306e\u306a\u3089devise_for method\u3092\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f :class_name, :path_prefix\u3068\u3044\u3063\u305fname_path\u3092\u5909\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```ruby:\ndevise_for :users, :path => \"auth\", :path_names => { :sign_in => 'login', :sign_out => 'logout', :password => 'secret', :confirmation => 'verification', :unlock => 'unblock', :registration => 'register', :sign_up => 'cmon_let_me_in' }\n```\n\u8a73\u7d30\u306fdevise_for\u3068\u3044\u3046documentation\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3082\u3057 \"/sign_in\"\u3060\u3051\u3067\u306a\u304f\"/users/sign_in\"\u306e\u3088\u3046\u306b\u3082\u3063\u3068\u6df1\u304f\u5909\u66f4\u3092\u52a0\u3048\u305f\u3044\u306e\u306a\u3089devise_scope\u3092router\u306b\u52a0\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\ndevise_scope :user do\n  get \"sign_in\", :to => \"devise/sessions#new\"\nend\n```\n\u3053\u306e\u3088\u3046\u306b \"/sign_in\" \u3092\u3059\u308b\u3068scope\u306f:user\u306b\u9650\u5b9a\u3055\u308c\u307e\u3059\u3002(\u6ce8\u610f)devise_scope\u306f\u901a\u79f0\u306a\u306e\u3067\u6c17\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\n\n###I18n\nDevise\u306eflash message \u306fI18n\u3067\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```\nen:\n  devise:\n    sessions:\n      signed_in: 'Signed in successfully.'\n```\n\u3042\u306a\u305f\u306fresourse\u306b\u57fa\u3065\u304f\u56fa\u6709\u306emessage\u3092route\u306e\u8a2d\u5b9a\u306e\u4e2d\u306b\u66f8\u304f\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\n\n```\nen:\n  devise:\n    sessions:\n      user:\n        signed_in: 'Welcome user, you are signed in.'\n      admin:\n        signed_in: 'Hello admin!'\n```\nDevise mailer\u306fsubject message\u306b\u4f3c\u305f\u30e2\u30ce\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\n\n```\nen:\n  devise:\n    mailer:\n      confirmation_instructions:\n        subject: 'Hello everybody!'\n        user_subject: 'Hello User! Please confirm your email'\n      reset_password_instructions:\n        subject: 'Reset instructions'\n```\nlocal file\u3092\u898b\u308b\u3053\u3068\u3067\u3059\u3079\u3066\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u3069\u306e\u3088\u3046\u306b\u7ffb\u8a33\u3055\u308c\u3066\u3044\u308b\u304b\u8208\u5473\u304c\u3042\u308b\u306a\u3089\u3053\u306ewiki\u3067\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\nhttps://github.com/plataformatec/devise/wiki/I18n\n\n##Test helper\nDevise\u306fspec\u6a5f\u80fd\u3092\u4f7f\u3063\u305f\u3044\u304f\u3064\u304b\u306ehelper\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u3092\u4f7f\u3046\u306b\u306f test/test_helper.rbfile\u306b\u4ee5\u4e0b\u3092\u4ed8\u3051\u52a0\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\nclass ActionController::TestCase\n  include Devise::TestHelpers\nend\n```\n\u3082\u3057\u3042\u306a\u305f\u304cRspec\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u306a\u3089spec/support/devise.rb:\u306e\u5185\u5074\u306b\u4ee5\u4e0b\u3092\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```\nRSpec.configure do |config|\n  config.include Devise::TestHelpers, :type => :controller\nend\n```\n\u3053\u308c\u3067sign_in\u3068sign_out\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3053\u308c\u306fcontroller\u3068\u540c\u3058\u69d8\u306a\u6a5f\u80fd\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\n```\nsign_in :user, @user   # sign_in(scope, resource)\nsign_in @user          # sign_in(resource)\n\nsign_out :user         # sign_out(scope)\nsign_out @user         # sign_out(resource)\n```\n\u3042\u306a\u305f\u306f\uff12\u3064\u306e\u3053\u3068\u3092\u5fc3\u306b\u3068\u3069\u3081\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n\n1.\u3053\u306ehelper\u306fcapybara\u306a\u3069\u3068\u306f\u7d71\u4e00\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u305b\u3093\u6a5f\u80fd\u7684\u306a\u30c6\u30b9\u30c8\u3060\u3051\u3092\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u305d\u306e\u304b\u308f\u308auser form\u306f\u65e2\u306b\u57cb\u307e\u3063\u305f\u72b6\u614b\u3067\u4f7f\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\n\n2.\u3082\u3057Devise controller\u3084Devise\u3092\u7d99\u627f\u3057\u305fcontrolelr\u306e\u30c6\u30b9\u30c8\u3092\u3057\u305f\u3044\u306e\u306a\u3089\u3070\u3001\u4f7f\u3046\u524d\u306brequest\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002Devise\u306froutes\u304b\u3089\u60c5\u5831\u3092\u53d7\u3051\u53d6\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u306f\u4e0d\u53ef\u6b20\u3067\u3059\u3002\u3057\u304b\u3057\u3001test\u306frouter\u3092\u4f7f\u308f\u306a\u3044\u306e\u3067\u4f7f\u3046\u3053\u3068\u3092\u660e\u78ba\u306b\u793a\u3059\u3053\u3068\u304c\u5fc5\u8981\u3068\u6210\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001user scope\u306etest\u3092\u3057\u305f\u3044\u306e\u306a\u3089\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\n```\n@request.env[\"devise.mapping\"] = Devise.mappings[:user]\nget :new\n```\n\n##Omniauth\nDevise\u306fominiauth\u306e\u30b5\u30dd\u30fc\u30c8\u3092\u4f7f\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u4f7f\u3046\u306b\u306fconfig/initializers/devise.rb\u306bominiauth\u306e\u8a2d\u5b9a\u3092\u660e\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nconfig.omniauth :github, 'APP_ID', 'APP_SECRET', :scope => 'user,public_repo'\n```\nominiautho\u306e\u6a5f\u80fd\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u5c02\u7528\u306ewiki\u304c\u3042\u308b\u306e\u3067\u3053\u308c\u3092\u826f\u304f\u8aad\u3093\u3067\u304f\u3060\u3055\u3044\n\n- https://github.com/plataformatec/devise/wiki/OmniAuth:-Overview\n\n- [\u79c1\u304c\u307e\u3068\u3081\u305f\u3082\u306e](http://qiita.com/sasa0721/items/e8574f9e21ffcaa988c4)\n\n##multiple model\u8a2d\u5b9a\nDevise\u306f\u597d\u304d\u306a\u6570\u3060\u3051Devise model\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002User model \u4ee5\u5916\u306bauthentication\u3068time out\u6a5f\u80fd\u3092\u4ed8\u3051\u52a0\u3048\u305fAdmin model\u3092\u4f5c\u308a\u305f\u3044\u306e\u306a\u3089\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\n\n```\n# Create a migration with the required fields\ncreate_table :admins do |t|\n  t.string :email\n  t.string :encrypted_password\n  t.timestamps\nend\n\n# Inside your Admin model\ndevise :database_authenticatable, :timeoutable\n\n# Inside your routes\ndevise_for :admins\n\n# Inside your protected controller\nbefore_filter :authenticate_admin!\n\n# Inside your controllers and views\nadmin_signed_in?\ncurrent_admin\nadmin_session\n```\n\u3053\u306e\u4ee3\u308f\u308a\u306bDevise generator\u3092\u4f7f\u3046\u3060\u3051\u3067\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\n\n\u3053\u306e\u3088\u3046\u306amodel\u306f\u7570\u306a\u3063\u305froute\u3092\u6301\u3064\u3053\u3068\u3092\u899a\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002sign_in\u3084sign_out\u306a\u3069\u3068\u540c\u3058controller\u3092\u5171\u6709\u3057\u3066\u4f7f\u3046\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\u540c\u3058action\u3067\u7570\u306a\u3063\u305frole\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f role-based approach\u3000\u3092\u4f7f\u3046\u3053\u3068\u3092\u52e7\u3081\u307e\u3059\u3002\n\n##\u8ffd\u52a0\u60c5\u5831\n#Heroku(\u91cd\u8981)\nRails3.1\u3067Devise\u3092heroku\u3067\u4f7f\u3044\u305f\u3044\u306e\u306a\u3089\u3053\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u304c\u5fc5\u8981\u3067\u3059\n\n```\nconfig.assets.initialize_on_precompile = false\n```\n\u305d\u306e\u4ed6\u306e\u6f5c\u5728\u7684\u554f\u984c\u306b\u3064\u3044\u3066\u306f\u30b3\u30ec\u3092\u8aad\u3093\u3067\u304f\u3060\u3055\u3044 http://guides.rubyonrails.org/asset_pipeline.html", "tags": ["devise", "Rails", "Gem"]}