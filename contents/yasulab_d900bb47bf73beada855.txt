{"context": "Apple\u306eApp Transport Security\u304c\u5ef6\u671f\u306b\u306a\u3063\u305f\u3068\u306f\u3044\u3048\u3001SEO\u7684\u306b\u3082\u4fe1\u983c\u6027\u7684\u306b\u3082\u300c\u3068\u308a\u3042\u3048\u305a https \u306b\u3057\u3068\u304f\u304b\u300d\u307f\u305f\u3044\u306a\u6642\u4ee3\u306b\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d \ud83e\udd14\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u6700\u8fd1\u8a71\u984c\u306e Let's Encrypt \u3092\u4f7f\u3063\u3066 Jekyll + Heroku \u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308bRails\u30ac\u30a4\u30c9\u3092 HTTPS \u306b\u5bfe\u5fdc\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u306f\u4e0b\u8a18\u306e\u30d7\u30eb\u30ea\u30af\u30a8\u30b9\u30c8 (\u4ee5\u4e0b\u3001PR) \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\nEnable SSL in Production #277\nhttps://github.com/yasslab/railsguides.jp/pull/277\n\u4e0a\u8a18PR\u304b\u3089\u6c4e\u7528\u7684\u306a\u30b3\u30df\u30c3\u30c8\u3092pickup\u3057\u3066\u3001\uff11\u3064\u305a\u3064\u89e3\u8aac\u3057\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n Let's Encrypt\u306e\u4f7f\u3044\u65b9\u3084\u3001SSL\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u624b\u9806\u306a\u3069\u306b\u3064\u3044\u3066\u306f\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\n \u672c\u756a\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u306e\u306f\u5371\u967a\u306a\u306e\u3067\u3001Heroku\u306eFork\u6a5f\u80fd\u306a\u3069\u3067\u30c6\u30b9\u30c8\u7528\u306e\u74b0\u5883\u3092\u4f5c\u308a\u3001\u305d\u3053\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n\n\nTL;DR\n\n\nacme_challenge gem \u3067\u8a3c\u660e\u66f8\u53d6\u5f97\u304c\u4fbf\u5229 \n\nrack-rewrite gem \u3067 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\nrack-contrib gem \u3067\u30d8\u30c3\u30c0\u30fc\u3092\u9069\u5b9c\u4fee\u6b63\n\n\n1. Add acme_challenge gem to be certified\n\nLet's Encrypt\u3067SSL\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u7279\u5b9a\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089\u7279\u5b9a\u306e\u7d50\u679c\u3092\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (ACME CHALLENGE\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3059)\u3002\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3048\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u300cJekyll\u3067\u74b0\u5883\u5909\u6570\u3092\u6271\u3046\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u306e\u304b?\ud83e\udd14\u300d\u3068\u3044\u3046\u70b9\u3067\u7d50\u69cb\u306f\u307e\u3063\u3066\u3044\u307e\u3057\u305f  \n_plugin\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u3068\u304b\u8272\u3005\u3068\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u7d50\u8ad6\u3068\u3057\u3066\u306f acme_challenge gem \u304c\u4fbf\u5229\u3067\u3057\u305f\u3002\nSimple rack middeware for responding to ACME challenge like LetsEncrypt uses.\nhttps://github.com/soffes/acme_challenge\n\u4e0a\u8a18\u306eREADME\u306b\u8a73\u7d30\u304c\u3042\u308a\u307e\u3059\u304c\u3001Jekyll + Heroku \u306e\u5834\u5408\u306f config.ru \u306e\u6700\u521d\u3067\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u3059 (\u3053\u308c\u3060\u3051!)\u3002\n# config.ru\n\nrequire 'acme_challenge'\nuse AcmeChallenge, ENV['ACME_CHALLENGE'] if ENV['ACME_CHALLENGE']\n\n\u3042\u3068\u306f\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3068\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u306e\u74b0\u5883\u5909\u6570 (ACME_CHALLENGE) \u306b\u3001Let's Encrypt \u3067\u53d6\u5f97\u3057\u305f\u30ad\u30fc\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u30ad\u30fc\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb\u306e\u300cLet's Encrypt \u306e\u4f7f\u3044\u65b9\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u306a\u304a\u3001\u74b0\u5883\u5909\u6570\u306b\u4ee3\u5165\u3059\u308b\u5024\u306f\u623b\u308a\u5024\u306e\u65b9\u3067\u3059\u3002\nMake sure your web server displays the following content at\nhttp://railsguides.jp/.well-known/acme-challenge/FOOBAR before continuing:\n\nFOOBAR.HOGEHOGE\n\u203b\ud83d\udc46\u3053\u3053\u306b\u8868\u793a\u3055\u308c\u308b\u5024\u3092 ACME_CHALLENGE \u306b\u4ee3\u5165\n\nIf you don't have HTTP server configured, you can run the following\ncommand on the target server (as root):\n\n(\u4e2d\u7565)\n\nPress ENTER to continue\n\n\u672c\u756a\u74b0\u5883\u3067\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb\u306e\u624b\u9806\u306b\u5f93\u3063\u3066SSL\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u307e\u3057\u3087\u3046\u3002\n\n2. Enforce SSL by rack-rewrite gem\n\n1.\u3067\u306e\u624b\u7d9a\u304d\u304c\u7121\u4e8b\u306b\u7d42\u308f\u308b\u3068\u3001*.pem\u304c\u5165\u624b\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\u307e\u305a\u306f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092 Heroku \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n$ heroku certs:add \\\n  /etc/letsencrypt/live/railsguides.jp/fullchain.pem \\\n  /etc/letsencrypt/live/railsguides.jp/privkey.pem\n\n\u3053\u308c\u3067 http \u3068 https \u306e\u4e21\u65b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067 https \u306b\u7d71\u4e00\u3055\u305b\u305f\u3044\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u306e\u5b9f\u88c5\u304c\u3053\u3061\u3089\u3002\nEnforce SSL by rack-rewrite gem\nhttps://github.com/yasslab/railsguides.jp/pull/277/commits/0cc483958d33e1781d607f3649ee424058222391\n\u4e0a\u306e\u30b3\u30df\u30c3\u30c8\u3067\u306f\u3001rack-rewrite gem \u3092\u4f7f\u3063\u3066 config.ru \u306b\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059 (\u7d30\u304b\u306a\u8a18\u6cd5\u306f\u7701\u7565)\u3002\nrequire 'rack/rewrite'\nuse Rack::Rewrite do\n  if ENV['RACK_ENV'] == 'production'\n    r301 %r{.*}, 'https://railsguides.jp$&', :scheme => 'http'\n  end\nend\n\n\u3053\u308c\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308c\u3070\u3001\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306a\u3069\u304b\u3089 http://railsguides.jp/ \u306b\u6765\u308b\u4eba\u3082 https \u306b\u5207\u308a\u66ff\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u5f8c\u8ff0\u306e\u554f\u984c\u304c\u307e\u3060\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u306e\u6642\u70b9\u3067\u306f\u307e\u3060\u672c\u756a\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u306a\u3044\u65b9\u304c\u826f\u3044\u3067\u3059 (\u30c6\u30b9\u30c8\u7528\u306e\u74b0\u5883\u3060\u3051\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b)  \n\n3. Implement custom headers with rack-contrib gem\n\n2. \u3067 https \u3067\u3082\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b https \u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3068\u3001Facebook \u306e Like \u30dc\u30bf\u30f3\u3084 Twitter \u306e Tweet \u30dc\u30bf\u30f3\u306a\u3069\u3001\u4ed6\u30b5\u30a4\u30c8\u306e\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u57cb\u3081\u8fbc\u3093\u3060\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u30a8\u30e9\u30fc\u307e\u305f\u306f\u8b66\u544a\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\n\u30a8\u30e9\u30fc\u4f8b (Chrome\u306a\u3089 Option + Cmd + i \u3067\u78ba\u8a8d)\n\n\u3053\u3053\u3067\u8868\u793a\u3055\u308c\u308b\u30a8\u30e9\u30fc\u304a\u3088\u3073\u8b66\u544a\u306f\u3001\u305d\u306e\u30b5\u30a4\u30c8\u3067\u3069\u3093\u306a\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3044\u308b\u304b\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u89e3\u6c7a\u65b9\u6cd5\u3082\u305d\u306e\u5185\u5bb9\u306b\u3088\u308b\u3068\u3053\u308d\u304c\u5927\u304d\u3044\u3067\u3059\u304c\u3001\uff11\u3064\u306e\u6c4e\u7528\u7684\u306a\u89e3\u6c7a\u7b56\u3068\u3057\u3066\u306f\u3001Content-Security-Policy (CSP) \u306b\u8a31\u5bb9\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u3092\u9069\u5b9c\u8ffd\u52a0\u3057\u3066\u3044\u304f\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070Rails\u30ac\u30a4\u30c9\u306e\u5834\u5408\u306f\u3001\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u3084Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u306a\u3069\u3092\u30b5\u30a4\u30c8\u5185\u3067\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092  config.ru \u306b\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\nrequire 'rack/contrib/try_static'\nuse Rack::TryStatic,\n  urls: %w[/],\n  root: '_site',\n  try: ['.html', 'index.html', '/index.html'],\n  header_rules: [\n    [:all, {\n      'Strict-Transport-Security' => 'max-age=31536000; preload',\n      'X-Xss-Protection'          => '1; mode=block',\n      'X-Content-Type-Options'    => 'nosniff',\n      'X-Frame-Options'           => 'DENY',\n      'Content-Security-Policy'   => \"default-src 'self' 'unsafe-inline' 'unsafe-eval' *.dropboxusercontent.com *.google-analytics.com *.facebook.net *.facebook.com *.twitter.com ghbtns.com *.hatena.ne.jp *.st-hatena.com *.google.com;\"\n    }],\n\n# (\u5f8c\u7565)\n\n\u30b3\u30df\u30c3\u30c8\u306e\u8a73\u7d30: Implement custom headers with rack-contrib gem\n (rack/jekyll \u3084 run Rake::Jekyll.new \u3092\u7f6e\u304d\u63db\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u8ffd\u8a18\u3057\u3066\u3044\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044  )\nCSP\u3092\u3069\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3059\u308b\u304b\u306f\u30b5\u30a4\u30c8\u3054\u3068\u306b\u7570\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u9069\u5b9c\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u76ee\u5b89\u3068\u3057\u3066\u306f\u3001(Chrome\u306e\u5834\u5408) \u30a2\u30a4\u30b3\u30f3\u304c\u9375\u30de\u30fc\u30af\ud83d\udd12\u306b\u5909\u308f\u3063\u305f\u304b\u3069\u3046\u304b\u3001Console\u4e0a\u306b\u30a8\u30e9\u30fc\u3084\u8b66\u544a\u304c\u51fa\u306a\u3044\u304b\u3069\u3046\u304b\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4ed6\u306e\u76ee\u5b89\u3068\u3057\u3066\u306f\u3001SSL Server Test\u306a\u3069\u306e\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u305f\u30c1\u30a7\u30c3\u30af\u3082\u3042\u308a\u307e\u3059\u3002\u3069\u3053\u307e\u3067\u5bfe\u5fdc\u3059\u308b\u304b\u306f\u30b1\u30fc\u30b9\u30d0\u30a4\u30b1\u30fc\u30b9\u3060\u3068\u601d\u3046\u306e\u3067\u3001\u305d\u306e\u5869\u6885\u306b\u3064\u3044\u3066\u306f\u5404\u30b1\u30fc\u30b9\u306b\u5fdc\u3058\u3066\u5224\u65ad\u3057\u3066\u3082\u3089\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059  \n\n\nrailsguides.jp\u306eSSL Report\u306e\u7d50\u679c\n\n\n\u307e\u3068\u3081 (\u518d\u63b2)\n\n\nacme_challenge gem \u3067\u8a3c\u660e\u66f8\u53d6\u5f97\u304c\u4fbf\u5229 \n\nrack-rewrite gem \u3067 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\nrack-contrib gem \u3067\u30d8\u30c3\u30c0\u30fc\u3092\u9069\u5b9c\u4fee\u6b63\n\nhttps \u5bfe\u5fdc\u306e\u3054\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059 \ud83d\ude06\n\n\u53c2\u8003\u8a18\u4e8b\n\nMoving to Heroku - Daniel Groves\n\n\n\u5ba3\u4f1d \n\nRails\u30ac\u30a4\u30c9\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3068\u3057\u3066 yasslab/railsguides.jp \u304b\u3089\u516c\u958b\u3055\u308c\u3001YassLab\u793e\u306b\u3088\u3063\u3066\u904b\u55b6\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30f3\u30c4\u5185\u306e\u8aa4\u5b57\u30fb\u8131\u5b57\u306f\u3082\u3068\u3088\u308a\u3001\u30b3\u30fc\u30c9\u3068\u3057\u3066\u6539\u5584\u3067\u304d\u305d\u3046\u306a\u3068\u3053\u308d\u304c\u3042\u308c\u3070\u3001\u304a\u6c17\u8efd\u306b Issue \u307e\u305f\u306f PR \u3092\u9001\u3063\u3066\u3044\u305f\u3060\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059!  \n\nApple\u306e[App Transport Security\u304c\u5ef6\u671f\u306b\u306a\u3063\u305f](https://developer.apple.com/news/?id=12212016b)\u3068\u306f\u3044\u3048\u3001SEO\u7684\u306b\u3082\u4fe1\u983c\u6027\u7684\u306b\u3082<b>\u300c\u3068\u308a\u3042\u3048\u305a https \u306b\u3057\u3068\u304f\u304b\u300d</b>\u307f\u305f\u3044\u306a\u6642\u4ee3\u306b\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d \ud83e\udd14\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u6700\u8fd1\u8a71\u984c\u306e [Let's Encrypt](https://letsencrypt.jp/) \u3092\u4f7f\u3063\u3066 Jekyll + Heroku \u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b[Rails\u30ac\u30a4\u30c9](https://railsguides.jp)\u3092 HTTPS \u306b\u5bfe\u5fdc\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u306f\u4e0b\u8a18\u306e\u30d7\u30eb\u30ea\u30af\u30a8\u30b9\u30c8 (\u4ee5\u4e0b\u3001PR) \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\nEnable SSL in Production #277\nhttps://github.com/yasslab/railsguides.jp/pull/277\n\n\u4e0a\u8a18PR\u304b\u3089\u6c4e\u7528\u7684\u306a\u30b3\u30df\u30c3\u30c8\u3092pickup\u3057\u3066\u3001\uff11\u3064\u305a\u3064\u89e3\u8aac\u3057\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n- :beginner: __Let's Encrypt\u306e\u4f7f\u3044\u65b9\u3084\u3001SSL\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\u624b\u9806\u306a\u3069\u306b\u3064\u3044\u3066\u306f[\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb](https://letsencrypt.jp/)\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002__\n- :warning: __\u672c\u756a\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u306e\u306f\u5371\u967a\u306a\u306e\u3067\u3001[Heroku\u306eFork\u6a5f\u80fd](https://devcenter.heroku.com/articles/fork-app)\u306a\u3069\u3067\u30c6\u30b9\u30c8\u7528\u306e\u74b0\u5883\u3092\u4f5c\u308a\u3001\u305d\u3053\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002__\n\n# TL;DR\n\n- [acme_challenge](https://github.com/soffes/acme_challenge) gem \u3067\u8a3c\u660e\u66f8\u53d6\u5f97\u304c\u4fbf\u5229 \n- [rack-rewrite](https://github.com/jtrupiano/rack-rewrite) gem \u3067 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n- [rack-contrib](https://github.com/rack/rack-contrib/) gem \u3067\u30d8\u30c3\u30c0\u30fc\u3092\u9069\u5b9c\u4fee\u6b63\n\n## 1. [Add acme_challenge gem to be certified](https://github.com/yasslab/railsguides.jp/pull/277/commits/8ac644e3be038db227e038e6fd60f74d97d556d2)\n\nLet's Encrypt\u3067SSL\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u7279\u5b9a\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3089\u7279\u5b9a\u306e\u7d50\u679c\u3092\u8fd4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (ACME CHALLENGE\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3059)\u3002\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3048\u3070\u826f\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u300cJekyll\u3067\u74b0\u5883\u5909\u6570\u3092\u6271\u3046\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u306e\u304b?\ud83e\udd14\u300d\u3068\u3044\u3046\u70b9\u3067\u7d50\u69cb\u306f\u307e\u3063\u3066\u3044\u307e\u3057\u305f :sweat: \n\n`_plugin`\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u3068\u304b\u8272\u3005\u3068\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u7d50\u8ad6\u3068\u3057\u3066\u306f [acme_challenge](https://github.com/soffes/acme_challenge) gem \u304c\u4fbf\u5229\u3067\u3057\u305f\u3002\n\nSimple rack middeware for responding to ACME challenge like LetsEncrypt uses.\nhttps://github.com/soffes/acme_challenge\n\n\u4e0a\u8a18\u306eREADME\u306b\u8a73\u7d30\u304c\u3042\u308a\u307e\u3059\u304c\u3001Jekyll + Heroku \u306e\u5834\u5408\u306f `config.ru` \u306e[\u6700\u521d\u3067\u547c\u3073\u51fa\u3059](https://github.com/yasslab/railsguides.jp/pull/277/commits/8ac644e3be038db227e038e6fd60f74d97d556d2#diff-0a400c8217d53ff4f978163d7c61868cR1)\u3060\u3051\u3067\u3059 (\u3053\u308c\u3060\u3051!)\u3002\n\n```rb\n# config.ru\n\nrequire 'acme_challenge'\nuse AcmeChallenge, ENV['ACME_CHALLENGE'] if ENV['ACME_CHALLENGE']\n```\n\n\u3042\u3068\u306f\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3068\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u306e\u74b0\u5883\u5909\u6570 (`ACME_CHALLENGE`) \u306b\u3001Let's Encrypt \u3067\u53d6\u5f97\u3057\u305f\u30ad\u30fc\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u30ad\u30fc\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb\u306e\u300c[Let's Encrypt \u306e\u4f7f\u3044\u65b9](https://letsencrypt.jp/usage/)\u300d\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u306a\u304a\u3001\u74b0\u5883\u5909\u6570\u306b\u4ee3\u5165\u3059\u308b\u5024\u306f\u623b\u308a\u5024\u306e\u65b9\u3067\u3059\u3002\n\n```\nMake sure your web server displays the following content at\nhttp://railsguides.jp/.well-known/acme-challenge/FOOBAR before continuing:\n\nFOOBAR.HOGEHOGE\n\u203b\ud83d\udc46\u3053\u3053\u306b\u8868\u793a\u3055\u308c\u308b\u5024\u3092 ACME_CHALLENGE \u306b\u4ee3\u5165\n\nIf you don't have HTTP server configured, you can run the following\ncommand on the target server (as root):\n\n(\u4e2d\u7565)\n\nPress ENTER to continue\n```\n\n\u672c\u756a\u74b0\u5883\u3067\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u7dcf\u5408\u30dd\u30fc\u30bf\u30eb\u306e\u624b\u9806\u306b\u5f93\u3063\u3066SSL\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3057\u307e\u3057\u3087\u3046\u3002\n\n## 2. [Enforce SSL by rack-rewrite gem](https://github.com/yasslab/railsguides.jp/pull/277/commits/0cc483958d33e1781d607f3649ee424058222391) \n\n`1.`\u3067\u306e\u624b\u7d9a\u304d\u304c\u7121\u4e8b\u306b\u7d42\u308f\u308b\u3068\u3001`*.pem`\u304c\u5165\u624b\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\u307e\u305a\u306f\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092 Heroku \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```sh\n$ heroku certs:add \\\n  /etc/letsencrypt/live/railsguides.jp/fullchain.pem \\\n  /etc/letsencrypt/live/railsguides.jp/privkey.pem\n```\n\n\u3053\u308c\u3067 http \u3068 https \u306e\u4e21\u65b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u305b\u3063\u304b\u304f\u306a\u306e\u3067 https \u306b\u7d71\u4e00\u3055\u305b\u305f\u3044\u3067\u3059\u3002\u305d\u306e\u305f\u3081\u306e\u5b9f\u88c5\u304c\u3053\u3061\u3089\u3002\n\nEnforce SSL by rack-rewrite gem\nhttps://github.com/yasslab/railsguides.jp/pull/277/commits/0cc483958d33e1781d607f3649ee424058222391\n\n\u4e0a\u306e\u30b3\u30df\u30c3\u30c8\u3067\u306f\u3001[rack-rewrite gem](https://github.com/jtrupiano/rack-rewrite) \u3092\u4f7f\u3063\u3066 `config.ru` \u306b\u6b21\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059 (\u7d30\u304b\u306a\u8a18\u6cd5\u306f\u7701\u7565)\u3002\n\n```rb\nrequire 'rack/rewrite'\nuse Rack::Rewrite do\n  if ENV['RACK_ENV'] == 'production'\n    r301 %r{.*}, 'https://railsguides.jp$&', :scheme => 'http'\n  end\nend\n```\n\n\u3053\u308c\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308c\u3070\u3001\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306a\u3069\u304b\u3089 http://railsguides.jp/ \u306b\u6765\u308b\u4eba\u3082 https \u306b\u5207\u308a\u66ff\u308f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u5f8c\u8ff0\u306e\u554f\u984c\u304c\u307e\u3060\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u306e\u6642\u70b9\u3067\u306f\u307e\u3060\u672c\u756a\u74b0\u5883\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u306a\u3044\u65b9\u304c\u826f\u3044\u3067\u3059 (\u30c6\u30b9\u30c8\u7528\u306e\u74b0\u5883\u3060\u3051\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b) :warning: \n\n## 3. [Implement custom headers with rack-contrib gem](https://github.com/yasslab/railsguides.jp/pull/277/commits/39f80899d456633576b2568e0e8b2516e4967607)\n\n`2.` \u3067 https \u3067\u3082\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b https \u3067\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3068\u3001Facebook \u306e Like \u30dc\u30bf\u30f3\u3084 Twitter \u306e Tweet \u30dc\u30bf\u30f3\u306a\u3069\u3001\u4ed6\u30b5\u30a4\u30c8\u306e\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u57cb\u3081\u8fbc\u3093\u3060\u30b3\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u30a8\u30e9\u30fc\u307e\u305f\u306f\u8b66\u544a\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n<div align=\"center\">\n<img src=https://qiita-image-store.s3.amazonaws.com/0/1857/ca926851-e55f-c1e8-0cff-e780c164d0bb.png \"railsguides-jp_SSL-Error.png\" />\n\u30a8\u30e9\u30fc\u4f8b (Chrome\u306a\u3089 Option + Cmd + i \u3067\u78ba\u8a8d)\n</div>\n\n\u3053\u3053\u3067\u8868\u793a\u3055\u308c\u308b\u30a8\u30e9\u30fc\u304a\u3088\u3073\u8b66\u544a\u306f\u3001\u305d\u306e\u30b5\u30a4\u30c8\u3067\u3069\u3093\u306a\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u3044\u308b\u304b\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u89e3\u6c7a\u65b9\u6cd5\u3082\u305d\u306e\u5185\u5bb9\u306b\u3088\u308b\u3068\u3053\u308d\u304c\u5927\u304d\u3044\u3067\u3059\u304c\u3001\uff11\u3064\u306e\u6c4e\u7528\u7684\u306a\u89e3\u6c7a\u7b56\u3068\u3057\u3066\u306f\u3001[Content-Security-Policy](https://developer.mozilla.org/ja/docs/Web/Security/CSP) (CSP) \u306b\u8a31\u5bb9\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u3092\u9069\u5b9c\u8ffd\u52a0\u3057\u3066\u3044\u304f\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070Rails\u30ac\u30a4\u30c9\u306e\u5834\u5408\u306f\u3001\u306f\u3066\u306a\u30d6\u30c3\u30af\u30de\u30fc\u30af\u3084Google\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9\u306a\u3069\u3092\u30b5\u30a4\u30c8\u5185\u3067\u4f7f\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u6b21\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092  `config.ru` \u306b\u8ffd\u8a18\u3057\u3066\u3044\u307e\u3059\u3002\n\n```rb\nrequire 'rack/contrib/try_static'\nuse Rack::TryStatic,\n  urls: %w[/],\n  root: '_site',\n  try: ['.html', 'index.html', '/index.html'],\n  header_rules: [\n    [:all, {\n      'Strict-Transport-Security' => 'max-age=31536000; preload',\n      'X-Xss-Protection'          => '1; mode=block',\n      'X-Content-Type-Options'    => 'nosniff',\n      'X-Frame-Options'           => 'DENY',\n      'Content-Security-Policy'   => \"default-src 'self' 'unsafe-inline' 'unsafe-eval' *.dropboxusercontent.com *.google-analytics.com *.facebook.net *.facebook.com *.twitter.com ghbtns.com *.hatena.ne.jp *.st-hatena.com *.google.com;\"\n    }],\n\n# (\u5f8c\u7565)\n```\n\n\u30b3\u30df\u30c3\u30c8\u306e\u8a73\u7d30: [Implement custom headers with rack-contrib gem\n](https://github.com/yasslab/railsguides.jp/pull/277/commits/39f80899d456633576b2568e0e8b2516e4967607) (`rack/jekyll` \u3084 `run Rake::Jekyll.new` \u3092[\u7f6e\u304d\u63db\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u8ffd\u8a18](https://github.com/yasslab/railsguides.jp/pull/277/commits/39f80899d456633576b2568e0e8b2516e4967607#diff-0a400c8217d53ff4f978163d7c61868cL11)\u3057\u3066\u3044\u308b\u70b9\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044 :warning: )\n\nCSP\u3092\u3069\u306e\u3088\u3046\u306b\u5bfe\u5fdc\u3059\u308b\u304b\u306f\u30b5\u30a4\u30c8\u3054\u3068\u306b\u7570\u306a\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u9069\u5b9c\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u76ee\u5b89\u3068\u3057\u3066\u306f\u3001(Chrome\u306e\u5834\u5408) \u30a2\u30a4\u30b3\u30f3\u304c\u9375\u30de\u30fc\u30af\ud83d\udd12\u306b\u5909\u308f\u3063\u305f\u304b\u3069\u3046\u304b\u3001Console\u4e0a\u306b\u30a8\u30e9\u30fc\u3084\u8b66\u544a\u304c\u51fa\u306a\u3044\u304b\u3069\u3046\u304b\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\n![railsguidesjp_SSL-Check.png](https://qiita-image-store.s3.amazonaws.com/0/1857/f0127ca6-6d0f-e77d-d6aa-0eba274a1a93.png)\n\n\u4ed6\u306e\u76ee\u5b89\u3068\u3057\u3066\u306f\u3001[SSL Server Test](https://www.ssllabs.com/ssltest/)\u306a\u3069\u306e\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u305f\u30c1\u30a7\u30c3\u30af\u3082\u3042\u308a\u307e\u3059\u3002\u3069\u3053\u307e\u3067\u5bfe\u5fdc\u3059\u308b\u304b\u306f\u30b1\u30fc\u30b9\u30d0\u30a4\u30b1\u30fc\u30b9\u3060\u3068\u601d\u3046\u306e\u3067\u3001\u305d\u306e\u5869\u6885\u306b\u3064\u3044\u3066\u306f\u5404\u30b1\u30fc\u30b9\u306b\u5fdc\u3058\u3066\u5224\u65ad\u3057\u3066\u3082\u3089\u3048\u308c\u3070\u3068\u601d\u3044\u307e\u3059 :bow: \n\n<div align=\"center\">\n<img src=https://qiita-image-store.s3.amazonaws.com/0/1857/37beac78-e77c-6554-c040-bce67a552dbf.png \"railsguides-jp_SSL-Report.png\" />\nrailsguides.jp\u306e<a href=\"https://www.ssllabs.com/ssltest/analyze.html?d=railsguides.jp&s=50.19.93.247\">SSL Report\u306e\u7d50\u679c</a>\n</div>\n\n## \u307e\u3068\u3081 (\u518d\u63b2)\n\n- [acme_challenge](https://github.com/soffes/acme_challenge) gem \u3067\u8a3c\u660e\u66f8\u53d6\u5f97\u304c\u4fbf\u5229 \n- [rack-rewrite](https://github.com/jtrupiano/rack-rewrite) gem \u3067 https \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n- [rack-contrib](https://github.com/rack/rack-contrib/) gem \u3067\u30d8\u30c3\u30c0\u30fc\u3092\u9069\u5b9c\u4fee\u6b63\n\nhttps \u5bfe\u5fdc\u306e\u3054\u53c2\u8003\u306b\u306a\u308c\u3070\u5e78\u3044\u3067\u3059 \ud83d\ude06\n\n### \u53c2\u8003\u8a18\u4e8b\n\n- [Moving to Heroku - Daniel Groves](https://danielgroves.net/development/2016/11/move-to-heroku)\n\n## \u5ba3\u4f1d :loudspeaker: \n\n[Rails\u30ac\u30a4\u30c9](https://railsguides.jp/)\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3068\u3057\u3066 [yasslab/railsguides.jp](https://github.com/yasslab/railsguides.jp) \u304b\u3089\u516c\u958b\u3055\u308c\u3001[YassLab\u793e](http://yasslab.jp/)\u306b\u3088\u3063\u3066\u904b\u55b6\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30f3\u30c4\u5185\u306e\u8aa4\u5b57\u30fb\u8131\u5b57\u306f\u3082\u3068\u3088\u308a\u3001\u30b3\u30fc\u30c9\u3068\u3057\u3066\u6539\u5584\u3067\u304d\u305d\u3046\u306a\u3068\u3053\u308d\u304c\u3042\u308c\u3070\u3001\u304a\u6c17\u8efd\u306b Issue \u307e\u305f\u306f PR \u3092\u9001\u3063\u3066\u3044\u305f\u3060\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059! :smile_cat: \n\n[![yasslab_logo_copy.png](https://qiita-image-store.s3.amazonaws.com/0/1857/5ede2b6a-5386-14a4-2783-da61ed424bab.png)](http://yasslab.jp/)\n\n\n", "tags": ["Jekyll", "Heroku", "SSL", "HTTPS", "Ruby"]}