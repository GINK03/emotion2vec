{"tags": ["hive0.10.0", "R"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6982\u8981\nHive \u306e INSERT \u3067\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304d\u3066\uff0cR \u3067\u8aad\u307f\u8fbc\u3081\u308b\u304b\u691c\u8a3c\u3057\u305f\uff0e\nHive \u3067\u96c6\u8a08\u3057\u305f\u7d50\u679c\u3092 R \u3067\u89e3\u6790\u3057\u305f\u3044\u3068\u304d\u304c\u3042\u308b\uff0e\n\u305d\u306e\u3088\u3046\u306a\u3068\u304d\uff0chive -e \u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u306e\u3082\u826f\u3044\u304c\uff0cHive \u306e\u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u4e2d\u9593\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u3066\u304a\u3051\u308b\u3068\u5b09\u3057\u3044\uff0e\n\n\u7d50\u8ad6\nINSERT \u3067\u4f5c\u3063\u305f\u30c7\u30fc\u30bf\u3092 R \u3067\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\n\n\u691c\u8a3c\u74b0\u5883\n\nHadoop: CDH 4.3\nHive 0.10.0\nCentOS 6.3\nR 3.0.1\n\n\n\u691c\u8a3c\u904e\u7a0b\n\nHive \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u6e96\u5099\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092 Hive \u306b\u30ed\u30fc\u30c9\u3059\u308b\nINSERT \u3067\u30c7\u30fc\u30bf\u3092\u751f\u6210\n\u751f\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\nR \u3067\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\n\n\nHive \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\n\" \u5143\u3005\u306e CSV \u3092\u683c\u7d0d\u3059\u308b\u30c6\u30fc\u30d6\u30eb\nDROP TABLE IF EXISTS test_r;\nCREATE TABLE IF NOT EXISTS test_r (\n    clm1 STRING,\n    clm2 STRING,\n    clm3 STRING\n)\nROW FORMAT DELIMITED fields terminated by ','\nSTORED AS TEXTFILE;\n\n\" INSERT \u3067\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u30c6\u30fc\u30d6\u30eb\nDROP TABLE IF EXISTS test_r2;\nCREATE TABLE IF NOT EXISTS test_r2 (\n    clm1 STRING,\n    clm2 STRING,\n    clm3 STRING\n)\nPARTITIONED BY (dt STRING)\nROW FORMAT DELIMITED fields terminated by ','\nSTORED AS TEXTFILE;\n\n\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\n\u30c6\u30b9\u30c8\u7528\u306e CSV \u30d5\u30a1\u30a4\u30eb\u306f\uff0c\u3064\u304e\u3067\u3042\u308b\uff0e\n\u30d5\u30a1\u30a4\u30eb\u3092 /tmp/data.csv \u306b\u914d\u7f6e\u3059\u308b\uff0e\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n\n\n\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\n\" CSV \u3092\u30ed\u30fc\u30c9\nLOAD DATA LOCAL INPATH '/tmp/data.csv' OVERWRITE INTO TABLE test_r;\n\n\" \u30ed\u30fc\u30c9\u3057\u305f CSV \u3092 INSERT \u3067\u5225\u30c6\u30fc\u30d6\u30eb\u306b\u683c\u7d0d\n\" \u30c7\u30fc\u30bf\u304c\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u305f\u3068\u304d\u306f mapred.output.compression.type \u3092 ROW \u306b\u3057\u3066\u307f\u308b\u3068\u3044\u3044\uff1f\nSET hive.exec.compress.output=true;\nSET hive.exec.compress.intermediate=true;\nSET mapred.output.compression.type=BLOCK; \nSET mapred.output.compression.codec=org.apache.hadoop.io.compress.GzipCodec; \nINSERT OVERWRITE TABLE test_r2\n    PARTITION (dt = \"2013-01-01\")\nSELECT clm1, clm2, clm3 FROM test_r;\n\n\nR \u3067\u8aad\u307f\u8fbc\u3081\u308b\u304b\u691c\u8a3c\nHIve \u306e INSERT \u3067\u751f\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092 R \u306e read.csv \u3067\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\uff0e\n# HDFS \u304b\u3089\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\n> hdfs dfs -copyToLocal /user/hive/warehouse/test_r2/dt=2013-01-01/000000_0.gz .\n# file \u3092\u78ba\u8a8d\n> file 000000_0.gz\n000000_0.gz: gzip compressed data, from Unix\n\n# R \u3067\u8aad\u307f\u8fbc\u3080\nR> data <- read.csv(\"000000_0.gz\")\nR> head(data)\n> head(data)\n  X1 X2 X3\n1  1  2  3\n2  1  2  3\n3  1  2  3\n4  1  2  3\n5  1  2  3\n6  1  2  3\n\n# \u6982\u8981\n\nHive \u306e INSERT \u3067\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\u3057\u3066\u304d\u3066\uff0cR \u3067\u8aad\u307f\u8fbc\u3081\u308b\u304b\u691c\u8a3c\u3057\u305f\uff0e\nHive \u3067\u96c6\u8a08\u3057\u305f\u7d50\u679c\u3092 R \u3067\u89e3\u6790\u3057\u305f\u3044\u3068\u304d\u304c\u3042\u308b\uff0e\n\u305d\u306e\u3088\u3046\u306a\u3068\u304d\uff0chive -e \u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u306e\u3082\u826f\u3044\u304c\uff0cHive \u306e\u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u4e2d\u9593\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u3066\u304a\u3051\u308b\u3068\u5b09\u3057\u3044\uff0e\n\n# \u7d50\u8ad6\n\nINSERT \u3067\u4f5c\u3063\u305f\u30c7\u30fc\u30bf\u3092 R \u3067\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\n\n# \u691c\u8a3c\u74b0\u5883\n\n- Hadoop: CDH 4.3\n- Hive 0.10.0\n- CentOS 6.3\n- R 3.0.1\n\n# \u691c\u8a3c\u904e\u7a0b\n\n1. Hive \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\n2. \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u6e96\u5099\n3. \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092 Hive \u306b\u30ed\u30fc\u30c9\u3059\u308b\n4. INSERT \u3067\u30c7\u30fc\u30bf\u3092\u751f\u6210\n5. \u751f\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\n6. R \u3067\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\n\n## Hive \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\n\n```sql\n\" \u5143\u3005\u306e CSV \u3092\u683c\u7d0d\u3059\u308b\u30c6\u30fc\u30d6\u30eb\nDROP TABLE IF EXISTS test_r;\nCREATE TABLE IF NOT EXISTS test_r (\n    clm1 STRING,\n    clm2 STRING,\n    clm3 STRING\n)\nROW FORMAT DELIMITED fields terminated by ','\nSTORED AS TEXTFILE;\n\n\" INSERT \u3067\u4f5c\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u30c6\u30fc\u30d6\u30eb\nDROP TABLE IF EXISTS test_r2;\nCREATE TABLE IF NOT EXISTS test_r2 (\n    clm1 STRING,\n    clm2 STRING,\n    clm3 STRING\n)\nPARTITIONED BY (dt STRING)\nROW FORMAT DELIMITED fields terminated by ','\nSTORED AS TEXTFILE;\n```\n\n## \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\n\n\u30c6\u30b9\u30c8\u7528\u306e CSV \u30d5\u30a1\u30a4\u30eb\u306f\uff0c\u3064\u304e\u3067\u3042\u308b\uff0e\n\u30d5\u30a1\u30a4\u30eb\u3092 /tmp/data.csv \u306b\u914d\u7f6e\u3059\u308b\uff0e\n\n```\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n1,2,3\n```\n\n## \u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\n\n```sql\n\" CSV \u3092\u30ed\u30fc\u30c9\nLOAD DATA LOCAL INPATH '/tmp/data.csv' OVERWRITE INTO TABLE test_r;\n\n\" \u30ed\u30fc\u30c9\u3057\u305f CSV \u3092 INSERT \u3067\u5225\u30c6\u30fc\u30d6\u30eb\u306b\u683c\u7d0d\n\" \u30c7\u30fc\u30bf\u304c\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u305f\u3068\u304d\u306f mapred.output.compression.type \u3092 ROW \u306b\u3057\u3066\u307f\u308b\u3068\u3044\u3044\uff1f\nSET hive.exec.compress.output=true;\nSET hive.exec.compress.intermediate=true;\nSET mapred.output.compression.type=BLOCK; \nSET mapred.output.compression.codec=org.apache.hadoop.io.compress.GzipCodec; \nINSERT OVERWRITE TABLE test_r2\n    PARTITION (dt = \"2013-01-01\")\nSELECT clm1, clm2, clm3 FROM test_r;\n```\n\n## R \u3067\u8aad\u307f\u8fbc\u3081\u308b\u304b\u691c\u8a3c\n\nHIve \u306e INSERT \u3067\u751f\u6210\u3057\u305f\u30c7\u30fc\u30bf\u3092 R \u306e read.csv \u3067\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u305f\uff0e\n\n```\n# HDFS \u304b\u3089\u30ed\u30fc\u30ab\u30eb\u306b\u30b3\u30d4\u30fc\n> hdfs dfs -copyToLocal /user/hive/warehouse/test_r2/dt=2013-01-01/000000_0.gz .\n# file \u3092\u78ba\u8a8d\n> file 000000_0.gz\n000000_0.gz: gzip compressed data, from Unix\n\n# R \u3067\u8aad\u307f\u8fbc\u3080\nR> data <- read.csv(\"000000_0.gz\")\nR> head(data)\n> head(data)\n  X1 X2 X3\n1  1  2  3\n2  1  2  3\n3  1  2  3\n4  1  2  3\n5  1  2  3\n6  1  2  3\n```"}