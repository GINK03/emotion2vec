{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u4f55\u756a\u714e\u3058\u304b\u77e5\u308a\u307e\u305b\u3093\u304c\u3001WebGL\u3067Flash\u307f\u305f\u3044\u306a\u4f7f\u3044\u304b\u305f\u304c\u3067\u304d\u306a\u3044\u3082\u306e\u304b\u3068\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u5206\u6563\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u304cWebGL\u3068Flash\u306e\u5927\u304d\u306a\u9055\u3044\u3067\u3042\u308b\u3068\u611f\u3058\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u304b\u3089\u3067\u3059\u3002\n\u5177\u4f53\u7684\u306a\u7528\u9014\u306f\u3084\u306f\u308a\u5e83\u544a\u3067\u3057\u3087\u3046\u304b\u3002\n\u30d6\u30ed\u30b0\u30d1\u30fc\u30c4\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u3082\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\u3044\u308f\u3086\u308bWebGL\u51fa\u529b\u306e\u4e00\u7a2e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u52d5\u304f\u30c7\u30e2\u306e\u30da\u30fc\u30b8\n\n\u4ed5\u7d44\u307f\u306e\u6982\u8981\n\u7d50\u8ad6\u304b\u3089\u3044\u3046\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u751f\u6210\u3057\u3001\n\nwebgl_content_packed.js\n(function (win, doc) {\n    var images = {};\n    images['tex.png'] = new Image();\n    images['tex.png'].src = 'data:image/png;base64,iVBORw0KGgoA ..... ';\n\n    doc.write('<canvas style=\\\"width: 100%;height: 100%;\\\"></canvas>');\n    var canvas_list = doc.getElementsByTagName('canvas');\n    var canvas = canvas_list[canvas_list.length - 1];\n\n    var script_text = win.atob('KG5ldyBmdW5jdGlvbiAoKSB7DQoNCiA ..... ');\n    var js = eval(script_text);\n    var env = {\n        'window': win,\n        'document': doc,\n        'canvas': canvas,\n        'script': js,\n        'resources': {\n        'images': images\n        }\n    };\n    js.initialize(env);\n})(window, document, null);\n\n\n\u6b21\u306e\u3088\u3046\u306bHTML\u306b\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\nindex.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Packing test</title>\n    <style>\n        div#container {\n            width: 480px;\n            height: 480px;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"container\">\n        <script src=\"webgl_content_packed.js\"></script>\n    </div>\n</body>\n</html>\n\n\n\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nWebGL\u3068\u95a2\u4fc2\u306a\u304b\u3063\u305f\u308a\u3057\u307e\u3059\u304c\u7b46\u8005\u306fWebGL\u754c\u9688\u306e\u4eba\u306a\u306e\u3067\u2026\n\ncanvas\u30bf\u30b0\u3092\u751f\u6210\u3057\u3066\u3044\u308b\u306e\u3067script\u30bf\u30b0\uff11\u3064\u3067\u8868\u793a\u3067\u304d\u308b\n\u753b\u50cf\u30c7\u30fc\u30bf\u3092Data URI scheme\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u753b\u50cf\u304c\u76d7\u307e\u308c\u306a\u3044\uff08\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u3044\n\u30b9\u30af\u30ea\u30d7\u30c8\u306fData URI scheme\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304c\u898b\u3089\u308c\u306a\u3044\uff08\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u3044\n\n\nC#\u306b\u3088\u308b\u30d1\u30c3\u30ad\u30f3\u30b0\ninputImageFileNames \u3067\u6307\u5b9a\u3057\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092base64\u306e\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001inputScriptFileNames \u3067\u6307\u5b9a\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6587\u5b57\u5217\u3067\u7e4b\u3052\u305f\u3082\u306e\u3092base64\u306e\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u307e\u3059\u3002\ndebugMode\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092base64\u306b\u3057\u306a\u3044\u3067\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08\u30c7\u30d0\u30c3\u30b0\u7528\uff09\u3002\n\nProgram.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.IO;\n\nnamespace WebGLPacking\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            // \u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n            string inputDirectory = @\"../../../src\";\n\n            var inputImageFileNames = new List<string>()\n            {\n                @\"tex.png\",\n            };\n\n            var inputScriptFileNames = new List<string>()\n            {\n                @\"packing_head.js\",\n                @\"gl-matrix-min.js\",\n                @\"main.js\",\n                @\"packing_tail.js\",\n            };\n\n            string outputDirectory = @\"../../../\";\n            string outputFile = @\"webgl_content_packed.js\";\n\n            bool debugMode = false;\n\n            // \u5916\u5074\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n            string templateScript1 = @\"\n(function (win, doc) {\n    var images = {};\n\";\n\n            string templateScript2 = @\"\n\n    doc.write('<canvas style=\\\"\"width: 100%;height: 100%;\\\"\"></canvas>');\n    var canvas_list = doc.getElementsByTagName('canvas');\n    var canvas = canvas_list[canvas_list.length - 1];\n\";\n\n            string templateScript3;\n            string templateScript4;\n            if (debugMode)\n            {\n                templateScript3 = @\"\n    var js = \";\n\n                templateScript4 = @\";\";\n            }\n            else\n            {\n                templateScript3 = @\"\n    var script_text = win.atob('\";\n\n                templateScript4 = @\"');\n    var js = eval(script_text);\n\";\n            }\n\n            string templateScript5 = @\"\n    var env = {\n        'window': win,\n        'document': doc,\n        'canvas': canvas,\n        'script': js,\n        'resources': {\n        'images': images\n        }\n    };\n    js.initialize(env);\n})(window, document, null);\n\";\n            // \u753b\u50cf\u30c7\u30fc\u30bf\u90e8\u5206\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u751f\u6210\n            var resultSB = new StringBuilder();\n            resultSB.Append(templateScript1);\n\n            foreach (string fileName in inputImageFileNames)\n            {\n                string imageName = Path.GetFileName(fileName);\n\n                byte[] imageFileBytes = File.ReadAllBytes(Path.Combine(inputDirectory, fileName));\n                string imageFileBase64Text = Convert.ToBase64String(imageFileBytes);\n\n                resultSB.Append(\"\\r\\n\");\n                resultSB.Append(string.Format(\"\\timages['{0}'] = new Image();\", imageName));\n                resultSB.Append(\"\\r\\n\");\n                resultSB.Append(string.Format(\"\\timages['{0}'].src = 'data:image/png;base64,{1}';\"\n                                                , imageName, imageFileBase64Text));\n            }\n\n            resultSB.Append(templateScript2);\n\n            resultSB.Append(templateScript3);\n\n            // \u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30fc\u30bf\u90e8\u5206\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u751f\u6210\n            var scriptSB = new StringBuilder();\n            foreach (string fileName in inputScriptFileNames)\n            {\n                string scriptText = File.ReadAllText(Path.Combine(inputDirectory, fileName));\n                scriptSB.Append(scriptText);\n                scriptSB.Append(\"\\r\\n\");\n            }\n\n            if (debugMode)\n            {\n                resultSB.Append(scriptSB.ToString());\n            }\n            else\n            {\n                byte[] scriptTextBytes = System.Text.Encoding.UTF8.GetBytes(scriptSB.ToString());\n                string scriptBase64Text = Convert.ToBase64String(scriptTextBytes);\n                resultSB.Append(scriptBase64Text);\n            }\n\n            resultSB.Append(templateScript4);\n\n            // \u6700\u5f8c\u306e\u90e8\u5206\u306e\u751f\u6210\n            resultSB.Append(templateScript5);\n\n            // \u30d5\u30a1\u30a4\u30eb\u51fa\u529b\n            File.WriteAllText(Path.Combine(outputDirectory, outputFile), resultSB.ToString());\n        }\n    }\n}\n\n\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u3001\u5909\u63db\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u3082\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\nWebGL\u306e\u305f\u3081\u9577\u3005\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u5fc5\u8981\u306a\u306e\u306f\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5168\u3066\u9023\u7d50\u3059\u308b\u3053\u3068\u3067 initialize(env) \u3068\u3044\u3046\u95a2\u6570\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u30021\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u305f\u3081\u3001\u5168\u3066\u306e\u6a5f\u80fd\u3092\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u306b\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\npacking_head.js\n(new function () {\n\n\n\ngl-matrix-min.js\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u305f\u3081\u7701\u7565\n\n\n\nmain.js\n\n    this.onload = function () {\n\n        var screenWidth = _env.canvas.offsetWidth;\n        var screenHeight = _env.canvas.offsetHeight;\n        _env.canvas.width = screenWidth;\n        _env.canvas.height = screenHeight;\n\n        var gl = _env.canvas.getContext('experimental-webgl');\n\n        // initialize model buffers\n        var positionData = [\n            -1.0, 1.0, 0.0,\n            1.0, 1.0, 0.0,\n            -1.0, -1.0, 0.0,\n            1.0, -1.0, 0.0\n        ];\n        var textureCoordData = [\n            0.0, 0.0,\n            1.0, 0.0,\n            0.0, 1.0,\n            1.0, 1.0\n        ];\n        var indexData = [\n            0, 1, 2,\n            3, 2, 1\n        ];\n\n        var positionBuffer     = createVertexBuffer(positionData, gl);\n        var textureCoordBuffer = createVertexBuffer(textureCoordData, gl);\n        var indexBuffer        = createIndexBuffer(indexData, gl);\n\n        // initialize texture\n        var texture = createTexture(_env.resources.images[\"tex.png\"], gl);\n\n        // initialize the shader\n        var vertexShaderSrc = \"\\\n            attribute vec3  aPosition;\\\n            attribute vec2  aTextureCoord;\\\n            uniform   mat4  uMvpMatrix;\\\n            uniform   float uZoom;\\\n            varying   vec2  vTextureCoord;\\\n            void main(void){\\\n                gl_Position = uMvpMatrix * vec4(aPosition, 1.0);\\\n                gl_Position.xy *= uZoom;\\\n                vTextureCoord = aTextureCoord;\\\n            }\\\n        \";\n\n        var fragmentShaderSrc = \"\\\n            precision mediump float;\\\n            uniform sampler2D uTexture;\\\n            uniform float     uAlpha;\\\n            varying vec2      vTextureCoord;\\\n            void main(void){\\\n                gl_FragColor = texture2D(uTexture, vTextureCoord);\\\n                gl_FragColor.a = gl_FragColor.a * uAlpha;\\\n            }\\\n        \";\n\n        var vertexShader = createShader(vertexShaderSrc, gl.VERTEX_SHADER, gl);\n        var fragmentShader = createShader(fragmentShaderSrc, gl.FRAGMENT_SHADER, gl);\n        var program = createProgram(vertexShader, fragmentShader, gl);\n\n        var aPosition = setFloatVertexAttribute(program, 'aPosition', positionBuffer, 3, gl);\n        var aTextureCoord = setFloatVertexAttribute(program, 'aTextureCoord', textureCoordBuffer, 2, gl);\n\n        var uMvpMatrix = gl.getUniformLocation(program, 'uMvpMatrix');\n        var uTexture = gl.getUniformLocation(program, 'uTexture');\n        var uZoom = gl.getUniformLocation(program, 'uZoom');\n        var uAlpha = gl.getUniformLocation(program, 'uAlpha');\n\n        // main loop\n        var eyeLocation = vec3.create();\n        var lookatLocation = vec3.create();\n        var upVector = vec3.create();\n        var modelLocation = vec3.create();\n        var modelMatrix = mat4.create();\n        var viewMatrix = mat4.create();\n        var projMatrix = mat4.create();\n        var mvpMatrix = mat4.create();\n        var tempVec3 = vec3.create();\n\n        var start_time = new Date().getTime();\n\n        (function () {\n\n            var local_time = (new Date().getTime() - start_time) * 0.001;\n\n            vec3.set(eyeLocation, 0.0, -6.0, 4.0);\n            vec3.set(lookatLocation, 0.0, 0.0, 0.0);\n            vec3.set(upVector, 0.0, 0.0, 1.0);\n            mat4.perspective(projMatrix, 45.0 * Math.PI / 180, screenWidth / screenHeight, 0.1, 100.0);\n            mat4.lookAt(viewMatrix, eyeLocation, lookatLocation, upVector);\n            mat4.multiply(projMatrix, projMatrix, viewMatrix);\n\n            vec3.set(modelLocation, 0.0, 0.0, 0.0);\n            mat4.identity(modelMatrix);\n            mat4.translate(modelMatrix, modelMatrix, modelLocation);\n            mat4.rotateZ(modelMatrix, modelMatrix, local_time);\n            mat4.scale(modelMatrix, modelMatrix, vec3.set(tempVec3, 2.0, 2.0, 2.0));\n\n            mat4.multiply(mvpMatrix, projMatrix, modelMatrix);\n\n            gl.clearColor(0.0, 0.0, 1.0, 1.0);\n            gl.clearDepth(1.0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n            gl.disable(gl.DEPTH_TEST);\n            gl.disable(gl.CULL_FACE);\n            gl.enable(gl.BLEND);\n            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n\n            gl.useProgram(program);\n\n            gl.uniformMatrix4fv(uMvpMatrix, false, mvpMatrix);\n            gl.uniform1i(uTexture, 0);\n            gl.uniform1f(uAlpha, 1.0);\n            gl.uniform1f(uZoom, 1.5);\n\n            gl.drawElements(gl.TRIANGLES, indexData.length, gl.UNSIGNED_SHORT, 0);\n\n            setTimeout(arguments.callee, 1000 / 30);\n        })();\n    };\n\n    var createVertexBuffer = function (data, gl) {\n\n        var buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        return buffer;\n    };\n\n    var createIndexBuffer = function (data, gl) {\n\n        var buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Int16Array(data), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        return buffer;\n    };\n\n    var createTexture = function (image, gl) {\n\n        var textrue = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, textrue);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        return textrue;\n    };\n\n    var createShader = function (sourceCodeText, shaderType, gl) {\n\n        var shader = gl.createShader(shaderType);\n        gl.shaderSource(shader, sourceCodeText);\n        gl.compileShader(shader);\n\n        if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            return shader;\n        } else {\n            alert(gl.getShaderInfoLog(shader));\n            return null;\n        }\n    };\n\n    var createProgram = function (vs, fs, gl) {\n\n        var program = gl.createProgram();\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        gl.linkProgram(program);\n\n        if (gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            return program;\n        } else {\n            alert(gl.getProgramInfoLog(program));\n            return null;\n        }\n    };\n\n    var setFloatVertexAttribute = function (program, attribName, buffer, elementCount, gl) {\n\n        var attribute = gl.getAttribLocation(program, attribName);\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.enableVertexAttribArray(attribute);\n        gl.vertexAttribPointer(attribute, elementCount, gl.FLOAT, false, 4 * elementCount, 0);\n\n        return attribute;\n    };\n\n\n\n\npacking_tail.js\n\n    var _env;\n\n    this.initialize = function (env) {\n        _env = env;\n        _env.document.addEventListener('DOMContentLoaded', this.onload, false);\n    }\n})\n\n\n\u4f7f\u7528\u30c6\u30af\u30b9\u30c1\u30e3\u3067\u3059\u3002\u3053\u306e\u4e0b\u306b\u9003\u3052\u51fa\u3057\u305f\u304f\u306a\u308b\u3088\u3046\u306a\u4f55\u304b\u304c\u3042\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\n\u304a\u308f\u308a\u306b\n\u3082\u3063\u3068\u826f\u3044\u3084\u308a\u65b9\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3057\u3001\u554f\u984c\u3082\u8272\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u30da\u30fc\u30b8\u306e\u8868\u793a\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u306b\u306a\u308b\u554f\u984c\u3082\u3042\u308a\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u9045\u5ef6\u8aad\u307f\u8fbc\u307f\u3059\u308c\u3070\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u305d\u308c\u3060\u3068\uff11\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u305f\u610f\u5473\u304c\u306a\u3044\u3067\u3059\u3057\u3002\n\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u305d\u3046\u3044\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u304f\u308c\u308c\u3070\u3044\u3044\u3093\u3067\u3059\u304c\u2026\u3002\n\u3057\u304b\u3057\u3001\u3068\u3082\u304b\u304f\uff11\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308b\u3053\u3068\u3067\u914d\u5e03\u3057\u3084\u3059\u304f\u306a\u308b\u306a\u3069\u306e\u5229\u70b9\u3082\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u308b\u304b\u306a\u3041\u3002\n\u7b46\u8005\u306e\u6c17\u6301\u3061\u3068\u3057\u3066\u306f\u3001\u672c\u5f53\u306bFlash\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001WebGL\u306e\u7528\u9014\u304c\u5e83\u304c\u308c\u3070\u3044\u3044\u306a\u3068\u3044\u3046\u6c17\u6301\u3061\u3067\u304a\u308a\u307e\u3059\u3002\nWebGL\u754c\u9688\u306e\u4eba\u306a\u306e\u3067\u3002\n#\u306f\u3058\u3081\u306b\n\u4f55\u756a\u714e\u3058\u304b\u77e5\u308a\u307e\u305b\u3093\u304c\u3001WebGL\u3067Flash\u307f\u305f\u3044\u306a\u4f7f\u3044\u304b\u305f\u304c\u3067\u304d\u306a\u3044\u3082\u306e\u304b\u3068\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u5206\u6563\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u304cWebGL\u3068Flash\u306e\u5927\u304d\u306a\u9055\u3044\u3067\u3042\u308b\u3068\u611f\u3058\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u304b\u3089\u3067\u3059\u3002\n\n\u5177\u4f53\u7684\u306a\u7528\u9014\u306f\u3084\u306f\u308a\u5e83\u544a\u3067\u3057\u3087\u3046\u304b\u3002\n\u30d6\u30ed\u30b0\u30d1\u30fc\u30c4\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u3082\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\u3044\u308f\u3086\u308bWebGL\u51fa\u529b\u306e\u4e00\u7a2e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\n[\u52d5\u304f\u30c7\u30e2\u306e\u30da\u30fc\u30b8](http://www.geocities.jp/warotarock/main/demos/webgl_packing/)\n\n#\u4ed5\u7d44\u307f\u306e\u6982\u8981\n\u7d50\u8ad6\u304b\u3089\u3044\u3046\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u751f\u6210\u3057\u3001\n\n```js:webgl_content_packed.js\n(function (win, doc) {\n    var images = {};\n\timages['tex.png'] = new Image();\n\timages['tex.png'].src = 'data:image/png;base64,iVBORw0KGgoA ..... ';\n\t\n    doc.write('<canvas style=\\\"width: 100%;height: 100%;\\\"></canvas>');\n    var canvas_list = doc.getElementsByTagName('canvas');\n    var canvas = canvas_list[canvas_list.length - 1];\n\n    var script_text = win.atob('KG5ldyBmdW5jdGlvbiAoKSB7DQoNCiA ..... ');\n    var js = eval(script_text);\n    var env = {\n        'window': win,\n        'document': doc,\n        'canvas': canvas,\n        'script': js,\n        'resources': {\n        'images': images\n        }\n    };\n    js.initialize(env);\n})(window, document, null);\n```\n\n\u6b21\u306e\u3088\u3046\u306bHTML\u306b\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```html:index.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>Packing test</title>\n    <style>\n        div#container {\n            width: 480px;\n            height: 480px;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"container\">\n        <script src=\"webgl_content_packed.js\"></script>\n    </div>\n</body>\n</html>\n```\n\n\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\nWebGL\u3068\u95a2\u4fc2\u306a\u304b\u3063\u305f\u308a\u3057\u307e\u3059\u304c\u7b46\u8005\u306fWebGL\u754c\u9688\u306e\u4eba\u306a\u306e\u3067\u2026\n\n* canvas\u30bf\u30b0\u3092\u751f\u6210\u3057\u3066\u3044\u308b\u306e\u3067script\u30bf\u30b0\uff11\u3064\u3067\u8868\u793a\u3067\u304d\u308b\n* \u753b\u50cf\u30c7\u30fc\u30bf\u3092Data URI scheme\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u753b\u50cf\u304c\u76d7\u307e\u308c\u306a\u3044\uff08\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u3044\n* \u30b9\u30af\u30ea\u30d7\u30c8\u306fData URI scheme\u3067\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u306e\u3067\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u304c\u898b\u3089\u308c\u306a\u3044\uff08\u305d\u3093\u306a\u3053\u3068\u306f\u306a\u3044\n\n\n\n#C#\u306b\u3088\u308b\u30d1\u30c3\u30ad\u30f3\u30b0\ninputImageFileNames \u3067\u6307\u5b9a\u3057\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092base64\u306e\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001inputScriptFileNames \u3067\u6307\u5b9a\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u6587\u5b57\u5217\u3067\u7e4b\u3052\u305f\u3082\u306e\u3092base64\u306e\u6587\u5b57\u5217\u306b\u5909\u63db\u3057\u307e\u3059\u3002\ndebugMode\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092base64\u306b\u3057\u306a\u3044\u3067\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\uff08\u30c7\u30d0\u30c3\u30b0\u7528\uff09\u3002\n\n\n```csharp:Program.cs\nusing System;\nusing System.Collections.Generic;\nusing System.Text;\nusing System.IO;\n\nnamespace WebGLPacking\n{\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            // \u5165\u51fa\u529b\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\n            string inputDirectory = @\"../../../src\";\n\n            var inputImageFileNames = new List<string>()\n            {\n                @\"tex.png\",\n            };\n\n            var inputScriptFileNames = new List<string>()\n            {\n                @\"packing_head.js\",\n                @\"gl-matrix-min.js\",\n                @\"main.js\",\n                @\"packing_tail.js\",\n            };\n\n            string outputDirectory = @\"../../../\";\n            string outputFile = @\"webgl_content_packed.js\";\n\n            bool debugMode = false;\n\n            // \u5916\u5074\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n            string templateScript1 = @\"\n(function (win, doc) {\n    var images = {};\n\";\n\n            string templateScript2 = @\"\n\n    doc.write('<canvas style=\\\"\"width: 100%;height: 100%;\\\"\"></canvas>');\n    var canvas_list = doc.getElementsByTagName('canvas');\n    var canvas = canvas_list[canvas_list.length - 1];\n\";\n            \n            string templateScript3;\n            string templateScript4;\n            if (debugMode)\n            {\n                templateScript3 = @\"\n    var js = \";\n\n                templateScript4 = @\";\";\n            }\n            else\n            {\n                templateScript3 = @\"\n    var script_text = win.atob('\";\n\n                templateScript4 = @\"');\n    var js = eval(script_text);\n\";\n            }\n\n            string templateScript5 = @\"\n    var env = {\n        'window': win,\n        'document': doc,\n        'canvas': canvas,\n        'script': js,\n        'resources': {\n        'images': images\n        }\n    };\n    js.initialize(env);\n})(window, document, null);\n\";\n            // \u753b\u50cf\u30c7\u30fc\u30bf\u90e8\u5206\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u751f\u6210\n            var resultSB = new StringBuilder();\n            resultSB.Append(templateScript1);\n\n            foreach (string fileName in inputImageFileNames)\n            {\n                string imageName = Path.GetFileName(fileName);\n\n                byte[] imageFileBytes = File.ReadAllBytes(Path.Combine(inputDirectory, fileName));\n                string imageFileBase64Text = Convert.ToBase64String(imageFileBytes);\n\n                resultSB.Append(\"\\r\\n\");\n                resultSB.Append(string.Format(\"\\timages['{0}'] = new Image();\", imageName));\n                resultSB.Append(\"\\r\\n\");\n                resultSB.Append(string.Format(\"\\timages['{0}'].src = 'data:image/png;base64,{1}';\"\n                                                , imageName, imageFileBase64Text));\n            }\n\n            resultSB.Append(templateScript2);\n\n            resultSB.Append(templateScript3);\n\n            // \u30b9\u30af\u30ea\u30d7\u30c8\u30c7\u30fc\u30bf\u90e8\u5206\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u751f\u6210\n            var scriptSB = new StringBuilder();\n            foreach (string fileName in inputScriptFileNames)\n            {\n                string scriptText = File.ReadAllText(Path.Combine(inputDirectory, fileName));\n                scriptSB.Append(scriptText);\n                scriptSB.Append(\"\\r\\n\");\n            }\n\n            if (debugMode)\n            {\n                resultSB.Append(scriptSB.ToString());\n            }\n            else\n            {\n                byte[] scriptTextBytes = System.Text.Encoding.UTF8.GetBytes(scriptSB.ToString());\n                string scriptBase64Text = Convert.ToBase64String(scriptTextBytes);\n                resultSB.Append(scriptBase64Text);\n            }\n\n            resultSB.Append(templateScript4);\n\n            // \u6700\u5f8c\u306e\u90e8\u5206\u306e\u751f\u6210\n            resultSB.Append(templateScript5);\n\n            // \u30d5\u30a1\u30a4\u30eb\u51fa\u529b\n            File.WriteAllText(Path.Combine(outputDirectory, outputFile), resultSB.ToString());\n        }\n    }\n}\n```\n\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u3001\u5909\u63db\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u3082\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\nWebGL\u306e\u305f\u3081\u9577\u3005\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u5fc5\u8981\u306a\u306e\u306f\u3053\u308c\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u5168\u3066\u9023\u7d50\u3059\u308b\u3053\u3068\u3067 initialize(env) \u3068\u3044\u3046\u95a2\u6570\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u30021\u30d5\u30a1\u30a4\u30eb\u306b\u3059\u308b\u305f\u3081\u3001\u5168\u3066\u306e\u6a5f\u80fd\u3092\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u306b\u5165\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```js:packing_head.js\n(new function () {\n```\n\n\n```js:gl-matrix-min.js\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u305f\u3081\u7701\u7565\n```\n\n```js:main.js\n\n    this.onload = function () {\n\n        var screenWidth = _env.canvas.offsetWidth;\n        var screenHeight = _env.canvas.offsetHeight;\n        _env.canvas.width = screenWidth;\n        _env.canvas.height = screenHeight;\n\n        var gl = _env.canvas.getContext('experimental-webgl');\n\n        // initialize model buffers\n        var positionData = [\n            -1.0, 1.0, 0.0,\n            1.0, 1.0, 0.0,\n            -1.0, -1.0, 0.0,\n            1.0, -1.0, 0.0\n        ];\n        var textureCoordData = [\n            0.0, 0.0,\n            1.0, 0.0,\n            0.0, 1.0,\n            1.0, 1.0\n        ];\n        var indexData = [\n            0, 1, 2,\n            3, 2, 1\n        ];\n\n        var positionBuffer     = createVertexBuffer(positionData, gl);\n        var textureCoordBuffer = createVertexBuffer(textureCoordData, gl);\n        var indexBuffer        = createIndexBuffer(indexData, gl);\n\n        // initialize texture\n        var texture = createTexture(_env.resources.images[\"tex.png\"], gl);\n\n        // initialize the shader\n        var vertexShaderSrc = \"\\\n            attribute vec3  aPosition;\\\n            attribute vec2  aTextureCoord;\\\n            uniform   mat4  uMvpMatrix;\\\n            uniform   float uZoom;\\\n            varying   vec2  vTextureCoord;\\\n            void main(void){\\\n                gl_Position = uMvpMatrix * vec4(aPosition, 1.0);\\\n                gl_Position.xy *= uZoom;\\\n                vTextureCoord = aTextureCoord;\\\n            }\\\n        \";\n\n        var fragmentShaderSrc = \"\\\n            precision mediump float;\\\n            uniform sampler2D uTexture;\\\n            uniform float     uAlpha;\\\n            varying vec2      vTextureCoord;\\\n            void main(void){\\\n                gl_FragColor = texture2D(uTexture, vTextureCoord);\\\n                gl_FragColor.a = gl_FragColor.a * uAlpha;\\\n            }\\\n        \";\n\n        var vertexShader = createShader(vertexShaderSrc, gl.VERTEX_SHADER, gl);\n        var fragmentShader = createShader(fragmentShaderSrc, gl.FRAGMENT_SHADER, gl);\n        var program = createProgram(vertexShader, fragmentShader, gl);\n\n        var aPosition = setFloatVertexAttribute(program, 'aPosition', positionBuffer, 3, gl);\n        var aTextureCoord = setFloatVertexAttribute(program, 'aTextureCoord', textureCoordBuffer, 2, gl);\n\n        var uMvpMatrix = gl.getUniformLocation(program, 'uMvpMatrix');\n        var uTexture = gl.getUniformLocation(program, 'uTexture');\n        var uZoom = gl.getUniformLocation(program, 'uZoom');\n        var uAlpha = gl.getUniformLocation(program, 'uAlpha');\n\n        // main loop\n        var eyeLocation = vec3.create();\n        var lookatLocation = vec3.create();\n        var upVector = vec3.create();\n        var modelLocation = vec3.create();\n        var modelMatrix = mat4.create();\n        var viewMatrix = mat4.create();\n        var projMatrix = mat4.create();\n        var mvpMatrix = mat4.create();\n        var tempVec3 = vec3.create();\n\n        var start_time = new Date().getTime();\n\n        (function () {\n\n            var local_time = (new Date().getTime() - start_time) * 0.001;\n\n            vec3.set(eyeLocation, 0.0, -6.0, 4.0);\n            vec3.set(lookatLocation, 0.0, 0.0, 0.0);\n            vec3.set(upVector, 0.0, 0.0, 1.0);\n            mat4.perspective(projMatrix, 45.0 * Math.PI / 180, screenWidth / screenHeight, 0.1, 100.0);\n            mat4.lookAt(viewMatrix, eyeLocation, lookatLocation, upVector);\n            mat4.multiply(projMatrix, projMatrix, viewMatrix);\n\n            vec3.set(modelLocation, 0.0, 0.0, 0.0);\n            mat4.identity(modelMatrix);\n            mat4.translate(modelMatrix, modelMatrix, modelLocation);\n            mat4.rotateZ(modelMatrix, modelMatrix, local_time);\n            mat4.scale(modelMatrix, modelMatrix, vec3.set(tempVec3, 2.0, 2.0, 2.0));\n\n            mat4.multiply(mvpMatrix, projMatrix, modelMatrix);\n\n            gl.clearColor(0.0, 0.0, 1.0, 1.0);\n            gl.clearDepth(1.0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, texture);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n\n            gl.disable(gl.DEPTH_TEST);\n            gl.disable(gl.CULL_FACE);\n            gl.enable(gl.BLEND);\n            gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\n\n            gl.useProgram(program);\n\n            gl.uniformMatrix4fv(uMvpMatrix, false, mvpMatrix);\n            gl.uniform1i(uTexture, 0);\n            gl.uniform1f(uAlpha, 1.0);\n            gl.uniform1f(uZoom, 1.5);\n\n            gl.drawElements(gl.TRIANGLES, indexData.length, gl.UNSIGNED_SHORT, 0);\n\n            setTimeout(arguments.callee, 1000 / 30);\n        })();\n    };\n\n    var createVertexBuffer = function (data, gl) {\n\n        var buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        return buffer;\n    };\n\n    var createIndexBuffer = function (data, gl) {\n\n        var buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Int16Array(data), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        return buffer;\n    };\n\n    var createTexture = function (image, gl) {\n\n        var textrue = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, textrue);\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n\n        return textrue;\n    };\n\n    var createShader = function (sourceCodeText, shaderType, gl) {\n\n        var shader = gl.createShader(shaderType);\n        gl.shaderSource(shader, sourceCodeText);\n        gl.compileShader(shader);\n\n        if (gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n            return shader;\n        } else {\n            alert(gl.getShaderInfoLog(shader));\n            return null;\n        }\n    };\n\n    var createProgram = function (vs, fs, gl) {\n\n        var program = gl.createProgram();\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        gl.linkProgram(program);\n\n        if (gl.getProgramParameter(program, gl.LINK_STATUS)) {\n            return program;\n        } else {\n            alert(gl.getProgramInfoLog(program));\n            return null;\n        }\n    };\n\n    var setFloatVertexAttribute = function (program, attribName, buffer, elementCount, gl) {\n\n        var attribute = gl.getAttribLocation(program, attribName);\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.enableVertexAttribArray(attribute);\n        gl.vertexAttribPointer(attribute, elementCount, gl.FLOAT, false, 4 * elementCount, 0);\n\n        return attribute;\n    };\n\n```\n\n```js:packing_tail.js\n\n    var _env;\n\n    this.initialize = function (env) {\n        _env = env;\n        _env.document.addEventListener('DOMContentLoaded', this.onload, false);\n    }\n})\n```\n\n\u4f7f\u7528\u30c6\u30af\u30b9\u30c1\u30e3\u3067\u3059\u3002\u3053\u306e\u4e0b\u306b\u9003\u3052\u51fa\u3057\u305f\u304f\u306a\u308b\u3088\u3046\u306a\u4f55\u304b\u304c\u3042\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n![tex.png](https://qiita-image-store.s3.amazonaws.com/0/59191/98629d35-8dfc-36a5-4e27-303d879717ac.png)\n\n#\u304a\u308f\u308a\u306b\n\u3082\u3063\u3068\u826f\u3044\u3084\u308a\u65b9\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3057\u3001\u554f\u984c\u3082\u8272\u3005\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c\u5927\u304d\u304f\u306a\u308b\u3068\u30da\u30fc\u30b8\u306e\u8868\u793a\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u306b\u306a\u308b\u554f\u984c\u3082\u3042\u308a\u307e\u3059\u3002\n\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u9045\u5ef6\u8aad\u307f\u8fbc\u307f\u3059\u308c\u3070\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u305d\u308c\u3060\u3068\uff11\u30d5\u30a1\u30a4\u30eb\u306b\u3057\u305f\u610f\u5473\u304c\u306a\u3044\u3067\u3059\u3057\u3002\n\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u305d\u3046\u3044\u3046\u3053\u3068\u3092\u3084\u3063\u3066\u304f\u308c\u308c\u3070\u3044\u3044\u3093\u3067\u3059\u304c\u2026\u3002\n\n\u3057\u304b\u3057\u3001\u3068\u3082\u304b\u304f\uff11\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308b\u3053\u3068\u3067\u914d\u5e03\u3057\u3084\u3059\u304f\u306a\u308b\u306a\u3069\u306e\u5229\u70b9\u3082\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3042\u308b\u304b\u306a\u3041\u3002\n\u7b46\u8005\u306e\u6c17\u6301\u3061\u3068\u3057\u3066\u306f\u3001\u672c\u5f53\u306bFlash\u306e\u3088\u3046\u306a\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3001WebGL\u306e\u7528\u9014\u304c\u5e83\u304c\u308c\u3070\u3044\u3044\u306a\u3068\u3044\u3046\u6c17\u6301\u3061\u3067\u304a\u308a\u307e\u3059\u3002\nWebGL\u754c\u9688\u306e\u4eba\u306a\u306e\u3067\u3002\n", "tags": ["WebGL", "JavaScript", "HTML", "C#"]}