{"context": " More than 1 year has passed since last update.\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nServerspec\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u305f\u3068\u304d\u3001\u5185\u90e8\u306e\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u304c\u307f\u308c\u306a\u3044\u306e\u3067\u6b63\u3057\u304f\u30c6\u30b9\u30c8\u3067\u304d\u3066\u3044\u308b\u304b\u4e0d\u5b89\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3068\u7d50\u679c\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059\u65b9\u6cd5\u306f\u3001\u5225\u306e\u65b9\u304c\u3059\u3067\u306b\u6295\u7a3f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u308c\u3092\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u53c2\u8003\uff1aServerspec \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u306e\u30a8\u30d3\u30c7\u30f3\u30b9\u3092\u53d6\u5f97\n\u3053\u306e\u6295\u7a3f\u3067\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u3066\u3044\u308b\u90e8\u5206\u3092\u3001\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3057\u305f\u3060\u3051\u3067\u3059\u3002\n\n\u901a\u5e38\u306e\u7d50\u679c\u8868\u793a\nServerspec\u3092\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u306b\u3001\u5185\u90e8\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u306f\u8868\u793a\u3055\u308c\u306a\u3044\u3067\u3059\u3002\n[root@console serverspec]# rake spec\n/usr/bin/ruby -I/usr/local/share/gems/gems/rspec-core-3.4.2/lib:/usr/local/share/gems/gems/rspec-support-3.4.1/lib /usr/local/share/gems/gems/rspec-core-3.4.2/exe/rspec --pattern spec/localhost/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n\nService \"httpd\"\n  should be enabled\n  should be running\n\nPort \"80\"\n  should be listening\n\nCommand \"ls -al /\"\n  stdout\n    should match /bin/\n\nFinished in 0.10108 seconds (files took 0.41086 seconds to load)\n5 examples, 0 failures\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u66f4\u5f8c\u306e\u7d50\u679c\u8868\u793a\n\u7d50\u679c\u8868\u793a\u7528\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u66f8\u3044\u3066\u3001\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b3\u30de\u30f3\u30c9\u3068\u305d\u306e\u7d50\u679c\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u5f8c\u8ff0\u3002\n\u53c2\u8003\u5143\u3060\u3068.rspec\u30d5\u30a1\u30a4\u30eb\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7b49\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30c7\u30d0\u30c3\u30af\u6642\u3060\u3051\u8a73\u7d30\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u5b9f\u884c\u6642\u306eSPEC_OPTS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7b49\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n[root@console serverspec]# rake spec SPEC_OPTS=\"--format ServerspecDebugFormatter --require ./serverspec_debug_formatter.rb\"                                                                  \n/usr/bin/ruby -I/usr/local/share/gems/gems/rspec-core-3.4.2/lib:/usr/local/share/gems/gems/rspec-support-3.4.1/lib /usr/local/share/gems/gems/rspec-core-3.4.2/exe/rspec --pattern spec/localhost/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n    -- command\n    /bin/sh -c rpm\\ -q\\ httpd\n    -- stdout\n    httpd-2.4.6-40.el7.centos.x86_64\n\nService \"httpd\"\n  should be enabled\n    -- command\n    /bin/sh -c systemctl\\ --quiet\\ is-enabled\\ httpd\n    -- stdout\n  should be running\n    -- command\n    /bin/sh -c systemctl\\ is-active\\ httpd\n    -- stdout\n    active\n\nPort \"80\"\n  should be listening\n    -- command\n    /bin/sh -c ss\\ -tunl\\ \\|\\ grep\\ --\\ :80\\\\\\ \n    -- stdout\n    tcp    LISTEN     0      128      :::80                   :::*                  \n\nCommand \"ls -al /\"\n  stdout\n    should match /bin/\n      -- command\n      /bin/sh -c ls\\ -al\\ /\n      -- stdout\n      total 68\n      dr-xr-xr-x  71 root root 4096 Feb 13 14:51 .\n      dr-xr-xr-x  71 root root 4096 Feb 13 14:51 ..\n      -rw-r--r--   1 root root    0 Feb  6 01:18 .autorelabel\n      -rwxr-xr-x   1 root root    0 Feb  6 01:18 .dockerenv\n      -rwxr-xr-x   1 root root    0 Feb  6 01:18 .dockerinit\n      -rw-r--r--   1 root root   31 Feb 13 14:32 .rspec\n      -rw-r--r--   1 root root  685 Feb 13 12:20 Rakefile\n      lrwxrwxrwx   1 root root    7 Feb  6 01:22 bin -> usr/bin\n      dr-xr-xr-x   3 root root 4096 Feb 13 12:32 boot\n      drwxr-xr-x  15 root root 4380 Feb 11 01:02 dev\n      drwxr-xr-x 133 root root 4096 Feb 13 12:32 etc\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 home\n      lrwxrwxrwx   1 root root    7 Feb  6 01:22 lib -> usr/lib\n      lrwxrwxrwx   1 root root    9 Feb  6 01:22 lib64 -> usr/lib64\n      drwx------   2 root root 4096 Aug 14  2015 lost+found\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 media\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 mnt\n      drwxr-xr-x   3 root root 4096 Feb 10 14:17 opt\n      dr-xr-xr-x 196 root root    0 Feb 11 01:02 proc\n      dr-xr-x---   8 root root 4096 Feb 13 14:31 root\n      drwxr-xr-x  16 root root  360 Feb 13 15:59 run\n      lrwxrwxrwx   1 root root    8 Feb  6 01:22 sbin -> usr/sbin\n      drwxr-xr-x   1 1000 ftp   272 Feb  5 17:17 share\n      drwxr-xr-x   5 root root 4096 Feb 13 12:29 spec\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 srv\n      dr-xr-xr-x  13 root root    0 Feb 10 13:37 sys\n      drwxrwxrwt  15 root root 4096 Feb 13 15:59 tmp\n      drwxr-xr-x  46 root root 4096 Feb  6 01:22 usr\n      drwxr-xr-x  53 root root 4096 Feb 13 12:32 var\n      -- exit status\n      0\n\nFinished in 0.09723 seconds (files took 0.39293 seconds to load)\n5 examples, 0 failures\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u66f4\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\u30c7\u30d0\u30c3\u30af\u6642\u306b\u6307\u5b9a\u3059\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7528\u306eruby\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u30a4\u30f3\u30c7\u30f3\u30c8\u3084\u8868\u793a\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u51e6\u7406\u7684\u306b\u306f\u53c2\u8003\u5143\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30d5\u30a1\u30a4\u30eb\u51fa\u529b\u3057\u3066\u3044\u305f\u306e\u3092puts\u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\u3002\n\nserverspec_debug_formatter.rb\nrequire 'rspec/core/formatters/documentation_formatter'\nrequire 'specinfra'\nrequire 'serverspec/version'\nrequire 'serverspec/type/base'\nrequire 'serverspec/type/command'\n\nclass ServerspecDebugFormatter < RSpec::Core::Formatters::DocumentationFormatter\n  RSpec::Core::Formatters.register self, :example_group_started,\n                                   :example_passed, :example_pending, :example_failed\n\n  def initialize(output)\n    super\n  end\n\n  def example_group_started(notification)\n    @indent = 2 * (@group_level + 2)\n    super\n  end\n\n  def example_passed(notification)\n    super\n    puts_evidence(notification.example)\n  end\n\n  def example_pending(notification)\n    super\n    puts_evidence(notification.example)\n  end\n\n  def example_failed(notification)\n    super\n    puts_evidence(notification.example, notification.exception)\n  end\n\n  def puts_evidence(example, exception=nil)\n    # \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\n    puts ' ' * @indent + '-- command'\n    puts ' ' * @indent + example.metadata[:command]\n\n    # \u6a19\u6e96\u51fa\u529b\n    if example.metadata[:stdout]\n      puts ' ' * @indent + '-- stdout'\n      example.metadata[:stdout].lines do |line|\n        puts ' ' * @indent + line\n      end\n    end\n\n    # RSpec\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n    if exception\n      puts ' ' * @indent + '-- exception'\n      exception.message.lines do |line|\n        puts ' ' * @indent + line\n      end\n    end\n\n    # \u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3068\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\uff08command\u30ea\u30bd\u30fc\u30b9\u306e\u307f\uff09\n    resource = example.metadata[:described_class]\n    if resource.kind_of? Serverspec::Type::Command\n      unless resource.stderr.to_s.empty?\n        puts ' ' * @indent + '-- stderr'\n        resource.stderr.lines do |line|\n          puts ' ' * @indent + line\n        end\n      end\n      puts ' ' * @indent + '-- exit status'\n      puts ' ' * @indent + resource.exit_status.to_s\n    end\n  end\nend\n\n\n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3053\u3093\u306a\u98a8\u306b\u914d\u7f6e\u3057\u3066\u3001\n[root@console serverspec]# tree .\n.           \n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 serverspec_debug_formatter.rb\n\u2514\u2500\u2500 spec\n    \u251c\u2500\u2500 localhost\n    \u2502   \u2514\u2500\u2500 sample_spec.rb\n    \u2514\u2500\u2500 spec_helper.rb\n\nServerspec\u5b9f\u884c\u6642\u306eSPEC_OPTS\u3067\u6307\u5b9a\u3057\u3066\u3084\u308c\u3070\u3001\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3092\u6a19\u6e96\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n# rake spec SPEC_OPTS=\"--format ServerspecDebugFormatter --require ./serverspec_debug_formatter.rb\"\n\n\u666e\u6bb5\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306a\u3057\u306erake spec\u3067\u5b9f\u884c\u3057\u3066\u3001\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306e\u30c7\u30d0\u30c3\u30af\u3084\u3001\u304d\u3061\u3093\u3068\u8a3c\u8de1\u3092\u6b8b\u3059\u6642\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u3048\u3066\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3092\u8868\u793a\u3059\u308b\u3068\u304b\u3067\u3059\u3002\n\n\u30a8\u30e9\u30fc\u51fa\u529b\u304c\u3046\u307e\u304f\u3068\u308c\u306a\u3044\uff1f\n\u30b3\u30de\u30f3\u30c9\u306e\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3082\u8868\u793a\u3067\u304d\u308b\u306f\u305a\u3060\u3063\u305f\u3093\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u304c\u8868\u793a\u3055\u308c\u306a\u304b\u3063\u305f\u3067\u3059\u3002\u305d\u3082\u305d\u3082\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u30c6\u30b9\u30c8\u3059\u308b\u5b9a\u7fa9Serverspec\u3067\u66f8\u3044\u3066\u3082\u3001\u7d50\u679c\u304c\u30d6\u30e9\u30f3\u30af\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u306e\u3067\u74b0\u5883\u304c\u60aa\u3044\u306e\u304b\u3082\u3002\u539f\u56e0\u304c\u308f\u304b\u3063\u305f\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n# \u3084\u308a\u305f\u3044\u3053\u3068\nServerspec\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u3044\u305f\u3068\u304d\u3001\u5185\u90e8\u306e\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u304c\u307f\u308c\u306a\u3044\u306e\u3067\u6b63\u3057\u304f\u30c6\u30b9\u30c8\u3067\u304d\u3066\u3044\u308b\u304b\u4e0d\u5b89\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3068\u7d50\u679c\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059\u65b9\u6cd5\u306f\u3001\u5225\u306e\u65b9\u304c\u3059\u3067\u306b\u6295\u7a3f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u308c\u3092\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u53c2\u8003\uff1a[Serverspec \u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u306e\u30a8\u30d3\u30c7\u30f3\u30b9\u3092\u53d6\u5f97](http://qiita.com/ohtsuka1317/items/984041a1b94131547a21)\n\n\u3053\u306e\u6295\u7a3f\u3067\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u3044\u3066\u3044\u308b\u90e8\u5206\u3092\u3001\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3057\u305f\u3060\u3051\u3067\u3059\u3002\n\n# \u901a\u5e38\u306e\u7d50\u679c\u8868\u793a\nServerspec\u3092\u666e\u901a\u306b\u5b9f\u884c\u3059\u308b\u3068\u3053\u3093\u306a\u611f\u3058\u306b\u3001\u5185\u90e8\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u306f\u8868\u793a\u3055\u308c\u306a\u3044\u3067\u3059\u3002\n\n```\n[root@console serverspec]# rake spec\n/usr/bin/ruby -I/usr/local/share/gems/gems/rspec-core-3.4.2/lib:/usr/local/share/gems/gems/rspec-support-3.4.1/lib /usr/local/share/gems/gems/rspec-core-3.4.2/exe/rspec --pattern spec/localhost/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n\nService \"httpd\"\n  should be enabled\n  should be running\n\nPort \"80\"\n  should be listening\n\nCommand \"ls -al /\"\n  stdout\n    should match /bin/\n\nFinished in 0.10108 seconds (files took 0.41086 seconds to load)\n5 examples, 0 failures\n```\n\n# \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u66f4\u5f8c\u306e\u7d50\u679c\u8868\u793a\n\u7d50\u679c\u8868\u793a\u7528\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u66f8\u3044\u3066\u3001\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30b3\u30de\u30f3\u30c9\u3068\u305d\u306e\u7d50\u679c\u304c\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u5f8c\u8ff0\u3002\n\n\u53c2\u8003\u5143\u3060\u3068.rspec\u30d5\u30a1\u30a4\u30eb\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7b49\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30c7\u30d0\u30c3\u30af\u6642\u3060\u3051\u8a73\u7d30\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u5b9f\u884c\u6642\u306eSPEC_OPTS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7b49\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n[root@console serverspec]# rake spec SPEC_OPTS=\"--format ServerspecDebugFormatter --require ./serverspec_debug_formatter.rb\"                                                                  \n/usr/bin/ruby -I/usr/local/share/gems/gems/rspec-core-3.4.2/lib:/usr/local/share/gems/gems/rspec-support-3.4.1/lib /usr/local/share/gems/gems/rspec-core-3.4.2/exe/rspec --pattern spec/localhost/\\*_spec.rb\n\nPackage \"httpd\"\n  should be installed\n    -- command\n    /bin/sh -c rpm\\ -q\\ httpd\n    -- stdout\n    httpd-2.4.6-40.el7.centos.x86_64\n\nService \"httpd\"\n  should be enabled\n    -- command\n    /bin/sh -c systemctl\\ --quiet\\ is-enabled\\ httpd\n    -- stdout\n  should be running\n    -- command\n    /bin/sh -c systemctl\\ is-active\\ httpd\n    -- stdout\n    active\n\nPort \"80\"\n  should be listening\n    -- command\n    /bin/sh -c ss\\ -tunl\\ \\|\\ grep\\ --\\ :80\\\\\\ \n    -- stdout\n    tcp    LISTEN     0      128      :::80                   :::*                  \n\nCommand \"ls -al /\"\n  stdout\n    should match /bin/\n      -- command\n      /bin/sh -c ls\\ -al\\ /\n      -- stdout\n      total 68\n      dr-xr-xr-x  71 root root 4096 Feb 13 14:51 .\n      dr-xr-xr-x  71 root root 4096 Feb 13 14:51 ..\n      -rw-r--r--   1 root root    0 Feb  6 01:18 .autorelabel\n      -rwxr-xr-x   1 root root    0 Feb  6 01:18 .dockerenv\n      -rwxr-xr-x   1 root root    0 Feb  6 01:18 .dockerinit\n      -rw-r--r--   1 root root   31 Feb 13 14:32 .rspec\n      -rw-r--r--   1 root root  685 Feb 13 12:20 Rakefile\n      lrwxrwxrwx   1 root root    7 Feb  6 01:22 bin -> usr/bin\n      dr-xr-xr-x   3 root root 4096 Feb 13 12:32 boot\n      drwxr-xr-x  15 root root 4380 Feb 11 01:02 dev\n      drwxr-xr-x 133 root root 4096 Feb 13 12:32 etc\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 home\n      lrwxrwxrwx   1 root root    7 Feb  6 01:22 lib -> usr/lib\n      lrwxrwxrwx   1 root root    9 Feb  6 01:22 lib64 -> usr/lib64\n      drwx------   2 root root 4096 Aug 14  2015 lost+found\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 media\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 mnt\n      drwxr-xr-x   3 root root 4096 Feb 10 14:17 opt\n      dr-xr-xr-x 196 root root    0 Feb 11 01:02 proc\n      dr-xr-x---   8 root root 4096 Feb 13 14:31 root\n      drwxr-xr-x  16 root root  360 Feb 13 15:59 run\n      lrwxrwxrwx   1 root root    8 Feb  6 01:22 sbin -> usr/sbin\n      drwxr-xr-x   1 1000 ftp   272 Feb  5 17:17 share\n      drwxr-xr-x   5 root root 4096 Feb 13 12:29 spec\n      drwxr-xr-x   2 root root 4096 Aug 12  2015 srv\n      dr-xr-xr-x  13 root root    0 Feb 10 13:37 sys\n      drwxrwxrwt  15 root root 4096 Feb 13 15:59 tmp\n      drwxr-xr-x  46 root root 4096 Feb  6 01:22 usr\n      drwxr-xr-x  53 root root 4096 Feb 13 12:32 var\n      -- exit status\n      0\n\nFinished in 0.09723 seconds (files took 0.39293 seconds to load)\n5 examples, 0 failures\n```\n\n# \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u66f4\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\u30c7\u30d0\u30c3\u30af\u6642\u306b\u6307\u5b9a\u3059\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7528\u306eruby\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u30a4\u30f3\u30c7\u30f3\u30c8\u3084\u8868\u793a\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u51e6\u7406\u7684\u306b\u306f\u53c2\u8003\u5143\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30d5\u30a1\u30a4\u30eb\u51fa\u529b\u3057\u3066\u3044\u305f\u306e\u3092puts\u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\u3002\n\n```rb:serverspec_debug_formatter.rb\nrequire 'rspec/core/formatters/documentation_formatter'\nrequire 'specinfra'\nrequire 'serverspec/version'\nrequire 'serverspec/type/base'\nrequire 'serverspec/type/command'\n\nclass ServerspecDebugFormatter < RSpec::Core::Formatters::DocumentationFormatter\n  RSpec::Core::Formatters.register self, :example_group_started,\n                                   :example_passed, :example_pending, :example_failed\n\n  def initialize(output)\n    super\n  end\n\n  def example_group_started(notification)\n    @indent = 2 * (@group_level + 2)\n    super\n  end\n\n  def example_passed(notification)\n    super\n    puts_evidence(notification.example)\n  end\n\n  def example_pending(notification)\n    super\n    puts_evidence(notification.example)\n  end\n\n  def example_failed(notification)\n    super\n    puts_evidence(notification.example, notification.exception)\n  end\n\n  def puts_evidence(example, exception=nil)\n    # \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\n    puts ' ' * @indent + '-- command'\n    puts ' ' * @indent + example.metadata[:command]\n\n    # \u6a19\u6e96\u51fa\u529b\n    if example.metadata[:stdout]\n      puts ' ' * @indent + '-- stdout'\n      example.metadata[:stdout].lines do |line|\n        puts ' ' * @indent + line\n      end\n    end\n\n    # RSpec\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n    if exception\n      puts ' ' * @indent + '-- exception'\n      exception.message.lines do |line|\n        puts ' ' * @indent + line\n      end\n    end\n\n    # \u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3068\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\uff08command\u30ea\u30bd\u30fc\u30b9\u306e\u307f\uff09\n    resource = example.metadata[:described_class]\n    if resource.kind_of? Serverspec::Type::Command\n      unless resource.stderr.to_s.empty?\n        puts ' ' * @indent + '-- stderr'\n        resource.stderr.lines do |line|\n          puts ' ' * @indent + line\n        end\n      end\n      puts ' ' * @indent + '-- exit status'\n      puts ' ' * @indent + resource.exit_status.to_s\n    end\n  end\nend\n```\n\n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3053\u3093\u306a\u98a8\u306b\u914d\u7f6e\u3057\u3066\u3001\n\n```\n[root@console serverspec]# tree .\n.           \n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 serverspec_debug_formatter.rb\n\u2514\u2500\u2500 spec\n    \u251c\u2500\u2500 localhost\n    \u2502   \u2514\u2500\u2500 sample_spec.rb\n    \u2514\u2500\u2500 spec_helper.rb\n```\n\nServerspec\u5b9f\u884c\u6642\u306eSPEC_OPTS\u3067\u6307\u5b9a\u3057\u3066\u3084\u308c\u3070\u3001\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3092\u6a19\u6e96\u51fa\u529b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n# rake spec SPEC_OPTS=\"--format ServerspecDebugFormatter --require ./serverspec_debug_formatter.rb\"\n```\n\n\u666e\u6bb5\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306a\u3057\u306erake spec\u3067\u5b9f\u884c\u3057\u3066\u3001\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3068\u304d\u306e\u30c7\u30d0\u30c3\u30af\u3084\u3001\u304d\u3061\u3093\u3068\u8a3c\u8de1\u3092\u6b8b\u3059\u6642\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u4ed8\u304d\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u3048\u3066\u30b3\u30de\u30f3\u30c9\u7d50\u679c\u3092\u8868\u793a\u3059\u308b\u3068\u304b\u3067\u3059\u3002\n\n# \u30a8\u30e9\u30fc\u51fa\u529b\u304c\u3046\u307e\u304f\u3068\u308c\u306a\u3044\uff1f\n\u30b3\u30de\u30f3\u30c9\u306e\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3082\u8868\u793a\u3067\u304d\u308b\u306f\u305a\u3060\u3063\u305f\u3093\u3067\u3059\u304c\u3001\u306a\u305c\u304b\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u304c\u8868\u793a\u3055\u308c\u306a\u304b\u3063\u305f\u3067\u3059\u3002\u305d\u3082\u305d\u3082\u6a19\u6e96\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u30c6\u30b9\u30c8\u3059\u308b\u5b9a\u7fa9Serverspec\u3067\u66f8\u3044\u3066\u3082\u3001\u7d50\u679c\u304c\u30d6\u30e9\u30f3\u30af\u306b\u306a\u3063\u305f\u308a\u3059\u308b\u306e\u3067\u74b0\u5883\u304c\u60aa\u3044\u306e\u304b\u3082\u3002\u539f\u56e0\u304c\u308f\u304b\u3063\u305f\u3089\u8ffd\u8a18\u3057\u307e\u3059\u3002\n", "tags": ["serverspec"]}