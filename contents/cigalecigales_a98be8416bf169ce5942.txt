{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nDevise\u306eTwitter\u8a8d\u8a3c\u306e\u30c6\u30b9\u30c8\u3092\u3059\u308b\u969b\u306e\u30e1\u30e2\u3002\n\nView\u3068Model\u306e\u7de8\u96c6\nTwitter\u8a8d\u8a3c\u6642\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8981\u6c42\u3057\u306a\u3044\u3088\u3046\u306bUser\u30e2\u30c7\u30eb\u3068View\u3092\u4fee\u6b63\u3002\nUser\u30e2\u30c7\u30eb\u306bpassword_required?\u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\u3002\nUser\u306eprovider\u304c\u30ab\u30e9\u306e\u5834\u5408\u306e\u307fPassword\u5165\u529b\u3092\u8981\u6c42\u3059\u308b\u3002\n\napp/models/user.rb\nclass User < ActiveRecord::Base\n    (\u7701\u7565)...\n    def password_required?\n        super && provider.blank?\n    end\nend\n\n\nView\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u90e8\u5206\u3092if\u6587\u3067\u56f2\u3080\u3002\n\napp/views/devise/registrations/new.html.erb\n<h2>Sign up</h2>\n\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>\n    (\u7701\u7565)...\n    <% if f.object.password_required? %>\n        <div class=\"field\">\n            <%= f.label :password %>\n            <% if @validatable %>\n                <em>(<%= @minimum_password_length %> characters minimum)</em>\n            <% end %><br />\n            <%= f.password_field :password, autocomplete: \"off\" %>\n        </div>\n\n        <div class=\"field\">\n            <%= f.label :password_confirmation %><br />\n            <%= f.password_field :password_confirmation, autocomplete: \"off\" %>\n        </div>\n    <% end %>\n    (\u7701\u7565)...\n<% end %>\n\n<%= render \"devise/shared/links\" %>\n\n\n\n\u30c6\u30b9\u30c8\u306e\u4f5c\u6210\n\u73fe\u72b6\u306eGemfile\u3002\n\nGemfile\nsource 'https://rubygems.org'\n\n\n# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\ngem 'rails', '4.2.0'\n\ngroup :development, :test do\n    # Use sqlite3 as the database for Active Record\n    gem 'sqlite3'\n    gem 'rspec-rails'\nend\n\ngroup :test do\n    gem 'selenium-webdriver'\n    gem 'capybara'\n    gem 'factory_girl_rails'\nend\n\n# Use SCSS for stylesheets\ngem 'sass-rails', '~> 5.0'\n# Use Uglifier as compressor for JavaScript assets\ngem 'uglifier', '>= 1.3.0'\n# Use CoffeeScript for .coffee assets and views\ngem 'coffee-rails', '~> 4.1.0'\n# See https://github.com/sstephenson/execjs#readme for more supported runtimes\n# gem 'therubyracer', platforms: :ruby\n\n# Use jquery as the JavaScript library\ngem 'jquery-rails'\n# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks\ngem 'turbolinks'\n# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\ngem 'jbuilder', '~> 2.0'\n# bundle exec rake doc:rails generates the API under doc/api.\ngem 'sdoc', '~> 0.4.0', group: :doc\n\n# Use ActiveModel has_secure_password\n# gem 'bcrypt', '~> 3.1.7'\n\n# Use Unicorn as the app server\n# gem 'unicorn'\n\n# Use Capistrano for deployment\n# gem 'capistrano-rails', group: :development\n\ngroup :development, :test do\n  # Call 'byebug' anywhere in the code to stop execution and get a debugger console\n  gem 'byebug'\n\n  # Access an IRB console on exception pages or by using <%= console %> in views\n  gem 'web-console', '~> 2.0'\n\n  # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\n  gem 'spring'\nend\n\n# Devise\ngem 'devise', '3.4.1'\ngem 'omniauth-twitter'\n\n\n\nRSpec\u306e\u521d\u671f\u8a2d\u5b9a\u3002\n$ rails g rspec:install\n\nTwitter\u8a8d\u8a3c\u7528\u306e\u30c6\u30b9\u30c8\u4f5c\u6210\u3002\n$ rails g integration_test twitter_omniauth\n\n\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u306b\u30c7\u30d5\u30a9\u30eb\u30c8URL\u3092\u8a18\u8f09\u3002\n\nconfig/environments/test.rb\nRails.application.configure do\n  (\u7701\u7565)...\n    # Devise host mail setting\n    config.action_mailer.default_url_options = { host: 'localhost:3000' }\nend\n\n\n\u4e0a\u90e82\u884c\u3068Capybara::DSL\u306e\u884c\u3092\u8ffd\u52a0\u3002\n\nspec/spec_helper.rb\nENV['RAILS_ENV'] = 'test'\nrequire File.expand_path('../../config/environment', __FILE__)\n(\u7701\u7565)...\nRSpec.configure do |config|\n    (\u7701\u7565)...\n    # Add Capybara DSL to rspec helper\n    config.include Capybara::DSL\nend\n\n\n\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3002\ndevise\u3067confirmable\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306fconfirmed_at\u306b\u5024\u3092\u5165\u308c\u3066\u304a\u304b\u306a\u3044\u3068\u627f\u8a8d\u3055\u308c\u3066\u3044\u306a\u3044\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3002\n\nspec/factories.rb\nFactoryGirl.define do\n    factory :user do\n        email \"rspec_test@test.com\"\n        uid \"123\"\n        provider \"twitter\"\n        username \"anonymous\"\n        confirmed_at Time.now\n    end\nend\n\n\n\u30c6\u30b9\u30c8\u306e\u5185\u5bb9\u3002\nOAuth\u7528\u306e\u30e2\u30c3\u30af\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3002\n/pages/show\u306f\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30da\u30fc\u30b8\u3002\n\nspec/requests/twitter_omniauths_spec.rb\nrequire 'rails_helper'\n\ndescribe \"twitter login test\" do\n    before do\n        OmniAuth.config.test_mode = true\n        FactoryGirl.create(:user)\n        OmniAuth.config.mock_auth[:twitter] = {\n            \"uid\" => \"123\",\n            \"provider\" => \"twitter\",\n            \"info\" => { \n                \"nickname\" => \"anonymous\"\n            }\n        }\n        visit user_omniauth_authorize_path(:twitter)\n    end\n\n    after do\n        OmniAuth.config.test_mode = false\n    end\n\n    describe \"after login\" do\n        before{ visit \"/pages/show\" }\n        subject{ page }\n\n        it{ should have_link('\u30ed\u30b0\u30a2\u30a6\u30c8') }\n    end\nend\n\n\n\u30c6\u30b9\u30c8\u306f\u6210\u529f\uff01\n$ bundle exec rspec spec/requests/twitter_omniauths_spec.rb \n.\n\nFinished in 0.86037 seconds (files took 21.05 seconds to load)\n1 example, 0 failures\n\n# \u306f\u3058\u3081\u306b\nDevise\u306eTwitter\u8a8d\u8a3c\u306e\u30c6\u30b9\u30c8\u3092\u3059\u308b\u969b\u306e\u30e1\u30e2\u3002\n\n# View\u3068Model\u306e\u7de8\u96c6\nTwitter\u8a8d\u8a3c\u6642\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8981\u6c42\u3057\u306a\u3044\u3088\u3046\u306bUser\u30e2\u30c7\u30eb\u3068View\u3092\u4fee\u6b63\u3002\n\nUser\u30e2\u30c7\u30eb\u306b**password_required?**\u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\u3002\nUser\u306eprovider\u304c\u30ab\u30e9\u306e\u5834\u5408\u306e\u307fPassword\u5165\u529b\u3092\u8981\u6c42\u3059\u308b\u3002\n\n```rb:app/models/user.rb\nclass User < ActiveRecord::Base\n    (\u7701\u7565)...\n\tdef password_required?\n\t\tsuper && provider.blank?\n\tend\nend\n```\n\nView\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u90e8\u5206\u3092if\u6587\u3067\u56f2\u3080\u3002\n\n```erb:app/views/devise/registrations/new.html.erb\n<h2>Sign up</h2>\n\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>\n    (\u7701\u7565)...\n\t<% if f.object.password_required? %>\n\t\t<div class=\"field\">\n\t\t\t<%= f.label :password %>\n\t\t\t<% if @validatable %>\n\t\t\t\t<em>(<%= @minimum_password_length %> characters minimum)</em>\n\t\t\t<% end %><br />\n\t\t\t<%= f.password_field :password, autocomplete: \"off\" %>\n\t\t</div>\n\n\t\t<div class=\"field\">\n\t\t\t<%= f.label :password_confirmation %><br />\n\t\t\t<%= f.password_field :password_confirmation, autocomplete: \"off\" %>\n\t\t</div>\n\t<% end %>\n    (\u7701\u7565)...\n<% end %>\n\n<%= render \"devise/shared/links\" %>\n```\n\n# \u30c6\u30b9\u30c8\u306e\u4f5c\u6210\n\u73fe\u72b6\u306eGemfile\u3002\n\n```rb:Gemfile\nsource 'https://rubygems.org'\n\n\n# Bundle edge Rails instead: gem 'rails', github: 'rails/rails'\ngem 'rails', '4.2.0'\n\ngroup :development, :test do\n\t# Use sqlite3 as the database for Active Record\n\tgem 'sqlite3'\n\tgem 'rspec-rails'\nend\n\ngroup :test do\n\tgem 'selenium-webdriver'\n\tgem 'capybara'\n\tgem 'factory_girl_rails'\nend\n\n# Use SCSS for stylesheets\ngem 'sass-rails', '~> 5.0'\n# Use Uglifier as compressor for JavaScript assets\ngem 'uglifier', '>= 1.3.0'\n# Use CoffeeScript for .coffee assets and views\ngem 'coffee-rails', '~> 4.1.0'\n# See https://github.com/sstephenson/execjs#readme for more supported runtimes\n# gem 'therubyracer', platforms: :ruby\n\n# Use jquery as the JavaScript library\ngem 'jquery-rails'\n# Turbolinks makes following links in your web application faster. Read more: https://github.com/rails/turbolinks\ngem 'turbolinks'\n# Build JSON APIs with ease. Read more: https://github.com/rails/jbuilder\ngem 'jbuilder', '~> 2.0'\n# bundle exec rake doc:rails generates the API under doc/api.\ngem 'sdoc', '~> 0.4.0', group: :doc\n\n# Use ActiveModel has_secure_password\n# gem 'bcrypt', '~> 3.1.7'\n\n# Use Unicorn as the app server\n# gem 'unicorn'\n\n# Use Capistrano for deployment\n# gem 'capistrano-rails', group: :development\n\ngroup :development, :test do\n  # Call 'byebug' anywhere in the code to stop execution and get a debugger console\n  gem 'byebug'\n\n  # Access an IRB console on exception pages or by using <%= console %> in views\n  gem 'web-console', '~> 2.0'\n\n  # Spring speeds up development by keeping your application running in the background. Read more: https://github.com/rails/spring\n  gem 'spring'\nend\n\n# Devise\ngem 'devise', '3.4.1'\ngem 'omniauth-twitter'\n\n```\n\nRSpec\u306e\u521d\u671f\u8a2d\u5b9a\u3002\n\n```bash\n$ rails g rspec:install\n```\n\nTwitter\u8a8d\u8a3c\u7528\u306e\u30c6\u30b9\u30c8\u4f5c\u6210\u3002\n\n```bash\n$ rails g integration_test twitter_omniauth\n```\n\n\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u306b\u30c7\u30d5\u30a9\u30eb\u30c8URL\u3092\u8a18\u8f09\u3002\n\n```rb:config/environments/test.rb\nRails.application.configure do\n  (\u7701\u7565)...\n\t# Devise host mail setting\n\tconfig.action_mailer.default_url_options = { host: 'localhost:3000' }\nend\n```\n\n\u4e0a\u90e82\u884c\u3068Capybara::DSL\u306e\u884c\u3092\u8ffd\u52a0\u3002\n\n```rb:spec/spec_helper.rb\nENV['RAILS_ENV'] = 'test'\nrequire File.expand_path('../../config/environment', __FILE__)\n(\u7701\u7565)...\nRSpec.configure do |config|\n    (\u7701\u7565)...\n\t# Add Capybara DSL to rspec helper\n\tconfig.include Capybara::DSL\nend\n```\n\n\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3002\ndevise\u3067confirmable\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f`confirmed_at`\u306b\u5024\u3092\u5165\u308c\u3066\u304a\u304b\u306a\u3044\u3068\u627f\u8a8d\u3055\u308c\u3066\u3044\u306a\u3044\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3002\n\n```rb:spec/factories.rb\nFactoryGirl.define do\n\tfactory :user do\n\t\temail \"rspec_test@test.com\"\n\t\tuid \"123\"\n\t\tprovider \"twitter\"\n\t\tusername \"anonymous\"\n\t\tconfirmed_at Time.now\n\tend\nend\n```\n\n\u30c6\u30b9\u30c8\u306e\u5185\u5bb9\u3002\nOAuth\u7528\u306e\u30e2\u30c3\u30af\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3002\n`/pages/show`\u306f\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u307f\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u30da\u30fc\u30b8\u3002\n\n```rb:spec/requests/twitter_omniauths_spec.rb\nrequire 'rails_helper'\n\ndescribe \"twitter login test\" do\n\tbefore do\n\t\tOmniAuth.config.test_mode = true\n\t\tFactoryGirl.create(:user)\n\t\tOmniAuth.config.mock_auth[:twitter] = {\n\t\t\t\"uid\" => \"123\",\n\t\t\t\"provider\" => \"twitter\",\n\t\t\t\"info\" => { \n\t\t\t\t\"nickname\" => \"anonymous\"\n\t\t\t}\n\t\t}\n\t\tvisit user_omniauth_authorize_path(:twitter)\n\tend\n\n\tafter do\n\t\tOmniAuth.config.test_mode = false\n\tend\n\n\tdescribe \"after login\" do\n\t\tbefore{ visit \"/pages/show\" }\n\t\tsubject{ page }\n\n\t\tit{ should have_link('\u30ed\u30b0\u30a2\u30a6\u30c8') }\n\tend\nend\n```\n\n\u30c6\u30b9\u30c8\u306f\u6210\u529f\uff01\n\n```bash\n$ bundle exec rspec spec/requests/twitter_omniauths_spec.rb \n.\n\nFinished in 0.86037 seconds (files took 21.05 seconds to load)\n1 example, 0 failures\n```\n", "tags": ["Rails4.2.0", "Ruby2.2.0", "devise3.4.1", "RSpec", "FactoryGirl"]}