{"tags": ["docker", "Hyper-V", "DockerSwarm", "Linux"], "context": "\n\n\u80cc\u666f\n\u904e\u53bb\u306b\u5927\u597d\u8a55\u3060\u3063\u305fDocker\u5165\u9580\u306e\u5185\u5bb9\u30922016\u5e74\u7248\u306bupdate\u3057\u305f\u518d\u5165\u9580\u6295\u7a3f3\u672c\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u3001\n\u307e\u3060\u7d39\u4ecb\u3057\u3066\u3044\u306a\u3044\u6a5f\u80fd\u3092\u6295\u7a3f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nDocker Compose \u5165\u9580\nDocker Machine \u5165\u9580(Hyper-V\u306e\u5834\u5408)\nDocker Machine \u5165\u9580(AWS\u306e\u5834\u5408)\nDocker \u518d\u5165\u95803 2016\nDocker \u518d\u5165\u95802 2016\nDocker \u518d\u5165\u95801 2016\n\nDocker \u5165\u9580 (SlideShare)\n\n\n\u52d5\u4f5c\u74b0\u5883\n\nThinkPad X200s OS:Linux MINT 18\nThinkPad X1 Carbon OS:Windows 10 Pro (Hyper-V)\n\n\u500b\u4eba\u7684\u306b\u958b\u767a\u74b0\u5883OS\u306fLinux\u304c\u4e3b\u306a\u306e\u3067\u3001MacOS\u3084Windows\u306b\u3064\u3044\u3066\u306f\u512a\u5148\u5ea6\u304c\u4f4e\u3044\u306e\u3067\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\nDocker 1.12(docker swarm mode)\n\u8907\u6570\u306e\u30db\u30b9\u30c8\u3067Docker\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u5c02\u7528\u306eDocker Swarm\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n2016\u5e74\u306b\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305fDocker 1.12\u304b\u3089\u306fDocker Engine\u306b\u7d71\u5408\u3055\u308c\u3066swarm mode\u3068\u3057\u3066\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\nSwarm mode overview(docker.com)\n\n\nDocker\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n\u901a\u5e38\u306eweb\u30b5\u30a4\u30c8\u3067\u306f\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u306f\u99b4\u67d3\u307f\u304c\u7121\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u5197\u9577\u5316\u3084\u8ca0\u8377\u5206\u6563\u3068\u3044\u3063\u305f\u52b9\u679c\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u7a4d\u6975\u7684\u306b\u4f7f\u3063\u3066\u884c\u304d\u305f\u3044\u3067\u3059\u306d\u3002\n\u3067\u306f\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306bDocker\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u3092\uff13\u30db\u30b9\u30c8\u7528\u610f\u3059\u308b\n\u307e\u305a\u6700\u521d\u306b\uff13\u3064\u306e\u30db\u30b9\u30c8\u3092docker-machine\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u3001Windows 10 Pro(Hyper-V)\u4e0a\u306bBoot2Docker\u306e\u30db\u30b9\u30c8\u3092\uff13\u3064(node1,node2,node3)\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u305f\u3002\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node1\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node2\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node3\n\n\u52d5\u4f5c\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nPS C:\\WINDOWS\\system32> docker-machine ls\nNAME    ACTIVE   DRIVER   STATE     URL                        SWARM   DOCKER    ERRORS\nnode1   -        hyperv   Running   tcp://192.168.99.11:2376           v1.12.3\nnode2   -        hyperv   Running   tcp://192.168.99.12:2376           v1.12.3\nnode3   -        hyperv   Running   tcp://192.168.99.13:2376           v1.12.3\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306eSWARM\u306b\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u7121\u3044\u4e8b\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u304cDocker\u306e\u901a\u5e38\u30e2\u30fc\u30c9\u3067\u3059\u3002\n\n\u89aa\u30ce\u30fc\u30c9(manager)\u306e\u8a2d\u5b9a\n\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306e\u5143\u306b\u306a\u308b\u89aa\u30ce\u30fc\u30c9(manager)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fnode1\u306e\u30db\u30b9\u30c8\u3092\u89aa\u30ce\u30fc\u30c9(manager)\u3068\u3057\u307e\u3059\u3002\ndocker-machine\u30b3\u30de\u30f3\u30c9\u3067node1\u30db\u30b9\u30c8\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3067swarm mode\u306b\u521d\u671f\u5316\u3057\u307e\u3059\u3002IP\u30a2\u30c9\u30ec\u30b9\u306fnode1\u30db\u30b9\u30c8\u306e\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\nPS C:\\WINDOWS\\system32> docker-machine ssh node1\n\ndocker@node1:~$ docker swarm init --advertise-addr 192.168.99.11\nSwarm initialized: current node (28d8rbrnzxz4ktgmhhattzc52) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0z7y5jvysq0kuwao3itq783ncslyxw3ugn1l5w9l4k64z83lzi-9v684gv2g9tp28blu3hvhplrd \\\n    192.168.99.11:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n\n\u8868\u793a\u6587\u4e2d\u306e\u30b3\u30de\u30f3\u30c9\u4f8b\u306f\u3001\u5225\u306e\u8ffd\u52a0\u3059\u308b\u5b50\u30ce\u30fc\u30c9(worker)\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u30e2\u30ce\u3067\u3001\u3053\u308c\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u307e\u305f\u6700\u7d42\u884c\u306b\u3042\u308b\u30b3\u30de\u30f3\u30c9'docker swarm join-token manager'\u3067\u518d\u8868\u793a\u3082\u53ef\u80fd\u3067\u3059\u3002\nswarm mode\u3078\u306e\u5909\u66f4\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ndocker@node1:~$ docker info\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\nSwarm: active\n NodeID: 28d8rbrnzxz4ktgmhhattzc52\n Is Manager: true\n ClusterID: 5t03nqvt7btkh1y88dfsb2f2t\n Managers: 1\n Nodes: 1\n\nswarm mode\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3001ID\u8868\u793a\u304c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u5168\u30ce\u30fc\u30c9\u306e\u72b6\u614b\u8868\u793a\u3092\u3057\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ndocker@node1:~$ docker node ls\nID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n28d8rbrnzxz4ktgmhhattzc52 *  node1     Ready   Active        Leader\n\n\u89aa\u30ce\u30fc\u30c9(manager)\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u5b50\u30ce\u30fc\u30c9(worker)\u306e\u8ffd\u52a0\u8a2d\u5b9a\n\u305d\u308c\u3067\u306f\u3001\u4ed6\u306e\u30db\u30b9\u30c8\u3092\u5b50\u30ce\u30fc\u30c9\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\ndocker-machine\u30b3\u30de\u30f3\u30c9\u3067node2\u30db\u30b9\u30c8\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3067\u5148\u7a0b\u30e1\u30e2\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\nPS C:\\WINDOWS\\system32> docker-machine ssh node2\n\ndocker@node2:~$ docker swarm join \\\n> --token SWMTKN-1-0z7y5jvysq0kuwao3itq783ncslyxw3ugn1l5w9l4k64z83lzi-9v684gv2g9tp28blu3hvhplrd \\\n> 192.168.99.11:2377\nThis node joined a swarm as a manager.\n\n\u7121\u4e8b\u306b\u5b50\u30ce\u30fc\u30c9(worker)\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3089\u540c\u3058\u3088\u3046\u306bnode3\u30db\u30b9\u30c8\u3082\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u5168\u30af\u30e9\u30b9\u30bf\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u89aa\u30ce\u30fc\u30c9(manager)\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30ce\u30fc\u30c9\u72b6\u614b\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\nPS C:\\WINDOWS\\system32> docker-machine ssh node1\n\ndocker@node1:~$ docker node ls\nID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n28d8rbrnzxz4ktgmhhattzc52 *  node1     Ready   Active        Leader\n7yt8lf2zmcxt16dkcw5b4ors1    node2     Ready   Active        Reachable\n877vnv6x40xzd6uf8c2i0rvdp    node3     Ready   Active        Reachable\n\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\n\u305d\u308c\u3067\u306f\u89aa\u30ce\u30fc\u30c9(manager)\u306bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u307e\u3059\u3002\n\u4f8b\u3068\u3057\u3066\u3001AlpineLinux\u3067docker.com\u3078ping\u3059\u308b\u5358\u7d14\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\nDocker\u30b3\u30f3\u30c6\u30ca\u540d\u306bhelloworld\u3092\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\ndocker@node1:~$ docker service create --replicas 1 --name helloworld alpine ping docker.com\n0vu955zjrfh294mw1ivdzdr67\n\n\u4f5c\u6210\u3057\u305fDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9(helloworld)\u306e\u72b6\u614b\u8868\u793a\u3092\u3057\u3066\u307f\u307e\u3059\u3002\ndocker@node1:~$ docker service ls\nID            NAME        REPLICAS  IMAGE   COMMAND\n0vu955zjrfh2  helloworld  1/1       alpine  ping docker.com\n\ndocker@node1:~$ docker service inspect --pretty helloworld\nID:             0vu955zjrfh294mw1ivdzdr67\nName:           helloworld\nMode:           Replicated\n Replicas:      1\nPlacement:\nUpdateConfig:\n Parallelism:   1\n On failure:    pause\nContainerSpec:\n Image:         alpine\n Args:          ping docker.com\nResources:\n\ndocker@node1:~$ docker service ps helloworld\nID                         NAME          IMAGE   NODE   DESIRED STATE  CURRENT STATE          ERROR\nf0i0te74m5in3qehhtgkg1yfv  helloworld.1  alpine  node1  Running        Running 2 minutes ago\n\ndocker@node1:~$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS\nNAMES\na1e9f32ec207        alpine:latest       \"ping docker.com\"   3 minutes ago       Up 3 minutes        helloworld.1.f0i0te74m5in3qehhtgkg1yfv\n\n\u89aa\u30ce\u30fc\u30c9(manager)\u3067Docker\u30b3\u30f3\u30c6\u30ca(helloworld)\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u52d5\u3057\u3066\u3044\u308b\u72b6\u6cc1\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u5b50\u30ce\u30fc\u30c9(worker)\u3078\u30b9\u30b1\u30fc\u30eb\n\u89aa\u30ce\u30fc\u30c9(manager)\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30fc\u30d3\u30b9(helloworld)\u3092\u5b50\u30ce\u30fc\u30c9(worker)\u3078\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ndocker@node1:~$ docker service scale helloworld=5\nhelloworld scaled to 5\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306f\u3001\u89aa\u30ce\u30fc\u30c9(manager)\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bhelloworld\u306e\u30b3\u30f3\u30c6\u30ca\u3092\uff15\u500b\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\u30ce\u30fc\u30c9\u306e\u6570\u306f\u5168\u90e8\u3067\uff13\u500b\u3067\u3059\u304c\u3001\u3069\u3046\u306a\u308b\u3067\u3057\u3087\u3046\u3002\ndocker@node1:~$ docker service ps helloworld\nID                         NAME          IMAGE   NODE   DESIRED STATE  CURRENT STATE           ERROR\nf0i0te74m5in3qehhtgkg1yfv  helloworld.1  alpine  node1  Running        Running 6 minutes ago\n1p3u9x2po7vlgfph2vw2stqt0  helloworld.2  alpine  node2  Running        Running 23 seconds ago\n2rxzqe66wdyd4tao016ktcmh8  helloworld.3  alpine  node1  Running        Running 25 seconds ago\n5xrj8yxz54faehzr591xjqb9k  helloworld.4  alpine  node3  Running        Running 23 seconds ago\n5vpxaiqy8slos9j81bmuydy7m  helloworld.5  alpine  node2  Running        Running 23 seconds ago\n\n\uff11\u500b\u306e\u30ce\u30fc\u30c9\u306b\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u3066\u3044\u307e\u3059\u3002\nnode1\u306e\u30db\u30b9\u30c8\u3067\u30822\u500b\u306eDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u306e\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\ndocker@node1:~$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS\n NAMES\n166d6e7a8dbe        alpine:latest       \"ping docker.com\"   About a minute ago   Up About a minute   helloworld.3.2rxzqe66wdyd4tao016ktcmh8\na1e9f32ec207        alpine:latest       \"ping docker.com\"   7 minutes ago        Up 7 minutes        helloworld.1.f0i0te74m5in3qehhtgkg1yfv\n\n\u6700\u521d\u306b\u5b9f\u884c\u3057\u305f\u30aa\u30ea\u30b8\u30ca\u30eb\u306eDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4ed6\u306b\u3082\u30461\u500b\u306eDocker\u30b3\u30f3\u30c6\u30ca\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u69d8\u306b\u3057\u3066\uff11\u3064\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u4e8b\u3067\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u51fa\u6765\u307e\u3059\u3002\n\n\u5f8c\u7247\u4ed8\u3051\u65b9\u6cd5\n\u8907\u6570\u306e\u30db\u30b9\u30c8\u3067\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3067\u3059\u304c\u3001\u30b3\u30de\u30f3\u30c9\uff11\u3064\u3067\u7c21\u5358\u306b\u6d88\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\ndocker@node1:~$ docker service rm helloworld\nhelloworld\n\ndocker@node1:~$ docker service inspect helloworld\n[]\nError: no such service: helloworld\n\n# \u80cc\u666f\n\u904e\u53bb\u306b\u5927\u597d\u8a55\u3060\u3063\u305fDocker\u5165\u9580\u306e\u5185\u5bb9\u30922016\u5e74\u7248\u306bupdate\u3057\u305f\u518d\u5165\u9580\u6295\u7a3f3\u672c\u304c\u7d42\u308f\u3063\u305f\u306e\u3067\u3001\n\u307e\u3060\u7d39\u4ecb\u3057\u3066\u3044\u306a\u3044\u6a5f\u80fd\u3092\u6295\u7a3f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n- [Docker Compose \u5165\u9580](http://qiita.com/ohhara_shiojiri/items/0ac80924a1a8292ce511)\n- [Docker Machine \u5165\u9580(Hyper-V\u306e\u5834\u5408)](http://qiita.com/ohhara_shiojiri/items/801a24a2c94ff93be82d)\n- [Docker Machine \u5165\u9580(AWS\u306e\u5834\u5408)](http://qiita.com/ohhara_shiojiri/items/9fbb32ecdb999e2df523)\n- [Docker \u518d\u5165\u95803 2016](http://qiita.com/ohhara_shiojiri/items/cabc644f8a4d1aaf2e36)\n- [Docker \u518d\u5165\u95802 2016](http://qiita.com/ohhara_shiojiri/items/31a76913cbfdd9d2fe13)\n- [Docker \u518d\u5165\u95801 2016](http://qiita.com/ohhara_shiojiri/items/98573b074185381d46c8)\n- [Docker \u5165\u9580](http://www.slideshare.net/ShinichiroOhhara/docker-39456836) (SlideShare)\n\n# \u52d5\u4f5c\u74b0\u5883\n- ThinkPad X200s OS:Linux MINT 18\n- ThinkPad X1 Carbon OS:Windows 10 Pro (Hyper-V)\n\n\u500b\u4eba\u7684\u306b\u958b\u767a\u74b0\u5883OS\u306fLinux\u304c\u4e3b\u306a\u306e\u3067\u3001MacOS\u3084Windows\u306b\u3064\u3044\u3066\u306f\u512a\u5148\u5ea6\u304c\u4f4e\u3044\u306e\u3067\u3054\u4e86\u627f\u304f\u3060\u3055\u3044\u3002\n\n# Docker 1.12(docker swarm mode)\n\u8907\u6570\u306e\u30db\u30b9\u30c8\u3067Docker\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u5c02\u7528\u306eDocker Swarm\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n2016\u5e74\u306b\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305fDocker 1.12\u304b\u3089\u306fDocker Engine\u306b\u7d71\u5408\u3055\u308c\u3066swarm mode\u3068\u3057\u3066\u69cb\u7bc9\u3059\u308b\u4e8b\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n- [Swarm mode overview](https://docs.docker.com/engine/swarm/)(docker.com)\n\n# Docker\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n\u901a\u5e38\u306eweb\u30b5\u30a4\u30c8\u3067\u306f\u30af\u30e9\u30b9\u30bf\u69cb\u7bc9\u306f\u99b4\u67d3\u307f\u304c\u7121\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u5197\u9577\u5316\u3084\u8ca0\u8377\u5206\u6563\u3068\u3044\u3063\u305f\u52b9\u679c\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u7a4d\u6975\u7684\u306b\u4f7f\u3063\u3066\u884c\u304d\u305f\u3044\u3067\u3059\u306d\u3002\n\u3067\u306f\u3001\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u8003\u306bDocker\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## \u30af\u30e9\u30b9\u30bf\u306e\u30ce\u30fc\u30c9\u3092\uff13\u30db\u30b9\u30c8\u7528\u610f\u3059\u308b\n\u307e\u305a\u6700\u521d\u306b\uff13\u3064\u306e\u30db\u30b9\u30c8\u3092docker-machine\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u3001Windows 10 Pro(Hyper-V)\u4e0a\u306bBoot2Docker\u306e\u30db\u30b9\u30c8\u3092\uff13\u3064(node1,node2,node3)\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node1\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node2\ndocker-machine create -d hyperv --hyperv-virtual-switch \"Primary Virtual Switch\" node3\n```\n\n\u52d5\u4f5c\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\nPS C:\\WINDOWS\\system32> docker-machine ls\nNAME    ACTIVE   DRIVER   STATE     URL                        SWARM   DOCKER    ERRORS\nnode1   -        hyperv   Running   tcp://192.168.99.11:2376           v1.12.3\nnode2   -        hyperv   Running   tcp://192.168.99.12:2376           v1.12.3\nnode3   -        hyperv   Running   tcp://192.168.99.13:2376           v1.12.3\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306eSWARM\u306b\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u7121\u3044\u4e8b\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\u3053\u308c\u304cDocker\u306e\u901a\u5e38\u30e2\u30fc\u30c9\u3067\u3059\u3002\n\n## \u89aa\u30ce\u30fc\u30c9(manager)\u306e\u8a2d\u5b9a\n\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306e\u5143\u306b\u306a\u308b\u89aa\u30ce\u30fc\u30c9(manager)\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306fnode1\u306e\u30db\u30b9\u30c8\u3092\u89aa\u30ce\u30fc\u30c9(manager)\u3068\u3057\u307e\u3059\u3002\ndocker-machine\u30b3\u30de\u30f3\u30c9\u3067node1\u30db\u30b9\u30c8\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3067swarm mode\u306b\u521d\u671f\u5316\u3057\u307e\u3059\u3002IP\u30a2\u30c9\u30ec\u30b9\u306fnode1\u30db\u30b9\u30c8\u306e\u756a\u53f7\u3092\u6307\u5b9a\u3059\u308b\u4e8b\u3067\u30b5\u30fc\u30d3\u30b9\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\n```\nPS C:\\WINDOWS\\system32> docker-machine ssh node1\n\ndocker@node1:~$ docker swarm init --advertise-addr 192.168.99.11\nSwarm initialized: current node (28d8rbrnzxz4ktgmhhattzc52) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join \\\n    --token SWMTKN-1-0z7y5jvysq0kuwao3itq783ncslyxw3ugn1l5w9l4k64z83lzi-9v684gv2g9tp28blu3hvhplrd \\\n    192.168.99.11:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n```\n\n\u8868\u793a\u6587\u4e2d\u306e\u30b3\u30de\u30f3\u30c9\u4f8b\u306f\u3001\u5225\u306e\u8ffd\u52a0\u3059\u308b\u5b50\u30ce\u30fc\u30c9(worker)\u4e0a\u3067\u5b9f\u884c\u3059\u308b\u30e2\u30ce\u3067\u3001\u3053\u308c\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u307e\u305f\u6700\u7d42\u884c\u306b\u3042\u308b\u30b3\u30de\u30f3\u30c9'docker swarm join-token manager'\u3067\u518d\u8868\u793a\u3082\u53ef\u80fd\u3067\u3059\u3002\n\nswarm mode\u3078\u306e\u5909\u66f4\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\ndocker@node1:~$ docker info\n\u30fb\u30fb\u30fb\u4e2d\u7565\u30fb\u30fb\u30fb\nSwarm: active\n NodeID: 28d8rbrnzxz4ktgmhhattzc52\n Is Manager: true\n ClusterID: 5t03nqvt7btkh1y88dfsb2f2t\n Managers: 1\n Nodes: 1\n```\n\nswarm mode\u304c\u6709\u52b9\u306b\u306a\u3063\u3066\u3001ID\u8868\u793a\u304c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u5168\u30ce\u30fc\u30c9\u306e\u72b6\u614b\u8868\u793a\u3092\u3057\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\ndocker@node1:~$ docker node ls\nID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n28d8rbrnzxz4ktgmhhattzc52 *  node1     Ready   Active        Leader\n```\n\n\u89aa\u30ce\u30fc\u30c9(manager)\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n## \u5b50\u30ce\u30fc\u30c9(worker)\u306e\u8ffd\u52a0\u8a2d\u5b9a\n\u305d\u308c\u3067\u306f\u3001\u4ed6\u306e\u30db\u30b9\u30c8\u3092\u5b50\u30ce\u30fc\u30c9\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\ndocker-machine\u30b3\u30de\u30f3\u30c9\u3067node2\u30db\u30b9\u30c8\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066docker\u30b3\u30de\u30f3\u30c9\u3067\u5148\u7a0b\u30e1\u30e2\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5165\u529b\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nPS C:\\WINDOWS\\system32> docker-machine ssh node2\n\ndocker@node2:~$ docker swarm join \\\n> --token SWMTKN-1-0z7y5jvysq0kuwao3itq783ncslyxw3ugn1l5w9l4k64z83lzi-9v684gv2g9tp28blu3hvhplrd \\\n> 192.168.99.11:2377\nThis node joined a swarm as a manager.\n```\n\n\u7121\u4e8b\u306b\u5b50\u30ce\u30fc\u30c9(worker)\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3089\u540c\u3058\u3088\u3046\u306bnode3\u30db\u30b9\u30c8\u3082\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n## \u5168\u30af\u30e9\u30b9\u30bf\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u89aa\u30ce\u30fc\u30c9(manager)\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u30ce\u30fc\u30c9\u72b6\u614b\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\nPS C:\\WINDOWS\\system32> docker-machine ssh node1\n\ndocker@node1:~$ docker node ls\nID                           HOSTNAME  STATUS  AVAILABILITY  MANAGER STATUS\n28d8rbrnzxz4ktgmhhattzc52 *  node1     Ready   Active        Leader\n7yt8lf2zmcxt16dkcw5b4ors1    node2     Ready   Active        Reachable\n877vnv6x40xzd6uf8c2i0rvdp    node3     Ready   Active        Reachable\n```\n\n## \u30b5\u30fc\u30d3\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\n\u305d\u308c\u3067\u306f\u89aa\u30ce\u30fc\u30c9(manager)\u306bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u307f\u307e\u3059\u3002\n\u4f8b\u3068\u3057\u3066\u3001AlpineLinux\u3067docker.com\u3078ping\u3059\u308b\u5358\u7d14\u306a\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\nDocker\u30b3\u30f3\u30c6\u30ca\u540d\u306bhelloworld\u3092\u4ed8\u3051\u3066\u3044\u307e\u3059\u3002\n\n```\ndocker@node1:~$ docker service create --replicas 1 --name helloworld alpine ping docker.com\n0vu955zjrfh294mw1ivdzdr67\n```\n\n\u4f5c\u6210\u3057\u305fDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9(helloworld)\u306e\u72b6\u614b\u8868\u793a\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\ndocker@node1:~$ docker service ls\nID            NAME        REPLICAS  IMAGE   COMMAND\n0vu955zjrfh2  helloworld  1/1       alpine  ping docker.com\n\ndocker@node1:~$ docker service inspect --pretty helloworld\nID:             0vu955zjrfh294mw1ivdzdr67\nName:           helloworld\nMode:           Replicated\n Replicas:      1\nPlacement:\nUpdateConfig:\n Parallelism:   1\n On failure:    pause\nContainerSpec:\n Image:         alpine\n Args:          ping docker.com\nResources:\n\ndocker@node1:~$ docker service ps helloworld\nID                         NAME          IMAGE   NODE   DESIRED STATE  CURRENT STATE          ERROR\nf0i0te74m5in3qehhtgkg1yfv  helloworld.1  alpine  node1  Running        Running 2 minutes ago\n\ndocker@node1:~$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS\nNAMES\na1e9f32ec207        alpine:latest       \"ping docker.com\"   3 minutes ago       Up 3 minutes        helloworld.1.f0i0te74m5in3qehhtgkg1yfv\n```\n\n\u89aa\u30ce\u30fc\u30c9(manager)\u3067Docker\u30b3\u30f3\u30c6\u30ca(helloworld)\u306e\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u52d5\u3057\u3066\u3044\u308b\u72b6\u6cc1\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n## \u5b50\u30ce\u30fc\u30c9(worker)\u3078\u30b9\u30b1\u30fc\u30eb\n\u89aa\u30ce\u30fc\u30c9(manager)\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bDocker\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30fc\u30d3\u30b9(helloworld)\u3092\u5b50\u30ce\u30fc\u30c9(worker)\u3078\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\ndocker@node1:~$ docker service scale helloworld=5\nhelloworld scaled to 5\n```\n\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3067\u306f\u3001\u89aa\u30ce\u30fc\u30c9(manager)\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bhelloworld\u306e\u30b3\u30f3\u30c6\u30ca\u3092\uff15\u500b\u30b9\u30b1\u30fc\u30eb\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\u30ce\u30fc\u30c9\u306e\u6570\u306f\u5168\u90e8\u3067\uff13\u500b\u3067\u3059\u304c\u3001\u3069\u3046\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\n```\ndocker@node1:~$ docker service ps helloworld\nID                         NAME          IMAGE   NODE   DESIRED STATE  CURRENT STATE           ERROR\nf0i0te74m5in3qehhtgkg1yfv  helloworld.1  alpine  node1  Running        Running 6 minutes ago\n1p3u9x2po7vlgfph2vw2stqt0  helloworld.2  alpine  node2  Running        Running 23 seconds ago\n2rxzqe66wdyd4tao016ktcmh8  helloworld.3  alpine  node1  Running        Running 25 seconds ago\n5xrj8yxz54faehzr591xjqb9k  helloworld.4  alpine  node3  Running        Running 23 seconds ago\n5vpxaiqy8slos9j81bmuydy7m  helloworld.5  alpine  node2  Running        Running 23 seconds ago\n```\n\n\uff11\u500b\u306e\u30ce\u30fc\u30c9\u306b\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u3066\u3044\u307e\u3059\u3002\nnode1\u306e\u30db\u30b9\u30c8\u3067\u30822\u500b\u306eDocker\u30b3\u30f3\u30c6\u30ca\u30b5\u30fc\u30d3\u30b9\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b\u306e\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```\ndocker@node1:~$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED              STATUS              PORTS\n NAMES\n166d6e7a8dbe        alpine:latest       \"ping docker.com\"   About a minute ago   Up About a minute   helloworld.3.2rxzqe66wdyd4tao016ktcmh8\na1e9f32ec207        alpine:latest       \"ping docker.com\"   7 minutes ago        Up 7 minutes        helloworld.1.f0i0te74m5in3qehhtgkg1yfv\n```\n\n\u6700\u521d\u306b\u5b9f\u884c\u3057\u305f\u30aa\u30ea\u30b8\u30ca\u30eb\u306eDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4ed6\u306b\u3082\u30461\u500b\u306eDocker\u30b3\u30f3\u30c6\u30ca\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u69d8\u306b\u3057\u3066\uff11\u3064\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u4e8b\u3067\u30af\u30e9\u30b9\u30bf\u304c\u69cb\u7bc9\u51fa\u6765\u307e\u3059\u3002\n\n## \u5f8c\u7247\u4ed8\u3051\u65b9\u6cd5\n\u8907\u6570\u306e\u30db\u30b9\u30c8\u3067\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3067\u69cb\u6210\u3055\u308c\u305f\u30af\u30e9\u30b9\u30bf\u3067\u3059\u304c\u3001\u30b3\u30de\u30f3\u30c9\uff11\u3064\u3067\u7c21\u5358\u306b\u6d88\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```\ndocker@node1:~$ docker service rm helloworld\nhelloworld\n\ndocker@node1:~$ docker service inspect helloworld\n[]\nError: no such service: helloworld\n```\n\n\n\n\n\n\n"}