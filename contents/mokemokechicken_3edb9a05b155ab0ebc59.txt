{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nAWS\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u3068\u3001\u672c\u756a\u74b0\u5883\u3001staging\u74b0\u5883\u3001\u30c6\u30b9\u30c8\u74b0\u5883\u306a\u3069\u8272\u3005\u306a\u74b0\u5883\u304c\u5897\u3048\u3066\u304d\u307e\u3059\u3002\n\u305d\u306e\u6642\u3001\n\n\u30c6\u30b9\u30c8\u74b0\u5883\u306a\u3069\u306e\u7279\u5b9a\u306e\u8907\u6570\u306eInstanceSet\u306f\u30dc\u30bf\u30f3\u3072\u3068\u3064\u3067 stop/start \u3057\u305f\u3044\n\u3060\u3051\u3069\u3001\u4e07\u304c\u4e00\u306b\u3082\u672c\u756a\u74b0\u5883\u306b\u305d\u3046\u3044\u3046\u5f71\u97ff\u304c\u7121\u3044\u3088\u3046\u306b\u3057\u305f\u3044\n\n\u3068\u3044\u3046\u3053\u3068\u304c\u306a\u304d\u306b\u3057\u3082\u3042\u3089\u305a\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3046\u3044\u3046\u5834\u5408\u300c\u7279\u5b9a\u306eTag\u3092\u3082\u3064Instance\u306e\u307fStop/Start\u3067\u304d\u308bIAM\u30e6\u30fc\u30b6\u300d\u3068\u3044\u3046\u306e\u3092\u4f5c\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u65b9\u6cd5\n\nIAM\u306e\u8a2d\u5b9a\n\u3053\u3093\u306a\u611f\u3058\u306ePolicy\u3092\u3082\u3064IAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u4efb\u610f\u306e EC2 Instance\u3092\u691c\u7d22\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\nEC2\u306eTag\u304c Key= TAGTEST, Value= YES \u306eInstance\u306b\u5bfe\u3057\u3066\u306e\u307f Stop/Start/Reboot \u304c\u3067\u304d\u308b\n\n\u3068\u3044\u3046\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u5f53\u7136Tag\u6761\u4ef6\u306a\u3069\u306f\u81ea\u7531\u306b\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002\n\npolicy.json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AllowDescribe\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        },\n        {\n            \"Sid\": \"AllowStartStop\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:RebootInstances\",\n                \"ec2:StartInstances\",\n                \"ec2:StopInstances\"\n            ],\n            \"Condition\": {\n                \"ForAnyValue:StringEquals\": {\n                    \"ec2:ResourceTag/TAGTEST\": \"YES\"\n                }\n            },\n            \"Resource\": [\n                \"arn:aws:ec2:*\"\n            ]\n        }\n    ]\n}\n\n\n\n\u30c6\u30b9\u30c8\n\u4e0a\u8a18\u306eIAM\u30e6\u30fc\u30b6\u306e Key/Secret \u3092\u4f7f\u3063\u3066\u3001Name \u304c my_project \u306eInstance\u3092stop\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002\n\u3053\u306eInstance\u306b TAGTEST=YES \u3092\u4ed8\u3051\u305f\u6642\u3068\u3064\u3051\u3066\u3044\u306a\u3044\u6642\u3067\u52d5\u4f5c\u304c\u5909\u308f\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\nrequire 'rubygems'\nrequire 'aws'\n\nAWS_ACCESS_KEY_ID     = 'MYKEY'\nAWS_SECRET_ACCESS_KEY = 'MYSECRET'\n\nec2 = AWS::EC2.new(\n    :access_key_id => AWS_ACCESS_KEY_ID,\n    :secret_access_key => AWS_SECRET_ACCESS_KEY,\n    :region => 'ap-southeast-1',\n)\n\nyy = ec2.instances.tagged('Name').tagged_values('my_project').first\nyy.stop\n\n\n\u306f\u3058\u3081\u306b\n=========\n\nAWS\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u3068\u3001\u672c\u756a\u74b0\u5883\u3001staging\u74b0\u5883\u3001\u30c6\u30b9\u30c8\u74b0\u5883\u306a\u3069\u8272\u3005\u306a\u74b0\u5883\u304c\u5897\u3048\u3066\u304d\u307e\u3059\u3002\n\u305d\u306e\u6642\u3001\n\n* \u30c6\u30b9\u30c8\u74b0\u5883\u306a\u3069\u306e\u7279\u5b9a\u306e\u8907\u6570\u306eInstanceSet\u306f\u30dc\u30bf\u30f3\u3072\u3068\u3064\u3067 stop/start \u3057\u305f\u3044\n* \u3060\u3051\u3069\u3001\u4e07\u304c\u4e00\u306b\u3082\u672c\u756a\u74b0\u5883\u306b\u305d\u3046\u3044\u3046\u5f71\u97ff\u304c\u7121\u3044\u3088\u3046\u306b\u3057\u305f\u3044\n\n\u3068\u3044\u3046\u3053\u3068\u304c\u306a\u304d\u306b\u3057\u3082\u3042\u3089\u305a\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u3046\u3044\u3046\u5834\u5408\u300c\u7279\u5b9a\u306eTag\u3092\u3082\u3064Instance\u306e\u307fStop/Start\u3067\u304d\u308bIAM\u30e6\u30fc\u30b6\u300d\u3068\u3044\u3046\u306e\u3092\u4f5c\u308b\u3053\u3068\u3067\u5b9f\u73fe\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u65b9\u6cd5\n=====\nIAM\u306e\u8a2d\u5b9a\n-------------\n\n\u3053\u3093\u306a\u611f\u3058\u306ePolicy\u3092\u3082\u3064IAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n* \u4efb\u610f\u306e EC2 Instance\u3092\u691c\u7d22\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n* EC2\u306eTag\u304c Key= **TAGTEST**, Value= **YES** \u306eInstance\u306b\u5bfe\u3057\u3066\u306e\u307f Stop/Start/Reboot \u304c\u3067\u304d\u308b\n\n\u3068\u3044\u3046\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u5f53\u7136Tag\u6761\u4ef6\u306a\u3069\u306f\u81ea\u7531\u306b\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002\n\n```json:policy.json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AllowDescribe\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:Describe*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        },\n        {\n            \"Sid\": \"AllowStartStop\",\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"ec2:RebootInstances\",\n                \"ec2:StartInstances\",\n                \"ec2:StopInstances\"\n            ],\n            \"Condition\": {\n                \"ForAnyValue:StringEquals\": {\n                    \"ec2:ResourceTag/TAGTEST\": \"YES\"\n                }\n            },\n            \"Resource\": [\n                \"arn:aws:ec2:*\"\n            ]\n        }\n    ]\n}\n```\n\n\u30c6\u30b9\u30c8\n-------\n\n\u4e0a\u8a18\u306eIAM\u30e6\u30fc\u30b6\u306e Key/Secret \u3092\u4f7f\u3063\u3066\u3001Name \u304c my_project \u306eInstance\u3092stop\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002\n\u3053\u306eInstance\u306b **TAGTEST=YES** \u3092\u4ed8\u3051\u305f\u6642\u3068\u3064\u3051\u3066\u3044\u306a\u3044\u6642\u3067\u52d5\u4f5c\u304c\u5909\u308f\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```ruby\nrequire 'rubygems'\nrequire 'aws'\n\nAWS_ACCESS_KEY_ID     = 'MYKEY'\nAWS_SECRET_ACCESS_KEY = 'MYSECRET'\n\nec2 = AWS::EC2.new(\n    :access_key_id => AWS_ACCESS_KEY_ID,\n    :secret_access_key => AWS_SECRET_ACCESS_KEY,\n    :region => 'ap-southeast-1',\n)\n\nyy = ec2.instances.tagged('Name').tagged_values('my_project').first\nyy.stop\n```", "tags": ["AWS", "EC2", "IAM"]}