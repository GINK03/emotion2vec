{"context": " More than 1 year has passed since last update.\u524d\u56deNode.js\u306engrok\u30e9\u30c3\u30d1\u30fc\u3092\u4f7f\u3044Raspberry Pi\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bExpress\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u516c\u958b\u3057\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u751f\u6210\u3055\u308c\u305f\u30e9\u30f3\u30c0\u30e0\u306angrok\u306eURL\u306fRaspberry Pi\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066pm2\u306e\u30ed\u30b0\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u6b21\u306f\u3053\u306eURL\u3092Slack\u306b\u6295\u7a3f\u3057\u3066\u30ea\u30e2\u30fc\u30c8\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nSlack\nSlack\u306eConfigure Integrations(https://{teamdomain}.slack.com/services/new)\u306e\u30da\u30fc\u30b8\u304b\u3089\u3001Incoming WebHooks(https://{teamdomain}.slack.com/services/new/incoming-webhook)\u3092\u958b\u304d\u307e\u3059\u3002\u9069\u5f53\u306a\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u9078\u629e\u3057\u3066Add Incoming WebHooks Integration\u3092\u62bc\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3055\u308c\u305fWebhook URL\u306f\u3042\u3068\u3067.env\u30d5\u30a1\u30a4\u30eb\u306e\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\nnode-slack\n\u524d\u56de\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306bNode.js\u306eSlack\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4e00\u3064\u3067\u3042\u308b\u3001node-slack\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ cd ~/node_apps/node-hello-ngrok-pm2\n$ npm install node-slack --save\n\npackage.json\u306edependencies\u306bnode-slack\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\n~/node_apps/node-hello-ngrok-pm2/package.json\n{\n  \"name\": \"node-hello-ngrok-pm2\",\n  \"description\": \"node-hello-ngrok-pm2\",\n  \"version\": \"0.0.1\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"dotenv\": \"^1.2.0\",\n    \"express\": \"^4.13.3\",\n    \"ngrok\": \"^0.1.99\",\n    \"node-slack\": \"0.0.7\"\n  }\n}\n\n\ndotenv\u306e\u3072\u306a\u5f62\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u307e\u3059\u3002\n$ mv .env.default .env\n\n\u5148\u307b\u3069\u53d6\u5f97\u3057\u305fSlack\u306eWebhook URL\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n~/node_apps/node-hello-ngrok-pm2/.env\nEXPRESS_PORT=3000\nSLACK_WEBHOOK=https://hooks.slack.com/services/xxxx\n\n\n\napp.js\napp.js\u306bnode-slack\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002ngrok.connect\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u3067\u53d6\u5f97\u3057\u305fngrok\u306eURL\u3092\u3001Slack\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066#general\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u6295\u7a3f\u3057\u307e\u3059\u3002\n\n~/node_apps/node-hello-ngrok-pm2/app.js\nrequire('dotenv').load();\nvar ngrok = require('ngrok'),\n    express = require('express'),\n    Slack = require('node-slack');\n\nvar slack = new Slack(process.env.SLACK_WEBHOOK);\nvar app = express();\n\napp.get('/', function(req, res) {\n    res.send('Hello World!');\n});\n\nvar server = app.listen(process.env.EXPRESS_PORT, function() {\n    var host = server.address().address,\n        port = server.address().port;\n\n    console.log('listening at http://%s:%s', host, port);\n    ngrok.connect({\n        port: port\n    },\n    function (err, url) {\n        console.log(url);\n        var message = 'app url: ' + url;\n        slack.send({\n            text: message,\n            channel: '#general',\n            username: 'raspi',\n            icon_emoji: \":ghost:\"\n        });\n    });\n});\n\n\n\n\u78ba\u8a8d\npm2\u304b\u3089\u30a2\u30d7\u30ea\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002\n$ pm2 restart app\n[PM2] restartProcessId process id 0\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 App name \u2502 id \u2502 mode \u2502 pid  \u2502 status \u2502 restart \u2502 uptime \u2502 memory     \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 app      \u2502 0  \u2502 fork \u2502 4401 \u2502 online \u2502 7       \u2502 0s     \u2502 8.602 MB   \u2502 disabled \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n Use `pm2 show <id|name>` to get more details about an app\n\n\u30ea\u30b9\u30bf\u30fc\u30c8\u5f8c\u3001Slack\u306bngrok\u306eURL\u304c\u6295\u7a3f\u3055\u308c\u307e\u3057\u305f\u3002\n\nSlack\u306b\u6295\u7a3f\u3055\u308c\u305f\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001Raspberry Pi\u3067\u8d77\u52d5\u3057\u3066\u3044\u308bExpress\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n[\u524d\u56de](http://qiita.com/masato/items/9fd096a544fc462a7b11)Node.js\u306engrok\u30e9\u30c3\u30d1\u30fc\u3092\u4f7f\u3044Raspberry Pi\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308bExpress\u3092\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u516c\u958b\u3057\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u751f\u6210\u3055\u308c\u305f\u30e9\u30f3\u30c0\u30e0\u306angrok\u306eURL\u306fRaspberry Pi\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066pm2\u306e\u30ed\u30b0\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u6b21\u306f\u3053\u306eURL\u3092Slack\u306b\u6295\u7a3f\u3057\u3066\u30ea\u30e2\u30fc\u30c8\u304b\u3089\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n## Slack\n\nSlack\u306eConfigure Integrations(https://{teamdomain}.slack.com/services/new)\u306e\u30da\u30fc\u30b8\u304b\u3089\u3001Incoming WebHooks(https://{teamdomain}.slack.com/services/new/incoming-webhook)\u3092\u958b\u304d\u307e\u3059\u3002\u9069\u5f53\u306a\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u9078\u629e\u3057\u3066`Add Incoming WebHooks Integration`\u3092\u62bc\u3057\u307e\u3059\u3002\n\n![incoming-webhook.png](https://qiita-image-store.s3.amazonaws.com/0/43745/65fe49b3-2fe8-fcd8-0193-3692d901aa46.png)\n\n\n\u4f5c\u6210\u3055\u308c\u305fWebhook URL\u306f\u3042\u3068\u3067.env\u30d5\u30a1\u30a4\u30eb\u306e\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n![incoming-webhook-url.png](https://qiita-image-store.s3.amazonaws.com/0/43745/0a27e270-8c12-cbfe-8a45-c42ba1a37fff.png)\n\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\n\n### node-slack\n\n\u524d\u56de\u4f5c\u6210\u3057\u305f[\u30d7\u30ed\u30b8\u30a7\u30af\u30c8](https://github.com/masato/node-hello-ngrok-pm2)\u306bNode.js\u306eSlack\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4e00\u3064\u3067\u3042\u308b\u3001[node-slack](https://www.npmjs.com/package/node-slack)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$ cd ~/node_apps/node-hello-ngrok-pm2\n$ npm install node-slack --save\n```\n\npackage.json\u306edependencies\u306bnode-slack\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\n```json:~/node_apps/node-hello-ngrok-pm2/package.json\n{\n  \"name\": \"node-hello-ngrok-pm2\",\n  \"description\": \"node-hello-ngrok-pm2\",\n  \"version\": \"0.0.1\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node app.js\"\n  },\n  \"dependencies\": {\n    \"dotenv\": \"^1.2.0\",\n    \"express\": \"^4.13.3\",\n    \"ngrok\": \"^0.1.99\",\n    \"node-slack\": \"0.0.7\"\n  }\n}\n```\n\ndotenv\u306e\u3072\u306a\u5f62\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u307e\u3059\u3002\n\n```bash\n$ mv .env.default .env\n```\n\n\u5148\u307b\u3069\u53d6\u5f97\u3057\u305fSlack\u306eWebhook URL\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:~/node_apps/node-hello-ngrok-pm2/.env\nEXPRESS_PORT=3000\nSLACK_WEBHOOK=https://hooks.slack.com/services/xxxx\n```\n\n### app.js\n\napp.js\u306bnode-slack\u306e\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002`ngrok.connect`\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u3067\u53d6\u5f97\u3057\u305fngrok\u306eURL\u3092\u3001Slack\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066`#general`\u30c1\u30e3\u30f3\u30cd\u30eb\u306b\u6295\u7a3f\u3057\u307e\u3059\u3002\n\n```js:~/node_apps/node-hello-ngrok-pm2/app.js\nrequire('dotenv').load();\nvar ngrok = require('ngrok'),\n    express = require('express'),\n    Slack = require('node-slack');\n\nvar slack = new Slack(process.env.SLACK_WEBHOOK);\nvar app = express();\n\napp.get('/', function(req, res) {\n    res.send('Hello World!');\n});\n\nvar server = app.listen(process.env.EXPRESS_PORT, function() {\n    var host = server.address().address,\n        port = server.address().port;\n\n    console.log('listening at http://%s:%s', host, port);\n    ngrok.connect({\n        port: port\n    },\n    function (err, url) {\n        console.log(url);\n        var message = 'app url: ' + url;\n        slack.send({\n            text: message,\n            channel: '#general',\n            username: 'raspi',\n            icon_emoji: \":ghost:\"\n        });\n    });\n});\n```\n\n\n\n## \u78ba\u8a8d\n\npm2\u304b\u3089\u30a2\u30d7\u30ea\u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3057\u307e\u3059\u3002\n\n```bash\n$ pm2 restart app\n[PM2] restartProcessId process id 0\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 App name \u2502 id \u2502 mode \u2502 pid  \u2502 status \u2502 restart \u2502 uptime \u2502 memory     \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 app      \u2502 0  \u2502 fork \u2502 4401 \u2502 online \u2502 7       \u2502 0s     \u2502 8.602 MB   \u2502 disabled \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n Use `pm2 show <id|name>` to get more details about an app\n```\n\n\u30ea\u30b9\u30bf\u30fc\u30c8\u5f8c\u3001Slack\u306bngrok\u306eURL\u304c\u6295\u7a3f\u3055\u308c\u307e\u3057\u305f\u3002\n\n![slack-ngrok-url.png](https://qiita-image-store.s3.amazonaws.com/0/43745/5c95cae0-fc5e-4797-16b0-df1f1d79ec2e.png)\n\nSlack\u306b\u6295\u7a3f\u3055\u308c\u305f\u30ea\u30f3\u30af\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u3001Raspberry Pi\u3067\u8d77\u52d5\u3057\u3066\u3044\u308bExpress\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![raspi-hello-ngrok.png](https://qiita-image-store.s3.amazonaws.com/0/43745/df51b3cd-7745-6805-19a2-53bb4fcec23d.png)\n\n", "tags": ["RaspberryPi", "ngrok1.7", "Slack", "Node.js", "Webhook"]}