{"context": "\n\nInstallation How to: Nested ESXi on KVM\n\n\u76ee\u7684\n\nESXi \u306e\u30c6\u30b9\u30c8\u3092\u4eee\u60f3\u74b0\u5883\u3067\n\n\n\u30b7\u30b9\u30c6\u30e0\n\nUbuntu 14.04.3 LTS\nqemu-kvm 2.0.0\nlibvirt 1.2.2\n\n\n\u624b\u9806\n\n1. \u7a7a\u304d VNC \u30dd\u30fc\u30c8\u8abf\u3079\n$ for i in `virsh -c qemu:///system list --all | awk '{print $2}' | grep -v Name` ; do virsh dumpxml $i|grep vnc  ; done | sort\n\n\noutput_sample\n    <graphics type='vnc' port='5926' autoport='no' listen='0.0.0.0'>\n    <graphics type='vnc' port='5927' autoport='no' listen='0.0.0.0'>\n    <graphics type='vnc' port='5928' autoport='no' listen='0.0.0.0'>\n\n\n\n2. VNC \u30dd\u30fc\u30c8\u30a2\u30b5\u30a4\u30f3\n$ VNCPORT='5929'\n\n\n3. VM \u540d\u306e\u6c7a\u5b9a\u3068 Disk \u4f5c\u6210\n$ VMNAME='esxi6.5-test01'\n\nqemu-img create -f qcow2 -o preallocation=metadata $VMNAME.qcow2 20G\n\n\n4. \u30e1\u30e2\u30ea\u30a2\u30b5\u30a4\u30f3\n$ RAM='4096'\n\n\n5. iso \u30d5\u30a1\u30a4\u30eb\u540d\u3001OS \u30bf\u30a4\u30d7\u6307\u5b9a\n$ ISOFILE='/pathto/VMware-VMvisor-Installer-201701001-4887370.x86_64.iso'\n$ OSTYPE='linux'\n\n\n6. VM \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ virt-install --connect qemu:///system \\\n-n $VMNAME -r $RAM \\\n--vcpus=sockets=1,cores=2,threads=2 \\\n--cpu host --disk path=./$VMNAME.qcow2 \\\n-c $ISOFILE --os-type $OSTYPE \\\n--accelerate --network=bridge:br0,model=e1000 \\\n--hvm --graphics vnc,port=$VNCPORT,listen=0.0.0.0\n\n\n7. VNC \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067 KVM \u30db\u30b9\u30c8\u306e $VNCPORT \u306b\u63a5\u7d9a\n\n\n\n8. \u3042\u3068\u306f\u901a\u5e38\u306e ESXi \u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u3092\u9032\u3081\u3066\u4e0b\u3055\u3044\n\n9. \u304a\u308f\u308a\n# Installation How to: Nested ESXi on KVM\n\n## \u76ee\u7684\n\n- ESXi \u306e\u30c6\u30b9\u30c8\u3092\u4eee\u60f3\u74b0\u5883\u3067\n\n## \u30b7\u30b9\u30c6\u30e0\n\n  - Ubuntu 14.04.3 LTS\n  - qemu-kvm 2.0.0\n  - libvirt 1.2.2\n\n## \u624b\u9806\n\n### 1. \u7a7a\u304d VNC \u30dd\u30fc\u30c8\u8abf\u3079\n\n```shell-session\n$ for i in `virsh -c qemu:///system list --all | awk '{print $2}' | grep -v Name` ; do virsh dumpxml $i|grep vnc  ; done | sort\n```\n\n```shell-session:output_sample\n    <graphics type='vnc' port='5926' autoport='no' listen='0.0.0.0'>\n    <graphics type='vnc' port='5927' autoport='no' listen='0.0.0.0'>\n    <graphics type='vnc' port='5928' autoport='no' listen='0.0.0.0'>\n```\n\n### 2. VNC \u30dd\u30fc\u30c8\u30a2\u30b5\u30a4\u30f3\n\n```shell-session\n$ VNCPORT='5929'\n```\n\n### 3. VM \u540d\u306e\u6c7a\u5b9a\u3068 Disk \u4f5c\u6210\n\n```shell-session\n$ VMNAME='esxi6.5-test01'\n```\n```shell-session\nqemu-img create -f qcow2 -o preallocation=metadata $VMNAME.qcow2 20G\n```\n\n### 4. \u30e1\u30e2\u30ea\u30a2\u30b5\u30a4\u30f3\n\n```shell-session\n$ RAM='4096'\n```\n\n### 5. iso \u30d5\u30a1\u30a4\u30eb\u540d\u3001OS \u30bf\u30a4\u30d7\u6307\u5b9a\n\n```shell-session\n$ ISOFILE='/pathto/VMware-VMvisor-Installer-201701001-4887370.x86_64.iso'\n$ OSTYPE='linux'\n```\n\n### 6. VM \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell-session\n$ virt-install --connect qemu:///system \\\n-n $VMNAME -r $RAM \\\n--vcpus=sockets=1,cores=2,threads=2 \\\n--cpu host --disk path=./$VMNAME.qcow2 \\\n-c $ISOFILE --os-type $OSTYPE \\\n--accelerate --network=bridge:br0,model=e1000 \\\n--hvm --graphics vnc,port=$VNCPORT,listen=0.0.0.0\n```\n\n### 7. VNC \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067 KVM \u30db\u30b9\u30c8\u306e $VNCPORT \u306b\u63a5\u7d9a\n\n![Screenshot 2017-02-23 03.30.41.png](https://qiita-image-store.s3.amazonaws.com/0/67892/84b8f37f-b20e-4645-de24-d77279b867e0.png)\n\n\n![Screenshot 2017-02-23 03.35.54.png](https://qiita-image-store.s3.amazonaws.com/0/67892/1707bafb-a9c7-22f3-5b56-b7b13bafd4a8.png)\n\n### 8. \u3042\u3068\u306f\u901a\u5e38\u306e ESXi \u540c\u69d8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u3092\u9032\u3081\u3066\u4e0b\u3055\u3044\n\n### 9. \u304a\u308f\u308a\n", "tags": ["KVM", "libvirt", "ESXi6.5", "vSphere"]}