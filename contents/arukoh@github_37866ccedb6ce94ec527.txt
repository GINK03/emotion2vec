{"context": " More than 1 year has passed since last update.\n\n\u30b1\u30fc\u30b9\n\n\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u540d\u306f\u3001access_log\napache\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u53ce\u96c6\u3057\u3066\u3044\u308b\n\n\nhttp://ltsv.org/\nLogFormat \"host:%h\\tident:%l\\tuser:%u\\ttime:%t\\treq:%r\\tstatus:%>s\\tsize:%b\\treferer:\\%{Referer}i\\tua:%{User-Agent}i\" combined_ltsv\n\n\n\n\n\u6e96\u5099\n\nConfiguration\nhttp://mongoid.org/en/mongoid/docs/installation.html#configuration\n\u7701\u7565\n\nDocument\u5b9a\u7fa9\nhttp://mongoid.org/en/mongoid/docs/documents.html\nclass AccessLog\n  include Mongoid::Document\n  store_in collection: \"access_log\"\nend\n\nAccessLog.last.as_document\n=> {\"_id\"=>\"5338b6e0058281474986c8a6\",\n \"host\"=>\"10.0.0.1\",\n \"ident\"=>\"-\",\n \"user\"=>\"-\",\n \"time\"=>2014-01-01 00:00:00 UTC,\n \"req\"=>\"\\\"GET / HTTP/1.1\\\"\",\n \"status\"=>\"200\",\n \"size\"=>\"1024\",\n \"referer\"=>\"-\",\n \"ua\"=> \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:27.0) Gecko/20100101 Firefox/27.0\\\"\"}\n\n\n\u3000\u30af\u30a8\u30ea\nhttp://mongoid.org/en/mongoid/docs/querying.html\nActiveRecord\u30e9\u30a4\u30af\u306a\uff08\uff1f\uff09DSL\u304c\u5b9a\u7fa9\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u3042\u3068\u306f\u6163\u308c\u306e\u554f\u984c\u304b\u3002\nMyDSL\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u3001\u5c11\u3057\u306f\u4fbf\u5229\u304b\u306a\u3002\nmodule DSL\n  def time(times)\n    where({time: times})\n  end\n\n  def status(code)\n    where(to_status_hash(code))\n  end\n  alias :status_and :status\n\n  def status_or(*codes)\n    self.or(codes.map{|code| to_status_hash(code)})\n  end\n\n  def status_not(code)\n    self.not(to_status_hash(code))\n  end\n\n  private\n  def to_status_hash(code)\n    {status: code.is_a?(Regexp) ? code : Regexp.new(code.to_s)}\n  end\nend\n\nmodule Mongoid\n  class Criteria\n    include DSL\n  end\nend\n\nclass AccessLog\n  include DSL\nend\n\n\u4ee5\u4e0b\u3001\u3069\u308c\u3082\u540c\u3058selector\u3068\u306a\u308b\u3002\nAccessLog.where(time: 1.days.ago..Time.now).where(status: /5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n\nAccessLog.where(time: 1.days.ago..Time.now, status: /5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n\nAccessLog.time(1.days.ago..Time.now).status(/5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n\n## \u30b1\u30fc\u30b9\n\n* \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u540d\u306f\u3001access_log\n* apache\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u53ce\u96c6\u3057\u3066\u3044\u308b\n * http://ltsv.org/\n * LogFormat \"host:%h\\tident:%l\\tuser:%u\\ttime:%t\\treq:%r\\tstatus:%>s\\tsize:%b\\treferer:\\%{Referer}i\\tua:%{User-Agent}i\" combined_ltsv\n\n## \u6e96\u5099\n### Configuration\n\nhttp://mongoid.org/en/mongoid/docs/installation.html#configuration\n\u7701\u7565\n\n### Document\u5b9a\u7fa9\n\nhttp://mongoid.org/en/mongoid/docs/documents.html\n\n```rb\nclass AccessLog\n  include Mongoid::Document\n  store_in collection: \"access_log\"\nend\n```\n\n```irb\nAccessLog.last.as_document\n=> {\"_id\"=>\"5338b6e0058281474986c8a6\",\n \"host\"=>\"10.0.0.1\",\n \"ident\"=>\"-\",\n \"user\"=>\"-\",\n \"time\"=>2014-01-01 00:00:00 UTC,\n \"req\"=>\"\\\"GET / HTTP/1.1\\\"\",\n \"status\"=>\"200\",\n \"size\"=>\"1024\",\n \"referer\"=>\"-\",\n \"ua\"=> \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10.9; rv:27.0) Gecko/20100101 Firefox/27.0\\\"\"}\n```\n\n##\u3000\u30af\u30a8\u30ea\n\nhttp://mongoid.org/en/mongoid/docs/querying.html\nActiveRecord\u30e9\u30a4\u30af\u306a\uff08\uff1f\uff09DSL\u304c\u5b9a\u7fa9\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u3042\u3068\u306f\u6163\u308c\u306e\u554f\u984c\u304b\u3002\n\nMyDSL\u3092\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u3068\u3001\u5c11\u3057\u306f\u4fbf\u5229\u304b\u306a\u3002\n\n```rb\nmodule DSL\n  def time(times)\n    where({time: times})\n  end\n\n  def status(code)\n    where(to_status_hash(code))\n  end\n  alias :status_and :status\n\n  def status_or(*codes)\n    self.or(codes.map{|code| to_status_hash(code)})\n  end\n\n  def status_not(code)\n    self.not(to_status_hash(code))\n  end\n\n  private\n  def to_status_hash(code)\n    {status: code.is_a?(Regexp) ? code : Regexp.new(code.to_s)}\n  end\nend\n\nmodule Mongoid\n  class Criteria\n    include DSL\n  end\nend\n\nclass AccessLog\n  include DSL\nend\n```\n\n\u4ee5\u4e0b\u3001\u3069\u308c\u3082\u540c\u3058selector\u3068\u306a\u308b\u3002\n\n```irb\nAccessLog.where(time: 1.days.ago..Time.now).where(status: /5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n\nAccessLog.where(time: 1.days.ago..Time.now, status: /5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n\nAccessLog.time(1.days.ago..Time.now).status(/5\\d\\d/)\n=> #<Mongoid::Criteria\n  selector: {\"time\"=>{\"$gte\"=>2014-01-01 00:00:00 UTC, \"$lte\"=>2014-01-01 10:00:00 UTC}, \"status\"=>/5\\d\\d/}\n  options:  {}\n  class:    AccessLog\n  embedded: false>\n```\n", "tags": ["MongoDB", "mongoid", "Ruby"]}