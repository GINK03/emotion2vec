{"tags": ["Rails", "Ruby", "OmniAuth", "Twitter"], "context": " More than 1 year has passed since last update.Ruby2.0, Rails4\u3067\u78ba\u8a8d\n\u3044\u3064\u304b\u8a66\u305d\u3046\u3044\u3064\u304b\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305fOmniauth\u3092\u4f7f\u3063\u3066\u306eTwitter\u30ed\u30b0\u30a4\u30f3\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u8a73\u7d30\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\n\n\u521d\u671f\u8a2d\u5b9a\n\nTwitter\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\n\ncallback URL\u306b\u300chttp://127.0.0.1:3000/auth/twitter\u300d\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u5f8c\u3005\u6295\u7a3f\u3082\u3055\u305b\u305f\u3044\u306e\u3067Access\u3092\u300cRead and Write\u300d\u306b\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\u300cAllow this application to use 'Sign in with Twitter\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u304a\u304f\u3068\u3001\u4e8c\u5ea6\u76ee\u306e\u30ed\u30b0\u30a4\u30f3\u4ee5\u964d\u306f\u8a8d\u8a3c\u753b\u9762\u3092\u7701\u7565\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nGemfile\u8ffd\u52a0\n\ngem 'omniauth'\ngem 'omniauth-twitter'\ngem 'settingslogic'\n\n\nbundle install\n\n./bin bundle install\n\n\nsettingslogic initializer\u8a2d\u5b9a\n\n\nconfig/initializers/0_settings.rb\nclass Settings < Settingslogic\n  source \"#{Rails.root}/config/settings.yml\"\n  namespace Rails.env\nend\n\n\n\nsettings.yml\u306btwitter\u8a2d\u5b9a\u3092\u8a18\u8ff0\n\n\nconfig/settings.yml\ndefaults: &defaults\n\ndevelopment:\n  <<: *defaults\n  twitter:\n    consumer_key: YOUR CONSUMER KEY\n    consumer_secret: YOUR CONSUMER SECRET\n\ntest:\n  <<: *defaults\n\nproduction:\n  <<: *defaults\n\n\n\nomniauth initializer\u8a2d\u5b9a\n\n\nconfig/initializers/omniauth.rb\nRails.application.config.middleware.use OmniAuth::Builder do\n  provider :twitter, Settings.twitter.consumer_key, Settings.twitter.consumer_secret\nend\n\n\n\nmodel\u4f5c\u6210\n\nuser\u30e2\u30c7\u30eb\u4f5c\u6210\n\n./bin/rails g model user provider:string uid:string screen_name:string name:string\n\n\nmigrate\n\n./bin/rake db:migrate\n\n\napp/models/user.rb\n\n\napp/models/user.rb\n\nclass User < ActiveRecord::Base\n  def self.create_with_omniauth(auth)\n    create! do |user|\n      user.provider = auth['provider']\n      user.uid = auth['uid']\n      user.screen_name = auth['info']['nickname']\n      user.name = auth['info']['name']\n    end\n  end\nend\n\n\n\ncontroller\u4f5c\u6210\n\ncontroller\u4f5c\u6210\n\n./bin/rails g controller base\n./bin/rails g controller home index\n./bin/rails g controller sessions\n\n\nrouting\u8ffd\u52a0\n\n\nconfig/routes.rb\nroot 'home#index'\nget \"home/index\"\nget '/auth/:provider/callback', :to => 'sessions#callback'\npost '/auth/:provider/callback', :to => 'sessions#callback'\nget '/logout' => 'sessions#destroy', :as => :logout\n\n\n\nBaseController\n\n\napp/controllers/base_controller.rb\nclass BaseController < ActionController::Base\n  protect_from_forgery\n\n  def login_required\n    if session[:user_id]\n      @current_user = User.find(session[:user_id])\n    else\n      redirect_to root_path\n    end\n\n  end\n\n  helper_method :current_user\n\n  private\n  def current_user\n    @current_user ||= User.find(session[:user_id]) if session[:user_id]\n  end\nend\n\n\n\nHomeController\n\n\napp/controllers/home_controller.rb\nclass HomeController < BaseController\n  def index\n  end\nend\n\n\n\nSessionController\n\n\napp/controllers/sessions_controller.rb\nclass SessionsController < ApplicationController\n  def callback\n    auth = request.env['omniauth.auth']\n    user = User.find_by_provider_and_uid(auth['provider'], auth['uid']) || User.create_with_omniauth(auth)\n    session[:user_id] = user.id\n    redirect_to root_path\n  end\n\n  def destroy\n    session[:user_id] = nil\n    redirect_to root_path\n  end\nend\n\n\n\nView\u5909\u66f4\n\nlayout\u8ffd\u52a0\n\n\napp/views/layouts/application.html.erb\n<% if current_user %>\n  <%= current_user.name %> <%= link_to '\u30ed\u30b0\u30a2\u30a6\u30c8', logout_path %>\n<% else %>\n  <%= link_to '\u30ed\u30b0\u30a4\u30f3', '/auth/twitter' %>\n<% end %>\n\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089http://127.0.0.1:3000\n\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30ed\u30b0\u30a4\u30f3\u30ea\u30f3\u30af\u304c\u8868\u793a\u3055\u308c\u3001Twitter\u8a8d\u8a3c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u6b21\u56de\u306f\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u3067Tweet\u6295\u7a3f\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u53c2\u8003\n\nRails\u3067Omniauth\u3092\u4f7f\u3063\u3066Twitter\u30ed\u30b0\u30a4\u30f3\u3059\u308b\nintridea / omniauth\n(\u30e1\u30e2) Rails+OmniAuth\u306b\u3088\u308bTwitter\u30ed\u30b0\u30a4\u30f3\nOmniAuth 1.1.4\u3068Rails 4.0.1\u3067Twitter\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3088\u308b\u8a8d\u8a3c\nRails\u3067omniauth\u3092\u4f7f\u3063\u3066twitter,facebook\u306e\u7c21\u5358\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\nTwitter OAuth \u306e\u6319\u52d5\u304c\u5909\u308f\u308a\u307e\u3057\u305f\n241: \u7c21\u5358\u306aOmniAuth\n\n\nRuby2.0, Rails4\u3067\u78ba\u8a8d\n\n\u3044\u3064\u304b\u8a66\u305d\u3046\u3044\u3064\u304b\u8a66\u305d\u3046\u3068\u601d\u3063\u3066\u3044\u305fOmniauth\u3092\u4f7f\u3063\u3066\u306eTwitter\u30ed\u30b0\u30a4\u30f3\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n[\u8a73\u7d30\u8a18\u4e8b\u306f\u3053\u3061\u3089\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044](http://blog.hello-world.jp.net/?p=847)\n\n### \u521d\u671f\u8a2d\u5b9a\n\n* Twitter\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\n\ncallback URL\u306b\u300chttp://127.0.0.1:3000/auth/twitter\u300d\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u5f8c\u3005\u6295\u7a3f\u3082\u3055\u305b\u305f\u3044\u306e\u3067Access\u3092\u300cRead and Write\u300d\u306b\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u300cAllow this application to use 'Sign in with Twitter\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u304a\u304f\u3068\u3001\u4e8c\u5ea6\u76ee\u306e\u30ed\u30b0\u30a4\u30f3\u4ee5\u964d\u306f\u8a8d\u8a3c\u753b\u9762\u3092\u7701\u7565\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n* Gemfile\u8ffd\u52a0\n\n```\ngem 'omniauth'\ngem 'omniauth-twitter'\ngem 'settingslogic'\n```\n\n* bundle install\n\n```\n./bin bundle install\n```\n\n* settingslogic initializer\u8a2d\u5b9a\n\n```config/initializers/0_settings.rb\nclass Settings < Settingslogic\n  source \"#{Rails.root}/config/settings.yml\"\n  namespace Rails.env\nend\n```\n\n* settings.yml\u306btwitter\u8a2d\u5b9a\u3092\u8a18\u8ff0\n\n```config/settings.yml\ndefaults: &defaults\n\ndevelopment:\n  <<: *defaults\n  twitter:\n    consumer_key: YOUR CONSUMER KEY\n    consumer_secret: YOUR CONSUMER SECRET\n\ntest:\n  <<: *defaults\n\nproduction:\n  <<: *defaults\n```\n\n* omniauth initializer\u8a2d\u5b9a\n\n```config/initializers/omniauth.rb\nRails.application.config.middleware.use OmniAuth::Builder do\n  provider :twitter, Settings.twitter.consumer_key, Settings.twitter.consumer_secret\nend\n```\n\n## model\u4f5c\u6210\n\n* user\u30e2\u30c7\u30eb\u4f5c\u6210\n\n```\n./bin/rails g model user provider:string uid:string screen_name:string name:string\n```\n\n* migrate\n\n```\n./bin/rake db:migrate\n```\n\n* app/models/user.rb\n\n```rb:app/models/user.rb\n\nclass User < ActiveRecord::Base\n  def self.create_with_omniauth(auth)\n    create! do |user|\n      user.provider = auth['provider']\n      user.uid = auth['uid']\n      user.screen_name = auth['info']['nickname']\n      user.name = auth['info']['name']\n    end\n  end\nend\n```\n\n## controller\u4f5c\u6210\n\n* controller\u4f5c\u6210\n\n```\n./bin/rails g controller base\n./bin/rails g controller home index\n./bin/rails g controller sessions\n```\n\n* routing\u8ffd\u52a0\n\n```config/routes.rb\nroot 'home#index'\nget \"home/index\"\nget '/auth/:provider/callback', :to => 'sessions#callback'\npost '/auth/:provider/callback', :to => 'sessions#callback'\nget '/logout' => 'sessions#destroy', :as => :logout\n```\n\n* BaseController\n\n```app/controllers/base_controller.rb\nclass BaseController < ActionController::Base\n  protect_from_forgery\n \n  def login_required\n    if session[:user_id]\n      @current_user = User.find(session[:user_id])\n    else\n      redirect_to root_path\n    end\n \n  end\n \n  helper_method :current_user\n \n  private\n  def current_user\n    @current_user ||= User.find(session[:user_id]) if session[:user_id]\n  end\nend\n```\n\n* HomeController\n\n```app/controllers/home_controller.rb\nclass HomeController < BaseController\n  def index\n  end\nend\n```\n\n* SessionController\n\n```app/controllers/sessions_controller.rb\nclass SessionsController < ApplicationController\n  def callback\n    auth = request.env['omniauth.auth']\n    user = User.find_by_provider_and_uid(auth['provider'], auth['uid']) || User.create_with_omniauth(auth)\n    session[:user_id] = user.id\n    redirect_to root_path\n  end\n   \n  def destroy\n    session[:user_id] = nil\n    redirect_to root_path\n  end\nend\n```\n\n## View\u5909\u66f4\n\n* layout\u8ffd\u52a0\n\n```app/views/layouts/application.html.erb\n<% if current_user %>\n  <%= current_user.name %> <%= link_to '\u30ed\u30b0\u30a2\u30a6\u30c8', logout_path %>\n<% else %>\n  <%= link_to '\u30ed\u30b0\u30a4\u30f3', '/auth/twitter' %>\n<% end %>\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089[http://127.0.0.1:3000](http://127.0.0.1:3000)\n\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30ed\u30b0\u30a4\u30f3\u30ea\u30f3\u30af\u304c\u8868\u793a\u3055\u308c\u3001Twitter\u8a8d\u8a3c\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n## \u6b21\u56de\u306f\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u3067Tweet\u6295\u7a3f\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n### \u53c2\u8003\n* [Rails\u3067Omniauth\u3092\u4f7f\u3063\u3066Twitter\u30ed\u30b0\u30a4\u30f3\u3059\u308b](http://blog.hello-world.jp.net/?p=847)\n* [intridea / omniauth](https://github.com/intridea/omniauth)\n* [(\u30e1\u30e2) Rails+OmniAuth\u306b\u3088\u308bTwitter\u30ed\u30b0\u30a4\u30f3](http://d.hatena.ne.jp/m-kawato/20130105/1357399125)\n* [OmniAuth 1.1.4\u3068Rails 4.0.1\u3067Twitter\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u3088\u308b\u8a8d\u8a3c](http://blog.iotaworks.jp/2013/11/omniauth-twitter-with-rails.html)\n* [Rails\u3067omniauth\u3092\u4f7f\u3063\u3066twitter,facebook\u306e\u7c21\u5358\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c](http://www.geekzshu.com/rails/1562)\n* [Twitter OAuth \u306e\u6319\u52d5\u304c\u5909\u308f\u308a\u307e\u3057\u305f](http://koiroha.blogspot.jp/2013/03/changes-to-the-sign-in-with-twiter-flow.html)\n* [241: \u7c21\u5358\u306aOmniAuth](http://ja.asciicasts.com/episodes/241-simple-omniauth)\n"}