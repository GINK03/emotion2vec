{"tags": ["AVX"], "context": "\n\n\u306f\u3058\u3081\u306b\nAVX\u306e\u30d3\u30c3\u30c8\u30c6\u30b9\u30c8\u306f\u3001\u6574\u6570\u7248(VPTEST)\u3068\u5b9f\u6570\u7248(VTESTPD)\u304c\u3042\u3063\u3066\u3001\u52d5\u4f5c\u304c\u7570\u306a\u308b\u3002\u3061\u3087\u3063\u3068\u6df7\u4e71\u3059\u308b\u306e\u3067\u899a\u66f8\u3002\u30d3\u30c3\u30c8\u30c6\u30b9\u30c8\u306fZF\u3001CF\u306e\u53cc\u65b9\u306b\u5f71\u97ff\u3059\u308b\u304c\u3001\u4ee5\u4e0bZF\u306e\u632f\u308b\u821e\u3044\u306e\u307f\u306b\u3064\u3044\u3066\u8a18\u8ff0\u3059\u308b\u3002\n\n\u6574\u6570\u7248(VPTEST)\n\u6574\u6570\u7248\u306eVPTEST\u306f\u3001\u5168\u30d3\u30c3\u30c8\u306b\u5bfe\u3057\u3066AND\u3092\u304b\u3051\u308b\u3002\u5168\u30d3\u30c3\u30c8\u306eAND\u304c\u30bc\u30ed\u306a\u3089ZF\u304c\u7acb\u3061\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070ZF\u306f\u30af\u30ea\u30a2\u3055\u308c\u308b\u3002\u5bfe\u5fdc\u3059\u308b\u7d44\u307f\u8fbc\u307f\u95a2\u6570\u306f_mm256_testz_si256\u3002\u3053\u308c\u306fZF\u304c\u7acb\u3063\u3066\u3044\u305f\u30891\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3092\u8fd4\u3059\u30021\n\u8981\u3059\u308b\u306b\u3001\u7d14\u7c8b\u306b256\u30d3\u30c3\u30c8\u306eAND\u3060\u3068\u601d\u3048\u3070\u826f\u3044\u3002\u4ee5\u4e0b\u3001\u3044\u304f\u3064\u304b\u4f8b\u793a\u3002\n\n\u8981\u7d20\u3054\u3068\u306eAND\u304c\u5168\u30660\u306a\u30891\n\n  __m256i v1 = _mm256_set_epi32(0,1,2,4,8,16,32,64);\n  __m256i v2 = _mm256_set_epi32(1,2,4,8,16,32,64,128);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 1\n\n\n \u8981\u7d20\u3054\u3068\u306eAND\u304c\u4e00\u3064\u3067\u3082\u975e\u30bc\u30ed\u306a\u30890\n\n  __m256i v1 = _mm256_set_epi32(0,1,2,4,8,16,32,64);\n  __m256i v2 = _mm256_set_epi32(1,1,4,8,16,32,64,128);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 0\n\n\n\u540c\u3058\u5024\u3067\u30820\n\n  __m256i v1 = _mm256_set_epi32(0,1,2,3,4,5,6,7);\n  __m256i v2 = _mm256_set_epi32(0,1,2,3,4,5,6,8);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 0\n\n\u306a\u306e\u3067\u3001\u4f8b\u3048\u3070mm256_testz_si256(v1,v1)\u3067\u3001YMM\u30ec\u30b8\u30b9\u30bf\u304c\u5168\u3066\u30bc\u30ed\u3067\u3042\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u305f\u308a\u3001(\u672c\u8cea\u7684\u306b\u540c\u3058\u3053\u3068\u3060\u304c)mm256_testz_si256(v1-v2,v1-v2)\u3067\u4e8c\u3064\u306eYMM\u30ec\u30b8\u30b9\u30bf\u304c\u5168\u304f\u540c\u3058\u5024\u3092\u3082\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u5b9f\u6570\u7248(VTESTPD)\n\u6574\u6570\u7248\u304c\u300c\u5168\u3066\u306ebit\u306eAND\u300d\u3092\u3068\u3063\u3066\u3044\u305f\u306e\u306b\u5bfe\u3057\u3066\u3001\u5b9f\u6570\u7248\u306f\u300c\u7b26\u53f7\u30d3\u30c3\u30c8\u300d\u306b\u306e\u307f\u4f5c\u7528\u3059\u308b\u3002\u56f3\u89e3\u3059\u308b\u307e\u3067\u3082\u306a\u3044\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n\nYMM\u30ec\u30b8\u30b9\u30bf\u3092\u98df\u308f\u305b\u305f\u5834\u5408\u306f\u30014\u3064\u306e\u8981\u7d20\u306e\u7b26\u53f7\u30d9\u30af\u30c8\u30eb\u306e\u307f\u3092\u96c6\u3081\u305f4bit\u306e\u5024\u3092\u4f5c\u3063\u3066\u3001\u305d\u308c\u306bAND\u3092\u304b\u3051\u3066\u3001\u30bc\u30ed\u306b\u306a\u3063\u305f\u3089ZF\u3092\u7acb\u3066\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070ZF\u3092\u30af\u30ea\u30a2\u3059\u308b\u3002\u5bfe\u5fdc\u3059\u308b\u7d44\u307f\u8fbc\u307f\u95a2\u6570\u306f_mm256_testz_pd\u3067\u3001ZF\u304c\u7acb\u3063\u3066\u3044\u308c\u30701\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3092\u8fd4\u3059\u30021\n\u8981\u3059\u308b\u306b\u300c\u5bfe\u5fdc\u3059\u308b\u4f4d\u7f6e\u306e\u8981\u7d20\u304c\u540c\u6642\u306b\u8ca0\u3067\u3042\u308c\u30701\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u300d\u3068\u306a\u308b\u3002\u4ee5\u4e0b\u3001\u3044\u304f\u3064\u304b\u4f8b\u793a\u3002\n\n\u8ca0\u306e\u8981\u7d20\u304c\u306a\u3051\u308c\u3070\u5024\u306b\u95a2\u308f\u3089\u305a1\n\n  __m256d v1 = _mm256_set_pd(3,2,1,0);\n  __m256d v2 = _mm256_set_pd(7,6,5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 1\n\n\n\u540c\u3058\u4f4d\u7f6e\u306b\u8ca0\u306e\u8981\u7d20\u304c\u3042\u308c\u3070\u3001\u5024\u304c\u7570\u306a\u3063\u3066\u3044\u3066\u30820\n\n  __m256d v1 = _mm256_set_pd(3,2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,6,-5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 0\n\n\n\u8ca0\u306e\u8981\u7d20\u306e\u4f4d\u7f6e\u304c\u7570\u306a\u3063\u3066\u3044\u308c\u30701\n\n  __m256d v1 = _mm256_set_pd(3,2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,-6,5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 1\n\n\n\u5bfe\u5fdc\u3059\u308b\u8ca0\u306e\u8981\u7d20\u304c\u8907\u6570\u3042\u3063\u3066\u30820\n\n  __m256d v1 = _mm256_set_pd(3,-2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,-6,-5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 0\n\n\u306a\u306e\u3067\u3001\u7b2c\u4e00\u5f15\u6570\u3068\u7b2c\u4e8c\u5f15\u6570\u306b\u540c\u3058\u30d9\u30af\u30c8\u30eb\u3092\u98df\u308f\u305b\u308b\u3068\u300c4\u3064\u306e\u8981\u7d20\u306e\u3046\u3061\u3069\u308c\u304b\u4e00\u3064\u3067\u3082\u8ca0\u306a\u30890\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30701\u300d\u3068\u3044\u3046\u5224\u5b9a\u306b\u4f7f\u3048\u308b\u3002\u3063\u3066\u3044\u3046\u304b\u305d\u308c\u4ee5\u5916\u306e\u6709\u52b9\u306a\u4f7f\u3044\u65b9\u3092\u601d\u3044\u3064\u304b\u306a\u3044\u30fb\u30fb\u30fb\u3002\n\n\u307e\u3068\u3081\n\u30d1\u30c3\u30af\u30c9\u30fb\u30d3\u30c3\u30c8\u30fb\u30c6\u30b9\u30c8\u306f\u3001\u6574\u6570\u7248\u3068\u5b9f\u6570\u7248\u3067\u547d\u4ee4\u304c\u7570\u306a\u308a\u3001\u52d5\u4f5c\u3082\u7570\u306a\u308b\u3002\u7279\u306bANDPD\u3068\u304bORPD\u304c\u30d3\u30c3\u30c8\u3054\u3068\u306b\u304b\u304b\u308b\u306e\u306b\u3001VTESTPD\u306f\u7b26\u53f7\u30d3\u30c3\u30c8\u306b\u3057\u304b\u304b\u304b\u3089\u306a\u3044\u306e\u306b\u3057\u3070\u3089\u304f\u6c17\u3065\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u3044\u305f\u3002\u3061\u3083\u3093\u3068\u8aad\u3080\u3068\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u66f8\u3044\u3066\u3042\u308b\u3093\u3060\u3051\u3069\u3001\u305d\u306e\u66f8\u304d\u65b9\u304c\n IF (TEMP[63] = TEMP[127] = TEMP[191] = TEMP[255] = 0)\n   THEN ZF\u21901;\n   ELSE ZF\u21900;\n\n\u307f\u305f\u3044\u306b\u3055\u3089\u3063\u3068\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u30fb\u30fb\u30fb\u3002\n\n\n\n\n\u672c\u5f53\u306fZF\u304c\u7acb\u3063\u3066\u3044\u308c\u3070\u975e\u30bc\u30ed\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3060\u304c\u3001\u624b\u5143\u306e\u74b0\u5883\u3067\u306f1\u3092\u8fd4\u3059\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u305f\u3002\u00a0\u21a9\n\n\n\n# \u306f\u3058\u3081\u306b\n\nAVX\u306e\u30d3\u30c3\u30c8\u30c6\u30b9\u30c8\u306f\u3001\u6574\u6570\u7248(VPTEST)\u3068\u5b9f\u6570\u7248(VTESTPD)\u304c\u3042\u3063\u3066\u3001\u52d5\u4f5c\u304c\u7570\u306a\u308b\u3002\u3061\u3087\u3063\u3068\u6df7\u4e71\u3059\u308b\u306e\u3067\u899a\u66f8\u3002\u30d3\u30c3\u30c8\u30c6\u30b9\u30c8\u306fZF\u3001CF\u306e\u53cc\u65b9\u306b\u5f71\u97ff\u3059\u308b\u304c\u3001\u4ee5\u4e0bZF\u306e\u632f\u308b\u821e\u3044\u306e\u307f\u306b\u3064\u3044\u3066\u8a18\u8ff0\u3059\u308b\u3002\n\n# \u6574\u6570\u7248(VPTEST)\n\n\u6574\u6570\u7248\u306eVPTEST\u306f\u3001\u5168\u30d3\u30c3\u30c8\u306b\u5bfe\u3057\u3066AND\u3092\u304b\u3051\u308b\u3002\u5168\u30d3\u30c3\u30c8\u306eAND\u304c\u30bc\u30ed\u306a\u3089ZF\u304c\u7acb\u3061\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070ZF\u306f\u30af\u30ea\u30a2\u3055\u308c\u308b\u3002\u5bfe\u5fdc\u3059\u308b\u7d44\u307f\u8fbc\u307f\u95a2\u6570\u306f`_mm256_testz_si256`\u3002\u3053\u308c\u306fZF\u304c\u7acb\u3063\u3066\u3044\u305f\u30891\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3092\u8fd4\u3059\u3002[^1]\n\n\u8981\u3059\u308b\u306b\u3001\u7d14\u7c8b\u306b256\u30d3\u30c3\u30c8\u306eAND\u3060\u3068\u601d\u3048\u3070\u826f\u3044\u3002\u4ee5\u4e0b\u3001\u3044\u304f\u3064\u304b\u4f8b\u793a\u3002\n\n\n* \u8981\u7d20\u3054\u3068\u306eAND\u304c\u5168\u30660\u306a\u30891\n\n```cpp\n  __m256i v1 = _mm256_set_epi32(0,1,2,4,8,16,32,64);\n  __m256i v2 = _mm256_set_epi32(1,2,4,8,16,32,64,128);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 1\n```\n\n*  \u8981\u7d20\u3054\u3068\u306eAND\u304c\u4e00\u3064\u3067\u3082\u975e\u30bc\u30ed\u306a\u30890\n\n```cpp\n  __m256i v1 = _mm256_set_epi32(0,1,2,4,8,16,32,64);\n  __m256i v2 = _mm256_set_epi32(1,1,4,8,16,32,64,128);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 0\n```\n\n* \u540c\u3058\u5024\u3067\u30820\n\n```cpp\n  __m256i v1 = _mm256_set_epi32(0,1,2,3,4,5,6,7);\n  __m256i v2 = _mm256_set_epi32(0,1,2,3,4,5,6,8);\n  std::cout << _mm256_testz_si256(v1,v2) << std::endl;\n  // => 0\n```\n\n\u306a\u306e\u3067\u3001\u4f8b\u3048\u3070`mm256_testz_si256(v1,v1)`\u3067\u3001YMM\u30ec\u30b8\u30b9\u30bf\u304c\u5168\u3066\u30bc\u30ed\u3067\u3042\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u305f\u308a\u3001(\u672c\u8cea\u7684\u306b\u540c\u3058\u3053\u3068\u3060\u304c)`mm256_testz_si256(v1-v2,v1-v2)`\u3067\u4e8c\u3064\u306eYMM\u30ec\u30b8\u30b9\u30bf\u304c\u5168\u304f\u540c\u3058\u5024\u3092\u3082\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u8abf\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n# \u5b9f\u6570\u7248(VTESTPD)\n\n\u6574\u6570\u7248\u304c\u300c\u5168\u3066\u306ebit\u306eAND\u300d\u3092\u3068\u3063\u3066\u3044\u305f\u306e\u306b\u5bfe\u3057\u3066\u3001\u5b9f\u6570\u7248\u306f\u300c\u7b26\u53f7\u30d3\u30c3\u30c8\u300d\u306b\u306e\u307f\u4f5c\u7528\u3059\u308b\u3002\u56f3\u89e3\u3059\u308b\u307e\u3067\u3082\u306a\u3044\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3002\n\n![vptest.png](https://qiita-image-store.s3.amazonaws.com/0/79744/12c8252b-30eb-ed9c-bb08-4ab8a518f090.png)\n\nYMM\u30ec\u30b8\u30b9\u30bf\u3092\u98df\u308f\u305b\u305f\u5834\u5408\u306f\u30014\u3064\u306e\u8981\u7d20\u306e\u7b26\u53f7\u30d9\u30af\u30c8\u30eb\u306e\u307f\u3092\u96c6\u3081\u305f4bit\u306e\u5024\u3092\u4f5c\u3063\u3066\u3001\u305d\u308c\u306bAND\u3092\u304b\u3051\u3066\u3001\u30bc\u30ed\u306b\u306a\u3063\u305f\u3089ZF\u3092\u7acb\u3066\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u3070ZF\u3092\u30af\u30ea\u30a2\u3059\u308b\u3002\u5bfe\u5fdc\u3059\u308b\u7d44\u307f\u8fbc\u307f\u95a2\u6570\u306f`_mm256_testz_pd`\u3067\u3001ZF\u304c\u7acb\u3063\u3066\u3044\u308c\u30701\u3092\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3092\u8fd4\u3059\u3002[^1]\n\n\u8981\u3059\u308b\u306b\u300c\u5bfe\u5fdc\u3059\u308b\u4f4d\u7f6e\u306e\u8981\u7d20\u304c\u540c\u6642\u306b\u8ca0\u3067\u3042\u308c\u30701\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u300d\u3068\u306a\u308b\u3002\u4ee5\u4e0b\u3001\u3044\u304f\u3064\u304b\u4f8b\u793a\u3002\n\n* \u8ca0\u306e\u8981\u7d20\u304c\u306a\u3051\u308c\u3070\u5024\u306b\u95a2\u308f\u3089\u305a1\n\n```cpp\n  __m256d v1 = _mm256_set_pd(3,2,1,0);\n  __m256d v2 = _mm256_set_pd(7,6,5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 1\n```\n\n* \u540c\u3058\u4f4d\u7f6e\u306b\u8ca0\u306e\u8981\u7d20\u304c\u3042\u308c\u3070\u3001\u5024\u304c\u7570\u306a\u3063\u3066\u3044\u3066\u30820\n\n```cpp\n  __m256d v1 = _mm256_set_pd(3,2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,6,-5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 0\n```\n\n* \u8ca0\u306e\u8981\u7d20\u306e\u4f4d\u7f6e\u304c\u7570\u306a\u3063\u3066\u3044\u308c\u30701\n\n```cpp\n  __m256d v1 = _mm256_set_pd(3,2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,-6,5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 1\n```\n\n* \u5bfe\u5fdc\u3059\u308b\u8ca0\u306e\u8981\u7d20\u304c\u8907\u6570\u3042\u3063\u3066\u30820\n\n```cpp\n  __m256d v1 = _mm256_set_pd(3,-2,-1,0);\n  __m256d v2 = _mm256_set_pd(7,-6,-5,4);\n  std::cout << _mm256_testz_pd(v1,v2) << std::endl;\n  // => 0\n```\n\n\u306a\u306e\u3067\u3001\u7b2c\u4e00\u5f15\u6570\u3068\u7b2c\u4e8c\u5f15\u6570\u306b\u540c\u3058\u30d9\u30af\u30c8\u30eb\u3092\u98df\u308f\u305b\u308b\u3068\u300c4\u3064\u306e\u8981\u7d20\u306e\u3046\u3061\u3069\u308c\u304b\u4e00\u3064\u3067\u3082\u8ca0\u306a\u30890\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30701\u300d\u3068\u3044\u3046\u5224\u5b9a\u306b\u4f7f\u3048\u308b\u3002\u3063\u3066\u3044\u3046\u304b\u305d\u308c\u4ee5\u5916\u306e\u6709\u52b9\u306a\u4f7f\u3044\u65b9\u3092\u601d\u3044\u3064\u304b\u306a\u3044\u30fb\u30fb\u30fb\u3002\n\n# \u307e\u3068\u3081\n\n\u30d1\u30c3\u30af\u30c9\u30fb\u30d3\u30c3\u30c8\u30fb\u30c6\u30b9\u30c8\u306f\u3001\u6574\u6570\u7248\u3068\u5b9f\u6570\u7248\u3067\u547d\u4ee4\u304c\u7570\u306a\u308a\u3001\u52d5\u4f5c\u3082\u7570\u306a\u308b\u3002\u7279\u306bANDPD\u3068\u304bORPD\u304c\u30d3\u30c3\u30c8\u3054\u3068\u306b\u304b\u304b\u308b\u306e\u306b\u3001VTESTPD\u306f\u7b26\u53f7\u30d3\u30c3\u30c8\u306b\u3057\u304b\u304b\u304b\u3089\u306a\u3044\u306e\u306b\u3057\u3070\u3089\u304f\u6c17\u3065\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u3044\u305f\u3002\u3061\u3083\u3093\u3068\u8aad\u3080\u3068\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u66f8\u3044\u3066\u3042\u308b\u3093\u3060\u3051\u3069\u3001\u305d\u306e\u66f8\u304d\u65b9\u304c\n\n```\n IF (TEMP[63] = TEMP[127] = TEMP[191] = TEMP[255] = 0)\n   THEN ZF\u21901;\n   ELSE ZF\u21900;\n```\n\n\u307f\u305f\u3044\u306b\u3055\u3089\u3063\u3068\u66f8\u3044\u3066\u3042\u3063\u305f\u306e\u3067\u30fb\u30fb\u30fb\u3002\n\n[^1]: \u672c\u5f53\u306fZF\u304c\u7acb\u3063\u3066\u3044\u308c\u3070\u975e\u30bc\u30ed\u3001\u305d\u3046\u3067\u306a\u3051\u308c\u30700\u3060\u304c\u3001\u624b\u5143\u306e\u74b0\u5883\u3067\u306f1\u3092\u8fd4\u3059\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u305f\u3002\n"}