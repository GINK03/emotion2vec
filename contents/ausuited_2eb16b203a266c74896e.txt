{"context": " More than 1 year has passed since last update.\n\n\u8a18\u4e8b\u3092\u66f8\u304f\u304d\u3063\u304b\u3051\n\u8868\u984c\u306e\u901a\u308a\u3067\u3001\u4f8b\u3048\u3070fizz_buzz_fizzbuzz\u3068\u3044\u3046\u540d\u524d\u306e\u30c6\u30fc\u30d6\u30eb\u306emodel\u3092fromdb\u3067\u751f\u6210\u3059\u308b\u3068\u3001fuel/app/classes/model/fizz/buzz/fizzbuzz.php\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3001\u30af\u30e9\u30b9\u540d\u306fModel_Fizz_Buzz_Fizzbuzz\u3068\u306a\u308b\u3002\n\u3053\u308c\u3092\u3001fuel/app/classes/model/fizzbuzzfizzbuzz.php\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3001\u30af\u30e9\u30b9\u540d\u306fModel_Fizzbuzzfizzbuzz\u3068\u306a\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u3002\n\n\u5bfe\u5fdc\u306b\u3042\u305f\u3063\u3066\n\u540c\u3058\u4e8b\u3067\u60a9\u3093\u3060\u65b9\u3067\u3001\u751f\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092mv\u3057\u3066rm\u3057\u3066bootstrap.php\u3067Autoloader::add_classes\u3059\u308b\u89e3\u6c7a\u7b56\u304c\u3042\u3063\u305f\u304c\u3001fromdb\u306e\u4fbf\u5229\u3055\u3092\u4eab\u53d7\u3057\u305f\u304b\u3063\u305f\u305f\u3081\u3001\u3053\u306e\u65b9\u6cd5\u306f\u898b\u9001\u3063\u305f\u3002FuelPHP\u306a\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3092\u4f7f\u7528\u3057\u305f\u304f\u306a\u304b\u3063\u305f\u3001\u3068\u3044\u3046\u306e\u3082\u898b\u9001\u3063\u305f\u4e8b\u306e\u9060\u56e0\u3067\u306f\u3042\u308b\u3002\nfromdb\u304c\u5229\u7528\u3057\u3066\u3044\u308bpackages/oil/classes/generate.php\u306emodel\u306e\u51e6\u7406\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u5b9a\u3059\u308b\u969b\u306b\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3068\u30cf\u30a4\u30d5\u30f3\u3092directory separator\u306b\u7f6e\u63db\u3059\u308b\u305f\u3081\u3001\u524d\u8ff0\u306e\u3088\u3046\u306a\u72b6\u614b\u3068\u306a\u308b\u3002\ngenerate.php\u3082fromdb.php\u3082\u4fee\u6b63\u3057\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067\u3001fromdb\u3092\u5143\u306b\u3057\u305ffromdbunderscore\u3092\u4f5c\u6210\u3057\u305f\u3002\n\n\u30b3\u30fc\u30c9\n\u4f7f\u7528\u65b9\u6cd5\u306f\u57fa\u672c\u7684\u306bfromdb\u3068\u540c\u3058\u3067\u3059\uff08\u30d8\u30eb\u30d7\u5909\u66f4\u3057\u3066\u3044\u307e\u305b\u3093...\uff09\n\n\n--singular\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3002\n\n--crud\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3002\n\n-us-model-dir'\u3067fuel/app/classes/model`\u306e\u4e0b\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u6307\u5b9a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\n-us-base-model\u3067\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\u52d5\u4f5c\u672a\u691c\u8a3c\u306a\u306e\u3067-no-migration\u3092\u5fc5\u305a\u6307\u5b9a\u3059\u308b\u4e8b\u3002\n\n\nfuel/app/tasks/fromdbunderscore.php\n<?php\n\nnamespace Fuel\\Tasks;\n\nrequire_once(PKGPATH . 'oil/tasks/fromdb.php');\n\nclass Fromdbunderscore extends Fromdb\n{\n  const ORIGINAL_PARENT_CLASS_NAME  = '\\Orm\\Model';\n\n  private static $_model_dir = '';\n  private static $_parent_class_name = '';\n\n  public static function crud($tables = '')\n  {\n    \\Cli::write('fromdbunderscore does not support crud.', 'red');\n    exit();\n  }\n\n  public static function model($tables = '')\n  {\n    // do we have any tables defined?\n    if (empty($tables))\n    {\n      // do we want to generate for all tables?\n      if ( ! \\Cli::option('all', false))\n      {\n        \\Cli::write('No table names specified to generate a model on.', 'red');\n        exit();\n      }\n\n      // get the list of all available tables\n      try\n      {\n        $list = \\DB::list_tables(null, \\Cli::option('db', null));\n      }\n      catch (\\FuelException $e)\n      {\n        \\Cli::write('The database driver configured does not support listing tables. Please specify them manually.', 'red');\n        exit();\n      }\n\n      $prefix = \\DB::table_prefix();\n      $migration = \\Config::get('migrations.table', 'migration');\n\n      $tables = array();\n\n      // create the table list\n      foreach ($list as $table)\n      {\n        // strip any defined table prefix from the table name\n        if ( ! empty($prefix) and strpos($table, $prefix) === 0)\n        {\n          $table = substr($table, strlen($prefix));\n        }\n\n        // skip the migration table\n        $table == $migration or $tables[] = $table;\n      }\n    }\n\n    // make sure we have an array to work with\n    is_array($tables) or $tables = explode(',', $tables);\n\n    static::_preprocess_for_generate();\n\n    // generate for each table defined\n    foreach ($tables as $table)\n    {\n      static::generate_model_under_score($table);\n    }\n  }\n\n  protected static function _preprocess_for_generate()\n  {\n    if(empty(\\Cli::option('singular', ''))){\n      \\Cli::write('You must specify the -singular option.', 'red');\n      exit();\n    }\n\n    static::$_model_dir = \\Cli::option('us-model-dir', '');\n\n    static::$_parent_class_name = empty(\\Cli::option('us-base-model', '')) ?\n      static::ORIGINAL_PARENT_CLASS_NAME : \\Cli::option('us-base-model');\n  }\n\n  protected static function generate_model_under_score($table)\n  {\n    // start with an empty list\n    \\Oil\\Generate::$create_files = array();\n\n    $args = static::arguments($table);\n\n    // underscores are erased from table name\n    $table_name_which_has_not_underscores = str_replace('_', '', $args[0]);\n    $args[0] = $table_name_which_has_not_underscores;\n\n    // and generate, but doesn't create a file.\n    call_user_func('Oil\\Generate::model', $args, false);\n\n    $filename = \\Oil\\Generate::$create_files[0]['path'];\n\n    // restore a table name in generated content\n    $search = array(sprintf('$_table_name = \\'%s\\'', $table_name_which_has_not_underscores));\n    $replace = array(sprintf('$_table_name = \\'%s\\'', $table));\n\n    // normalize a class name in generated content\n    $search[] = sprintf('Model_%s', ucfirst($table_name_which_has_not_underscores));\n    $replace[] = sprintf('Model_%s', ucfirst(\\Inflector::camelize($table)));\n\n    // replace parent class name if neededed\n    if(!empty(static::$_parent_class_name)){\n      $search[] = static::ORIGINAL_PARENT_CLASS_NAME;\n      $replace[] = static::$_parent_class_name;\n    }\n\n    $contents = str_replace($search, $replace, \\Oil\\Generate::$create_files[0]['contents']);\n\n    $type = \\Oil\\Generate::$create_files[0]['type'];\n\n    $model_dir = empty(static::$_model_dir) ?\n      dirname($filename) : sprintf('%s/%s', dirname($filename), static::$_model_dir);\n    is_dir($model_dir) or mkdir($model_dir, 0755, TRUE);\n\n    $filename = sprintf('%s/%s', $model_dir, basename($filename));\n\n    // easy way\n    \\Cli::write(\"\\tCreating $type: $filename\", 'green');\n    @file_put_contents($filename, $contents);\n    @chmod($filename, 0666);\n  }\n}\n\n\n\n## \u8a18\u4e8b\u3092\u66f8\u304f\u304d\u3063\u304b\u3051\n\n\u8868\u984c\u306e\u901a\u308a\u3067\u3001\u4f8b\u3048\u3070fizz_buzz_fizzbuzz\u3068\u3044\u3046\u540d\u524d\u306e\u30c6\u30fc\u30d6\u30eb\u306emodel\u3092` fromdb`\u3067\u751f\u6210\u3059\u308b\u3068\u3001` fuel/app/classes/model/fizz/buzz/fizzbuzz.php`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3001\u30af\u30e9\u30b9\u540d\u306f` Model_Fizz_Buzz_Fizzbuzz`\u3068\u306a\u308b\u3002\n\n\u3053\u308c\u3092\u3001` fuel/app/classes/model/fizzbuzzfizzbuzz.php`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3001\u30af\u30e9\u30b9\u540d\u306f` Model_Fizzbuzzfizzbuzz`\u3068\u306a\u308b\u3088\u3046\u306b\u3057\u305f\u304b\u3063\u305f\u3002\n\n## \u5bfe\u5fdc\u306b\u3042\u305f\u3063\u3066\n\n\u540c\u3058\u4e8b\u3067\u60a9\u3093\u3060\u65b9\u3067\u3001\u751f\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092` mv`\u3057\u3066` rm`\u3057\u3066` bootstrap.php`\u3067` Autoloader::add_classes`\u3059\u308b\u89e3\u6c7a\u7b56\u304c\u3042\u3063\u305f\u304c\u3001` fromdb`\u306e\u4fbf\u5229\u3055\u3092\u4eab\u53d7\u3057\u305f\u304b\u3063\u305f\u305f\u3081\u3001\u3053\u306e\u65b9\u6cd5\u306f\u898b\u9001\u3063\u305f\u3002FuelPHP\u306a\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3092\u4f7f\u7528\u3057\u305f\u304f\u306a\u304b\u3063\u305f\u3001\u3068\u3044\u3046\u306e\u3082\u898b\u9001\u3063\u305f\u4e8b\u306e\u9060\u56e0\u3067\u306f\u3042\u308b\u3002\n\n` fromdb`\u304c\u5229\u7528\u3057\u3066\u3044\u308b` packages/oil/classes/generate.php`\u306e` model`\u306e\u51e6\u7406\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u6c7a\u5b9a\u3059\u308b\u969b\u306b\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3068\u30cf\u30a4\u30d5\u30f3\u3092directory separator\u306b\u7f6e\u63db\u3059\u308b\u305f\u3081\u3001\u524d\u8ff0\u306e\u3088\u3046\u306a\u72b6\u614b\u3068\u306a\u308b\u3002\n\n` generate.php`\u3082` fromdb.php`\u3082\u4fee\u6b63\u3057\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067\u3001` fromdb`\u3092\u5143\u306b\u3057\u305f` fromdbunderscore`\u3092\u4f5c\u6210\u3057\u305f\u3002\n\n## \u30b3\u30fc\u30c9\n\n_\u4f7f\u7528\u65b9\u6cd5\u306f\u57fa\u672c\u7684\u306bfromdb\u3068\u540c\u3058\u3067\u3059\uff08\u30d8\u30eb\u30d7\u5909\u66f4\u3057\u3066\u3044\u307e\u305b\u3093...\uff09_\n\n1. ` --singular`\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3002\n1. ` --crud`\u304c\u6307\u5b9a\u3055\u308c\u305f\u5834\u5408\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3002\n1. ` -us-model-dir'\u3067``` fuel/app/classes/model```\u306e\u4e0b\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u6307\u5b9a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n1. ` -us-base-model`\u3067\u57fa\u5e95\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n1. \u52d5\u4f5c\u672a\u691c\u8a3c\u306a\u306e\u3067` -no-migration`\u3092\u5fc5\u305a\u6307\u5b9a\u3059\u308b\u4e8b\u3002\n\n```php:fuel/app/tasks/fromdbunderscore.php\n<?php\n\nnamespace Fuel\\Tasks;\n\nrequire_once(PKGPATH . 'oil/tasks/fromdb.php');\n\nclass Fromdbunderscore extends Fromdb\n{\n  const ORIGINAL_PARENT_CLASS_NAME  = '\\Orm\\Model';\n\n  private static $_model_dir = '';\n  private static $_parent_class_name = '';\n\n  public static function crud($tables = '')\n  {\n    \\Cli::write('fromdbunderscore does not support crud.', 'red');\n    exit();\n  }\n\n  public static function model($tables = '')\n  {\n    // do we have any tables defined?\n    if (empty($tables))\n    {\n      // do we want to generate for all tables?\n      if ( ! \\Cli::option('all', false))\n      {\n        \\Cli::write('No table names specified to generate a model on.', 'red');\n        exit();\n      }\n\n      // get the list of all available tables\n      try\n      {\n        $list = \\DB::list_tables(null, \\Cli::option('db', null));\n      }\n      catch (\\FuelException $e)\n      {\n        \\Cli::write('The database driver configured does not support listing tables. Please specify them manually.', 'red');\n        exit();\n      }\n\n      $prefix = \\DB::table_prefix();\n      $migration = \\Config::get('migrations.table', 'migration');\n\n      $tables = array();\n\n      // create the table list\n      foreach ($list as $table)\n      {\n        // strip any defined table prefix from the table name\n        if ( ! empty($prefix) and strpos($table, $prefix) === 0)\n        {\n          $table = substr($table, strlen($prefix));\n        }\n\n        // skip the migration table\n        $table == $migration or $tables[] = $table;\n      }\n    }\n\n    // make sure we have an array to work with\n    is_array($tables) or $tables = explode(',', $tables);\n\n    static::_preprocess_for_generate();\n\n    // generate for each table defined\n    foreach ($tables as $table)\n    {\n      static::generate_model_under_score($table);\n    }\n  }\n\n  protected static function _preprocess_for_generate()\n  {\n    if(empty(\\Cli::option('singular', ''))){\n      \\Cli::write('You must specify the -singular option.', 'red');\n      exit();\n    }\n\n    static::$_model_dir = \\Cli::option('us-model-dir', '');\n\n    static::$_parent_class_name = empty(\\Cli::option('us-base-model', '')) ?\n      static::ORIGINAL_PARENT_CLASS_NAME : \\Cli::option('us-base-model');\n  }\n\n  protected static function generate_model_under_score($table)\n  {\n    // start with an empty list\n    \\Oil\\Generate::$create_files = array();\n\n    $args = static::arguments($table);\n\n    // underscores are erased from table name\n    $table_name_which_has_not_underscores = str_replace('_', '', $args[0]);\n    $args[0] = $table_name_which_has_not_underscores;\n\n    // and generate, but doesn't create a file.\n    call_user_func('Oil\\Generate::model', $args, false);\n\n    $filename = \\Oil\\Generate::$create_files[0]['path'];\n\n    // restore a table name in generated content\n    $search = array(sprintf('$_table_name = \\'%s\\'', $table_name_which_has_not_underscores));\n    $replace = array(sprintf('$_table_name = \\'%s\\'', $table));\n\n    // normalize a class name in generated content\n    $search[] = sprintf('Model_%s', ucfirst($table_name_which_has_not_underscores));\n    $replace[] = sprintf('Model_%s', ucfirst(\\Inflector::camelize($table)));\n\n    // replace parent class name if neededed\n    if(!empty(static::$_parent_class_name)){\n      $search[] = static::ORIGINAL_PARENT_CLASS_NAME;\n      $replace[] = static::$_parent_class_name;\n    }\n\n    $contents = str_replace($search, $replace, \\Oil\\Generate::$create_files[0]['contents']);\n\n    $type = \\Oil\\Generate::$create_files[0]['type'];\n\n    $model_dir = empty(static::$_model_dir) ?\n      dirname($filename) : sprintf('%s/%s', dirname($filename), static::$_model_dir);\n    is_dir($model_dir) or mkdir($model_dir, 0755, TRUE);\n\n    $filename = sprintf('%s/%s', $model_dir, basename($filename));\n\n    // easy way\n    \\Cli::write(\"\\tCreating $type: $filename\", 'green');\n    @file_put_contents($filename, $contents);\n    @chmod($filename, 0666);\n  }\n}\n```\n", "tags": ["FuelPHP", "fromdb", "\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2"]}