{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nZabbix Advent Calendar 2015 6\u65e5\u76ee\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\nZabbix\u521d\u7d1a\u8005\uff08\u81ea\u5206\u3082\u3053\u306e\u57df\u3068\u601d\u3063\u3066\u307e\u3059\uff09\u304b\u3089\u6d3b\u7528\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\n\n\u8907\u6570\u53f0\u306e\uff08Web\uff09\u30b5\u30fc\u30d0\u30fc\u304b\u3089NFS\u3067\u5171\u6709\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08\u5b9f\u4f53\u304c\u5225\u306e\u30b5\u30fc\u30d0\u30fc\uff09\u304c\u3042\u308a\u3001\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b58\u5728\u304c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u91cd\u8981\u3067\u3042\u308b\u30b1\u30fc\u30b9\n\n\n\u524d\u63d0\n\nWeb\u30b5\u30fc\u30d0\u30fc\u30fbNFS\u30b5\u30fc\u30d0\u30fc\u3068\u3082OS\u306fLinux\nZabbix Server\u30fbAgent \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\uff08\u304a\u305d\u3089\u304f\u65e2\u5b58\u5168\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u5229\u7528\u3067\u304d\u308b\uff09\n\n\n\u76e3\u8996\u3055\u308c\u308b\u5074\uff08mount\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a [UserParameter]\n\n\u521d\u671f\u72b6\u614b\n[root@server ~]# df\nFilesystem                  1K-blocks      Used Available Use% Mounted on\n/dev/mapper/centos-root       8775680   1778724   6996956  21% /\n\u30fb\u30fb\u30fb\nnone                        479525884 148412768 331113116  31% /vagrant\n192.168.33.97:/exports/data   8775680   1114112   7661568  13% /mnt/data\n\n\nzabbix_agentd.conf \u306b UserParameter \u3092\u8ffd\u8a18\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u3067\uff08\u30b3\u30de\u30f3\u30c9\u3067\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3001$ \u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u70b9\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3002vi \u7b49\u3067\u300c\u624b\u66f8\u304d\u300d\u3059\u308b\u3068\u304d\u306f \\ \u4e0d\u8981\uff09\necho \"UserParameter=vfs.directory.exists[*],if [ -d \\$1 ]; then echo 1; else echo 0; fi\" >> /etc/zabbix/zabbix_agentd.conf\n\n\nzabbix-agent \u518d\u8d77\u52d5\nsystemctl restart zabbix-agent\n\n\nZabbix Server \u5074\u306e\u8a2d\u5b9a\uff08\u30a2\u30a4\u30c6\u30e0\u30fb\u30c8\u30ea\u30ac\u30fc\uff09\nWeb UI \u3067 Item \u3068 Trigger \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nItem\n\n\u59a5\u5f53\u306a Name \u3092\u8a2d\u5b9a\n\n\n\u4f8b\uff09Check mount_directory_access\n\n\nKey \u306b UserParameter \u3067\u8ffd\u8a18\u3057\u305f vfs.directory.exists \u3092\u5229\u7528\u3057\u305f\u5b9a\u7fa9\u3092\u8a2d\u5b9a\n\n\n\u4f8b\uff09vfs.directory.exists[/mnt/data/sample]\n\n\n\n\n\nTrigger\n\n\u59a5\u5f53\u306a Name \u3092\u8a2d\u5b9a\n\n\n\u4f8b\uff09Failed mount_directory_access (/mnt/data/sample)\n\n\nExpression \u306b \u8ffd\u52a0\u3057\u305f Item \u3092\u9078\u629e\n\n\n\u4f8b\uff09{[mountingHost]:vfs.directory.exists[/mnt/data/sample].last()}=0\n\n\n\n\n\n\u30c6\u30b9\u30c8\n\n\u76e3\u8996\u5bfe\u8c61\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u307f\u308b \u2192 \u30a4\u30a4\u611f\u3058\n(NFS\u30b5\u30fc\u30d0\u30fc\u5074)\n\n[root@target ~]# exportfs -v\n/exports/data   192.168.33.0/24(rw,wdelay,root_squash,all_squash,no_subtree_check,sec=sys,rw,secure,root_squash,all_squash)\n[root@target ~]# cd /exports/data\n[root@target data]# ls -la\ntotal 0\ndrwxr-xr-x 3 nfsnobody nfsnobody 19 Dec  6 00:05 .\ndrwxr-xr-x 3 root      root      17 Dec  5 15:06 ..\ndrwxrwxrwx 2 root      root       6 Dec  5 16:01 sample\n[root@target data]# mv sample sample1\n[root@target data]#\n\n\u2193\n\n\nNFS\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b \u2192 \u304a\u3084\uff1f\n[root@target data]# systemctl stop nfs-server\n\n\u2193\n\n\u671f\u5f85\u3057\u3066\u3044\u305f\u300cFailed mount_directory_access (/mnt/data/sample)\u300d\u3067\u306f\u306a\u304f\u3001\u300cNFS Procces Down\u300d\u306e Alert\u304c\u51fa\u307e\u3057\u305f\u3002\nCheck mount_directory_access \u306f\u3001\u300cNot supported\u300d\u3068\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\n\u307e\u3068\u3081\n\nmount\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b9f\u4f53\u5b58\u5728\u76e3\u8996\u3092Zabbix\u3067\u884c\u3046\u5834\u5408\uff08Linux\u7cfbOS\uff09\n\n\nUserParameter \u3092\u5229\u7528\u3057\u305f\u76e3\u8996\u30a2\u30a4\u30c6\u30e0\u8ffd\u52a0\u3067\u5b9f\u73fe\u53ef\u80fd\n\u305f\u3060\u3057\u3001NFS\u306e\u5834\u5408\u3001NFS\u30d7\u30ed\u30bb\u30b9\u81ea\u4f53\u3082\u76e3\u8996\u304c\u5fc5\u8981\n\n\n\n\n\u5099\u8003\n\nZABBIX-JP\u30d5\u30a9\u30fc\u30e9\u30e0\u300c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u306e\u30a2\u30a4\u30c6\u30e0\u8a2d\u5b9a\u300d\n\n\nhttp://www.zabbix.jp/node/1551\n\n\n\u691c\u8a3c\u6642\u53c2\u7167\u60c5\u5831\n\n\nCentOS\u306bZabbix 2.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\nhttp://eno0514.hatenadiary.jp/entry/20151104/1446563413\n\n\nCentOS7\u306bZabbix2.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nhttp://qiita.com/tukiyo3/items/e974627fbb393037fa8a\n\n\nCentOS7.1 64bit\u306eyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306bMySQL\u3092\u8ffd\u52a0\u3057\u3001\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\nhttp://www.kakiro-web.com/linux/mysql-yum-repository-install.html\n\n\nCentOS7\u3067zabbix-server-mysql\u304c\u8d77\u52d5\u3057\u306a\u304b\u3063\u305f\u3068\u304d\u306e\u51e6\u7f6e\n\n\nhttp://sogaoh.hatenablog.com/entry/2015/12/05/225610\n\n\nNFS \u30b5\u30fc\u30d0\uff0f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\u30e1\u30e2\uff08CentOS7.1.1503\uff09\n\n\nhttps://blog.apar.jp/linux/2712/\n\n\n\n\n\n\n\u304a\u308f\u308a\u306b\nUserParameter \u306f\u975e\u5e38\u306b\u6d3b\u7528\u306e\u5e45\u304c\u5e83\u304f\u3001\u69d8\u3005\u306a\u5fdc\u7528\u304c\u53ef\u80fd\u306b\u601d\u3048\u307e\u3059\u3002\n\u6b21\u306f halchiyo \u3055\u3093\u3001\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\n[Zabbix Advent Calendar 2015](http://qiita.com/advent-calendar/2015/zabbix) 6\u65e5\u76ee\u306e\u30a8\u30f3\u30c8\u30ea\u3067\u3059\u3002\nZabbix\u521d\u7d1a\u8005\uff08\u81ea\u5206\u3082\u3053\u306e\u57df\u3068\u601d\u3063\u3066\u307e\u3059\uff09\u304b\u3089\u6d3b\u7528\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n# \u30e6\u30fc\u30b9\u30b1\u30fc\u30b9\n- \u8907\u6570\u53f0\u306e\uff08Web\uff09\u30b5\u30fc\u30d0\u30fc\u304b\u3089NFS\u3067\u5171\u6709\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08\u5b9f\u4f53\u304c\u5225\u306e\u30b5\u30fc\u30d0\u30fc\uff09\u304c\u3042\u308a\u3001\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b58\u5728\u304c\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u91cd\u8981\u3067\u3042\u308b\u30b1\u30fc\u30b9\n\n# \u524d\u63d0\n- Web\u30b5\u30fc\u30d0\u30fc\u30fbNFS\u30b5\u30fc\u30d0\u30fc\u3068\u3082OS\u306fLinux\n- Zabbix Server\u30fbAgent \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\uff08\u304a\u305d\u3089\u304f\u65e2\u5b58\u5168\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u5229\u7528\u3067\u304d\u308b\uff09\n\n# \u76e3\u8996\u3055\u308c\u308b\u5074\uff08mount\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a [UserParameter]\n## \u521d\u671f\u72b6\u614b\n```\n[root@server ~]# df\nFilesystem                  1K-blocks      Used Available Use% Mounted on\n/dev/mapper/centos-root       8775680   1778724   6996956  21% /\n\u30fb\u30fb\u30fb\nnone                        479525884 148412768 331113116  31% /vagrant\n192.168.33.97:/exports/data   8775680   1114112   7661568  13% /mnt/data\n```\n\n## zabbix_agentd.conf \u306b UserParameter \u3092\u8ffd\u8a18\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30de\u30f3\u30c9\u3067\uff08\u30b3\u30de\u30f3\u30c9\u3067\u66f8\u304d\u8fbc\u3080\u5834\u5408\u3001$ \u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u70b9\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3002vi \u7b49\u3067\u300c\u624b\u66f8\u304d\u300d\u3059\u308b\u3068\u304d\u306f \\ \u4e0d\u8981\uff09\n\n```\necho \"UserParameter=vfs.directory.exists[*],if [ -d \\$1 ]; then echo 1; else echo 0; fi\" >> /etc/zabbix/zabbix_agentd.conf\n```\n\n## zabbix-agent \u518d\u8d77\u52d5\n```\nsystemctl restart zabbix-agent\n```\n\n# Zabbix Server \u5074\u306e\u8a2d\u5b9a\uff08\u30a2\u30a4\u30c6\u30e0\u30fb\u30c8\u30ea\u30ac\u30fc\uff09\nWeb UI \u3067 Item \u3068 Trigger \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n## Item\n- \u59a5\u5f53\u306a Name \u3092\u8a2d\u5b9a\n\t- \u4f8b\uff09Check mount_directory_access\n- Key \u306b UserParameter \u3067\u8ffd\u8a18\u3057\u305f vfs.directory.exists \u3092\u5229\u7528\u3057\u305f\u5b9a\u7fa9\u3092\u8a2d\u5b9a\n\t- \u4f8b\uff09vfs.directory.exists[/mnt/data/sample]\n\n![02_item_configuration.jpg](https://qiita-image-store.s3.amazonaws.com/0/9474/fe84b78f-121d-7660-6e77-1324c3f107d8.jpeg)\n\n## Trigger\n- \u59a5\u5f53\u306a Name \u3092\u8a2d\u5b9a\n\t- \u4f8b\uff09Failed mount_directory_access (/mnt/data/sample)\n- Expression \u306b \u8ffd\u52a0\u3057\u305f Item \u3092\u9078\u629e\n\t- \u4f8b\uff09{[mountingHost]:vfs.directory.exists[/mnt/data/sample].last()}=0\n  \n![03_trriger_configuration.jpg](https://qiita-image-store.s3.amazonaws.com/0/9474/9df88de6-037d-fd19-eb34-b8885d52ea7f.jpeg)\n\n\n# \u30c6\u30b9\u30c8\n## \u76e3\u8996\u5bfe\u8c61\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u307f\u308b \u2192 \u30a4\u30a4\u611f\u3058\n\n```\n(NFS\u30b5\u30fc\u30d0\u30fc\u5074)\n\n[root@target ~]# exportfs -v\n/exports/data   192.168.33.0/24(rw,wdelay,root_squash,all_squash,no_subtree_check,sec=sys,rw,secure,root_squash,all_squash)\n[root@target ~]# cd /exports/data\n[root@target data]# ls -la\ntotal 0\ndrwxr-xr-x 3 nfsnobody nfsnobody 19 Dec  6 00:05 .\ndrwxr-xr-x 3 root      root      17 Dec  5 15:06 ..\ndrwxrwxrwx 2 root      root       6 Dec  5 16:01 sample\n[root@target data]# mv sample sample1\n[root@target data]#\n```\n\u2193\n![11_failed_mount_directory_access.jpg](https://qiita-image-store.s3.amazonaws.com/0/9474/886d04f2-64aa-c42f-7a0a-9e0c5ee3db9b.jpeg)\n\n\n## NFS\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b \u2192 \u304a\u3084\uff1f\n```\n[root@target data]# systemctl stop nfs-server\n```\n\u2193\n![12_NFS_Process_down.jpg](https://qiita-image-store.s3.amazonaws.com/0/9474/4bf37e10-e910-dd81-b328-aeca285eaeb2.jpeg)\n\n\u671f\u5f85\u3057\u3066\u3044\u305f\u300cFailed mount_directory_access (/mnt/data/sample)\u300d\u3067\u306f\u306a\u304f\u3001\u300cNFS Procces Down\u300d\u306e Alert\u304c\u51fa\u307e\u3057\u305f\u3002\n\nCheck mount_directory_access \u306f\u3001\u300cNot supported\u300d\u3068\u306a\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n![13_Not_supported_Item.jpg](https://qiita-image-store.s3.amazonaws.com/0/9474/00cb9e62-323e-52ca-cf74-77e8905d88ed.jpeg)\n\n\n\n# \u307e\u3068\u3081\n- mount\u3057\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b9f\u4f53\u5b58\u5728\u76e3\u8996\u3092Zabbix\u3067\u884c\u3046\u5834\u5408\uff08Linux\u7cfbOS\uff09\n\t- UserParameter \u3092\u5229\u7528\u3057\u305f\u76e3\u8996\u30a2\u30a4\u30c6\u30e0\u8ffd\u52a0\u3067\u5b9f\u73fe\u53ef\u80fd\n\t- \u305f\u3060\u3057\u3001NFS\u306e\u5834\u5408\u3001NFS\u30d7\u30ed\u30bb\u30b9\u81ea\u4f53\u3082\u76e3\u8996\u304c\u5fc5\u8981\n\n# \u5099\u8003\n- ZABBIX-JP\u30d5\u30a9\u30fc\u30e9\u30e0\u300c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\u306e\u30a2\u30a4\u30c6\u30e0\u8a2d\u5b9a\u300d\n\t- http://www.zabbix.jp/node/1551\n- \u691c\u8a3c\u6642\u53c2\u7167\u60c5\u5831\n\t- CentOS\u306bZabbix 2.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\t\t- http://eno0514.hatenadiary.jp/entry/20151104/1446563413\n\t- CentOS7\u306bZabbix2.2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\t\t- http://qiita.com/tukiyo3/items/e974627fbb393037fa8a\n\t- CentOS7.1 64bit\u306eyum\u30ea\u30dd\u30b8\u30c8\u30ea\u306bMySQL\u3092\u8ffd\u52a0\u3057\u3001\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\t\t- http://www.kakiro-web.com/linux/mysql-yum-repository-install.html\n\t- CentOS7\u3067zabbix-server-mysql\u304c\u8d77\u52d5\u3057\u306a\u304b\u3063\u305f\u3068\u304d\u306e\u51e6\u7f6e\n\t\t- http://sogaoh.hatenablog.com/entry/2015/12/05/225610\n\t- NFS \u30b5\u30fc\u30d0\uff0f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\u30e1\u30e2\uff08CentOS7.1.1503\uff09\n\t\t- https://blog.apar.jp/linux/2712/\n\n# \u304a\u308f\u308a\u306b\nUserParameter \u306f\u975e\u5e38\u306b\u6d3b\u7528\u306e\u5e45\u304c\u5e83\u304f\u3001\u69d8\u3005\u306a\u5fdc\u7528\u304c\u53ef\u80fd\u306b\u601d\u3048\u307e\u3059\u3002\n\n\u6b21\u306f halchiyo \u3055\u3093\u3001\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n", "tags": ["zabbix", "Linux"]}