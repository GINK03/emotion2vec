{"context": "\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\uff0859\u4e07\u7d4c\u8def\uff09\u3092VyOS\u306bGoBGP\u7d4c\u7531\u3067\u6ce8\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002VyOS\u3068GoBGP\u9593\u3067BGP\u30d4\u30a2\u3092\u5f35\u308a\u3001GoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u3001GoBGP\u304b\u3089VyOS\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u5e83\u5831\u3057\u307e\u3057\u305f\u3002\n\u672c\u8a18\u4e8b\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u3067\u6ce8\u5165\u3057\u3066\u307f\u305f\u306e\u7d9a\u304d\u3067\u3059\u3002GoBGP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\u65b9\u6cd5\u306f\u5272\u611b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u524d\u56de\u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u95a2\u9023\u6295\u7a3f\n\u305d\u306e1\uff1a\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u3067\u6ce8\u5165\u3057\u3066\u307f\u305f\n\u305d\u306e2\uff1a\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u304b\u3089VyOS\u306b\u6ce8\u5165\u3057\u3066\u307f\u305f\uff08\u672c\u8a18\u4e8b\uff09\n\n\u306f\u3058\u3081\u306b\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3068\u622f\u308c\u305f\u304f\u3066\u3001\u81ea\u5b85\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u53d6\u308a\u6271\u3046\u65b9\u6cd5\u3092\u63a2\u3057\u3066\u3001\u8a18\u4e8b\u3068\u3057\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\nVyOS\u306b\u306f\u76f4\u63a5MRT\u30c7\u30fc\u30bf\u3092\u6ce8\u5165\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u9ad8\u901f\u306aGoBGP\u3057\u3066\u6ce8\u5165\u30fb\u5e83\u5831\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u56f3. \u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\u30fb\u5e83\u5831\n\n\u74b0\u5883\nBGP\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u6ce8\u5165\u306f\u4e0b\u8a18\u306e\u74b0\u5883\u3067\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\nIntel NUC, NUC5i5RY\uff08Core i5-5250U\uff09\nOracle VM VirtualBox 5.0.18\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\uff1agobgp\uff08xenial1\uff09\u30db\u30b9\u30c8\u306b\u30e1\u30e2\u30ea4GB\u5272\u5f53\uff08gobgpd\u3067\u7d50\u69cb\u30e1\u30e2\u30ea\u4f7f\u3044\u307e\u3059\uff09\n\u4eee\u60f3\u30de\u30b7\u30f3\uff1avyos\uff08helium1\uff09\u30db\u30b9\u30c8\u306b\u30e1\u30e2\u30ea2GB\u5272\u5f53\n\u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c81\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u307e\u3059\n\n\ngobgp\uff08xenial1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\n\n\nUbuntu 16.04 LTS\uff08ubuntu-16.04-server-amd64.iso\uff09\n\nGolang 1.6\n\nGoBGP v1.6\nIP\u30a2\u30c9\u30ec\u30b9\uff1a192.168.88.121/24\nBGP AS\u756a\u53f7\uff1aAS65121\n\n\nvyos\uff08helium1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\n\n\n\nVyOS (helium) 1.1.7\uff08vyos-1.1.7-amd64.iso\uff09\nIP\u30a2\u30c9\u30ec\u30b9\uff1a192.168.88.122/24\nBGP AS\u756a\u53f7\uff1aAS65122\n\n\n\n\n\u56f3. vyos\uff08helium1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\u306e\u8a2d\u5b9a\n\nVyOS\u306e\u8a2d\u5b9a\nVyOS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f\u30e6\u30fc\u30b6\u30fc\u30ac\u30fc\u30c9 - VyOS jp\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306finstall system\u3067\u5185\u8535\u30c7\u30a3\u30b9\u30af\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u901a\u308a\u3001IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u3068BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n# VyOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\nvyos@vyos:~$ show version\nVersion:      VyOS 1.1.7\nDescription:  VyOS 1.1.7 (helium)\nCopyright:    2016 VyOS maintainers and contributors\nBuilt by:     maintainers@vyos.net\nBuilt on:     Wed Feb 17 09:57:31 UTC 2016\nBuild ID:     1602170957-4459750\nSystem type:  x86 64-bit\nBoot via:     image\nHypervisor:   KVM\nHW model:     VirtualBox\nHW S/N:       0\nHW UUID:      5A0EB465-F756-40D7-919A-F804911A72F7\nUptime:       07:57:21 up 10 min,  2 users,  load average: 0.00, 0.02, 0.02\n\n# \u8a2d\u5b9a\u30e2\u30fc\u30c9\nvyos@vyos:~$ configure\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3068SSH\u306e\u8a2d\u5b9a\nvyos@vyos# set interfaces ethernet eth0 address 192.168.88.122/24\nvyos@vyos# set service ssh\n\n# BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyos@vyos# set protocols bgp 65122 parameters router-id 192.168.88.122\nvyos@vyos# set protocols bgp 65122 neighbor 192.168.88.121 remote-as 65121\nvyos@vyos# set protocols bgp 65122 neighbor 192.168.88.121 soft-reconfiguration inbound\n\n# \u8a2d\u5b9a\u53cd\u6620\nvyos@vyos# commit\nvyos@vyos# save\nvyos@vyos# exit\n\n\nGoBGP\u306e\u8a2d\u5b9a\n\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u3001vyos\u3068BGP\u30d4\u30a2\u3092\u5f35\u308b\u8a2d\u5b9a\u3067\u3001GoBGP\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n# IP\u30a2\u30c9\u30ec\u30b9\u306e\u5909\u66f4\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d\u306fenp0s3\nkooshin@gobgp:~$ sudo ifdown enp0s3\nkooshin@gobgp:~$ sudo -H vi /etc/network/interfaces\nauto enp0s3\niface enp0s3 inet static\n    address 192.168.88.121\n    netmask 255.255.255.0\n    gateway 192.168.88.1\n    dns-nameserver 192.168.88.1\nkooshin@gobgp:~$ sudo ifup enp0s3\n\n# GoBGP\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nkooshin@gobgp:~$ cat <<EOF > gobgpd.conf\n[global.config]\n  as = 65121\n  router-id = \"192.168.88.121\"\n\n[[neighbors]]\n[neighbors.config]\n  neighbor-address = \"192.168.88.122\"\n  peer-as = 65122\nEOF\n\n# GoBGP\u306e\u8d77\u52d5\nkooshin@gobgp:~$ sudo $HOME/go/bin/gobgpd -f gobgpd.conf\n{\"level\":\"info\",\"msg\":\"gobgpd started\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"finished reading the config file\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"Peer 192.168.88.122 is added\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"Add a peer configuration for 192.168.88.122\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"Key\":\"192.168.88.122\",\"State\":\"BGP_FSM_OPENCONFIRM\",\"Topic\":\"Peer\",\"level\":\"info\",\"msg\":\"Peer Up\",\"time\":\"2016-05-03T17:09:02+09:00\"}\n\n\n\nGoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\n\u524d\u56de\u306e\u8a18\u4e8b\u3068\u540c\u69d8\u306e\u65b9\u6cd5\u3067\u3001GoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fvyos - gobgp\u9593\u3067BGP\u30d4\u30a2\u3092\u5f35\u3063\u305f\u72b6\u614b\u306e\u305f\u3081\u30012\u500d\u306e180\u79d2\u7a0b\u5ea6\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\nkooshin@gobgp:~$ time gobgp mrt inject global rib.20160502.1400\n\nreal    2m37.165s\nuser    0m13.076s\nsys     0m4.696s\n\n\nVyOS\u306e\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306e\u8a2d\u5b9a\nGoBGP\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u7d42\u308f\u3063\u3066\u3001VyOS\u3067show ip bgp summary\u3092\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3068\u306a\u308a\u307e\u3059\u3002\nMsgRcvd\u5217\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u30d5\u30eb\u30eb\u30fc\u30c8\u306b\u8fd1\u304459\u4e07\u7d4c\u8def\uff08\u30e1\u30c3\u30bb\u30fc\u30b8\uff09\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001State/PfxRcd\u5217\u3092\u78ba\u8a8d\u3059\u308b\u30680\u3068\u306a\u308a\u307e\u3059\u3002\n\u539f\u56e0\u306f\u3001GoBGP\u304b\u3089\u7d4c\u8def\u5e83\u5831\u3059\u308b\u969b\u306b\u3001\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u304cMRT\u30c7\u30fc\u30bf\u306e\u307e\u307e\u5e83\u5831\u3055\u308c\u308b\u305f\u3081\u3067\u3059\u3002VyOS\u3067\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306b\u5230\u9054\u3067\u304d\u306a\u3044\u3068\u5224\u65ad\u3055\u308c\u3001VyOS\u306eBGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u539f\u56e0\u3067\u3059\u3002\nvyos@vyos:~$ show ip bgp summary \nBGP router identifier 192.168.88.122, local AS number 65122\nIPv4 Unicast - max multipaths: ebgp 1 ibgp 1\nRIB entries 1081447, using 99 MiB of memory\nPeers 1, using 4560 bytes of memory\n\nNeighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n192.168.88.121  4 65121  590583\u2605    28        0    0    0 00:10:50        0\u2605\n\nTotal number of neighbors 1\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306b\u5230\u9054\u3067\u304d\u306a\u3044\u305f\u3081\u3001BGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306fVyOS\u3067\u30c0\u30df\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9202.248.2.1/24\u3092\u5272\u5f53\u3001\u5230\u9054\u3067\u304d\u308b\u3088\u3046\u306b\u898b\u305b\u304b\u3051\u307e\u3059\u3002\n\u30c0\u30df\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3082BGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u306a\u3044\u305f\u3081\u3001BGP\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n# \u30c0\u30df\u30fc\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u5f53\nvyos@vyos:~$ configure\nvyos@vyos# set interfaces dummy dum1 address 202.249.2.1/24\nvyos@vyos# commit\nvyos@vyos# exit\n\n## BGP\u306e\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\nvyos@vyos:~$ reset ip bgp 192.168.88.121 soft in \nvyos@vyos:~$ show ip bgp summary \nBGP router identifier 192.168.88.122, local AS number 65122\nIPv4 Unicast - max multipaths: ebgp 1 ibgp 1\nRIB entries 1081447, using 99 MiB of memory\nPeers 1, using 4560 bytes of memory\n\nNeighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n192.168.88.121  4 65121  590584      29        0    0    0 00:11:11   590558\u2605\n\nTotal number of neighbors 1\n\n\n\u5b9f\u884c\u7d50\u679c\nGoBGP\u3067\u306f\u78ba\u8a8d\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u304c\u9650\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001VyOS\u3067\u306f\u5404\u7a2e\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u7d4c\u8def\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n# BGP\u30c6\u30fc\u30d6\u30eb\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u309220\u884c\u8868\u793a\nvyos@vyos:~$ show ip bgp | head -n20\nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 1.0.4.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 i\n*> 1.0.5.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 i\n*> 1.0.6.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 56203 56203 i\n*> 1.0.38.0/24      202.249.2.169                          0 65121 2497 10026 24155 i\n*> 1.0.64.0/18      202.249.2.169                          0 65121 2497 7670 7670 7670 18144 i\n*> 1.0.128.0/17     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/18     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/19     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/24     202.249.2.169                          0 65121 2497 38040 9737 23969 i\n*> 1.0.129.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.139.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.142.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.144.0/20     202.249.2.169                          0 65121 2497 38040 9737 23969 i\n*> 1.0.160.0/19     202.249.2.169                          0 65121 2497 38040 9737 i\n\n# RIB\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u309220\u884c\u8868\u793a\nvyos@vyos:~$ show ip route | head -n20\nCodes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,\n       I - ISIS, B - BGP, > - selected route, * - FIB route\n\nB>* 1.0.4.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.5.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.6.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.38.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.64.0/18 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/17 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/18 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/19 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.129.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.139.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.142.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.144.0/20 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.160.0/19 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.160.0/21 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.168.0/21 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.176.0/20 [20/0] via 202.249.2.169, dum1, 00:06:35\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092RIB\u3067\u78ba\u8a8d\nvyos@vyos:~$ show ip route 8.8.8.8\nRouting entry for 8.8.8.0/24\n  Known via \"bgp\", distance 20, metric 0, best\n  Last update 00:16:21 ago\n  * 202.249.2.169, via dum1\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092BGP\u30c6\u30fc\u30d6\u30eb\u3067\u78ba\u8a8d\nvyos@vyos:~$ show ip bgp 8.8.8.8\nBGP routing table entry for 8.8.8.0/24\nPaths: (1 available, best #1, table Default-IP-Routing-Table)\n  Not advertised to any peer\n  65121 2497 15169\n    202.249.2.169 from 192.168.88.121 (192.168.88.121)\n      Origin IGP, localpref 100, valid, external, best\n      Last update: Tue May  3 08:20:09 2016\n\n# Origin AS\u304cAS15169\u309210\u884c\u3060\u3051\u8868\u793a\nvyos@vyos:~$ show ip bgp regexp _15169$ | head \nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 8.8.4.0/24       202.249.2.169                          0 65121 2497 15169 i\n*> 8.8.8.0/24       202.249.2.169                          0 65121 2497 15169 i\n*> 8.34.208.0/21    202.249.2.169                          0 65121 2497 15169 i\n*> 8.34.216.0/21    202.249.2.169                          0 65121 2497 15169 i\n\n# Origin AS\u304cAS2510\u309210\u884c\u3060\u3051\u8868\u793a\nvyos@vyos:~$ show ip bgp regexp _2510$ | head \nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 58.0.0.0/15      202.249.2.169                          0 65121 2497 2510 i\n*> 61.121.0.0/17    202.249.2.169                          0 65121 2497 2510 i\n*> 61.124.0.0/16    202.249.2.169                          0 65121 2497 2510 i\n*> 61.210.0.0/16    202.249.2.169                          0 65121 2497 2510 i\n\n\nVyOS\u306e\u30e1\u30e2\u30ea\u6d88\u8cbb\nVyOS\u306f\u5168\u4f53\u3068\u3057\u3066820MB\u7a0b\u5ea6\u3092\u6d88\u8cbb\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u3001bgpd\u304c314MB\u3001zebra\u304c199M\u3092\u6d88\u8cbb\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u56f3. VyOS\u4e0a\u306etop\u753b\u9762\n\n\u304a\u308f\u308a\u306b\n\u4eca\u56de\u306fGoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u3001GoBGP\u304b\u3089VyOS\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u5e83\u5831\u3057\u307e\u3057\u305f\u3002\nVyOS\u30671\u30d4\u30a2\u304b\u3089\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408\u306b\u5fc5\u8981\u306a\u30e1\u30e2\u30ea\u306f1GB\u7a0b\u5ea6\u3042\u308c\u3070\u826f\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u4ed8\u9332\n\nGoBGP\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\n[global.config]\n  as = 65121\n  router-id = \"192.168.88.121\"\n\n[[neighbors]]\n[neighbors.config]\n  neighbor-address = \"192.168.88.122\"\n  peer-as = 65122\n\n\nVyOS\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\nvyos@vyos:~$ show configuration \ninterfaces {\n    dummy dum1 {\n        address 202.249.2.1/24\n    }\n    ethernet eth0 {\n        address 192.168.88.122/24\n        hw-id 08:00:27:59:cb:85\n    }\n    loopback lo {\n    }\n}\nprotocols {\n    bgp 65122 {\n        neighbor 192.168.88.121 {\n            remote-as 65121\n            soft-reconfiguration {\n                inbound\n            }\n        }\n        parameters {\n            router-id 192.168.88.122\n        }\n    }\n}\nservice {\n    ssh {\n    }\n}\nsystem {\n    config-management {\n        commit-revisions 20\n    }\n    console {\n        device ttyS0 {\n            speed 9600\n        }\n    }\n    login {\n        user vyos {\n            authentication {\n                encrypted-password ****************\n                plaintext-password ****************\n            }\n            level admin\n        }\n    }\n    ntp {\n        server 0.pool.ntp.org {\n        }\n        server 1.pool.ntp.org {\n        }\n        server 2.pool.ntp.org {\n        }\n    }\n    package {\n        repository community {\n            components main\n            distribution helium\n            url http://packages.vyos.net/vyos\n        }\n    }\n    syslog {\n        global {\n            facility all {\n                level notice\n            }\n            facility protocols {\n                level debug\n            }\n        }\n    }\n}\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\uff0859\u4e07\u7d4c\u8def\uff09\u3092VyOS\u306bGoBGP\u7d4c\u7531\u3067\u6ce8\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002VyOS\u3068GoBGP\u9593\u3067BGP\u30d4\u30a2\u3092\u5f35\u308a\u3001GoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u3001GoBGP\u304b\u3089VyOS\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u5e83\u5831\u3057\u307e\u3057\u305f\u3002\n\n\u672c\u8a18\u4e8b\u306f[\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u3067\u6ce8\u5165\u3057\u3066\u307f\u305f](http://qiita.com/kooshin/items/fe70c68217a0d399cefa)\u306e\u7d9a\u304d\u3067\u3059\u3002GoBGP\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\u65b9\u6cd5\u306f\u5272\u611b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001[\u524d\u56de\u306e\u8a18\u4e8b](http://qiita.com/kooshin/items/fe70c68217a0d399cefa)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u95a2\u9023\u6295\u7a3f\n\u305d\u306e1\uff1a[\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u3067\u6ce8\u5165\u3057\u3066\u307f\u305f](http://qiita.com/kooshin/items/fe70c68217a0d399cefa)\n\u305d\u306e2\uff1a[\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3092GoBGP\u304b\u3089VyOS\u306b\u6ce8\u5165\u3057\u3066\u307f\u305f](http://qiita.com/kooshin/items/103e30ad7cc7b38ce779)\uff08\u672c\u8a18\u4e8b\uff09\n\n# \u306f\u3058\u3081\u306b\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u3068\u622f\u308c\u305f\u304f\u3066\u3001\u81ea\u5b85\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u53d6\u308a\u6271\u3046\u65b9\u6cd5\u3092\u63a2\u3057\u3066\u3001\u8a18\u4e8b\u3068\u3057\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\nVyOS\u306b\u306f\u76f4\u63a5MRT\u30c7\u30fc\u30bf\u3092\u6ce8\u5165\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u9ad8\u901f\u306aGoBGP\u3057\u3066\u6ce8\u5165\u30fb\u5e83\u5831\u3057\u3066\u3044\u307e\u3059\u3002\n\n![vyos1.png](https://qiita-image-store.s3.amazonaws.com/0/12026/01730bab-b234-78dc-f3a9-a11538ecaf7a.png)\n\u56f3. \u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\u30fb\u5e83\u5831\n\n# \u74b0\u5883\nBGP\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u6ce8\u5165\u306f\u4e0b\u8a18\u306e\u74b0\u5883\u3067\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\n- Intel NUC, NUC5i5RY\uff08Core i5-5250U\uff09\n- Oracle VM VirtualBox 5.0.18\n  - \u4eee\u60f3\u30de\u30b7\u30f3\uff1agobgp\uff08xenial1\uff09\u30db\u30b9\u30c8\u306b\u30e1\u30e2\u30ea4GB\u5272\u5f53\uff08gobgpd\u3067\u7d50\u69cb\u30e1\u30e2\u30ea\u4f7f\u3044\u307e\u3059\uff09\n  - \u4eee\u60f3\u30de\u30b7\u30f3\uff1avyos\uff08helium1\uff09\u30db\u30b9\u30c8\u306b\u30e1\u30e2\u30ea2GB\u5272\u5f53\n    - \u30b7\u30ea\u30a2\u30eb\u30dd\u30fc\u30c81\u3092\u6709\u52b9\u5316\u3057\u3066\u3044\u307e\u3059\n- gobgp\uff08xenial1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\n  - Ubuntu 16.04 LTS\uff08ubuntu-16.04-server-amd64.iso\uff09\n  - [Golang](https://golang.org/) 1.6\n  - [GoBGP](http://osrg.github.io/gobgp/) v1.6\n  - IP\u30a2\u30c9\u30ec\u30b9\uff1a192.168.88.121/24\n  - BGP AS\u756a\u53f7\uff1aAS65121\n- vyos\uff08helium1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\n  - [VyOS](http://wiki.vyos-users.jp) (helium) 1.1.7\uff08vyos-1.1.7-amd64.iso\uff09\n  - IP\u30a2\u30c9\u30ec\u30b9\uff1a192.168.88.122/24\n  - BGP AS\u756a\u53f7\uff1aAS65122\n\n![Screenshot from 2016-05-03 18-50-11.png](https://qiita-image-store.s3.amazonaws.com/0/12026/f8ad1ee0-2b03-0c42-5030-1c855d1aeb6e.png)\n\u56f3. vyos\uff08helium1\u4eee\u60f3\u30de\u30b7\u30f3\uff09\u306e\u8a2d\u5b9a\n\n# VyOS\u306e\u8a2d\u5b9a\nVyOS\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306f[\u30e6\u30fc\u30b6\u30fc\u30ac\u30fc\u30c9 - VyOS jp](http://wiki.vyos-users.jp/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%82%AC%E3%82%A4%E3%83%89)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306f``install system``\u3067\u5185\u8535\u30c7\u30a3\u30b9\u30af\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u4e0b\u8a18\u306e\u901a\u308a\u3001IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u3068BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n```bash\n# VyOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\nvyos@vyos:~$ show version\nVersion:      VyOS 1.1.7\nDescription:  VyOS 1.1.7 (helium)\nCopyright:    2016 VyOS maintainers and contributors\nBuilt by:     maintainers@vyos.net\nBuilt on:     Wed Feb 17 09:57:31 UTC 2016\nBuild ID:     1602170957-4459750\nSystem type:  x86 64-bit\nBoot via:     image\nHypervisor:   KVM\nHW model:     VirtualBox\nHW S/N:       0\nHW UUID:      5A0EB465-F756-40D7-919A-F804911A72F7\nUptime:       07:57:21 up 10 min,  2 users,  load average: 0.00, 0.02, 0.02\n\n# \u8a2d\u5b9a\u30e2\u30fc\u30c9\nvyos@vyos:~$ configure\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3068SSH\u306e\u8a2d\u5b9a\nvyos@vyos# set interfaces ethernet eth0 address 192.168.88.122/24\nvyos@vyos# set service ssh\n\n# BGP\u30d4\u30a2\u306e\u8a2d\u5b9a\nvyos@vyos# set protocols bgp 65122 parameters router-id 192.168.88.122\nvyos@vyos# set protocols bgp 65122 neighbor 192.168.88.121 remote-as 65121\nvyos@vyos# set protocols bgp 65122 neighbor 192.168.88.121 soft-reconfiguration inbound\n\n# \u8a2d\u5b9a\u53cd\u6620\nvyos@vyos# commit\nvyos@vyos# save\nvyos@vyos# exit\n```\n\n# GoBGP\u306e\u8a2d\u5b9a\n\u56fa\u5b9aIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u3001vyos\u3068BGP\u30d4\u30a2\u3092\u5f35\u308b\u8a2d\u5b9a\u3067\u3001GoBGP\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n# IP\u30a2\u30c9\u30ec\u30b9\u306e\u5909\u66f4\u3001\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540d\u306fenp0s3\nkooshin@gobgp:~$ sudo ifdown enp0s3\nkooshin@gobgp:~$ sudo -H vi /etc/network/interfaces\nauto enp0s3\niface enp0s3 inet static\n\taddress 192.168.88.121\n\tnetmask 255.255.255.0\n\tgateway 192.168.88.1\n\tdns-nameserver 192.168.88.1\nkooshin@gobgp:~$ sudo ifup enp0s3\n\n# GoBGP\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\nkooshin@gobgp:~$ cat <<EOF > gobgpd.conf\n[global.config]\n  as = 65121\n  router-id = \"192.168.88.121\"\n\n[[neighbors]]\n[neighbors.config]\n  neighbor-address = \"192.168.88.122\"\n  peer-as = 65122\nEOF\n\n# GoBGP\u306e\u8d77\u52d5\nkooshin@gobgp:~$ sudo $HOME/go/bin/gobgpd -f gobgpd.conf\n{\"level\":\"info\",\"msg\":\"gobgpd started\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"finished reading the config file\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"Peer 192.168.88.122 is added\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"level\":\"info\",\"msg\":\"Add a peer configuration for 192.168.88.122\",\"time\":\"2016-05-03T17:08:47+09:00\"}\n{\"Key\":\"192.168.88.122\",\"State\":\"BGP_FSM_OPENCONFIRM\",\"Topic\":\"Peer\",\"level\":\"info\",\"msg\":\"Peer Up\",\"time\":\"2016-05-03T17:09:02+09:00\"}\n\n```\n\n# GoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u6ce8\u5165\n[\u524d\u56de\u306e\u8a18\u4e8b](http://qiita.com/kooshin/items/fe70c68217a0d399cefa)\u3068\u540c\u69d8\u306e\u65b9\u6cd5\u3067\u3001GoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fvyos - gobgp\u9593\u3067BGP\u30d4\u30a2\u3092\u5f35\u3063\u305f\u72b6\u614b\u306e\u305f\u3081\u30012\u500d\u306e180\u79d2\u7a0b\u5ea6\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash\nkooshin@gobgp:~$ time gobgp mrt inject global rib.20160502.1400\n\nreal    2m37.165s\nuser    0m13.076s\nsys     0m4.696s\n```\n\n## VyOS\u306e\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306e\u8a2d\u5b9a\nGoBGP\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u7d42\u308f\u3063\u3066\u3001VyOS\u3067``show ip bgp summary``\u3092\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3068\u304a\u308a\u3068\u306a\u308a\u307e\u3059\u3002\nMsgRcvd\u5217\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u30d5\u30eb\u30eb\u30fc\u30c8\u306b\u8fd1\u304459\u4e07\u7d4c\u8def\uff08\u30e1\u30c3\u30bb\u30fc\u30b8\uff09\u3092\u53d7\u4fe1\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u306a\u304c\u3089\u3001State/PfxRcd\u5217\u3092\u78ba\u8a8d\u3059\u308b\u30680\u3068\u306a\u308a\u307e\u3059\u3002\n\u539f\u56e0\u306f\u3001GoBGP\u304b\u3089\u7d4c\u8def\u5e83\u5831\u3059\u308b\u969b\u306b\u3001\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u304cMRT\u30c7\u30fc\u30bf\u306e\u307e\u307e\u5e83\u5831\u3055\u308c\u308b\u305f\u3081\u3067\u3059\u3002VyOS\u3067\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306b\u5230\u9054\u3067\u304d\u306a\u3044\u3068\u5224\u65ad\u3055\u308c\u3001VyOS\u306eBGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u539f\u56e0\u3067\u3059\u3002\n\n```bash\nvyos@vyos:~$ show ip bgp summary \nBGP router identifier 192.168.88.122, local AS number 65122\nIPv4 Unicast - max multipaths: ebgp 1 ibgp 1\nRIB entries 1081447, using 99 MiB of memory\nPeers 1, using 4560 bytes of memory\n\nNeighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n192.168.88.121  4 65121  590583\u2605    28        0    0    0 00:10:50        0\u2605\n\nTotal number of neighbors 1\n```\n\n\u3053\u306e\u307e\u307e\u3067\u306f\u30cd\u30af\u30b9\u30c8\u30db\u30c3\u30d7\u306b\u5230\u9054\u3067\u304d\u306a\u3044\u305f\u3081\u3001BGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u307e\u305b\u3093\u3002\n\u4eca\u56de\u306fVyOS\u3067\u30c0\u30df\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9202.248.2.1/24\u3092\u5272\u5f53\u3001\u5230\u9054\u3067\u304d\u308b\u3088\u3046\u306b\u898b\u305b\u304b\u3051\u307e\u3059\u3002\n\u30c0\u30df\u30fc\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3066\u3082BGP\u30c6\u30fc\u30d6\u30eb\u306b\u53cd\u6620\u3055\u308c\u306a\u3044\u305f\u3081\u3001BGP\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n```bash\n# \u30c0\u30df\u30fc\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u5f53\nvyos@vyos:~$ configure\nvyos@vyos# set interfaces dummy dum1 address 202.249.2.1/24\nvyos@vyos# commit\nvyos@vyos# exit\n\n## BGP\u306e\u30bd\u30d5\u30c8\u30ea\u30bb\u30c3\u30c8\nvyos@vyos:~$ reset ip bgp 192.168.88.121 soft in \nvyos@vyos:~$ show ip bgp summary \nBGP router identifier 192.168.88.122, local AS number 65122\nIPv4 Unicast - max multipaths: ebgp 1 ibgp 1\nRIB entries 1081447, using 99 MiB of memory\nPeers 1, using 4560 bytes of memory\n\nNeighbor        V    AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd\n192.168.88.121  4 65121  590584      29        0    0    0 00:11:11   590558\u2605\n\nTotal number of neighbors 1\n```\n\n# \u5b9f\u884c\u7d50\u679c\nGoBGP\u3067\u306f\u78ba\u8a8d\u3067\u304d\u308b\u30b3\u30de\u30f3\u30c9\u304c\u9650\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001VyOS\u3067\u306f\u5404\u7a2e\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30eb\u30eb\u30fc\u30c8\u306e\u7d4c\u8def\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n\n```bash\n# BGP\u30c6\u30fc\u30d6\u30eb\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u309220\u884c\u8868\u793a\nvyos@vyos:~$ show ip bgp | head -n20\nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 1.0.4.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 i\n*> 1.0.5.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 i\n*> 1.0.6.0/24       202.249.2.169                          0 65121 7500 2497 4637 1221 38803 56203 56203 56203 i\n*> 1.0.38.0/24      202.249.2.169                          0 65121 2497 10026 24155 i\n*> 1.0.64.0/18      202.249.2.169                          0 65121 2497 7670 7670 7670 18144 i\n*> 1.0.128.0/17     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/18     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/19     202.249.2.169                          0 65121 2497 38040 9737 i\n*> 1.0.128.0/24     202.249.2.169                          0 65121 2497 38040 9737 23969 i\n*> 1.0.129.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.139.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.142.0/24     202.249.2.169                          0 65121 7500 2497 38040 9737 23969 i\n*> 1.0.144.0/20     202.249.2.169                          0 65121 2497 38040 9737 23969 i\n*> 1.0.160.0/19     202.249.2.169                          0 65121 2497 38040 9737 i\n\n# RIB\u306e\u30d5\u30eb\u30eb\u30fc\u30c8\u309220\u884c\u8868\u793a\nvyos@vyos:~$ show ip route | head -n20\nCodes: K - kernel route, C - connected, S - static, R - RIP, O - OSPF,\n       I - ISIS, B - BGP, > - selected route, * - FIB route\n\nB>* 1.0.4.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.5.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.6.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.38.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.64.0/18 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/17 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/18 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/19 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.128.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.129.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.139.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.142.0/24 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.144.0/20 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.160.0/19 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.160.0/21 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.168.0/21 [20/0] via 202.249.2.169, dum1, 00:06:35\nB>* 1.0.176.0/20 [20/0] via 202.249.2.169, dum1, 00:06:35\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092RIB\u3067\u78ba\u8a8d\nvyos@vyos:~$ show ip route 8.8.8.8\nRouting entry for 8.8.8.0/24\n  Known via \"bgp\", distance 20, metric 0, best\n  Last update 00:16:21 ago\n  * 202.249.2.169, via dum1\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092BGP\u30c6\u30fc\u30d6\u30eb\u3067\u78ba\u8a8d\nvyos@vyos:~$ show ip bgp 8.8.8.8\nBGP routing table entry for 8.8.8.0/24\nPaths: (1 available, best #1, table Default-IP-Routing-Table)\n  Not advertised to any peer\n  65121 2497 15169\n    202.249.2.169 from 192.168.88.121 (192.168.88.121)\n      Origin IGP, localpref 100, valid, external, best\n      Last update: Tue May  3 08:20:09 2016\n\n# Origin AS\u304cAS15169\u309210\u884c\u3060\u3051\u8868\u793a\nvyos@vyos:~$ show ip bgp regexp _15169$ | head \nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 8.8.4.0/24       202.249.2.169                          0 65121 2497 15169 i\n*> 8.8.8.0/24       202.249.2.169                          0 65121 2497 15169 i\n*> 8.34.208.0/21    202.249.2.169                          0 65121 2497 15169 i\n*> 8.34.216.0/21    202.249.2.169                          0 65121 2497 15169 i\n\n# Origin AS\u304cAS2510\u309210\u884c\u3060\u3051\u8868\u793a\nvyos@vyos:~$ show ip bgp regexp _2510$ | head \nBGP table version is 0, local router ID is 192.168.88.122\nStatus codes: s suppressed, d damped, h history, * valid, > best, i - internal,\n              r RIB-failure, S Stale, R Removed\nOrigin codes: i - IGP, e - EGP, ? - incomplete\n\n   Network          Next Hop            Metric LocPrf Weight Path\n*> 58.0.0.0/15      202.249.2.169                          0 65121 2497 2510 i\n*> 61.121.0.0/17    202.249.2.169                          0 65121 2497 2510 i\n*> 61.124.0.0/16    202.249.2.169                          0 65121 2497 2510 i\n*> 61.210.0.0/16    202.249.2.169                          0 65121 2497 2510 i\n```\n\n## VyOS\u306e\u30e1\u30e2\u30ea\u6d88\u8cbb\nVyOS\u306f\u5168\u4f53\u3068\u3057\u3066820MB\u7a0b\u5ea6\u3092\u6d88\u8cbb\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u3001bgpd\u304c314MB\u3001zebra\u304c199M\u3092\u6d88\u8cbb\u3057\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot from 2016-05-03 17-30-55.png](https://qiita-image-store.s3.amazonaws.com/0/12026/b84e2d45-3d44-8f4c-c9be-6da2add6a197.png)\n\u56f3. VyOS\u4e0a\u306etop\u753b\u9762\n\n# \u304a\u308f\u308a\u306b\n\u4eca\u56de\u306fGoBGP\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u6ce8\u5165\u3057\u3001GoBGP\u304b\u3089VyOS\u306b\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u5e83\u5831\u3057\u307e\u3057\u305f\u3002\nVyOS\u30671\u30d4\u30a2\u304b\u3089\u30d5\u30eb\u30eb\u30fc\u30c8\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408\u306b\u5fc5\u8981\u306a\u30e1\u30e2\u30ea\u306f1GB\u7a0b\u5ea6\u3042\u308c\u3070\u826f\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n# \u4ed8\u9332\n\n## GoBGP\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\n\n```toml\n[global.config]\n  as = 65121\n  router-id = \"192.168.88.121\"\n\n[[neighbors]]\n[neighbors.config]\n  neighbor-address = \"192.168.88.122\"\n  peer-as = 65122\n```\n\n## VyOS\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\n\n```bash\nvyos@vyos:~$ show configuration \ninterfaces {\n    dummy dum1 {\n        address 202.249.2.1/24\n    }\n    ethernet eth0 {\n        address 192.168.88.122/24\n        hw-id 08:00:27:59:cb:85\n    }\n    loopback lo {\n    }\n}\nprotocols {\n    bgp 65122 {\n        neighbor 192.168.88.121 {\n            remote-as 65121\n            soft-reconfiguration {\n                inbound\n            }\n        }\n        parameters {\n            router-id 192.168.88.122\n        }\n    }\n}\nservice {\n    ssh {\n    }\n}\nsystem {\n    config-management {\n        commit-revisions 20\n    }\n    console {\n        device ttyS0 {\n            speed 9600\n        }\n    }\n    login {\n        user vyos {\n            authentication {\n                encrypted-password ****************\n                plaintext-password ****************\n            }\n            level admin\n        }\n    }\n    ntp {\n        server 0.pool.ntp.org {\n        }\n        server 1.pool.ntp.org {\n        }\n        server 2.pool.ntp.org {\n        }\n    }\n    package {\n        repository community {\n            components main\n            distribution helium\n            url http://packages.vyos.net/vyos\n        }\n    }\n    syslog {\n        global {\n            facility all {\n                level notice\n            }\n            facility protocols {\n                level debug\n            }\n        }\n    }\n}\n```\n\n\n", "tags": ["Network", "GoBGP", "VyOS"]}