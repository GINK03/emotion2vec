{"context": " More than 1 year has passed since last update.OpenStack LIBERTY \u3067 DRBD Cinder Volume Driver \u4e8b\u59cb\u3081\u3001\u3067\u306f\u7c21\u5358\u306b\u5c11\u3057\u3060\u3051\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3063\u305f\u3002\u3082\u3046\u5c11\u3057\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u69cb\u6210\u306e\u30df\u30cb\u30c1\u30e5\u30a2\u3092\u4f5c\u3063\u305f\u3002\nDRBD9 \u306e\u305f\u3081\u306e Cinder Volume Driver \u306e\u3067\u304d\u308b\u7bc4\u56f2\u304c\u3060\u3044\u305f\u3044\u78ba\u8a8d\u3067\u304d\u305f\u306e\u3067\u4ee5\u4e0b\u306b\u8a18\u3059\u3002\n\n\u74b0\u5883\n\nOpenStack LIBERTY RDO allinone\n\n\nOpenStack Controller , Compute , Network\nCinder-Volume\nDRBD Primary Node\n192.168.0.3\n\n\nDRBD9 Node1\n\n\nDRBD Secondary\n192.168.0.21\nsdb(10GB), sdc(10GB) ... VG(drbdpool) for DRBD Volume\nsdd ... VG(thinvg) for ThinPoolLV\n\n\nDRBD9 Node2\n\n\nDRBD Secondary\n192.168.0.21\nsdb(10GB), sdc(10GB) ... VG(drbdpool) for DRBD Volume\nsdd ... VG(thinvg) for ThinPoolLV\n\n\n\n\n\nDRBD \u30d0\u30fc\u30b8\u30e7\u30f3\n\ndrbd-8.9.4-1.el7.x86_64\ndrbdmanage-0.50-1.noarch\n\nkmod-drbd-9.0.0_3.10.0_229.7.2-3.el7.x86_64\n\n\u7d50\u8ad6\u3068\u3057\u3066\u78ba\u8a8d\u3067\u304d\u305f\u3053\u3068\n\nCinder \u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u30fbNova\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u30a2\u30bf\u30c3\u30c1\nCinder \u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u524a\u9664\u30fbNova\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u306e\u30c7\u30bf\u30c3\u30c1\nCinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u4f5c\u6210\nCinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\nCinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u524a\u9664\n\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u5229\u7528\u6642\u306e\u6ce8\u610f\u70b9\n\n\u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30e9\u30b0\u30a4\u30f3\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001DRDB \u3068\u9023\u643a\u3059\u308b\u308f\u3051\u3060\u304c\u3001DRBD \u5074\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306e\u6761\u4ef6\u3092\u307f\u305f\u3057\u3066\u3044\u308b\u5834\u5408\u304c\u3042\u308b\u3002\u901a\u5e38\u306e LVM \u3067\u306f\u306a\u304f ThinPoolLV \u3092\u4f5c\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u308c\u306f DRBD \u304b\u3089\u307f\u308b\u3068 Storage-Plugin \u3068\u3057\u3066 ThinLV \u3092\u9069\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4f5c\u6210\u5148\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u306f\u305d\u306e\u6642\u306b\u3001DRBD Primary \u306e\u30ce\u30fc\u30c9\u3060\u3051\u3067\u3042\u308b\u3002\u30dc\u30ea\u30e5\u30fc\u30e0\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3055\u308c\u3066\u3044\u308b\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u306f\u4f5c\u6210\u3055\u308c\u306a\u3044\u3002\u305f\u3060\u3057\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u540c\u3058\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ab\u30a6\u30f3\u30c8\u3092\u6301\u3064\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u306a\u308b\u3002\u3064\u307e\u308a\u30df\u30e9\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u4f5c\u3089\u308c\u308b\u3002\n\n\u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\uff08\u3067\u304d\u3066\u304a\u304f\u3079\u304d\u4e8b\uff09\n\nCinder \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u62e1\u5f35\u6a5f\u80fd\u306b\u306f\u672a\u5bfe\u5fdc\uff08Cinder \u5074\u306f\u6210\u529f\u3068\u306a\u308b\u304c DRBD \u30dc\u30ea\u30e5\u30fc\u30e0\u5b9f\u4f53\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u306a\u3044\uff09\nCinder \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u524a\u9664\u3057\u3066\u3082\u3001DRBD \u5074\u3067\u3067\u304d\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u6d88\u3048\u308b\u304c\u3001Resource\u304c\u6d88\u3048\u306a\u3044\n\nWorkaround : drbdmanage \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u624b\u52d5\u524a\u9664\n\n\n\nCinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u524a\u9664\u3057\u3066\u3082\u3001DRBD \u5074\u3067\u3067\u304d\u305f ThinPool \u306e\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u6d88\u3048\u306a\u3044\n\nWorkaround : drbdmanage \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u624b\u52d5\u524a\u9664\n\n\n\nCinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001\u4f5c\u3063\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u540c\u671f\u304c\u30da\u30f3\u30c7\u30a3\u30f3\u30b0\u306b\u306a\u308b\n\nWorkaround : \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u6d88\u3059\u3068\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u308b\n\n\n\n\n\u305d\u306e\u4ed6\u308f\u304b\u3063\u305f\u3053\u3068\n\nCinder-Volume \u30ce\u30fc\u30c9\u3092\u5897\u3084\u3059\u3053\u3068\u3067\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u5148\u3092\u5897\u3084\u3059\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u30de\u30eb\u30c1 DRBDmanage instance\uff08DRBD\u30af\u30e9\u30b9\u30bf\u8907\u6570\u306b\u3088\u308b\u30de\u30eb\u30c1\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff09\u306f\u307e\u3060\u672a\u5bfe\u5fdc\n\ndrbdmanage modify-config \u3067\u306eStorage Plugin \u306e\u5909\u66f4\u306f\u30aa\u30f3\u30b6\u30d5\u30e9\u30a4\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002\u305f\u3060\u3057\u3001\u30ed\u30b0\u30ec\u30d9\u30eb\u306a\u3069\u306f\u30aa\u30f3\u30b6\u30d5\u30e9\u30a4\u3067\u6709\u52b9\u306b\u306a\u308b http://drbd.linbit.com/users-guide-9.0/s-dm-set-config.html\n\nWorkaround : \u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u3001\u8a2d\u5b9a\u5909\u66f4\u3057\u305f\u5f8c\u306b\u3001\u4e00\u5ea6\u4f7f\u7528\u3059\u308b\uff08\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u308b\u306a\u3069\uff09\u3053\u3068\u3067\u5909\u66f4\u304c\u6709\u52b9\u306b\u306a\u308b\n\n\nDRBD Client \u3092 Primary\uff08OpenStack Cinder-Volume \u306e\u30ce\u30fc\u30c9\uff09\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u308b\u304c Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u305f\u3042\u3068\u306b\u305d\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306f \u81ea\u52d5\u7684\u306b Primary \u30ce\u30fc\u30c9\u306b Client \u3068\u3057\u3066\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u306a\u3044\u3001\u3064\u307e\u308a DRBD Client \u3092\u60f3\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\n\n\nWorkaround : Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u5f8c\u3001\u624b\u52d5\u3067\u30a2\u30b5\u30a4\u30f3\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u30fb\u30fb\u30fb\n\n\n\n\n\u691c\u8a3c\u74b0\u5883\n\n\n\n\u30db\u30b9\u30c8\u540d\nIP\u30a2\u30c9\u30ec\u30b9\n\n\n\n\nakira.tk.net\n192.168.0.3\n\n\ndrbd9-01.tk.net\n192.168.0.21\n\n\ndrbd9-02.tk.net\n192.168.0.22\n\n\n\n\nDRBD Controller Node \u6e96\u5099\n\nDNS\u767b\u9332\n\u30ce\u30fc\u30c9\u9593\u3067SSH-KEY\u767b\u9332\n\n[root@drbd9-01 ~]# vgcreate drbdpool /dev/sdb /dev/sdc\n  Physical volume \"/dev/sdb\" successfully created\n  Physical volume \"/dev/sdc\" successfully created\n  Volume group \"drbdpool\" successfully created\n\n[root@drbd9-02 ~]# vgcreate drbdpool /dev/sdb /dev/sdc\n  Physical volume \"/dev/sdb\" successfully created\n  Physical volume \"/dev/sdc\" successfully created\n  Volume group \"drbdpool\" successfully created\n\n\n\u521d\u671f\u8a2d\u5b9a\n[root@drbd9-01 ~]# drbdmanage init 192.168.0.21\n\nYou are going to initalize a new drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Failed to find logical volume \"drbdpool/.drbdctrl_0\"\n  Failed to find logical volume \"drbdpool/.drbdctrl_1\"\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\nempty drbdmanage control volume initialized.\nempty drbdmanage control volume initialized.\nOperation completed successfully\n\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n\n[root@drbd9-01 ~]# drbdmanage add-node drbd9-02.tk.net 192.168.0.22\nOperation completed successfully\nOperation completed successfully\n\nExecuting join command using ssh.\nIMPORTANT: The output you see comes from drbd9-02.tk.net\nIMPORTANT: Your input is executed on drbd9-02.tk.net\nYou are going to join an existing drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Logical volume \".drbdctrl_0\" successfully removed\n  Logical volume \".drbdctrl_1\" successfully removed\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_0 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_1 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nOperation completed successfully\n\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n| drbd9-02.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n\n\n\u30db\u30b9\u30c8\u6e96\u5099\nOpenstack Cinder Volume \u5074 \u3082 DRBD \u30ce\u30fc\u30c9\u3068\u3057\u3066\u8ffd\u52a0\u767b\u9332\n[root@drbd9-01 ~]# drbdmanage add-node akira.tk.net 192.168.0.3\nOperation completed successfully\nOperation completed successfully\n\nExecuting join command using ssh.\nIMPORTANT: The output you see comes from akira.tk.net\nIMPORTANT: Your input is executed on akira.tk.net\nYou are going to join an existing drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Logical volume \".drbdctrl_0\" successfully removed\n  Logical volume \".drbdctrl_1\" successfully removed\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_0 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\n\nDo you want to proceed?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\nmd_offset 4190208\nal_offset 4157440\nbm_offset 4153344\n\nFound some data\n\n ==> This might destroy existing data! <==\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_1 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\n\nDo you want to proceed?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\nmd_offset 4190208\nal_offset 4157440\nbm_offset 4153344\n\nFound some data\n\n ==> This might destroy existing data! <==\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nOperation completed successfully\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| akira.tk.net    |      9992 |      9984 |  N/A |                                                   |    ok |\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n| drbd9-02.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n\n\u4ee5\u964d\u306f\nOpenStack LIBERTY \u3067 DRBD Cinder Volume Driver \u4e8b\u59cb\u3081\u3001\u3068\u540c\u69d8\u3002\n\n\n drbdmanage driver \u8a2d\u5b9a\n\n\ncinder.conf\n\u30dc\u30ea\u30e5\u30fc\u30e0\u30bf\u30a4\u30d7\u4f5c\u6210\ndbus \u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\ncinder-volume \u518d\u8d77\u52d5\n\n\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u30ed\u30b0\n\u9806\u6b21\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n\u53c2\u8003\n\nhttp://drbd.linbit.com/users-guide-9.0/\nhttps://github.com/openstack/cinder/commits/master/cinder/volume/drivers/drbdmanagedrv.py\nhttp://docs.openstack.org/liberty/config-reference/content/section_cinder.conf.html\n\n[OpenStack LIBERTY \u3067 DRBD Cinder Volume Driver \u4e8b\u59cb\u3081](http://qiita.com/tksarah/items/c6e886884f3ba5ea364e)\u3001\u3067\u306f\u7c21\u5358\u306b\u5c11\u3057\u3060\u3051\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3063\u305f\u3002\u3082\u3046\u5c11\u3057\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081**\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u69cb\u6210\u306e\u30df\u30cb\u30c1\u30e5\u30a2**\u3092\u4f5c\u3063\u305f\u3002\nDRBD9 \u306e\u305f\u3081\u306e Cinder Volume Driver \u306e\u3067\u304d\u308b\u7bc4\u56f2\u304c\u3060\u3044\u305f\u3044\u78ba\u8a8d\u3067\u304d\u305f\u306e\u3067\u4ee5\u4e0b\u306b\u8a18\u3059\u3002\n\n# \u74b0\u5883\n* OpenStack LIBERTY RDO allinone\n    * **OpenStack Controller , Compute , Network**\n    * Cinder-Volume\n    * **DRBD Primary Node**\n    * 192.168.0.3\n* DRBD9 Node1\n    * **DRBD Secondary**\n    * 192.168.0.21\n    * sdb(10GB), sdc(10GB) ... VG(drbdpool) for DRBD Volume\n    * sdd ... VG(thinvg) for ThinPoolLV\n* DRBD9 Node2\n    * **DRBD Secondary**\n    * 192.168.0.21\n    * sdb(10GB), sdc(10GB) ... VG(drbdpool) for DRBD Volume\n    * sdd ... VG(thinvg) for ThinPoolLV\n\n![qitta-2.jpg](https://qiita-image-store.s3.amazonaws.com/0/75458/bfac0c13-3824-9af7-93a0-46e7bcf7cb0d.jpeg)\n\n## DRBD \u30d0\u30fc\u30b8\u30e7\u30f3\n* drbd-8.9.4-1.el7.x86_64\n* drbdmanage-0.50-1.noarch\n* kmod-drbd-9.0.0_3.10.0_229.7.2-3.el7.x86_64\n# \u7d50\u8ad6\u3068\u3057\u3066\u78ba\u8a8d\u3067\u304d\u305f\u3053\u3068\n\n* Cinder \u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u30fbNova\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u30a2\u30bf\u30c3\u30c1\n* Cinder \u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u524a\u9664\u30fbNova\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u306e\u30c7\u30bf\u30c3\u30c1\n* Cinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u4f5c\u6210\n* Cinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\n* Cinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u524a\u9664\n\n## \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u5229\u7528\u6642\u306e\u6ce8\u610f\u70b9\n### \u30b9\u30c8\u30ec\u30fc\u30b8\u30d7\u30e9\u30b0\u30a4\u30f3\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001DRDB \u3068\u9023\u643a\u3059\u308b\u308f\u3051\u3060\u304c\u3001DRBD \u5074\u3067\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306e\u6761\u4ef6\u3092\u307f\u305f\u3057\u3066\u3044\u308b\u5834\u5408\u304c\u3042\u308b\u3002\u901a\u5e38\u306e LVM \u3067\u306f\u306a\u304f ThinPoolLV \u3092\u4f5c\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u308c\u306f DRBD \u304b\u3089\u307f\u308b\u3068 Storage-Plugin \u3068\u3057\u3066 ThinLV \u3092\u9069\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n###\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u4f5c\u6210\u5148\n\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u4f5c\u6210\u3055\u308c\u308b\u306e\u306f\u305d\u306e\u6642\u306b\u3001DRBD Primary \u306e\u30ce\u30fc\u30c9\u3060\u3051\u3067\u3042\u308b\u3002\u30dc\u30ea\u30e5\u30fc\u30e0\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3055\u308c\u3066\u3044\u308b\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u306f\u4f5c\u6210\u3055\u308c\u306a\u3044\u3002\u305f\u3060\u3057\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u540c\u3058\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30ab\u30a6\u30f3\u30c8\u3092\u6301\u3064\u30dc\u30ea\u30e5\u30fc\u30e0\u3068\u306a\u308b\u3002\u3064\u307e\u308a\u30df\u30e9\u30fc\u30ea\u30f3\u30b0\u3055\u308c\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u304c\u4f5c\u3089\u308c\u308b\u3002\n\n# \u3067\u304d\u306a\u304b\u3063\u305f\u3053\u3068\uff08\u3067\u304d\u3066\u304a\u304f\u3079\u304d\u4e8b\uff09\n\n* Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u62e1\u5f35\u6a5f\u80fd\u306b\u306f\u672a\u5bfe\u5fdc\uff08Cinder \u5074\u306f\u6210\u529f\u3068\u306a\u308b\u304c DRBD \u30dc\u30ea\u30e5\u30fc\u30e0\u5b9f\u4f53\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u306a\u3044\uff09\n* Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u524a\u9664\u3057\u3066\u3082\u3001DRBD \u5074\u3067\u3067\u304d\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306f\u6d88\u3048\u308b\u304c\u3001**Resource\u304c\u6d88\u3048\u306a\u3044**\n  * Workaround : drbdmanage \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u624b\u52d5\u524a\u9664\n* Cinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u524a\u9664\u3057\u3066\u3082\u3001DRBD \u5074\u3067\u3067\u304d\u305f **ThinPool \u306e\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304c\u6d88\u3048\u306a\u3044**\n  * Workaround : drbdmanage \u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u624b\u52d5\u524a\u9664\n\n* Cinder \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3059\u308b\u3068\u3001\u4f5c\u3063\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306e**\u540c\u671f\u304c\u30da\u30f3\u30c7\u30a3\u30f3\u30b0\u306b\u306a\u308b**\n  * Workaround : \u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u3092\u6d88\u3059\u3068\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u308b\n\n# \u305d\u306e\u4ed6\u308f\u304b\u3063\u305f\u3053\u3068\n\n* Cinder-Volume \u30ce\u30fc\u30c9\u3092\u5897\u3084\u3059\u3053\u3068\u3067\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u4f5c\u6210\u5148\u3092\u5897\u3084\u3059\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u30de\u30eb\u30c1 DRBDmanage instance\uff08DRBD\u30af\u30e9\u30b9\u30bf\u8907\u6570\u306b\u3088\u308b\u30de\u30eb\u30c1\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\uff09\u306f\u307e\u3060\u672a\u5bfe\u5fdc\n* ``drbdmanage modify-config`` \u3067\u306eStorage Plugin \u306e\u5909\u66f4\u306f\u30aa\u30f3\u30b6\u30d5\u30e9\u30a4\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3002\u305f\u3060\u3057\u3001\u30ed\u30b0\u30ec\u30d9\u30eb\u306a\u3069\u306f\u30aa\u30f3\u30b6\u30d5\u30e9\u30a4\u3067\u6709\u52b9\u306b\u306a\u308b http://drbd.linbit.com/users-guide-9.0/s-dm-set-config.html\n  * Workaround : \u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3057\u3001\u8a2d\u5b9a\u5909\u66f4\u3057\u305f\u5f8c\u306b\u3001\u4e00\u5ea6\u4f7f\u7528\u3059\u308b\uff08\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u308b\u306a\u3069\uff09\u3053\u3068\u3067\u5909\u66f4\u304c\u6709\u52b9\u306b\u306a\u308b\n* DRBD Client \u3092 Primary\uff08OpenStack Cinder-Volume \u306e\u30ce\u30fc\u30c9\uff09\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u308b\u304c Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210\u3057\u305f\u3042\u3068\u306b\u305d\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u306f \u81ea\u52d5\u7684\u306b **Primary \u30ce\u30fc\u30c9\u306b Client \u3068\u3057\u3066\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u306a\u3044**\u3001\u3064\u307e\u308a DRBD Client \u3092\u60f3\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\n  * Workaround : Cinder \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210\u5f8c\u3001\u624b\u52d5\u3067\u30a2\u30b5\u30a4\u30f3\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u30fb\u30fb\u30fb\n\n# \u691c\u8a3c\u74b0\u5883\n| \u30db\u30b9\u30c8\u540d |IP\u30a2\u30c9\u30ec\u30b9|\n|:--------|:--------|\n|akira.tk.net|192.168.0.3|\n|drbd9-01.tk.net|192.168.0.21|\n|drbd9-02.tk.net|192.168.0.22|\n\n# DRBD Controller Node \u6e96\u5099\n\n* DNS\u767b\u9332\n* \u30ce\u30fc\u30c9\u9593\u3067SSH-KEY\u767b\u9332\n\n```shell-session\n[root@drbd9-01 ~]# vgcreate drbdpool /dev/sdb /dev/sdc\n  Physical volume \"/dev/sdb\" successfully created\n  Physical volume \"/dev/sdc\" successfully created\n  Volume group \"drbdpool\" successfully created\n\n[root@drbd9-02 ~]# vgcreate drbdpool /dev/sdb /dev/sdc\n  Physical volume \"/dev/sdb\" successfully created\n  Physical volume \"/dev/sdc\" successfully created\n  Volume group \"drbdpool\" successfully created\n```\n\n## \u521d\u671f\u8a2d\u5b9a\n\n```shell-session\n[root@drbd9-01 ~]# drbdmanage init 192.168.0.21\n\nYou are going to initalize a new drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Failed to find logical volume \"drbdpool/.drbdctrl_0\"\n  Failed to find logical volume \"drbdpool/.drbdctrl_1\"\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\nempty drbdmanage control volume initialized.\nempty drbdmanage control volume initialized.\nOperation completed successfully\n\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n\n[root@drbd9-01 ~]# drbdmanage add-node drbd9-02.tk.net 192.168.0.22\nOperation completed successfully\nOperation completed successfully\n\nExecuting join command using ssh.\nIMPORTANT: The output you see comes from drbd9-02.tk.net\nIMPORTANT: Your input is executed on drbd9-02.tk.net\nYou are going to join an existing drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Logical volume \".drbdctrl_0\" successfully removed\n  Logical volume \".drbdctrl_1\" successfully removed\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_0 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_1 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nOperation completed successfully\n\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n| drbd9-02.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n```\n\n# \u30db\u30b9\u30c8\u6e96\u5099\nOpenstack Cinder Volume \u5074 \u3082 DRBD \u30ce\u30fc\u30c9\u3068\u3057\u3066\u8ffd\u52a0\u767b\u9332\n\n```shell-session\n[root@drbd9-01 ~]# drbdmanage add-node akira.tk.net 192.168.0.3\nOperation completed successfully\nOperation completed successfully\n\nExecuting join command using ssh.\nIMPORTANT: The output you see comes from akira.tk.net\nIMPORTANT: Your input is executed on akira.tk.net\nYou are going to join an existing drbdmanage cluster.\nCAUTION! Note that:\n  * Any previous drbdmanage cluster information may be removed\n  * Any remaining resources managed by a previous drbdmanage installation\n    that still exist on this system will no longer be managed by drbdmanage\n\nConfirm:\n\n  yes/no: yes\n  Logical volume \".drbdctrl_0\" successfully removed\n  Logical volume \".drbdctrl_1\" successfully removed\n  Logical volume \".drbdctrl_0\" created.\n  Logical volume \".drbdctrl_1\" created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_0 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\n\nDo you want to proceed?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\nmd_offset 4190208\nal_offset 4157440\nbm_offset 4153344\n\nFound some data\n\n ==> This might destroy existing data! <==\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nYou want me to create a v09 style flexible-size internal meta data block.\nThere appears to be a v09 flexible-size internal meta data block\nalready in place on /dev/drbdpool/.drbdctrl_1 at byte offset 4190208\n\nDo you really want to overwrite the existing meta-data?\n*** confirmation forced via --force option ***\n\nDo you want to proceed?\n*** confirmation forced via --force option ***\nNOT initializing bitmap\nmd_offset 4190208\nal_offset 4157440\nbm_offset 4153344\n\nFound some data\n\n ==> This might destroy existing data! <==\ninitializing activity log\nWriting meta data...\nNew drbd meta data block successfully created.\nOperation completed successfully\n[root@drbd9-01 ~]# drbdmanage list-nodes\n+------------------------------------------------------------------------------------------------------------+\n| Name            | Pool Size | Pool Free | Site |                                                   | State |\n+------------------------------------------------------------------------------------------------------------+\n| akira.tk.net    |      9992 |      9984 |  N/A |                                                   |    ok |\n| drbd9-01.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n| drbd9-02.tk.net |     20472 |     20464 |  N/A |                                                   |    ok |\n+------------------------------------------------------------------------------------------------------------+\n```\n\u4ee5\u964d\u306f\n[OpenStack LIBERTY \u3067 DRBD Cinder Volume Driver \u4e8b\u59cb\u3081](http://qiita.com/tksarah/items/c6e886884f3ba5ea364e)\u3001\u3068\u540c\u69d8\u3002\n\n\n> *  drbdmanage driver \u8a2d\u5b9a\n    1. cinder.conf\n    2. \u30dc\u30ea\u30e5\u30fc\u30e0\u30bf\u30a4\u30d7\u4f5c\u6210\n    3. dbus \u3078\u306e\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\n    4. cinder-volume \u518d\u8d77\u52d5\n\n# \u52d5\u4f5c\u78ba\u8a8d\u30ed\u30b0\n\u9806\u6b21\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n# \u53c2\u8003\n* http://drbd.linbit.com/users-guide-9.0/\n* https://github.com/openstack/cinder/commits/master/cinder/volume/drivers/drbdmanagedrv.py\n* http://docs.openstack.org/liberty/config-reference/content/section_cinder.conf.html\n", "tags": ["openstack", "Cinder", "drbd9", "drbdmanage"]}