{"tags": ["Doctrine2", "Symfony"], "context": "yositani2002 \u3067\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u306f Symfony Advent Calender 2016 \u306e17\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nSymfony 2.x \u7cfb\u4ee5\u964d\u306e Doctrine2 \u3092\u3044\u3058\u3063\u3066\u3001\u904e\u53bb\u306b\u8e93\u3044\u305f\u3053\u3068\u3092\u9061\u3063\u3066\u307e\u3068\u3081\u3066\u307e\u3057\u305f\u3002\n\u6df1\u6398\u308a\u3067\u304d\u3066\u306a\u304b\u3063\u305f\u308a\u3001\u975e\u5e38\u306b\u4e3b\u89b3\u7684\u306a\u5185\u5bb9\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u65e2\u5b58\u306e\u4e0d\u5177\u5408\u306b\u3064\u3044\u3066\n\u672c\u6295\u7a3f\u3092\u66f8\u3044\u3066\u3044\u3066\u77e5\u3063\u305f\u306e\u3067\u3059\u304c\u3001 Doctrine \u306e\u672c\u5bb6\u30b5\u30a4\u30c8\u306b\u65e2\u77e5\u306e\u5236\u7d04\u30fb\u554f\u984c\u304c\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u30da\u30fc\u30b8\u304c\u6709\u308a\u307e\u3057\u305f\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/limitations-and-known-issues.html#limitations-and-known-issues\n\nDoctrineBundle\u306e\u6a5f\u80fd\u3068\u3057\u3066\u3001sharding\u306b\u3064\u3044\u3066\nsharding \u306f master/slave \u306e\u8a2d\u5b9a\u3068\u306e\u540c\u6642\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nhttps://github.com/doctrine/DoctrineBundle/blob/master/DependencyInjection/DoctrineExtension.php#L283\nmaster/slave \u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u306a\u3069\u306e\u6a5f\u80fd\u306f\u306a\u304f\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u306a\u3044\u53c2\u7167\u306e\u307f slave \u306b\u9001\u3089\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\nOne-To-One Bidirectional \u3067\u7e4b\u304c\u308b\u30c6\u30fc\u30d6\u30eb\u540c\u58eb\u3092\u4e00\u3064\u306e\u30ad\u30fc\u3067\u7e4b\u3052\u3089\u308c\u306a\u3044\nOne-To-One Bidirectional \u3067\u7e4b\u304c\u308b\u30c6\u30fc\u30d6\u30eb A \u3068 B, B \u3068 C \u3092\u30ad\u30fc\u3072\u3068\u3064\u3067\u3064\u306a\u3052\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\u771f\u3093\u4e2d\u306b\u5165\u308b\u30c6\u30fc\u30d6\u30eb\u306b\u540c\u3058\u5024\u3092\u6301\u3064\u30ab\u30e9\u30e0\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html#onetoone\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001 Entity \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u5024\u306b\u5024\u3092\u5165\u308c\u3066\u304a\u304f\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/faq.html#how-can-i-add-default-values-to-a-column\noptions={\"default\":0}\n\n\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3068\u3044\u3046StackOverflow\u306e\u56de\u7b54\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u65b9\u6cd5\u3068\u601d\u308f\u308c\u307e\u3059\u3002\nhttp://stackoverflow.com/questions/3376881/default-value-in-doctrine\n\nQueryBuilder \u3067 where \u53e5\u306b\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3092\u4f7f\u308f\u306a\u3044\u6642\u306e\u6307\u5b9a\u65b9\u6cd5\n\u5d4c\u3063\u305f\u306e\u306f\u81ea\u5206\u3060\u3051\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001QueryBuilder\u3092\u4f7f\u3063\u3066\u3001Where\u53e5\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u306a\u3044\u5834\u5408\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306f\u3001expr()->literal()\u3092\u4f7f\u7528\u3059\u308b\u3002\n$qb->where($qb->expr()->eq('a.enable', $qb->expr()->literal(true)))\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/query-builder.html#binding-parameters-to-your-query\n\nDQL \u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u66f8\u304d\u65b9\u304c\u3042\u308b\nQueryBuilder \u304a\u3088\u3073 DQL \u306f\u3001 SQL \u306e\u5b8c\u5168\u306a\u518d\u73fe\u306f\u51fa\u6765\u305a\u3001\u751f\u306e SQL \u3092\u66f8\u3044\u305f\u65b9\u304c\u3044\u3044\u5834\u5408\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\u3068\u304f\u306b UPDATE \u3084 DELETE \u3067\u30c6\u30fc\u30d6\u30eb\u3092 join \u3057\u3066\u4e00\u62ec\u3067\u6307\u5b9a\u3059\u308b\u3088\u3046\u306a SQL \u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/dql-doctrine-query-language.html#update-queries\nhttp://stackoverflow.com/questions/37080116/doctrine-bulk-dql-update-with-join\n\nPostgreSQL\u306e\u5834\u5408\u3001persist()\u306e\u6bb5\u968e\u3067Entity\u306eID\u3092\u4ed8\u4e0e\u3059\u308b\n\u4ee5\u4e0b\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/chihiro-adachi/items/4dac99731817485d51ac\npersist() \u306e\u6bb5\u968e\u3067 ID \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\nEntity \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u308b\u9806\u756a\u306f\u3001persist() \u3057\u305f\u9806\u756a\u3067\u306f\u306a\u3044\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\u306f\u3001 persist() \u3057\u305f\u9806\u756a\u3067\u884c\u308f\u308c\u308b\u3055\u308c\u308b\u304b\u3068\u304a\u3082\u3044\u304d\u3084\u3001\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4e26\u3073\u3092\u6c7a\u3081\u308b\u3088\u3046\u3067\u3059\u3002\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/UnitOfWork.php#L1113\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/Internal/CommitOrderCalculator.php\n\u9806\u756a\u306b\u4fdd\u5b58\u3055\u308c\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u9010\u6b21 flush() \u3057\u307e\u3057\u3087\u3046\u3002\n\u3055\u3089\u306b\u3001\u4fdd\u5b58\u3055\u308c\u308b\u30af\u30e9\u30b9\u306e\u9806\u756a\u306b\u3088\u3063\u3066\u3001persist() \u3067\u4e00\u5ea6\u4ed8\u4e0e\u3055\u308c\u305f Entity \u306e ID \u304c null \u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\n\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6301\u3063\u3066\u3044\u308b Entity \u3067\u89aa\u306b\u3042\u305f\u308b\u65b9\u304c\u5148\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u3068\u304d\u306e\u3088\u3046\u3067\u3059\u3002\nhttps://groups.google.com/forum/#!topic/doctrine-user/o5j8PcYc0DY\n\u3053\u3053\u3067\u306floose\u3060\u3068\u8a00\u308f\u308c\u3066\u3044\u307e\u3059\u3002\nhttp://stackoverflow.com/questions/32766709/make-doctrine-to-add-entities-in-original-order\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/transactions-and-concurrency.html\n\nEntityManager\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\nEntityManager\u306fselect\u3067\u53d6\u5f97\u3057\u305fEntity\u306e\u60c5\u5831\u3092\u3059\u3079\u3066\u4fdd\u6301\u3057\u3066\u3044\u307e\u3059\u3002\nChangeTrackingPolicy \u304c Deferred Implicit (\u30c7\u30d5\u30a9\u30eb\u30c8) \u306e\u3068\u304d\u3001flush()\u3055\u308c\u305f\u3068\u304d\u306b\u3001\u4fdd\u6301\u3057\u3066\u3044\u308b\u3059\u3079\u3066\u306eEntity\u306b\u3064\u3044\u3066\u5909\u66f4\u304c\u3042\u3063\u305f\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u5909\u66f4\u304c\u3042\u3063\u305f Entity \u306b\u3064\u3044\u3066\u306fDB\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u65e2\u5b58\u306e Entity \u3092\u5909\u66f4\u3057\u305f\u3068\u304d\u306b\u306f persist() \u3057\u306a\u304f\u3066\u3082\u3088\u3044\u3067\u3059\u3002\nChangeTrackingPolicy \u3092 Deferred Explicit \u306b\u8a2d\u5b9a\u3059\u308b\u3068persist()\u3055\u308c\u305fEntity\u3060\u3051\u3001\u5dee\u5206\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066DB\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://doctrine-orm.readthedocs.io/projects/doctrine-orm/en/latest/reference/change-tracking-policies.html\n\u540c\u69d8\u306b\u3001 NativeQuery \u3092\u4f7f\u3063\u305f EntityResult \u3067\u53d6\u5f97\u3057\u305f Entity \u3082\u3001 EntityManager \u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\n$em->getRepository('MyProject\\Domain\\User')->find($id);\n\n\u3057\u305f\u3068\u304d\u306b\u3001id\u306b\u4e00\u81f4\u3059\u308bEntity\u3092EntityManager\u304c\u4fdd\u6301\u3057\u3066\u3044\u308b\u5834\u5408\u3001SQL\u3092\u6295\u3052\u305a\u306b\u4fdd\u6301\u3057\u3066\u3044\u308b Entity \u3092\u8fd4\u3057\u307e\u3059\u3002\nNativeQuery\u3067\u53d6\u5f97\u3057\u305fEntity\u306f\u3001addFieldResult()\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u3057\u304b\u4fdd\u6301\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u304c null \u306b\u306a\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\nfind() \u3067 SQL \u3092\u6295\u3052\u3066 Entity \u3092\u53d6\u5f97\u3057\u76f4\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u8a72\u5f53 Entity \u3092EntityManager \u304b\u3089 detatch() \u3057\u3066\u304b\u3089 find() \u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/working-with-objects.html#detaching-entities\n\u30c7\u30fc\u30bf\u3092\u518d\u5229\u7528\u3059\u308b\u5834\u5408\u4ee5\u5916\u306f\u3001\u533a\u5207\u308a\u306e\u3044\u3044\u3068\u3053\u308d\u3067\u30af\u30ea\u30a2\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u3088\u3046\u3067\u3059\u3002\n$em->clear();\n\n\nEntity \u306e\u524a\u9664\u306e\u9806\u756a\u306b\u3064\u3044\u3066\nEntity a \u3068 Entity b \u304c\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u7e4b\u304c\u3063\u3066\u3044\u3066\u3001onDelete\u306e\u8a2d\u5b9a\u304c\u306a\u3044\u72b6\u614b\u3067\u3001a\u3068b\u3092\u4e21\u65b9\u3068\u3082\u524a\u9664\u3059\u308b\u30b1\u30fc\u30b9\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n$a->setB(null);\n$em->persist($a);\n$em->remove($b);\n$em->remove($a);\n$em->flush();\n\n\u300cb\u306fa\u304b\u3089\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3057\u305f\u3002\nChangeTrackingPolicy \u304c Deferred Implicit \u306e\u5834\u5408\u306f\u3001\u5909\u66f4\u3057\u305fEntity\u3092persist()\u3057\u3066\u3082\u3001EntityManager\u306f\u7121\u8996\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001 $a->setB(null); \u304c\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u72b6\u614b\u3067 $b \u304c\u5148\u306b delete \u3055\u308c\u308b\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\nhttp://stackoverflow.com/questions/14257004/doctrine2-symfony2-cascading-remove-integrity-constraint-violation-1451\n\u524a\u9664\u7cfb\u306e\u30d5\u30e9\u30b0\u306f onDelete=\"CASCADE\", cascade={\"remove\"}, orphanRemoval=\"true\" \u30683\u3064\u3042\u308b\u306e\u3067\u305d\u308c\u305e\u308c\u306f\u3058\u3081\u306b\u610f\u8b58\u3057\u3066\u8a2d\u8a08\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306d\u3002\nhttp://stackoverflow.com/questions/27472538/cascade-remove-vs-orphanremoval-true-vs-ondelete-cascade\n\n\u30cd\u30b9\u30c8\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\n\u8a73\u3057\u304f\u77e5\u3089\u306a\u7121\u3044\u306e\u3067\u3059\u304c\u3001\u5546\u7528\u306eDB\u3067\u3059\u3068\u30cd\u30b9\u30c8\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u305f\u3082\u306e\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nMySQL \u3084 PostgreSQL \u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u4ee3\u308f\u308a\u306b savepoint \u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u540c\u69d8\u306e\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u3067\u3059\u3002\nDoctrine\\DBAL\\Connection::setNestTransactionsWithSavepoints()\n\nhttp://www.doctrine-project.org/api/dbal/2.3/class-Doctrine.DBAL.Connection.html#_setNestTransactionsWithSavepoints\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u6210\u529f\u3057\u307e\u3059\u3002\n\u3068\u3044\u3063\u3066\u3082 @Doctrine\\DBAL\\Platforms@ \u306e\u4e2d\u3067\u306f DB2\uff08IBM Database2\uff09\u4ee5\u5916\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u306a\u304b\u306a\u304b\u30b5\u30f3\u30d7\u30eb\u3092\u898b\u3064\u3051\u306b\u304f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u304c\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nhttp://cgit.drupalcode.org/doctrine/tree/vendor/doctrine/dbal/tests/Doctrine/Tests/DBAL/Functional/ConnectionTest.php?id=e72638ee91c275b504645deb39378ce152ce5680#n64\nbeginTransaction() \u3092\u8907\u6570\u56de\u767a\u884c\u3057\u3001rollback()\u3057\u305f\u5834\u5408\u3001\u4e00\u3064\u524d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u307e\u3060\u751f\u304d\u3066\u3044\u308b\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4e2d\u3067\u3001\u5185\u90e8\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u3060\u3059\u5834\u5408\u3084\u3001\u6210\u529f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b\u5834\u5408\u306a\u3069\u3067\u4f7f\u3048\u308b\u304b\u3068\u304a\u3082\u3044\u307e\u3059\u3002\n\nAPCu \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\nDoctrine \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u4fdd\u5b58\u5148\u3068\u3057\u3066 APCu \u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u305d\u306e\u5834\u5408\u3001Doctrine \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\u306e\u30b3\u30de\u30f3\u30c9\u304c\u52b9\u304b\u305a\u3001httpd \u306e\u30d7\u30ed\u30bb\u30b9\u7d4c\u7531\u3067\u6d88\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306e\u30d7\u30ed\u30bb\u30b9\u3068 httpd \u306e\u30d7\u30ed\u30bb\u30b9\u304c\u5225\u306e\u70ba\u306e\u3088\u3046\u3067\u3059\u3002\nhttpd \u306e restart \u3067\u624b\u3063\u53d6\u308a\u65e9\u304f\u6d88\u305b\u307e\u3059\u304c\u3001\u5c02\u7528\u306e Bundle \u304c\u3042\u308b\u306e\u3067\u3001\u5927\u898f\u6a21\u306a\u74b0\u5883\u3067\u3059\u3068\u3053\u3061\u3089\u306e\u307b\u3046\u304c\u3044\u3044\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nhttps://github.com/Smart-Core/AcceleratorCacheBundle\nhttp://stackoverflow.com/questions/39981501/how-to-clear-doctrine-apc-cache-for-production\n\nEntity Cache \u306b\u3064\u3044\u3066\n\u3042\u307e\u308a\u6df1\u304f\u8ffd\u3044\u304d\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001Second Level cache \u306e entity cache \u3092\u4f7f\u3063\u3066\u96e3\u5100\u3057\u305f\u8a18\u61b6\u304c\u3042\u308a\u307e\u3059\u3002\n\u6319\u52d5\u304c\u4e0d\u5b89\u5b9a\uff08\u3060\u3063\u305f\uff09\u306e\u3067\u3001\u307b\u3068\u3093\u3069\u5909\u66f4\u3057\u306a\u3044\u3088\u3046\u306a\u30de\u30b9\u30bf\u30fc\u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3001entity cache\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u3001\n\u305d\u3082\u305d\u3082\u4f7f\u308f\u306a\u3044\u65b9\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nSoftDelete\u3067\u3001disable\u306b\u3057\u3066\u5024\u3092\u53d6\u308a\u3060\u3057\u3066\u3044\u3066\u30cf\u30de\u3063\u305f\n\u8ad6\u7406\u524a\u9664\u306e\u62e1\u5f35\u3092\u4f7f\u3046\u3068\u900f\u904e\u7684\u306bDQL\u306b\u524a\u9664\u30d5\u30e9\u30b0\u306e\u6761\u4ef6\u3092\u5dee\u3057\u8fbc\u3093\u3067\u304f\u308c\u3066\u4fbf\u5229\u3067\u3059\u3002\nhttps://symfony.com/doc/current/bundles/StofDoctrineExtensionsBundle/index.html\n\u524a\u9664\u6e08\u307f\u306e\u3082\u306e\u3092\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u306f\u3001filter \u3092 disable \u306b\u3057\u3066\u30af\u30a8\u30ea\u30fc\u3092\u6295\u3052\u308b\u3053\u3068\u3067\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n$filters = $em->getFilters();\n$filters->disable('softdeleteable');\n\nQueryBuilder \u304a\u3088\u3073 DQL \u3092\u4f7f\u308f\u305a\u3001\u751f SQL \u3092\u66f8\u304f\u5834\u5408\u306f\u624b\u52d5\u3067\u66f8\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u304d\u3061\u3063\u3068\u6700\u521d\u306b\u8003\u3048\u3066\u5229\u7528\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u8907\u96d1\u306a\u751f SQL \u66f8\u3044\u305f\u308a\u3059\u308b\u5834\u5408\u306f\u3001\u5f8c\u3067\u30cf\u30de\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n\n\nEntityManager \u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30fc\u306b\u6e21\u3059\u3053\u3068\u306b\u3064\u3044\u3066\n\u6c4e\u7528\u7684\u306a\uff08\u7279\u306b\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u30fc\u30d0\u30f3\u30c9\u30eb\u306e\uff09\u30af\u30e9\u30b9\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3068\u304d\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b EntityManager \u306f\u6307\u5b9a\u305b\u305a\u3001 ManagerRegistry \u3092\u6e21\u3057\u3066\u305d\u3053\u304b\u3089 EntityManager \u3092\u53d6\u5f97\u3059\u308b\u3068\u3044\u3044\u3088\u3046\u3067\u3059\u3002\nhttp://php-and-symfony.matthiasnoback.nl/2014/05/inject-the-manager-registry-instead-of-the-entity-manager/\nEntityManager \u306f\u8907\u6570\u5b9a\u7fa9\u3067\u304d\u3001 Entity \u30af\u30e9\u30b9\u306b\u5bfe\u3057\u3066\u500b\u5225\u306b\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002\n\u305f\u3060\u3001\u30ea\u30f3\u30af\u5148\u306e\n$entityManager = $managerRegistry->getManagerForClass(get_class($customer));\n\n\u3067\u5f97\u3089\u308c\u308b $entityManager \u306f\u3001 ORM \u3092\u4f7f\u7528\u3057\u3066\u3044\u308c\u3070\u3001 EntityManager \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u304c\u3001 interface \u306e\u5b9a\u7fa9\u3067\u306f ObjectManager \u304c\u8fd4\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001 EntityManager \u7279\u6709\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001IDE \u3084 scrutinizer \u306a\u3069\u306e CI \u30c4\u30fc\u30eb\u3067\u306f\u672a\u5b9a\u7fa9\u306e\u30e1\u30bd\u30c3\u30c9\u6271\u3044\u3055\u308c\u307e\u3059\u3002\n\n\u307e\u3068\u306a\u308a\u306e\u306a\u3044\u5185\u5bb9\u3067\u3059\u304c\u3001\u4ee5\u4e0a\u3067\u3059\u3002\n\u6700\u5f8c\u306b\u3001\u306a\u3093\u3060\u304b\u3093\u3060\u8a00\u3063\u3066\u3082 Doctrine \u304a\u3088\u3073 Symfony \u4fbf\u5229\u3067\u3059\u3088\u306d\u3002 \n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\nyositani2002 \u3067\u3059\u3002\n\n\u3053\u306e\u8a18\u4e8b\u306f [Symfony Advent Calender 2016](http://qiita.com/advent-calendar/2016/symfony) \u306e17\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nSymfony 2.x \u7cfb\u4ee5\u964d\u306e Doctrine2 \u3092\u3044\u3058\u3063\u3066\u3001\u904e\u53bb\u306b\u8e93\u3044\u305f\u3053\u3068\u3092\u9061\u3063\u3066\u307e\u3068\u3081\u3066\u307e\u3057\u305f\u3002\n\u6df1\u6398\u308a\u3067\u304d\u3066\u306a\u304b\u3063\u305f\u308a\u3001\u975e\u5e38\u306b\u4e3b\u89b3\u7684\u306a\u5185\u5bb9\u3082\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n## \u65e2\u5b58\u306e\u4e0d\u5177\u5408\u306b\u3064\u3044\u3066\n\n\u672c\u6295\u7a3f\u3092\u66f8\u3044\u3066\u3044\u3066\u77e5\u3063\u305f\u306e\u3067\u3059\u304c\u3001 Doctrine \u306e\u672c\u5bb6\u30b5\u30a4\u30c8\u306b\u65e2\u77e5\u306e\u5236\u7d04\u30fb\u554f\u984c\u304c\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u30da\u30fc\u30b8\u304c\u6709\u308a\u307e\u3057\u305f\u3002\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/limitations-and-known-issues.html#limitations-and-known-issues\n\n\n## DoctrineBundle\u306e\u6a5f\u80fd\u3068\u3057\u3066\u3001sharding\u306b\u3064\u3044\u3066\n\nsharding \u306f master/slave \u306e\u8a2d\u5b9a\u3068\u306e\u540c\u6642\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u3067\u3059\u3002\nhttps://github.com/doctrine/DoctrineBundle/blob/master/DependencyInjection/DoctrineExtension.php#L283\n\n\nmaster/slave \u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u306a\u3069\u306e\u6a5f\u80fd\u306f\u306a\u304f\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3057\u306a\u3044\u53c2\u7167\u306e\u307f slave \u306b\u9001\u3089\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n\n## One-To-One Bidirectional \u3067\u7e4b\u304c\u308b\u30c6\u30fc\u30d6\u30eb\u540c\u58eb\u3092\u4e00\u3064\u306e\u30ad\u30fc\u3067\u7e4b\u3052\u3089\u308c\u306a\u3044\n\nOne-To-One Bidirectional \u3067\u7e4b\u304c\u308b\u30c6\u30fc\u30d6\u30eb A \u3068 B, B \u3068 C \u3092\u30ad\u30fc\u3072\u3068\u3064\u3067\u3064\u306a\u3052\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\u771f\u3093\u4e2d\u306b\u5165\u308b\u30c6\u30fc\u30d6\u30eb\u306b\u540c\u3058\u5024\u3092\u6301\u3064\u30ab\u30e9\u30e0\u3092\u6301\u305f\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html#onetoone\n\n## \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001 Entity \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u5024\u306b\u5024\u3092\u5165\u308c\u3066\u304a\u304f\u3002\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/faq.html#how-can-i-add-default-values-to-a-column\n\n<pre>\noptions={\"default\":0}\n</pre>\n\n\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3068\u3044\u3046StackOverflow\u306e\u56de\u7b54\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u65b9\u6cd5\u3068\u601d\u308f\u308c\u307e\u3059\u3002\nhttp://stackoverflow.com/questions/3376881/default-value-in-doctrine\n\n## QueryBuilder \u3067 where \u53e5\u306b\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3092\u4f7f\u308f\u306a\u3044\u6642\u306e\u6307\u5b9a\u65b9\u6cd5\n\n\u5d4c\u3063\u305f\u306e\u306f\u81ea\u5206\u3060\u3051\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001QueryBuilder\u3092\u4f7f\u3063\u3066\u3001Where\u53e5\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u306a\u3044\u5834\u5408\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306f\u3001expr()->literal()\u3092\u4f7f\u7528\u3059\u308b\u3002\n<pre>\n$qb->where($qb->expr()->eq('a.enable', $qb->expr()->literal(true)))\n</pre>\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/query-builder.html#binding-parameters-to-your-query\n\n## DQL \u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u66f8\u304d\u65b9\u304c\u3042\u308b\n\nQueryBuilder \u304a\u3088\u3073 DQL \u306f\u3001 SQL \u306e\u5b8c\u5168\u306a\u518d\u73fe\u306f\u51fa\u6765\u305a\u3001\u751f\u306e SQL \u3092\u66f8\u3044\u305f\u65b9\u304c\u3044\u3044\u5834\u5408\u3082\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\u3068\u304f\u306b UPDATE \u3084 DELETE \u3067\u30c6\u30fc\u30d6\u30eb\u3092 join \u3057\u3066\u4e00\u62ec\u3067\u6307\u5b9a\u3059\u308b\u3088\u3046\u306a SQL \u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/dql-doctrine-query-language.html#update-queries\n\nhttp://stackoverflow.com/questions/37080116/doctrine-bulk-dql-update-with-join\n\n## PostgreSQL\u306e\u5834\u5408\u3001persist()\u306e\u6bb5\u968e\u3067Entity\u306eID\u3092\u4ed8\u4e0e\u3059\u308b\n\n\u4ee5\u4e0b\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\nhttp://qiita.com/chihiro-adachi/items/4dac99731817485d51ac\npersist() \u306e\u6bb5\u968e\u3067 ID \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n## Entity \u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3055\u308c\u308b\u9806\u756a\u306f\u3001persist() \u3057\u305f\u9806\u756a\u3067\u306f\u306a\u3044\u3002\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\u306f\u3001 persist() \u3057\u305f\u9806\u756a\u3067\u884c\u308f\u308c\u308b\u3055\u308c\u308b\u304b\u3068\u304a\u3082\u3044\u304d\u3084\u3001\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4e26\u3073\u3092\u6c7a\u3081\u308b\u3088\u3046\u3067\u3059\u3002\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/UnitOfWork.php#L1113\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/Internal/CommitOrderCalculator.php\n\n\u9806\u756a\u306b\u4fdd\u5b58\u3055\u308c\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u9010\u6b21 flush() \u3057\u307e\u3057\u3087\u3046\u3002\n\n\u3055\u3089\u306b\u3001\u4fdd\u5b58\u3055\u308c\u308b\u30af\u30e9\u30b9\u306e\u9806\u756a\u306b\u3088\u3063\u3066\u3001persist() \u3067\u4e00\u5ea6\u4ed8\u4e0e\u3055\u308c\u305f Entity \u306e ID \u304c null \u306b\u8a2d\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\n\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6301\u3063\u3066\u3044\u308b Entity \u3067\u89aa\u306b\u3042\u305f\u308b\u65b9\u304c\u5148\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u3068\u304d\u306e\u3088\u3046\u3067\u3059\u3002\n\nhttps://groups.google.com/forum/#!topic/doctrine-user/o5j8PcYc0DY\n\u3053\u3053\u3067\u306floose\u3060\u3068\u8a00\u308f\u308c\u3066\u3044\u307e\u3059\u3002\n\n\nhttp://stackoverflow.com/questions/32766709/make-doctrine-to-add-entities-in-original-order\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/transactions-and-concurrency.html\n\n\n## EntityManager\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\n\nEntityManager\u306fselect\u3067\u53d6\u5f97\u3057\u305fEntity\u306e\u60c5\u5831\u3092\u3059\u3079\u3066\u4fdd\u6301\u3057\u3066\u3044\u307e\u3059\u3002\n\nChangeTrackingPolicy \u304c Deferred Implicit (\u30c7\u30d5\u30a9\u30eb\u30c8) \u306e\u3068\u304d\u3001flush()\u3055\u308c\u305f\u3068\u304d\u306b\u3001\u4fdd\u6301\u3057\u3066\u3044\u308b\u3059\u3079\u3066\u306eEntity\u306b\u3064\u3044\u3066\u5909\u66f4\u304c\u3042\u3063\u305f\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u5909\u66f4\u304c\u3042\u3063\u305f Entity \u306b\u3064\u3044\u3066\u306fDB\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u65e2\u5b58\u306e Entity \u3092\u5909\u66f4\u3057\u305f\u3068\u304d\u306b\u306f persist() \u3057\u306a\u304f\u3066\u3082\u3088\u3044\u3067\u3059\u3002\nChangeTrackingPolicy \u3092 Deferred Explicit \u306b\u8a2d\u5b9a\u3059\u308b\u3068persist()\u3055\u308c\u305fEntity\u3060\u3051\u3001\u5dee\u5206\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066DB\u306b\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\nhttp://doctrine-orm.readthedocs.io/projects/doctrine-orm/en/latest/reference/change-tracking-policies.html\n\n\u540c\u69d8\u306b\u3001 NativeQuery \u3092\u4f7f\u3063\u305f EntityResult \u3067\u53d6\u5f97\u3057\u305f Entity \u3082\u3001 EntityManager \u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\n<pre>\n$em->getRepository('MyProject\\Domain\\User')->find($id);\n</pre>\n\u3057\u305f\u3068\u304d\u306b\u3001id\u306b\u4e00\u81f4\u3059\u308bEntity\u3092EntityManager\u304c\u4fdd\u6301\u3057\u3066\u3044\u308b\u5834\u5408\u3001SQL\u3092\u6295\u3052\u305a\u306b\u4fdd\u6301\u3057\u3066\u3044\u308b Entity \u3092\u8fd4\u3057\u307e\u3059\u3002\nNativeQuery\u3067\u53d6\u5f97\u3057\u305fEntity\u306f\u3001addFieldResult()\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u3057\u304b\u4fdd\u6301\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u304c null \u306b\u306a\u3063\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\nfind() \u3067 SQL \u3092\u6295\u3052\u3066 Entity \u3092\u53d6\u5f97\u3057\u76f4\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u8a72\u5f53 Entity \u3092EntityManager \u304b\u3089 detatch() \u3057\u3066\u304b\u3089 find() \u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nhttp://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/working-with-objects.html#detaching-entities\n\n\u30c7\u30fc\u30bf\u3092\u518d\u5229\u7528\u3059\u308b\u5834\u5408\u4ee5\u5916\u306f\u3001\u533a\u5207\u308a\u306e\u3044\u3044\u3068\u3053\u308d\u3067\u30af\u30ea\u30a2\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u3088\u3046\u3067\u3059\u3002\n<pre>\n$em->clear();\n</pre>\n\n\n## Entity \u306e\u524a\u9664\u306e\u9806\u756a\u306b\u3064\u3044\u3066\n\nEntity a \u3068 Entity b \u304c\u30ea\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u7e4b\u304c\u3063\u3066\u3044\u3066\u3001onDelete\u306e\u8a2d\u5b9a\u304c\u306a\u3044\u72b6\u614b\u3067\u3001a\u3068b\u3092\u4e21\u65b9\u3068\u3082\u524a\u9664\u3059\u308b\u30b1\u30fc\u30b9\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n<pre>\n$a->setB(null);\n$em->persist($a);\n$em->remove($b);\n$em->remove($a);\n$em->flush();\n</pre>\n\n\u300cb\u306fa\u304b\u3089\u53c2\u7167\u3055\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3057\u305f\u3002\nChangeTrackingPolicy \u304c Deferred Implicit \u306e\u5834\u5408\u306f\u3001\u5909\u66f4\u3057\u305fEntity\u3092persist()\u3057\u3066\u3082\u3001EntityManager\u306f\u7121\u8996\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u3001 $a->setB(null); \u304c\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u305d\u306e\u72b6\u614b\u3067 $b \u304c\u5148\u306b delete \u3055\u308c\u308b\u306e\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\nhttp://stackoverflow.com/questions/14257004/doctrine2-symfony2-cascading-remove-integrity-constraint-violation-1451\n\n\u524a\u9664\u7cfb\u306e\u30d5\u30e9\u30b0\u306f onDelete=\"CASCADE\", cascade={\"remove\"}, orphanRemoval=\"true\" \u30683\u3064\u3042\u308b\u306e\u3067\u305d\u308c\u305e\u308c\u306f\u3058\u3081\u306b\u610f\u8b58\u3057\u3066\u8a2d\u8a08\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u306d\u3002\n\nhttp://stackoverflow.com/questions/27472538/cascade-remove-vs-orphanremoval-true-vs-ondelete-cascade\n\n## \u30cd\u30b9\u30c8\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\n\n\u8a73\u3057\u304f\u77e5\u3089\u306a\u7121\u3044\u306e\u3067\u3059\u304c\u3001\u5546\u7528\u306eDB\u3067\u3059\u3068\u30cd\u30b9\u30c8\u3057\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3057\u305f\u3082\u306e\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\nMySQL \u3084 PostgreSQL \u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u4ee3\u308f\u308a\u306b savepoint \u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u305d\u3061\u3089\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u540c\u69d8\u306e\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u3067\u3059\u3002\n\n<pre>Doctrine\\DBAL\\Connection::setNestTransactionsWithSavepoints()</pre>\nhttp://www.doctrine-project.org/api/dbal/2.3/class-Doctrine.DBAL.Connection.html#_setNestTransactionsWithSavepoints\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304c\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u6210\u529f\u3057\u307e\u3059\u3002\n\u3068\u3044\u3063\u3066\u3082 @Doctrine\\DBAL\\Platforms@ \u306e\u4e2d\u3067\u306f DB2\uff08IBM Database2\uff09\u4ee5\u5916\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\n\u306a\u304b\u306a\u304b\u30b5\u30f3\u30d7\u30eb\u3092\u898b\u3064\u3051\u306b\u304f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u304c\u53c2\u8003\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nhttp://cgit.drupalcode.org/doctrine/tree/vendor/doctrine/dbal/tests/Doctrine/Tests/DBAL/Functional/ConnectionTest.php?id=e72638ee91c275b504645deb39378ce152ce5680#n64\n\nbeginTransaction() \u3092\u8907\u6570\u56de\u767a\u884c\u3057\u3001rollback()\u3057\u305f\u5834\u5408\u3001\u4e00\u3064\u524d\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u307e\u3060\u751f\u304d\u3066\u3044\u308b\u72b6\u614b\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4e2d\u3067\u3001\u5185\u90e8\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u3060\u3059\u5834\u5408\u3084\u3001\u6210\u529f\u3059\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3057\u5b9f\u884c\u3059\u308b\u5834\u5408\u306a\u3069\u3067\u4f7f\u3048\u308b\u304b\u3068\u304a\u3082\u3044\u307e\u3059\u3002\n\n## APCu \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\n\nDoctrine \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u4fdd\u5b58\u5148\u3068\u3057\u3066 APCu \u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 \u305d\u306e\u5834\u5408\u3001Doctrine \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30af\u30ea\u30a2\u306e\u30b3\u30de\u30f3\u30c9\u304c\u52b9\u304b\u305a\u3001httpd \u306e\u30d7\u30ed\u30bb\u30b9\u7d4c\u7531\u3067\u6d88\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306e\u30d7\u30ed\u30bb\u30b9\u3068 httpd \u306e\u30d7\u30ed\u30bb\u30b9\u304c\u5225\u306e\u70ba\u306e\u3088\u3046\u3067\u3059\u3002\n\nhttpd \u306e restart \u3067\u624b\u3063\u53d6\u308a\u65e9\u304f\u6d88\u305b\u307e\u3059\u304c\u3001\u5c02\u7528\u306e Bundle \u304c\u3042\u308b\u306e\u3067\u3001\u5927\u898f\u6a21\u306a\u74b0\u5883\u3067\u3059\u3068\u3053\u3061\u3089\u306e\u307b\u3046\u304c\u3044\u3044\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nhttps://github.com/Smart-Core/AcceleratorCacheBundle\n\nhttp://stackoverflow.com/questions/39981501/how-to-clear-doctrine-apc-cache-for-production\n\n## Entity Cache \u306b\u3064\u3044\u3066\n\n\u3042\u307e\u308a\u6df1\u304f\u8ffd\u3044\u304d\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001Second Level cache \u306e entity cache \u3092\u4f7f\u3063\u3066\u96e3\u5100\u3057\u305f\u8a18\u61b6\u304c\u3042\u308a\u307e\u3059\u3002\n\u6319\u52d5\u304c\u4e0d\u5b89\u5b9a\uff08\u3060\u3063\u305f\uff09\u306e\u3067\u3001\u307b\u3068\u3093\u3069\u5909\u66f4\u3057\u306a\u3044\u3088\u3046\u306a\u30de\u30b9\u30bf\u30fc\u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3001entity cache\u3092\u6709\u52b9\u306b\u3059\u308b\u304b\u3001\n\u305d\u3082\u305d\u3082\u4f7f\u308f\u306a\u3044\u65b9\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n## SoftDelete\u3067\u3001disable\u306b\u3057\u3066\u5024\u3092\u53d6\u308a\u3060\u3057\u3066\u3044\u3066\u30cf\u30de\u3063\u305f\n\n\u8ad6\u7406\u524a\u9664\u306e\u62e1\u5f35\u3092\u4f7f\u3046\u3068\u900f\u904e\u7684\u306bDQL\u306b\u524a\u9664\u30d5\u30e9\u30b0\u306e\u6761\u4ef6\u3092\u5dee\u3057\u8fbc\u3093\u3067\u304f\u308c\u3066\u4fbf\u5229\u3067\u3059\u3002\nhttps://symfony.com/doc/current/bundles/StofDoctrineExtensionsBundle/index.html\n\n\u524a\u9664\u6e08\u307f\u306e\u3082\u306e\u3092\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u306f\u3001filter \u3092 disable \u306b\u3057\u3066\u30af\u30a8\u30ea\u30fc\u3092\u6295\u3052\u308b\u3053\u3068\u3067\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n<pre>\n$filters = $em->getFilters();\n$filters->disable('softdeleteable');\n</pre>\nQueryBuilder \u304a\u3088\u3073 DQL \u3092\u4f7f\u308f\u305a\u3001\u751f SQL \u3092\u66f8\u304f\u5834\u5408\u306f\u624b\u52d5\u3067\u66f8\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u304d\u3061\u3063\u3068\u6700\u521d\u306b\u8003\u3048\u3066\u5229\u7528\u3059\u308c\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u8907\u96d1\u306a\u751f SQL \u66f8\u3044\u305f\u308a\u3059\u308b\u5834\u5408\u306f\u3001\u5f8c\u3067\u30cf\u30de\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n\n\n## EntityManager \u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30fc\u306b\u6e21\u3059\u3053\u3068\u306b\u3064\u3044\u3066\n\n\u6c4e\u7528\u7684\u306a\uff08\u7279\u306b\u30b5\u30fc\u30c9\u30d1\u30fc\u30c6\u30a3\u30fc\u30d0\u30f3\u30c9\u30eb\u306e\uff09\u30af\u30e9\u30b9\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3068\u304d\u3001\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b EntityManager \u306f\u6307\u5b9a\u305b\u305a\u3001 ManagerRegistry \u3092\u6e21\u3057\u3066\u305d\u3053\u304b\u3089 EntityManager \u3092\u53d6\u5f97\u3059\u308b\u3068\u3044\u3044\u3088\u3046\u3067\u3059\u3002\nhttp://php-and-symfony.matthiasnoback.nl/2014/05/inject-the-manager-registry-instead-of-the-entity-manager/\nEntityManager \u306f\u8907\u6570\u5b9a\u7fa9\u3067\u304d\u3001 Entity \u30af\u30e9\u30b9\u306b\u5bfe\u3057\u3066\u500b\u5225\u306b\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002\n\n\u305f\u3060\u3001\u30ea\u30f3\u30af\u5148\u306e\n<pre>\n$entityManager = $managerRegistry->getManagerForClass(get_class($customer));\n</pre>\n\n\u3067\u5f97\u3089\u308c\u308b $entityManager \u306f\u3001 ORM \u3092\u4f7f\u7528\u3057\u3066\u3044\u308c\u3070\u3001 EntityManager \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u304c\u3001 interface \u306e\u5b9a\u7fa9\u3067\u306f ObjectManager \u304c\u8fd4\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001 EntityManager \u7279\u6709\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001IDE \u3084 scrutinizer \u306a\u3069\u306e CI \u30c4\u30fc\u30eb\u3067\u306f\u672a\u5b9a\u7fa9\u306e\u30e1\u30bd\u30c3\u30c9\u6271\u3044\u3055\u308c\u307e\u3059\u3002\n\n\n------------\n\n\u307e\u3068\u306a\u308a\u306e\u306a\u3044\u5185\u5bb9\u3067\u3059\u304c\u3001\u4ee5\u4e0a\u3067\u3059\u3002\n\n\u6700\u5f8c\u306b\u3001\u306a\u3093\u3060\u304b\u3093\u3060\u8a00\u3063\u3066\u3082 Doctrine \u304a\u3088\u3073 Symfony \u4fbf\u5229\u3067\u3059\u3088\u306d\u3002 \n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n"}