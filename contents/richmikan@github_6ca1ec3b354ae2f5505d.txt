{"context": " More than 1 year has passed since last update.\n\n\u3069\u306eUNIX\u3067\u3082\u901a\u7528\u3059\u308b\u30ed\u30c3\u30af\u6a5f\u69cb\u306f\u3042\u308b\u306e\u304b?\n\u4ed6\u8a00\u8a9e\u3067\u306f\u5927\u62b5\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30ed\u30c3\u30af\u6a5f\u69cb\u3067\u3042\u308b\u304c\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306f\u30ed\u30c3\u30af\u6a5f\u69cb\u3092\u76f4\u63a5\u5b9f\u73fe\u3059\u308b\u30b3\u30de\u30f3\u30c9\u304c\u7121\u3044\u3002flock\u30b3\u30de\u30f3\u30c9\u3084lockf\u30b3\u30de\u30f3\u30c9\u306a\u3069OS\u306b\u3088\u3063\u3066\u306f\u72ec\u81ea\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u304c\u3001OS\u72ec\u81ea\u3086\u3048\u3001\u305d\u308c\u3089\u3092\u4f7f\u3063\u3066\u3057\u307e\u3046\u3068\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u53ef\u642c\u6027\u306f\u5931\u308f\u308c\u3066\u3057\u307e\u3046\u3002\uff08\u3057\u304b\u3082\u524d\u8ff0\u306e2\u3064\u306e\u30b3\u30de\u30f3\u30c9\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u30ed\u30c3\u30af\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3042\u308b\u3046\u3048\u306b\u3001\u30ed\u30c3\u30af\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u9593\u306f\u6b21\u306e\u884c\u306b\u9032\u3081\u306a\u3044\uff09\n\u300c\u7279\u5b9a\u306eOS\u306b\u7e1b\u3089\u308c\u3066\u3057\u307e\u3046\u304f\u3089\u3044\u306a\u3089\u4ed6\u306e\u8a00\u8a9e\u3092\u4f7f\u3046\u65b9\u304c\u3088\u3063\u307d\u3069\u30de\u30b7\u3060\u300d\u3068\u3044\u3063\u3066\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u4fe1\u8005\uff08POSIX\u539f\u7406\u4e3b\u7fa9\u8005\uff09\u3092\u5897\u3084\u305b\u306a\u3044\u306e\u304c\u6094\u3057\u304b\u3063\u305f\u306e\u3060\u304c\u3001\u3088\u3046\u3084\u304f\u4f5c\u308b\u306e\u306b\u6210\u529f\u3057\u305f\u306e\u3067\u5831\u544a\u3059\u308b\u3002\n\u3053\u308c\u3067\u3001\n\n\n\u6392\u4ed6\u30ed\u30c3\u30af\u2026\u2026\u2026\u2026\u2026\u2026\u2026pexlock\u30b3\u30de\u30f3\u30c9\n\n\n\u5171\u6709\u30ed\u30c3\u30af\u2026\u2026\u2026\u2026\u2026\u2026\u2026pshlock\u30b3\u30de\u30f3\u30c9\n\n\n\u30bb\u30de\u30d5\u30a9\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\uff08pshlock\u30b3\u30de\u30f3\u30c9\u3001\u5171\u6709\u30ed\u30c3\u30af\u306e\u5fdc\u7528\uff09\n\u4e0a\u8a18\u306e\u30ed\u30c3\u30af\u89e3\u9664\u2026\u2026\u2026\u2026punlock\u30b3\u30de\u30f3\u30c9\n\n\u89e3\u9664\u6f0f\u308c\u30d5\u30a1\u30a4\u30eb\u306e\u6e05\u6383\u2026pcllock\u30b3\u30de\u30f3\u30c9\n\n\n\u304c\u3001POSIX\u306e\u7bc4\u56f2\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u80fd\u66f8\u304d\u306f\u3044\u3044\u304b\u3089\u4f7f\u3044\u305f\u3044\u3068\u3044\u3046\u4eba\u306f\u3001\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3082\u3089\u3063\u3066\uff08\u3054\u304f\u7c21\u5358\u306a\u4f7f\u3044\u65b9\u306f\u30b3\u30de\u30f3\u30c9\u30bd\u30fc\u30b9\u306e\u5192\u982d\u306b\u8a18\u3057\u3066\u3042\u308b\uff09\u3001\u672c\u8a18\u4e8b\u3067\u306f\u3044\u304b\u306b\u305d\u308c\u3089\u3092\u5b9f\u73fe\u3057\u305f\u304b\u3068\u3044\u3046\u30a2\u30a4\u30c7\u30a2\u3092\u307e\u3068\u3081\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n\u305d\u306e0. \u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u65b9\u6cd5\n\u30ed\u30c3\u30af\u306b\u95a2\u9023\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3092\u53f8\u308b\u30b3\u30de\u30f3\u30c9\u306fPOSIX\u7bc4\u56f2\u306b\u306f\u306a\u3044\u3002\u3067\u306f\u4f55\u3092\u4f7f\u3063\u3066\u7ba1\u7406\u3059\u308b\u304b\u3068\u3044\u3048\u3070\u3001\u30d5\u30a1\u30a4\u30eb\u3060\u30021\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u76f4\u4e0b\u306b\u306f\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u304c1\u3064\u3057\u304b\u5b58\u5728\u3067\u304d\u306a\u3044\u3001\u3068\u3044\u3046\u6027\u8cea\u3092\u8ce2\u304f\u5229\u7528\u3059\u308b\u306e\u304c\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30ed\u30c3\u30af\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u539f\u7406\u3067\u3042\u308b\u3002\n\u30d9\u30bf\u306a\u65b9\u6cd5\u3060\u3068\u898b\u304f\u3073\u308b\u3053\u3068\u306a\u304b\u308c\u3002\u3082\u3068\u3082\u3068OS\u306f\u3001\u7269\u7406\u7684\u306b1\u53f0\u3057\u304b\u306a\u3044HDD\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8981\u6c42\u3092\u634c\u304f\u305f\u3081\u306b\u5185\u90e8\u3067\u5fc5\u305a\u6392\u4ed6\u5236\u5fa1\u3092\u3084\u3063\u3066\u3044\u308b\u3002\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u308b\u30ed\u30c3\u30af\u7ba1\u7406\u3068\u306f\u3001OS\u304c\u5099\u3048\u3066\u3044\u308b\u6d17\u7df4\u3055\u308c\u305f\u6392\u4ed6\u5236\u5fa1\u6a5f\u69cb\u306e\u6d3b\u7528\u306b\u4ed6\u306a\u3089\u306a\u3044!\n\n\u57fa\u672c\u30eb\u30fc\u30eb1. \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308c\u305f\u8005\u52dd\u3061\n\u3082\u3046\u5c11\u3057\u5177\u4f53\u7684\u306b\u8a00\u3048\u3070\u3001\u30ed\u30c3\u30af\u7ba1\u7406\u306e\u305f\u3081\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30921\u3064\u7528\u610f\u3057\u2026\u2026\n\n\u65e9\u3044\u8005\u52dd\u3061\u3067\u30d5\u30a1\u30a4\u30eb\uff08\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u4f5c\u308b\u3002\n\u300c\u6210\u529f\u8005\u306f\u30ed\u30c3\u30af\u6210\u529f\uff08\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\uff09\u300d\u3068\u53d6\u308a\u6c7a\u3081\u308b\u3002\n\u5931\u6557\u8005\u306f\u66ab\u304f\u3057\u3066\u304b\u3089\u518d\u5ea6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3092\u8a66\u307f\u308b\u3002\n\u6210\u529f\u8005\u306f\u7528\u4e8b\u304c\u6e08\u3093\u3060\u3089\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u6d88\u3059\u3002\n\n\u3067\u3042\u308b\u3002\u3053\u308c\u3092\u57fa\u672c\u30eb\u30fc\u30eb1\u3068\u3057\u3066\u5236\u5b9a\u3059\u308b\u3002\n\n\u57fa\u672c\u30eb\u30fc\u30eb2. \u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306f\u6d88\u3057\u3066\u3088\u3044\n\u305f\u3060\u3001\u6210\u529f\u8005\u304c\u30ed\u30c3\u30af\u3092\u3057\u305f\u307e\u307e\u6d88\u3057\u5fd8\u308c\u305f\u308a\u3001\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7570\u5e38\u7d42\u4e86\u3057\u3066\u3057\u307e\u3046\u3068\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u7d1b\u5931\u3055\u308c\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308b\u3002\u3053\u308c\u306f\u7d42\u4e86\u30b7\u30b0\u30ca\u30eb\u3092\u691c\u51fa\uff08trap\u30b3\u30de\u30f3\u30c9\u3067\uff09\u3057\u305f\u3089\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u7b49\u3067\u3042\u308b\u7a0b\u5ea6\u5bfe\u5fdc\u3067\u304d\u308b\u304c\u3001SIGKILL\uff08\u5f37\u5236\u7d42\u4e86\uff09\u306a\u3069\u304c\u3042\u308b\u306e\u3067\u5b8c\u5168\u3067\u306f\u306a\u3044\u3002\n\u4ed5\u65b9\u304c\u7121\u3044\u306e\u3067\u3001\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u78ba\u8a8d\u3057\u3001\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306f\u6d88\u3057\u3066\u3088\u3044\u3068\u3044\u3046\u57fa\u672c\u30eb\u30fc\u30eb2\u3092\u5236\u5b9a\u3059\u308b\u3002\u305f\u3060\u3001\u53ef\u80fd\u306a\u3089\u3070\u751f\u6210\u5143\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u65e2\u306b\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3082\u78ba\u8a8d\u3059\u308b\u65b9\u304c\u89aa\u5207\u3060\u3002\n\u3053\u3053\u3067\u3001\u4e00\u3064\u6ce8\u610f\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u3068\u3044\u3046\u5f79\u5272\u306f\u30011\u3064\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u5bfe\u3057\u30661\u3064\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3057\u304b\u4e0e\u3048\u3066\u306f\u306a\u3089\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u3060\u3002\u3082\u3057\u3001\u3042\u308b\u30d7\u30ed\u30bb\u30b9A\u304c\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u691c\u51fa\u3057\u3001\u4eca\u304b\u3089\u305d\u308c\u3092\u6d88\u3057\u3066\u65b0\u305f\u306b\u4f5c\u308a\u76f4\u305d\u3046\u3068\u3057\u3066\u3044\u308b\u6642\u3001\u30d7\u30ed\u30bb\u30b9B\u304c\u540c\u3058\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u53e4\u3044\u3068\u5224\u65ad\u3057\u3066\u524a\u9664\u3057\u3001\u65b0\u898f\u4f5c\u6210\u307e\u3067\u6e08\u307e\u305b\u3066\u3057\u307e\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u3060\u308d\u3046\u3002\u30d7\u30ed\u30bb\u30b9A\u306f\u3053\u306e\u5f8c\u3001\u30d7\u30ed\u30bb\u30b9B\u306e\u4f5c\u3063\u305f\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u8aa4\u3063\u3066\u6d88\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u3053\u308c\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u51fa\u3001\u524a\u9664\u3001\u4f5c\u308a\u76f4\u3057\u3068\u3044\u3046\u64cd\u4f5c\u304c\u3001\u30a2\u30c8\u30df\u30c3\u30af\u306b\uff08\u5358\u4e00\u64cd\u4f5c\u3067\uff09\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u5236\u7d04\u306b\u8d77\u56e0\u3059\u308b\u3002\u3088\u3063\u3066\u3001\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u5f79\u306f\u4e00\u4eba\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3042\u308b\u3002\n\u5c1a\u3001\u3053\u3053\u3067\u51fa\u3066\u304d\u305f\u300c\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u51fa\u3059\u308b\u300d\u3068\u3044\u3046\u51e6\u7406\u304cPOSIX\u306e\u7bc4\u56f2\u3067\u306f\u9762\u5012\u306a\u306e\u3060\u304c\u3001\u3053\u308c\u306b\u95a2\u3057\u3066\u306f\u904e\u53bb\u306e\u8a18\u4e8b\u300cfind\u30b3\u30de\u30f3\u30c9\u3067\u79d2\u5358\u4f4d\u306b\u65b0\u65e7\u6bd4\u8f03\u3057\u305f\u3044\u300d\u3067\u89e3\u6c7a\u3057\u3066\u304a\u3044\u305f\u306e\u3067\u3053\u3053\u3067\u306f\u5272\u611b\u3059\u308b\u3002\n\u4ee5\u4e0a\u3092\u8e0f\u307e\u3048\u3001\u5404\u30ed\u30c3\u30af\u3092\u5b9f\u73fe\u3059\u308b\u30a2\u30a4\u30c7\u30a2\u3092\u307e\u3068\u3081\u308b\u3002\n\n\u305d\u306e1. \u6392\u4ed6\u30ed\u30c3\u30af\u306f\u3069\u3046\u3084\u308b\uff1f\n\u6392\u4ed6\u30ed\u30c3\u30af\u3068\u306f\u3001\u8ab0\u306b\u3082\u90aa\u9b54\u3055\u308c\u306a\u3044\u552f\u4e00\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u7372\u5f97\u3059\u308b\u305f\u3081\u306e\u30ed\u30c3\u30af\u3060\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\n\n\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u65b9\u6cd5\u306f\u3044\u308d\u3044\u308d\u3042\u308b\n\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u3044\u3066\u6392\u4ed6\u30ed\u30c3\u30af\u3092\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u3068\u3044\u3046\u306e\u306f\u5b9f\u306f\u3088\u304f\u77e5\u3089\u308c\u3066\u304a\u308a\u3001\u5358\u7d14\u3067\u3042\u308b\u3002\u30ed\u30c3\u30af\u7ba1\u7406\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u3067\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308c\u3070\u3088\u3044\u308f\u3051\u3060\u304c\u3001\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\u306b\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u4f5c\u6210\u3059\u308b\u306b\u306f\u4f8b\u3048\u3070\u6b21\u306e\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n\nmkdir <\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>\n\n\nln -s <\u4f55\u304b\u306e\u5143\u30d5\u30a1\u30a4\u30eb> <\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>\n\n\nln <\u4f55\u304b\u306e\u5143\u30d5\u30a1\u30a4\u30eb> <\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>\n\n\n(set -C; : > <\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>)\n\n\n\u30dd\u30a4\u30f3\u30c8\u306f\u30a2\u30c8\u30df\u30c3\u30af\u306b\uff08\u5358\u4e00\u64cd\u4f5c\u3067\uff09\u4f5c\u308b\u3068\u3044\u3046\u70b9\u3067\u3042\u308b\u3002\u3064\u307e\u308a\u5b58\u5728\u78ba\u8a8d\u51e6\u7406\u3068\u4f5c\u6210\u51e6\u7406\u304c\u540c\u6642\u3068\u3044\u3046\u3053\u3068\u3060\u3002\u3082\u3057\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u3066\u3001\u3044\u3056\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u305f\u6642\u306b\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u7d20\u65e9\u304f\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u3067\u304d\u3066\u3057\u307e\u3046\u306e\u3067\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u552f\u4e00\u306e\u3082\u306e\u3067\u306f\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u79c1\u304c\u4f5c\u3063\u305f\u6392\u4ed6\u30ed\u30c3\u30af\u30b3\u30de\u30f3\u30c9\u201cpexlock\u201d\u3067\u306f\u6700\u5f8c\u306e\u65b9\u6cd5\u3092\u7528\u3044\u305f\u3002\u5f8c\u3067\u7d39\u4ecb\u3059\u308b\u5171\u6709\u30ed\u30c3\u30af\u30b3\u30de\u30f3\u30c9\u3067\u306f\u8907\u6570\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08mkdir\uff09\u3092\u7528\u3044\u3066\u304a\u308a\u3001\u305d\u308c\u3068\u533a\u5225\u3055\u305b\u308b\u305f\u3081\u3060\u3002\n\n\u305d\u306e2. \u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u306f\u3069\u3046\u3084\u308b?\n\u5171\u6709\u30ed\u30c3\u30af\u3068\u306f\u3001\u305d\u306e\u30ed\u30c3\u30af\u3092\u7533\u8acb\u3057\u305f\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306e\u30ed\u30c3\u30af\u3060\u3002\u81ea\u5206\u304c\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u9593\u3001\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u3082\u305d\u308c\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u306a\u3089\u8a31\u3059\u304c\u3001\u66f8\u304d\u8fbc\u307f\u8a31\u3055\u306a\u3044\u3001\u3068\u3044\u3046\u30d7\u30ed\u30bb\u30b9\u540c\u58eb\u304c\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u5171\u6709\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\n\u4e00\u65b9\u30bb\u30de\u30d5\u30a9\u3068\u306f\u3001\u5171\u6709\u30ed\u30c3\u30af\u306e\u6700\u5927\u5171\u6709\u6570\u3092\u5236\u9650\u3059\u308b\u30ed\u30c3\u30af\u3060\u3002\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6570\u3060\u3051\u30d7\u30ed\u30bb\u30b9\u3092\u540c\u6642\u306b\u8d70\u3089\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\u30bb\u30de\u30d5\u30a9\u306f\u5171\u6709\u30ed\u30c3\u30af\u306e\u5fdc\u7528\u3067\u5b9f\u73fe\u3067\u304d\u308b\u305f\u3081\u3001\u3053\u3053\u3067\u307e\u3068\u3081\u3066\u8aac\u660e\u3059\u308b\u3002\n\n2.1. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u306e\u69cb\u9020\n\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306b\u6bd4\u3079\u308b\u3068\u3060\u3044\u3076\u8907\u96d1\u3067\u3042\u308b\u304c\u3001\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u306f\u6b21\u306e\u69cb\u9020\u3092\u6301\u305f\u305b\u308b\u3002\n\n\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\"lockname_HOGE\"\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\nLOCKDIR/           \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\n|\n+-lockname_HOGE/   \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\uff08\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\n  |\n  +-lockname_HOGE/ \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\uff08\u540c\u540d\u306e\u5b50\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\n    |                 \u30fb\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u30cf\u30fc\u30c9\u30ea\u30f3\u30af\u6570-2\u304c\u5171\u6709\u6570\n    |\n    +-uniq_num1.pid1/ \u2190 \u5171\u6709\u30ed\u30c3\u30af\u3092\u304b\u3051\u308b\u5ea6\u306b\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30ed\u30c3\u30af\u540d\n    +-uniq_num2.pid2/    (\u4e00\u610f\u306a\u756a\u53f7+\u547c\u51fa\u5143\u30d7\u30ed\u30bb\u30b9ID)\n    :\n    |\n    + modifying  \u2190 \u4e0a\u8a18\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u8ffd\u52a0\u524a\u9664\u3059\u308b\u969b\u306e\n                   \u30a2\u30af\u30bb\u30b9\u6a29\u306e\u305f\u3081\u306e\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u4f5c\u696d\u6642\u306e\u307f\u5b58\u5728\uff09\n\n\n\u3053\u308c\u306b\u306f\u3044\u304f\u3064\u304b\u5de5\u592b\u304c\u51dd\u3089\u3057\u3066\u3042\u308b\u3002\n\n2.1.1. \u540c\u540d\u3067\u4e8c\u91cd\u5316\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\n\u306a\u305c\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4e8c\u91cd\u306b\u4f5c\u3063\u3066\u3044\u308b\u306e\u304b\u3002\u3053\u308c\u306f\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u3092\u30a2\u30c8\u30df\u30c3\u30af\u306b\u4f5c\u308b\u305f\u3081\u306e\u5de7\u5999\u306a\u4ed5\u639b\u3051\u3067\u3042\u308b\u3002\n\u5f8c\u3067\u6539\u3081\u3066\u8aac\u660e\u3059\u308b\u304c\u3001\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u306b\u306f\u3001\u5171\u6709\u4e2d\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u3063\u3066\u4e00\u610f\u306b\u4f5c\u3089\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u304c\u5fc5\u305a\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u3053\u308c\u306f\u5171\u6709\u4e2d\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u628a\u63e1\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3002\u305d\u308c\u3086\u3048\u3001\u3082\u3057\u4f55\u3082\u8003\u3048\u305a\u672c\u756a\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u76f4\u63a5\u306b\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u4f5c\u6210\u3057\u305f\u77ac\u9593\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306f\u7a7a\u3067\u3042\u308b\u305f\u3081\u3001\u5171\u6709\u30d7\u30ed\u30bb\u30b9\u304c0\uff08\u3082\u306f\u3084\u8ab0\u3082\u5171\u6709\u3057\u3066\u3044\u306a\u3044\uff09\u3068\u898b\u306a\u3055\u308c\u3066\u524a\u9664\u3055\u308c\u308b\u6050\u308c\u304c\u3042\u308b\u3002\u3088\u3063\u3066\u672c\u756a\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u76f4\u63a5\u4f5c\u308b\u3053\u3068\u306f\u907f\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\u305d\u3053\u3067\u3001\u4e88\u3081\u5225\u306e\u5b89\u5168\u306a\u5834\u6240\u3067\u30b5\u30d6\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u307e\u3067\u4e2d\u8eab\u3092\u4f5c\u3063\u3066\u304a\u304d\u3001mv\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u79fb\u52d5\u3055\u305b\u308b\u3002\u3068\u3053\u308d\u304c\u3082\u3057\u79fb\u52d5\u5148\u306b\u65e2\u5b58\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u3042\u308b\u3068\u901a\u5e38mv\u30b3\u30de\u30f3\u30c9\u306f\u3001\u305d\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3068\u3057\u3066\u79fb\u52d5\u3092\u6210\u529f\u3055\u305b\u3066\u3057\u307e\u3046\u3002\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u76f4\u4e0b\u306b\u308f\u3056\u308f\u3056\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u7f6e\u304f\u306e\u306f\u3053\u306e\u554f\u984c\u3078\u306e\u5bfe\u7b56\u3067\u3042\u308b\u3002\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u76f4\u4e0b\u306b\u3042\u308c\u3070\u3001mv\u30b3\u30de\u30f3\u30c9\u3082\u79fb\u52d5\u3092\u8ae6\u3081\u3066\u304f\u308c\u308b\u3002\n\n2.1.2. \u4e2d\u306b<\u56fa\u6709\u756a\u53f7+\u30d7\u30ed\u30bb\u30b9ID>\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u308b\n\u3053\u308c\u307e\u305f\u5de7\u5999\u306a\u4ed5\u639b\u3051\u3060\u3002\u5148\u7a0b\u8aac\u660e\u3057\u305f\u4e8c\u968e\u5c64\u540c\u540d\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e0b\u5c64\u5074\uff08\u5b50\uff09\u306b\u3001\u5171\u6709\u30ed\u30c3\u30af\u3092\u5e0c\u671b\u3059\u308b\u5404\u30d7\u30ed\u30bb\u30b9\u304c\u3055\u3089\u306b1\u3064\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u308b\u3002\u3053\u306e\u969b\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u540d\u304c\u885d\u7a81\u3057\u306a\u3044\u3088\u3046\u306b<\u56fa\u6709\u756a\u53f7+\u547c\u51fa\u5143\u30d7\u30ed\u30bb\u30b9ID>\u3068\u3044\u3046\u547d\u540d\u898f\u5247\uff08\u56fa\u6709\u756a\u53f7\u306f\u3001\u4f5c\u6210\u65e5\u6642\u3068\u4f5c\u6210\u30d7\u30ed\u30bb\u30b9ID\u306b\u57fa\u3065\u3044\u3066\u4f5c\u308c\u3070\u3088\u3044\uff09\u306b\u3088\u308b\u4e00\u610f\u306a\u540d\u79f0\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\uff09\u3092\u4ed8\u3051\u308b\u3002\n\u76ee\u7684\u306f\u5148\u7a0b\u3082\u8ff0\u3079\u305f\u304c\u3001\u73fe\u5728\u306e\u5171\u6709\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u628a\u63e1\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3002\u5171\u6709\u6570\u304c\u628a\u63e1\u3067\u304d\u308c\u3070\u5f8c\u8ff0\u3059\u308b\u30bb\u30de\u30d5\u30a9\uff08\u5171\u6709\u6570\u306b\u5236\u9650\u3092\u8a2d\u3051\u308b\uff09\u3092\u5b9f\u73fe\u3067\u304d\u308b\u3057\u3001\u307e\u305f\u5171\u6709\u65700\u306b\u306a\u3063\u305f\u969b\u306b\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u3044\u3046\u5224\u65ad\u3082\u3067\u304d\u308b\u3002\n\u3067\u306f\u5177\u4f53\u7684\u306b\u3069\u3046\u3084\u3063\u3066\u5171\u6709\u6570\u3092\u628a\u63e1\u3059\u308b\u304b? \u4e2d\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u6570\u3092\u7d20\u76f4\u306b\u6570\u3048\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3082\u3042\u308b\u304c\u3001\u3082\u3063\u3068\u8efd\u3044\u65b9\u6cd5\u304c\u3042\u308b\u3002\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09\u306e\u30cf\u30fc\u30c9\u30ea\u30f3\u30af\u6570\u3092\u898b\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3060\u3002\nls -ld <\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09>\n\u3092\u5b9f\u884c\u3057\u305f\u6642\u30012\u5217\u76ee\u306b\u8868\u793a\u3055\u308c\u308b\u6570\u5b57\u304c\u305d\u308c\u3067\u3042\u308b\u3002\u3053\u306e\u6570\u5b57\u3092-2\u3059\u308b\u3068\u3001\u76f4\u4e0b\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u6570\u306b\u306a\u308b\uff08\u7406\u7531\u306f\u5272\u611b\uff09\u3002\u5f93\u3063\u3066\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u30672\u5217\u76ee\u306e\u6570\u3092\u53d6\u5f97\u3059\u308c\u3070\u3001\u3044\u3061\u3044\u3061\u5168\u90e8\u6570\u3048\u305a\u3068\u3082\u3001\u5171\u6709\u6570\u3092\u8a08\u7b97\u3067\u304d\u308b\u306e\u3067\u3042\u308b\u3002\n\n2.1.3. \u5171\u6709\u6570\u3092\u5897\u6e1b\u30fb\u53c2\u7167\u3059\u308b\u969b\u306f\u3001\u66f4\u306b\u6392\u4ed6\u30ed\u30c3\u30af\n\n\u5171\u6709\u6570\u304c0\u3060\u3063\u305f\u3089\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\u3059\u308b\n\u5171\u6709\u6570\u304c\u4e0a\u9650\u306b\u9054\u3057\u305f\u3089\u305d\u308c\u4ee5\u4e0a\u306e\u5171\u6709\u3092\u62d2\u5426\u3059\u308b\uff08\u30bb\u30de\u30d5\u30a9\u5236\u5fa1\uff09\n\n\u3068\u3044\u3063\u305f\u64cd\u4f5c\u306f\u3001\u3069\u3046\u3057\u3066\u3082\u30a2\u30c8\u30df\u30c3\u30af\u306b\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\u5171\u6709\u6570\u3092\u8abf\u3079\u3066\u51e6\u7406\u3092\u6c7a\u3081\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u6642\u306b\u5171\u6709\u6570\u304c\u5909\u5316\u3057\u3066\u3057\u307e\u3046\u6050\u308c\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u3001\u5171\u6709\u6570\u3092\u53c2\u7167\u3059\u308b\u6642\u3068\u5171\u6709\u6570\u3092\u5897\u6e1b\u3055\u305b\u308b\u6642\u306f\u3001\u305d\u3053\u3067\u66f4\u306b\u6392\u4ed6\u30ed\u30c3\u30af\u3092\u639b\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\u5171\u6709\u6570\u3092\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u306f\u4eca\u5217\u6319\u3057\u305f\u3068\u304a\u308a\u3060\u304c\u3001\u5897\u6e1b\u3055\u305b\u305f\u3044\u6642\u3068\u3044\u3046\u306e\u306f\u6b21\u306e\u5834\u5408\u3067\u3042\u308b\u3002\n\n\u5171\u6709\u30ed\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\n\u5171\u6709\u30ed\u30c3\u30af\u3092\u524a\u9664\u3057\u305f\u3044\u5834\u5408\n\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09\u5185\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u3046\u3061\u53e4\u3044\u3082\u306e\u3092\u3001\u57fa\u672c\u30eb\u30fc\u30eb2\u306b\u5f93\u3063\u3066\u4e00\u6589\u524a\u9664\u3057\u305f\u3044\u5834\u5408\n\n\u4ee5\u4e0a\u3001\u5217\u6319\u3057\u305f\u64cd\u4f5c\u3092\u884c\u3046\u5834\u5408\u306b\u4f5c\u308b\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u304c\n<\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09>/modifying\n\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b\u3002\n\n2.2. \u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u306e\u5b9f\u88c5\u306e\u307e\u3068\u3081\n\u4ee5\u4e0a\u306e\u7406\u5c48\u306b\u57fa\u3065\u3044\u3066\u30b3\u30fc\u30c9\u306b\u8d77\u3053\u3057\u3066\u307f\u305f\u3082\u306e\u3092\u3044\u304f\u3064\u304b\u4f8b\u793a\u3059\u308b\u3002\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u306b\u306f\u7570\u5e38\u7cfb\u306e\u51e6\u7406\u7b49\u304c\u3042\u308a\u3001\u3053\u308c\u3088\u308a\u8fbc\u307f\u5165\u3063\u3066\u3044\u308b\u304c\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u305d\u308c\u3089\u306f\u66f8\u3044\u3066\u3044\u306a\u3044\u3002\n\n2.2.1. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u65b0\u898f\u4f5c\u6210\n\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u65b0\u898f\u4f5c\u6210\u3059\u308b\u90e8\u5206\u306e\u30b3\u30fc\u30c9\u3067\u3042\u308b\u3002\u5b89\u5168\u306a\u5834\u6240\u30672.1.\u3067\u8a18\u3057\u305f\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306bmv\u30b3\u30de\u30f3\u30c9\u3067\u79fb\u52d5\u3057\u3066\u3044\u308b\u3002\u3082\u3057mv\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u3001\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u6b21\u306b\u4f8b\u793a\u3059\u308b\u30b7\u30a7\u30eb\u95a2\u6570add_shlock()\u3078\u9032\u3080\u3002\n\n\u5171\u6709\u30ed\u30c3\u30af\u65b0\u898f\u4f5c\u6210\u30b5\u30f3\u30d7\u30eb\nLOCKDIR=\"/PATH/TO/LOCKDIR\" # \u30ed\u30c3\u30af\u306e\u7ba1\u7406\u3092\u884c\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\nlockname=\"\u30ed\u30c3\u30af\u540d\"        # \u5171\u6709\u30ed\u30c3\u30af\u540d\nMAX_SHARING_PROCS=\u4e0a\u9650\u6570   # \u30bb\u30de\u30d5\u30a9\u30e2\u30fc\u30c9\u306e\u5834\u5408\u306b\u4f7f\u3046\u4e0a\u9650\u6570\n\n# \u5b89\u5168\u306a\u5834\u6240\u3067\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\ncallerpid=$(ps -o pid,ppid | awk '$2=='$$'{print $1;exit}')\nsublockname=$(date +%Y%m%d%H%M%S).$$.$callerpid\ntmpdir=\"$LOCKDIR/.preshlock.$sublockname\"\nshlockdir_pre=\"$tmpdir/$lockname/$lockname/$sublockname\"\nmkdir -p $shlockdir_pre\n\n# \u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3078\u306e\u79fb\u52d5\u3092\u8a66\u307f\u308b\ntry=3 # \u30ea\u30c8\u30e9\u30a4\u6570\nwhile [ $try -gt 0 ]; do\n  # mv\u306b\u6210\u529f\u3057\u305f\u3089\u65b0\u898f\u4f5c\u6210\u6210\u529f\n  mv $shlockdir_pre $LOCKDIR 2>/dev/null && {\n    echo \"$LOCKDIR/$lockname/$lockname/$sublockname\" # \u5f8c\u3067\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u3001\n    break                                            # \u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u8fd4\u3059\n  }\n\n  # \u5931\u6557\u3057\u305f\u3089\u8ffd\u52a0\u4f5c\u6210\u30e2\u30fc\u30c9\u3067\u8a66\u307f\u308b\n  add_shlock && break  # add_shlock()\u306e\u4e2d\u8eab\u306f\u5225\u9014\u8aac\u660e\n\n  try=$((try-1))\n  [ $try -gt 0 ] && sleep 1                          # \u30ea\u30c8\u30e9\u30a4\u3059\u308b\u5834\u5408\u306f1\u79d2\u5f85\u3064\ndone\ncase $try in 0) echo \"timeout, try again later\";exit 1;; esac\n\n# \u5b89\u5168\u306a\u5834\u6240\u3068\u3057\u3066\u4f5c\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\nrm -rf \"$tmpdir\"\n\n\n\u5c1a\u3001\u300c\u5b89\u5168\u306a\u5834\u6240\u300d\u3092\u78ba\u4fdd\u3059\u308b\u305f\u3081\u306b\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u306b.preshlock.<\u30b5\u30d6\u30ed\u30c3\u30af\u540d>\u3068\u3044\u3046\u4e00\u610f\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u3063\u3066\u3044\u308b\u3002\u305d\u306e\u305f\u3081\u3001^\\.preshlock\\.[0-9.]+$\u306b\u8a72\u5f53\u3059\u308b\u30ed\u30c3\u30af\u540d\u306f\u4e88\u7d04\u540d\u3068\u3057\u3066\u4f7f\u7528\u7981\u6b62\u3068\u3059\u308b\u3002\n\n2.2.2. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u8ffd\u52a0\u4f5c\u6210\n\u524d\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u65b0\u898f\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306b\u306f\u3053\u3061\u3089\u306e\u30b7\u30a7\u30eb\u95a2\u6570add_shlock()\u306b\u3084\u3063\u3066\u304f\u308b\u3002\n\u5171\u6709\u6570\u3092\u5897\u6e1b\u30fb\u53c2\u7167\u3059\u308b\u306e\u3067\u307e\u305a\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30ebmodifying\u3092\u4f5c\u308a\u3001\u5171\u6709\u6570\u304c\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u306a\u3044\u304b\u8abf\u3079\u3001\u9054\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30921\u3064\u4f5c\u308b\u3002\u6700\u5f8c\u306b\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u306e\u3082\u5fd8\u308c\u306c\u3088\u3046\u306b\u3059\u308b\u3002\n\nadd_shlock()\u2026\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u8ffd\u52a0\u4f5c\u6210\u30b5\u30f3\u30d7\u30eb\nadd_shlock() {\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\uff08\u5931\u6557\u3057\u305f\u3089\u30b7\u30a7\u30eb\u95a2\u6570\u7d42\u4e86\uff09\n  (set -C; : >$LOCKDIR/$lockname/$lockname/modifying) || return 1\n\n  # \u5171\u6709\u6570\uff08=\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb(\u5b50)\u306e\u6570-2\uff09\u304c\u5236\u9650\u3092\u8d85\u3048\u3066\u3044\u306a\u3044\u304b\n  # \u203b \u3053\u306e\u51e6\u7406\u306f\u30bb\u30de\u30d5\u30a9\u5236\u5fa1\u306e\u5834\u5408\u306e\u307f\n  n=$(ls -dl $LOCKDIR/$lockname/$lockname | awk '{$2-2}')\n  [ $n -ge $MAX_SHARING_PROCS ] || return 1 # \u8d85\u904e\u6642\u306f\u95a2\u6570\u7d42\u4e86\n\n  # \u5171\u6709\u30ed\u30c3\u30af\u8ffd\u52a0\n  sublockname=$(date +%Y%m%d%H%M%S).$$.$callerpid\n  mkdir $tmpdir/$lockname/$lockname/$sublockname\n  echo \"$LOCKDIR/$lockname/$lockname/$sublockname\" # \u5f8c\u3067\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u3001\n                                                   # \u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30d1\u30b9\u3092\u8fd4\u3059\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u89e3\u653e\n  rm $LOCKDIR/$lockname/$lockname/modifying\n}\n\n\n\n2.2.3. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u524a\u9664\n\u81ea\u5206\u3067\u4f5c\u3063\u305f\u5171\u6709\u30ed\u30c3\u30af\u3092\u524a\u9664\u3059\u308b\u5834\u5408\u306f\u3001\u30ed\u30c3\u30af\u6210\u529f\u6642\u306b\u6e21\u3055\u308c\u305f\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u307e\u3067\u542b\u3080\uff09\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6e21\u3059\u3002\u305d\u308c\u306b\u57fa\u3065\u3044\u3066\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\u3001\u66f4\u306b\u53e4\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3082\u524a\u9664\u3057\u305f\u7d50\u679c\u3001\u5171\u6709\u65700\u306b\u306a\u3063\u3066\u3044\u305f\u3089\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3054\u3068\u524a\u9664\u3059\u308b\u3002\n\n\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u524a\u9664\u30b5\u30f3\u30d7\u30eb\nlockfile=\"\u3053\u3053\u306b\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u540d\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u307e\u3067\u542b\u3080\uff09\"\n\ntry=3 # \u30ea\u30c8\u30e9\u30a4\u6570\nwhile [ $try -gt 0 ]; do\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\n  (set -C; : >${lockfile#/*}/modifying) && break\n\n  try=$((try-1))\n  [ $try -gt 0 ] && sleep 1\ndone\ncase $try in 0) echo \"timeout, try again later\";exit 1;; esac\n\n# \u30ed\u30c3\u30af\u89e3\u9664\u5bfe\u8c61\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\nrmdir $lockfile\n\n# \u5171\u6709\u6570\uff08=\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb(\u5b50)\u306e\u6570-2\uff09\u304c0\u306a\u3089\u5171\u6709\u30ed\u30c3\u30afdir\u81ea\u8eab\u3092\u524a\u9664\nn=$(ls -dl ${lockfile#/*} | awk '{$2-2}')\nif [ $n -le 0 ]; then\n  rm -rf ${lockfile#/*}/..\nelse\n  # \u5171\u6709\u6570\u304c0\u3067\u306a\u3051\u308c\u3070\u3001\u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u89e3\u653e\u3059\u308b\u306e\u307f\n  rm ${lockfile#/*}/modifying\nfi\n\n\n\n\u3044\u3084\u3041\u3001\u5171\u6709\u30ed\u30c3\u30af\u306f\u5927\u5909\u3060\u3002\n\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u5de7\u5999\u306a\u6280\u3092\u3044\u304f\u3064\u304b\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u3082POSIX\u306e\u7bc4\u56f2\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u5b9f\u73fe\u3067\u304d\u308b\u3002\uff08\u5b9f\u969b\u306e\u30b3\u30de\u30f3\u30c9\u2192pexlock\u30b3\u30de\u30f3\u30c9\u3001pshlock\u30b3\u30de\u30f3\u30c9\u3001punlock\u30b3\u30de\u30f3\u30c9\u3001pcllock\u30b3\u30de\u30f3\u30c9\uff09\n\u3060\u304c\u3001\u3053\u3053\u307e\u3067\u8907\u96d1\u3060\u3068\u3082\u306f\u3084\u30d1\u30ba\u30eb\u3060\u3002\u5de7\u5999\u306a\u69cb\u9020\u306b\u3057\u305f\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u307f\u306a\u3089\u305a\u3001\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\uff08pcllock\u30b3\u30de\u30f3\u30c9\u5185\u3067\u5b9f\u88c5\uff09\u306b\u306f\u65e5\u6642\u8a08\u7b97\u304c\u5fc5\u8981\u3067\u3042\u308b\u305f\u3081\u524d\u8ff0\u306e\u5225\u8a18\u4e8b\u306e\u6280\u3092\u99c6\u4f7f\u3057\u3001\u304b\u306a\u308a\u5927\u639b\u304b\u308a\u3060\u3002\n\u3068\u306f\u3044\u3046\u3082\u306e\u306e\u3001\u3053\u3046\u3057\u3066\u4f55\u3068\u304b\u30b3\u30de\u30f3\u30c9\u5316\u3057\u3066\u3057\u307e\u3048\u305f\u306e\u3060\u304b\u3089\u3001\u4eca\u5f8c\u306f\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u7c21\u5358\u306b\u30ed\u30c3\u30af\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3046\u3048\u3001\u540c\u6642\u306b\u3069\u306eUNIX\u3067\u3082\u3001\u5c06\u6765\u9577\u304d\u306b\u6e21\u308a\u52d5\u304f\u3068\u3044\u3046\u7a76\u6975\u306e\u53ef\u642c\u6027\u3092\u5099\u3048\u305f\u30ed\u30c3\u30af\u304c\u624b\u306b\u5165\u3063\u305f\u3002POSIX\u539f\u7406\u4e3b\u7fa9\u4e07\u6b73!!\n# \u3069\u306eUNIX\u3067\u3082\u901a\u7528\u3059\u308b\u30ed\u30c3\u30af\u6a5f\u69cb\u306f\u3042\u308b\u306e\u304b?\n\n\u4ed6\u8a00\u8a9e\u3067\u306f\u5927\u62b5\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u30ed\u30c3\u30af\u6a5f\u69cb\u3067\u3042\u308b\u304c\u3001**\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u306f\u30ed\u30c3\u30af\u6a5f\u69cb\u3092\u76f4\u63a5\u5b9f\u73fe\u3059\u308b\u30b3\u30de\u30f3\u30c9\u304c\u7121\u3044\u3002**[flock\u30b3\u30de\u30f3\u30c9](http://linuxjm.sourceforge.jp/html/util-linux/man1/flock.1.html)\u3084[lockf\u30b3\u30de\u30f3\u30c9](http://www.jp.freebsd.org/cgi/mroff.cgi?subdir=man&man=lockf&dir=jpman-5.4.0%2Fman)\u306a\u3069OS\u306b\u3088\u3063\u3066\u306f\u72ec\u81ea\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u304c\u3001OS\u72ec\u81ea\u3086\u3048\u3001\u305d\u308c\u3089\u3092\u4f7f\u3063\u3066\u3057\u307e\u3046\u3068\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u53ef\u642c\u6027\u306f\u5931\u308f\u308c\u3066\u3057\u307e\u3046\u3002\uff08\u3057\u304b\u3082\u524d\u8ff0\u306e2\u3064\u306e\u30b3\u30de\u30f3\u30c9\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u30ed\u30c3\u30af\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3042\u308b\u3046\u3048\u306b\u3001\u30ed\u30c3\u30af\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u9593\u306f\u6b21\u306e\u884c\u306b\u9032\u3081\u306a\u3044\uff09\n\n\u300c\u7279\u5b9a\u306eOS\u306b\u7e1b\u3089\u308c\u3066\u3057\u307e\u3046\u304f\u3089\u3044\u306a\u3089\u4ed6\u306e\u8a00\u8a9e\u3092\u4f7f\u3046\u65b9\u304c\u3088\u3063\u307d\u3069\u30de\u30b7\u3060\u300d\u3068\u3044\u3063\u3066\u3001\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u4fe1\u8005\uff08POSIX\u539f\u7406\u4e3b\u7fa9\u8005\uff09\u3092\u5897\u3084\u305b\u306a\u3044\u306e\u304c\u6094\u3057\u304b\u3063\u305f\u306e\u3060\u304c\u3001\u3088\u3046\u3084\u304f\u4f5c\u308b\u306e\u306b\u6210\u529f\u3057\u305f\u306e\u3067\u5831\u544a\u3059\u308b\u3002\n\n\u3053\u308c\u3067\u3001\n\n* **\u6392\u4ed6\u30ed\u30c3\u30af**\u2026\u2026\u2026\u2026\u2026\u2026\u2026[pexlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pexlock)\n* **\u5171\u6709\u30ed\u30c3\u30af**\u2026\u2026\u2026\u2026\u2026\u2026\u2026[pshlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pshlock)\n* **\u30bb\u30de\u30d5\u30a9**\u2026\u2026\u2026\u2026\u2026\u2026\u2026\u2026\uff08pshlock\u30b3\u30de\u30f3\u30c9\u3001\u5171\u6709\u30ed\u30c3\u30af\u306e\u5fdc\u7528\uff09\n* \u4e0a\u8a18\u306e\u30ed\u30c3\u30af\u89e3\u9664\u2026\u2026\u2026\u2026[punlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pshlock)\n* \u89e3\u9664\u6f0f\u308c\u30d5\u30a1\u30a4\u30eb\u306e\u6e05\u6383\u2026[pcllock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pcllock)\n\n\u304c\u3001POSIX\u306e\u7bc4\u56f2\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3002\u80fd\u66f8\u304d\u306f\u3044\u3044\u304b\u3089\u4f7f\u3044\u305f\u3044\u3068\u3044\u3046\u4eba\u306f\u3001\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3082\u3089\u3063\u3066\uff08\u3054\u304f\u7c21\u5358\u306a\u4f7f\u3044\u65b9\u306f\u30b3\u30de\u30f3\u30c9\u30bd\u30fc\u30b9\u306e\u5192\u982d\u306b\u8a18\u3057\u3066\u3042\u308b\uff09\u3001\u672c\u8a18\u4e8b\u3067\u306f\u3044\u304b\u306b\u305d\u308c\u3089\u3092\u5b9f\u73fe\u3057\u305f\u304b\u3068\u3044\u3046\u30a2\u30a4\u30c7\u30a2\u3092\u307e\u3068\u3081\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n# \u305d\u306e0. \u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u65b9\u6cd5\n\n\u30ed\u30c3\u30af\u306b\u95a2\u9023\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3092\u53f8\u308b\u30b3\u30de\u30f3\u30c9\u306fPOSIX\u7bc4\u56f2\u306b\u306f\u306a\u3044\u3002\u3067\u306f\u4f55\u3092\u4f7f\u3063\u3066\u7ba1\u7406\u3059\u308b\u304b\u3068\u3044\u3048\u3070\u3001\u30d5\u30a1\u30a4\u30eb\u3060\u3002**1\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u76f4\u4e0b\u306b\u306f\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u304c1\u3064\u3057\u304b\u5b58\u5728\u3067\u304d\u306a\u3044**\u3001\u3068\u3044\u3046\u6027\u8cea\u3092\u8ce2\u304f\u5229\u7528\u3059\u308b\u306e\u304c\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30ed\u30c3\u30af\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306e\u539f\u7406\u3067\u3042\u308b\u3002\n\n\u30d9\u30bf\u306a\u65b9\u6cd5\u3060\u3068\u898b\u304f\u3073\u308b\u3053\u3068\u306a\u304b\u308c\u3002\u3082\u3068\u3082\u3068OS\u306f\u3001\u7269\u7406\u7684\u306b1\u53f0\u3057\u304b\u306a\u3044HDD\u3078\u306e\u30a2\u30af\u30bb\u30b9\u8981\u6c42\u3092\u634c\u304f\u305f\u3081\u306b\u5185\u90e8\u3067\u5fc5\u305a\u6392\u4ed6\u5236\u5fa1\u3092\u3084\u3063\u3066\u3044\u308b\u3002**\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u308b\u30ed\u30c3\u30af\u7ba1\u7406\u3068\u306f\u3001OS\u304c\u5099\u3048\u3066\u3044\u308b\u6d17\u7df4\u3055\u308c\u305f\u6392\u4ed6\u5236\u5fa1\u6a5f\u69cb\u306e\u6d3b\u7528**\u306b\u4ed6\u306a\u3089\u306a\u3044!\n\n## \u57fa\u672c\u30eb\u30fc\u30eb1. \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308c\u305f\u8005\u52dd\u3061\n\n\u3082\u3046\u5c11\u3057\u5177\u4f53\u7684\u306b\u8a00\u3048\u3070\u3001\u30ed\u30c3\u30af\u7ba1\u7406\u306e\u305f\u3081\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30921\u3064\u7528\u610f\u3057\u2026\u2026\n\n* \u65e9\u3044\u8005\u52dd\u3061\u3067\u30d5\u30a1\u30a4\u30eb\uff08\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff09\u3092\u4f5c\u308b\u3002\n* \u300c\u6210\u529f\u8005\u306f\u30ed\u30c3\u30af\u6210\u529f\uff08\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\uff09\u300d\u3068\u53d6\u308a\u6c7a\u3081\u308b\u3002\n* \u5931\u6557\u8005\u306f\u66ab\u304f\u3057\u3066\u304b\u3089\u518d\u5ea6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3092\u8a66\u307f\u308b\u3002\n* \u6210\u529f\u8005\u306f\u7528\u4e8b\u304c\u6e08\u3093\u3060\u3089\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u6d88\u3059\u3002\n\n\u3067\u3042\u308b\u3002\u3053\u308c\u3092\u57fa\u672c\u30eb\u30fc\u30eb1\u3068\u3057\u3066\u5236\u5b9a\u3059\u308b\u3002\n\n## \u57fa\u672c\u30eb\u30fc\u30eb2. \u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306f\u6d88\u3057\u3066\u3088\u3044\n\n\u305f\u3060\u3001\u6210\u529f\u8005\u304c\u30ed\u30c3\u30af\u3092\u3057\u305f\u307e\u307e\u6d88\u3057\u5fd8\u308c\u305f\u308a\u3001\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7570\u5e38\u7d42\u4e86\u3057\u3066\u3057\u307e\u3046\u3068\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u7d1b\u5931\u3055\u308c\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308b\u3002\u3053\u308c\u306f\u7d42\u4e86\u30b7\u30b0\u30ca\u30eb\u3092\u691c\u51fa\uff08trap\u30b3\u30de\u30f3\u30c9\u3067\uff09\u3057\u305f\u3089\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u7b49\u3067\u3042\u308b\u7a0b\u5ea6\u5bfe\u5fdc\u3067\u304d\u308b\u304c\u3001SIGKILL\uff08\u5f37\u5236\u7d42\u4e86\uff09\u306a\u3069\u304c\u3042\u308b\u306e\u3067\u5b8c\u5168\u3067\u306f\u306a\u3044\u3002\n\n\u4ed5\u65b9\u304c\u7121\u3044\u306e\u3067\u3001\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u78ba\u8a8d\u3057\u3001**\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306f\u6d88\u3057\u3066\u3088\u3044**\u3068\u3044\u3046\u57fa\u672c\u30eb\u30fc\u30eb2\u3092\u5236\u5b9a\u3059\u308b\u3002\u305f\u3060\u3001\u53ef\u80fd\u306a\u3089\u3070\u751f\u6210\u5143\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u65e2\u306b\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3082\u78ba\u8a8d\u3059\u308b\u65b9\u304c\u89aa\u5207\u3060\u3002\n\n\u3053\u3053\u3067\u3001\u4e00\u3064\u6ce8\u610f\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002**\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u3068\u3044\u3046\u5f79\u5272\u306f\u30011\u3064\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u5bfe\u3057\u30661\u3064\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3057\u304b\u4e0e\u3048\u3066\u306f\u306a\u3089\u306a\u3044**\u3068\u3044\u3046\u3053\u3068\u3060\u3002\u3082\u3057\u3001\u3042\u308b\u30d7\u30ed\u30bb\u30b9A\u304c\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u691c\u51fa\u3057\u3001\u4eca\u304b\u3089\u305d\u308c\u3092\u6d88\u3057\u3066\u65b0\u305f\u306b\u4f5c\u308a\u76f4\u305d\u3046\u3068\u3057\u3066\u3044\u308b\u6642\u3001\u30d7\u30ed\u30bb\u30b9B\u304c\u540c\u3058\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u53e4\u3044\u3068\u5224\u65ad\u3057\u3066\u524a\u9664\u3057\u3001\u65b0\u898f\u4f5c\u6210\u307e\u3067\u6e08\u307e\u305b\u3066\u3057\u307e\u3063\u305f\u3089\u3069\u3046\u306a\u308b\u3060\u308d\u3046\u3002\u30d7\u30ed\u30bb\u30b9A\u306f\u3053\u306e\u5f8c\u3001\u30d7\u30ed\u30bb\u30b9B\u306e\u4f5c\u3063\u305f\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u8aa4\u3063\u3066\u6d88\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308b\u3002\u3053\u308c\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u51fa\u3001\u524a\u9664\u3001\u4f5c\u308a\u76f4\u3057\u3068\u3044\u3046\u64cd\u4f5c\u304c\u3001\u30a2\u30c8\u30df\u30c3\u30af\u306b\uff08\u5358\u4e00\u64cd\u4f5c\u3067\uff09\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u5236\u7d04\u306b\u8d77\u56e0\u3059\u308b\u3002\u3088\u3063\u3066\u3001\u53e4\u3044\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u5f79\u306f\u4e00\u4eba\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3042\u308b\u3002\n\n\u5c1a\u3001\u3053\u3053\u3067\u51fa\u3066\u304d\u305f\u300c\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u51fa\u3059\u308b\u300d\u3068\u3044\u3046\u51e6\u7406\u304cPOSIX\u306e\u7bc4\u56f2\u3067\u306f\u9762\u5012\u306a\u306e\u3060\u304c\u3001\u3053\u308c\u306b\u95a2\u3057\u3066\u306f\u904e\u53bb\u306e\u8a18\u4e8b\u300c[find\u30b3\u30de\u30f3\u30c9\u3067\u79d2\u5358\u4f4d\u306b\u65b0\u65e7\u6bd4\u8f03\u3057\u305f\u3044](http://qiita.com/richmikan@github/items/aba490d479afab4029a8)\u300d\u3067\u89e3\u6c7a\u3057\u3066\u304a\u3044\u305f\u306e\u3067\u3053\u3053\u3067\u306f\u5272\u611b\u3059\u308b\u3002\n\n\u4ee5\u4e0a\u3092\u8e0f\u307e\u3048\u3001\u5404\u30ed\u30c3\u30af\u3092\u5b9f\u73fe\u3059\u308b\u30a2\u30a4\u30c7\u30a2\u3092\u307e\u3068\u3081\u308b\u3002\n\n# \u305d\u306e1. \u6392\u4ed6\u30ed\u30c3\u30af\u306f\u3069\u3046\u3084\u308b\uff1f\n\n\u6392\u4ed6\u30ed\u30c3\u30af\u3068\u306f\u3001\u8ab0\u306b\u3082\u90aa\u9b54\u3055\u308c\u306a\u3044\u552f\u4e00\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u7372\u5f97\u3059\u308b\u305f\u3081\u306e\u30ed\u30c3\u30af\u3060\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u66f8\u304d\u3059\u308b\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\n\n## \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u65b9\u6cd5\u306f\u3044\u308d\u3044\u308d\u3042\u308b\n\n\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u3044\u3066\u6392\u4ed6\u30ed\u30c3\u30af\u3092\u5b9f\u73fe\u3059\u308b\u65b9\u6cd5\u3068\u3044\u3046\u306e\u306f\u5b9f\u306f\u3088\u304f\u77e5\u3089\u308c\u3066\u304a\u308a\u3001\u5358\u7d14\u3067\u3042\u308b\u3002\u30ed\u30c3\u30af\u7ba1\u7406\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u3067\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308c\u3070\u3088\u3044\u308f\u3051\u3060\u304c\u3001\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u5834\u5408\u306b\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u4f5c\u6210\u3059\u308b\u306b\u306f\u4f8b\u3048\u3070\u6b21\u306e\u65b9\u6cd5\u304c\u3042\u308b\u3002\n\n* `mkdir` *<\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>*\n* `ln -s` *<\u4f55\u304b\u306e\u5143\u30d5\u30a1\u30a4\u30eb>* *<\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>*\n* `ln` *<\u4f55\u304b\u306e\u5143\u30d5\u30a1\u30a4\u30eb>* *<\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>*\n* `(set -C; : >` *<\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb>*`)`\n\n\u30dd\u30a4\u30f3\u30c8\u306f\u30a2\u30c8\u30df\u30c3\u30af\u306b\uff08\u5358\u4e00\u64cd\u4f5c\u3067\uff09\u4f5c\u308b\u3068\u3044\u3046\u70b9\u3067\u3042\u308b\u3002\u3064\u307e\u308a**\u5b58\u5728\u78ba\u8a8d\u51e6\u7406\u3068\u4f5c\u6210\u51e6\u7406\u304c\u540c\u6642**\u3068\u3044\u3046\u3053\u3068\u3060\u3002\u3082\u3057\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u3066\u3001\u3044\u3056\u4f5c\u6210\u3057\u3088\u3046\u3068\u3057\u305f\u6642\u306b\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u7d20\u65e9\u304f\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u3067\u304d\u3066\u3057\u307e\u3046\u306e\u3067\u30a2\u30af\u30bb\u30b9\u6a29\u304c\u552f\u4e00\u306e\u3082\u306e\u3067\u306f\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\n\u79c1\u304c\u4f5c\u3063\u305f\u6392\u4ed6\u30ed\u30c3\u30af\u30b3\u30de\u30f3\u30c9\u201c[pexlock](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pexlock)\u201d\u3067\u306f\u6700\u5f8c\u306e\u65b9\u6cd5\u3092\u7528\u3044\u305f\u3002\u5f8c\u3067\u7d39\u4ecb\u3059\u308b\u5171\u6709\u30ed\u30c3\u30af\u30b3\u30de\u30f3\u30c9\u3067\u306f\u8907\u6570\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08mkdir\uff09\u3092\u7528\u3044\u3066\u304a\u308a\u3001\u305d\u308c\u3068\u533a\u5225\u3055\u305b\u308b\u305f\u3081\u3060\u3002\n\n# \u305d\u306e2. \u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u306f\u3069\u3046\u3084\u308b?\n\n\u5171\u6709\u30ed\u30c3\u30af\u3068\u306f\u3001\u305d\u306e\u30ed\u30c3\u30af\u3092\u7533\u8acb\u3057\u305f\u5168\u3066\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306e\u30ed\u30c3\u30af\u3060\u3002\u81ea\u5206\u304c\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\u9593\u3001\u4ed6\u306e\u30d7\u30ed\u30bb\u30b9\u3082\u305d\u308c\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u306a\u3089\u8a31\u3059\u304c\u3001\u66f8\u304d\u8fbc\u307f\u8a31\u3055\u306a\u3044\u3001\u3068\u3044\u3046\u30d7\u30ed\u30bb\u30b9\u540c\u58eb\u304c\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u5171\u6709\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\n\n\u4e00\u65b9\u30bb\u30de\u30d5\u30a9\u3068\u306f\u3001\u5171\u6709\u30ed\u30c3\u30af\u306e\u6700\u5927\u5171\u6709\u6570\u3092\u5236\u9650\u3059\u308b\u30ed\u30c3\u30af\u3060\u3002\u7269\u7406\u30c7\u30d0\u30a4\u30b9\u306e\u6570\u3060\u3051\u30d7\u30ed\u30bb\u30b9\u3092\u540c\u6642\u306b\u8d70\u3089\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u7528\u3044\u308b\u3002\u30bb\u30de\u30d5\u30a9\u306f\u5171\u6709\u30ed\u30c3\u30af\u306e\u5fdc\u7528\u3067\u5b9f\u73fe\u3067\u304d\u308b\u305f\u3081\u3001\u3053\u3053\u3067\u307e\u3068\u3081\u3066\u8aac\u660e\u3059\u308b\u3002\n\n## 2.1. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u306e\u69cb\u9020\n\n\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u306b\u6bd4\u3079\u308b\u3068\u3060\u3044\u3076\u8907\u96d1\u3067\u3042\u308b\u304c\u3001\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u306f\u6b21\u306e\u69cb\u9020\u3092\u6301\u305f\u305b\u308b\u3002\n\n```text:\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\"lockname_HOGE\"\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\nLOCKDIR/           \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\n|\n+-lockname_HOGE/   \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\uff08\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\n  |\n  +-lockname_HOGE/ \u2190 \u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u4e00\u5f0f\uff08\u540c\u540d\u306e\u5b50\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\n    |                 \u30fb\u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u30cf\u30fc\u30c9\u30ea\u30f3\u30af\u6570-2\u304c\u5171\u6709\u6570\n    |\n    +-uniq_num1.pid1/ \u2190 \u5171\u6709\u30ed\u30c3\u30af\u3092\u304b\u3051\u308b\u5ea6\u306b\u4f5c\u6210\u3059\u308b\u30b5\u30d6\u30ed\u30c3\u30af\u540d\n    +-uniq_num2.pid2/    (\u4e00\u610f\u306a\u756a\u53f7+\u547c\u51fa\u5143\u30d7\u30ed\u30bb\u30b9ID)\n    :\n    |\n    + modifying  \u2190 \u4e0a\u8a18\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u8ffd\u52a0\u524a\u9664\u3059\u308b\u969b\u306e\n                   \u30a2\u30af\u30bb\u30b9\u6a29\u306e\u305f\u3081\u306e\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u4f5c\u696d\u6642\u306e\u307f\u5b58\u5728\uff09\n```\n\n\u3053\u308c\u306b\u306f\u3044\u304f\u3064\u304b\u5de5\u592b\u304c\u51dd\u3089\u3057\u3066\u3042\u308b\u3002\n\n### 2.1.1. \u540c\u540d\u3067\u4e8c\u91cd\u5316\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\n\n\u306a\u305c\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4e8c\u91cd\u306b\u4f5c\u3063\u3066\u3044\u308b\u306e\u304b\u3002\u3053\u308c\u306f\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u3092\u30a2\u30c8\u30df\u30c3\u30af\u306b\u4f5c\u308b\u305f\u3081\u306e\u5de7\u5999\u306a\u4ed5\u639b\u3051\u3067\u3042\u308b\u3002\n\n\u5f8c\u3067\u6539\u3081\u3066\u8aac\u660e\u3059\u308b\u304c\u3001\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u306b\u306f\u3001\u5171\u6709\u4e2d\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u3063\u3066\u4e00\u610f\u306b\u4f5c\u3089\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u304c\u5fc5\u305a\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\u3053\u308c\u306f\u5171\u6709\u4e2d\u306e\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u628a\u63e1\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3002\u305d\u308c\u3086\u3048\u3001\u3082\u3057\u4f55\u3082\u8003\u3048\u305a\u672c\u756a\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u76f4\u63a5\u306b\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3057\u307e\u3046\u3068\u3001\u4f5c\u6210\u3057\u305f\u77ac\u9593\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306f\u7a7a\u3067\u3042\u308b\u305f\u3081\u3001\u5171\u6709\u30d7\u30ed\u30bb\u30b9\u304c0\uff08\u3082\u306f\u3084\u8ab0\u3082\u5171\u6709\u3057\u3066\u3044\u306a\u3044\uff09\u3068\u898b\u306a\u3055\u308c\u3066\u524a\u9664\u3055\u308c\u308b\u6050\u308c\u304c\u3042\u308b\u3002\u3088\u3063\u3066\u672c\u756a\u306e\u30ed\u30c3\u30af\u7ba1\u7406\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u76f4\u63a5\u4f5c\u308b\u3053\u3068\u306f\u907f\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n\u305d\u3053\u3067\u3001\u4e88\u3081\u5225\u306e\u5b89\u5168\u306a\u5834\u6240\u3067\u30b5\u30d6\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u307e\u3067\u4e2d\u8eab\u3092\u4f5c\u3063\u3066\u304a\u304d\u3001mv\u30b3\u30de\u30f3\u30c9\u3092\u7528\u3044\u3066\u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u79fb\u52d5\u3055\u305b\u308b\u3002\u3068\u3053\u308d\u304c\u3082\u3057\u79fb\u52d5\u5148\u306b\u65e2\u5b58\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u3042\u308b\u3068\u901a\u5e38**mv\u30b3\u30de\u30f3\u30c9\u306f\u3001\u305d\u306e\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3068\u3057\u3066\u79fb\u52d5\u3092\u6210\u529f\u3055\u305b\u3066\u3057\u307e\u3046\u3002**\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u76f4\u4e0b\u306b\u308f\u3056\u308f\u3056\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u7f6e\u304f\u306e\u306f\u3053\u306e\u554f\u984c\u3078\u306e\u5bfe\u7b56\u3067\u3042\u308b\u3002\u540c\u540d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u76f4\u4e0b\u306b\u3042\u308c\u3070\u3001mv\u30b3\u30de\u30f3\u30c9\u3082\u79fb\u52d5\u3092\u8ae6\u3081\u3066\u304f\u308c\u308b\u3002\n\n### 2.1.2. \u4e2d\u306b*<\u56fa\u6709\u756a\u53f7+\u30d7\u30ed\u30bb\u30b9ID>*\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u308b\n\n\u3053\u308c\u307e\u305f\u5de7\u5999\u306a\u4ed5\u639b\u3051\u3060\u3002\u5148\u7a0b\u8aac\u660e\u3057\u305f\u4e8c\u968e\u5c64\u540c\u540d\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e0b\u5c64\u5074\uff08\u5b50\uff09\u306b\u3001\u5171\u6709\u30ed\u30c3\u30af\u3092\u5e0c\u671b\u3059\u308b\u5404\u30d7\u30ed\u30bb\u30b9\u304c\u3055\u3089\u306b1\u3064\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u308b\u3002\u3053\u306e\u969b\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u540d\u304c\u885d\u7a81\u3057\u306a\u3044\u3088\u3046\u306b*<\u56fa\u6709\u756a\u53f7+\u547c\u51fa\u5143\u30d7\u30ed\u30bb\u30b9ID>*\u3068\u3044\u3046\u547d\u540d\u898f\u5247\uff08\u56fa\u6709\u756a\u53f7\u306f\u3001\u4f5c\u6210\u65e5\u6642\u3068\u4f5c\u6210\u30d7\u30ed\u30bb\u30b9ID\u306b\u57fa\u3065\u3044\u3066\u4f5c\u308c\u3070\u3088\u3044\uff09\u306b\u3088\u308b\u4e00\u610f\u306a\u540d\u79f0\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\uff09\u3092\u4ed8\u3051\u308b\u3002\n\n\u76ee\u7684\u306f\u5148\u7a0b\u3082\u8ff0\u3079\u305f\u304c\u3001\u73fe\u5728\u306e\u5171\u6709\u30d7\u30ed\u30bb\u30b9\u6570\u3092\u628a\u63e1\u3059\u308b\u305f\u3081\u3067\u3042\u308b\u3002\u5171\u6709\u6570\u304c\u628a\u63e1\u3067\u304d\u308c\u3070\u5f8c\u8ff0\u3059\u308b\u30bb\u30de\u30d5\u30a9\uff08\u5171\u6709\u6570\u306b\u5236\u9650\u3092\u8a2d\u3051\u308b\uff09\u3092\u5b9f\u73fe\u3067\u304d\u308b\u3057\u3001\u307e\u305f\u5171\u6709\u65700\u306b\u306a\u3063\u305f\u969b\u306b\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u81ea\u4f53\u3092\u524a\u9664\u3059\u308b\u3068\u3044\u3046\u5224\u65ad\u3082\u3067\u304d\u308b\u3002\n\n\u3067\u306f\u5177\u4f53\u7684\u306b\u3069\u3046\u3084\u3063\u3066\u5171\u6709\u6570\u3092\u628a\u63e1\u3059\u308b\u304b? \u4e2d\u306b\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u6570\u3092\u7d20\u76f4\u306b\u6570\u3048\u308b\u3068\u3044\u3046\u65b9\u6cd5\u3082\u3042\u308b\u304c\u3001\u3082\u3063\u3068\u8efd\u3044\u65b9\u6cd5\u304c\u3042\u308b\u3002**\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09\u306e\u30cf\u30fc\u30c9\u30ea\u30f3\u30af\u6570\u3092\u898b\u308b**\u3068\u3044\u3046\u65b9\u6cd5\u3060\u3002\n\n`ls -ld` *<\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09>*\n\n\u3092\u5b9f\u884c\u3057\u305f\u6642\u30012\u5217\u76ee\u306b\u8868\u793a\u3055\u308c\u308b\u6570\u5b57\u304c\u305d\u308c\u3067\u3042\u308b\u3002\u3053\u306e\u6570\u5b57\u3092-2\u3059\u308b\u3068\u3001\u76f4\u4e0b\u306e\u30b5\u30d6\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u6570\u306b\u306a\u308b\uff08\u7406\u7531\u306f\u5272\u611b\uff09\u3002\u5f93\u3063\u3066\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u30672\u5217\u76ee\u306e\u6570\u3092\u53d6\u5f97\u3059\u308c\u3070\u3001\u3044\u3061\u3044\u3061\u5168\u90e8\u6570\u3048\u305a\u3068\u3082\u3001\u5171\u6709\u6570\u3092\u8a08\u7b97\u3067\u304d\u308b\u306e\u3067\u3042\u308b\u3002\n\n### 2.1.3. \u5171\u6709\u6570\u3092\u5897\u6e1b\u30fb\u53c2\u7167\u3059\u308b\u969b\u306f\u3001\u66f4\u306b\u6392\u4ed6\u30ed\u30c3\u30af\n\n* \u5171\u6709\u6570\u304c0\u3060\u3063\u305f\u3089\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\u3059\u308b\n* \u5171\u6709\u6570\u304c\u4e0a\u9650\u306b\u9054\u3057\u305f\u3089\u305d\u308c\u4ee5\u4e0a\u306e\u5171\u6709\u3092\u62d2\u5426\u3059\u308b\uff08\u30bb\u30de\u30d5\u30a9\u5236\u5fa1\uff09\n\n\u3068\u3044\u3063\u305f\u64cd\u4f5c\u306f\u3001\u3069\u3046\u3057\u3066\u3082\u30a2\u30c8\u30df\u30c3\u30af\u306b\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3002\u5171\u6709\u6570\u3092\u8abf\u3079\u3066\u51e6\u7406\u3092\u6c7a\u3081\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u6642\u306b\u5171\u6709\u6570\u304c\u5909\u5316\u3057\u3066\u3057\u307e\u3046\u6050\u308c\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u3001\u5171\u6709\u6570\u3092\u53c2\u7167\u3059\u308b\u6642\u3068\u5171\u6709\u6570\u3092\u5897\u6e1b\u3055\u305b\u308b\u6642\u306f\u3001\u305d\u3053\u3067\u66f4\u306b\u6392\u4ed6\u30ed\u30c3\u30af\u3092\u639b\u3051\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n\n\u5171\u6709\u6570\u3092\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u306f\u4eca\u5217\u6319\u3057\u305f\u3068\u304a\u308a\u3060\u304c\u3001\u5897\u6e1b\u3055\u305b\u305f\u3044\u6642\u3068\u3044\u3046\u306e\u306f\u6b21\u306e\u5834\u5408\u3067\u3042\u308b\u3002\n\n* \u5171\u6709\u30ed\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408\n* \u5171\u6709\u30ed\u30c3\u30af\u3092\u524a\u9664\u3057\u305f\u3044\u5834\u5408\n* \u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09\u5185\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u3046\u3061\u53e4\u3044\u3082\u306e\u3092\u3001\u57fa\u672c\u30eb\u30fc\u30eb2\u306b\u5f93\u3063\u3066\u4e00\u6589\u524a\u9664\u3057\u305f\u3044\u5834\u5408\n\n\u4ee5\u4e0a\u3001\u5217\u6319\u3057\u305f\u64cd\u4f5c\u3092\u884c\u3046\u5834\u5408\u306b\u4f5c\u308b\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u304c\n\n`<\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff08\u5b50\uff09>/modifying`\n\n\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b\u3002\n\n## 2.2. \u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u306e\u5b9f\u88c5\u306e\u307e\u3068\u3081\n\n\u4ee5\u4e0a\u306e\u7406\u5c48\u306b\u57fa\u3065\u3044\u3066\u30b3\u30fc\u30c9\u306b\u8d77\u3053\u3057\u3066\u307f\u305f\u3082\u306e\u3092\u3044\u304f\u3064\u304b\u4f8b\u793a\u3059\u308b\u3002\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u306b\u306f\u7570\u5e38\u7cfb\u306e\u51e6\u7406\u7b49\u304c\u3042\u308a\u3001\u3053\u308c\u3088\u308a\u8fbc\u307f\u5165\u3063\u3066\u3044\u308b\u304c\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u305d\u308c\u3089\u306f\u66f8\u3044\u3066\u3044\u306a\u3044\u3002\n\n### 2.2.1. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u65b0\u898f\u4f5c\u6210\n\n\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306b\u65b0\u898f\u4f5c\u6210\u3059\u308b\u90e8\u5206\u306e\u30b3\u30fc\u30c9\u3067\u3042\u308b\u3002\u5b89\u5168\u306a\u5834\u6240\u3067[2.1.](http://qiita.com/richmikan@github/items/6ca1ec3b354ae2f5505d#21-%E5%85%B1%E6%9C%89%E3%83%AD%E3%83%83%E3%82%AF%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%83%BC%E3%81%AE%E6%A7%8B%E9%80%A0)\u3067\u8a18\u3057\u305f\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306bmv\u30b3\u30de\u30f3\u30c9\u3067\u79fb\u52d5\u3057\u3066\u3044\u308b\u3002\u3082\u3057mv\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306f\u3001\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u304c\u65e2\u306b\u5b58\u5728\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u6b21\u306b\u4f8b\u793a\u3059\u308b\u30b7\u30a7\u30eb\u95a2\u6570add_shlock()\u3078\u9032\u3080\u3002\n\n```sh:\u5171\u6709\u30ed\u30c3\u30af\u65b0\u898f\u4f5c\u6210\u30b5\u30f3\u30d7\u30eb\nLOCKDIR=\"/PATH/TO/LOCKDIR\" # \u30ed\u30c3\u30af\u306e\u7ba1\u7406\u3092\u884c\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\nlockname=\"\u30ed\u30c3\u30af\u540d\"        # \u5171\u6709\u30ed\u30c3\u30af\u540d\nMAX_SHARING_PROCS=\u4e0a\u9650\u6570   # \u30bb\u30de\u30d5\u30a9\u30e2\u30fc\u30c9\u306e\u5834\u5408\u306b\u4f7f\u3046\u4e0a\u9650\u6570\n\n# \u5b89\u5168\u306a\u5834\u6240\u3067\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\ncallerpid=$(ps -o pid,ppid | awk '$2=='$$'{print $1;exit}')\nsublockname=$(date +%Y%m%d%H%M%S).$$.$callerpid\ntmpdir=\"$LOCKDIR/.preshlock.$sublockname\"\nshlockdir_pre=\"$tmpdir/$lockname/$lockname/$sublockname\"\nmkdir -p $shlockdir_pre\n\n# \u672c\u756a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3078\u306e\u79fb\u52d5\u3092\u8a66\u307f\u308b\ntry=3 # \u30ea\u30c8\u30e9\u30a4\u6570\nwhile [ $try -gt 0 ]; do\n  # mv\u306b\u6210\u529f\u3057\u305f\u3089\u65b0\u898f\u4f5c\u6210\u6210\u529f\n  mv $shlockdir_pre $LOCKDIR 2>/dev/null && {\n    echo \"$LOCKDIR/$lockname/$lockname/$sublockname\" # \u5f8c\u3067\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u3001\n    break                                            # \u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u8fd4\u3059\n  }\n\n  # \u5931\u6557\u3057\u305f\u3089\u8ffd\u52a0\u4f5c\u6210\u30e2\u30fc\u30c9\u3067\u8a66\u307f\u308b\n  add_shlock && break  # add_shlock()\u306e\u4e2d\u8eab\u306f\u5225\u9014\u8aac\u660e\n\n  try=$((try-1))\n  [ $try -gt 0 ] && sleep 1                          # \u30ea\u30c8\u30e9\u30a4\u3059\u308b\u5834\u5408\u306f1\u79d2\u5f85\u3064\ndone\ncase $try in 0) echo \"timeout, try again later\";exit 1;; esac\n\n# \u5b89\u5168\u306a\u5834\u6240\u3068\u3057\u3066\u4f5c\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\nrm -rf \"$tmpdir\"\n```\n\n\u5c1a\u3001\u300c\u5b89\u5168\u306a\u5834\u6240\u300d\u3092\u78ba\u4fdd\u3059\u308b\u305f\u3081\u306b\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u4e2d\u306b`.preshlock.<\u30b5\u30d6\u30ed\u30c3\u30af\u540d>`\u3068\u3044\u3046\u4e00\u610f\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u3063\u3066\u3044\u308b\u3002\u305d\u306e\u305f\u3081\u3001**`^\\.preshlock\\.[0-9.]+$`\u306b\u8a72\u5f53\u3059\u308b\u30ed\u30c3\u30af\u540d\u306f\u4e88\u7d04\u540d**\u3068\u3057\u3066\u4f7f\u7528\u7981\u6b62\u3068\u3059\u308b\u3002\n\n### 2.2.2. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u8ffd\u52a0\u4f5c\u6210\n\n\u524d\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u65b0\u898f\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306b\u306f\u3053\u3061\u3089\u306e\u30b7\u30a7\u30eb\u95a2\u6570add_shlock()\u306b\u3084\u3063\u3066\u304f\u308b\u3002\n\n\u5171\u6709\u6570\u3092\u5897\u6e1b\u30fb\u53c2\u7167\u3059\u308b\u306e\u3067\u307e\u305a\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb`modifying`\u3092\u4f5c\u308a\u3001\u5171\u6709\u6570\u304c\u4e0a\u9650\u306b\u9054\u3057\u3066\u3044\u306a\u3044\u304b\u8abf\u3079\u3001\u9054\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u30921\u3064\u4f5c\u308b\u3002\u6700\u5f8c\u306b\u6392\u4ed6\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\u306e\u3082\u5fd8\u308c\u306c\u3088\u3046\u306b\u3059\u308b\u3002\n\n```sh:add_shlock()\u2026\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u8ffd\u52a0\u4f5c\u6210\u30b5\u30f3\u30d7\u30eb\nadd_shlock() {\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\uff08\u5931\u6557\u3057\u305f\u3089\u30b7\u30a7\u30eb\u95a2\u6570\u7d42\u4e86\uff09\n  (set -C; : >$LOCKDIR/$lockname/$lockname/modifying) || return 1\n\n  # \u5171\u6709\u6570\uff08=\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb(\u5b50)\u306e\u6570-2\uff09\u304c\u5236\u9650\u3092\u8d85\u3048\u3066\u3044\u306a\u3044\u304b\n  # \u203b \u3053\u306e\u51e6\u7406\u306f\u30bb\u30de\u30d5\u30a9\u5236\u5fa1\u306e\u5834\u5408\u306e\u307f\n  n=$(ls -dl $LOCKDIR/$lockname/$lockname | awk '{$2-2}')\n  [ $n -ge $MAX_SHARING_PROCS ] || return 1 # \u8d85\u904e\u6642\u306f\u95a2\u6570\u7d42\u4e86\n  \n  # \u5171\u6709\u30ed\u30c3\u30af\u8ffd\u52a0\n  sublockname=$(date +%Y%m%d%H%M%S).$$.$callerpid\n  mkdir $tmpdir/$lockname/$lockname/$sublockname\n  echo \"$LOCKDIR/$lockname/$lockname/$sublockname\" # \u5f8c\u3067\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u3001\n                                                   # \u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30d1\u30b9\u3092\u8fd4\u3059\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u89e3\u653e\n  rm $LOCKDIR/$lockname/$lockname/modifying\n}\n```\n\n### 2.2.3. \u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u524a\u9664\n\n\u81ea\u5206\u3067\u4f5c\u3063\u305f\u5171\u6709\u30ed\u30c3\u30af\u3092\u524a\u9664\u3059\u308b\u5834\u5408\u306f\u3001\u30ed\u30c3\u30af\u6210\u529f\u6642\u306b\u6e21\u3055\u308c\u305f\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u307e\u3067\u542b\u3080\uff09\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6e21\u3059\u3002\u305d\u308c\u306b\u57fa\u3065\u3044\u3066\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\u3001\u66f4\u306b\u53e4\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3082\u524a\u9664\u3057\u305f\u7d50\u679c\u3001\u5171\u6709\u65700\u306b\u306a\u3063\u3066\u3044\u305f\u3089\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3054\u3068\u524a\u9664\u3059\u308b\u3002\n\n```sh:\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\uff08\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\uff09\u524a\u9664\u30b5\u30f3\u30d7\u30eb\nlockfile=\"\u3053\u3053\u306b\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb\u540d\uff08\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u307e\u3067\u542b\u3080\uff09\"\n\ntry=3 # \u30ea\u30c8\u30e9\u30a4\u6570\nwhile [ $try -gt 0 ]; do\n  # \u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u53d6\u5f97\n  (set -C; : >${lockfile#/*}/modifying) && break\n\n  try=$((try-1))\n  [ $try -gt 0 ] && sleep 1\ndone\ncase $try in 0) echo \"timeout, try again later\";exit 1;; esac\n\n# \u30ed\u30c3\u30af\u89e3\u9664\u5bfe\u8c61\u306e\u30b5\u30d6\u30ed\u30c3\u30af\u540d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u524a\u9664\nrmdir $lockfile\n\n# \u5171\u6709\u6570\uff08=\u5171\u6709\u30ed\u30c3\u30af\u30d5\u30a1\u30a4\u30eb(\u5b50)\u306e\u6570-2\uff09\u304c0\u306a\u3089\u5171\u6709\u30ed\u30c3\u30afdir\u81ea\u8eab\u3092\u524a\u9664\nn=$(ls -dl ${lockfile#/*} | awk '{$2-2}')\nif [ $n -le 0 ]; then\n  rm -rf ${lockfile#/*}/..\nelse\n  # \u5171\u6709\u6570\u304c0\u3067\u306a\u3051\u308c\u3070\u3001\u5171\u6709\u6570\u30a2\u30af\u30bb\u30b9\u6a29\u3092\u89e3\u653e\u3059\u308b\u306e\u307f\n  rm ${lockfile#/*}/modifying\nfi\n```\n\n# \u3044\u3084\u3041\u3001\u5171\u6709\u30ed\u30c3\u30af\u306f\u5927\u5909\u3060\u3002\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u3066\u5de7\u5999\u306a\u6280\u3092\u3044\u304f\u3064\u304b\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u5171\u6709\u30ed\u30c3\u30af\u30fb\u30bb\u30de\u30d5\u30a9\u3082POSIX\u306e\u7bc4\u56f2\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u5b9f\u73fe\u3067\u304d\u308b\u3002\uff08\u5b9f\u969b\u306e\u30b3\u30de\u30f3\u30c9\u2192[pexlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pexlock)\u3001[pshlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pshlock)\u3001[punlock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pshlock)\u3001[pcllock\u30b3\u30de\u30f3\u30c9](https://github.com/ShellShoccar-jpn/misc-tools/blob/master/pcllock)\uff09\n\n\u3060\u304c\u3001\u3053\u3053\u307e\u3067\u8907\u96d1\u3060\u3068\u3082\u306f\u3084\u30d1\u30ba\u30eb\u3060\u3002\u5de7\u5999\u306a\u69cb\u9020\u306b\u3057\u305f\u5171\u6709\u30ed\u30c3\u30af\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306e\u307f\u306a\u3089\u305a\u3001\u4e00\u5b9a\u4ee5\u4e0a\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u6d88\u3059\uff08pcllock\u30b3\u30de\u30f3\u30c9\u5185\u3067\u5b9f\u88c5\uff09\u306b\u306f\u65e5\u6642\u8a08\u7b97\u304c\u5fc5\u8981\u3067\u3042\u308b\u305f\u3081[\u524d\u8ff0\u306e\u5225\u8a18\u4e8b](http://qiita.com/richmikan@github/items/14e32d099bd9bcc7f8e8)\u306e\u6280\u3092\u99c6\u4f7f\u3057\u3001\u304b\u306a\u308a\u5927\u639b\u304b\u308a\u3060\u3002\n\n\u3068\u306f\u3044\u3046\u3082\u306e\u306e\u3001\u3053\u3046\u3057\u3066\u4f55\u3068\u304b\u30b3\u30de\u30f3\u30c9\u5316\u3057\u3066\u3057\u307e\u3048\u305f\u306e\u3060\u304b\u3089\u3001\u4eca\u5f8c\u306f\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3060\u3051\u3067\u7c21\u5358\u306b\u30ed\u30c3\u30af\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3046\u3048\u3001\u540c\u6642\u306b**\u3069\u306eUNIX\u3067\u3082\u3001\u5c06\u6765\u9577\u304d\u306b\u6e21\u308a\u52d5\u304f\u3068\u3044\u3046\u7a76\u6975\u306e\u53ef\u642c\u6027\u3092\u5099\u3048\u305f\u30ed\u30c3\u30af**\u304c\u624b\u306b\u5165\u3063\u305f\u3002POSIX\u539f\u7406\u4e3b\u7fa9\u4e07\u6b73!!\n", "tags": ["ShellScript", "POSIX", "UNIX", "shell"]}