{"tags": ["Python", "fabric", "gunicorn"], "context": " More than 1 year has passed since last update.Gunicorn\u3067\u52d5\u3044\u3066\u3044\u308b\u30a2\u30d7\u30ea\u3092\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u8d77\u52d5\u3001\u518d\u8d77\u52d5\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b\u306b\u306fpid\u3092\u6307\u5b9a\u3057\u3066kill\u3059\u308c\u3070\u3044\u3044\u3068\u3044\u3046\u3053\u3068\u3092\u5b66\u3093\u3060\u3002\n\ngunicorn.conf.py\nusr/bin/python\ngunicorn.conf.py\n\nbind = \"0.0.0.0:5000\"\nworkers = 2\nworker_class = 'sync'\nmax_requests = 1000\ntimeout = 30\nkeep_alive = 2\npreload = True\ndaemon = True\n\n\nstart.sh\nGUNICORN=/usr/bin/gunicorn\nROOT=/your/app/path\nPID=/var/run/gunicorn/your.pid\nAPP=run:app\n\nif [ -f $PID ]; then rm $PID; fi\n    cd $ROOT\n    source venv/bin/activate\n    exec $GUNICORN -c $ROOT/gunicorn.conf.py \u2013pid=$PID $APP\n\n\nfabfile.py\n#coding: utf-8\nfrom fabric.api import run,env,local,settings\nfrom fabric.operations import sudo\nfrom fabric.context_managers import cd\nimport os\nimport subprocess\n\nfrom fabric.api import env, run\nenv.use_ssh_config = True\nenv.hosts = [\"your ip address\"]\nenv.key_filename = \"/root/.ssh/authorized_keys\"\nenv.user = \"username\"\nenv.password = \"password\"\n\n\ndef start():\n    with settings():\n        with cd(\"/your/path\"):\n            sudo(\"\"\"\n            source start.sh\n            \"\"\",pty=False)\n\ndef stop():\n    with settings():\n        pid = get_pid()\n        sudo(\"kill {}\".format(pid))\n\ndef restart():\n    try:\n        stop()\n    except:\n        print(\"There isn't pid\")\n    start()\n\n\u3053\u308c\u3067 fab start/stop/restart\u3067\u81ea\u7531\u306b\u518d\u8d77\u52d5\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n\u30e1\u30e2\n\n\u30bf\u30b9\u30af\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u305b\u305f\u3044\u6642\u306f pty=False \u3068\u3057\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\n\u3053\u306e\u8a18\u4e8b\u306fhttp://furodrive.com/ja/2014/2/stop_and_start_gunicorn\n\u3092\u5143\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n\n\nGunicorn\u3067\u52d5\u3044\u3066\u3044\u308b\u30a2\u30d7\u30ea\u3092\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u8d77\u52d5\u3001\u518d\u8d77\u52d5\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\u30d7\u30ed\u30bb\u30b9\u3092\u6b62\u3081\u308b\u306b\u306fpid\u3092\u6307\u5b9a\u3057\u3066kill\u3059\u308c\u3070\u3044\u3044\u3068\u3044\u3046\u3053\u3068\u3092\u5b66\u3093\u3060\u3002\n\n####gunicorn.conf.py\n\n    usr/bin/python\n    gunicorn.conf.py\n\n    bind = \"0.0.0.0:5000\"\n    workers = 2\n    worker_class = 'sync'\n    max_requests = 1000\n    timeout = 30\n    keep_alive = 2\n    preload = True\n    daemon = True\n\n\n####start.sh\n\n    GUNICORN=/usr/bin/gunicorn\n    ROOT=/your/app/path\n    PID=/var/run/gunicorn/your.pid\n    APP=run:app\n\n    if [ -f $PID ]; then rm $PID; fi\n        cd $ROOT\n        source venv/bin/activate\n        exec $GUNICORN -c $ROOT/gunicorn.conf.py \u2013pid=$PID $APP\n\n\n####fabfile.py\n\n\n\n    #coding: utf-8\n    from fabric.api import run,env,local,settings\n    from fabric.operations import sudo\n    from fabric.context_managers import cd\n    import os\n    import subprocess\n\n    from fabric.api import env, run\n    env.use_ssh_config = True\n    env.hosts = [\"your ip address\"]\n    env.key_filename = \"/root/.ssh/authorized_keys\"\n    env.user = \"username\"\n    env.password = \"password\"\n\n\n    def start():\n        with settings():\n            with cd(\"/your/path\"):\n                sudo(\"\"\"\n                source start.sh\n                \"\"\",pty=False)\n\n    def stop():\n        with settings():\n            pid = get_pid()\n            sudo(\"kill {}\".format(pid))\n\n    def restart():\n        try:\n            stop()\n        except:\n            print(\"There isn't pid\")\n        start()\n\n\n\u3053\u308c\u3067 fab start/stop/restart\u3067\u81ea\u7531\u306b\u518d\u8d77\u52d5\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n###\u30e1\u30e2\n\n+ \u30bf\u30b9\u30af\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u305b\u305f\u3044\u6642\u306f pty=False \u3068\u3057\u306a\u3044\u3068\u52d5\u4f5c\u3057\u306a\u3044\u3002\n\n\u3053\u306e\u8a18\u4e8b\u306fhttp://furodrive.com/ja/2014/2/stop_and_start_gunicorn\n\u3092\u5143\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n"}