{"context": "ECMAScript 5.1 \u3092\u524d\u63d0\u306b JavaScript \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3092\u30e1\u30e2\u3063\u3068\u304f\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u771f\u5b9f\u306f\u3053\u308c\u3002\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3067\u691c\u7d22\u3057\u3066\u3082\u8aac\u660e\u304c\u307b\u3068\u3093\u3069\u51fa\u3066\u3053\u306a\u3044\u3002\u8ab0\u304b\u304c\u8aac\u660e\u3057\u3066\u304f\u308c\u305f\u3089\u3044\u3044\u306e\u306b\u306a\u3068\u601d\u3063\u3066\u305f\u306e\u3067\u3001\u53b3\u5bc6\u3055\u306b\u306f\u6b20\u3051\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u8a18\u4e8b\u306b\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002ECMAScript \u306e\u4ed5\u69d8\u306b\u3088\u3063\u3066\u5b9f\u73fe\u3055\u308c\u3066\u3044\u308b\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u7406\u89e3\u3059\u308b\u4fa1\u5024\u306f\u304d\u3063\u3068\u3042\u308b\u3002\n\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u3092\u4f5c\u308b\u4f8b\u3002\u52a0\u7b97\u3055\u308c\u3066\u3044\u304f var n \u3063\u3066\u3069\u3053\u306b\u5b58\u5728\u3057\u7d9a\u3051\u308b\u306e\u304b\uff1f\u3053\u306e\u8a18\u4e8b\u3067\u306f\u305d\u3046\u3044\u3046\u7591\u554f\u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\nexample.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n\n\n\u30b3\u30fc\u30c9\u306f SpiderMonkey \u3067\u691c\u8a3c\u3057\u3066\u308b\u306e\u3067\u6a19\u6e96\u51fa\u529b\u95a2\u6570\u304c print \u3060\u3051\u3069\u3001console.log \u306b\u7f6e\u304d\u63db\u3048\u308c\u3070\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3002\u306a\u304a\u3001OS X \u3067 Homebrew \u304c\u5165\u3063\u3066\u308b\u306a\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067 SpiderMonkey \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3002\n$ brew install spidermonkey\n$ js example.js\n\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\n\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u8a71\u3092\u3059\u308b\u3068\u7d76\u5bfe\u51fa\u3066\u304f\u308b\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\uff08\u9759\u7684\u30b9\u30b3\u30fc\u30d7\uff09\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\uff08\u52d5\u7684\u30b9\u30b3\u30fc\u30d7\uff09\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u304c\u652f\u3048\u3066\u3044\u3066\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u306b\u30af\u30ed\u30fc\u30b8\u30e3\u306f\u306a\u3044\u3093\u3060\u3088\u306d\u3002\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068 10 \u304c\u51fa\u529b\u3055\u308c\u308b\u3002JavaScript \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3060\u304b\u3089\u306d\u3002\u3067\u3082\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3060\u3063\u305f\u3089 20 \u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\nscope.js\nvar x = 10;\n\nfunction foo() {\n  print(x); // 10\n}\n\nfunction bar() {\n  var x = 20;\n  foo();\n}\n\nbar();\n\n\nPerl \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3092\u4f7f\u3044\u5206\u3051\u3089\u308c\u308b\u306e\u3067\u3001\u524d\u8ff0\u306e\u30b3\u30fc\u30c9\u3092\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3067\u66f8\u3044\u3066\u307f\u308b\u3002\n\nscope.pl\n$x = 10;\n\nsub foo {\n  print $x, \"\\n\"; # 20\n}\n\nsub bar {\n  local $x = 20;\n  foo();\n}\n\nbar();\n\n\nOS X \u306a\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3002\u30bf\u30fc\u30df\u30ca\u30eb\u306b 20 \u304c\u51fa\u529b\u3055\u308c\u305f\u306f\u305a\u3002\n$ perl scope.pl\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u306e\u9055\u3044\u306f\u3001\u30b3\u30fc\u30c9\u4e0a\u3067\u6c7a\u307e\u308b\u304b\u5b9f\u884c\u4e0a\u3067\u6c7a\u307e\u308b\u304b\u3068\u3044\u3046\u9055\u3044\u3002\u30b3\u30fc\u30c9\u4e0a\u3067\u306f\u95a2\u6570 foo \u306e\u5b9a\u7fa9\u5143\u306b\u3042\u308b\u306e\u306f 10 \u306b\u521d\u671f\u5316\u3055\u308c\u305f var x \u306b\u306a\u308b\u3002\u5b9f\u884c\u4e0a\u3067\u306f foo \u306e\u547c\u51fa\u5143\u306b\u3042\u308b\u306e\u306f 20 \u306b\u521d\u671f\u5316\u3055\u308c\u305f var x \u306b\u306a\u308b\u3002\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u306e\u5834\u5408\u3001\u5909\u6570 x \u3092\u30b3\u30fc\u30c9\u4e0a\u3068\u5b9f\u884c\u4e0a\u306e\u3069\u3063\u3061\u306e\u65b9\u6cd5\u3067\u89e3\u6c7a\u3057\u3066\u3044\u308b\u304b\u3067\u51fa\u529b\u304c\u9055\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\nECMAScript 5.1 \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u306e\u539f\u7406\nJavaScript \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3060\u3002\u305d\u308c\u3092 JavaScript \u306e\u4ed5\u69d8 ECMAScript 5.1 \u3067\u306f\u3069\u3046\u3084\u3063\u3066\u5b9f\u73fe\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u898b\u3066\u3044\u3053\u3046\u3002\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u30b3\u30fc\u30c9\u4e0a\u306e\u5165\u308c\u5b50\u69cb\u9020\u3068\u8b58\u5225\u5b50\u304b\u3089\u5909\u6570\u3068\u95a2\u6570\u3078\u306e\u95a2\u9023\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u3002\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4f8b\u3092\u898b\u305f\u65b9\u304c\u7406\u89e3\u3057\u3084\u3059\u3044\u3002scope.js \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306b\u306a\u308b\u3002\n\nscope.js\nvar x = 10;\n\nfunction foo() {\n  print(x); // 10\n}\n\nfunction bar() {\n  var x = 20;\n  foo();\n}\n\nbar();\n\n\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8003\u3048\u308b\u3002\n\nrecord: \u74b0\u5883\u30ec\u30b3\u30fc\u30c9\nouter: \u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3078\u306e\u53c2\u7167\n\nglobalEnv \u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3060\u3002fooEnv \u306f\u95a2\u6570 foo \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3067\u3001\u305d\u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f globalEnv \u3060\u3002\u306a\u304a\u3001global \u306f\u3044\u308f\u3086\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3002\u4f8b\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u4e0a\u3067\u5b9f\u884c\u3059\u308b JavaScript \u306a\u3089\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f window \u306b\u306a\u308b\u3002\n\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u8b58\u5225\u5b50\u3068\u5024\u3092\u8a18\u9332\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u74b0\u5883\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3078\u306e\u53c2\u7167\u306b\u306a\u308b\u3002var x = 10; \u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u8ffd\u52a0\u3055\u308c\u308b\u306e\u306f\u3053\u306e\u305f\u3081\u3060\u3002var x = 20; \u306f barEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\u3002\uff08\u4ed5\u69d8\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u3082\u3046\u5c11\u3057\u8907\u96d1\u306a\u306e\u3067\u3001\u3053\u306e\u8aac\u660e\u306f\u6b63\u78ba\u3067\u306f\u306a\u3044\u3002\uff09\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u3042\u308b\u6642\u70b9\u306e\u5b9f\u884c\u4e0a\u306e\u5165\u308c\u5b50\u69cb\u9020\u3092\u30b9\u30bf\u30c3\u30af\u3068\u3057\u3066\u4fdd\u6301\u3057\u3066\u3044\u308b\u3002\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3082\u4f8b\u3092\u898b\u305f\u65b9\u304c\u7406\u89e3\u3057\u3084\u3059\u3044\u3002scope.js \u306e print(x); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u4e0b\u8a18\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306b\u306a\u308b\u3002\uff08PlantUML \u3092\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u304f\u3066\u30b9\u30bf\u30c3\u30af\u611f\u306f\u5168\u7136\u8868\u305b\u3066\u306a\u3044\u3051\u3069\u2026\u2026\u3002\uff09\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u4e0b\u8a18\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8003\u3048\u308b\u3002\n\nenv: \u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\n\nglobalExecCtx \u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u6700\u521d\u306b\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002globalExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u95a2\u6570 bar \u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b barExecCtx \u306f\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002barExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u95a2\u6570 foo \u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b fooExecCtx \u306f\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002\nprint(x); \u3092\u5b9f\u884c\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3060\u3068\u56f3\u306e\u3088\u3046\u306b globalExecCtx\u30fbbarExecCtx\u30fbfooExecCtx \u306e3\u3064\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u5b58\u5728\u3059\u308b\u3002\u95a2\u6570 foo \u306e\u5b9f\u884c\u304c\u7d42\u4e86\u3059\u308b\u3068 fooExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3082\u7d42\u4e86\u3059\u308b\u3002\n\n\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\n\u3055\u3042 print(x); \u306e\u5909\u6570 x \u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u3082\u56f3\u304b\u3089\u898b\u3066\u307f\u308b\u3002\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u56f3\u306e\u5909\u6570 x \u306e\u89e3\u6c7a\u306b\u5229\u7528\u3055\u308c\u308b\u53c2\u7167\u3092\u77e2\u5370\u306b\u3057\u3066\u307f\u305f\u3002\n\n\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u624b\u9806\u306f\u5358\u7d14\u3060\u3002\uff08\u4ed5\u69d8\u306e\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u306f\u3082\u3046\u5c11\u3057\u8907\u96d1\u306a\u306e\u3067\u3001\u3053\u306e\u8aac\u660e\u306f\u6b63\u78ba\u3067\u306f\u306a\u3044\u3002\uff09\n\n\u73fe\u5728\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50\u304c\u5b58\u5728\u3059\u308b\u304b\uff1f\n\n\n\u5b58\u5728\u3059\u308b\uff1a\u305d\u306e\u8b58\u5225\u5b50\u306e\u5024\u3092\u8fd4\u3059\n\u5b58\u5728\u3057\u306a\u3044\uff1a\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3057\u30662\u3092\u518d\u5b9f\u884c\u3059\u308b\n\n\n\nprint(x); \u306e\u5834\u5408\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u73fe\u5728\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 fooExecCtx \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50 x \u304c\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 globalEnv \u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 globalEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50 x \u304c\u5b58\u5728\u3059\u308b\u306e\u3067\u3001x \u306e\u5024\u3067\u3042\u308b 10 \u3092\u8fd4\u3059\u3002\n\n\nECMAScript 5.1 \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\nJavaScript \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3092\u8aac\u660e\u3057\u3088\u3046\u3002\n\nJavaScript \u306e\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u30af\u30ed\u30fc\u30b8\u30e3\nJavaScript \u306e\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3060\u3002\u3069\u3093\u306a\u95a2\u6570\u5b9a\u7fa9\u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u308b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3082\u3001\u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u305f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3078\u306e\u53c2\u7167\uff08\u30b9\u30b3\u30fc\u30d7\uff09\u3092\u6301\u3064\u304b\u3089\u3060\u3002\u524d\u9805\u306e\u56f3\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53cd\u6620\u3055\u305b\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u539f\u7406\u3092\u660e\u3089\u304b\u306b\u3057\u3088\u3046\u3002\n\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u539f\u7406\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u30b3\u30fc\u30c9\u3092\u518d\u63b2\u3059\u308b\u3002\n\nexample.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n\n\nvar count = createCounter(); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u95a2\u6570 createCounter \u306e\u7d42\u4e86\u76f4\u524d\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\u95a2\u6570 createCounter \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\u305d\u3057\u3066\u3001\u6ce8\u76ee\u3057\u3066\u307b\u3057\u3044\u306e\u306f \u95a2\u6570 createCounter \u5185\u306e\u7121\u540d\u95a2\u6570\u304c\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 anonymousFunc \u3068\u3057\u3066\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3068\u3053\u308d\u3002\n\nprint(count()); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 anonymousFunc \u304c\u5909\u6570 count \u3067\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u5909\u6570 count \u3092\u95a2\u6570\u3068\u3057\u3066\u547c\u3073\u51fa\u3057\u305f\u5f8c\u306e return n++; \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\nanonymousEnv \u306e outer \u304c createCounterEnv \u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u3001anonymousFunc \u306e scope \u3092 anonymousEnv \u3092\u751f\u6210\u3059\u308b\u3068\u304d\u306b outer \u306b\u8a2d\u5b9a\u3059\u308b\u304b\u3089\u3002\u95a2\u6570\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u300c\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u300d\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u300c\u30b9\u30b3\u30fc\u30d7\u300d\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u3044\u3046\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u3053\u308c\u307e\u3067\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u3092\u898b\u8fd4\u3057\u3066\u3082\u305d\u3046\u306a\u3063\u3066\u308b\u306f\u305a\u3060\u3002\n\n\u5909\u6570 n \u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\n\u6700\u521d\u306e print(count()); \u304c\u7d42\u4e86\u3057\u305f\u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002createCounterEnv \u306e n \u304c1\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u306d\u3002\n\n\u3053\u308c\u304c\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3060\u3002\n\ncreateCounter \u30922\u56de\u5b9f\u884c\u3059\u308b\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u30b3\u30fc\u30c9\u3067\u95a2\u6570 createCounter \u30922\u56de\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\u3082\u3061\u308d\u3093\u5225\u306e\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\nexample2.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n\nvar count2 = createCounter();\nprint(count2()); // 0\nprint(count2()); // 1\nprint(count2()); // 2\n\n\n\u3053\u308c\u306f\u306a\u305c\u306a\u306e\u304b\u3082\u5ff5\u306e\u305f\u3081\u8003\u3048\u3066\u307f\u308b\u3002\u3068\u8a00\u3063\u3066\u3082\u3001\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u3092\u307f\u308c\u3070\u3059\u3050\u306b\u89e3\u308b\u306f\u305a\u3002\nprint(count2()); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u8b0e\u306f\u89e3\u3051\u305f\u304b\u306a\u3002\n\n\u88dc\u8db3\u4e8b\u9805\n\u672c\u8a18\u4e8b\u3067\u306f\u4e0b\u8a18\u3092\u6761\u4ef6\u306b\u3059\u308b\u3053\u3068\u3067 ECMAScript 5.1 \u306e\u4ed5\u69d8\u3092\u7701\u7565\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u3002\n\nstrict \u30e2\u30fc\u30c9\u30b3\u30fc\u30c9\u306e\u307f\u5bfe\u8c61\u3068\u3059\u308b\neval \u30b3\u30fc\u30c9\u306f\u5bfe\u8c61\u5916\u3068\u3059\u308b\ntry \u6587 catch \u7bc0\u306f\u5bfe\u8c61\u5916\u3068\u3059\u308b\n1\u30683\u3092\u524d\u63d0\u306b\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e LexicalEnvironment \u3068 VariableEnvironment \u3092\u540c\u4e00\u3068\u307f\u306a\u3057\u3066 env \u306e\u540d\u524d\u3067\u53c2\u7167\u3059\u308b\n\n\n\u53c2\u8003\u6587\u732e\nECMA-262 Edition 5.1\u3092\u8aad\u3080\nhttp://www.ecma-international.org/ecma-262/5.1/\nhttp://dmitrysoshnikov.com/ecmascript/es5-chapter-3-1-lexical-environments-common-theory/\nhttp://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/\nECMAScript 5.1 \u3092\u524d\u63d0\u306b JavaScript \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3092\u30e1\u30e2\u3063\u3068\u304f\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u771f\u5b9f\u306f\u3053\u308c\u3002\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3067\u691c\u7d22\u3057\u3066\u3082\u8aac\u660e\u304c\u307b\u3068\u3093\u3069\u51fa\u3066\u3053\u306a\u3044\u3002\u8ab0\u304b\u304c\u8aac\u660e\u3057\u3066\u304f\u308c\u305f\u3089\u3044\u3044\u306e\u306b\u306a\u3068\u601d\u3063\u3066\u305f\u306e\u3067\u3001\u53b3\u5bc6\u3055\u306b\u306f\u6b20\u3051\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u8a18\u4e8b\u306b\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u305f\u3002ECMAScript \u306e\u4ed5\u69d8\u306b\u3088\u3063\u3066\u5b9f\u73fe\u3055\u308c\u3066\u3044\u308b\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u7406\u89e3\u3059\u308b\u4fa1\u5024\u306f\u304d\u3063\u3068\u3042\u308b\u3002\n\n# \u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\n\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u3092\u4f5c\u308b\u4f8b\u3002\u52a0\u7b97\u3055\u308c\u3066\u3044\u304f `var n` \u3063\u3066\u3069\u3053\u306b\u5b58\u5728\u3057\u7d9a\u3051\u308b\u306e\u304b\uff1f\u3053\u306e\u8a18\u4e8b\u3067\u306f\u305d\u3046\u3044\u3046\u7591\u554f\u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\n```js:example.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n```\n\n\u30b3\u30fc\u30c9\u306f SpiderMonkey \u3067\u691c\u8a3c\u3057\u3066\u308b\u306e\u3067\u6a19\u6e96\u51fa\u529b\u95a2\u6570\u304c `print` \u3060\u3051\u3069\u3001`console.log` \u306b\u7f6e\u304d\u63db\u3048\u308c\u3070\u30d6\u30e9\u30a6\u30b6\u3067\u3082\u52d5\u4f5c\u3059\u308b\u306f\u305a\u3002\u306a\u304a\u3001OS X \u3067 Homebrew \u304c\u5165\u3063\u3066\u308b\u306a\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067 SpiderMonkey \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n```bash\n$ brew install spidermonkey\n$ js example.js\n```\n\n# \u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\n\n\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u8a71\u3092\u3059\u308b\u3068\u7d76\u5bfe\u51fa\u3066\u304f\u308b\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\uff08\u9759\u7684\u30b9\u30b3\u30fc\u30d7\uff09\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\uff08\u52d5\u7684\u30b9\u30b3\u30fc\u30d7\uff09\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u304c\u652f\u3048\u3066\u3044\u3066\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u306b\u30af\u30ed\u30fc\u30b8\u30e3\u306f\u306a\u3044\u3093\u3060\u3088\u306d\u3002\n\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068 `10` \u304c\u51fa\u529b\u3055\u308c\u308b\u3002JavaScript \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3060\u304b\u3089\u306d\u3002\u3067\u3082\u3001\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3060\u3063\u305f\u3089 `20` \u304c\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```js:scope.js\nvar x = 10;\n\nfunction foo() {\n  print(x); // 10\n}\n\nfunction bar() {\n  var x = 20;\n  foo();\n}\n\nbar();\n```\n\nPerl \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3092\u4f7f\u3044\u5206\u3051\u3089\u308c\u308b\u306e\u3067\u3001\u524d\u8ff0\u306e\u30b3\u30fc\u30c9\u3092\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u3067\u66f8\u3044\u3066\u307f\u308b\u3002\n\n```pl:scope.pl\n$x = 10;\n\nsub foo {\n  print $x, \"\\n\"; # 20\n}\n\nsub bar {\n  local $x = 20;\n  foo();\n}\n\nbar();\n```\n\nOS X \u306a\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3067\u304d\u308b\u3002\u30bf\u30fc\u30df\u30ca\u30eb\u306b `20` \u304c\u51fa\u529b\u3055\u308c\u305f\u306f\u305a\u3002\n\n```bash\n$ perl scope.pl\n```\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3068\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30b9\u30b3\u30fc\u30d7\u306e\u9055\u3044\u306f\u3001\u30b3\u30fc\u30c9\u4e0a\u3067\u6c7a\u307e\u308b\u304b\u5b9f\u884c\u4e0a\u3067\u6c7a\u307e\u308b\u304b\u3068\u3044\u3046\u9055\u3044\u3002\u30b3\u30fc\u30c9\u4e0a\u3067\u306f\u95a2\u6570 `foo` \u306e\u5b9a\u7fa9\u5143\u306b\u3042\u308b\u306e\u306f `10` \u306b\u521d\u671f\u5316\u3055\u308c\u305f `var x` \u306b\u306a\u308b\u3002\u5b9f\u884c\u4e0a\u3067\u306f `foo` \u306e\u547c\u51fa\u5143\u306b\u3042\u308b\u306e\u306f `20` \u306b\u521d\u671f\u5316\u3055\u308c\u305f `var x` \u306b\u306a\u308b\u3002\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u306e\u5834\u5408\u3001\u5909\u6570 `x` \u3092\u30b3\u30fc\u30c9\u4e0a\u3068\u5b9f\u884c\u4e0a\u306e\u3069\u3063\u3061\u306e\u65b9\u6cd5\u3067\u89e3\u6c7a\u3057\u3066\u3044\u308b\u304b\u3067\u51fa\u529b\u304c\u9055\u3046\u3053\u3068\u306b\u306a\u308b\u3002\n\n# ECMAScript 5.1 \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u306e\u539f\u7406\n\nJavaScript \u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u30b9\u30b3\u30fc\u30d7\u3060\u3002\u305d\u308c\u3092 JavaScript \u306e\u4ed5\u69d8 ECMAScript 5.1 \u3067\u306f\u3069\u3046\u3084\u3063\u3066\u5b9f\u73fe\u3057\u3066\u3044\u308b\u306e\u304b\u3092\u898b\u3066\u3044\u3053\u3046\u3002\n\n## \u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u30b3\u30fc\u30c9\u4e0a\u306e\u5165\u308c\u5b50\u69cb\u9020\u3068\u8b58\u5225\u5b50\u304b\u3089\u5909\u6570\u3068\u95a2\u6570\u3078\u306e\u95a2\u9023\u3092\u4fdd\u6301\u3057\u3066\u3044\u308b\u3002\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4f8b\u3092\u898b\u305f\u65b9\u304c\u7406\u89e3\u3057\u3084\u3059\u3044\u3002scope.js \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306b\u306a\u308b\u3002\n\n```js:scope.js\nvar x = 10;\n\nfunction foo() {\n  print(x); // 10\n}\n\nfunction bar() {\n  var x = 20;\n  foo();\n}\n\nbar();\n```\n\n![scope.js \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/RO_13i8W343lV4L_W6HwD7CtVy34a_F0a9afQmq3CsFsxx8WOoHUAEsZhsLuTFWKHlGmsBTM_ZITjAxNZ55pLzB2JLCZD0i1TZ327ZP5obiYNpct3gNj22-9DCBa95SUyCMMctzkb2HpzHrbg5OP9MVLh4EdzGhm8uyRHhjVQ5Q7iFP-fbICkd9HLH7o4rzj6At-CtCQGcQj4M3SmRQeSKhytu0Vp0Py0G00)\n\n\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f\u4e0b\u8a18\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8003\u3048\u308b\u3002\n\n* record: \u74b0\u5883\u30ec\u30b3\u30fc\u30c9\n* outer: \u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3078\u306e\u53c2\u7167\n\nglobalEnv \u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3060\u3002fooEnv \u306f\u95a2\u6570 `foo` \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3067\u3001\u305d\u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306f globalEnv \u3060\u3002\u306a\u304a\u3001global \u306f\u3044\u308f\u3086\u308b\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3060\u3002\u4f8b\u3048\u3070\u3001\u30d6\u30e9\u30a6\u30b6\u30fc\u4e0a\u3067\u5b9f\u884c\u3059\u308b JavaScript \u306a\u3089\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f `window` \u306b\u306a\u308b\u3002\n\n\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u8b58\u5225\u5b50\u3068\u5024\u3092\u8a18\u9332\u3059\u308b\u3002\u305f\u3060\u3057\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u74b0\u5883\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3078\u306e\u53c2\u7167\u306b\u306a\u308b\u3002`var x = 10;` \u304c\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u8ffd\u52a0\u3055\u308c\u308b\u306e\u306f\u3053\u306e\u305f\u3081\u3060\u3002`var x = 20;` \u306f barEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\u3002\uff08\u4ed5\u69d8\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306f\u3082\u3046\u5c11\u3057\u8907\u96d1\u306a\u306e\u3067\u3001\u3053\u306e\u8aac\u660e\u306f\u6b63\u78ba\u3067\u306f\u306a\u3044\u3002\uff09\n\n## \u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u3042\u308b\u6642\u70b9\u306e\u5b9f\u884c\u4e0a\u306e\u5165\u308c\u5b50\u69cb\u9020\u3092\u30b9\u30bf\u30c3\u30af\u3068\u3057\u3066\u4fdd\u6301\u3057\u3066\u3044\u308b\u3002\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3082\u4f8b\u3092\u898b\u305f\u65b9\u304c\u7406\u89e3\u3057\u3084\u3059\u3044\u3002scope.js \u306e `print(x);` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u4e0b\u8a18\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306b\u306a\u308b\u3002\uff08PlantUML \u3092\u4f7f\u3044\u3053\u306a\u305b\u3066\u306a\u304f\u3066\u30b9\u30bf\u30c3\u30af\u611f\u306f\u5168\u7136\u8868\u305b\u3066\u306a\u3044\u3051\u3069\u2026\u2026\u3002\uff09\n\n![scope.js \u306e print(x); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/VL913i8W4BppYlr0JVLej1VZ1xnQ3nIfgI8OfAR6zEzkG-c2KIzbcPaTXgNtIwDltF8htDrJIVpQHhZsgXWprLaA1oTbAgwsdHGRrx5a1qkG-W5hM8smVXHJNsrCQAAIEWOibbVS1ZcL91-mM3uToAOAnLOAOuyKg4XOqpffaTIjKabCTF5BRF7g2GoTt-xfap6_90Qb1kYMiCXBtHF_pyj3OsZKTgYRvxJ7G8ZiwrOBrnXz80RjK-RZfMQp7nD68def6bUMXT4as7ZR2DjbQUnWJ4GOJqICDj6FCQ3-m3S0)\n\n\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f\u4e0b\u8a18\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8003\u3048\u308b\u3002\n\n* env: \u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\n\nglobalExecCtx \u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u306a\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u6700\u521d\u306b\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002globalExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u95a2\u6570 `bar` \u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b barExecCtx \u306f\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002barExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u95a2\u6570 `foo` \u304c\u547c\u3073\u51fa\u3055\u308c\u305f\u3068\u304d\u306b fooExecCtx \u306f\u751f\u6210\u3055\u308c\u3066\u30b9\u30bf\u30c3\u30af\u306b\u7a4d\u307e\u308c\u308b\u3002\n\n`print(x);` \u3092\u5b9f\u884c\u3059\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u3060\u3068\u56f3\u306e\u3088\u3046\u306b globalExecCtx\u30fbbarExecCtx\u30fbfooExecCtx \u306e3\u3064\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u5b58\u5728\u3059\u308b\u3002\u95a2\u6570 `foo` \u306e\u5b9f\u884c\u304c\u7d42\u4e86\u3059\u308b\u3068 fooExecCtx \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3082\u7d42\u4e86\u3059\u308b\u3002\n\n## \u8b58\u5225\u5b50\u306e\u89e3\u6c7a\n\n\u3055\u3042 `print(x);` \u306e\u5909\u6570 `x` \u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\n\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u3082\u56f3\u304b\u3089\u898b\u3066\u307f\u308b\u3002\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u56f3\u306e\u5909\u6570 `x` \u306e\u89e3\u6c7a\u306b\u5229\u7528\u3055\u308c\u308b\u53c2\u7167\u3092\u77e2\u5370\u306b\u3057\u3066\u307f\u305f\u3002\n\n![scope.js \u306e print(x); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306e\u5909\u6570 `x` \u306e\u89e3\u6c7a\u306b\u5229\u7528\u3055\u308c\u308b\u53c2\u7167\u3092\u77e2\u5370\u306b\u3057\u305f\u3082\u306e](http://www.plantuml.com/plantuml/img/VLB13e8m3BtlA_e36FH8b8ln1xoA1vZ3e7CpOnYCyTyjZj7Dg1VMlVVwshMqvqPTIrDUeBLtAV1h6cwxYsHCLoV1BHobhagvwGLVsvv5DyX0g1kiO3d2wfPFURNMFeb2oXYmK5wLniif9Fc0XVAf89iY51l1jJbGGtd4wiuAWwJgf8pQH1TtX1QF9u4-yzixNMVC7P51eG3w31PfePx4__DoqDWqQdlKpLEwOqE8xEfESTjejIS6xMFcOrEpsOy98n5iYiQrJ18_6m8H6vyRODiaZnltriW4Umfg3iJe4_mQRoDNyWK0)\n\n\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u624b\u9806\u306f\u5358\u7d14\u3060\u3002\uff08\u4ed5\u69d8\u306e\u8b58\u5225\u5b50\u306e\u89e3\u6c7a\u306f\u3082\u3046\u5c11\u3057\u8907\u96d1\u306a\u306e\u3067\u3001\u3053\u306e\u8aac\u660e\u306f\u6b63\u78ba\u3067\u306f\u306a\u3044\u3002\uff09\n\n1. \u73fe\u5728\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n2. \u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50\u304c\u5b58\u5728\u3059\u308b\u304b\uff1f\n    - \u5b58\u5728\u3059\u308b\uff1a\u305d\u306e\u8b58\u5225\u5b50\u306e\u5024\u3092\u8fd4\u3059\n    - \u5b58\u5728\u3057\u306a\u3044\uff1a\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3057\u30662\u3092\u518d\u5b9f\u884c\u3059\u308b\n\n`print(x);` \u306e\u5834\u5408\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n1. \u73fe\u5728\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 fooExecCtx \u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n2. \u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50 `x` \u304c\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u3001\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 fooEnv \u306e\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 globalEnv \u3092\u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306b\u3059\u308b\n3. \u73fe\u5728\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883 globalEnv \u306e\u74b0\u5883\u30ec\u30b3\u30fc\u30c9\uff08\u30b0\u30ed\u30fc\u30d0\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09\u306b\u5bfe\u8c61\u306e\u8b58\u5225\u5b50 `x` \u304c\u5b58\u5728\u3059\u308b\u306e\u3067\u3001`x` \u306e\u5024\u3067\u3042\u308b `10` \u3092\u8fd4\u3059\u3002\n\n# ECMAScript 5.1 \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\n\nJavaScript \u306e\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3092\u8aac\u660e\u3057\u3088\u3046\u3002\n\n## JavaScript \u306e\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u30af\u30ed\u30fc\u30b8\u30e3\n\nJavaScript \u306e\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3060\u3002\u3069\u3093\u306a\u95a2\u6570\u5b9a\u7fa9\u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u308b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3082\u3001\u95a2\u6570\u304c\u5b9a\u7fa9\u3055\u308c\u305f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u3078\u306e\u53c2\u7167\uff08\u30b9\u30b3\u30fc\u30d7\uff09\u3092\u6301\u3064\u304b\u3089\u3060\u3002\u524d\u9805\u306e\u56f3\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53cd\u6620\u3055\u305b\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n![scope.js \u306e print(x); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8ffd\u52a0](http://www.plantuml.com/plantuml/img/VL91SiCW3Bpp2dt0dhH7J-9Bftr0pxdOX7RIOl1Wx76duxz73iA2DEa5mUvgaGJ3zzdqZMiw6FoFLhYwi_HZfuMmxPUI7ZwrRHlzEYlvucUHdQ02PIOum9vWCzLRteUrCOctdB5YgRnjN9JpbkKhbigt2yMsGx5JqheJ5rHdh1szSaYQKUkiJ7G98RNuNHYCcVVw39M943A3em6OAtZU7St2_7zU0QAYKJkZxcd7Poo8PlSs6bapWUuqfK2axQs8e8ZIGTfUFUxbggPuNmtYvXUKvOFNGoBv1VmKHH77dc4qoGHxB_AHH6CcukWJWcoIJxUYsOLKmRLNHcBtSLR5pIL_mGi0)\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u3002\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u539f\u7406\u3092\u660e\u3089\u304b\u306b\u3057\u3088\u3046\u3002\n\n## \u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u539f\u7406\n\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u30b3\u30fc\u30c9\u3092\u518d\u63b2\u3059\u308b\u3002\n\n```js:example.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n```\n\n`var count = createCounter();` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n![var count = createCounter(); \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/PP1T3i8W48JVEGKNu0AczgNH0tW3kbrDbIuDVwctTnjhaV92OEQRXS6_HfgrqvFquMsGLpT2Y9CHmlPFX20VnlRQN1Q4BYoYECcJH4hoB9jDfjGUSvJ4lcFU8LWtv4XRk3O6T6nIDCS7R1n3u507x6oaBzmKmZKIj7_mgZ8KQS3xI3ZiOwkKg1JEUx0p7XlMe59LtrMhxyXjrKsLrNwVcWt6FW00)\n\n\u95a2\u6570 `createCounter` \u306e\u7d42\u4e86\u76f4\u524d\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\u95a2\u6570 `createCounter` \u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\u305d\u3057\u3066\u3001\u6ce8\u76ee\u3057\u3066\u307b\u3057\u3044\u306e\u306f \u95a2\u6570 `createCounter` \u5185\u306e\u7121\u540d\u95a2\u6570\u304c\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 anonymousFunc \u3068\u3057\u3066\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3068\u3053\u308d\u3002\n\n![\u95a2\u6570 `createCounter` \u306e\u7d42\u4e86\u76f4\u524d\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/XL913i8W4BppYlr0ZMUZlHXzW6SlbAwcIXT3mMYCVtVLre9Wl3HbTcPsbgKxDdIILhRGkQj6_jf6ETzgOQe3AWTxRIgfLnTKItSHqGbcW7I61SnxcCwb67JAedIuD9uSsa6U0qUNk1gQVVp5vuzb5fMnzTY_ZAh6imiNoMlz8nNxVGEXxMrB03I3wPRkEUBG8JV-6-e3CJUI9yEkFQao83zH9dcgSTSGrldyJvL84DPtofpmHp19XgwjyTrB7Pr2PMONQQUY23QJN11NusRzV8odOuoRApP5V7kzLxAw-2sEiZHCGFdZCfba7-u3)\n\n`print(count());` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 anonymousFunc \u304c\u5909\u6570 `count` \u3067\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n![`print(count());` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/TLBD3i8W3Bxp57s19PuNtSNe0tZsWjWObHN3OD4OtzsYqwrZkn3u_je2pVLCD-rr3KruMEJLdqs8jLNA7Ive0foiEsYxkQDPXxiI9oW1gOKLB3kOschierRzTwptQ9m_zfPAi2u6z4nIj7q3ngCEk7QHc4nvOs0O-zmJ09MmsDDhIlYhCDznrn1hXJrv1B2DPAg1EA59fCdHetQn-GecfqYKoX1EQOoxuKnx8bY9qz0v7fe3yaf5CNYVx9gObSMwAHdFn-YvASydRbV8k-rgP0yhFrTlO-uD)\n\n\u5909\u6570 `count` \u3092\u95a2\u6570\u3068\u3057\u3066\u547c\u3073\u51fa\u3057\u305f\u5f8c\u306e `return n++;` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\nanonymousEnv \u306e outer \u304c createCounterEnv \u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u3001anonymousFunc \u306e scope \u3092 anonymousEnv \u3092\u751f\u6210\u3059\u308b\u3068\u304d\u306b outer \u306b\u8a2d\u5b9a\u3059\u308b\u304b\u3089\u3002**\u95a2\u6570\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u306f\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u306e\u300c\u5916\u5074\u306e\u30ec\u30ad\u30b7\u30ab\u30eb\u74b0\u5883\u300d\u306b\u95a2\u6570\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u300c\u30b9\u30b3\u30fc\u30d7\u300d\u3092\u8a2d\u5b9a\u3059\u308b**\u3068\u3044\u3046\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u3053\u308c\u307e\u3067\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u3092\u898b\u8fd4\u3057\u3066\u3082\u305d\u3046\u306a\u3063\u3066\u308b\u306f\u305a\u3060\u3002\n\n![`count` \u3092\u95a2\u6570\u3068\u3057\u3066\u547c\u3073\u51fa\u3057\u305f\u5f8c\u306e `return n++;` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/ZLD1RiCW4BppYls0evwZnfUeVK3FkH2wgjBY9S8G9QhozwvJOXQmcbuisDcPqIphyUj0H-tr06EuMEIlFvWG1wkKst-Y2V1XtLxRbpEQRJYhuWPhG3h11fvJcKxzpDFaw3AuEDwfTI6pCo85PaqrdvZYqJZ_dZtx0dKne6UGeiq9Z4STSEiYCJZfrGKf-xqZ05h3quwkIurtXxyZiucy50RN6febQxjw5YagKuhEXleQoVIYUQeMS_vjM9pF1AccmYgZSKTy5Fp6BcwIkP2lTUewyVBD0p1QcgMKN6zZP6o9SvDxwyhP9e_7AoD5nOwcrSwwBRPQ_UFVc0Ia_Wy0)\n\n\u5909\u6570 `n` \u3092\u89e3\u6c7a\u3057\u3088\u3046\u3002\n\n![`count` \u3092\u95a2\u6570\u3068\u3057\u3066\u547c\u3073\u51fa\u3057\u305f\u5f8c\u306e `return n++;` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306e\u5909\u6570 `n` \u306e\u89e3\u6c7a\u306b\u5229\u7528\u3055\u308c\u308b\u53c2\u7167\u3092\u77e2\u5370\u306b\u3057\u305f\u3082\u306e](http://www.plantuml.com/plantuml/img/ZLD1RiCW4BppYls0evwZr9UeVK3FkH2wgjBY9S8G9QhozwvJObYmcbuisDcPqIphyUj0H-tr06EuMEIlFvWG1wkKst-Y2V1XtLxRbpEQRJWhSOCr89tW6JQfJAT-vcboT1bS7E_Kkf3P6Ia5PaqrdvZYqJZ_dZrxWReOq3D8qUO4ngCEk7MH69pqwa8f-xqZ05h3quwkIurtXxyZiqbv4GRN6febQxjw5YagKqHdGtsDPFgYUQgAEVysBCvdWbHJOPNHk2C-2dvZYrl9NCZNEdLTyVBD0p0gpL9AhhSnChR4kSczTNAsoUFnocnArM99qsvduHPRhVxnSx10Bmn-0000)\n\n\u6700\u521d\u306e `print(count());` \u304c\u7d42\u4e86\u3057\u305f\u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002createCounterEnv \u306e n \u304c1\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u306d\u3002\n\n![\u6700\u521d\u306e `print(count());` \u304c\u7d42\u4e86\u3057\u305f\u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/TLBD3i8W3Bxp57s17RmkkelH1_3i1R4nAYk6mQ8nlhj5frl7TY7m_RK5ckkPRjhh6fhmiCYhFviGQwkKErpG13XPTz1sSqUp3dSbJb02KWihM7OmjTNOHwtwxrZlqJX_x2sLO5qCw9caQFi6Z4STSEqYCPdoni0mzhad02fXiQVNbF1NORxZhY7M2dlo260RoLG3SKAJI9EZH-rYynLCJf4ebI6SqXXtmvdsHB0Ifw5pF3G7v9MAOl0-sJKnAujrKpAUZz5pKvvFtAwGTzlLo1vMVgxUnjmR)\n\n\u3053\u308c\u304c\u30af\u30ed\u30fc\u30b8\u30e3\u306e\u539f\u7406\u3060\u3002\n\n## createCounter \u30922\u56de\u5b9f\u884c\u3059\u308b\n\n\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\u306e\u30b3\u30fc\u30c9\u3067\u95a2\u6570 `createCounter` \u30922\u56de\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\u3082\u3061\u308d\u3093\u5225\u306e\u30ab\u30a6\u30f3\u30bf\u30fc\u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\n```js:example2.js\nfunction createCounter() {\n  var n = 0;\n  return function() {\n    return n++;\n  }\n}\n\nvar count = createCounter();\nprint(count()); // 0\nprint(count()); // 1\nprint(count()); // 2\n\nvar count2 = createCounter();\nprint(count2()); // 0\nprint(count2()); // 1\nprint(count2()); // 2\n```\n\n\u3053\u308c\u306f\u306a\u305c\u306a\u306e\u304b\u3082\u5ff5\u306e\u305f\u3081\u8003\u3048\u3066\u307f\u308b\u3002\u3068\u8a00\u3063\u3066\u3082\u3001\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u3092\u307f\u308c\u3070\u3059\u3050\u306b\u89e3\u308b\u306f\u305a\u3002\n\n`print(count2());` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n![`print(count2());` \u6642\u70b9\u3067\u306e\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u56f3](http://www.plantuml.com/plantuml/img/XLFBRiCW4Bpp5Vi3bghjBKfzYTeFw3aNGb2L5YyH1YjHrNyFg4xD0aul5ipCphxm-7MYitHoWD5VZOvVTr8-34O8U_ZKoiE7iGTfNYzQxVn5i1jiGDC4Bx2TOPhwCeucyNUAUgULTSSbf6Ui3LwxI58mIm7AQUdrpWQAPF8hWTpsUqy0j87dFVsqXFSChOfBELO6s4hrr4g5_-JwXURcevR5fnW6l0LIVIPEQ199idGTR1XR0gmKkD9huaI5H9zHsRDUwO0v2tRB8yl1h1WWTy175gcDkjgkovvSjVd8yeBhXPKIlCyp4lMu5exxhk2OlVFklUFxdmki7lf35ej_SN6Dv0q0)\n\n\u3053\u308c\u3067\u3059\u3079\u3066\u306e\u8b0e\u306f\u89e3\u3051\u305f\u304b\u306a\u3002\n\n# \u88dc\u8db3\u4e8b\u9805\n\n\u672c\u8a18\u4e8b\u3067\u306f\u4e0b\u8a18\u3092\u6761\u4ef6\u306b\u3059\u308b\u3053\u3068\u3067 ECMAScript 5.1 \u306e\u4ed5\u69d8\u3092\u7701\u7565\u3057\u3066\u3044\u308b\u3068\u3053\u308d\u304c\u3042\u308b\u3002\n\n1. strict \u30e2\u30fc\u30c9\u30b3\u30fc\u30c9\u306e\u307f\u5bfe\u8c61\u3068\u3059\u308b\n2. eval \u30b3\u30fc\u30c9\u306f\u5bfe\u8c61\u5916\u3068\u3059\u308b\n3. try \u6587 catch \u7bc0\u306f\u5bfe\u8c61\u5916\u3068\u3059\u308b\n4. 1\u30683\u3092\u524d\u63d0\u306b\u5b9f\u884c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e LexicalEnvironment \u3068 VariableEnvironment \u3092\u540c\u4e00\u3068\u307f\u306a\u3057\u3066 env \u306e\u540d\u524d\u3067\u53c2\u7167\u3059\u308b\n\n# \u53c2\u8003\u6587\u732e\n\nECMA-262 Edition 5.1\u3092\u8aad\u3080\nhttp://www.ecma-international.org/ecma-262/5.1/\nhttp://dmitrysoshnikov.com/ecmascript/es5-chapter-3-1-lexical-environments-common-theory/\nhttp://dmitrysoshnikov.com/ecmascript/es5-chapter-3-2-lexical-environments-ecmascript-implementation/\n", "tags": ["JavaScript", "ECMAScript"]}