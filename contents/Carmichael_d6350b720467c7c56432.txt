{"context": "\n\n\u30b9\u30d7\u30ec\u30c3\u30c8\u304b\u3089\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u306e\u307f\u3092\u9078\u629e\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\n\n\u6dfb\u4ed8\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3092\u3001Spread\u3001pdf\u3001xlsx\u3067\u6307\u5b9a\u3067\u304d\u308b\u3002\n\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u53ef\u80fd\n\n\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u3092\u6dfb\u4ed8\u3067\u304d\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u4e00\u5ea6\u30c9\u30e9\u30a4\u30d6\u4e0a\u306e\u30eb\u30fc\u30c8\u306b\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u30b3\u30d4\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u4ee5\u5916\u3092\u524a\u9664\u3057\u3066\u3001\u305d\u308c\u3092\u6dfb\u4ed8\u3059\u308b\u3068\u3044\u3046\u5f37\u5f15\u306a\u51e6\u7406\u3002\uff08\u6700\u5f8c\u306b\u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u524a\u9664\uff09\n\nfunction sendEmailattAchmentMultiFile() {\n\n  // \u73fe\u5728\u65e5\u4ed8\u3092\u53d6\u5f97\n  var nowDate = Utilities.formatDate(new Date(), 'JST', 'yyyyMMdd');\n\n  // \u81ea\u5206\u81ea\u8eab\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u540d\u3092\u53d6\u5f97\n  var mySpreadSheetName = SpreadsheetApp.getActiveSpreadsheet().getName();\n\n\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u8a2d\u5b9a\u9805\u76ee\u2193\u2193\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n\n  // [\u5b9b\u5148]\n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u8907\u6570\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  // to,cc,bcc\u5171\u306b\u8a2d\u5b9a\u65b9\u6cd5\u306f\u540c\u4e00\u3067\u3059\u3002\n\n  // To\n  var strMailTo = \"test@gmail.com\";\n  // Cc\n  var strMailCc = \"\";\n  // Bcc\n  var strMailBcc = \"\";\n\n\n  // [\u30e1\u30fc\u30eb\u30bf\u30a4\u30c8\u30eb]\n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002 \n\n  var strSubject = \"\u30c6\u30b9\u30c8\" + nowDate;\n\n\n  // [\u30e1\u30fc\u30eb\u672c\u6587] \n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002 \n  // \u300c+\u300d\u306f\u6587\u5b57\u5217\u9023\u7d50\u306b\u306a\u308a\u307e\u3059\n  // \u300c/n\u300d\u306f\u6539\u884c\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\u6539\u884c\u3057\u305f\u3044\u7b87\u6240\u306b/n\u3092\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n  var strBody = nowDate + \"\u65e5\u306e\u30e1\u30fc\u30eb\u9001\u4ed8\u3044\u305f\u3057\u307e\u3059\u3002\u30c6\u30b9\u30c8\u914d\u4fe1\u3067\u3059\u3002\\n\"\n                + \"\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u6dfb\u4ed8\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\";\n\n  // [\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b] \n  // \u8907\u6570\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u6570\u5206\u306e\u5909\u6570(\u914d\u5217)\u3092\u5ba3\u8a00\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  // \u914d\u5217\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u2193\u2193\n  // 0\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\uff08\u30c9\u30e9\u30a4\u30d6\u4e0a\u306b\u3042\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\uff09\u3000\u81ea\u5206\u81ea\u8eab\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u300cmySpreadSheetName\u300d\u3068\u3044\u3046\u5909\u6570\u3092\u4f7f\u7528\u3059\u308b\u3002\n  // 1\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d\u3000\u9001\u4fe1\u3059\u308b\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u65e5\u4ed8\u3092\u4ed8\u4e0e\u3059\u308b\u5834\u5408\u306f\u300cnowDate\u300d\u3092 + \u3067\u9023\u7d50\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  // 2\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u7279\u306b\u5909\u63db\u304c\u5fc5\u8981\u3067\u306f\u306a\u3044\u5834\u5408\uff08\u30b9\u30d7\u30ec\u30c3\u30c8\u3067\u9001\u4fe1\u3059\u308b\uff09\u306f\u3001\"\"(\u30d6\u30e9\u30f3\u30af)\u3092\u8a2d\u5b9a\n  //       \u6307\u5b9a\u53ef\u80fd\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6307\u5b9a\u5024\u3000\"pdf\",\"xlsx\",\u201d\u201d\n  // 3\u756a\u76ee\u4ee5\u964d\uff1a\u9001\u4fe1\u3059\u308b\u30b7\u30fc\u30c8\u540d\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n  //\n  // \u203b\u5909\u6570\u540d\u3092\u6307\u5b9a\u3059\u308b\u4ee5\u5916\u306f\u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u56f2\u3093\u3067\u3001[ ] \u306e\u9593\u306b\u5b9a\u7fa9\u3057\u3066\u4e0b\u3055\u3044\u3002\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  //\n\n  // \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb1\u3064\u76ee\n  var sendSpreadsheet = [\n     // \u914d\u52170\u756a\u76ee\n   \u3000mySpreadSheetName,\n     // \u914d\u52171\u756a\u76ee\n     mySpreadSheetName + \"_\" + nowDate,\n     // \u914d\u52172\u756a\u76ee\n     \"xlsx\",\n     // \u914d\u52173\u756a\u76ee\u4ee5\u964d\n     \"\u30b7\u30fc\u30c81\",\n     \"\u30b7\u30fc\u30c82\",\n     \"\u30b7\u30fc\u30c83\"];\n\n       // \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb2\u3064\u76ee\n  var sendSpreadsheet2 = [\n     // \u914d\u52170\u756a\u76ee\n   \u3000\"\u9001\u4fe1\u3057\u305f\u3044\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\u524d\",\n     // \u914d\u52171\u756a\u76ee\n     \"\u9001\u4fe1\u3057\u305f\u3044\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\u524d\" + \"_\" + nowDate,\n     // \u914d\u52172\u756a\u76ee\n     \"pdf\",\n     // \u914d\u52173\u756a\u76ee\u4ee5\u964d\n     \"Spread2\u30b7\u30fc\u30c81\",\n     \"Spread2\u30b7\u30fc\u30c82\",\n     \"Spread3\u30b7\u30fc\u30c83\"];\n\n\n  // [\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u7e8f\u3081\u308b] \n  // \u4e0a\u8a18\u3067\u5ba3\u8a00\u3057\u305f\u914d\u5217\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u60c5\u5831\u30922\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  // \u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n  // \u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u3068\u3001\u4e0a\u8a18\u3067\u5909\u6570\u5ba3\u8a00\u3057\u3066\u3044\u3066\u3082\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3055\u308c\u307e\u305b\u3093\u3002\n  var allSendSpreadsheets = [sendSpreadsheet,sendSpreadsheet2]\n\n\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u8a2d\u5b9a\u9805\u76ee\u2191\u2191\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u3053\u3053\u304b\u3089\u51e6\u7406\u2193\u2193\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n\n\n  // \u2193Google OAuth\u8a8d\u8a3c\u2193\n\n  // Google\u30c9\u30e9\u30a4\u30d6\u306e\u30eb\u30fc\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u53d6\u5f97\n  // \u3053\u306e\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u306a\u3044\u3068\u30e1\u30fc\u30eb\u9001\u4fe1\u306e\u969b\u306b\u3001Google\u30c9\u30e9\u30a4\u30d6\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30b9\u30b3\u30fc\u30d7\u304c\u53d6\u5f97\u3055\u308c\u306a\u3044\u3002\n  // \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u521d\u56de\u8d77\u52d5\u6642\u306bGoogle\u30c9\u30e9\u30a4\u30d6\u3078\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u6c42\u3081\u3089\u308c\u308b\u3002\n  DriveApp.getRootFolder();\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3059\u308b\u969b\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\n  var fetchOpt = {\n    \"headers\" : { Authorization: 'Bearer ' + ScriptApp.getOAuthToken() },\n    \"muteHttpExceptions\" : true\n   };\n\n  // \u2191Google OAuth\u8a8d\u8a3c\u2191\n\n\n  // \u30e1\u30fc\u30eb\u9001\u4fe1\u6642\u306e\u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u7528\u306e\u914d\u5217\u306e\u5ba3\u8a00\n  var attachmentFiles = new Array();\n\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306eKEY\u5024\n  var key; \n\n  // \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\n  var sendName;\n\n  // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\n  var fetchUrl;\n\n  // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306eKEY\u5024\u306e\u914d\u5217\n  var keys = new Array(allSendSpreadsheets.length);\n\n  // \u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306e\u60c5\u5831\u3054\u3068\u306b\u7e70\u308a\u8fd4\u3057\u51e6\u7406\n  for(i = 0; i < allSendSpreadsheets.length; i++){\n\n    // \u9001\u4fe1\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306e\u4f5c\u6210\n    key = createSendFile_(allSendSpreadsheets[i]);\n\n    // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u304c\u30d6\u30e9\u30f3\u30af\u306e\u5834\u5408\n    if(key == \"\"){\n\n     // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u6b21\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u60c5\u5831\u3092\u51e6\u7406\u3059\u308b\u3002\n     keys[i] = \"\";\n     continue;\n    }\n\n    // KEY\u5024\u306e\u914d\u5217\u306bKEY\u5024\u3092\u8a2d\u5b9a\u3059\u308b\n    keys[i] = key;\n\n    // PDF\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408\n    if(allSendSpreadsheets[i][2] == \"pdf\"){\n\n    \u3000// \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1] + \".pdf\";\n\n      // \u9001\u4fe1\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u60c5\u5831\u3092\u53d6\u5f97\n      var attachmentFile = DriveApp.getFileById(key).getBlob();\n\n    \u3000// \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push({fileName:sendName, mimeType: attachmentFile.getContentType(), content:attachmentFile.getBytes()});\n\n    }\u3000// \u30a8\u30af\u30bb\u30eb\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408 \n    else if(allSendSpreadsheets[i][2]  == \"xlsx\" ){\n\n    \u3000// \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1] + \".xlsx\";\n\n      // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\u3092\u4f5c\u6210\n      fetchUrl = \"https://docs.google.com/feeds/download/spreadsheets/Export?key=\" + key + \"&amp;exportFormat=xlsx\";\n\n      // \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push(UrlFetchApp.fetch(fetchUrl,fetchOpt).getBlob().setName(sendName));\n\n\n    } // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408(\u30d5\u30a1\u30a4\u30eb\u5909\u63db\u306a\u3057)\n    else if(allSendSpreadsheets[i][2] == \"\"){\n\n      // \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1];\n\n      // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\u3092\u4f5c\u6210\n      fetchUrl = \"https://docs.google.com/feeds/download/spreadsheets/Export?key=\" + key;\n\n      // \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push(UrlFetchApp.fetch(fetchUrl, fetchOpt).getBlob().setName(sendName));\n\n    } // \u4e0a\u8a18\u4ee5\u5916\u306e\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n    else {\n\n      // \u6307\u5b9a\u5916\u306e\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u305f\u3081\u3001\u6b21\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u60c5\u5831\u3092\u51e6\u7406\u3059\u308b\u3002\n      continue;\n    }\n\n  }\n\n  // \u30e1\u30fc\u30eb\u9001\u4fe1\n  MailApp.sendEmail(strMailTo, strSubject, strBody, {cc:strMailCc, bcc:strMailBcc, attachments:attachmentFiles});\n\n  // \u9001\u4fe1\u7528\u306b\u4f5c\u6210\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u5168\u3066\u524a\u9664\u3059\u308b\n  for(i = 0; i < keys.length; i++){\n\n    if(keys[i] == \"\"){continue;}\n\n    // \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u51e6\u7406\n    deleteFile_(keys[i]);\n  }\n\n}\n\n/**\n*\n* \u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b(private\u30e1\u30bd\u30c3\u30c9)\n*\n* @param String[] sendSpreadsheetInfo \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u60c5\u5831(\u914d\u5217)\n* @return String \u4f5c\u6210\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\n*\n*/\nfunction createSendFile_(sendSpreadsheetInfo){\n\n  // \u9001\u4fe1\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u6307\u5b9a\u30d5\u30a1\u30a4\u30eb\u540d\u3067Google\u30c9\u30e9\u30a4\u30d6\u3088\u308a\u53d6\u5f97\u3059\u308b\u3002\n  var Files = DriveApp.getFilesByName(sendSpreadsheetInfo[0]);\n\n  // \u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001\u623b\u308a\u5024\u306f\u30d6\u30e9\u30f3\u30af\u3067\u51e6\u7406\u7d42\u4e86\n  if(!Files.hasNext()){return \"\";}\n\n  // \u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u53d6\u5f97\n  var objFile;\n  while (Files.hasNext()) {\n      objFile = Files.next();\n  }\n\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306eURL\u4f5c\u6210\n  var url = \"https://docs.google.com/spreadsheets/d/\" + objFile.getId() + \"/edit\";\n\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u53d6\u5f97\n  var spreadSheet = SpreadsheetApp.openByUrl(url);\n\n  // \u6307\u5b9a\u3055\u308c\u305f\u30b7\u30fc\u30c8\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u884c\u3046\n  for (var i = 3; i < sendSpreadsheetInfo.length; i++){\n    var sheet = spreadSheet.getSheetByName(sendSpreadsheetInfo[i]);\n\n    // \u6307\u5b9a\u3055\u308c\u305f\u30b7\u30fc\u30c8\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u623b\u308a\u5024\u306f\u30d6\u30e9\u30f3\u30af\u3067\u51e6\u7406\u7d42\u4e86\n    if(sheet == null){return \"\";}\n  }\n   // \u9001\u4fe1\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n  var sendName = sendSpreadsheetInfo[1];\n\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u4f5c\u6210(\u30b3\u30d4\u30fc)\n  var copySpreadsheet = spreadSheet.copy(sendName);\n\n  pivotTableChangeWrite_(copySpreadsheet);\n\n\n  // \u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u9001\u4fe1\u3057\u306a\u3044\u30b7\u30fc\u30c8\u3092\u524a\u9664(\u9001\u4fe1\u3059\u308b\u30b7\u30fc\u30c8\u306e\u307f\u6b8b\u3059)\n  var sheets = copySpreadsheet.getSheets();\n  for (var i = 0; i < sheets.length; i++){  \n    if(sendSpreadsheetInfo.indexOf(sheets[i].getName()) == -1){\n         copySpreadsheet.deleteSheet(sheets[i]);\n    }\n  }\n\n  // \u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u3092\u8fd4\u5374\n  return copySpreadsheet.getId();\n}\n\n/**\n*\n* \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u524a\u9664\u3059\u308b(private\u30e1\u30bd\u30c3\u30c9)\n*\n* @param String deleteKey \u524a\u9664\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\n*\n*/\nfunction deleteFile_(deleteKey){\n\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u3088\u308a\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\n  var objFile = DriveApp.getFileById(deleteKey);\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n  DriveApp.getRootFolder().removeFile(objFile);\n}\n\n##\u30b9\u30d7\u30ec\u30c3\u30c8\u304b\u3089\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u306e\u307f\u3092\u9078\u629e\u3057\u3066\u30e1\u30fc\u30eb\u9001\u4fe1\u3059\u308b\n - \u6dfb\u4ed8\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3092\u3001Spread\u3001pdf\u3001xlsx\u3067\u6307\u5b9a\u3067\u304d\u308b\u3002\n - \u8907\u6570\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u53ef\u80fd  \n - \u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u3092\u6dfb\u4ed8\u3067\u304d\u308b\u30e1\u30bd\u30c3\u30c9\u304c\u898b\u5f53\u305f\u3089\u306a\u304b\u3063\u305f\u305f\u3081\u3001\u4e00\u5ea6\u30c9\u30e9\u30a4\u30d6\u4e0a\u306e\u30eb\u30fc\u30c8\u306b\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u30b3\u30d4\u30fc\u3092\u4f5c\u6210\u3057\u3066\u3001\u6307\u5b9a\u3057\u305f\u30b7\u30fc\u30c8\u4ee5\u5916\u3092\u524a\u9664\u3057\u3066\u3001\u305d\u308c\u3092\u6dfb\u4ed8\u3059\u308b\u3068\u3044\u3046\u5f37\u5f15\u306a\u51e6\u7406\u3002\uff08\u6700\u5f8c\u306b\u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u524a\u9664\uff09\n\n\n```\nfunction sendEmailattAchmentMultiFile() {\n\n  // \u73fe\u5728\u65e5\u4ed8\u3092\u53d6\u5f97\n  var nowDate = Utilities.formatDate(new Date(), 'JST', 'yyyyMMdd');\n  \n  // \u81ea\u5206\u81ea\u8eab\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u540d\u3092\u53d6\u5f97\n  var mySpreadSheetName = SpreadsheetApp.getActiveSpreadsheet().getName();\n  \n  \n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u8a2d\u5b9a\u9805\u76ee\u2193\u2193\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n\n  // [\u5b9b\u5148]\n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u8907\u6570\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  // to,cc,bcc\u5171\u306b\u8a2d\u5b9a\u65b9\u6cd5\u306f\u540c\u4e00\u3067\u3059\u3002\n \n  // To\n  var strMailTo = \"test@gmail.com\";\n  // Cc\n  var strMailCc = \"\";\n  // Bcc\n  var strMailBcc = \"\";\n\n  \n  // [\u30e1\u30fc\u30eb\u30bf\u30a4\u30c8\u30eb]\n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\t\n  \n  var strSubject = \"\u30c6\u30b9\u30c8\" + nowDate;\n\n  \n  // [\u30e1\u30fc\u30eb\u672c\u6587] \n  // \u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\t\n  // \u300c+\u300d\u306f\u6587\u5b57\u5217\u9023\u7d50\u306b\u306a\u308a\u307e\u3059\n  // \u300c/n\u300d\u306f\u6539\u884c\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\u6539\u884c\u3057\u305f\u3044\u7b87\u6240\u306b/n\u3092\u8a18\u8ff0\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n  var strBody = nowDate + \"\u65e5\u306e\u30e1\u30fc\u30eb\u9001\u4ed8\u3044\u305f\u3057\u307e\u3059\u3002\u30c6\u30b9\u30c8\u914d\u4fe1\u3067\u3059\u3002\\n\"\n                + \"\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u6dfb\u4ed8\u306e\u30c6\u30b9\u30c8\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\";\n  \n  // [\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b] \n  // \u8907\u6570\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u3001\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u6570\u5206\u306e\u5909\u6570(\u914d\u5217)\u3092\u5ba3\u8a00\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  // \u914d\u5217\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u2193\u2193\n  // 0\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\uff08\u30c9\u30e9\u30a4\u30d6\u4e0a\u306b\u3042\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\uff09\u3000\u81ea\u5206\u81ea\u8eab\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u5834\u5408\u306f\u300cmySpreadSheetName\u300d\u3068\u3044\u3046\u5909\u6570\u3092\u4f7f\u7528\u3059\u308b\u3002\n  // 1\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u540d\u3000\u9001\u4fe1\u3059\u308b\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u65e5\u4ed8\u3092\u4ed8\u4e0e\u3059\u308b\u5834\u5408\u306f\u300cnowDate\u300d\u3092 + \u3067\u9023\u7d50\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  // 2\u756a\u76ee\uff1a\u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u6307\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u7279\u306b\u5909\u63db\u304c\u5fc5\u8981\u3067\u306f\u306a\u3044\u5834\u5408\uff08\u30b9\u30d7\u30ec\u30c3\u30c8\u3067\u9001\u4fe1\u3059\u308b\uff09\u306f\u3001\"\"(\u30d6\u30e9\u30f3\u30af)\u3092\u8a2d\u5b9a\n  //       \u6307\u5b9a\u53ef\u80fd\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6307\u5b9a\u5024\u3000\"pdf\",\"xlsx\",\u201d\u201d\n  // 3\u756a\u76ee\u4ee5\u964d\uff1a\u9001\u4fe1\u3059\u308b\u30b7\u30fc\u30c8\u540d\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n  //\n  // \u203b\u5909\u6570\u540d\u3092\u6307\u5b9a\u3059\u308b\u4ee5\u5916\u306f\u30c0\u30d6\u30eb\u30b3\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u56f2\u3093\u3067\u3001[ ] \u306e\u9593\u306b\u5b9a\u7fa9\u3057\u3066\u4e0b\u3055\u3044\u3002\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  //\n  \n  // \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb1\u3064\u76ee\n  var sendSpreadsheet = [\n     // \u914d\u52170\u756a\u76ee\n   \u3000mySpreadSheetName,\n     // \u914d\u52171\u756a\u76ee\n     mySpreadSheetName + \"_\" + nowDate,\n     // \u914d\u52172\u756a\u76ee\n     \"xlsx\",\n     // \u914d\u52173\u756a\u76ee\u4ee5\u964d\n     \"\u30b7\u30fc\u30c81\",\n     \"\u30b7\u30fc\u30c82\",\n     \"\u30b7\u30fc\u30c83\"];\n     \n       // \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb2\u3064\u76ee\n  var sendSpreadsheet2 = [\n     // \u914d\u52170\u756a\u76ee\n   \u3000\"\u9001\u4fe1\u3057\u305f\u3044\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\u524d\",\n     // \u914d\u52171\u756a\u76ee\n     \"\u9001\u4fe1\u3057\u305f\u3044\u30b9\u30d7\u30ec\u30c3\u30c8\u540d\u524d\" + \"_\" + nowDate,\n     // \u914d\u52172\u756a\u76ee\n     \"pdf\",\n     // \u914d\u52173\u756a\u76ee\u4ee5\u964d\n     \"Spread2\u30b7\u30fc\u30c81\",\n     \"Spread2\u30b7\u30fc\u30c82\",\n     \"Spread3\u30b7\u30fc\u30c83\"];\n\n\n  // [\u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u3092\u7e8f\u3081\u308b] \n  // \u4e0a\u8a18\u3067\u5ba3\u8a00\u3057\u305f\u914d\u5217\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u60c5\u5831\u30922\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n  // \u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\n  // \u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u306a\u3044\u3068\u3001\u4e0a\u8a18\u3067\u5909\u6570\u5ba3\u8a00\u3057\u3066\u3044\u3066\u3082\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3055\u308c\u307e\u305b\u3093\u3002\n  var allSendSpreadsheets = [sendSpreadsheet,sendSpreadsheet2]\n    \n  \n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u8a2d\u5b9a\u9805\u76ee\u2191\u2191\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  \n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n  //\uff0a\u3053\u3053\u304b\u3089\u51e6\u7406\u2193\u2193\n  //\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\uff0a\n \n  \n  // \u2193Google OAuth\u8a8d\u8a3c\u2193\n  \n  // Google\u30c9\u30e9\u30a4\u30d6\u306e\u30eb\u30fc\u30c8\u30d5\u30a9\u30eb\u30c0\u3092\u53d6\u5f97\n  // \u3053\u306e\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u306a\u3044\u3068\u30e1\u30fc\u30eb\u9001\u4fe1\u306e\u969b\u306b\u3001Google\u30c9\u30e9\u30a4\u30d6\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30b9\u30b3\u30fc\u30d7\u304c\u53d6\u5f97\u3055\u308c\u306a\u3044\u3002\n  // \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u521d\u56de\u8d77\u52d5\u6642\u306bGoogle\u30c9\u30e9\u30a4\u30d6\u3078\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u3092\u6c42\u3081\u3089\u308c\u308b\u3002\n  DriveApp.getRootFolder();\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3059\u308b\u969b\u306e\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u53d6\u5f97\n  var fetchOpt = {\n    \"headers\" : { Authorization: 'Bearer ' + ScriptApp.getOAuthToken() },\n    \"muteHttpExceptions\" : true\n   };\n   \n  // \u2191Google OAuth\u8a8d\u8a3c\u2191\n  \n  \n  // \u30e1\u30fc\u30eb\u9001\u4fe1\u6642\u306e\u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u7528\u306e\u914d\u5217\u306e\u5ba3\u8a00\n  var attachmentFiles = new Array();\n  \n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306eKEY\u5024\n  var key; \n  \n  // \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\n  var sendName;\n  \n  // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\n  var fetchUrl;\n  \n  // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306eKEY\u5024\u306e\u914d\u5217\n  var keys = new Array(allSendSpreadsheets.length);\n  \n  // \u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306e\u60c5\u5831\u3054\u3068\u306b\u7e70\u308a\u8fd4\u3057\u51e6\u7406\n  for(i = 0; i < allSendSpreadsheets.length; i++){\n  \n    // \u9001\u4fe1\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u306e\u4f5c\u6210\n    key = createSendFile_(allSendSpreadsheets[i]);\n   \n    // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u304c\u30d6\u30e9\u30f3\u30af\u306e\u5834\u5408\n    if(key == \"\"){\n    \n     // \u9001\u4fe1\u7528\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u305f\u305f\u3081\u3001\u6b21\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u60c5\u5831\u3092\u51e6\u7406\u3059\u308b\u3002\n     keys[i] = \"\";\n     continue;\n    }\n    \n    // KEY\u5024\u306e\u914d\u5217\u306bKEY\u5024\u3092\u8a2d\u5b9a\u3059\u308b\n    keys[i] = key;\n    \n    // PDF\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408\n    if(allSendSpreadsheets[i][2] == \"pdf\"){\n    \n    \u3000// \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1] + \".pdf\";\n      \n      // \u9001\u4fe1\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u60c5\u5831\u3092\u53d6\u5f97\n      var attachmentFile = DriveApp.getFileById(key).getBlob();\n    \n    \u3000// \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push({fileName:sendName, mimeType: attachmentFile.getContentType(), content:attachmentFile.getBytes()});\n\n    }\u3000// \u30a8\u30af\u30bb\u30eb\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408 \n    else if(allSendSpreadsheets[i][2]  == \"xlsx\" ){\n    \n    \u3000// \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1] + \".xlsx\";\n    \n      // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\u3092\u4f5c\u6210\n      fetchUrl = \"https://docs.google.com/feeds/download/spreadsheets/Export?key=\" + key + \"&amp;exportFormat=xlsx\";\n  \n      // \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push(UrlFetchApp.fetch(fetchUrl,fetchOpt).getBlob().setName(sendName));\n\n    \n    } // \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3067\u9001\u4fe1\u3059\u308b\u5834\u5408(\u30d5\u30a1\u30a4\u30eb\u5909\u63db\u306a\u3057)\n    else if(allSendSpreadsheets[i][2] == \"\"){\n    \n      // \u9001\u4fe1\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n      sendName = allSendSpreadsheets[i][1];\n    \n      // fetch\u7528\u306e\u30ea\u30af\u30a8\u30b9\u30c8URL\u3092\u4f5c\u6210\n      fetchUrl = \"https://docs.google.com/feeds/download/spreadsheets/Export?key=\" + key;\n      \n      // \u6dfb\u4ed8\u7528\u30d5\u30a1\u30a4\u30eb\u3092google\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3002\u7d50\u679c\u3092\u683c\u7d0d\u3002\n      attachmentFiles.push(UrlFetchApp.fetch(fetchUrl, fetchOpt).getBlob().setName(sendName));\n    \n    } // \u4e0a\u8a18\u4ee5\u5916\u306e\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n    else {\n    \n      // \u6307\u5b9a\u5916\u306e\u30d5\u30a1\u30a4\u30eb\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u305f\u3081\u3001\u6b21\u306e\u30b9\u30d7\u30ec\u30c3\u30c8\u60c5\u5831\u3092\u51e6\u7406\u3059\u308b\u3002\n      continue;\n    }\n    \n  }\n\n  // \u30e1\u30fc\u30eb\u9001\u4fe1\n  MailApp.sendEmail(strMailTo, strSubject, strBody, {cc:strMailCc, bcc:strMailBcc, attachments:attachmentFiles});\n  \n  // \u9001\u4fe1\u7528\u306b\u4f5c\u6210\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u5168\u3066\u524a\u9664\u3059\u308b\n  for(i = 0; i < keys.length; i++){\n \n    if(keys[i] == \"\"){continue;}\n  \n    // \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u51e6\u7406\n    deleteFile_(keys[i]);\n  }\n\n}\n\n/**\n*\n* \u9001\u4fe1\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b(private\u30e1\u30bd\u30c3\u30c9)\n*\n* @param String[] sendSpreadsheetInfo \u9001\u4fe1\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u60c5\u5831(\u914d\u5217)\n* @return String \u4f5c\u6210\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\n*\n*/\nfunction createSendFile_(sendSpreadsheetInfo){\n\n  // \u9001\u4fe1\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u6307\u5b9a\u30d5\u30a1\u30a4\u30eb\u540d\u3067Google\u30c9\u30e9\u30a4\u30d6\u3088\u308a\u53d6\u5f97\u3059\u308b\u3002\n  var Files = DriveApp.getFilesByName(sendSpreadsheetInfo[0]);\n  \n  // \u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u3001\u623b\u308a\u5024\u306f\u30d6\u30e9\u30f3\u30af\u3067\u51e6\u7406\u7d42\u4e86\n  if(!Files.hasNext()){return \"\";}\n\n  // \u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u53d6\u5f97\n  var objFile;\n  while (Files.hasNext()) {\n      objFile = Files.next();\n  }\n  \n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306eURL\u4f5c\u6210\n  var url = \"https://docs.google.com/spreadsheets/d/\" + objFile.getId() + \"/edit\";\n  \n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u53d6\u5f97\n  var spreadSheet = SpreadsheetApp.openByUrl(url);\n  \n  // \u6307\u5b9a\u3055\u308c\u305f\u30b7\u30fc\u30c8\u306e\u5b58\u5728\u78ba\u8a8d\u3092\u884c\u3046\n  for (var i = 3; i < sendSpreadsheetInfo.length; i++){\n    var sheet = spreadSheet.getSheetByName(sendSpreadsheetInfo[i]);\n    \n    // \u6307\u5b9a\u3055\u308c\u305f\u30b7\u30fc\u30c8\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u623b\u308a\u5024\u306f\u30d6\u30e9\u30f3\u30af\u3067\u51e6\u7406\u7d42\u4e86\n    if(sheet == null){return \"\";}\n  }\n   // \u9001\u4fe1\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u4f5c\u6210\n  var sendName = sendSpreadsheetInfo[1];\n  \n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u4f5c\u6210(\u30b3\u30d4\u30fc)\n  var copySpreadsheet = spreadSheet.copy(sendName);\n  \n  pivotTableChangeWrite_(copySpreadsheet);\n  \n  \n  // \u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306e\u9001\u4fe1\u3057\u306a\u3044\u30b7\u30fc\u30c8\u3092\u524a\u9664(\u9001\u4fe1\u3059\u308b\u30b7\u30fc\u30c8\u306e\u307f\u6b8b\u3059)\n  var sheets = copySpreadsheet.getSheets();\n  for (var i = 0; i < sheets.length; i++){  \n    if(sendSpreadsheetInfo.indexOf(sheets[i].getName()) == -1){\n         copySpreadsheet.deleteSheet(sheets[i]);\n    }\n  }\n  \n  // \u30b3\u30d4\u30fc\u3057\u305f\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u3092\u8fd4\u5374\n  return copySpreadsheet.getId();\n}\n\n/**\n*\n* \u30b9\u30d7\u30ec\u30c3\u30c8\u30b7\u30fc\u30c8\u3092\u524a\u9664\u3059\u308b(private\u30e1\u30bd\u30c3\u30c9)\n*\n* @param String deleteKey \u524a\u9664\u3059\u308b\u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\n*\n*/\nfunction deleteFile_(deleteKey){\n  \n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u306eKEY\u5024\u3088\u308a\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3059\u308b\n  var objFile = DriveApp.getFileById(deleteKey);\n  // \u30b9\u30d7\u30ec\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\n  DriveApp.getRootFolder().removeFile(objFile);\n}\n```\n", "tags": ["GoogleAppsScript", "gmail"]}