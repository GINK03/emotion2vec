{"context": "Kinesis Analytics\u3092SQL\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\u3001AWS\u5074\u304c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u7528\u610f\u3057\u3066\u304f\u308c\u3066\u308b\u306e\u3067\u3059\u304c\u3001\u5fae\u5999\u306b\u9593\u9055\u3063\u3066\u3044\u305f\u308a\u3059\u308b\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u30cf\u30de\u308a\u3069\u3053\u308d\u3082\u591a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\nKinesis Analytics\u3092\u4f7f\u7528\u3059\u308b\u4e0a\u3067\u306e\u30dd\u30a4\u30f3\u30c8\n\u30fbStream\u540d\u3068\u30c7\u30fc\u30bf\u540d\u306e\u540d\u524d\u306f\u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3067\u533a\u5225\u3055\u308c\u308b\n \u3000 \u2192 Stream\u540d\u3082\u3057\u304f\u306f\u30c7\u30fc\u30bf\u540d\u3092\u300c\"\u300d\u3067\u62ec\u308b\u3068\u5c0f\u6587\u5b57\u306b\u306a\u308a\u3001\u62ec\u3089\u306a\u3044\u3068\u5927\u6587\u5b57\u3068\u8a8d\u8b58\u3055\u308c\u308b\n\u3000\u3000\u2192 \uff08\u500b\u4eba\u7684\u306b\u306f\uff09Create Stream\u6587\u5185\u306eStream\u540d\u3068\u30c7\u30fc\u30bf\u540d\u306f\u5927\u6587\u5b57\u304c\u3088\u3044\n\u30fbKinesis Streams demo\u306f\u826f\u304f\u505c\u6b62\u3059\u308b\n\u3000\u3000\u2192 \u4e00\u65e6\u524a\u9664\u3057\u3066\u3001\u65b0\u305f\u306b\u4f5c\u6210\u3057\u305f\u307b\u3046\u304c\u3088\u3044\n\u30fbReference Data\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001[Could not find Stream]\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\n\u30fbSQL\u30b3\u30fc\u30c9\u3092[Save and Running]\u3055\u305b\u308b\u3068\u5b9f\u884c\u307e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u3068\u304d\u304c\u3042\u308b\n\u3000\u3000- Random_CUT\u95a2\u6570\u306f30\u5206\u307b\u3069\u6642\u9593\u3092\u8981\u3059\u308b\u5834\u5408\u304c\u3042\u308b\n\u30fb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u5fae\u5999\u306b\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u304d\u304c\u3042\u308b\n\n\u6240\u611f\n\u30fb\u69cb\u7bc9\u306f\u697d\n\u30fbKPU\u306f\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3060\u304c\u3001\u30ad\u30e3\u30c3\u30d7\u6a5f\u80fd\u306f\u306a\u3044\u306e\u3067\u304a\u91d1\u306b\u6ce8\u610f\n\u30fb\u7d50\u69cb\u3001\u30d0\u30b0\u304c\u3042\u308b\u3002\u30b3\u30fc\u30c9\u306eupdating\u304b\u3089RUNNING\u307e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u3068\u304d\u304c\u3042\u308b\n\u30fb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u5c11\u306a\u3044\n\u30fb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3002\u9ad8\u5ea6\u306a\u5206\u6790\u306e\u95a2\u6570\u306f\u307e\u3058\u3067\u308f\u304b\u3089\u3093\u30fb\u30fb\u30fb\n\u7d39\u4ecb\u3059\u308b\u30af\u30a8\u30ea\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u57fa\u672c\u7684\u306a\u30af\u30a8\u30ea\n\u30fbCREATE PUMP & STREAM\n\u30fbSELECT\n\u30fbWHERE\n\u30fbMULTI STREAMS\n\u30fbGROUP BY\n\u30fbWINDOW\n\u30001.TUMBLING WINDOW\n\u30002.SLIDING WINDOW\n\u30fbINNER JOIN\n\n\u9ad8\u5ea6\u306a\u5206\u6790\n\u30fbRANDOM_CUT_FOREST\n\u30fbDISTINCT\n\u30fbGROUP RANK \u203b\u3067\u304d\u3066\u3044\u306a\u3044\n\u30fbTOP-K\u3000\u203b\u3067\u304d\u3066\u3044\u306a\u3044\n\n\u57fa\u672c\u7684\u306a\u69cb\u6587\n\nCREATE PUMP & STREAM, SELECT\n\u30fb[OR REPLACE]\u306fSTREAM\u540d\u304c\u65e2\u306b\u5b58\u5728\u3059\u308c\u3070\u7f6e\u304d\u63db\u3048\u308b\u3068\u3044\u3046\u610f\u5473\n\u30fbAnalytics\u306fPUMP\u306b\u30c7\u30fc\u30bf\u3092\u6295\u5165\u5f8c\u306b\u3001STREAM\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\n\u30fb\u95a2\u6570\u540d\u3092\u5217\u540d\u306b\u4f7f\u7528\u3067\u304d\u306a\u3044\uff08avg\u3001min,max\u306a\u3069\uff09\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_STNBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM \"SOURCE_SQL_STREAM_001\";\n\n\n\nWHERE\n\u30fb\u57fa\u672c\u7684\u306b\u6a19\u6e96SQL\u3068\u540c\u3058\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM \"SOURCE_SQL_STREAM_001\"\n   WHERE SECTOR LIKE '%ALTH%' \n;\n\n\n\nMULTI STREAMS\n\u30fbPUMP\u540d\u306f\u4e00\u7dd2\u306b\u3057\u3066\u306f\u306a\u3089\u306a\u3044\n\u30fbMULTI STREAMS\u3092\u5b9a\u7fa9\u3057\u305f\u5834\u5408\u3001AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306ereal-time analytics\u30bf\u30d6\u5185\u306e\u300cIn-application streams\u300d\u306b\u8907\u6570STREAM\u304c\u8868\u308c\u308b\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM SOURCE_SQL_STREAM_001\n   WHERE SECTOR LIKE '%ALTH%' \n;\n\n\nCREATE OR REPLACE PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM SOURCE_SQL_STREAM_001\n   WHERE PRICE > 0.0\n;\n\n\n\nGROUP BY\uff08TUMBLING WINDOW)\n\u30fb\u69cb\u6587\u306f\u901a\u5e38SQL\u3068\u540c\u69d8\u3060\u304c\u3001TIME WINDOW\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff08TUMBLING WINDOW\u3068\u8a00\u3046\uff09\n\u30fbROWTIME\u306fKinesis Analytics\u306b\u4e88\u3081\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u6642\u523b\u3067\u53ce\u96c6\u3057\u305f\u6642\u523b\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_COUNT INTEGER,\n  TICKER_SYMBOL_AVG REAL\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM \n   ticker_symbol, \n   COUNT(*) AS ticker_symbol_count,\n   AVG(price) AS ticker_symbol_avg\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n\n\n\nSLIDING WINDOW\n\u30fbSLIDING WINDOW\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001GROUP BY\u53e5\u306f\u4f7f\u7528\u305b\u305a\u3001\u96c6\u7d04\u95a2\u6570(avg,min,count\u7b49)\u306e\u76f4\u5f8c\u306bWINDOW\u3092\u5b9a\u7fa9\u3059\u308b\n\u30fbWINDOW\u5e45\u306e\u8a2d\u5b9a\u306fTIME\u3068ROW\u306e\uff12\u7a2e\u985e\u304c\u5b58\u5728\u3059\u308b\uff08\u5fae\u5999\u306b\u66f8\u304d\u65b9\u304c\u9055\u3046\u306e\u3067\u6ce8\u610f\uff09\nCREATE STREAM DESTINATION_SQL_STREAM (\n    TICKER_SYMBOL VARCHAR(4), \n    TICKER_SYMBOL_AVG_T REAL,\n    TICKER_SYMBOL_COUNT_T INTEGER,\n    TICKER_SYMBOL_AVG_R REAL,\n    TICKER_SYMBOL_COUNT_R INTEGER);\n\nCREATE PUMP STREAM_PUMP as insert into DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol,\n              avg(price) over TSW as ticker_symbol_avg1,\n              count(*)  over TSW as cnt1,\n              avg(price) over RSW as ticker_symbol_avg2,\n              count(*)  over RSW as cnt2\nFROM SOURCE_SQL_STREAM_001\nWINDOW TSW as (partition by ticker_symbol Range interval '10' second preceding),\nRSW as (partition by ticker_symbol  ROWS 2 preceding);\n\n\n\nINNER JOIN\n\u30fb\u7570\u306a\u308bSTREAM\u540c\u58eb\u306eJoin\u51e6\u7406\u306f\u53ef\u80fd\n\u30fbReference Data\u3092\u8ffd\u52a0\u3059\u308b\u52d5\u4f5c\u3057\u306a\u3044(2017/3\u6708\u6642\u70b9\uff09\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM3 (\n  TICKER_SYMBOL VARCHAR(4),\n  TICKER_SYMBOL_COUNT INTEGER, \n  TICKER_SYMBOL_AVG REAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP3 AS INSERT INTO DESTINATION_SQL_STREAM3\nSELECT \n   STREAM A.ticker_symbol,  \n          A.ticker_symbol_count,\n          B.ticker_symbol_avg\nFROM DESTINATION_SQL_STREAM as A\nINNER JOIN DESTINATION_SQL_STREAM2 as B\nON A.ticker_symbol = B.ticker_symbol\n\n\n\nINNER JOIN\u3067\u4f7f\u7528\u3057\u3066\u3044\u308bDESTINATION_SQL_STREAM\u3068DESTINATION_SQL_STREAM2\u306e\u4f5c\u6210\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_COUNT INTEGER\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP1 AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT \n  STREAM ticker_symbol, \n         count(*) AS ticker_symbol_count\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_AVG REAL\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\nSELECT \n  STREAM ticker_symbol, \n         avg(price) AS ticker_symbol_avg\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n\n\nReference Data\u306e\u8ffd\u52a0\n\u30fbAWS CLI\u3067\u306e\u307f\u8ffd\u52a0\u304c\u53ef\u80fd\n\u30fbcurrent-application-version-id\u306fdescribe-application\u3067\u78ba\u8a8d\u3059\u308b\naws kinesisanalytics add-application-reference-data-source \\\n--region us-east-1   \\\n--application-name [your-kinesis-analytics-name] \\\n--current-application-version-id [?] \\\n--reference-data-source '{\"TableName\":\"companyname\",\"S3ReferenceDataSource\":{\"BucketARN\":\"arn:aws:s3:::[\u30d0\u30b1\u30c3\u30c8\u540d]\",\"FileKey\":\"[\u30d5\u30a1\u30a4\u30eb\u540d]\",\"ReferenceRoleARN\":\"arn:aws:iam::[\u30a2\u30ab\u30a6\u30f3\u30c8ID]:role/service-role/[\u30ed\u30fc\u30eb\u540d]\"},\n\"ReferenceSchema\":{ \"RecordFormat\":{\"RecordFormatType\":[CSV or json], \"MappingParameters\":{\"CSVMappingParameters\":{\"RecordRowDelimiter\":\"\\n\",\"RecordColumnDelimiter\":\",\"} }},\n\"RecordEncoding\":\"UTF-8\",\"RecordColumns\":[{\"Name\":\"type\",\"SqlType\":\"varchar(5)\"},{ \"Name\":\"company\",\"SqlType\":\"varchar(10)\"}]}}'\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\n\u30fbaws configure\u3067\u4e8b\u524d\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\naws kinesisanalytics describe-application --application-name [your-kinesis-analytics-name]\n\n\nReference Data\u306e\u524a\u9664\n\u30fbversion-id\u3068reference-id\u306fdescribe-application\u3067\u78ba\u8a8d\u3059\u308b\naws kinesisanalytics delete-application-reference-data-source --application-name [your-kinesis-analytics-name] --current-application-version-id [?] --reference-id [?]\n\n\n\u9ad8\u5ea6\u306a\u5206\u6790\n\u30fb\u9ad8\u5ea6\u306a\u5206\u6790\u3067\u306fCursol\u95a2\u6570\u3092\u4f7f\u7528\u3002\uff08\u6a19\u6e96SQL\u3068\u7d50\u69cb\u9055\u3046\u306e\u3067\u6700\u521d\u306f\u3060\u3044\u3076\u6238\u60d1\u3046\uff09\n\u30fb\u66f8\u304d\u65b9\u306f\u300cSELECT STREAM * FROM(TABLE(xxxFUNCTION(COURSOR([in-application-stream],option)));\u300d\n\nRANDOM_CUT_FOREST(\u7570\u5e38\u691c\u77e5\uff09\n\u30fb\u8a18\u8f09\u3059\u308b\u60c5\u5831\u306f\u300cin-application-stream\u300d\u3001\u300cnumberOfTrees(default:100)\u300d\u3001 \u300csubSampleSize(default\uff1a256)\u300d\u3001\u300ctimeDecay(default\uff1a100,000)\u300d\u3001 \u300cshingleSize (default\uff1a1)\u300d\u306e\uff15\u3064\n\u30fb\u8a73\u7d30\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u30fb\u30fb\u30fb\uff08\u6b63\u76f4\u3042\u307e\u308a\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\uff09\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL    VARCHAR(4),\n   SECTOR VARCHAR(10),\n   PRICE   DOUBLE,\n   CHANGE DOUBLE,\n   ANOMALY_SCORE  DOUBLE);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n   TICKER_SYMBOL    VARCHAR(4),\n   SECTOR VARCHAR(10),\n   PRICE   DOUBLE,\n   CHANGE DOUBLE,\n   ANOMALY_SCORE  DOUBLE);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM  ticker_symbol,sector,price,change,ANOMALY_SCORE FROM\n      TABLE(RANDOM_CUT_FOREST(\n        CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\")\n      )\n    ) ;\n\nCREATE OR REPLACE PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\nSELECT \n   STREAM * FROM DESTINATION_SQL_STREAM\nORDER BY FLOOR(DESTINATION_SQL_STREAM.ROWTIME TO SECOND), \n         ANOMALY_SCORE DESC;\n\n\n\nDISTINCT COUNT\n\u30fbCOUNT_DISTINCT_ITEMS_TUMBLING\u95a2\u6570\u306b\u8a18\u8f09\u3059\u308b\u60c5\u5831\u306f\u300cin-application-stream\u300d\u3001\u300c\u5217\u540d\u300d\u3001\u300cTUMBLING WINDOW\u6642\u9593\u300d\u306e3\u3064\u3002\u5217\u540d\u306f\uff11\u3064\u306e\u307f\u3067\u8907\u6570\u5217\u306e\u6307\u5b9a\u306f\u3067\u304d\u306a\u3044\n\u30fb\u51fa\u529b\u3055\u308c\u308b\u60c5\u5831\u306fDistinct Count\u3057\u305f\u60c5\u5831\u306e\u307f \nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (NUMBER_OF_DISTINCT_ITEMS BIGINT);\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM NUMBER_OF_DISTINCT_ITEMS FROM TABLE(COUNT_DISTINCT_ITEMS_TUMBLING(\n  CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\"),\n  'TICKER_SYMBOL', -- name of column in single quotes\n  10 -- tumbling window size in seconds\n  )\n);\n\n\n\nGROUP RANK\n\u30fb\u3059\u307f\u307e\u305b\u3093\u3001\u3044\u307e\u306e\u3068\u3053\u308d\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u4e0d\u660e\u3002\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3093\u3060\u306e\u3060\u304c\u30fb\u30fb\u30fb\uff09\n\u30fb\u30a8\u30e9\u30fc\u5185\u5bb9\u306f\u300cSQL error message: From line 2, column 55 to line 9, column 3: No match found for function signature GROUP_RANK(, , , , , , )\u300d\n\u30fb\u4f7f\u7528\u3057\u305f\u30af\u30a8\u30ea\u306f\u4e0b\u8a18\u3002\n\u30fb\u60c5\u5831\u304c\u3042\u308c\u3070\u5171\u6709\u3057\u3066\u307b\u3057\u3044\u3067\u3059\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n    TICKER_SYMBOL VARCHAR(4),\n    PRICE real,\n    RANK_NUM integer\n);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol,price,rank_num FROM TABLE(GROUP_RANK(\n  CURSOR(SELECT STREAM ticker_symbol,price FROM \"SOURCE_SQL_STREAM_001\"),\n  'PRICE', -- rankByColumnName\n  'rank_num', -- rankOutColumnName\n  'desc', -- sortOrder\n  'asc', --outputOrder\n  10, --maxIdle\n  5 --outputMax\n  )\n);\n\n\nTOP-K\n\u30fb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308a\u3067\u8a18\u8f09\u3057\u305f\u304c\u3001SELECT STREAM\u5f8c\u306eticker_symbol\u304c\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u767a\u751f\n\u30fb\u305f\u3060\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u3042\u308b\u30af\u30a8\u30ea\u306f\u56de\u3063\u3066\u3044\u3066\u3001TOP-K\u95a2\u6570\u304b\u3089\u3067\u3066\u304f\u308b\u5024\u306fITEM,ITEM_COUNT\u3068\u3044\u3046\u8b0e\u306e2\u5217\u306e\u3088\u3046\u3067\u3059\u3002\uff08\u8a73\u7d30\u306b\u3064\u3044\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u3055\u308c\u305a\u3001\u8272\u3005\u3068\u8a66\u3057\u305f\u3051\u3069\u4f55\u3082\u51fa\u529b\u3055\u308c\u3066\u306a\u3044\u306e\u3067\uff09\n\u30fb\u60c5\u5831\u304c\u3042\u308c\u3070\u5171\u6709\u3057\u3066\u307b\u3057\u3044\u3067\u3059\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM(\n    TICKER_SYMBOL VARCHAR(4), \n    PRICE REAL)\n;\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol, price FROM TABLE(TOP_K_ITEMS_TUMBLING(\n  CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\"),\n  'ticker_symbol', -- name of column in single quotes\n  10, -- number of top items\n  10 -- tumbling window size in seconds\n  )\n);\n\n\u3044\u307e\u306e\u3068\u3053\u308d\u3001\u3084\u3063\u3066\u307f\u305f\u30af\u30a8\u30ea\u3092\u6574\u7406\u3057\u3066\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\nKinesis Analytics\u3092SQL\u30af\u30a8\u30ea\u306b\u3064\u3044\u3066\u3001AWS\u5074\u304c\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u7528\u610f\u3057\u3066\u304f\u308c\u3066\u308b\u306e\u3067\u3059\u304c\u3001\u5fae\u5999\u306b\u9593\u9055\u3063\u3066\u3044\u305f\u308a\u3059\u308b\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u30cf\u30de\u308a\u3069\u3053\u308d\u3082\u591a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\n#Kinesis Analytics\u3092\u4f7f\u7528\u3059\u308b\u4e0a\u3067\u306e\u30dd\u30a4\u30f3\u30c8\n\u30fbStream\u540d\u3068\u30c7\u30fc\u30bf\u540d\u306e\u540d\u524d\u306f\u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3067\u533a\u5225\u3055\u308c\u308b\n \u3000 \u2192 Stream\u540d\u3082\u3057\u304f\u306f\u30c7\u30fc\u30bf\u540d\u3092\u300c\"\u300d\u3067\u62ec\u308b\u3068\u5c0f\u6587\u5b57\u306b\u306a\u308a\u3001\u62ec\u3089\u306a\u3044\u3068\u5927\u6587\u5b57\u3068\u8a8d\u8b58\u3055\u308c\u308b\n\u3000\u3000\u2192 \uff08\u500b\u4eba\u7684\u306b\u306f\uff09Create Stream\u6587\u5185\u306eStream\u540d\u3068\u30c7\u30fc\u30bf\u540d\u306f\u5927\u6587\u5b57\u304c\u3088\u3044\n\u30fbKinesis Streams demo\u306f\u826f\u304f\u505c\u6b62\u3059\u308b\n\u3000\u3000\u2192 \u4e00\u65e6\u524a\u9664\u3057\u3066\u3001\u65b0\u305f\u306b\u4f5c\u6210\u3057\u305f\u307b\u3046\u304c\u3088\u3044\n\u30fbReference Data\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001[Could not find Stream]\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\n\u30fbSQL\u30b3\u30fc\u30c9\u3092[Save and Running]\u3055\u305b\u308b\u3068\u5b9f\u884c\u307e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u3068\u304d\u304c\u3042\u308b\n\u3000\u3000- Random_CUT\u95a2\u6570\u306f30\u5206\u307b\u3069\u6642\u9593\u3092\u8981\u3059\u308b\u5834\u5408\u304c\u3042\u308b\n\u30fb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u5fae\u5999\u306b\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u304d\u304c\u3042\u308b\n    \n#\u6240\u611f\n\u30fb\u69cb\u7bc9\u306f\u697d\n\u30fbKPU\u306f\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3060\u304c\u3001\u30ad\u30e3\u30c3\u30d7\u6a5f\u80fd\u306f\u306a\u3044\u306e\u3067\u304a\u91d1\u306b\u6ce8\u610f\n\u30fb\u7d50\u69cb\u3001\u30d0\u30b0\u304c\u3042\u308b\u3002\u30b3\u30fc\u30c9\u306eupdating\u304b\u3089RUNNING\u307e\u3067\u6642\u9593\u304c\u639b\u304b\u308b\u3068\u304d\u304c\u3042\u308b\n\u30fb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u5c11\u306a\u3044\n\u30fb\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u306e\u3067\u6ce8\u610f\u3002\u9ad8\u5ea6\u306a\u5206\u6790\u306e\u95a2\u6570\u306f\u307e\u3058\u3067\u308f\u304b\u3089\u3093\u30fb\u30fb\u30fb\n\n\n\n\u7d39\u4ecb\u3059\u308b\u30af\u30a8\u30ea\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n#\u57fa\u672c\u7684\u306a\u30af\u30a8\u30ea\n\u30fbCREATE PUMP & STREAM\n\u30fbSELECT\n\u30fbWHERE\n\u30fbMULTI STREAMS\n\u30fbGROUP BY\n\u30fbWINDOW\n\u30001.TUMBLING WINDOW\n\u30002.SLIDING WINDOW\n\u30fbINNER JOIN\n\n\n#\u9ad8\u5ea6\u306a\u5206\u6790\n\u30fbRANDOM_CUT_FOREST\n\u30fbDISTINCT\n\u30fbGROUP RANK \u203b\u3067\u304d\u3066\u3044\u306a\u3044\n\u30fbTOP-K\u3000\u203b\u3067\u304d\u3066\u3044\u306a\u3044\n\n\n#\u57fa\u672c\u7684\u306a\u69cb\u6587\n## CREATE PUMP & STREAM, SELECT\n\u30fb[OR REPLACE]\u306fSTREAM\u540d\u304c\u65e2\u306b\u5b58\u5728\u3059\u308c\u3070\u7f6e\u304d\u63db\u3048\u308b\u3068\u3044\u3046\u610f\u5473\n\u30fbAnalytics\u306fPUMP\u306b\u30c7\u30fc\u30bf\u3092\u6295\u5165\u5f8c\u306b\u3001STREAM\u306b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\n\u30fb\u95a2\u6570\u540d\u3092\u5217\u540d\u306b\u4f7f\u7528\u3067\u304d\u306a\u3044\uff08avg\u3001min,max\u306a\u3069\uff09\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_STNBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM \"SOURCE_SQL_STREAM_001\";\n```\n\n<img width=\"1186\" alt=\"SELECT.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/4a4cb891-028f-37e1-7ed1-474e379a2e4d.png\">\n\n\n## WHERE\n\u30fb\u57fa\u672c\u7684\u306b\u6a19\u6e96SQL\u3068\u540c\u3058\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM \"SOURCE_SQL_STREAM_001\"\n   WHERE SECTOR LIKE '%ALTH%' \n;\n```\n<img width=\"1181\" alt=\"WHERE.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/1747d855-5554-9080-ccd8-18e17838f502.png\">\n\n\n##MULTI STREAMS\n\u30fbPUMP\u540d\u306f\u4e00\u7dd2\u306b\u3057\u3066\u306f\u306a\u3089\u306a\u3044\n\u30fbMULTI STREAMS\u3092\u5b9a\u7fa9\u3057\u305f\u5834\u5408\u3001AWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306ereal-time analytics\u30bf\u30d6\u5185\u306e\u300cIn-application streams\u300d\u306b\u8907\u6570STREAM\u304c\u8868\u308c\u308b\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n   TICKER_SYMBOL VARCHAR(4),\n   SECTOR        VARCHAR(16),\n   PRICE         REAL,\n   CHANGE        DECIMAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM SOURCE_SQL_STREAM_001\n   WHERE SECTOR LIKE '%ALTH%' \n;\n\n\nCREATE OR REPLACE PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\n   SELECT STREAM ticker_symbol, sector, change, price\n   FROM SOURCE_SQL_STREAM_001\n   WHERE PRICE > 0.0\n;\n```\n\n<img width=\"1178\" alt=\"MULTISTREAM.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/83260ffe-5276-edde-925c-a72390c88f41.png\">\n\n\n\n##GROUP BY\uff08TUMBLING WINDOW)\n\u30fb\u69cb\u6587\u306f\u901a\u5e38SQL\u3068\u540c\u69d8\u3060\u304c\u3001TIME WINDOW\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\uff08TUMBLING WINDOW\u3068\u8a00\u3046\uff09\n\u30fbROWTIME\u306fKinesis Analytics\u306b\u4e88\u3081\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u6642\u523b\u3067\u53ce\u96c6\u3057\u305f\u6642\u523b\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_COUNT INTEGER,\n  TICKER_SYMBOL_AVG REAL\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM \n   ticker_symbol, \n   COUNT(*) AS ticker_symbol_count,\n   AVG(price) AS ticker_symbol_avg\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n```\n\n<img width=\"1190\" alt=\"GROUPBY.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/4bce2b36-1439-18b6-a9c5-65e571e0fff6.png\">\n\n\n##SLIDING WINDOW\n\u30fbSLIDING WINDOW\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001GROUP BY\u53e5\u306f\u4f7f\u7528\u305b\u305a\u3001\u96c6\u7d04\u95a2\u6570(avg,min,count\u7b49)\u306e\u76f4\u5f8c\u306bWINDOW\u3092\u5b9a\u7fa9\u3059\u308b\n\u30fbWINDOW\u5e45\u306e\u8a2d\u5b9a\u306fTIME\u3068ROW\u306e\uff12\u7a2e\u985e\u304c\u5b58\u5728\u3059\u308b\uff08\u5fae\u5999\u306b\u66f8\u304d\u65b9\u304c\u9055\u3046\u306e\u3067\u6ce8\u610f\uff09\n\n```\nCREATE STREAM DESTINATION_SQL_STREAM (\n    TICKER_SYMBOL VARCHAR(4), \n    TICKER_SYMBOL_AVG_T REAL,\n    TICKER_SYMBOL_COUNT_T INTEGER,\n    TICKER_SYMBOL_AVG_R REAL,\n    TICKER_SYMBOL_COUNT_R INTEGER);\n    \nCREATE PUMP STREAM_PUMP as insert into DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol,\n              avg(price) over TSW as ticker_symbol_avg1,\n              count(*)  over TSW as cnt1,\n              avg(price) over RSW as ticker_symbol_avg2,\n              count(*)  over RSW as cnt2\nFROM SOURCE_SQL_STREAM_001\nWINDOW TSW as (partition by ticker_symbol Range interval '10' second preceding),\nRSW as (partition by ticker_symbol  ROWS 2 preceding);\n```\n\n<img width=\"1187\" alt=\"GROUP BY SLID.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/761b3ae2-be60-b465-7f9c-f43c2dcda78c.png\">\n\n\n##INNER JOIN\n\u30fb\u7570\u306a\u308bSTREAM\u540c\u58eb\u306eJoin\u51e6\u7406\u306f\u53ef\u80fd\n\u30fbReference Data\u3092\u8ffd\u52a0\u3059\u308b\u52d5\u4f5c\u3057\u306a\u3044(2017/3\u6708\u6642\u70b9\uff09\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM3 (\n  TICKER_SYMBOL VARCHAR(4),\n  TICKER_SYMBOL_COUNT INTEGER, \n  TICKER_SYMBOL_AVG REAL);\n\nCREATE OR REPLACE PUMP STREAM_PUMP3 AS INSERT INTO DESTINATION_SQL_STREAM3\nSELECT \n   STREAM A.ticker_symbol,  \n          A.ticker_symbol_count,\n          B.ticker_symbol_avg\nFROM DESTINATION_SQL_STREAM as A\nINNER JOIN DESTINATION_SQL_STREAM2 as B\nON A.ticker_symbol = B.ticker_symbol\n```\n\n<img width=\"1198\" alt=\"INNER JOIN.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/f7e1c758-1140-8aad-604d-deb578067a6f.png\">\n\n\n####INNER JOIN\u3067\u4f7f\u7528\u3057\u3066\u3044\u308bDESTINATION_SQL_STREAM\u3068DESTINATION_SQL_STREAM2\u306e\u4f5c\u6210\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_COUNT INTEGER\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP1 AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT \n  STREAM ticker_symbol, \n         count(*) AS ticker_symbol_count\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n  TICKER_SYMBOL VARCHAR(4), \n  TICKER_SYMBOL_AVG REAL\n);\n\nCREATE OR REPLACE  PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\nSELECT \n  STREAM ticker_symbol, \n         avg(price) AS ticker_symbol_avg\nFROM \"SOURCE_SQL_STREAM_001\"\nGROUP BY ticker_symbol, \n         FLOOR((\"SOURCE_SQL_STREAM_001\".ROWTIME - TIMESTAMP '1970-01-01 00:00:00') SECOND / 10 TO SECOND);\n```\n\n\n####Reference Data\u306e\u8ffd\u52a0\n\u30fbAWS CLI\u3067\u306e\u307f\u8ffd\u52a0\u304c\u53ef\u80fd\n\u30fbcurrent-application-version-id\u306fdescribe-application\u3067\u78ba\u8a8d\u3059\u308b\n\n```\naws kinesisanalytics add-application-reference-data-source \\\n--region us-east-1   \\\n--application-name [your-kinesis-analytics-name] \\\n--current-application-version-id [?] \\\n--reference-data-source '{\"TableName\":\"companyname\",\"S3ReferenceDataSource\":{\"BucketARN\":\"arn:aws:s3:::[\u30d0\u30b1\u30c3\u30c8\u540d]\",\"FileKey\":\"[\u30d5\u30a1\u30a4\u30eb\u540d]\",\"ReferenceRoleARN\":\"arn:aws:iam::[\u30a2\u30ab\u30a6\u30f3\u30c8ID]:role/service-role/[\u30ed\u30fc\u30eb\u540d]\"},\n\"ReferenceSchema\":{ \"RecordFormat\":{\"RecordFormatType\":[CSV or json], \"MappingParameters\":{\"CSVMappingParameters\":{\"RecordRowDelimiter\":\"\\n\",\"RecordColumnDelimiter\":\",\"} }},\n\"RecordEncoding\":\"UTF-8\",\"RecordColumns\":[{\"Name\":\"type\",\"SqlType\":\"varchar(5)\"},{ \"Name\":\"company\",\"SqlType\":\"varchar(10)\"}]}}'\n```\n####\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\n\u30fbaws configure\u3067\u4e8b\u524d\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3053\u3068\n\n```\naws kinesisanalytics describe-application --application-name [your-kinesis-analytics-name]\n```\n####Reference Data\u306e\u524a\u9664\n\u30fbversion-id\u3068reference-id\u306fdescribe-application\u3067\u78ba\u8a8d\u3059\u308b\n\n```\naws kinesisanalytics delete-application-reference-data-source --application-name [your-kinesis-analytics-name] --current-application-version-id [?] --reference-id [?]\n```\n\n#\u9ad8\u5ea6\u306a\u5206\u6790\n\u30fb\u9ad8\u5ea6\u306a\u5206\u6790\u3067\u306fCursol\u95a2\u6570\u3092\u4f7f\u7528\u3002\uff08\u6a19\u6e96SQL\u3068\u7d50\u69cb\u9055\u3046\u306e\u3067\u6700\u521d\u306f\u3060\u3044\u3076\u6238\u60d1\u3046\uff09\n\u30fb\u66f8\u304d\u65b9\u306f\u300cSELECT STREAM * FROM(TABLE(xxxFUNCTION(COURSOR([in-application-stream],option)));\u300d\n\n##RANDOM_CUT_FOREST(\u7570\u5e38\u691c\u77e5\uff09\n\u30fb\u8a18\u8f09\u3059\u308b\u60c5\u5831\u306f\u300cin-application-stream\u300d\u3001\u300cnumberOfTrees(default:100)\u300d\u3001 \u300csubSampleSize(default\uff1a256)\u300d\u3001\u300ctimeDecay(default\uff1a100,000)\u300d\u3001 \u300cshingleSize (default\uff1a1)\u300d\u306e\uff15\u3064\n\u30fb\u8a73\u7d30\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u30fb\u30fb\u30fb\uff08\u6b63\u76f4\u3042\u307e\u308a\u7406\u89e3\u3057\u3066\u3044\u306a\u3044\uff09\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n   TICKER_SYMBOL    VARCHAR(4),\n   SECTOR VARCHAR(10),\n   PRICE   DOUBLE,\n   CHANGE DOUBLE,\n   ANOMALY_SCORE  DOUBLE);\n\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM2 (\n   TICKER_SYMBOL    VARCHAR(4),\n   SECTOR VARCHAR(10),\n   PRICE   DOUBLE,\n   CHANGE DOUBLE,\n   ANOMALY_SCORE  DOUBLE);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM  ticker_symbol,sector,price,change,ANOMALY_SCORE FROM\n      TABLE(RANDOM_CUT_FOREST(\n        CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\")\n      )\n    ) ;\n\nCREATE OR REPLACE PUMP STREAM_PUMP2 AS INSERT INTO DESTINATION_SQL_STREAM2\nSELECT \n   STREAM * FROM DESTINATION_SQL_STREAM\nORDER BY FLOOR(DESTINATION_SQL_STREAM.ROWTIME TO SECOND), \n         ANOMALY_SCORE DESC;\n```\n<img width=\"1170\" alt=\"RANDOMCUT.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/18af3e97-4747-68c3-abd0-b6ae1e27c50e.png\">\n\n\n##DISTINCT COUNT\n\u30fbCOUNT_DISTINCT_ITEMS_TUMBLING\u95a2\u6570\u306b\u8a18\u8f09\u3059\u308b\u60c5\u5831\u306f\u300cin-application-stream\u300d\u3001\u300c\u5217\u540d\u300d\u3001\u300cTUMBLING WINDOW\u6642\u9593\u300d\u306e3\u3064\u3002\u5217\u540d\u306f\uff11\u3064\u306e\u307f\u3067\u8907\u6570\u5217\u306e\u6307\u5b9a\u306f\u3067\u304d\u306a\u3044\n\u30fb\u51fa\u529b\u3055\u308c\u308b\u60c5\u5831\u306fDistinct Count\u3057\u305f\u60c5\u5831\u306e\u307f \n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (NUMBER_OF_DISTINCT_ITEMS BIGINT);\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM NUMBER_OF_DISTINCT_ITEMS FROM TABLE(COUNT_DISTINCT_ITEMS_TUMBLING(\n  CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\"),\n  'TICKER_SYMBOL', -- name of column in single quotes\n  10 -- tumbling window size in seconds\n  )\n);\n```\n\n<img width=\"1182\" alt=\"Distinct.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/132083/da00d9d5-7cf4-9941-fba4-b0faa77304b3.png\">\n\n\n##GROUP RANK\n\u30fb\u3059\u307f\u307e\u305b\u3093\u3001\u3044\u307e\u306e\u3068\u3053\u308d\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u4e0d\u660e\u3002\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8aad\u3093\u3060\u306e\u3060\u304c\u30fb\u30fb\u30fb\uff09\n\u30fb\u30a8\u30e9\u30fc\u5185\u5bb9\u306f\u300cSQL error message: From line 2, column 55 to line 9, column 3: No match found for function signature GROUP_RANK(<CURSOR>, <CHARACTER>, <CHARACTER>, <CHARACTER>, <CHARACTER>, <CHARACTER>, <CHARACTER>)\u300d\n\u30fb\u4f7f\u7528\u3057\u305f\u30af\u30a8\u30ea\u306f\u4e0b\u8a18\u3002\n\u30fb\u60c5\u5831\u304c\u3042\u308c\u3070\u5171\u6709\u3057\u3066\u307b\u3057\u3044\u3067\u3059\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM (\n    TICKER_SYMBOL VARCHAR(4),\n    PRICE real,\n    RANK_NUM integer\n);\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol,price,rank_num FROM TABLE(GROUP_RANK(\n  CURSOR(SELECT STREAM ticker_symbol,price FROM \"SOURCE_SQL_STREAM_001\"),\n  'PRICE', -- rankByColumnName\n  'rank_num', -- rankOutColumnName\n  'desc', -- sortOrder\n  'asc', --outputOrder\n  10, --maxIdle\n  5 --outputMax\n  )\n);\n```\n\n##TOP-K\n\u30fb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3093\u3067\u3001\u4e0b\u8a18\u306e\u901a\u308a\u3067\u8a18\u8f09\u3057\u305f\u304c\u3001SELECT STREAM\u5f8c\u306eticker_symbol\u304c\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u767a\u751f\n\u30fb\u305f\u3060\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u3042\u308b\u30af\u30a8\u30ea\u306f\u56de\u3063\u3066\u3044\u3066\u3001TOP-K\u95a2\u6570\u304b\u3089\u3067\u3066\u304f\u308b\u5024\u306fITEM,ITEM_COUNT\u3068\u3044\u3046\u8b0e\u306e2\u5217\u306e\u3088\u3046\u3067\u3059\u3002\uff08\u8a73\u7d30\u306b\u3064\u3044\u3066\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u3055\u308c\u305a\u3001\u8272\u3005\u3068\u8a66\u3057\u305f\u3051\u3069\u4f55\u3082\u51fa\u529b\u3055\u308c\u3066\u306a\u3044\u306e\u3067\uff09\n\u30fb\u60c5\u5831\u304c\u3042\u308c\u3070\u5171\u6709\u3057\u3066\u307b\u3057\u3044\u3067\u3059\n\n```\nCREATE OR REPLACE STREAM DESTINATION_SQL_STREAM(\n    TICKER_SYMBOL VARCHAR(4), \n    PRICE REAL)\n;\n\nCREATE OR REPLACE PUMP STREAM_PUMP AS INSERT INTO DESTINATION_SQL_STREAM\nSELECT STREAM ticker_symbol, price FROM TABLE(TOP_K_ITEMS_TUMBLING(\n  CURSOR(SELECT STREAM * FROM \"SOURCE_SQL_STREAM_001\"),\n  'ticker_symbol', -- name of column in single quotes\n  10, -- number of top items\n  10 -- tumbling window size in seconds\n  )\n);\n```\n\n\u3044\u307e\u306e\u3068\u3053\u308d\u3001\u3084\u3063\u3066\u307f\u305f\u30af\u30a8\u30ea\u3092\u6574\u7406\u3057\u3066\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002\n", "tags": ["Kinesis", "analytics", "SQL"]}