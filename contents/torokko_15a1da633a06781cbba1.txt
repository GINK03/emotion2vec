{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nID\u3001\u6c0f\u540d\u3001\u5e74\u9f62\u304b\u3089\u306a\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u524d\u63d0\u3068\u3057\u3066\u3001HTML\u306e\u8868\u5f62\u5f0f\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3001\u5909\u66f4\u3001\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\nJSON\u30c7\u30fc\u30bf\u3067\u306e\u3084\u308a\u53d6\u308a\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u306a\u3069\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff08\u306a\u3093\u304b\u3046\u307e\u304f\u3067\u304d\u306a\u304b\u3063\u305f\u3067\u3059\uff09\u3002\n\n\u898b\u305f\u76ee\n\n\u66f4\u65b0\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u65b0\u898f\u767b\u9332\u3001\u5909\u66f4\u3001\u524a\u9664\u304c\u4e00\u5ea6\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u74b0\u5883\nApache 2.2.15\nphp 5.5.19\nsqlite3 3.6.20\n\n\u30b3\u30fc\u30c9\n1\u679a\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\nsample.php\n<?php\nheader(\"Content-Type: text/html; charset=UTF-8\");\n$db = new PDO(\"sqlite:sample.db\");\n$db->exec(\"CREATE TABLE IF NOT EXISTS sample (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)\");\n\n/**************/\n/* \u30c7\u30fc\u30bf\u53d6\u5f97 */\n/**************/\n\nif (isset($_GET[\"func\"]) && $_GET[\"func\"] == \"get_data\") {\n    $stmt = $db->query(\"SELECT * FROM sample\");\n    $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\n    $json = json_encode($rows);\n    echo $json;\n    exit();\n\n/*********************************/*\n/* \u30c7\u30fc\u30bf\u66f4\u65b0\uff08\u524a\u9664\u3001\u5909\u66f4\u3001\u8ffd\u52a0\uff09 \u3000 */\n/*********************************/*\n\n} else if (isset($_POST[\"func\"]) && $_POST[\"func\"] == \"upd_data\") {\n    // \u30c7\u30fc\u30bf\u53d7\u53d6\n    $delid = $_POST[\"delid\"];\n    $delid = json_decode($delid, true);\n    $upddata = $_POST[\"upddata\"];\n    $upddata = json_decode($upddata, true);\n    $insdata = $_POST[\"insdata\"];\n    $insdata = json_decode($insdata, true);\n\n    // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\n    $db->beginTransaction();\n    // \u30c7\u30fc\u30bf\u524a\u9664\n    if ($delid) {\n        for ($i=0; $i<count($delid); $i++) {\n            $sql = \"DELETE FROM sample WHERE id=?\";\n            $stmt = $db->prepare($sql);\n            $stmt->execute(array($delid[$i][\"id\"]));\n        }\n    }\n    // \u30c7\u30fc\u30bf\u5909\u66f4\n    if ($upddata) {\n        for ($i=0; $i<count($upddata); $i++) {\n            $sql = \"UPDATE sample SET name=?, age=? WHERE id=?\";\n            $stmt = $db->prepare($sql);\n            $stmt->execute(array($upddata[$i][\"name\"], $upddata[$i][\"age\"], $upddata[$i][\"id\"]));\n        }\n    }\n    // \u30c7\u30fc\u30bf\u8ffd\u52a0\n    if ($insdata) {\n        for ($i=0; $i<count($insdata); $i++) {\n            $sql = \"INSERT INTO sample (name, age) VALUES (?, ?)\";\n            $stmt = $db->prepare($sql);\n            $stmt->execute(array($insdata[$i][\"name\"], $insdata[$i][\"age\"]));\n        }\n    }\n    // \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7d42\u4e86\n    $db->commit();\n    exit();\n}\n$db = null;\n?>\n\n<html>\n<head>\n<script type=\"text/javascript\">\nvar Ajax = new XMLHttpRequest();\n\n// \u524a\u9664\u5bfe\u8c61ID\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar delid = [];\n\n// \u5909\u66f4\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar upddata = [];\n\n// \u65b0\u898f\u767b\u9332\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar insdata = [];\n\nwindow.onload = getSample;\n\n/************/\n/* \u4e00\u89a7\u8868\u793a */\n/************/\n\nfunction getSample() {\n    var rows, row, i, out;\n    var url = \"sample.php\" + \"?dummy=\" + new Date().getTime() + \"&func=\" + \"get_data\";\n    Ajax.open(\"GET\", url, true);\n    Ajax.send(null);\n    Ajax.onreadystatechange = function() {\n        if (Ajax.readyState == 4 && Ajax.status == 200) {\n            out = '<table border=\"1\" id=\"sampletb\">';\n            out += '<tr>';\n            out += '<th>\u524a\u9664</th>';\n            out += '<th>ID</th>';\n            out += '<th>\u6c0f\u540d</th>';\n            out += '<th>\u5e74\u9f62</th>';\n            out += '</tr>';\n            var res = Ajax.responseText;\n            if (res) {\n                rows = JSON.parse(res);\n                for (i in rows) {\n                    out += '<tr>';\n                    out += '<td><input type=\"checkbox\" id=\"'+i+':0\" onClick=\"delCheck(this);\"></td>';\n                    out += '<td><input type=\"text\" id=\"'+i+':1\" value='+rows[i][\"id\"]+' disabled></td>';\n                    out += '<td><input type=\"text\" id=\"'+i+':2\" value=\"'+rows[i][\"name\"]+'\" onChange=\"updCheck(this)\";></td>';\n                    out += '<td><input type=\"text\" id=\"'+i+':3\" value=\"'+rows[i][\"age\"]+'\" onChange=\"updCheck(this)\";></td>';\n                    out += '</tr>';\n                }   \n            }\n            out += '</table>';\n            out += '<p>';\n            out += '<button type=\"button\" onClick=\"addRow();\">'+\"\u884c\u8ffd\u52a0\"+'</button>';\n            out += '<button type=\"button\" onClick=\"Upd();\">'+\"\u66f4\u65b0\"+'</button>';\n            out += '</p>';\n            document.getElementById(\"result\").innerHTML = out;\n        }\n    }\n}\n\n/**********/\n/* \u884c\u8ffd\u52a0 */\n/**********/\n\nfunction addRow() {\n    var el = document.getElementById('sampletb');\n    var i = el.rows.length;\n    var insertRow = el.insertRow(i);\n    var insertCell0 = insertRow.insertCell(0);\n    var insertCell1 = insertRow.insertCell(1);\n    var insertCell2 = insertRow.insertCell(2);\n    var insertCell3 = insertRow.insertCell(3);\n    insertRow.style.backgroundColor = 'blue';\n    // 1:insid, 2:name, 3:age\n    insertCell0.innerHTML = '<td><input type=\"checkbox\"></td>';\n    insertCell1.innerHTML = '<input type=\"text\" id=\"'+i+':1\" value=\"'+i+'\" style=\"width:20px;\">';\n    insertCell2.innerHTML = '<input type=\"text\" id=\"'+i+':2\" value=\"\" onChange=\"insCheck(this)\";>';\n    insertCell3.innerHTML = '<input type=\"text\" id=\"'+i+':3\" value=\"\" onChange=\"insCheck(this)\";>';\n}\n\n/************/\n/* \u65b0\u898f\u767b\u9332 */\n/************/\n\nfunction insCheck(e) {\n    var index = e.id.indexOf(\":\");\n    var row = e.id.substring(0, index);\n    var insid = document.getElementById(row+':1').value;\n    var name = document.getElementById(row+':2').value;\n    var age = document.getElementById(row+':3').value;\n    // \u6700\u521d\u306e\u767b\u9332\u51e6\u7406\n    if (insdata.length == 0) {\n        insdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n        return;\n    }\n    // 2\u4ef6\u76ee\u4ee5\u964d\u306e\u767b\u9332\u51e6\u7406\n    // \u91cd\u8907\u304c\u3042\u308b\u5834\u5408\u306e\u767b\u9332\u51e6\u7406\n    for (var i=0; i<insdata.length; i++) {\n        if (insdata[i][\"insid\"] == insid) {\n            // \u914d\u5217\u304b\u3089\u9664\u5916\n            insdata.splice(i, 1);\n            // \u914d\u5217\u306b\u8ffd\u52a0\n            insdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n            return;\n        } \n    }\n    // \u91cd\u8907\u304c\u306a\u3044\u5834\u5408\u306e\u767b\u9332\u51e6\u7406\n    insdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n}\n\n/********/\n/* \u5909\u66f4 */\n/********/\n\nfunction updCheck(e) {\n    e.parentNode.style.backgroundColor = 'yellow';\n    var row = e.id.substr(0, e.id.indexOf(\":\"));\n    var tid = document.getElementById(row+':1').value;\n    var name = document.getElementById(row+':2').value;\n    var age = document.getElementById(row+':3').value;\n    // \u6700\u521d\u306e\u5909\u66f4\u51e6\u7406\n    if (upddata.length == 0) {\n        upddata.push({\"id\":tid, \"name\":name, \"age\":age});\n        return;\n    }\n    // 2\u4ef6\u76ee\u4ee5\u964d\u306e\u5909\u66f4\u51e6\u7406\n    // \u91cd\u8907\u304c\u3042\u308b\u5834\u5408\u306e\u5909\u66f4\u51e6\u7406\n    for (var i=0; i<upddata.length; i++) {\n        if (upddata[i][\"id\"] == tid) {\n            // \u914d\u5217\u304b\u3089\u9664\u5916\n            upddata.splice(i, 1);\n            // \u914d\u5217\u306b\u8ffd\u52a0\n            upddata.push({\"id\":tid, \"name\":name, \"age\":age});\n            return;\n        }\n    }\n    // \u91cd\u8907\u304c\u306a\u3044\u5834\u5408\u306e\u5909\u66f4\u51e6\u7406\n    upddata.push({\"id\":tid, \"name\":name, \"age\":age});\n}\n\n/********/\n/* \u524a\u9664 */\n/********/\n\nfunction delCheck(e) {\n    var tid = document.getElementById(e.id.replace(':0',':1')).value;\n    // \u30c1\u30a7\u30c3\u30af\u5165\u308c\u305f\u3068\u304d\n    if (e.checked == true) {\n        e.parentNode.parentNode.style.backgroundColor = 'red';\n        delid.push({\"id\":tid});\n    // \u30c1\u30a7\u30c3\u30af\u5916\u3057\u305f\u3068\u304d\n    } else if (e.checked == false) {\n        e.parentNode.parentNode.style.backgroundColor = '';\n        for (var i=0; i<delid.length; i++) {\n            if (delid[i][\"id\"] == tid) {\n                delid.splice(i, 1);\n            }\n        }\n    }\n}\n\n/************/\n/* \u66f4\u65b0\u51e6\u7406 */\n/************/\n\nfunction Upd() {\n    delid2 = JSON.stringify(delid);\n    upddata2 = JSON.stringify(upddata);\n    insdata2 = JSON.stringify(insdata);\n    url = \"sample.php\";\n    Ajax.open(\"POST\", url, true);\n    Ajax.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    Ajax.send(\"func=\" + \"upd_data\" + \"&delid=\" + delid2 + \"&upddata=\" + upddata2 + \"&insdata=\" + insdata2);\n    Ajax.onreadystatechange = function() {\n        if (Ajax.readyState == 4 && Ajax.status == 200) {\n            getSample();\n            // \u914d\u5217\u521d\u671f\u5316\n            delid.length=0;\n            upddata.length=0;\n            insdata.length=0;\n        }\n    }\n}\n\n</script>\n</head>\n<body>\n<div id=\"result\"></div>\n</body>\n</html>\n\n\n\n\n\n\n# \u6982\u8981\nID\u3001\u6c0f\u540d\u3001\u5e74\u9f62\u304b\u3089\u306a\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u524d\u63d0\u3068\u3057\u3066\u3001HTML\u306e\u8868\u5f62\u5f0f\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3001\u5909\u66f4\u3001\u524a\u9664\u3067\u304d\u308b\u3088\u3046\u306a\u3082\u306e\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nJSON\u30c7\u30fc\u30bf\u3067\u306e\u3084\u308a\u53d6\u308a\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u306a\u3069\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff08\u306a\u3093\u304b\u3046\u307e\u304f\u3067\u304d\u306a\u304b\u3063\u305f\u3067\u3059\uff09\u3002\n\n# \u898b\u305f\u76ee\n![sample.png](https://qiita-image-store.s3.amazonaws.com/0/112959/b474e8e9-c756-4732-6e97-91e397db10f4.png)\n\n\u66f4\u65b0\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u65b0\u898f\u767b\u9332\u3001\u5909\u66f4\u3001\u524a\u9664\u304c\u4e00\u5ea6\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n# \u74b0\u5883\nApache 2.2.15\nphp 5.5.19\nsqlite3 3.6.20\n\n# \u30b3\u30fc\u30c9\n\n1\u679a\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n```html+php:sample.php\n<?php\nheader(\"Content-Type: text/html; charset=UTF-8\");\n$db = new PDO(\"sqlite:sample.db\");\n$db->exec(\"CREATE TABLE IF NOT EXISTS sample (id INTEGER PRIMARY KEY, name TEXT, age INTEGER)\");\n\n/**************/\n/* \u30c7\u30fc\u30bf\u53d6\u5f97 */\n/**************/\n\nif (isset($_GET[\"func\"]) && $_GET[\"func\"] == \"get_data\") {\n\t$stmt = $db->query(\"SELECT * FROM sample\");\n\t$rows = $stmt->fetchAll(PDO::FETCH_ASSOC);\n\t$json = json_encode($rows);\n\techo $json;\n\texit();\n\n/*********************************/*\n/* \u30c7\u30fc\u30bf\u66f4\u65b0\uff08\u524a\u9664\u3001\u5909\u66f4\u3001\u8ffd\u52a0\uff09 \u3000 */\n/*********************************/*\n\n} else if (isset($_POST[\"func\"]) && $_POST[\"func\"] == \"upd_data\") {\n\t// \u30c7\u30fc\u30bf\u53d7\u53d6\n\t$delid = $_POST[\"delid\"];\n\t$delid = json_decode($delid, true);\n\t$upddata = $_POST[\"upddata\"];\n\t$upddata = json_decode($upddata, true);\n\t$insdata = $_POST[\"insdata\"];\n\t$insdata = json_decode($insdata, true);\n\n\t// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\n\t$db->beginTransaction();\n\t// \u30c7\u30fc\u30bf\u524a\u9664\n\tif ($delid) {\n\t\tfor ($i=0; $i<count($delid); $i++) {\n\t\t\t$sql = \"DELETE FROM sample WHERE id=?\";\n\t\t\t$stmt = $db->prepare($sql);\n\t\t\t$stmt->execute(array($delid[$i][\"id\"]));\n\t\t}\n\t}\n\t// \u30c7\u30fc\u30bf\u5909\u66f4\n\tif ($upddata) {\n\t\tfor ($i=0; $i<count($upddata); $i++) {\n\t\t\t$sql = \"UPDATE sample SET name=?, age=? WHERE id=?\";\n\t\t\t$stmt = $db->prepare($sql);\n\t\t\t$stmt->execute(array($upddata[$i][\"name\"], $upddata[$i][\"age\"], $upddata[$i][\"id\"]));\n\t\t}\n\t}\n\t// \u30c7\u30fc\u30bf\u8ffd\u52a0\n\tif ($insdata) {\n\t\tfor ($i=0; $i<count($insdata); $i++) {\n\t\t\t$sql = \"INSERT INTO sample (name, age) VALUES (?, ?)\";\n\t\t\t$stmt = $db->prepare($sql);\n\t\t\t$stmt->execute(array($insdata[$i][\"name\"], $insdata[$i][\"age\"]));\n\t\t}\n\t}\n\t// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7d42\u4e86\n\t$db->commit();\n\texit();\n}\n$db = null;\n?>\n\n<html>\n<head>\n<script type=\"text/javascript\">\nvar Ajax = new XMLHttpRequest();\n\n// \u524a\u9664\u5bfe\u8c61ID\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar delid = [];\n\n// \u5909\u66f4\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar upddata = [];\n\n// \u65b0\u898f\u767b\u9332\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3059\u308b\u914d\u5217\nvar insdata = [];\n\nwindow.onload = getSample;\n\n/************/\n/* \u4e00\u89a7\u8868\u793a */\n/************/\n\nfunction getSample() {\n\tvar rows, row, i, out;\n\tvar url = \"sample.php\" + \"?dummy=\" + new Date().getTime() + \"&func=\" + \"get_data\";\n\tAjax.open(\"GET\", url, true);\n\tAjax.send(null);\n\tAjax.onreadystatechange = function() {\n\t\tif (Ajax.readyState == 4 && Ajax.status == 200) {\n\t\t\tout = '<table border=\"1\" id=\"sampletb\">';\n\t\t\tout += '<tr>';\n\t\t\tout += '<th>\u524a\u9664</th>';\n\t\t\tout += '<th>ID</th>';\n\t\t\tout += '<th>\u6c0f\u540d</th>';\n\t\t\tout += '<th>\u5e74\u9f62</th>';\n\t\t\tout += '</tr>';\n\t\t\tvar res = Ajax.responseText;\n\t\t\tif (res) {\n\t\t\t\trows = JSON.parse(res);\n\t\t\t\tfor (i in rows) {\n\t\t\t\t\tout += '<tr>';\n\t\t\t\t\tout += '<td><input type=\"checkbox\" id=\"'+i+':0\" onClick=\"delCheck(this);\"></td>';\n\t\t\t\t\tout += '<td><input type=\"text\" id=\"'+i+':1\" value='+rows[i][\"id\"]+' disabled></td>';\n\t\t\t\t\tout += '<td><input type=\"text\" id=\"'+i+':2\" value=\"'+rows[i][\"name\"]+'\" onChange=\"updCheck(this)\";></td>';\n\t\t\t\t\tout += '<td><input type=\"text\" id=\"'+i+':3\" value=\"'+rows[i][\"age\"]+'\" onChange=\"updCheck(this)\";></td>';\n\t\t\t\t\tout += '</tr>';\n\t\t\t\t}\t\n\t\t\t}\n\t\t\tout += '</table>';\n\t\t\tout += '<p>';\n\t\t\tout += '<button type=\"button\" onClick=\"addRow();\">'+\"\u884c\u8ffd\u52a0\"+'</button>';\n\t\t\tout += '<button type=\"button\" onClick=\"Upd();\">'+\"\u66f4\u65b0\"+'</button>';\n\t\t\tout += '</p>';\n\t\t\tdocument.getElementById(\"result\").innerHTML = out;\n\t\t}\n\t}\n}\n\n/**********/\n/* \u884c\u8ffd\u52a0 */\n/**********/\n\nfunction addRow() {\n\tvar el = document.getElementById('sampletb');\n\tvar i = el.rows.length;\n\tvar insertRow = el.insertRow(i);\n\tvar insertCell0 = insertRow.insertCell(0);\n\tvar insertCell1 = insertRow.insertCell(1);\n\tvar insertCell2 = insertRow.insertCell(2);\n\tvar insertCell3 = insertRow.insertCell(3);\n\tinsertRow.style.backgroundColor = 'blue';\n\t// 1:insid, 2:name, 3:age\n\tinsertCell0.innerHTML = '<td><input type=\"checkbox\"></td>';\n\tinsertCell1.innerHTML = '<input type=\"text\" id=\"'+i+':1\" value=\"'+i+'\" style=\"width:20px;\">';\n\tinsertCell2.innerHTML = '<input type=\"text\" id=\"'+i+':2\" value=\"\" onChange=\"insCheck(this)\";>';\n\tinsertCell3.innerHTML = '<input type=\"text\" id=\"'+i+':3\" value=\"\" onChange=\"insCheck(this)\";>';\n}\n\n/************/\n/* \u65b0\u898f\u767b\u9332 */\n/************/\n\nfunction insCheck(e) {\n\tvar index = e.id.indexOf(\":\");\n\tvar row = e.id.substring(0, index);\n\tvar insid = document.getElementById(row+':1').value;\n\tvar name = document.getElementById(row+':2').value;\n\tvar age = document.getElementById(row+':3').value;\n\t// \u6700\u521d\u306e\u767b\u9332\u51e6\u7406\n\tif (insdata.length == 0) {\n\t\tinsdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n\t\treturn;\n\t}\n\t// 2\u4ef6\u76ee\u4ee5\u964d\u306e\u767b\u9332\u51e6\u7406\n\t// \u91cd\u8907\u304c\u3042\u308b\u5834\u5408\u306e\u767b\u9332\u51e6\u7406\n\tfor (var i=0; i<insdata.length; i++) {\n\t\tif (insdata[i][\"insid\"] == insid) {\n\t\t\t// \u914d\u5217\u304b\u3089\u9664\u5916\n\t\t\tinsdata.splice(i, 1);\n\t\t\t// \u914d\u5217\u306b\u8ffd\u52a0\n\t\t\tinsdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n\t\t\treturn;\n\t\t} \n\t}\n\t// \u91cd\u8907\u304c\u306a\u3044\u5834\u5408\u306e\u767b\u9332\u51e6\u7406\n\tinsdata.push({\"insid\":insid, \"name\":name, \"age\":age});\n}\n\n/********/\n/* \u5909\u66f4 */\n/********/\n\nfunction updCheck(e) {\n\te.parentNode.style.backgroundColor = 'yellow';\n\tvar row = e.id.substr(0, e.id.indexOf(\":\"));\n\tvar tid = document.getElementById(row+':1').value;\n\tvar name = document.getElementById(row+':2').value;\n\tvar age = document.getElementById(row+':3').value;\n\t// \u6700\u521d\u306e\u5909\u66f4\u51e6\u7406\n\tif (upddata.length == 0) {\n\t\tupddata.push({\"id\":tid, \"name\":name, \"age\":age});\n\t\treturn;\n\t}\n\t// 2\u4ef6\u76ee\u4ee5\u964d\u306e\u5909\u66f4\u51e6\u7406\n\t// \u91cd\u8907\u304c\u3042\u308b\u5834\u5408\u306e\u5909\u66f4\u51e6\u7406\n\tfor (var i=0; i<upddata.length; i++) {\n\t\tif (upddata[i][\"id\"] == tid) {\n\t\t\t// \u914d\u5217\u304b\u3089\u9664\u5916\n\t\t\tupddata.splice(i, 1);\n\t\t\t// \u914d\u5217\u306b\u8ffd\u52a0\n\t\t\tupddata.push({\"id\":tid, \"name\":name, \"age\":age});\n\t\t\treturn;\n\t\t}\n\t}\n\t// \u91cd\u8907\u304c\u306a\u3044\u5834\u5408\u306e\u5909\u66f4\u51e6\u7406\n\tupddata.push({\"id\":tid, \"name\":name, \"age\":age});\n}\n\n/********/\n/* \u524a\u9664 */\n/********/\n\nfunction delCheck(e) {\n\tvar tid = document.getElementById(e.id.replace(':0',':1')).value;\n\t// \u30c1\u30a7\u30c3\u30af\u5165\u308c\u305f\u3068\u304d\n\tif (e.checked == true) {\n\t\te.parentNode.parentNode.style.backgroundColor = 'red';\n\t\tdelid.push({\"id\":tid});\n\t// \u30c1\u30a7\u30c3\u30af\u5916\u3057\u305f\u3068\u304d\n\t} else if (e.checked == false) {\n\t\te.parentNode.parentNode.style.backgroundColor = '';\n\t\tfor (var i=0; i<delid.length; i++) {\n\t\t\tif (delid[i][\"id\"] == tid) {\n\t\t\t\tdelid.splice(i, 1);\n\t\t\t}\n\t\t}\n\t}\n}\n\n/************/\n/* \u66f4\u65b0\u51e6\u7406 */\n/************/\n\nfunction Upd() {\n\tdelid2 = JSON.stringify(delid);\n\tupddata2 = JSON.stringify(upddata);\n\tinsdata2 = JSON.stringify(insdata);\n\turl = \"sample.php\";\n\tAjax.open(\"POST\", url, true);\n\tAjax.setRequestHeader(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\tAjax.send(\"func=\" + \"upd_data\" + \"&delid=\" + delid2 + \"&upddata=\" + upddata2 + \"&insdata=\" + insdata2);\n\tAjax.onreadystatechange = function() {\n\t\tif (Ajax.readyState == 4 && Ajax.status == 200) {\n\t\t\tgetSample();\n\t\t\t// \u914d\u5217\u521d\u671f\u5316\n\t\t\tdelid.length=0;\n\t\t\tupddata.length=0;\n\t\t\tinsdata.length=0;\n\t\t}\n\t}\n}\n\n</script>\n</head>\n<body>\n<div id=\"result\"></div>\n</body>\n</html>\n\n\n```\n", "tags": ["Ajax", "PHP", "SQLite3", "JavaScript"]}