{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u691c\u8a3c\u6642\u306b\u5404\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u614b\u3092\u53d6\u5f97\u3057\u3066\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u898b\u305f\u3044\u306a\u3068\u601d\u3063\u3066\u3001fluentd\u3001influxDB\u3001Grafana\u3068\u3044\u3046\u69cb\u6210\u3067\u3044\u3044\u304b\u306a\u3068\u601d\u3044\u8abf\u3079\u305f\u3002\n\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306fdstat\u3067\u53d6\u5f97\u3057\u305f\u3002\n\n\u74b0\u5883\n\nOS: CentOS7.1\nRuby: 2.2.2p95\ndstat: 0.7.0\nfluentd: 0.12.15\ninfluxDB: 0.9.2\nGrafana: 2.1.3\n\n\nInstall\ndstat\u3001fluentd\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u3002\n$ sudo yum install dstat\n$ gem install fluentd\n\ninfluxDB\u306b\u3064\u3044\u3066\u306f\u3001InfluxDB \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - \u7c21\u5358\u306a\u4f7f\u3044\u65b9\nGrafana\u306b\u3064\u3044\u3066\u306f\u3001Grafana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - InfluxDB\u3068\u306e\u9023\u643a\n\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u30fb\u30fb\u30fb\u306f\u305a\u3002\n\ndstat\u306b\u3064\u3044\u3066\ndstat\u306f\u3001system\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3001cpu/memory/disk/network/\u5272\u308a\u8fbc\u307f\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n$ sudo dstat\nYou did not select any stats, using -cdngy by default.\n----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw \n  0   0 100   0   0   0| 996B 4819B|   0     0 |   0     0 |  41    84 \n  0   0 100   0   0   0|   0     0 | 132B  838B|   0     0 |  54   107 \n  2   0  98   0   0   0|   0  4096B| 822B 2940B|   0     0 |  78   125 ^C\n$\n\n\n\u30c7\u30fc\u30bf\u6295\u5165\u524d\u6e96\u5099\n\nFluentd\u8a2d\u5b9a\n\u4eca\u56de\u5229\u7528\u3059\u308bfluentd\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u4ee5\u4e0b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ fluent-gem install fluent-plugin-dstat fluent-plugin-influxdb fluent-plugin-typecast fluent-plugin-flatten-hash\n\n\u305d\u308c\u305e\u308c\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5f79\u5272\u306f\u4ee5\u4e0b\u3002\n\nfluent-plugin-dstat: dstat\u60c5\u5831\u3092Json\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\nfluent-plugin-influxdb: JSON\u30c7\u30fc\u30bf\u3092influxDB\u306b\u5165\u308c\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\nfluent-plugin-typecast: \u30c7\u30fc\u30bf\u306e\u578b\u3092\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\nfluent-plugin-flatten-hash: \u968e\u5c64\u5316\u3055\u308c\u3066\u3044\u308bJSON\u3092\u30d5\u30e9\u30c3\u30c8\u306aJSON\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n\n\nfluent-plugin-dstat\ninput\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3057\u3066fluent-plugin-dstat\u3092\u6a19\u6e96\u51fa\u529b\u3057\u3066\u307f\u308b\u3002\n\nflluentd_dstat.conf\n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<match before_trans>\n  type stdout\n</match>\n\n\n\u4e0a\u8a18\u30d5\u30a1\u30a4\u30eb\u3067\u306fdstat\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066-cdgny\u3092\u6307\u5b9a\u3057\u3066\u3084\u308a3\u79d2\u6bce\u306b\u5b9f\u884c\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\u4e0a\u8a18\u30d5\u30a1\u30a4\u30eb\u3067fluentd\u3092\u5b9f\u884c\u3057\u3066\u3084\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n$ fluend -c fluentd_dstat.conf\n....\n2015-08-28 00:55:56 +0900 before_trans: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat\":{\"total_cpu_usage\":{\"usr\":\"0.288\",\"sys\":\"0.131\",\"idl\":\"99.556\",\"wai\":\"0.024\",\"hiq\":\"0.000\",\"siq\":\"0.002\"},\"dsk/total\":{\"read\":\"995.537\",\"writ\":\"4817.681\"},\"paging\":{\"in\":\"0.0\",\"out\":\"0.0\"},\"net/total\":{\"recv\":\"0.0\",\"send\":\"0.0\"},\"system\":{\"int\":\"40.824\",\"csw\":\"83.692\"}}}\n2015-08-28 00:55:59 +0900 before_trans: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat\":{\"total_cpu_usage\":{\"usr\":\"0.664\",\"sys\":\"0.0\",\"idl\":\"99.336\",\"wai\":\"0.0\",\"hiq\":\"0.0\",\"siq\":\"0.0\"},\"dsk/total\":{\"read\":\"0.0\",\"writ\":\"1365.333\"},\"paging\":{\"in\":\"0.0\",\"out\":\"0.0\"},\"net/total\":{\"recv\":\"274.0\",\"send\":\"1008.667\"},\"system\":{\"int\":\"56.0\",\"csw\":\"108.0\"}}}\n$ \n\n\u4e0a\u8a18\u3092\u898b\u3066\u3084\u308b\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u3001JSON\u304c\u968e\u5c64\u5316\u3055\u308c\u3066\u3044\u3066\u3001\u5024\u304c\u6587\u5b57\u5217\u3068\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nInfluxDB\u306b\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3059\u308b\u305f\u3081\u306b\u5229\u7528\u3059\u308bfluent-plugin-influxdb\u3067\u306f\u30d5\u30e9\u30c3\u30c8\u306aJSON\u3067\u3057\u304b\u6295\u5165\u51fa\u6765\u306a\u3044\u306e\u3067\u3001fluent-plugin-flatten-hash\u3067\u30d5\u30e9\u30c3\u30c8\u306aJSON\u306b\u5909\u66f4\u3059\u308b\u3002\u307e\u305fInfluxDB\u3067\u6570\u5024\u3068\u3057\u3066\u6271\u3044\u305f\u3044\u306e\u3067fluent-plugin-typecast\u3067\u5909\u63db\u3057\u3066\u3084\u308b\u3002\n\nfluent-plugin-typecast + fluent-plugin-flatten-hash\n\u30d5\u30e9\u30c3\u30c8\u306aJSON\u3067\u6587\u5b57\u5217\u3092\u6570\u5024\u306b\u5909\u63db\u3057\u3066\u3084\u308bfluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u3002\n\nflatten_hash\u3067\u968e\u5c64\u69cb\u9020\u306eJSON\u306e\u7d50\u5408\u6587\u5b57\u5217\u3092\u4f55\u3059\u308b\u304b\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u3053\u3053\u3067\u306f__\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u6b21\u306brecord_transformer\u3067\u30c7\u30fc\u30bf\u306bkey\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\nInfluxDB\u3067\u89e3\u6790\u3059\u308b\u969b\u306b/\u304c\u3042\u308b\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u305f\u306e\u3067\u5909\u63db\u3057\u3066\u3044\u308b\u3002\ntypecast\u3067string\u3092float\u306b\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\nrecord_transformer\u3067key\u306b/\u304c\u3042\u308b\u3082\u306e\u3092\u524a\u9664\u3057\u3066\u3044\u308b\u3002typecast\u6642\u306borginal\u306ekey\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3053\u3046\u3044\u3046\u66f8\u304d\u65b9\u306b\u3057\u3066\u3044\u308b\u3002(\u591a\u5206\u3082\u3063\u3068\u826f\u3044\u66f8\u304d\u65b9\u3084\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u308b\u306f\u305a\uff01)\n\n\nfluentd_flatter.conf\n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<filter before*>\n  type flatten_hash\n  separator __\n</filter>\n\n<filter before*>\n  type record_transformer\n  <record>\n    dstat__net_total__send ${dstat__net/total__send}\n    dstat__dsk_total__read ${dstat__dsk/total__read}\n    dstat__dsk_total__writ ${dstat__dsk/total__writ}\n    dstat__net_total__recv ${dstat__net/total__recv}\n    dstat__net_total__send ${dstat__net/total__send}\n  </record>\n</filter>\n\n<match before_*>\n  type typecast\n  item_types dstat__total_cpu_usage__usr:float,dstat__total_cpu_usage__sys:float,dstat__total_cpu_usage__idl:float,dstat__total_cpu_usage__wai:float,dstat__total_cpu_usage__hiq:float,dstat__total_cpu_usage__siq:float,dstat__paging__in:float,dstat__paging__out:float,dstat__system__int:float,dstat__system__csw:float,dstat__net_total__send:float,dstat__dsk_total__read:float,dstat__dsk_total__writ:float,dstat__net_total__recv:float,dstat__net_total__send:float\n  tag influx_dstat\n</match>\n\n<filter influx_dstat>\n  type record_transformer\n  remove_keys dstat__net/total__send,dstat__dsk/total__read,dstat__dsk/total__writ,dstat__net/total__recv,dstat__net/total__send \n</filter>\n\n<match influx_*>\n  type stdout\n</match>\n\n\n\u51fa\u529b\u306f\u4ee5\u4e0b\u3068\u306a\u308b\u3002\n$ fluentd -c fluentd_flatter.conf \n2015-08-28 01:05:26 +0900 influx_dstat: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat__total_cpu_usage__usr\":0.288,\"dstat__total_cpu_usage__sys\":0.131,\"dstat__total_cpu_usage__idl\":99.556,\"dstat__total_cpu_usage__wai\":0.024,\"dstat__total_cpu_usage__hiq\":0.0,\"dstat__total_cpu_usage__siq\":0.002,\"dstat__paging__in\":0.0,\"dstat__paging__out\":0.0,\"dstat__system__int\":40.836,\"dstat__system__csw\":83.713,\"dstat__net_total__send\":0.0,\"dstat__dsk_total__read\":994.721,\"dstat__dsk_total__writ\":4815.365,\"dstat__net_total__recv\":0.0}\n2015-08-28 01:05:29 +0900 influx_dstat: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat__total_cpu_usage__usr\":0.0,\"dstat__total_cpu_usage__sys\":0.0,\"dstat__total_cpu_usage__idl\":100.0,\"dstat__total_cpu_usage__wai\":0.0,\"dstat__total_cpu_usage__hiq\":0.0,\"dstat__total_cpu_usage__siq\":0.0,\"dstat__paging__in\":0.0,\"dstat__paging__out\":0.0,\"dstat__system__int\":55.333,\"dstat__system__csw\":111.333,\"dstat__net_total__send\":215.333,\"dstat__dsk_total__read\":0.0,\"dstat__dsk_total__writ\":2730.667,\"dstat__net_total__recv\":88.0}\n$\n\n\u6700\u5f8c\u306binfluxDB\u306b\u5165\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u7d44\u307f\u8fbc\u3093\u3060\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u3002\n\nfluentd.conf\n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<filter before*>\n  type flatten_hash\n  separator __\n</filter>\n\n<filter before*>\n  type record_transformer\n  <record>\n    dstat__net_total__send ${dstat__net/total__send}\n    dstat__dsk_total__read ${dstat__dsk/total__read}\n    dstat__dsk_total__writ ${dstat__dsk/total__writ}\n    dstat__net_total__recv ${dstat__net/total__recv}\n    dstat__net_total__send ${dstat__net/total__send}\n  </record>\n</filter>\n\n<match before_*>\n  type typecast\n  item_types dstat__total_cpu_usage__usr:float,dstat__total_cpu_usage__sys:float,dstat__total_cpu_usage__idl:float,dstat__total_cpu_usage__wai:float,dstat__total_cpu_usage__hiq:float,dstat__total_cpu_usage__siq:float,dstat__paging__in:float,dstat__paging__out:float,dstat__system__int:float,dstat__system__csw:float,dstat__net_total__send:float,dstat__dsk_total__read:float,dstat__dsk_total__writ:float,dstat__net_total__recv:float,dstat__net_total__send:float\n  tag influx_dstat\n</match>\n\n<filter influx_dstat>\n  type record_transformer\n  remove_keys dstat__net/total__send,dstat__dsk/total__read,dstat__dsk/total__writ,dstat__net/total__recv,dstat__net/total__send \n</filter>\n\n<match influx_*>\n  type influxdb\n  host localhost\n  port 8086\n  dbname demo\n  tag_keys [\"hostname\"]\n  time_precision s\n</match>\n\n\n\nInfluxDB\u306e\u8a2d\u5b9a\nInfluxDB\u3067\u306fDB\u3092\u7528\u610f\u3059\u308b\u3060\u3051\u3002\n$ influx\nConnected to http://localhost:8086 version 0.9.2\nInfluxDB shell 0.9.2\n> CREATE DATABASE demo\n> exit\n$\n\n\n\u30c7\u30fc\u30bf\u6295\u5165\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067fluentd\u3092\u8d77\u52d5\u3059\u308c\u3070InfluxDB\u306b\u30c7\u30fc\u30bf\u304c\u5165\u308b\u3002\n$ fluentd -c fluentd.conf \n\n\nGrafana\u306e\u8a2d\u5b9a\nGrafana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - InfluxDB\u3068\u306e\u9023\u643a\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306bDatasource\u3068Dashboard\u3092\u4f5c\u6210\u3057\u3066\u3084\u308b\u3002\nDatasources\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u611f\u3058\u3002\n\nMetrics\u306e\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u3002\n\u3053\u3053\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d2\u30c3\u30af\u91cf\u3092\u8868\u793a\u3002\n\n\u3042\u3068\u306f\u3044\u304f\u3064\u304b\u306e\u30b0\u30e9\u30d5\u3092\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u8ffd\u52a0\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n\u3042\u308b\u7a0b\u5ea6\u898b\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d\u3002\n\n\u304a\u308f\u308a\u306b\n\u3042\u3068\u306ftag\u306e\u5024\u3067\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3057\u3066\u3084\u3063\u3066\u91cd\u306d\u3066\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3055\u305b\u3089\u308c\u308c\u3070\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3042\u308b\u7a0b\u5ea6\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\u304a\u3057\u307e\u3044\u3002\n\n# \u306f\u3058\u3081\u306b\n\u691c\u8a3c\u6642\u306b\u5404\u30b5\u30fc\u30d0\u30fc\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u614b\u3092\u53d6\u5f97\u3057\u3066\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u898b\u305f\u3044\u306a\u3068\u601d\u3063\u3066\u3001fluentd\u3001influxDB\u3001Grafana\u3068\u3044\u3046\u69cb\u6210\u3067\u3044\u3044\u304b\u306a\u3068\u601d\u3044\u8abf\u3079\u305f\u3002\n\u30ea\u30bd\u30fc\u30b9\u60c5\u5831\u306fdstat\u3067\u53d6\u5f97\u3057\u305f\u3002\n\n# \u74b0\u5883\n\n- OS: CentOS7.1\n- Ruby: 2.2.2p95\n- dstat: 0.7.0\n- fluentd: 0.12.15\n- influxDB: 0.9.2\n- Grafana: 2.1.3\n\n# Install\ndstat\u3001fluentd\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u3002\n\n```\n$ sudo yum install dstat\n$ gem install fluentd\n```\n\ninfluxDB\u306b\u3064\u3044\u3066\u306f\u3001[InfluxDB \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - \u7c21\u5358\u306a\u4f7f\u3044\u65b9](http://qiita.com/akito1986/items/9c1c14a36654646db456)\nGrafana\u306b\u3064\u3044\u3066\u306f\u3001[Grafana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - InfluxDB\u3068\u306e\u9023\u643a](http://qiita.com/akito1986/items/bee99eaf5ddac2bc3498)\n\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u308b\u30fb\u30fb\u30fb\u306f\u305a\u3002\n\n# dstat\u306b\u3064\u3044\u3066\ndstat\u306f\u3001system\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3001cpu/memory/disk/network/\u5272\u308a\u8fbc\u307f\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u308b\u3002\n\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n\n```\n$ sudo dstat\nYou did not select any stats, using -cdngy by default.\n----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--\nusr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw \n  0   0 100   0   0   0| 996B 4819B|   0     0 |   0     0 |  41    84 \n  0   0 100   0   0   0|   0     0 | 132B  838B|   0     0 |  54   107 \n  2   0  98   0   0   0|   0  4096B| 822B 2940B|   0     0 |  78   125 ^C\n$\n```\n\n# \u30c7\u30fc\u30bf\u6295\u5165\u524d\u6e96\u5099\n## Fluentd\u8a2d\u5b9a\n\u4eca\u56de\u5229\u7528\u3059\u308bfluentd\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u4ee5\u4e0b\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```\n$ fluent-gem install fluent-plugin-dstat fluent-plugin-influxdb fluent-plugin-typecast fluent-plugin-flatten-hash\n```\n\n\u305d\u308c\u305e\u308c\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5f79\u5272\u306f\u4ee5\u4e0b\u3002\n\n- fluent-plugin-dstat: dstat\u60c5\u5831\u3092Json\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n- fluent-plugin-influxdb: JSON\u30c7\u30fc\u30bf\u3092influxDB\u306b\u5165\u308c\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n- fluent-plugin-typecast: \u30c7\u30fc\u30bf\u306e\u578b\u3092\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n- fluent-plugin-flatten-hash: \u968e\u5c64\u5316\u3055\u308c\u3066\u3044\u308bJSON\u3092\u30d5\u30e9\u30c3\u30c8\u306aJSON\u306b\u5909\u63db\u3057\u3066\u304f\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\n\n### fluent-plugin-dstat\ninput\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3057\u3066fluent-plugin-dstat\u3092\u6a19\u6e96\u51fa\u529b\u3057\u3066\u307f\u308b\u3002\n\n```flluentd_dstat.conf\n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<match before_trans>\n  type stdout\n</match>\n```\n\u4e0a\u8a18\u30d5\u30a1\u30a4\u30eb\u3067\u306fdstat\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u3068\u3057\u3066`-cdgny`\u3092\u6307\u5b9a\u3057\u3066\u3084\u308a3\u79d2\u6bce\u306b\u5b9f\u884c\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u3044\u308b\u3002\n\u4e0a\u8a18\u30d5\u30a1\u30a4\u30eb\u3067fluentd\u3092\u5b9f\u884c\u3057\u3066\u3084\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3002\n\n\n```\n$ fluend -c fluentd_dstat.conf\n....\n2015-08-28 00:55:56 +0900 before_trans: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat\":{\"total_cpu_usage\":{\"usr\":\"0.288\",\"sys\":\"0.131\",\"idl\":\"99.556\",\"wai\":\"0.024\",\"hiq\":\"0.000\",\"siq\":\"0.002\"},\"dsk/total\":{\"read\":\"995.537\",\"writ\":\"4817.681\"},\"paging\":{\"in\":\"0.0\",\"out\":\"0.0\"},\"net/total\":{\"recv\":\"0.0\",\"send\":\"0.0\"},\"system\":{\"int\":\"40.824\",\"csw\":\"83.692\"}}}\n2015-08-28 00:55:59 +0900 before_trans: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat\":{\"total_cpu_usage\":{\"usr\":\"0.664\",\"sys\":\"0.0\",\"idl\":\"99.336\",\"wai\":\"0.0\",\"hiq\":\"0.0\",\"siq\":\"0.0\"},\"dsk/total\":{\"read\":\"0.0\",\"writ\":\"1365.333\"},\"paging\":{\"in\":\"0.0\",\"out\":\"0.0\"},\"net/total\":{\"recv\":\"274.0\",\"send\":\"1008.667\"},\"system\":{\"int\":\"56.0\",\"csw\":\"108.0\"}}}\n$ \n```\n\n\u4e0a\u8a18\u3092\u898b\u3066\u3084\u308b\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u3001JSON\u304c\u968e\u5c64\u5316\u3055\u308c\u3066\u3044\u3066\u3001\u5024\u304c\u6587\u5b57\u5217\u3068\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nInfluxDB\u306b\u30c7\u30fc\u30bf\u3092\u6295\u5165\u3059\u308b\u305f\u3081\u306b\u5229\u7528\u3059\u308bfluent-plugin-influxdb\u3067\u306f\u30d5\u30e9\u30c3\u30c8\u306aJSON\u3067\u3057\u304b\u6295\u5165\u51fa\u6765\u306a\u3044\u306e\u3067\u3001fluent-plugin-flatten-hash\u3067\u30d5\u30e9\u30c3\u30c8\u306aJSON\u306b\u5909\u66f4\u3059\u308b\u3002\u307e\u305fInfluxDB\u3067\u6570\u5024\u3068\u3057\u3066\u6271\u3044\u305f\u3044\u306e\u3067fluent-plugin-typecast\u3067\u5909\u63db\u3057\u3066\u3084\u308b\u3002\n\n### fluent-plugin-typecast + fluent-plugin-flatten-hash\n\u30d5\u30e9\u30c3\u30c8\u306aJSON\u3067\u6587\u5b57\u5217\u3092\u6570\u5024\u306b\u5909\u63db\u3057\u3066\u3084\u308bfluentd\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u3002\n\n- `flatten_hash`\u3067\u968e\u5c64\u69cb\u9020\u306eJSON\u306e\u7d50\u5408\u6587\u5b57\u5217\u3092\u4f55\u3059\u308b\u304b\u3092\u8a2d\u5b9a\u3059\u308b\u3002\u3053\u3053\u3067\u306f`__`\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n- \u6b21\u306b`record_transformer`\u3067\u30c7\u30fc\u30bf\u306bkey\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\nInfluxDB\u3067\u89e3\u6790\u3059\u308b\u969b\u306b`/`\u304c\u3042\u308b\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u305f\u306e\u3067\u5909\u63db\u3057\u3066\u3044\u308b\u3002\n\n- `typecast`\u3067string\u3092float\u306b\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\n- `record_transformer`\u3067key\u306b`/`\u304c\u3042\u308b\u3082\u306e\u3092\u524a\u9664\u3057\u3066\u3044\u308b\u3002typecast\u6642\u306borginal\u306ekey\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3053\u3046\u3044\u3046\u66f8\u304d\u65b9\u306b\u3057\u3066\u3044\u308b\u3002(\u591a\u5206\u3082\u3063\u3068\u826f\u3044\u66f8\u304d\u65b9\u3084\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u3042\u308b\u306f\u305a\uff01)\n\n```fluentd_flatter.conf \n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<filter before*>\n  type flatten_hash\n  separator __\n</filter>\n\n<filter before*>\n  type record_transformer\n  <record>\n    dstat__net_total__send ${dstat__net/total__send}\n    dstat__dsk_total__read ${dstat__dsk/total__read}\n    dstat__dsk_total__writ ${dstat__dsk/total__writ}\n    dstat__net_total__recv ${dstat__net/total__recv}\n    dstat__net_total__send ${dstat__net/total__send}\n  </record>\n</filter>\n\n<match before_*>\n  type typecast\n  item_types dstat__total_cpu_usage__usr:float,dstat__total_cpu_usage__sys:float,dstat__total_cpu_usage__idl:float,dstat__total_cpu_usage__wai:float,dstat__total_cpu_usage__hiq:float,dstat__total_cpu_usage__siq:float,dstat__paging__in:float,dstat__paging__out:float,dstat__system__int:float,dstat__system__csw:float,dstat__net_total__send:float,dstat__dsk_total__read:float,dstat__dsk_total__writ:float,dstat__net_total__recv:float,dstat__net_total__send:float\n  tag influx_dstat\n</match>\n\n<filter influx_dstat>\n  type record_transformer\n  remove_keys dstat__net/total__send,dstat__dsk/total__read,dstat__dsk/total__writ,dstat__net/total__recv,dstat__net/total__send \n</filter>\n\n<match influx_*>\n  type stdout\n</match>\n```\n\n\u51fa\u529b\u306f\u4ee5\u4e0b\u3068\u306a\u308b\u3002\n\n```\n$ fluentd -c fluentd_flatter.conf \n2015-08-28 01:05:26 +0900 influx_dstat: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat__total_cpu_usage__usr\":0.288,\"dstat__total_cpu_usage__sys\":0.131,\"dstat__total_cpu_usage__idl\":99.556,\"dstat__total_cpu_usage__wai\":0.024,\"dstat__total_cpu_usage__hiq\":0.0,\"dstat__total_cpu_usage__siq\":0.002,\"dstat__paging__in\":0.0,\"dstat__paging__out\":0.0,\"dstat__system__int\":40.836,\"dstat__system__csw\":83.713,\"dstat__net_total__send\":0.0,\"dstat__dsk_total__read\":994.721,\"dstat__dsk_total__writ\":4815.365,\"dstat__net_total__recv\":0.0}\n2015-08-28 01:05:29 +0900 influx_dstat: {\"hostname\":\"influxdb.cs1aidcfcloud.internal\",\"dstat__total_cpu_usage__usr\":0.0,\"dstat__total_cpu_usage__sys\":0.0,\"dstat__total_cpu_usage__idl\":100.0,\"dstat__total_cpu_usage__wai\":0.0,\"dstat__total_cpu_usage__hiq\":0.0,\"dstat__total_cpu_usage__siq\":0.0,\"dstat__paging__in\":0.0,\"dstat__paging__out\":0.0,\"dstat__system__int\":55.333,\"dstat__system__csw\":111.333,\"dstat__net_total__send\":215.333,\"dstat__dsk_total__read\":0.0,\"dstat__dsk_total__writ\":2730.667,\"dstat__net_total__recv\":88.0}\n$\n```\n\n\u6700\u5f8c\u306binfluxDB\u306b\u5165\u308c\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u7d44\u307f\u8fbc\u3093\u3060\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u3002\n\n```fluentd.conf\n<source>\n  type dstat\n  tag before_trans\n  option -cdgny\n  delay 3\n</source>\n\n<filter before*>\n  type flatten_hash\n  separator __\n</filter>\n\n<filter before*>\n  type record_transformer\n  <record>\n    dstat__net_total__send ${dstat__net/total__send}\n    dstat__dsk_total__read ${dstat__dsk/total__read}\n    dstat__dsk_total__writ ${dstat__dsk/total__writ}\n    dstat__net_total__recv ${dstat__net/total__recv}\n    dstat__net_total__send ${dstat__net/total__send}\n  </record>\n</filter>\n\n<match before_*>\n  type typecast\n  item_types dstat__total_cpu_usage__usr:float,dstat__total_cpu_usage__sys:float,dstat__total_cpu_usage__idl:float,dstat__total_cpu_usage__wai:float,dstat__total_cpu_usage__hiq:float,dstat__total_cpu_usage__siq:float,dstat__paging__in:float,dstat__paging__out:float,dstat__system__int:float,dstat__system__csw:float,dstat__net_total__send:float,dstat__dsk_total__read:float,dstat__dsk_total__writ:float,dstat__net_total__recv:float,dstat__net_total__send:float\n  tag influx_dstat\n</match>\n\n<filter influx_dstat>\n  type record_transformer\n  remove_keys dstat__net/total__send,dstat__dsk/total__read,dstat__dsk/total__writ,dstat__net/total__recv,dstat__net/total__send \n</filter>\n\n<match influx_*>\n  type influxdb\n  host localhost\n  port 8086\n  dbname demo\n  tag_keys [\"hostname\"]\n  time_precision s\n</match>\n```\n\n## InfluxDB\u306e\u8a2d\u5b9a\n\nInfluxDB\u3067\u306fDB\u3092\u7528\u610f\u3059\u308b\u3060\u3051\u3002\n\n```\n$ influx\nConnected to http://localhost:8086 version 0.9.2\nInfluxDB shell 0.9.2\n> CREATE DATABASE demo\n> exit\n$\n```\n# \u30c7\u30fc\u30bf\u6295\u5165\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067fluentd\u3092\u8d77\u52d5\u3059\u308c\u3070InfluxDB\u306b\u30c7\u30fc\u30bf\u304c\u5165\u308b\u3002\n\n```\n$ fluentd -c fluentd.conf \n```\n\n## Grafana\u306e\u8a2d\u5b9a\n[Grafana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb - InfluxDB\u3068\u306e\u9023\u643a](http://qiita.com/akito1986/items/bee99eaf5ddac2bc3498)\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306bDatasource\u3068Dashboard\u3092\u4f5c\u6210\u3057\u3066\u3084\u308b\u3002\n\nDatasources\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u611f\u3058\u3002\n\n![graphana_set.png](https://qiita-image-store.s3.amazonaws.com/0/46472/b1c11629-2f37-629e-543b-62f39698382f.png \"graphana_set.png\")\n\nMetrics\u306e\u66f8\u304d\u65b9\u306f\u4ee5\u4e0b\u3002\n\u3053\u3053\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d2\u30c3\u30af\u91cf\u3092\u8868\u793a\u3002\n\n![graphana_metrics.png](https://qiita-image-store.s3.amazonaws.com/0/46472/2c7ec08f-837d-0ac2-f47d-2af24a62d3eb.png \"graphana_metrics.png\")\n\n\u3042\u3068\u306f\u3044\u304f\u3064\u304b\u306e\u30b0\u30e9\u30d5\u3092\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u8ffd\u52a0\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n![graphana_dashboard.png](https://qiita-image-store.s3.amazonaws.com/0/46472/df8a00d6-93de-7abc-bae7-cd614466b268.png \"graphana_dashboard.png\")\n\n\u3042\u308b\u7a0b\u5ea6\u898b\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u304d\u307e\u3057\u305f\u306d\u3002\n\n# \u304a\u308f\u308a\u306b\n\u3042\u3068\u306ftag\u306e\u5024\u3067\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\u3057\u3066\u3084\u3063\u3066\u91cd\u306d\u3066\u30b0\u30e9\u30d5\u3092\u8868\u793a\u3055\u305b\u3089\u308c\u308c\u3070\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3042\u308b\u7a0b\u5ea6\u4f7f\u3048\u305d\u3046\u3067\u3059\u3002\n\n\u304a\u3057\u307e\u3044\u3002\n", "tags": ["fluentd", "influxdb", "dstat", "grafana"]}