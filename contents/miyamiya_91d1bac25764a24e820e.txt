{"context": "\u30d6\u30ed\u30b02\u3064\u3092\u7e8f\u3081\u305f\u8ee2\u8f09\n\nCentOS 7.2 \u3067 Docker \u59cb\u3081\u307e\u3059\nCentOS 7 \u3067 Hubot on Docker \u3092\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2\n\n\n\u65b0\u3057\u304f\u5951\u7d04\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u306b CentOS 7.2 \u3092\u5165\u308c\u305f\u306e\u3067\u3001Docker \u5165\u308c\u3066 Hubot \u3092\u8a66\u3057\u3066\u307f\u305f\n\u591a\u304f\u306e\u4eba\u304c\u3084\u3063\u3066\u63b2\u8f09\u3057\u3066\u308b\u3051\u3069\u3001\u81ea\u5206\u306e\u30e1\u30e2\u3068\u3057\u3066\u66f8\u304f\n\nDocker \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u304c\u3001CentOS 7.x \u304b\u3089\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u306e\u3067 yum \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u53ef\u80fd\n$ sudo yum install doker\n$ sudo systemctl start docker\n$ sudo systemctl enable docker\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n\n\n\u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\n\u6b21\u306b\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u30fc(miyamiya)\u304c docker \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\n$ sudo groupadd docker\n$ sudo gpasswd -a miyamiya docker\nAdding user miyamiya to group docker\n$ sudo systemctl restart docker\n\n\u4e00\u65e6\u3053\u3053\u3067\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u307e\u3057\u305f\n\u3061\u306a\u307f\u306b\u3053\u306e\u624b\u9806\u3092\u53d6\u3089\u306a\u3044\u3067\u4e00\u822c\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30a8\u30e9\u30fc\u3068\u306a\u308b\n$ docker pull node\nUsing default tag: latest\nPost http:///var/run/docker.sock/v1.20/images/create?fromImage=node%3Alatest: dial unix /var/run/docker.sock: permission denied.\n* Are you trying to connect to a TLS-enabled daemon without TLS?\n* Is your docker daemon up and running?\n\n\nSlack \u30c1\u30fc\u30e0\u306e\u4f5c\u6210\u3068 API Token \u306e\u53d6\u5f97\n\u304b\u3001\u304b\u3001\u5272\u611b... (\u30e1\u30e2\u3063\u3066\u306a\u3044\uff57\n\nnode.js \u306e\u74b0\u5883\u3092\u6e96\u5099\nHubot \u306f node.js \u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001node.js \u306e\u74b0\u5883\u3092\u6e96\u5099\u3059\u308b\nnode.js \u516c\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\n\u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n$ docker pull node\n\n\u78ba\u8a8d\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\ndocker.io/node      latest              2c06219661ed        8 days ago          644.2 MB\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n$ docker run --rm -it -v /etc/localtime:/etc/localtime:ro --name \"bot-base\" node /bin/sh\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8aac\u660e\n\n--name \"bot-base\"\n\u30b3\u30f3\u30c6\u30ca\u540d\u306f bot-base\nnode\n\u4f7f\u3046\u30a4\u30e1\u30fc\u30b8\u306f node.js\n\n-v /etc/localtime:/etc/localtime:ro\nlocaletime \u306f\u30db\u30b9\u30c8\u3068 Readonly \u3067\u5171\u6709\u3059\u308b(\u65e5\u672c\u306e\u6642\u9593\u306b\u3059\u308b)\n-it , /bin/sh\n\u8d77\u52d5\u5f8c\u30b7\u30a7\u30eb\u306b\u5165\u308b\n--rm\n\u843d\u3068\u3057\u305f\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b\n\n\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u5f8c\n\nCtrl+p, Ctrl+q \u3067\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u629c\u3051\u308b\nexit \u3067\u629c\u3051\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u306f\u524a\u9664\u3055\u308c\u308b(--rm \u3092\u3064\u3051\u3066\u3044\u308b\u305f\u3081)\n\n\n--rm \u3092\u3064\u3051\u305a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u624b\u52d5\u3067\u524a\u9664\u3059\u308b\u3068\u304d\n\u8d77\u52d5\u4e2d\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n2f12ee8929bb        bot-base            \"/bin/sh\"                  5 days ago          Up 5 days                               bot-base\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u505c\u6b62\n$ docker stop bot-base\nbot-base\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u524a\u9664\n$ docker rm bot-base\nbot-base\n\n\nHubot \u3092\u52d5\u304b\u305b\u308b\u307e\u3067\u3072\u305f\u3059\u3089\u9811\u5f35\u308b\n\u6b21\u306e\u4e8b\u304c\u3067\u304d\u308b\u307e\u3067\u3001\u8a66\u3057\u3066\u307f\u3066\u30e1\u30e2\u3063\u3066\u3001\u307e\u305f\u30b3\u30f3\u30c6\u30ca\u6700\u521d\u304b\u3089\u3084\u3063\u3066\u307f\u3066\u3092\u7e70\u308a\u8fd4\u3057\u305f\n\nHubot Generator \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nHubot \u3092\u4f5c\u6210\nHubot \u3092\u8d77\u52d5\n\n\u3053\u308c\u3092\u5143\u306b\u3057\u3066 Dockerfile \u3092\u4f5c\u3063\u305f\n\nDockerfile\nFROM node\nMAINTAINER miyamiya\n\nRUN npm install -g yo generator-hubot\nRUN npm list -g yo generator-hubot\nRUN useradd bot\nRUN mkdir /home/bot && chown bot.bot /home/bot\n\nUSER bot\nWORKDIR /home/bot\nRUN  yo hubot --owner \"miyamiya\" --name \"bot\" --description \"Hubot image\" --adapter slack\n\nCMD cd /home/bot/hubot; bin/hubot --adapter slack\n\n\n\nHubot \u7528\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n$ docker build -t bot-base .\nSending build context to Docker daemon 4.096 kB\nStep 1 : FROM node\n ---> 2c06219661ed\nStep 2 : MAINTAINER miyamiya\n ---> Using cache\n ---> 6cd0fb4b3b24\nStep 3 : RUN npm install -g yo generator-hubot\n ---> Using cache\n ---> 86f522f924ca\n  \uff1a\n\uff08\u7701\u7565\uff09\n  \uff1a\nnpm info ok \n ---> ef4964132a7f\nRemoving intermediate container 2464b01dd061\nStep 10 : CMD bin/hubot --adapter slack\n ---> Running in 2d797a7465fd\n ---> c64050988afd\nRemoving intermediate container 2d797a7465fd\nSuccessfully built c64050988afd\n\n\u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u78ba\u8a8d\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nbot-base            latest              c64050988afd        18 minutes ago      698.8 MB\ndocker.io/node      latest              2c06219661ed        8 days ago          644.2 MB\n\n\n\u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u524a\u9664\u4f8b\n$ docker rmi bot-base:latest\nUntagged: bot-base:latest\nDeleted: c64050988afde89c14b937c6c1382a984b1a676e10b0a96bb1566a98ba23621e\nDeleted: ef4964132a7f637a3862086cc64ffce53a5acd0d6a459d9a338e24ce98de96b7\nDeleted: e7cec4828b1aa52b9840fe8cf099ee43d36ed802c68936c113ecc822a0882715\nDeleted: cf0c4e3fff369b137cf68839abdc2869266cb846a9bbc247e4b517c667936d9e\nDeleted: 5a6f64bcca492dc861035ed78cb3e8916a3e584832fdd0874f2482cc637a54b4\nDeleted: f3f7ed898049035d93d38b951e012644abe8463b72efca2409aea8769c03cf26\nDeleted: fa599f410d58049a73f9ea39e86fda7c50deb5b386d98be286f21ff0effeb225\n\n\u53c8\u306f docker rmi c64050988afd \u3067\u3082\u53ef\n\n\u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u3059\u308b\n$ docker run -itd -v /etc/localtime:/etc/localtime:ro -e \"HUBOT_SLACK_TOKEN=slack\u304b\u3089\u53d6\u5f97\u3057\u305ftoken\" --name \"\u4f5c\u6210\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u540d\" bot-base /bin/sh\n\n\nSlack \u3067\u8a71\u3057\u304b\u3051\u3066\u307f\u305f\n\n\u30d6\u30ed\u30b02\u3064\u3092\u7e8f\u3081\u305f\u8ee2\u8f09\n\n* [CentOS 7.2 \u3067 Docker \u59cb\u3081\u307e\u3059](http://1bed.saloon.jp/?p=1912)\n* [CentOS 7 \u3067 Hubot on Docker \u3092\u3084\u3063\u3066\u307f\u305f\u30e1\u30e2](http://1bed.saloon.jp/?p=1961)\n\n---\n\n\u65b0\u3057\u304f\u5951\u7d04\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u306b CentOS 7.2 \u3092\u5165\u308c\u305f\u306e\u3067\u3001Docker \u5165\u308c\u3066 Hubot \u3092\u8a66\u3057\u3066\u307f\u305f\n\u591a\u304f\u306e\u4eba\u304c\u3084\u3063\u3066\u63b2\u8f09\u3057\u3066\u308b\u3051\u3069\u3001\u81ea\u5206\u306e\u30e1\u30e2\u3068\u3057\u3066\u66f8\u304f\n\n## Docker \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u304c\u3001CentOS 7.x \u304b\u3089\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u306e\u3067 yum \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u53ef\u80fd\n\n```\n$ sudo yum install doker\n$ sudo systemctl start docker\n$ sudo systemctl enable docker\nCreated symlink from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.\n```\n\n## \u4e00\u822c\u30e6\u30fc\u30b6\u30fc\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\n\n\u6b21\u306b\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u30fc(miyamiya)\u304c docker \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\n\n```\n$ sudo groupadd docker\n$ sudo gpasswd -a miyamiya docker\nAdding user miyamiya to group docker\n$ sudo systemctl restart docker\n```\n\n\u4e00\u65e6\u3053\u3053\u3067\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u3001\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u307e\u3057\u305f\n\n\u3061\u306a\u307f\u306b\u3053\u306e\u624b\u9806\u3092\u53d6\u3089\u306a\u3044\u3067\u4e00\u822c\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306b\u30a8\u30e9\u30fc\u3068\u306a\u308b\n\n```\n$ docker pull node\nUsing default tag: latest\nPost http:///var/run/docker.sock/v1.20/images/create?fromImage=node%3Alatest: dial unix /var/run/docker.sock: permission denied.\n* Are you trying to connect to a TLS-enabled daemon without TLS?\n* Is your docker daemon up and running?\n```\n\n## Slack \u30c1\u30fc\u30e0\u306e\u4f5c\u6210\u3068 API Token \u306e\u53d6\u5f97\n\n\u304b\u3001\u304b\u3001\u5272\u611b... (\u30e1\u30e2\u3063\u3066\u306a\u3044\uff57\n\n\n## node.js \u306e\u74b0\u5883\u3092\u6e96\u5099\n\nHubot \u306f node.js \u3067\u52d5\u4f5c\u3059\u308b\u306e\u3067\u3001node.js \u306e\u74b0\u5883\u3092\u6e96\u5099\u3059\u308b\nnode.js \u516c\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u5229\u7528\u3059\u308b\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n\n```\n$ docker pull node\n```\n\n\u78ba\u8a8d\n\n```\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\ndocker.io/node      latest              2c06219661ed        8 days ago          644.2 MB\n```\n\n## \u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\n```\n$ docker run --rm -it -v /etc/localtime:/etc/localtime:ro --name \"bot-base\" node /bin/sh\n```\n\n### \u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8aac\u660e\n\n* \\-\\-name \"bot-base\"  \n  \u30b3\u30f3\u30c6\u30ca\u540d\u306f bot-base\n* node  \n  \u4f7f\u3046\u30a4\u30e1\u30fc\u30b8\u306f node.js  \n* -v /etc/localtime:/etc/localtime:ro\n  localetime \u306f\u30db\u30b9\u30c8\u3068 Readonly \u3067\u5171\u6709\u3059\u308b(\u65e5\u672c\u306e\u6642\u9593\u306b\u3059\u308b)\n* -it , /bin/sh  \n  \u8d77\u52d5\u5f8c\u30b7\u30a7\u30eb\u306b\u5165\u308b\n* \\-\\-rm  \n  \u843d\u3068\u3057\u305f\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b\n\n### \u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u5f8c\n\n* Ctrl+p, Ctrl+q \u3067\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u629c\u3051\u308b\n* exit \u3067\u629c\u3051\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u306f\u524a\u9664\u3055\u308c\u308b(\\-\\-rm \u3092\u3064\u3051\u3066\u3044\u308b\u305f\u3081)\n\n\n### \\-\\-rm \u3092\u3064\u3051\u305a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u624b\u52d5\u3067\u524a\u9664\u3059\u308b\u3068\u304d\n\n\u8d77\u52d5\u4e2d\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\n\n```\n$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n2f12ee8929bb        bot-base            \"/bin/sh\"                  5 days ago          Up 5 days                               bot-base\n```\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u505c\u6b62\n\n```\n$ docker stop bot-base\nbot-base\n```\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u524a\u9664\n\n```\n$ docker rm bot-base\nbot-base\n```\n\n## Hubot \u3092\u52d5\u304b\u305b\u308b\u307e\u3067\u3072\u305f\u3059\u3089\u9811\u5f35\u308b\n\n\u6b21\u306e\u4e8b\u304c\u3067\u304d\u308b\u307e\u3067\u3001\u8a66\u3057\u3066\u307f\u3066\u30e1\u30e2\u3063\u3066\u3001\u307e\u305f\u30b3\u30f3\u30c6\u30ca\u6700\u521d\u304b\u3089\u3084\u3063\u3066\u307f\u3066\u3092\u7e70\u308a\u8fd4\u3057\u305f\n\n* Hubot Generator \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* Hubot \u3092\u4f5c\u6210\n* Hubot \u3092\u8d77\u52d5\n\n\u3053\u308c\u3092\u5143\u306b\u3057\u3066 Dockerfile \u3092\u4f5c\u3063\u305f\n\n```bash:Dockerfile\nFROM node\nMAINTAINER miyamiya\n\nRUN npm install -g yo generator-hubot\nRUN npm list -g yo generator-hubot\nRUN useradd bot\nRUN mkdir /home/bot && chown bot.bot /home/bot\n\nUSER bot\nWORKDIR /home/bot\nRUN  yo hubot --owner \"miyamiya\" --name \"bot\" --description \"Hubot image\" --adapter slack\n\nCMD cd /home/bot/hubot; bin/hubot --adapter slack\n```\n\n## Hubot \u7528\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\n\n```\n$ docker build -t bot-base .\nSending build context to Docker daemon 4.096 kB\nStep 1 : FROM node\n ---> 2c06219661ed\nStep 2 : MAINTAINER miyamiya\n ---> Using cache\n ---> 6cd0fb4b3b24\nStep 3 : RUN npm install -g yo generator-hubot\n ---> Using cache\n ---> 86f522f924ca\n  \uff1a\n\uff08\u7701\u7565\uff09\n  \uff1a\nnpm info ok \n ---> ef4964132a7f\nRemoving intermediate container 2464b01dd061\nStep 10 : CMD bin/hubot --adapter slack\n ---> Running in 2d797a7465fd\n ---> c64050988afd\nRemoving intermediate container 2d797a7465fd\nSuccessfully built c64050988afd\n```\n\n\u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u78ba\u8a8d\n\n```\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nbot-base            latest              c64050988afd        18 minutes ago      698.8 MB\ndocker.io/node      latest              2c06219661ed        8 days ago          644.2 MB\n```\n\n### \u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u524a\u9664\u4f8b\n\n```\n$ docker rmi bot-base:latest\nUntagged: bot-base:latest\nDeleted: c64050988afde89c14b937c6c1382a984b1a676e10b0a96bb1566a98ba23621e\nDeleted: ef4964132a7f637a3862086cc64ffce53a5acd0d6a459d9a338e24ce98de96b7\nDeleted: e7cec4828b1aa52b9840fe8cf099ee43d36ed802c68936c113ecc822a0882715\nDeleted: cf0c4e3fff369b137cf68839abdc2869266cb846a9bbc247e4b517c667936d9e\nDeleted: 5a6f64bcca492dc861035ed78cb3e8916a3e584832fdd0874f2482cc637a54b4\nDeleted: f3f7ed898049035d93d38b951e012644abe8463b72efca2409aea8769c03cf26\nDeleted: fa599f410d58049a73f9ea39e86fda7c50deb5b386d98be286f21ff0effeb225\n```\n\n\u53c8\u306f ```docker rmi c64050988afd``` \u3067\u3082\u53ef\n\n## \u4f5c\u3063\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u3059\u308b\n\n```\n$ docker run -itd -v /etc/localtime:/etc/localtime:ro -e \"HUBOT_SLACK_TOKEN=slack\u304b\u3089\u53d6\u5f97\u3057\u305ftoken\" --name \"\u4f5c\u6210\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u540d\" bot-base /bin/sh\n```\n\n### Slack \u3067\u8a71\u3057\u304b\u3051\u3066\u307f\u305f\n\n<img width=\"283\" alt=\"hubot_example.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/118961/7da4d734-0b68-b95b-891b-1d7df6d22183.png\">\n", "tags": ["CentOS", "Hubot", "docker"]}