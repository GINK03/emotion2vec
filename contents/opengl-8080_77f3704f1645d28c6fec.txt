{"context": " More than 1 year has passed since last update.GitHub \u30b5\u30f3\u30d7\u30eb\nCordova \u306e\u4e0a\u3067 jQuery Mobile \u3068 RequireJS \u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u3048\u308b\u304b\u8a66\u3057\u305f\u3002\n\u4e00\u5fdc\u52d5\u3044\u305f\uff08\u305f\u3060\u3057\u78ba\u8a8d\u3057\u305f\u306e\u306f Android \u3060\u3051\uff09\u3002\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u3068\u3053\u308d\u7279\u306b\u529b\u5165\u308c\u305f\u3002\n\nindex.html\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"format-detection\" content=\"telephone=no\" />\n    <meta name=\"msapplication-tap-highlight\" content=\"no\" />\n    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->\n    <meta name=\"viewport\" content=\"user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"css/jquery.mobile.min.css\" />\n    <title>Hello World</title>\n  </head>\n  <body>\n    <div data-role=\"page\">\n      <div data-role=\"header\">\n        <h1>header</h1>\n      </div>\n      <div role=\"main\">\n        <p id=\"console\">\n        </p>\n      </div>\n    </div>\n\n    <script type=\"text/javascript\" src=\"cordova.js\"></script>\n    <script type=\"text/javascript\" src=\"js/lib/require.js\" data-main=\"js/index\"></script>\n  </body>\n</html>\n\n\n\u666e\u901a\u306b require.js \u3092\u8aad\u307f\u8fbc\u3093\u3067\u3001 data-main \u306b index.js \u3092\u6307\u5b9a\u3002\n\nindex.js\nrequirejs.config({\n    paths: {\n        'jquery': 'lib/jquery.min',\n        'jquery-mobile': 'lib/jquery.mobile.min'\n    }\n});\n\nrequire(['root', 'database', 'jquery-mobile'], function(root) {\n    root.deviceready(function() {\n        root.log('Hello Cordova with RequireJS!!');\n\n        root.db.readTransaction(function(tx) {\n            root.deferredTransaction(tx)\n                .first('SELECT * FROM SAMPLE_TABLE')\n                .done(function(exec, result) {\n                    for (var i=0; i<result.rows.length; i++) {\n                        var row = result.rows.item(i);\n                        root.log('[database rows] id=' + row.ID + ', message=' + row.MESSAGE);\n                    }\n                });\n        });\n    });\n});\n\n\n\u5148\u982d\u3067 jQuery \u3068 jQuery Mobile \u306e\u30d1\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3001\nrequire() \u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u521d\u671f\u5316\u3092\u3057\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\uff08database\uff09\u3068 jquery-mobile \u3092\u4f9d\u5b58\u5bfe\u8c61\u3068\u3057\u3066\u5b9a\u7fa9\u3002\n\nroot.js\ndefine(['jquery'], function($) {\n    return {\n        log: function(message) {\n            // weinre console is not work!!\n            $('#console').append(message + '<br>');\n            // console.log(message);\n        },\n\n        deviceready: function(callback) {\n            var root = this;\n            document.addEventListener('deviceready', function() {\n                try {\n                    callback();\n                } catch (e) {\n                    root.log('error : ' + e);\n                }\n            });\n        },\n\n        deferredTransaction: function(transaction) {\n            var root = this;\n            exec.first = executeSql;\n\n            return exec;\n\n            function exec(sql, params) {\n                return function(exec, result) {\n                    return exec.first(sql, params);\n                };\n            }\n\n            function executeSql(sql, params) {\n                var d = new $.Deferred();\n\n                root.log('execute sql : ' + sql + ', params=' + params);\n\n                transaction.executeSql(\n                    sql,\n                    params || [],\n                    function(tx, result) {\n                        d.resolve(root.deferredTransaction(tx), result);\n                    },\n                    function(tx, result) {\n                        d.reject(root.deferredTransaction(tx), result);\n                    }\n                );\n\n                return d.promise();\n            }\n        }\n    };\n});\n\n\nroot \u306f\u3001\u5171\u901a\u51e6\u7406\u3068\u304b\u3092\u307e\u3068\u3081\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5b9a\u7fa9\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3002\n\u6a19\u6e96\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 API \u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5730\u7344\u5fc5\u81f3\u306a\u306e\u3067\u3001 jQuery \u306e Deferred \u3092\u4f7f\u3063\u3066\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u9811\u5f35\u3063\u305f\uff08deferredTransaction()\uff09\u3002\n\ndatabase.js\ndefine(['root', 'jquery'], function(root, $) {\n    root.deviceready(function() {\n        root.log('initializing database...');\n\n        root.db = openDatabase('sampledb', '', 'Sample Database', 1024 * 1024 * 10);\n\n        root.db.transaction(\n            function(tx) {\n                var exec = root.deferredTransaction(tx);\n\n                exec.first('DROP TABLE IF EXISTS SAMPLE_TABLE')\n                    .then(exec('CREATE TABLE SAMPLE_TABLE (ID INTEGER PRIMARY KEY, MESSAGE)'))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Hoge']))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Fuga']))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Piyo']))\n                    .then(exec('SELECT * FROM SAMPLE_TABLE'))\n                    .then(function(exec, result) {\n                        root.log('count=' + result.rows.length);\n                        return exec.first('DELETE FROM SAMPLE_TABLE WHERE MESSAGE=?', ['Fuga']);\n                    })\n                    .done(function() {\n                        root.log('success to initialize database');\n                    })\n                    .fail(function(exec, result) {\n                        root.log('fail to initialize database : ' + JSON.stringify(result));\n                    });\n            },\n            function(error) {\n                root.log('fail to initialize database');\n            });\n\n    });\n});\n\n\n\u753b\u9762\u306e\u69d8\u5b50\n\n\u7d50\u8ad6\uff1a Deferred \u3063\u3066\u7d20\u6674\u3089\u3057\u3044\u3002\n[GitHub \u30b5\u30f3\u30d7\u30eb](https://github.com/opengl-8080/cordova_requirejs)\n\nCordova \u306e\u4e0a\u3067 jQuery Mobile \u3068 RequireJS \u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u3048\u308b\u304b\u8a66\u3057\u305f\u3002\n\u4e00\u5fdc\u52d5\u3044\u305f\uff08\u305f\u3060\u3057\u78ba\u8a8d\u3057\u305f\u306e\u306f Android \u3060\u3051\uff09\u3002\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u3068\u3053\u308d\u7279\u306b\u529b\u5165\u308c\u305f\u3002\n\n```html:index.html\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"format-detection\" content=\"telephone=no\" />\n    <meta name=\"msapplication-tap-highlight\" content=\"no\" />\n    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->\n    <meta name=\"viewport\" content=\"user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi\" />\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"css/jquery.mobile.min.css\" />\n    <title>Hello World</title>\n  </head>\n  <body>\n    <div data-role=\"page\">\n      <div data-role=\"header\">\n        <h1>header</h1>\n      </div>\n      <div role=\"main\">\n        <p id=\"console\">\n        </p>\n      </div>\n    </div>\n\n    <script type=\"text/javascript\" src=\"cordova.js\"></script>\n    <script type=\"text/javascript\" src=\"js/lib/require.js\" data-main=\"js/index\"></script>\n  </body>\n</html>\n```\n\n\u666e\u901a\u306b `require.js` \u3092\u8aad\u307f\u8fbc\u3093\u3067\u3001 `data-main` \u306b `index.js` \u3092\u6307\u5b9a\u3002\n\n```js:index.js\nrequirejs.config({\n    paths: {\n        'jquery': 'lib/jquery.min',\n        'jquery-mobile': 'lib/jquery.mobile.min'\n    }\n});\n\nrequire(['root', 'database', 'jquery-mobile'], function(root) {\n    root.deviceready(function() {\n        root.log('Hello Cordova with RequireJS!!');\n\n        root.db.readTransaction(function(tx) {\n            root.deferredTransaction(tx)\n                .first('SELECT * FROM SAMPLE_TABLE')\n                .done(function(exec, result) {\n                    for (var i=0; i<result.rows.length; i++) {\n                        var row = result.rows.item(i);\n                        root.log('[database rows] id=' + row.ID + ', message=' + row.MESSAGE);\n                    }\n                });\n        });\n    });\n});\n```\n\n\u5148\u982d\u3067 `jQuery` \u3068 `jQuery Mobile` \u306e\u30d1\u30b9\u3092\u5b9a\u7fa9\u3057\u3066\u3001\n`require()` \u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u521d\u671f\u5316\u3092\u3057\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\uff08`database`\uff09\u3068 `jquery-mobile` \u3092\u4f9d\u5b58\u5bfe\u8c61\u3068\u3057\u3066\u5b9a\u7fa9\u3002\n\n```js:root.js\ndefine(['jquery'], function($) {\n    return {\n        log: function(message) {\n            // weinre console is not work!!\n            $('#console').append(message + '<br>');\n            // console.log(message);\n        },\n\n        deviceready: function(callback) {\n            var root = this;\n            document.addEventListener('deviceready', function() {\n                try {\n                    callback();\n                } catch (e) {\n                    root.log('error : ' + e);\n                }\n            });\n        },\n\n        deferredTransaction: function(transaction) {\n            var root = this;\n            exec.first = executeSql;\n\n            return exec;\n\n            function exec(sql, params) {\n                return function(exec, result) {\n                    return exec.first(sql, params);\n                };\n            }\n\n            function executeSql(sql, params) {\n                var d = new $.Deferred();\n\n                root.log('execute sql : ' + sql + ', params=' + params);\n\n                transaction.executeSql(\n                    sql,\n                    params || [],\n                    function(tx, result) {\n                        d.resolve(root.deferredTransaction(tx), result);\n                    },\n                    function(tx, result) {\n                        d.reject(root.deferredTransaction(tx), result);\n                    }\n                );\n\n                return d.promise();\n            }\n        }\n    };\n});\n```\n\n`root` \u306f\u3001\u5171\u901a\u51e6\u7406\u3068\u304b\u3092\u307e\u3068\u3081\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u5b9a\u7fa9\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3002\n\n\u6a19\u6e96\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 API \u306f\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5730\u7344\u5fc5\u81f3\u306a\u306e\u3067\u3001 jQuery \u306e Deferred \u3092\u4f7f\u3063\u3066\u30b7\u30f3\u30d7\u30eb\u306b\u66f8\u3051\u308b\u3088\u3046\u306b\u9811\u5f35\u3063\u305f\uff08`deferredTransaction()`\uff09\u3002\n\n```js:database.js\ndefine(['root', 'jquery'], function(root, $) {\n    root.deviceready(function() {\n        root.log('initializing database...');\n\n        root.db = openDatabase('sampledb', '', 'Sample Database', 1024 * 1024 * 10);\n\n        root.db.transaction(\n            function(tx) {\n                var exec = root.deferredTransaction(tx);\n\n                exec.first('DROP TABLE IF EXISTS SAMPLE_TABLE')\n                    .then(exec('CREATE TABLE SAMPLE_TABLE (ID INTEGER PRIMARY KEY, MESSAGE)'))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Hoge']))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Fuga']))\n                    .then(exec('INSERT INTO SAMPLE_TABLE (MESSAGE) VALUES (?)', ['Piyo']))\n                    .then(exec('SELECT * FROM SAMPLE_TABLE'))\n                    .then(function(exec, result) {\n                        root.log('count=' + result.rows.length);\n                        return exec.first('DELETE FROM SAMPLE_TABLE WHERE MESSAGE=?', ['Fuga']);\n                    })\n                    .done(function() {\n                        root.log('success to initialize database');\n                    })\n                    .fail(function(exec, result) {\n                        root.log('fail to initialize database : ' + JSON.stringify(result));\n                    });\n            },\n            function(error) {\n                root.log('fail to initialize database');\n            });\n\n    });\n});\n```\n\n**\u753b\u9762\u306e\u69d8\u5b50**\n\n![cordova_requirejs.png](https://qiita-image-store.s3.amazonaws.com/0/28302/1c89ae0d-64f0-70e7-13f2-7a1e1fcf348c.png)\n\n\n\n\u7d50\u8ad6\uff1a **Deferred \u3063\u3066\u7d20\u6674\u3089\u3057\u3044\u3002**\n", "tags": ["Cordova", "PhoneGap", "jQuery", "jQueryMobile", "RequireJS"]}