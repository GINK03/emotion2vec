{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nhivemall\u3068\u306f\u3001Hive\u306e\u30af\u30a8\u30ea\u3067\u6a5f\u68b0\u5b66\u7fd2\u304c\u884c\u3048\u308b\u7d71\u8a08\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u7523\u7dcf\u7814\u306e\u6cb9\u4e95\u3055\u3093\u304c\u958b\u767a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nTreasureData\u306eRelease Note 20140617\u306b\u3053\u3063\u305d\u308a\u3068\u3001\"Backend: Hivemall Library v0.2 Upgraded the Hivemall Library to version v0.2. Its capabilities are immediately available to all users querying using the Hive engine.\"\n\u3068\u66f8\u304b\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306f\u53c2\u8003\u8cc7\u6599\u306e1.\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u51e6\u7406\u306e\u6d41\u308c\u3092\u306a\u308b\u3079\u304f\u305d\u306e\u307e\u307eTreasureData\u4e0a\u306e\u51e6\u7406\u306b\u7f6e\u304d\u63db\u3048\u3066\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u3057\u3066\u3001KDD Cup 2012, Track 2\u306eCTR\u63a8\u5b9a\u30bf\u30b9\u30af\u7528\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001\u4e2d\u56fd\u306e3\u5927\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u4e00\u3064soso.com\u306e\u5b9f\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u30c7\u30fc\u30bf\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\u30b5\u30a4\u30c8\u306eDownload\u304b\u3089\u3001track2.zip\u3068test.zip\u3068KDD_Track2_solution.csv\n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n\u53c2\u8003\u8cc7\u6599\n\nHive/Hivemall\u3092\u5229\u7528\u3057\u305f\u5e83\u544a\u30af\u30ea\u30c3\u30af\u30b9\u30eb\u30fc\u7387(CTR)\u306e\u63a8\u5b9a\n\u30de\u30e1\u7814\u30a4\u30f3\u30bf\u30d3\u30e5\u30fc\u30b7\u30ea\u30fc\u30ba\u7b2c1\u56de\uff5e\u7523\u696d\u6280\u8853\u7dcf\u5408\u7814\u7a76\u6240\u3000\u6cb9\u4e95\u8aa0\u7814\u7a76\u54e1\uff1a\u30de\u30fc\u30b1\u30bf\u30fc\u3082\u30af\u30a8\u30ea\u8a00\u8a9e\u3092\u3084\u308a\u307e\u3057\u3087\u3046\uff01\uff5e\nHivemall: Hive scalable machine learning library\n\n\n\n\u30c7\u30fc\u30bf\u306e\u6e96\u5099\nBulkImport\u3092\u4f7f\u3063\u3066\u5404\u30ec\u30b3\u30fc\u30c9\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306e\u30b9\u30ad\u30fc\u30de\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u306e\u30b9\u30ad\u30fc\u30de\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u306f\u3001rowid\u306f\u30c7\u30fc\u30bf\u5185\u306b\u306f\u5165\u3063\u3066\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6642\u70b9\u3067\u306f\u7701\u7565\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u30ab\u30e9\u30e0\u540d\u306b\u306f\u3001\u5927\u6587\u5b57\u304c\u4f7f\u3048\u306a\u3044\u3002time\u3092\u6563\u3051\u3066\u4ed8\u4e0e\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u51e6\u7406\u52b9\u7387\u306e\u305f\u3081\u306b\u91cd\u8981\u3067\u3042\u308b\u3053\u3068\u3067\u3059\u3002\n$ td db:create t_hivemall\n\n$ td table:create t_hivemall training\n\n$ td import:upload training.txt --auto-create t_hivemall.training --format tsv --columns clicks,impression,displayurl,adid,advertiserid,depth,position,queryid,keywordid,titleid,descriptionid,userid --column-types int,int,string,int,int,int,int,int,int,int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\ntd table:create t_hivemall user\n\ntd import:upload userid_profile.txt --auto-create t_hivemall.user --format tsv --columns userid,gender,age --column-types int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\ntd table:create t_hivemall query\n\ntd import:upload queryid_tokensid.txt --auto-create t_hivemall.query --format tsv --columns queryid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\ntd table:create t_hivemall keyword\n\ntd import:upload purchasedkeywordid_tokensid.txt --auto-create t_hivemall.keyword --format tsv --columns keywordid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\ntd table:create t_hivemall title\ntd import:upload titleid_tokensid.txt --auto-create t_hivemall.title --format tsv --columns titleid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\ntd table:create t_hivemall description\n\ntd import:upload descriptionid_tokensid.txt --auto-create t_hivemall.description --format tsv --columns descriptionid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\n\nsolution.sh\ntd table:create t_hivemall solution\n\ntd import:upload KDD_Track2_solution.csv --auto-create t_hivemall.solution --format csv --columns clicks,impressions,private --column-types int,int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\n\ntd table:create t_hivemall test\n\ntd import:upload test.txt --auto-create t_hivemall.test --format tsv --columns displayurl,adid,advertiserid,depth,position,queryid,keywordid,titleid,descriptionid,userid --column-types string,int,int,int,int,int,int,int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n\n\nRow_ID\u306e\u4ed8\u4e0e\nsolution, training, test\u306b\u3064\u3044\u3066\u306f\u3001row_id\u3092\u4ed8\u4e0e\u3059\u308b\u305f\u3081\u306bTD_X_RANK\u3092\u5229\u7528\u3059\u308b\u3002\n\nsolution.sql\nSELECT \n  TD_X_RANK(id) AS row_id,\nclicks,impressions,private,time\nFROM (\n    SELECT \n      '1' AS id,\nclicks,impressions,private,time\n    FROM\n      solution\n    ORDER BY\n      id\n  ) t\n\n\n\nHashing trick\u3068\u30d0\u30a4\u30a2\u30b9\u9805\n\nhashing.sql\nselect\n  row_id, time,\n  array(displayurl, adid, advertiserid, depth, position, queryid, keywordid, titleid, descriptionid, userid, gender, age, bias) \n    as features\nfrom (\nselect\n  row_id,time,\n  mhash(concat(\"1:\", displayurl)) as displayurl, \n  mhash(concat(\"2:\", adid)) as adid, \n  mhash(concat(\"3:\", advertiserid)) as advertiserid, \n  mhash(concat(\"4:\", depth)) as depth, \n  mhash(concat(\"5:\", position)) as position, \n  mhash(concat(\"6:\", queryid)) as queryid, \n  mhash(concat(\"7:\", keywordid)) as keywordid, \n  mhash(concat(\"8:\", titleid)) as titleid, \n  mhash(concat(\"9:\", descriptionid)) as descriptionid, \n  mhash(concat(\"10:\", userid)) as userid, \n  mhash(concat(\"11:\", COALESCE(gender,\"0\"))) as gender, \n  mhash(concat(\"12:\", COALESCE(age,\"-1\"))) as age, \n  -1 as bias\nfrom (\nselect\n  t.*,\n  u.gender,\n  u.age\nfrom \n  testing_row t \n  LEFT OUTER JOIN user u \n    on t.userid = u.userid\n) t1\n) t2\n\n\n*\u8a18\u4e8b\u81ea\u4f53\u306f\u3001hivemall\u306e\u51e6\u7406\u304c\u6b63\u3057\u304f\u3067\u304d\u6b21\u7b2c\u3001\u6574\u5f62\u3057\u3066\u5225\u306a\u30d6\u30ed\u30b0\u306b\u6295\u7a3f\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n# \u306f\u3058\u3081\u306b\nhivemall\u3068\u306f\u3001Hive\u306e\u30af\u30a8\u30ea\u3067\u6a5f\u68b0\u5b66\u7fd2\u304c\u884c\u3048\u308b\u7d71\u8a08\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\n\u7523\u7dcf\u7814\u306e\u6cb9\u4e95\u3055\u3093\u304c\u958b\u767a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nTreasureData\u306e[Release Note 20140617](http://docs.treasuredata.com/articles/releasenote-20140617)\u306b\u3053\u3063\u305d\u308a\u3068\u3001\"Backend: Hivemall Library v0.2 Upgraded the Hivemall Library to version v0.2. Its capabilities are immediately available to all users querying using the Hive engine.\"\n\u3068\u66f8\u304b\u308c\u3066\u3044\u305f\u306e\u3067\u3001\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u4eca\u56de\u306f\u53c2\u8003\u8cc7\u6599\u306e1.\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u51e6\u7406\u306e\u6d41\u308c\u3092\u306a\u308b\u3079\u304f\u305d\u306e\u307e\u307eTreasureData\u4e0a\u306e\u51e6\u7406\u306b\u7f6e\u304d\u63db\u3048\u3066\u5b9f\u65bd\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u3057\u3066\u3001[KDD Cup 2012, Track 2](http://www.kddcup2012.org/c/kddcup2012-track2)\u306eCTR\u63a8\u5b9a\u30bf\u30b9\u30af\u7528\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001\u4e2d\u56fd\u306e3\u5927\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u4e00\u3064soso.com\u306e\u5b9f\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u306e\u30c7\u30fc\u30bf\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\u30b5\u30a4\u30c8\u306eDownload\u304b\u3089\u3001track2.zip\u3068test.zip\u3068KDD_Track2_solution.csv\n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n# \u53c2\u8003\u8cc7\u6599\n1. [Hive/Hivemall\u3092\u5229\u7528\u3057\u305f\u5e83\u544a\u30af\u30ea\u30c3\u30af\u30b9\u30eb\u30fc\u7387(CTR)\u306e\u63a8\u5b9a](http://qiita.com/myui/items/f726ca3dcc48410abe45)\n2. [\u30de\u30e1\u7814\u30a4\u30f3\u30bf\u30d3\u30e5\u30fc\u30b7\u30ea\u30fc\u30ba\u7b2c1\u56de\uff5e\u7523\u696d\u6280\u8853\u7dcf\u5408\u7814\u7a76\u6240\u3000\u6cb9\u4e95\u8aa0\u7814\u7a76\u54e1\uff1a\u30de\u30fc\u30b1\u30bf\u30fc\u3082\u30af\u30a8\u30ea\u8a00\u8a9e\u3092\u3084\u308a\u307e\u3057\u3087\u3046\uff01\uff5e](http://www.mm-lab.jp/article/1219/)\n3. [Hivemall: Hive scalable machine learning library](https://github.com/myui/hivemall)\n4. \n\n# \u30c7\u30fc\u30bf\u306e\u6e96\u5099\n\nBulkImport\u3092\u4f7f\u3063\u3066\u5404\u30ec\u30b3\u30fc\u30c9\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u30c7\u30fc\u30bf\u306e\u30b9\u30ad\u30fc\u30de\u306b\u3064\u3044\u3066\u306f\u3001[\u3053\u3061\u3089](https://github.com/myui/hivemall/wiki/KDDCup-2012-track-2-CTR-prediction-dataset)\u306e\u30b9\u30ad\u30fc\u30de\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u306f\u3001rowid\u306f\u30c7\u30fc\u30bf\u5185\u306b\u306f\u5165\u3063\u3066\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6642\u70b9\u3067\u306f\u7701\u7565\u3057\u307e\u3059\u3002\u307e\u305f\u3001\u30ab\u30e9\u30e0\u540d\u306b\u306f\u3001\u5927\u6587\u5b57\u304c\u4f7f\u3048\u306a\u3044\u3002time\u3092\u6563\u3051\u3066\u4ed8\u4e0e\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u51e6\u7406\u52b9\u7387\u306e\u305f\u3081\u306b\u91cd\u8981\u3067\u3042\u308b\u3053\u3068\u3067\u3059\u3002\n\n```\n$ td db:create t_hivemall\n\n$ td table:create t_hivemall training\n\n$ td import:upload training.txt --auto-create t_hivemall.training --format tsv --columns clicks,impression,displayurl,adid,advertiserid,depth,position,queryid,keywordid,titleid,descriptionid,userid --column-types int,int,string,int,int,int,int,int,int,int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n```\ntd table:create t_hivemall user\n\ntd import:upload userid_profile.txt --auto-create t_hivemall.user --format tsv --columns userid,gender,age --column-types int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n\n```\ntd table:create t_hivemall query\n\ntd import:upload queryid_tokensid.txt --auto-create t_hivemall.query --format tsv --columns queryid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n```\ntd table:create t_hivemall keyword\n\ntd import:upload purchasedkeywordid_tokensid.txt --auto-create t_hivemall.keyword --format tsv --columns keywordid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n\n```\ntd table:create t_hivemall title\ntd import:upload titleid_tokensid.txt --auto-create t_hivemall.title --format tsv --columns titleid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n```\ntd table:create t_hivemall description\n\ntd import:upload descriptionid_tokensid.txt --auto-create t_hivemall.description --format tsv --columns descriptionid,tokens --column-types int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n``` sh:solution.sh\ntd table:create t_hivemall solution\n\ntd import:upload KDD_Track2_solution.csv --auto-create t_hivemall.solution --format csv --columns clicks,impressions,private --column-types int,int,string --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n```\ntd table:create t_hivemall test\n\ntd import:upload test.txt --auto-create t_hivemall.test --format tsv --columns displayurl,adid,advertiserid,depth,position,queryid,keywordid,titleid,descriptionid,userid --column-types string,int,int,int,int,int,int,int,int,int --time-value 0,24 -o pre/ --auto-perform --auto-commit --parallel 8 --prepare-parallel 8 --error-records-output err/\n```\n\n## Row_ID\u306e\u4ed8\u4e0e\nsolution, training, test\u306b\u3064\u3044\u3066\u306f\u3001row_id\u3092\u4ed8\u4e0e\u3059\u308b\u305f\u3081\u306bTD_X_RANK\u3092\u5229\u7528\u3059\u308b\u3002\n\n``` sql:solution.sql\nSELECT \n  TD_X_RANK(id) AS row_id,\nclicks,impressions,private,time\nFROM (\n    SELECT \n      '1' AS id,\nclicks,impressions,private,time\n    FROM\n      solution\n    ORDER BY\n      id\n  ) t\n```\n\n# Hashing trick\u3068\u30d0\u30a4\u30a2\u30b9\u9805\n\n\n\n``` sql:hashing.sql\nselect\n  row_id, time,\n  array(displayurl, adid, advertiserid, depth, position, queryid, keywordid, titleid, descriptionid, userid, gender, age, bias) \n    as features\nfrom (\nselect\n  row_id,time,\n  mhash(concat(\"1:\", displayurl)) as displayurl, \n  mhash(concat(\"2:\", adid)) as adid, \n  mhash(concat(\"3:\", advertiserid)) as advertiserid, \n  mhash(concat(\"4:\", depth)) as depth, \n  mhash(concat(\"5:\", position)) as position, \n  mhash(concat(\"6:\", queryid)) as queryid, \n  mhash(concat(\"7:\", keywordid)) as keywordid, \n  mhash(concat(\"8:\", titleid)) as titleid, \n  mhash(concat(\"9:\", descriptionid)) as descriptionid, \n  mhash(concat(\"10:\", userid)) as userid, \n  mhash(concat(\"11:\", COALESCE(gender,\"0\"))) as gender, \n  mhash(concat(\"12:\", COALESCE(age,\"-1\"))) as age, \n  -1 as bias\nfrom (\nselect\n  t.*,\n  u.gender,\n  u.age\nfrom \n  testing_row t \n  LEFT OUTER JOIN user u \n    on t.userid = u.userid\n) t1\n) t2\n```\n\n\n*\u8a18\u4e8b\u81ea\u4f53\u306f\u3001hivemall\u306e\u51e6\u7406\u304c\u6b63\u3057\u304f\u3067\u304d\u6b21\u7b2c\u3001\u6574\u5f62\u3057\u3066\u5225\u306a\u30d6\u30ed\u30b0\u306b\u6295\u7a3f\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n", "tags": ["TreasureData"]}