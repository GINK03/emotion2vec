{"context": "\u5b8c\u5168\u306b\u81ea\u5206\u7528\u306b\u307e\u3068\u3081\u305f\u306e\u3067\u3059\u304c\u3001\u521d\u5fc3\u8005\u306b\u306f\u76f2\u70b9\u306b\u306a\u308a\u305d\u3046\u306a\u3068\u3053\u308d\u304c\u591a\u304f\u3082\u3057\u304b\u3057\u305f\u3089\u5f79\u7acb\u3064\u304b\u3082\u3057\u308c\u306a\u3044\u306a\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u516c\u958b\u3002\u4fee\u6b63\u30fb\u30a2\u30c9\u30d0\u30a4\u30b9\u7b49\u3042\u308c\u3070\u30b3\u30e1\u30f3\u30c8\u304f\u3060\u3055\u3044\u3002\n\u4e3b\u306b\u306f\u3001\u300e\u305f\u306e\u3057\u3044Ruby\u300f\u3068\u300eRuby on Rails4 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u300f\u306e\u307e\u3068\u3081\u3067\u3059\u3002\n\n\u305f\u306e\u3057\u3044Ruby\n\nrequire\nrequire\u306f\u4f7f\u3044\u305f\u3044\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u3002\n\u4f8b\uff1a\"uri\"\n\u30e1\u30e2\uff1a\u4ee5\u4e0b\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306einclude\u306a\u3069\u304c\u30af\u30e9\u30b9\u306b\u5bfe\u3059\u308b\u3082\u306e\u3060\u3068\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3059\u308binclude\u307f\u305f\u3044\u306a\u3082\u306e\u304b\u306a\uff1f\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\n\n\u30af\u30e9\u30b9\u3068\u306e\u9055\u3044\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30e1\u30bd\u30c3\u30c9\u3092\u63d0\u4f9b\u3057\u3001\u30af\u30e9\u30b9\u306b\u4f3c\u3066\u3044\u308b\u304c\u4ee5\u4e0b\u306e\u70b9\u3067\u9055\u3046\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3067\u304d\u306a\u3044\n\u7d99\u627f\u3067\u304d\u306a\u3044\n\n\ninclude\u3068extend\n\u57fa\u672c\u7684\u306b\u306fRails\u306e\u30d8\u30eb\u30da\u30fc\u307f\u305f\u3044\u306b\u3069\u3053\u3067\u3082\uff08\uff1f\uff09\u547c\u3073\u51fa\u305b\u308b\nmodule Test\n    def explain(name)\n        p \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n    end\nend\n\nTest::explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n\ninclude\u3059\u308b\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\nmodule Test\n    def explain(name)\n        p \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n    end\nend\n\nclass MyClass\ninclude Test\n\nend\n\ntest = MyClass.new\ntest.explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n\nextend\u3059\u308b\u3068\u3001\u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\n\nmodule Test\n    def explain(name)\n        p \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n    end\nend\n\nclass MyClass\nextend Test\n\nend\n\nMyClass.explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n\n\n\u4f8b\u5916\u51e6\u7406\n\n\u57fa\u672c\u7cfb\nbegin\n    # \u901a\u5e38\u306e\u51e6\u7406\n    raise \"\u30e1\u30c3\u30bb\u30fc\u30b8\" # RuntimeError\u304c\u767a\u751f\n    raise \u4f8b\u5916\u30af\u30e9\u30b9 # \u6307\u5b9a\u3057\u305f\u4f8b\u5916\u306e\u767a\u751f\n    raise \u4f8b\u5916\u30af\u30e9\u30b9, \"\u30e1\u30c3\u30bb\u30fc\u30b8\" #\u6307\u5b9a\u3057\u305f\u4f8b\u5916\u3092\u767a\u751f\u3055\u305b\u3001\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30bb\u30c3\u30c8\n    raise # RuntimeError\nrescue\n    # error\u51e6\u7406\n    # $\u3067\u4f8b\u5916\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\n    # $! => \u6700\u5f8c\u306b\u767a\u751f\u3057\u305f\u4f8b\u5916 $@ => \u6700\u5f8c\u306b\u767a\u751f\u3057\u305f\u4f8b\u5916\u306e\u4f4d\u7f6e\u306b\u95a2\u3059\u308b\u60c5\u5831\n    raise # $!\u3092\u3082\u3046\u4e00\u5ea6\u767a\u751f\u3055\u305b\u308b\nensure\n    # \u4f8b\u5916\u306e\u6709\u7121\u306b\u304b\u304b\u308f\u3089\u305a\u5b9f\u884c\u3055\u308c\u308b\u51e6\u7406\nend\n\n\n\u4f8b\u5916\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n\n\u547c\u3073\u51fa\u305b\u308b\u30e1\u30bd\u30c3\u30c9\n\nclass : \u4f8b\u5916\u306e\u7a2e\u985e\nmessage : \u4f8b\u5916\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\nbacktrace : \u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u4f4d\u7f6e\u306b\u95a2\u3059\u308b\u60c5\u5831\n\n\n\u30d6\u30ed\u30c3\u30af\ndef total(from, to)\n    result = 0\n    from.upto(to) do |num|\n        if block_given?          # \u30d6\u30ed\u30c3\u30af\u304c\u6e21\u3055\u308c\u3066\u3044\u305f\u3089\n            result += yield(num) # num\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3055\u308c\u305f\u30d6\u30ed\u30c3\u30af\u3092\u5b9f\u884c\n        else\n            result += num\n        end \n    end\n    return result\nend\n\np total(1, 10)                    # 1\u304b\u308910\u306e\u548c => 55\np total(1, 10) { |num| num ** 2 } # 1\u304b\u308910\u306e2\u4e57\u306e\u5024\u306e\u548c => 385\n\n\n\u30d6\u30ed\u30c3\u30af\u306e\u4e2d\u3067break\u3092\u547c\u3073\u3068\u3001nil\u306b\u306a\u308b\u3002break 0\u306a\u3069\u5024\u3092\u6e21\u3059\u3068\u623b\u308a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n\u3042\u3068\u306f\u8f9e\u66f8\u7684\u306b\u4f7f\u304a\u3046\u7b11\n\nRails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u306e\u5b66\u3073\u307e\u3068\u3081\n\nView\n\ndebug\u3092\u4f7f\u304a\u3046\ndebug(@items)\u3068\u3044\u3063\u305f\u5f62\u3067\u3001\u5909\u6570\u306e\u4e2d\u8eab\u3092view\u306b\u8868\u793a\u3067\u304d\u308b\u3002\n\n\u7c21\u5358\u306a\u90e8\u5206\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306ecapture\n- @current = capture do\n    = \"\u305f\u3060\u3044\u307e\u306e\u6642\u523b\u306f#{Time.now}\u3067\u3059\u3002\"\n\n= @current\ndiv.container = @current\n\n\nModel\n\nValidation\n\u3053\u3046\u3084\u308b\u3068\u7dba\u9e97\u306b\u304b\u3051\u308b\u306e\u304b\nclass Book < ActiveRecord::Base\n    validates :isbn,\n        presence:   true,\n        uniqueness: true,\n        length:     { is: 17 },\n        format:     { with: /\u00a5a[0-9]/ }\n    validates :title\n        # ...(\u7701\u7565\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u95a2\u9023\u3065\u304b\u306a\u3044\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3059\u308b\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u306e\u5165\u529b\u3092\u691c\u8a3c\u3057\u305f\u3044\u6642\u306a\u3069\n# app/models/search_keyword.rb\nclass SearchKeyword\n    include ActiveModel::Model\n\n    attr_accessor :keyword\n\n    validates :keyword, presene: true\nend\n\n# record_controller\n\ndef keywd\n    @search = SearchKeyword.new\nend\n\ndef keywd_process\n    @search = SearchKeyword.new(params[:search_keyword])\n    if @search.valid? # \u3053\u3053\u3067\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u547c\u3073\u51fa\u3059\u3002\n        render text: @search.keyword\n    end\nend\n\n\n\n\n\nController\n\n\u57fa\u672c\u8a8d\u8a3c\uff1a\u7c21\u6613\u306a\u30ed\u30b0\u30a4\u30f3\u5b9f\u88c5\n\u3072\u3068\u307e\u305a\u7ba1\u7406\u8005\u306e\u307f\u306b\u3057\u305f\u3044\u3068\u304d\u3068\u304b\u3002\nclass CtrlController < ApplicationController\n\n    before_action :auth, only: :index\n\n    private\n\n    def auth\n        # \u8a8d\u8a3c\u306b\u4f7f\u3046\u540d\u524d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\n        name = 'kimuko' \n        passwd = '8dohardk4kfn45ngiij4359058'\n\n        #\u57fa\u672c\u8a8d\u8a3c\u3092\u5b9f\u884c\n        authentiate_or_request_with_http_basic('Railsbook') do |n, p|\n            n == name && Digest::SHA1.hexdigest(p) == passwd\n        end\n    end\nend \n\n\n\u4f8b\u5916\u51e6\u7406\n\napplication_controller.rb\nclass ApplicationController < ActionController::Base\n    protect_from_forgery with: :exception\n\n    rescue_from ActiveRecord::RecordNotFound, with: :id_invalid\n\n    private\n\n    def id_invalid(e)\n        # 404\u7528\u306e\u30d3\u30e5\u30fc\n        render 'shared/record_not_found', status: 404\n    end\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fpublic/404.html\u3084public/500.html\u306b\u98db\u3070\u3055\u308c\u308b\u3002\n\n\u72ec\u81ea\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8ffd\u52a0\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3067\u304d\u308b\u3002\nclass ApplicationController < ActionController::Base\n    add_flash_types :info\nend\n\n\n\u8907\u6570\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u5171\u901a\u306e\u51e6\u7406\napp/controllers/concerns\u306b\u307e\u3068\u3081\u308b\n\nsample.rb\nmodule Name\n    extend ActiveSupport::Concern\n\n    included do\n        # call_clazz\n        before_filter :check_logined\n    end\n\n    module ClassMethods\n        #\u5b9a\u7fa9\n    end\n\n    #\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u306e\u5b9a\u7fa9\n\n    private\n\n    def check_logined\n    end\nend\n\n\n\u305d\u3057\u3066\u3001\u8aad\u307f\u8fbc\u307f\u305f\u3044\u5074\u3067include Name\u3068\u3059\u308c\u3070OK\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n\nnamespace\u3068scope\u306e\u9055\u3044\nnamespace\uff1a\u53c2\u7167\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3001URL\u30d1\u30bf\u30fc\u30f3\u3001Url\u30d8\u30eb\u30d1\u30fc\u3082\u5909\u308f\u308b\uff08RESTful\uff09\nscope module\uff1a\u53c2\u7167\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u5909\u308f\u308b\u304c\u3001\u305d\u306e\u4ed6\u306f\u5909\u308f\u3089\u306a\u3044\n\u203bscope\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u5909\u3048\u306a\u3044\u304c\u3001URL\u3060\u3051\u5909\u3048\u308b\n\npath_name\nnew\u3084edit\u306a\u3069\u306e\u6a19\u6e96\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u95a2\u9023\u3065\u3044\u305fURL\u3092\u5909\u66f4\u3057\u305f\u3044\u306a\u3089\u3070\u3001:path_names\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3002\u3053\u308c\u3084\u308a\u305f\u304b\u3063\u305f...!\nresources :reviews, path_names: { new: :insert, edit: :revise }\n\n\n\u30cd\u30b9\u30c8\u3092\u6d45\u304f\u3059\u308bshallow\u30aa\u30d7\u30b7\u30e7\u30f3\nresources :books do\n    resources :reviews, shallow: true\nend\n\n\u3053\u3046\u3059\u308b\u3068\u3001reviews\u30ea\u30bd\u30fc\u30b9\u304cid\u3092\u53d7\u3051\u53d6\u3089\u306a\u3044\u3001index,new,create\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u306e\u307f:book_id\u304c\u5165\u308a\u3001\u305d\u308c\u4ee5\u5916\u306f\u3001id\u306e\u307f\u306e\u30d1\u30b9\u304c\u51fa\u6765\u4e0a\u304c\u308b\u3002\n\u3055\u3089\u306bscope\u3068shallow_path\u3092\u5229\u7528\u3059\u308b\u3068\u3001reviews\u30ea\u30bd\u30fc\u30b9\u6642\u306b\u3001books/\u3067\u306f\u306a\u304fb/\u3092\u6307\u5b9a\u3067\u304d\u305f\u308a\u3059\u308b\u3002\nscope shallow_path: :b do\n    resources :books do\n        resources :reviews, shallow: true\n    end\nend\n\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u3064\u3044\u3066\n\u30b5\u30a4\u30c8\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u8003\u3048\u305f\u3089\u5fc5\u9808\u306e\u6a5f\u80fd\u3002\u3053\u308c\u4ee5\u5916\u306b\u3082\u3042\u308a\u305d\u3046\u3060\u3051\u3069\u672c\u66f8\u3067\u306f\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3002\n\n\u57fa\u672c\n- cache do\n    = Time.new\n    br\n\n\u30d3\u30e5\u30fc\u30d8\u30eb\u30d1\u30fccache\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u305f\u3044\u9818\u57df\u3092\u56f2\u3046\u3060\u3051\u3002\u7c21\u5358\uff01\uff01\n\n\u540c\u4e00\u30da\u30fc\u30b8\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\n\u57fa\u672c\u7684\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u304c\u3001\u8907\u6570\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u540c\u4e00\u30da\u30fc\u30b8\u306b\u3042\u308b\u3068\u30ad\u30fc\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3046\u3001\u3068\u306e\u3053\u3068\u3002\u306a\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\n- cache(suffix: 'footer') do\n    = Time.new\n    br\n\n\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u306e\u8907\u6570\u30da\u30fc\u30b8\u3067\u306e\u5171\u6709\n\u540c\u4e00\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3092\u5229\u7528\u3059\u308c\u3070OK\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u306e\u6c7a\u3081\u65b9\n\n\u30e2\u30c7\u30eb\u3092\u5143\u306b\n- cache(book) do\n    #\u30d3\u30e5\u30fc\n\n\u3053\u306e\u3088\u3046\u306b\u30e2\u30c7\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3059\u3068\u30e2\u30c7\u30eb\u540d.id\u5024-updated_at\u5217\u306e\u5024\u3068\u3044\u3046\u30ad\u30fc\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u308b\u3089\u3057\u3044\u3002\u3053\u308c\u306a\u3089\u66f4\u65b0\u3057\u3066\u3066\u3082\u308f\u304b\u308b\u306d\u3002\n\n\u89aa\u5b50\u95a2\u4fc2\u306b\u3042\u308b\u30e2\u30c7\u30eb\u306b\u304a\u3051\u308b\u6ce8\u610f\u70b9\n\nreview.rb\nclass Review < ActiveRecord::Base\n    belongs_to :book, touch: true\nend\n\n\n\u3053\u306etouch: true\u304c\u3042\u308c\u3070\u3001\u89aa\u306eupdated_at\u3082\u66f4\u65b0\u3055\u308c\u308b\u306e\u3067\u6700\u65b0\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4fdd\u3066\u308b\u3068\u306e\u3053\u3068\u3002\n\n\u4e00\u89a7\u753b\u9762\u3068\u304b\u306f\uff1f\n- cache(books_cache_key) do\n\n\nmodule ExtraHelper\n    def books_cache_key\n        \"books-#{Book.count}-#{Book.maximum(:updated_at).to_i}\"\n    end\nend\n\n\u30d8\u30eb\u30d1\u30fc\u3092\u62e1\u5f35\u3057\u3066\u4f5c\u3063\u3061\u3083\u304a\u3046\u3002\n\n\u6761\u4ef6\u3064\u304d\n- cache_if(book.published <= Date.today, book)\n\n\u7684\u306a\u3002\n\u203b\u6ce8\u610f\uff1a\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u30e1\u30e2\u30ea\u306e\u4e0a\u9650\u307e\u3067\u7d2f\u7a4d\u3059\u308b\u3002\u6700\u7d42\u30a2\u30af\u30bb\u30b9\u65e5\u306a\u3069\u304b\u3089\u5224\u65ad\u3057\u3066\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3053\u3068\n\n\u5b8c\u5168\u306b\u81ea\u5206\u7528\u306b\u307e\u3068\u3081\u305f\u306e\u3067\u3059\u304c\u3001\u521d\u5fc3\u8005\u306b\u306f\u76f2\u70b9\u306b\u306a\u308a\u305d\u3046\u306a\u3068\u3053\u308d\u304c\u591a\u304f\u3082\u3057\u304b\u3057\u305f\u3089\u5f79\u7acb\u3064\u304b\u3082\u3057\u308c\u306a\u3044\u306a\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u516c\u958b\u3002\u4fee\u6b63\u30fb\u30a2\u30c9\u30d0\u30a4\u30b9\u7b49\u3042\u308c\u3070\u30b3\u30e1\u30f3\u30c8\u304f\u3060\u3055\u3044\u3002\n\n\u4e3b\u306b\u306f\u3001\u300e\u305f\u306e\u3057\u3044Ruby\u300f\u3068\u300eRuby on Rails4 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u300f\u306e\u307e\u3068\u3081\u3067\u3059\u3002\n# \u305f\u306e\u3057\u3044Ruby\n## require\nrequire\u306f\u4f7f\u3044\u305f\u3044\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u3002\n\u4f8b\uff1a\"uri\"\n\u30e1\u30e2\uff1a\u4ee5\u4e0b\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306einclude\u306a\u3069\u304c\u30af\u30e9\u30b9\u306b\u5bfe\u3059\u308b\u3082\u306e\u3060\u3068\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u306b\u5bfe\u3059\u308binclude\u307f\u305f\u3044\u306a\u3082\u306e\u304b\u306a\uff1f\n\n## \u30e2\u30b8\u30e5\u30fc\u30eb\n### \u30af\u30e9\u30b9\u3068\u306e\u9055\u3044\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u30e1\u30bd\u30c3\u30c9\u3092\u63d0\u4f9b\u3057\u3001\u30af\u30e9\u30b9\u306b\u4f3c\u3066\u3044\u308b\u304c\u4ee5\u4e0b\u306e\u70b9\u3067\u9055\u3046\n\n* \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3067\u304d\u306a\u3044\n* \u7d99\u627f\u3067\u304d\u306a\u3044\n\n### include\u3068extend\n\n\u57fa\u672c\u7684\u306b\u306fRails\u306e\u30d8\u30eb\u30da\u30fc\u307f\u305f\u3044\u306b\u3069\u3053\u3067\u3082\uff08\uff1f\uff09\u547c\u3073\u51fa\u305b\u308b\n\n```ruby\nmodule Test\n\tdef explain(name)\n\t\tp \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\tend\nend\n\nTest::explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n```\n\ninclude\u3059\u308b\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\n\n```ruby\nmodule Test\n\tdef explain(name)\n\t\tp \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\tend\nend\n\nclass MyClass\ninclude Test\n\nend\n\ntest = MyClass.new\ntest.explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n```\n\nextend\u3059\u308b\u3068\u3001\u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u306b\u8ffd\u52a0\u3055\u308c\u308b\n\n```ruby\n\nmodule Test\n\tdef explain(name)\n\t\tp \"#{name}\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\tend\nend\n\nclass MyClass\nextend Test\n\nend\n\nMyClass.explain(\"\u7530\u4e2d\") #=> \"\u7530\u4e2d\u3055\u3093\u3001\u3053\u308c\u306f\u30c6\u30b9\u30c8\u3067\u3059\"\n\n```\n\n## \u4f8b\u5916\u51e6\u7406\n### \u57fa\u672c\u7cfb\n\n```ruby\nbegin\n\t# \u901a\u5e38\u306e\u51e6\u7406\n\traise \"\u30e1\u30c3\u30bb\u30fc\u30b8\" # RuntimeError\u304c\u767a\u751f\n\traise \u4f8b\u5916\u30af\u30e9\u30b9 # \u6307\u5b9a\u3057\u305f\u4f8b\u5916\u306e\u767a\u751f\n\traise \u4f8b\u5916\u30af\u30e9\u30b9, \"\u30e1\u30c3\u30bb\u30fc\u30b8\" #\u6307\u5b9a\u3057\u305f\u4f8b\u5916\u3092\u767a\u751f\u3055\u305b\u3001\u305d\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30bb\u30c3\u30c8\n\traise # RuntimeError\nrescue\n\t# error\u51e6\u7406\n\t# $\u3067\u4f8b\u5916\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\n\t# $! => \u6700\u5f8c\u306b\u767a\u751f\u3057\u305f\u4f8b\u5916 $@ => \u6700\u5f8c\u306b\u767a\u751f\u3057\u305f\u4f8b\u5916\u306e\u4f4d\u7f6e\u306b\u95a2\u3059\u308b\u60c5\u5831\n\traise # $!\u3092\u3082\u3046\u4e00\u5ea6\u767a\u751f\u3055\u305b\u308b\nensure\n\t# \u4f8b\u5916\u306e\u6709\u7121\u306b\u304b\u304b\u308f\u3089\u305a\u5b9f\u884c\u3055\u308c\u308b\u51e6\u7406\nend\n```\n\n### \u4f8b\u5916\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n#### \u547c\u3073\u51fa\u305b\u308b\u30e1\u30bd\u30c3\u30c9\n\n* class : \u4f8b\u5916\u306e\u7a2e\u985e\n* message : \u4f8b\u5916\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\n* backtrace : \u4f8b\u5916\u304c\u767a\u751f\u3057\u305f\u4f4d\u7f6e\u306b\u95a2\u3059\u308b\u60c5\u5831\n\n## \u30d6\u30ed\u30c3\u30af\n```ruby\ndef total(from, to)\n\tresult = 0\n\tfrom.upto(to) do |num|\n\t\tif block_given?          # \u30d6\u30ed\u30c3\u30af\u304c\u6e21\u3055\u308c\u3066\u3044\u305f\u3089\n\t\t\tresult += yield(num) # num\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3055\u308c\u305f\u30d6\u30ed\u30c3\u30af\u3092\u5b9f\u884c\n\t\telse\n\t\t\tresult += num\n\t\tend\t\n\tend\n\treturn result\nend\n\np total(1, 10)                    # 1\u304b\u308910\u306e\u548c => 55\np total(1, 10) { |num| num ** 2 } # 1\u304b\u308910\u306e2\u4e57\u306e\u5024\u306e\u548c => 385\n\n```\n\n\u30d6\u30ed\u30c3\u30af\u306e\u4e2d\u3067`break`\u3092\u547c\u3073\u3068\u3001nil\u306b\u306a\u308b\u3002`break 0`\u306a\u3069\u5024\u3092\u6e21\u3059\u3068\u623b\u308a\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\n\n**\u3042\u3068\u306f\u8f9e\u66f8\u7684\u306b\u4f7f\u304a\u3046\u7b11**\n\n# Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u306e\u5b66\u3073\u307e\u3068\u3081\n## View\n### debug\u3092\u4f7f\u304a\u3046\n`debug(@items)`\u3068\u3044\u3063\u305f\u5f62\u3067\u3001\u5909\u6570\u306e\u4e2d\u8eab\u3092view\u306b\u8868\u793a\u3067\u304d\u308b\u3002\n\n### \u7c21\u5358\u306a\u90e8\u5206\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306ecapture\n\n```slim\n- @current = capture do\n\t= \"\u305f\u3060\u3044\u307e\u306e\u6642\u523b\u306f#{Time.now}\u3067\u3059\u3002\"\n\n= @current\ndiv.container = @current\n```\n\n## Model\n### Validation\n\u3053\u3046\u3084\u308b\u3068\u7dba\u9e97\u306b\u304b\u3051\u308b\u306e\u304b\n\n```ruby\nclass Book < ActiveRecord::Base\n\tvalidates :isbn,\n\t\tpresence:   true,\n\t\tuniqueness: true,\n\t\tlength:     { is: 17 },\n\t\tformat:     { with: /\u00a5a[0-9]/ }\n\tvalidates :title\n\t\t# ...(\u7701\u7565\n```\n#### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u95a2\u9023\u3065\u304b\u306a\u3044\u30e2\u30c7\u30eb\u3092\u5b9a\u7fa9\u3059\u308b\n\u30d5\u30a9\u30fc\u30e0\u304b\u3089\u306e\u5165\u529b\u3092\u691c\u8a3c\u3057\u305f\u3044\u6642\u306a\u3069\n\n```ruby\n# app/models/search_keyword.rb\nclass SearchKeyword\n\tinclude ActiveModel::Model\n\t\n\tattr_accessor :keyword\n\t\n\tvalidates :keyword, presene: true\nend\n\n# record_controller\n\ndef keywd\n\t@search = SearchKeyword.new\nend\n\ndef keywd_process\n\t@search = SearchKeyword.new(params[:search_keyword])\n\tif @search.valid? # \u3053\u3053\u3067\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u547c\u3073\u51fa\u3059\u3002\n\t\trender text: @search.keyword\n\tend\nend\n\n\t\t\n\n```\n\n\n## Controller\n### \u57fa\u672c\u8a8d\u8a3c\uff1a\u7c21\u6613\u306a\u30ed\u30b0\u30a4\u30f3\u5b9f\u88c5\n\u3072\u3068\u307e\u305a\u7ba1\u7406\u8005\u306e\u307f\u306b\u3057\u305f\u3044\u3068\u304d\u3068\u304b\u3002\n\n```ruby\nclass CtrlController < ApplicationController\n\n\tbefore_action :auth, only: :index\n\t\n\tprivate\n\t\t\n\tdef auth\n\t\t# \u8a8d\u8a3c\u306b\u4f7f\u3046\u540d\u524d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\n\t\tname = 'kimuko'\t\n\t\tpasswd = '8dohardk4kfn45ngiij4359058'\n\t\t\n\t\t#\u57fa\u672c\u8a8d\u8a3c\u3092\u5b9f\u884c\n\t\tauthentiate_or_request_with_http_basic('Railsbook') do |n, p|\n\t\t\tn == name && Digest::SHA1.hexdigest(p) == passwd\n\t\tend\n\tend\nend\t\n```\n\n### \u4f8b\u5916\u51e6\u7406\n\n```ruby:application_controller.rb\nclass ApplicationController < ActionController::Base\n\tprotect_from_forgery with: :exception\n\t\n\trescue_from ActiveRecord::RecordNotFound, with: :id_invalid\n\t\n\tprivate\n\t\n\tdef id_invalid(e)\n\t\t# 404\u7528\u306e\u30d3\u30e5\u30fc\n\t\trender 'shared/record_not_found', status: 404\n\tend\n\n```\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f`public/404.html`\u3084`public/500.html`\u306b\u98db\u3070\u3055\u308c\u308b\u3002\n\n### \u72ec\u81ea\u306e\u30d5\u30e9\u30c3\u30b7\u30e5\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8ffd\u52a0\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3067\u304d\u308b\u3002\n\n```ruby\nclass ApplicationController < ActionController::Base\n\tadd_flash_types :info\nend\n```\n\n### \u8907\u6570\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u5171\u901a\u306e\u51e6\u7406\n`app/controllers/concerns`\u306b\u307e\u3068\u3081\u308b\n\n```ruby:sample.rb\nmodule Name\n\textend ActiveSupport::Concern\n\t\n\tincluded do\n\t\t# call_clazz\n\t\tbefore_filter :check_logined\n\tend\n\t\n\tmodule ClassMethods\n\t\t#\u5b9a\u7fa9\n\tend\n\t\n\t#\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30e1\u30bd\u30c3\u30c9\u306e\u5b9a\u7fa9\n\t\n\tprivate\n\t\n\tdef check_logined\n\tend\nend\n```\n\n\u305d\u3057\u3066\u3001\u8aad\u307f\u8fbc\u307f\u305f\u3044\u5074\u3067`include Name`\u3068\u3059\u308c\u3070OK\n\n## \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\n### namespace\u3068scope\u306e\u9055\u3044\n`namespace`\uff1a\u53c2\u7167\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3001URL\u30d1\u30bf\u30fc\u30f3\u3001Url\u30d8\u30eb\u30d1\u30fc\u3082\u5909\u308f\u308b\uff08RESTful\uff09\n`scope module`\uff1a\u53c2\u7167\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u5909\u308f\u308b\u304c\u3001\u305d\u306e\u4ed6\u306f\u5909\u308f\u3089\u306a\u3044\n\u203b`scope`\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u5909\u3048\u306a\u3044\u304c\u3001URL\u3060\u3051\u5909\u3048\u308b\n\n### path_name\nnew\u3084edit\u306a\u3069\u306e\u6a19\u6e96\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u95a2\u9023\u3065\u3044\u305fURL\u3092\u5909\u66f4\u3057\u305f\u3044\u306a\u3089\u3070\u3001:path_names\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3002\u3053\u308c\u3084\u308a\u305f\u304b\u3063\u305f...!\n\n```ruby\nresources :reviews, path_names: { new: :insert, edit: :revise }\n```\n\n### \u30cd\u30b9\u30c8\u3092\u6d45\u304f\u3059\u308bshallow\u30aa\u30d7\u30b7\u30e7\u30f3\n```ruby\nresources :books do\n\tresources :reviews, shallow: true\nend\n```\n\u3053\u3046\u3059\u308b\u3068\u3001`reviews`\u30ea\u30bd\u30fc\u30b9\u304cid\u3092\u53d7\u3051\u53d6\u3089\u306a\u3044\u3001index,new,create\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u306e\u307f`:book_id`\u304c\u5165\u308a\u3001\u305d\u308c\u4ee5\u5916\u306f\u3001`id`\u306e\u307f\u306e\u30d1\u30b9\u304c\u51fa\u6765\u4e0a\u304c\u308b\u3002\n\n\u3055\u3089\u306bscope\u3068shallow_path\u3092\u5229\u7528\u3059\u308b\u3068\u3001reviews\u30ea\u30bd\u30fc\u30b9\u6642\u306b\u3001`books/`\u3067\u306f\u306a\u304f`b/`\u3092\u6307\u5b9a\u3067\u304d\u305f\u308a\u3059\u308b\u3002\n\n```ruby\nscope shallow_path: :b do\n\tresources :books do\n\t\tresources :reviews, shallow: true\n\tend\nend\n```\n\n## \u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u3064\u3044\u3066\n\u30b5\u30a4\u30c8\u306e\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u3092\u8003\u3048\u305f\u3089\u5fc5\u9808\u306e\u6a5f\u80fd\u3002\u3053\u308c\u4ee5\u5916\u306b\u3082\u3042\u308a\u305d\u3046\u3060\u3051\u3069\u672c\u66f8\u3067\u306f\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3002\n### \u57fa\u672c\n```slim\n- cache do\n\t= Time.new\n\tbr\n```\n\u30d3\u30e5\u30fc\u30d8\u30eb\u30d1\u30fccache\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u305f\u3044\u9818\u57df\u3092\u56f2\u3046\u3060\u3051\u3002\u7c21\u5358\uff01\uff01\n\n### \u540c\u4e00\u30da\u30fc\u30b8\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\n\u57fa\u672c\u7684\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u304c\u3001\u8907\u6570\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u540c\u4e00\u30da\u30fc\u30b8\u306b\u3042\u308b\u3068\u30ad\u30fc\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3046\u3001\u3068\u306e\u3053\u3068\u3002\u306a\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\n\n```slim\n- cache(suffix: 'footer') do\n\t= Time.new\n\tbr\n\n```\n\n\n### \u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u306e\u8907\u6570\u30da\u30fc\u30b8\u3067\u306e\u5171\u6709\n\u540c\u4e00\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u3092\u5229\u7528\u3059\u308c\u3070OK\n\n### \u30ad\u30e3\u30c3\u30b7\u30e5\u30ad\u30fc\u306e\u6c7a\u3081\u65b9\n#### \u30e2\u30c7\u30eb\u3092\u5143\u306b\n```slim\n- cache(book) do\n\t#\u30d3\u30e5\u30fc\n```\n\u3053\u306e\u3088\u3046\u306b\u30e2\u30c7\u30eb\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6e21\u3059\u3068`\u30e2\u30c7\u30eb\u540d.id\u5024-updated_at\u5217\u306e\u5024`\u3068\u3044\u3046\u30ad\u30fc\u3092\u751f\u6210\u3057\u3066\u304f\u308c\u308b\u3089\u3057\u3044\u3002\u3053\u308c\u306a\u3089\u66f4\u65b0\u3057\u3066\u3066\u3082\u308f\u304b\u308b\u306d\u3002\n\n##### \u89aa\u5b50\u95a2\u4fc2\u306b\u3042\u308b\u30e2\u30c7\u30eb\u306b\u304a\u3051\u308b\u6ce8\u610f\u70b9\n```ruby:review.rb\nclass Review < ActiveRecord::Base\n\tbelongs_to :book, touch: true\nend\n```\n\u3053\u306e`touch: true`\u304c\u3042\u308c\u3070\u3001\u89aa\u306eupdated_at\u3082\u66f4\u65b0\u3055\u308c\u308b\u306e\u3067\u6700\u65b0\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4fdd\u3066\u308b\u3068\u306e\u3053\u3068\u3002\n\n##### \u4e00\u89a7\u753b\u9762\u3068\u304b\u306f\uff1f\n```slim\n- cache(books_cache_key) do\n\n```\n\n```ruby\nmodule ExtraHelper\n\tdef books_cache_key\n\t\t\"books-#{Book.count}-#{Book.maximum(:updated_at).to_i}\"\n\tend\nend\n```\n\u30d8\u30eb\u30d1\u30fc\u3092\u62e1\u5f35\u3057\u3066\u4f5c\u3063\u3061\u3083\u304a\u3046\u3002\n\n##### \u6761\u4ef6\u3064\u304d\n```slim\n- cache_if(book.published <= Date.today, book)\n```\n\u7684\u306a\u3002\n\n\u203b\u6ce8\u610f\uff1a\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u30e1\u30e2\u30ea\u306e\u4e0a\u9650\u307e\u3067\u7d2f\u7a4d\u3059\u308b\u3002\u6700\u7d42\u30a2\u30af\u30bb\u30b9\u65e5\u306a\u3069\u304b\u3089\u5224\u65ad\u3057\u3066\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3053\u3068\n", "tags": ["Rails", "\u57fa\u790e", "Ruby"]}