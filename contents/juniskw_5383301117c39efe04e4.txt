{"context": " More than 1 year has passed since last update.\u30e1\u30a4\u30f3\u306e\u30da\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\uff08\u3061\u306a\u307f\u306b\u3053\u3053\u3089\u8fba\u304b\u3089\u982d\u306e\u4e2d\u304c\u3054\u3061\u3083\u3054\u3061\u3083\u3057\u3066\u304d\u305f\uff09\u3002\n\u3061\u306a\u307f\u306b\u73fe\u6642\u70b9\u3067\u306e\u753b\u9762\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n\nURL\u306e\u8a2d\u5b9a\n\u307e\u305a\u306fURLconf\u306e\u8a2d\u5b9a\u304b\u3089\u3002\u4eca\u56de\u306f http://shift-maker/2014/5/15/shift/ \u307f\u305f\u3044\u306aURL\u306b\u3057\u3066\u5e74\u6708\u306e\u6570\u5024\u3092\u7d44\u307f\u8fbc\u3093\u3067\u3001\u305d\u306e\u6570\u5024\u3092\u30d3\u30e5\u30fc\u95a2\u6570\u306b\u6301\u3063\u3066\u884c\u304f\u3053\u3068\u3067\u30c7\u30fc\u30bf\u306b\u63a5\u7d9a\u3059\u308b\u611f\u3058\u306b\u3057\u305f\u3044\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nurl.py\n#...\nmonth_url = r'(?P<year_num>\\d+)\\-(?P<month_num>\\d+)'  # \u4f7f\u3044\u56de\u3059\u4e88\u611f\u304c\u3057\u305f\u306e\u3067\u5909\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u305f\u3002\u5e74\u3068\u6708\u306e\u6570\u5024\u3092year_num,month_num\u3068\u3057\u3066views.py\u306b\u6301\u3063\u3066\u3044\u3051\u308b\u3002\n\nurlpatterns += patterns('schedule.views',\n    url(r'^$', 'home', name=\"Home\"),  # \u3068\u3053\u308d\u3067\u3053\u306ename\u5c5e\u6027\u306e\u610f\u5473\u304c\u610f\u5473\u4e00\u3064\u5206\u304b\u3089\u306a\u3044\uff08\u3068\u308a\u3042\u3048\u305a\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u304c\uff09\n    url(r'^%s/shift/$' % (month_url,),'a_month_shift',name=\"MonthShift\"),\n)\n#...\n\n\u30db\u30fc\u30e0\u30da\u30fc\u30b8\u306f\u6df1\u304f\u8003\u3048\u305a\u304a\u307e\u3051\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\n2.\u30d3\u30e5\u30fc\u95a2\u6570\n\u6bce\u6708\u306e\u30b7\u30d5\u30c8\u5236\u4f5c\u30da\u30fc\u30b8\u3092\u4f5c\u308b\u5834\u5408\u3001\u305d\u306e\u6708\u306e\u5185\u5bb9\uff08\u65e5\u4ed8\u3068\u304b\u66dc\u65e5\u306a\u3069\uff09\u3092\u53d6\u5f97\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3059\u304c\u3001Python\u306b\u306fcalendar\u3068\u3044\u3046\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u6d3b\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306fowner/models.py\u306eGroupSchedule\u30e2\u30c7\u30eb\u5185\u306bget_calendar\u3068\u3044\u3046\u95a2\u6570\u3068\u3057\u3066\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\nschedule/views.py\nfrom django.contrib.auth.decorators import login_required\nfrom django.shortcuts import render,redirect\n\n\n@login_required\ndef home(req):\n    from datetime import datetime\n\n    now = datetime.now()\n\n    return redirect( '/%s-%s/shift/' % (now.year,now.month,) )  # \u81ea\u52d5\u7684\u306b\u4eca\u6708\u306e\u30b7\u30d5\u30c8\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n@login_required\ndef a_month_shift(req,year_num,month_num):\n    from owner.models import GroupSchedule\n    from schedule.models import WorkTime,MonthShift,StaffSchedule,NgShift,GuestSchedule\n    from datetime import date\n\n    year,month = int(year_num),int(month_num)\n\n    try:\n        groupschedule = GroupSchedule.objects.get(owner=req.user)\n    except GroupSchedule.DoesNotExist:  # \u30b7\u30d5\u30c8\u8a2d\u5b9a\u304c\u51fa\u6765\u3066\u306a\u3051\u308c\u3070\n        return redirect('/owner/schedule/edit')  # \u8a2d\u5b9a\u753b\u9762\u3078\n\n    monthshift,created = groupschedule.monthshift_set.get_or_create(year=year,month=month,groupschedule=req.user.groupschedule)  # get_or_create\u306f\u3044\u3061\u3044\u3061try\u6587\u3092\u66f8\u304b\u305a\u306b\u6e08\u3080\u4fbf\u5229\u306a\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3002\u5de6\u8fba\u304c\u4e8c\u3064\u3042\u308b\u3053\u3068\u306b\u6ce8\u610f\uff08\u4e8c\u3064\u76ee\u304c\u4f55\u304b\u306f\u4eca\u306e\u3068\u3053\u308d\u4e0d\u660e\uff09\n\n    if req.method == 'POST':\n        posted = req.POST\n        s_year,s_month,s_day = int(posted['year']),int(posted['month']),int(posted['day'])  # s_\u3068\u3044\u3046\u306e\u306fstaffschedule_\u306e\u7565\u3002\u65e5\u4ed8\u60c5\u5831\u3092POST\u30c7\u30fc\u30bf\u304b\u3089\u53d7\u3051\u53d6\u308a\u30fb\u30fb\u30fb\n        s_date = date( year=s_year,month=s_month,day=s_day )  # date\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u5909\u6570\u5316\n\n        try:  # POST\u3055\u308c\u305f\u65e5\u4ed8\u3068\u30b9\u30bf\u30c3\u30d5\u60c5\u5831\u304b\u3089StaffSchedule\u3092\u53d6\u5f97\u3059\u308b\u304b\u30fb\u30fb\u30fb\n            s_schedule = StaffSchedule.objects.get( date=s_date,staff=int(posted['staff']) )\n        except StaffSchedule.DoesNotExist:  # \u7121\u3051\u308c\u3070\u4f5c\u6210\n            from staff.models import Staff\n            s_schedule = StaffSchedule(date=s_date)\n            s_schedule.staff = Staff.objects.get( id=int(posted['staff']) )\n\n        s_schedule.monthshift = monthshift\n\n        s_schedule.worktime = WorkTime.objects.get( id=int(posted['shift']) )  # StaffSchedule\u306eWorkTime\u3092\u78ba\u5b9a\u3057\u30fb\u30fb\u30fb\n\n        s_schedule.save()  # \u4fdd\u5b58\n\n    month_cal = groupschedule.get_calendar(year,month)  # GroupSchedule\u30e2\u30c7\u30eb\u306b\u5b9a\u7fa9\u3057\u305fget_calendar\u304b\u3089\u6708\u60c5\u5831\u3092\u53d6\u5f97\n\n    return render(req,'schedule/a_month_shift.html',{\n        'year':year_num,  # \u305d\u306e\u307e\u307e\u30da\u30fc\u30b8\u30bf\u30a4\u30c8\u30eb\u306a\u3069\u306b\u4f7f\u3046\n        'month':month_num,  # \u540c\u4e0a\n        'month_cal':month_cal,  # \u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\n        'monthshift':monthshift,  # \u307e\u3060\u4f7f\u3063\u3066\u3044\u306a\u3044\u304c\n        'weekdays':['\u6708','\u706b','\u6c34','\u6728','\u91d1','\u571f','\u65e5',],  # \u66dc\u65e5\u306e\u8868\u793a\u65b9\u6cd5\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068Sunday\u3068\u304b\u306b\u306a\u308b\u306e\u3067\u99b4\u67d3\u307f\u3065\u3089\u3044\uff09\n        'staffs':groupschedule.staff_set.order_by('id'),\n        'worktimes':groupschedule.worktime_set.order_by('id'),\n    })\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\u3042\u3068\u306f\u305d\u308c\u3063\u307d\u304f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\u307e\u305a\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30d9\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3057\u305f\uff08\u3057\u304b\u3057\u5206\u3051\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u304b\u306f\u5fae\u5999\uff09\u3002\n\ntemplates/schedule/bases/base_a_month.html\n{% extends 'bases/base.html' %}\n\n{% block title %} {{ year_num }}-{{ month_num }} {% endblock %}\n\n{% block main %}\n<!--\u3053\u3053\u304b\u3089-->\n<a href=\"/logout\">Log out</a>\n<a href=\"/staff/new\"><button class=\"btn btn-success\">Add New Staff</button></a>\n<!--\u3053\u3053\u307e\u3067\u306f\u30c6\u30ad\u30c8\u30fc\u306b\u5165\u308c\u305f\u306e\u3067\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u30ac\u30bf\u30ac\u30bf-->\n\n<ul class=\"pager\">\n    <li class=\"previous\">\n        {% ifnotequal month '1' %}\n        <a href=\"/{{ year }}-{{ month|add:'-1' }}/shift\">\u524d\u6708</a>\n        {% else %}\n        <a href=\"/{{ year|add:'-1' }}-12/shift\">\u524d\u6708</a>\n        {% endifnotequal %}\n    </li>\n    <li class=\"next\">\n        {% ifnotequal month '12' %}\n        <a href=\"/{{ year }}-{{ month|add:\"1\" }}/shift\">\u6b21\u6708</a>\n        {% else %}\n        <a href=\"/{{ year|add:'1' }}-1/shift\">\u6b21\u6708</a>\n        {% endifnotequal %}\n    </li>\n</ul>\n\n<h1><small>{{ year }}-</small>{{ month }}</h1>  <!--\u898b\u51fa\u3057\u3002\u4f55\u5e74\u306e\u4f55\u6708\uff1f-->\n\n<table class=\"table table-bordered {% block t_class %}{% endblock %}\">\n\n    {% block t_main %}\n        <!--\u3053\u3053\u306b\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5165\u308c\u308b-->\n    {% endblock %}\n\n</table>\n{% endblock main %}\n\n\u3067\u3001\u4ee5\u4e0b\u304c\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u3067\u3059\u3002\n\ntemplates/schedule/a_month_shift.html\n{% extends \"schedule/bases/base_a_month.html\"  %}\n\n{% block title %} Shift:{{ year }}/{{ month }}-{{ month|add:1 }} {% endblock %}\n\n{% block t_main %}\n<script type=\"text/javascript\" src=\"{{ STATIC_URL }}js/a_month_shift.js\"></script>\n<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}css/a_month_shift.css\">  <!--\u73fe\u6642\u70b9\u3067\u306f\u4f5c\u3063\u3066\u3044\u306a\u3044\u304c-->\n\n    {% load schedule_controler %}  {# \u81ea\u4f5c\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u8aad\u307f\u8fbc\u307f #}\n\n<thead>\n    <tr align=\"center\" class=\"info\">    <!--\u65e5\u4ed8-->\n        <th rowspan=\"2\"></th>\n    {% for cal in month_cal %}  {# \u30ab\u30ec\u30f3\u30c0\u30fc\u3092\u4e00\u65e5\u305a\u3064\u8868\u793a #}\n        <th class=\"day_{{ cal.day }}\">{{ cal.day }}</th>\n    {% endfor %}\n\n    {% for worktime in worktimes %}  {# \u767b\u9332\u3057\u3066\u3042\u308bWorkTime\u3092\u4e00\u3064\u305a\u3064\u8868\u793a\uff08\u52e4\u52d9\u6642\u9593\u3054\u3068\u306e\u7d71\u8a08\u3092\u3059\u308b\u305f\u3081\u306e\u898b\u51fa\u3057\uff09 #}\n        <th rowspan=\"2\">{{ worktime.title }}</th>\n    {% endfor %}\n    </tr>\n\n    <tr class=\"info\">   <!--\u66dc\u65e5-->\n    {% for cal in month_cal %}\n\n        <th class=\"day_{{ cal.day }}\">{{ weekdays|index_is:cal.weekday }}</th>  {# index_is\u306f\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc #}\n\n    {% endfor %}\n    </tr>\n</thead>\n<tbody>\n    {% for staff in staffs %}\n    <tr align=\"center\">\n        <th class=\"info\" staff_id=\"{{ staff.id }}\">{{ staff }}</th>  <!--staff_id\u8981\u7d20\u306fjs\u3067\u4f7f\u3046-->\n        {% for cal in month_cal %}\n        <td class=\"day_{{ cal.day }}\" id=\"s{{ staff.id }}d{{ cal.day }}\">\n            {% include 'schedule/parts/dropdown.html' %}  {# \u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u3067\u306eWorkTime\u9078\u629e\u90e8\u5206\u3092\u30d1\u30fc\u30c4\u3068\u3057\u3066\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u4f5c\u6210\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3053\u3053\u3067\u8aad\u307f\u8fbc\u3080\u611f\u3058 #}\n        </td>\n        {% endfor %}\n\n        {% for worktime in worktimes %}\n        <td>\n            {% with staff.staffschedule_set|worktime_filter:worktime as worktime_set %}  {# worktime_filter\u3068\u30fb\u30fb\u30fb #}\n                {% with worktime_set|monthshift_filter:monthshift as month_worktime_set %}  {# monthshift_filter\u3082\u81ea\u4f5c #}\n                    {{ month_worktime_set.count }}  {# count\u3068\u3044\u3046\u306e\u306f\u7d44\u307f\u8fbc\u307f\u306e\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u3053\u3053\u3067\u306fWorkTime\u3054\u3068\u306e\u7d71\u8a08\u3092\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528 #}\n                {% endwith %}\n            {% endwith %}\n        </td>\n        {% endfor %}\n    </tr>\n\n    {% endfor %}\n</tbody>\n{% endblock t_main %}\n\n\u3044\u304f\u3064\u304b\u306e\u7b87\u6240\u3067\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b templatetags \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u65b0\u305f\u306b\u7528\u610f\u3057\u305d\u3053\u306b\u4f5c\u6210\u3059\u308b\u3068\u547c\u3073\u51fa\u305b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u53c2\u8003\uff1ahttp://docs.djangoproject.jp/en/latest/howto/custom-template-tags.html\n\u305d\u308c\u3089\u306e\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u66f8\u3044\u305f schedule_controler.py \u3084 a_month_shift.js \u3001 dropdown.html \u306a\u3069\u306f\u9577\u304f\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u6b21\u56de\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u30e1\u30a4\u30f3\u306e\u30da\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\uff08\u3061\u306a\u307f\u306b\u3053\u3053\u3089\u8fba\u304b\u3089\u982d\u306e\u4e2d\u304c\u3054\u3061\u3083\u3054\u3061\u3083\u3057\u3066\u304d\u305f\uff09\u3002\n\n\u3061\u306a\u307f\u306b\u73fe\u6642\u70b9\u3067\u306e\u753b\u9762\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![\u51fa\u6765\u4e0a\u304c\u3063\u305f\u753b\u9762](http://i.gyazo.com/5fb06bf4a1635e6f338f800e3bc2cfbb.png)\n\n#### URL\u306e\u8a2d\u5b9a\n\n\u307e\u305a\u306fURLconf\u306e\u8a2d\u5b9a\u304b\u3089\u3002\u4eca\u56de\u306f **http://shift-maker/2014/5/15/shift/** \u307f\u305f\u3044\u306aURL\u306b\u3057\u3066\u5e74\u6708\u306e\u6570\u5024\u3092\u7d44\u307f\u8fbc\u3093\u3067\u3001\u305d\u306e\u6570\u5024\u3092\u30d3\u30e5\u30fc\u95a2\u6570\u306b\u6301\u3063\u3066\u884c\u304f\u3053\u3068\u3067\u30c7\u30fc\u30bf\u306b\u63a5\u7d9a\u3059\u308b\u611f\u3058\u306b\u3057\u305f\u3044\u306e\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n###### url.py\n\n```py\n#...\nmonth_url = r'(?P<year_num>\\d+)\\-(?P<month_num>\\d+)'  # \u4f7f\u3044\u56de\u3059\u4e88\u611f\u304c\u3057\u305f\u306e\u3067\u5909\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u305f\u3002\u5e74\u3068\u6708\u306e\u6570\u5024\u3092year_num,month_num\u3068\u3057\u3066views.py\u306b\u6301\u3063\u3066\u3044\u3051\u308b\u3002\n\nurlpatterns += patterns('schedule.views',\n    url(r'^$', 'home', name=\"Home\"),  # \u3068\u3053\u308d\u3067\u3053\u306ename\u5c5e\u6027\u306e\u610f\u5473\u304c\u610f\u5473\u4e00\u3064\u5206\u304b\u3089\u306a\u3044\uff08\u3068\u308a\u3042\u3048\u305a\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u304c\uff09\n\turl(r'^%s/shift/$' % (month_url,),'a_month_shift',name=\"MonthShift\"),\n)\n#...\n```\n\n\u30db\u30fc\u30e0\u30da\u30fc\u30b8\u306f\u6df1\u304f\u8003\u3048\u305a\u304a\u307e\u3051\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\n### 2.\u30d3\u30e5\u30fc\u95a2\u6570\n\n\u6bce\u6708\u306e\u30b7\u30d5\u30c8\u5236\u4f5c\u30da\u30fc\u30b8\u3092\u4f5c\u308b\u5834\u5408\u3001\u305d\u306e\u6708\u306e\u5185\u5bb9\uff08\u65e5\u4ed8\u3068\u304b\u66dc\u65e5\u306a\u3069\uff09\u3092\u53d6\u5f97\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u3059\u304c\u3001Python\u306b\u306f[calendar\u3068\u3044\u3046\u4fbf\u5229\u306a\u30e2\u30b8\u30e5\u30fc\u30eb](http://qiita.com/juniskw/items/e2d42c2f457e4b49b8b5)\u304c\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u6d3b\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f[owner/models.py\u306eGroupSchedule\u30e2\u30c7\u30eb\u5185\u306bget_calendar\u3068\u3044\u3046\u95a2\u6570](http://qiita.com/juniskw/items/8edf5fb52a997b486614)\u3068\u3057\u3066\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n###### schedule/views.py\n\n```py\nfrom django.contrib.auth.decorators import login_required\nfrom django.shortcuts import render,redirect\n\n\n@login_required\ndef home(req):\n\tfrom datetime import datetime\n\t\n\tnow = datetime.now()\n\n\treturn redirect( '/%s-%s/shift/' % (now.year,now.month,) )  # \u81ea\u52d5\u7684\u306b\u4eca\u6708\u306e\u30b7\u30d5\u30c8\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n@login_required\ndef a_month_shift(req,year_num,month_num):\n\tfrom owner.models import GroupSchedule\n\tfrom schedule.models import WorkTime,MonthShift,StaffSchedule,NgShift,GuestSchedule\n\tfrom datetime import date\n\n\tyear,month = int(year_num),int(month_num)\n\n\ttry:\n\t\tgroupschedule = GroupSchedule.objects.get(owner=req.user)\n\texcept GroupSchedule.DoesNotExist:  # \u30b7\u30d5\u30c8\u8a2d\u5b9a\u304c\u51fa\u6765\u3066\u306a\u3051\u308c\u3070\n\t\treturn redirect('/owner/schedule/edit')  # \u8a2d\u5b9a\u753b\u9762\u3078\n\n    monthshift,created = groupschedule.monthshift_set.get_or_create(year=year,month=month,groupschedule=req.user.groupschedule)  # get_or_create\u306f\u3044\u3061\u3044\u3061try\u6587\u3092\u66f8\u304b\u305a\u306b\u6e08\u3080\u4fbf\u5229\u306a\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3002\u5de6\u8fba\u304c\u4e8c\u3064\u3042\u308b\u3053\u3068\u306b\u6ce8\u610f\uff08\u4e8c\u3064\u76ee\u304c\u4f55\u304b\u306f\u4eca\u306e\u3068\u3053\u308d\u4e0d\u660e\uff09\n\n\tif req.method == 'POST':\n\t\tposted = req.POST\n\t\ts_year,s_month,s_day = int(posted['year']),int(posted['month']),int(posted['day'])  # s_\u3068\u3044\u3046\u306e\u306fstaffschedule_\u306e\u7565\u3002\u65e5\u4ed8\u60c5\u5831\u3092POST\u30c7\u30fc\u30bf\u304b\u3089\u53d7\u3051\u53d6\u308a\u30fb\u30fb\u30fb\n\t\ts_date = date( year=s_year,month=s_month,day=s_day )  # date\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u5909\u6570\u5316\n\n\t\ttry:  # POST\u3055\u308c\u305f\u65e5\u4ed8\u3068\u30b9\u30bf\u30c3\u30d5\u60c5\u5831\u304b\u3089StaffSchedule\u3092\u53d6\u5f97\u3059\u308b\u304b\u30fb\u30fb\u30fb\n\t\t\ts_schedule = StaffSchedule.objects.get( date=s_date,staff=int(posted['staff']) )\n\t\texcept StaffSchedule.DoesNotExist:  # \u7121\u3051\u308c\u3070\u4f5c\u6210\n\t\t\tfrom staff.models import Staff\n\t\t\ts_schedule = StaffSchedule(date=s_date)\n\t\t\ts_schedule.staff = Staff.objects.get( id=int(posted['staff']) )\n\n\t\ts_schedule.monthshift = monthshift\n\n\t\ts_schedule.worktime = WorkTime.objects.get( id=int(posted['shift']) )  # StaffSchedule\u306eWorkTime\u3092\u78ba\u5b9a\u3057\u30fb\u30fb\u30fb\n\n\t\ts_schedule.save()  # \u4fdd\u5b58\n\n\tmonth_cal = groupschedule.get_calendar(year,month)  # GroupSchedule\u30e2\u30c7\u30eb\u306b\u5b9a\u7fa9\u3057\u305fget_calendar\u304b\u3089\u6708\u60c5\u5831\u3092\u53d6\u5f97\n\n\treturn render(req,'schedule/a_month_shift.html',{\n\t\t'year':year_num,  # \u305d\u306e\u307e\u307e\u30da\u30fc\u30b8\u30bf\u30a4\u30c8\u30eb\u306a\u3069\u306b\u4f7f\u3046\n\t\t'month':month_num,  # \u540c\u4e0a\n\t\t'month_cal':month_cal,  # \u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\n\t\t'monthshift':monthshift,  # \u307e\u3060\u4f7f\u3063\u3066\u3044\u306a\u3044\u304c\n\t\t'weekdays':['\u6708','\u706b','\u6c34','\u6728','\u91d1','\u571f','\u65e5',],  # \u66dc\u65e5\u306e\u8868\u793a\u65b9\u6cd5\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068Sunday\u3068\u304b\u306b\u306a\u308b\u306e\u3067\u99b4\u67d3\u307f\u3065\u3089\u3044\uff09\n\t\t'staffs':groupschedule.staff_set.order_by('id'),\n\t\t'worktimes':groupschedule.worktime_set.order_by('id'),\n\t})\n```\n\n#### \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n\u3042\u3068\u306f\u305d\u308c\u3063\u307d\u304f\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\u307e\u305a\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30d9\u30fc\u30b9\u3092\u4f5c\u308a\u307e\u3057\u305f\uff08\u3057\u304b\u3057\u5206\u3051\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u306e\u304b\u306f\u5fae\u5999\uff09\u3002\n\n###### templates/schedule/bases/base_a_month.html\n\n```django\n{% extends 'bases/base.html' %}\n\n{% block title %} {{ year_num }}-{{ month_num }} {% endblock %}\n\n{% block main %}\n<!--\u3053\u3053\u304b\u3089-->\n<a href=\"/logout\">Log out</a>\n<a href=\"/staff/new\"><button class=\"btn btn-success\">Add New Staff</button></a>\n<!--\u3053\u3053\u307e\u3067\u306f\u30c6\u30ad\u30c8\u30fc\u306b\u5165\u308c\u305f\u306e\u3067\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u30ac\u30bf\u30ac\u30bf-->\n\n<ul class=\"pager\">\n\t<li class=\"previous\">\n\t\t{% ifnotequal month '1' %}\n\t\t<a href=\"/{{ year }}-{{ month|add:'-1' }}/shift\">\u524d\u6708</a>\n\t\t{% else %}\n\t\t<a href=\"/{{ year|add:'-1' }}-12/shift\">\u524d\u6708</a>\n\t\t{% endifnotequal %}\n\t</li>\n\t<li class=\"next\">\n\t\t{% ifnotequal month '12' %}\n\t\t<a href=\"/{{ year }}-{{ month|add:\"1\" }}/shift\">\u6b21\u6708</a>\n\t\t{% else %}\n\t\t<a href=\"/{{ year|add:'1' }}-1/shift\">\u6b21\u6708</a>\n\t\t{% endifnotequal %}\n\t</li>\n</ul>\n\n<h1><small>{{ year }}-</small>{{ month }}</h1>\t<!--\u898b\u51fa\u3057\u3002\u4f55\u5e74\u306e\u4f55\u6708\uff1f-->\n\n<table class=\"table table-bordered {% block t_class %}{% endblock %}\">\n\n\t{% block t_main %}\n        <!--\u3053\u3053\u306b\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5165\u308c\u308b-->\n\t{% endblock %}\n\n</table>\n{% endblock main %}\n```\n\n\u3067\u3001\u4ee5\u4e0b\u304c\u30e1\u30a4\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u3067\u3059\u3002\n\n###### templates/schedule/a_month_shift.html\n\n```django\n{% extends \"schedule/bases/base_a_month.html\"  %}\n\n{% block title %} Shift:{{ year }}/{{ month }}-{{ month|add:1 }} {% endblock %}\n\n{% block t_main %}\n<script type=\"text/javascript\" src=\"{{ STATIC_URL }}js/a_month_shift.js\"></script>\n<link type=\"text/css\" rel=\"stylesheet\" href=\"{{ STATIC_URL }}css/a_month_shift.css\">  <!--\u73fe\u6642\u70b9\u3067\u306f\u4f5c\u3063\u3066\u3044\u306a\u3044\u304c-->\n\t\t\t\t\n\t{% load schedule_controler %}  {# \u81ea\u4f5c\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u8aad\u307f\u8fbc\u307f #}\n\n<thead>\n\t<tr align=\"center\" class=\"info\">\t<!--\u65e5\u4ed8-->\n\t\t<th rowspan=\"2\"></th>\n\t{% for cal in month_cal %}  {# \u30ab\u30ec\u30f3\u30c0\u30fc\u3092\u4e00\u65e5\u305a\u3064\u8868\u793a #}\n\t\t<th class=\"day_{{ cal.day }}\">{{ cal.day }}</th>\n\t{% endfor %}\n\n\t{% for worktime in worktimes %}  {# \u767b\u9332\u3057\u3066\u3042\u308bWorkTime\u3092\u4e00\u3064\u305a\u3064\u8868\u793a\uff08\u52e4\u52d9\u6642\u9593\u3054\u3068\u306e\u7d71\u8a08\u3092\u3059\u308b\u305f\u3081\u306e\u898b\u51fa\u3057\uff09 #}\n\t\t<th rowspan=\"2\">{{ worktime.title }}</th>\n\t{% endfor %}\n\t</tr>\n\n\t<tr class=\"info\">\t<!--\u66dc\u65e5-->\n\t{% for cal in month_cal %}\n\n\t\t<th class=\"day_{{ cal.day }}\">{{ weekdays|index_is:cal.weekday }}</th>  {# index_is\u306f\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc #}\n\n\t{% endfor %}\n\t</tr>\n</thead>\n<tbody>\n\t{% for staff in staffs %}\n\t<tr align=\"center\">\n\t\t<th class=\"info\" staff_id=\"{{ staff.id }}\">{{ staff }}</th>  <!--staff_id\u8981\u7d20\u306fjs\u3067\u4f7f\u3046-->\n\t\t{% for cal in month_cal %}\n\t\t<td class=\"day_{{ cal.day }}\" id=\"s{{ staff.id }}d{{ cal.day }}\">\n\t\t\t{% include 'schedule/parts/dropdown.html' %}  {# \u30c9\u30ed\u30c3\u30d7\u30c0\u30a6\u30f3\u3067\u306eWorkTime\u9078\u629e\u90e8\u5206\u3092\u30d1\u30fc\u30c4\u3068\u3057\u3066\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u4f5c\u6210\u3057\u3066\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3053\u3053\u3067\u8aad\u307f\u8fbc\u3080\u611f\u3058 #}\n\t\t</td>\n\t\t{% endfor %}\n\n\t\t{% for worktime in worktimes %}\n\t\t<td>\n\t\t\t{% with staff.staffschedule_set|worktime_filter:worktime as worktime_set %}  {# worktime_filter\u3068\u30fb\u30fb\u30fb #}\n\t\t\t\t{% with worktime_set|monthshift_filter:monthshift as month_worktime_set %}  {# monthshift_filter\u3082\u81ea\u4f5c #}\n\t\t\t\t\t{{ month_worktime_set.count }}  {# count\u3068\u3044\u3046\u306e\u306f\u7d44\u307f\u8fbc\u307f\u306e\u4fbf\u5229\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u3053\u3053\u3067\u306fWorkTime\u3054\u3068\u306e\u7d71\u8a08\u3092\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528 #}\n\t\t\t\t{% endwith %}\n\t\t\t{% endwith %}\n\t\t</td>\n\t\t{% endfor %}\n\t</tr>\n\n\t{% endfor %}\n</tbody>\n{% endblock t_main %}\n```\n\n\u3044\u304f\u3064\u304b\u306e\u7b87\u6240\u3067\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\u306b **templatetags** \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u65b0\u305f\u306b\u7528\u610f\u3057\u305d\u3053\u306b\u4f5c\u6210\u3059\u308b\u3068\u547c\u3073\u51fa\u305b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u53c2\u8003\uff1ahttp://docs.djangoproject.jp/en/latest/howto/custom-template-tags.html\n\n\u305d\u308c\u3089\u306e\u81ea\u4f5c\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u66f8\u3044\u305f **schedule_controler.py** \u3084 **a_month_shift.js** \u3001 **dropdown.html** \u306a\u3069\u306f\u9577\u304f\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u6b21\u56de\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["Django", "HTML", "Python", "bootstrap"]}