{"context": " More than 1 year has passed since last update.AWS EC2\u4e0a\u306bfluentd + fluent-plugin-twitter + elasticsearch + kibana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30e1\u30e2\u3002\n\n0. instance\u7acb\u3061\u4e0a\u3052\nEC2\u4e0a\u306binstance\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u304a\u8a66\u3057\u306a\u3089t2.micro\u3067\u3082\u826f\u3044\u304b\u3082\u3002\nAWS t2.micro\nOS: Amazon Linux AMI (HVM)\n\u30c4\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u306fS3\u4e0a\u306b\u4e0a\u3052\u3066\u304a\u304f\u3068\u3001\u5916\u90e8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3088\u308a\u5c11\u3057\u65e9\u3044\u3057\u3001\u304a\u8ca1\u5e03\u306b\u3082\u5c11\u3057\u512a\u3057\u3044\u3002\n\n1. yum update\n$ sudo yum update -y\n\n\n2. swap\u8a2d\u5b9a\nEC2instance\u304ct2.micro\u306e\u3068\u304dswap\u9818\u57df\u3092\u8a2d\u5b9a\u3059\u308b\n$ sudo dd if=/dev/zero of=/swap.img bs=1M count=2048\n$ sudo chmod 600 /swap.img\n$ sudo mkswap /swap.img\n$ sudo bash -c 'echo \"/swap.img    swap    swap    defaults    0    0\" >> /etc/fstab'\n\nswap\u3092\u6709\u52b9\u306b\u3059\u308b\n$ sudo swapon -a\n\n\n3. \u65e5\u672c\u6642\u9593\u306b\u8a2d\u5b9a\n$ sudo vi /etc/sysconfig/clock\n\nZONE=\"Asia/Tokyo\"\n\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n$ sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n$ sudo reboot\n\n\n4. \u958b\u767a\u74b0\u5883\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum -y install gcc* make\n\n\n5. TreasureData\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3002\ninstall-redhat.sh \u306b\u3088\u308ayum\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u767b\u9332\u3068\u3001td-agent\u306erpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u884c\u3048\u308b\u3002\n$ sudo bash -c 'curl -L http://toolbelt.treasuredata.com/sh/install-redhat.sh | sh'\n$ sudo service td-agent start\n$ sudo chkconfig td-agent on\n\n\u30bf\u30b0\u3092\u52d5\u7684\u306b\u6271\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u3092\u6271\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem update\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-forest\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-config-expander\n\n\n6. Elasticsearch\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nElasticsearch\u306bJava\u304c\u5fc5\u8981\u3060\u304c\u3001Amazon Linux AMI (HVM)\u306b\u306fJava\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3002\n\u516c\u5f0f\u30b5\u30a4\u30c8 \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.2.2.noarch.rpm\n$ sudo rpm -ivh elasticsearch-1.2.2.noarch.rpm\n$ sudo chkconfig elasticsearch on\n\n$ sudo service elasticsearch status\n\n\u52d5\u3044\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u3089\u3001\u8d77\u52d5\n$ sudo service elasticsearch start\n\nElasticsearch\u306e\u52d5\u4f5c\u78ba\u8a8d\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u767b\u9332\n$ curl -XPUT http://localhost:9200/mytest/test/1 -d '\n> {\n>   \"title\" : \"test_title\",\n>   \"text\"  : \"test_text\"\n> }'\n\n\u30c7\u30fc\u30bf\u3092\u691c\u7d22\n$ curl -XGET http://localhost:9200/mytest/test/_search -d '\n> {\n>   \"query\":\n>   { \"match\":{\"title\":\"test_title\"}}\n> }'\n\nKuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nKuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001Elasticsearch\u7528\u306e\u65e5\u672c\u8a9e\u89e3\u6790\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3042\u308b\u3002\nelasticsearch/elasticsearch-analysis-kuromoji\nElasticsearch\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3002\n$ sudo /usr/share/elasticsearch/bin/plugin -install elasticsearch/elasticsearch-analysis-kuromoji/2.2.0\n\nElasticSearch\u306e\u518d\u8d77\u52d5\n$ sudo service elasticsearch restart\n\n\u30c6\u30b9\u30c8\u7528\u306e\u767b\u9332\n$ curl -XPUT 'http://localhost:9200/kuro_test/' -d'\n  {\n      \"index\":{\n          \"analysis\":{\n              \"tokenizer\" : {\n                  \"kuromoji\" : {\n                     \"type\" : \"kuromoji_tokenizer\"\n                  }\n              },\n              \"analyzer\" : {\n                  \"analyzer\" : {\n                      \"type\" : \"custom\",\n                      \"tokenizer\" : \"kuromoji\"\n                  }\n              }\n          }\n      }\n  }'\n\n\u30c6\u30b9\u30c8\n$ curl -XPOST 'http://localhost:9200/kuro_test/_analyze?analyzer=analyzer&petty' -d '\u8cb4\u793e\u306e\u8a18\u8005'\n\nElasticsearch\u3068Kuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\n$ sudo vi /etc/elasticsearch/elasticsearch.yml\n\nindex.analysis.analyzer.default.type: custom\nindex.analysis.analyzer.default.tokenizer: kuromoji_tokenizer\n\n$ sudo service elasticsearch restart\n\n\u30c6\u30b9\u30c8\u7528\u306e\u767b\u9332\n$ curl -XPUT http://localhost:9200/jptest/test/1 -d '\n>  {\n>    \"title\" : \"\u30e1\u30e2\",\n>    \"text\"  : \"\u6885\u9152\u306f\u6c34\"\n>  }'\n\n$ curl -XPUT http://localhost:9200/jptest/test/1 -d '\n>  {\n>    \"title\" : \"\u30e1\u30e2\",\n>    \"text\"  : \"\u6885\u9152\u306f\u6c34\"\n>  }'\n\n\u6885\u9152\u3067\u691c\u7d22\n$ curl -XGET http://localhost:9200/jptest/test/_search -d '\n>    {\n>      \"query\":\n>      { \"match\":{\"text\":\"\u6885\u9152\"}}\n>    }'\n\n\u6885\u9152\u306f\u3067\u691c\u7d22\n$ curl -XGET http://localhost:9200/jptest/test/_search -d '\n>    {\n>      \"query\":\n>      { \"match\":{\"text\":\"\u6885\u9152\u306f\"}}\n>    }'\n\n\u4e21\u8005\u306e\u30b9\u30b3\u30a2\u306e\u9055\u3044\u3092\u78ba\u8a8d\u3059\u308b\u3002\nElasticsearch\u3092fluentd\u3067\u5229\u7528\u3059\u308b\u305f\u3081\u306bfluent-plugin-elasticsearch\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-elasticsearch\n\n\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3059\u3079\u3066\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8868\u793a\n$ curl -X GET http://localhost:9200/_aliases\n\n\u6b21\u306e\u4f5c\u696d\u306e\u305f\u3081\u306b\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3066\u304a\u304f\n$ curl -XDELETE 'http://localhost:9200/*'\n\n\n7. fluent-plugin-twitter\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ny-ken/fluent-plugin-twitter\n$ sudo yum install openssl-devel libcurl libcurl-devel\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install eventmachine\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-twitter\n\ndev.twitter.com\u3067\u30a2\u30d7\u30ea\u767b\u9332\u3057\u3001\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u5165\u624b\u3059\u308b\u3002\n\nAPI key\nAPI secret\nAccess token\nAccess token secret\n\n$ sudo vi /etc/td-agent/td-agent.conf\n\n<source>\n  type twitter\n  consumer_key        xxxxxxxx # API key\n  consumer_secret     yyyyyyyy # API secret key\n  oauth_token         zzzzzzzz # Access token\n  oauth_token_secret  pppppppp # Access token secret\n  tag                 input.twitter.sampling\n  timeline            sampling\n  keyword             daihyo\n  lang                ja,en\n  output_format       nest\n</source>\n\n<match input.twitter.sampling>\n  type copy\n  <store>\n    type file\n    path /tmp/twitter\n  </store>\n  <store>\n    type elasticsearch\n    include_tag_key true\n    tag_key @log_name\n    host 127.0.0.1\n    port 9200\n    logstash_format true\n    logstash_prefix twitter\n    flush_interval 10s\n  </store>\n</match>\n\n$ sudo service td-agent restart\n\nprocess finished code=6\u3067td-agent\u304c\u843d\u3061\u3066\u3057\u307e\u3046\u5834\u5408\u3001openssl-devel, eventmachine\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u89e3\u6c7a\u3059\u308b\uff08\u3053\u3068\u304c\u3042\u308b\uff1f\uff09\ntwitter-2014.07.15\u306ffluent-plugin-twitter\u304c\u4f5c\u3063\u3066\u304f\u308c\u308b\u306f\u305a\u3002\n\u5206\u304b\u3089\u306a\u3051\u308c\u3070\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3059\u3079\u3066\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8868\u793a\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3002\n$ curl -X GET http://localhost:9200/twitter-2014.07.15/_search -d '\n{\n\"query\":\n{ \"match\":{\"text\":\"daihyo\"}}\n}'\n\n\n8. Kibana\nKibana\u306fElasticsearch\u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u3001Kibana\u3092\u4f7f\u3046\u4e8b\u306b\u3088\u3063\u3066\u3001\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u30c7\u30fc\u30bf\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u5206\u6790\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\nKibana\u306f9200\u30dd\u30fc\u30c8\u7d4c\u7531\u3067Elasticsearch\u306b\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001Apache\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u7d4c\u7531\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nkibana.example.com\u306f\u30f4\u30a1\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u7528\u306e\u30a2\u30c9\u30ec\u30b9\u3002\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\n$ sudo useradd kibana\n$ sudo chmod +x /home/kibana\n$ sudo su - kibana\n# curl -LO http://download.elasticsearch.org/kibana/kibana/kibana-latest.zip\n# unzip kibana-latest.zip\n# ln -s /home/kibana/kibana-latest ./kibana\n# vi /home/kibana/kibana/config.js\n# grep okochang /home/kibana/kibana/config.js\n    elasticsearch: \"http://kibana.example.com/es/\",\n# exit\n\n$ sudo yum install httpd -y\n\ndigest\u8a8d\u8a3c\u3092\u3059\u308b\u306a\u3089\n$ sudo htdigest -c /etc/httpd/conf/htdigest \"Required authentication\" kibana\n\n$ sudo vi /etc/httpd/conf.d/kibana.conf\n\n\n/etc/httpd/conf.d/kibana.conf\nNameVirtualHost *:80\n<VirtualHost *:80>\n    DocumentRoot /home/kibana/kibana\n    ServerName kibana.example.com\n    ProxyPass /es/ http://localhost:9200/\n    ProxyPassReverse /es/ http://localhost:9200/\n    CustomLog logs/access_log custom\n    ErrorLog logs/error_log\n    Options FollowSymLinks\n#    <Location />\n#        AuthType Digest\n#        AuthName \"Required authentication\"\n#        AuthUserFile /etc/httpd/conf/htdigest\n#        require valid-user\n#        Satisfy any\n#        Order deny,allow\n#        Deny from all\n#        Allow from 127.0.0.1\n#    </Location>\n</VirtualHost>\n\n\n\u5fc5\u8981\u306a\u3089\u30f4\u30a1\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u7528\u306e\u30b5\u30fc\u30d0\u540d\u3092DNS\u767b\u9332\u3059\u308b\u3002\n\u30d6\u30e9\u30a6\u30b6\u3067 http://kibana.example.com \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001Dashboard\u304b\u3089\u30c7\u30fc\u30bf\u304c\u95b2\u89a7\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n\u3084\u308a\u6b8b\u3057\n\n\u30c7\u30fc\u30bf\u3092s3\u306b\u3082\u4fdd\u5b58\u3057\u3066\u304a\u304f\ntd-agent2\u3078\u306e\u5bfe\u5fdc http://qiita.com/repeatedly/items/5904e81e1856e0671684\n\n\n\n\u53c2\u8003\u306b\u3057\u305fWeb\u30da\u30fc\u30b8\n\nInstalling Fluentd Using rpm Package | Fluentd http://docs.fluentd.org/articles/install-by-rpm\n\nfluentd\u3067\u30ed\u30b0\u3092S3\u306b\u683c\u7d0d\u3059\u308b - OpenGroove http://open-groove.net/fluentd/fluentd-s3/\n\nKuromoji\u3067\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22 \u2013 AWS\u3067\u59cb\u3081\u308bElasticSearch(1) \uff5c Developers.IO http://dev.classmethod.jp/cloud/aws/use-elasticsearch-1-use-kuromoji/\n\nfluentd \u3068 Elasticsearch \u3068 kibana \u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u3068\u3066\u3082\u6c17\u306b\u5165\u3063\u305f\u306e\u3067\u30e1\u30e2 - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032 XP http://inokara.hateblo.jp/entry/2013/09/07/122149\n\nfluentd + fluent-plugin-twitter + elasticsearch + kibana \u3067\u304a\u624b\u8efd\u306b\u30c4\u30a4\u30fc\u30c8\u3092\u53ef\u8996\u5316\u3059\u308b\u8a66\u307f - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032 XP http://inokara.hateblo.jp/entry/2013/12/05/072519\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u5165\u308c\u308b\u3068\u3001\u300cprocess finished code=6\u300d\u3067\u843d\u3061\u307e\u3059 \u00b7 Issue #3 \u00b7 y-ken/fluent-plugin-twitter https://github.com/y-ken/fluent-plugin-twitter/issues/3\n\nFluentd\u304b\u3089Elasticsearch\u306b\u8ee2\u9001\u3057\u3066Kibana\u3067\u53ef\u8996\u5316\u3059\u308b - okochang\u306e\u30a4\u30f3\u30d5\u30e9\u65e5\u8a8c http://okochang.hatenablog.jp/entry/2014/03/21/191523\n\nElasticsearch - Elastic Search\u3067\u5168\u3066\u306e\u30c7\u30fc\u30bf(index)\u3092\u524a\u9664\u3059\u308b - Qiita http://qiita.com/bounscale/items/c2d2eb6cf61bb1fa8e1b\n\n\nAWS EC2\u4e0a\u306bfluentd + fluent-plugin-twitter + elasticsearch + kibana \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30e1\u30e2\u3002\n\n\n# 0. instance\u7acb\u3061\u4e0a\u3052\n\nEC2\u4e0a\u306binstance\u3092\u7acb\u3061\u4e0a\u3052\u308b\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u304a\u8a66\u3057\u306a\u3089t2.micro\u3067\u3082\u826f\u3044\u304b\u3082\u3002\n\nAWS t2.micro\nOS: Amazon Linux AMI (HVM)\n\n\u30c4\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u306fS3\u4e0a\u306b\u4e0a\u3052\u3066\u304a\u304f\u3068\u3001\u5916\u90e8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3088\u308a\u5c11\u3057\u65e9\u3044\u3057\u3001\u304a\u8ca1\u5e03\u306b\u3082\u5c11\u3057\u512a\u3057\u3044\u3002\n\n\n# 1. yum update\n\n```bash\n$ sudo yum update -y\n```\n\n# 2. swap\u8a2d\u5b9a\n\nEC2instance\u304ct2.micro\u306e\u3068\u304dswap\u9818\u57df\u3092\u8a2d\u5b9a\u3059\u308b\n\n```bash\n$ sudo dd if=/dev/zero of=/swap.img bs=1M count=2048\n$ sudo chmod 600 /swap.img\n$ sudo mkswap /swap.img\n$ sudo bash -c 'echo \"/swap.img    swap    swap    defaults    0    0\" >> /etc/fstab'\n```\n\nswap\u3092\u6709\u52b9\u306b\u3059\u308b\n\n```bash\n$ sudo swapon -a\n```\n\n# 3. \u65e5\u672c\u6642\u9593\u306b\u8a2d\u5b9a\n\n```bash\n$ sudo vi /etc/sysconfig/clock\n```\nZONE=\"Asia/Tokyo\"\n\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\n```bash\n$ sudo ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n$ sudo reboot\n```\n\n# 4. \u958b\u767a\u74b0\u5883\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo yum -y install gcc* make\n```\n\n\n# 5. TreasureData\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3002\n\ninstall-redhat.sh \u306b\u3088\u308ayum\u30ec\u30dd\u30b8\u30c8\u30ea\u306e\u767b\u9332\u3068\u3001td-agent\u306erpm\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u884c\u3048\u308b\u3002\n\n```bash\n$ sudo bash -c 'curl -L http://toolbelt.treasuredata.com/sh/install-redhat.sh | sh'\n$ sudo service td-agent start\n$ sudo chkconfig td-agent on\n```\n\n\u30bf\u30b0\u3092\u52d5\u7684\u306b\u6271\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u3092\u6271\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8ffd\u52a0\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```bash\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem update\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-forest\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-config-expander\n```\n\n# 6. Elasticsearch\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nElasticsearch\u306bJava\u304c\u5fc5\u8981\u3060\u304c\u3001Amazon Linux AMI (HVM)\u306b\u306fJava\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3002\n\n[\u516c\u5f0f\u30b5\u30a4\u30c8](http://www.elasticsearch.org/download/) \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash\n$ wget https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.2.2.noarch.rpm\n$ sudo rpm -ivh elasticsearch-1.2.2.noarch.rpm\n$ sudo chkconfig elasticsearch on\n```\n\n```bash\n$ sudo service elasticsearch status\n```\n\u52d5\u3044\u3066\u3044\u306a\u3044\u3088\u3046\u306a\u3089\u3001\u8d77\u52d5\n\n```bash\n$ sudo service elasticsearch start\n```\n\nElasticsearch\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u767b\u9332\n\n```bash\n$ curl -XPUT http://localhost:9200/mytest/test/1 -d '\n> {\n>   \"title\" : \"test_title\",\n>   \"text\"  : \"test_text\"\n> }'\n```\n\n\u30c7\u30fc\u30bf\u3092\u691c\u7d22\n\n```bash\n$ curl -XGET http://localhost:9200/mytest/test/_search -d '\n> {\n>   \"query\":\n>   { \"match\":{\"title\":\"test_title\"}}\n> }'\n```\n\nKuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nKuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u3001Elasticsearch\u7528\u306e\u65e5\u672c\u8a9e\u89e3\u6790\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3042\u308b\u3002\n\n[elasticsearch/elasticsearch-analysis-kuromoji](https://github.com/elasticsearch/elasticsearch-analysis-kuromoji)\n\nElasticsearch\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u306e\u3067\u6ce8\u610f\u3002\n\n```bash\n$ sudo /usr/share/elasticsearch/bin/plugin -install elasticsearch/elasticsearch-analysis-kuromoji/2.2.0\n```\n\nElasticSearch\u306e\u518d\u8d77\u52d5\n\n```bash\n$ sudo service elasticsearch restart\n```\n\n\u30c6\u30b9\u30c8\u7528\u306e\u767b\u9332\n\n```bash\n$ curl -XPUT 'http://localhost:9200/kuro_test/' -d'\n  {\n      \"index\":{\n          \"analysis\":{\n              \"tokenizer\" : {\n                  \"kuromoji\" : {\n                     \"type\" : \"kuromoji_tokenizer\"\n                  }\n              },\n              \"analyzer\" : {\n                  \"analyzer\" : {\n                      \"type\" : \"custom\",\n                      \"tokenizer\" : \"kuromoji\"\n                  }\n              }\n          }\n      }\n  }'\n```\n\n\u30c6\u30b9\u30c8\n\n```bash\n$ curl -XPOST 'http://localhost:9200/kuro_test/_analyze?analyzer=analyzer&petty' -d '\u8cb4\u793e\u306e\u8a18\u8005'\n```\n\n\nElasticsearch\u3068Kuromoji\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22\n\n```bash\n$ sudo vi /etc/elasticsearch/elasticsearch.yml\n```\n\n```\nindex.analysis.analyzer.default.type: custom\nindex.analysis.analyzer.default.tokenizer: kuromoji_tokenizer\n```\n\n```bash\n$ sudo service elasticsearch restart\n```\n\n\u30c6\u30b9\u30c8\u7528\u306e\u767b\u9332\n\n```bash\n$ curl -XPUT http://localhost:9200/jptest/test/1 -d '\n>  {\n>    \"title\" : \"\u30e1\u30e2\",\n>    \"text\"  : \"\u6885\u9152\u306f\u6c34\"\n>  }'\n```\n\n```bash\n$ curl -XPUT http://localhost:9200/jptest/test/1 -d '\n>  {\n>    \"title\" : \"\u30e1\u30e2\",\n>    \"text\"  : \"\u6885\u9152\u306f\u6c34\"\n>  }'\n```\n\n\u6885\u9152\u3067\u691c\u7d22\n\n```bash\n$ curl -XGET http://localhost:9200/jptest/test/_search -d '\n>    {\n>      \"query\":\n>      { \"match\":{\"text\":\"\u6885\u9152\"}}\n>    }'\n```\n\n\u6885\u9152\u306f\u3067\u691c\u7d22\n\n```bash\n$ curl -XGET http://localhost:9200/jptest/test/_search -d '\n>    {\n>      \"query\":\n>      { \"match\":{\"text\":\"\u6885\u9152\u306f\"}}\n>    }'\n```\n\n\u4e21\u8005\u306e\u30b9\u30b3\u30a2\u306e\u9055\u3044\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nElasticsearch\u3092fluentd\u3067\u5229\u7528\u3059\u308b\u305f\u3081\u306bfluent-plugin-elasticsearch\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-elasticsearch\n```\n\n\n\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3059\u3079\u3066\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8868\u793a\n\n```bash\n$ curl -X GET http://localhost:9200/_aliases\n```\n\n\u6b21\u306e\u4f5c\u696d\u306e\u305f\u3081\u306b\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3057\u3066\u304a\u304f\n\n```bash\n$ curl -XDELETE 'http://localhost:9200/*'\n```\n\n# 7. fluent-plugin-twitter\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[y-ken/fluent-plugin-twitter](https://github.com/y-ken/fluent-plugin-twitter)\n\n```bash\n$ sudo yum install openssl-devel libcurl libcurl-devel\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install eventmachine\n$ sudo /usr/lib64/fluent/ruby/bin/fluent-gem install fluent-plugin-twitter\n```\n\ndev.twitter.com\u3067\u30a2\u30d7\u30ea\u767b\u9332\u3057\u3001\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u5165\u624b\u3059\u308b\u3002\n\n- API key\n- API secret\n- Access token\n- Access token secret\n\n\n```bash\n$ sudo vi /etc/td-agent/td-agent.conf\n```\n\n\n```\n<source>\n  type twitter\n  consumer_key        xxxxxxxx # API key\n  consumer_secret     yyyyyyyy # API secret key\n  oauth_token         zzzzzzzz # Access token\n  oauth_token_secret  pppppppp # Access token secret\n  tag                 input.twitter.sampling\n  timeline            sampling\n  keyword             daihyo\n  lang                ja,en\n  output_format       nest\n</source>\n\n<match input.twitter.sampling>\n  type copy\n  <store>\n    type file\n    path /tmp/twitter\n  </store>\n  <store>\n    type elasticsearch\n    include_tag_key true\n    tag_key @log_name\n    host 127.0.0.1\n    port 9200\n    logstash_format true\n    logstash_prefix twitter\n    flush_interval 10s\n  </store>\n</match>\n```\n\n```bash\n$ sudo service td-agent restart\n```\n\nprocess finished code=6\u3067td-agent\u304c\u843d\u3061\u3066\u3057\u307e\u3046\u5834\u5408\u3001openssl-devel, eventmachine\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u89e3\u6c7a\u3059\u308b\uff08\u3053\u3068\u304c\u3042\u308b\uff1f\uff09\n\ntwitter-2014.07.15\u306ffluent-plugin-twitter\u304c\u4f5c\u3063\u3066\u304f\u308c\u308b\u306f\u305a\u3002\n\u5206\u304b\u3089\u306a\u3051\u308c\u3070\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3059\u3079\u3066\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8868\u793a\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3068\u826f\u3044\u3002\n\n\n```bash\n$ curl -X GET http://localhost:9200/twitter-2014.07.15/_search -d '\n{\n\"query\":\n{ \"match\":{\"text\":\"daihyo\"}}\n}'\n```\n\n# 8. Kibana\n\nKibana\u306fElasticsearch\u306e\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3067\u3001Kibana\u3092\u4f7f\u3046\u4e8b\u306b\u3088\u3063\u3066\u3001\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u30c7\u30fc\u30bf\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u5206\u6790\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nKibana\u306f9200\u30dd\u30fc\u30c8\u7d4c\u7531\u3067Elasticsearch\u306b\u63a5\u7d9a\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u3001Apache\u306e\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3092\u7d4c\u7531\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\nkibana.example.com\u306f\u30f4\u30a1\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u7528\u306e\u30a2\u30c9\u30ec\u30b9\u3002\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u3053\u3068\u3002\n\n```bash\n$ sudo useradd kibana\n$ sudo chmod +x /home/kibana\n$ sudo su - kibana\n# curl -LO http://download.elasticsearch.org/kibana/kibana/kibana-latest.zip\n# unzip kibana-latest.zip\n# ln -s /home/kibana/kibana-latest ./kibana\n# vi /home/kibana/kibana/config.js\n# grep okochang /home/kibana/kibana/config.js\n    elasticsearch: \"http://kibana.example.com/es/\",\n# exit\n```\n\n```bash\n$ sudo yum install httpd -y\n```\n\ndigest\u8a8d\u8a3c\u3092\u3059\u308b\u306a\u3089\n\n```bash\n$ sudo htdigest -c /etc/httpd/conf/htdigest \"Required authentication\" kibana\n```\n\n```bash\n$ sudo vi /etc/httpd/conf.d/kibana.conf\n```\n\n```apache:/etc/httpd/conf.d/kibana.conf\nNameVirtualHost *:80\n<VirtualHost *:80>\n    DocumentRoot /home/kibana/kibana\n    ServerName kibana.example.com\n    ProxyPass /es/ http://localhost:9200/\n    ProxyPassReverse /es/ http://localhost:9200/\n    CustomLog logs/access_log custom\n    ErrorLog logs/error_log\n    Options FollowSymLinks\n#    <Location />\n#        AuthType Digest\n#        AuthName \"Required authentication\"\n#        AuthUserFile /etc/httpd/conf/htdigest\n#        require valid-user\n#        Satisfy any\n#        Order deny,allow\n#        Deny from all\n#        Allow from 127.0.0.1\n#    </Location>\n</VirtualHost>\n```\n\n\u5fc5\u8981\u306a\u3089\u30f4\u30a1\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u7528\u306e\u30b5\u30fc\u30d0\u540d\u3092DNS\u767b\u9332\u3059\u308b\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u3067 http://kibana.example.com \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001Dashboard\u304b\u3089\u30c7\u30fc\u30bf\u304c\u95b2\u89a7\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n# \u3084\u308a\u6b8b\u3057\n- \u30c7\u30fc\u30bf\u3092s3\u306b\u3082\u4fdd\u5b58\u3057\u3066\u304a\u304f\n- td-agent2\u3078\u306e\u5bfe\u5fdc http://qiita.com/repeatedly/items/5904e81e1856e0671684\n\n# \u53c2\u8003\u306b\u3057\u305fWeb\u30da\u30fc\u30b8\n\n- Installing Fluentd Using rpm Package | Fluentd http://docs.fluentd.org/articles/install-by-rpm\n- fluentd\u3067\u30ed\u30b0\u3092S3\u306b\u683c\u7d0d\u3059\u308b - OpenGroove http://open-groove.net/fluentd/fluentd-s3/\n- Kuromoji\u3067\u65e5\u672c\u8a9e\u5168\u6587\u691c\u7d22 \u2013 AWS\u3067\u59cb\u3081\u308bElasticSearch(1) \uff5c Developers.IO http://dev.classmethod.jp/cloud/aws/use-elasticsearch-1-use-kuromoji/\n- fluentd \u3068 Elasticsearch \u3068 kibana \u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u3068\u3066\u3082\u6c17\u306b\u5165\u3063\u305f\u306e\u3067\u30e1\u30e2 - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032 XP http://inokara.hateblo.jp/entry/2013/09/07/122149\n- fluentd + fluent-plugin-twitter + elasticsearch + kibana \u3067\u304a\u624b\u8efd\u306b\u30c4\u30a4\u30fc\u30c8\u3092\u53ef\u8996\u5316\u3059\u308b\u8a66\u307f - \u3088\u3046\u3078\u3044\u306e\u65e5\u3005\u7cbe\u9032 XP http://inokara.hateblo.jp/entry/2013/12/05/072519\n- \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\u3092\u5165\u308c\u308b\u3068\u3001\u300cprocess finished code=6\u300d\u3067\u843d\u3061\u307e\u3059 \u00b7 Issue #3 \u00b7 y-ken/fluent-plugin-twitter https://github.com/y-ken/fluent-plugin-twitter/issues/3\n- Fluentd\u304b\u3089Elasticsearch\u306b\u8ee2\u9001\u3057\u3066Kibana\u3067\u53ef\u8996\u5316\u3059\u308b - okochang\u306e\u30a4\u30f3\u30d5\u30e9\u65e5\u8a8c http://okochang.hatenablog.jp/entry/2014/03/21/191523\n- Elasticsearch - Elastic Search\u3067\u5168\u3066\u306e\u30c7\u30fc\u30bf(index)\u3092\u524a\u9664\u3059\u308b - Qiita http://qiita.com/bounscale/items/c2d2eb6cf61bb1fa8e1b\n", "tags": ["fluentd", "kibana", "Elasticsearch", "AWS"]}