{"context": "\u3061\u3087\u3063\u3068\u524d\u307e\u3067\u306fMechanize\u3068\u304b\u3067\u3084\u3063\u3066\u305f\u3093\u3067\u3059\u304c\u3001\u6700\u8fd1\u306e\u306fJavascript\u304c\u52d5\u304f\u306e\u304c\u524d\u63d0\u306a\u30b5\u30a4\u30c8\u304c\u591a\u3044\u306e\u3067\u3001Capybara+Poltergeist\u3067\u3084\u308b\u3053\u3068\u306b\u3057\u3066\u307e\u3059\u3002\n\u6027\u80fd\u3067\u554f\u984c\u304c\u51fa\u305f\u6642\u3060\u3051Mechanize\u3068\u304b\u306b\u3059\u308c\u3070\u826f\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3002\n\nPhantomJS\u5165\u308c\u308b\nbrew install phantomjs\n\n\nGem\u5165\u308c\u308b\n\nGemfile\ngem 'nokogiri'\ngem 'poltergeist'\ngem 'capybara'\n\n\n\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3053\u308d\u307e\u3067\nUser-Agent\u306f\u9069\u5f53\u306b\n\nrequire 'capybara/poltergeist'\n\nCapybara.register_driver :poltergeist do |app|\n  Capybara::Poltergeist::Driver.new(app, {:js_errors => false, :timeout => 5000 })\nend\n\nsession = Capybara::Session.new(:poltergeist)\n\nsession.driver.headers = {\n    'User-Agent' => \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2564.97 Safari/537.36\"\n}\nsession.visit \"http://www.yahoo.co.jp\"\n\n\nCapybara\u5468\u308a\u306e\u4f7f\u3044\u65b9\n\nID/\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3057\u3066\u6b21\u306e\u30da\u30fc\u30b8\u30d8\nemail_input = session.find('input#email')\nemail_input.native.send_key('mail@example.com')\n\npassword_input = session.find('input#password')\npassword_input.native.send_key('mypassword')\n\nsubmit = session.find('#submit-button')\nsubmit.trigger('click')\n\n\nhtml\u3092\u53d6\u5f97\nhtml = session.html\n\n\niframe\u306e\u4e2d\u306eHTML\u3092\u53d6\u5f97\niframe_html = session.evaluate_script('$(\"#IFrame\")[0].contentWindow.document.body.innerHTML')\n\n\nhtml\u3092\u30d1\u30fc\u30b9\u3057\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\ndoc = Nokogiri::HTML.parse(html)\n\n\nNokogiri\u306e\u4f7f\u3044\u65b9\n\u53c2\u8003: http://d.hatena.ne.jp/otn/20090509/p1\n\u57fa\u672c\u7684\u306b\u306fCSS\u30bb\u30ec\u30af\u30bf\u6d3e\u306a\u306e\u3067\u305d\u306e\u4f7f\u3044\u65b9\u3092\u30e1\u30a4\u30f3\u306b\n\ncss\u30bb\u30ec\u30af\u30bf\u3067\u8981\u7d20\u3092\u691c\u7d22\nelements = doc.css('.section')\n\n\u53c2\u8003 http://weboook.blog22.fc2.com/blog-entry-268.html\n\nHTML\u3092\u53d6\u5f97\nto_html = doc.to_html\ninner_html = doc.inner_html\n\n\n\u5c5e\u6027\nkeys = doc.keys #\u5c5e\u6027\u540d\nvalues = doc.values #\u5c5e\u6027\u5024\nattributes = doc.attributes #\u30cf\u30c3\u30b7\u30e5\u3067\n\n\u3053\u308c\u304f\u3089\u3044\u3042\u308c\u3070\u3060\u3044\u305f\u3044\u306a\u3093\u3067\u3082\u3067\u304d\u308b\u306f\u305a\uff08\u305f\u3076\u3093\uff09\u3002\n\n\u3061\u3087\u3063\u3068\u524d\u307e\u3067\u306fMechanize\u3068\u304b\u3067\u3084\u3063\u3066\u305f\u3093\u3067\u3059\u304c\u3001\u6700\u8fd1\u306e\u306fJavascript\u304c\u52d5\u304f\u306e\u304c\u524d\u63d0\u306a\u30b5\u30a4\u30c8\u304c\u591a\u3044\u306e\u3067\u3001Capybara+Poltergeist\u3067\u3084\u308b\u3053\u3068\u306b\u3057\u3066\u307e\u3059\u3002\n\n\u6027\u80fd\u3067\u554f\u984c\u304c\u51fa\u305f\u6642\u3060\u3051Mechanize\u3068\u304b\u306b\u3059\u308c\u3070\u826f\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3002\n\n\n# PhantomJS\u5165\u308c\u308b\n\n```\nbrew install phantomjs\n```\n\n# Gem\u5165\u308c\u308b\n\n```rb:Gemfile\ngem 'nokogiri'\ngem 'poltergeist'\ngem 'capybara'\n```\n\n# \u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3053\u308d\u307e\u3067\n\nUser-Agent\u306f\u9069\u5f53\u306b\n\n```rb\n\nrequire 'capybara/poltergeist'\n\nCapybara.register_driver :poltergeist do |app|\n  Capybara::Poltergeist::Driver.new(app, {:js_errors => false, :timeout => 5000 })\nend\n\nsession = Capybara::Session.new(:poltergeist)\n\nsession.driver.headers = {\n    'User-Agent' => \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2564.97 Safari/537.36\"\n}\nsession.visit \"http://www.yahoo.co.jp\"\n```\n\n# Capybara\u5468\u308a\u306e\u4f7f\u3044\u65b9\n\n## ID/\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3057\u3066\u6b21\u306e\u30da\u30fc\u30b8\u30d8\n\n```rb\nemail_input = session.find('input#email')\nemail_input.native.send_key('mail@example.com')\n\npassword_input = session.find('input#password')\npassword_input.native.send_key('mypassword')\n\nsubmit = session.find('#submit-button')\nsubmit.trigger('click')\n```\n\n## html\u3092\u53d6\u5f97\n\n```rb\nhtml = session.html\n```\n\n## iframe\u306e\u4e2d\u306eHTML\u3092\u53d6\u5f97\n\n```rb\niframe_html = session.evaluate_script('$(\"#IFrame\")[0].contentWindow.document.body.innerHTML')\n````\n\n## html\u3092\u30d1\u30fc\u30b9\u3057\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\n\n```rb\ndoc = Nokogiri::HTML.parse(html)\n```\n\n\n# Nokogiri\u306e\u4f7f\u3044\u65b9\n\n\u53c2\u8003: http://d.hatena.ne.jp/otn/20090509/p1\n\n\u57fa\u672c\u7684\u306b\u306fCSS\u30bb\u30ec\u30af\u30bf\u6d3e\u306a\u306e\u3067\u305d\u306e\u4f7f\u3044\u65b9\u3092\u30e1\u30a4\u30f3\u306b\n\n### css\u30bb\u30ec\u30af\u30bf\u3067\u8981\u7d20\u3092\u691c\u7d22\n```rb\nelements = doc.css('.section')\n```\n\n\u53c2\u8003 http://weboook.blog22.fc2.com/blog-entry-268.html\n\n### HTML\u3092\u53d6\u5f97\n\n```rb\nto_html = doc.to_html\ninner_html = doc.inner_html\n```\n\n### \u5c5e\u6027\n\n```rb\nkeys = doc.keys #\u5c5e\u6027\u540d\nvalues = doc.values #\u5c5e\u6027\u5024\nattributes = doc.attributes #\u30cf\u30c3\u30b7\u30e5\u3067\n```\n\n\n\n\u3053\u308c\u304f\u3089\u3044\u3042\u308c\u3070\u3060\u3044\u305f\u3044\u306a\u3093\u3067\u3082\u3067\u304d\u308b\u306f\u305a\uff08\u305f\u3076\u3093\uff09\u3002\n", "tags": ["Nokogiri", "PhantomJS", "Capybara", "scraping", "Ruby"]}