{"context": "\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067Ajax\u3067\u30d0\u30a4\u30ca\u30ea\u753b\u50cf\u3092\u53d7\u3051\u53d6\u308a\u8868\u793a\u3059\u308b\u3002\n\n\u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u8fd4\u3059API\n\u30c6\u30b9\u30c8\u7528\u306bRails\u3067\u9069\u5f53\u306a\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u305d\u306e\u307e\u307e\u8fd4\u3059API\u3092\u4f5c\u308b\u3002\n\ncapture_controller.rb\ndef load\n  send_data binary, type: 'image/jpeg', disposition: 'inline'\nend\n\ndef binary\n  path = \"#{Rails.root}/tmp/test.jpg\"\n  img = File.open(path, 'r')\n  img.read\nend\n\n\n\nAjax\u3067\u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\nXMLHttpRequest\u3092\u4f7f\u3046\n\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092Ajax\u3067\u53d6\u5f97\u3059\u308b\u969b\u306b\u6ce8\u610f\u3059\u308b\u70b9\n\u2191\u3053\u3053\u306b\u66f8\u3044\u3066\u3044\u3042\u308b\u3053\u3068\u3068\u540c\u3058\u3068\u3053\u308d\u3067\u306f\u307e\u3063\u305f\u3002\njQuery\u306e$.ajax()\u3067\u666e\u901a\u306b\u53d6\u5f97\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3059\u308b\u3068\u3001\u30d0\u30a4\u30ca\u30ea\u304c\u30c6\u30ad\u30b9\u30c8\u3068\u3057\u3066\u6271\u308f\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\nXMLHttpRequest\u3067responseType\u306bblob\u304barraybuffer\u3092\u6307\u5b9a\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067\u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nvar loadBinaryImage = function(path, cb, type) {\n  var xhr = new XMLHttpRequest();\n  xhr.onreadystatechange = function(){\n    if (this.readyState == 4 && this.status == 200) {\n      cb(this.response);\n    }\n  }\n  xhr.open('GET', path);\n  xhr.responseType = type || 'blob';\n  xhr.send();\n}\n\n\uff08\u3061\u306a\u307f\u306b$.ajax()\u3067\u30d0\u30a4\u30ca\u30ea\u3092\u53d7\u3051\u53d6\u308b\u65b9\u6cd5\u3082\u3042\u308b\u307f\u305f\u3044\uff09\n\nBlob\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\nresponseType='blob'\u306b\u3057\u3066\u53d7\u3051\u53d6\u308a\u753b\u50cf\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3002\n\nURL.createObjectURL\n\nURL.createObjectURL\u3092\u4f7f\u3063\u3066\u753b\u50cf\u8868\u793a\u3059\u308b\u3002\n// URL.createObjectURL\nvar showImageByCreateObjectURL = function(blob) {\n  var img = document.getElementById(\"imgTest\");\n  var url = window.URL || window.webkitURL;\n  img.src = url.createObjectURL(blob);\n}\n\n\nFileReader\n\nFileReader\u3067blob\u3092DataURL\u3068\u3057\u3066\u8aad\u307f\u3001Img\u30bf\u30b0\u306esrc\u306b\u5165\u308c\u308b\u3002\n// FileReader\nvar showImageByFileReader = function(blob) {\n  var reader = new FileReader();\n  reader.onloadend = function() {\n    var img = document.getElementById(\"imgTest\");\n    img.src = reader.result;\n  }\n  // DataURL\u3068\u3057\u3066\u8aad\u307f\u8fbc\u3080\n  reader.readAsDataURL(blob);\n}\n\n\nArrayBuffer\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\nresponseType='arraybuffer'\u306b\u3057\u3066\u53d7\u3051\u53d6\u308a\u753b\u50cf\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3002\n\nwindow.btoa\n\n// window.btoa\nvar showImageByBtoa = function(ab) {\n  var bytes = new Uint8Array(ab);\n  var binaryData = \"\";\n  for (var i = 0, len = bytes.byteLength; i < len; i++) {\n    binaryData += String.fromCharCode(bytes[i]);\n  }\n  var img = document.getElementById(\"imgTest\");\n  img.src = \"data:image/jpeg;base64,\" + window.btoa(binaryData);\n}\n\n\nblob\u306b\u5909\u63db\u3059\u308b\n\nblob\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3042\u3068\u306fURL.createObjectURL\u3084FileReader\u3092\u4f7f\u3063\u3066\u8868\u793a\u53ef\u80fd\u3002\nvar blob = new Blob([ ab ], { type: \"image/jpeg\" });\n\n\u4ed6\u306b\u3082\u3001Canvas\u306etoDataURL\u3092\u4f7f\u3046\u65b9\u6cd5\u3084\u81ea\u524d\u3067Base64\u5316\u3059\u308b\u65b9\u6cd5\u306a\u3069\u3082\u3042\u308b\u3002\n\n\u53c2\u8003\nhttp://qiita.com/tom_konda/items/484955b8332e0305ebc4\nhttp://tech-sketch.jp/2013/01/javascript-1.html\nhttp://www.qript.co.jp/blog/technique/215/\nhttp://qiita.com/weal/items/1a2af81138cd8f49937d\nhttp://stackoverflow.com/questions/32085474/how-to-put-png-binary-data-into-an-img-tag-and-display-it-as-an-image\nhttp://stackoverflow.com/questions/10982712/convert-binary-data-to-base64-with-javascript\nhttp://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067Ajax\u3067\u30d0\u30a4\u30ca\u30ea\u753b\u50cf\u3092\u53d7\u3051\u53d6\u308a\u8868\u793a\u3059\u308b\u3002\n\n# \u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u8fd4\u3059API\n\n\u30c6\u30b9\u30c8\u7528\u306bRails\u3067\u9069\u5f53\u306a\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u305d\u306e\u307e\u307e\u8fd4\u3059API\u3092\u4f5c\u308b\u3002\n\n```capture_controller.rb\ndef load\n  send_data binary, type: 'image/jpeg', disposition: 'inline'\nend\n\ndef binary\n  path = \"#{Rails.root}/tmp/test.jpg\"\n  img = File.open(path, 'r')\n  img.read\nend\n```\n\n# Ajax\u3067\u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\n\n## XMLHttpRequest\u3092\u4f7f\u3046\n\n[\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092Ajax\u3067\u53d6\u5f97\u3059\u308b\u969b\u306b\u6ce8\u610f\u3059\u308b\u70b9](http://qiita.com/tom_konda/items/484955b8332e0305ebc4)\n\u2191\u3053\u3053\u306b\u66f8\u3044\u3066\u3044\u3042\u308b\u3053\u3068\u3068\u540c\u3058\u3068\u3053\u308d\u3067\u306f\u307e\u3063\u305f\u3002\n\njQuery\u306e`$.ajax()`\u3067\u666e\u901a\u306b\u53d6\u5f97\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3059\u308b\u3068\u3001\u30d0\u30a4\u30ca\u30ea\u304c\u30c6\u30ad\u30b9\u30c8\u3068\u3057\u3066\u6271\u308f\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u3002\n\n**XMLHttpRequest\u3067responseType\u306b`blob`\u304b`arraybuffer`\u3092\u6307\u5b9a\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u3053\u3068\u3067\u753b\u50cf\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u3053\u3068\u304c\u3067\u304d\u308b\u3002**\n\n```\nvar loadBinaryImage = function(path, cb, type) {\n  var xhr = new XMLHttpRequest();\n  xhr.onreadystatechange = function(){\n    if (this.readyState == 4 && this.status == 200) {\n      cb(this.response);\n    }\n  }\n  xhr.open('GET', path);\n  xhr.responseType = type || 'blob';\n  xhr.send();\n}\n```\n\n\uff08\u3061\u306a\u307f\u306b[`$.ajax()`\u3067\u30d0\u30a4\u30ca\u30ea\u3092\u53d7\u3051\u53d6\u308b\u65b9\u6cd5](http://www.henryalgus.com/reading-binary-files-using-jquery-ajax/)\u3082\u3042\u308b\u307f\u305f\u3044\uff09\n\n## Blob\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\n\n`responseType='blob'`\u306b\u3057\u3066\u53d7\u3051\u53d6\u308a\u753b\u50cf\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3002\n\n1. URL.createObjectURL\n\n`URL.createObjectURL`\u3092\u4f7f\u3063\u3066\u753b\u50cf\u8868\u793a\u3059\u308b\u3002\n\n```\n// URL.createObjectURL\nvar showImageByCreateObjectURL = function(blob) {\n  var img = document.getElementById(\"imgTest\");\n  var url = window.URL || window.webkitURL;\n  img.src = url.createObjectURL(blob);\n}\n```\n\n2. FileReader\n\n`FileReader`\u3067blob\u3092DataURL\u3068\u3057\u3066\u8aad\u307f\u3001Img\u30bf\u30b0\u306esrc\u306b\u5165\u308c\u308b\u3002\n\n```\n// FileReader\nvar showImageByFileReader = function(blob) {\n  var reader = new FileReader();\n  reader.onloadend = function() {\n    var img = document.getElementById(\"imgTest\");\n    img.src = reader.result;\n  }\n  // DataURL\u3068\u3057\u3066\u8aad\u307f\u8fbc\u3080\n  reader.readAsDataURL(blob);\n}\n```\n\n## ArrayBuffer\u3067\u53d7\u3051\u53d6\u308b\u5834\u5408\n\n`responseType='arraybuffer'`\u306b\u3057\u3066\u53d7\u3051\u53d6\u308a\u753b\u50cf\u8868\u793a\u3059\u308b\u65b9\u6cd5\u3002\n\n1. window.btoa\n\n```\n// window.btoa\nvar showImageByBtoa = function(ab) {\n  var bytes = new Uint8Array(ab);\n  var binaryData = \"\";\n  for (var i = 0, len = bytes.byteLength; i < len; i++) {\n    binaryData += String.fromCharCode(bytes[i]);\n  }\n  var img = document.getElementById(\"imgTest\");\n  img.src = \"data:image/jpeg;base64,\" + window.btoa(binaryData);\n}\n```\n\n2. blob\u306b\u5909\u63db\u3059\u308b\n\nblob\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3001\u3042\u3068\u306fURL.createObjectURL\u3084FileReader\u3092\u4f7f\u3063\u3066\u8868\u793a\u53ef\u80fd\u3002\n\n```\nvar blob = new Blob([ ab ], { type: \"image/jpeg\" });\n```\n\n\u4ed6\u306b\u3082\u3001[Canvas\u306etoDataURL\u3092\u4f7f\u3046\u65b9\u6cd5](http://stackoverflow.com/questions/26212792/convert-an-image-to-canvas-that-is-already-loaded/26554277#26554277)\u3084[\u81ea\u524d\u3067Base64\u5316\u3059\u308b\u65b9\u6cd5](http://stackoverflow.com/questions/26212792/convert-an-image-to-canvas-that-is-already-loaded/26554277#26554277)\u306a\u3069\u3082\u3042\u308b\u3002\n\n# \u53c2\u8003\n\nhttp://qiita.com/tom_konda/items/484955b8332e0305ebc4\n\nhttp://tech-sketch.jp/2013/01/javascript-1.html\n\nhttp://www.qript.co.jp/blog/technique/215/\n\nhttp://qiita.com/weal/items/1a2af81138cd8f49937d\n\nhttp://stackoverflow.com/questions/32085474/how-to-put-png-binary-data-into-an-img-tag-and-display-it-as-an-image\n\nhttp://stackoverflow.com/questions/10982712/convert-binary-data-to-base64-with-javascript\n\nhttp://stackoverflow.com/questions/6150289/how-to-convert-image-into-base64-string-using-javascript\n", "tags": ["JavaScript", "base64"]}