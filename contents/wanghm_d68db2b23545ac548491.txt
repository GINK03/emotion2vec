{"context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\nPublicIP\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d0\u30de\u30eb\u30c1AZ\u3067\u306e\u5197\u9577\u5316\uff08Active-Stanby)\n\u4ee5\u4e0b\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\uff1a\n\nFloatingIP: \u30de\u30eb\u30c1AZ\u5bfe\u5fdc\u3067\u304d\u306a\u3044\nDNS\u30d5\u30a7\u30eb\u30aa\u30fc\u30d0\u30fc\uff1aPublicIP\u304c\u5fc5\u8981\n\n\ncli53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\neasy_install pip\npip install cli53\n\n\n\u69cb\u6210\nHA_Node_IP: 10.10.100.101, 10.10.200.101\nHOSTED_ZONE: xyz.com\nHOST: myserver\n\u521d\u671f\u767b\u9332(route53)\nmyserver A 10.10.100.101 60\n\nHA\u30e2\u30cb\u30bf\u30fc(shell)\n\u76e3\u8996\u306e\u76f8\u624b\u304b\u3089\u5fdc\u7b54\u306a\u3057\u3001\u304b\u3064\u73fe\u5728DNS\u306b\u767b\u9332\u3055\u308c\u305fIP\u306f\u76f8\u624b\u306e\u30b5\u30fc\u30d0\u306e\u5834\u5408\u3001\nDNS\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\uff08\u81ea\u5206\u306eIP\u306b\u8a2d\u5b9a\uff09\n\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306fAWS\u306eFloatingIP\u7528\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u3057\u3066\u4f5c\u6210\u3057\u305f\u3002\nrc.local\u306a\u3069\u3067\u5e38\u6642\u8d77\u52d5\n#!/bin/sh\n\n#\u76e3\u8996\u76f8\u624b\u306eIP\u3092\u8a2d\u5b9a\nHA_Node_IP=10.10.100.101\nHOSTED_ZONE=test.xyz.com\nHOST=myserver\n\nSELF_IP=$(curl -s http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho `date` \"-- Starting HA monitor\"\nwhile [ . ]; do\n  pingresult=`ping -c 3 -W 1 $HA_Node_IP | grep time= | wc -l`\n  if [ \"$pingresult\" == \"0\" ]; then\n    ACTIVE_IP=$(cli53 rrlist ${HOSTED_ZONE}|grep ^${HOST}|awk '{print $5}')\n    if [ \"SELF_IP\" != \"$ACTIVE_IP\" ]; then\n      echo `date` \"-- HA heartbeat failed, taking over domain name\"\n      cli53 rrcreate $HOSTED_ZONE $HOST A $SELF_IP --ttl 60 --replace\n    fi\n  fi\n  sleep 10\ndone\n\n## \u76ee\u7684\nPublicIP\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u30b5\u30fc\u30d0\u30de\u30eb\u30c1AZ\u3067\u306e\u5197\u9577\u5316\uff08Active-Stanby)\n\u4ee5\u4e0b\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\uff1a\n\n- FloatingIP: \u30de\u30eb\u30c1AZ\u5bfe\u5fdc\u3067\u304d\u306a\u3044\n- DNS\u30d5\u30a7\u30eb\u30aa\u30fc\u30d0\u30fc\uff1aPublicIP\u304c\u5fc5\u8981\n\n## cli53\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n<pre>\neasy_install pip\npip install cli53\n</pre>\n\n## \u69cb\u6210\n\nHA_Node_IP: 10.10.100.101, 10.10.200.101\nHOSTED_ZONE: xyz.com\nHOST: myserver\n\n\u521d\u671f\u767b\u9332(route53)\nmyserver A 10.10.100.101 60\n\n\n## HA\u30e2\u30cb\u30bf\u30fc(shell)\n\n\u76e3\u8996\u306e\u76f8\u624b\u304b\u3089\u5fdc\u7b54\u306a\u3057\u3001\u304b\u3064\u73fe\u5728DNS\u306b\u767b\u9332\u3055\u308c\u305fIP\u306f\u76f8\u624b\u306e\u30b5\u30fc\u30d0\u306e\u5834\u5408\u3001\nDNS\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\uff08\u81ea\u5206\u306eIP\u306b\u8a2d\u5b9a\uff09\n\n\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306fAWS\u306eFloatingIP\u7528\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092\u53c2\u8003\u3057\u3066\u4f5c\u6210\u3057\u305f\u3002\nrc.local\u306a\u3069\u3067\u5e38\u6642\u8d77\u52d5\n\n<pre>\n#!/bin/sh\n\n#\u76e3\u8996\u76f8\u624b\u306eIP\u3092\u8a2d\u5b9a\nHA_Node_IP=10.10.100.101\nHOSTED_ZONE=test.xyz.com\nHOST=myserver\n\nSELF_IP=$(curl -s http://169.254.169.254/latest/meta-data/local-ipv4)\n\necho `date` \"-- Starting HA monitor\"\nwhile [ . ]; do\n  pingresult=`ping -c 3 -W 1 $HA_Node_IP | grep time= | wc -l`\n  if [ \"$pingresult\" == \"0\" ]; then\n    ACTIVE_IP=$(cli53 rrlist ${HOSTED_ZONE}|grep ^${HOST}|awk '{print $5}')\n    if [ \"SELF_IP\" != \"$ACTIVE_IP\" ]; then\n      echo `date` \"-- HA heartbeat failed, taking over domain name\"\n      cli53 rrcreate $HOSTED_ZONE $HOST A $SELF_IP --ttl 60 --replace\n    fi\n  fi\n  sleep 10\ndone\n</pre>\n", "tags": ["AWS", "route53", "\u5197\u9577\u5316"]}