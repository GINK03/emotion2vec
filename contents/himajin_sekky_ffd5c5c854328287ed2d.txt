{"tags": ["DelphiXE3"], "context": " More than 1 year has passed since last update.\u306f\u3058\u3081\u306b\n\u6e2c\u5b9a\u88c5\u7f6e\u306a\u3069\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3068\u306e\u901a\u4fe1\u306bTCP/IP\u3092\u7528\u3044\u308b\u5834\u5408\u306f\u3001\u30bd\u30b1\u30c3\u30c8\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\u3001\u7d30\u304b\u306a\u5236\u5fa1\u304c\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u304c\u672a\u3060\u3042\u308b\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\nDelphi XE \u306eTTcpServer\u306f\u3001\u6587\u5b57\u5217\u53d7\u4fe1\u5f8c\u306b\u76f4\u3050\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u9589\u3058\u3066\u3057\u307e\u3046\u70ba\u3001\u4eca\u56de\u306fIndy \u306e TIdTCPServer \u3092\u4f7f\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\uff08\u5099\u5fd8\u9332\u3067\u3059\uff09\n\u30b5\u30f3\u30d7\u30eb\n\u30d5\u30a9\u30fc\u30e0\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nunit Unit1;\n\ninterface\n\nuses\n  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,\n  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, IdContext, Vcl.StdCtrls,\n  IdBaseComponent, IdComponent, IdCustomTCPServer, IdTCPServer, Vcl.ExtCtrls, IdGlobal;\n\ntype\n  TForm1 = class(TForm)\n    LabeledEdit1: TLabeledEdit;\n    IdTCPServer1: TIdTCPServer;\n    CheckBox1: TCheckBox;\n    Memo1: TMemo;\n    procedure IdTCPServer1Execute(AContext: TIdContext);\n    procedure IdTCPServer1Exception(AContext: TIdContext;\n      AException: Exception);\n    procedure IdTCPServer1Disconnect(AContext: TIdContext);\n    procedure IdTCPServer1Connect(AContext: TIdContext);\n    procedure CheckBox1Click(Sender: TObject);\n    procedure FormCreate(Sender: TObject);\n  private\n    { Private \u5ba3\u8a00 }\n    FEncoding:TEncoding;\n  public\n    { Public \u5ba3\u8a00 }\n  end;\n\nvar\n  Form1: TForm1;\n\nimplementation\n\n{$R *.dfm}\n\nprocedure TForm1.FormCreate(Sender: TObject);\nbegin\n  FEncoding := TEncoding.GetEncoding(932);\n  Memo1.Clear;\n  LabeledEdit1.Text := IntToStr(IdTCPServer1.DefaultPort);\nend;\n\nprocedure TForm1.FormDestroy(Sender: TObject);\nbegin\n  if IdTCPServer1.Active then\n    IdTCPServer1.Active := False;\n\n  FEncoding.Free;\nend;\n\nprocedure TForm1.CheckBox1Click(Sender: TObject);\nbegin\n  if CheckBox1.Checked then begin\n    CheckBox1.Caption := 'Start';\n    IdTCPServer1.DefaultPort := StrToInt(LabeledEdit1.Text);\n    IdTCPServer1.Active := True;\n  end else begin\n    CheckBox1.Caption := 'Stop';\n    IdTCPServer1.Active := False;\n  end;\nend;\n\nprocedure TForm1.IdTCPServer1Connect(AContext: TIdContext);\nbegin\n  Memo1.Lines.Add('Connect:'+AContext.Binding.PeerIP);\nend;\n\nprocedure TForm1.IdTCPServer1Disconnect(AContext: TIdContext);\nbegin\n  Memo1.Lines.Add('Disconnect:'+AContext.Binding.PeerIP);\nend;\n\nprocedure TForm1.IdTCPServer1Exception(AContext: TIdContext;\n  AException: Exception);\nbegin\n  Memo1.Lines.Add(AException.Message);\nend;\n\nprocedure TForm1.IdTCPServer1Execute(AContext: TIdContext);\nvar\n  Text: String;\n  Bytes: TIdBytes;\nbegin\n  AContext.Connection.IOHandler.ReadBytes(Bytes,-1);\n\n  try\n    Text := FEncoding.GetString(Bytes);\n    Memo1.Lines.Add(Text);\n\n    AContext.Connection.IOHandler.Write('OK');\n  except\n    Memo1.Lines.Add('\u6587\u5b57\u5217\u5909\u63db\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n  end;\n\nend;\n\nend.\n\n\u7d50\u679c\n\u6c4e\u7528\u306e\u30bd\u30b1\u30c3\u30c8\u901a\u4fe1\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u63a5\u7d9a\u3057\u305f\u308a\u3001\u6587\u5b57\u3092\u9001\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u4e0a\u8a18\u4f8b\u306f\u3001\u6c4e\u7528\u30c4\u30fc\u30eb\u5074\u3067\u3001\n\u3000\uff11\uff0e\u63a5\u7d9a\u2192\u300c\u3042\u3044\u3046\u3048\u304a\u300d\u9001\u4fe1\u2192\u5207\u65ad\n\u3000\uff12\uff0e\u63a5\u7d9a\u2192\u300c\u304b\u304d\u304f\u3051\u3053\u300d\u9001\u4fe1\u2192\u30a2\u30d7\u30ea\u7d42\u4e86\n\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\uff12\uff0e\u306e\u5f8c\u306b\u3001\u3082\u3046\u518d\u5ea6\u63a5\u7d9a\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u30dd\u30a4\u30f3\u30c8\nUses\u306e\u8ffd\u52a0\n\u300cIdGlobal\u300d\u306f\u624b\u52d5Uses\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\u53d7\u4fe1\u6642\u306e\u51e6\u7406\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001TIdTCPServer\u306eExcecute\u30a4\u30d9\u30f3\u30c8\u306b\u3066\u3001\u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30c8\u5217\u3067\u53d6\u51fa\u3057\u3001String\u306b\u5909\u63db\u3057\u307e\u3059\u3002\nhttp://www.watercolor-city.net/ct_delphi/delphi_tiburon/doc_unicode/bintostring.htm\nprocedure TForm1.IdTCPServer1Execute(AContext: TIdContext);\nvar\n  Text: String;\n  Bytes: TIdBytes;\nbegin\n  AContext.Connection.IOHandler.ReadBytes(Bytes,-1);\n\n  try\n    Text := FEncoding.GetString(Bytes);\n    Memo1.Lines.Add(Text);\n\n    AContext.Connection.IOHandler.Write('OK');\n  except\n    Memo1.Lines.Add('\u6587\u5b57\u5217\u5909\u63db\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n  end;\n\nend;\n\nReadBytes\u306e\uff12\u756a\u76ee\u306e\u5f15\u6570\u306f\u3001\u53d6\u5f97\u30d0\u30a4\u30c8\u6570\u3067\u3001-1\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u300c\u524d\u56de\u306e\u53d6\u5f97\u304b\u3089\u5168\u3066\u300d\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002\u4fbf\u5229\uff01\n\u4eca\u56de\u306f\u3001TEncoding \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092FormCreate\u5185\u3067\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u30da\u30fc\u30b8\u306b\u306f\u3001932\uff08Microsoft \u30b3\u30fc\u30c9\u30da\u30fc\u30b8\u3000Shift-JIS\uff09\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u533a\u5225\nAContext.Binding.PeerIP \u3067 IP \u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\uff08\u81ea\u5206\u3078\u306e\uff09\u5bbf\u984c\n\u300c\u63a5\u7d9a\u4e2d\u306e\u4efb\u610f\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3001\u81ea\u767a\u7684\u306b\u30c7\u30fc\u30bf\u9001\u4fe1\u3059\u308b\u300d\u5834\u5408\u306e\u51e6\u7406\u304c\u3001\u307e\u3060\u8abf\u3079\u3089\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3069\u3053\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u304b\u30fb\u30fb\u82f1\u8a9e\u30fb\u30fb\uff86\uff76\uff9e\uff83\u30fb\u30fb\u3002\n<h1>\u306f\u3058\u3081\u306b</h1>\n\u6e2c\u5b9a\u88c5\u7f6e\u306a\u3069\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u3068\u306e\u901a\u4fe1\u306bTCP/IP\u3092\u7528\u3044\u308b\u5834\u5408\u306f\u3001\u30bd\u30b1\u30c3\u30c8\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\u3001\u7d30\u304b\u306a\u5236\u5fa1\u304c\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u304c\u672a\u3060\u3042\u308b\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\n\nDelphi XE \u306eTTcpServer\u306f\u3001\u6587\u5b57\u5217\u53d7\u4fe1\u5f8c\u306b\u76f4\u3050\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u9589\u3058\u3066\u3057\u307e\u3046\u70ba\u3001\u4eca\u56de\u306fIndy \u306e TIdTCPServer \u3092\u4f7f\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\uff08\u5099\u5fd8\u9332\u3067\u3059\uff09\n\n<h1>\u30b5\u30f3\u30d7\u30eb</h1>\n\n<h2>\u30d5\u30a9\u30fc\u30e0</h2>\n![\u30d5\u30a9\u30fc\u30e0\u30c7\u30b6\u30a4\u30f3.png](https://qiita-image-store.s3.amazonaws.com/0/33684/24a57384-4f3c-5fcf-047e-07dc26479966.png)\n\n\n<h2>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9</h2>\n```delphi\nunit Unit1;\n\ninterface\n\nuses\n  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,\n  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, IdContext, Vcl.StdCtrls,\n  IdBaseComponent, IdComponent, IdCustomTCPServer, IdTCPServer, Vcl.ExtCtrls, IdGlobal;\n\ntype\n  TForm1 = class(TForm)\n    LabeledEdit1: TLabeledEdit;\n    IdTCPServer1: TIdTCPServer;\n    CheckBox1: TCheckBox;\n    Memo1: TMemo;\n    procedure IdTCPServer1Execute(AContext: TIdContext);\n    procedure IdTCPServer1Exception(AContext: TIdContext;\n      AException: Exception);\n    procedure IdTCPServer1Disconnect(AContext: TIdContext);\n    procedure IdTCPServer1Connect(AContext: TIdContext);\n    procedure CheckBox1Click(Sender: TObject);\n    procedure FormCreate(Sender: TObject);\n  private\n    { Private \u5ba3\u8a00 }\n    FEncoding:TEncoding;\n  public\n    { Public \u5ba3\u8a00 }\n  end;\n\nvar\n  Form1: TForm1;\n\nimplementation\n\n{$R *.dfm}\n\nprocedure TForm1.FormCreate(Sender: TObject);\nbegin\n  FEncoding := TEncoding.GetEncoding(932);\n  Memo1.Clear;\n  LabeledEdit1.Text := IntToStr(IdTCPServer1.DefaultPort);\nend;\n\nprocedure TForm1.FormDestroy(Sender: TObject);\nbegin\n  if IdTCPServer1.Active then\n    IdTCPServer1.Active := False;\n\n  FEncoding.Free;\nend;\n\nprocedure TForm1.CheckBox1Click(Sender: TObject);\nbegin\n  if CheckBox1.Checked then begin\n    CheckBox1.Caption := 'Start';\n    IdTCPServer1.DefaultPort := StrToInt(LabeledEdit1.Text);\n    IdTCPServer1.Active := True;\n  end else begin\n    CheckBox1.Caption := 'Stop';\n    IdTCPServer1.Active := False;\n  end;\nend;\n\nprocedure TForm1.IdTCPServer1Connect(AContext: TIdContext);\nbegin\n  Memo1.Lines.Add('Connect:'+AContext.Binding.PeerIP);\nend;\n\nprocedure TForm1.IdTCPServer1Disconnect(AContext: TIdContext);\nbegin\n  Memo1.Lines.Add('Disconnect:'+AContext.Binding.PeerIP);\nend;\n\nprocedure TForm1.IdTCPServer1Exception(AContext: TIdContext;\n  AException: Exception);\nbegin\n  Memo1.Lines.Add(AException.Message);\nend;\n\nprocedure TForm1.IdTCPServer1Execute(AContext: TIdContext);\nvar\n  Text: String;\n  Bytes: TIdBytes;\nbegin\n  AContext.Connection.IOHandler.ReadBytes(Bytes,-1);\n\n  try\n    Text := FEncoding.GetString(Bytes);\n    Memo1.Lines.Add(Text);\n\n    AContext.Connection.IOHandler.Write('OK');\n  except\n    Memo1.Lines.Add('\u6587\u5b57\u5217\u5909\u63db\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n  end;\n\nend;\n\nend.\n```\n\n<h2>\u7d50\u679c</h2>\n\u6c4e\u7528\u306e\u30bd\u30b1\u30c3\u30c8\u901a\u4fe1\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u63a5\u7d9a\u3057\u305f\u308a\u3001\u6587\u5b57\u3092\u9001\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n![\u3053\u3093\u306a\u611f\u3058.png](https://qiita-image-store.s3.amazonaws.com/0/33684/020e8a1a-3f8f-b51e-9ec2-6e05a47a9352.png)\n\n\u4e0a\u8a18\u4f8b\u306f\u3001<b>\u6c4e\u7528\u30c4\u30fc\u30eb\u5074</b>\u3067\u3001\n\u3000\uff11\uff0e\u63a5\u7d9a\u2192\u300c\u3042\u3044\u3046\u3048\u304a\u300d\u9001\u4fe1\u2192\u5207\u65ad\n\u3000\uff12\uff0e\u63a5\u7d9a\u2192\u300c\u304b\u304d\u304f\u3051\u3053\u300d\u9001\u4fe1\u2192\u30a2\u30d7\u30ea\u7d42\u4e86\n\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\uff12\uff0e\u306e\u5f8c\u306b\u3001\u3082\u3046\u518d\u5ea6\u63a5\u7d9a\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n<h1>\u30dd\u30a4\u30f3\u30c8</h1>\n<h2>Uses\u306e\u8ffd\u52a0</h2>\n\u300cIdGlobal\u300d\u306f\u624b\u52d5Uses\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n<h2>\u53d7\u4fe1\u6642\u306e\u51e6\u7406</h2>\n\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3001TIdTCPServer\u306eExcecute\u30a4\u30d9\u30f3\u30c8\u306b\u3066\u3001\u53d7\u4fe1\u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30c8\u5217\u3067\u53d6\u51fa\u3057\u3001String\u306b\u5909\u63db\u3057\u307e\u3059\u3002\nhttp://www.watercolor-city.net/ct_delphi/delphi_tiburon/doc_unicode/bintostring.htm\n\n```delphi\nprocedure TForm1.IdTCPServer1Execute(AContext: TIdContext);\nvar\n  Text: String;\n  Bytes: TIdBytes;\nbegin\n  AContext.Connection.IOHandler.ReadBytes(Bytes,-1);\n\n  try\n    Text := FEncoding.GetString(Bytes);\n    Memo1.Lines.Add(Text);\n\n    AContext.Connection.IOHandler.Write('OK');\n  except\n    Memo1.Lines.Add('\u6587\u5b57\u5217\u5909\u63db\u306b\u5931\u6557\u3057\u307e\u3057\u305f');\n  end;\n\nend;\n```\n\nReadBytes\u306e\uff12\u756a\u76ee\u306e\u5f15\u6570\u306f\u3001\u53d6\u5f97\u30d0\u30a4\u30c8\u6570\u3067\u3001-1\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u300c\u524d\u56de\u306e\u53d6\u5f97\u304b\u3089\u5168\u3066\u300d\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002\u4fbf\u5229\uff01\n\n\u4eca\u56de\u306f\u3001TEncoding \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092FormCreate\u5185\u3067\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u30da\u30fc\u30b8\u306b\u306f\u3001932\uff08Microsoft \u30b3\u30fc\u30c9\u30da\u30fc\u30b8\u3000Shift-JIS\uff09\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n<h2>\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u533a\u5225</h2>\nAContext.Binding.PeerIP \u3067 IP \u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002\n\n<h1>\uff08\u81ea\u5206\u3078\u306e\uff09\u5bbf\u984c</h1>\n\u300c\u63a5\u7d9a\u4e2d\u306e\u4efb\u610f\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u3001\u81ea\u767a\u7684\u306b\u30c7\u30fc\u30bf\u9001\u4fe1\u3059\u308b\u300d\u5834\u5408\u306e\u51e6\u7406\u304c\u3001\u307e\u3060\u8abf\u3079\u3089\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3069\u3053\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u304b\u30fb\u30fb\u82f1\u8a9e\u30fb\u30fb\uff86\uff76\uff9e\uff83\u30fb\u30fb\u3002\n"}