{"context": " More than 1 year has passed since last update.\n\nWhat's this?\nglance image-delete \u3067 image \u524a\u9664\u3057\u305f\u306b\u3082\u304b\u304b\u308f\u3089\u305a\u3001\u306a\u305c\u304b glance image-list \u3067 Status=deleted \u3067\u8868\u793a\u3055\u308c\u7d9a\u3051\u308b\u4e8b\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u76f4\u63a5 MySQL \u3092\u64cd\u4f5c\u3057\u3066\u524a\u9664\u3057\u3066\u307f\u305f\u3002\n# glance image-list\n+--------------------------------------+---------+-------------+------------------+----------+---------+\n| ID                                   | Name    | Disk Format | Container Format | Size     | Status  |\n+--------------------------------------+---------+-------------+------------------+----------+---------+\n| 5b62762b-9fd8-479b-a62c-011d2a744032 | image02 | raw         | bare             | 41126400 | deleted |\n| 93610bcc-0dda-4082-a8dd-66dbc562a12f | image01 | qcow2       | bare             | 13167616 | active  |\n+--------------------------------------+---------+-------------+------------------+----------+---------+\n\n\nProcedure\n\nMySQL login\n# mysql -uroot\n\n\nDatabase \u53c2\u7167\nmysql> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| cinder             |\n| glance             |\n| heat               |\n| keystone           |\n| murano             |\n| mysql              |\n| neutron            |\n| nova               |\n| performance_schema |\n| sahara             |\n| test               |\n+--------------------+\n12 rows in set (0.00 sec)\n\n\nGlance Database \u306b\u63a5\u7d9a\nmysql> use glance;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\n\n\nTable \u53c2\u7167\nmysql> show tables;\n+----------------------------------+\n| Tables_in_glance                 |\n+----------------------------------+\n| image_locations                  |\n| image_members                    |\n| image_properties                 |\n| image_tags                       |\n| images                           |\n| metadef_namespace_resource_types |\n| metadef_namespaces               |\n| metadef_objects                  |\n| metadef_properties               |\n| metadef_resource_types           |\n| migrate_version                  |\n| task_info                        |\n| tasks                            |\n+----------------------------------+\n13 rows in set (0.00 sec)\n\n\nImages Table \u53c2\u7167\nmysql> desc images;\n+------------------+--------------+------+-----+---------+-------+\n| Field            | Type         | Null | Key | Default | Extra |\n+------------------+--------------+------+-----+---------+-------+\n| id               | varchar(36)  | NO   | PRI | NULL    |       |\n| name             | varchar(255) | YES  |     | NULL    |       |\n| size             | bigint(20)   | YES  |     | NULL    |       |\n| status           | varchar(30)  | NO   |     | NULL    |       |\n| is_public        | tinyint(1)   | NO   | MUL | NULL    |       |\n| created_at       | datetime     | NO   |     | NULL    |       |\n| updated_at       | datetime     | YES  |     | NULL    |       |\n| deleted_at       | datetime     | YES  |     | NULL    |       |\n| deleted          | tinyint(1)   | NO   | MUL | NULL    |       |\n| disk_format      | varchar(20)  | YES  |     | NULL    |       |\n| container_format | varchar(20)  | YES  |     | NULL    |       |\n| checksum         | varchar(32)  | YES  | MUL | NULL    |       |\n| owner            | varchar(255) | YES  | MUL | NULL    |       |\n| min_disk         | int(11)      | NO   |     | NULL    |       |\n| min_ram          | int(11)      | NO   |     | NULL    |       |\n| protected        | tinyint(1)   | YES  |     | NULL    |       |\n| virtual_size     | bigint(20)   | YES  |     | NULL    |       |\n+------------------+--------------+------+-----+---------+-------+\n17 rows in set (0.06 sec)\n\nmysql> select name, deleted from images;\n+---------+---------+\n| name    | deleted |\n+---------+---------+\n| image01 |       0 |\n| image02 |       0 |\n| image03 |       1 |\n+---------+---------+\n3 rows in set (0.00 sec)\n\n\n\u524a\u9664\u3057\u305f\u3044 image \u306e deleted flag \u306b \"1\" \u3092\u8a2d\u5b9a\nmysql> update images set deleted=1 where name=\"image02\";\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> select name, deleted from images;\n+---------+---------+\n| name    | deleted |\n+---------+---------+\n| image01 |       0 |\n| image02 |       1 |\n| image03 |       1 |\n+---------+---------+\n3 rows in set (0.00 sec)\n\n\nMySQL logout\nmysql> quit\nBye\n\n\n\u78ba\u8a8d\n# glance image-list\n+---------+--------+-------------+------------------+----------+--------+\n| ID      | Name   | Disk Format | Container Format | Size     | Status |\n+---------+--------+-------------+------------------+----------+--------+\n| image01 | TestVM | qcow2       | bare             | 13167616 | active |\n+---------+--------+-------------+------------------+----------+--------+\n\n\nEnvironment\nOpenstack : Juno\n\n# glance --version\n0.15.0\n\n# mysql --version\nmysql  Ver 14.14 Distrib 5.6.16, for Linux (x86_64) using  EditLine wrapper\n\n## What's this?\n\n`glance image-delete` \u3067 image \u524a\u9664\u3057\u305f\u306b\u3082\u304b\u304b\u308f\u3089\u305a\u3001\u306a\u305c\u304b `glance image-list` \u3067 Status=deleted \u3067\u8868\u793a\u3055\u308c\u7d9a\u3051\u308b\u4e8b\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u76f4\u63a5 MySQL \u3092\u64cd\u4f5c\u3057\u3066\u524a\u9664\u3057\u3066\u307f\u305f\u3002\n\n    # glance image-list\n    +--------------------------------------+---------+-------------+------------------+----------+---------+\n    | ID                                   | Name    | Disk Format | Container Format | Size     | Status  |\n    +--------------------------------------+---------+-------------+------------------+----------+---------+\n    | 5b62762b-9fd8-479b-a62c-011d2a744032 | image02 | raw         | bare             | 41126400 | deleted |\n    | 93610bcc-0dda-4082-a8dd-66dbc562a12f | image01 | qcow2       | bare             | 13167616 | active  |\n    +--------------------------------------+---------+-------------+------------------+----------+---------+\n\n## Procedure\n\n#### MySQL login\n\n    # mysql -uroot\n\n#### Database \u53c2\u7167\n\n    mysql> show databases;\n    +--------------------+\n    | Database           |\n    +--------------------+\n    | information_schema |\n    | cinder             |\n    | glance             |\n    | heat               |\n    | keystone           |\n    | murano             |\n    | mysql              |\n    | neutron            |\n    | nova               |\n    | performance_schema |\n    | sahara             |\n    | test               |\n    +--------------------+\n    12 rows in set (0.00 sec)\n\n#### Glance Database \u306b\u63a5\u7d9a\n\n    mysql> use glance;\n    Reading table information for completion of table and column names\n    You can turn off this feature to get a quicker startup with -A\n\n    Database changed\n\n#### Table \u53c2\u7167\n\n    mysql> show tables;\n    +----------------------------------+\n    | Tables_in_glance                 |\n    +----------------------------------+\n    | image_locations                  |\n    | image_members                    |\n    | image_properties                 |\n    | image_tags                       |\n    | images                           |\n    | metadef_namespace_resource_types |\n    | metadef_namespaces               |\n    | metadef_objects                  |\n    | metadef_properties               |\n    | metadef_resource_types           |\n    | migrate_version                  |\n    | task_info                        |\n    | tasks                            |\n    +----------------------------------+\n    13 rows in set (0.00 sec)\n\n#### Images Table \u53c2\u7167\n\n    mysql> desc images;\n    +------------------+--------------+------+-----+---------+-------+\n    | Field            | Type         | Null | Key | Default | Extra |\n    +------------------+--------------+------+-----+---------+-------+\n    | id               | varchar(36)  | NO   | PRI | NULL    |       |\n    | name             | varchar(255) | YES  |     | NULL    |       |\n    | size             | bigint(20)   | YES  |     | NULL    |       |\n    | status           | varchar(30)  | NO   |     | NULL    |       |\n    | is_public        | tinyint(1)   | NO   | MUL | NULL    |       |\n    | created_at       | datetime     | NO   |     | NULL    |       |\n    | updated_at       | datetime     | YES  |     | NULL    |       |\n    | deleted_at       | datetime     | YES  |     | NULL    |       |\n    | deleted          | tinyint(1)   | NO   | MUL | NULL    |       |\n    | disk_format      | varchar(20)  | YES  |     | NULL    |       |\n    | container_format | varchar(20)  | YES  |     | NULL    |       |\n    | checksum         | varchar(32)  | YES  | MUL | NULL    |       |\n    | owner            | varchar(255) | YES  | MUL | NULL    |       |\n    | min_disk         | int(11)      | NO   |     | NULL    |       |\n    | min_ram          | int(11)      | NO   |     | NULL    |       |\n    | protected        | tinyint(1)   | YES  |     | NULL    |       |\n    | virtual_size     | bigint(20)   | YES  |     | NULL    |       |\n    +------------------+--------------+------+-----+---------+-------+\n    17 rows in set (0.06 sec)\n\n    mysql> select name, deleted from images;\n    +---------+---------+\n    | name    | deleted |\n    +---------+---------+\n    | image01 |       0 |\n    | image02 |       0 |\n    | image03 |       1 |\n    +---------+---------+\n    3 rows in set (0.00 sec)\n\n#### \u524a\u9664\u3057\u305f\u3044 image \u306e deleted flag \u306b \"1\" \u3092\u8a2d\u5b9a\n\n    mysql> update images set deleted=1 where name=\"image02\";\n    Query OK, 1 row affected (0.01 sec)\n    Rows matched: 1  Changed: 1  Warnings: 0\n\n    mysql> select name, deleted from images;\n    +---------+---------+\n    | name    | deleted |\n    +---------+---------+\n    | image01 |       0 |\n    | image02 |       1 |\n    | image03 |       1 |\n    +---------+---------+\n    3 rows in set (0.00 sec)\n\n#### MySQL logout\n\n    mysql> quit\n    Bye\n\n#### \u78ba\u8a8d\n\n    # glance image-list\n    +---------+--------+-------------+------------------+----------+--------+\n    | ID      | Name   | Disk Format | Container Format | Size     | Status |\n    +---------+--------+-------------+------------------+----------+--------+\n    | image01 | TestVM | qcow2       | bare             | 13167616 | active |\n    +---------+--------+-------------+------------------+----------+--------+\n\n## Environment\n\n    Openstack : Juno\n\n    # glance --version\n    0.15.0\n\n    # mysql --version\n    mysql  Ver 14.14 Distrib 5.6.16, for Linux (x86_64) using  EditLine wrapper\n\n", "tags": ["openstack", "glance", "MySQL"]}