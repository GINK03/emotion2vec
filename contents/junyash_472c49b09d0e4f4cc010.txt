{"context": " More than 1 year has passed since last update.\u5148\u65e5\u306e\u30a2\u30f3\u30ea\u30a2\u30eb\u30fb\u30d5\u30a7\u30b9 2014\u3067\u306f\u6642\u9593\u306e\u90fd\u5408\u3084\u30d7\u30ec\u30bc\u30f3\u5f62\u5f0f\u3060\u3063\u305f\u308a\u3067\u8a73\u3057\u304f\u7d39\u4ecb\u3067\u304d\u306a\u304b\u3063\u305f\u3001Shading Model\u3092\u62e1\u5f35\u3057\u3066\u72ec\u81ea\u306e\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3084\u63cf\u753b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30b3\u30fc\u30c9\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u203b\u3061\u306a\u307f\u306bUE4\u81ea\u4f53\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u516c\u306e\u5834\u3067\u516c\u958b\u3059\u308b\u5834\u5408\u3001\u5f53\u8a72\u30b3\u30fc\u30c9\u306b\u3064\u3044\u3066\u30d5\u30a9\u30fc\u30e9\u30e0\u7b49\u3067\u8b70\u8ad6\u7b49\u3059\u308b\u7528\u9014\u306b\u304a\u3044\u3066\u306e\u307f30\u884c\u4ee5\u5185\u306a\u3089OK\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3053\u3068\u306b\u3054\u7559\u610f\u304f\u3060\u3055\u3044\u3002\u8a73\u3057\u304f\u306fEnd User License Agreement\uff08\u65e5\u672c\u8a9e\u7248\u306f\u30a8\u30f3\u30c9\u30e6\u30fc\u30b6\u30fc\u30e9\u30a4\u30bb\u30f3\u30b9\u5951\u7d04\u66f8\u53c2\u8003\u8a33\uff09\u4e2d\u3067\u300cYou are permitted to post snippets of Engine Code, up to 30 lines of code in length, online in public forums for the limited purpose of discussing the content of the snippet and not for any other purpose. \u300d\u3068\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\nUE4\u306eShading Model\u3068\u306f\uff1f\nUE4\u306e\u30de\u30c6\u30ea\u30a2\u30eb\u6a5f\u80fd\u3067\u7279\u6b8a\u306a\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3092\u4f7f\u3046\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002\u8a73\u3057\u304f\u306f\u4ee5\u4e0b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u30b7\u30a7\u30fc\u30c7\u30a3\u30f3\u30b0\u30e2\u30c7\u30eb\n\u5b9f\u969b\u306b\u9069\u7528\u3059\u308b\u306e\u306f\u30de\u30c6\u30ea\u30a2\u30eb\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u306a\u308a\u307e\u3059\u3002\n\nMaterial\u30d7\u30ed\u30d1\u30c6\u30a3\u4e2d\u306b\u300cShading Model\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u3001\u30de\u30c6\u30ea\u30a2\u30eb\u3078\u306e\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u9078\u629e\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\nUE4\u306e4.3\u307e\u3067\u306f\u300cUnlit\u300d \u300cDefault Lit\u300d\u300cSubsurface\u300d\u300cPreintegrated Skin\u300d\u304c\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u3066\u3001G\u30d0\u30c3\u30d5\u30a1\u7fa4\u4e2d\u306e\u300cLighting Model\u300d\u3068\u3044\u3046\u30d0\u30c3\u30d5\u30a1\u306b2\u30d3\u30c3\u30c8\u306e\u60c5\u5831\u3068\u3057\u3066\u66f8\u304d\u51fa\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u30018\u30d3\u30c3\u30c8\u306b\u62e1\u5f35\u3055\u308c256\u7a2e\u985e\u307e\u3067\u8a8d\u8b58\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u30014.3\u4ee5\u964d\u300cClear Coat\u300d\u300cSubsurface Profile\u300d\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\nShading Model\u306e\u8ffd\u52a0\u30fb\u62e1\u5f35\u306b\u306f\u30bd\u30fc\u30b9\u306e\u6539\u5909\u304c\u5fc5\u8981\u3067\u3059\nGitHub\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u305d\u306e\u624b\u9806\u3092\u66f8\u304d\u3060\u3059\u3068\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d2\u30b9\u30c8\u30ea\u30a2\u3055\u3093\u3084DM\u3055\u3093\u306e\u30b5\u30a4\u30c8\u3092\u898b\u306a\u304c\u3089\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nUE4 \u30a8\u30f3\u30b8\u30f3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u53d6\u5f97\u3068\u30d3\u30eb\u30c9\u624b\u9806\u306e\u307e\u3068\u3081\nUE4\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u843d\u3068\u3057\u3066\u8aad\u3093\u3067\u307f\u305f\n\n\u305d\u308c\u3067\u306f\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u6539\u5909\n\u307e\u305a\u306f\u3001\u65b0\u305f\u306aShadingModel\u3092enum EMaterialShadingModel\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nEngine/Source/Runtime/Engine/Classes/Engine/EngineTypes.h\n// Note: Check UMaterialInstance::Serialize if changed!!\nUENUM()\nenum EMaterialShadingModel\n{\n    \uff1a\n    MSM_CellLook            UMETA(DisplayName=\"Cell Look\"), // \u8ffd\u52a0\n    MSM_MAX,\n};\n\n\n\n\u6b21\u306bC++\u5074\u3067\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u30b3\u30fc\u30c9\u306e\u5b9f\u88c5\u3002\n\nEngine/Source/Runtime/Engine/Private/Materials/MaterialShader.cpp\nFString GetShadingModelString(EMaterialShadingModel ShadingModel)\n{\n    FString ShadingModelName;\n    switch(ShadingModel)\n    {\n        \uff1a\n        case MSM_CellLook:          ShadingModelName = TEXT(\"MSM_CellLook\"); break; // \u8ffd\u52a0\n        default: ShadingModelName = TEXT(\"Unknown\"); break;\n    }\n    return ShadingModelName;\n}\n\nvoid UpdateMaterialShaderCompilingStats(const FMaterial* Material)\n{\n    \uff1a\n    switch(Material->GetShadingModel())\n    {\n        \uff1a\n        case MSM_CellLook: // \u8ffd\u52a0\n            INC_DWORD_STAT_BY(STAT_ShaderCompiling_NumLitMaterialShaders,1);\n            break;\n        default: break;\n    };\n    \uff1a\n}\n\nvoid FMaterial::SetupMaterialEnvironment(\n    EShaderPlatform Platform,\n    const FUniformExpressionSet& InUniformExpressionSet,\n    FShaderCompilerEnvironment& OutEnvironment\n    ) const\n{\n    \uff1a\n    switch(GetShadingModel())\n    {\n        \uff1a\n        case MSM_CellLook:          OutEnvironment.SetDefine(TEXT(\"MATERIAL_SHADINGMODEL_CELL_LOOK\"),           TEXT(\"1\")); break; // \u8ffd\u52a0\n        default: \n            UE_LOG(LogMaterial, Warning, TEXT(\"Unknown material shading model: %u  Setting to MSM_DefaultLit\"),(int32)GetShadingModel());\n            OutEnvironment.SetDefine(TEXT(\"MATERIAL_SHADINGMODEL_DEFAULT_LIT\"),TEXT(\"1\"));\n    };\n    \uff1a\n}\n\n\n\u6700\u5f8c\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u5074\u306b\u5b9f\u88c5\u3002\n\nEngine/Shaders/DeferredShadingCommon.usf\n\uff1a\n#define SHADINGMODELID_SUBSURFACE_PROFILE   5\n#define SHADINGMODELID_CELL_LOOK            6 // \u8ffd\u52a0\n#define SHADINGMODELID_NUM                  7\n\n\n\nEngine/Shaders/BasePassPixelShader.usf\nvoid Main(\n    \uff1a\n   )\n{\n    \uff1a\n        #elif MATERIAL_SHADINGMODEL_CELL_LOOK // \u8ffd\u52a0\n            GBuffer.ShadingModelID = SHADINGMODELID_CELL_LOOK; // \u8ffd\u52a0\n        #else\n            // missing shading model, compiler should report ShadingModelID is not set\n        #endif\n    \uff1a\n}\n\n\n\nEngine/Shaders/DeferredLightingCommon.usf\nfloat3 CellLookShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N, float2 DiffSpecMask )\n{\n    // \u5b9f\u969b\u306b\u3084\u308a\u305f\u3044\u63cf\u753b\u6a5f\u80fd\u3092\u8a18\u8ff0\u3002\n}\n\nfloat3 SurfaceShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N, float2 DiffSpecMask )\n{\n    switch( GBuffer.ShadingModelID )\n    {\n        \uff1a\n        case SHADINGMODELID_CELL_LOOK:\n            return CellLookShading( GBuffer, LobeRoughness, LobeEnergy, L, V, N, DiffSpecMask);\n        default:\n            return 0;\n    }\n}\n\n\n\nEngine/Shaders/PostProcessAmbient.usf\nfloat3 CellLookShading( FGBufferData GBuffer, float Roughness, float3 L, float3 V, half3 N )\n{\n    \u5b9f\u969b\u306b\u3084\u308a\u305f\u3044\u63cf\u753b\u6a5f\u80fd\u3092\u8a18\u8ff0\u3002\n}\n\nfloat3 ImageBasedLightingMIS( FGBufferData GBuffer, float3 V, float3 N, uint2 Random )\n{\n                \uff1a\n                else if( GBuffer.ShadingModelID == SHADINGMODELID_CELL_LOOK )\n                {\n                    Shading = CellLookShading( GBuffer, GBuffer.Roughness, L, V, N );\n                }\n                else\n                {\n                    Shading = StandardShading( GBuffer, GBuffer.Roughness, L, V, N );\n                }\n\n                Lighting += SampleColor * Shading * ( NoL * Weight );\n            }\n        }\n    }\n\n    return Lighting;\n}\n\n\n\n\u4ee5\u4e0a\u3067\u3053\u3093\u306a\u611f\u3058\u306b\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3048\u3063\uff1f\u4f55\u306b\u4f7f\u3046\u306e\u304b\uff1f\u305d\u308c\u306f\u7686\u3055\u3093\u306e\u30a2\u30a4\u30c7\u30a3\u30a2\u6b21\u7b2c\u3067\u3059\uff01\n\nUE4\u306e\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u307e\u3067\u306f\u624b\u3092\u3060\u305b\u306a\u3044\u3088\u30fb\u30fb\u30fb\nClear Coat\u306eShading Model\u3092\u30cf\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\nEngine/Shaders/BasePassPixelShader.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\n#elif MATERIAL_SHADINGMODEL_CLEAR_COAT\u5f8c\u306e\u30b3\u30fc\u30c9\u3068\uff08#else // missing shading model, compiler should report ShadingModelID is not set\u306e\u524d\u307e\u3067\uff09\nEngine/Shaders/DeferredLightingCommon.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306b float3 ClearCoatShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N )\u3001Engine/Shaders/PostProcessAmbient.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306b float3 ClearCoatShading( FGBufferData GBuffer, float Roughness, float3 L, float3 V, half3 N )\n \u3068\u3044\u3046\u95a2\u6570\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u4e2d\u306e\u30b3\u30fc\u30c9\u3092\u30a4\u30b8\u308c\u3070\u30cf\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\u3063\u3066\u3044\u304d\u306a\u308a\u6577\u5c45\u304c\u9ad8\u3044\u306a\u30aa\u30a4\uff01\u3063\u3066\u3044\u3046\u30c4\u30c3\u30b3\u30df\u306f\u30fb\u30fb\u30fb\u3002\u30cf\u30c3\u30af\u3068\u306f\u305d\u3046\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u3067\u3082\u3001\u3053\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u3001UE4\u306e\u30a8\u30c7\u30a3\u30bf\u3067\u300cShift+Ctrl+.\uff08\u30d4\u30ea\u30aa\u30c9\uff09\u300d\u3092\u62bc\u3059\u3060\u3051\u3067.usf\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u3059\u304b\u3089\u30fb\u30fb\u30fb\u3053\u3046\u3044\u3046\u30cf\u30c3\u30af\u304c\u597d\u304d\u306a\u65b9\u306b\u306f\u9762\u767d\u3044\u74b0\u5883\u3060\u3068\u601d\u3044\u307e\u3059\u3002(^_^;)\n\n\u5fdc\u7528\u7de8\n\u4eca\u6708\u306e\u5f8c\u534a\uff0812/20\uff09\u306b\u3001\u5fdc\u7528\u7de8\u3068\u3057\u3066\u5b9f\u969b\u306bShading Model\u3067\u7279\u6b8a\u306a\u63cf\u753b\u7b49\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u753b\u50cf\u306f\u305d\u308c\u307e\u3067\u30d2\u30df\u30c4\u3067\u3059\u3002\u304a\u697d\u3057\u307f\u306b\uff01\n\u660e\u65e512/11\u306e\u62c5\u5f53\u306falwei\u3055\u3093\uff08@aizen76\uff09\u3067\u3001\n\u30bf\u30a4\u30c8\u30eb\u306f\u300cUE4\u3067\u4f7f\u3048\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3044\u308d\u3044\u308d\u7d39\u4ecb\u300d\u3067\u3059\uff01alwei\u30b5\u30fc\u30f3\uff01\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\u5148\u65e5\u306e\u30a2\u30f3\u30ea\u30a2\u30eb\u30fb\u30d5\u30a7\u30b9 2014\u3067\u306f\u6642\u9593\u306e\u90fd\u5408\u3084\u30d7\u30ec\u30bc\u30f3\u5f62\u5f0f\u3060\u3063\u305f\u308a\u3067\u8a73\u3057\u304f\u7d39\u4ecb\u3067\u304d\u306a\u304b\u3063\u305f\u3001Shading Model\u3092\u62e1\u5f35\u3057\u3066\u72ec\u81ea\u306e\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3084\u63cf\u753b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30b3\u30fc\u30c9\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u203b\u3061\u306a\u307f\u306bUE4\u81ea\u4f53\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u516c\u306e\u5834\u3067\u516c\u958b\u3059\u308b\u5834\u5408\u3001\u5f53\u8a72\u30b3\u30fc\u30c9\u306b\u3064\u3044\u3066\u30d5\u30a9\u30fc\u30e9\u30e0\u7b49\u3067\u8b70\u8ad6\u7b49\u3059\u308b\u7528\u9014\u306b\u304a\u3044\u3066\u306e\u307f30\u884c\u4ee5\u5185\u306a\u3089OK\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3053\u3068\u306b\u3054\u7559\u610f\u304f\u3060\u3055\u3044\u3002\u8a73\u3057\u304f\u306f[End User License Agreement](https://www.unrealengine.com/eula)\uff08\u65e5\u672c\u8a9e\u7248\u306f[\u30a8\u30f3\u30c9\u30e6\u30fc\u30b6\u30fc\u30e9\u30a4\u30bb\u30f3\u30b9\u5951\u7d04\u66f8\u53c2\u8003\u8a33](https://www.unrealengine.com/ja/eula)\uff09\u4e2d\u3067\u300cYou are permitted to post snippets of Engine Code, up to 30 lines of code in length, online in public forums for the limited purpose of discussing the content of the snippet and not for any other purpose. \u300d\u3068\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\n# UE4\u306eShading Model\u3068\u306f\uff1f\n\nUE4\u306e\u30de\u30c6\u30ea\u30a2\u30eb\u6a5f\u80fd\u3067\u7279\u6b8a\u306a\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3092\u4f7f\u3046\u305f\u3081\u306e\u6a5f\u80fd\u3067\u3059\u3002\u8a73\u3057\u304f\u306f\u4ee5\u4e0b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n[\u30b7\u30a7\u30fc\u30c7\u30a3\u30f3\u30b0\u30e2\u30c7\u30eb](https://docs.unrealengine.com/latest/JPN/Engine/Rendering/Materials/MaterialProperties/LightingModels/index.html \"\u30b7\u30a7\u30fc\u30c7\u30a3\u30f3\u30b0\u30e2\u30c7\u30eb\")\n\n\u5b9f\u969b\u306b\u9069\u7528\u3059\u308b\u306e\u306f\u30de\u30c6\u30ea\u30a2\u30eb\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u306a\u308a\u307e\u3059\u3002<br \\>\n![UE4ShadingModel.png](https://qiita-image-store.s3.amazonaws.com/0/58485/dac9b8ee-4f76-2051-5677-cc2b65976235.png)<br \\>\nMaterial\u30d7\u30ed\u30d1\u30c6\u30a3\u4e2d\u306b\u300cShading Model\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u3001\u30de\u30c6\u30ea\u30a2\u30eb\u3078\u306e\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u9078\u629e\u3059\u308b\u3082\u306e\u3067\u3059\u3002<br \\>\n![UE4LightingModel.png](https://qiita-image-store.s3.amazonaws.com/0/58485/f1aa5dc3-6c96-c84a-aef6-8a1c4ef787a0.png)<br \\>\nUE4\u306e4.3\u307e\u3067\u306f\u300cUnlit\u300d \u300cDefault Lit\u300d\u300cSubsurface\u300d\u300cPreintegrated Skin\u300d\u304c\u9078\u629e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u3066\u3001G\u30d0\u30c3\u30d5\u30a1\u7fa4\u4e2d\u306e\u300cLighting Model\u300d\u3068\u3044\u3046\u30d0\u30c3\u30d5\u30a1\u306b2\u30d3\u30c3\u30c8\u306e\u60c5\u5831\u3068\u3057\u3066\u66f8\u304d\u51fa\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u30018\u30d3\u30c3\u30c8\u306b\u62e1\u5f35\u3055\u308c256\u7a2e\u985e\u307e\u3067\u8a8d\u8b58\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u306e\u3067\u30014.3\u4ee5\u964d\u300cClear Coat\u300d\u300cSubsurface Profile\u300d\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\n# Shading Model\u306e\u8ffd\u52a0\u30fb\u62e1\u5f35\u306b\u306f\u30bd\u30fc\u30b9\u306e\u6539\u5909\u304c\u5fc5\u8981\u3067\u3059\n\nGitHub\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u305d\u306e\u624b\u9806\u3092\u66f8\u304d\u3060\u3059\u3068\u9577\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u30d2\u30b9\u30c8\u30ea\u30a2\u3055\u3093\u3084DM\u3055\u3093\u306e\u30b5\u30a4\u30c8\u3092\u898b\u306a\u304c\u3089\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n[UE4 \u30a8\u30f3\u30b8\u30f3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u53d6\u5f97\u3068\u30d3\u30eb\u30c9\u624b\u9806\u306e\u307e\u3068\u3081](http://historia.co.jp/archives/231 \"UE4 \u30a8\u30f3\u30b8\u30f3\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u53d6\u5f97\u3068\u30d3\u30eb\u30c9\u624b\u9806\u306e\u307e\u3068\u3081\")\n[UE4\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u843d\u3068\u3057\u3066\u8aad\u3093\u3067\u307f\u305f](http://qiita.com/DandyMania/items/423c9723c3e3ca6ee0da \"UE4\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u843d\u3068\u3057\u3066\u8aad\u3093\u3067\u307f\u305f\")\n\n# \u305d\u308c\u3067\u306f\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\u6539\u5909\n\n\u307e\u305a\u306f\u3001\u65b0\u305f\u306aShadingModel\u3092enum EMaterialShadingModel\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```Engine/Source/Runtime/Engine/Classes/Engine/EngineTypes.h\n// Note: Check UMaterialInstance::Serialize if changed!!\nUENUM()\nenum EMaterialShadingModel\n{\n\t\uff1a\n\tMSM_CellLook\t\t\tUMETA(DisplayName=\"Cell Look\"), // \u8ffd\u52a0\n\tMSM_MAX,\n};\n\n```\n\n\u6b21\u306bC++\u5074\u3067\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3059\u308b\u30b3\u30fc\u30c9\u306e\u5b9f\u88c5\u3002\n\n```Engine/Source/Runtime/Engine/Private/Materials/MaterialShader.cpp\nFString GetShadingModelString(EMaterialShadingModel ShadingModel)\n{\n\tFString ShadingModelName;\n\tswitch(ShadingModel)\n\t{\n\t\t\uff1a\n\t\tcase MSM_CellLook:\t\t\tShadingModelName = TEXT(\"MSM_CellLook\"); break; // \u8ffd\u52a0\n\t\tdefault: ShadingModelName = TEXT(\"Unknown\"); break;\n\t}\n\treturn ShadingModelName;\n}\n\nvoid UpdateMaterialShaderCompilingStats(const FMaterial* Material)\n{\n\t\uff1a\n\tswitch(Material->GetShadingModel())\n\t{\n\t\t\uff1a\n\t\tcase MSM_CellLook: // \u8ffd\u52a0\n\t\t\tINC_DWORD_STAT_BY(STAT_ShaderCompiling_NumLitMaterialShaders,1);\n\t\t\tbreak;\n\t\tdefault: break;\n\t};\n\t\uff1a\n}\n\nvoid FMaterial::SetupMaterialEnvironment(\n\tEShaderPlatform Platform,\n\tconst FUniformExpressionSet& InUniformExpressionSet,\n\tFShaderCompilerEnvironment& OutEnvironment\n\t) const\n{\n\t\uff1a\n\tswitch(GetShadingModel())\n\t{\n\t\t\uff1a\n\t\tcase MSM_CellLook:\t\t\tOutEnvironment.SetDefine(TEXT(\"MATERIAL_SHADINGMODEL_CELL_LOOK\"),\t\t\tTEXT(\"1\")); break; // \u8ffd\u52a0\n\t\tdefault: \n\t\t\tUE_LOG(LogMaterial, Warning, TEXT(\"Unknown material shading model: %u  Setting to MSM_DefaultLit\"),(int32)GetShadingModel());\n\t\t\tOutEnvironment.SetDefine(TEXT(\"MATERIAL_SHADINGMODEL_DEFAULT_LIT\"),TEXT(\"1\"));\n\t};\n\t\uff1a\n}\n```\n\n\u6700\u5f8c\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u5074\u306b\u5b9f\u88c5\u3002\n\n```Engine/Shaders/DeferredShadingCommon.usf\n\uff1a\n#define SHADINGMODELID_SUBSURFACE_PROFILE\t5\n#define SHADINGMODELID_CELL_LOOK\t\t\t6 // \u8ffd\u52a0\n#define SHADINGMODELID_NUM\t\t\t\t\t7\n```\n\n\n```Engine/Shaders/BasePassPixelShader.usf\nvoid Main(\n\t\uff1a\n   )\n{\n\t\uff1a\n\t\t#elif MATERIAL_SHADINGMODEL_CELL_LOOK // \u8ffd\u52a0\n\t\t\tGBuffer.ShadingModelID = SHADINGMODELID_CELL_LOOK; // \u8ffd\u52a0\n\t\t#else\n\t\t\t// missing shading model, compiler should report ShadingModelID is not set\n\t\t#endif\n\t\uff1a\n}\n```\n\n```Engine/Shaders/DeferredLightingCommon.usf\nfloat3 CellLookShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N, float2 DiffSpecMask )\n{\n\t// \u5b9f\u969b\u306b\u3084\u308a\u305f\u3044\u63cf\u753b\u6a5f\u80fd\u3092\u8a18\u8ff0\u3002\n}\n\nfloat3 SurfaceShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N, float2 DiffSpecMask )\n{\n\tswitch( GBuffer.ShadingModelID )\n\t{\n\t\t\uff1a\n\t\tcase SHADINGMODELID_CELL_LOOK:\n\t\t\treturn CellLookShading( GBuffer, LobeRoughness, LobeEnergy, L, V, N, DiffSpecMask);\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n}\n```\n\n```Engine/Shaders/PostProcessAmbient.usf\nfloat3 CellLookShading( FGBufferData GBuffer, float Roughness, float3 L, float3 V, half3 N )\n{\n\t\u5b9f\u969b\u306b\u3084\u308a\u305f\u3044\u63cf\u753b\u6a5f\u80fd\u3092\u8a18\u8ff0\u3002\n}\n\nfloat3 ImageBasedLightingMIS( FGBufferData GBuffer, float3 V, float3 N, uint2 Random )\n{\n\t\t\t\t\uff1a\n\t\t\t\telse if( GBuffer.ShadingModelID == SHADINGMODELID_CELL_LOOK )\n\t\t\t\t{\n\t\t\t\t\tShading = CellLookShading( GBuffer, GBuffer.Roughness, L, V, N );\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tShading = StandardShading( GBuffer, GBuffer.Roughness, L, V, N );\n\t\t\t\t}\n\t\t\t\n\t\t\t\tLighting += SampleColor * Shading * ( NoL * Weight );\n\t\t\t}\n\t\t}\n\t}\n\n\treturn Lighting;\n}\n\n```\n\n\u4ee5\u4e0a\u3067\u3053\u3093\u306a\u611f\u3058\u306b\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002<br \\>\n![UE4ShadingModelCellLook.png](https://qiita-image-store.s3.amazonaws.com/0/58485/e429a9a3-1b74-411d-e31b-cf586885ea89.png)\n\n\u3048\u3063\uff1f\u4f55\u306b\u4f7f\u3046\u306e\u304b\uff1f\u305d\u308c\u306f\u7686\u3055\u3093\u306e\u30a2\u30a4\u30c7\u30a3\u30a2\u6b21\u7b2c\u3067\u3059\uff01\n\n\n# UE4\u306e\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30d3\u30eb\u30c9\u307e\u3067\u306f\u624b\u3092\u3060\u305b\u306a\u3044\u3088\u30fb\u30fb\u30fb\n\nClear Coat\u306eShading Model\u3092\u30cf\u30c3\u30af\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\nEngine/Shaders/BasePassPixelShader.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\n\\#elif MATERIAL_SHADINGMODEL_CLEAR_COAT\u5f8c\u306e\u30b3\u30fc\u30c9\u3068\uff08#else // missing shading model, compiler should report ShadingModelID is not set\u306e\u524d\u307e\u3067\uff09\nEngine/Shaders/DeferredLightingCommon.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306b float3 ClearCoatShading( FGBufferData GBuffer, float3 LobeRoughness, float3 LobeEnergy, float3 L, float3 V, half3 N )\u3001Engine/Shaders/PostProcessAmbient.usf \u3068\u3044\u3046\u30b7\u30a7\u30fc\u30c0\u30fc\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u306b float3 ClearCoatShading( FGBufferData GBuffer, float Roughness, float3 L, float3 V, half3 N )\n \u3068\u3044\u3046\u95a2\u6570\u304c\u3042\u308b\u306e\u3067\u3001\u3053\u306e\u4e2d\u306e\u30b3\u30fc\u30c9\u3092\u30a4\u30b8\u308c\u3070\u30cf\u30c3\u30af\u3067\u304d\u307e\u3059\u3002\u3063\u3066\u3044\u304d\u306a\u308a\u6577\u5c45\u304c\u9ad8\u3044\u306a\u30aa\u30a4\uff01\u3063\u3066\u3044\u3046\u30c4\u30c3\u30b3\u30df\u306f\u30fb\u30fb\u30fb\u3002\u30cf\u30c3\u30af\u3068\u306f\u305d\u3046\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\n\u3067\u3082\u3001\u3053\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u3001UE4\u306e\u30a8\u30c7\u30a3\u30bf\u3067\u300cShift+Ctrl+.\uff08\u30d4\u30ea\u30aa\u30c9\uff09\u300d\u3092\u62bc\u3059\u3060\u3051\u3067.usf\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u3059\u304b\u3089\u30fb\u30fb\u30fb\u3053\u3046\u3044\u3046\u30cf\u30c3\u30af\u304c\u597d\u304d\u306a\u65b9\u306b\u306f\u9762\u767d\u3044\u74b0\u5883\u3060\u3068\u601d\u3044\u307e\u3059\u3002(^_^;)\n\n# \u5fdc\u7528\u7de8\n\n\u4eca\u6708\u306e\u5f8c\u534a\uff0812/20\uff09\u306b\u3001\u5fdc\u7528\u7de8\u3068\u3057\u3066\u5b9f\u969b\u306bShading Model\u3067\u7279\u6b8a\u306a\u63cf\u753b\u7b49\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u753b\u50cf\u306f\u305d\u308c\u307e\u3067\u30d2\u30df\u30c4\u3067\u3059\u3002\u304a\u697d\u3057\u307f\u306b\uff01\n\n\u660e\u65e512/11\u306e\u62c5\u5f53\u306falwei\u3055\u3093\uff08[@aizen76](https://twitter.com/aizen76 \"alwei\u3055\u3093\")\uff09\u3067\u3001\n\u30bf\u30a4\u30c8\u30eb\u306f\u300cUE4\u3067\u4f7f\u3048\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3044\u308d\u3044\u308d\u7d39\u4ecb\u300d\u3067\u3059\uff01alwei\u30b5\u30fc\u30f3\uff01\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n", "tags": ["UE4", "CellLook", "Toon"]}