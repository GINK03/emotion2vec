{"context": "\u52d5\u304d\u307e\u3057\u305f.. ...\u3078\u306e\u9053 \u306a\u306e\u3067\u3001\u307e\u3060\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3044. (\u30b5\u30ae\u3060\u30fc.\n\n(2017-01-05) \u2193\u3053\u308c\u3067\u3001\u66f4\u65b0\u3057\u3066\u307e\u3059\u3002\u30ad\u30fc\u30dc\u30fc\u30c9 <=USB=> RPi <=UART(\u30b7\u30ea\u30a2\u30eb)=> BLEnano <= Bluetooth => PC\n\n\n\u3069\u306e\u30ad\u30fc\u3082\u4f7f\u3048\u307e\u3059\u3002(HID USB\u3067\u306a\u304c\u308c\u3066\u304f\u308b\u30ad\u30fc\u30b3\u30fc\u30c9\u3001\u305d\u306e\u307e\u307e\u3001BT\u3078\u6295\u3052\u3066\u308b)\nLED\u3082\u70b9\u304f\u3088(\u3053\u306e\u30ad\u30fc\u30dc\u30fc\u30c9\u306b\u3064\u3044\u3066\u308b\u3001CAPS\u3001NumLock\u3001ScrLk\u306e\u307f\u78ba\u8a8d)\n\u3061\u3087\u3044\u3068\u3001\u4e0d\u5b89\u5b9a\uff1f\u4e00\u5ea6\u3001\u63a5\u7d9a\u3067\u304d\u308c\u3070\u3001\u6bd4\u8f03\u7684\u5b89\u5b9a\u3002\n\u96fb\u6e90\u5207\u308b\u3068\u304d\u306f\u3001\u3076\u3061\u3063\u3001\u3068\u3084\u308b\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u3084\u3070\u3044\u304b\u3082\uff1f\niPhone\u306b\u3082\u3064\u306a\u304c\u308b\u3088\n\u5b9f\u7528\u6027?? USB\u7aef\u5b50\u304c\u305f\u308a\u306a\u3044\u3068\u304d\u3001\u3068\u304b?\n\u3089\u305a\u3071\u3044\u3063\u3066\u3001\u96fb\u6c17\u98df\u3046\u3088\u306d... => USB\u30db\u30b9\u30c8\u3068UART\u304c\u3064\u304b\u3048\u308b\u30de\u30a4\u30b3\u30f3\u304c\u624b\u5143\u306b\u306a\u3044..(\u304a\u52e7\u3081\u3042\u3063\u305f\u3089\u3001\u30b3\u30e1\u30f3\u30c8\u3078)\n\n\n\n\n\u6982\u8981\n\n\n\u30ad\u30fc\u30dc\u30fc\u30c9 <=USB=> RPi <=UART(\u30b7\u30ea\u30a2\u30eb)=> BLEnano <= Bluetooth => PC\u3067\u3044\u304f\u306e\u3067\u306f\u306a\u3044\u304b\u3068...\n\u95a2\u9023: @Biacco\u3055\u3093\u306e\u8a18\u4e8b\u300cErgoDox BT \u306e\u8a2d\u8a08\u30fb\u5b9f\u88c5\u306b\u8a66\u884c\u932f\u8aa4\u3057\u305f\u8a71\u3042\u3089\u305f\u3081\u8a66\u884c\u932f\u8aa4\u3057\u3066\u3044\u308b\u8a71\u300d\n(2017-0105):\u52d5\u3044\u305f\u3093\u3060\u3051\u3069\u3001\u3001\u3082\u3063\u3068\u3061\u30fc\u3077\u306a\u30de\u30a4\u30b3\u30f3\u3067\u3084\u308a\u305f\u3044\u3088\u306d.\n\n\nTODO\n\nbuildroot\u3068\u304b\u3067\u30b3\u30f3\u30d1\u30af\u30c8\u306b\u307e\u3068\u3081\u308b\uff1f\n(\u8ffd\u52a0:2017-01-05)\n\n\n\u8a18\u4e8b\u3092\u6574\u7406\u3059\u308b > \u65b0\u3057\u3044\u30a8\u30f3\u30c8\u30ea\u3067\u304b\u304f\uff1f\n(\u6e08:2017-01-05)\u3068\u308a\u3042\u3048\u305a\u3001nRF51\u5074\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068HEX\u3092push\u3057\u305f.\u30b3\u30fc\u30c9\u3092github\u3078..\n\n\n\n(\u6e08:2017-01-05)BLEnano\u3068RPi\u3067\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3059\u308b\u3068\u3053\u3002nodejs\u306eserialport\u3067\u3067\u304d\u308b\u304b\u306a\uff1f\n\nserialport\u4f7f\u3063\u3066\u3001\u3089\u305a\u3071\u3044\u5074\u306f\u3067\u304d\u305f\u304b\u3082\uff1f\nBLENano\u5074\u3092\u5bfe\u5fdc\u3055\u305b\u308b..\n\n\n(\u6e08:2017-01-05)PC\u304b\u3089\u9001\u3089\u308c\u3066\u304f\u308bCAPS\u306a\u3069\u306eLED\u306b\u5bfe\u5fdc\u3002\n\n\n\n\u74b0\u5883\n\nRaspberry Pi 2RPi3\u3067\u3001UART\u3063\u3066\u4f7f\u3046\u306e\u9762\u5012\u3060\u3063\u305f\u3088\u306d?? => MK-20\u306e\u307e\u307e\u633f\u305b\u3070\u3001/dev/ttyACM0\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3002\nRaspberry Pi Zero : /dev/ttyAMA0\u4f7f\u7528\nWindows 7 64bit\n\n\n/home/pi/hid/kbd_usb2bt.js____/etc/rc.local\u3042\u305f\u308a\u304b\u3089\u3001\u3088\u3076\u3002&\u3064\u3051\u308b\n#!/home/pi/.nvm/versions/node/v6.9.3/bin/node\n\nvar comDevName = \"/dev/ttyAMA0\";\n\nvar bSendText = false; //Text\u306b\u3057\u3066\u9001\u308b\u3002;\nvar bVerbose = false;\nvar HID = require('node-hid');\nvar device = new HID.HID(HID.devices()[0].path)\n\nvar SerialPort = require(\"serialport\");\n//SerialPort.list(function (err, ports) {console.log(ports);}\n\nvar port = new SerialPort(comDevName, {\n  baudRate: 38400\n});\n\nconst bufLFCR = new Buffer([0x0d,0x0a]);\nvar buf = new Buffer(10);\n// 0xfe \u59cb\u7aef : 8\u30d0\u30a4\u30c8\u30c7\u30fc\u30bf : 0xfd \u7d42\u7aef \u307f\u305f\u3044\u306a\uff1f.\nbuf.writeUInt8(0xfe,0); \nbuf.writeUInt8(0xfd,9); \n\nport.on('data', function (data) {\n  //bit 0: Num Lock\n  //bit 1: Caps Lock\n  //bit 2: Scroll Lock\n  //bit 3: Compose\n  //bit 4: Kana\n  //bit 5: Shift\n  if (bVerbose) console.log((('0'+data[0].toString(16)).slice(-2)));\n  device.write([0x80+data[0]]);\n});\n\ndevice.on(\"data\", function(data) {\n  //console.log(data);\n  data.copy(buf, 1,0,8);\n  if (bVerbose) console.log(buf);\n  if (bSendText) {\n      buf.forEach(function(a,b,c){port.write(('0'+a.toString(16)+' ').slice(-3));});\n      port.write(bufLFCR);\n  } else {\n      port.write(buf);\n  }\n});\n\n\n\n\u2193\u306f\u3001\u4f5c\u696d\u5185\u5bb9\u3002\u307e\u3068\u307e\u3063\u3066\u306a\u3044...\n\n\n\u78ba\u8a8d\u3067\u304d\u3066\u308b\u3053\u3068\n\nBLEnano Nordic nRF51 UART\u3067\u53d7\u3051\u53d6\u3063\u305f\u6587\u5b57\u3092\u3001HID\u30ad\u30fc\u30dc\u30fc\u30c9\u3068\u3057\u3066\u3001\u30bf\u30a4\u30d7\u3059\u308b\u3002=>\u30b7\u30ea\u30a2\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308a\u3001BLEnano\u7d4c\u7531\u3067\u3001\u6587\u5b57\u306e\u30bf\u30a4\u30d7\u3002\n\nRPi + nodejs + node-hid\u306b\u3066\u3001\u30ad\u30fc\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\u3002\n\nnode.js\u306e\u6e96\u5099\u306a\u3069\nsudo apt-get install libusb-1.0-0-dev\n# \u53e4\u3044nodejs\u3092\u524a\u9664\nsudo apt-get autoremove nodejs -y\n# nvm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash\n# \nexport NVM_DIR=\"/home/pi/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\"\n# node LTS\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnvm install --lts\nnvm use --lts\n#\n# node-hid\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nmkdir /home/pi/hid ; cd /home/pi/hid\nnpm install node-hid\n\n\n\nroot\u306b\u3066\u5b9f\u884c\nsudo bash\nexport NVM_DIR=\"/home/pi/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\"\ncd /home/pi/hid\nnode\n\n\n\nroot\u3067\u5b9f\u884c.\u3089\u305a\u3071\u3044\u306eUSB\u306b\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u307f\u633f\u3057\u3066\u30c6\u30b9\u30c8\nvar HID = require('node-hid');\nvar deviceFirst = new HID.HID(HID.devices()[0].path)\ndeviceFirst.on(\"data\", function(data) { console.log(data) });\n/* \n\u3053\u3053\u3067\u3000Hello\u3000\u3068\u30bf\u30a4\u30d7\u3059\u308b\u3068\u3001\u30ad\u30fc\u30b3\u30fc\u30c9\u304c\u3067\u3066\u304f\u308b\u3002\n<Buffer 02 00 00 00 00 00 00 00>   L_SHIFT\n<Buffer 02 00 0b 00 00 00 00 00>   L_SHIFT+ 'h'\n<Buffer 02 00 00 00 00 00 00 00>   L_SHIFT\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 08 00 00 00 00 00>   'e'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 0f 00 00 00 00 00>   'l'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 0f 00 00 00 00 00>   'l'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 12 00 00 00 00 00>   'o'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n*/\n\n\n=> \u3053\u308c\u3001\u305d\u306e\u307e\u307e\u3001\u9001\u4fe1\u3059\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306d\uff1f\n\n\n\u30b7\u30ea\u30a2\u30eb(UART)\u52d5\u4f5cnpm install serialport node-hid \u306b\u3066\u3002\n\u3089\u305a\u3071\u3044\u306eUART(ttyAMA0)\u3068\u3001Windows(USB\u306ePL2303)\u306eTeraTerm\u306b\u3066\u901a\u4fe1\n\n\nttyAMA0\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002\u30ed\u30b0\u30a4\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n\n/boot/cmdline.txt\u304b\u3089\u3001console=serial0,115200\u3092\u6d88\u3059.\ndwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles\n#\u5143.\n#dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles                                                       ```\n\n\n\nserial-getty@ttyAMA0.service\u3092\u505c\u6b62\u3002\nsudo systemctl stop serial-getty@ttyAMA0.service\nsudo systemctl disable serial-getty@ttyAMA0.service\n\n\n\n\nroot\u306b\u3066\u3001node\u5b9f\u884c\n\nnode\u3053\u3093\u305d\u30fc\u308b\u306b\u3066\nvar bSendText = true; //Text\u306b\u3057\u3066\u9001\u308b\u3002\n\nvar HID = require('node-hid');\nvar device = new HID.HID(HID.devices()[0].path)\n\nvar SerialPort = require(\"serialport\");\n//SerialPort.list(function (err, ports) {console.log(ports);}\n\nvar port = new SerialPort(\"/dev/ttyAMA0\", {\n  baudRate: 38400\n});\n\nconst bufLFCR = new Buffer([0x0d,0x0a]);\nvar buf = new Buffer(10);\n// 0xfe \u59cb\u7aef : 8\u30d0\u30a4\u30c8\u30c7\u30fc\u30bf : 0xfd \u7d42\u7aef \u307f\u305f\u3044\u306a\uff1f.\nbuf.writeUInt8(0xfe,0); \nbuf.writeUInt8(0xfd,9); \n\nport.on('data', function (data) {\n  console.log(data);\n});\n\ndevice.on(\"data\", function(data) {\n  //console.log(data);\n  data.copy(buf, 1,0,8);\n  console.log(buf);\n  if (bSendText) {\n      buf.forEach(function(a,b,c){port.write(('0'+a.toString(16)+' ').slice(-3));});\n      port.write(bufLFCR);\n  } else {\n      port.write(buf);\n  }\n});\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u51fa\u3066\u304f\u308b\u3002 ::Hello\u3068\u6253\u3063\u305f\u3068\u3053\u3002\n\n\n\n\n\n\n\u305d\u306e\u4ed6\n\nbleno\u3068\u304b\u3067\u3067\u3001HID-Keyboard\u306b\u5316\u3051\u3089\u308c\u308c\u3070...\n\u203bbleno: A Node.js module for implementing BLE (Bluetooth Low Energy) peripherals\n\u203bnoble: A Node.js BLE (Bluetooth Low Energy) central module \n\n\u52d5\u304d\u307e\u3057\u305f.. <del><font color='red'>**...\u3078\u306e\u9053**</font> \u306a\u306e\u3067\u3001\u307e\u3060\u52d5\u4f5c\u3057\u3066\u3044\u306a\u3044. (\u30b5\u30ae\u3060\u30fc.</del>\n\n- (2017-01-05) \u2193\u3053\u308c\u3067\u3001\u66f4\u65b0\u3057\u3066\u307e\u3059\u3002<br>`\u30ad\u30fc\u30dc\u30fc\u30c9` <=USB=> `RPi` <=UART(\u30b7\u30ea\u30a2\u30eb)=> `BLEnano` <= Bluetooth => `PC`<br>\n![Qiita-USBKBD2BT.jpg](https://qiita-image-store.s3.amazonaws.com/0/75594/1cb2b87f-e315-5cf7-03fa-0af3dbc45999.jpeg)\n    - \u3069\u306e\u30ad\u30fc\u3082\u4f7f\u3048\u307e\u3059\u3002(HID USB\u3067\u306a\u304c\u308c\u3066\u304f\u308b\u30ad\u30fc\u30b3\u30fc\u30c9\u3001\u305d\u306e\u307e\u307e\u3001BT\u3078\u6295\u3052\u3066\u308b)\n    - LED\u3082\u70b9\u304f\u3088(\u3053\u306e\u30ad\u30fc\u30dc\u30fc\u30c9\u306b\u3064\u3044\u3066\u308b\u3001CAPS\u3001NumLock\u3001ScrLk\u306e\u307f\u78ba\u8a8d)\n    - \u3061\u3087\u3044\u3068\u3001\u4e0d\u5b89\u5b9a\uff1f\u4e00\u5ea6\u3001\u63a5\u7d9a\u3067\u304d\u308c\u3070\u3001\u6bd4\u8f03\u7684\u5b89\u5b9a\u3002\n    - \u96fb\u6e90\u5207\u308b\u3068\u304d\u306f\u3001\u3076\u3061\u3063\u3001\u3068\u3084\u308b\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u3084\u3070\u3044\u304b\u3082\uff1f\n    - iPhone\u306b\u3082\u3064\u306a\u304c\u308b\u3088\n    - \u5b9f\u7528\u6027?? USB\u7aef\u5b50\u304c\u305f\u308a\u306a\u3044\u3068\u304d\u3001\u3068\u304b?\n    - \u3089\u305a\u3071\u3044\u3063\u3066\u3001\u96fb\u6c17\u98df\u3046\u3088\u306d... => USB\u30db\u30b9\u30c8\u3068UART\u304c\u3064\u304b\u3048\u308b\u30de\u30a4\u30b3\u30f3\u304c\u624b\u5143\u306b\u306a\u3044..(\u304a\u52e7\u3081\u3042\u3063\u305f\u3089\u3001\u30b3\u30e1\u30f3\u30c8\u3078)\n\n## \u6982\u8981\n- `\u30ad\u30fc\u30dc\u30fc\u30c9` <=USB=> `RPi` <=UART(\u30b7\u30ea\u30a2\u30eb)=> `BLEnano` <= Bluetooth => `PC`<br>\u3067\u3044\u304f\u306e\u3067\u306f\u306a\u3044\u304b\u3068...\n- \u95a2\u9023: @Biacco\u3055\u3093\u306e\u8a18\u4e8b\u300c[ErgoDox BT \u306e\u8a2d\u8a08\u30fb\u5b9f\u88c5\u306b\u8a66\u884c\u932f\u8aa4\u3057\u305f\u8a71\u3042\u3089\u305f\u3081\u8a66\u884c\u932f\u8aa4\u3057\u3066\u3044\u308b\u8a71](http://qiita.com/Biacco/items/259c36cfb36f4ee8dd49)\u300d\n- (2017-0105):\u52d5\u3044\u305f\u3093\u3060\u3051\u3069\u3001\u3001\u3082\u3063\u3068\u3061\u30fc\u3077\u306a\u30de\u30a4\u30b3\u30f3\u3067\u3084\u308a\u305f\u3044\u3088\u306d.\n\n## TODO\n- buildroot\u3068\u304b\u3067\u30b3\u30f3\u30d1\u30af\u30c8\u306b\u307e\u3068\u3081\u308b\uff1f\n- (\u8ffd\u52a0:2017-01-05)\n    - \u8a18\u4e8b\u3092\u6574\u7406\u3059\u308b > \u65b0\u3057\u3044\u30a8\u30f3\u30c8\u30ea\u3067\u304b\u304f\uff1f\n    - (\u6e08:2017-01-05)\u3068\u308a\u3042\u3048\u305a\u3001nRF51\u5074\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3068HEX\u3092push\u3057\u305f.<del>\u30b3\u30fc\u30c9\u3092github\u3078..</del>\n- (\u6e08:2017-01-05)<del>BLEnano\u3068RPi\u3067\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3059\u308b\u3068\u3053\u3002<br>nodejs\u306e`serialport`\u3067\u3067\u304d\u308b\u304b\u306a\uff1f</del>\n    - <del>`serialport`\u4f7f\u3063\u3066\u3001\u3089\u305a\u3071\u3044\u5074\u306f\u3067\u304d\u305f\u304b\u3082\uff1f</del>\n    - <del>BLENano\u5074\u3092\u5bfe\u5fdc\u3055\u305b\u308b..</del>\n- (\u6e08:2017-01-05)<del>PC\u304b\u3089\u9001\u3089\u308c\u3066\u304f\u308bCAPS\u306a\u3069\u306eLED\u306b\u5bfe\u5fdc\u3002</del>\n\n## \u74b0\u5883\n- Raspberry Pi 2<br>RPi3\u3067\u3001UART\u3063\u3066<del>\u4f7f\u3046\u306e\u9762\u5012\u3060\u3063\u305f\u3088\u306d??</del> <br>=> MK-20\u306e\u307e\u307e\u633f\u305b\u3070\u3001`/dev/ttyACM0`\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3002\n- Raspberry Pi Zero : `/dev/ttyAMA0`\u4f7f\u7528\n- Windows 7 64bit\n\n\n\n```js:/home/pi/hid/kbd_usb2bt.js____/etc/rc.local\u3042\u305f\u308a\u304b\u3089\u3001\u3088\u3076\u3002&\u3064\u3051\u308b\n#!/home/pi/.nvm/versions/node/v6.9.3/bin/node\n\nvar comDevName = \"/dev/ttyAMA0\";\n\nvar bSendText = false; //Text\u306b\u3057\u3066\u9001\u308b\u3002;\nvar bVerbose = false;\nvar HID = require('node-hid');\nvar device = new HID.HID(HID.devices()[0].path)\n\nvar SerialPort = require(\"serialport\");\n//SerialPort.list(function (err, ports) {console.log(ports);}\n\nvar port = new SerialPort(comDevName, {\n  baudRate: 38400\n});\n\nconst bufLFCR = new Buffer([0x0d,0x0a]);\nvar buf = new Buffer(10);\n// 0xfe \u59cb\u7aef : 8\u30d0\u30a4\u30c8\u30c7\u30fc\u30bf : 0xfd \u7d42\u7aef \u307f\u305f\u3044\u306a\uff1f.\nbuf.writeUInt8(0xfe,0); \nbuf.writeUInt8(0xfd,9); \n\nport.on('data', function (data) {\n  //bit 0: Num Lock\n  //bit 1: Caps Lock\n  //bit 2: Scroll Lock\n  //bit 3: Compose\n  //bit 4: Kana\n  //bit 5: Shift\n  if (bVerbose) console.log((('0'+data[0].toString(16)).slice(-2)));\n  device.write([0x80+data[0]]);\n});\n\ndevice.on(\"data\", function(data) {\n  //console.log(data);\n  data.copy(buf, 1,0,8);\n  if (bVerbose) console.log(buf);\n  if (bSendText) {\n      buf.forEach(function(a,b,c){port.write(('0'+a.toString(16)+' ').slice(-3));});\n      port.write(bufLFCR);\n  } else {\n      port.write(buf);\n  }\n});\n```\n\n----\n\n\u2193\u306f\u3001\u4f5c\u696d\u5185\u5bb9\u3002\u307e\u3068\u307e\u3063\u3066\u306a\u3044...\n\n----\n## \u78ba\u8a8d\u3067\u304d\u3066\u308b\u3053\u3068\n- [BLEnano Nordic nRF51 UART\u3067\u53d7\u3051\u53d6\u3063\u305f\u6587\u5b57\u3092\u3001HID\u30ad\u30fc\u30dc\u30fc\u30c9\u3068\u3057\u3066\u3001\u30bf\u30a4\u30d7\u3059\u308b\u3002](http://qiita.com/mt08/items/50683e3e135ba13aed21)<br>=>\u30b7\u30ea\u30a2\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u53d6\u308a\u3001BLEnano\u7d4c\u7531\u3067\u3001\u6587\u5b57\u306e\u30bf\u30a4\u30d7\u3002\n\n- RPi + nodejs + node-hid\u306b\u3066\u3001\u30ad\u30fc\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\u3002\n\n    ```bash:node.js\u306e\u6e96\u5099\u306a\u3069\nsudo apt-get install libusb-1.0-0-dev\n# \u53e4\u3044nodejs\u3092\u524a\u9664\nsudo apt-get autoremove nodejs -y\n# nvm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.0/install.sh | bash\n# \nexport NVM_DIR=\"/home/pi/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\"\n# node LTS\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnvm install --lts\nnvm use --lts\n#\n# node-hid\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nmkdir /home/pi/hid ; cd /home/pi/hid\nnpm install node-hid\n```\n\n    ```bash:root\u306b\u3066\u5b9f\u884c\nsudo bash\nexport NVM_DIR=\"/home/pi/.nvm\"\n[ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\"\ncd /home/pi/hid\nnode\n```\n\n    ```js:root\u3067\u5b9f\u884c.\u3089\u305a\u3071\u3044\u306eUSB\u306b\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u307f\u633f\u3057\u3066\u30c6\u30b9\u30c8\nvar HID = require('node-hid');\nvar deviceFirst = new HID.HID(HID.devices()[0].path)\ndeviceFirst.on(\"data\", function(data) { console.log(data) });\n/* \n \u3053\u3053\u3067\u3000Hello\u3000\u3068\u30bf\u30a4\u30d7\u3059\u308b\u3068\u3001\u30ad\u30fc\u30b3\u30fc\u30c9\u304c\u3067\u3066\u304f\u308b\u3002\n<Buffer 02 00 00 00 00 00 00 00>   L_SHIFT\n<Buffer 02 00 0b 00 00 00 00 00>   L_SHIFT+ 'h'\n<Buffer 02 00 00 00 00 00 00 00>   L_SHIFT\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 08 00 00 00 00 00>   'e'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 0f 00 00 00 00 00>   'l'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 0f 00 00 00 00 00>   'l'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n<Buffer 00 00 12 00 00 00 00 00>   'o'\n<Buffer 00 00 00 00 00 00 00 00>   (none)\n*/\n```\n=> \u3053\u308c\u3001\u305d\u306e\u307e\u307e\u3001\u9001\u4fe1\u3059\u308c\u3070\u3044\u3044\u3093\u3058\u3083\u306d\uff1f\n\n\n- \u30b7\u30ea\u30a2\u30eb(UART)\u52d5\u4f5c<br>`npm install serialport node-hid` \u306b\u3066\u3002\n\u3089\u305a\u3071\u3044\u306eUART(ttyAMA0)\u3068\u3001Windows(USB\u306ePL2303)\u306eTeraTerm\u306b\u3066\u901a\u4fe1\n\n    - `ttyAMA0`\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3002<br>\u30ed\u30b0\u30a4\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n\n        ```txt:/boot/cmdline.txt\u304b\u3089\u3001console=serial0,115200\u3092\u6d88\u3059.\ndwc_otg.lpm_enable=0 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles\n#\u5143.\n#dwc_otg.lpm_enable=0 console=serial0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles                                                       ```\n```\n\n        ```bash:serial-getty@ttyAMA0.service\u3092\u505c\u6b62\u3002\nsudo systemctl stop serial-getty@ttyAMA0.service\nsudo systemctl disable serial-getty@ttyAMA0.service\n```\n\n    - root\u306b\u3066\u3001node\u5b9f\u884c\n\n        ```javascript:node\u3053\u3093\u305d\u30fc\u308b\u306b\u3066\nvar bSendText = true; //Text\u306b\u3057\u3066\u9001\u308b\u3002\n\n        var HID = require('node-hid');\nvar device = new HID.HID(HID.devices()[0].path)\n\n\n        var SerialPort = require(\"serialport\");\n//SerialPort.list(function (err, ports) {console.log(ports);}\n\n        var port = new SerialPort(\"/dev/ttyAMA0\", {\n          baudRate: 38400\n});\n\n        const bufLFCR = new Buffer([0x0d,0x0a]);\nvar buf = new Buffer(10);\n// 0xfe \u59cb\u7aef : 8\u30d0\u30a4\u30c8\u30c7\u30fc\u30bf : 0xfd \u7d42\u7aef \u307f\u305f\u3044\u306a\uff1f.\nbuf.writeUInt8(0xfe,0); \nbuf.writeUInt8(0xfd,9); \n\n        port.on('data', function (data) {\n          console.log(data);\n});\n\n        device.on(\"data\", function(data) {\n          //console.log(data);\n          data.copy(buf, 1,0,8);\n          console.log(buf);\n          if (bSendText) {\n              buf.forEach(function(a,b,c){port.write(('0'+a.toString(16)+' ').slice(-3));});\n              port.write(bufLFCR);\n          } else {\n              port.write(buf);\n          }\n});\n```\n\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u51fa\u3066\u304f\u308b\u3002<br> ::Hello\u3068\u6253\u3063\u305f\u3068\u3053\u3002\n![Qiita-BLENano-HID-Test02.png](https://qiita-image-store.s3.amazonaws.com/0/75594/0f79a183-572d-2eab-8722-01eec8b86694.png)\n\n\n\n## \u305d\u306e\u4ed6\n- bleno\u3068\u304b\u3067\u3067\u3001HID-Keyboard\u306b\u5316\u3051\u3089\u308c\u308c\u3070...\n<br>\u203b[bleno](https://github.com/sandeepmistry/bleno): *A Node.js module for implementing BLE (Bluetooth Low Energy) peripherals*\n<br>\u203b[noble](https://github.com/sandeepmistry/noble): *A Node.js BLE (Bluetooth Low Energy) central module* \n", "tags": ["Node.js", "BLE", "BLEnano", "RaspberryPi"]}