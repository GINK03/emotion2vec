{"context": " More than 1 year has passed since last update.\n\n1. \u3084\u308a\u305f\u3044\u3053\u3068\nPlay2\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092AWS\u3068\u304bGCP\u306b\u914d\u5e03\u3057\u305f\u3044\u3002\n\u3067\u3082\u3001\u6bce\u5ea6\u6bce\u5ea6\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bscala\u306e\u5b9f\u884c\u74b0\u5883\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u305f\u304f\u306a\u3044\u3002\u3002\nDocker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u3001\u7c21\u5358\u306b\u30c7\u30d7\u30ed\u30a4\u30f3\u30b0\u304c\u3057\u305f\u3044\u3002\n\n2. \u6210\u679c\u7269\nhttps://hub.docker.com/r/letusfly85/play-sample-auth\nhttps://github.com/letusfly85/scala-oauth2-provider-example-skinny-orm\n\n3. \u624b\u9806\n\n3-1. sbt\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3001build.sbt\u3092\u7de8\u96c6\u3057\u3001sbt-docker plugin\u3092\u6709\u52b9\u306b\u3059\u308b\nsbt-docker \u306eREADME.md\u3092\u898b\u306a\u304c\u3089\u8a2d\u5b9a\u3092\u3057\u307e\u3057\u305f\u3002\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nproject/plugins.sbt\nscalacOptions ++= Seq(\"-deprecation\", \"-language:_\", \"-unchecked\")\n\naddSbtPlugin(\"com.typesafe.play\" % \"sbt-plugin\" % \"2.4.0\")\n\naddSbtPlugin(\"se.marcuslonnberg\" % \"sbt-docker\" % \"1.3.0\")\n\n\n\nbuild.sbt\nlazy val root = (project in file(\".\"))\n.enablePlugins(PlayScala, sbtdocker.DockerPlugin)\n.settings(\n  scalaVersion := \"2.11.7\",\n  scalacOptions := Seq(\"-language:_\", \"-deprecation\", \"-unchecked\", \"-feature\", \"-Xlint\"),\n  javaOptions := Seq(\"-Dplay.evolutions.db.default.autoApply=true\"),\n  transitiveClassifiers in Global := Seq(Artifact.SourceClassifier),\n  sources in (Compile, doc) := Nil,\n  publishArtifact in (Compile, packageDoc) := false,\n  parallelExecution in Test := false\n).settings(\n  resolvers += Resolver.file(\n    \"local-ivy-repos\", file(Path.userHome + \"/.ivy2/local\")\n  )(Resolver.ivyStylePatterns),\n  libraryDependencies ++= Seq(\n    jdbc,\n    evolutions,\n    \"org.skinny-framework\" %% \"skinny-orm\" % \"2.0.5\",\n    \"org.scalikejdbc\" %% \"scalikejdbc-play-dbapi-adapter\" % \"2.4.3\",\n    \"com.nulab-inc\" %% \"play2-oauth2-provider\" % \"0.16.1\"\n  )\n)\n\ndockerfile in docker := {\n  val appDir = stage.value\n  val targetDir = \"/app\"\n\n  new Dockerfile {\n    from(\"java\")\n    entryPoint(s\"$targetDir/bin/${executableScriptName.value}\")\n    copy(appDir, targetDir)\n  }\n}\n\nimageNames in docker := Seq(\n  ImageName(\"letusfly85/play-sample-auth:latest\")\n)\n\nroutesGenerator := InjectedRoutesGenerator\n\n\n\n3-2. .travis.yml\u3092\u7de8\u96c6\u3057\u3066\u3001docker login \u53ca\u3073\u3001sbt dockerBuildAndPush\u3092\u5b9f\u884c\u3055\u305b\u308b\n\ntravis.yml\nlanguage: scala\nscala:\n  - 2.11.7\n\nservices:\n  - docker\n\nscript:\n  - sbt clean compile\n  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS\n  - sbt dockerBuildAndPush\n\n\n\n3-3. \u4efb\u610f\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3001docker run\u3092\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5229\u7528\u53ef\u80fd\u304b\u78ba\u8a8d\u3059\u308b\ndocker run -i -p 80:9000 -e \"JAVA_OPTS=-Dplay.evolutions.db.default.autoApply=true\" letusfly85/play-sample-auth\n\n\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u3001JAVA_OPTS\u3092\u6e21\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u3053\u308c\u304c\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3067\u5fc5\u8981\u306a\u4ed5\u69d8\u3060\u304b\u3089\u3067\u3059\uff3e\uff3e\uff1b\n\u307e\u305f\u3001build.sbt\u306e\u4e2d\u3067\u3001ENTRYPOINT\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001docker run\u3059\u308b\u969b\u306b\u3001\u30b3\u30de\u30f3\u30c9\u306f\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u7d50\u679c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\ndocker run -i -p 80:9000 -e \"JAVA_OPTS=-Dplay.evolutions.db.default.autoApply=true\" letusfly85/play-sample-auth\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Could NOT find resource [logback.groovy]\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Could NOT find resource [logback-test.xml]\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Found resource [logback.xml] at [file:/app/conf/logback.xml]\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs multiple times on the classpath.\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs at [jar:file:/app/lib/root.root-0.1-SNAPSHOT.jar!/logback.xml]\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs at [file:/app/conf/logback.xml]\n08:12:53,186 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - debug attribute not set\n08:12:53,187 |-INFO in ch.qos.logback.core.joran.action.ConversionRuleAction - registering conversion word coloredLevel with class [play.api.Logger$ColoredLevel]\n08:12:53,187 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]\n08:12:53,192 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - Naming appender as [STDOUT]\n08:12:53,211 |-INFO in ch.qos.logback.core.joran.action.NestedComplexPropertyIA - Assuming default type [ch.qos.logback.classic.encoder.PatternLayoutEncoder] for [encoder] property\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [play] to INFO\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [application] to DEBUG\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.RootLoggerAction - Setting level of ROOT logger to ERROR\n08:12:53,235 |-INFO in ch.qos.logback.core.joran.action.AppenderRefAction - Attaching appender named [STDOUT] to Logger[ROOT]\n08:12:53,236 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - End of configuration.\n08:12:53,237 |-INFO in ch.qos.logback.classic.joran.JoranConfigurator@6ab778a - Registering current configuration as safe fallback point\n\n[info] - application - Creating Pool for datasource 'default'\n[info] - play.api.db.DefaultDBApi - Database [default] connected at jdbc:h2:mem:play\n[info] - play.api.Play - Application started (Prod)\n[info] - play.core.server.NettyServer - Listening for HTTP on /0:0:0:0:0:0:0:0:9000\n\n\u7d50\u679c\u3001\u30a6\u30a7\u30d6\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3082\u3067\u304d\u307e\u3057\u305f\u3002\n\n4. \u6240\u611f\n\u3042\u3068\u306f\u3001\u30af\u30e9\u30a6\u30c9\u30d9\u30f3\u30c0\u30fc\u304a\u624b\u88fd\u306edocker\u7ba1\u7406\u30c4\u30fc\u30eb\u7b49\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u308a\u3001daemon\u30b9\u30af\u30ea\u30d7\u30c8\u3084systemctl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3061\u3087\u3063\u3068\u7528\u610f\u3059\u308c\u3070\u5229\u7528\u3067\u304d\u306a\u304f\u3082\u306a\u3055\u305d\u3046\u306a\u5370\u8c61\u3067\u3059\u3002\n\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u306a\u3044\u304b\u306a\u30fc\u3001\u3068\u3044\u3063\u305f\u5370\u8c61\u3067\u3059\u306d\uff3e\uff3e\n\n\u672c\u65e5\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\n## 1. \u3084\u308a\u305f\u3044\u3053\u3068\n\nPlay2\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092AWS\u3068\u304bGCP\u306b\u914d\u5e03\u3057\u305f\u3044\u3002\n\u3067\u3082\u3001\u6bce\u5ea6\u6bce\u5ea6\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bscala\u306e\u5b9f\u884c\u74b0\u5883\u3092\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3057\u305f\u304f\u306a\u3044\u3002\u3002\nDocker\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u3066\u3001\u7c21\u5358\u306b\u30c7\u30d7\u30ed\u30a4\u30f3\u30b0\u304c\u3057\u305f\u3044\u3002\n\n## 2. \u6210\u679c\u7269\n\nhttps://hub.docker.com/r/letusfly85/play-sample-auth\nhttps://github.com/letusfly85/scala-oauth2-provider-example-skinny-orm\n\n## 3. \u624b\u9806\n\n### 3-1. sbt\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3001build.sbt\u3092\u7de8\u96c6\u3057\u3001sbt-docker plugin\u3092\u6709\u52b9\u306b\u3059\u308b\n\n[sbt-docker](https://github.com/marcuslonnberg/sbt-docker) \u306eREADME.md\u3092\u898b\u306a\u304c\u3089\u8a2d\u5b9a\u3092\u3057\u307e\u3057\u305f\u3002\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```project/plugins.sbt\nscalacOptions ++= Seq(\"-deprecation\", \"-language:_\", \"-unchecked\")\n\naddSbtPlugin(\"com.typesafe.play\" % \"sbt-plugin\" % \"2.4.0\")\n\naddSbtPlugin(\"se.marcuslonnberg\" % \"sbt-docker\" % \"1.3.0\")\n```\n\n```build.sbt\nlazy val root = (project in file(\".\"))\n.enablePlugins(PlayScala, sbtdocker.DockerPlugin)\n.settings(\n  scalaVersion := \"2.11.7\",\n  scalacOptions := Seq(\"-language:_\", \"-deprecation\", \"-unchecked\", \"-feature\", \"-Xlint\"),\n  javaOptions := Seq(\"-Dplay.evolutions.db.default.autoApply=true\"),\n  transitiveClassifiers in Global := Seq(Artifact.SourceClassifier),\n  sources in (Compile, doc) := Nil,\n  publishArtifact in (Compile, packageDoc) := false,\n  parallelExecution in Test := false\n).settings(\n  resolvers += Resolver.file(\n    \"local-ivy-repos\", file(Path.userHome + \"/.ivy2/local\")\n  )(Resolver.ivyStylePatterns),\n  libraryDependencies ++= Seq(\n    jdbc,\n    evolutions,\n    \"org.skinny-framework\" %% \"skinny-orm\" % \"2.0.5\",\n    \"org.scalikejdbc\" %% \"scalikejdbc-play-dbapi-adapter\" % \"2.4.3\",\n    \"com.nulab-inc\" %% \"play2-oauth2-provider\" % \"0.16.1\"\n  )\n)\n\ndockerfile in docker := {\n  val appDir = stage.value\n  val targetDir = \"/app\"\n\n  new Dockerfile {\n    from(\"java\")\n    entryPoint(s\"$targetDir/bin/${executableScriptName.value}\")\n    copy(appDir, targetDir)\n  }\n}\n\nimageNames in docker := Seq(\n  ImageName(\"letusfly85/play-sample-auth:latest\")\n)\n\nroutesGenerator := InjectedRoutesGenerator\n```\n\n\n\n### 3-2. .travis.yml\u3092\u7de8\u96c6\u3057\u3066\u3001`docker login` \u53ca\u3073\u3001`sbt dockerBuildAndPush`\u3092\u5b9f\u884c\u3055\u305b\u308b\n\n```.travis.yml\nlanguage: scala\nscala:\n  - 2.11.7\n\nservices:\n  - docker\n\nscript:\n  - sbt clean compile\n  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS\n  - sbt dockerBuildAndPush\n```\n\n### 3-3. \u4efb\u610f\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3001docker run\u3092\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u5229\u7528\u53ef\u80fd\u304b\u78ba\u8a8d\u3059\u308b\n\n```bash\ndocker run -i -p 80:9000 -e \"JAVA_OPTS=-Dplay.evolutions.db.default.autoApply=true\" letusfly85/play-sample-auth\n```\n\n\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u3001JAVA_OPTS\u3092\u6e21\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u3053\u308c\u304c\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3067\u5fc5\u8981\u306a\u4ed5\u69d8\u3060\u304b\u3089\u3067\u3059\uff3e\uff3e\uff1b\n\n\u307e\u305f\u3001build.sbt\u306e\u4e2d\u3067\u3001ENTRYPOINT\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001`docker run`\u3059\u308b\u969b\u306b\u3001\u30b3\u30de\u30f3\u30c9\u306f\u4e0d\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\n\n```bash\ndocker run -i -p 80:9000 -e \"JAVA_OPTS=-Dplay.evolutions.db.default.autoApply=true\" letusfly85/play-sample-auth\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Could NOT find resource [logback.groovy]\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Could NOT find resource [logback-test.xml]\n08:12:53,091 |-INFO in ch.qos.logback.classic.LoggerContext[default] - Found resource [logback.xml] at [file:/app/conf/logback.xml]\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs multiple times on the classpath.\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs at [jar:file:/app/lib/root.root-0.1-SNAPSHOT.jar!/logback.xml]\n08:12:53,091 |-WARN in ch.qos.logback.classic.LoggerContext[default] - Resource [logback.xml] occurs at [file:/app/conf/logback.xml]\n08:12:53,186 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - debug attribute not set\n08:12:53,187 |-INFO in ch.qos.logback.core.joran.action.ConversionRuleAction - registering conversion word coloredLevel with class [play.api.Logger$ColoredLevel]\n08:12:53,187 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - About to instantiate appender of type [ch.qos.logback.core.ConsoleAppender]\n08:12:53,192 |-INFO in ch.qos.logback.core.joran.action.AppenderAction - Naming appender as [STDOUT]\n08:12:53,211 |-INFO in ch.qos.logback.core.joran.action.NestedComplexPropertyIA - Assuming default type [ch.qos.logback.classic.encoder.PatternLayoutEncoder] for [encoder] property\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [play] to INFO\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.LoggerAction - Setting level of logger [application] to DEBUG\n08:12:53,235 |-INFO in ch.qos.logback.classic.joran.action.RootLoggerAction - Setting level of ROOT logger to ERROR\n08:12:53,235 |-INFO in ch.qos.logback.core.joran.action.AppenderRefAction - Attaching appender named [STDOUT] to Logger[ROOT]\n08:12:53,236 |-INFO in ch.qos.logback.classic.joran.action.ConfigurationAction - End of configuration.\n08:12:53,237 |-INFO in ch.qos.logback.classic.joran.JoranConfigurator@6ab778a - Registering current configuration as safe fallback point\n\n[info] - application - Creating Pool for datasource 'default'\n[info] - play.api.db.DefaultDBApi - Database [default] connected at jdbc:h2:mem:play\n[info] - play.api.Play - Application started (Prod)\n[info] - play.core.server.NettyServer - Listening for HTTP on /0:0:0:0:0:0:0:0:9000\n```\n\n\u7d50\u679c\u3001\u30a6\u30a7\u30d6\u30d6\u30e9\u30a6\u30b6\u30a2\u30af\u30bb\u30b9\u3082\u3067\u304d\u307e\u3057\u305f\u3002\n\n## 4. \u6240\u611f\n\n\u3042\u3068\u306f\u3001\u30af\u30e9\u30a6\u30c9\u30d9\u30f3\u30c0\u30fc\u304a\u624b\u88fd\u306edocker\u7ba1\u7406\u30c4\u30fc\u30eb\u7b49\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u308a\u3001daemon\u30b9\u30af\u30ea\u30d7\u30c8\u3084systemctl\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u3061\u3087\u3063\u3068\u7528\u610f\u3059\u308c\u3070\u5229\u7528\u3067\u304d\u306a\u304f\u3082\u306a\u3055\u305d\u3046\u306a\u5370\u8c61\u3067\u3059\u3002\n\n\u3067\u304d\u306a\u3044\u3053\u3068\u3082\u306a\u3044\u304b\u306a\u30fc\u3001\u3068\u3044\u3063\u305f\u5370\u8c61\u3067\u3059\u306d\uff3e\uff3e\n\n---\n\n\u672c\u65e5\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\n", "tags": ["docker", "Scala", "PlayFramework", "TravisCI", "oauth2"]}