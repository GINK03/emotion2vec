{"context": "SQLAlchemy \u3067 Alter \u306e\u3084\u308a\u65b9\u3092\u8abf\u3079\u305f\u306e\u3067\u3001\u5fd8\u5099\u9332\u7684\u306b\u66f8\u3044\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u6b8b\u5ff5\u306a\u3053\u3068\u306b SQLAlchemy \u306b\u306f\u3001Alter \u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u7279\u5225\u306a\u6a5f\u80fd\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u4e00\u822c\u7684\u306b\u306f\u3001Alembic \u3084 SQLAlchemy-Migrate  \u3068\u3044\u3063\u305f\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u30b9\u30ad\u30fc\u30de\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u3069\u3046\u3057\u3066\u3082\u52d5\u7684\u306b\u30b9\u30ad\u30fc\u30de\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\u3001Connection.execute() \u307e\u305f\u306f DDL\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1eAltering Schemas through Migrations\nhttp://docs.sqlalchemy.org/en/latest/core/metadata.html#altering-schemas-through-migrations\n\n\u52d5\u4f5c\u74b0\u5883\n\nMac OS X 10.11.5\nPython 3.5.1\nMySQL Ver 14.14 Distrib 5.7.11, for osx10.11 (x86_64) using  EditLine wrapper\nSQLAlchemy 1.1.0\nPyMySQL 0.7.4\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u30c6\u30fc\u30d6\u30eb\u306b\u65b0\u3057\u3044\u30ab\u30e9\u30e0\u300ckana\u300d\u3092\u8ffd\u52a0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\nsqlalchemy_alter.py\n# -*- coding:utf-8 -*-\nimport sqlalchemy\nimport sqlalchemy.ext.declarative\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\nclass Student(Base):\n    __tablename__ = 'students'\n    id = sqlalchemy.Column(sqlalchemy.Integer, primary_key=True)\n    name = sqlalchemy.Column(sqlalchemy.String(20))\n\n    @staticmethod\n    def add_column(engine, column):\n        column_name = column.compile(dialect=engine.dialect)\n        column_type = column.type.compile(engine.dialect)\n        engine.execute('ALTER TABLE %s ADD COLUMN %s %s' % (Student.__tablename__, column_name, column_type))\n\ndef main():\n    url = 'mysql+pymysql://root:@localhost/test_db?charset=utf8'\n\n    engine = sqlalchemy.create_engine(url, echo=True)\n\n    # \u30c6\u30fc\u30d6\u30eb\u3092\u30c9\u30ed\u30c3\u30d7\n    Base.metadata.drop_all(engine)\n\n    # \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n    Base.metadata.create_all(engine)\n\n    # \u30c6\u30fc\u30d6\u30eb\u306b\u30ab\u30e9\u30e0\u3092\u8ffd\u52a0\n    column = sqlalchemy.Column('kana', sqlalchemy.String(40), primary_key=False)\n    Student.add_column(engine, column)\n\nif __name__ == '__main__':\n    main()\n\n\n**SQLAlchemy** \u3067 **Alter** \u306e\u3084\u308a\u65b9\u3092\u8abf\u3079\u305f\u306e\u3067\u3001\u5fd8\u5099\u9332\u7684\u306b\u66f8\u3044\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u6b8b\u5ff5\u306a\u3053\u3068\u306b SQLAlchemy \u306b\u306f\u3001Alter \u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u7279\u5225\u306a\u6a5f\u80fd\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\u4e00\u822c\u7684\u306b\u306f\u3001[Alembic](https://alembic.readthedocs.io/) \u3084 [SQLAlchemy-Migrate ](https://github.com/openstack/sqlalchemy-migrate) \u3068\u3044\u3063\u305f\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u3063\u3066\u30b9\u30ad\u30fc\u30de\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u3069\u3046\u3057\u3066\u3082\u52d5\u7684\u306b\u30b9\u30ad\u30fc\u30de\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\u3001[Connection.execute()](http://docs.sqlalchemy.org/en/latest/core/connections.html#sqlalchemy.engine.Connection.execute) \u307e\u305f\u306f [DDL](http://docs.sqlalchemy.org/en/latest/core/ddl.html#sqlalchemy.schema.DDL)\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\uff1eAltering Schemas through Migrations\nhttp://docs.sqlalchemy.org/en/latest/core/metadata.html#altering-schemas-through-migrations\n\n## \u52d5\u4f5c\u74b0\u5883\n- Mac OS X 10.11.5\n- Python 3.5.1\n- MySQL Ver 14.14 Distrib 5.7.11, for osx10.11 (x86_64) using  EditLine wrapper\n- SQLAlchemy 1.1.0\n- PyMySQL 0.7.4\n\n## \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u30c6\u30fc\u30d6\u30eb\u306b\u65b0\u3057\u3044\u30ab\u30e9\u30e0\u300ckana\u300d\u3092\u8ffd\u52a0\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u3059\u3002\n\n```py3:sqlalchemy_alter.py\n# -*- coding:utf-8 -*-\nimport sqlalchemy\nimport sqlalchemy.ext.declarative\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\nclass Student(Base):\n    __tablename__ = 'students'\n    id = sqlalchemy.Column(sqlalchemy.Integer, primary_key=True)\n    name = sqlalchemy.Column(sqlalchemy.String(20))\n\n    @staticmethod\n    def add_column(engine, column):\n        column_name = column.compile(dialect=engine.dialect)\n        column_type = column.type.compile(engine.dialect)\n        engine.execute('ALTER TABLE %s ADD COLUMN %s %s' % (Student.__tablename__, column_name, column_type))\n\ndef main():\n    url = 'mysql+pymysql://root:@localhost/test_db?charset=utf8'\n\n    engine = sqlalchemy.create_engine(url, echo=True)\n\n    # \u30c6\u30fc\u30d6\u30eb\u3092\u30c9\u30ed\u30c3\u30d7\n    Base.metadata.drop_all(engine)\n\n    # \u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\n    Base.metadata.create_all(engine)\n\n    # \u30c6\u30fc\u30d6\u30eb\u306b\u30ab\u30e9\u30e0\u3092\u8ffd\u52a0\n    column = sqlalchemy.Column('kana', sqlalchemy.String(40), primary_key=False)\n    Student.add_column(engine, column)\n\nif __name__ == '__main__':\n    main()\n```\n", "tags": ["Python", "python3", "MySQL", "sqlalchemy"]}