{"context": "\u30bf\u30a4\u30c8\u30eb\u306e\u901a\u308a\u3001docker \u3067 zookeeper \u306e\u30af\u30e9\u30b9\u30bf (= \u30a2\u30f3\u30b5\u30f3\u30d6\u30eb) \u3092\u7acb\u3061\u4e0a\u3052\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3002\n\n\u30af\u30e9\u30b9\u30bf\u7acb\u3061\u4e0a\u3052\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066 docker-compose.yml \u3092\u4f5c\u6210\u3059\u308b\u3002\n$ mkdir zookeeper\n$ cd zookeeper\n$ vi docker-compose.yml\n\nlibrary/zookeeper - Docker Hub \u306b\u66f8\u3044\u3066\u3042\u308b\u5185\u5bb9\u3092\u305d\u306e\u307e\u307e\u66f8\u304d\u8fbc\u3080\u3002\nversion: '2'\nservices:\n    zoo1:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2181:2181\n        environment:\n            ZOO_MY_ID: 1\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n    zoo2:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2182:2181\n        environment:\n            ZOO_MY_ID: 2\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n    zoo3:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2183:2181\n        environment:\n            ZOO_MY_ID: 3\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n\u30c9\u30c3\u30ab\u30fc\u30b3\u30f3\u30dd\u30fc\u30b6\u30c3\u30d7\u3002\n$ docker-compose up -d\nStarting zookeeper_zoo1_1\nStarting zookeeper_zoo2_1\nStarting zookeeper_zoo3_1\n\n\u3046\u307e\u304f\u7acb\u3061\u4e0a\u304c\u3063\u305f\u3063\u307d\u3044\u3002\n$ docker-compose ps\n      Name                    Command               State                     Ports                    \n------------------------------------------------------------------------------------------------------\nzookeeper_zoo1_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2181->2181/tcp, 2888/tcp, 3888/tcp \nzookeeper_zoo2_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2182->2181/tcp, 2888/tcp, 3888/tcp \nzookeeper_zoo3_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2183->2181/tcp, 2888/tcp, 3888/tcp\n\n\n\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\n\u30af\u30e9\u30b9\u30bf\u5185\u306e 1 \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 zkCli.sh \u3068\u3044\u3046\u5c02\u7528\u306e\u30b7\u30a7\u30eb\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n$ docker exec -ti zookeeper_zoo1_1 bin/zkCli.sh\n\nhelp \u3068\u6253\u3064\u3068\u3001\u306a\u3093\u304b\u3044\u308d\u3044\u308d\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n[zk: localhost:2181(CONNECTED) 0] help\nZooKeeper -server host:port cmd args\n        stat path [watch]\n        set path data [version]\n        ls path [watch]\n        delquota [-n|-b] path\n        ls2 path [watch]\n        setAcl path acl\n        setquota -n|-b val path\n        history \n        redo cmdno\n        printwatches on|off\n        delete path [version]\n        sync path\n        listquota path\n        rmr path\n        get path [watch]\n        create [-s] [-e] path data acl\n        addauth scheme auth\n        quit \n        getAcl path\n        close \n        connect host:port\n\n\u3068\u308a\u3042\u3048\u305a zknode \u3092\u4f5c\u3063\u3066\u3001\u5024\u3092\u30bb\u30c3\u30c8\u3057\u305f\u308a\u30b2\u30c3\u30c8\u3057\u3066\u307f\u305f\u308a\u3059\u308b\u3002\nzknode \u306e\u4f5c\u6210\u3002\n[zk: localhost:2181(CONNECTED) 11] create /helloworld \"this is test\"\nCreated /helloworld\n\n\u4f5c\u6210\u3057\u305f zknode \u306e\u5024\u3092\u53d6\u5f97\u3002\n[zk: localhost:2181(CONNECTED) 12] get /helloworld\nthis is test\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000006\nmtime = Thu Jan 12 05:43:06 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 12\nnumChildren = 0\n\n\u5024\u3092 set \u30b3\u30de\u30f3\u30c9\u3067\u66f4\u65b0\u3057\u3066\u307f\u308b\u3002\n[zk: localhost:2181(CONNECTED) 13] set /helloworld \"this is test updated\"\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n\n\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u305f\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n[zk: localhost:2181(CONNECTED) 14] get /helloworld                       \nthis is test updated\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n\n\u3053\u3053\u3067\u4e00\u56de docker exec \u3092\u629c\u3051\u3066\u3001\u5225\u306e zookeeper \u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\ndocker exec -ti zookeeper_zoo1_1 bin/zkCli.sh -server zookeeper_zoo2_1:2181\n\nzknode \u304c\u6b63\u5e38\u306b\u8907\u88fd\u3055\u308c\u3066\u3044\u305f\u3002\n[zk: zookeeper_zoo2_1:2181(CONNECTED) 0] get /helloworld\nthis is test updated\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n\n\n\u307e\u3068\u3081\ndocker-compose \u3067 zookeeper \u306e\u30af\u30e9\u30b9\u30bf\u3092\u7acb\u3061\u4e0a\u3052\u3066\u57fa\u672c\u7684\u306a\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u305f\u3002\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u3092\u8a66\u305b\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6b21\u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u3092\u8a66\u3059\u3002\n\n\u53c2\u8003\u8cc7\u6599\n\nlibrary/zookeeper - Docker Hub\nZooKeeper Getting Started Guide\nzookeeper leader follower \u78ba\u8a8d\u3000\u30b3\u30de\u30f3\u30c9 - Qiita\nHadoop\u672c\u8aad\u66f8\u4f1a - 13\u7ae0 ZooKeeper - \u5927\u898f\u6a21\u5206\u6563\u6280\u8853\u52c9\u5f37\u4f1a in \u540d\u53e4\u5c4b\nCannot use shell pipes with docker exec \u00b7 Issue #8679 \u00b7 docker/docker\n\n\u30bf\u30a4\u30c8\u30eb\u306e\u901a\u308a\u3001docker \u3067 zookeeper \u306e\u30af\u30e9\u30b9\u30bf (= \u30a2\u30f3\u30b5\u30f3\u30d6\u30eb) \u3092\u7acb\u3061\u4e0a\u3052\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u305f\u3002\n\n## \u30af\u30e9\u30b9\u30bf\u7acb\u3061\u4e0a\u3052\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066 docker-compose.yml \u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```\n$ mkdir zookeeper\n$ cd zookeeper\n$ vi docker-compose.yml\n```\n[library/zookeeper \\- Docker Hub](https://hub.docker.com/_/zookeeper/) \u306b\u66f8\u3044\u3066\u3042\u308b\u5185\u5bb9\u3092\u305d\u306e\u307e\u307e\u66f8\u304d\u8fbc\u3080\u3002\n\n```yaml\nversion: '2'\nservices:\n    zoo1:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2181:2181\n        environment:\n            ZOO_MY_ID: 1\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n    zoo2:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2182:2181\n        environment:\n            ZOO_MY_ID: 2\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n\n    zoo3:\n        image: zookeeper\n        restart: always\n        ports:\n            - 2183:2181\n        environment:\n            ZOO_MY_ID: 3\n            ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888\n```\n\n\u30c9\u30c3\u30ab\u30fc\u30b3\u30f3\u30dd\u30fc\u30b6\u30c3\u30d7\u3002\n\n```\n$ docker-compose up -d\nStarting zookeeper_zoo1_1\nStarting zookeeper_zoo2_1\nStarting zookeeper_zoo3_1\n```\n\n\u3046\u307e\u304f\u7acb\u3061\u4e0a\u304c\u3063\u305f\u3063\u307d\u3044\u3002\n\n```\n$ docker-compose ps\n      Name                    Command               State                     Ports                    \n------------------------------------------------------------------------------------------------------\nzookeeper_zoo1_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2181->2181/tcp, 2888/tcp, 3888/tcp \nzookeeper_zoo2_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2182->2181/tcp, 2888/tcp, 3888/tcp \nzookeeper_zoo3_1   /docker-entrypoint.sh zkSe ...   Up      0.0.0.0:2183->2181/tcp, 2888/tcp, 3888/tcp\n```\n\n## \u30c7\u30fc\u30bf\u306e\u8aad\u307f\u66f8\u304d\u3068\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d\n\n\u30af\u30e9\u30b9\u30bf\u5185\u306e 1 \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 `zkCli.sh` \u3068\u3044\u3046\u5c02\u7528\u306e\u30b7\u30a7\u30eb\u3092\u8d77\u52d5\u3057\u3066\u307f\u308b\u3002\n\n```\n$ docker exec -ti zookeeper_zoo1_1 bin/zkCli.sh\n```\n\n`help` \u3068\u6253\u3064\u3068\u3001\u306a\u3093\u304b\u3044\u308d\u3044\u308d\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n\n```\n[zk: localhost:2181(CONNECTED) 0] help\nZooKeeper -server host:port cmd args\n        stat path [watch]\n        set path data [version]\n        ls path [watch]\n        delquota [-n|-b] path\n        ls2 path [watch]\n        setAcl path acl\n        setquota -n|-b val path\n        history \n        redo cmdno\n        printwatches on|off\n        delete path [version]\n        sync path\n        listquota path\n        rmr path\n        get path [watch]\n        create [-s] [-e] path data acl\n        addauth scheme auth\n        quit \n        getAcl path\n        close \n        connect host:port\n```\n\n\u3068\u308a\u3042\u3048\u305a zknode \u3092\u4f5c\u3063\u3066\u3001\u5024\u3092\u30bb\u30c3\u30c8\u3057\u305f\u308a\u30b2\u30c3\u30c8\u3057\u3066\u307f\u305f\u308a\u3059\u308b\u3002\n\nzknode \u306e\u4f5c\u6210\u3002\n\n```\n[zk: localhost:2181(CONNECTED) 11] create /helloworld \"this is test\"\nCreated /helloworld\n```\n\n\u4f5c\u6210\u3057\u305f zknode \u306e\u5024\u3092\u53d6\u5f97\u3002\n\n```\n[zk: localhost:2181(CONNECTED) 12] get /helloworld\nthis is test\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000006\nmtime = Thu Jan 12 05:43:06 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 0\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 12\nnumChildren = 0\n```\n\n\u5024\u3092 `set` \u30b3\u30de\u30f3\u30c9\u3067\u66f4\u65b0\u3057\u3066\u307f\u308b\u3002\n\n```\n[zk: localhost:2181(CONNECTED) 13] set /helloworld \"this is test updated\"\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n```\n\n\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u305f\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n\n```\n[zk: localhost:2181(CONNECTED) 14] get /helloworld                       \nthis is test updated\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n```\n\n\u3053\u3053\u3067\u4e00\u56de `docker exec` \u3092\u629c\u3051\u3066\u3001\u5225\u306e zookeeper \u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n\n```\ndocker exec -ti zookeeper_zoo1_1 bin/zkCli.sh -server zookeeper_zoo2_1:2181\n```\n\nzknode \u304c\u6b63\u5e38\u306b\u8907\u88fd\u3055\u308c\u3066\u3044\u305f\u3002\n\n```\n[zk: zookeeper_zoo2_1:2181(CONNECTED) 0] get /helloworld\nthis is test updated\ncZxid = 0x500000006\nctime = Thu Jan 12 05:43:06 GMT 2017\nmZxid = 0x500000007\nmtime = Thu Jan 12 05:43:25 GMT 2017\npZxid = 0x500000006\ncversion = 0\ndataVersion = 1\naclVersion = 0\nephemeralOwner = 0x0\ndataLength = 20\nnumChildren = 0\n```\n\n## \u307e\u3068\u3081\n\ndocker-compose \u3067 zookeeper \u306e\u30af\u30e9\u30b9\u30bf\u3092\u7acb\u3061\u4e0a\u3052\u3066\u57fa\u672c\u7684\u306a\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u305f\u3002\n\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u3092\u8a66\u305b\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u6b21\u306f\u30d5\u30a7\u30a4\u30eb\u30aa\u30fc\u30d0\u30fc\u3092\u8a66\u3059\u3002\n\n## \u53c2\u8003\u8cc7\u6599\n\n* [library/zookeeper \\- Docker Hub](https://hub.docker.com/_/zookeeper/)\n* [ZooKeeper Getting Started Guide](https://zookeeper.apache.org/doc/r3.3.3/zookeeperStarted.html)\n* [zookeeper leader follower \u78ba\u8a8d\u3000\u30b3\u30de\u30f3\u30c9 \\- Qiita](http://qiita.com/pioho07/items/43e81656a46b51cebc37)\n* [Hadoop\u672c\u8aad\u66f8\u4f1a \\- 13\u7ae0 ZooKeeper \\- \u5927\u898f\u6a21\u5206\u6563\u6280\u8853\u52c9\u5f37\u4f1a in \u540d\u53e4\u5c4b](http://seesaawiki.jp/dainagoya/d/Hadoop%CB%DC%C6%C9%BD%F1%B2%F1%20-%2013%BE%CF%20ZooKeeper)\n* [Cannot use shell pipes with docker exec \u00b7 Issue \\#8679 \u00b7 docker/docker](https://github.com/docker/docker/issues/8679)\n", "tags": ["ZooKeeper", "docker"]}