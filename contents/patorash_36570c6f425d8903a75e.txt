{"context": "\n\nAxlsx\u3067\u30ec\u30dd\u30fc\u30c8\u4f5c\u6210\u3057\u3066s3\u306b\u4fdd\u5b58\u3057\u305f\u3044\nRails\u3084\u3063\u3066\u3044\u305f\u3089\u7ba1\u7406\u753b\u9762\u3068\u304b\u4f5c\u3063\u3066\u3044\u308b\u3068\u30ec\u30dd\u30fc\u30c8\u3092Excel\u3067\u51fa\u529b\u3057\u3066\u307b\u3057\u3044\u3068\u8a00\u308f\u308c\u308b\u3053\u3068\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u306d\u3002\u4e16\u306e\u4e2dExcel\u3067\u52d5\u3044\u3066\u308b\u3093\u3067\u3059\u3088\u306d\u3002Excel\u306f\u3044\u308d\u3093\u306a\u696d\u52d9\u306e\u7cca\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u306d\u3002\n\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092DB\u306b\u7a81\u3063\u8fbc\u3080\u3068\u3001DB\u306e\u5bb9\u91cf\u3092\u98df\u3046\u306e\u3068\u3001DB\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u6642\u9593\u304c\u9577\u304f\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u3001\u3084\u3063\u3071\u308a\u5b89\u5b9a\u306eAmazon s3\u306b\u4fdd\u5b58\u3057\u305f\u3044\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3089\u305a\u306bpaperclip\u7d4c\u7531\u3067\u305d\u306e\u307e\u307e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3044\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u3002\n\n\u3053\u3053\u306b\u66f8\u304b\u306a\u3044\u3053\u3068\n\nRails\u3067\u306epaperclip\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306a\u3069\n\n\n\u3084\u3063\u3066\u307f\u305f\u3002\n\n\u30e2\u30c7\u30eb\n\u30e2\u30c7\u30eb\u306fReport\u30e2\u30c7\u30eb\u3067\u3001\u30ec\u30dd\u30fc\u30c8\u306e\u671f\u9593\u3092\u6307\u5b9a\u3059\u308b\u304f\u3089\u3044\u3067\u3059\u3002\n\nReport\u30e2\u30c7\u30eb\n# == Schema Information\n#\n# Table name: reports\n#\n#  id                   :integer          not null, primary key\n#  start_date           :date             not null\n#  end_date             :date             not null\n#  content_file_name    :string\n#  content_content_type :string\n#  content_file_size    :integer\n#  content_updated_at   :datetime\n#  created_at           :datetime         not null\n#  updated_at           :datetime         not null\n#\n\nclass Report < ActiveRecord::Base\n  has_attached_file :content\n  validates_attached_content_type :content,\n                                  content_type: %w(application/vnd.openxmlformats-officedocument.spreadsheetml.sheet)\nend\n\n\n\n\u30ec\u30dd\u30fc\u30c8\u751f\u6210\u3059\u308bRake Task\n\nreport.rake\nnamespace :report do\n  desc 'Create Report'\n  task :create, \"start_date\", \"end_date\"\n  task create: :environment do |x, args|\n    unless args.start_date.present? && args.end_date.present?\n      puts \"Please input start_date and end_date.\"\n      next\n    end\n    start_date = Date.parse(args.start_date)\n    end_date = Date.parse(args.end_date)\n    range = start_date.to_time..end_date.to_time.end_of_day\n    Axlsx::Package.new do |p|\n      wb = p.workbook\n      default_style = wb.styles.add_style(font_name: '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af', sz: 10)\n      wb.add_worksheet(name: 'Sheet1') do |sheet|\n        # \u30ec\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b5\u30f3\u30d7\u30eb\u306a\u306e\u3067\u9069\u5f53\n        Foo.in_range(range).find_each do |foo|\n          row = [foo.name, foo.price]\n          sheet.add_row row, style: default_style\n        end\n      end\n\n      # \u3053\u3053\u304b\u3089\u304c\u672c\u756a\n      file = Paperclip::StringioAdapter.new(StringIO.new(p.to_stream.read))\n      file.original_filename = \"report_#{start_date.strftime('%Y%m')}.xlsx\"\n      file.content_type = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      Report.create!(start_date: start_date,\n                     end_date: end_date,\n                     content: file)\n    end\n  end\nend\n\n\n\u3059\u308b\u3068\u3001s3\u306bExcel\u30d5\u30a1\u30a4\u30eb\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3057\u305f\u3002\u3084\u3063\u305f\u306d\uff01\n\n\u53c2\u8003URL\n\nHow do I set content_type using StringIO to upload to S3 using PaperClip\n\n# Axlsx\u3067\u30ec\u30dd\u30fc\u30c8\u4f5c\u6210\u3057\u3066s3\u306b\u4fdd\u5b58\u3057\u305f\u3044\n\nRails\u3084\u3063\u3066\u3044\u305f\u3089\u7ba1\u7406\u753b\u9762\u3068\u304b\u4f5c\u3063\u3066\u3044\u308b\u3068\u30ec\u30dd\u30fc\u30c8\u3092Excel\u3067\u51fa\u529b\u3057\u3066\u307b\u3057\u3044\u3068\u8a00\u308f\u308c\u308b\u3053\u3068\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u306d\u3002\u4e16\u306e\u4e2dExcel\u3067\u52d5\u3044\u3066\u308b\u3093\u3067\u3059\u3088\u306d\u3002Excel\u306f\u3044\u308d\u3093\u306a\u696d\u52d9\u306e\u7cca\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u306d\u3002\n\n\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092DB\u306b\u7a81\u3063\u8fbc\u3080\u3068\u3001DB\u306e\u5bb9\u91cf\u3092\u98df\u3046\u306e\u3068\u3001DB\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u6642\u9593\u304c\u9577\u304f\u306a\u308b\u3068\u3044\u3046\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u3001\u3084\u3063\u3071\u308a\u5b89\u5b9a\u306eAmazon s3\u306b\u4fdd\u5b58\u3057\u305f\u3044\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3089\u305a\u306bpaperclip\u7d4c\u7531\u3067\u305d\u306e\u307e\u307e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u3044\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u3002\n\n# \u3053\u3053\u306b\u66f8\u304b\u306a\u3044\u3053\u3068\n\n- Rails\u3067\u306epaperclip\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306a\u3069\n\n# \u3084\u3063\u3066\u307f\u305f\u3002\n\n## \u30e2\u30c7\u30eb\n\n\u30e2\u30c7\u30eb\u306fReport\u30e2\u30c7\u30eb\u3067\u3001\u30ec\u30dd\u30fc\u30c8\u306e\u671f\u9593\u3092\u6307\u5b9a\u3059\u308b\u304f\u3089\u3044\u3067\u3059\u3002\n\n```rb:Report\u30e2\u30c7\u30eb\n# == Schema Information\n#\n# Table name: reports\n#\n#  id                   :integer          not null, primary key\n#  start_date           :date             not null\n#  end_date             :date             not null\n#  content_file_name    :string\n#  content_content_type :string\n#  content_file_size    :integer\n#  content_updated_at   :datetime\n#  created_at           :datetime         not null\n#  updated_at           :datetime         not null\n#\n\nclass Report < ActiveRecord::Base\n  has_attached_file :content\n  validates_attached_content_type :content,\n                                  content_type: %w(application/vnd.openxmlformats-officedocument.spreadsheetml.sheet)\nend\n```\n\n## \u30ec\u30dd\u30fc\u30c8\u751f\u6210\u3059\u308bRake Task\n\n```rb:report.rake\nnamespace :report do\n  desc 'Create Report'\n  task :create, \"start_date\", \"end_date\"\n  task create: :environment do |x, args|\n    unless args.start_date.present? && args.end_date.present?\n      puts \"Please input start_date and end_date.\"\n      next\n    end\n    start_date = Date.parse(args.start_date)\n    end_date = Date.parse(args.end_date)\n    range = start_date.to_time..end_date.to_time.end_of_day\n    Axlsx::Package.new do |p|\n      wb = p.workbook\n      default_style = wb.styles.add_style(font_name: '\uff2d\uff33 \uff30\u30b4\u30b7\u30c3\u30af', sz: 10)\n      wb.add_worksheet(name: 'Sheet1') do |sheet|\n        # \u30ec\u30dd\u30fc\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\u30b5\u30f3\u30d7\u30eb\u306a\u306e\u3067\u9069\u5f53\n        Foo.in_range(range).find_each do |foo|\n          row = [foo.name, foo.price]\n          sheet.add_row row, style: default_style\n        end\n      end\n\n      # \u3053\u3053\u304b\u3089\u304c\u672c\u756a\n      file = Paperclip::StringioAdapter.new(StringIO.new(p.to_stream.read))\n      file.original_filename = \"report_#{start_date.strftime('%Y%m')}.xlsx\"\n      file.content_type = 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n      Report.create!(start_date: start_date,\n                     end_date: end_date,\n                     content: file)\n    end\n  end\nend\n```\n\n\u3059\u308b\u3068\u3001s3\u306bExcel\u30d5\u30a1\u30a4\u30eb\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3057\u305f\u3002\u3084\u3063\u305f\u306d\uff01\n\n# \u53c2\u8003URL\n\n- [How do I set content_type using StringIO to upload to S3 using PaperClip](http://stackoverflow.com/questions/24628212/how-do-i-set-content-type-using-stringio-to-upload-to-s3-using-paperclip)\n", "tags": ["Rails", "ActiveRecord", "Axlsx", "paperclip"]}