{"context": " More than 1 year has passed since last update.\u3053\u308c\u306a\u3089\u5206\u304b\u308b\u6700\u9069\u5316\u6570\u5b66 3.1 \u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u52fe\u914d\u6cd5\uff08\u52fe\u914d\u964d\u4e0b\u6cd5\u30fb\u6700\u6025\u964d\u4e0b\u6cd5\uff09\u3092\u7528\u3044\u3066\u3001\u95a2\u6570\u306b\u6700\u5927\u5024\u30fb\u6700\u5c0f\u5024\u3092\u53d6\u3089\u305b\u308b\u5909\u6570\u306e\u5024\u3092\u6c42\u3081\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u6700\u5927\u5024\u3092\u53d6\u308b\u70b9\u3092\u6c42\u3081\u3066\u3044\u307e\u3059\u3002\n\n1\u5909\u6570\u306e\u5834\u5408\n\nframe()\npar(mfcol=c(1, 1))\npar(mar=c(2, 2, 1, 0.1))\npar(mgp=c(1, 0.2, 0))\nxrange <- c(-3, 3)\nyrange <- c(-1, 1)\nf <- function(x) { cos(x) }\ndx <- function(x) { -sin(x) }\nsearch <- function(x0, f, df) {\n\n    x <- x0\n    h <- 0.7\n    eps <- 1e-6\n    i <- 1\n    # \u89e3\u306e\u79fb\u52d5\u91cf\u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n    repeat {\n        oldx <- x\n        # df(x)\u306e\u7b26\u53f7\u306b\u3088\u3063\u3066\u3001\u9032\u3080\u65b9\u5411\u3092\u6c7a\u3081\u308b\u3002\n        h <- sign(df(x)) * abs(h)\n        newx <- x + h\n        if (f(x) < f(newx)) {\n            # \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u9650\u308a\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u500d\u306b\u3057\u3066\u3044\u304f\u3002\n            repeat {\n                h <- 2 * h\n                x <- newx\n                newx <- x + h\n                if (f(x) >= f(newx)) {\n                    break\n                }\n            }\n            h <- h / 2\n        } else {\n            # \u95a2\u6570\u5024\u304c\u6e1b\u5c11\u3057\u3066\u3057\u307e\u3046\u3068\u304d\u306f\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u534a\u5206\u306b\u3057\u3066\u3044\u304d\u3001\n            # \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u3002\n            repeat {\n                h <- h / 2\n                newx <- x + h\n                if (f(x) <= f(newx)) {\n                    break\n                }\n            }\n            x <- newx\n            h <- 2 * h\n        }\n        lines(c(oldx, x), c(i - 1, i) * 0.05 - 0.5, type=\"o\", col=2)\n        cat(\"i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"df(x)=\", df(x), \"h=\", h, \"\\n\")\n        if (abs(h) < eps) {\n            break\n        }\n        i <- i + 1\n    }\n    x\n}\n\ncurve(f, xlim=range(xrange), ylim=range(yrange))\nsearch(-1, f, dx)\n\n\n\u591a\u5909\u6570\u306e\u5834\u5408\n\nframe()\npar(mfcol=c(1, 2))\npar(mar=c(2, 2, 1, 0.1))\npar(mgp=c(1, 0.2, 0))\n\nsearch <- function(x0, delta, f, df) {\n\n    x <- x0\n    h <- 0.7\n    eps <- 1e-6\n    i <- 1\n    # \u89e3\u306e\u79fb\u52d5\u91cf\u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n    repeat {\n        oldx <- x\n        # df(x)\u306e\u7b26\u53f7\u306b\u3088\u3063\u3066\u3001\u9032\u3080\u65b9\u5411\u3092\u6c7a\u3081\u308b\u3002\n        h <- sign(df(x)) * abs(h)\n        newx <- x + h * delta\n        if (f(x) < f(newx)) {\n            # \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u9650\u308a\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u500d\u306b\u3057\u3066\u3044\u304f\u3002\n            repeat {\n                h <- 2 * h\n                x <- newx\n                newx <- x + h * delta\n                if (f(x) >= f(newx)) {\n                    break\n                }\n            }\n            h <- h / 2\n        } else {\n            # \u95a2\u6570\u5024\u304c\u6e1b\u5c11\u3057\u3066\u3057\u307e\u3046\u3068\u304d\u306f\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u534a\u5206\u306b\u3057\u3066\u3044\u304d\u3001\n            # \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u3002\n            repeat {\n                h <- h / 2\n                newx <- x + h * delta\n                if (f(x) <= f(newx)) {\n                    break\n                }\n            }\n            x <- newx\n            h <- 2 * h\n        }\n        cat(\"search i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"df(x)=\", df(x), \"h=\", h, \"\\n\")\n        if (abs(h) < eps) {\n            break\n        }\n        i <- i + 1\n    }\n    x\n}\n\nhillclimb <- function(x, f, dx, dy) {\n\n    eps <- 1e-12\n    i <- 1\n    repeat {\n        # \u63a2\u7d22\u76f4\u7ddax(t)=x0+t*\u2207f0\u3092\u6c42\u3081\u308b\u3002\n        gradientf0 <- c(dx(x), dy(x))\n        cat(\"hillclimb i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"gradientf0=\", gradientf0, \"\\n\")\n        # \u63a2\u7d22\u76f4\u7dda\u4e0a\u306e\u95a2\u6570F(t)=f(x(t))\u306b\u3064\u3044\u3066\u30011\u968e\u5fae\u5206dF/dt=\u2207f^T * \u2207f0\u3092\u6c42\u3081\u308b\u3002\n        df <- function(x) { as.numeric(c(dx(x), dy(x)) %*% gradientf0) }\n        # \u63a2\u7d22\u76f4\u7dda\u306e\u65b9\u5411\u30d9\u30af\u30c8\u30eb\u3092\u6b63\u898f\u5316\u3059\u308b\u3002\n        delta <- scale(gradientf0, center=F)\n        # \u76f4\u7dda\u63a2\u7d22\u3059\u308b\u3002\n        newx <- search(x, delta, f, df)\n        # \u8ecc\u8de1\u3092\u63cf\u753b\u3059\u308b\u3002\n        xy <- cbind(x, newx)\n        lines(xy[1, ], xy[2, ], type=\"o\", col=1)\n        diff = newx - x\n        x <- newx\n        # ||\u0394x||^2 \u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n        if (sum(diff * diff) < eps) {\n            break\n        }\n        i <- i + 1\n    }\n    x\n}\n\ndraw <- function() {\n    xgrid <- seq(-3, 3, 0.1)\n    ygrid <- seq(-3, 3, 0.1)\n    zgrid <- outer(xgrid, ygrid, Vectorize(function(x, y){ f(c(x, y)) }))\n    image(xgrid, ygrid, zgrid, xlim=range(xgrid), ylim=range(ygrid), xlab=\"x[1]\", ylab=\"x[2]\", main=\"f(x)\", col=rainbow(450)[256:1])\n    contour(xgrid, ygrid, zgrid, xlim=range(xgrid), ylim=range(ygrid), add=T)\n    hillclimb(c(1, 0.5), f, dx, dy)\n}\n\nf <- function(x){ -x[1] ^ 2 - 4 * x[2] ^ 2 + 5 * x[1] }\ndx <- function(x){ -2 * x[1] + 5 }\ndy <- function(x){ - 8 * x[2] }\ndraw()\n\nf <- function(x){ cos(x[1]) + cos(x[2]) }\ndx <- function(x){ -sin(x[1]) }\ndy <- function(x){ -sin(x[2]) }\ndraw()\n\n# f <- function(x){ -(x[1] ^ 3 + x[2] ^ 3 - 9 * x[1] * x[2] + 27) }\n# dx <- function(x){ -(3 * x[1] ^ 2 - 9 * x[2]) }\n# dy <- function(x){ -(3 * x[2] ^ 2 - 9 * x[1]) }\n# draw()\n\n[\u3053\u308c\u306a\u3089\u5206\u304b\u308b\u6700\u9069\u5316\u6570\u5b66](http://www.amazon.co.jp/dp/4320017862) 3.1 \u306b\u8a18\u8f09\u306e\u901a\u308a\u3001\u52fe\u914d\u6cd5\uff08\u52fe\u914d\u964d\u4e0b\u6cd5\u30fb\u6700\u6025\u964d\u4e0b\u6cd5\uff09\u3092\u7528\u3044\u3066\u3001\u95a2\u6570\u306b\u6700\u5927\u5024\u30fb\u6700\u5c0f\u5024\u3092\u53d6\u3089\u305b\u308b\u5909\u6570\u306e\u5024\u3092\u6c42\u3081\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u6700\u5927\u5024\u3092\u53d6\u308b\u70b9\u3092\u6c42\u3081\u3066\u3044\u307e\u3059\u3002\n\n## 1\u5909\u6570\u306e\u5834\u5408\n\n![OPT1.GradientDescent1D.png](https://qiita-image-store.s3.amazonaws.com/0/12670/6e8c11a7-69bc-fbdd-3b48-ee026a2ae8aa.png)\n\n```r\nframe()\npar(mfcol=c(1, 1))\npar(mar=c(2, 2, 1, 0.1))\npar(mgp=c(1, 0.2, 0))\nxrange <- c(-3, 3)\nyrange <- c(-1, 1)\nf <- function(x) { cos(x) }\ndx <- function(x) { -sin(x) }\nsearch <- function(x0, f, df) {\n\t\n\tx <- x0\n\th <- 0.7\n\teps <- 1e-6\n\ti <- 1\n\t# \u89e3\u306e\u79fb\u52d5\u91cf\u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n\trepeat {\n\t\toldx <- x\n\t\t# df(x)\u306e\u7b26\u53f7\u306b\u3088\u3063\u3066\u3001\u9032\u3080\u65b9\u5411\u3092\u6c7a\u3081\u308b\u3002\n\t\th <- sign(df(x)) * abs(h)\n\t\tnewx <- x + h\n\t\tif (f(x) < f(newx)) {\n\t\t\t# \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u9650\u308a\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u500d\u306b\u3057\u3066\u3044\u304f\u3002\n\t\t\trepeat {\n\t\t\t\th <- 2 * h\n\t\t\t\tx <- newx\n\t\t\t\tnewx <- x + h\n\t\t\t\tif (f(x) >= f(newx)) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\th <- h / 2\n\t\t} else {\n\t\t\t# \u95a2\u6570\u5024\u304c\u6e1b\u5c11\u3057\u3066\u3057\u307e\u3046\u3068\u304d\u306f\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u534a\u5206\u306b\u3057\u3066\u3044\u304d\u3001\n\t\t\t# \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u3002\n\t\t\trepeat {\n\t\t\t\th <- h / 2\n\t\t\t\tnewx <- x + h\n\t\t\t\tif (f(x) <= f(newx)) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tx <- newx\n\t\t\th <- 2 * h\n\t\t}\n\t\tlines(c(oldx, x), c(i - 1, i) * 0.05 - 0.5, type=\"o\", col=2)\n\t\tcat(\"i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"df(x)=\", df(x), \"h=\", h, \"\\n\")\n\t\tif (abs(h) < eps) {\n\t\t\tbreak\n\t\t}\n\t\ti <- i + 1\n\t}\n\tx\n}\n\ncurve(f, xlim=range(xrange), ylim=range(yrange))\nsearch(-1, f, dx)\n```\n\n## \u591a\u5909\u6570\u306e\u5834\u5408\n\n![OPT2.GradientDescent2D.png](https://qiita-image-store.s3.amazonaws.com/0/12670/ae2c0e50-3486-fed6-cdcf-e1241edce92f.png)\n\n```r\nframe()\npar(mfcol=c(1, 2))\npar(mar=c(2, 2, 1, 0.1))\npar(mgp=c(1, 0.2, 0))\n\nsearch <- function(x0, delta, f, df) {\n\t\n\tx <- x0\n\th <- 0.7\n\teps <- 1e-6\n\ti <- 1\n\t# \u89e3\u306e\u79fb\u52d5\u91cf\u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n\trepeat {\n\t\toldx <- x\n\t\t# df(x)\u306e\u7b26\u53f7\u306b\u3088\u3063\u3066\u3001\u9032\u3080\u65b9\u5411\u3092\u6c7a\u3081\u308b\u3002\n\t\th <- sign(df(x)) * abs(h)\n\t\tnewx <- x + h * delta\n\t\tif (f(x) < f(newx)) {\n\t\t\t# \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u9650\u308a\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u500d\u306b\u3057\u3066\u3044\u304f\u3002\n\t\t\trepeat {\n\t\t\t\th <- 2 * h\n\t\t\t\tx <- newx\n\t\t\t\tnewx <- x + h * delta\n\t\t\t\tif (f(x) >= f(newx)) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\th <- h / 2\n\t\t} else {\n\t\t\t# \u95a2\u6570\u5024\u304c\u6e1b\u5c11\u3057\u3066\u3057\u307e\u3046\u3068\u304d\u306f\u3001\u30b9\u30c6\u30c3\u30d7\u5e45\u3092\u534a\u5206\u306b\u3057\u3066\u3044\u304d\u3001\n\t\t\t# \u95a2\u6570\u5024\u304c\u5897\u5927\u3059\u308b\u4f4d\u7f6e\u3092\u898b\u3064\u3051\u308b\u3002\n\t\t\trepeat {\n\t\t\t\th <- h / 2\n\t\t\t\tnewx <- x + h * delta\n\t\t\t\tif (f(x) <= f(newx)) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tx <- newx\n\t\t\th <- 2 * h\n\t\t}\n\t\tcat(\"search i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"df(x)=\", df(x), \"h=\", h, \"\\n\")\n\t\tif (abs(h) < eps) {\n\t\t\tbreak\n\t\t}\n\t\ti <- i + 1\n\t}\n\tx\n}\n\nhillclimb <- function(x, f, dx, dy) {\n\t\n\teps <- 1e-12\n\ti <- 1\n\trepeat {\n\t\t# \u63a2\u7d22\u76f4\u7ddax(t)=x0+t*\u2207f0\u3092\u6c42\u3081\u308b\u3002\n\t\tgradientf0 <- c(dx(x), dy(x))\n\t\tcat(\"hillclimb i=\", i, \"x=\" , x, \"f(x)=\", f(x), \"gradientf0=\", gradientf0, \"\\n\")\n\t\t# \u63a2\u7d22\u76f4\u7dda\u4e0a\u306e\u95a2\u6570F(t)=f(x(t))\u306b\u3064\u3044\u3066\u30011\u968e\u5fae\u5206dF/dt=\u2207f^T * \u2207f0\u3092\u6c42\u3081\u308b\u3002\n\t\tdf <- function(x) { as.numeric(c(dx(x), dy(x)) %*% gradientf0) }\n\t\t# \u63a2\u7d22\u76f4\u7dda\u306e\u65b9\u5411\u30d9\u30af\u30c8\u30eb\u3092\u6b63\u898f\u5316\u3059\u308b\u3002\n\t\tdelta <- scale(gradientf0, center=F)\n\t\t# \u76f4\u7dda\u63a2\u7d22\u3059\u308b\u3002\n\t\tnewx <- search(x, delta, f, df)\n\t\t# \u8ecc\u8de1\u3092\u63cf\u753b\u3059\u308b\u3002\n\t\txy <- cbind(x, newx)\n\t\tlines(xy[1, ], xy[2, ], type=\"o\", col=1)\n\t\tdiff = newx - x\n\t\tx <- newx\n\t\t# ||\u0394x||^2 \u304c\u5341\u5206\u5c0f\u3055\u304f\u306a\u308b\u307e\u3067\u7e70\u308a\u8fd4\u3059\u3002\n\t\tif (sum(diff * diff) < eps) {\n\t\t\tbreak\n\t\t}\n\t\ti <- i + 1\n\t}\n\tx\n}\n\ndraw <- function() {\n\txgrid <- seq(-3, 3, 0.1)\n\tygrid <- seq(-3, 3, 0.1)\n\tzgrid <- outer(xgrid, ygrid, Vectorize(function(x, y){ f(c(x, y)) }))\n\timage(xgrid, ygrid, zgrid, xlim=range(xgrid), ylim=range(ygrid), xlab=\"x[1]\", ylab=\"x[2]\", main=\"f(x)\", col=rainbow(450)[256:1])\n\tcontour(xgrid, ygrid, zgrid, xlim=range(xgrid), ylim=range(ygrid), add=T)\n\thillclimb(c(1, 0.5), f, dx, dy)\n}\n\nf <- function(x){ -x[1] ^ 2 - 4 * x[2] ^ 2 + 5 * x[1] }\ndx <- function(x){ -2 * x[1] + 5 }\ndy <- function(x){ - 8 * x[2] }\ndraw()\n\nf <- function(x){ cos(x[1]) + cos(x[2]) }\ndx <- function(x){ -sin(x[1]) }\ndy <- function(x){ -sin(x[2]) }\ndraw()\n\n# f <- function(x){ -(x[1] ^ 3 + x[2] ^ 3 - 9 * x[1] * x[2] + 27) }\n# dx <- function(x){ -(3 * x[1] ^ 2 - 9 * x[2]) }\n# dy <- function(x){ -(3 * x[2] ^ 2 - 9 * x[1]) }\n# draw()\n```\n", "tags": ["R", "\u6570\u5024\u8a08\u7b97"]}