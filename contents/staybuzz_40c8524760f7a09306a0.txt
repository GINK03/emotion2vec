{"context": "\u65e5\u672cOpenStack\u30e6\u30fc\u30b6\u4f1a \u7b2c25\u56de\u52c9\u5f37\u4f1a \u3067\u30c6\u30fc\u30de\u3068\u306a\u3063\u3066\u3044\u305f\"OpenStack\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\"\u3002\n\u4eca\u56de\u306f\u305d\u308c\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u306e1\u3064\u3067\u3042\u308bMasakari\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nMasakari\u3092\u8a66\u3059\u306b\u3042\u305f\u308a\u3001\u958b\u767a\u5143\u3067\u3042\u308bNTT-SIC\u3055\u3093\u304cVirtualBox\u4e0a\u3067\u3059\u3050\u306b\u74b0\u5883\u69cb\u7bc9\u304c\u3067\u304d\u308bmasakari-deploy\u3092\u516c\u958b\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\nMasakari\u3068\u306f\n\"OpenStack\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\"\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u306e1\u3064\u3067\u3001NTT\u306e\u7814\u7a76\u6240\u3067\u958b\u767a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306e4\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u5f62\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nMasakari Controller\n\n\n\u969c\u5bb3\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308a\u3001OpenStack API\u3092\u53e9\u304f\u3002\n\n\nMasakari Instance Monitor\n\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u7a3c\u50cd\u4e2d\u306eVM\u306e\u751f\u5b58\u76e3\u8996\u3092\u884c\u3046\u3002Libvirt\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u76e3\u8996\u3057\u3066\u304a\u308a\u3001\u305f\u3068\u3048\u3070qemu\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u7570\u5e38\u7d42\u4e86\u3059\u308b\u3068Controller\u306b\u901a\u77e5\u3059\u308b\u3002\n\n\nMasakari Process Monitor\n\n\n\u3042\u3089\u304b\u3058\u3081\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u306e\u751f\u5b58\u76e3\u8996\u3092\u884c\u3046\u3002\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u3066\u3044\u308b\u306e\u3092\u691c\u77e5\u3059\u308b\u3068\u8d77\u52d5\u3092\u8a66\u307f\u308b\u3002\u8d77\u52d5\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306fContoroller\u3078\u901a\u77e5\u3001\u5f53\u8a72\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u5bfe\u8c61\u304b\u3089\u5916\u3055\u308c\u308b(nova-compute\u30b5\u30fc\u30d3\u30b9\u304cdisable\u306b\u306a\u308b)\u3002 \n\n\nMasakari Host Monitor\n\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u81ea\u4f53\u306e\u751f\u5b58\u76e3\u8996\u3092Pacemaker/Corosync\u3092\u5229\u7528\u3057\u3066\u884c\u3046\u3002\u30af\u30e9\u30b9\u30bf\u5185\u3067Offline\u3068\u306a\u3063\u305f\u30ce\u30fc\u30c9\u3092\u691c\u77e5\u3059\u308b\u3068Controller\u3078\u901a\u77e5\u304c\u884c\u304d\u3001nova-evacuate API\u304c\u767a\u884c\u3055\u308c\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u308b\u3002\n\n\n\n\u3053\u308c\u3089\u306e\u95a2\u4fc2\u6027\u306fMasakari\u306eReadme\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u56f3\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u524d\u63d0\nmasakari-deploy\u306fVagrant + VirtualBox\u3067\u74b0\u5883\u69cb\u7bc9\u3059\u308b\u3088\u3046\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u79c1\u306e\u691c\u8a3c\u74b0\u5883\u306e\u90fd\u5408\u4e0a\u3001Ubuntu14.04 + Vagrant1.8.1 + KVM\u3067\u74b0\u5883\u69cb\u7bc9\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u4f55\u70b9\u304bVagrantfile\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u3044\u307e\u3059\u3002VirtualBox\u3092\u4f7f\u7528\u3059\u308b\u65b9\u306f\u7279\u306b\u5909\u66f4\u306f\u5fc5\u8981\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001Vagrant\u304b\u3089KVM\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306b\u95a2\u3057\u3066\u306f\u3001\nKVM\u7528\u4eee\u60f3\u30de\u30b7\u30f3\u3092Vagrant\u3067\u624b\u8efd\u306b\u4f5c\u308b\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nlibvirt\u7528 ubuntu/trusty64 \u30a4\u30e1\u30fc\u30b8\u304c\u65e2\u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n\n\u81ea\u52d5\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3055\u308c\u308b\u69cb\u6210\n\nOpenStack \u7ba1\u7406\u30ce\u30fc\u30c9\uff06Masakari Controller\n\n\ncontroller\nIP: 192.168.50.10 \u2192 192.168.122.10 (KVM\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d6\u30ea\u30c3\u30b8\u7528IP\u30a2\u30c9\u30ec\u30b9\u3078\u5909\u66f4\u3057\u305f)\nCPU: 2Core\nRAM: 8192MB\n\n\nOpenStack\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c91\u53f7\u6a5f\uff06Masakari Monitor\u985e\n\n\ncompute1\nIP: 192.168.50.11 \u2192 192.168.122.11\n\nCPU: 1Core\nRAM: 1024MB\n\n\nOpenStack\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c92\u53f7\u6a5f\uff06Masakari Monitor\u985e\n\n\ncompute2\nIP: 192.168.50.12 \u2192 192.168.122.12\n\nCPU: 1Core\nRAM: 1024MB\n\n\n\nCPU\u30b3\u30a2\u6570\u3084\u30e1\u30e2\u30ea\u5bb9\u91cf\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\uff08\u7ba1\u7406\u30ce\u30fc\u30c9\u306fRAM4GB\u306b\u843d\u3068\u3059\u306a\u3069\uff09\u3002\n\n\u69cb\u7bc9\u3057\u3066\u307f\u308b\nmasakari-deploy\u306eReadme\u901a\u308a\u306b\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\uff08Vagrant+libvirt\u7528\u306b\u591a\u5c11\u5909\u66f4\u3092\u52a0\u3048\u3064\u3064\uff09\u3002\n\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n1. \u691c\u8a3c\u7528VM\u306e\u4f5c\u6210\n2. OpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(DevStack\u4f7f\u7528)\n3. Masakari\u306e\u521d\u671f\u8a2d\u5b9a\n\u3068\u306a\u308a\u307e\u3059\u3002\n\u306a\u304a2016/04/22\u73fe\u5728\u3001OpenStack Mitaka\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u306e\u3067\u3001DevStack\u3082Mitaka\u304c\u5165\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\uff01\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u4f5c\u6210\u3055\u308c\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30fc\u30bf\u306f\u3059\u3079\u3066NFS\u3067\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u9818\u57df\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059(/mnt/instances/)\n\n1. Masakari-deploy\u3092Clone\n$ git clone https://github.com/ntt-sic/masakari-deploy.git\n$ cd masakari-deploy/\n~/masakari-deploy$ ls\ncookbooks  LICENSE  README.md  roles  Vagrantfile\n\n\n2. KVM\u3067\u4f7f\u7528\u3059\u308b\u305f\u3081\u306bVagrantfile\u306e\u7de8\u96c6\n\u4e3b\u306b\u4f7f\u7528\u3059\u308bProvider\u90e8\u5206\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\u4f8b\u3048\u3070\u7ba1\u7406\u30ce\u30fc\u30c9\u3067\u3042\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u305f(Provider\u306bVirtualBox\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u5909\u66f4\u4e0d\u8981)\u3002\n\u30aa\u30ea\u30b8\u30ca\u30eb\n...(\u7565)...\nconfig.vm.define \"controller\" do |controller|\n    controller.vm.hostname = \"controller\"\n    controller.vm.network \"private_network\", ip: \"192.168.50.10\"\n    controller.vm.provider \"virtualbox\" do |vb|\n      vb.customize [\"modifyvm\", :id, \"--memory\", \"8192\", \"--cpus\", \"4\", \"--ioapic\", \"on\"]\n    end\n    controller.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n\nKVM\u7528\u306b\u6539\u826f\n...(\u7565)...\n  config.vm.define \"controller\" do |controller|\n    controller.vm.hostname = \"controller\"\n    controller.vm.network \"private_network\", ip: \"192.168.122.10\" \u2605\n    controller.vm.provider \"libvirt\" do |libvirt| \u2605\n      libvirt.memory = 4096 \u2605\n      libvirt.cpus = 2 \u2605\n    end\n    controller.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306b\u95a2\u3057\u3066\u306f\u3001nested virtualization\u3092\u6709\u52b9\u306b\u3059\u308b\u4e00\u6587\u3082\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n...(\u7565)...\n  config.vm.define \"compute1\" do |compute1|\n    compute1.vm.hostname = \"compute1\"\n    compute1.vm.network \"private_network\", ip: \"192.168.122.11\"\n    compute1.vm.provider \"libvirt\" do |libvirt|\n      libvirt.memory = 1024\n      libvirt.cpus = 1\n      libvirt.nested = true \u2605\n    end\n    compute1.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n\n\n3. \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u306e\u958b\u59cb\n~/masakari-deploy$ vagrant up\n\nVM\u4f5c\u6210\u5f8c\u3001\u81ea\u52d5\u7684\u306bChef\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\n\nDevStack\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068local.conf\u306e\u8a2d\u5b9a\nPacemaker/Corosync\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30af\u30e9\u30b9\u30bf\u5f62\u6210(\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306e\u307f)\nMasakari\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nNFS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a(\u7ba1\u7406\u30ce\u30fc\u30c9\u304c\u30b5\u30fc\u30d0\u3068\u306a\u308a\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u30de\u30a6\u30f3\u30c8\u3057\u306b\u3044\u304f)\n\n\u304c\u884c\u308f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u79c1\u304c\u8a66\u3057\u305f\u3068\u304d(2016/04/13)\u306f\u3001\u7ba1\u7406\u30ce\u30fc\u30c9\u3067Python\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b pytz \u304c\u7121\u3044\u3068\u3044\u3046\u7406\u7531\u3067pip install \u304c\u3053\u3051\u3066\u3044\u307e\u3057\u305f(4/22\u306b\u518d\u6311\u6226\u3057\u305f\u3089\u7279\u306b\u30a8\u30e9\u30fc\u306f\u306a\u304b\u3063\u305f)\u3002\u304a\u3082\u3080\u308d\u306b vagrant provision \u3092\u5b9f\u884c\u3057\u305f\u3089\u306a\u3093\u3068\u304b\u901a\u904e\u3057\u305f\u306e\u3067\u3001\u306a\u306b\u304b\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u60aa\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n4. DevStack\u3092\u4f7f\u3063\u3066OpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nOpenStack\u306e\u69cb\u7bc9\u306fDevStack\u3092\u7528\u3044\u3066\u884c\u308f\u308c\u307e\u3059\u30023VM\u306b\u5bfe\u3057\u3066\u305d\u308c\u305e\u308cstack.sh\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u30fbdevstack\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\n~/masakari-deploy$ vagrant ssh controller\nvagrant@controller:~$ sudo -u stack -i\nstack@controller:~$ cd devstack/\nstack@controller:~/devstack$\n\n\u624b\u98062\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3092\u5909\u66f4\u3057\u3066\u3044\u308b\u305f\u3081\u3001OpenStack\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u60c5\u5831\u304c\u66f8\u3044\u3066\u3042\u308blocal.conf\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u203b\u3053\u306e\u4f5c\u696d\u306f\u7ba1\u7406\u30ce\u30fc\u30c9\u306e\u307f\u3067\u3059\u3002\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\n\nlocal.conf\n...(\u7565)...\n## neutron options\nQ_USE_SECGROUP=True\nFLOATING_RANGE=192.168.122.0/24 \u2605192.168.50.0/24\u304b\u3089\u5909\u66f4\nFIXED_RANGE=10.0.0.0/24\nQ_FLOATING_ALLOCATION_POOL=start=192.168.122.128,end=192.168.122.253 \u2605192.168.50.0/24\u304b\u3089\u5909\u66f4\nPUBLIC_NETWORK_GATEWAY=192.168.122.1 \u2605(KVM\u30db\u30b9\u30c8\u5074\u306evirbr0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9)\n...(\u7565)...\n\n\n\u5909\u66f4\u3057\u305f\u3089\u69cb\u7bc9\u958b\u59cb\u3067\u3059\u3002\nstack@controller:~/devstack$ ./stack.sh\n\n\u74b0\u5883\u306b\u3082\u3088\u308a\u307e\u3059\u304c30\u5206\u304f\u3089\u3044\u304b\u304b\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\u3042\u308c\u3070DevStack\u69cb\u7bc9\u6210\u529f\u3067\u3059\u3002\n\uff08\u4f8b\uff1a\u7ba1\u7406\u30ce\u30fc\u30c9\uff09\nThis is your host IP address: 192.168.122.10\nThis is your host IPv6 address: ::1\nKeystone is serving at http://192.168.122.10:5000/\nThe default users are: admin and demo\nThe password: password\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u3082This is your host IP address: 192.168.122.11\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u7ba1\u7406\u30ce\u30fc\u30c9\u304b\u3089\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-list\n+----+---------------------+-------+---------+\n| ID | Hypervisor hostname | State | Status  |\n+----+---------------------+-------+---------+\n| 1  | compute1            | up    | enabled |\n| 2  | compute2            | up    | enabled |\n+----+---------------------+-------+---------+\n\n\n5. Masakari\u306e\u521d\u671f\u8a2d\u5b9a\n\u30fb\u521d\u671fDB\u306e\u6d41\u3057\u8fbc\u307f(\u7ba1\u7406\u30ce\u30fc\u30c9\u4f5c\u696d)\nstack@controller:~/devstack$ cd ~/masakari/\nstack@controller:~/masakari$ ./masakari_database_setting.sh\n\n\u8ffd\u52a0\u3055\u308c\u305fDB\u30c6\u30fc\u30d6\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u30fbmasakari-controller\u306e\u8d77\u52d5\nstack@controller:~/masakari$ sudo service masakari-controller start\nStarting masakari:  *\nstack@controller:~/masakari$ sudo service masakari-controller status\n * masakari is running\n\n\u30fbMasakari Monitor\u985e\u306e\u8d77\u52d5(\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4f5c\u696d)\n\u5ff5\u306e\u305f\u3081\u3001Corosync\u3067\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\nstack@compute1:~/devstack$ sudo crm_mon -A1\nLast updated: Fri Apr 15 00:54:47 2016\nLast change: Wed Apr 13 14:57:00 2016 via crmd on compute1\nStack: corosync\nCurrent DC: compute1 (1) - partition with quorum\nVersion: 1.1.10-42f2063\n2 Nodes configured\n0 Resources configured\n\n\nOnline: [ compute1 compute2 ]\n\n\nNode Attributes:\n* Node compute1:\n* Node compute2:\n\ncompute1, compute2\u5171\u306bOnline\u3068\u306a\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\ncompute1, compute2\u306e\u4e21\u65b9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nstack@compute1:~/devstack$ sudo service masakari-hostmonitor start\nstack@compute1:~/devstack$ sudo service masakari-instancemonitor start\nstack@compute1:~/devstack$ sudo service masakari-processmonitor start\n\nstack@compute1:~$ for i in {instance,process,host}; do sudo service  masakari-${i}monitor status;done\n * masakari-instancemonitor is running\nmasakari-processmonitor start/running, process 11401\nmasakari-hostmonitor start/running, process 11489\n\nstack@compute2:~/devstack$ sudo service masakari-hostmonitor start\nstack@compute2:~/devstack$ sudo service masakari-instancemonitor start\nstack@compute2:~/devstack$ sudo service masakari-processmonitor start\n\nstack@compute2:~/devstack$ for i in {instance,process,host}; do sudo service  masakari-${i}monitor status;done\n * masakari-instancemonitor is running\nmasakari-processmonitor start/running, process 11391\nmasakari-hostmonitor start/running, process 11425\n\n\n6. Masakari\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\u3092\u8a66\u3057\u3066\u307f\u308b\n\u7ba1\u7406\u30ce\u30fc\u30c9\u3067\u4f5c\u696d\u3002\n\u30fb\u9000\u907f\u5148\u30db\u30b9\u30c8\u3068\u3057\u3066compute2\u3092\u767b\u9332\nstack@controller:~/masakari$ ./reserved_host_add.sh compute2\nreserve_host_manage execution start\n+---------------------+---------+-----------------+----------+\n| create_at           | deleted | cluster_port    | hostname |\n+---------------------+---------+-----------------+----------+\n| 2016-04-15 23:22:43 |       0 | 226.94.1.1:5405 | compute2 |\n+---------------------+---------+-----------------+----------+\nreserve_host_manage execution end\n\n\u30fbcompute2\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7acb\u305f\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\nstack@controller:~/masakari$ cd ~/devstack/\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova service-disable compute2 nova-compute\n+----------+--------------+----------+\n| Host     | Binary       | Status   |\n+----------+--------------+----------+\n| compute2 | nova-compute | disabled |\n+----------+--------------+----------+\n\n\u30fb\u304a\u8a66\u3057\u7528\u306b\u30b9\u30da\u30c3\u30af\u306e\u5c0f\u3055\u306a\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\nstack@controller:~/devstack$ nova flavor-create m1.nano auto 64 1 1\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| 2a38abf7-42e7-4aa1-b539-f61cf3e72056 | m1.nano | 64        | 1    | 0         |      | 1     | 1.0         | True      |\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\nstack@controller:~/devstack$ source openrc demo demo\nstack@controller:~/devstack$ nova boot --image cirros-0.3.4-x86_64-uec --flavor m1.nano vm1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          |                                                                |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | Tjn5g4vCjrcW                                                   |\n| config_drive                         |                                                                |\n| created                              | 2016-04-22T17:02:14Z                                           |\n| description                          | -                                                              |\n| flavor                               | m1.nano (2a38abf7-42e7-4aa1-b539-f61cf3e72056)                 |\n| hostId                               |                                                                |\n| id                                   | 721ebba1-8543-4ba8-9518-4934a0ebdf9e                           |\n| image                                | cirros-0.3.4-x86_64-uec (b82f4797-0ba7-4608-b942-33e9f27e08ee) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | vm1                                                            |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 9bd82adbe5a14592bea7ca1df7b6ee73                               |\n| updated                              | 2016-04-22T17:02:15Z                                           |\n| user_id                              | 6b7ea4a443284d679bb84cbcb6a8c566                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n\nstack@controller:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks                                               |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | vm1  | ACTIVE | -          | Running     | private=fd81:7cfe:cd33:0:f816:3eff:fe93:7dd1, 10.0.0.5 |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304ccompute1\u306b\u7acb\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-servers compute1\n+--------------------------------------+-------------------+---------------+---------------------+\n| ID                                   | Name              | Hypervisor ID | Hypervisor Hostname |\n+--------------------------------------+-------------------+---------------+---------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | instance-00000005 | 1             | compute1            |\n+--------------------------------------+-------------------+---------------+---------------------+\n\nstack@controller:~/devstack$ nova hypervisor-servers compute2\n+----+------+---------------+---------------------+\n| ID | Name | Hypervisor ID | Hypervisor Hostname |\n+----+------+---------------+---------------------+\n+----+------+---------------+---------------------+\n\n\u30fb\u7591\u4f3c\u969c\u5bb3\u3092\u767a\u751f\u3055\u305b\u308b(compute1\u306e\u5f37\u5236\u505c\u6b62)\n\u30db\u30b9\u30c8OS\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\nubuntu@host01:~/masakari-deploy$ vagrant halt compute1 --force\n\n\u3059\u308b\u3068compute2\u5074\u3067\u969c\u5bb3\u3092\u691c\u77e5\u3057\u3001Masakari Controller\u3078\u901a\u77e5\u304c\u98db\u3073\u307e\u3059\u3002\nMasakari Controller\u306f\u969c\u5bb3\u304c\u8d77\u304d\u305fcompute1\u306enova-compute\u30b5\u30fc\u30d3\u30b9\u3092disable\u306b\u3057\u3001OpenStack\u5074\u3067compute1\u306estatus\u304cdown\u3068\u8a8d\u8b58\u3055\u308c\u308b\u307e\u3067Masakari Controller\u306f180\u79d2\u9593(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\u3084\u304c\u3066compute2\u3078\u306eHA\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\nHA\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7a3c\u50cd\u3059\u308b\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u5909\u5316\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-servers compute1\n+----+------+---------------+---------------------+\n| ID | Name | Hypervisor ID | Hypervisor Hostname |\n+----+------+---------------+---------------------+\n+----+------+---------------+---------------------+\n\nstack@controller:~/devstack$ nova hypervisor-servers compute2\n+--------------------------------------+-------------------+---------------+---------------------+\n| ID                                   | Name              | Hypervisor ID | Hypervisor Hostname |\n+--------------------------------------+-------------------+---------------+---------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | instance-00000005 | 2             | compute2            |\n+--------------------------------------+-------------------+---------------+---------------------+\n\n\u30fb\u843d\u3068\u3057\u305f\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3092\u5fa9\u6d3b\u3055\u305b\u308b(compute1\u306e\u518d\u59cb\u52d5)\nReadme\u306b\u3088\u308b\u3068\u3001\u518d\u5ea6Vagrant\u304b\u3089 $ vagrant up compute1 --provision \u3092\u5b9f\u884c\u3057\u3001DevStack\u306e\u518d\u69cb\u7bc9\uff06Masakari\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u3092\u884c\u3046\u3053\u3068\u3067\u5fa9\u65e7\u3067\u304d\u308b\u305d\u3046\u3067\u3059\u3002\n\n\u307e\u3068\u3081\n\u4eca\u56de\u306fmasakari-deploy\u3092\u4f7f\u3063\u3066Masakari\u306e\u691c\u8a3c\u74b0\u5883\u3092\u4f5c\u6210\u3057\u3001Host Monitor\u3092\u5229\u7528\u3057\u3066OpenStack\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4ed6\u306b\u3082Instance Monitor\u3084Process Monitor\u3082\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5225\u306e\u6a5f\u4f1a\u306b\u89e6\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4f59\u8ac7\nnova-evacuate API\u306e\u5f15\u6570\u3068\u3057\u3066 onSharedStorage\u304c\u3042\u308a\u3001Masakari\u3067\u306fTrue\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u30a8\u30d5\u30a7\u30e1\u30e9\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u9818\u57df\u304cNFS\u306e\u3088\u3046\u306a\u5171\u6709\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u3067\u3042\u308c\u3070\u4eca\u56de\u306e\u3088\u3046\u306aHA\u304c\u53ef\u80fd\u3067\u3059\u3002\nCinder\u30dc\u30ea\u30e5\u30fc\u30e0\u304b\u3089\u8d77\u52d5\u3057\u3066\u3044\u308b\u5834\u5408\u306fonSharedStorage\u3092False\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u306fMasakari Controller\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n/opt/masakari/controller/masakari_util.py\n\nmasakari_util.py\n693     def do_instance_evacuate(self, uuid, targethost):\n694         \"\"\"Call evacuate API for server instance.\n695\n696         :uuid : Instance id\n697         :targethost: The name or ID of the host where the server is evacuated.\n698         \"\"\"\n699         try:\n700             self.rc_util.syslogout('Call Evacuate API with %s to %s' %\n701                                    (uuid, targethost), syslog.LOG_INFO)\n702             self.nova_client.servers.evacuate(uuid, host=targethost,\n703                                               on_shared_storage=False) \u2605\u3053\u3053\u3092\u5909\u66f4\n704         except exceptions.ClientException as e:\n705             error_code = \"[RecoveryControllerUtilApi_0007]\"\n706             msg = ('Fails to call Instance Evacuate API onto %s: %s'\n707                    % (targethost, e))\n708             self.rc_util.syslogout(error_code + msg, syslog.LOG_ERR)\n709             raise\n\n\n[\u65e5\u672cOpenStack\u30e6\u30fc\u30b6\u4f1a \u7b2c25\u56de\u52c9\u5f37\u4f1a](http://openstack-jp.connpass.com/event/27532/) \u3067\u30c6\u30fc\u30de\u3068\u306a\u3063\u3066\u3044\u305f\"OpenStack\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\"\u3002\n\u4eca\u56de\u306f\u305d\u308c\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u306e1\u3064\u3067\u3042\u308b[Masakari](https://github.com/ntt-sic/masakari)\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nMasakari\u3092\u8a66\u3059\u306b\u3042\u305f\u308a\u3001\u958b\u767a\u5143\u3067\u3042\u308bNTT-SIC\u3055\u3093\u304cVirtualBox\u4e0a\u3067\u3059\u3050\u306b\u74b0\u5883\u69cb\u7bc9\u304c\u3067\u304d\u308b[masakari-deploy](https://github.com/ntt-sic/masakari-deploy)\u3092\u516c\u958b\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u4eca\u56de\u306f\u3053\u308c\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n## Masakari\u3068\u306f\n\"OpenStack\u4e0a\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\"\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u306e1\u3064\u3067\u3001NTT\u306e\u7814\u7a76\u6240\u3067\u958b\u767a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u4ee5\u4e0b\u306e4\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u5f62\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* Masakari Controller\n  * \u969c\u5bb3\u901a\u77e5\u3092\u53d7\u3051\u53d6\u308a\u3001OpenStack API\u3092\u53e9\u304f\u3002\n* Masakari Instance Monitor\n  * \u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u7a3c\u50cd\u4e2d\u306eVM\u306e\u751f\u5b58\u76e3\u8996\u3092\u884c\u3046\u3002Libvirt\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u76e3\u8996\u3057\u3066\u304a\u308a\u3001\u305f\u3068\u3048\u3070qemu\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u7570\u5e38\u7d42\u4e86\u3059\u308b\u3068Controller\u306b\u901a\u77e5\u3059\u308b\u3002\n* Masakari Process Monitor\n  * \u3042\u3089\u304b\u3058\u3081\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3057\u305f\u30d7\u30ed\u30bb\u30b9\u306e\u751f\u5b58\u76e3\u8996\u3092\u884c\u3046\u3002\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u3066\u3044\u308b\u306e\u3092\u691c\u77e5\u3059\u308b\u3068\u8d77\u52d5\u3092\u8a66\u307f\u308b\u3002\u8d77\u52d5\u306b\u5931\u6557\u3057\u305f\u5834\u5408\u306fContoroller\u3078\u901a\u77e5\u3001\u5f53\u8a72\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u5bfe\u8c61\u304b\u3089\u5916\u3055\u308c\u308b(nova-compute\u30b5\u30fc\u30d3\u30b9\u304cdisable\u306b\u306a\u308b)\u3002 \n* Masakari Host Monitor\n  * \u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u81ea\u4f53\u306e\u751f\u5b58\u76e3\u8996\u3092Pacemaker/Corosync\u3092\u5229\u7528\u3057\u3066\u884c\u3046\u3002\u30af\u30e9\u30b9\u30bf\u5185\u3067Offline\u3068\u306a\u3063\u305f\u30ce\u30fc\u30c9\u3092\u691c\u77e5\u3059\u308b\u3068Controller\u3078\u901a\u77e5\u304c\u884c\u304d\u3001nova-evacuate API\u304c\u767a\u884c\u3055\u308c\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u884c\u308f\u308c\u308b\u3002\n\n\u3053\u308c\u3089\u306e\u95a2\u4fc2\u6027\u306f[Masakari\u306eReadme](https://github.com/ntt-sic/masakari/blob/master/README.md)\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u56f3\u304c\u3042\u308a\u307e\u3059\u3002\n\n![masakari_architecture](https://raw.githubusercontent.com/ntt-sic/masakari/master/contents/architecture.png)\n\n## \u524d\u63d0\nmasakari-deploy\u306fVagrant + VirtualBox\u3067\u74b0\u5883\u69cb\u7bc9\u3059\u308b\u3088\u3046\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u79c1\u306e\u691c\u8a3c\u74b0\u5883\u306e\u90fd\u5408\u4e0a\u3001Ubuntu14.04 + Vagrant1.8.1 + KVM\u3067\u74b0\u5883\u69cb\u7bc9\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u4f55\u70b9\u304bVagrantfile\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u3044\u307e\u3059\u3002VirtualBox\u3092\u4f7f\u7528\u3059\u308b\u65b9\u306f\u7279\u306b\u5909\u66f4\u306f\u5fc5\u8981\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001Vagrant\u304b\u3089KVM\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u306b\u95a2\u3057\u3066\u306f\u3001\n[KVM\u7528\u4eee\u60f3\u30de\u30b7\u30f3\u3092Vagrant\u3067\u624b\u8efd\u306b\u4f5c\u308b](http://knowledge.sakura.ad.jp/tech/2535/)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nlibvirt\u7528 ubuntu/trusty64 \u30a4\u30e1\u30fc\u30b8\u304c\u65e2\u306b\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u524d\u63d0\u3067\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n\n## \u81ea\u52d5\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3055\u308c\u308b\u69cb\u6210\n* OpenStack \u7ba1\u7406\u30ce\u30fc\u30c9\uff06Masakari Controller\n  * `controller`\n  * IP: `192.168.50.10` \u2192 `192.168.122.10` (KVM\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u30d6\u30ea\u30c3\u30b8\u7528IP\u30a2\u30c9\u30ec\u30b9\u3078\u5909\u66f4\u3057\u305f)\n  * CPU: 2Core\n  * RAM: 8192MB\n* OpenStack\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c91\u53f7\u6a5f\uff06Masakari Monitor\u985e\n  * `compute1`\n  * IP: `192.168.50.11` \u2192 `192.168.122.11`\n  * CPU: 1Core\n  * RAM: 1024MB\n* OpenStack\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c92\u53f7\u6a5f\uff06Masakari Monitor\u985e\n  * `compute2`\n  * IP: `192.168.50.12` \u2192 `192.168.122.12`\n  * CPU: 1Core\n  * RAM: 1024MB\n\nCPU\u30b3\u30a2\u6570\u3084\u30e1\u30e2\u30ea\u5bb9\u91cf\u306f\u9069\u5b9c\u5909\u66f4\u3057\u3066\u3082\u3044\u3044\u3068\u601d\u3044\u307e\u3059\uff08\u7ba1\u7406\u30ce\u30fc\u30c9\u306fRAM4GB\u306b\u843d\u3068\u3059\u306a\u3069\uff09\u3002\n\n## \u69cb\u7bc9\u3057\u3066\u307f\u308b\n[masakari-deploy\u306eReadme](https://github.com/ntt-sic/masakari-deploy/blob/master/README.md)\u901a\u308a\u306b\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3059\uff08Vagrant+libvirt\u7528\u306b\u591a\u5c11\u5909\u66f4\u3092\u52a0\u3048\u3064\u3064\uff09\u3002\n\u6d41\u308c\u3068\u3057\u3066\u306f\u3001\n1. \u691c\u8a3c\u7528VM\u306e\u4f5c\u6210\n2. OpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb(DevStack\u4f7f\u7528)\n3. Masakari\u306e\u521d\u671f\u8a2d\u5b9a\n\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u306a\u304a2016/04/22\u73fe\u5728\u3001OpenStack Mitaka\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u306e\u3067\u3001DevStack\u3082Mitaka\u304c\u5165\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\uff01\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4e0a\u3067\u4f5c\u6210\u3055\u308c\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30c7\u30fc\u30bf\u306f\u3059\u3079\u3066NFS\u3067\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u9818\u57df\u306b\u4fdd\u5b58\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059(/mnt/instances/)\n\n### 1. Masakari-deploy\u3092Clone\n\n```\n$ git clone https://github.com/ntt-sic/masakari-deploy.git\n$ cd masakari-deploy/\n~/masakari-deploy$ ls\ncookbooks  LICENSE  README.md  roles  Vagrantfile\n```\n\n### 2. KVM\u3067\u4f7f\u7528\u3059\u308b\u305f\u3081\u306bVagrantfile\u306e\u7de8\u96c6\n\u4e3b\u306b\u4f7f\u7528\u3059\u308bProvider\u90e8\u5206\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\u4f8b\u3048\u3070\u7ba1\u7406\u30ce\u30fc\u30c9\u3067\u3042\u308c\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3057\u305f(Provider\u306bVirtualBox\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u5909\u66f4\u4e0d\u8981)\u3002\n\n\u30aa\u30ea\u30b8\u30ca\u30eb\n\n```\n...(\u7565)...\nconfig.vm.define \"controller\" do |controller|\n    controller.vm.hostname = \"controller\"\n    controller.vm.network \"private_network\", ip: \"192.168.50.10\"\n    controller.vm.provider \"virtualbox\" do |vb|\n      vb.customize [\"modifyvm\", :id, \"--memory\", \"8192\", \"--cpus\", \"4\", \"--ioapic\", \"on\"]\n    end\n    controller.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n```\n\nKVM\u7528\u306b\u6539\u826f\n\n```\n...(\u7565)...\n  config.vm.define \"controller\" do |controller|\n    controller.vm.hostname = \"controller\"\n    controller.vm.network \"private_network\", ip: \"192.168.122.10\" \u2605\n    controller.vm.provider \"libvirt\" do |libvirt| \u2605\n      libvirt.memory = 4096 \u2605\n      libvirt.cpus = 2 \u2605\n    end\n    controller.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n```\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306b\u95a2\u3057\u3066\u306f\u3001nested virtualization\u3092\u6709\u52b9\u306b\u3059\u308b\u4e00\u6587\u3082\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n...(\u7565)...\n  config.vm.define \"compute1\" do |compute1|\n    compute1.vm.hostname = \"compute1\"\n    compute1.vm.network \"private_network\", ip: \"192.168.122.11\"\n    compute1.vm.provider \"libvirt\" do |libvirt|\n      libvirt.memory = 1024\n      libvirt.cpus = 1\n      libvirt.nested = true \u2605\n    end\n    compute1.vm.provision \"chef_solo\" do |chef|\n...(\u7565)...\n```\n\n### 3. \u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u306e\u958b\u59cb\n\n```\n~/masakari-deploy$ vagrant up\n```\n\nVM\u4f5c\u6210\u5f8c\u3001\u81ea\u52d5\u7684\u306bChef\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\n\n* DevStack\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068local.conf\u306e\u8a2d\u5b9a\n* Pacemaker/Corosync\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u30af\u30e9\u30b9\u30bf\u5f62\u6210(\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u306e\u307f)\n* Masakari\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* NFS\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a(\u7ba1\u7406\u30ce\u30fc\u30c9\u304c\u30b5\u30fc\u30d0\u3068\u306a\u308a\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u30de\u30a6\u30f3\u30c8\u3057\u306b\u3044\u304f)\n\n\u304c\u884c\u308f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u79c1\u304c\u8a66\u3057\u305f\u3068\u304d(2016/04/13)\u306f\u3001\u7ba1\u7406\u30ce\u30fc\u30c9\u3067Python\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b `pytz` \u304c\u7121\u3044\u3068\u3044\u3046\u7406\u7531\u3067pip install \u304c\u3053\u3051\u3066\u3044\u307e\u3057\u305f(4/22\u306b\u518d\u6311\u6226\u3057\u305f\u3089\u7279\u306b\u30a8\u30e9\u30fc\u306f\u306a\u304b\u3063\u305f)\u3002\u304a\u3082\u3080\u308d\u306b `vagrant provision` \u3092\u5b9f\u884c\u3057\u305f\u3089\u306a\u3093\u3068\u304b\u901a\u904e\u3057\u305f\u306e\u3067\u3001\u306a\u306b\u304b\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u60aa\u304b\u3063\u305f\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n### 4. DevStack\u3092\u4f7f\u3063\u3066OpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nOpenStack\u306e\u69cb\u7bc9\u306fDevStack\u3092\u7528\u3044\u3066\u884c\u308f\u308c\u307e\u3059\u30023VM\u306b\u5bfe\u3057\u3066\u305d\u308c\u305e\u308c`stack.sh`\u3092\u5b9f\u884c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30fbdevstack\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\n\n```\n~/masakari-deploy$ vagrant ssh controller\nvagrant@controller:~$ sudo -u stack -i\nstack@controller:~$ cd devstack/\nstack@controller:~/devstack$\n```\n\n\u624b\u98062\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u3092\u5909\u66f4\u3057\u3066\u3044\u308b\u305f\u3081\u3001OpenStack\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u60c5\u5831\u304c\u66f8\u3044\u3066\u3042\u308b`local.conf`\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u203b\u3053\u306e\u4f5c\u696d\u306f\u7ba1\u7406\u30ce\u30fc\u30c9\u306e\u307f\u3067\u3059\u3002\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\n\n```local.conf\n...(\u7565)...\n## neutron options\nQ_USE_SECGROUP=True\nFLOATING_RANGE=192.168.122.0/24 \u2605192.168.50.0/24\u304b\u3089\u5909\u66f4\nFIXED_RANGE=10.0.0.0/24\nQ_FLOATING_ALLOCATION_POOL=start=192.168.122.128,end=192.168.122.253 \u2605192.168.50.0/24\u304b\u3089\u5909\u66f4\nPUBLIC_NETWORK_GATEWAY=192.168.122.1 \u2605(KVM\u30db\u30b9\u30c8\u5074\u306evirbr0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9)\n...(\u7565)...\n```\n\n\u5909\u66f4\u3057\u305f\u3089\u69cb\u7bc9\u958b\u59cb\u3067\u3059\u3002\n\n```\nstack@controller:~/devstack$ ./stack.sh\n```\n\n\u74b0\u5883\u306b\u3082\u3088\u308a\u307e\u3059\u304c30\u5206\u304f\u3089\u3044\u304b\u304b\u308a\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u51fa\u529b\u304c\u3042\u308c\u3070DevStack\u69cb\u7bc9\u6210\u529f\u3067\u3059\u3002\n\uff08\u4f8b\uff1a\u7ba1\u7406\u30ce\u30fc\u30c9\uff09\n\n```\nThis is your host IP address: 192.168.122.10\nThis is your host IPv6 address: ::1\nKeystone is serving at http://192.168.122.10:5000/\nThe default users are: admin and demo\nThe password: password\n```\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u3082`This is your host IP address: 192.168.122.11`\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u7ba1\u7406\u30ce\u30fc\u30c9\u304b\u3089\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-list\n+----+---------------------+-------+---------+\n| ID | Hypervisor hostname | State | Status  |\n+----+---------------------+-------+---------+\n| 1  | compute1            | up    | enabled |\n| 2  | compute2            | up    | enabled |\n+----+---------------------+-------+---------+\n```\n\n### 5. Masakari\u306e\u521d\u671f\u8a2d\u5b9a\n\u30fb\u521d\u671fDB\u306e\u6d41\u3057\u8fbc\u307f(\u7ba1\u7406\u30ce\u30fc\u30c9\u4f5c\u696d)\n\n```\nstack@controller:~/devstack$ cd ~/masakari/\nstack@controller:~/masakari$ ./masakari_database_setting.sh\n```\n\u8ffd\u52a0\u3055\u308c\u305fDB\u30c6\u30fc\u30d6\u30eb\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n\u30fbmasakari-controller\u306e\u8d77\u52d5\n\n```\nstack@controller:~/masakari$ sudo service masakari-controller start\nStarting masakari:  *\nstack@controller:~/masakari$ sudo service masakari-controller status\n * masakari is running\n```\n\n\u30fbMasakari Monitor\u985e\u306e\u8d77\u52d5(\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u4f5c\u696d)\n\u5ff5\u306e\u305f\u3081\u3001Corosync\u3067\u30af\u30e9\u30b9\u30bf\u304c\u7d44\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\nstack@compute1:~/devstack$ sudo crm_mon -A1\nLast updated: Fri Apr 15 00:54:47 2016\nLast change: Wed Apr 13 14:57:00 2016 via crmd on compute1\nStack: corosync\nCurrent DC: compute1 (1) - partition with quorum\nVersion: 1.1.10-42f2063\n2 Nodes configured\n0 Resources configured\n\n\nOnline: [ compute1 compute2 ]\n\n\nNode Attributes:\n* Node compute1:\n* Node compute2:\n```\n\ncompute1, compute2\u5171\u306bOnline\u3068\u306a\u3063\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\ncompute1, compute2\u306e\u4e21\u65b9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\nstack@compute1:~/devstack$ sudo service masakari-hostmonitor start\nstack@compute1:~/devstack$ sudo service masakari-instancemonitor start\nstack@compute1:~/devstack$ sudo service masakari-processmonitor start\n\nstack@compute1:~$ for i in {instance,process,host}; do sudo service  masakari-${i}monitor status;done\n * masakari-instancemonitor is running\nmasakari-processmonitor start/running, process 11401\nmasakari-hostmonitor start/running, process 11489\n```\n\n```\nstack@compute2:~/devstack$ sudo service masakari-hostmonitor start\nstack@compute2:~/devstack$ sudo service masakari-instancemonitor start\nstack@compute2:~/devstack$ sudo service masakari-processmonitor start\n\nstack@compute2:~/devstack$ for i in {instance,process,host}; do sudo service  masakari-${i}monitor status;done\n * masakari-instancemonitor is running\nmasakari-processmonitor start/running, process 11391\nmasakari-hostmonitor start/running, process 11425\n```\n\n### 6. Masakari\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\u3092\u8a66\u3057\u3066\u307f\u308b\n\n\u7ba1\u7406\u30ce\u30fc\u30c9\u3067\u4f5c\u696d\u3002\n\n\u30fb\u9000\u907f\u5148\u30db\u30b9\u30c8\u3068\u3057\u3066compute2\u3092\u767b\u9332\n\n```\nstack@controller:~/masakari$ ./reserved_host_add.sh compute2\nreserve_host_manage execution start\n+---------------------+---------+-----------------+----------+\n| create_at           | deleted | cluster_port    | hostname |\n+---------------------+---------+-----------------+----------+\n| 2016-04-15 23:22:43 |       0 | 226.94.1.1:5405 | compute2 |\n+---------------------+---------+-----------------+----------+\nreserve_host_manage execution end\n```\n\n\u30fbcompute2\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7acb\u305f\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\n\n```\nstack@controller:~/masakari$ cd ~/devstack/\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova service-disable compute2 nova-compute\n+----------+--------------+----------+\n| Host     | Binary       | Status   |\n+----------+--------------+----------+\n| compute2 | nova-compute | disabled |\n+----------+--------------+----------+\n```\n\n\u30fb\u304a\u8a66\u3057\u7528\u306b\u30b9\u30da\u30c3\u30af\u306e\u5c0f\u3055\u306a\u30d5\u30ec\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\n\n```\nstack@controller:~/devstack$ nova flavor-create m1.nano auto 64 1 1\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public |\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n| 2a38abf7-42e7-4aa1-b539-f61cf3e72056 | m1.nano | 64        | 1    | 0         |      | 1     | 1.0         | True      |\n+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+\n\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\n\n```\nstack@controller:~/devstack$ source openrc demo demo\nstack@controller:~/devstack$ nova boot --image cirros-0.3.4-x86_64-uec --flavor m1.nano vm1\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          |                                                                |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | Tjn5g4vCjrcW                                                   |\n| config_drive                         |                                                                |\n| created                              | 2016-04-22T17:02:14Z                                           |\n| description                          | -                                                              |\n| flavor                               | m1.nano (2a38abf7-42e7-4aa1-b539-f61cf3e72056)                 |\n| hostId                               |                                                                |\n| id                                   | 721ebba1-8543-4ba8-9518-4934a0ebdf9e                           |\n| image                                | cirros-0.3.4-x86_64-uec (b82f4797-0ba7-4608-b942-33e9f27e08ee) |\n| key_name                             | -                                                              |\n| locked                               | False                                                          |\n| metadata                             | {}                                                             |\n| name                                 | vm1                                                            |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | default                                                        |\n| status                               | BUILD                                                          |\n| tenant_id                            | 9bd82adbe5a14592bea7ca1df7b6ee73                               |\n| updated                              | 2016-04-22T17:02:15Z                                           |\n| user_id                              | 6b7ea4a443284d679bb84cbcb6a8c566                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n\nstack@controller:~/devstack$ nova list\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| ID                                   | Name | Status | Task State | Power State | Networks                                               |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | vm1  | ACTIVE | -          | Running     | private=fd81:7cfe:cd33:0:f816:3eff:fe93:7dd1, 10.0.0.5 |\n+--------------------------------------+------+--------+------------+-------------+--------------------------------------------------------+\n\n```\n\n\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304ccompute1\u306b\u7acb\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n```\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-servers compute1\n+--------------------------------------+-------------------+---------------+---------------------+\n| ID                                   | Name              | Hypervisor ID | Hypervisor Hostname |\n+--------------------------------------+-------------------+---------------+---------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | instance-00000005 | 1             | compute1            |\n+--------------------------------------+-------------------+---------------+---------------------+\n\nstack@controller:~/devstack$ nova hypervisor-servers compute2\n+----+------+---------------+---------------------+\n| ID | Name | Hypervisor ID | Hypervisor Hostname |\n+----+------+---------------+---------------------+\n+----+------+---------------+---------------------+\n```\n\n\u30fb\u7591\u4f3c\u969c\u5bb3\u3092\u767a\u751f\u3055\u305b\u308b(compute1\u306e\u5f37\u5236\u505c\u6b62)\n\n\u30db\u30b9\u30c8OS\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\n\n```\nubuntu@host01:~/masakari-deploy$ vagrant halt compute1 --force\n```\n\n\u3059\u308b\u3068compute2\u5074\u3067\u969c\u5bb3\u3092\u691c\u77e5\u3057\u3001Masakari Controller\u3078\u901a\u77e5\u304c\u98db\u3073\u307e\u3059\u3002\nMasakari Controller\u306f\u969c\u5bb3\u304c\u8d77\u304d\u305fcompute1\u306enova-compute\u30b5\u30fc\u30d3\u30b9\u3092disable\u306b\u3057\u3001OpenStack\u5074\u3067compute1\u306estatus\u304cdown\u3068\u8a8d\u8b58\u3055\u308c\u308b\u307e\u3067Masakari Controller\u306f180\u79d2\u9593(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\u5f85\u6a5f\u3057\u307e\u3059\u3002\n\u3084\u304c\u3066compute2\u3078\u306eHA\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\nHA\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u7a3c\u50cd\u3059\u308b\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u304c\u5909\u5316\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n```\nstack@controller:~/devstack$ source openrc admin admin\nstack@controller:~/devstack$ nova hypervisor-servers compute1\n+----+------+---------------+---------------------+\n| ID | Name | Hypervisor ID | Hypervisor Hostname |\n+----+------+---------------+---------------------+\n+----+------+---------------+---------------------+\n\nstack@controller:~/devstack$ nova hypervisor-servers compute2\n+--------------------------------------+-------------------+---------------+---------------------+\n| ID                                   | Name              | Hypervisor ID | Hypervisor Hostname |\n+--------------------------------------+-------------------+---------------+---------------------+\n| 721ebba1-8543-4ba8-9518-4934a0ebdf9e | instance-00000005 | 2             | compute2            |\n+--------------------------------------+-------------------+---------------+---------------------+\n```\n\n\u30fb\u843d\u3068\u3057\u305f\u30b3\u30f3\u30d4\u30e5\u30fc\u30c8\u30ce\u30fc\u30c9\u3092\u5fa9\u6d3b\u3055\u305b\u308b(compute1\u306e\u518d\u59cb\u52d5)\nReadme\u306b\u3088\u308b\u3068\u3001\u518d\u5ea6Vagrant\u304b\u3089 `$ vagrant up compute1 --provision` \u3092\u5b9f\u884c\u3057\u3001DevStack\u306e\u518d\u69cb\u7bc9\uff06Masakari\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u3092\u884c\u3046\u3053\u3068\u3067\u5fa9\u65e7\u3067\u304d\u308b\u305d\u3046\u3067\u3059\u3002\n\n\n## \u307e\u3068\u3081\n\n\u4eca\u56de\u306fmasakari-deploy\u3092\u4f7f\u3063\u3066Masakari\u306e\u691c\u8a3c\u74b0\u5883\u3092\u4f5c\u6210\u3057\u3001Host Monitor\u3092\u5229\u7528\u3057\u3066OpenStack\u306e\u4eee\u60f3\u30de\u30b7\u30f3HA\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4ed6\u306b\u3082Instance Monitor\u3084Process Monitor\u3082\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5225\u306e\u6a5f\u4f1a\u306b\u89e6\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u4f59\u8ac7\nnova-evacuate API\u306e\u5f15\u6570\u3068\u3057\u3066 `onSharedStorage`\u304c\u3042\u308a\u3001Masakari\u3067\u306f`True`\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u30a8\u30d5\u30a7\u30e1\u30e9\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u9818\u57df\u304cNFS\u306e\u3088\u3046\u306a\u5171\u6709\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u3067\u3042\u308c\u3070\u4eca\u56de\u306e\u3088\u3046\u306aHA\u304c\u53ef\u80fd\u3067\u3059\u3002\nCinder\u30dc\u30ea\u30e5\u30fc\u30e0\u304b\u3089\u8d77\u52d5\u3057\u3066\u3044\u308b\u5834\u5408\u306f`onSharedStorage`\u3092`False`\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u306b\u306fMasakari Controller\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n /opt/masakari/controller/masakari_util.py\n\n```masakari_util.py\n693     def do_instance_evacuate(self, uuid, targethost):\n694         \"\"\"Call evacuate API for server instance.\n695\n696         :uuid : Instance id\n697         :targethost: The name or ID of the host where the server is evacuated.\n698         \"\"\"\n699         try:\n700             self.rc_util.syslogout('Call Evacuate API with %s to %s' %\n701                                    (uuid, targethost), syslog.LOG_INFO)\n702             self.nova_client.servers.evacuate(uuid, host=targethost,\n703                                               on_shared_storage=False) \u2605\u3053\u3053\u3092\u5909\u66f4\n704         except exceptions.ClientException as e:\n705             error_code = \"[RecoveryControllerUtilApi_0007]\"\n706             msg = ('Fails to call Instance Evacuate API onto %s: %s'\n707                    % (targethost, e))\n708             self.rc_util.syslogout(error_code + msg, syslog.LOG_ERR)\n709             raise\n```\n\n", "tags": ["openstack", "masakari"]}