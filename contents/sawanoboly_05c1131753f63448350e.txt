{"context": " More than 1 year has passed since last update.\u6700\u8fd1opscode/omnibus\u3067Serverspec\u306e\u975e\u516c\u5f0f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\nopscode/omnibus\u306b\u3064\u3044\u3066\u306f\u5927\u4f53\u306e\u8aac\u660e\u306f\u3053\u3061\u3089\u30023\u4ee5\u964d\u306f\u307e\u305f\u3061\u3087\u3063\u3068\u65b9\u91dd\u9055\u3044\u307e\u3059\u3002\n\nOmnibus-ruby\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30c4\u30fc\u30eb\u306e\u5468\u8fba\u4f9d\u5b58\u3092\u307e\u308b\u3054\u3068rpm,deb\u306b\u56fa\u3081\u308b - Qiita\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u6210\u3068\u30ea\u30ea\u30fc\u30b9\u3092\u3001\u624b\u5143\u3067\u3084\u308b\u3068\u3046\u308b\u3055\u3044\u306e\u3067CircleCI\u306b\u3084\u3089\u305b\u3066\u307f\u305f\u8a18\u9332\u3002\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3053\uff1a https://github.com/OpsRockin/omnibus-serverspec\n\ncircle.yml\u3092\u6652\u3059\ncircle.yml\u672c\u4f53\u306b\u7279\u6b8a\u306a\u8981\u7d20\u306f\u306a\u3057\u3002\n\ncircle.yml\n---\n---\ngeneral:\n  artifacts:\n    - \"pkg\"\nmachine:\n  ruby:\n    version: 2.1.5\ndependencies:\n  pre:\n    - wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.6.5_x86_64.deb\n    - sudo dpkg -i vagrant_1.6.5_x86_64.deb\n    - if [ ! -d /home/ubuntu/.vagrant.d/gems/gems/vagrant-digitalocean-0.7.1 ] ; then sudo vagrant plugin install vagrant-digitalocean ; fi\n  cache_directories:\n    - \".kitchen\"\n    - \"~/.vagrant.d/\"\ntest:\n  override:\n    - \"ci/circle_build_parallel.sh\":\n        timeout: 1200\n        parallel: true\n    - \"bundle exec rake sync\":\n        parallel: true\n    - \"ci/circle_release.sh\":\n        parallel: true\n\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u4e26\u884c\u30d3\u30eb\u30c9: circle_build_parallel.sh\n\u30d3\u30eb\u30c9\u306e\u624b\u53e3\u306fTest-Kitchen\u3068Vagrant-DigitalOcean\u3067\u3059\u3002\nomnibus\u306f\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u30fc\u9762\u3067\u826f\u3044\u306e\u3067\u3059\u304c\u3001\u521d\u56de\u306e\u30d3\u30eb\u30c9\u306b\u306f\u3059\u3054\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\nCircleCI\u306f\u30d3\u30eb\u30c9\u309230\u5206\u3067\u7d42\u308f\u3089\u305b\u306a\u3044\u3068\u30b3\u30f3\u30c6\u30ca\u304c\u505c\u6b62\u3059\u308b\u306e\u3067\u3001rpm\u3068deb\u3092\u4e26\u884c\u3057\u3066\u4f5c\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\nTest-Kitchen\u306econverge\u3067\u305d\u308c\u305e\u308c\u6e96\u5099\u3092\u3055\u305b\u305f\u3089\u3001\u305d\u308c\u305e\u308c\u306eDroplet\u5185\u3067omnibus build\u3092\u3059\u308b\u305f\u3081kitchen exec\u3092\u304b\u3051\u307e\u3057\u305f\u3002\n#!/usr/bin/env bash\n\nset -e\ncase $CIRCLE_NODE_INDEX in\n  0) TARGET=\"centos\"\n    ;;\n  1) TARGET=\"ubuntu\"\n    ;;\nesac\n\nRUBYPATH=\"/opt/rubies/ruby-2.1.5/bin\"\n\nbundle exec kitchen destroy ${TARGET}\nbundle exec kitchen converge ${TARGET}\n\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; gem install bundler --no-ri --no-rdoc\"\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; cd /home/vagrant/serverspec; bundle install --jobs=2 --verbose --binstubs --without development\"\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; cd /home/vagrant/serverspec; ./bin/omnibus build serverspec\"\n\nomnibus\u306e2\u56de\u76ee\u4ee5\u964d\u306f\u5909\u66f4\u70b9\u4ee5\u5916\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3064\u304b\u3046\u306e\u3067\u3059\u3050\u7d42\u308f\u308a\u307e\u3059\u3002\u5b9f\u969b\u306e\u6240\u30d3\u30eb\u30c9\u30b5\u30fc\u30d0\u306f\u5fc5\u8981\u306a\u6642\u306b\u30b9\u30bf\u30fc\u30c8\u3001\u7d42\u308f\u3063\u305f\u3089\u30b9\u30c8\u30c3\u30d7\u306b\u3059\u308b\u306e\u304c\u3088\u3044\u3067\u3059\u3002\n\u304c\u3001\u4eca\u56de\u306f\u6bce\u56de\u7834\u68c4\u30b3\u30fc\u30b9\u3067\u3002\n\n.kitchen.yml\n\u7d50\u5c40Droplet\u306f8GB\u3067\u306a\u3044\u3068\u3001\u30d3\u30eb\u30c9\u304c\u5b89\u5b9a\u3057\u306630\u5206\u3092\u5207\u3089\u306a\u304b\u3063\u305f\u3002\n\u3042\u3068\u306f\u666e\u901a\u306e\u8907\u6570\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u7528.kitchen.yml\u3067\u3059\u306d\u3002\ndriver:\n  name: vagrant\n  provider: digital_ocean\n  box: digital_ocean\n  box_url: https://github.com/smdahlen/vagrant-digitalocean/raw/master/box/digital_ocean.box\n  vagrantfile_erb: <%= File.join(File.dirname(__FILE__), \"templates/Vagrantfile.erb\") %>\n  digitalocean:\n    provider:\n      token: <%= ENV['DIGITALOCEAN_TOKEN'] %>\n      ssh_key_name: <%= ENV['DO_SSH_KEY_NAME'] %>\n      size: 8GB\n      region: nyc3\n    override:\n      ssh.private_key_path: <%= ENV['DO_SSH_KEY'] %>\n  synced_folders:\n    - ['./', '/home/vagrant/serverspec']\n\nprovisioner:\n  require_chef_omnibus: 11.16.4\n\nplatforms:\n  - name: ubuntu-14.04\n    run_list: apt::default\n    driver:\n      digitalocean:\n        provider:\n          image: ubuntu-14-04-x64\n  - name: centos-6.5\n    driver:\n      digitalocean:\n        provider:\n          image: centos-6-5-x64\n\nsuites:\n  - name: default\n    run_list: omnibus::default\n    attributes:\n      omnibus:\n        build_user:  vagrant\n        build_dir:   /home/vagrant/serverspec\n        install_dir: /opt/serverspec\n        ruby_version: 2.1.5\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u56de\u53ce: rake\u30bf\u30b9\u30af\nomnibus\u306f\u4f5c\u6210\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092Droplet\u5185\u306b\u653e\u7f6e\u3057\u307e\u3059\u3002\nVagrant+VirtualBox\u3068\u304b\u306a\u3089\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u6307\u5b9a\u3059\u308c\u3070OK\u3067\u3059\u304c\u3001\u76f8\u624b\u5148\u306b\u3088\u3063\u3066\u306f\u56de\u53ce\u3059\u308b\u304b\u305d\u306e\u5834\u3067\u30ea\u30ea\u30fc\u30b9\u3055\u305b\u307e\u3059\u3002\n\u4eca\u56de\u306fTest-Kitchen\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u5229\u7528\u3057\u3066\u3001(pkg\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u4fe1\u3058\u3066)Rsync\u3067CircleCI\u306e\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u56de\u53ce\u3057\u307e\u3057\u305f\u3002\nrequire 'yaml'\nrequire 'json'\nrequire 'open-uri'\n\nplatforms = Dir.glob('.kitchen/*.yml')\n@instances = []\nplatforms.each do |platform|\n  @instances << YAML.load(File.read(platform))\nend\n\n...\n\ndesc \"collect packages from remote server\"\ntask :sync do\n  # puts @instances\n  remote_user = ENV['REMOTE_USER_NAME'] || 'root'\n  @instances.each do |instance|\n    system \"rsync -avz --progress -e 'ssh -oStrictHostKeyChecking=no -C -i #{ENV['DO_SSH_KEY']}' #{remote_user}@#{instance['hostname']}:/home/vagrant/serverspec/pkg/ ./pkg\"\n  end\nend\n\n...\n\nDroplet\u304b\u3089\u56de\u53ce\u3055\u3048\u3067\u304d\u308c\u3070\u3001\u3068\u308a\u3042\u3048\u305aartifacts\u3068\u3057\u3066\u4fdd\u7ba1\u3057\u3066\u3082\u3089\u3048\u308b\u306e\u3067\u3001\u30ea\u30ea\u30fc\u30b9\u304c\u3053\u3051\u3066\u3082\u307e\u3042\u306a\u3093\u3068\u304b\u3002\n\n\nPackagecloud\u306b\u30ea\u30ea\u30fc\u30b9: circle_release.sh\n\u3053\u308c\u3082\u4e26\u884c\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u3001package_cloud\u30b3\u30de\u30f3\u30c9\u3067\u666e\u901a\u306bpush\u3059\u308b\u3060\u3051\u3002\n\ncircle_release.sh\n#!/usr/bin/env bash\n\nset -e\nif [ \"${CIRCLE_BRANCH}\" == \"master\" ]; then\n  case $CIRCLE_NODE_INDEX in\n    0) TARGET=\"centos\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/dummy_with_ci/el/6 pkg/*.rpm\n      ;;\n    1) TARGET=\"ubuntu\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/dummy_with_ci/ubuntu/trusty pkg/*.deb\n      ;;\n  esac\nelif [ \"${CIRCLE_BRANCH}\" == \"release_package\" ]; then\n  case $CIRCLE_NODE_INDEX in\n    0) TARGET=\"centos\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/serverspec/el/6 pkg/*.rpm\n      ;;\n    1) TARGET=\"ubuntu\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/serverspec/ubuntu/trusty pkg/*.deb\n      ;;\n  esac\nfi\n\n\n\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u7f6e\u304b\u308c\u307e\u3059\u3002\nhttps://packagecloud.io/omnibus-serverspec/serverspec\n\n\n\u6b8b\u8ab2\u984c\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u3061\u3083\u3093\u3068\u52d5\u304f\u304b\u306e\u30c6\u30b9\u30c8\u306f\u81ea\u52d5\u3067\u3057\u3066\u306a\u3044\u3002\n\n\n\nkitchen verify\u3067\u7d50\u5408\u30c6\u30b9\u30c8\u306f\u304b\u3051\u306a\u304f\u3082\u306a\u3044\u3002\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u540c\u3058\u3001\u30ea\u30d3\u30b8\u30e7\u30f3\u9055\u3044\u306b\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u3002(push\u3053\u3051\u308b)\n\n\npackagecloud\u304b\u3089\u4e00\u89a7\u3092\u3068\u308bAPI\u304c\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u56f0\u3063\u3066\u3044\u308b\u3002\n\n\nServerspec\u672c\u4f53\u306e\u30ea\u30ea\u30fc\u30b9\u3068\u9023\u52d5\u3057\u3066\u306a\u3044\u3002\n\n\nRubygems Feed => IFTTT => CricleCI\u30ad\u30c3\u30af\u3092\u753b\u7b56\u3002\n\u30d9\u30fc\u30bf\u7248\u3068\u304b\u3067\u305f\u3076\u3093\u3053\u3051\u308b\u3002\nSpecinfra\u3060\u3051\u66f4\u65b0\u3055\u308c\u305f\u3068\u304d\u3069\u3046\u3057\u3088\u3046\u3002\n\n\n\n\u305d\u306e\u3046\u3061\u56f0\u3063\u305f\u3089\u66f4\u65b0\u3057\u3088\u3046\u3002\n\n\n\u6700\u8fd1[opscode/omnibus](https://github.com/opscode/omnibus \"opscode/omnibus\")\u3067Serverspec\u306e\u975e\u516c\u5f0f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u307e\u3059\u3002\n\n[opscode/omnibus](https://github.com/opscode/omnibus \"opscode/omnibus\")\u306b\u3064\u3044\u3066\u306f\u5927\u4f53\u306e\u8aac\u660e\u306f\u3053\u3061\u3089\u30023\u4ee5\u964d\u306f\u307e\u305f\u3061\u3087\u3063\u3068\u65b9\u91dd\u9055\u3044\u307e\u3059\u3002\n\n> [Omnibus-ruby\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30c4\u30fc\u30eb\u306e\u5468\u8fba\u4f9d\u5b58\u3092\u307e\u308b\u3054\u3068rpm,deb\u306b\u56fa\u3081\u308b - Qiita](http://qiita.com/sawanoboly/items/a2c258a235824b91b70f \"Omnibus-ruby\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u30c4\u30fc\u30eb\u306e\u5468\u8fba\u4f9d\u5b58\u3092\u307e\u308b\u3054\u3068rpm,deb\u306b\u56fa\u3081\u308b - Qiita\")\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u4f5c\u6210\u3068\u30ea\u30ea\u30fc\u30b9\u3092\u3001\u624b\u5143\u3067\u3084\u308b\u3068\u3046\u308b\u3055\u3044\u306e\u3067CircleCI\u306b\u3084\u3089\u305b\u3066\u307f\u305f\u8a18\u9332\u3002\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3053\uff1a https://github.com/OpsRockin/omnibus-serverspec\n\n\n## circle.yml\u3092\u6652\u3059\n\n`circle.yml`\u672c\u4f53\u306b\u7279\u6b8a\u306a\u8981\u7d20\u306f\u306a\u3057\u3002\n\n\n```circle.yml\n---\n---\ngeneral:\n  artifacts:\n    - \"pkg\"\nmachine:\n  ruby:\n    version: 2.1.5\ndependencies:\n  pre:\n    - wget https://dl.bintray.com/mitchellh/vagrant/vagrant_1.6.5_x86_64.deb\n    - sudo dpkg -i vagrant_1.6.5_x86_64.deb\n    - if [ ! -d /home/ubuntu/.vagrant.d/gems/gems/vagrant-digitalocean-0.7.1 ] ; then sudo vagrant plugin install vagrant-digitalocean ; fi\n  cache_directories:\n    - \".kitchen\"\n    - \"~/.vagrant.d/\"\ntest:\n  override:\n    - \"ci/circle_build_parallel.sh\":\n        timeout: 1200\n        parallel: true\n    - \"bundle exec rake sync\":\n        parallel: true\n    - \"ci/circle_release.sh\":\n        parallel: true\n```\n\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u4e26\u884c\u30d3\u30eb\u30c9: circle_build_parallel.sh\n\n\u30d3\u30eb\u30c9\u306e\u624b\u53e3\u306fTest-Kitchen\u3068Vagrant-DigitalOcean\u3067\u3059\u3002\nomnibus\u306f\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u30fc\u9762\u3067\u826f\u3044\u306e\u3067\u3059\u304c\u3001\u521d\u56de\u306e\u30d3\u30eb\u30c9\u306b\u306f\u3059\u3054\u304f\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\nCircleCI\u306f\u30d3\u30eb\u30c9\u309230\u5206\u3067\u7d42\u308f\u3089\u305b\u306a\u3044\u3068\u30b3\u30f3\u30c6\u30ca\u304c\u505c\u6b62\u3059\u308b\u306e\u3067\u3001rpm\u3068deb\u3092\u4e26\u884c\u3057\u3066\u4f5c\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\nTest-Kitchen\u306econverge\u3067\u305d\u308c\u305e\u308c\u6e96\u5099\u3092\u3055\u305b\u305f\u3089\u3001\u305d\u308c\u305e\u308c\u306eDroplet\u5185\u3067`omnibus build`\u3092\u3059\u308b\u305f\u3081`kitchen exec`\u3092\u304b\u3051\u307e\u3057\u305f\u3002\n\n```\n#!/usr/bin/env bash\n\nset -e\ncase $CIRCLE_NODE_INDEX in\n  0) TARGET=\"centos\"\n    ;;\n  1) TARGET=\"ubuntu\"\n    ;;\nesac\n\nRUBYPATH=\"/opt/rubies/ruby-2.1.5/bin\"\n\nbundle exec kitchen destroy ${TARGET}\nbundle exec kitchen converge ${TARGET}\n\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; gem install bundler --no-ri --no-rdoc\"\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; cd /home/vagrant/serverspec; bundle install --jobs=2 --verbose --binstubs --without development\"\nbundle exec kitchen exec ${TARGET} -c \"export PATH=${RUBYPATH}:\\$PATH; cd /home/vagrant/serverspec; ./bin/omnibus build serverspec\"\n```\n\nomnibus\u306e2\u56de\u76ee\u4ee5\u964d\u306f\u5909\u66f4\u70b9\u4ee5\u5916\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3064\u304b\u3046\u306e\u3067\u3059\u3050\u7d42\u308f\u308a\u307e\u3059\u3002\u5b9f\u969b\u306e\u6240\u30d3\u30eb\u30c9\u30b5\u30fc\u30d0\u306f\u5fc5\u8981\u306a\u6642\u306b\u30b9\u30bf\u30fc\u30c8\u3001\u7d42\u308f\u3063\u305f\u3089\u30b9\u30c8\u30c3\u30d7\u306b\u3059\u308b\u306e\u304c\u3088\u3044\u3067\u3059\u3002\n\u304c\u3001\u4eca\u56de\u306f\u6bce\u56de\u7834\u68c4\u30b3\u30fc\u30b9\u3067\u3002\n\n\n### .kitchen.yml\n\n\u7d50\u5c40Droplet\u306f`8GB`\u3067\u306a\u3044\u3068\u3001\u30d3\u30eb\u30c9\u304c\u5b89\u5b9a\u3057\u306630\u5206\u3092\u5207\u3089\u306a\u304b\u3063\u305f\u3002\n\u3042\u3068\u306f\u666e\u901a\u306e\u8907\u6570\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u7528`.kitchen.yml`\u3067\u3059\u306d\u3002\n\n```\ndriver:\n  name: vagrant\n  provider: digital_ocean\n  box: digital_ocean\n  box_url: https://github.com/smdahlen/vagrant-digitalocean/raw/master/box/digital_ocean.box\n  vagrantfile_erb: <%= File.join(File.dirname(__FILE__), \"templates/Vagrantfile.erb\") %>\n  digitalocean:\n    provider:\n      token: <%= ENV['DIGITALOCEAN_TOKEN'] %>\n      ssh_key_name: <%= ENV['DO_SSH_KEY_NAME'] %>\n      size: 8GB\n      region: nyc3\n    override:\n      ssh.private_key_path: <%= ENV['DO_SSH_KEY'] %>\n  synced_folders:\n    - ['./', '/home/vagrant/serverspec']\n\nprovisioner:\n  require_chef_omnibus: 11.16.4\n\nplatforms:\n  - name: ubuntu-14.04\n    run_list: apt::default\n    driver:\n      digitalocean:\n        provider:\n          image: ubuntu-14-04-x64\n  - name: centos-6.5\n    driver:\n      digitalocean:\n        provider:\n          image: centos-6-5-x64\n\nsuites:\n  - name: default\n    run_list: omnibus::default\n    attributes:\n      omnibus:\n        build_user:  vagrant\n        build_dir:   /home/vagrant/serverspec\n        install_dir: /opt/serverspec\n        ruby_version: 2.1.5\n```\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u56de\u53ce: rake\u30bf\u30b9\u30af\n\nomnibus\u306f\u4f5c\u6210\u3057\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092Droplet\u5185\u306b\u653e\u7f6e\u3057\u307e\u3059\u3002\nVagrant+VirtualBox\u3068\u304b\u306a\u3089\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u6307\u5b9a\u3059\u308c\u3070OK\u3067\u3059\u304c\u3001\u76f8\u624b\u5148\u306b\u3088\u3063\u3066\u306f\u56de\u53ce\u3059\u308b\u304b\u305d\u306e\u5834\u3067\u30ea\u30ea\u30fc\u30b9\u3055\u305b\u307e\u3059\u3002\n\n\u4eca\u56de\u306fTest-Kitchen\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u5229\u7528\u3057\u3066\u3001(pkg\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u4fe1\u3058\u3066)Rsync\u3067CircleCI\u306e\u30b3\u30f3\u30c6\u30ca\u5074\u306b\u56de\u53ce\u3057\u307e\u3057\u305f\u3002\n\n```\nrequire 'yaml'\nrequire 'json'\nrequire 'open-uri'\n\nplatforms = Dir.glob('.kitchen/*.yml')\n@instances = []\nplatforms.each do |platform|\n  @instances << YAML.load(File.read(platform))\nend\n\n...\n\ndesc \"collect packages from remote server\"\ntask :sync do\n  # puts @instances\n  remote_user = ENV['REMOTE_USER_NAME'] || 'root'\n  @instances.each do |instance|\n    system \"rsync -avz --progress -e 'ssh -oStrictHostKeyChecking=no -C -i #{ENV['DO_SSH_KEY']}' #{remote_user}@#{instance['hostname']}:/home/vagrant/serverspec/pkg/ ./pkg\"\n  end\nend\n\n...\n```\n\nDroplet\u304b\u3089\u56de\u53ce\u3055\u3048\u3067\u304d\u308c\u3070\u3001\u3068\u308a\u3042\u3048\u305aartifacts\u3068\u3057\u3066\u4fdd\u7ba1\u3057\u3066\u3082\u3089\u3048\u308b\u306e\u3067\u3001\u30ea\u30ea\u30fc\u30b9\u304c\u3053\u3051\u3066\u3082\u307e\u3042\u306a\u3093\u3068\u304b\u3002\n\n![OpsRockin_omnibus-serverspec__22_-_CircleCI.png](https://qiita-image-store.s3.amazonaws.com/0/7454/9d32c10e-04d5-1c72-5138-f96ff26e3045.png \"OpsRockin_omnibus-serverspec__22_-_CircleCI.png\")\n\n\n## Packagecloud\u306b\u30ea\u30ea\u30fc\u30b9: circle_release.sh\n\n\u3053\u308c\u3082\u4e26\u884c\u30b3\u30f3\u30c6\u30ca\u3054\u3068\u3001`package_cloud`\u30b3\u30de\u30f3\u30c9\u3067\u666e\u901a\u306bpush\u3059\u308b\u3060\u3051\u3002\n\n```circle_release.sh\n#!/usr/bin/env bash\n\nset -e\nif [ \"${CIRCLE_BRANCH}\" == \"master\" ]; then\n  case $CIRCLE_NODE_INDEX in\n    0) TARGET=\"centos\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/dummy_with_ci/el/6 pkg/*.rpm\n      ;;\n    1) TARGET=\"ubuntu\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/dummy_with_ci/ubuntu/trusty pkg/*.deb\n      ;;\n  esac\nelif [ \"${CIRCLE_BRANCH}\" == \"release_package\" ]; then\n  case $CIRCLE_NODE_INDEX in\n    0) TARGET=\"centos\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/serverspec/el/6 pkg/*.rpm\n      ;;\n    1) TARGET=\"ubuntu\"\n      bundle exec kitchen destroy ${TARGET}\n      bundle exec package_cloud push omnibus-serverspec/serverspec/ubuntu/trusty pkg/*.deb\n      ;;\n  esac\nfi\n```\n\n\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u7f6e\u304b\u308c\u307e\u3059\u3002\n\nhttps://packagecloud.io/omnibus-serverspec/serverspec\n\n![omnibus-serverspec_serverspec_-_Packages.png](https://qiita-image-store.s3.amazonaws.com/0/7454/f09a564c-9caf-0172-117e-1c99a941a628.png \"omnibus-serverspec_serverspec_-_Packages.png\")\n\n\n## \u6b8b\u8ab2\u984c\n\n- \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u3061\u3083\u3093\u3068\u52d5\u304f\u304b\u306e\u30c6\u30b9\u30c8\u306f\u81ea\u52d5\u3067\u3057\u3066\u306a\u3044\u3002\n    - `kitchen verify`\u3067\u7d50\u5408\u30c6\u30b9\u30c8\u306f\u304b\u3051\u306a\u304f\u3082\u306a\u3044\u3002\n- \u30d0\u30fc\u30b8\u30e7\u30f3\u540c\u3058\u3001\u30ea\u30d3\u30b8\u30e7\u30f3\u9055\u3044\u306b\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u3002(push\u3053\u3051\u308b)\n    - packagecloud\u304b\u3089\u4e00\u89a7\u3092\u3068\u308bAPI\u304c\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u56f0\u3063\u3066\u3044\u308b\u3002\n- Serverspec\u672c\u4f53\u306e\u30ea\u30ea\u30fc\u30b9\u3068\u9023\u52d5\u3057\u3066\u306a\u3044\u3002\n    - Rubygems Feed => IFTTT => CricleCI\u30ad\u30c3\u30af\u3092\u753b\u7b56\u3002\n    - \u30d9\u30fc\u30bf\u7248\u3068\u304b\u3067\u305f\u3076\u3093\u3053\u3051\u308b\u3002\n    - Specinfra\u3060\u3051\u66f4\u65b0\u3055\u308c\u305f\u3068\u304d\u3069\u3046\u3057\u3088\u3046\u3002\n\n\u305d\u306e\u3046\u3061\u56f0\u3063\u305f\u3089\u66f4\u65b0\u3057\u3088\u3046\u3002\n", "tags": ["CircleCI", "test-kitchen", "packagecloud"]}