{"context": " More than 1 year has passed since last update.\u53c2\u8003webglorg;\n\u539f\u5247\u3068\u3057\u3066\u4e0a\u8a18\u30da\u30fc\u30b8\u3092\u898b\u306a\u304c\u3089\u5b66\u7fd2\u3057\u305f\u8a18\u9332\u3067\u3059\u3002\n\n\n\u5e73\u884c\u5149\u6e90\n\u5e73\u884c\u5149\u6e90(\u30c7\u30a3\u30ec\u30af\u30b7\u30e7\u30ca\u30eb\u30e9\u30a4\u30c8)\u306b\u3088\u308b\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5b9f\u88c5\u53ef\u80fd\u3002\n\u7121\u9650\u306b\u9060\u3044\u3068\u3053\u308d\u304b\u3089\u3001\uff13\u6b21\u5143\u7a7a\u9593\u5168\u4f53\u306b\u5e73\u884c\u306b\u964d\u308a\u6ce8\u3050\u5149\u3002\n\n\u6cd5\u7dda\u30d9\u30af\u30c8\u30eb\u3068\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\n\u6cd5\u7dda\u3068\u306f\u3001\u5411\u304d\u3092\u8868\u3059\u30d9\u30af\u30c8\u30eb\u306e\u3053\u3068\u3002\uff13\u6b21\u5143\u306b\u304a\u3051\u308b\u5411\u304d\u306e\u3053\u3068\u3002\n\u6b63\u3057\u3044\u30c7\u30fc\u30bf\u3055\u3048\u7528\u610f\u3059\u308c\u3070\u3001WebGL\u5074\u3067\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u3042\u307e\u308a\u5fc3\u914d\u3059\u308b\u3053\u3068\u306f\u306a\u3044\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30b7\u30e7\u30ca\u30eb\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u30b7\u30a7\u30fc\u30c0\n\u3067\u306f\u30b7\u30a7\u30fc\u30c0\u306e\u5b9f\u88c5\u304b\u3089\u3002\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nuniform   mat4 mvpMatrix;\nuniform   mat4 invMatrix;\nuniform   vec3 lightDirection;\nvarying   vec4 vColor;\n\nvoid main(void){\n    vec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\n    float diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\n    vColor         = color * vec4(vec3(diffuse), 1.0);\n    gl_Position    = mvpMatrix * vec4(position, 1.0);\n}\n\nattribute \u5909\u6570\u306b\u65b0\u305f\u306b nomal \u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\u3053\u308c\u306f\u9802\u70b9\u306e\u6cd5\u7dda\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306e\u5909\u6570\u3002\nuniform \u5909\u6570\u306b\u4e8c\u3064\u306e\u8ffd\u52a0\u304c\u3042\u308b\u304c\u3001\ninvMatrix \u306f\u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u9006\u884c\u5217\u3092\u53d7\u3051\u53d6\u308b\u305f\u3081\u306e\u5909\u6570\u3002\nlightDirection \u306f\u5e73\u884c\u5149\u6e90\u304b\u3089\u767a\u305b\u3089\u308c\u308b\u5149\u306e\u5411\u304d\u3092\u8868\u3059\u30d9\u30af\u30c8\u30eb\u3002\n\u7d9a\u3044\u3066\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3046\u305f\u3081\u306e\u4fc2\u6570\u3092\u8a08\u7b97\u3059\u308b\u3002\nvec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\nfloat diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\nvColor         = color * vec4(vec3(diffuse), 1.0);\n\n\u3053\u306e\u90e8\u5206\u3067\u306f\u3001\u307e\u305ainvLight\u3092\u6b63\u898f\u5316\u3057\u3066\u3044\u308b\u3002\n\u6b21\u306b\u6cd5\u7dda\u3068\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\u306e\u5185\u7a4d\u3092\u3068\u3063\u3066\u3044\u308b\u3002\n\u6700\u5f8c\u306b\u7b97\u51fa\u3057\u305f\u30e9\u30a4\u30c8\u4fc2\u6570\u3068\u3001\u9802\u70b9\u8272\u3068\u3092\u639b\u3051\u5408\u308f\u305b\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306b varying \u5909\u6570\u3068\u3057\u3066\u6e21\u3057\u3066\u3044\u308b\u3002\n\nVBO\u306b\u653e\u7dda\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\n\u524d\u56de\u306e\u30c8\u30fc\u30e9\u30b9\u30e2\u30c7\u30eb\u3092\u4fee\u6b63\u3002\u653e\u7dda\u306e\u60c5\u5831\u3082\u6e21\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n// \u30c8\u30fc\u30e9\u30b9\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\nfunction torus(row, column, irad, orad){\n    var pos = new Array(), nor = new Array(),\n        col = new Array(), idx = new Array();\n    for(var i = 0; i <= row; i++){\n        var r = Math.PI * 2 / row * i;\n        var rr = Math.cos(r);\n        var ry = Math.sin(r);\n        for(var ii = 0; ii <= column; ii++){\n            var tr = Math.PI * 2 / column * ii;\n            var tx = (rr * irad + orad) * Math.cos(tr);\n            var ty = ry * irad;\n            var tz = (rr * irad + orad) * Math.sin(tr);\n            var rx = rr * Math.cos(tr);\n            var rz = rr * Math.sin(tr);\n            pos.push(tx, ty, tz);\n            nor.push(rx, ry, rz);\n            var tc = hsva(360 / column * ii, 1, 1, 1);\n            col.push(tc[0], tc[1], tc[2], tc[3]);\n        }\n    }\n    for(i = 0; i < row; i++){\n        for(ii = 0; ii < column; ii++){\n            r = (column + 1) * i + ii;\n            idx.push(r, r + column + 1, r + 1);\n            idx.push(r + column + 1, r + column + 2, r + 1);\n        }\n    }\n    return [pos, nor, col, idx];\n}\n\n\u3053\u306e\u95a2\u6570\u3092\u3082\u3068\u306b\u30c8\u30fc\u30e9\u30b9\u751f\u6210\u3092\u3057\u3001VBO\u3092\u4f5c\u6210\u3059\u308b\u3002\n// attributeLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\nvar attLocation = new Array();\nattLocation[0] = gl.getAttribLocation(prg, 'position');\nattLocation[1] = gl.getAttribLocation(prg, 'normal');\nattLocation[2] = gl.getAttribLocation(prg, 'color');\n\n// attribute\u306e\u8981\u7d20\u6570\u3092\u914d\u5217\u306b\u683c\u7d0d\nvar attStride = new Array();\nattStride[0] = 3;\nattStride[1] = 3;\nattStride[2] = 4;\n\n// \u30c8\u30fc\u30e9\u30b9\u306e\u9802\u70b9\u30c7\u30fc\u30bf\u3092\u751f\u6210\nvar torusData = torus(32, 32, 1.0, 2.0);\nvar position = torusData[0];\nvar normal = torusData[1];\nvar color = torusData[2];\nvar index = torusData[3];\n\n// VBO\u306e\u751f\u6210\nvar pos_vbo = create_vbo(position);\nvar nor_vbo = create_vbo(normal);\nvar col_vbo = create_vbo(color);\n\nuniform \u88c5\u98fe\u5b50\u4ed8\u304d\u306e\u5909\u6570\u3082\u5897\u3048\u305f\u306e\u3067\u3001uniformLocation \u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3082\u8ffd\u52a0\u3059\u308b\u3002\n// uniformLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\nvar uniLocation = new Array();\nuniLocation[0] = gl.getUniformLocation(prg, 'mvpMatrix');\nuniLocation[1] = gl.getUniformLocation(prg, 'invMatrix');\nuniLocation[2] = gl.getUniformLocation(prg, 'lightDirection');\n\n\n\u30e9\u30a4\u30c8\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\n// \u5404\u7a2e\u884c\u5217\u306e\u751f\u6210\u3068\u521d\u671f\u5316\nvar mMatrix = m.identity(m.create());\nvar vMatrix = m.identity(m.create());\nvar pMatrix = m.identity(m.create());\nvar tmpMatrix = m.identity(m.create());\nvar mvpMatrix = m.identity(m.create());\nvar invMatrix = m.identity(m.create());\n\n// \u30d3\u30e5\u30fc\u00d7\u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5ea7\u6a19\u5909\u63db\u884c\u5217\nm.lookAt([0.0, 0.0, 20.0], [0, 0, 0], [0, 1, 0], vMatrix);\nm.perspective(45, c.width / c.height, 0.1, 100, pMatrix);\nm.multiply(pMatrix, vMatrix, tmpMatrix);\n\n// \u5e73\u884c\u5149\u6e90\u306e\u5411\u304d\nvar lightDirection = [-0.5, 0.5, 0.5];\n\n\u5de6\u3084\u3084\u5f8c\u65b9\u304b\u3089\u539f\u70b9\u306b\u5411\u304b\u3063\u3066\u5149\u3092\u3042\u3066\u308b\u3002\ninvMatrix\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3002\n// \u30ab\u30a6\u30f3\u30bf\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\ncount++;\n\n// \u30ab\u30a6\u30f3\u30bf\u3092\u5143\u306b\u30e9\u30b8\u30a2\u30f3\u3092\u7b97\u51fa\nvar rad = (count % 360) * Math.PI / 180;\n\n// \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u751f\u6210\nm.identity(mMatrix);\nm.rotate(mMatrix, rad, [0, 1, 1], mMatrix);\nm.multiply(tmpMatrix, mMatrix, mvpMatrix);\n\n// \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u304b\u3089\u9006\u884c\u5217\u3092\u751f\u6210\nm.inverse(mMatrix, invMatrix);\n\n// uniform\u5909\u6570\u306e\u767b\u9332\ngl.uniformMatrix4fv(uniLocation[0], false, mvpMatrix);\ngl.uniformMatrix4fv(uniLocation[1], false, invMatrix);\ngl.uniform3fv(uniLocation[2], lightDirection);\n\n\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\u306f\u4e09\u3064\u306e\u8981\u7d20\u3092\u6301\u3064\u30d9\u30af\u30c8\u30eb\u306a\u306e\u3067\u3001\u884c\u5217\u3092\u6271\u3046\u5834\u5408\u3068\u306f\u9055\u3044 uniform3fv \u3092\u4f7f\u3046\u3053\u3068\u306b\u6ce8\u610f\u3002\n\nHTML,\u30b9\u30af\u30ea\u30d7\u30c8\u5168\u6587\n<html>\n<head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=windows-1252\">\n\n\n        <title>WebGL TEST</title>\n        <script src=\"minMatrix.js\" type=\"text/javascript\"></script>\n        <script src=\"script.js\" type=\"text/javascript\"></script>\n\n        <script id=\"vs\" type=\"x-shader/x-vertex\">\n        attribute vec3 position;\n        attribute vec3 normal;\n        attribute vec4 color;\n        uniform   mat4 mvpMatrix;\n        uniform   mat4 invMatrix;\n        uniform   vec3 lightDirection;\n        varying   vec4 vColor;\n\n        void main(void){\n            vec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\n            float diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\n            vColor         = color * vec4(vec3(diffuse), 1.0);\n            gl_Position    = mvpMatrix * vec4(position, 1.0);\n        }\n        </script>\n\n        <script id=\"fs\" type=\"x-shader/x-fragment\">\n        precision mediump float;\n\n        varying vec4 vColor;\n\n        void main(void){\n            gl_FragColor = vColor;\n        }\n        </script>\n\n    </head>\n    <body>\n        <canvas id=\"canvas\" width=\"300\" height=\"300\"></canvas>\n    </body>\n</html>\n\nonload = function(){\n    // canvas\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n    var c = document.getElementById('canvas');\n    c.width = 500;\n    c.height = 300;\n\n    // webgl\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u53d6\u5f97\n    var gl = c.getContext('webgl') || c.getContext('experimental-webgl');\n\n    // \u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3068\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306e\u751f\u6210\n    var v_shader = create_shader('vs');\n    var f_shader = create_shader('fs');\n\n    // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\u3068\u30ea\u30f3\u30af\n    var prg = create_program(v_shader, f_shader);\n\n    // attributeLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\n    var attLocation = new Array();\n    attLocation[0] = gl.getAttribLocation(prg, 'position');\n    attLocation[1] = gl.getAttribLocation(prg, 'normal');\n    attLocation[2] = gl.getAttribLocation(prg, 'color');\n\n    // attribute\u306e\u8981\u7d20\u6570\u3092\u914d\u5217\u306b\u683c\u7d0d\n    var attStride = new Array();\n    attStride[0] = 3;\n    attStride[1] = 3;\n    attStride[2] = 4;\n\n    // \u30c8\u30fc\u30e9\u30b9\u306e\u9802\u70b9\u30c7\u30fc\u30bf\u3092\u751f\u6210\n    var torusData = torus(32, 32, 1.0, 2.0);\n    var position = torusData[0];\n    var normal = torusData[1];\n    var color = torusData[2];\n    var index = torusData[3];\n\n    // VBO\u306e\u751f\u6210\n    var pos_vbo = create_vbo(position);\n    var nor_vbo = create_vbo(normal);\n    var col_vbo = create_vbo(color);\n\n    // VBO \u3092\u767b\u9332\u3059\u308b\n    set_attribute([pos_vbo, nor_vbo, col_vbo], attLocation, attStride);\n\n    // IBO\u306e\u751f\u6210\n    var ibo = create_ibo(index);\n\n    // IBO\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u767b\u9332\u3059\u308b\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);\n\n    // uniformLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\n    var uniLocation = new Array();\n    uniLocation[0] = gl.getUniformLocation(prg, 'mvpMatrix');\n    uniLocation[1] = gl.getUniformLocation(prg, 'invMatrix');\n    uniLocation[2] = gl.getUniformLocation(prg, 'lightDirection');\n\n    // minMatrix.js \u3092\u7528\u3044\u305f\u884c\u5217\u95a2\u9023\u51e6\u7406\n    // matIV\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\n    var m = new matIV();\n\n    // \u5404\u7a2e\u884c\u5217\u306e\u751f\u6210\u3068\u521d\u671f\u5316\n    var mMatrix = m.identity(m.create());\n    var vMatrix = m.identity(m.create());\n    var pMatrix = m.identity(m.create());\n    var tmpMatrix = m.identity(m.create());\n    var mvpMatrix = m.identity(m.create());\n    var invMatrix = m.identity(m.create());\n\n    // \u30d3\u30e5\u30fc\u00d7\u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5ea7\u6a19\u5909\u63db\u884c\u5217\n    m.lookAt([0.0, 0.0, 20.0], [0, 0, 0], [0, 1, 0], vMatrix);\n    m.perspective(45, c.width / c.height, 0.1, 100, pMatrix);\n    m.multiply(pMatrix, vMatrix, tmpMatrix);\n\n    // \u5e73\u884c\u5149\u6e90\u306e\u5411\u304d\n    var lightDirection = [-0.5, 0.5, 0.5];\n\n    // \u30ab\u30a6\u30f3\u30bf\u306e\u5ba3\u8a00\n    var count = 0;\n\n    // \u30ab\u30ea\u30f3\u30b0\u3068\u6df1\u5ea6\u30c6\u30b9\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.enable(gl.CULL_FACE);\n\n    // \u6052\u5e38\u30eb\u30fc\u30d7\n    (function(){\n        // canvas\u3092\u521d\u671f\u5316\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clearDepth(1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n\n        // \u30ab\u30a6\u30f3\u30bf\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\n        count++;\n\n        // \u30ab\u30a6\u30f3\u30bf\u3092\u5143\u306b\u30e9\u30b8\u30a2\u30f3\u3092\u7b97\u51fa\n        var rad = (count % 360) * Math.PI / 180;\n\n        // \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u751f\u6210\n        m.identity(mMatrix);\n        m.rotate(mMatrix, rad, [0, 1, 1], mMatrix);\n        m.multiply(tmpMatrix, mMatrix, mvpMatrix);\n\n        // \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u304b\u3089\u9006\u884c\u5217\u3092\u751f\u6210\n        m.inverse(mMatrix, invMatrix);\n\n        // uniform\u5909\u6570\u306e\u767b\u9332\n        gl.uniformMatrix4fv(uniLocation[0], false, mvpMatrix);\n        gl.uniformMatrix4fv(uniLocation[1], false, invMatrix);\n        gl.uniform3fv(uniLocation[2], lightDirection);\n\n        // \u30e2\u30c7\u30eb\u306e\u63cf\u753b\n        gl.drawElements(gl.TRIANGLES, index.length, gl.UNSIGNED_SHORT, 0);\n\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u518d\u63cf\u753b\n        gl.flush();\n\n        // \u30eb\u30fc\u30d7\u306e\u305f\u3081\u306b\u518d\u5e30\u547c\u3073\u51fa\u3057\n        setTimeout(arguments.callee, 1000 / 30);\n    })();\n\n    // \u30b7\u30a7\u30fc\u30c0\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_shader(id){\n        // \u30b7\u30a7\u30fc\u30c0\u3092\u683c\u7d0d\u3059\u308b\u5909\u6570\n        var shader;\n\n        // HTML\u304b\u3089script\u30bf\u30b0\u3078\u306e\u53c2\u7167\u3092\u53d6\u5f97\n        var scriptElement = document.getElementById(id);\n\n        // script\u30bf\u30b0\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u629c\u3051\u308b\n        if(!scriptElement){return;}\n\n        // script\u30bf\u30b0\u306etype\u5c5e\u6027\u3092\u30c1\u30a7\u30c3\u30af\n        switch(scriptElement.type){\n\n            // \u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306e\u5834\u5408\n            case 'x-shader/x-vertex':\n                shader = gl.createShader(gl.VERTEX_SHADER);\n                break;\n\n            // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306e\u5834\u5408\n            case 'x-shader/x-fragment':\n                shader = gl.createShader(gl.FRAGMENT_SHADER);\n                break;\n            default :\n                return;\n        }\n\n        // \u751f\u6210\u3055\u308c\u305f\u30b7\u30a7\u30fc\u30c0\u306b\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u308b\n        gl.shaderSource(shader, scriptElement.text);\n\n        // \u30b7\u30a7\u30fc\u30c0\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\n        gl.compileShader(shader);\n\n        // \u30b7\u30a7\u30fc\u30c0\u304c\u6b63\u3057\u304f\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u304b\u30c1\u30a7\u30c3\u30af\n        if(gl.getShaderParameter(shader, gl.COMPILE_STATUS)){\n\n            // \u6210\u529f\u3057\u3066\u3044\u305f\u3089\u30b7\u30a7\u30fc\u30c0\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n            return shader;\n        }else{\n\n            // \u5931\u6557\u3057\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u30a2\u30e9\u30fc\u30c8\u3059\u308b\n            alert(gl.getShaderInfoLog(shader));\n        }\n    }\n\n    // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u30b7\u30a7\u30fc\u30c0\u3092\u30ea\u30f3\u30af\u3059\u308b\u95a2\u6570\n    function create_program(vs, fs){\n        // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var program = gl.createProgram();\n\n        // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30b7\u30a7\u30fc\u30c0\u3092\u5272\u308a\u5f53\u3066\u308b\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n\n        // \u30b7\u30a7\u30fc\u30c0\u3092\u30ea\u30f3\u30af\n        gl.linkProgram(program);\n\n        // \u30b7\u30a7\u30fc\u30c0\u306e\u30ea\u30f3\u30af\u304c\u6b63\u3057\u304f\u884c\u306a\u308f\u308c\u305f\u304b\u30c1\u30a7\u30c3\u30af\n        if(gl.getProgramParameter(program, gl.LINK_STATUS)){\n\n            // \u6210\u529f\u3057\u3066\u3044\u305f\u3089\u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\n            gl.useProgram(program);\n\n            // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n            return program;\n        }else{\n\n            // \u5931\u6557\u3057\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u30a2\u30e9\u30fc\u30c8\u3059\u308b\n            alert(gl.getProgramInfoLog(program));\n        }\n    }\n\n    // VBO\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_vbo(data){\n        // \u30d0\u30c3\u30d5\u30a1\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var vbo = gl.createBuffer();\n\n        // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n\n        // \u30d0\u30c3\u30d5\u30a1\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n\n        // \u30d0\u30c3\u30d5\u30a1\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u7121\u52b9\u5316\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n        // \u751f\u6210\u3057\u305f VBO \u3092\u8fd4\u3057\u3066\u7d42\u4e86\n        return vbo;\n    }\n\n    // VBO\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u767b\u9332\u3059\u308b\u95a2\u6570\n    function set_attribute(vbo, attL, attS){\n        // \u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u3063\u305f\u914d\u5217\u3092\u51e6\u7406\u3059\u308b\n        for(var i in vbo){\n            // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n            gl.bindBuffer(gl.ARRAY_BUFFER, vbo[i]);\n\n            // attributeLocation\u3092\u6709\u52b9\u306b\u3059\u308b\n            gl.enableVertexAttribArray(attL[i]);\n\n            // attributeLocation\u3092\u901a\u77e5\u3057\u767b\u9332\u3059\u308b\n            gl.vertexAttribPointer(attL[i], attS[i], gl.FLOAT, false, 0, 0);\n        }\n    }\n\n    // IBO\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_ibo(data){\n        // \u30d0\u30c3\u30d5\u30a1\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var ibo = gl.createBuffer();\n\n        // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);\n\n        // \u30d0\u30c3\u30d5\u30a1\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Int16Array(data), gl.STATIC_DRAW);\n\n        // \u30d0\u30c3\u30d5\u30a1\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u7121\u52b9\u5316\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n        // \u751f\u6210\u3057\u305fIBO\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n        return ibo;\n    }\n\n    // \u30c8\u30fc\u30e9\u30b9\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function torus(row, column, irad, orad){\n        var pos = new Array(), nor = new Array(),\n            col = new Array(), idx = new Array();\n        for(var i = 0; i <= row; i++){\n            var r = Math.PI * 2 / row * i;\n            var rr = Math.cos(r);\n            var ry = Math.sin(r);\n            for(var ii = 0; ii <= column; ii++){\n                var tr = Math.PI * 2 / column * ii;\n                var tx = (rr * irad + orad) * Math.cos(tr);\n                var ty = ry * irad;\n                var tz = (rr * irad + orad) * Math.sin(tr);\n                var rx = rr * Math.cos(tr);\n                var rz = rr * Math.sin(tr);\n                pos.push(tx, ty, tz);\n                nor.push(rx, ry, rz);\n                var tc = hsva(360 / column * ii, 1, 1, 1);\n                col.push(tc[0], tc[1], tc[2], tc[3]);\n            }\n        }\n        for(i = 0; i < row; i++){\n            for(ii = 0; ii < column; ii++){\n                r = (column + 1) * i + ii;\n                idx.push(r, r + column + 1, r + 1);\n                idx.push(r + column + 1, r + column + 2, r + 1);\n            }\n        }\n        return [pos, nor, col, idx];\n    }\n\n    // HSV\u30ab\u30e9\u30fc\u53d6\u5f97\u7528\u95a2\u6570\n    function hsva(h, s, v, a){\n        if(s > 1 || v > 1 || a > 1){return;}\n        var th = h % 360;\n        var i = Math.floor(th / 60);\n        var f = th / 60 - i;\n        var m = v * (1 - s);\n        var n = v * (1 - s * f);\n        var k = v * (1 - s * (1 - f));\n        var color = new Array();\n        if(!s > 0 && !s < 0){\n            color.push(v, v, v, a); \n        } else {\n            var r = new Array(v, n, m, m, k, v);\n            var g = new Array(k, v, v, n, m, m);\n            var b = new Array(m, m, k, v, v, n);\n            color.push(r[i], g[i], b[i], a);\n        }\n        return color;\n    }\n\n};\n\n\n\u53c2\u8003[webglorg](http://wgld.org/);\n\u539f\u5247\u3068\u3057\u3066\u4e0a\u8a18\u30da\u30fc\u30b8\u3092\u898b\u306a\u304c\u3089\u5b66\u7fd2\u3057\u305f\u8a18\u9332\u3067\u3059\u3002\n\n![Screen Shot 2015-10-30 at 20.44.11.png](https://qiita-image-store.s3.amazonaws.com/0/54225/fe1e78fb-a1c2-8214-0321-211324f2c8b8.png \"Screen Shot 2015-10-30 at 20.44.11.png\")\n\n\n## \u5e73\u884c\u5149\u6e90\n\u5e73\u884c\u5149\u6e90(\u30c7\u30a3\u30ec\u30af\u30b7\u30e7\u30ca\u30eb\u30e9\u30a4\u30c8)\u306b\u3088\u308b\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u306f\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u5b9f\u88c5\u53ef\u80fd\u3002\n\u7121\u9650\u306b\u9060\u3044\u3068\u3053\u308d\u304b\u3089\u3001\uff13\u6b21\u5143\u7a7a\u9593\u5168\u4f53\u306b\u5e73\u884c\u306b\u964d\u308a\u6ce8\u3050\u5149\u3002\n\n## \u6cd5\u7dda\u30d9\u30af\u30c8\u30eb\u3068\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\n\u6cd5\u7dda\u3068\u306f\u3001\u5411\u304d\u3092\u8868\u3059\u30d9\u30af\u30c8\u30eb\u306e\u3053\u3068\u3002\uff13\u6b21\u5143\u306b\u304a\u3051\u308b\u5411\u304d\u306e\u3053\u3068\u3002\n\u6b63\u3057\u3044\u30c7\u30fc\u30bf\u3055\u3048\u7528\u610f\u3059\u308c\u3070\u3001WebGL\u5074\u3067\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u3042\u307e\u308a\u5fc3\u914d\u3059\u308b\u3053\u3068\u306f\u306a\u3044\u3002\n\n## \u30c7\u30a3\u30ec\u30af\u30b7\u30e7\u30ca\u30eb\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u30b7\u30a7\u30fc\u30c0\n\u3067\u306f\u30b7\u30a7\u30fc\u30c0\u306e\u5b9f\u88c5\u304b\u3089\u3002\n\n```GLSL\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec4 color;\nuniform   mat4 mvpMatrix;\nuniform   mat4 invMatrix;\nuniform   vec3 lightDirection;\nvarying   vec4 vColor;\n\nvoid main(void){\n    vec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\n    float diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\n    vColor         = color * vec4(vec3(diffuse), 1.0);\n    gl_Position    = mvpMatrix * vec4(position, 1.0);\n}\n```\n\nattribute \u5909\u6570\u306b\u65b0\u305f\u306b nomal \u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\n\u3053\u308c\u306f\u9802\u70b9\u306e\u6cd5\u7dda\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308b\u305f\u3081\u306e\u5909\u6570\u3002\nuniform \u5909\u6570\u306b\u4e8c\u3064\u306e\u8ffd\u52a0\u304c\u3042\u308b\u304c\u3001\ninvMatrix \u306f\u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u9006\u884c\u5217\u3092\u53d7\u3051\u53d6\u308b\u305f\u3081\u306e\u5909\u6570\u3002\nlightDirection \u306f\u5e73\u884c\u5149\u6e90\u304b\u3089\u767a\u305b\u3089\u308c\u308b\u5149\u306e\u5411\u304d\u3092\u8868\u3059\u30d9\u30af\u30c8\u30eb\u3002\n\n\u7d9a\u3044\u3066\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3092\u884c\u3046\u305f\u3081\u306e\u4fc2\u6570\u3092\u8a08\u7b97\u3059\u308b\u3002\n\n```GLSL\nvec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\nfloat diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\nvColor         = color * vec4(vec3(diffuse), 1.0);\n```\n\n\n\u3053\u306e\u90e8\u5206\u3067\u306f\u3001\u307e\u305ainvLight\u3092\u6b63\u898f\u5316\u3057\u3066\u3044\u308b\u3002\n\u6b21\u306b\u6cd5\u7dda\u3068\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\u306e\u5185\u7a4d\u3092\u3068\u3063\u3066\u3044\u308b\u3002\n\u6700\u5f8c\u306b\u7b97\u51fa\u3057\u305f\u30e9\u30a4\u30c8\u4fc2\u6570\u3068\u3001\u9802\u70b9\u8272\u3068\u3092\u639b\u3051\u5408\u308f\u305b\u3066\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306b varying \u5909\u6570\u3068\u3057\u3066\u6e21\u3057\u3066\u3044\u308b\u3002\n\n\n## VBO\u306b\u653e\u7dda\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\n\u524d\u56de\u306e\u30c8\u30fc\u30e9\u30b9\u30e2\u30c7\u30eb\u3092\u4fee\u6b63\u3002\u653e\u7dda\u306e\u60c5\u5831\u3082\u6e21\u305b\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```javascript\n// \u30c8\u30fc\u30e9\u30b9\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\nfunction torus(row, column, irad, orad){\n    var pos = new Array(), nor = new Array(),\n        col = new Array(), idx = new Array();\n    for(var i = 0; i <= row; i++){\n        var r = Math.PI * 2 / row * i;\n        var rr = Math.cos(r);\n        var ry = Math.sin(r);\n        for(var ii = 0; ii <= column; ii++){\n            var tr = Math.PI * 2 / column * ii;\n            var tx = (rr * irad + orad) * Math.cos(tr);\n            var ty = ry * irad;\n            var tz = (rr * irad + orad) * Math.sin(tr);\n            var rx = rr * Math.cos(tr);\n            var rz = rr * Math.sin(tr);\n            pos.push(tx, ty, tz);\n            nor.push(rx, ry, rz);\n            var tc = hsva(360 / column * ii, 1, 1, 1);\n            col.push(tc[0], tc[1], tc[2], tc[3]);\n        }\n    }\n    for(i = 0; i < row; i++){\n        for(ii = 0; ii < column; ii++){\n            r = (column + 1) * i + ii;\n            idx.push(r, r + column + 1, r + 1);\n            idx.push(r + column + 1, r + column + 2, r + 1);\n        }\n    }\n    return [pos, nor, col, idx];\n}\n```\n\n\u3053\u306e\u95a2\u6570\u3092\u3082\u3068\u306b\u30c8\u30fc\u30e9\u30b9\u751f\u6210\u3092\u3057\u3001VBO\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```javascript\n// attributeLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\nvar attLocation = new Array();\nattLocation[0] = gl.getAttribLocation(prg, 'position');\nattLocation[1] = gl.getAttribLocation(prg, 'normal');\nattLocation[2] = gl.getAttribLocation(prg, 'color');\n\n// attribute\u306e\u8981\u7d20\u6570\u3092\u914d\u5217\u306b\u683c\u7d0d\nvar attStride = new Array();\nattStride[0] = 3;\nattStride[1] = 3;\nattStride[2] = 4;\n\n// \u30c8\u30fc\u30e9\u30b9\u306e\u9802\u70b9\u30c7\u30fc\u30bf\u3092\u751f\u6210\nvar torusData = torus(32, 32, 1.0, 2.0);\nvar position = torusData[0];\nvar normal = torusData[1];\nvar color = torusData[2];\nvar index = torusData[3];\n\n// VBO\u306e\u751f\u6210\nvar pos_vbo = create_vbo(position);\nvar nor_vbo = create_vbo(normal);\nvar col_vbo = create_vbo(color);\n```\n\nuniform \u88c5\u98fe\u5b50\u4ed8\u304d\u306e\u5909\u6570\u3082\u5897\u3048\u305f\u306e\u3067\u3001uniformLocation \u3092\u53d6\u5f97\u3059\u308b\u51e6\u7406\u3082\u8ffd\u52a0\u3059\u308b\u3002\n\n```javascript\n// uniformLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\nvar uniLocation = new Array();\nuniLocation[0] = gl.getUniformLocation(prg, 'mvpMatrix');\nuniLocation[1] = gl.getUniformLocation(prg, 'invMatrix');\nuniLocation[2] = gl.getUniformLocation(prg, 'lightDirection');\n```\n\n\n## \u30e9\u30a4\u30c8\u306b\u95a2\u3059\u308b\u51e6\u7406\u3092\u8ffd\u52a0\n```javascript\n// \u5404\u7a2e\u884c\u5217\u306e\u751f\u6210\u3068\u521d\u671f\u5316\nvar mMatrix = m.identity(m.create());\nvar vMatrix = m.identity(m.create());\nvar pMatrix = m.identity(m.create());\nvar tmpMatrix = m.identity(m.create());\nvar mvpMatrix = m.identity(m.create());\nvar invMatrix = m.identity(m.create());\n\n// \u30d3\u30e5\u30fc\u00d7\u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5ea7\u6a19\u5909\u63db\u884c\u5217\nm.lookAt([0.0, 0.0, 20.0], [0, 0, 0], [0, 1, 0], vMatrix);\nm.perspective(45, c.width / c.height, 0.1, 100, pMatrix);\nm.multiply(pMatrix, vMatrix, tmpMatrix);\n\n// \u5e73\u884c\u5149\u6e90\u306e\u5411\u304d\nvar lightDirection = [-0.5, 0.5, 0.5];\n```\n\n\u5de6\u3084\u3084\u5f8c\u65b9\u304b\u3089\u539f\u70b9\u306b\u5411\u304b\u3063\u3066\u5149\u3092\u3042\u3066\u308b\u3002\ninvMatrix\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3002\n\n```javascript\n// \u30ab\u30a6\u30f3\u30bf\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\ncount++;\n\n// \u30ab\u30a6\u30f3\u30bf\u3092\u5143\u306b\u30e9\u30b8\u30a2\u30f3\u3092\u7b97\u51fa\nvar rad = (count % 360) * Math.PI / 180;\n\n// \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u751f\u6210\nm.identity(mMatrix);\nm.rotate(mMatrix, rad, [0, 1, 1], mMatrix);\nm.multiply(tmpMatrix, mMatrix, mvpMatrix);\n\n// \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u304b\u3089\u9006\u884c\u5217\u3092\u751f\u6210\nm.inverse(mMatrix, invMatrix);\n\n// uniform\u5909\u6570\u306e\u767b\u9332\ngl.uniformMatrix4fv(uniLocation[0], false, mvpMatrix);\ngl.uniformMatrix4fv(uniLocation[1], false, invMatrix);\ngl.uniform3fv(uniLocation[2], lightDirection);\n```\n\n\u30e9\u30a4\u30c8\u30d9\u30af\u30c8\u30eb\u306f\u4e09\u3064\u306e\u8981\u7d20\u3092\u6301\u3064\u30d9\u30af\u30c8\u30eb\u306a\u306e\u3067\u3001\u884c\u5217\u3092\u6271\u3046\u5834\u5408\u3068\u306f\u9055\u3044 uniform3fv \u3092\u4f7f\u3046\u3053\u3068\u306b\u6ce8\u610f\u3002\n\n\n## HTML,\u30b9\u30af\u30ea\u30d7\u30c8\u5168\u6587\n\n```HTML\n<html>\n<head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=windows-1252\">\n\n        \n        <title>WebGL TEST</title>\n        <script src=\"minMatrix.js\" type=\"text/javascript\"></script>\n        <script src=\"script.js\" type=\"text/javascript\"></script>\n\n        <script id=\"vs\" type=\"x-shader/x-vertex\">\n\t\tattribute vec3 position;\n\t\tattribute vec3 normal;\n\t\tattribute vec4 color;\n\t\tuniform   mat4 mvpMatrix;\n\t\tuniform   mat4 invMatrix;\n\t\tuniform   vec3 lightDirection;\n\t\tvarying   vec4 vColor;\n\n\t\tvoid main(void){\n\t\t    vec3  invLight = normalize(invMatrix * vec4(lightDirection, 0.0)).xyz;\n\t\t    float diffuse  = clamp(dot(normal, invLight), 0.1, 1.0);\n\t\t    vColor         = color * vec4(vec3(diffuse), 1.0);\n\t\t    gl_Position    = mvpMatrix * vec4(position, 1.0);\n\t\t}\n        </script>\n        \n        <script id=\"fs\" type=\"x-shader/x-fragment\">\n\t\tprecision mediump float;\n\n\t\tvarying vec4 vColor;\n\n\t\tvoid main(void){\n\t\t    gl_FragColor = vColor;\n\t\t}\n        </script>\n\n    </head>\n    <body>\n        <canvas id=\"canvas\" width=\"300\" height=\"300\"></canvas>\n    </body>\n</html>\n```\n\n```javascript\nonload = function(){\n    // canvas\u30a8\u30ec\u30e1\u30f3\u30c8\u3092\u53d6\u5f97\n    var c = document.getElementById('canvas');\n    c.width = 500;\n    c.height = 300;\n    \n    // webgl\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u53d6\u5f97\n    var gl = c.getContext('webgl') || c.getContext('experimental-webgl');\n    \n    // \u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u3068\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306e\u751f\u6210\n    var v_shader = create_shader('vs');\n    var f_shader = create_shader('fs');\n    \n    // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\u3068\u30ea\u30f3\u30af\n    var prg = create_program(v_shader, f_shader);\n    \n    // attributeLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\n    var attLocation = new Array();\n    attLocation[0] = gl.getAttribLocation(prg, 'position');\n    attLocation[1] = gl.getAttribLocation(prg, 'normal');\n    attLocation[2] = gl.getAttribLocation(prg, 'color');\n    \n    // attribute\u306e\u8981\u7d20\u6570\u3092\u914d\u5217\u306b\u683c\u7d0d\n    var attStride = new Array();\n    attStride[0] = 3;\n    attStride[1] = 3;\n    attStride[2] = 4;\n    \n    // \u30c8\u30fc\u30e9\u30b9\u306e\u9802\u70b9\u30c7\u30fc\u30bf\u3092\u751f\u6210\n    var torusData = torus(32, 32, 1.0, 2.0);\n    var position = torusData[0];\n    var normal = torusData[1];\n    var color = torusData[2];\n    var index = torusData[3];\n    \n    // VBO\u306e\u751f\u6210\n    var pos_vbo = create_vbo(position);\n    var nor_vbo = create_vbo(normal);\n    var col_vbo = create_vbo(color);\n    \n    // VBO \u3092\u767b\u9332\u3059\u308b\n    set_attribute([pos_vbo, nor_vbo, col_vbo], attLocation, attStride);\n    \n    // IBO\u306e\u751f\u6210\n    var ibo = create_ibo(index);\n    \n    // IBO\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u767b\u9332\u3059\u308b\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);\n    \n    // uniformLocation\u3092\u914d\u5217\u306b\u53d6\u5f97\n    var uniLocation = new Array();\n    uniLocation[0] = gl.getUniformLocation(prg, 'mvpMatrix');\n    uniLocation[1] = gl.getUniformLocation(prg, 'invMatrix');\n    uniLocation[2] = gl.getUniformLocation(prg, 'lightDirection');\n    \n    // minMatrix.js \u3092\u7528\u3044\u305f\u884c\u5217\u95a2\u9023\u51e6\u7406\n    // matIV\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\n    var m = new matIV();\n    \n    // \u5404\u7a2e\u884c\u5217\u306e\u751f\u6210\u3068\u521d\u671f\u5316\n    var mMatrix = m.identity(m.create());\n    var vMatrix = m.identity(m.create());\n    var pMatrix = m.identity(m.create());\n    var tmpMatrix = m.identity(m.create());\n    var mvpMatrix = m.identity(m.create());\n    var invMatrix = m.identity(m.create());\n    \n    // \u30d3\u30e5\u30fc\u00d7\u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u5ea7\u6a19\u5909\u63db\u884c\u5217\n    m.lookAt([0.0, 0.0, 20.0], [0, 0, 0], [0, 1, 0], vMatrix);\n    m.perspective(45, c.width / c.height, 0.1, 100, pMatrix);\n    m.multiply(pMatrix, vMatrix, tmpMatrix);\n    \n    // \u5e73\u884c\u5149\u6e90\u306e\u5411\u304d\n    var lightDirection = [-0.5, 0.5, 0.5];\n    \n    // \u30ab\u30a6\u30f3\u30bf\u306e\u5ba3\u8a00\n    var count = 0;\n    \n    // \u30ab\u30ea\u30f3\u30b0\u3068\u6df1\u5ea6\u30c6\u30b9\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\n    gl.enable(gl.DEPTH_TEST);\n    gl.depthFunc(gl.LEQUAL);\n    gl.enable(gl.CULL_FACE);\n    \n    // \u6052\u5e38\u30eb\u30fc\u30d7\n    (function(){\n        // canvas\u3092\u521d\u671f\u5316\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clearDepth(1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        \n        // \u30ab\u30a6\u30f3\u30bf\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308b\n        count++;\n        \n        // \u30ab\u30a6\u30f3\u30bf\u3092\u5143\u306b\u30e9\u30b8\u30a2\u30f3\u3092\u7b97\u51fa\n        var rad = (count % 360) * Math.PI / 180;\n        \n        // \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u306e\u751f\u6210\n        m.identity(mMatrix);\n        m.rotate(mMatrix, rad, [0, 1, 1], mMatrix);\n        m.multiply(tmpMatrix, mMatrix, mvpMatrix);\n        \n        // \u30e2\u30c7\u30eb\u5ea7\u6a19\u5909\u63db\u884c\u5217\u304b\u3089\u9006\u884c\u5217\u3092\u751f\u6210\n        m.inverse(mMatrix, invMatrix);\n        \n        // uniform\u5909\u6570\u306e\u767b\u9332\n        gl.uniformMatrix4fv(uniLocation[0], false, mvpMatrix);\n        gl.uniformMatrix4fv(uniLocation[1], false, invMatrix);\n        gl.uniform3fv(uniLocation[2], lightDirection);\n        \n        // \u30e2\u30c7\u30eb\u306e\u63cf\u753b\n        gl.drawElements(gl.TRIANGLES, index.length, gl.UNSIGNED_SHORT, 0);\n        \n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u518d\u63cf\u753b\n        gl.flush();\n        \n        // \u30eb\u30fc\u30d7\u306e\u305f\u3081\u306b\u518d\u5e30\u547c\u3073\u51fa\u3057\n        setTimeout(arguments.callee, 1000 / 30);\n    })();\n    \n    // \u30b7\u30a7\u30fc\u30c0\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_shader(id){\n        // \u30b7\u30a7\u30fc\u30c0\u3092\u683c\u7d0d\u3059\u308b\u5909\u6570\n        var shader;\n        \n        // HTML\u304b\u3089script\u30bf\u30b0\u3078\u306e\u53c2\u7167\u3092\u53d6\u5f97\n        var scriptElement = document.getElementById(id);\n        \n        // script\u30bf\u30b0\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u629c\u3051\u308b\n        if(!scriptElement){return;}\n        \n        // script\u30bf\u30b0\u306etype\u5c5e\u6027\u3092\u30c1\u30a7\u30c3\u30af\n        switch(scriptElement.type){\n            \n            // \u9802\u70b9\u30b7\u30a7\u30fc\u30c0\u306e\u5834\u5408\n            case 'x-shader/x-vertex':\n                shader = gl.createShader(gl.VERTEX_SHADER);\n                break;\n                \n            // \u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u30b7\u30a7\u30fc\u30c0\u306e\u5834\u5408\n            case 'x-shader/x-fragment':\n                shader = gl.createShader(gl.FRAGMENT_SHADER);\n                break;\n            default :\n                return;\n        }\n        \n        // \u751f\u6210\u3055\u308c\u305f\u30b7\u30a7\u30fc\u30c0\u306b\u30bd\u30fc\u30b9\u3092\u5272\u308a\u5f53\u3066\u308b\n        gl.shaderSource(shader, scriptElement.text);\n        \n        // \u30b7\u30a7\u30fc\u30c0\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\n        gl.compileShader(shader);\n        \n        // \u30b7\u30a7\u30fc\u30c0\u304c\u6b63\u3057\u304f\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u304b\u30c1\u30a7\u30c3\u30af\n        if(gl.getShaderParameter(shader, gl.COMPILE_STATUS)){\n            \n            // \u6210\u529f\u3057\u3066\u3044\u305f\u3089\u30b7\u30a7\u30fc\u30c0\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n            return shader;\n        }else{\n            \n            // \u5931\u6557\u3057\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u30a2\u30e9\u30fc\u30c8\u3059\u308b\n            alert(gl.getShaderInfoLog(shader));\n        }\n    }\n    \n    // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u30b7\u30a7\u30fc\u30c0\u3092\u30ea\u30f3\u30af\u3059\u308b\u95a2\u6570\n    function create_program(vs, fs){\n        // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var program = gl.createProgram();\n        \n        // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u30b7\u30a7\u30fc\u30c0\u3092\u5272\u308a\u5f53\u3066\u308b\n        gl.attachShader(program, vs);\n        gl.attachShader(program, fs);\n        \n        // \u30b7\u30a7\u30fc\u30c0\u3092\u30ea\u30f3\u30af\n        gl.linkProgram(program);\n        \n        // \u30b7\u30a7\u30fc\u30c0\u306e\u30ea\u30f3\u30af\u304c\u6b63\u3057\u304f\u884c\u306a\u308f\u308c\u305f\u304b\u30c1\u30a7\u30c3\u30af\n        if(gl.getProgramParameter(program, gl.LINK_STATUS)){\n        \n            // \u6210\u529f\u3057\u3066\u3044\u305f\u3089\u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6709\u52b9\u306b\u3059\u308b\n            gl.useProgram(program);\n            \n            // \u30d7\u30ed\u30b0\u30e9\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n            return program;\n        }else{\n            \n            // \u5931\u6557\u3057\u3066\u3044\u305f\u3089\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u30a2\u30e9\u30fc\u30c8\u3059\u308b\n            alert(gl.getProgramInfoLog(program));\n        }\n    }\n    \n    // VBO\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_vbo(data){\n        // \u30d0\u30c3\u30d5\u30a1\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var vbo = gl.createBuffer();\n        \n        // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n        gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n        \n        // \u30d0\u30c3\u30d5\u30a1\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(data), gl.STATIC_DRAW);\n        \n        // \u30d0\u30c3\u30d5\u30a1\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u7121\u52b9\u5316\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        \n        // \u751f\u6210\u3057\u305f VBO \u3092\u8fd4\u3057\u3066\u7d42\u4e86\n        return vbo;\n    }\n    \n    // VBO\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u767b\u9332\u3059\u308b\u95a2\u6570\n    function set_attribute(vbo, attL, attS){\n        // \u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u3063\u305f\u914d\u5217\u3092\u51e6\u7406\u3059\u308b\n        for(var i in vbo){\n            // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n            gl.bindBuffer(gl.ARRAY_BUFFER, vbo[i]);\n            \n            // attributeLocation\u3092\u6709\u52b9\u306b\u3059\u308b\n            gl.enableVertexAttribArray(attL[i]);\n            \n            // attributeLocation\u3092\u901a\u77e5\u3057\u767b\u9332\u3059\u308b\n            gl.vertexAttribPointer(attL[i], attS[i], gl.FLOAT, false, 0, 0);\n        }\n    }\n    \n    // IBO\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function create_ibo(data){\n        // \u30d0\u30c3\u30d5\u30a1\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n        var ibo = gl.createBuffer();\n        \n        // \u30d0\u30c3\u30d5\u30a1\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibo);\n        \n        // \u30d0\u30c3\u30d5\u30a1\u306b\u30c7\u30fc\u30bf\u3092\u30bb\u30c3\u30c8\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Int16Array(data), gl.STATIC_DRAW);\n        \n        // \u30d0\u30c3\u30d5\u30a1\u306e\u30d0\u30a4\u30f3\u30c9\u3092\u7121\u52b9\u5316\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n        \n        // \u751f\u6210\u3057\u305fIBO\u3092\u8fd4\u3057\u3066\u7d42\u4e86\n        return ibo;\n    }\n    \n    // \u30c8\u30fc\u30e9\u30b9\u3092\u751f\u6210\u3059\u308b\u95a2\u6570\n    function torus(row, column, irad, orad){\n        var pos = new Array(), nor = new Array(),\n            col = new Array(), idx = new Array();\n        for(var i = 0; i <= row; i++){\n            var r = Math.PI * 2 / row * i;\n            var rr = Math.cos(r);\n            var ry = Math.sin(r);\n            for(var ii = 0; ii <= column; ii++){\n                var tr = Math.PI * 2 / column * ii;\n                var tx = (rr * irad + orad) * Math.cos(tr);\n                var ty = ry * irad;\n                var tz = (rr * irad + orad) * Math.sin(tr);\n                var rx = rr * Math.cos(tr);\n                var rz = rr * Math.sin(tr);\n                pos.push(tx, ty, tz);\n                nor.push(rx, ry, rz);\n                var tc = hsva(360 / column * ii, 1, 1, 1);\n                col.push(tc[0], tc[1], tc[2], tc[3]);\n            }\n        }\n        for(i = 0; i < row; i++){\n            for(ii = 0; ii < column; ii++){\n                r = (column + 1) * i + ii;\n                idx.push(r, r + column + 1, r + 1);\n                idx.push(r + column + 1, r + column + 2, r + 1);\n            }\n        }\n        return [pos, nor, col, idx];\n    }\n    \n    // HSV\u30ab\u30e9\u30fc\u53d6\u5f97\u7528\u95a2\u6570\n    function hsva(h, s, v, a){\n        if(s > 1 || v > 1 || a > 1){return;}\n        var th = h % 360;\n        var i = Math.floor(th / 60);\n        var f = th / 60 - i;\n        var m = v * (1 - s);\n        var n = v * (1 - s * f);\n        var k = v * (1 - s * (1 - f));\n        var color = new Array();\n        if(!s > 0 && !s < 0){\n            color.push(v, v, v, a); \n        } else {\n            var r = new Array(v, n, m, m, k, v);\n            var g = new Array(k, v, v, n, m, m);\n            var b = new Array(m, m, k, v, v, n);\n            color.push(r[i], g[i], b[i], a);\n        }\n        return color;\n    }\n    \n};\n```\n\n\n\n\n", "tags": ["GLSL", "WebGL"]}