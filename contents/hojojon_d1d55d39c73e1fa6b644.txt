{"context": " More than 1 year has passed since last update.Espresso\u3068Spoon\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3001Android\u30a2\u30d7\u30ea\u306eUI\u30c6\u30b9\u30c8\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u306a\u304a\u304b\u3064\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u7c21\u5358\u306b\u64ae\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u305d\u306e\u4e00\u65b9\u3067\u3001\u300c\u8907\u6570\u306eActivity\u306b\u9077\u79fb\u3059\u308b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u306e\u6642\u3001\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u5404Activity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308c\u3070\u3044\u3044\u3093\u3060\u308d\u3046\u300d\u3001\u300c\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u3093\u3060\u308d\u3046\u300d\u3068\u3044\u3063\u305f\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u3088\u3046\u306a\u554f\u984c\u306b\u5bfe\u3057\u3066\u53d6\u3063\u305f\u5bfe\u51e6\u6cd5\u3092\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\n1.\u306f\u3058\u3081\u306b\n\n-1.1 Espresso\u3068\u306f\nEspresso\u3068\u306f\u3001Google\u304c2013\u5e74\u306b\u516c\u958b\u3057\u305fAndroid\u7528\u306eUI\u30c6\u30b9\u30c6\u30a3\u30f3\u30b0\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002\nEspresso 2.0\u304b\u3089\u306f\u300cAndroid Support Library\u300d\u306e\u4e00\u90e8\u3068\u3057\u3066\u53d6\u308a\u8fbc\u307e\u308c\u3066\u304a\u308a\u3001\u300cSDK Manager\u300d\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u7c21\u5358\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nEspresso\u306e\u826f\u3044\u70b9\u3068\u3057\u3066\u306f\u3001\u300cAndroid Suport library\u300d\u306e\u4e00\u90e8\u3068\u3057\u3066\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u6bd4\u8f03\u7684\u5b89\u5fc3\u3057\u3066\u4f7f\u3044\u7d9a\u3051\u3089\u308c\u305d\u3046\u306a\u3053\u3068\u3001\u7c21\u6f54\u3067\u4fe1\u983c\u6027\u306e\u3042\u308bUI\u30c6\u30b9\u30c8\u304c\u7d20\u65e9\u304f\u66f8\u3051\u308b\u3053\u3068\u3001\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u306e\u53cd\u9762\u3001Espresso\u81ea\u4f53\u306b\u306f\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u6a5f\u80fd\u304c\u306a\u3044\u305f\u3081\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3001\u3068\u3044\u3063\u305f\u6b8b\u5ff5\u306a\u70b9\u3082\u3042\u308a\u307e\u3059\u3002\n\n-1.2 Spoon\u3068\u306f\n\u305d\u3053\u3067Spoon\u306e\u51fa\u756a\u3067\u3059\u3002Spoon\u3068\u306f\u3001\u8907\u6570\u306eAndroid\u7aef\u672b\u4e0a\u3067\u540c\u6642\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3001HTML\u5f62\u5f0f\u3067\u5404\u7aef\u672b\u3054\u3068\u306e\u30c6\u30b9\u30c8\u7d50\u679c\u3092\u51fa\u529b\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u3055\u3089\u306b\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u6a5f\u80fd\u3082\u5099\u308f\u3063\u3066\u304a\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3044Activity\u3092\u6307\u5b9a\u3057\u3066\u3001\u7c21\u5358\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\nSpoon.screenshot(activity, \"initial_state\");\n\n\n-1.3 \u4f7f\u7528\u30d0\u30fc\u30b8\u30e7\u30f3\n\u672c\u8a18\u4e8b\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\nEspresso 2.1\nSpoon v1.2.1\n\n\n2.\u56f0\u3063\u305f\u3053\u3068\nEspresso\u3068Spoon\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u7c21\u6f54\u306bUI\u30c6\u30b9\u30c8\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u306a\u304a\u304b\u3064Activity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u7c21\u5358\u306b\u64ae\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u56f0\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n-2.1 \u8907\u6570\u306eActivity\u306b\u9077\u79fb\u3059\u308b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u3060\u3068\u3001\u305d\u308c\u305e\u308c\u306eActivity\u6bce\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u306a\u3044\nEspresso 2.1\u304b\u3089\u306fActivityTestRule\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u4ee5\u4e0b\u306e\u4f8b\u306e\u3088\u3046\u306bgetActivity()\u3067\u30c6\u30b9\u30c8\u5bfe\u8c61\u306eActivity\u3092\u53d6\u5f97\u3057\u3001\u5358\u4e00\u306eActivity\u306e\u30c6\u30b9\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001Activity\u306e\u9077\u79fb\u3092\u884c\u3063\u305f\u5834\u5408\u3001getActivity()\u3067\u306f\u9077\u79fb\u5f8c\u306eActivity\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001Spoon\u3067\u9077\u79fb\u5f8c\u306eActivity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\u9077\u79fb\u5f8c\u306eActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308bgetCurrentActivity()\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n@RunWith(AndroidJUnit4.class)\npublic class MainActivityTest {\n\n    private Activity mActivity;\n\n    @Rule\n    public ActivityTestRule<MainActivity> mActivityRule =\n            new ActivityTestRule<MainActivity>(MainActivity.class);\n\n    @Before\n    public void setUp() {\n        // \u30c6\u30b9\u30c8\u5bfe\u8c61\u306eActivity\u3092\u53d6\u5f97\u3059\u308b\n        mActivity = mActivityRule.getActivity();\n    }\n\n    @Test\n    public void loginShouldSuccessful() {\n\n        // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\n        Spoon.screenshot(mActivity, \"before_login\");\n\n        // \u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3057\u3066Activityn\u3092\u9077\u79fb\u3092\u884c\u3046\n        onView(ViewMatchers.withId(R.id.btnLogin)).perform(click());\n\n        // \u9077\u79fb\u5f8c\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3044\u304c\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\n        Spoon.screenshot(mActivityRule.getActivity(), \"after_login\");       \n    }\n\n}\n\n\n-2.2 \u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u306a\u3044\nActivity\u4e0a\u306b\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u306e\u6642\u306bSpoon\u3067\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97\u3092\u884c\u3046\u3068\u3001\u53d6\u5f97\u7d50\u679c\u306e\u753b\u50cf\u306b\u306f\u30c0\u30a4\u30a2\u30ed\u30b0\u306f\u8868\u793a\u3055\u308c\u305a\u3001Activity\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n3.\u5bfe\u51e6\u6cd5\n\n-3.1 getCurrentActivity()\u3092\u4f5c\u6210\u3059\u308b\n\u3044\u304f\u3064\u304b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u3044\u3066\u3001\u73fe\u5728\u8868\u793a\u3055\u308c\u3066\u3044\u308bActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308bgetCurerntActivity()\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n    Activity getCurrentActivity() throws Throwable {\n        InstrumentationRegistry.getInstrumentation().waitForIdleSync();\n        final Activity[] activity = new Activity[1];\n        InstrumentationRegistry.getInstrumentation().runOnMainSync(new Runnable() {\n            @Override\n            public void run() {\n                java.util.Collection activities = ActivityLifecycleMonitorRegistry.getInstance().getActivitiesInStage(Stage.RESUMED);\n                activity[0] = (Activity) Iterables.getOnlyElement(activities);\n            }\n        });\n        return activity[0];\n    }\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u9077\u79fb\u5f8c\u306eActivity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n        // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\n        Spoon.screenshot(mActivity, \"before_login\");\n\n        // \u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3057\u3066Activity\u3092\u9077\u79fb\u3092\u884c\u3046\n        onView(ViewMatchers.withId(R.id.btnLogin)).perform(click());\n\n        // \u9077\u79fb\u5f8c\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3059\u308b\n        Spoon.screenshot(getCurrentActivity(), \"after_login\");  \n\n\n-3.2 \u30c0\u30a4\u30a2\u30ed\u30b0\u7528\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3059\u308b\nSpoon\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u306eIssues\u3067\u3001\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u3044\u3066\u304f\u308c\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002\n\u5225\u306e\u30c6\u30b9\u30c6\u30a3\u30f3\u30b0\u30d5\u30ec\u30fc\u30a6\u30ef\u30fc\u30af\u3067\u3042\u308bRobotium\u3060\u3068\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u554f\u984c\u306a\u304f\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3001\u305d\u306e\u30b3\u30fc\u30c9\u3092\u6d41\u7528\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u4fdd\u5b58\u5148\u3082Spoon\u6a19\u6e96\u306e\u4fdd\u5b58\u5148\u306b\u5909\u66f4\u3057\u3066\u304a\u308a\u3001Spoon\u306e\u30c6\u30b9\u30c8\u30ec\u30dd\u30fc\u30c8HTML\u306b\u3082\u554f\u984c\u306a\u304f\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u203b \u4e00\u90e8\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u554f\u984c\u304c\u3042\u308b\u3088\u3046\u3067\u3001KitKat\u4ee5\u964d\u306eOS\u3060\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u306e\u90e8\u5206\u306b\u95a2\u3057\u3066\u306f\u3001Robotiumn\u306e\u65b9\u306e\u30bd\u30fc\u30b9\u3092\u53c2\u8003\u306b\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\u3068\u6b63\u5e38\u306b\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n    public View[] getWindowDecorViews()\n    {\n\n        Field viewsField;\n        Field instanceField;\n        try {\n            viewsField = windowManager.getDeclaredField(\"mViews\");\n            instanceField = windowManager.getDeclaredField(windowManagerString);\n            viewsField.setAccessible(true);\n            instanceField.setAccessible(true);\n            Object instance = instanceField.get(null);\n\n            //return (View[]) viewsField.get(instance);\n            View[] result;\n            if (android.os.Build.VERSION.SDK_INT >= 19) {\n                result = ((ArrayList<View>) viewsField.get(instance)).toArray(new View[0]);\n            } else {\n                result = (View[]) viewsField.get(instance);\n            }\n\n            return result;\n        } catch (SecurityException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        } catch (IllegalArgumentException e) {\n            e.printStackTrace();\n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n\n\nEspresso\u3068Spoon\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3001Android\u30a2\u30d7\u30ea\u306eUI\u30c6\u30b9\u30c8\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u306a\u304a\u304b\u3064\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u7c21\u5358\u306b\u64ae\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\u305d\u306e\u4e00\u65b9\u3067\u3001\u300c\u8907\u6570\u306eActivity\u306b\u9077\u79fb\u3059\u308b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u306e\u6642\u3001\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u5404Activity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308c\u3070\u3044\u3044\u3093\u3060\u308d\u3046\u300d\u3001\u300c\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u3044\u3044\u3093\u3060\u308d\u3046\u300d\u3068\u3044\u3063\u305f\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001\u305d\u306e\u3088\u3046\u306a\u554f\u984c\u306b\u5bfe\u3057\u3066\u53d6\u3063\u305f\u5bfe\u51e6\u6cd5\u3092\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\n#1.\u306f\u3058\u3081\u306b\n\n## -1.1 Espresso\u3068\u306f\nEspresso\u3068\u306f\u3001Google\u304c2013\u5e74\u306b\u516c\u958b\u3057\u305fAndroid\u7528\u306eUI\u30c6\u30b9\u30c6\u30a3\u30f3\u30b0\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002\nEspresso 2.0\u304b\u3089\u306f\u300cAndroid Support Library\u300d\u306e\u4e00\u90e8\u3068\u3057\u3066\u53d6\u308a\u8fbc\u307e\u308c\u3066\u304a\u308a\u3001\u300cSDK Manager\u300d\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u7c21\u5358\u306b\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nEspresso\u306e\u826f\u3044\u70b9\u3068\u3057\u3066\u306f\u3001\u300cAndroid Suport library\u300d\u306e\u4e00\u90e8\u3068\u3057\u3066\u542b\u307e\u308c\u3066\u3044\u308b\u305f\u3081\u6bd4\u8f03\u7684\u5b89\u5fc3\u3057\u3066\u4f7f\u3044\u7d9a\u3051\u3089\u308c\u305d\u3046\u306a\u3053\u3068\u3001\u7c21\u6f54\u3067\u4fe1\u983c\u6027\u306e\u3042\u308bUI\u30c6\u30b9\u30c8\u304c\u7d20\u65e9\u304f\u66f8\u3051\u308b\u3053\u3068\u3001\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u306e\u53cd\u9762\u3001Espresso\u81ea\u4f53\u306b\u306f\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u6a5f\u80fd\u304c\u306a\u3044\u305f\u3081\u81ea\u5206\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3001\u3068\u3044\u3063\u305f\u6b8b\u5ff5\u306a\u70b9\u3082\u3042\u308a\u307e\u3059\u3002\n\n## -1.2 Spoon\u3068\u306f\n\u305d\u3053\u3067[Spoon](http://square.github.io/spoon/)\u306e\u51fa\u756a\u3067\u3059\u3002Spoon\u3068\u306f\u3001\u8907\u6570\u306eAndroid\u7aef\u672b\u4e0a\u3067\u540c\u6642\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u3001HTML\u5f62\u5f0f\u3067\u5404\u7aef\u672b\u3054\u3068\u306e\u30c6\u30b9\u30c8\u7d50\u679c\u3092\u51fa\u529b\u3057\u3066\u304f\u308c\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u3055\u3089\u306b\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u6a5f\u80fd\u3082\u5099\u308f\u3063\u3066\u304a\u308a\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3044Activity\u3092\u6307\u5b9a\u3057\u3066\u3001\u7c21\u5358\u306b\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n``` \nSpoon.screenshot(activity, \"initial_state\");\n```\n\n## -1.3 \u4f7f\u7528\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u672c\u8a18\u4e8b\u3067\u306f\u3001\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n* Espresso 2.1\n* Spoon v1.2.1\n\n#2.\u56f0\u3063\u305f\u3053\u3068\n\nEspresso\u3068Spoon\u3092\u7d44\u307f\u5408\u308f\u305b\u308c\u3070\u3001\u7c21\u6f54\u306bUI\u30c6\u30b9\u30c8\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3001\u306a\u304a\u304b\u3064Activity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u7c21\u5358\u306b\u64ae\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u56f0\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n## -2.1 \u8907\u6570\u306eActivity\u306b\u9077\u79fb\u3059\u308b\u3088\u3046\u306a\u30c6\u30b9\u30c8\u3060\u3068\u3001\u305d\u308c\u305e\u308c\u306eActivity\u6bce\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u306a\u3044\n\nEspresso 2.1\u304b\u3089\u306fActivityTestRule\u304c\u8ffd\u52a0\u3055\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u4ee5\u4e0b\u306e\u4f8b\u306e\u3088\u3046\u306b`getActivity()`\u3067\u30c6\u30b9\u30c8\u5bfe\u8c61\u306eActivity\u3092\u53d6\u5f97\u3057\u3001\u5358\u4e00\u306eActivity\u306e\u30c6\u30b9\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001Activity\u306e\u9077\u79fb\u3092\u884c\u3063\u305f\u5834\u5408\u3001`getActivity()`\u3067\u306f\u9077\u79fb\u5f8c\u306eActivity\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001Spoon\u3067\u9077\u79fb\u5f8c\u306eActivity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u64ae\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\u9077\u79fb\u5f8c\u306eActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308b`getCurrentActivity()`\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n``` java\n@RunWith(AndroidJUnit4.class)\npublic class MainActivityTest {\n\n    private Activity mActivity;\n\n    @Rule\n    public ActivityTestRule<MainActivity> mActivityRule =\n            new ActivityTestRule<MainActivity>(MainActivity.class);\n\n    @Before\n    public void setUp() {\n        // \u30c6\u30b9\u30c8\u5bfe\u8c61\u306eActivity\u3092\u53d6\u5f97\u3059\u308b\n        mActivity = mActivityRule.getActivity();\n    }\n\n    @Test\n    public void loginShouldSuccessful() {\n\n        // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\n        Spoon.screenshot(mActivity, \"before_login\");\n\n        // \u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3057\u3066Activityn\u3092\u9077\u79fb\u3092\u884c\u3046\n        onView(ViewMatchers.withId(R.id.btnLogin)).perform(click());\n\n        // \u9077\u79fb\u5f8c\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3044\u304c\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\n        Spoon.screenshot(mActivityRule.getActivity(), \"after_login\");       \n    }\n\n}\n```\n\n## -2.2 \u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u306a\u3044\n\nActivity\u4e0a\u306b\u30c0\u30a4\u30a2\u30ed\u30b0\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u72b6\u614b\u306e\u6642\u306bSpoon\u3067\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97\u3092\u884c\u3046\u3068\u3001\u53d6\u5f97\u7d50\u679c\u306e\u753b\u50cf\u306b\u306f\u30c0\u30a4\u30a2\u30ed\u30b0\u306f\u8868\u793a\u3055\u308c\u305a\u3001Activity\u306e\u307f\u304c\u8868\u793a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n#3.\u5bfe\u51e6\u6cd5\n\n## -3.1 getCurrentActivity()\u3092\u4f5c\u6210\u3059\u308b\n\n\u3044\u304f\u3064\u304b\u306e[\u30b5\u30a4\u30c8](http://codingid.blogspot.jp/2014/10/spoon-screenshot-current-activity-and.html)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u3044\u3066\u3001\u73fe\u5728\u8868\u793a\u3055\u308c\u3066\u3044\u308bActivity\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3067\u304d\u308bgetCurerntActivity()\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n``` java\n    Activity getCurrentActivity() throws Throwable {\n        InstrumentationRegistry.getInstrumentation().waitForIdleSync();\n        final Activity[] activity = new Activity[1];\n        InstrumentationRegistry.getInstrumentation().runOnMainSync(new Runnable() {\n            @Override\n            public void run() {\n                java.util.Collection activities = ActivityLifecycleMonitorRegistry.getInstance().getActivitiesInStage(Stage.RESUMED);\n                activity[0] = (Activity) Iterables.getOnlyElement(activities);\n            }\n        });\n        return activity[0];\n    }\n```\n\n\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u9077\u79fb\u5f8c\u306eActivity\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u64ae\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n``` \n        // \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\n        Spoon.screenshot(mActivity, \"before_login\");\n\n        // \u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u3057\u3066Activity\u3092\u9077\u79fb\u3092\u884c\u3046\n        onView(ViewMatchers.withId(R.id.btnLogin)).perform(click());\n\n        // \u9077\u79fb\u5f8c\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u53d6\u5f97\u3059\u308b\n        Spoon.screenshot(getCurrentActivity(), \"after_login\");  \n```\n\n## -3.2 \u30c0\u30a4\u30a2\u30ed\u30b0\u7528\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3059\u308b\n\nSpoon\u306eGitHub\u30ea\u30dd\u30b8\u30c8\u30ea\u306e[Issues](https://github.com/square/spoon/issues/4)\u3067\u3001\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u53d6\u5f97\u7528\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u66f8\u3044\u3066\u304f\u308c\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002\n\u5225\u306e\u30c6\u30b9\u30c6\u30a3\u30f3\u30b0\u30d5\u30ec\u30fc\u30a6\u30ef\u30fc\u30af\u3067\u3042\u308bRobotium\u3060\u3068\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3082\u554f\u984c\u306a\u304f\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u3067\u3001\u305d\u306e\u30b3\u30fc\u30c9\u3092\u6d41\u7528\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u306e\u4fdd\u5b58\u5148\u3082Spoon\u6a19\u6e96\u306e\u4fdd\u5b58\u5148\u306b\u5909\u66f4\u3057\u3066\u304a\u308a\u3001Spoon\u306e\u30c6\u30b9\u30c8\u30ec\u30dd\u30fc\u30c8HTML\u306b\u3082\u554f\u984c\u306a\u304f\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u203b \u4e00\u90e8\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u554f\u984c\u304c\u3042\u308b\u3088\u3046\u3067\u3001KitKat\u4ee5\u964d\u306eOS\u3060\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u306e\u90e8\u5206\u306b\u95a2\u3057\u3066\u306f\u3001Robotiumn\u306e\u65b9\u306e\u30bd\u30fc\u30b9\u3092\u53c2\u8003\u306b\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4fee\u6b63\u3059\u308b\u3068\u6b63\u5e38\u306b\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\n    public View[] getWindowDecorViews()\n    {\n\n        Field viewsField;\n        Field instanceField;\n        try {\n            viewsField = windowManager.getDeclaredField(\"mViews\");\n            instanceField = windowManager.getDeclaredField(windowManagerString);\n            viewsField.setAccessible(true);\n            instanceField.setAccessible(true);\n            Object instance = instanceField.get(null);\n           \n            //return (View[]) viewsField.get(instance);\n            View[] result;\n            if (android.os.Build.VERSION.SDK_INT >= 19) {\n                result = ((ArrayList<View>) viewsField.get(instance)).toArray(new View[0]);\n            } else {\n                result = (View[]) viewsField.get(instance);\n            }\n            \n            return result;\n        } catch (SecurityException e) {\n            e.printStackTrace();\n        } catch (NoSuchFieldException e) {\n            e.printStackTrace();\n        } catch (IllegalArgumentException e) {\n            e.printStackTrace();\n        } catch (IllegalAccessException e) {\n            e.printStackTrace();\n        }\n        return null;\n    }\n```\n\n\n\n", "tags": ["Android", "Spoon", "Espresso"]}