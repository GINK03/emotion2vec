{"context": "\n\n\u306f\u3058\u3081\u306b\n\u4eca\u5f8c\u306f\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u306e\u6642\u4ee3\u304c\u304f\u308b\u306f\u305a\u3067\u3059\u3002\u305f\u3076\u3093\u3002\u305d\u3093\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u9069\u5f53\u306a\u30c7\u30fc\u30bf\u767a\u751f\u3092\u767a\u751f\u3055\u305b\u3066\u3001Kinesis Streams\uff0bSpark streaming\u3067\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u3092\u4f53\u9a13\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nSpark 2.0.0 (EMR\u3092\u5229\u7528\uff09\n\nKinesis Streams\u3068\u306f\n\u6614\u306f\u5358\u306bKinesis\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5f8c\u304b\u3089Kinesis Firehose\u3068Kinesis Analytics\u304c\u8ffd\u52a0\u3055\u308c\u305f\u305f\u3081\u3001Kinesis\uff13\u5144\u5f1f\u306e\u3046\u3061\u306e\uff11\u4eba\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3059\u3002\n\u5927\u898f\u6a21\u3067\u30b9\u30b1\u30fc\u30eb\u53ef\u80fd\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u4e00\u5b9a\u6642\u9593\u4fdd\u5b58\u3055\u308c\u308bPubSub\u578b\u30ad\u30e5\u30fc\u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\nhttps://aws.amazon.com/jp/kinesis/streams/\n\u3064\u307e\u308a\u3001\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308bProducer\u76f8\u5f53\u3068\u3001\u5f8c\u6bb5\u306e\u51e6\u7406\u3067\u3042\u308bConsumer\u76f8\u5f53\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nhttps://docs.aws.amazon.com/ja_jp/streams/latest/dev/key-concepts.html\n\nSpark Streaming\u3068\u306f\n\u5927\u898f\u6a21\u30c7\u30fc\u30bf\u5206\u6563\u51e6\u7406\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306eApache spark\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4e00\u3064\u3067\u3001\u5c11\u3057\u306e\u30b3\u30fc\u30c9\u5909\u66f4\u3067\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u51e6\u7406\u304c\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\nhttp://spark.apache.org/streaming/\n\u4eca\u56deSpark\u74b0\u5883\u306fAmazon EMR\uff08\u30de\u30cd\u30fc\u30b8\u30c9Hadoop\u3001Hadoop\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3082\u4f7f\u3048\u308b\uff09\u3067\u7528\u610f\u3057\u307e\u3059\u3002\nhttps://aws.amazon.com/jp/emr/\n\n\u6e96\u5099\n\nKinesis streams\u306e\u6e96\u5099\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Kinesis streams\u306e\u30da\u30fc\u30b8\u306b\u884c\u304d\u307e\u3059\u3002\n\n\u30b9\u30c8\u30ea\u30fc\u30e0\u540d\n\u30b7\u30e3\u30fc\u30c9\u6570\n\n\u3092\u6c7a\u3081\u308b\u3060\u3051\u3067\u3059\u3002\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u7b49\u306b\u5fdc\u3058\u3066\u6c7a\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3053\u3067\u306f\u9069\u5f53\u306b2\u306b\u3057\u307e\u3059\u3002\n\n\nEMR\u306e\u6e96\u5099\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EMR\u306e\u30da\u30fc\u30b8\u306b\u884c\u304d\u307e\u3059\u3002\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u304b\u3089\u8a73\u7d30\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\nSpark\u306b\u5fc5\u305a\u30c1\u30a7\u30c3\u30af\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\u3042\u3068\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30de\u30b9\u30bf\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSSH\u30dd\u30fc\u30c8\u304c\u7a7a\u3044\u3066\u3044\u306a\u3044\u306e\u3067\u4ed6\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\nEC2\n\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u7528\u306bEC2\u3082\uff11\u53f0\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002boto\u304c\u4f7f\u3048\u308c\u3070\u306a\u3093\u3067\u3082\u3088\u3044\u3067\u3059\u3002\n\n\u30c7\u30fc\u30bf\u4f5c\u6210(producer)\n\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u8272\u3005\u306a\u8a00\u8a9e\u3067\u8a18\u8ff0\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306fPython\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nput.py\n#!/usr/bin/python\n# -*- coding: utf-8 -*-\n\nimport boto.kinesis,datetime,time,random\n\nconnection = boto.kinesis.connect_to_region('ap-northeast-1')\nstream_name = 'stream-test'\n\npartition_key = str(time.time()) + str(random.random())\nsource_str = 'abcdefghijklmnopqrstuvwxyz'\n\nfor loop in range(10):\n    for i in range(10):\n        sampledata=str(i)+\",\"+random.choice(source_str)\n        put_data = connection.put_record(stream_name,sampledata,partition_key)\n    time.sleep(10)\n\n\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u3068\u3057\u3066\u306f\u3001\n\nKinesis\u63a5\u7d9a\u306e\u6e96\u5099\n\u6570\u5024\u304a\u3088\u3073\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u306e\u30e9\u30f3\u30c0\u30e0\u6587\u5b57\u5217\u309210\u56de\u767a\u751f\u3055\u305b\u308b\nKinesis streams\u306bPut\u3059\u308b\n10\u79d2\u9593\u9694\u30672-4\u309210\u56de\u3084\u308b\n\n\u3067\u3059\u3002\npartition_key\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u305f\u3082\u306e\u3092\u3082\u3061\u3044\u3066\u30b7\u30e3\u30fc\u30c9\u306e\u632f\u308a\u5206\u3051\u304c\u884c\u308f\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\u306a\u306e\u3067\u3042\u308b\u7a0b\u5ea6\u30e9\u30f3\u30c0\u30e0\u306b\u306a\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u51e6\u7406\uff08Consumer\uff09\nKinesis streams\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u4f55\u3089\u304b\u306e\u51e6\u7406\u3092\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\nget.py\nfrom __future__ import print_function\nimport sys\nfrom pyspark import SparkContext\nfrom pyspark.streaming import StreamingContext\nfrom pyspark.streaming.kinesis import KinesisUtils, InitialPositionInStream\n\nif __name__ == \"__main__\":\n\n    sc = SparkContext()\n    ssc = StreamingContext(sc, 5)\n    appName=\"stream-app\"\n    streamName=\"stream-test\"\n    endpointUrl=\"https://kinesis.ap-northeast-1.amazonaws.com\"\n    regionName=\"ap-northeast-1\"\n\n    lines = KinesisUtils.createStream(\n        ssc, appName, streamName, endpointUrl, regionName, InitialPositionInStream.LATEST, 1)\n\n    lines.pprint()\n    ssc.start()\n    ssc.awaitTermination()\n\n\nSpark\u306e\u4e2d\u306bKinesis strams\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u307e\u305aSpark\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u5165\u308a\u53e3\u3068\u3082\u3044\u3048\u308bSparkContext\u3068Streaming\u3067\u3064\u304b\u3046\u305f\u3081\u306eStreamingContext\u3092\u7528\u610f\u3057\u307e\u3059\u3002\nStreamingContext\u306fWindows\u5358\u4f4d\u3067\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306f\uff15\u79d2\u304a\u304d\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n    sc = SparkContext()\n    ssc = StreamingContext(sc, 5)\n\nStreams\u3092\u4f5c\u308a\u307e\u3059\u3002appname\u306f\u306a\u3093\u3067\u3082\u3088\u3044\u306e\u3067stream-app\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n    appName=\"stream-app\"\n    streamName=\"stream-test\"\n    endpointUrl=\"https://kinesis.ap-northeast-1.amazonaws.com\"\n    regionName=\"ap-northeast-1\"\n    lines = KinesisUtils.createStream(\n        ssc, appName, streamName, endpointUrl, regionName, InitialPositionInStream.LATEST, 1)\n\n\u8868\u793a\u3057\u307e\u3059\u3002\n    lines.pprint()\n\nStream\u51e6\u7406\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n    ssc.start()\n    ssc.awaitTermination()\n\n\n\u5b9f\u884c\nEMR\u3067Spark\u306e\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u6642JAR\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nspark-submit --jars /usr/lib/spark/external/lib/spark-streaming-kinesis-asl-assembly_*.jar ./get.py\n\nEC2\u3067\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u307e\u3059\u3002\npython put.py\n\n\u5c11\u3057\u5f85\u3064\u3068Consumer\u5074\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n-------------------------------------------\nTime: 2016-11-03 01:38:00\n-------------------------------------------\n0,c\n1,e\n2,x\n3,w\n4,g\n5,h\n6,t\n7,q\n8,c\n9,o\n\n\u884c\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u3044\u5834\u5408\u306f\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n    counts=lines.count()\n    counts.pprint()\n\n\u3053\u308c\u3067\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u3064\u304b\u3081\u305f\u304b\u306a\u3001\u3068\u601d\u3044\u307e\u3059\u3002\n\u6027\u80fd\u7b49\u306b\u3064\u3044\u3066\u306f\u4f55\u3082\u8003\u3048\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8981\u691c\u8a0e\u3067\u3059\u3002\n## \u306f\u3058\u3081\u306b\n\n\u4eca\u5f8c\u306f\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u306e\u6642\u4ee3\u304c\u304f\u308b\u306f\u305a\u3067\u3059\u3002\u305f\u3076\u3093\u3002\u305d\u3093\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u9069\u5f53\u306a\u30c7\u30fc\u30bf\u767a\u751f\u3092\u767a\u751f\u3055\u305b\u3066\u3001Kinesis Streams\uff0bSpark streaming\u3067\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u3092\u4f53\u9a13\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nSpark 2.0.0 (EMR\u3092\u5229\u7528\uff09\n\n### Kinesis Streams\u3068\u306f\n\n\u6614\u306f\u5358\u306bKinesis\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u5f8c\u304b\u3089Kinesis Firehose\u3068Kinesis Analytics\u304c\u8ffd\u52a0\u3055\u308c\u305f\u305f\u3081\u3001Kinesis\uff13\u5144\u5f1f\u306e\u3046\u3061\u306e\uff11\u4eba\u3068\u547c\u3070\u308c\u3066\u3044\u307e\u3059\u3002\n\u5927\u898f\u6a21\u3067\u30b9\u30b1\u30fc\u30eb\u53ef\u80fd\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u4e00\u5b9a\u6642\u9593\u4fdd\u5b58\u3055\u308c\u308bPubSub\u578b\u30ad\u30e5\u30fc\u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\n\nhttps://aws.amazon.com/jp/kinesis/streams/\n\n\u3064\u307e\u308a\u3001\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308bProducer\u76f8\u5f53\u3068\u3001\u5f8c\u6bb5\u306e\u51e6\u7406\u3067\u3042\u308bConsumer\u76f8\u5f53\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nhttps://docs.aws.amazon.com/ja_jp/streams/latest/dev/key-concepts.html\n\n\n### Spark Streaming\u3068\u306f\n\u5927\u898f\u6a21\u30c7\u30fc\u30bf\u5206\u6563\u51e6\u7406\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306eApache spark\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4e00\u3064\u3067\u3001\u5c11\u3057\u306e\u30b3\u30fc\u30c9\u5909\u66f4\u3067\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u51e6\u7406\u304c\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002\n\nhttp://spark.apache.org/streaming/\n\n\u4eca\u56deSpark\u74b0\u5883\u306fAmazon EMR\uff08\u30de\u30cd\u30fc\u30b8\u30c9Hadoop\u3001Hadoop\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3082\u4f7f\u3048\u308b\uff09\u3067\u7528\u610f\u3057\u307e\u3059\u3002\nhttps://aws.amazon.com/jp/emr/\n\n## \u6e96\u5099\n### Kinesis streams\u306e\u6e96\u5099\n\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Kinesis streams\u306e\u30da\u30fc\u30b8\u306b\u884c\u304d\u307e\u3059\u3002\n\n- \u30b9\u30c8\u30ea\u30fc\u30e0\u540d\n- \u30b7\u30e3\u30fc\u30c9\u6570\n\n\u3092\u6c7a\u3081\u308b\u3060\u3051\u3067\u3059\u3002\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u8981\u4ef6\u7b49\u306b\u5fdc\u3058\u3066\u6c7a\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3053\u3067\u306f\u9069\u5f53\u306b2\u306b\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-03 8.50.13.png](https://qiita-image-store.s3.amazonaws.com/0/69820/0b2a4ef4-16b6-33e7-7447-5969a91abd64.png)\n\n### EMR\u306e\u6e96\u5099\n\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EMR\u306e\u30da\u30fc\u30b8\u306b\u884c\u304d\u307e\u3059\u3002\n\u30b5\u30d6\u30cd\u30c3\u30c8\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u304b\u3089\u8a73\u7d30\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u79fb\u52d5\u3057\u307e\u3059\u3002\nSpark\u306b\u5fc5\u305a\u30c1\u30a7\u30c3\u30af\u3092\u3064\u3051\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u3042\u3068\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30de\u30b9\u30bf\u30fc\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSSH\u30dd\u30fc\u30c8\u304c\u7a7a\u3044\u3066\u3044\u306a\u3044\u306e\u3067\u4ed6\u306e\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-11-03 8.56.30.png](https://qiita-image-store.s3.amazonaws.com/0/69820/8849e0a6-6356-d63f-eb0d-6e4ee0fe593e.png)\n\n### EC2\n\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u7528\u306bEC2\u3082\uff11\u53f0\u6e96\u5099\u3057\u3066\u304a\u304d\u307e\u3059\u3002boto\u304c\u4f7f\u3048\u308c\u3070\u306a\u3093\u3067\u3082\u3088\u3044\u3067\u3059\u3002\n\n## \u30c7\u30fc\u30bf\u4f5c\u6210(producer)\n\n\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\u8272\u3005\u306a\u8a00\u8a9e\u3067\u8a18\u8ff0\u3067\u304d\u308b\u306e\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306fPython\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```put.py\n#!/usr/bin/python\n# -*- coding: utf-8 -*-\n\nimport boto.kinesis,datetime,time,random\n\nconnection = boto.kinesis.connect_to_region('ap-northeast-1')\nstream_name = 'stream-test'\n\npartition_key = str(time.time()) + str(random.random())\nsource_str = 'abcdefghijklmnopqrstuvwxyz'\n\nfor loop in range(10):\n    for i in range(10):\n        sampledata=str(i)+\",\"+random.choice(source_str)\n        put_data = connection.put_record(stream_name,sampledata,partition_key)\n    time.sleep(10)\n```\n\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u3068\u3057\u3066\u306f\u3001\n\n1. Kinesis\u63a5\u7d9a\u306e\u6e96\u5099\n2. \u6570\u5024\u304a\u3088\u3073\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u306e\u30e9\u30f3\u30c0\u30e0\u6587\u5b57\u5217\u309210\u56de\u767a\u751f\u3055\u305b\u308b\n3. Kinesis streams\u306bPut\u3059\u308b\n4. 10\u79d2\u9593\u9694\u30672-4\u309210\u56de\u3084\u308b\n\n\u3067\u3059\u3002\n\n`partition_key`\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u3092\u30cf\u30c3\u30b7\u30e5\u5316\u3057\u305f\u3082\u306e\u3092\u3082\u3061\u3044\u3066\u30b7\u30e3\u30fc\u30c9\u306e\u632f\u308a\u5206\u3051\u304c\u884c\u308f\u308c\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\u306a\u306e\u3067\u3042\u308b\u7a0b\u5ea6\u30e9\u30f3\u30c0\u30e0\u306b\u306a\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n## \u30c7\u30fc\u30bf\u51e6\u7406\uff08Consumer\uff09\n\nKinesis streams\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3001\u4f55\u3089\u304b\u306e\u51e6\u7406\u3092\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\n```get.py\nfrom __future__ import print_function\nimport sys\nfrom pyspark import SparkContext\nfrom pyspark.streaming import StreamingContext\nfrom pyspark.streaming.kinesis import KinesisUtils, InitialPositionInStream\n\nif __name__ == \"__main__\":\n\n    sc = SparkContext()\n    ssc = StreamingContext(sc, 5)\n    appName=\"stream-app\"\n    streamName=\"stream-test\"\n    endpointUrl=\"https://kinesis.ap-northeast-1.amazonaws.com\"\n    regionName=\"ap-northeast-1\"\n\n    lines = KinesisUtils.createStream(\n        ssc, appName, streamName, endpointUrl, regionName, InitialPositionInStream.LATEST, 1)\n\n    lines.pprint()\n    ssc.start()\n    ssc.awaitTermination()\n```\n\nSpark\u306e\u4e2d\u306bKinesis strams\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u305d\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u307e\u305aSpark\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u5165\u308a\u53e3\u3068\u3082\u3044\u3048\u308bSparkContext\u3068Streaming\u3067\u3064\u304b\u3046\u305f\u3081\u306eStreamingContext\u3092\u7528\u610f\u3057\u307e\u3059\u3002\nStreamingContext\u306fWindows\u5358\u4f4d\u3067\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u3001\u3053\u3053\u3067\u306f\uff15\u79d2\u304a\u304d\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n    sc = SparkContext()\n    ssc = StreamingContext(sc, 5)\n```\n\nStreams\u3092\u4f5c\u308a\u307e\u3059\u3002appname\u306f\u306a\u3093\u3067\u3082\u3088\u3044\u306e\u3067stream-app\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n    appName=\"stream-app\"\n    streamName=\"stream-test\"\n    endpointUrl=\"https://kinesis.ap-northeast-1.amazonaws.com\"\n    regionName=\"ap-northeast-1\"\n    lines = KinesisUtils.createStream(\n        ssc, appName, streamName, endpointUrl, regionName, InitialPositionInStream.LATEST, 1)\n```\n\n\u8868\u793a\u3057\u307e\u3059\u3002\n\n```\n    lines.pprint()\n```\n\nStream\u51e6\u7406\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n    ssc.start()\n    ssc.awaitTermination()\n```\n\n## \u5b9f\u884c\n\nEMR\u3067Spark\u306e\u30b8\u30e7\u30d6\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u6642JAR\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\nspark-submit --jars /usr/lib/spark/external/lib/spark-streaming-kinesis-asl-assembly_*.jar ./get.py\n```\n\n\nEC2\u3067\u30c7\u30fc\u30bf\u3092\u767a\u751f\u3055\u305b\u307e\u3059\u3002\n\n```\npython put.py\n```\n\n\u5c11\u3057\u5f85\u3064\u3068Consumer\u5074\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```\n-------------------------------------------\nTime: 2016-11-03 01:38:00\n-------------------------------------------\n0,c\n1,e\n2,x\n3,w\n4,g\n5,h\n6,t\n7,q\n8,c\n9,o\n```\n\n\u884c\u6570\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u305f\u3044\u5834\u5408\u306f\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n    counts=lines.count()\n    counts.pprint()\n```\n\n\u3053\u308c\u3067\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u3064\u304b\u3081\u305f\u304b\u306a\u3001\u3068\u601d\u3044\u307e\u3059\u3002\n\u6027\u80fd\u7b49\u306b\u3064\u3044\u3066\u306f\u4f55\u3082\u8003\u3048\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u8981\u691c\u8a0e\u3067\u3059\u3002\n\n\n\n\n\n\n\n", "tags": ["AWS", "Kinesis", "Spark", "\u3084\u3063\u3066\u307f\u305f", "EMR"]}