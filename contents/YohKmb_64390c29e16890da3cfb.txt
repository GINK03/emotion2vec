{"context": " More than 1 year has passed since last update.\n\n\u5e8f\u6587\nKMV\u74b0\u5883\u306b\u304a\u3044\u3066\u540c\u4e00\u30db\u30b9\u30c8\u4e0a\u306e\u306eVM\uff5eVM\u9593\u3001VM\uff5e\u30db\u30b9\u30c8Veth\u9593\u306e\u901a\u4fe1\u306b\u306f\u3001\u591a\u304f\u306e\u5834\u5408Linux-Bridge\u3084\nOpen vSwitch\u306a\u3069\u3001\u30d6\u30ea\u30c3\u30b8\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u591a\u304f\u306e\u5834\u5408\u306f\u3053\u306e\u3088\u3046\u306aBride\u7d4c\u7531\u306eVM\u63a5\u7d9a\u3067\u4f55\u3089\u652f\u969c\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u305f\u3060\u3001VM\u4e0a\u3067S/W\u4eee\u60f3\u30b9\u30a4\u30c3\u30c1\u3092\u7a3c\u50cd\u3055\u305b\u3066\u3001\u305d\u308c\u3092\u8907\u6570\u53f0\u306b\u76f8\u4e92\u63a5\u7d9a\u3001LLDP\u3084IGMP\u306e\u9001\u53d7\u4fe1\u3092\n\u3055\u305b\u305f\u3044\u3088\u3046\u306a\u5834\u5408\u3001\u9593\u306b\u30d6\u30ea\u30c3\u30b8\u30c7\u30d0\u30a4\u30b9\u304c\u4ecb\u5728\u3059\u308b\u4e8b\u304c\u969c\u5bb3\u3068\u306a\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u203b\u4eca\u56de\u8a66\u3057\u3066\u3044\u306a\u3044\u304c\u3001IPv6\u306eLink-Local\u30d5\u30ec\u30fc\u30e0\u3082\u540c\u69d8\u3067\u306f\uff1f\uff09\n\u3068\u304d\u306b\u3001\u79c1\u306fOpenFlow 1.3\u5bfe\u5fdc\u306e\u30b9\u30a4\u30c3\u30c1\u7fa4\u3067\u30c8\u30dd\u30ed\u30b8\u30a2\u30a6\u30a7\u30a2\u306a\u7d4c\u8def\u5236\u5fa1\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3068\n\u601d\u3044\u7acb\u3063\u3066\u304a\u308a\u307e\u3057\u305f\u3002\n\u305d\u3057\u3066\u3001\u3053\u306e\u5b9f\u88c5\u624b\u6bb5\u306e\u4e00\u3064\u306bLLDP\u306b\u3088\u308b\u30c8\u30dd\u30ed\u30b8\u691c\u77e5\u3092\u691c\u8a0e\u3057\u305f\u306e\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001\u53d6\u308a\u6025\u304eKVM\u9593\u3092\u5b89\u6613\u306bLinux-Bridge\u3067\u63a5\u7d9a\u3057\u305f\u3068\u3053\u308dLLDP\u306e\u6388\u53d7\u304c\u9069\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3053\u3046\u3057\u305f\u7d4c\u7def\u3067\u3001KVM\u9593\u306eLayer-2\u76f4\u7d50\uff08\u7269\u7406\u3067\u8a00\u3048\u3070\u3001\u6a5f\u5668\u9593\u306e\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u30b1\u30fc\u30d6\u30eb\u76f4\u7d50\uff09\u306e\u65b9\u6cd5\u3092\u6a21\u7d22\u3057\u3001\n\u305d\u306e\u6210\u529f\u7d50\u679c\u3092\u5171\u6709\u3057\u305f\u3044\u3068\u601d\u3063\u305f\u6b21\u7b2c\u3067\u3059\u3002\n\u624b\u9806\u3068\u3057\u3066\u306f\n\u3000\u30fb \u30db\u30b9\u30c8OS\u4e0a\u3067\u306eveth\u30da\u30a2\u306e\u4f5c\u6210\n\u3000\u30fb \u5404KVM\u306e\u30db\u30b9\u30c8\u5074tap\u30c7\u30d0\u30a4\u30b9\u3092\u3001\u4e0a\u8a18\u306eveth\u306e\u7247\u5074\u3078macvtap\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u63a5\u7d9a\n\u3000\u30fb veth\u30da\u30a2\u30c7\u30d0\u30a4\u30b9\u3001macvtap\u30c7\u30d0\u30a4\u30b9\u306e\u3059\u3079\u3066\u3092Uplink\u72b6\u614b\u3001Promiscuous\u8a31\u53ef\u306b\u8a2d\u5b9a\n\u3053\u306e\u6d41\u308c\u3067\u5b9f\u65bd\u3057\u3001\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u306a\u304a\u3001LLDP\u53d7\u4fe1\u306e\u78ba\u8a8d\u306b\u306fLADVD\u30d1\u30c3\u30b1\u30fc\u30b8\u306eLLDP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n\n\u624b\u9806\u306e\u89e3\u8aac\u306b\u5148\u7acb\u3063\u3066\u3001\u307e\u305aMacvtap\u30c7\u30d0\u30a4\u30b9\u306e\u6982\u8981\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\nMacvtap\u3068\u306f\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3068\u306f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u7a3c\u50cd\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u3066\u3001VM\u3068\u30db\u30b9\u30c8OS\u5916\u90e8\uff08\u30db\u30b9\u30c8OS\u306e\u30ab\u30fc\u30cd\u30eb\u4ee5\u5916\uff09\u3068\u306e\nLayer-2\u3067\u306e\u901a\u4fe1\u3092\u53ef\u80fd\u3068\u3059\u308b\u305f\u3081\u306b\u767b\u5834\u3057\u305f\u3001\u6bd4\u8f03\u7684\u65b0\u3057\u3044\u4eee\u60f3\u30c7\u30d0\u30a4\u30b9\u3067\u3059\u3002\n\u4e0a\u3067\u300c\u30db\u30b9\u30c8OS\u5916\u90e8\u300d\u306e\u8a00\u8449\u3067\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3082\u306e\u306f\u3001\n\u3000- \u30db\u30b9\u30c8OS\u306e\u7269\u7406\u30b5\u30fc\u30d0\u5916\u90e8\u306eNW\u6a5f\u5668\n\u3000- \u540c\u4e00\u306e\u30db\u30b9\u30c8OS\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u5225\u306eVM\u3084NW\u30b9\u30bf\u30c3\u30af\u5229\u7528\u306e\u30d7\u30ed\u30bb\u30b9\n\u306a\u3069\u3068\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u30c7\u30d0\u30a4\u30b9Type\u306f\u5148\u3093\u3058\u3066Linux\u30ab\u30fc\u30cd\u30eb\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305fMacvlan\u30c7\u30d0\u30a4\u30b9\u3068Tap\u30c7\u30d0\u30a4\u30b9\u306e2\u3064\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\n\u76ee\u7684\u306e\u52d5\u4f5c\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\nMacvlan\u30c7\u30d0\u30a4\u30b9\u306fLinux\u30ab\u30fc\u30cd\u30eb\u4e0a\u306e\u65e2\u5b58NW\u30c7\u30d0\u30a4\u30b9\u306b\u7570\u306a\u308bMAC\u30a2\u30c9\u30ec\u30b9\u3092\u6301\u3064\u3001\u65b0\u305f\u306aLayer-2\u30c7\u30d0\u30a4\u30b9\u3092\n\u8ffd\u52a0\u4f5c\u6210\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u3053\u306e\u65b0\u898f\u751f\u6210\u306e\u30c7\u30d0\u30a4\u30b9\u306f\u3001\u8ffd\u52a0\u5143\u306eNW\u30c7\u30d0\u30a4\u30b9\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001\u5916\u90e8\u306eNW\u3068\u306e\u901a\u4fe1\u3092\u884c\u3046\u4e8b\u304c\n\u3067\u304d\u308b\u306e\u3067\u3059\u3002\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3067\u306f\u3001\u3053\u306eMacvlan\u30c7\u30d0\u30a4\u30b9\u3092\u65e2\u5b58\u30c7\u30d0\u30a4\u30b9\u4e0a\u306b\u751f\u6210\u3057\u3001\u305d\u306e\u5916\u90e8\u3068\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u6b21\u3044\u3067Tap\u30c7\u30d0\u30a4\u30b9\u306e\u5229\u7528\u306b\u3064\u3044\u3066\u3082\u8aac\u660e\u3057\u307e\u3059\u3002\nTap\u30c7\u30d0\u30a4\u30b9\u306f\u3001\u30db\u30b9\u30c8OS\u306eLinux\u30ab\u30fc\u30cd\u30eb \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b9\u30bf\u30c3\u30af\u3068\u3001\u305d\u306eLinux\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u304c\nLayer-2\u30ec\u30d9\u30eb\u306eNW\u901a\u4fe1\u3092\u884c\u3046\u305f\u3081\u306b\u5229\u7528\u3059\u308b\u4eee\u60f3NW\u30c7\u30d0\u30a4\u30b9\u3067\u3059\u3002\n\u3059\u306a\u308f\u3061\u3001VM\u30b2\u30b9\u30c8\u304c\u81ea\u8eab\u306eNIC\u3078\u306eR/W\u3092\u884c\u3046\u3068\u3001\u305d\u306e\u5165\u51fa\u529bLayer-2\u30d5\u30ec\u30fc\u30e0\u306f\u5bfe\u5fdc\u3059\u308bTap\u30c7\u30d0\u30a4\u30b9\u3078\u306e\n\u5165\u51fa\u529b\u3068\u3057\u3066\u3001\u30db\u30b9\u30c8OS\u4e0a\u3067R/W\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3067\u306f\u3001\u30db\u30b9\u30c8OS\u4e0a\u306b\u751f\u6210\u3055\u308c\u308bTap\u30c7\u30d0\u30a4\u30b9\u3092Macvlan\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u65e2\u5b58NW\u30c7\u30d0\u30a4\u30b9\u306b\n\u30a2\u30bf\u30c3\u30c1\u3057\u3001\u30b2\u30b9\u30c8OS\u306e\u901a\u4fe1\u30d5\u30ec\u30fc\u30e0\u3092\u65e2\u5b58\u306eNW\u30c7\u30d0\u30a4\u30b9\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001\u5916\u90e8\u3068\u5165\u51fa\u529b\u3057\u307e\u3059\u3002\n\u53c2\u8003\uff1a\n\u3000http://seravo.fi/2012/virtualized-bridged-networking-with-macvtap\n\nMacvtap\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\nMacvtap \u30c7\u30d0\u30a4\u30b9\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u306f4 \u7a2e\u985e\u306e\u30e2\u30fc\u30c9\u304b\u3089\u6210\u3063\u3066\u3044\u307e\u3059\u3002\n\u660e\u793a\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u300cvepa\u300d\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30e2\u30fc\u30c9\u3068\u306a\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fLink-Local\u306aLayer-2\u30d5\u30ec\u30fc\u30e0\u3092KVM\u30b2\u30b9\u30c8\u9593\u3067\u9001\u53d7\u4fe1\u3059\u308b\u4e8b\u304c\u76ee\u7684\u306a\u306e\u3067\u3001Bridge\u30e2\u30fc\u30c9\u306f\u907f\u3051\u3001\nvepa\u30e2\u30fc\u30c9\u3067\u306e\u63a5\u7d9a\u3092\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\u4ed6\u306e\u30e2\u30fc\u30c9\u3084\u5404\u30e2\u30fc\u30c9\u306e\u4ed5\u69d8\u306b\u95a2\u3057\u3066\u306f\u3001\u4e0b\u306b\u53c2\u8003\u306eURL\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\u53c2\u8003\uff1a\n\u3000https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/6/html/Virtualization_Administration_Guide/sect-attch-nic-physdev.html\n\n\u6280\u8853\u7684\u306a\u624b\u9806\n\n\u30db\u30b9\u30c8OS\u3067\u306eVeth\u30da\u30a2\u4f5c\u6210\n\n\n\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ip lin add name veth0_a type veth peer name veth0_b\n\n[root@fedo21]# ip -d link sh dev veth0_a\n81: veth0_a: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000\n    link/ether de:db:ee:3d:55:ba brd ff:ff:ff:ff:ff:ff promiscuity 2 \n    veth \n[root@fedo21]# ip -d link sh dev veth0_b\n80: veth0_b: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000\n    link/ether b2:6e:02:a8:d4:e2 brd ff:ff:ff:ff:ff:ff promiscuity 2 \n    veth \n[root@fedo21]# ethtool -S veth0_a\nNIC statistics:\n     peer_ifindex: 80\n\n\n\nKVM\u306eNIC\u3092veth\u306bmacvtap\u3068\u3057\u3066\u63a5\u7d9a\n\n\n\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# virsh list\n Id    Name                           State\n----------------------------------------------------\n 14    nfv-ubu-cpqd                   running\n 15    nfv-ubu-tedge                  running\n\n\n[root@fedo21]# virsh dumpxml 14\n<domain type='kvm' id='14'>\n  <name>nfv-ubu-cpqd</name>\n\n\u3000\u3000\uff08##### Truncated #####\uff09\n\n    </interface>\n    <interface type='direct'>\n      <mac address='52:54:00:74:e2:c3'/>\n      <source dev='veth0_a' mode='vepa'/>\n      <target dev='macvtap0'/>\n      <model type='virtio'/>\n      <alias name='net1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x09' function='0x0'/>\n    </interface>\n\n\u3000\u3000\uff08##### Truncated #####\uff09\n</domain>\n\n\n\n\n\nKVM\u3092\u8d77\u52d5\u3057\u3001I/F\u306eLinkup\u3068Promiscuous\u8a31\u53ef\u3092\u8a2d\u5b9a\n\n\n\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ip lin set up veth0_a\n[root@fedo21]# ip lin set up veth0_b\n\n[root@fedo21]# ip lin set promisc on veth0_a\n[root@fedo21]# ip lin set promisc on veth0_b\n[root@fedo21]# ip lin set promisc on macvtap0\n[root@fedo21]# ip lin set promisc on macvtap1\n\n\n\nKVM\u306e\u7247\u5272\u308c\u3067LLDP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8d77\u52d5\u3001\u5bfe\u5411KVM\u3067\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u78ba\u8a8d\n\n\n\uff20KVM\u2460\nroot@ubu-01:~# apt-get install ladvd\nroot@ubu-01:~# ladvd -m 192.168.10.2 -n -f -a eth1 &\n\n\n\n\uff20KVM\u2461\nroot@ubu-02:~# tcpdump -v -i eth1\ntcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes\n08:46:37.129285 LLDP, length 298\n    Chassis ID TLV (1), length 7\n      Subtype MAC address (4): 52:54:00:ab:0d:1a (oui Unknown)\n    Port ID TLV (2), length 5\n      Subtype Interface Name (5): eth1\n    Time to Live TLV (3), length 2: TTL 180s\n    Port Description TLV (4), length 24: Red Hat, Inc Device 0001\n    System Name TLV (5), length 7: nfv-ubu\n    System Description TLV (6), length 93\n      Ubuntu 14.04.1 LTS Linux 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64\n    System Capabilities TLV (7), length 4\n      System  Capabilities [Router] (0x0010)\n      Enabled Capabilities [none] (0x0000)\n    Management Address TLV (8), length 12\n      Management Address length 5, AFI IPv4 (1): 192.168.10.2\n      Interface Index Interface Numbering (2): 3\n    Organization specific TLV (127), length 6: OUI IEEE 802.3 Private (0x00120f)\n      Max frame size Subtype (4)\n        MTU size 1522\n    Organization specific TLV (127), length 17: OUI ANSI/TIA (0x0012bb)\n      Inventory - hardware revision Subtype (5)\n      Hardware revision pc-i440fx-2.1\n    Organization specific TLV (127), length 26: OUI ANSI/TIA (0x0012bb)\n      Inventory - firmware revision Subtype (6)\n      Firmware revision 1.7.5-20140709_153950-\n    Organization specific TLV (127), length 21: OUI ANSI/TIA (0x0012bb)\n      Inventory - software revision Subtype (7)\n      Software revision 3.13.0-32-generic\n    Organization specific TLV (127), length 8: OUI ANSI/TIA (0x0012bb)\n      Inventory - manufacturer name Subtype (9)\n      Manufacturer name QEMU\n    Organization specific TLV (127), length 36: OUI ANSI/TIA (0x0012bb)\n      Inventory - model name Subtype (10)\n      Model name Standard PC (i440FX + PIIX, 1996\n    End TLV (0), length 0\n^C\n1 packet captured\n1 packet received by filter\n0 packets dropped by kernel\n\n\n\n\n\u8ffd\u8a18 2015/03/05\nVeth\u3067\u76f4\u7d50\u3057\u305fKVM\u9593\u3067\u306eLLDP\u9001\u53d7\u4fe1\u306b\u306f\u6210\u529f\u3057\u305f\u304c\u3001\u5b9f\u969b\u306bOpenFlow\u30b9\u30a4\u30c3\u30c1\u3092\u691c\u8a3c\u3057\u59cb\u3081\u308b\u3068\u3001\n2\u53f0\u306eKVM\uff08\u305d\u308c\u305e\u308cOpenFlow\u30b9\u30a4\u30c3\u30c1\uff09\u3092\u8de8\u3044\u3060Docker\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u758e\u901a\u304c\u3067\u304d\u306a\u3044\u4e8b\u304c\u5224\u660e\u3057\u305f\u3002\n\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u306b\u3088\u308b\u5207\u308a\u5206\u3051\u3084\u3001Web\u60c5\u5831\u306e\u8abf\u67fb\u306e\u7d50\u679c\u3001Macvtap\u3068NIC\u306e\u63a5\u7d9a\u70b9\u3067\u3001ARP\u30ea\u30d7\u30e9\u30a4\u304c\n\u4e2d\u7d99\u3055\u308c\u306a\u3044\u4ed5\u69d8\uff08\u30d0\u30b0\uff1f\uff09\u304c\u5b58\u5728\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u56f3\u306ePing\u7528\u30b3\u30f3\u30c6\u30ca\u2460\u304b\u3089Ping\u7528\u30b3\u30f3\u30c6\u30ca\u2461\u3078\u306eICMP\u306b\u5148\u7acb\u3064ARP\u89e3\u6c7a\u3067\u3001\u2460\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\n\u2461\u304c\u8fd4\u3057\u305fARP\u30ea\u30d7\u30e9\u30a4\u304c\u3001\u623b\u308a\u7d4c\u8def\u306eVeth\uff5eMacvtap\u63a5\u7d9a\u70b9\u3067\u4e2d\u7d99\u3055\u308c\u306a\u3044\u4e8b\u8c61\u304c\u751f\u3058\u307e\u3057\u305f\u3002\n\u306a\u304a\u3001\u4ee5\u4e0b\u306e\u7b56\u3082\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3068\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3000- Macvtap\u3084Veth\u306eNamespace\u3092\u30db\u30b9\u30c8OS\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u5909\u66f4\u3059\u308b\n\u3000- \u540c\u4e0a\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30a4\u30b9\u306b\u3066\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u95a2\u9023\u306e\u30d5\u30e9\u30b0\u306a\u3069\u3092on\u306b\u3059\u308b\uff08ip link set\u30b3\u30de\u30f3\u30c9\uff09\n\n\n\u7d50\u5c40\u3001\u59a5\u5354\u3057\u305f\u8fc2\u56de\u7b56\u3068\u3057\u3066\u3001Veth\u76f4\u7d50\u3057\u3066\u3044\u305f\u90e8\u5206\u3092Open vSwitch\u3068\u3057\u3001\u305d\u306eOVS\u306b2\u30a2\u30fc\u30e0\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30a4\u30b9\u9593\u3092\n\u76f8\u4e92\u306b\u7d20\u901a\u3057\u3059\u308b\u300c\u4eee\u60f3\u30d1\u30c3\u30c1\u30d1\u30cd\u30eb\u300d\u8a2d\u5b9a\u3092\u3001Static\u306aOpenFlow\u30eb\u30fc\u30eb\u3068\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u4e8b\u3067\u3001LLDP\u306b\u52a0\u3048\u3066ICMP\u7b49\u306e\n\u901a\u5e38\u306eEnd-to-End\u901a\u4fe1\u3082\u758e\u901a\u53ef\u80fd\u306a\u72b6\u6cc1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\n\u305f\u3060\u3001\u89e3\u6c7a\u7b56\u3068\u3057\u3066\u30a8\u30ec\u30ac\u30f3\u30c8\u3055\u3092\u6b20\u304f\u306e\u3067\u3001\u7d99\u7d9a\u3057\u3066\u4ed6\u306e\u30ef\u30fc\u30af\u30a2\u30e9\u30f3\u30c9\u3082\u691c\u8a0e\u3057\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u4eee\u60f3\u30d1\u30c3\u30c1\u30d1\u30cd\u30eb\u7528OpenFlow\u8a2d\u5b9a\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ovs-ofctl add-flow ovbr0 in_port=1,action=output:2\n[root@fedo21]# ovs-ofctl add-flow ovbr0 in_port=2,action=output:1\n\n[root@localhost ~fedo21]# ovs-ofctl dump-flows ovbr0\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=284.702s, table=0, n_packets=9, n_bytes=2806, idle_age=6, priority=0 actions=NORMAL\n cookie=0x0, duration=68.381s, table=0, n_packets=0, n_bytes=0, idle_age=68, in_port=1 actions=output:2\n cookie=0x0, duration=2.384s, table=0, n_packets=0, n_bytes=0, idle_age=2, in_port=2 actions=output:1\n\n\n##\u5e8f\u6587\n\nKMV\u74b0\u5883\u306b\u304a\u3044\u3066\u540c\u4e00\u30db\u30b9\u30c8\u4e0a\u306e\u306eVM\uff5eVM\u9593\u3001VM\uff5e\u30db\u30b9\u30c8Veth\u9593\u306e\u901a\u4fe1\u306b\u306f\u3001\u591a\u304f\u306e\u5834\u5408Linux-Bridge\u3084\nOpen vSwitch\u306a\u3069\u3001\u30d6\u30ea\u30c3\u30b8\u30c7\u30d0\u30a4\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u591a\u304f\u306e\u5834\u5408\u306f\u3053\u306e\u3088\u3046\u306aBride\u7d4c\u7531\u306eVM\u63a5\u7d9a\u3067\u4f55\u3089\u652f\u969c\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u305f\u3060\u3001VM\u4e0a\u3067S/W\u4eee\u60f3\u30b9\u30a4\u30c3\u30c1\u3092\u7a3c\u50cd\u3055\u305b\u3066\u3001\u305d\u308c\u3092\u8907\u6570\u53f0\u306b\u76f8\u4e92\u63a5\u7d9a\u3001LLDP\u3084IGMP\u306e\u9001\u53d7\u4fe1\u3092\n\u3055\u305b\u305f\u3044\u3088\u3046\u306a\u5834\u5408\u3001\u9593\u306b\u30d6\u30ea\u30c3\u30b8\u30c7\u30d0\u30a4\u30b9\u304c\u4ecb\u5728\u3059\u308b\u4e8b\u304c\u969c\u5bb3\u3068\u306a\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u203b\u4eca\u56de\u8a66\u3057\u3066\u3044\u306a\u3044\u304c\u3001IPv6\u306eLink-Local\u30d5\u30ec\u30fc\u30e0\u3082\u540c\u69d8\u3067\u306f\uff1f\uff09\n\n\n<br>\u3068\u304d\u306b\u3001\u79c1\u306fOpenFlow 1.3\u5bfe\u5fdc\u306e\u30b9\u30a4\u30c3\u30c1\u7fa4\u3067\u30c8\u30dd\u30ed\u30b8\u30a2\u30a6\u30a7\u30a2\u306a\u7d4c\u8def\u5236\u5fa1\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u5b9f\u88c5\u3057\u3088\u3046\u3068\n\u601d\u3044\u7acb\u3063\u3066\u304a\u308a\u307e\u3057\u305f\u3002\n\u305d\u3057\u3066\u3001\u3053\u306e\u5b9f\u88c5\u624b\u6bb5\u306e\u4e00\u3064\u306bLLDP\u306b\u3088\u308b\u30c8\u30dd\u30ed\u30b8\u691c\u77e5\u3092\u691c\u8a0e\u3057\u305f\u306e\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u3001\u53d6\u308a\u6025\u304eKVM\u9593\u3092\u5b89\u6613\u306bLinux-Bridge\u3067\u63a5\u7d9a\u3057\u305f\u3068\u3053\u308dLLDP\u306e\u6388\u53d7\u304c\u9069\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u3053\u3046\u3057\u305f\u7d4c\u7def\u3067\u3001KVM\u9593\u306eLayer-2\u76f4\u7d50\uff08\u7269\u7406\u3067\u8a00\u3048\u3070\u3001\u6a5f\u5668\u9593\u306e\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u30b1\u30fc\u30d6\u30eb\u76f4\u7d50\uff09\u306e\u65b9\u6cd5\u3092\u6a21\u7d22\u3057\u3001\n\u305d\u306e\u6210\u529f\u7d50\u679c\u3092\u5171\u6709\u3057\u305f\u3044\u3068\u601d\u3063\u305f\u6b21\u7b2c\u3067\u3059\u3002\n\n\n<br>\u624b\u9806\u3068\u3057\u3066\u306f\n\u3000\u30fb \u30db\u30b9\u30c8OS\u4e0a\u3067\u306eveth\u30da\u30a2\u306e\u4f5c\u6210\n\u3000\u30fb \u5404KVM\u306e\u30db\u30b9\u30c8\u5074tap\u30c7\u30d0\u30a4\u30b9\u3092\u3001\u4e0a\u8a18\u306eveth\u306e\u7247\u5074\u3078macvtap\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u63a5\u7d9a\n\u3000\u30fb veth\u30da\u30a2\u30c7\u30d0\u30a4\u30b9\u3001macvtap\u30c7\u30d0\u30a4\u30b9\u306e\u3059\u3079\u3066\u3092Uplink\u72b6\u614b\u3001Promiscuous\u8a31\u53ef\u306b\u8a2d\u5b9a\n\u3053\u306e\u6d41\u308c\u3067\u5b9f\u65bd\u3057\u3001\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\n\u306a\u304a\u3001LLDP\u53d7\u4fe1\u306e\u78ba\u8a8d\u306b\u306fLADVD\u30d1\u30c3\u30b1\u30fc\u30b8\u306eLLDP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\n<br>\n![macvtap_vs_bridge.png](https://qiita-image-store.s3.amazonaws.com/0/42848/bbcb343e-aa6b-cae7-9383-b5ce43eab7a2.png)\n\n\n<br>\u624b\u9806\u306e\u89e3\u8aac\u306b\u5148\u7acb\u3063\u3066\u3001\u307e\u305aMacvtap\u30c7\u30d0\u30a4\u30b9\u306e\u6982\u8981\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\n##Macvtap\u3068\u306f\n\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3068\u306f\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u7a3c\u50cd\u306eLinux\u30ab\u30fc\u30cd\u30eb\u306b\u3066\u3001VM\u3068\u30db\u30b9\u30c8OS\u5916\u90e8\uff08\u30db\u30b9\u30c8OS\u306e\u30ab\u30fc\u30cd\u30eb\u4ee5\u5916\uff09\u3068\u306e\nLayer-2\u3067\u306e\u901a\u4fe1\u3092\u53ef\u80fd\u3068\u3059\u308b\u305f\u3081\u306b\u767b\u5834\u3057\u305f\u3001\u6bd4\u8f03\u7684\u65b0\u3057\u3044\u4eee\u60f3\u30c7\u30d0\u30a4\u30b9\u3067\u3059\u3002\n\n\u4e0a\u3067\u300c\u30db\u30b9\u30c8OS\u5916\u90e8\u300d\u306e\u8a00\u8449\u3067\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3082\u306e\u306f\u3001\n\u3000- \u30db\u30b9\u30c8OS\u306e\u7269\u7406\u30b5\u30fc\u30d0\u5916\u90e8\u306eNW\u6a5f\u5668\n\u3000- \u540c\u4e00\u306e\u30db\u30b9\u30c8OS\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u5225\u306eVM\u3084NW\u30b9\u30bf\u30c3\u30af\u5229\u7528\u306e\u30d7\u30ed\u30bb\u30b9\n\u306a\u3069\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n<br>\u3053\u306e\u30c7\u30d0\u30a4\u30b9Type\u306f\u5148\u3093\u3058\u3066Linux\u30ab\u30fc\u30cd\u30eb\u306b\u5b9f\u88c5\u3055\u308c\u3066\u3044\u305fMacvlan\u30c7\u30d0\u30a4\u30b9\u3068Tap\u30c7\u30d0\u30a4\u30b9\u306e2\u3064\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\n\u76ee\u7684\u306e\u52d5\u4f5c\u3092\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002\n\nMacvlan\u30c7\u30d0\u30a4\u30b9\u306fLinux\u30ab\u30fc\u30cd\u30eb\u4e0a\u306e\u65e2\u5b58NW\u30c7\u30d0\u30a4\u30b9\u306b\u7570\u306a\u308bMAC\u30a2\u30c9\u30ec\u30b9\u3092\u6301\u3064\u3001\u65b0\u305f\u306aLayer-2\u30c7\u30d0\u30a4\u30b9\u3092\n\u8ffd\u52a0\u4f5c\u6210\u3059\u308b\u4e8b\u304c\u51fa\u6765\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001\u3053\u306e\u65b0\u898f\u751f\u6210\u306e\u30c7\u30d0\u30a4\u30b9\u306f\u3001\u8ffd\u52a0\u5143\u306eNW\u30c7\u30d0\u30a4\u30b9\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001\u5916\u90e8\u306eNW\u3068\u306e\u901a\u4fe1\u3092\u884c\u3046\u4e8b\u304c\n\u3067\u304d\u308b\u306e\u3067\u3059\u3002\n\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3067\u306f\u3001\u3053\u306eMacvlan\u30c7\u30d0\u30a4\u30b9\u3092\u65e2\u5b58\u30c7\u30d0\u30a4\u30b9\u4e0a\u306b\u751f\u6210\u3057\u3001\u305d\u306e\u5916\u90e8\u3068\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\n<br>\u6b21\u3044\u3067Tap\u30c7\u30d0\u30a4\u30b9\u306e\u5229\u7528\u306b\u3064\u3044\u3066\u3082\u8aac\u660e\u3057\u307e\u3059\u3002\n\nTap\u30c7\u30d0\u30a4\u30b9\u306f\u3001\u30db\u30b9\u30c8OS\u306eLinux\u30ab\u30fc\u30cd\u30eb \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b9\u30bf\u30c3\u30af\u3068\u3001\u305d\u306eLinux\u4e0a\u306e\u30d7\u30ed\u30bb\u30b9\u3068\u304c\nLayer-2\u30ec\u30d9\u30eb\u306eNW\u901a\u4fe1\u3092\u884c\u3046\u305f\u3081\u306b\u5229\u7528\u3059\u308b\u4eee\u60f3NW\u30c7\u30d0\u30a4\u30b9\u3067\u3059\u3002\n\n\u3059\u306a\u308f\u3061\u3001VM\u30b2\u30b9\u30c8\u304c\u81ea\u8eab\u306eNIC\u3078\u306eR/W\u3092\u884c\u3046\u3068\u3001\u305d\u306e\u5165\u51fa\u529bLayer-2\u30d5\u30ec\u30fc\u30e0\u306f\u5bfe\u5fdc\u3059\u308bTap\u30c7\u30d0\u30a4\u30b9\u3078\u306e\n\u5165\u51fa\u529b\u3068\u3057\u3066\u3001\u30db\u30b9\u30c8OS\u4e0a\u3067R/W\u3055\u308c\u308b\u4e8b\u306b\u306a\u308a\u307e\u3059\u3002\n\nMacvtap\u30c7\u30d0\u30a4\u30b9\u3067\u306f\u3001\u30db\u30b9\u30c8OS\u4e0a\u306b\u751f\u6210\u3055\u308c\u308bTap\u30c7\u30d0\u30a4\u30b9\u3092Macvlan\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u65e2\u5b58NW\u30c7\u30d0\u30a4\u30b9\u306b\n\u30a2\u30bf\u30c3\u30c1\u3057\u3001\u30b2\u30b9\u30c8OS\u306e\u901a\u4fe1\u30d5\u30ec\u30fc\u30e0\u3092\u65e2\u5b58\u306eNW\u30c7\u30d0\u30a4\u30b9\u306e\u901a\u4fe1\u6a5f\u80fd\u3092\u5229\u7528\u3057\u3066\u3001\u5916\u90e8\u3068\u5165\u51fa\u529b\u3057\u307e\u3059\u3002\n\n<br>\u53c2\u8003\uff1a\n\u3000http://seravo.fi/2012/virtualized-bridged-networking-with-macvtap\n\n\n##Macvtap\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\n\nMacvtap \u30c7\u30d0\u30a4\u30b9\u306e\u52d5\u4f5c\u30e2\u30fc\u30c9\u306f4 \u7a2e\u985e\u306e\u30e2\u30fc\u30c9\u304b\u3089\u6210\u3063\u3066\u3044\u307e\u3059\u3002\n\u660e\u793a\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u300cvepa\u300d\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30e2\u30fc\u30c9\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306fLink-Local\u306aLayer-2\u30d5\u30ec\u30fc\u30e0\u3092KVM\u30b2\u30b9\u30c8\u9593\u3067\u9001\u53d7\u4fe1\u3059\u308b\u4e8b\u304c\u76ee\u7684\u306a\u306e\u3067\u3001Bridge\u30e2\u30fc\u30c9\u306f\u907f\u3051\u3001\nvepa\u30e2\u30fc\u30c9\u3067\u306e\u63a5\u7d9a\u3092\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\n\n\n\u4ed6\u306e\u30e2\u30fc\u30c9\u3084\u5404\u30e2\u30fc\u30c9\u306e\u4ed5\u69d8\u306b\u95a2\u3057\u3066\u306f\u3001\u4e0b\u306b\u53c2\u8003\u306eURL\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u53c2\u8003\uff1a\n\u3000https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/6/html/Virtualization_Administration_Guide/sect-attch-nic-physdev.html\n\n\n##\u6280\u8853\u7684\u306a\u624b\u9806\n\n- \u30db\u30b9\u30c8OS\u3067\u306eVeth\u30da\u30a2\u4f5c\u6210\n\n```text:\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ip lin add name veth0_a type veth peer name veth0_b\n\n[root@fedo21]# ip -d link sh dev veth0_a\n81: veth0_a: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000\n    link/ether de:db:ee:3d:55:ba brd ff:ff:ff:ff:ff:ff promiscuity 2 \n    veth \n[root@fedo21]# ip -d link sh dev veth0_b\n80: veth0_b: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000\n    link/ether b2:6e:02:a8:d4:e2 brd ff:ff:ff:ff:ff:ff promiscuity 2 \n    veth \n[root@fedo21]# ethtool -S veth0_a\nNIC statistics:\n     peer_ifindex: 80\n```\n\n- KVM\u306eNIC\u3092veth\u306bmacvtap\u3068\u3057\u3066\u63a5\u7d9a\n\n```text:\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# virsh list\n Id    Name                           State\n----------------------------------------------------\n 14    nfv-ubu-cpqd                   running\n 15    nfv-ubu-tedge                  running\n\n\n[root@fedo21]# virsh dumpxml 14\n<domain type='kvm' id='14'>\n  <name>nfv-ubu-cpqd</name>\n\n\u3000\u3000\uff08##### Truncated #####\uff09\n\n    </interface>\n    <interface type='direct'>\n      <mac address='52:54:00:74:e2:c3'/>\n      <source dev='veth0_a' mode='vepa'/>\n      <target dev='macvtap0'/>\n      <model type='virtio'/>\n      <alias name='net1'/>\n      <address type='pci' domain='0x0000' bus='0x00' slot='0x09' function='0x0'/>\n    </interface>\n\n\u3000\u3000\uff08##### Truncated #####\uff09\n</domain>\n```\n![macvtap.png](https://qiita-image-store.s3.amazonaws.com/0/42848/e39b6d58-fe20-b7c9-a780-9470068e1858.png)\n\n<br>\n\n- KVM\u3092\u8d77\u52d5\u3057\u3001I/F\u306eLinkup\u3068Promiscuous\u8a31\u53ef\u3092\u8a2d\u5b9a\n\n```text:\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ip lin set up veth0_a\n[root@fedo21]# ip lin set up veth0_b\n\n[root@fedo21]# ip lin set promisc on veth0_a\n[root@fedo21]# ip lin set promisc on veth0_b\n[root@fedo21]# ip lin set promisc on macvtap0\n[root@fedo21]# ip lin set promisc on macvtap1\n```\n\n- KVM\u306e\u7247\u5272\u308c\u3067LLDP\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u8d77\u52d5\u3001\u5bfe\u5411KVM\u3067\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u78ba\u8a8d\n\n```text:\uff20KVM\u2460\nroot@ubu-01:~# apt-get install ladvd\nroot@ubu-01:~# ladvd -m 192.168.10.2 -n -f -a eth1 &\n```\n\n```text:\uff20KVM\u2461\nroot@ubu-02:~# tcpdump -v -i eth1\ntcpdump: listening on eth1, link-type EN10MB (Ethernet), capture size 65535 bytes\n08:46:37.129285 LLDP, length 298\n\tChassis ID TLV (1), length 7\n\t  Subtype MAC address (4): 52:54:00:ab:0d:1a (oui Unknown)\n\tPort ID TLV (2), length 5\n\t  Subtype Interface Name (5): eth1\n\tTime to Live TLV (3), length 2: TTL 180s\n\tPort Description TLV (4), length 24: Red Hat, Inc Device 0001\n\tSystem Name TLV (5), length 7: nfv-ubu\n\tSystem Description TLV (6), length 93\n\t  Ubuntu 14.04.1 LTS Linux 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64\n\tSystem Capabilities TLV (7), length 4\n\t  System  Capabilities [Router] (0x0010)\n\t  Enabled Capabilities [none] (0x0000)\n\tManagement Address TLV (8), length 12\n\t  Management Address length 5, AFI IPv4 (1): 192.168.10.2\n\t  Interface Index Interface Numbering (2): 3\n\tOrganization specific TLV (127), length 6: OUI IEEE 802.3 Private (0x00120f)\n\t  Max frame size Subtype (4)\n\t    MTU size 1522\n\tOrganization specific TLV (127), length 17: OUI ANSI/TIA (0x0012bb)\n\t  Inventory - hardware revision Subtype (5)\n\t  Hardware revision pc-i440fx-2.1\n\tOrganization specific TLV (127), length 26: OUI ANSI/TIA (0x0012bb)\n\t  Inventory - firmware revision Subtype (6)\n\t  Firmware revision 1.7.5-20140709_153950-\n\tOrganization specific TLV (127), length 21: OUI ANSI/TIA (0x0012bb)\n\t  Inventory - software revision Subtype (7)\n\t  Software revision 3.13.0-32-generic\n\tOrganization specific TLV (127), length 8: OUI ANSI/TIA (0x0012bb)\n\t  Inventory - manufacturer name Subtype (9)\n\t  Manufacturer name QEMU\n\tOrganization specific TLV (127), length 36: OUI ANSI/TIA (0x0012bb)\n\t  Inventory - model name Subtype (10)\n\t  Model name Standard PC (i440FX + PIIX, 1996\n\tEnd TLV (0), length 0\n^C\n1 packet captured\n1 packet received by filter\n0 packets dropped by kernel\n```\n\n<br>\n##\u8ffd\u8a18 2015/03/05\n\nVeth\u3067\u76f4\u7d50\u3057\u305fKVM\u9593\u3067\u306eLLDP\u9001\u53d7\u4fe1\u306b\u306f\u6210\u529f\u3057\u305f\u304c\u3001\u5b9f\u969b\u306bOpenFlow\u30b9\u30a4\u30c3\u30c1\u3092\u691c\u8a3c\u3057\u59cb\u3081\u308b\u3068\u3001\n2\u53f0\u306eKVM\uff08\u305d\u308c\u305e\u308cOpenFlow\u30b9\u30a4\u30c3\u30c1\uff09\u3092\u8de8\u3044\u3060Docker\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u758e\u901a\u304c\u3067\u304d\u306a\u3044\u4e8b\u304c\u5224\u660e\u3057\u305f\u3002\n\n\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u306b\u3088\u308b\u5207\u308a\u5206\u3051\u3084\u3001Web\u60c5\u5831\u306e\u8abf\u67fb\u306e\u7d50\u679c\u3001Macvtap\u3068NIC\u306e\u63a5\u7d9a\u70b9\u3067\u3001ARP\u30ea\u30d7\u30e9\u30a4\u304c\n\u4e2d\u7d99\u3055\u308c\u306a\u3044\u4ed5\u69d8\uff08\u30d0\u30b0\uff1f\uff09\u304c\u5b58\u5728\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u56f3\u306ePing\u7528\u30b3\u30f3\u30c6\u30ca\u2460\u304b\u3089Ping\u7528\u30b3\u30f3\u30c6\u30ca\u2461\u3078\u306eICMP\u306b\u5148\u7acb\u3064ARP\u89e3\u6c7a\u3067\u3001\u2460\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\n\u2461\u304c\u8fd4\u3057\u305fARP\u30ea\u30d7\u30e9\u30a4\u304c\u3001\u623b\u308a\u7d4c\u8def\u306eVeth\uff5eMacvtap\u63a5\u7d9a\u70b9\u3067\u4e2d\u7d99\u3055\u308c\u306a\u3044\u4e8b\u8c61\u304c\u751f\u3058\u307e\u3057\u305f\u3002\n\n\n\u306a\u304a\u3001\u4ee5\u4e0b\u306e\u7b56\u3082\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3068\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3000- Macvtap\u3084Veth\u306eNamespace\u3092\u30db\u30b9\u30c8OS\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u5909\u66f4\u3059\u308b\n\u3000- \u540c\u4e0a\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30a4\u30b9\u306b\u3066\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u95a2\u9023\u306e\u30d5\u30e9\u30b0\u306a\u3069\u3092on\u306b\u3059\u308b\uff08ip link set\u30b3\u30de\u30f3\u30c9\uff09\n\n\n![macvtap_malfunc.png](https://qiita-image-store.s3.amazonaws.com/0/42848/91d196d6-ed61-93e3-4a22-317680c0f983.png)\n\n<br>\n\u7d50\u5c40\u3001\u59a5\u5354\u3057\u305f\u8fc2\u56de\u7b56\u3068\u3057\u3066\u3001Veth\u76f4\u7d50\u3057\u3066\u3044\u305f\u90e8\u5206\u3092Open vSwitch\u3068\u3057\u3001\u305d\u306eOVS\u306b2\u30a2\u30fc\u30e0\u306e\u30a4\u30f3\u30bf\u30d5\u30a7\u30a4\u30b9\u9593\u3092\n\u76f8\u4e92\u306b\u7d20\u901a\u3057\u3059\u308b\u300c\u4eee\u60f3\u30d1\u30c3\u30c1\u30d1\u30cd\u30eb\u300d\u8a2d\u5b9a\u3092\u3001Static\u306aOpenFlow\u30eb\u30fc\u30eb\u3068\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u4e8b\u3067\u3001LLDP\u306b\u52a0\u3048\u3066ICMP\u7b49\u306e\n\u901a\u5e38\u306eEnd-to-End\u901a\u4fe1\u3082\u758e\u901a\u53ef\u80fd\u306a\u72b6\u6cc1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u305f\u3060\u3001\u89e3\u6c7a\u7b56\u3068\u3057\u3066\u30a8\u30ec\u30ac\u30f3\u30c8\u3055\u3092\u6b20\u304f\u306e\u3067\u3001\u7d99\u7d9a\u3057\u3066\u4ed6\u306e\u30ef\u30fc\u30af\u30a2\u30e9\u30f3\u30c9\u3082\u691c\u8a0e\u3057\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n![virtpatch.png](https://qiita-image-store.s3.amazonaws.com/0/42848/7213fbe3-5547-ec05-eb8b-3edb81a87bff.png)\n\n\n```text:\u4eee\u60f3\u30d1\u30c3\u30c1\u30d1\u30cd\u30eb\u7528OpenFlow\u8a2d\u5b9a\uff20\u30db\u30b9\u30c8OS\n[root@fedo21]# ovs-ofctl add-flow ovbr0 in_port=1,action=output:2\n[root@fedo21]# ovs-ofctl add-flow ovbr0 in_port=2,action=output:1\n\n[root@localhost ~fedo21]# ovs-ofctl dump-flows ovbr0\nNXST_FLOW reply (xid=0x4):\n cookie=0x0, duration=284.702s, table=0, n_packets=9, n_bytes=2806, idle_age=6, priority=0 actions=NORMAL\n cookie=0x0, duration=68.381s, table=0, n_packets=0, n_bytes=0, idle_age=68, in_port=1 actions=output:2\n cookie=0x0, duration=2.384s, table=0, n_packets=0, n_bytes=0, idle_age=2, in_port=2 actions=output:1\n```\n", "tags": ["KVM", "Network", "OpenFlow", "kernel"]}