{"context": "\n\ndocker\n\u30db\u30b9\u30c8PC\u3067\u306e\u64cd\u4f5c\n$ docker images\n$ docker run -i -t amazonlinux:2016.09 /bin/bash\n\n\nOS + ssh\n# yum update -y\n# yum install -y vim zsh git wget curl tmux bzip2 sudo openssh-server openssh passwd\n# echo \"NETWORKING=yes\" >/etc/sysconfig/network\n# /etc/init.d/sshd start\n\n\nyum\n\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5909\u66f4\u3059\u308b\nvim /etc/yum/vars/awsregion\nap-northeast-1\n\n\nnginx\n# yum install -y nginx\n\nvim /etc/nginx/conf.d/default.conf\n\n/etc/nginx/conf.d/default.conf\nserver {\n  listen \"8071\";\n  root /var/www/hoge/web;\n  location ~ \\.php.*$ {\n    fastcgi_split_path_info ^(.+\\.php)(.*)$;\n    fastcgi_pass 127.0.0.1:7100;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param PATH_INFO $fastcgi_path_info;\n    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n    include fastcgi_params;\n  }\n}\n\n\n\nuser\n# useradd -g nginx -s /bin/bash www\n# echo \"www ALL=(ALL) NOPASSWD:ALL\" > /etc/sudoers.d/www\n# su - www\n$ mkdir .ssh\n$ chmod 700 .ssh\n$ echo \"\u516c\u958b\u9375\" > ~/.ssh/authorized_keys\n$ chmod 600 .ssh/authorized_keys\n\n\ndocker\u30b3\u30df\u30c3\u30c8\n\u30db\u30b9\u30c8PC\u4e0a\u3067\u306e\u64cd\u4f5c\n$ docker ps -a\n$ docker commit \u30cf\u30c3\u30b7\u30e5\u5024 symfony3\n$ docker run -it -p 8071:8071 -p 10022:22 symfony3 /bin/bash\n\n\nssh\n\u30db\u30b9\u30c8PC\u304b\u3089ssh\n$ ssh -p 10022 -i ~/.ssh/id_rsa www@localhost\n\n\nanyenv\nhttps://github.com/riywo/anyenv\n$ git clone https://github.com/riywo/anyenv ~/.anyenv\n$ echo 'export PATH=\"$HOME/.anyenv/bin:$PATH\"' >> ~/.bash_profile\n$ echo 'eval \"$(anyenv init -)\"' >> ~/.bash_profile\n$ exec $SHELL -l\n$ cd ~\n$ mkdir -p $(anyenv root)/plugins\n$ git clone https://github.com/znz/anyenv-update.git $(anyenv root)/plugins/anyenv-update\n$ anyenv install phpenv\n$ exec $SHELL -l\n\n\nPHP\n\u5fc5\u8981\u306a\u30b3\u30f3\u30d1\u30a4\u30e9\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install -y gcc gcc-c++ libgcc cmake ncurses-devel re2c autoconf automake bison libxml2 libxml2-devel openssl-devel curl-devel libpng libpng-devel libmcrypt libmcrypt-devel readline-devel libtidy libtidy-devel libxslt libxslt-devel zlib-devel libjpeg-turbo libjpeg-turbo-devel libcurl-devel libicu-devel freetype freetype-devel\n\nintl\u306b\u5fc5\u8981\u306aicu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget http://download.icu-project.org/files/icu4c/57.1/icu4c-57_1-src.tgz\n$ tar xvzf icu4c-57_1-src.tgz\n$ cd ./icu/source\n$ ./configure --prefix=/opt/icu\n$ make\n$ sudo make install\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\n$ sudo vim /etc/ld.so.conf\n\n\n/etc/ld.so.conf\ninclude ld.so.conf.d/*.conf\n/usr/local/lib\n/usr/lib64\n\n\nsudo ldconfig\n\nphp-build\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u8ffd\u52a0\nvim ~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n\n~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n--enable-mbregex\n--enable-gd-native-ttf\n--with-freetype-dir=/usr/local/\n--with-libdir=lib\n--enable-intl\n--with-icu-dir=/opt/icu\n\n\nphp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ phpenv install 7.1.2\n$ phpenv global 7.1.2\n$ exec $SHELL -l\n\nphp\u306e\u8a2d\u5b9a\nvim ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php.ini\n\n~/.anyenv/envs/phpenv/versions/7.1.2/etc/php.ini\ndate.timezone = Asia/Tokyo\n\n\n\nPHP-FPM\u306e\u8a2d\u5b9a\n$ cp ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.d/www.conf.default ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\n\nvim ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\n\n~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\nlisten = 127.0.0.1:7100\nlisten.allowed_clients = 127.0.0.1\npm = ondemand\npm.max_children = 5\nuser = www\ngroup = nginx\n\n\n\nphp-fpm\u8d77\u52d5\n$ sudo ~/.anyenv/envs/phpenv/versions/7.1.2/sbin/php-fpm\n\n\nnginx\u8d77\u52d5\n$ sudo /etc/init.d/nginx start\n\n\nSymfony3\n$ sudo mkdir -p /var/www\n$ cd /var/www\n$ composer create-project symfony/framework-standard-edition hoge \"3.2.*\"\n\n\n\u53c2\u8003\u6587\u732e\n\nDocker\u3092\u4f7f\u7528\u3057\u305fAmazonLinux\u306e\u958b\u767a\u74b0\u5883\u4f5c\u6210\nmacOS Sierra\u306banyenv, phpenv\u3067PHP7.1\u3092\u5165\u308c\u308b\n\n\n# docker\n\n\u30db\u30b9\u30c8PC\u3067\u306e\u64cd\u4f5c\n\n```bash\n$ docker images\n$ docker run -i -t amazonlinux:2016.09 /bin/bash\n```\n\n# OS + ssh\n\n```bash\n# yum update -y\n# yum install -y vim zsh git wget curl tmux bzip2 sudo openssh-server openssh passwd\n# echo \"NETWORKING=yes\" >/etc/sysconfig/network\n# /etc/init.d/sshd start\n```\n\n# yum\n\n\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5909\u66f4\u3059\u308b\n\nvim /etc/yum/vars/awsregion\n\n```/etc/yum/vars/awsregion\nap-northeast-1\n```\n\n\n# nginx\n\n```bash\n# yum install -y nginx\n```\n\nvim /etc/nginx/conf.d/default.conf\n\n```/etc/nginx/conf.d/default.conf\nserver {\n  listen \"8071\";\n  root /var/www/hoge/web;\n  location ~ \\.php.*$ {\n    fastcgi_split_path_info ^(.+\\.php)(.*)$;\n    fastcgi_pass 127.0.0.1:7100;\n    fastcgi_index index.php;\n    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n    fastcgi_param PATH_INFO $fastcgi_path_info;\n    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;\n    include fastcgi_params;\n  }\n}\n```\n\n# user\n\n```bash\n# useradd -g nginx -s /bin/bash www\n# echo \"www ALL=(ALL) NOPASSWD:ALL\" > /etc/sudoers.d/www\n# su - www\n$ mkdir .ssh\n$ chmod 700 .ssh\n$ echo \"\u516c\u958b\u9375\" > ~/.ssh/authorized_keys\n$ chmod 600 .ssh/authorized_keys\n```\n\n\n## docker\u30b3\u30df\u30c3\u30c8\n\n\u30db\u30b9\u30c8PC\u4e0a\u3067\u306e\u64cd\u4f5c\n\n```bash\n$ docker ps -a\n$ docker commit \u30cf\u30c3\u30b7\u30e5\u5024 symfony3\n$ docker run -it -p 8071:8071 -p 10022:22 symfony3 /bin/bash\n```\n\n# ssh\n\n\u30db\u30b9\u30c8PC\u304b\u3089ssh\n\n```\n$ ssh -p 10022 -i ~/.ssh/id_rsa www@localhost\n```\n\n# anyenv\n\nhttps://github.com/riywo/anyenv\n\n```bash\n$ git clone https://github.com/riywo/anyenv ~/.anyenv\n$ echo 'export PATH=\"$HOME/.anyenv/bin:$PATH\"' >> ~/.bash_profile\n$ echo 'eval \"$(anyenv init -)\"' >> ~/.bash_profile\n$ exec $SHELL -l\n$ cd ~\n$ mkdir -p $(anyenv root)/plugins\n$ git clone https://github.com/znz/anyenv-update.git $(anyenv root)/plugins/anyenv-update\n$ anyenv install phpenv\n$ exec $SHELL -l\n```\n\n# PHP\n\n\u5fc5\u8981\u306a\u30b3\u30f3\u30d1\u30a4\u30e9\u3001\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ sudo yum install -y gcc gcc-c++ libgcc cmake ncurses-devel re2c autoconf automake bison libxml2 libxml2-devel openssl-devel curl-devel libpng libpng-devel libmcrypt libmcrypt-devel readline-devel libtidy libtidy-devel libxslt libxslt-devel zlib-devel libjpeg-turbo libjpeg-turbo-devel libcurl-devel libicu-devel freetype freetype-devel\n```\n\nintl\u306b\u5fc5\u8981\u306aicu\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ wget http://download.icu-project.org/files/icu4c/57.1/icu4c-57_1-src.tgz\n$ tar xvzf icu4c-57_1-src.tgz\n$ cd ./icu/source\n$ ./configure --prefix=/opt/icu\n$ make\n$ sudo make install\n```\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\n\n```\n$ sudo vim /etc/ld.so.conf\n```\n\n```/etc/ld.so.conf\ninclude ld.so.conf.d/*.conf\n/usr/local/lib\n/usr/lib64\n```\n\n```bash\nsudo ldconfig\n```\n\nphp-build\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u8ffd\u52a0\n\nvim ~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n\n```~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n--enable-mbregex\n--enable-gd-native-ttf\n--with-freetype-dir=/usr/local/\n--with-libdir=lib\n--enable-intl\n--with-icu-dir=/opt/icu\n```\n\nphp\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\n$ phpenv install 7.1.2\n$ phpenv global 7.1.2\n$ exec $SHELL -l\n```\n\nphp\u306e\u8a2d\u5b9a\n\nvim ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php.ini\n\n```~/.anyenv/envs/phpenv/versions/7.1.2/etc/php.ini\ndate.timezone = Asia/Tokyo\n```\n\n## PHP-FPM\u306e\u8a2d\u5b9a\n\n```bash\n$ cp ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.d/www.conf.default ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\n```\n\nvim ~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\n\n```~/.anyenv/envs/phpenv/versions/7.1.2/etc/php-fpm.conf\nlisten = 127.0.0.1:7100\nlisten.allowed_clients = 127.0.0.1\npm = ondemand\npm.max_children = 5\nuser = www\ngroup = nginx\n```\n\n## php-fpm\u8d77\u52d5\n\n```bash\n$ sudo ~/.anyenv/envs/phpenv/versions/7.1.2/sbin/php-fpm\n```\n\n## nginx\u8d77\u52d5\n\n```bash\n$ sudo /etc/init.d/nginx start\n```\n\n# Symfony3\n\n```bash\n$ sudo mkdir -p /var/www\n$ cd /var/www\n$ composer create-project symfony/framework-standard-edition hoge \"3.2.*\"\n```\n\n# \u53c2\u8003\u6587\u732e\n* [Docker\u3092\u4f7f\u7528\u3057\u305fAmazonLinux\u306e\u958b\u767a\u74b0\u5883\u4f5c\u6210](http://qiita.com/mogetarou/items/e1cb3d33fbaca5ae65ed)\n* [macOS Sierra\u306banyenv, phpenv\u3067PHP7.1\u3092\u5165\u308c\u308b](http://qiita.com/HRS_O/items/0495dcdd8c324cf264d8)\n", "tags": ["PHP", "docker", "Symfony", "anyenv"]}