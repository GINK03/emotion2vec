{"context": " More than 1 year has passed since last update.\u6ce8\u6587\u30c6\u30fc\u30d6\u30eb\n> describe `order`;\n+-------------+--------------+------+-----+---------+----------------+\n| Field       | Type         | Null | Key | Default | Extra          |\n+-------------+--------------+------+-----+---------+----------------+\n| id          | bigint(20)   | NO   | PRI | NULL    | auto_increment |\n| buyer_id    | bigint(20)   | NO   | MUL | NULL    |                |\n| product_id  | bigint(20)   | YES  | UNI | NULL    |                |\n| pay         | bigint(20)   | NO   |     | 0       |                |\n| ...                                                                |\n+-------------+--------------+------+-----+---------+----------------+\n\n\u96c6\u8a08\u7528\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u3092\u4f5c\u6210\u3059\u308b\nCREATE TABLE `calendar` (\n  `dt` datetime NOT NULL,\n  PRIMARY KEY (`dt`)\n)\n\n\u30ab\u30ec\u30f3\u30c0\u30fc\u30c6\u30fc\u30d6\u30eb\u306b\u65e5\u4ed8\u3092\u5165\u308c\u308b\nDELIMITER |\nCREATE PROCEDURE fill_calendar(start_date DATE, end_date DATE)\nBEGIN\n  DECLARE crt_date DATE;\n  SET crt_date=start_date;\n  WHILE crt_date < end_date DO\n    INSERT INTO calendar VALUES(crt_date);\n    SET crt_date = ADDDATE(crt_date, INTERVAL 1 DAY);\n  END WHILE;\nEND |\nDELIMITER ;\n\nCALL fill_calendar('2000-01-01', '2099-12-31');\n\n\u65e5\u6b21\u306e\u53d6\u5f97\nSELECT\n    DATE_FORMAT(c.dt,'%Y-%m-%d')\n    , COUNT(o.id) order_count\n    , COUNT(DISTINCT o.product_id) product_count\n    , COUNT(DISTINCT o.buyer_id) buyer_count\n    , IFNULL(SUM(o.pay), 0) total_pay\nFROM\n    calendar c\nLEFT JOIN \n    `order` o\nON\n    TO_DAYS(c.dt) = TO_DAYS(o.created_dt)\nWHERE\n    c.dt >= '2015-06-01 00:00:00'\n    AND c.dt < '2015-07-01 00:00:00'\nGROUP BY\n    c.dt\nORDER BY \n    c.dt;\n\n\u9031\u6b21\u306e\u53d6\u5f97\nSELECT\n    STR_TO_DATE(CONCAT(YEARWEEK(c.dt, 1),' 1'), '%x%v %w') week_start_date\n    , STR_TO_DATE(CONCAT(YEARWEEK(c.dt, 1),' 0'), '%x%v %w') week_end_date\n    , COUNT(o.id) order_count\n    , COUNT(DISTINCT o.product_id) product_count\n    , COUNT(DISTINCT o.buyer_id) buyer_count\n    , IFNULL(SUM(o.pay), 0) total_pay\nFROM\n    calendar c\nLEFT JOIN \n    `order` o\nON\n    YEARWEEK(c.dt,1) = YEARWEEK(o.created_dt,1)\nWHERE\n    YEARWEEK(c.dt,1) >= YEARWEEK('2015-06-01 00:00:00',1)\n    AND YEARWEEK(c.dt) <= YEARWEEK('2016-07-01 00:00:00',1)\nGROUP BY\n    YEARWEEK(c.dt,1)\nORDER BY \n    YEARWEEK(c.dt,1);\n\n\u6708\u6b21\u306e\u53d6\u5f97\nSELECT\n    DATE_FORMAT(c.dt,'%Y-%m')\n    , COUNT(o.id) order_count\n    , COUNT(DISTINCT o.product_id) product_count\n    , COUNT(DISTINCT o.buyer_id) buyer_count\n    , IFNULL(SUM(o.pay), 0) total_pay\nFROM\n    calendar c\nLEFT JOIN \n    `order` o\nON\n    DATE_FORMAT(c.dt,'%Y%m') = DATE_FORMAT(o.created_dt,'%Y%m')\nWHERE\n    DATE_FORMAT(c.dt,'%Y%m') >= DATE_FORMAT('2015-06-01 00:00:00','%Y%m')\n    AND DATE_FORMAT(c.dt,'%Y%m') <= DATE_FORMAT('2015-07-01 00:00:00','%Y%m')\nGROUP BY\n    DATE_FORMAT(c.dt,'%Y%m')\nORDER BY \n    DATE_FORMAT(c.dt,'%Y%m');\n\n\u53c2\u8003: http://www.media-division.com/using-mysql-generate-daily-sales-reports-filled-gaps/\n\u6ce8\u6587\u30c6\u30fc\u30d6\u30eb\n\n```mysql\n> describe `order`;\n+-------------+--------------+------+-----+---------+----------------+\n| Field       | Type         | Null | Key | Default | Extra          |\n+-------------+--------------+------+-----+---------+----------------+\n| id          | bigint(20)   | NO   | PRI | NULL    | auto_increment |\n| buyer_id    | bigint(20)   | NO   | MUL | NULL    |                |\n| product_id  | bigint(20)   | YES  | UNI | NULL    |                |\n| pay         | bigint(20)   | NO   |     | 0       |                |\n| ...                                                                |\n+-------------+--------------+------+-----+---------+----------------+\n```\n\n\u96c6\u8a08\u7528\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u3092\u4f5c\u6210\u3059\u308b\n\n```mysql\nCREATE TABLE `calendar` (\n  `dt` datetime NOT NULL,\n  PRIMARY KEY (`dt`)\n)\n```\n\u30ab\u30ec\u30f3\u30c0\u30fc\u30c6\u30fc\u30d6\u30eb\u306b\u65e5\u4ed8\u3092\u5165\u308c\u308b\n\n```mysql\nDELIMITER |\nCREATE PROCEDURE fill_calendar(start_date DATE, end_date DATE)\nBEGIN\n  DECLARE crt_date DATE;\n  SET crt_date=start_date;\n  WHILE crt_date < end_date DO\n    INSERT INTO calendar VALUES(crt_date);\n    SET crt_date = ADDDATE(crt_date, INTERVAL 1 DAY);\n  END WHILE;\nEND |\nDELIMITER ;\n\nCALL fill_calendar('2000-01-01', '2099-12-31');\n```\n\n\n\u65e5\u6b21\u306e\u53d6\u5f97\n\n```mysql\nSELECT\n\tDATE_FORMAT(c.dt,'%Y-%m-%d')\n\t, COUNT(o.id) order_count\n\t, COUNT(DISTINCT o.product_id) product_count\n\t, COUNT(DISTINCT o.buyer_id) buyer_count\n\t, IFNULL(SUM(o.pay), 0) total_pay\nFROM\n\tcalendar c\nLEFT JOIN \n\t`order` o\nON\n\tTO_DAYS(c.dt) = TO_DAYS(o.created_dt)\nWHERE\n\tc.dt >= '2015-06-01 00:00:00'\n\tAND c.dt < '2015-07-01 00:00:00'\nGROUP BY\n\tc.dt\nORDER BY \n\tc.dt;\n```\n\n\u9031\u6b21\u306e\u53d6\u5f97\n\n```mysql\nSELECT\n\tSTR_TO_DATE(CONCAT(YEARWEEK(c.dt, 1),' 1'), '%x%v %w') week_start_date\n\t, STR_TO_DATE(CONCAT(YEARWEEK(c.dt, 1),' 0'), '%x%v %w') week_end_date\n\t, COUNT(o.id) order_count\n\t, COUNT(DISTINCT o.product_id) product_count\n\t, COUNT(DISTINCT o.buyer_id) buyer_count\n\t, IFNULL(SUM(o.pay), 0) total_pay\nFROM\n\tcalendar c\nLEFT JOIN \n\t`order` o\nON\n\tYEARWEEK(c.dt,1) = YEARWEEK(o.created_dt,1)\nWHERE\n\tYEARWEEK(c.dt,1) >= YEARWEEK('2015-06-01 00:00:00',1)\n\tAND YEARWEEK(c.dt) <= YEARWEEK('2016-07-01 00:00:00',1)\nGROUP BY\n\tYEARWEEK(c.dt,1)\nORDER BY \n\tYEARWEEK(c.dt,1);\n```\n\n\u6708\u6b21\u306e\u53d6\u5f97\n\n```mysql\nSELECT\n\tDATE_FORMAT(c.dt,'%Y-%m')\n\t, COUNT(o.id) order_count\n\t, COUNT(DISTINCT o.product_id) product_count\n\t, COUNT(DISTINCT o.buyer_id) buyer_count\n\t, IFNULL(SUM(o.pay), 0) total_pay\nFROM\n\tcalendar c\nLEFT JOIN \n\t`order` o\nON\n\tDATE_FORMAT(c.dt,'%Y%m') = DATE_FORMAT(o.created_dt,'%Y%m')\nWHERE\n\tDATE_FORMAT(c.dt,'%Y%m') >= DATE_FORMAT('2015-06-01 00:00:00','%Y%m')\n\tAND DATE_FORMAT(c.dt,'%Y%m') <= DATE_FORMAT('2015-07-01 00:00:00','%Y%m')\nGROUP BY\n\tDATE_FORMAT(c.dt,'%Y%m')\nORDER BY \n\tDATE_FORMAT(c.dt,'%Y%m');\n```\n\n\n\u53c2\u8003: http://www.media-division.com/using-mysql-generate-daily-sales-reports-filled-gaps/\n", "tags": ["MySQL", "datetime", "\u96c6\u8a08"]}