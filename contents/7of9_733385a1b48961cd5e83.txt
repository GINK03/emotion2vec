{"context": "\n\u52d5\u4f5c\u74b0\u5883\nC++ Builder XE4\n\n\n\u95a2\u9023 http://qiita.com/7of9/items/4caba5c87522aa410447\n\u95a2\u9023 http://qiita.com/7of9/items/490f6b00b197f4e7df6e\nTLabel\u3092\u7528\u610f\u3057\u305f\u6642\u3001\u305d\u3053\u306b\u3069\u306e\u9577\u3055\u307e\u3067String\u6587\u5b57\u5217\u3092\u4ee3\u5165\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u305f\u304f\u306a\u3063\u305f\u3002\n\u4ee5\u4e0b\u306egetMaximumStringLength()\u3092\u5b9f\u88c5\u3057\u305f\u3002\n\nUnit1.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"Unit1.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n__fastcall TForm1::TForm1(TComponent* Owner)\n    : TForm(Owner)\n{\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n//  String kDummyString = L\"START_jfkldsajkfjdklsajfkldjsklfjaksdljfkldsjalkjfsdk_END\";\n\n//  Label1->Caption = kDummyString;\n\n    int mxlen = getMaximumStringLength(Label1);\n    String msg = L\"Maxsize:\" + IntToStr(mxlen);\n    OutputDebugString(msg.c_str());\n\n//  fitWithDesignedWidth(Label1);\n\n\n    int nop=1;\n}\n//---------------------------------------------------------------------------\n\nvoid __fastcall TForm1::fitWithDesignedWidth(TLabel *lblPtr)\n{\n    int fntsiz[] = { 16, 14, 12, 10, 8 }; // \u5927\u304d\u3044\u30b5\u30a4\u30ba\u304b\u3089\n    int size = sizeof(fntsiz) / sizeof(fntsiz[0]);\n\n    bool widthIsOk;\n\n    for(int idx=0; idx<size; idx++) {\n        lblPtr->Font->Size = fntsiz[idx];\n        widthIsOk = checkWidthIsLargeEnough(lblPtr);\n        if (widthIsOk) {\n            break;\n        }\n    }\n}\n\nint __fastcall TForm1::getMaximumStringLength(TLabel *lblPtr)\n{\n    static const int kMaxLoop = 8;\n    static const int kIncrease = 5;\n\n    bool widthIsOk;\n    int maxLen = 10;\n\n    lblPtr->Caption = L\"1234567890\";\n\n    int loop = 0;\n    while(loop < kMaxLoop) {\n        lblPtr->Caption = lblPtr->Caption + L\"SAAAE\"; // [kIncrease]\u306b\u5408\u308f\u305b\u3066\u6587\u5b57\u3092\u7528\u610f\n        widthIsOk = checkWidthIsLargeEnough(lblPtr);\n        if (widthIsOk == false) {\n            lblPtr->Caption = lblPtr->Caption.SubString(0, lblPtr->Caption.Length() - kIncrease);\n            break;\n        }\n        maxLen += kIncrease;\n        loop++;\n    }\n\n    return maxLen;\n}\n\nbool __fastcall TForm1::checkWidthIsLargeEnough(TLabel *lblPtr)\n{\n    int orgWdt = lblPtr->Width;\n\n    // to check\n    lblPtr->AutoSize = true;\n    int aftWdt = Label1->Width;\n\n    // recover\n    lblPtr->AutoSize = false;\n    lblPtr->Width = orgWdt;\n\n    return (aftWdt < orgWdt);\n}\n\n\n\n\u7d50\u679c\n\u30c7\u30d0\u30c3\u30b0\u51fa\u529b: Maxsize:30 \u30d7\u30ed\u30bb\u30b9 Project1.exe (752)\n\n\n\n```txt:\u52d5\u4f5c\u74b0\u5883\nC++ Builder XE4\n```\n\n\u95a2\u9023 http://qiita.com/7of9/items/4caba5c87522aa410447\n\u95a2\u9023 http://qiita.com/7of9/items/490f6b00b197f4e7df6e\n\nTLabel\u3092\u7528\u610f\u3057\u305f\u6642\u3001\u305d\u3053\u306b\u3069\u306e\u9577\u3055\u307e\u3067String\u6587\u5b57\u5217\u3092\u4ee3\u5165\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3057\u305f\u304f\u306a\u3063\u305f\u3002\n\n\u4ee5\u4e0b\u306egetMaximumStringLength()\u3092\u5b9f\u88c5\u3057\u305f\u3002\n\n```Unit1.cpp\n//---------------------------------------------------------------------------\n\n#include <vcl.h>\n#pragma hdrstop\n\n#include \"Unit1.h\"\n//---------------------------------------------------------------------------\n#pragma package(smart_init)\n#pragma resource \"*.dfm\"\nTForm1 *Form1;\n//---------------------------------------------------------------------------\n__fastcall TForm1::TForm1(TComponent* Owner)\n\t: TForm(Owner)\n{\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n//\tString kDummyString = L\"START_jfkldsajkfjdklsajfkldjsklfjaksdljfkldsjalkjfsdk_END\";\n\n//\tLabel1->Caption = kDummyString;\n\n\tint mxlen = getMaximumStringLength(Label1);\n\tString msg = L\"Maxsize:\" + IntToStr(mxlen);\n\tOutputDebugString(msg.c_str());\n\n//\tfitWithDesignedWidth(Label1);\n\n\n\tint nop=1;\n}\n//---------------------------------------------------------------------------\n\nvoid __fastcall TForm1::fitWithDesignedWidth(TLabel *lblPtr)\n{\n\tint fntsiz[] = { 16, 14, 12, 10, 8 }; // \u5927\u304d\u3044\u30b5\u30a4\u30ba\u304b\u3089\n\tint size = sizeof(fntsiz) / sizeof(fntsiz[0]);\n\n\tbool widthIsOk;\n\n\tfor(int idx=0; idx<size; idx++) {\n\t\tlblPtr->Font->Size = fntsiz[idx];\n\t\twidthIsOk = checkWidthIsLargeEnough(lblPtr);\n\t\tif (widthIsOk) {\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nint __fastcall TForm1::getMaximumStringLength(TLabel *lblPtr)\n{\n\tstatic const int kMaxLoop = 8;\n\tstatic const int kIncrease = 5;\n\n\tbool widthIsOk;\n\tint maxLen = 10;\n\n\tlblPtr->Caption = L\"1234567890\";\n\n\tint loop = 0;\n\twhile(loop < kMaxLoop) {\n\t\tlblPtr->Caption = lblPtr->Caption + L\"SAAAE\"; // [kIncrease]\u306b\u5408\u308f\u305b\u3066\u6587\u5b57\u3092\u7528\u610f\n\t\twidthIsOk = checkWidthIsLargeEnough(lblPtr);\n\t\tif (widthIsOk == false) {\n\t\t\tlblPtr->Caption = lblPtr->Caption.SubString(0, lblPtr->Caption.Length() - kIncrease);\n\t\t\tbreak;\n\t\t}\n\t\tmaxLen += kIncrease;\n\t\tloop++;\n\t}\n\n\treturn maxLen;\n}\n\nbool __fastcall TForm1::checkWidthIsLargeEnough(TLabel *lblPtr)\n{\n\tint orgWdt = lblPtr->Width;\n\n\t// to check\n\tlblPtr->AutoSize = true;\n\tint aftWdt = Label1->Width;\n\n\t// recover\n\tlblPtr->AutoSize = false;\n\tlblPtr->Width = orgWdt;\n\n\treturn (aftWdt < orgWdt);\n}\n```\n\n```txt:\u7d50\u679c\n\u30c7\u30d0\u30c3\u30b0\u51fa\u529b: Maxsize:30 \u30d7\u30ed\u30bb\u30b9 Project1.exe (752)\n```\n\n![qiita.png](https://qiita-image-store.s3.amazonaws.com/0/32870/1fff985e-098c-1521-ad23-7841cce7a10b.png)\n", "tags": ["cppBuilder", "TLabel"]}