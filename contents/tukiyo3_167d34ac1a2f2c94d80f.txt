{"context": "\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668\u3067\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\niptables\u3092\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\n\niptables\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u65bd\n\n/root/iptables/main.sh\n#!/bin/sh\nexport PATH=$PATH:/sbin\n\nclear() {\n    iptables -F -t filter\n    iptables -F -t nat\n    iptables -F -t mangle\n}\n\nlimit() {\n    PORT=$1\n    iptables -A INPUT -p tcp --dport $PORT -s 192.168.0.0/24 -j ACCEPT\n    iptables -A INPUT -p tcp --dport $PORT -s localhost -j ACCEPT\n    iptables -A INPUT -p tcp --dport $PORT -j DROP\n}\naccept() {\n    PORT=$1\n    iptables -A INPUT -p tcp --dport $PORT -j ACCEPT\n}\n\nclear\niptables -P INPUT DROP\nlimit 8006\naccept 22\n\n\n\n\u30eb\u30fc\u30eb\u3092\u624b\u52d5\u3067\u524a\u9664\u3059\u308b\u65b9\u6cd5\n# iptables -L --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination         \n1    ACCEPT     tcp  --  192.168.0.0/24      anywhere             tcp dpt:8006\n..\n# iptables -t filter -D INPUT 1\n\n\n\ncrontab\n@reboot /root/iptables/main.sh\n\n\n\nufw\u306e\u5834\u5408\nufw default deny\nufw allow from 192.168.0.0/24\nufw allow 22\nufw enable\n\n\n\niptables\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n\u73fe\u5728\u306e\u8a2d\u5b9a\u3092\u51fa\u529b\n# iptables-save > ~/iptables.8006\n\n\n\n~/iptables.8006\n  # Generated by iptables-save v1.4.14 on Thu Apr 17 06:23:06 2014\n  *mangle\n  :PREROUTING ACCEPT [15654:17658617]\n  :INPUT ACCEPT [15654:17658617]\n  :FORWARD ACCEPT [0:0]\n  :OUTPUT ACCEPT [9166:1523820]\n  :POSTROUTING ACCEPT [9166:1523820]\n  COMMIT\n  # Completed on Thu Apr 17 06:23:06 2014\n  # Generated by iptables-save v1.4.14 on Thu Apr 17 06:23:06 2014\n  *filter\n  :INPUT ACCEPT [15654:17658617]\n  :FORWARD ACCEPT [0:0]\n  :OUTPUT ACCEPT [9166:1523820]\n+ -A INPUT -p tcp --dport 8006 -s 11.22.33.44/32 -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -s 192.168.0.0/16 -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -s localhost -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -j DROP\n+ -A INPUT -j ACCEPT\n  COMMIT\n  # Completed on Thu Apr 17 06:23:06 2014\n\n\n11.22.33.44/32\u306f\u81ea\u5206\u306e\u4fe1\u983c\u3059\u308b\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\n\u52d5\u4f5c\u78ba\u8a8d\n# iptables-save < ~/iptables.8006\n# telnet localhost 8006\n\n\n\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\u518d\u8d77\u52d5\u5f8c\u3082iptables\u8a2d\u5b9a\u3092\u6709\u52b9\u306b\u3059\u308b\n\n\u8d77\u52d5\u6642\u306biptables\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install -y iptables-persistent\n\n\n\niptables-persistent\u306b\u767b\u9332\n# /etc/init.d/iptables-persistent save\nSaving rules... IPv4... IPv6...done.\n\n\n\n\u518d\u8d77\u52d5\u5f8c\u3082\u8a2d\u5b9a\u304c\u6709\u52b9\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n# reboot\n\u5f85\u3064\u3002\u3002\u3002\n# iptables -nL\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nACCEPT     tcp  --  11.22.33.44/32       0.0.0.0/0            tcp dpt:8006\nACCEPT     tcp  --  192.168.0.0/16       0.0.0.0/0            tcp dpt:8006\nACCEPT     tcp  --  127.0.0.1            0.0.0.0/0            tcp dpt:8006\nDROP       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:8006\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n/etc/iptables/rules.v4\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668\u3067\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u305f\u3081\niptables\u3092\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n# iptables\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u65bd\n\n```bash:/root/iptables/main.sh \n#!/bin/sh\nexport PATH=$PATH:/sbin\n\nclear() {\n    iptables -F -t filter\n    iptables -F -t nat\n    iptables -F -t mangle\n}\n\nlimit() {\n    PORT=$1\n    iptables -A INPUT -p tcp --dport $PORT -s 192.168.0.0/24 -j ACCEPT\n    iptables -A INPUT -p tcp --dport $PORT -s localhost -j ACCEPT\n    iptables -A INPUT -p tcp --dport $PORT -j DROP\n}\naccept() {\n    PORT=$1\n    iptables -A INPUT -p tcp --dport $PORT -j ACCEPT\n}\n\nclear\niptables -P INPUT DROP\nlimit 8006\naccept 22\n```\n\n```bash:\u30eb\u30fc\u30eb\u3092\u624b\u52d5\u3067\u524a\u9664\u3059\u308b\u65b9\u6cd5\n# iptables -L --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination         \n1    ACCEPT     tcp  --  192.168.0.0/24      anywhere             tcp dpt:8006\n..\n# iptables -t filter -D INPUT 1\n```\n\n```bash:crontab\n@reboot /root/iptables/main.sh\n```\n\n## ufw\u306e\u5834\u5408\n\n```\nufw default deny\nufw allow from 192.168.0.0/24\nufw allow 22\nufw enable\n```\n\n----\n\n# iptables\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\n```bash:\u73fe\u5728\u306e\u8a2d\u5b9a\u3092\u51fa\u529b\n# iptables-save > ~/iptables.8006\n```\n\n```diff:~/iptables.8006\n  # Generated by iptables-save v1.4.14 on Thu Apr 17 06:23:06 2014\n  *mangle\n  :PREROUTING ACCEPT [15654:17658617]\n  :INPUT ACCEPT [15654:17658617]\n  :FORWARD ACCEPT [0:0]\n  :OUTPUT ACCEPT [9166:1523820]\n  :POSTROUTING ACCEPT [9166:1523820]\n  COMMIT\n  # Completed on Thu Apr 17 06:23:06 2014\n  # Generated by iptables-save v1.4.14 on Thu Apr 17 06:23:06 2014\n  *filter\n  :INPUT ACCEPT [15654:17658617]\n  :FORWARD ACCEPT [0:0]\n  :OUTPUT ACCEPT [9166:1523820]\n+ -A INPUT -p tcp --dport 8006 -s 11.22.33.44/32 -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -s 192.168.0.0/16 -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -s localhost -j ACCEPT\n+ -A INPUT -p tcp --dport 8006 -j DROP\n+ -A INPUT -j ACCEPT\n  COMMIT\n  # Completed on Thu Apr 17 06:23:06 2014\n```\n\n`11.22.33.44/32`\u306f\u81ea\u5206\u306e\u4fe1\u983c\u3059\u308b\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n==============================\n\n```bash:\u52d5\u4f5c\u78ba\u8a8d\n# iptables-save < ~/iptables.8006\n# telnet localhost 8006\n```\n\n\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\n\u518d\u8d77\u52d5\u5f8c\u3082iptables\u8a2d\u5b9a\u3092\u6709\u52b9\u306b\u3059\u308b\n==============================\n\n```bash:\u8d77\u52d5\u6642\u306biptables\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install -y iptables-persistent\n```\n\n```bash:iptables-persistent\u306b\u767b\u9332\n# /etc/init.d/iptables-persistent save\nSaving rules... IPv4... IPv6...done.\n```\n\n```bash:\u518d\u8d77\u52d5\u5f8c\u3082\u8a2d\u5b9a\u304c\u6709\u52b9\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n# reboot\n\u5f85\u3064\u3002\u3002\u3002\n# iptables -nL\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nACCEPT     tcp  --  11.22.33.44/32       0.0.0.0/0            tcp dpt:8006\nACCEPT     tcp  --  192.168.0.0/16       0.0.0.0/0            tcp dpt:8006\nACCEPT     tcp  --  127.0.0.1            0.0.0.0/0            tcp dpt:8006\nDROP       tcp  --  0.0.0.0/0            0.0.0.0/0            tcp dpt:8006\nACCEPT     all  --  0.0.0.0/0            0.0.0.0/0\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n* /etc/iptables/rules.v4\n", "tags": ["proxmox", "iptables"]}