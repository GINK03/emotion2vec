{"context": "\n\nAWS\u306e\u8acb\u6c42\u91d1\u984d\u3092\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u305f\u3044\nAWS\u3092\u4f7f\u3044\u3059\u304e\u306a\u3044\u3088\u3046\u306b\u8acb\u6c42\u30a2\u30e9\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4f55\u304b\u3068\u6c17\u306b\u306a\u308b\u306e\u3067\u8acb\u6c42\u91d1\u984d\u3092\u5b9a\u671f\u7684\u306b\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3001\u305d\u306e\u5ea6\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u306e\u306f\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067\u3001\u300cAWS SDK for Android\u300d\u3092\u5229\u7528\u3057\u3066\u8acb\u6c42\u91d1\u984d\u3092\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3067\u304d\u308bAndroid\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nAmazon Cognito\u3067\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u6210\u3059\u308b\nAndroid\u30a2\u30d7\u30ea\u304b\u3089AWS\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001Cognito\u3067\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nIdentity Pool\u3092\u4f5c\u6210\u3059\u308b\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30e2\u30d0\u30a4\u30eb\u30b5\u30fc\u30d3\u30b9\uff1eCognito\u3088\u308a\u300cManage Federated Identities\u300d\u3092\u9078\u629e\u3057\u3066Identity Pool\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cIdentity pool name\u300d\u306b\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u3001\u8a8d\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u30e6\u30fc\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u300cEnable access to unauthenticated identities\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u307e\u3059\u3002\n\n\u30ed\u30fc\u30eb\u540d\u306b\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u3001IAM\u30ed\u30fc\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u300cIdentity Pool ID\u300d\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u5f8c\u3067\u30a2\u30d7\u30ea\u4f5c\u6210\u6642\u306b\u5229\u7528\u3059\u308b\u306e\u3067\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nCognito\u7528\u306eIAM\u30ed\u30fc\u30eb\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u304b\u3089Cloudwatch\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\nIAM\u3088\u308a\u30ed\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u3001CloudWatchFullAccess\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\uff08\u9069\u5b9c\u3001\u6700\u5c0f\u6a29\u9650\u3068\u306a\u308b\u30dd\u30ea\u30b7\u30fc\u306b\u7f6e\u304d\u63db\u3048\u3066\u4e0b\u3055\u3044\uff09\n\u4eca\u56de\u306f\u3001\u672a\u8a8d\u8a3c\u306e\u30a2\u30d7\u30ea\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3067\u3001Unauth\u7528\u306e\u30ed\u30fc\u30eb\u306b\u9069\u5207\u306a\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\n\nAndroid\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fCognito\u8a8d\u8a3c\u57fa\u76e4\u3092\u5229\u7528\u3057\u3066\u5b9f\u969b\u306b\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u300cAWS SDK for Android\u300d\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3059\u308b\n\u300cbuild.gradle\u300d\u306edependencies\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nbuild.gradle\ndependencies {\n    compile 'com.amazonaws:aws-android-sdk-cloudwatch:2.+'\n}\n\n\n\nuses-permission\u3092\u8a2d\u5b9a\u3059\u308b\nAndroid\u30a2\u30d7\u30ea\u304b\u3089AWS\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u300cAndroidManifest.xml\u300d\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nAndroidManifest.xml\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\n\n\n\nAmazonCloudWatchClient\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\nCloudWatch\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u306f\u300cAWS SDK for Android \u300d\u306e\u30b3\u30fc\u30c9\u30b5\u30f3\u30d7\u30eb\uff08https://aws.amazon.com/jp/sdkforandroid/\uff09\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001\u300cCOGNITO_POOL_ID\u300d\u5b9a\u6570\u306b\u306f\u3001\u5148\u307b\u3069\u30e1\u30e2\u3057\u3066\u304a\u3044\u305f\u300cIdentity Pool ID\u300d\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u306a\u3044\u5834\u5408\u306f\u3001\u300cRegions.AP_NORTHEAST_1\u300d\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nUtil.java\nimport android.content.Context;\nimport com.amazonaws.auth.CognitoCachingCredentialsProvider;\nimport com.amazonaws.regions.Regions;\nimport com.amazonaws.services.cloudwatch.AmazonCloudWatchClient;\n\npublic class Util {\n    public static final String COGNITO_POOL_ID = \"your Identity Pool ID\";\n\n    private static AmazonCloudWatchClient cloudWatchClient;\n    private static CognitoCachingCredentialsProvider sCredProvider;\n\n    private static CognitoCachingCredentialsProvider getCredProvider(Context context) {\n        if (sCredProvider == null) {\n            sCredProvider = new CognitoCachingCredentialsProvider(\n                    context.getApplicationContext(),\n                    COGNITO_POOL_ID,\n                    Regions.AP_NORTHEAST_1);\n        }\n        return sCredProvider;\n    }\n\n    public static AmazonCloudWatchClient getCloudWatchClient(Context context){\n        if(cloudWatchClient == null){\n            cloudWatchClient = new AmazonCloudWatchClient(getCredProvider(context.getApplicationContext()));\n        }\n        return cloudWatchClient;\n    }\n}\n\n\n\nCloudWatch API\u3092\u7528\u3044\u3066\u8acb\u6c42\u91d1\u984d\u3092\u53d6\u5f97\u3059\u308bTask\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\n\u300cAmazonCloudWatchClient\u300d\u304b\u3089CloudWatch API\u3092\u5229\u7528\u3057\u3066\u4eca\u6708\u306e\u8acb\u6c42\u91d1\u984d\u3092\u53d6\u5f97\u3059\u308bTask\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\nAndroid\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067http\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u884c\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306bCallable\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\nBillingInfoTask.java\nimport com.amazonaws.services.cloudwatch.AmazonCloudWatchClient;\nimport com.amazonaws.services.cloudwatch.model.Datapoint;\nimport com.amazonaws.services.cloudwatch.model.Dimension;\nimport com.amazonaws.services.cloudwatch.model.GetMetricStatisticsRequest;\nimport com.amazonaws.services.cloudwatch.model.GetMetricStatisticsResult;\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.Date;\nimport java.util.List;\nimport java.util.concurrent.Callable;\n\npublic class BillingInfoTask implements Callable<String> {\n\n    // AmazonCloudWatc\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n    private AmazonCloudWatchClient _cloudWatchClient;\n\n    public BillingInfoTask(AmazonCloudWatchClient cloudWatchClient) {\n        _cloudWatchClient = cloudWatchClient;\n    }\n\n    @Override\n    public String call() throws Exception {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n        GetMetricStatisticsRequest getMetricStatisticsRequest = new GetMetricStatisticsRequest();\n        Date date = new Date();\n        getMetricStatisticsRequest.setStartTime(new Date(date.getTime() - (24 * 3600 * 1 * 1000)));\n        getMetricStatisticsRequest.setEndTime(new Date());\n        getMetricStatisticsRequest.setMetricName(\"EstimatedCharges\");\n        getMetricStatisticsRequest.setNamespace(\"AWS/Billing\");\n        getMetricStatisticsRequest.setPeriod(86400);\n\n        Collection<String> statistics = new ArrayList<String>();\n        statistics.add(\"Maximum\");\n        getMetricStatisticsRequest.setStatistics(statistics);\n\n        // \u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n        Collection<Dimension> dimensions = new ArrayList<Dimension>();\n        Dimension currenctDimension = new Dimension();\n        currenctDimension.setName(\"Currency\");\n        currenctDimension.setValue(\"USD\");\n        dimensions.add(currenctDimension);\n\n        getMetricStatisticsRequest.setDimensions(dimensions);\n\n        // \u8acb\u6c42\u30e1\u30c8\u30ea\u30af\u30b9\u53d6\u5f97\n        GetMetricStatisticsResult getMetricStatisticsResult = _cloudWatchClient\n                .getMetricStatistics(getMetricStatisticsRequest);\n        List<Datapoint> dataPoints = getMetricStatisticsResult\n                .getDatapoints();\n\n        return dataPoints.get(0).getMaximum().toString();\n    }\n}\n\n\n\n\u30e1\u30a4\u30f3\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u3092\u5b9f\u88c5\u3059\u308b\n\u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u3001\u753b\u9762\u306b\u8acb\u6c42\u91d1\u984d\u3092\u8868\u793a\u3059\u308b\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4e00\u5fdc\u3001\u66f4\u65b0\u30dc\u30bf\u30f3\u3082\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\nMainActivity.java\nimport android.os.Bundle;\nimport android.support.v7.app.AppCompatActivity;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.TextView;\n\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\n\npublic class MainActivity extends AppCompatActivity {\n\n    // \u66f4\u65b0\u30dc\u30bf\u30f3\n    private Button updateBtn;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        init();\n    }\n\n    // \u521d\u671f\u51e6\u7406\n    private void init() {\n        // \u66f4\u65b0\u30dc\u30bf\u30f3\u767b\u9332\n        Button updateBtn = (Button) findViewById(R.id.update);\n        updateBtn.setOnClickListener(clicked);\n\n        // \u8acb\u6c42\u91d1\u984d\u8868\u793a\n        dispBillingCost();\n    }\n\n    // \u66f4\u65b0\u30dc\u30bf\u30f3\u62bc\u4e0b\u51e6\u7406\n    private View.OnClickListener clicked = new View.OnClickListener() {\n        public void onClick(View v) {\n            dispBillingCost();\n        }\n    };\n\n    // \u8acb\u6c42\u91d1\u984d\u51fa\u529b\u51e6\u7406\n    private void dispBillingCost() {\n        ExecutorService billingInfoService = Executors.newCachedThreadPool();\n        Future<String> billingInfoFuture = billingInfoService.submit(\n                new BillingInfoTask(Util.getCloudWatchClient(MainActivity.this)));\n\n        TextView billingTextView = (TextView) findViewById(R.id.billingCost);\n        try {\n            billingTextView.setText(billingInfoFuture.get());\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } catch (ExecutionException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n\n\n\u4ee5\u4e0a\u3067\u3001AWS\u306e\u8acb\u6c42\u91d1\u984d\u304c\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3067\u304d\u308b\uff08\u3060\u3051\u306e\uff09\u30a2\u30d7\u30ea\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n#AWS\u306e\u8acb\u6c42\u91d1\u984d\u3092\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u305f\u3044\nAWS\u3092\u4f7f\u3044\u3059\u304e\u306a\u3044\u3088\u3046\u306b\u8acb\u6c42\u30a2\u30e9\u30fc\u30e0\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4f55\u304b\u3068\u6c17\u306b\u306a\u308b\u306e\u3067\u8acb\u6c42\u91d1\u984d\u3092\u5b9a\u671f\u7684\u306b\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3001\u305d\u306e\u5ea6\u306b\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u306e\u306f\u9762\u5012\u304f\u3055\u304b\u3063\u305f\u306e\u3067\u3001\u300cAWS SDK for Android\u300d\u3092\u5229\u7528\u3057\u3066\u8acb\u6c42\u91d1\u984d\u3092\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3067\u304d\u308bAndroid\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n#Amazon Cognito\u3067\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u6210\u3059\u308b\nAndroid\u30a2\u30d7\u30ea\u304b\u3089AWS\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306b\u3001Cognito\u3067\u8a8d\u8a3c\u57fa\u76e4\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n##Identity Pool\u3092\u4f5c\u6210\u3059\u308b\nAWS\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30e2\u30d0\u30a4\u30eb\u30b5\u30fc\u30d3\u30b9\uff1eCognito\u3088\u308a\u300cManage Federated Identities\u300d\u3092\u9078\u629e\u3057\u3066Identity Pool\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n![WS000006.JPG](https://qiita-image-store.s3.amazonaws.com/0/83813/fd7e232a-9e27-4025-0029-39c12104a6ed.jpeg)\n\u300cIdentity pool name\u300d\u306b\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u3001\u8a8d\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u30e6\u30fc\u30b6\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u300cEnable access to unauthenticated identities\u300d\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u307e\u3059\u3002\n\n![WS000007.JPG](https://qiita-image-store.s3.amazonaws.com/0/83813/6f114ef3-ebd4-8a85-28fb-f66942013abf.jpeg)\n\u30ed\u30fc\u30eb\u540d\u306b\u4efb\u610f\u306e\u540d\u524d\u3092\u5165\u529b\u3057\u3066\u3001IAM\u30ed\u30fc\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n![WS000008.JPG](https://qiita-image-store.s3.amazonaws.com/0/83813/124ae1d6-70ab-db81-2e7d-08a97a46b08c.jpeg)\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u300cIdentity Pool ID\u300d\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u5f8c\u3067\u30a2\u30d7\u30ea\u4f5c\u6210\u6642\u306b\u5229\u7528\u3059\u308b\u306e\u3067\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n##Cognito\u7528\u306eIAM\u30ed\u30fc\u30eb\u306b\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fIAM\u30ed\u30fc\u30eb\u304b\u3089Cloudwatch\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n![WS000009.JPG](https://qiita-image-store.s3.amazonaws.com/0/83813/ddd9cbef-8577-42ed-83f7-18a76ccddb12.jpeg)\n\nIAM\u3088\u308a\u30ed\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u3001CloudWatchFullAccess\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\uff08\u9069\u5b9c\u3001\u6700\u5c0f\u6a29\u9650\u3068\u306a\u308b\u30dd\u30ea\u30b7\u30fc\u306b\u7f6e\u304d\u63db\u3048\u3066\u4e0b\u3055\u3044\uff09\n\u4eca\u56de\u306f\u3001\u672a\u8a8d\u8a3c\u306e\u30a2\u30d7\u30ea\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u3067\u3001Unauth\u7528\u306e\u30ed\u30fc\u30eb\u306b\u9069\u5207\u306a\u30dd\u30ea\u30b7\u30fc\u3092\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\n\n#Android\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fCognito\u8a8d\u8a3c\u57fa\u76e4\u3092\u5229\u7528\u3057\u3066\u5b9f\u969b\u306b\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n##\u300cAWS SDK for Android\u300d\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u53d6\u5f97\u3059\u308b\n\u300cbuild.gradle\u300d\u306edependencies\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```groovy:build.gradle\ndependencies {\n    compile 'com.amazonaws:aws-android-sdk-cloudwatch:2.+'\n}\n```\n## uses-permission\u3092\u8a2d\u5b9a\u3059\u308b\nAndroid\u30a2\u30d7\u30ea\u304b\u3089AWS\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u300cAndroidManifest.xml\u300d\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```xml:AndroidManifest.xml\n<uses-permission android:name=\"android.permission.INTERNET\" />\n<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\n```\n\n##AmazonCloudWatchClient\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\nCloudWatch\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u30bd\u30fc\u30b9\u306f\u300cAWS SDK for Android \u300d\u306e\u30b3\u30fc\u30c9\u30b5\u30f3\u30d7\u30eb\uff08[https://aws.amazon.com/jp/sdkforandroid/](https://aws.amazon.com/jp/sdkforandroid/)\uff09\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001\u300cCOGNITO_POOL_ID\u300d\u5b9a\u6570\u306b\u306f\u3001\u5148\u307b\u3069\u30e1\u30e2\u3057\u3066\u304a\u3044\u305f\u300cIdentity Pool ID\u300d\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u306a\u3044\u5834\u5408\u306f\u3001\u300cRegions.AP_NORTHEAST_1\u300d\u3092\u4fee\u6b63\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```java:Util.java\nimport android.content.Context;\nimport com.amazonaws.auth.CognitoCachingCredentialsProvider;\nimport com.amazonaws.regions.Regions;\nimport com.amazonaws.services.cloudwatch.AmazonCloudWatchClient;\n\npublic class Util {\n    public static final String COGNITO_POOL_ID = \"your Identity Pool ID\";\n\n    private static AmazonCloudWatchClient cloudWatchClient;\n    private static CognitoCachingCredentialsProvider sCredProvider;\n\n    private static CognitoCachingCredentialsProvider getCredProvider(Context context) {\n        if (sCredProvider == null) {\n            sCredProvider = new CognitoCachingCredentialsProvider(\n                    context.getApplicationContext(),\n                    COGNITO_POOL_ID,\n                    Regions.AP_NORTHEAST_1);\n        }\n        return sCredProvider;\n    }\n\n    public static AmazonCloudWatchClient getCloudWatchClient(Context context){\n        if(cloudWatchClient == null){\n            cloudWatchClient = new AmazonCloudWatchClient(getCredProvider(context.getApplicationContext()));\n        }\n        return cloudWatchClient;\n    }\n}\n```\n\n##CloudWatch API\u3092\u7528\u3044\u3066\u8acb\u6c42\u91d1\u984d\u3092\u53d6\u5f97\u3059\u308bTask\u30af\u30e9\u30b9\u3092\u5b9f\u88c5\u3059\u308b\n\u300cAmazonCloudWatchClient\u300d\u304b\u3089CloudWatch API\u3092\u5229\u7528\u3057\u3066\u4eca\u6708\u306e\u8acb\u6c42\u91d1\u984d\u3092\u53d6\u5f97\u3059\u308bTask\u30af\u30e9\u30b9\u3092\u4f5c\u308a\u307e\u3059\u3002\nAndroid\u306f\u30e1\u30a4\u30f3\u30b9\u30ec\u30c3\u30c9\u3067http\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u884c\u3063\u3066\u306f\u3044\u3051\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u5225\u30b9\u30ec\u30c3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306bCallable\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\n```java:BillingInfoTask.java\nimport com.amazonaws.services.cloudwatch.AmazonCloudWatchClient;\nimport com.amazonaws.services.cloudwatch.model.Datapoint;\nimport com.amazonaws.services.cloudwatch.model.Dimension;\nimport com.amazonaws.services.cloudwatch.model.GetMetricStatisticsRequest;\nimport com.amazonaws.services.cloudwatch.model.GetMetricStatisticsResult;\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.Date;\nimport java.util.List;\nimport java.util.concurrent.Callable;\n\npublic class BillingInfoTask implements Callable<String> {\n\n    // AmazonCloudWatc\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n    private AmazonCloudWatchClient _cloudWatchClient;\n\n    public BillingInfoTask(AmazonCloudWatchClient cloudWatchClient) {\n        _cloudWatchClient = cloudWatchClient;\n    }\n\n    @Override\n    public String call() throws Exception {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n        GetMetricStatisticsRequest getMetricStatisticsRequest = new GetMetricStatisticsRequest();\n        Date date = new Date();\n        getMetricStatisticsRequest.setStartTime(new Date(date.getTime() - (24 * 3600 * 1 * 1000)));\n        getMetricStatisticsRequest.setEndTime(new Date());\n        getMetricStatisticsRequest.setMetricName(\"EstimatedCharges\");\n        getMetricStatisticsRequest.setNamespace(\"AWS/Billing\");\n        getMetricStatisticsRequest.setPeriod(86400);\n\n        Collection<String> statistics = new ArrayList<String>();\n        statistics.add(\"Maximum\");\n        getMetricStatisticsRequest.setStatistics(statistics);\n\n        // \u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n        Collection<Dimension> dimensions = new ArrayList<Dimension>();\n        Dimension currenctDimension = new Dimension();\n        currenctDimension.setName(\"Currency\");\n        currenctDimension.setValue(\"USD\");\n        dimensions.add(currenctDimension);\n\n        getMetricStatisticsRequest.setDimensions(dimensions);\n\n        // \u8acb\u6c42\u30e1\u30c8\u30ea\u30af\u30b9\u53d6\u5f97\n        GetMetricStatisticsResult getMetricStatisticsResult = _cloudWatchClient\n                .getMetricStatistics(getMetricStatisticsRequest);\n        List<Datapoint> dataPoints = getMetricStatisticsResult\n                .getDatapoints();\n\n        return dataPoints.get(0).getMaximum().toString();\n    }\n}\n```\n\n##\u30e1\u30a4\u30f3\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u3092\u5b9f\u88c5\u3059\u308b\n\u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u3001\u753b\u9762\u306b\u8acb\u6c42\u91d1\u984d\u3092\u8868\u793a\u3059\u308b\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4e00\u5fdc\u3001\u66f4\u65b0\u30dc\u30bf\u30f3\u3082\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n```java:MainActivity.java\nimport android.os.Bundle;\nimport android.support.v7.app.AppCompatActivity;\nimport android.view.View;\nimport android.widget.Button;\nimport android.widget.TextView;\n\nimport java.util.concurrent.ExecutionException;\nimport java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\nimport java.util.concurrent.Future;\n\npublic class MainActivity extends AppCompatActivity {\n\n    // \u66f4\u65b0\u30dc\u30bf\u30f3\n    private Button updateBtn;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n        init();\n    }\n\n    // \u521d\u671f\u51e6\u7406\n    private void init() {\n        // \u66f4\u65b0\u30dc\u30bf\u30f3\u767b\u9332\n        Button updateBtn = (Button) findViewById(R.id.update);\n        updateBtn.setOnClickListener(clicked);\n\n        // \u8acb\u6c42\u91d1\u984d\u8868\u793a\n        dispBillingCost();\n    }\n\n    // \u66f4\u65b0\u30dc\u30bf\u30f3\u62bc\u4e0b\u51e6\u7406\n    private View.OnClickListener clicked = new View.OnClickListener() {\n        public void onClick(View v) {\n            dispBillingCost();\n        }\n    };\n\n    // \u8acb\u6c42\u91d1\u984d\u51fa\u529b\u51e6\u7406\n    private void dispBillingCost() {\n        ExecutorService billingInfoService = Executors.newCachedThreadPool();\n        Future<String> billingInfoFuture = billingInfoService.submit(\n                new BillingInfoTask(Util.getCloudWatchClient(MainActivity.this)));\n\n        TextView billingTextView = (TextView) findViewById(R.id.billingCost);\n        try {\n            billingTextView.setText(billingInfoFuture.get());\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        } catch (ExecutionException e) {\n            e.printStackTrace();\n        }\n    }\n}\n```\n\n![WS000011.JPG](https://qiita-image-store.s3.amazonaws.com/0/83813/39785ed4-4f20-5c61-a51b-c2ea32ee64e4.jpeg)\n\n\u4ee5\u4e0a\u3067\u3001AWS\u306e\u8acb\u6c42\u91d1\u984d\u304c\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3067\u304d\u308b\uff08\u3060\u3051\u306e\uff09\u30a2\u30d7\u30ea\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n", "tags": ["AWS", "cognito", "CloudWatch", "Android", "Java"]}