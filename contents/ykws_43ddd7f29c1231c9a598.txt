{"tags": ["Redmine", "Ruby"], "context": "\u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\n\napp/controllers/my_controller.rb\n  DEFAULT_LAYOUT = {  'left' => ['issuesassignedtome'],\n                      'right' => ['issuesreportedbyme']\n                   }.freeze\n\n\n\u8868\u793a\u3059\u308b\u6642\u306b\u30e6\u30fc\u30b6\u304c\u672a\u8a2d\u5b9a\u306e\u72b6\u614b\u306e\u6642\u306f\u3001\u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\napp/controllers/my_controller.rb\n  def index\n    page\n    render :action => 'page'\n  end\n\n  # Show user's page\n  def page\n    @user = User.current\n    @blocks = @user.pref[:my_page_layout] || DEFAULT_LAYOUT # <- \u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6e21\u3057\u3066\u3044\u308b\n  end\n\n\n\u8ffd\u52a0\u3059\u308b\u6642\u306b\u30e6\u30fc\u30b6\u304c\u672a\u8a2d\u5b9a\u306e\u72b6\u614b\u306e\u6642\u306f\u3001\u7a7a\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u3001\u8ffd\u52a0\u3057\u3066\u3044\u308b\u306e\u3067\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3002\n\napp/controllers/my_controller.rb\n  # Add a block to user's page\n  # The block is added on top of the page\n  # params[:block] : id of the block to add\n  def add_block\n    block = params[:block].to_s.underscore\n    if block.present? && BLOCKS.key?(block)\n      @user = User.current\n      layout = @user.pref[:my_page_layout] || {} # <- \u7a7a\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6e21\u3057\u3066\u3044\u308b\n      # remove if already present in a group\n      %w(top left right).each {|f| (layout[f] ||= []).delete block }\n      # add it on top\n      layout['top'].unshift block\n      @user.pref[:my_page_layout] = layout\n      @user.pref.save\n    end\n    redirect_to my_page_layout_path\n  end\n\n\n\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u306f\u826f\u3044\u3051\u3069\u3001\u3044\u304d\u306a\u308a\u6d88\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3082\u3046\u5c11\u3057\u898b\u305b\u65b9\u3092\u5de5\u592b\u3059\u308b\u4f59\u5730\u304c\u3042\u308a\u305d\u3046\u3002\n\u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u3066\n\n```ruby:app/controllers/my_controller.rb\n  DEFAULT_LAYOUT = {  'left' => ['issuesassignedtome'],\n                      'right' => ['issuesreportedbyme']\n                   }.freeze\n```\n\n\u8868\u793a\u3059\u308b\u6642\u306b\u30e6\u30fc\u30b6\u304c\u672a\u8a2d\u5b9a\u306e\u72b6\u614b\u306e\u6642\u306f\u3001\u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n```ruby:app/controllers/my_controller.rb\n  def index\n    page\n    render :action => 'page'\n  end\n\n  # Show user's page\n  def page\n    @user = User.current\n    @blocks = @user.pref[:my_page_layout] || DEFAULT_LAYOUT # <- \u521d\u56de\u8868\u793a\u7528\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6e21\u3057\u3066\u3044\u308b\n  end\n```\n\n\u8ffd\u52a0\u3059\u308b\u6642\u306b\u30e6\u30fc\u30b6\u304c\u672a\u8a2d\u5b9a\u306e\u72b6\u614b\u306e\u6642\u306f\u3001\u7a7a\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u3001\u8ffd\u52a0\u3057\u3066\u3044\u308b\u306e\u3067\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u3002\n\n```ruby:app/controllers/my_controller.rb\n  # Add a block to user's page\n  # The block is added on top of the page\n  # params[:block] : id of the block to add\n  def add_block\n    block = params[:block].to_s.underscore\n    if block.present? && BLOCKS.key?(block)\n      @user = User.current\n      layout = @user.pref[:my_page_layout] || {} # <- \u7a7a\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6e21\u3057\u3066\u3044\u308b\n      # remove if already present in a group\n      %w(top left right).each {|f| (layout[f] ||= []).delete block }\n      # add it on top\n      layout['top'].unshift block\n      @user.pref[:my_page_layout] = layout\n      @user.pref.save\n    end\n    redirect_to my_page_layout_path\n  end\n```\n\n\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u308b\u306e\u306f\u826f\u3044\u3051\u3069\u3001\u3044\u304d\u306a\u308a\u6d88\u3048\u3066\u3057\u307e\u3046\u306e\u3067\u3082\u3046\u5c11\u3057\u898b\u305b\u65b9\u3092\u5de5\u592b\u3059\u308b\u4f59\u5730\u304c\u3042\u308a\u305d\u3046\u3002\n"}