{"tags": ["Linux", "\u30b5\u30fc\u30d0\u30fc", "server", "\u30e1\u30e2\u30ea", "Cache"], "context": "\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u30e1\u30e2\u30ea\u304cslab_cache\u3067\u5360\u6709\u3055\u308c\u308b\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u30e1\u30e2\u30ea\u304c\u6570\u65e5\u3067slab_cache\u306b\u5360\u6709\u3055\u308c\u308b\u306e\u3067\u539f\u56e0\u3068\u5bfe\u7b56\u3092\u8abf\u67fb\u3057\u305f\u3002\n\n\u30e1\u30e2\u30ea\u306e\u4f7f\u7528\u72b6\u6cc1\u306e\u8abf\u67fb\n\nmeminfo\nmeminfo\u3092\u898b\u308b\u3068Slab\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002SReclaimable\u3068SUnreclaim\u3092\u8db3\u3059\u3068Slab\u306b\u306a\u308b\u3002\n$ cat /proc/meminfo | grep \"Slab\\|claim\"\nSlab:            1654520 kB\nSReclaimable:    1631304 kB\nSUnreclaim:        23216 kB\n\n\nslabtop\nslabtop\u30b3\u30de\u30f3\u30c9\u3092\u305f\u305f\u304f\u3068top\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306bSlab\u306e\u5185\u8a33\u304c\u8868\u793a\u3055\u308c\u308b\u3002dentry\u304c\u6700\u3082\u591a\u3044\u3088\u3046\u3060\u3002--once\u306f1\u56de\u51fa\u529b\u3067\u7d42\u4e86\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3002--sort=c\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30a4\u30ba\u9806\u306b\u30bd\u30fc\u30c8\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3002slabtop -o -s c\u3067\u3082\u540c\u69d8\u3002\n$ slabtop --once --sort=c | head -n 12\n Active / Total Objects (% used)    : 9220223 / 9293161 (99.2%)\n Active / Total Slabs (% used)      : 437042 / 437042 (100.0%)\n Active / Total Caches (% used)     : 65 / 89 (73.0%)\n Active / Total Size (% used)       : 1745015.88K / 1758078.67K (99.3%)\n Minimum / Average / Maximum Object : 0.01K / 0.19K / 8.00K\n\n  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME\n8990394 8990394 100%    0.19K 428114       21   1712456K dentry\n 22473  22473 100%    0.95K    681       33     21792K ext4_inode_cache\n103740  67048  64%    0.10K   2660       39     10640K buffer_head\n 52269  30144  57%    0.19K   2489       21      9956K kmalloc-192\n 10475   9953  95%    0.62K    419       25      6704K proc_inode_cache\n\n\nslabinfo\nslabinfo\u3092\u898b\u308b\u3068\u8a73\u7d30\u304c\u5206\u304b\u308b\u3002\n$ cat /proc/slabinfo | grep \"dentry\\|obj\"\n# name            <active_objs> <num_objs> <objsize> <objperslab> <pagesperslab> : tunables <limit> <batchcount> <sharedfactor> : slabdata <active_slabs> <num_slabs> <sharedavail>\ndentry            8662626 8662626    192   21    1 : tunables    0    0    0 : slabdata 412506 412506      0\n\n\u898b\u3065\u3089\u3044\u306e\u3067 awk \u3067\u52a0\u5de5\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n$ cat /proc/slabinfo | grep \"dentry\\|obj\" | awk '{ for (i=1; i<=NF; i++) { a[NR,i] = $i } } NF>p { p = NF } END { for(j=1; j<=p; j++) { str=a[1,j]; for(i=2; i<=NR; i++){ str=str\"\\t\"a[i,j-1]; } print str } }' | grep '<'\n<active_objs>   8662626\n<num_objs>      8662626\n<objsize>       192\n<objperslab>    21\n<pagesperslab>  1\n<limit> 0\n<batchcount>    0\n<sharedfactor>  0\n<active_slabs>  412506\n<num_slabs>     412506\n<sharedavail>   0\n\n\nsar\nsar\u30b3\u30de\u30f3\u30c9\u306b-v\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3068\u300c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u5185\u306e\u672a\u4f7f\u7528\u30ad\u30e3\u30c3\u30b7\u30e5\u30fb\u30a8\u30f3\u30c8\u30ea\u306e\u6570\u300d1\u3067\u3042\u308bdentunusd\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002dentunusd\u304cnegative dentry\u306e\u6570\u306b\u306a\u308b\u30022\n$ sar -v 0\n12:00:00 AM dentunusd   file-nr  inode-nr    pty-nr\n12:00:00 AM   8637647       768     40414         1\n\n\ndentry-state\nLinux 2.2\u4ee5\u964d\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5 (dcache) \u306e\u72b6\u614b\u306b\u95a2\u3059\u308b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u30023\n$ cat /proc/sys/fs/dentry-state\n9006589 8998515 45      0       0       0\n\nnr_dentry, nr_unused, age_limit, want_pages, \u30c0\u30df\u30fc, \u30c0\u30df\u30fc\u3001 \u3068\u3044\u30466\u3064\u306e\u6570\u5b57\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\nnr_dentry \u306f\u5272\u308a\u5f53\u3066\u3089\u308c\u305f dentry (dcache \u30a8\u30f3\u30c8\u30ea) \u306e\u6570\u3067\u3042\u308b\u3002 \u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Linux 2.2 \u3067\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\nnr_unused \u306f\u672a\u4f7f\u7528\u306e dentry \u6570\u3067\u3042\u308b\u3002\nage_limit \u306f\u3001\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u6b21\u306b dcache entry \u3092\u518d\u8981\u6c42\u3067\u304d\u308b\u3088\u3046\u306b \u306a\u308b\u307e\u3067\u306e\u6b8b\u308a\u6642\u9593 (\u79d2\u6570) \u3067\u3042\u308b\u3002\nwant_pages \u306f\u3001\u30b7\u30b9\u30c6\u30e0\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305f\u30da\u30fc\u30b8\u6570\u3002\u30ab\u30fc\u30cd\u30eb\u304c shrink_dcache_pages() \u3092\u547c\u3073\u51fa\u3057\u305f\u304c dcache \u304c\u307e\u3060\u7e2e\u5c0f\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306b\u30010 \u4ee5\u5916\u306e\u5024\u3068\u306a\u308b\u3002\n\n\nslab\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\n\u3068\u308a\u3042\u3048\u305adrop_caches\u306b2\u304b3\u3092\u66f8\u304d\u8fbc\u3081\u3070slab\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u89e3\u653e\u3055\u308c\u308b\u3002drop_caches\u306b\u66f8\u304d\u8fbc\u307f\u3059\u308b\u524d\u306bsync\u3092\u5b9f\u884c\u3059\u308b\u3068\u3088\u308a\u591a\u304f\u89e3\u653e\u3067\u304d\u308b4\u3002\n\n\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\nsync; echo 1 > /proc/sys/vm/drop_caches\n\n\n\nslab\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(dentry\u3068inode\u3092\u542b\u3080)\u306e\u89e3\u653e\nsync; echo 2 > /proc/sys/vm/drop_caches\n\n\n\nslab\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\nsync; echo 3 > /proc/sys/vm/drop_caches\n\n\n\u3057\u304b\u3057\u3001\u89e3\u653e\u5f8c\u518d\u3073\u9806\u8abf\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5897\u6b96\u3059\u308b\u3002\n\n\u3061\u306a\u307f\u306bdrop_caches\u306b0\u3092\u66f8\u304d\u8fbc\u3093\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u72b6\u614b\u306b\u623b\u3059\u3068\u3044\u3046\u8da3\u65e8\u306e\u8a18\u4e8b5\u304c\u6563\u898b\u3055\u308c\u308b\u304c\u3001\u7121\u8996\u3055\u308c\u308b\u3060\u3051\u3067\u610f\u5473\u304c\u306a\u3044\u3088\u3046\u30606\u3002\n\n\u89e3\u6c7a\u7b56\ncron\u3067\u4e0a\u8a18\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u89e3\u653e\u3092\u5b9a\u671f\u5b9f\u884c\u3055\u305b\u308b\u8a18\u4e8b7\u304c\u591a\u304b\u3063\u305f\u304c\u3001\u305d\u3082\u305d\u3082\u305d\u3093\u306a\u3093\u3067\u3044\u3044\u306e\u304b\u3002\n\u3082\u3046\u5c11\u3057\u6839\u672c\u7684\u306a\u5bfe\u5fdc\u306f\u306a\u3044\u306e\u304b\u3068\u3055\u3089\u306b\u8abf\u3079\u305f\u7d50\u679c\u3001/etc/sysconfig/httpd\u306bTMPDIR=/dev/shm \u3092\u6307\u5b9a\u3059\u308b\u304b NSS_SDB_USE_CACHE=YES\u3092\u6307\u5b9a\u3059\u308b\u304b\u306e2\u629e\u304c\u3042\u308b\u6a21\u69d8\u3002\n\ntmpfs\n\n/etc/sysconfig/httpd\nexport TMPDIR=/dev/shm\n\n\n$ echo $TMPDIR\n/dev/shm\n$ php -r 'echo sys_get_temp_dir(),\"\\n\";'\n/dev/shm\n\n\nNSS_SDB_USE_CACHE\nNSS_SDB_USE_CACHE\u306fNSS Softoken\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c3.16.0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u306a\u306e\u3067yum list nss-softokn\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u305f\u3060\u3001NSS_SDB_USE_CACHE\u306f\u300c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u3068\u5b9f\u306fNO\u306e\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u306a\u6c17\u304c\u3057\u305f\u3002NFS\u3092\u4f7f\u3063\u3066\u306a\u3044\u9650\u308aNO\u3067\u3088\u3044\u3002\u300d8\u3068\u8a00\u3063\u3066\u3044\u308b\u4eba\u3082\u3044\u308b\u3002\n\n/etc/sysconfig/httpd\nexport NSS_SDB_USE_CACHE=YES\n\n\n\n\u305d\u3082\u305d\u3082slab_cache\u3063\u3066\u306a\u306b\n\nslab\u30ad\u30e3\u30c3\u30b7\u30e5\n\n\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf9\n\ninode\u3084dentry\u306a\u3069\u3001\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u300210\n\n\u30ab\u30fc\u30cd\u30eb\u306f\u3001\u30e1\u30e2\u30ea\u306e\u5229\u7528\u52b9\u7387\u3092\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u7a7a\u9593\u5185\u306e\u3055\u307e\u3056\u307e\u306a \u30e1\u30e2\u30ea\u8cc7\u6e90\u3092\u3001\u8cc7\u6e90\u3054\u3068\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u4ed5\u7d44\u307f\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3092\u300c\u30b9\u30e9\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u3068\u547c\u3073\u307e\u3059\u300211\n\nSlab\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308bdentry\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308binode\u69cb\u9020\u4f53\u306a\u3069\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u30ab\u30fc\u30cd\u30eb\u5185\u306e\u30e1\u30e2\u30ea\u9818\u57df\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u306f\u5225\u306b\u30ab\u30fc\u30cd\u30eb\u306e\u4e2d\u306b\u78ba\u4fdd\u3055\u308c\u3066\u304a\u308a\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u540c\u671f\u3057\u3066\u3044\u308c\u3070\u89e3\u653e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u300212\n\nkernel\u306eslab\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u306fSReclaimable(\u56de\u53ce\u53ef\u80fd)\u3068SUnreclaim(\u56de\u53ce\u4e0d\u53ef)\u306a\u3082\u306e\u304c\u3042\u308b\u3002/proc/meminfo\u3092cat\u3059\u308b\u3068\u73fe\u5728\u306e\u30b9\u30e9\u30d6\u306e\u4f7f\u7528\u72b6\u6cc1\u304c\u308f\u304b\u308b\u300213\n\nLinux\u306b\u304a\u3044\u3066\u3001\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u672a\u6e80\u306e\u30e1\u30e2\u30ea\u306fSLAB\uff08\u30b9\u30e9\u30d6\uff09\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002SLAB\u306f\u3001\u30e1\u30e2\u30ea\u5272\u308a\u5f53\u3066\u6642\u3001\u90e8\u5206\u7684\u306b\u4f7f\u7528\u4e2d\u306e\u30da\u30fc\u30b8\u304c\u3042\u308c\u3070\u305d\u3053\u304b\u3089\u512a\u5148\u7684\u306b\u30e1\u30e2\u30ea\u3092\u5272\u308a\u5f53\u3066\u308b\u4ed5\u7d44\u307f\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u305f\u3081\u3001SLAB\u3092\u7528\u3044\u305f\u78ba\u4fdd\u3068\u89e3\u653e\u304c\u4ea4\u4e92\u306b\u52d5\u3044\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3067\u306f\u3001\u7121\u99c4\u306a\u9818\u57df\u306f\u307b\u3068\u3093\u3069\u767a\u751f\u3057\u307e\u305b\u3093\u3002\u3057\u304b\u3057\u3001\u30e1\u30e2\u30ea\u78ba\u4fdd\u304c\u975e\u5e38\u306b\u305f\u304f\u3055\u3093\u9023\u7d9a\u3057\u3066\u767a\u751f\u3057\u305f\u5f8c\u306b\u3001\u30e1\u30e2\u30ea\u89e3\u653e\u304c\u3053\u308c\u307e\u305f\u9023\u7d9a\u3057\u3066\u767a\u751f\u3059\u308b\u3068\u3001\u90e8\u5206\u7684\u306b\u4f7f\u7528\u4e2d\u306e\u30e1\u30e2\u30ea\u304c\u5927\u91cf\u306b\u3067\u304d\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u304cSLAB\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u547c\u3070\u308c\u308b\u554f\u984c\u3067\u3059\u3002SLAB\u306e\u30d8\u30d3\u30fc\u30e6\u30fc\u30b6\u30fc\u306b\u306f\u3001inode\u30ad\u30e3\u30c3\u30b7\u30e5\u3068dentry\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30d1\u30b9\u540d\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3082\u306e\u3067\u3059\u304c\u3001\u4e0d\u5e78\u306a\u3053\u3068\u306b\u3053\u306e2\u3064\u3067\u306f\u3001find\u3084updatedb\u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u7c21\u5358\u306b\u4e0a\u8a18\u306e\u30ef\u30fc\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u300214\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u7528\u3059\u308b\u69cb\u9020\u4f53\uff08\u5358\u306b\u666e\u901a\u306e\u5909\u6570\u3067\u3082\u304b\u307e\u3044\u307e\u305b\u3093\uff09\u3068\u306a\u308a\u307e\u3059\u3002\u30ab\u30fc\u30cd\u30eb\u304c\u5b9f\u969b\u306b\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f7f\u7528\u3059\u308b\u306e\u304c\u201d\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u201d\u5358\u4f4d\u3068\u306a\u308a\u3001\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u306e\u5272\u308a\u5f53\u3066/\u89e3\u653e\u3092\u884c\u3046\u5358\u4f4d\u3082\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5358\u4f4d\u3068\u306a\u308a\u307e\u3059\u3002\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u3067\u306f\u4e00\u756a\u5c0f\u3055\u3044\u62ec\u308a\u3068\u306a\u308a\u307e\u3059\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4e00\u3064\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u4e00\u62ec\u308a\u306b\u3057\u305f\u3082\u306e\u304c\u201d\u30b9\u30e9\u30d6\u201d\u3068\u306a\u308a\u307e\u3059\u3002\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u3067\u306f\u30b9\u30e9\u30d6\u5358\u4f4d\u3067\u30b9\u30e9\u30d6\u5185\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5b8c\u5168\u306b\u5272\u308a\u5f53\u3066\u6e08\u307f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u90e8\u304c\u5272\u308a\u5f53\u3066\u6e08\u307f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5168\u3066\u304c\u5b8c\u5168\u306b\u30d5\u30ea\u30fc\u3068\u3044\u3063\u305f\u72b6\u614b\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u300215\n\n\n\n\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf (slab allocator)\n\nSunOS\u306e\u305f\u3081\u306b\u30b8\u30a7\u30d5\u30fb\u30dc\u30f3\u30a6\u30a3\u30c3\u30af(Jeff Bonwick)\u304c\u5c0e\u5165\u3057\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3002\u30b8\u30a7\u30d5\u306f\u901a\u5e38\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5272\u308a\u632f\u308a\u3068\u5ec3\u68c4\u306b\u591a\u304f\u306e\u6642\u9593\u304c\u8cbb\u3084\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u767a\u898b\u3002\u30e1\u30e2\u30ea\u30fc\u3092\u89e3\u653e\u3057\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u30d7\u30fc\u30eb\u306b\u8fd4\u5374\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u305d\u306e\u7528\u9014\u3067\u521d\u671f\u5316\u3055\u308c\u305f\u307e\u307e\u306e\u72b6\u614b\u3067\u4fdd\u6301\u3057\u3066\u518d\u5229\u7528\u3059\u308b\u65b9\u5f0f\u3092\u767a\u6848\u300213\n\n\n\ninode\n\ndentry\u30ad\u30e3\u30c3\u30b7\u30e5\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\u300216\n\ndentry \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001RAM \u3088\u308a\u4f4e\u901f\u306a HDD \u3084 SSD \u306a\u3069\u306e\u3001\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304b\u3089\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304d\u3001\u9ad8\u901f\u5316\u3059\u308b\u3082\u306e\u3067\u3059\u300217\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020\u3001\u307e\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3068inode\u60c5\u5831\u3092\u95a2\u9023\u4ed8\u3051\u308b\u3082\u306e\uff08\u69cb\u9020\u4f53\uff09\u3089\u3057\u3044\u3002dentry_cache\u306f\u3001\u305d\u308c\u3089\u306e\u60c5\u5831\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3060\u3068\u601d\u3063\u3066\u826f\u3055\u305d\u3046\u3002\u307e\u305fdentry_cache\u306f\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u60c5\u5831\uff08inode\u3092\u6301\u305f\u306a\u3044dentry\uff09\u306a\u3093\u304b\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\uff08\u3053\u308c\u3092negative dentry\u3068\u3044\u3046\u3089\u3057\u3044\uff09\u3002negative dentry\u306f\u3001sar\u30b3\u30de\u30f3\u30c9\uff08-v\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\u3067\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u300218\n\ndentry cache\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u540d\u3068inode\u3068\u3092\u7d50\u3073\u3064\u3051\u306b\u4f7f\u308f\u308c\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3067\u3059\u3002dentry cache\u304c\u3069\u306e\u7a0b\u5ea6\u3042\u308b\u306e\u304b\u306f\u3001slabtop\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u78ba\u8a8d\u3067\u304d\u307e\u3059\u300219\n\n\n\n\u53c2\u7167\u60c5\u5831\nhttps://www.kernel.org/doc/Documentation/sysctl/vm.txt\n\n//www.kernel.org/doc/Documentation/sysctl/vm.txt\ndrop_caches\n\nWriting to this will cause the kernel to drop clean caches, as well as\nreclaimable slab objects like dentries and inodes.  Once dropped, their\nmemory becomes free.\n\nTo free pagecache:\n    echo 1 > /proc/sys/vm/drop_caches\nTo free reclaimable slab objects (includes dentries and inodes):\n    echo 2 > /proc/sys/vm/drop_caches\nTo free slab objects and pagecache:\n    echo 3 > /proc/sys/vm/drop_caches\n\nThis is a non-destructive operation and will not free any dirty objects.\nTo increase the number of objects freed by this operation, the user may run\n`sync' prior to writing to /proc/sys/vm/drop_caches.  This will minimize the\nnumber of dirty objects on the system and create more candidates to be\ndropped.\n\nThis file is not a means to control the growth of the various kernel caches\n(inodes, dentries, pagecache, etc...)  These objects are automatically\nreclaimed by the kernel when memory is needed elsewhere on the system.\n\nUse of this file can cause performance problems.  Since it discards cached\nobjects, it may cost a significant amount of I/O and CPU to recreate the\ndropped objects, especially if they were under heavy use.  Because of this,\nuse outside of a testing or debugging environment is not recommended.\n\nYou may see informational messages in your kernel log when this file is\nused:\n\n    cat (1234): drop_caches: 3\n\nThese are informational only.  They do not mean that anything is wrong\nwith your system.  To disable them, echo 4 (bit 3) into drop_caches.\n\n\nDelete clean cache to free up memory on your slow Linux server, VPS - blackMORE Ops\n# crontab -e\n0 * * *  * sync; echo 3 > /proc/sys/vm/drop_caches\n\nhttp://futuremix.org/2009/09/clear-linux-memory-cach\nLinux \u306e top \u30b3\u30de\u30f3\u30c9\u3084 free \u30b3\u30de\u30f3\u30c9\u3067\u8868\u793a\u3055\u308c\u308b cached \u306f\u3001\u52dd\u624b\u306b\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u304d\u307e\u3059\u3002free \u304c\u306a\u304f\u306a\u308b\u3068\u3053\u306e cached \u304c\u5c11\u3057\u305a\u3064\u89e3\u653e\u3055\u308c\u3066\u4f7f\u308f\u308c\u307e\u3059\u3002\n\ncached \u3082 buffers \u3082\u7a7a\u304d\u30e1\u30e2\u30ea\u306e\u4e00\u90e8\u3067\u3059\u306e\u3067\u3001\u3053\u308c\u3089\u304c\u6e9c\u307e\u3063\u3066\u3044\u308b\u304b\u3089\u3068\u3044\u3063\u3066\u7121\u7406\u3084\u308a\u89e3\u653e\u3055\u305b\u308b\u5fc5\u8981\u306f\u901a\u5e38\u306f\u3042\u308a\u307e\u305b\u3093\u3002cached \u3092\u6e9c\u3081\u3066\u3044\u308b\u306e\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u305f\u3081\u306a\u306e\u3067\u3001\u89e3\u653e\u3055\u305b\u308b\u3068\u901a\u5e38\u4f7f\u7528\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u307e\u3059\u3002\u9006\u306b\u3053\u308c\u3092\u89e3\u653e\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6e2c\u5b9a\u306a\u3069\u3067\u3001\u6b63\u3057\u3044\u8a08\u6e2c\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n\nkernel \u306e 2.6.16 \u4ee5\u964d\u3067\u306f\u3001\u89e3\u653e\u3092\u30b3\u30de\u30f3\u30c9\u304b\u3089\u89e3\u653e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nhttp://blog.nomadscafe.jp/2014/01/tmpfile-and-dentry-cache.html\ndentry cache\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u540d\u3068inode\u3068\u3092\u7d50\u3073\u3064\u3051\u306b\u4f7f\u308f\u308c\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3067\u3059\u3002\n\ndentry cache\u304c\u3069\u306e\u7a0b\u5ea6\u3042\u308b\u306e\u304b\u306f\u3001slabtop\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\ndentry cache\u306f\u30e1\u30e2\u30ea\u304c\u5fc5\u8981\u306b\u306a\u308c\u3070\u89e3\u653e\u3055\u308c\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u305d\u306e\u691c\u8a3c\u306e\u305f\u3081\u3001\u3082\u3046\u4e00\u3064\u30e1\u30e2\u30ea\u3092\u5927\u91cf\u306b\u4f7f\u3046\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u307e\u305f\u3001dstat\u3067\u89b3\u5bdf\u3059\u308b\u3068\u3001\u306a\u3093\u3068\u3001swap\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\ndentry cache\u3092\u89e3\u653e\u3059\u308b\u30b9\u30d4\u30fc\u30c9\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u306e\u304b\u3001\u4e00\u90e8\u306e\u30e1\u30e2\u30ea\u304cswap\u306b\u8ffd\u3044\u51fa\u3055\u308c\u3001\u3055\u3089\u306b\u5f90\u3005\u306bswap\u304c\u5897\u3048\u3066\u884c\u304f\u308b\u7d50\u679c\u3068\u306a\u308a\u307e\u3057\u305f\u3002\n\nvm.vfs_cache_pressure \u3092\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\n$ sudo /sbin/sysctl -w vm.vfs_cache_pressure=10000\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306f100\u3067\u3001\u6570\u5b57\u3092\u5927\u304d\u304f\u3059\u308b\u3068\u65e9\u3081\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u89e3\u653e\u3059\u308b\u3088\u3046\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u304b\u306a\u308a\u5927\u304d\u306a\u6570\u5b57\u306b\u3057\u3066\u3082\u30b5\u30fc\u30d3\u30b9\u306e\u672c\u756a\u74b0\u5883\u3067\u306f\u76ee\u7acb\u3063\u305f\u5909\u5316\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\ntmpfs\u3060\u3068\u3001dentry cache\u306f\u6e9c\u307e\u3089\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u74b0\u5883\u5909\u6570TMPDIR\u306btmpfs\u3092\u6307\u5b9a\u3057\u3066\u5148\u307b\u3069\u306escript\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ TMPDIR=/dev/shm perl mktmp.pl\n\u307e\u305fdstat\u3067\u89b3\u5bdf\u3059\u308b\u3068\u3001\u30e1\u30e2\u30ea\u304c\u5897\u3048\u3066\u884c\u304b\u306a\u3044\u306e\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001tmpfs\u304cLinux\u306eVFS\u3092\u4f7f\u308f\u306a\u3044\u304b\u3089\u3067\u3057\u3087\u3046\u304b\u3002\n\u3053\u3053\u307e\u3067\u5206\u304b\u3063\u305f\u306e\u3067\u3001Apache\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306b\nexport TMPDIR=/dev/shm\n\u3092\u8ffd\u52a0\u3057\u3066\u518d\u8d77\u52d5\u3057\u305f\u3068\u3053\u308d\u3001\u30b5\u30fc\u30d0\u304c\u5b89\u5b9a\u3057\u3066\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\ndentry cache\u306b\u3088\u308a\u30e1\u30e2\u30ea\u304c\u5727\u8feb\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\ntmpfs\u3092\u4f7f\u3046\u3068dentry cache\u306f\u6e9c\u307e\u3089\u306a\u3044\nTMPDIR\u74b0\u5883\u5909\u6570\u3067\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\u306f\u5909\u66f4\u51fa\u6765\u308b\n\nhttp://d.hatena.ne.jp/hiboma/20140212/1392131530\nnegative dentry \u3068\u306f \u5b58\u5728\u3057\u306a\u3044 inode \u306b\u5bfe\u5fdc\u3059\u308b dentry \u3067\u3059\u3002\n\ndentry \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001RAM \u3088\u308a\u4f4e\u901f\u306a HDD \u3084 SSD \u306a\u3069\u306e\u3001\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304b\u3089\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304d\u3001\u9ad8\u901f\u5316\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\n\u4e00\u65b9\u3001negative dentry \u306f \u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3001\u9ad8\u901f\u5316\u3057\u307e\u3059\u3002\n\n\u300c\u5b58\u5728\u3057\u306a\u3044\u306e\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\uff1f\u300d\u304c\u3057\u3070\u3089\u304f\u30a4\u30df\u30d5\u3060\u3063\u305f\u306e\u3067\u3057\u305f\u304c\u3001DNS \u306e\u30cd\u30ac\u30c6\u30a3\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u52d5\u4f5c\u306b\u4f3c\u3066\u3044\u308b\u306a\u3068\u601d\u3044\u307e\u3057\u305f (\u5b58\u5728\u3057\u306a\u3044\u30ec\u30b3\u30fc\u30c9\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u554f\u3044\u5408\u308f\u305b\u3092\u6e1b\u3089\u3057\u9ad8\u901f\u5316\u3059\u308b)\n\nslabtop \u3067\u306f\u901a\u5e38\u306e dentry \u306a\u306e\u304b negative dentry \u306a\u306e\u304b\u5224\u5225\u3067\u304d\u307e\u305b\u3093 ...\n\nsar -w \u3067\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059 ( negative entry \u306f dentunusd \u306b\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059 )\n\n/tmp \u306b\u540c\u3058\u30d1\u30b9\u540d\u3067\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3084\u524a\u9664\u3092\u7e70\u308a\u8fd4\u3059\u3088\u3046\u306a\u30b1\u30fc\u30b9\u3084\u3001Perl\u3084Ruby\u306e\u3088\u3046\u306a\u8a00\u8a9e\u306e\u30e9\u30a4\u30d6\u30e9\u30ea/\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u63a2\u7d22 (\u4f8b: Perl \u304c\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u63a2\u3059\u305f\u3081\u306b @INC\u914d\u5217\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7fa4\u3092\u8d70\u67fb\u3059\u308b\u969b\u3001\u5b58\u5728\u3057\u306a\u3044\u30d1\u30b9\u306b\u3082 open(2) \u3057\u307e\u304f\u3063\u3066\u63a2\u3057\u3066\u3044\u308b ) \u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u3092\u6bce\u56de HDD \u306b\u554f\u3044\u5408\u308f\u305b\u3066\u3044\u308b\u3068 I/O \u307e\u304f\u308a\u3067\u9045\u305d\u3046\u3067\u3059\u3088\u306d\u3002\u3053\u3053\u3067\u3001 negative dentry \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u6709\u52b9\u306b\u4f5c\u7528\u3057\u3066\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u4e00\u65b9\u3067 File::Temp \u306e tmpfile() \u306e\u3088\u3046\u306b\u30e9\u30f3\u30c0\u30e0\u306a\u30d1\u30b9\u3092\u751f\u6210\u3057\u540c\u4e00\u30d1\u30b9\u306e\u518d\u5229\u7528\u3092\u907f\u3051\u308b\u30b1\u30fc\u30b9\u3068\u76f8\u6027\u304c\u60aa\u3044\u3053\u3068\u306f kazeburo \u3055\u3093\u306e\u30d6\u30ed\u30b0\u3067\u3082\u5b9f\u8a3c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\ntmpfs \u3067\u306f negative dentry \u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u307e\u305b\u3093\u3002 unlink/rmdir \u3059\u308b\u3068 dentry \u306f\u3059\u3050\u306b\u7834\u68c4\u3055\u308c\u307e\u3059\u3002\n\ntmpfs \u3067\u306f \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30fc\u30bf(inode\u60c5\u5831\u306a\u3069) \u306f\u30e1\u30e2\u30ea(\u30da\u30fc\u30b8)\u4e0a\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u3066\u9ad8\u901f\u306b\u63a2\u7d22\u3067\u304d\u307e\u3059\u3002\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304c\u7121\u3044\u306e\u3067\u3001\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u3092\u901f\u304f\u63a2\u3059\u305f\u3081\u306e negative dentry \u306f\u7121\u304f\u3066\u3082\u3044\u3044\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3059\u306d\u3002\n\next3 \u3084 ext4 \u306a\u3069\u3067\u306f .d_delete \u306f\u7279\u306b\u5b9f\u88c5\u3055\u308c\u3066\u304a\u3089\u305a\u3001negative dentry \u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3088\u3046\u3067\u3059\n\nhttp://s-tajima.hateblo.jp/entry/2015/02/20/233615\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5185\u3067https\u306b\u3088\u308b\u5916\u90e8API\u3092\u53e9\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d0\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5897\u52a0\u3057\u7d9a\u3051\u308b\u4ef6\u306b\u3064\u3044\u3066\u8abf\u3079\u305f\u3002\n\n\u8abf\u67fb\u3059\u308b\u3068\u3001\u3053\u306e\u30d0\u30b0\u4ed5\u69d8\u3092\u8e0f\u3093\u3067\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u308f\u308c\u308b\u30da\u30fc\u30b8\u3092\u898b\u3064\u3051\u305f\u3002\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1044666\n\n\u5185\u5bb9\u3068\u3057\u3066\u306f\u3001curl\u3092\u5b9f\u884c\u3057\u305f\u969b\u306b\n/etc/pki/nssdb/\u4ee5\u4e0b\u306e\u5b58\u5728\u3057\u306a\u3044\u30d5\u30a1\u30a4\u30eb(\u6bce\u56de\u9055\u3046\u30d1\u30b9)\u306b\u5bfe\u3057\u3066access\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u304c\u5927\u91cf\u306b\u30b3\u30fc\u30eb\u3055\u308c\u3001\nnegative dentry cache\u304c\u6e9c\u307e\u3063\u3066\u3044\u304d\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5727\u8feb\u3055\u308c\u308b\u3068\u3044\u3046\u3082\u306e\u3002\n\n\u306a\u305c\u3053\u3093\u306a\u3053\u3068\u306b\u306a\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\nhttps://hg.mozilla.org/projects/nss/file/4d876e0ee318/security/nss/lib/softoken/sdb.c#l372\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u6027\u80fd\u3092\u691c\u67fb\u3057\u3066\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\u304b\u3069\u3046\u304b\u306e\u5224\u65ad\u3092\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3002\n\n\u5bfe\u5fdc\u3068\u3057\u3066\u306f\u3001\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1044666#c8\n\u3053\u306e\u30d1\u30c3\u30c1\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3001NSS_SDB_USE_CACHE\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u3066\u3001\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u691c\u67fb\u3092\u305b\u305a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u3088\u3046\u3060\u3002\n\n$ export NSS_SDB_USE_CACHE=yes \u203bphp\u306e\u30b3\u30fc\u30c9\u5185\u3067putenv(\"NSS_SDB_USE_CACHE=yes\u201d)\u3067\u3082\u3088\u3044\u3002\n$ strace -fc -e trace=access php test.php\n% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n  -nan    0.000000           0        12         7 access\n------ ----------- ----------- --------- --------- ----------------\n100.00    0.000000                    12         7 total\n\u6539\u5584\u3055\u308c\u305f\u3002\n\nhttps://github.com/hiboma/hiboma/blob/master/kernel/dentry_cache.md\ndentry \u306f4\u3064\u306e\u72b6\u614b\u3092\u3082\u3064\n* free\n* nonused\n* used\n* negative\nnegative \u306f DNS\u306e\u30cd\u30ac\u30c6\u30a3\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3088\u304f\u4f3c\u3066\u3044\u308b ( \u5b58\u5728\u3057\u306a\u3044 \u30ec\u30b3\u30fc\u30c9\u306elookup \u3092\u9ad8\u901f\u5316)\n\n\ndentry \u306e\u4f7f\u7528\u91cf/\u6570\u3092\u8abf\u3079\u308b\n\nslabtop\n/proc/sys/fs/dentry-state\n\n/proc/sys/fs/dentry-state (Linux 2.2 \u4ee5\u964d)\n  \u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5 (dcache) \u306e\u72b6\u614b\u306b\u95a2\u3059\u308b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n  \u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001 nr_dentry, nr_unused, age_limit (\u79d2\u5358\u4f4d\u306e age), want_pages (\u30b7\u30b9\u30c6\u30e0\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305f\u30da\u30fc\u30b8\u6570), \u30c0\u30df\u30fc\u306e 2 \u3064\u306e\u5024\u3001 \u3068\u3044\u3046 6 \u3064\u306e\u6570\u5b57\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n * nr_dentry \u306f\u5272\u308a\u5f53\u3066\u3089\u308c\u305f dentry (dcache \u30a8\u30f3\u30c8\u30ea) \u306e\u6570\u3067\u3042\u308b\u3002 \u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Linux 2.2 \u3067\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\n * nr_unused \u306f\u672a\u4f7f\u7528\u306e dentry \u6570\u3067\u3042\u308b\u3002\n * age_limit \u306f\u3001\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u6b21\u306b dcache entry \u3092\u518d\u8981\u6c42\u3067\u304d\u308b\u3088\u3046\u306b \u306a\u308b\u307e\u3067\u306e\u6b8b\u308a\u6642\u9593 (\u79d2\u6570) \u3067\u3042\u308b\u3002\n * want_pages \u306f\u3001\u30ab\u30fc\u30cd\u30eb\u304c shrink_dcache_pages() \u3092\u547c\u3073\u51fa\u3057\u305f\u304c dcache \u304c\u307e\u3060\u7e2e\u5c0f\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306b\u30010 \u4ee5\u5916\u306e\u5024\u3068\u306a\u308b\u3002\n\ndentry cache \u7591\u554f\n\ndentry cache \u306e\u30b5\u30a4\u30ba\u306b\u5236\u9650\u3092\u304b\u3051\u3089\u308c\u308b\u304b ?\n\u3067\u304d\u306a\u305d\u3046\nvfs_cache_pressure \u3092\u9ad8\u3044\u6570\u5024\u306b\u3057\u3066\u304a\u304f\u3057\u304b\u306a\u3044\u306e\u304b\u306a?\n\nprocfs \u306e drop_cache\n\n/proc/sys/vm/drop_caches\nsysctl -w vm.drop_caches=N \u3067\u3082\u540c\u3058\n\u4e0b\u8a18\u306e\u30d3\u30c3\u30c8\u6f14\u7b97\u3067 1 \u3068 2 \u3068 3 \u306b\u5bfe\u5fdc\u3059\u308b\u3002\u306a\u308b\u307b\u3069\ninvalidate_mapping_pages ... \u5168\u90e8\u7834\u68c4\nshrink_slab ... \u5168\u7834\u68c4\u3059\u308b\u8a33\u3058\u3083\u306a\u3044\n\n\nlinux/fs/drop_caches.c\n        if (sysctl_drop_caches & 1)\n            drop_pagecache();\n        if (sysctl_drop_caches & 2)\n            drop_slab();\n\n\ntmpfs \u306f .lookup \u3059\u308b\u969b\u306b dentry_operations \u306b .d_delete \u3092\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\nbacking store \u304c RAM \u306e\u5834\u5408\u306f\u3001\u524a\u9664\u6e08\u307f\u30d5\u30a1\u30a4\u30eb\u306e dentry \u3092\u30ad\u30c3\u30b7\u30e5\u3057\u3066\u3082\u30e1\u30e2\u30ea\u3068\u63a2\u7d22\u6642\u9593\u306e\u7121\u99c4\u306b\u306a\u308b\u306e\u3067\u3001\u3059\u3050\u306b\u6d88\u3059\u3068\u306e\u4e8b\nbacking store \u304b\u3089\u306e lookup \u3092\u901f\u304f\u3059\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3057\u3066\u306e\u610f\u5473\u306f\u7121\u3044\u3057\u3001dentry \u5897\u3048\u3066\u30cf\u30c3\u30b7\u30e5\u5024\u306e\u6bd4\u8f03\u56de\u6570\u304c\u7121\u99c4\u306b\u5897\u3048\u308b\nfilename \u3068 Inode \u306e\u7d50\u3073\u3064\u3051\u4ee5\u5916\u306e\u50cd\u304d\u306f\u3057\u306a\u3044\n\nhttp://wiki.ducca.org/wiki/Munin_\u306e_Memory_\u3067\u8868\u793a\u3055\u308c\u308b\u5404\u30b0\u30e9\u30d5\u306e\u610f\u5473\nslab_cache  inode\u3084dentry\u306a\u3069\u3001\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u3002[Slab]\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3002\ncache   \u958b\u653e\u9593\u8fd1\u306e\u5206\uff06\u30c7\u30d0\u30a4\u30b9\uff08HDD\u7b49\uff09\u7528\u306e\u3092\u5f15\u3044\u305f\u30ad\u30e3\u30c3\u30b7\u30e5\u91cf\u3002    \u30ad\u30e3\u30c3\u30b7\u30e5\uff0d(SwapCache+buffers)\nbuffers HDD\u3068\u304b\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3002\u307e\u3060HDD\u306b\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3082\u542b\u3080\u3002    \u5404\u30c7\u30d0\u30a4\u30b9\u306ebdev->bd_inode->i_mapping-nrpages\u306e\u7dcf\u548c\n\ncommitted   \u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3059\u3079\u3066\u306e\u30e1\u30e2\u30ea\u304c\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3067\u3042\u308b\u306a\u3089\u4f7f\u7528\u3055\u308c\u308b\u30e1\u30e2\u30ea\u306e\u91cf\u3002\n\nactive  \u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u30da\u30fc\u30b8\u3002\u57fa\u672c\u7684\u306b\u958b\u653e\u306e\u5bfe\u8c61\u5916\u3002    \ninactive    \u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u304c\u7121\u3044\u3002\u7a7a\u304d\u304c\u7121\u304f\u306a\u308b\u3068\u3001\u3053\u306e\u90e8\u5206\u306e\u30da\u30fc\u30b8\u304b\u3089\u958b\u653e\u3055\u308c\u3066\u3044\u304f\u3002\n\nhttp://www.seeds-std.co.jp/seedsblog/488.html\nslab_cache\n\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\n\ncache\n\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\u3002\u5171\u6709\u30e1\u30e2\u30ea\u306f Cached \u306b\u52a0\u7b97\u3055\u308c\u308b\u3002SwapCached\u306f\u542b\u307e\u306a\u3044\ncache\uff0d(SwapCache+buffers)\n\nbuffers\n\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4f7f\u7528\u3057\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\n\ncommitted\n\u5168\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u3063\u3066\u78ba\u4fdd\u3055\u308c\u305f\u4eee\u60f3\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\u3002\n\nactive\n\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3057\u305f\u7269\u7406\u30e1\u30e2\u30ea\u306e\u5bb9\u91cf\n\ninactive\n\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u306a\u3044\u89e3\u653e\u3057\u3066\u3088\u3044\u7269\u7406\u30e1\u30e2\u30ea\u306e\u5bb9\u91cf\n\nhttp://mkosaki.blog46.fc2.com/blog-entry-884.html\n\u307e\u305a\u3001Active\u3068Inactive\u306e\u9055\u3044\u306f\u3001\u30e1\u30e2\u30ea\u4e0d\u8db3\u767a\u751f\u6642\u306bInactive\u306e\u307b\u3046\u304c\u5148\u306b\u56de\u53ce\u53ef\u80fd\u6027\u30c1\u30a7\u30c3\u30af\u3092\u3055\u308c\u308b\u3002\u3068\u3044\u3046\u610f\u5473\u3057\u304b\u306a\u3044\u3002\nInactive\u306b\u3082\u30c0\u30fc\u30c6\u30a3\u30fc\u30da\u30fc\u30b8\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u540c\u671f\u304c\u3068\u308c\u3066\u3044\u306a\u3044\u30da\u30fc\u30b8\uff09\u3084mlock\u3055\u308c\u305f\u30da\u30fc\u30b8\u306a\u3069\u6368\u3066\u3089\u308c\u306a\u3044\u30da\u30fc\u30b8\u306f\u5927\u91cf\u306b\u6df7\u3058\u3063\u3066\u3044\u308b\u3002\n\u307e\u305f\u3001Inactive\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u56de\u53ce\u3057\u305f\u308aActive\u306b\u5165\u308c\u306a\u304a\u3057\u305f\u308a\u3057\u3066\u6e1b\u3063\u305fInactive\u306e\u30da\u30fc\u30b8\u6570\u306fActive\u304b\u3089Inactive\u306b\u843d\u3068\u3059\u3053\u3068\u306b\u3088\u308a\u3001\u88dc\u5145\u3055\u308c\u308b\u306e\u3067\u3001Active\u3067\u3042\u308b\u3053\u3068\u3082\u4f55\u3082\u4fdd\u969c\u3057\u3066\u306a\u3044\u3002\n\nhttp://monoist.atmarkit.co.jp/mn/articles/1010/06/news107.html\ndentry\u306b\u306f\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a3\u3064\u306e\u5f79\u5272\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u7ba1\u7406\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u69cb\u9020\u306e\u7ba1\u7406\n\u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\n\n\n\n\n\nhttp://docs.oracle.com/cd/E39368_01/e48214/ch09s02.html#idm139984131471632\u00a0\u21a9\n\n\nhttp://qiita.com/joe_hrmn/items/f0fb72b4598607403f2f#dentrycache%E3%81%A8%E3%81%AF\u00a0\u21a9\n\n\nhttps://github.com/hiboma/hiboma/blob/master/kernel/dentry_cache.md\u00a0\u21a9\n\n\nhttps://www.kernel.org/doc/Documentation/sysctl/vm.txt\u00a0\u21a9\n\n\nhttp://www.atmarkit.co.jp/ait/articles/0810/01/news134_3.html\u00a0\u21a9\n\n\nhttp://mkosaki.blog46.fc2.com/blog-entry-885.html\u00a0\u21a9\n\n\nhttp://tecadmin.net/flush-memory-cache-on-linux-server/\u00a0\u21a9\n\n\nhttps://twitter.com/yuya_presto/status/545898513855291392\u00a0\u21a9\n\n\nhttp://www.seeds-std.co.jp/seedsblog/488.html\u00a0\u21a9\n\n\nhttp://wiki.ducca.org/wiki/Munin_\u306e_Memory_\u3067\u8868\u793a\u3055\u308c\u308b\u5404\u30b0\u30e9\u30d5\u306e\u610f\u5473\u00a0\u21a9\n\n\nhttp://www.linux-beginner.com/linux_kihon225.html\u00a0\u21a9\n\n\nhttp://www.atmarkit.co.jp/ait/articles/0810/01/news134_3.html\u00a0\u21a9\n\n\nhttp://benzaiten.dyndns.org/roller/ugya/entry/\u30b9\u30e9\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u00a0\u21a9\n\n\nhttp://www.atmarkit.co.jp/flinux/rensai/watch2008/watchmema.html\u00a0\u21a9\n\n\nhttp://softwaretechnique.jp/OS_Development/kernel_development14_1.html\u00a0\u21a9\n\n\nhttp://osdn.jp/projects/linux-kernel-docs/wiki/internal22-87-\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\u00a0\u21a9\n\n\nhttp://d.hatena.ne.jp/hiboma/20140212/1392131530\u00a0\u21a9\n\n\nhttp://qiita.com/joe_hrmn/items/f0fb72b4598607403f2f\u00a0\u21a9\n\n\nhttp://blog.nomadscafe.jp/2014/01/tmpfile-and-dentry-cache.html\u00a0\u21a9\n\n\n\n## \u30b5\u30fc\u30d0\u30fc\u306e\u30e1\u30e2\u30ea\u304cslab_cache\u3067\u5360\u6709\u3055\u308c\u308b\n![memory-day.png](https://qiita-image-store.s3.amazonaws.com/0/15175/72ad2a37-e3e5-b3ea-d772-273f909df955.png)\n\u30b5\u30fc\u30d0\u30fc\u306e\u30e1\u30e2\u30ea\u304c\u6570\u65e5\u3067slab_cache\u306b\u5360\u6709\u3055\u308c\u308b\u306e\u3067\u539f\u56e0\u3068\u5bfe\u7b56\u3092\u8abf\u67fb\u3057\u305f\u3002\n\n## \u30e1\u30e2\u30ea\u306e\u4f7f\u7528\u72b6\u6cc1\u306e\u8abf\u67fb\n### meminfo\nmeminfo\u3092\u898b\u308b\u3068Slab\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002SReclaimable\u3068SUnreclaim\u3092\u8db3\u3059\u3068Slab\u306b\u306a\u308b\u3002\n\n```bash\n$ cat /proc/meminfo | grep \"Slab\\|claim\"\nSlab:            1654520 kB\nSReclaimable:    1631304 kB\nSUnreclaim:        23216 kB\n```\n\n### slabtop\n`slabtop`\u30b3\u30de\u30f3\u30c9\u3092\u305f\u305f\u304f\u3068`top`\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u306bSlab\u306e\u5185\u8a33\u304c\u8868\u793a\u3055\u308c\u308b\u3002dentry\u304c\u6700\u3082\u591a\u3044\u3088\u3046\u3060\u3002`--once`\u306f1\u56de\u51fa\u529b\u3067\u7d42\u4e86\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3002`--sort=c`\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30a4\u30ba\u9806\u306b\u30bd\u30fc\u30c8\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3002`slabtop -o -s c`\u3067\u3082\u540c\u69d8\u3002\n\n```bash\n$ slabtop --once --sort=c | head -n 12\n Active / Total Objects (% used)    : 9220223 / 9293161 (99.2%)\n Active / Total Slabs (% used)      : 437042 / 437042 (100.0%)\n Active / Total Caches (% used)     : 65 / 89 (73.0%)\n Active / Total Size (% used)       : 1745015.88K / 1758078.67K (99.3%)\n Minimum / Average / Maximum Object : 0.01K / 0.19K / 8.00K\n\n  OBJS ACTIVE  USE OBJ SIZE  SLABS OBJ/SLAB CACHE SIZE NAME\n8990394 8990394 100%    0.19K 428114       21   1712456K dentry\n 22473  22473 100%    0.95K    681       33     21792K ext4_inode_cache\n103740  67048  64%    0.10K   2660       39     10640K buffer_head\n 52269  30144  57%    0.19K   2489       21      9956K kmalloc-192\n 10475   9953  95%    0.62K    419       25      6704K proc_inode_cache\n```\n\n### slabinfo\nslabinfo\u3092\u898b\u308b\u3068\u8a73\u7d30\u304c\u5206\u304b\u308b\u3002\n\n```bash\n$ cat /proc/slabinfo | grep \"dentry\\|obj\"\n# name            <active_objs> <num_objs> <objsize> <objperslab> <pagesperslab> : tunables <limit> <batchcount> <sharedfactor> : slabdata <active_slabs> <num_slabs> <sharedavail>\ndentry            8662626 8662626    192   21    1 : tunables    0    0    0 : slabdata 412506 412506      0\n```\n\n\u898b\u3065\u3089\u3044\u306e\u3067 `awk` \u3067\u52a0\u5de5\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n$ cat /proc/slabinfo | grep \"dentry\\|obj\" | awk '{ for (i=1; i<=NF; i++) { a[NR,i] = $i } } NF>p { p = NF } END { for(j=1; j<=p; j++) { str=a[1,j]; for(i=2; i<=NR; i++){ str=str\"\\t\"a[i,j-1]; } print str } }' | grep '<'\n<active_objs>   8662626\n<num_objs>      8662626\n<objsize>       192\n<objperslab>    21\n<pagesperslab>  1\n<limit> 0\n<batchcount>    0\n<sharedfactor>  0\n<active_slabs>  412506\n<num_slabs>     412506\n<sharedavail>   0\n```\n\n### sar\n`sar`\u30b3\u30de\u30f3\u30c9\u306b`-v`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3068\u300c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u5185\u306e\u672a\u4f7f\u7528\u30ad\u30e3\u30c3\u30b7\u30e5\u30fb\u30a8\u30f3\u30c8\u30ea\u306e\u6570\u300d[^13]\u3067\u3042\u308bdentunusd\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002dentunusd\u304cnegative dentry\u306e\u6570\u306b\u306a\u308b\u3002[^14]\n\n```bash\n$ sar -v 0\n12:00:00 AM dentunusd   file-nr  inode-nr    pty-nr\n12:00:00 AM   8637647       768     40414         1\n```\n[^13]: http://docs.oracle.com/cd/E39368_01/e48214/ch09s02.html#idm139984131471632\n[^14]: http://qiita.com/joe_hrmn/items/f0fb72b4598607403f2f#dentrycache%E3%81%A8%E3%81%AF\n\n### dentry-state\nLinux 2.2\u4ee5\u964d\u3002\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5 (dcache) \u306e\u72b6\u614b\u306b\u95a2\u3059\u308b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u3002[^15]\n\n[^15]: https://github.com/hiboma/hiboma/blob/master/kernel/dentry_cache.md\n\n```bash\n$ cat /proc/sys/fs/dentry-state\n9006589 8998515 45      0       0       0\n```\nnr_dentry, nr_unused, age_limit, want_pages, \u30c0\u30df\u30fc, \u30c0\u30df\u30fc\u3001 \u3068\u3044\u30466\u3064\u306e\u6570\u5b57\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n * nr_dentry \u306f\u5272\u308a\u5f53\u3066\u3089\u308c\u305f dentry (dcache \u30a8\u30f3\u30c8\u30ea) \u306e\u6570\u3067\u3042\u308b\u3002 \u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Linux 2.2 \u3067\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\n * nr_unused \u306f\u672a\u4f7f\u7528\u306e dentry \u6570\u3067\u3042\u308b\u3002\n * age_limit \u306f\u3001\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u6b21\u306b dcache entry \u3092\u518d\u8981\u6c42\u3067\u304d\u308b\u3088\u3046\u306b \u306a\u308b\u307e\u3067\u306e\u6b8b\u308a\u6642\u9593 (\u79d2\u6570) \u3067\u3042\u308b\u3002\n * want_pages \u306f\u3001\u30b7\u30b9\u30c6\u30e0\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305f\u30da\u30fc\u30b8\u6570\u3002\u30ab\u30fc\u30cd\u30eb\u304c shrink_dcache_pages() \u3092\u547c\u3073\u51fa\u3057\u305f\u304c dcache \u304c\u307e\u3060\u7e2e\u5c0f\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306b\u30010 \u4ee5\u5916\u306e\u5024\u3068\u306a\u308b\u3002\n\n## slab\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\n\u3068\u308a\u3042\u3048\u305a`drop_caches`\u306b`2`\u304b`3`\u3092\u66f8\u304d\u8fbc\u3081\u3070slab\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u89e3\u653e\u3055\u308c\u308b\u3002`drop_caches`\u306b\u66f8\u304d\u8fbc\u307f\u3059\u308b\u524d\u306b`sync`\u3092\u5b9f\u884c\u3059\u308b\u3068\u3088\u308a\u591a\u304f\u89e3\u653e\u3067\u304d\u308b[^18]\u3002\n\n[^18]: https://www.kernel.org/doc/Documentation/sysctl/vm.txt\n\n```bash:\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\nsync; echo 1 > /proc/sys/vm/drop_caches\n```\n```bash:slab\u30aa\u30d6\u30b8\u30a7\u30af\u30c8(dentry\u3068inode\u3092\u542b\u3080)\u306e\u89e3\u653e\nsync; echo 2 > /proc/sys/vm/drop_caches\n```\n```bash:slab\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u89e3\u653e\nsync; echo 3 > /proc/sys/vm/drop_caches\n```\n\u3057\u304b\u3057\u3001\u89e3\u653e\u5f8c\u518d\u3073\u9806\u8abf\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u5897\u6b96\u3059\u308b\u3002\n![memory-day.png](https://qiita-image-store.s3.amazonaws.com/0/15175/72ad2a37-e3e5-b3ea-d772-273f909df955.png)\n\n\u3061\u306a\u307f\u306b`drop_caches`\u306b`0`\u3092\u66f8\u304d\u8fbc\u3093\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u72b6\u614b\u306b\u623b\u3059\u3068\u3044\u3046\u8da3\u65e8\u306e\u8a18\u4e8b[^19]\u304c\u6563\u898b\u3055\u308c\u308b\u304c\u3001\u7121\u8996\u3055\u308c\u308b\u3060\u3051\u3067\u610f\u5473\u304c\u306a\u3044\u3088\u3046\u3060[^20]\u3002\n[^19]: http://www.atmarkit.co.jp/ait/articles/0810/01/news134_3.html\n[^20]: http://mkosaki.blog46.fc2.com/blog-entry-885.html\n\n## \u89e3\u6c7a\u7b56\ncron\u3067\u4e0a\u8a18\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u89e3\u653e\u3092\u5b9a\u671f\u5b9f\u884c\u3055\u305b\u308b\u8a18\u4e8b[^16]\u304c\u591a\u304b\u3063\u305f\u304c\u3001\u305d\u3082\u305d\u3082\u305d\u3093\u306a\u3093\u3067\u3044\u3044\u306e\u304b\u3002\n\u3082\u3046\u5c11\u3057\u6839\u672c\u7684\u306a\u5bfe\u5fdc\u306f\u306a\u3044\u306e\u304b\u3068\u3055\u3089\u306b\u8abf\u3079\u305f\u7d50\u679c\u3001`/etc/sysconfig/httpd`\u306b`TMPDIR=/dev/shm` \u3092\u6307\u5b9a\u3059\u308b\u304b `NSS_SDB_USE_CACHE=YES`\u3092\u6307\u5b9a\u3059\u308b\u304b\u306e2\u629e\u304c\u3042\u308b\u6a21\u69d8\u3002\n### tmpfs\n\n```ini:/etc/sysconfig/httpd\nexport TMPDIR=/dev/shm\n```\n```bash\n$ echo $TMPDIR\n/dev/shm\n$ php -r 'echo sys_get_temp_dir(),\"\\n\";'\n/dev/shm\n```\n\n### NSS_SDB_USE_CACHE\n**NSS_SDB_USE_CACHE**\u306fNSS Softoken\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c3.16.0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u306a\u306e\u3067`yum list nss-softokn`\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u305f\u3060\u3001NSS_SDB_USE_CACHE\u306f\u300c\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u8aad\u3080\u3068\u5b9f\u306fNO\u306e\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u306a\u6c17\u304c\u3057\u305f\u3002NFS\u3092\u4f7f\u3063\u3066\u306a\u3044\u9650\u308aNO\u3067\u3088\u3044\u3002\u300d[^17]\u3068\u8a00\u3063\u3066\u3044\u308b\u4eba\u3082\u3044\u308b\u3002\n\n```ini:/etc/sysconfig/httpd\nexport NSS_SDB_USE_CACHE=YES\n```\n\n[^16]: http://tecadmin.net/flush-memory-cache-on-linux-server/\n[^17]: https://twitter.com/yuya_presto/status/545898513855291392\n\n## \u305d\u3082\u305d\u3082slab_cache\u3063\u3066\u306a\u306b\n### slab\u30ad\u30e3\u30c3\u30b7\u30e5\n\n* \u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf[^1]\n* inode\u3084dentry\u306a\u3069\u3001\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u3002[^2]\n* \u30ab\u30fc\u30cd\u30eb\u306f\u3001\u30e1\u30e2\u30ea\u306e\u5229\u7528\u52b9\u7387\u3092\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u7a7a\u9593\u5185\u306e\u3055\u307e\u3056\u307e\u306a \u30e1\u30e2\u30ea\u8cc7\u6e90\u3092\u3001\u8cc7\u6e90\u3054\u3068\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u3059\u308b\u4ed5\u7d44\u307f\u3092\u5099\u3048\u3066\u3044\u307e\u3059\u3002 \u3053\u308c\u3092\u300c\u30b9\u30e9\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u300d\u3068\u547c\u3073\u307e\u3059\u3002[^3]\n* Slab\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308bdentry\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u60c5\u5831\u3092\u683c\u7d0d\u3059\u308binode\u69cb\u9020\u4f53\u306a\u3069\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3044\u308b\u30ab\u30fc\u30cd\u30eb\u5185\u306e\u30e1\u30e2\u30ea\u9818\u57df\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u30da\u30fc\u30b8\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u306f\u5225\u306b\u30ab\u30fc\u30cd\u30eb\u306e\u4e2d\u306b\u78ba\u4fdd\u3055\u308c\u3066\u304a\u308a\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u540c\u671f\u3057\u3066\u3044\u308c\u3070\u89e3\u653e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002[^4]\n* kernel\u306eslab\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u306fSReclaimable(\u56de\u53ce\u53ef\u80fd)\u3068SUnreclaim(\u56de\u53ce\u4e0d\u53ef)\u306a\u3082\u306e\u304c\u3042\u308b\u3002/proc/meminfo\u3092cat\u3059\u308b\u3068\u73fe\u5728\u306e\u30b9\u30e9\u30d6\u306e\u4f7f\u7528\u72b6\u6cc1\u304c\u308f\u304b\u308b\u3002[^5]\n* Linux\u306b\u304a\u3044\u3066\u3001\u30da\u30fc\u30b8\u30b5\u30a4\u30ba\u672a\u6e80\u306e\u30e1\u30e2\u30ea\u306fSLAB\uff08\u30b9\u30e9\u30d6\uff09\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3067\u7ba1\u7406\u3055\u308c\u3066\u3044\u307e\u3059\u3002SLAB\u306f\u3001\u30e1\u30e2\u30ea\u5272\u308a\u5f53\u3066\u6642\u3001\u90e8\u5206\u7684\u306b\u4f7f\u7528\u4e2d\u306e\u30da\u30fc\u30b8\u304c\u3042\u308c\u3070\u305d\u3053\u304b\u3089\u512a\u5148\u7684\u306b\u30e1\u30e2\u30ea\u3092\u5272\u308a\u5f53\u3066\u308b\u4ed5\u7d44\u307f\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u305f\u3081\u3001SLAB\u3092\u7528\u3044\u305f\u78ba\u4fdd\u3068\u89e3\u653e\u304c\u4ea4\u4e92\u306b\u52d5\u3044\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u6cc1\u3067\u306f\u3001\u7121\u99c4\u306a\u9818\u57df\u306f\u307b\u3068\u3093\u3069\u767a\u751f\u3057\u307e\u305b\u3093\u3002\u3057\u304b\u3057\u3001\u30e1\u30e2\u30ea\u78ba\u4fdd\u304c\u975e\u5e38\u306b\u305f\u304f\u3055\u3093\u9023\u7d9a\u3057\u3066\u767a\u751f\u3057\u305f\u5f8c\u306b\u3001\u30e1\u30e2\u30ea\u89e3\u653e\u304c\u3053\u308c\u307e\u305f\u9023\u7d9a\u3057\u3066\u767a\u751f\u3059\u308b\u3068\u3001\u90e8\u5206\u7684\u306b\u4f7f\u7528\u4e2d\u306e\u30e1\u30e2\u30ea\u304c\u5927\u91cf\u306b\u3067\u304d\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u304cSLAB\u306e\u30d5\u30e9\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u547c\u3070\u308c\u308b\u554f\u984c\u3067\u3059\u3002SLAB\u306e\u30d8\u30d3\u30fc\u30e6\u30fc\u30b6\u30fc\u306b\u306f\u3001inode\u30ad\u30e3\u30c3\u30b7\u30e5\u3068dentry\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30d1\u30b9\u540d\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3082\u306e\u3067\u3059\u304c\u3001\u4e0d\u5e78\u306a\u3053\u3068\u306b\u3053\u306e2\u3064\u3067\u306f\u3001find\u3084updatedb\u30b3\u30de\u30f3\u30c9\u306b\u3088\u3063\u3066\u7c21\u5358\u306b\u4e0a\u8a18\u306e\u30ef\u30fc\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002[^6]\n* \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u7528\u3059\u308b\u69cb\u9020\u4f53\uff08\u5358\u306b\u666e\u901a\u306e\u5909\u6570\u3067\u3082\u304b\u307e\u3044\u307e\u305b\u3093\uff09\u3068\u306a\u308a\u307e\u3059\u3002\u30ab\u30fc\u30cd\u30eb\u304c\u5b9f\u969b\u306b\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u4f7f\u7528\u3059\u308b\u306e\u304c\u201d\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u201d\u5358\u4f4d\u3068\u306a\u308a\u3001\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u306e\u5272\u308a\u5f53\u3066/\u89e3\u653e\u3092\u884c\u3046\u5358\u4f4d\u3082\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5358\u4f4d\u3068\u306a\u308a\u307e\u3059\u3002\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u3067\u306f\u4e00\u756a\u5c0f\u3055\u3044\u62ec\u308a\u3068\u306a\u308a\u307e\u3059\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4e00\u3064\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u4e00\u62ec\u308a\u306b\u3057\u305f\u3082\u306e\u304c\u201d\u30b9\u30e9\u30d6\u201d\u3068\u306a\u308a\u307e\u3059\u3002\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u30fc\u3067\u306f\u30b9\u30e9\u30d6\u5358\u4f4d\u3067\u30b9\u30e9\u30d6\u5185\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5b8c\u5168\u306b\u5272\u308a\u5f53\u3066\u6e08\u307f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e00\u90e8\u304c\u5272\u308a\u5f53\u3066\u6e08\u307f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5168\u3066\u304c\u5b8c\u5168\u306b\u30d5\u30ea\u30fc\u3068\u3044\u3063\u305f\u72b6\u614b\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002[^7]\n\n[^1]: http://www.seeds-std.co.jp/seedsblog/488.html\n[^2]: http://wiki.ducca.org/wiki/Munin_\u306e_Memory_\u3067\u8868\u793a\u3055\u308c\u308b\u5404\u30b0\u30e9\u30d5\u306e\u610f\u5473\n[^3]: http://www.linux-beginner.com/linux_kihon225.html\n[^4]: http://www.atmarkit.co.jp/ait/articles/0810/01/news134_3.html\n[^5]: http://benzaiten.dyndns.org/roller/ugya/entry/\u30b9\u30e9\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\n[^6]: http://www.atmarkit.co.jp/flinux/rensai/watch2008/watchmema.html\n[^7]: http://softwaretechnique.jp/OS_Development/kernel_development14_1.html\n\n### \u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf (slab allocator)\n\n* SunOS\u306e\u305f\u3081\u306b\u30b8\u30a7\u30d5\u30fb\u30dc\u30f3\u30a6\u30a3\u30c3\u30af(Jeff Bonwick)\u304c\u5c0e\u5165\u3057\u305f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3002\u30b8\u30a7\u30d5\u306f\u901a\u5e38\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5272\u308a\u632f\u308a\u3068\u5ec3\u68c4\u306b\u591a\u304f\u306e\u6642\u9593\u304c\u8cbb\u3084\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u767a\u898b\u3002\u30e1\u30e2\u30ea\u30fc\u3092\u89e3\u653e\u3057\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u30d7\u30fc\u30eb\u306b\u8fd4\u5374\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u305d\u306e\u7528\u9014\u3067\u521d\u671f\u5316\u3055\u308c\u305f\u307e\u307e\u306e\u72b6\u614b\u3067\u4fdd\u6301\u3057\u3066\u518d\u5229\u7528\u3059\u308b\u65b9\u5f0f\u3092\u767a\u6848\u3002[^5]\n\n### inode\n\n### dentry\u30ad\u30e3\u30c3\u30b7\u30e5\n\n* \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\u3002[^21]\n* dentry \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001RAM \u3088\u308a\u4f4e\u901f\u306a HDD \u3084 SSD \u306a\u3069\u306e\u3001\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304b\u3089\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304d\u3001\u9ad8\u901f\u5316\u3059\u308b\u3082\u306e\u3067\u3059\u3002[^8]\n* \u30d5\u30a1\u30a4\u30eb\u540d\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020\u3001\u307e\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3068inode\u60c5\u5831\u3092\u95a2\u9023\u4ed8\u3051\u308b\u3082\u306e\uff08\u69cb\u9020\u4f53\uff09\u3089\u3057\u3044\u3002dentry_cache\u306f\u3001\u305d\u308c\u3089\u306e\u60c5\u5831\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3060\u3068\u601d\u3063\u3066\u826f\u3055\u305d\u3046\u3002\u307e\u305fdentry_cache\u306f\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u60c5\u5831\uff08inode\u3092\u6301\u305f\u306a\u3044dentry\uff09\u306a\u3093\u304b\u3082\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\uff08\u3053\u308c\u3092negative dentry\u3068\u3044\u3046\u3089\u3057\u3044\uff09\u3002negative dentry\u306f\u3001sar\u30b3\u30de\u30f3\u30c9\uff08-v\u30aa\u30d7\u30b7\u30e7\u30f3\uff09\u3067\u78ba\u8a8d\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\u3002[^9]\n* dentry cache\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u540d\u3068inode\u3068\u3092\u7d50\u3073\u3064\u3051\u306b\u4f7f\u308f\u308c\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3067\u3059\u3002dentry cache\u304c\u3069\u306e\u7a0b\u5ea6\u3042\u308b\u306e\u304b\u306f\u3001slabtop\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002[^10]\n\n[^8]: http://d.hatena.ne.jp/hiboma/20140212/1392131530\n[^9]: http://qiita.com/joe_hrmn/items/f0fb72b4598607403f2f\n[^10]: http://blog.nomadscafe.jp/2014/01/tmpfile-and-dentry-cache.html\n[^21]: http://osdn.jp/projects/linux-kernel-docs/wiki/internal22-87-\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5\n\n## \u53c2\u7167\u60c5\u5831\nhttps://www.kernel.org/doc/Documentation/sysctl/vm.txt\n\n```text://www.kernel.org/doc/Documentation/sysctl/vm.txt\ndrop_caches\n\nWriting to this will cause the kernel to drop clean caches, as well as\nreclaimable slab objects like dentries and inodes.  Once dropped, their\nmemory becomes free.\n\nTo free pagecache:\n\techo 1 > /proc/sys/vm/drop_caches\nTo free reclaimable slab objects (includes dentries and inodes):\n\techo 2 > /proc/sys/vm/drop_caches\nTo free slab objects and pagecache:\n\techo 3 > /proc/sys/vm/drop_caches\n\nThis is a non-destructive operation and will not free any dirty objects.\nTo increase the number of objects freed by this operation, the user may run\n`sync' prior to writing to /proc/sys/vm/drop_caches.  This will minimize the\nnumber of dirty objects on the system and create more candidates to be\ndropped.\n\nThis file is not a means to control the growth of the various kernel caches\n(inodes, dentries, pagecache, etc...)  These objects are automatically\nreclaimed by the kernel when memory is needed elsewhere on the system.\n\nUse of this file can cause performance problems.  Since it discards cached\nobjects, it may cost a significant amount of I/O and CPU to recreate the\ndropped objects, especially if they were under heavy use.  Because of this,\nuse outside of a testing or debugging environment is not recommended.\n\nYou may see informational messages in your kernel log when this file is\nused:\n\n\tcat (1234): drop_caches: 3\n\nThese are informational only.  They do not mean that anything is wrong\nwith your system.  To disable them, echo 4 (bit 3) into drop_caches.\n```\n\n[Delete clean cache to free up memory on your slow Linux server, VPS - blackMORE Ops](http://www.blackmoreops.com/2014/10/28/delete-clean-cache-to-free-up-memory-on-your-slow-linux-server-vps/)\n\n```shell-session\n# crontab -e\n0 * * *  * sync; echo 3 > /proc/sys/vm/drop_caches\n```\n\nhttp://futuremix.org/2009/09/clear-linux-memory-cach\n\n```text\nLinux \u306e top \u30b3\u30de\u30f3\u30c9\u3084 free \u30b3\u30de\u30f3\u30c9\u3067\u8868\u793a\u3055\u308c\u308b cached \u306f\u3001\u52dd\u624b\u306b\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u304d\u307e\u3059\u3002free \u304c\u306a\u304f\u306a\u308b\u3068\u3053\u306e cached \u304c\u5c11\u3057\u305a\u3064\u89e3\u653e\u3055\u308c\u3066\u4f7f\u308f\u308c\u307e\u3059\u3002\n```\n\n```\ncached \u3082 buffers \u3082\u7a7a\u304d\u30e1\u30e2\u30ea\u306e\u4e00\u90e8\u3067\u3059\u306e\u3067\u3001\u3053\u308c\u3089\u304c\u6e9c\u307e\u3063\u3066\u3044\u308b\u304b\u3089\u3068\u3044\u3063\u3066\u7121\u7406\u3084\u308a\u89e3\u653e\u3055\u305b\u308b\u5fc5\u8981\u306f\u901a\u5e38\u306f\u3042\u308a\u307e\u305b\u3093\u3002cached \u3092\u6e9c\u3081\u3066\u3044\u308b\u306e\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u305f\u3081\u306a\u306e\u3067\u3001\u89e3\u653e\u3055\u305b\u308b\u3068\u901a\u5e38\u4f7f\u7528\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u843d\u3061\u307e\u3059\u3002\u9006\u306b\u3053\u308c\u3092\u89e3\u653e\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6e2c\u5b9a\u306a\u3069\u3067\u3001\u6b63\u3057\u3044\u8a08\u6e2c\u304c\u3067\u304d\u307e\u305b\u3093\u3002\n```\n\n```\nkernel \u306e 2.6.16 \u4ee5\u964d\u3067\u306f\u3001\u89e3\u653e\u3092\u30b3\u30de\u30f3\u30c9\u304b\u3089\u89e3\u653e\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n```\n\nhttp://blog.nomadscafe.jp/2014/01/tmpfile-and-dentry-cache.html\n\n```\ndentry cache\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u540d\u3068inode\u3068\u3092\u7d50\u3073\u3064\u3051\u306b\u4f7f\u308f\u308c\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3067\u3059\u3002\n```\n\n```\ndentry cache\u304c\u3069\u306e\u7a0b\u5ea6\u3042\u308b\u306e\u304b\u306f\u3001slabtop\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n```\n\n```\ndentry cache\u306f\u30e1\u30e2\u30ea\u304c\u5fc5\u8981\u306b\u306a\u308c\u3070\u89e3\u653e\u3055\u308c\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u305d\u306e\u691c\u8a3c\u306e\u305f\u3081\u3001\u3082\u3046\u4e00\u3064\u30e1\u30e2\u30ea\u3092\u5927\u91cf\u306b\u4f7f\u3046\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u307e\u305f\u3001dstat\u3067\u89b3\u5bdf\u3059\u308b\u3068\u3001\u306a\u3093\u3068\u3001swap\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\ndentry cache\u3092\u89e3\u653e\u3059\u308b\u30b9\u30d4\u30fc\u30c9\u304c\u9593\u306b\u5408\u308f\u306a\u3044\u306e\u304b\u3001\u4e00\u90e8\u306e\u30e1\u30e2\u30ea\u304cswap\u306b\u8ffd\u3044\u51fa\u3055\u308c\u3001\u3055\u3089\u306b\u5f90\u3005\u306bswap\u304c\u5897\u3048\u3066\u884c\u304f\u308b\u7d50\u679c\u3068\u306a\u308a\u307e\u3057\u305f\u3002\n```\n\n```\nvm.vfs_cache_pressure \u3092\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\n$ sudo /sbin/sysctl -w vm.vfs_cache_pressure=10000\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306f100\u3067\u3001\u6570\u5b57\u3092\u5927\u304d\u304f\u3059\u308b\u3068\u65e9\u3081\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u89e3\u653e\u3059\u308b\u3088\u3046\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u304b\u306a\u308a\u5927\u304d\u306a\u6570\u5b57\u306b\u3057\u3066\u3082\u30b5\u30fc\u30d3\u30b9\u306e\u672c\u756a\u74b0\u5883\u3067\u306f\u76ee\u7acb\u3063\u305f\u5909\u5316\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n```\n\n```\ntmpfs\u3060\u3068\u3001dentry cache\u306f\u6e9c\u307e\u3089\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u74b0\u5883\u5909\u6570TMPDIR\u306btmpfs\u3092\u6307\u5b9a\u3057\u3066\u5148\u307b\u3069\u306escript\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ TMPDIR=/dev/shm perl mktmp.pl\n\u307e\u305fdstat\u3067\u89b3\u5bdf\u3059\u308b\u3068\u3001\u30e1\u30e2\u30ea\u304c\u5897\u3048\u3066\u884c\u304b\u306a\u3044\u306e\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001tmpfs\u304cLinux\u306eVFS\u3092\u4f7f\u308f\u306a\u3044\u304b\u3089\u3067\u3057\u3087\u3046\u304b\u3002\n\u3053\u3053\u307e\u3067\u5206\u304b\u3063\u305f\u306e\u3067\u3001Apache\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306b\nexport TMPDIR=/dev/shm\n\u3092\u8ffd\u52a0\u3057\u3066\u518d\u8d77\u52d5\u3057\u305f\u3068\u3053\u308d\u3001\u30b5\u30fc\u30d0\u304c\u5b89\u5b9a\u3057\u3066\u52d5\u304f\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n```\n\n```\n\u307e\u3068\u3081\ndentry cache\u306b\u3088\u308a\u30e1\u30e2\u30ea\u304c\u5727\u8feb\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\ntmpfs\u3092\u4f7f\u3046\u3068dentry cache\u306f\u6e9c\u307e\u3089\u306a\u3044\nTMPDIR\u74b0\u5883\u5909\u6570\u3067\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\u306f\u5909\u66f4\u51fa\u6765\u308b\n```\n\nhttp://d.hatena.ne.jp/hiboma/20140212/1392131530\n\n```\nnegative dentry \u3068\u306f \u5b58\u5728\u3057\u306a\u3044 inode \u306b\u5bfe\u5fdc\u3059\u308b dentry \u3067\u3059\u3002\n\ndentry \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u3001RAM \u3088\u308a\u4f4e\u901f\u306a HDD \u3084 SSD \u306a\u3069\u306e\u3001\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304b\u3089\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u304a\u304d\u3001\u9ad8\u901f\u5316\u3059\u308b\u3082\u306e\u3067\u3059\u3002\n\n\u4e00\u65b9\u3001negative dentry \u306f \u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u306e\u8aad\u307f\u53d6\u308a\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3001\u9ad8\u901f\u5316\u3057\u307e\u3059\u3002\n\n\u300c\u5b58\u5728\u3057\u306a\u3044\u306e\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\uff1f\u300d\u304c\u3057\u3070\u3089\u304f\u30a4\u30df\u30d5\u3060\u3063\u305f\u306e\u3067\u3057\u305f\u304c\u3001DNS \u306e\u30cd\u30ac\u30c6\u30a3\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u52d5\u4f5c\u306b\u4f3c\u3066\u3044\u308b\u306a\u3068\u601d\u3044\u307e\u3057\u305f (\u5b58\u5728\u3057\u306a\u3044\u30ec\u30b3\u30fc\u30c9\u60c5\u5831\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u554f\u3044\u5408\u308f\u305b\u3092\u6e1b\u3089\u3057\u9ad8\u901f\u5316\u3059\u308b)\n```\n\n```\nslabtop \u3067\u306f\u901a\u5e38\u306e dentry \u306a\u306e\u304b negative dentry \u306a\u306e\u304b\u5224\u5225\u3067\u304d\u307e\u305b\u3093 ...\n\nsar -w \u3067\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059 ( negative entry \u306f dentunusd \u306b\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059 )\n```\n\n```\n/tmp \u306b\u540c\u3058\u30d1\u30b9\u540d\u3067\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3084\u524a\u9664\u3092\u7e70\u308a\u8fd4\u3059\u3088\u3046\u306a\u30b1\u30fc\u30b9\u3084\u3001Perl\u3084Ruby\u306e\u3088\u3046\u306a\u8a00\u8a9e\u306e\u30e9\u30a4\u30d6\u30e9\u30ea/\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u63a2\u7d22 (\u4f8b: Perl \u304c\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u63a2\u3059\u305f\u3081\u306b @INC\u914d\u5217\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7fa4\u3092\u8d70\u67fb\u3059\u308b\u969b\u3001\u5b58\u5728\u3057\u306a\u3044\u30d1\u30b9\u306b\u3082 open(2) \u3057\u307e\u304f\u3063\u3066\u63a2\u3057\u3066\u3044\u308b ) \u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u3092\u6bce\u56de HDD \u306b\u554f\u3044\u5408\u308f\u305b\u3066\u3044\u308b\u3068 I/O \u307e\u304f\u308a\u3067\u9045\u305d\u3046\u3067\u3059\u3088\u306d\u3002\u3053\u3053\u3067\u3001 negative dentry \u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u6709\u52b9\u306b\u4f5c\u7528\u3057\u3066\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u4e00\u65b9\u3067 File::Temp \u306e tmpfile() \u306e\u3088\u3046\u306b\u30e9\u30f3\u30c0\u30e0\u306a\u30d1\u30b9\u3092\u751f\u6210\u3057\u540c\u4e00\u30d1\u30b9\u306e\u518d\u5229\u7528\u3092\u907f\u3051\u308b\u30b1\u30fc\u30b9\u3068\u76f8\u6027\u304c\u60aa\u3044\u3053\u3068\u306f kazeburo \u3055\u3093\u306e\u30d6\u30ed\u30b0\u3067\u3082\u5b9f\u8a3c\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n```\n\n```\ntmpfs \u3067\u306f negative dentry \u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u307e\u305b\u3093\u3002 unlink/rmdir \u3059\u308b\u3068 dentry \u306f\u3059\u3050\u306b\u7834\u68c4\u3055\u308c\u307e\u3059\u3002\n```\n\n```\ntmpfs \u3067\u306f \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u30c7\u30fc\u30bf(inode\u60c5\u5831\u306a\u3069) \u306f\u30e1\u30e2\u30ea(\u30da\u30fc\u30b8)\u4e0a\u306b\u4fdd\u6301\u3055\u308c\u3066\u3044\u3066\u9ad8\u901f\u306b\u63a2\u7d22\u3067\u304d\u307e\u3059\u3002\u4e8c\u6b21\u8a18\u61b6\u88c5\u7f6e\u304c\u7121\u3044\u306e\u3067\u3001\u5b58\u5728\u3057\u306a\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30a8\u30f3\u30c8\u30ea\u3092\u901f\u304f\u63a2\u3059\u305f\u3081\u306e negative dentry \u306f\u7121\u304f\u3066\u3082\u3044\u3044\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3059\u306d\u3002\n\next3 \u3084 ext4 \u306a\u3069\u3067\u306f .d_delete \u306f\u7279\u306b\u5b9f\u88c5\u3055\u308c\u3066\u304a\u3089\u305a\u3001negative dentry \u304c\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308b\u3088\u3046\u3067\u3059\n```\n\nhttp://s-tajima.hateblo.jp/entry/2015/02/20/233615\n\n```\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5185\u3067https\u306b\u3088\u308b\u5916\u90e8API\u3092\u53e9\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d0\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5897\u52a0\u3057\u7d9a\u3051\u308b\u4ef6\u306b\u3064\u3044\u3066\u8abf\u3079\u305f\u3002\n```\n\n```\n\u8abf\u67fb\u3059\u308b\u3068\u3001\u3053\u306e\u30d0\u30b0\u4ed5\u69d8\u3092\u8e0f\u3093\u3067\u3044\u308b\u306e\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u308f\u308c\u308b\u30da\u30fc\u30b8\u3092\u898b\u3064\u3051\u305f\u3002\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1044666\n\n\u5185\u5bb9\u3068\u3057\u3066\u306f\u3001curl\u3092\u5b9f\u884c\u3057\u305f\u969b\u306b\n/etc/pki/nssdb/\u4ee5\u4e0b\u306e\u5b58\u5728\u3057\u306a\u3044\u30d5\u30a1\u30a4\u30eb(\u6bce\u56de\u9055\u3046\u30d1\u30b9)\u306b\u5bfe\u3057\u3066access\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u304c\u5927\u91cf\u306b\u30b3\u30fc\u30eb\u3055\u308c\u3001\nnegative dentry cache\u304c\u6e9c\u307e\u3063\u3066\u3044\u304d\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u304c\u5727\u8feb\u3055\u308c\u308b\u3068\u3044\u3046\u3082\u306e\u3002\n```\n\n```\n\u306a\u305c\u3053\u3093\u306a\u3053\u3068\u306b\u306a\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u3001\nhttps://hg.mozilla.org/projects/nss/file/4d876e0ee318/security/nss/lib/softoken/sdb.c#l372\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u6027\u80fd\u3092\u691c\u67fb\u3057\u3066\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\u304b\u3069\u3046\u304b\u306e\u5224\u65ad\u3092\u3057\u3066\u3044\u308b\u3089\u3057\u3044\u3002\n```\n\n```\n\u5bfe\u5fdc\u3068\u3057\u3066\u306f\u3001\nhttps://bugzilla.redhat.com/show_bug.cgi?id=1044666#c8\n\u3053\u306e\u30d1\u30c3\u30c1\u3067\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3001NSS_SDB_USE_CACHE\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u3066\u3001\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u691c\u67fb\u3092\u305b\u305a\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3046\u3088\u3046\u306b\u3059\u308c\u3070\u3044\u3044\u3088\u3046\u3060\u3002\n```\n\n```\n$ export NSS_SDB_USE_CACHE=yes \u203bphp\u306e\u30b3\u30fc\u30c9\u5185\u3067putenv(\"NSS_SDB_USE_CACHE=yes\u201d)\u3067\u3082\u3088\u3044\u3002\n$ strace -fc -e trace=access php test.php\n% time     seconds  usecs/call     calls    errors syscall\n------ ----------- ----------- --------- --------- ----------------\n  -nan    0.000000           0        12         7 access\n------ ----------- ----------- --------- --------- ----------------\n100.00    0.000000                    12         7 total\n\u6539\u5584\u3055\u308c\u305f\u3002\n```\n\nhttps://github.com/hiboma/hiboma/blob/master/kernel/dentry_cache.md\n\n```\ndentry \u306f4\u3064\u306e\u72b6\u614b\u3092\u3082\u3064\n* free\n* nonused\n* used\n* negative\nnegative \u306f DNS\u306e\u30cd\u30ac\u30c6\u30a3\u30d6\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3088\u304f\u4f3c\u3066\u3044\u308b ( \u5b58\u5728\u3057\u306a\u3044 \u30ec\u30b3\u30fc\u30c9\u306elookup \u3092\u9ad8\u901f\u5316)\n\n```\n\n\n```\ndentry \u306e\u4f7f\u7528\u91cf/\u6570\u3092\u8abf\u3079\u308b\n\nslabtop\n/proc/sys/fs/dentry-state\n```\n\n```\n/proc/sys/fs/dentry-state (Linux 2.2 \u4ee5\u964d)\n  \u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30ad\u30e3\u30c3\u30b7\u30e5 (dcache) \u306e\u72b6\u614b\u306b\u95a2\u3059\u308b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u3002\n  \u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001 nr_dentry, nr_unused, age_limit (\u79d2\u5358\u4f4d\u306e age), want_pages (\u30b7\u30b9\u30c6\u30e0\u304c\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u305f\u30da\u30fc\u30b8\u6570), \u30c0\u30df\u30fc\u306e 2 \u3064\u306e\u5024\u3001 \u3068\u3044\u3046 6 \u3064\u306e\u6570\u5b57\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n * nr_dentry \u306f\u5272\u308a\u5f53\u3066\u3089\u308c\u305f dentry (dcache \u30a8\u30f3\u30c8\u30ea) \u306e\u6570\u3067\u3042\u308b\u3002 \u3053\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f Linux 2.2 \u3067\u306f\u4f7f\u7528\u3055\u308c\u306a\u3044\u3002\n * nr_unused \u306f\u672a\u4f7f\u7528\u306e dentry \u6570\u3067\u3042\u308b\u3002\n * age_limit \u306f\u3001\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u6b21\u306b dcache entry \u3092\u518d\u8981\u6c42\u3067\u304d\u308b\u3088\u3046\u306b \u306a\u308b\u307e\u3067\u306e\u6b8b\u308a\u6642\u9593 (\u79d2\u6570) \u3067\u3042\u308b\u3002\n * want_pages \u306f\u3001\u30ab\u30fc\u30cd\u30eb\u304c shrink_dcache_pages() \u3092\u547c\u3073\u51fa\u3057\u305f\u304c dcache \u304c\u307e\u3060\u7e2e\u5c0f\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306b\u30010 \u4ee5\u5916\u306e\u5024\u3068\u306a\u308b\u3002\n```\n\n```\ndentry cache \u7591\u554f\n\ndentry cache \u306e\u30b5\u30a4\u30ba\u306b\u5236\u9650\u3092\u304b\u3051\u3089\u308c\u308b\u304b ?\n\u3067\u304d\u306a\u305d\u3046\nvfs_cache_pressure \u3092\u9ad8\u3044\u6570\u5024\u306b\u3057\u3066\u304a\u304f\u3057\u304b\u306a\u3044\u306e\u304b\u306a?\n```\n\n```\nprocfs \u306e drop_cache\n\n/proc/sys/vm/drop_caches\nsysctl -w vm.drop_caches=N \u3067\u3082\u540c\u3058\n\u4e0b\u8a18\u306e\u30d3\u30c3\u30c8\u6f14\u7b97\u3067 1 \u3068 2 \u3068 3 \u306b\u5bfe\u5fdc\u3059\u308b\u3002\u306a\u308b\u307b\u3069\ninvalidate_mapping_pages ... \u5168\u90e8\u7834\u68c4\nshrink_slab ... \u5168\u7834\u68c4\u3059\u308b\u8a33\u3058\u3083\u306a\u3044\n```\n\n```c:linux/fs/drop_caches.c\n        if (sysctl_drop_caches & 1)\n            drop_pagecache();\n        if (sysctl_drop_caches & 2)\n            drop_slab();\n```\n\n```\ntmpfs \u306f .lookup \u3059\u308b\u969b\u306b dentry_operations \u306b .d_delete \u3092\u30bb\u30c3\u30c8\u3057\u3066\u3044\u308b\nbacking store \u304c RAM \u306e\u5834\u5408\u306f\u3001\u524a\u9664\u6e08\u307f\u30d5\u30a1\u30a4\u30eb\u306e dentry \u3092\u30ad\u30c3\u30b7\u30e5\u3057\u3066\u3082\u30e1\u30e2\u30ea\u3068\u63a2\u7d22\u6642\u9593\u306e\u7121\u99c4\u306b\u306a\u308b\u306e\u3067\u3001\u3059\u3050\u306b\u6d88\u3059\u3068\u306e\u4e8b\nbacking store \u304b\u3089\u306e lookup \u3092\u901f\u304f\u3059\u308b\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u3057\u3066\u306e\u610f\u5473\u306f\u7121\u3044\u3057\u3001dentry \u5897\u3048\u3066\u30cf\u30c3\u30b7\u30e5\u5024\u306e\u6bd4\u8f03\u56de\u6570\u304c\u7121\u99c4\u306b\u5897\u3048\u308b\nfilename \u3068 Inode \u306e\u7d50\u3073\u3064\u3051\u4ee5\u5916\u306e\u50cd\u304d\u306f\u3057\u306a\u3044\n```\n\nhttp://wiki.ducca.org/wiki/Munin_\u306e_Memory_\u3067\u8868\u793a\u3055\u308c\u308b\u5404\u30b0\u30e9\u30d5\u306e\u610f\u5473\n\n```\nslab_cache\tinode\u3084dentry\u306a\u3069\u3001\u30ab\u30fc\u30cd\u30eb\u304c\u4f7f\u3046\u30e1\u30e2\u30ea\u3002[Slab]\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u306e\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u3002\ncache\t\u958b\u653e\u9593\u8fd1\u306e\u5206\uff06\u30c7\u30d0\u30a4\u30b9\uff08HDD\u7b49\uff09\u7528\u306e\u3092\u5f15\u3044\u305f\u30ad\u30e3\u30c3\u30b7\u30e5\u91cf\u3002\t\u30ad\u30e3\u30c3\u30b7\u30e5\uff0d(SwapCache+buffers)\nbuffers\tHDD\u3068\u304b\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3002\u307e\u3060HDD\u306b\u66f8\u304d\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3082\u542b\u3080\u3002\t\u5404\u30c7\u30d0\u30a4\u30b9\u306ebdev->bd_inode->i_mapping-nrpages\u306e\u7dcf\u548c\n```\n\n```\ncommitted\t\u5272\u308a\u5f53\u3066\u3089\u308c\u305f\u3059\u3079\u3066\u306e\u30e1\u30e2\u30ea\u304c\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3067\u3042\u308b\u306a\u3089\u4f7f\u7528\u3055\u308c\u308b\u30e1\u30e2\u30ea\u306e\u91cf\u3002\n```\n\n```\nactive\t\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3055\u308c\u305f\u30da\u30fc\u30b8\u3002\u57fa\u672c\u7684\u306b\u958b\u653e\u306e\u5bfe\u8c61\u5916\u3002\t\ninactive\t\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u304c\u7121\u3044\u3002\u7a7a\u304d\u304c\u7121\u304f\u306a\u308b\u3068\u3001\u3053\u306e\u90e8\u5206\u306e\u30da\u30fc\u30b8\u304b\u3089\u958b\u653e\u3055\u308c\u3066\u3044\u304f\u3002\n```\n\nhttp://www.seeds-std.co.jp/seedsblog/488.html\n\n```\nslab_cache\n\u30b9\u30e9\u30d6\u30a2\u30ed\u30b1\u30fc\u30bf\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\n\ncache\n\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\u3002\u5171\u6709\u30e1\u30e2\u30ea\u306f Cached \u306b\u52a0\u7b97\u3055\u308c\u308b\u3002SwapCached\u306f\u542b\u307e\u306a\u3044\ncache\uff0d(SwapCache+buffers)\n\nbuffers\n\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u3057\u3066\u4f7f\u7528\u3057\u3066\u3044\u308b\u7269\u7406\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\n```\n\n```\ncommitted\n\u5168\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u3063\u3066\u78ba\u4fdd\u3055\u308c\u305f\u4eee\u60f3\u30e1\u30e2\u30ea\u306e\u7dcf\u5bb9\u91cf\u3002\n```\n\n```\nactive\n\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3057\u305f\u7269\u7406\u30e1\u30e2\u30ea\u306e\u5bb9\u91cf\n\ninactive\n\u6700\u8fd1\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3044\u306a\u3044\u89e3\u653e\u3057\u3066\u3088\u3044\u7269\u7406\u30e1\u30e2\u30ea\u306e\u5bb9\u91cf\n```\n\n\nhttp://mkosaki.blog46.fc2.com/blog-entry-884.html\n\n```\n\u307e\u305a\u3001Active\u3068Inactive\u306e\u9055\u3044\u306f\u3001\u30e1\u30e2\u30ea\u4e0d\u8db3\u767a\u751f\u6642\u306bInactive\u306e\u307b\u3046\u304c\u5148\u306b\u56de\u53ce\u53ef\u80fd\u6027\u30c1\u30a7\u30c3\u30af\u3092\u3055\u308c\u308b\u3002\u3068\u3044\u3046\u610f\u5473\u3057\u304b\u306a\u3044\u3002\nInactive\u306b\u3082\u30c0\u30fc\u30c6\u30a3\u30fc\u30da\u30fc\u30b8\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u540c\u671f\u304c\u3068\u308c\u3066\u3044\u306a\u3044\u30da\u30fc\u30b8\uff09\u3084mlock\u3055\u308c\u305f\u30da\u30fc\u30b8\u306a\u3069\u6368\u3066\u3089\u308c\u306a\u3044\u30da\u30fc\u30b8\u306f\u5927\u91cf\u306b\u6df7\u3058\u3063\u3066\u3044\u308b\u3002\n\u307e\u305f\u3001Inactive\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u56de\u53ce\u3057\u305f\u308aActive\u306b\u5165\u308c\u306a\u304a\u3057\u305f\u308a\u3057\u3066\u6e1b\u3063\u305fInactive\u306e\u30da\u30fc\u30b8\u6570\u306fActive\u304b\u3089Inactive\u306b\u843d\u3068\u3059\u3053\u3068\u306b\u3088\u308a\u3001\u88dc\u5145\u3055\u308c\u308b\u306e\u3067\u3001Active\u3067\u3042\u308b\u3053\u3068\u3082\u4f55\u3082\u4fdd\u969c\u3057\u3066\u306a\u3044\u3002\n```\n\nhttp://monoist.atmarkit.co.jp/mn/articles/1010/06/news107.html\n\n```\ndentry\u306b\u306f\u3001\u4e3b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a3\u3064\u306e\u5f79\u5272\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u306e\u7ba1\u7406\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u69cb\u9020\u306e\u7ba1\u7406\n\u30ad\u30e3\u30c3\u30b7\u30e5\u7ba1\u7406\n```\n"}