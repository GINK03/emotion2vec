{"context": " More than 1 year has passed since last update.\n\npacker -> Vagrant -> Ansible\n\u306a\u3093\u3068\u306a\u304f\u3001\u6d41\u308c\u3068\u3057\u3066\u4f5c\u3063\u3066\u304a\u304f\u3068\u826f\u3055\u305d\u3046\n\npacker -> Vagrant box\u4f5c\u6210\n\n\u5916\u90e8\u304b\u3089packer template\u3092\u5165\u624b\u3059\u308b\n\u81ea\u5206\u3067\u4f5c\u3063\u3066\u3082\u3044\u3044\u3051\u3069\u3001\u6700\u521d\u304b\u3089Enter\u3092\u62bc\u3059\u306a\u3069\u306e\u64cd\u4f5c\u3092\u8d77\u3053\u3059\u306e\u306f\u3060\u308b\u3044\u306e\u3067\u3001\n\u65e2\u5b58\u306epacker template\u3092\u53d6\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u500b\u4eba\u7684\u306b\u304a\u3059\u3059\u3081\u306a\u306e\u306fchef\u793e\u306ebento\u3002\npacker template\u306f\u3001\nhttps://github.com/opscode/bento/tree/master/packer\n\u4ee5\u4e0b\u306b\u3042\u308b\u3002\n\nchef\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u524a\u9664\n\u50d5\u3068\u3057\u3066\u306f\u3001chef\u306f\u5229\u7528\u3057\u306a\u3044\u5f62\u306a\u306e\u3067\u3001\nprovisioner\u304b\u3089chef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7b87\u6240\u3092\u524a\u9664\u3057\u3066\u5229\u7528\u3059\u308b\u3002\nUbuntu 14.04\u306etemplate.json\u3092\u4f8b\u306b\u53d6\u308b\u3068\u3001\n\u4ee5\u4e0b\u306e\u90e8\u5206\u3092\u524a\u9664\u3059\u308b\u3002chef.sh\u3092\u524a\u9664\u3059\u308b\u3060\u3051\u3002\n\nubuntu-14.04-amd64.json#L172\ndiff --git packer/ubuntu-14.04-amd64.json packer/ubuntu-14.04-amd64.json\nindex 0522db4..41e62d8 100644\n--- packer/ubuntu-14.04-amd64.json\n+++ packer/ubuntu-14.04-amd64.json\n@@ -182,7 +182,6 @@\n         \"scripts/ubuntu/sudoers.sh\",\n         \"scripts/common/vagrant.sh\",\n         \"scripts/common/vmtools.sh\",\n-        \"scripts/common/chef.sh\",\n         \"scripts/ubuntu/cleanup.sh\",\n         \"scripts/common/minimize.sh\"\n       ],\n\n\n\npacker template\u3088\u308aVagrant box\u3092\u4f5c\u6210\u3059\u308b\npacker template\u3092\u7de8\u96c6\u3057\u7d42\u3048\u305f\u3089\u3001\n> packer build template.json\n\n\u3092\u5b9f\u884c\u3057\u3001Vagrant box\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u5148\u307b\u3069\u3042\u3052\u305fbento\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\n\u4ee5\u4e0b\u306e\u5f62\u3067Vagrant box\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n> git clone git@github.com:opscode/bento.git\n> cd bento/packer\n> sed -i '/chef\\.sh/d' ubuntu-14.04-amd64.json\n> packer build ubuntu-14.04-amd64.json\n\n\n\u66ab\u3057\u5f85\u3064\n\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092\u767b\u9332\n> cd ../builds/virtualbox/\n> vagrant box add ubuntu-14.04 opscode_ubuntu-14.04_chef-provisionerless.box\n> vagrant box list\nubuntu-14.04                                             (virtualbox, 0)\n\n\nVagrant\n\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001Vagrantfile\u3092\u4f5c\u6210\u3059\u308b\n> mkdir \n> vagrant init\n\n\nVagrantfile\u306e\u7de8\u96c6\n\u30b3\u30a2\u6570\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306a\u3069\u3092\u3044\u3058\u3063\u3066\u304a\u304f\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n\n  config.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n  config.ssh.forward_agent = true\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n    vb.customize [\"modifyvm\", :id, \"--memory\", \"1024\"]\n    # \u53c2\u8003: http://qiita.com/d_nishiyama85/items/c50c95795865ae7f714b\n    vb.customize [\"modifyvm\", :id, \"--ioapic\", \"on\"]\n    # \u53c2\u8003: http://shibayu36.hatenablog.com/entry/2013/08/12/090545\n    vb.customize [\"modifyvm\", :id, \"--natdnshostresolver1\", \"off\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnsproxy1\", \"off\"]\n  end\nend\n\n\n\n\u4f5c\u6210\u3057\u305fVagrant box\u306e\u7acb\u3061\u4e0a\u3052\n> vagrant up\n\n\u3067\u7acb\u3061\u4e0a\u3052\u3002\n\n\nAnsible\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u3048\u308b\nAnsible\u3092\u5229\u7528\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u3048\u308b\u3002\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092Ansible\u3067\u884c\u3046\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u3068\u3059\u308b\u30a2\u30d7\u30ea\nGitLab\u306b\u6c7a\u3081\u3066\u307f\u305f\u3002\n\nUbuntu-14.04\u5411\u3051\u3067\u3042\u308c\u3070\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\uff01\n\u306a\u3093\u3068\u697d\u306a\u3093\u3060\u308d\u3046\u3002Gitlab\u3092apt\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304d\u306b\u306fchef\u304c\u4f7f\u308f\u308c\u308b\u3051\u3069...\nhttps://about.gitlab.com/downloads/\n\nAnsible playbook\u3092\u7528\u610f\u3059\u308b\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306eAnsible playbook\u3092\u66f8\u3044\u3066\u307f\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u306eOS\u306fUbuntu 14.04 LTS\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u30a2\u30d7\u30ea\u306fGitLab\napt\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u72b6\u614b\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\n\n\u3068\u3044\u3046\u6761\u4ef6\u306a\u306e\u3067\u3001\u7279\u306b\u8003\u3048\u305a\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3060\u3051\u306e\nAnsible playbook\u3092\u66f8\u3044\u305f\u3002\nansible-gitlab-from-package\n.\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 Vagrantfile\n\u251c\u2500\u2500 gitlab.yml\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 gitlab\n        \u2514\u2500\u2500 tasks\n            \u251c\u2500\u2500 install.yml\n            \u251c\u2500\u2500 main.yml\n            \u251c\u2500\u2500 reconfigure.yml\n            \u251c\u2500\u2500 setup.yml\n            \u2514\u2500\u2500 update-gitlab.rb.yml\n\n\n/etc/gitlab/gitlab.rb\n\u30db\u30b9\u30c8\u540d\u3092\u8a2d\u5b9a\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3060\u304c\u3001\nAnsible playbook\u306e\u4e2d\u3067\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30b3\u30d4\u30fc\u3059\u308b\u5f62\u3067\u5bfe\u5fdc\u3059\u308b\u3002\nVagrant\u3067\u4f5c\u6210\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u7acb\u3061\u4e0a\u3052\u308b\u6642\u306b\u5272\u308a\u5f53\u3066\u308b\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n---\n- name: update gitlab.rb\n  lineinfile: dest=/etc/gitlab/gitlab.rb\n              regexp=^external_url\n              line=\"external_url 'http://192.168.33.10/'\"\n\n\nVagrantfile\u306bAnsible playbook\u3092\u5229\u7528\u3059\u308b\u5f62\u306b\u66f4\u65b0\u3059\u308b\n\u5148\u307b\u3069\u66f8\u3044\u305fVagrantfile\u306bAnsible playbook\u3092\u5229\u7528\u3059\u308b\u5f62\u306b\u66f4\u65b0\u3092\u884c\u3046\u3002\nAnsible playbook\u306eroot\u4ee5\u4e0b\u306bVagrantfile\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n\n  config.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n  config.ssh.forward_agent = true\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n    vb.customize [\"modifyvm\", :id, \"--memory\", \"1024\"]\n    vb.customize [\"modifyvm\", :id, \"--ioapic\", \"on\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnshostresolver1\", \"off\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnsproxy1\", \"off\"]\n  end\n\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"gitlab.yml\"\n    ansible.limit = \"all\"\n  end\nend\n\n\nVagrant box\u306b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u9069\u7528\n> vagrant up --provision\n\n\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u7d42\u308f\u308b\u307e\u3067\u66ab\u304f\u5f85\u3064\u3002\nGitlab\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u3001\u6642\u9593\u304c\u304b\u304b\u308b\u3002\n\n\nGitlab\u306b\u30a2\u30af\u30bb\u30b9\nGitlab\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u7d42\u3048\u3001gitlab-ctl reconfigure\u3082\u7d42\u3048\u3066\u3044\u308b\u3002\nGitlab\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3088\u3046\u3002\n> open http://192.168.33.10/\n\n\n\u30b5\u30a4\u30f3\u30a4\u30f3\u753b\u9762\u304c\u51fa\u305f\uff01\n\nGiglab\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\nUsername: root \nPassword: 5iveL!fe\n\n\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30e0\u306b\u5165\u529b\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3092\u3057\u3066\u307f\u308b\u3002\n\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u753b\u9762\u304c\u51fa\u305f\u306e\u3067\u9069\u5f53\u306b\u5909\u66f4\u3057\u3001\n\n\u30ed\u30b0\u30a4\u30f3\u6210\u529f\uff01\nGitlab\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u697d\u306a\u3093\u3060\u306a...(\u30c7\u30a3\u30b9\u30c8\u30ea\u306f\u9078\u3076\u3082\u306e\u306e)\n\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092package\u5316\nVagrant box\u3092package\u5316\u3057\u3066\u304a\u304f\u3002\n\u3044\u3061\u3044\u3061packer -> Vagrant -> ansible\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\n\u8e0f\u307e\u306a\u304f\u3066\u3082\u826f\u3044\u3088\u3046\u306b\u3002\u4ed6\u4eba\u306b\u3068\u308a\u3042\u3048\u305a\u5171\u6709\u3057\u305f\u304b\u3063\u305f\u308a\u3001\u74b0\u5883\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u610f\u5473\u3067\u3082\u3002\nVagrantfile\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\n\u3053\u306e\u5834\u5408\u306fAnsible playbook\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306a\u306e\u3060\u3051\u3069\u3001\n\u305d\u3053\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\n> vagrant package\n\n\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u73fe\u72b6\u52d5\u4f5c\u3057\u3066\u3044\u308bVagrant box\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092\u3069\u3063\u304b\u306b\u4fdd\u5b58\u3059\u308b\u306a\u308a\u3057\u3066\u304a\u3051\u3070\u3001\nVagrant box\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u306bvagrant up\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u306b\u306a\u308b\u306e\u3067\u697d\u3060\u3002\n\n\u5b89\u5b9a\u3057\u3066\u304d\u305f\u611f\u306e\u3042\u308bVagrant\u904b\u7528\nVagrant\u3067\u7acb\u3061\u4e0a\u3052\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u3001\n/vagrant\u3067root\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u308a\u3001\n\u305d\u3082\u305d\u3082\u958b\u767a\u74b0\u5883\u3092\u4eee\u60f3\u74b0\u5883\u3068\u306f\u3044\u3048\u7d71\u4e00\u3067\u304d\u308b(\u30c7\u30a3\u30b9\u30c8\u30ea\u306e\u5dee\u306a\u3069\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5dee\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u304b\u3089\u7279\u306b)\u306e\u3067\u826f\u3044\u3068\u601d\u3046\u3002\npacker -> ansible -> Vagrant \u3063\u3066\u884c\u3063\u3066\u3057\u307e\u3048\u3070\u3044\u3044\u3088\u3046\u306a\u6c17\u3082\u3059\u308b\u3051\u3069\u3002\n# packer -> Vagrant -> Ansible\n\n\u306a\u3093\u3068\u306a\u304f\u3001\u6d41\u308c\u3068\u3057\u3066\u4f5c\u3063\u3066\u304a\u304f\u3068\u826f\u3055\u305d\u3046\n\n# packer -> Vagrant box\u4f5c\u6210\n\n## \u5916\u90e8\u304b\u3089packer template\u3092\u5165\u624b\u3059\u308b\n\n\u81ea\u5206\u3067\u4f5c\u3063\u3066\u3082\u3044\u3044\u3051\u3069\u3001\u6700\u521d\u304b\u3089Enter\u3092\u62bc\u3059\u306a\u3069\u306e\u64cd\u4f5c\u3092\u8d77\u3053\u3059\u306e\u306f\u3060\u308b\u3044\u306e\u3067\u3001\n\u65e2\u5b58\u306epacker template\u3092\u53d6\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u500b\u4eba\u7684\u306b\u304a\u3059\u3059\u3081\u306a\u306e\u306f[chef\u793e\u306ebento](https://github.com/opscode/bento)\u3002\n\npacker template\u306f\u3001\n\nhttps://github.com/opscode/bento/tree/master/packer\n\n\u4ee5\u4e0b\u306b\u3042\u308b\u3002\n\n## chef\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u524a\u9664\n\n\u50d5\u3068\u3057\u3066\u306f\u3001chef\u306f\u5229\u7528\u3057\u306a\u3044\u5f62\u306a\u306e\u3067\u3001\nprovisioner\u304b\u3089chef\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7b87\u6240\u3092\u524a\u9664\u3057\u3066\u5229\u7528\u3059\u308b\u3002\n\n[Ubuntu 14.04\u306etemplate.json](https://github.com/opscode/bento/blob/ad9955bba5075af70ecd9fdfe7e00726ec8ac945/packer/ubuntu-14.04-amd64.json)\u3092\u4f8b\u306b\u53d6\u308b\u3068\u3001\n\n\u4ee5\u4e0b\u306e\u90e8\u5206\u3092\u524a\u9664\u3059\u308b\u3002chef.sh\u3092\u524a\u9664\u3059\u308b\u3060\u3051\u3002\n\n```diff:ubuntu-14.04-amd64.json#L172\ndiff --git packer/ubuntu-14.04-amd64.json packer/ubuntu-14.04-amd64.json\nindex 0522db4..41e62d8 100644\n--- packer/ubuntu-14.04-amd64.json\n+++ packer/ubuntu-14.04-amd64.json\n@@ -182,7 +182,6 @@\n         \"scripts/ubuntu/sudoers.sh\",\n         \"scripts/common/vagrant.sh\",\n         \"scripts/common/vmtools.sh\",\n-        \"scripts/common/chef.sh\",\n         \"scripts/ubuntu/cleanup.sh\",\n         \"scripts/common/minimize.sh\"\n       ],\n```\n\n## packer template\u3088\u308aVagrant box\u3092\u4f5c\u6210\u3059\u308b\n\npacker template\u3092\u7de8\u96c6\u3057\u7d42\u3048\u305f\u3089\u3001\n\n```\n> packer build template.json\n```\n\n\u3092\u5b9f\u884c\u3057\u3001Vagrant box\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u5148\u307b\u3069\u3042\u3052\u305f[bento\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8](https://github.com/opscode/bento/blob/master/packer/ubuntu-14.04-amd64.json)\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001\n\u4ee5\u4e0b\u306e\u5f62\u3067Vagrant box\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\n```bash\n> git clone git@github.com:opscode/bento.git\n> cd bento/packer\n> sed -i '/chef\\.sh/d' ubuntu-14.04-amd64.json\n> packer build ubuntu-14.04-amd64.json\n```\n\n## \u66ab\u3057\u5f85\u3064\n\n![packer.gif](https://dl.dropboxusercontent.com/u/614755/qiita/vagrant-packer/packer.gif)\n\n## \u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092\u767b\u9332\n\n```bash\n> cd ../builds/virtualbox/\n> vagrant box add ubuntu-14.04 opscode_ubuntu-14.04_chef-provisionerless.box\n> vagrant box list\nubuntu-14.04                                             (virtualbox, 0)\n```\n\n# Vagrant\n\n## \u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001Vagrantfile\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n> mkdir \n> vagrant init\n```\n\n## Vagrantfile\u306e\u7de8\u96c6\n\n\u30b3\u30a2\u6570\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306a\u3069\u3092\u3044\u3058\u3063\u3066\u304a\u304f\n\n```rb:Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n\n  config.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n  config.ssh.forward_agent = true\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n    vb.customize [\"modifyvm\", :id, \"--memory\", \"1024\"]\n    # \u53c2\u8003: http://qiita.com/d_nishiyama85/items/c50c95795865ae7f714b\n    vb.customize [\"modifyvm\", :id, \"--ioapic\", \"on\"]\n    # \u53c2\u8003: http://shibayu36.hatenablog.com/entry/2013/08/12/090545\n    vb.customize [\"modifyvm\", :id, \"--natdnshostresolver1\", \"off\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnsproxy1\", \"off\"]\n  end\nend\n```\n\n## \u4f5c\u6210\u3057\u305fVagrant box\u306e\u7acb\u3061\u4e0a\u3052\n\n```\n> vagrant up\n```\n\n\u3067\u7acb\u3061\u4e0a\u3052\u3002\n\n![vagrant-up](https://dl.dropboxusercontent.com/u/614755/qiita/vagrant-packer/vagrant-up.gif)\n\n# Ansible\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u3048\u308b\n\n[Ansible](http://www.ansible.com/home)\u3092\u5229\u7528\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u52d5\u4f5c\u74b0\u5883\u3092\u6574\u3048\u308b\u3002\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092Ansible\u3067\u884c\u3046\u3002\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u3068\u3059\u308b\u30a2\u30d7\u30ea\n\n[GitLab](https://about.gitlab.com/)\u306b\u6c7a\u3081\u3066\u307f\u305f\u3002\n\n![Screen Shot 2014-10-25 at 18.48.19.png](https://qiita-image-store.s3.amazonaws.com/0/3985/18a56554-f81e-4ead-464b-eefc81161bcd.png)\n\nUbuntu-14.04\u5411\u3051\u3067\u3042\u308c\u3070\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\uff01\n\u306a\u3093\u3068\u697d\u306a\u3093\u3060\u308d\u3046\u3002Gitlab\u3092apt\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u304d\u306b\u306fchef\u304c\u4f7f\u308f\u308c\u308b\u3051\u3069...\n\nhttps://about.gitlab.com/downloads/\n\n## Ansible playbook\u3092\u7528\u610f\u3059\u308b\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u305f\u3081\u306eAnsible playbook\u3092\u66f8\u3044\u3066\u307f\u308b\u3002\n\n- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5bfe\u8c61\u306eOS\u306fUbuntu 14.04 LTS\n- \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3046\u30a2\u30d7\u30ea\u306fGitLab\n- apt\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u72b6\u614b\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u914d\u5e03\u3055\u308c\u3066\u3044\u308b\n\n\u3068\u3044\u3046\u6761\u4ef6\u306a\u306e\u3067\u3001\u7279\u306b\u8003\u3048\u305a\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3060\u3051\u306e\nAnsible playbook\u3092\u66f8\u3044\u305f\u3002\n\n[ansible-gitlab-from-package](https://github.com/futoase/ansible-gitlab-from-package)\n\n```bash\n.\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 Vagrantfile\n\u251c\u2500\u2500 gitlab.yml\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 gitlab\n        \u2514\u2500\u2500 tasks\n            \u251c\u2500\u2500 install.yml\n            \u251c\u2500\u2500 main.yml\n            \u251c\u2500\u2500 reconfigure.yml\n            \u251c\u2500\u2500 setup.yml\n            \u2514\u2500\u2500 update-gitlab.rb.yml\n```\n\n## /etc/gitlab/gitlab.rb\n\n\u30db\u30b9\u30c8\u540d\u3092\u8a2d\u5b9a\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3060\u304c\u3001\nAnsible playbook\u306e\u4e2d\u3067\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30b3\u30d4\u30fc\u3059\u308b\u5f62\u3067\u5bfe\u5fdc\u3059\u308b\u3002\nVagrant\u3067\u4f5c\u6210\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u7acb\u3061\u4e0a\u3052\u308b\u6642\u306b\u5272\u308a\u5f53\u3066\u308b\n\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9\u3092\u5272\u308a\u5f53\u3066\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\n```yaml\n---\n- name: update gitlab.rb\n  lineinfile: dest=/etc/gitlab/gitlab.rb\n              regexp=^external_url\n              line=\"external_url 'http://192.168.33.10/'\"\n```\n\n## Vagrantfile\u306bAnsible playbook\u3092\u5229\u7528\u3059\u308b\u5f62\u306b\u66f4\u65b0\u3059\u308b\n\n\u5148\u307b\u3069\u66f8\u3044\u305fVagrantfile\u306bAnsible playbook\u3092\u5229\u7528\u3059\u308b\u5f62\u306b\u66f4\u65b0\u3092\u884c\u3046\u3002\nAnsible playbook\u306eroot\u4ee5\u4e0b\u306bVagrantfile\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\n\n```rb\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\n# Vagrantfile API/syntax version. Don't touch unless you know what you're doing!\nVAGRANTFILE_API_VERSION = \"2\"\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"ubuntu-14.04\"\n\n  config.vm.network \"private_network\", ip: \"192.168.33.10\"\n\n  config.ssh.forward_agent = true\n\n  config.vm.provider \"virtualbox\" do |vb|\n    vb.gui = false\n    vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n    vb.customize [\"modifyvm\", :id, \"--memory\", \"1024\"]\n    vb.customize [\"modifyvm\", :id, \"--ioapic\", \"on\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnshostresolver1\", \"off\"]\n    vb.customize [\"modifyvm\", :id, \"--natdnsproxy1\", \"off\"]\n  end\n\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"gitlab.yml\"\n    ansible.limit = \"all\"\n  end\nend\n```\n\n## Vagrant box\u306b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u9069\u7528\n\n```\n> vagrant up --provision\n```\n\n\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u304c\u7d42\u308f\u308b\u307e\u3067\u66ab\u304f\u5f85\u3064\u3002\nGitlab\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f\u3001\u6642\u9593\u304c\u304b\u304b\u308b\u3002\n\n![Screen Shot 2014-10-27 at 15.05.11.png](https://qiita-image-store.s3.amazonaws.com/0/3985/697e4a21-f505-6e8b-f9a5-585b01f2f417.png)\n\n\n## Gitlab\u306b\u30a2\u30af\u30bb\u30b9\n\nGitlab\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u7d42\u3048\u3001```gitlab-ctl reconfigure```\u3082\u7d42\u3048\u3066\u3044\u308b\u3002\nGitlab\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u3088\u3046\u3002\n\n```\n> open http://192.168.33.10/\n```\n\n![Screen Shot 2014-10-27 at 15.31.26.png](https://qiita-image-store.s3.amazonaws.com/0/3985/51b6a9b5-90e0-cfb2-1a3c-820d33d82602.png)\n\n\u30b5\u30a4\u30f3\u30a4\u30f3\u753b\u9762\u304c\u51fa\u305f\uff01\n\n## Giglab\u306b\u30b5\u30a4\u30f3\u30a4\u30f3\n\n```\nUsername: root \nPassword: 5iveL!fe\n```\n\n\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\u3001\u30d5\u30a9\u30fc\u30e0\u306b\u5165\u529b\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3092\u3057\u3066\u307f\u308b\u3002\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u753b\u9762\u304c\u51fa\u305f\u306e\u3067\u9069\u5f53\u306b\u5909\u66f4\u3057\u3001\n\n![Screen Shot 2014-10-27 at 15.33.38.png](https://qiita-image-store.s3.amazonaws.com/0/3985/7b4e1f6b-7644-eb4f-2238-eb3a5d14ab72.png)\n\n\u30ed\u30b0\u30a4\u30f3\u6210\u529f\uff01\nGitlab\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u697d\u306a\u3093\u3060\u306a...(\u30c7\u30a3\u30b9\u30c8\u30ea\u306f\u9078\u3076\u3082\u306e\u306e)\n\n![Screen Shot 2014-10-27 at 15.34.16.png](https://qiita-image-store.s3.amazonaws.com/0/3985/24f850fc-b49f-cbfb-b5d2-ef350af746d0.png)\n\n# \u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092package\u5316\n\nVagrant box\u3092package\u5316\u3057\u3066\u304a\u304f\u3002\n\u3044\u3061\u3044\u3061packer -> Vagrant -> ansible\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\n\u8e0f\u307e\u306a\u304f\u3066\u3082\u826f\u3044\u3088\u3046\u306b\u3002\u4ed6\u4eba\u306b\u3068\u308a\u3042\u3048\u305a\u5171\u6709\u3057\u305f\u304b\u3063\u305f\u308a\u3001\u74b0\u5883\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u610f\u5473\u3067\u3082\u3002\n\nVagrantfile\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3001\n\u3053\u306e\u5834\u5408\u306fAnsible playbook\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306a\u306e\u3060\u3051\u3069\u3001\n\u305d\u3053\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\n\n```\n> vagrant package\n```\n\n\u6642\u9593\u304c\u304b\u304b\u308b\u304c\u3001\u73fe\u72b6\u52d5\u4f5c\u3057\u3066\u3044\u308bVagrant box\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\n![Screen Shot 2014-10-27 at 16.01.19.png](https://qiita-image-store.s3.amazonaws.com/0/3985/388ee628-c656-20ff-3a45-9eb876e2aa7b.png)\n\n\u51fa\u6765\u4e0a\u304c\u3063\u305fVagrant box\u3092\u3069\u3063\u304b\u306b\u4fdd\u5b58\u3059\u308b\u306a\u308a\u3057\u3066\u304a\u3051\u3070\u3001\nVagrant box\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u5f8c\u306b```vagrant up```\u3092\u5b9f\u884c\u3059\u308b\u3060\u3051\u306b\u306a\u308b\u306e\u3067\u697d\u3060\u3002\n\n# \u5b89\u5b9a\u3057\u3066\u304d\u305f\u611f\u306e\u3042\u308bVagrant\u904b\u7528\n\nVagrant\u3067\u7acb\u3061\u4e0a\u3052\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u3001\n**/vagrant**\u3067root\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u305f\u308a\u3001\n\u305d\u3082\u305d\u3082\u958b\u767a\u74b0\u5883\u3092\u4eee\u60f3\u74b0\u5883\u3068\u306f\u3044\u3048\u7d71\u4e00\u3067\u304d\u308b(\u30c7\u30a3\u30b9\u30c8\u30ea\u306e\u5dee\u306a\u3069\u306f\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5dee\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u304b\u3089\u7279\u306b)\u306e\u3067\u826f\u3044\u3068\u601d\u3046\u3002\n\npacker -> ansible -> Vagrant \u3063\u3066\u884c\u3063\u3066\u3057\u307e\u3048\u3070\u3044\u3044\u3088\u3046\u306a\u6c17\u3082\u3059\u308b\u3051\u3069\u3002\n", "tags": ["packer", "vagrant", "Ansible"]}