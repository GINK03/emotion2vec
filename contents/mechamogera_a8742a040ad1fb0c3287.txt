{"context": " More than 1 year has passed since last update.CloudFormation\u3067Static Website Hosting\u3059\u308bS3\u3092\u81ea\u52d5\u69cb\u6210\u3057\u3066\u307f\u305f\n\n\nCloudFormation\u306eTemplate\n\n\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\n\n\n\u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u306b\u4f7f\u7528\u3059\u308b\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\nStaticDomain\uff1a\u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u3092\u63d0\u4f9b\u3059\u308b\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\nStaticHostedZone\uff1a\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u63d0\u4f9b\u3059\u308bRoute53\u306eHostedZone\u540d\n\n\n\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\n\n\nStatic Website Hosting\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\n\u7279\u5b9a\u306eIP\uff08192.168.0.0/16\uff09\u304b\u3089\u306eGetObject\u3092\u8a31\u53ef\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\nRoute53\u306e\u30ec\u30b3\u30fc\u30c9(CNAME\u3067S3\u306eStatic Website\u3092\u767b\u9332)\n\n\n\u51fa\u529b\n\n\nStaticURL\uff1a\u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u3078\u306eURL\n\n\n\n{                                                                                                     \n  \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n  \"Description\" : \"Sample\",\n\n  \"Parameters\" : { \n     \"StaticDomain\" : { \n        \"Type\" : \"String\",\n        \"Default\" : \"hogemoge.test.com\",\n        \"Description\" : \"domain for static\"\n     },  \n     \"StaticHostedZone\" : { \n        \"Type\" : \"String\",\n        \"Default\" : \"test.com\",\n        \"Description\" : \"hosted zone for static\"\n     }   \n  },  \n\n  \"Resources\" : { \n\n    \"StaticBucket\" : { \n      \"Type\" : \"AWS::S3::Bucket\",\n      \"Properties\" : { \n        \"BucketName\" : { \"Ref\" : \"StaticDomain\" },\n        \"WebsiteConfiguration\" : { \"IndexDocument\" : \"index.html\", \"ErrorDocument\" : \"error.html\" }\n      }\n    },\n\n    \"StaticBucketPolicy\" : {\n      \"Type\" : \"AWS::S3::BucketPolicy\",\n      \"Properties\" : {\n        \"Bucket\" : { \"Ref\" : \"StaticBucket\" },\n        \"PolicyDocument\" : {\n           \"Statement\": [{\n             \"Effect\": \"Allow\",\n             \"Principal\": { \"AWS\": \"*\" },\n             \"Action\": [\"s3:GetObject\"],\n             \"Resource\": { \"Fn::Join\" : [\"\", [\"arn:aws:s3:::\", { \"Ref\" : \"StaticBucket\" } , \"/*\" ]] },\n             \"Condition\": {\n               \"IpAddress\": {\n                  \"aws:SourceIp\": [\n                    \"192.168.0.0/16\"\n                  ]\n               }\n             }\n           }]\n        }\n      }\n    },\n\n    \"StaticRecord\" : { \n      \"Type\" : \"AWS::Route53::RecordSet\",\n      \"Properties\" : { \n        \"HostedZoneName\" : { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticHostedZone\" }, \".\"]] },\n        \"Name\" : { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticDomain\" }, \".\"]] },\n        \"Type\" : \"CNAME\",\n        \"Comment\" : \"TestCreated\",\n        \"TTL\" : \"300\",\n        \"ResourceRecords\" : [\n           { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticBucket\" }, \".s3-website-\", { \"Ref\" : \"AWS::Region\" }, \".amazonaws.com\" ]] }                                                                                \n        ]\n      }   \n    }\n\n  },\n\n  \"Outputs\" : {\n    \"StaticURL\" : {\n      \"Value\" : { \"Fn::Join\" : [\"\", [\"http://\", { \"Ref\" : \"StaticDomain\" } ]] }\n    }\n  }\n}\n\n\nTemplate\u4f5c\u6210\u306b\u3064\u3044\u3066\n\n\n\u30ea\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\n\nAWS Resource Types Reference - AWS CloudFormation\n\n\n\nRuby\u30b9\u30af\u30ea\u30d7\u30c8\u3067template validate\n\neclipse\u306eplugin\u5229\u7528\u3057\u306a\u304f\u3066\u3082\u3053\u306e\u7a0b\u5ea6\u306e\u898f\u6a21\u306etemplate\u306a\u3089\u3053\u308c\u304f\u3089\u3044\u306evalidate\u3067\u554f\u984c\u306a\u304b\u3063\u305f\n\n\n\n#!/bin/env ruby                                                                 \nrequire 'json'\nrequire 'aws-sdk'\n\ntarget = File.read(ARGV[0])\n\nJSON.parse(target)\n\ncf = AWS::CloudFormation.new(proxy_uri: ENV['HTTP_PROXY'] || ENV['http_proxy'])\nputs cf.validate_template(target)\n\nCloudFormation\u3067Static Website Hosting\u3059\u308bS3\u3092\u81ea\u52d5\u69cb\u6210\u3057\u3066\u307f\u305f\n\n![cf_s3static_hosting.png](https://qiita-image-store.s3.amazonaws.com/0/16768/b6daf39c-01f2-f95b-c2ed-ca22f79f09d6.png)\n\n## CloudFormation\u306eTemplate\n\n * \u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\n  * \u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u306b\u4f7f\u7528\u3059\u308b\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\n  * StaticDomain\uff1a\u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u3092\u63d0\u4f9b\u3059\u308b\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\n  * StaticHostedZone\uff1a\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u63d0\u4f9b\u3059\u308bRoute53\u306eHostedZone\u540d\n * \u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\n  * Static Website Hosting\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\n  * \u7279\u5b9a\u306eIP\uff08192.168.0.0/16\uff09\u304b\u3089\u306eGetObject\u3092\u8a31\u53ef\u3059\u308bS3\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\n  * Route53\u306e\u30ec\u30b3\u30fc\u30c9(CNAME\u3067S3\u306eStatic Website\u3092\u767b\u9332)\n * \u51fa\u529b\n  * StaticURL\uff1a\u9759\u7684\u306aWeb\u30b5\u30a4\u30c8\u3078\u306eURL\n \n```json\n{                                                                                                     \n  \"AWSTemplateFormatVersion\" : \"2010-09-09\",\n  \"Description\" : \"Sample\",\n\n  \"Parameters\" : { \n     \"StaticDomain\" : { \n        \"Type\" : \"String\",\n        \"Default\" : \"hogemoge.test.com\",\n        \"Description\" : \"domain for static\"\n     },  \n     \"StaticHostedZone\" : { \n        \"Type\" : \"String\",\n        \"Default\" : \"test.com\",\n        \"Description\" : \"hosted zone for static\"\n     }   \n  },  \n\n  \"Resources\" : { \n\n    \"StaticBucket\" : { \n      \"Type\" : \"AWS::S3::Bucket\",\n      \"Properties\" : { \n        \"BucketName\" : { \"Ref\" : \"StaticDomain\" },\n        \"WebsiteConfiguration\" : { \"IndexDocument\" : \"index.html\", \"ErrorDocument\" : \"error.html\" }\n      }\n    },\n\n    \"StaticBucketPolicy\" : {\n      \"Type\" : \"AWS::S3::BucketPolicy\",\n      \"Properties\" : {\n        \"Bucket\" : { \"Ref\" : \"StaticBucket\" },\n        \"PolicyDocument\" : {\n           \"Statement\": [{\n             \"Effect\": \"Allow\",\n             \"Principal\": { \"AWS\": \"*\" },\n             \"Action\": [\"s3:GetObject\"],\n             \"Resource\": { \"Fn::Join\" : [\"\", [\"arn:aws:s3:::\", { \"Ref\" : \"StaticBucket\" } , \"/*\" ]] },\n             \"Condition\": {\n               \"IpAddress\": {\n                  \"aws:SourceIp\": [\n                    \"192.168.0.0/16\"\n                  ]\n               }\n             }\n           }]\n        }\n      }\n    },\n\n    \"StaticRecord\" : { \n      \"Type\" : \"AWS::Route53::RecordSet\",\n      \"Properties\" : { \n        \"HostedZoneName\" : { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticHostedZone\" }, \".\"]] },\n        \"Name\" : { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticDomain\" }, \".\"]] },\n        \"Type\" : \"CNAME\",\n        \"Comment\" : \"TestCreated\",\n        \"TTL\" : \"300\",\n        \"ResourceRecords\" : [\n           { \"Fn::Join\" : [\"\", [{ \"Ref\" : \"StaticBucket\" }, \".s3-website-\", { \"Ref\" : \"AWS::Region\" }, \".amazonaws.com\" ]] }                                                                                \n        ]\n      }   \n    }\n\n  },\n\n  \"Outputs\" : {\n    \"StaticURL\" : {\n      \"Value\" : { \"Fn::Join\" : [\"\", [\"http://\", { \"Ref\" : \"StaticDomain\" } ]] }\n    }\n  }\n}\n```\n\n## Template\u4f5c\u6210\u306b\u3064\u3044\u3066\n\n* \u30ea\u30bd\u30fc\u30b9\u306e\u8a18\u8ff0\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\n * [AWS Resource Types Reference - AWS CloudFormation](http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-template-resource-type-ref.html)\n\n* Ruby\u30b9\u30af\u30ea\u30d7\u30c8\u3067template validate\n * eclipse\u306eplugin\u5229\u7528\u3057\u306a\u304f\u3066\u3082\u3053\u306e\u7a0b\u5ea6\u306e\u898f\u6a21\u306etemplate\u306a\u3089\u3053\u308c\u304f\u3089\u3044\u306evalidate\u3067\u554f\u984c\u306a\u304b\u3063\u305f\n\n```rb\n#!/bin/env ruby                                                                 \nrequire 'json'\nrequire 'aws-sdk'\n\ntarget = File.read(ARGV[0])\n\nJSON.parse(target)\n\ncf = AWS::CloudFormation.new(proxy_uri: ENV['HTTP_PROXY'] || ENV['http_proxy'])\nputs cf.validate_template(target)\n```", "tags": ["AWS", "CloudFormation", "Ruby"]}