{"tags": ["docker", "DockerSwarm"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\ndocker 1.9.0\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3001docker network\u30b3\u30de\u30f3\u30c9\u304cproduction\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u7279\u306b\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304cdocker\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u6210\u53ef\u80fd\u306b\u306a\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\ndocker network\u30b3\u30de\u30f3\u30c9\u3068\u306f\ndocker network\u306f\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u64cd\u4f5c\u30fb\u7ba1\u7406\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\nDocker Swarm\u3068\u9023\u643a\u3059\u308c\u3070\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u9593\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u69cb\u7bc9\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u9593\u304c\u901a\u4fe1\u3067\u304d\u308b\u3002\n\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u306e\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u3084\u65b9\u6cd5\u306f\u4ed6\u306b\u3082\u3044\u308d\u3044\u308d\u3042\u308b\u3002weave\u3001etcd+flannel\u3001runcher\u3001bridge\u63a5\u7d9a+GRE\u306a\u3069\u306a\u3069\u3002\n\n\u74b0\u5883\n\u4eca\u56de\u306f2\u3064\u306eDocker\u30db\u30b9\u30c8VM\u3092Swarm\u3067\u30af\u30e9\u30b9\u30bf\u5316\u3057\u3001docker network\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u69cb\u7bc9\u3057\u3066\u3001\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u901a\u4fe1\u304c\u3067\u304d\u308b\u304b\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\u3042\u3068docker network\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308boverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fLinux Kernel 3.16\u4ee5\u4e0a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002CentOS7\u306f3.10\u306a\u306e\u3067\u30013.18\u3092\u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\uff08kernel\u30d3\u30eb\u30c9\u90e8\u5206\u306f\u7701\u7565\uff09Ubuntu 14.10\u306e\u30ab\u30fc\u30cd\u30eb\u306f3.16\u306a\u306e\u3067\u3001Ubuntu\u3067\u8a66\u305b\u3070\u3088\u304b\u3063\u305f\u3002\n\nCentOS7(VM) x2\u53f0\n\n\ndocker01 :192.168.11.48 (consul server)\ndocker02 :192.168.11.49 (consul client)\n\n\nLinux Kernel 3.18\nDocker 1.9.0\nDocker Swarm 1.0\nconsul 0.5.2(Docker Swarm\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9KVS)\n\n\n\u3084\u3063\u305f\u3053\u3068\u76ee\u6b21\n\nconsul\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\nDocker1.9.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\nDocker Swarm\u3067\u30af\u30e9\u30b9\u30bf\u5316\noverlay network\u306e\u4f5c\u6210\n\u30b3\u30f3\u30c6\u30ca\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u63a5\u7d9a\u3057\u3066\u8d77\u52d5\n\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u758e\u901a\u78ba\u8a8d\n\n\nconsul\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u914d\u7f6e\u3059\u308b\u3060\u3051\u3002\u5408\u308f\u305b\u3066\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ wget https://releases.hashicorp.com/consul/0.5.2/consul_0.5.2_linux_amd64.zip\n$ unzip consul_0.5.2_linux_amd64.zip\n$ sudo cp consul /usr/local/bin/\n$ sudo mkdir -p {/etc/consul,/var/lib/consul,/var/log/consul}\n\nconsul\u8a2d\u5b9a\nconsul\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092server\u3068client\u306e2\u7a2e\u985e\u4f5c\u6210\u3057\u307e\u3059\u3002\ndocker01(consul server)\n\n/etc/consul/consul.json\n{\n  \"datacenter\": \"docker\",\n  \"addresses\" : {\n    \"http\": \"0.0.0.0\"\n  },\n  \"bind_addr\": \"192.168.11.48\",\n  \"node_name\": \"docker01\",\n  \"domain\": \"consul\",\n  \"server\": true,\n  \"bootstrap_expect\": 1,\n  \"data_dir\": \"/var/lib/consul\"\n}\n\n\ndocker02(consul client)\n\n/etc/consul/consul.json\n{\n  \"datacenter\": \"docker\",\n  \"addresses\" : {\n    \"http\": \"0.0.0.0\"\n  },\n  \"bind_addr\": \"192.168.11.49\",\n  \"node_name\": \"docker02\",\n  \"domain\": \"consul\",\n  \"retry_join\": [ \"192.168.11.48\"],\n  \"server\": false,\n  \"data_dir\": \"/var/lib/consul\"\n}\n\n\nconsul\u8d77\u52d5\n\ndocker01&docker02\n$ consul -config-file=/etc/consul/consul.json >> /var/log/consul/consul.log &\n$ consul members\nNode      Address             Status  Type    Build  Protocol  DC\ndocker02  192.168.11.49:8301  alive   client  0.5.2  2         docker\ndocker01  192.168.11.48:8301  alive   server  0.5.2  2         docker\n\n\n\u3061\u3083\u3093\u3068consul\u30af\u30e9\u30b9\u30bf\u306bdocker01,02\u304c\u3044\u307e\u3059\u306d\u3002\n\nDocker 1.9.0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nCentOS7\u306f\u307e\u3060yum\u306b\u3042\u308bdocker\u304c1.8.2\u306a\u306e\u3067(2015/11/9\u73fe\u5728)\u3001\u6700\u65b0\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u633f\u3057\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\n\ndocker01&docker02\n$ sudo yum install -y docker\n$ curl -o docker-1.9.0 https://get.docker.com/builds/Linux/x86_64/docker-1.9.0\n$ sudo cp docker-1.9.0 /usr/bin/docker\n$ sudo chmod +x /usr/bin/docker\n\n\nDocker Engine\u8a2d\u5b9a\ndocker daemon\u306e--cluster-store --cluster-advertise\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308cKVS\u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30db\u30b9\u30c8\u81ea\u8eab\u306eipaddress:port\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n/etc/sysconfig/docker(docker01&docker02)\nOPTIONS='--cluster-store=consul://localhost:8500 --cluster-advertise=<\u30db\u30b9\u30c8IP>:2376 -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock'\n\n\nDocker\u8d77\u52d5\n\ndocker01&docker02\n$ sudo systemctl start docker\n\n\n\nDocker Swarm\u30af\u30e9\u30b9\u30bf\u8d77\u52d5\ndocker01\u306e\u30db\u30b9\u30c8\u3067Swarm\u306e\u30af\u30e9\u30b9\u30bf\u30de\u30cd\u30fc\u30b8\u30e3\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\ndocker01\n$ docker run -d -p 2377:2375 --name swarm-manage-consul swarm manage consul://192.168.11.48:8500/docker\n\n\n\u5404\u30db\u30b9\u30c8\u3067Swarm\u30af\u30e9\u30b9\u30bf\u3078join\u3059\u308b\u305f\u3081\u306eswarm\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002docker\u30b3\u30de\u30f3\u30c9\u304cswarm\u30de\u30cd\u30fc\u30b8\u30e3\u30b3\u30f3\u30c6\u30ca\u306b\u5411\u3051\u3066\u5b9f\u884c\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\n\ndocker01&docker02\n# docker01\n$ docker run -d --name swarm-join swarm join --advertise=192.168.11.48:2375 consul://192.168.11.48:8500/docker\n# docker02\n$ docker run -d --name swarm-join swarm join --advertise=192.168.11.49:2375 consul://192.168.11.48:8500/docker\n$ docker -H tcp://192.168.11.48:2377 info\nContainers: 3\nImages: 4\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n centos7-01: 192.168.11.48:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 2.052 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.18.22, operatingsystem=CentOS Linux 7 (Core), storagedriver=overlay\n centos7-02: 192.168.11.49:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 2.052 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.18.22, operatingsystem=CentOS Linux 7 (Core), storagedriver=overlay\nCPUs: 4\nTotal Memory: 4.103 GiB\nName: 755cb58b105c\n\n\n\u3053\u3053\u307e\u3067\u3067docker network\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3044\u3088\u3044\u3088\u6b21\u306foverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\u3057\u307e\u3059\u3002\n\noverlay network\u306e\u4f5c\u6210\ndocker network create\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n1\u3064\u306e\u30db\u30b9\u30c8\u3067\u4f5c\u6210\u3057\u305fvn01\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306f\u30af\u30e9\u30b9\u30bf\u306e\u5168\u30db\u30b9\u30c8\u3067\u5171\u6709\u3055\u308c\u307e\u3059\u3002docker inspect\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u304c\u898b\u308c\u307e\u3059\u3002\n\ndocker01&docker02\n# docker01\n$ docker network ls\nNETWORK ID          NAME                DRIVER\n6f9ee8d629d6        none                null                \n0f0d0f12a59f        host                host                \n12613b8ef4b7        docker_gwbridge     bridge              \n0ac1dafaa764        bridge              bridge \n\n$ docker network create -d overlay vn01 \nb07f8c4a5cb954e7ff8d387bfc65e3239f67852ee65f68cea8d77e9032b577c5\n\n$ docker network ls\nNETWORK ID          NAME                DRIVER\nb07f8c4a5cb9        vn01                overlay             \n0ac1dafaa764        bridge              bridge              \n6f9ee8d629d6        none                null                \n0f0d0f12a59f        host                host                \n12613b8ef4b7        docker_gwbridge     bridge \n\n$ docker network inspect vn01\n[\n    {\n        \"Name\": \"vn01\",\n        \"Id\": \"b07f8c4a5cb954e7ff8d387bfc65e3239f67852ee65f68cea8d77e9032b577c5\",\n        \"Scope\": \"global\",\n        \"Driver\": \"overlay\",\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Config\": [\n                {}\n            ]\n        },\n        \"Containers\": {},\n        \"Options\": {}\n    }\n]\n# docker02\n$ docker network ls\nNETWORK ID          NAME                DRIVER\nb07f8c4a5cb9        vn01                overlay             \n65a8ead71e7c        none                null                \nebb12613053e        host                host                \n02ca2b4c8d98        docker_gwbridge     bridge              \n071afc5c93e3        bridge              bridge  \n\n\n\n\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5272\u308a\u5f53\u3066\ntest01\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u3063\u3066\u3001vn01\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ed8\u4e0e\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\ndocker01\n$ docker run -idt --name test01 --hostname test01 centos:7 /bin/bash\n$ docker network connect vn01 test01\n$ docker exec test01 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n40: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:2/64 scope link \n       valid_lft forever preferred_lft forever\n43: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP \n    link/ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.2/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe00:2/64 scope link \n       valid_lft forever preferred_lft forever\n\n\ntest01\u306e\u30b3\u30f3\u30c6\u30ca\u306eeth1\u306b10.0.0.2/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4ed8\u3044\u3066\u307e\u3059\u306d\u3002IP\u30a2\u30c9\u30ec\u30b9\u306f\u81ea\u52d5\u3067\u5272\u308a\u632f\u3089\u308c\u308b\u306e\u304b\u306a\uff1f\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b--net\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u3082\u4ed8\u4e0e\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\ndcoker01\n$ docker run -dit --name test01 --hostname test01 --net vn01 centos:7 /bin/bash\n\n\n\u540c\u69d8\u306b\u5225\u306e\u30db\u30b9\u30c8\u3067\u3082vn01\u3092\u4ed8\u4e0e\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\ndocker02\n$ docker run -dit --name test02 --hostname test02 centos:7 /bin/bash\n$ docker network connect vn01 test02 \n$ docker exec test02 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n39: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:2/64 scope link \n       valid_lft forever preferred_lft forever\n42: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP \n    link/ether 02:42:0a:00:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.3/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe00:3/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\u3053\u3063\u3061\u306f10.0.0.3/24\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u3064\u3044\u3066\u307e\u3059\u306d\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u9593\u901a\u4fe1\n\u3084\u3063\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u758e\u901a\u78ba\u8a8d\uff01test02(10.0.0.3)\u30b3\u30f3\u30c6\u30ca\u304b\u3089test01\u30b3\u30f3\u30c6\u30ca(10.0.02)\u3078ping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002\n$ docker exec test02 ping -c 4 10.0.0.2\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.\n64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.991 ms\n64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.639 ms\n64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=0.650 ms\n64 bytes from 10.0.0.2: icmp_seq=4 ttl=64 time=0.664 ms\n\n--- 10.0.0.2 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3004ms\nrtt min/avg/max/mdev = 0.639/0.736/0.991/0.147 ms\n\n\u3064\u306a\u304c\u308a\u307e\u3057\u305f\uff01\n\u3069\u3046\u3084\u3089\u30b3\u30f3\u30c6\u30ca\u540d\u3067\u540d\u524d\u89e3\u6c7a\u3082\u3067\u304d\u308b\u307f\u305f\u3044\u3002\u4fbf\u5229\uff01\n\ndocker02\n$ docker exec test02 ping -c 4 test01\nPING test01 (10.0.0.2) 56(84) bytes of data.\n64 bytes from test01 (10.0.0.2): icmp_seq=1 ttl=64 time=0.516 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=2 ttl=64 time=0.665 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=3 ttl=64 time=0.745 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=4 ttl=64 time=0.714 ms\n\n--- test01 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3005ms\nrtt min/avg/max/mdev = 0.516/0.660/0.745/0.087 ms\n\n\n\u9759\u7684IP\u306f\u632f\u308c\u306a\u3044(?)\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u306e\u3067\u554f\u984c\u306a\u3055\u305d\u3046\u3002\n\u3044\u308d\u3044\u308d\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u307e\u3060\u8a66\u305b\u3066\u3044\u307e\u305b\u3093\u2026\u3002\n\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5916\u90e8\u306b\u516c\u958b\u3067\u304d\u308b\u6a5f\u80fd\u304c\u3042\u308c\u3070\u6700\u9ad8\u306a\u306e\u306b\u306a\u3041\u3002weave expose\u307f\u305f\u3044\u306a\u3002\u307e\u3060\u306a\u3044\u306e\u304b\u306a\uff1f\u305d\u308c\u3068\u3082\u5916\u90e8\u63a5\u7d9a\u7528\u30b3\u30f3\u30c6\u30ca\u4f5c\u3063\u3066\u305d\u3053\u306f\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u304b\u306a\u3002\n\u3042\u3068\u306f\u6027\u80fd\u304c\u3069\u3093\u306a\u3082\u3093\u304b\u3067\u3059\u306d\u3002\u6280\u8853\u7684\u306b\u306fvxlan\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u305d\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3067\u6027\u80fd\u3069\u3046\u306a\u308b\u304b\u79c1\u6c17\u306b\u306a\u308a\u307e\u3059\uff01\n\n\u53c2\u8003\n\nGet started with multi-host networking\n\n##\u6982\u8981\ndocker 1.9.0\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3001docker network\u30b3\u30de\u30f3\u30c9\u304cproduction\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u7279\u306b\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304cdocker\u30b3\u30de\u30f3\u30c9\u304b\u3089\u4f5c\u6210\u53ef\u80fd\u306b\u306a\u3063\u305f\u306e\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n##`docker network`\u30b3\u30de\u30f3\u30c9\u3068\u306f\n`docker network`\u306f\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3059\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u64cd\u4f5c\u30fb\u7ba1\u7406\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3002\nDocker Swarm\u3068\u9023\u643a\u3059\u308c\u3070\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u9593\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u69cb\u7bc9\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u9593\u304c\u901a\u4fe1\u3067\u304d\u308b\u3002\n\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u306e\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5b9f\u73fe\u3059\u308b\u30c4\u30fc\u30eb\u3084\u65b9\u6cd5\u306f\u4ed6\u306b\u3082\u3044\u308d\u3044\u308d\u3042\u308b\u3002`weave`\u3001`etcd+flannel`\u3001`runcher`\u3001`bridge\u63a5\u7d9a+GRE`\u306a\u3069\u306a\u3069\u3002\n\n\n\u74b0\u5883\n--\n\u4eca\u56de\u306f2\u3064\u306eDocker\u30db\u30b9\u30c8VM\u3092Swarm\u3067\u30af\u30e9\u30b9\u30bf\u5316\u3057\u3001docker network\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u69cb\u7bc9\u3057\u3066\u3001\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u901a\u4fe1\u304c\u3067\u304d\u308b\u304b\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\n\u3042\u3068docker network\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308boverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306fLinux Kernel 3.16\u4ee5\u4e0a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002CentOS7\u306f3.10\u306a\u306e\u3067\u30013.18\u3092\u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\uff08kernel\u30d3\u30eb\u30c9\u90e8\u5206\u306f\u7701\u7565\uff09Ubuntu 14.10\u306e\u30ab\u30fc\u30cd\u30eb\u306f3.16\u306a\u306e\u3067\u3001Ubuntu\u3067\u8a66\u305b\u3070\u3088\u304b\u3063\u305f\u3002\n\n* CentOS7(VM) x2\u53f0\n * docker01 :192.168.11.48 (consul server)\n * docker02 :192.168.11.49 (consul client)\n* Linux Kernel 3.18\n* Docker 1.9.0\n* Docker Swarm 1.0\n* consul 0.5.2(Docker Swarm\u306e\u30d0\u30c3\u30af\u30a8\u30f3\u30c9KVS)\n\n\u3084\u3063\u305f\u3053\u3068\u76ee\u6b21\n--\n1. consul\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n1. Docker1.9.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n1. Docker Swarm\u3067\u30af\u30e9\u30b9\u30bf\u5316\n1. overlay network\u306e\u4f5c\u6210\n1. \u30b3\u30f3\u30c6\u30ca\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u63a5\u7d9a\u3057\u3066\u8d77\u52d5\n1. \u30b3\u30f3\u30c6\u30ca\u9593\u306e\u758e\u901a\u78ba\u8a8d\n\n\nconsul\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n--\n**\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\n\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u914d\u7f6e\u3059\u308b\u3060\u3051\u3002\u5408\u308f\u305b\u3066\u5fc5\u8981\u306a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```docker01_&_docker02\n$ wget https://releases.hashicorp.com/consul/0.5.2/consul_0.5.2_linux_amd64.zip\n$ unzip consul_0.5.2_linux_amd64.zip\n$ sudo cp consul /usr/local/bin/\n$ sudo mkdir -p {/etc/consul,/var/lib/consul,/var/log/consul}\n```\n\n**consul\u8a2d\u5b9a**\nconsul\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092server\u3068client\u306e2\u7a2e\u985e\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ndocker01(consul server)\n\n```json:/etc/consul/consul.json\n{\n  \"datacenter\": \"docker\",\n  \"addresses\" : {\n    \"http\": \"0.0.0.0\"\n  },\n  \"bind_addr\": \"192.168.11.48\",\n  \"node_name\": \"docker01\",\n  \"domain\": \"consul\",\n  \"server\": true,\n  \"bootstrap_expect\": 1,\n  \"data_dir\": \"/var/lib/consul\"\n}\n```\n\ndocker02(consul client)\n\n```json:/etc/consul/consul.json\n{\n  \"datacenter\": \"docker\",\n  \"addresses\" : {\n    \"http\": \"0.0.0.0\"\n  },\n  \"bind_addr\": \"192.168.11.49\",\n  \"node_name\": \"docker02\",\n  \"domain\": \"consul\",\n  \"retry_join\": [ \"192.168.11.48\"],\n  \"server\": false,\n  \"data_dir\": \"/var/lib/consul\"\n}\n```\n\n**consul\u8d77\u52d5**\n\n```bash:docker01&docker02\n$ consul -config-file=/etc/consul/consul.json >> /var/log/consul/consul.log &\n$ consul members\nNode      Address             Status  Type    Build  Protocol  DC\ndocker02  192.168.11.49:8301  alive   client  0.5.2  2         docker\ndocker01  192.168.11.48:8301  alive   server  0.5.2  2         docker\n```\n\u3061\u3083\u3093\u3068consul\u30af\u30e9\u30b9\u30bf\u306bdocker01,02\u304c\u3044\u307e\u3059\u306d\u3002\n\n\nDocker 1.9.0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30fb\u8a2d\u5b9a\n--\n**\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb**\nCentOS7\u306f\u307e\u3060yum\u306b\u3042\u308bdocker\u304c1.8.2\u306a\u306e\u3067(2015/11/9\u73fe\u5728)\u3001\u6700\u65b0\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u633f\u3057\u66ff\u3048\u3066\u3044\u307e\u3059\u3002\n\n```bash:docker01&docker02\n$ sudo yum install -y docker\n$ curl -o docker-1.9.0 https://get.docker.com/builds/Linux/x86_64/docker-1.9.0\n$ sudo cp docker-1.9.0 /usr/bin/docker\n$ sudo chmod +x /usr/bin/docker\n```\n\n**Docker Engine\u8a2d\u5b9a**\ndocker daemon\u306e`--cluster-store` `--cluster-advertise`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308cKVS\u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30db\u30b9\u30c8\u81ea\u8eab\u306e`ipaddress:port`\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```ini:/etc/sysconfig/docker(docker01&docker02)\nOPTIONS='--cluster-store=consul://localhost:8500 --cluster-advertise=<\u30db\u30b9\u30c8IP>:2376 -H tcp://0.0.0.0:2375 -H unix://var/run/docker.sock'\n```\n\n**Docker\u8d77\u52d5**\n\n```bash:docker01&docker02\n$ sudo systemctl start docker\n```\n\nDocker Swarm\u30af\u30e9\u30b9\u30bf\u8d77\u52d5\n--\ndocker01\u306e\u30db\u30b9\u30c8\u3067Swarm\u306e\u30af\u30e9\u30b9\u30bf\u30de\u30cd\u30fc\u30b8\u30e3\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash:docker01\n$ docker run -d -p 2377:2375 --name swarm-manage-consul swarm manage consul://192.168.11.48:8500/docker\n```\n\n\u5404\u30db\u30b9\u30c8\u3067Swarm\u30af\u30e9\u30b9\u30bf\u3078join\u3059\u308b\u305f\u3081\u306eswarm\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002`docker`\u30b3\u30de\u30f3\u30c9\u304cswarm\u30de\u30cd\u30fc\u30b8\u30e3\u30b3\u30f3\u30c6\u30ca\u306b\u5411\u3051\u3066\u5b9f\u884c\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\n\n```bash:docker01&docker02\n# docker01\n$ docker run -d --name swarm-join swarm join --advertise=192.168.11.48:2375 consul://192.168.11.48:8500/docker\n# docker02\n$ docker run -d --name swarm-join swarm join --advertise=192.168.11.49:2375 consul://192.168.11.48:8500/docker\n$ docker -H tcp://192.168.11.48:2377 info\nContainers: 3\nImages: 4\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 2\n centos7-01: 192.168.11.48:2375\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 2.052 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.18.22, operatingsystem=CentOS Linux 7 (Core), storagedriver=overlay\n centos7-02: 192.168.11.49:2375\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 2\n  \u2514 Reserved Memory: 0 B / 2.052 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=3.18.22, operatingsystem=CentOS Linux 7 (Core), storagedriver=overlay\nCPUs: 4\nTotal Memory: 4.103 GiB\nName: 755cb58b105c\n```\n\n\u3053\u3053\u307e\u3067\u3067`docker network`\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u307e\u3057\u305f\u3002\u3044\u3088\u3044\u3088\u6b21\u306foverlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f5c\u6210\u3057\u307e\u3059\u3002\n\noverlay network\u306e\u4f5c\u6210\n--\n`docker network create`\u30b3\u30de\u30f3\u30c9\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n1\u3064\u306e\u30db\u30b9\u30c8\u3067\u4f5c\u6210\u3057\u305fvn01\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u306f\u30af\u30e9\u30b9\u30bf\u306e\u5168\u30db\u30b9\u30c8\u3067\u5171\u6709\u3055\u308c\u307e\u3059\u3002`docker inspect`\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u304c\u898b\u308c\u307e\u3059\u3002\n\n```bash:docker01&docker02\n# docker01\n$ docker network ls\nNETWORK ID          NAME                DRIVER\n6f9ee8d629d6        none                null                \n0f0d0f12a59f        host                host                \n12613b8ef4b7        docker_gwbridge     bridge              \n0ac1dafaa764        bridge              bridge \n\n$ docker network create -d overlay vn01 \nb07f8c4a5cb954e7ff8d387bfc65e3239f67852ee65f68cea8d77e9032b577c5\n\n$ docker network ls\nNETWORK ID          NAME                DRIVER\nb07f8c4a5cb9        vn01                overlay             \n0ac1dafaa764        bridge              bridge              \n6f9ee8d629d6        none                null                \n0f0d0f12a59f        host                host                \n12613b8ef4b7        docker_gwbridge     bridge \n\n$ docker network inspect vn01\n[\n    {\n        \"Name\": \"vn01\",\n        \"Id\": \"b07f8c4a5cb954e7ff8d387bfc65e3239f67852ee65f68cea8d77e9032b577c5\",\n        \"Scope\": \"global\",\n        \"Driver\": \"overlay\",\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Config\": [\n                {}\n            ]\n        },\n        \"Containers\": {},\n        \"Options\": {}\n    }\n]\n# docker02\n$ docker network ls\nNETWORK ID          NAME                DRIVER\nb07f8c4a5cb9        vn01                overlay             \n65a8ead71e7c        none                null                \nebb12613053e        host                host                \n02ca2b4c8d98        docker_gwbridge     bridge              \n071afc5c93e3        bridge              bridge  \n```\n\n\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5272\u308a\u5f53\u3066\n--\ntest01\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u3063\u3066\u3001vn01\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ed8\u4e0e\u3055\u305b\u3066\u307f\u307e\u3059\u3002\n\n```bash:docker01\n$ docker run -idt --name test01 --hostname test01 centos:7 /bin/bash\n$ docker network connect vn01 test01\n$ docker exec test01 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n40: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:2/64 scope link \n       valid_lft forever preferred_lft forever\n43: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP \n    link/ether 02:42:0a:00:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.2/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe00:2/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\ntest01\u306e\u30b3\u30f3\u30c6\u30ca\u306e`eth1`\u306b`10.0.0.2/24`\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u4ed8\u3044\u3066\u307e\u3059\u306d\u3002IP\u30a2\u30c9\u30ec\u30b9\u306f\u81ea\u52d5\u3067\u5272\u308a\u632f\u3089\u308c\u308b\u306e\u304b\u306a\uff1f\n\n\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b`--net`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3053\u3068\u3067\u3082\u4ed8\u4e0e\u3067\u304d\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n```bash:dcoker01\n$ docker run -dit --name test01 --hostname test01 --net vn01 centos:7 /bin/bash\n```\n\n\n\u540c\u69d8\u306b\u5225\u306e\u30db\u30b9\u30c8\u3067\u3082vn01\u3092\u4ed8\u4e0e\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\n```bash:docker02\n$ docker run -dit --name test02 --hostname test02 centos:7 /bin/bash\n$ docker network connect vn01 test02 \n$ docker exec test02 ip a\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n39: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP \n    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff\n    inet 172.17.0.2/16 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:acff:fe11:2/64 scope link \n       valid_lft forever preferred_lft forever\n42: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP \n    link/ether 02:42:0a:00:00:03 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.3/24 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:aff:fe00:3/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\u3053\u3063\u3061\u306f`10.0.0.3/24`\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u3064\u3044\u3066\u307e\u3059\u306d\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u9593\u901a\u4fe1\n--\n\u3084\u3063\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u758e\u901a\u78ba\u8a8d\uff01test02(10.0.0.3)\u30b3\u30f3\u30c6\u30ca\u304b\u3089test01\u30b3\u30f3\u30c6\u30ca(10.0.02)\u3078ping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002\n\n```\n$ docker exec test02 ping -c 4 10.0.0.2\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.\n64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.991 ms\n64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.639 ms\n64 bytes from 10.0.0.2: icmp_seq=3 ttl=64 time=0.650 ms\n64 bytes from 10.0.0.2: icmp_seq=4 ttl=64 time=0.664 ms\n\n--- 10.0.0.2 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3004ms\nrtt min/avg/max/mdev = 0.639/0.736/0.991/0.147 ms\n```\n\u3064\u306a\u304c\u308a\u307e\u3057\u305f\uff01\n\n\u3069\u3046\u3084\u3089\u30b3\u30f3\u30c6\u30ca\u540d\u3067\u540d\u524d\u89e3\u6c7a\u3082\u3067\u304d\u308b\u307f\u305f\u3044\u3002\u4fbf\u5229\uff01\n\n```bash:docker02\n$ docker exec test02 ping -c 4 test01\nPING test01 (10.0.0.2) 56(84) bytes of data.\n64 bytes from test01 (10.0.0.2): icmp_seq=1 ttl=64 time=0.516 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=2 ttl=64 time=0.665 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=3 ttl=64 time=0.745 ms\n64 bytes from test01 (10.0.0.2): icmp_seq=4 ttl=64 time=0.714 ms\n\n--- test01 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3005ms\nrtt min/avg/max/mdev = 0.516/0.660/0.745/0.087 ms\n```\n\n\u9759\u7684IP\u306f\u632f\u308c\u306a\u3044(?)\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u306e\u3067\u554f\u984c\u306a\u3055\u305d\u3046\u3002\n\u3044\u308d\u3044\u308d\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u307e\u3060\u8a66\u305b\u3066\u3044\u307e\u305b\u3093\u2026\u3002\n\u30b3\u30f3\u30c6\u30ca\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5916\u90e8\u306b\u516c\u958b\u3067\u304d\u308b\u6a5f\u80fd\u304c\u3042\u308c\u3070\u6700\u9ad8\u306a\u306e\u306b\u306a\u3041\u3002`weave expose`\u307f\u305f\u3044\u306a\u3002\u307e\u3060\u306a\u3044\u306e\u304b\u306a\uff1f\u305d\u308c\u3068\u3082\u5916\u90e8\u63a5\u7d9a\u7528\u30b3\u30f3\u30c6\u30ca\u4f5c\u3063\u3066\u305d\u3053\u306f\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u304b\u306a\u3002\n\n\u3042\u3068\u306f\u6027\u80fd\u304c\u3069\u3093\u306a\u3082\u3093\u304b\u3067\u3059\u306d\u3002\u6280\u8853\u7684\u306b\u306fvxlan\u3067overlay\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\u304c\u3001\u305d\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3067\u6027\u80fd\u3069\u3046\u306a\u308b\u304b\u79c1\u6c17\u306b\u306a\u308a\u307e\u3059\uff01\n\n\n\u53c2\u8003\n--\n* [Get started with multi-host networking](http://docs.docker.com/engine/userguide/networking/get-started-overlay/)\n"}