{"context": " More than 1 year has passed since last update.\u3053\u3093\u3070\u3093\u306f\u3001cloudpack \u306e @dz_ \u3053\u3068\u5927\u5e73\u304b\u3065\u307f\u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n\u53cb\u9054\u304b\u3089 re:Invent \u306e\u304a\u571f\u7523\u3067\u3082\u3089\u3063\u305f AWS IoT \u30dc\u30bf\u30f3\u3092\u4f7f\u3063\u3066\u3001 AWS Lambda \u3001\u3057\u304b\u3082 PHP \u3092\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u5c0f\u30cd\u30bf\u3067\u3059\u3002\n(PHP on AWS Lambda \u306f\u3001\u795e\u5bae\u524dGeek Night\uff01\uff01\u306eLT\u30cd\u30bf\u63a2\u3057\u3057\u3066\u308b\u3068\u304d\u306b\u3001\u300c\u3084\u3063\u3066\u308b\u4eba\u3044\u308b\u304b\u3089\u3067\u304d\u308b\u3088\u30fc\u300d\u3068\u3001@yoshidashingo \u3055\u3093\u306b\u305d\u305d\u306e\u304b\u3055\u308c\u307e\u3057\u305f(\u7b11) \u3067\u3082\u3044\u3044\u7d4c\u9a13\u306b\u306a\u308a\u307e\u3057\u305f\uff01\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01)\n\u3061\u306a\u307f\u306b\u3001 Lambda Advent Calendar \u306b\u6295\u7a3f\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3059\u3067\u306b\u6e80\u54e1\u3060\u3063\u305f\u306e\u3067\u3001 AWS IoT Advent Calendar 2015 \u306b\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u5c0f\u30cd\u30bf\u3067\u3059\u304c\u6e08\u307f\u307e\u305b\u3093\uff01\n\n\u65e9\u901f\u3001\u6e96\u5099\n\u3055\u3063\u305d\u304f AWS IoT \u30dc\u30bf\u30f3 + PHP on AWS Lambda \u306e\u74b0\u5883\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nAWS IoT \u30dc\u30bf\u30f3\u306e\u6e96\u5099\uff08\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3001\u30b5\u30f3\u30d7\u30eb\u52d5\u4f5c\u78ba\u8a8d\uff09\nAWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059 \u2190 \u96e3\u95a2!!\n\nAWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP on AWS Lambda \u3092\u8d77\u52d5\uff01\n\n\nAWS IoT \u30dc\u30bf\u30f3\u306e\u6e96\u5099\n\u4eca\u3053\u306e\u6642\u70b9\u3067\u3001\u3059\u3067\u306b AWS IoT \u30dc\u30bf\u30f3\u306e\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3068\u30b5\u30f3\u30d7\u30eb\u306e\u52d5\u4f5c\u306f\u7d42\u308f\u3063\u3066\u3044\u307e\u3059\u3002\u624b\u9806\u306b\u307e\u3068\u3081\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3042\u307e\u308a\u306b\u3082\u7c21\u5358\u3067\u3059\u3057\u3001\u4ed6\u306b\u60c5\u5831\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5272\u611b\u3057\u307e\u3059\u3002\n\nAWS IoT \u30dc\u30bf\u30f3\u3063\u3066\uff1f\n\u5ff5\u306e\u305f\u3081\u3001AWS IoT \u30dc\u30bf\u30f3\u306b\u3064\u3044\u3066\u8efd\u304f\u8aac\u660e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3053\u306e AWS IoT \u30dc\u30bf\u30f3\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u56fa\u6709\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u306a\u304f\u3001AWS \u306e IoT \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3042\u308b AWS IoT \u3092\u5229\u7528\u3067\u304d\u308b\u3001\u30d9\u30fc\u30bf\u7248\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u7aef\u672b\u3067\u3059\u3002\nAWS IoT \u30dc\u30bf\u30f3\u306f\u3001WiFi\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u3001\u521d\u56de\u306f\u540c\u68b1\u3055\u308c\u3066\u3044\u308b\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u3068DSN\uff08\u203b\uff09\u3092\u5165\u529b\u3057\u3066\u81ea\u8eab\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u7d10\u3065\u3051\u307e\u3059\u3002\uff08\u203b\u30dc\u30bf\u30f3\u7aef\u672b\u306e\u88cf\u5074\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b Device Serial Number\uff09\nWiFi\u63a5\u7d9a\u3084\u3001\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3068\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3059\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u3064\u3044\u3066\u306f\u3001\u300c\u3054\u5229\u7528\u958b\u59cb\u306b\u3042\u305f\u3063\u3066\u300d\u3092\u53c2\u7167\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nAWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059\n\u305d\u308c\u3067\u306f\u3001AWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059\u6e96\u5099\u306b\u5165\u308a\u307e\u3059\u3002\n\u3054\u5b58\u77e5\u306e\u901a\u308a\u3001AWS Lambda \u3067\u306f\u3001Node.js, Java, Python \u304c\u52d5\u304d\u307e\u3059\u3002\u3060\u304c\u3057\u304b\u3057\u3001 PHP \u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff01\n\u3068\u306f\u3044\u3048\u3001\u52d5\u3044\u3066\u3044\u308b\u306e\u306f Linux \u3067\u3059\u3002\u8a66\u3057\u306b\u3001Lambda \u306e\u52d5\u3044\u3066\u3044\u308b\u74b0\u5883\u3067 uname -a \u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001 Linux ip-10-0-74-236 3.14.48-33.39.amzn1.x86_64 #1 SMP Tue Jul 14 23:43:07 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux \u3068\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002\n\u307e\u305f\u3001Lambda \u306f\u3001\u5358\u4e00\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3067\u306a\u304f\u3001zip\u306b\u307e\u3068\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u542b\u3093\u3060\u74b0\u5883\u3092\u52d5\u304b\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u3053\u308c\u3089\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3057\u3066\u3001 @yoshidashingo \u6c0f\u304b\u3089\u6559\u3048\u3066\u3082\u3089\u3063\u305f\u3053\u3061\u3089\u306e\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3001Linux\u3067\u52d5\u4f5c\u3059\u308bPHP\u306e\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3001Lambda \u3067\u3082 PHP \u3092\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u9b42\u80c6\u306a\u306e\u3067\u3059\uff01\n   PHP\u3068\u3044\u3046\u6982\u5ff5\u304b\u3099\u5b58\u5728\u3057\u306a\u3044\u9000\u5c48\u306a\u4e16\u754c  from Yoshihiro Ohsuka \n\u3055\u3066\u3001\u3053\u3053\u3067\u80c6\u3068\u306a\u308bPHP\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u3069\u3046\u5165\u624b\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001Lambda \u306e\u74b0\u5883\u3067\u52d5\u304f\u3088\u3046\u306b\u3001\u30d3\u30eb\u30c9\u3057\u3066\u4f5c\u6210\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\nLinux \u74b0\u5883\u3092\u7528\u610f\u3059\u308b\nLambda \u74b0\u5883\u3067\u52d5\u304f PHP \u3092\u30d3\u30eb\u30c9\u3059\u308b\nLambda\u7528\u306ezip\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\nLambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n\n\nLinux\u74b0\u5883\u3092\u7528\u610f\u3059\u308b\n\u4f5c\u696d\u74b0\u5883\u304c Windows \u306a\u306e\u3067\u3001\u5225\u9014 AWS EC2 \u3067 Linux \u74b0\u5883\u3092\u4f5c\u308a\u307e\u3059\u3002\u624b\u3063\u53d6\u308a\u65e9\u304f\u3001Amazon Linux \u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\nLambda\u74b0\u5883\u3067\u52d5\u304f PHP \u3092\u30d3\u30eb\u30c9\u3059\u308b\nLambda \u306e\u30b3\u30fc\u30c9\u304c\u914d\u7f6e\u3055\u308c\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001 /var/task \u3067\u3059\u3002\u306a\u306e\u3067\u3001Linux \u74b0\u5883\u306b /var/task \u3092\u4f5c\u6210\u3057\u3066\u305d\u3053\u3067 PHP \u304c\u52d5\u304f\u3088\u3046\u306b\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\nPHP \u306e\u30d3\u30eb\u30c9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u300cPHP 5.5.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff08\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u65b9\u6cd5\uff09\u300d\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\u3068\u3066\u3082\u5206\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u3070\u304b\u308a\u306e PHP 7 \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\uff01\n# Lambda \u306e\u5b9f\u884c\u74b0\u5883\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u3092\u4f5c\u6210\u3059\u308b\nmkdir /var/task\n\n# PHP\u914d\u7f6e\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\nmkdir /var/task/php\n\n# \u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nyum install gcc\nyum install make\n\n# PHP \u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\nwget http://jp2.php.net/get/php-7.0.0.tar.gz/from/this/mirror -O php-7.0.0.tar.gz\n\n# \u5c55\u958b\u3057\u3066\u3001\u5c55\u958b\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3059\u308b\ntar xfz php-7.0.0.tar.gz -C /usr/local/src/\ncd /usr/local/src/php-7.0.0/\n\n# \u30d3\u30eb\u30c9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b (\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f /var/task/php \u3001\u8ffd\u52a0\u6a5f\u80fd\u306f\u3059\u3079\u3066\u7121\u52b9)\n./configure --prefix=/var/task/php --disable-all\n\n# \u30d3\u30eb\u30c9\nmake\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nmake install\n\n\u3053\u308c\u3067\u3001 /var/task/php \u914d\u4e0b\u306b PHP \u74b0\u5883\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f PHP \u30e9\u30f3\u30bf\u30a4\u30e0 (\u203b tree \u30b3\u30de\u30f3\u30c9\u3067 3 \u968e\u5c64\u307e\u3067\u8868\u793a)\n tree -L 3 /var/task\n/var/task\n\u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 bin\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-cgi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-config\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 phpdbg\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phpize\n \u00a0\u00a0 \u251c\u2500\u2500 include\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 lib\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 php\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 man\n \u00a0\u00a0 \u2514\u2500\u2500 var\n \u00a0\u00a0     \u251c\u2500\u2500 log\n \u00a0\u00a0     \u2514\u2500\u2500 run\n\n\nLambda \u7528\u306ezip\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\nLambda \u306f\u3001\u5b9f\u884c\u6642\u306e\u8d77\u70b9\u3068\u306a\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002Node.js \u7248\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u306b\u306f\u901a\u5e38 index.handler \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u3066\u3001\u3053\u308c\u306f index.js \u306e exports.handler \u306b\u767b\u9332\u3055\u308c\u305f\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u4eca\u56de\u306e\u69cb\u6210\u3082\u3053\u308c\u306b\u5023\u3044\u307e\u3059\u3002\nindex.js \u304a\u3088\u3073 PHP\u5b9f\u884c\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001zip\u3067\u56fa\u3081\u307e\u3059\u3002\n# Lambda\u306e\u7591\u4f3c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3059\u308b\ncd /var/task\n\n# AWS Lambda \u95a2\u6570\u7528\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3059\u308b\nvi index.js\n\n# PHP \u5b9f\u884c\u7528\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\nvi run.sh\n\n# \u5b9f\u884c\u3059\u308b PHP \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\nvi info.php\n\n# \u5404\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u5f8c\u306e\u69cb\u6210\ntree -L 3 /var/task\n/var/task\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 info.php\n\u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-cgi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-config\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 phpdbg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phpize\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 man\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 var\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 log\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 run\n\u2514\u2500\u2500 run.sh\n\n\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nindex.js\nvar exec = require('child_process').exec;\n\nexports.handler = function(event, context) {\n    var child = exec(\"sh ./run.sh\", function(error) {\n        // Resolve with result of process\n        context.done(error, 'Process complete!');\n    });\n\n    // Log process stdout and stderr\n    child.stdout.on('data', console.log);\n    child.stderr.on('data', console.error);\n};\n\n\n\nrun.sh\n#!/bin/sh\n./php/bin/php info.php\n\n\n\ninfo.php\n<?php\nphpinfo();\n\n\nzip\u306b\u307e\u3068\u3081\u307e\u3059\u3002zip\u3092\u56de\u7b54\u3057\u305f\u3068\u304d\u306b\u3001\u76f4\u4e0b\u306b index.js \u304c\u914d\u7f6e\u3055\u308c\u308b\u3088\u3046\u306b zip \u5316\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n# Lambda \u306e\u7591\u4f3c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001zip \u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\ncd /var/task\nzip -r task.zip .\n\n\u3053\u306e task.zip \u3092\u624b\u5143\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001Lambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u4eca\u56de\u306f 10KB \u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001S3\u7d4c\u7531\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u554f\u984c\u306a\u3051\u308c\u3070\u3001\u6b21\u306b\u9032\u307f\u307e\u3057\u3087\u3046\uff01\n\nAWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP on AWS Lambda \u3092\u8d77\u52d5\uff01\n\u305d\u308c\u3067\u306f\u3001AWS IoT \u30dc\u30bf\u30f3\u306e\u62bc\u4e0b\u3067 PHP on Lambda \u304c\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\nAWS IoT \u30dc\u30bf\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u8a2d\u5b9a\u3057\u305f\u3042\u3068\u306f\u3001Things,Roles,Certificates,Policies\u304c1\u500b\u305a\u3064\u8a2d\u5b9a\u3055\u308c\u305f\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u3046\u3061\u3001\u30eb\u30fc\u30eb \u3092\u9078\u629e\u3057\u3001\u300cEdit Actions\u300d\u304b\u3089\u300cAdd New Action\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\u300cChoose an action\u300d\u3067\u3001\u300cInsert this message into a code function and excute it (Lambda)\u300d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u300cFunction Name\u300d\u306b\u3001\u5148\u307b\u3069\u4f5c\u3063\u305fLambda\u95a2\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f\uff01\nAWS IoT \u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u307f\u307e\u3059\u3002\n\u30dd\u30c1\u3063\u3068\u306a\uff01\n\nCloudWatch \u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u2026\n\n\u30ad\u30bf\u30fc\u30fc\u30fc\uff01\u30fe(o\u00b4\u2200`o)\uff89\n\nEpilogue - \u304a\u308f\u308a\u306b\nAWS IoT \u304b\u3089 Lambda \u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3082\u308f\u304b\u308a\u3001\u3044\u308d\u3044\u308d\u52c9\u5f37\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u3001\u4e00\u756a\u96e3\u95a2\u3068\u601d\u3063\u3066\u3044\u305f PHP \u306e\u30d3\u30eb\u30c9\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u5e2b\u5320 @kazumihirose \u306b\u30a2\u30c9\u30d0\u30a4\u30b9\u3092\u3044\u305f\u3060\u304d\u3064\u3064\u624b\u9806\u306b\u5023\u3046\u3068\u3059\u3093\u306a\u308a\u3067\u304d\u307e\u3057\u305f\uff01\n\u3057\u304b\u3057\u3001\u4eca\u56de\u306f\u308f\u3056\u308f\u3056 AWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP \u3092\u52d5\u304b\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3001\u7279\u306b\u4f55\u3082\u5f79\u306b\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u6b21\u306f\u3082\u3063\u3068\u5f79\u7acb\u3061\u305d\u3046\u306a\u3082\u306e\u3092\u4f5c\u308a\u305f\u3044\u3067\u3059\u306d(\u7b11)\n\u3053\u3093\u3070\u3093\u306f\u3001[cloudpack][] \u306e @dz_ \u3053\u3068[\u5927\u5e73\u304b\u3065\u307f][]\u3067\u3059\u3002\n\nPrologue - \u306f\u3058\u3081\u306b\n====\n\u53cb\u9054\u304b\u3089 re:Invent \u306e\u304a\u571f\u7523\u3067\u3082\u3089\u3063\u305f [AWS IoT \u30dc\u30bf\u30f3](https://aws.amazon.com/iot/button/ \"AWS IoT \u30dc\u30bf\u30f3\")\u3092\u4f7f\u3063\u3066\u3001 [AWS Lambda](https://aws.amazon.com/jp/lambda/ \"AWS Lambda (\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u30fb\u81ea\u52d5\u7ba1\u7406) | AWS\") \u3001\u3057\u304b\u3082 **PHP** \u3092\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u5c0f\u30cd\u30bf\u3067\u3059\u3002\n\n(PHP on AWS Lambda \u306f\u3001[\u795e\u5bae\u524dGeek Night\uff01\uff01](http://connpass.com/event/23126/ \"\u795e\u5bae\u524dGeek Night\uff01\uff01 - connpass\")\u306eLT\u30cd\u30bf\u63a2\u3057\u3057\u3066\u308b\u3068\u304d\u306b\u3001\u300c\u3084\u3063\u3066\u308b\u4eba\u3044\u308b\u304b\u3089\u3067\u304d\u308b\u3088\u30fc\u300d\u3068\u3001@yoshidashingo \u3055\u3093\u306b\u305d\u305d\u306e\u304b\u3055\u308c\u307e\u3057\u305f(\u7b11) \u3067\u3082\u3044\u3044\u7d4c\u9a13\u306b\u306a\u308a\u307e\u3057\u305f\uff01\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01)\n\n\u3061\u306a\u307f\u306b\u3001 Lambda Advent Calendar \u306b\u6295\u7a3f\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3059\u3067\u306b\u6e80\u54e1\u3060\u3063\u305f\u306e\u3067\u3001 [AWS IoT Advent Calendar 2015](http://qiita.com/advent-calendar/2015/awsiot) \u306b\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u5c0f\u30cd\u30bf\u3067\u3059\u304c\u6e08\u307f\u307e\u305b\u3093\uff01\n\n\u65e9\u901f\u3001\u6e96\u5099\n====\n\u3055\u3063\u305d\u304f AWS IoT \u30dc\u30bf\u30f3 + PHP on AWS Lambda \u306e\u74b0\u5883\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n1. AWS IoT \u30dc\u30bf\u30f3\u306e\u6e96\u5099\uff08\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3001\u30b5\u30f3\u30d7\u30eb\u52d5\u4f5c\u78ba\u8a8d\uff09\n2. AWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059 \u2190 **\u96e3\u95a2!!**\n3. AWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP on AWS Lambda \u3092\u8d77\u52d5\uff01\n\nAWS IoT \u30dc\u30bf\u30f3\u306e\u6e96\u5099\n====\n\u4eca\u3053\u306e\u6642\u70b9\u3067\u3001\u3059\u3067\u306b AWS IoT \u30dc\u30bf\u30f3\u306e\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3068\u30b5\u30f3\u30d7\u30eb\u306e\u52d5\u4f5c\u306f\u7d42\u308f\u3063\u3066\u3044\u307e\u3059\u3002\u624b\u9806\u306b\u307e\u3068\u3081\u3088\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u3001\u3042\u307e\u308a\u306b\u3082\u7c21\u5358\u3067\u3059\u3057\u3001\u4ed6\u306b\u60c5\u5831\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u5272\u611b\u3057\u307e\u3059\u3002\n\nAWS IoT \u30dc\u30bf\u30f3\u3063\u3066\uff1f\n----\n\u5ff5\u306e\u305f\u3081\u3001AWS IoT \u30dc\u30bf\u30f3\u306b\u3064\u3044\u3066\u8efd\u304f\u8aac\u660e\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u3053\u306e AWS IoT \u30dc\u30bf\u30f3\u306f\u3001\u30c7\u30d0\u30a4\u30b9\u56fa\u6709\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u306a\u304f\u3001AWS \u306e IoT \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3067\u3042\u308b [AWS IoT](https://aws.amazon.com/iot/ \"AWS IoT\") \u3092\u5229\u7528\u3067\u304d\u308b\u3001\u30d9\u30fc\u30bf\u7248\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u7aef\u672b\u3067\u3059\u3002\n\nAWS IoT \u30dc\u30bf\u30f3\u306f\u3001WiFi\u7d4c\u7531\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3067\u304d\u3001\u521d\u56de\u306f\u540c\u68b1\u3055\u308c\u3066\u3044\u308b\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u3068DSN\uff08\u203b\uff09\u3092\u5165\u529b\u3057\u3066\u81ea\u8eab\u306eAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u7d10\u3065\u3051\u307e\u3059\u3002\uff08\u203b\u30dc\u30bf\u30f3\u7aef\u672b\u306e\u88cf\u5074\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b Device Serial Number\uff09\n\nWiFi\u63a5\u7d9a\u3084\u3001\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30b7\u30e7\u30f3\u3068\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3059\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306b\u3064\u3044\u3066\u306f\u3001\u300c[\u3054\u5229\u7528\u958b\u59cb\u306b\u3042\u305f\u3063\u3066](https://aws.amazon.com/jp/iot/button/ \"\u3054\u5229\u7528\u306b\u3042\u305f\u3063\u3066 - AWS IoT \u30dc\u30bf\u30f3\")\u300d\u3092\u53c2\u7167\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\nAWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059\n====\n\u305d\u308c\u3067\u306f\u3001AWS Lambda \u3067 PHP \u3092\u52d5\u304b\u3059\u6e96\u5099\u306b\u5165\u308a\u307e\u3059\u3002\n\n\u3054\u5b58\u77e5\u306e\u901a\u308a\u3001AWS Lambda \u3067\u306f\u3001Node.js, Java, Python \u304c\u52d5\u304d\u307e\u3059\u3002\u3060\u304c\u3057\u304b\u3057\u3001 **PHP \u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff01**\n\n\u3068\u306f\u3044\u3048\u3001\u52d5\u3044\u3066\u3044\u308b\u306e\u306f Linux \u3067\u3059\u3002\u8a66\u3057\u306b\u3001Lambda \u306e\u52d5\u3044\u3066\u3044\u308b\u74b0\u5883\u3067 `uname -a` \u3092\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001 `Linux ip-10-0-74-236 3.14.48-33.39.amzn1.x86_64 #1 SMP Tue Jul 14 23:43:07 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux` \u3068\u8fd4\u5374\u3055\u308c\u307e\u3059\u3002\n\n\u307e\u305f\u3001Lambda \u306f\u3001\u5358\u4e00\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u3067\u306a\u304f\u3001zip\u306b\u307e\u3068\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u542b\u3093\u3060\u74b0\u5883\u3092\u52d5\u304b\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u308c\u3089\u306e\u4ed5\u7d44\u307f\u3092\u5229\u7528\u3057\u3066\u3001 @yoshidashingo \u6c0f\u304b\u3089\u6559\u3048\u3066\u3082\u3089\u3063\u305f\u3053\u3061\u3089\u306e\u8cc7\u6599\u3092\u53c2\u8003\u306b\u3001Linux\u3067\u52d5\u4f5c\u3059\u308bPHP\u306e\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3001Lambda \u3067\u3082 PHP \u3092\u52d5\u304b\u3057\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u9b42\u80c6\u306a\u306e\u3067\u3059\uff01\n\n<iframe src=\"//www.slideshare.net/slideshow/embed_code/key/LwW6qUDMdmREXC\" width=\"595\" height=\"485\" frameborder=\"0\" marginwidth=\"0\" marginheight=\"0\" scrolling=\"no\" style=\"border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;\" allowfullscreen> </iframe> <div style=\"margin-bottom:5px\"> <strong> <a href=\"//www.slideshare.net/oh-sky/php-55467177\" title=\"PHP\u3068\u3044\u3046\u6982\u5ff5\u304b\u3099\u5b58\u5728\u3057\u306a\u3044\u9000\u5c48\u306a\u4e16\u754c\" target=\"_blank\">PHP\u3068\u3044\u3046\u6982\u5ff5\u304b\u3099\u5b58\u5728\u3057\u306a\u3044\u9000\u5c48\u306a\u4e16\u754c</a> </strong> from <strong><a href=\"//www.slideshare.net/oh-sky\" target=\"_blank\">Yoshihiro Ohsuka</a></strong> </div>\n\n\u3055\u3066\u3001\u3053\u3053\u3067\u80c6\u3068\u306a\u308bPHP\u5b9f\u884c\u30e9\u30f3\u30bf\u30a4\u30e0\u3092\u3069\u3046\u5165\u624b\u3059\u308b\u304b\u3068\u3044\u3046\u3068\u3001Lambda \u306e\u74b0\u5883\u3067\u52d5\u304f\u3088\u3046\u306b\u3001\u30d3\u30eb\u30c9\u3057\u3066\u4f5c\u6210\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\n1. Linux \u74b0\u5883\u3092\u7528\u610f\u3059\u308b\n2. Lambda \u74b0\u5883\u3067\u52d5\u304f PHP \u3092\u30d3\u30eb\u30c9\u3059\u308b\n3. Lambda\u7528\u306ezip\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\n4. Lambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n\nLinux\u74b0\u5883\u3092\u7528\u610f\u3059\u308b\n----\n\u4f5c\u696d\u74b0\u5883\u304c Windows \u306a\u306e\u3067\u3001\u5225\u9014 AWS EC2 \u3067 Linux \u74b0\u5883\u3092\u4f5c\u308a\u307e\u3059\u3002\u624b\u3063\u53d6\u308a\u65e9\u304f\u3001Amazon Linux \u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\nLambda\u74b0\u5883\u3067\u52d5\u304f PHP \u3092\u30d3\u30eb\u30c9\u3059\u308b\n----\nLambda \u306e\u30b3\u30fc\u30c9\u304c\u914d\u7f6e\u3055\u308c\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001 `/var/task` \u3067\u3059\u3002\u306a\u306e\u3067\u3001Linux \u74b0\u5883\u306b `/var/task` \u3092\u4f5c\u6210\u3057\u3066\u305d\u3053\u3067 PHP \u304c\u52d5\u304f\u3088\u3046\u306b\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\nPHP \u306e\u30d3\u30eb\u30c9\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\u300c[PHP 5.5.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff08\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u65b9\u6cd5\uff09](http://momoto.github.io/blog/2013/07/31/guide-to-compiling-and-installing-php-5-dot-5-1/ \"PHP 5.5.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff08\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3059\u308b\u65b9\u6cd5\uff09 - momoto.github.io\")\u300d\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\u3068\u3066\u3082\u5206\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u3067\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f\u3070\u304b\u308a\u306e PHP 7 \u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\uff01\n\n```bash\n# Lambda \u306e\u5b9f\u884c\u74b0\u5883\u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u3092\u4f5c\u6210\u3059\u308b\nmkdir /var/task\n\n# PHP\u914d\u7f6e\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\nmkdir /var/task/php\n\n# \u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nyum install gcc\nyum install make\n\n# PHP \u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\nwget http://jp2.php.net/get/php-7.0.0.tar.gz/from/this/mirror -O php-7.0.0.tar.gz\n\n# \u5c55\u958b\u3057\u3066\u3001\u5c55\u958b\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3059\u308b\ntar xfz php-7.0.0.tar.gz -C /usr/local/src/\ncd /usr/local/src/php-7.0.0/\n\n# \u30d3\u30eb\u30c9\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b (\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f /var/task/php \u3001\u8ffd\u52a0\u6a5f\u80fd\u306f\u3059\u3079\u3066\u7121\u52b9)\n./configure --prefix=/var/task/php --disable-all\n\n# \u30d3\u30eb\u30c9\nmake\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nmake install\n```\n\n\u3053\u308c\u3067\u3001 `/var/task/php` \u914d\u4e0b\u306b PHP \u74b0\u5883\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n```bash\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f PHP \u30e9\u30f3\u30bf\u30a4\u30e0 (\u203b tree \u30b3\u30de\u30f3\u30c9\u3067 3 \u968e\u5c64\u307e\u3067\u8868\u793a)\n tree -L 3 /var/task\n/var/task\n\u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 bin\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-cgi\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-config\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 phpdbg\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phpize\n \u00a0\u00a0 \u251c\u2500\u2500 include\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 lib\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n \u00a0\u00a0 \u251c\u2500\u2500 php\n \u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 man\n \u00a0\u00a0 \u2514\u2500\u2500 var\n \u00a0\u00a0     \u251c\u2500\u2500 log\n \u00a0\u00a0     \u2514\u2500\u2500 run\n```\n\nLambda \u7528\u306ezip\u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\n----\nLambda \u306f\u3001\u5b9f\u884c\u6642\u306e\u8d77\u70b9\u3068\u306a\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002Node.js \u7248\u306e\u30cf\u30f3\u30c9\u30e9\u30fc\u306b\u306f\u901a\u5e38 `index.handler` \u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u3066\u3001\u3053\u308c\u306f `index.js` \u306e `exports.handler` \u306b\u767b\u9332\u3055\u308c\u305f\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u4eca\u56de\u306e\u69cb\u6210\u3082\u3053\u308c\u306b\u5023\u3044\u307e\u3059\u3002\n\n`index.js` \u304a\u3088\u3073 PHP\u5b9f\u884c\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001zip\u3067\u56fa\u3081\u307e\u3059\u3002\n\n```bash\n# Lambda\u306e\u7591\u4f3c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u79fb\u52d5\u3059\u308b\ncd /var/task\n\n# AWS Lambda \u95a2\u6570\u7528\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3059\u308b\nvi index.js\n\n# PHP \u5b9f\u884c\u7528\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\nvi run.sh\n\n# \u5b9f\u884c\u3059\u308b PHP \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\nvi info.php\n\n# \u5404\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u5f8c\u306e\u69cb\u6210\ntree -L 3 /var/task\n/var/task\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 info.php\n\u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bin\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-cgi\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 php-config\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 phpdbg\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 phpize\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 include\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lib\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 php\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 php\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 man\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 var\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 log\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 run\n\u2514\u2500\u2500 run.sh\n```\n\n\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n```js:index.js\nvar exec = require('child_process').exec;\n\nexports.handler = function(event, context) {\n    var child = exec(\"sh ./run.sh\", function(error) {\n        // Resolve with result of process\n        context.done(error, 'Process complete!');\n    });\n\n    // Log process stdout and stderr\n    child.stdout.on('data', console.log);\n    child.stderr.on('data', console.error);\n};\n```\n```bash:run.sh\n#!/bin/sh\n./php/bin/php info.php\n```\n```php:info.php\n<?php\nphpinfo();\n```\n\nzip\u306b\u307e\u3068\u3081\u307e\u3059\u3002zip\u3092\u56de\u7b54\u3057\u305f\u3068\u304d\u306b\u3001\u76f4\u4e0b\u306b `index.js` \u304c\u914d\u7f6e\u3055\u308c\u308b\u3088\u3046\u306b zip \u5316\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```bash\n# Lambda \u306e\u7591\u4f3c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3001zip \u30a2\u30fc\u30ab\u30a4\u30d6\u3092\u4f5c\u6210\u3059\u308b\ncd /var/task\nzip -r task.zip .\n```\n\n\u3053\u306e `task.zip` \u3092\u624b\u5143\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001Lambda \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u4eca\u56de\u306f 10KB \u4ee5\u4e0a\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3001S3\u7d4c\u7531\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u554f\u984c\u306a\u3051\u308c\u3070\u3001\u6b21\u306b\u9032\u307f\u307e\u3057\u3087\u3046\uff01\n\nAWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP on AWS Lambda \u3092\u8d77\u52d5\uff01\n====\n\u305d\u308c\u3067\u306f\u3001AWS IoT \u30dc\u30bf\u30f3\u306e\u62bc\u4e0b\u3067 PHP on Lambda \u304c\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\nAWS IoT \u30dc\u30bf\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u8a2d\u5b9a\u3057\u305f\u3042\u3068\u306f\u3001`Things`,`Roles`,`Certificates`,`Policies`\u304c1\u500b\u305a\u3064\u8a2d\u5b9a\u3055\u308c\u305f\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u3046\u3061\u3001`\u30eb\u30fc\u30eb` \u3092\u9078\u629e\u3057\u3001\u300cEdit Actions\u300d\u304b\u3089\u300cAdd New Action\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_120715_122121_AM.jpg](https://qiita-image-store.s3.amazonaws.com/0/3812/3308c6b6-d8d2-a05e-1497-1c3134b38bb8.jpeg)\n\n\u300cChoose an action\u300d\u3067\u3001\u300cInsert this message into a code function and excute it (Lambda)\u300d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n![\u5168\u753b\u9762_120715_122527_AM.jpg](https://qiita-image-store.s3.amazonaws.com/0/3812/192e1fff-35bc-cf46-350b-e90071741a12.jpeg)\n\n\u300cFunction Name\u300d\u306b\u3001\u5148\u307b\u3069\u4f5c\u3063\u305fLambda\u95a2\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_120715_125149_AM.jpg](https://qiita-image-store.s3.amazonaws.com/0/3812/7373e882-f8d8-6265-3ac3-878c25226757.jpeg)\n\n\u305d\u308c\u3067\u306f\uff01\nAWS IoT \u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30dd\u30c1\u3063\u3068\u306a\uff01\n![\u7121\u984c\u30af\u30ea\u30c3\u30d7_120715_020400_AM.jpg](https://qiita-image-store.s3.amazonaws.com/0/3812/346609e8-6728-53fe-bf83-7f412e0591c0.jpeg)\n\n\nCloudWatch \u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u2026\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_120715_013316_AM.jpg](https://qiita-image-store.s3.amazonaws.com/0/3812/a797824c-c6e6-68bc-303d-acfab22231d5.jpeg)\n\n\u30ad\u30bf\u30fc\u30fc\u30fc\uff01\u30fe(o\u00b4\u2200`o)\uff89\n\nEpilogue - \u304a\u308f\u308a\u306b\n====\nAWS IoT \u304b\u3089 Lambda \u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3082\u308f\u304b\u308a\u3001\u3044\u308d\u3044\u308d\u52c9\u5f37\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u4eca\u56de\u3001\u4e00\u756a\u96e3\u95a2\u3068\u601d\u3063\u3066\u3044\u305f PHP \u306e\u30d3\u30eb\u30c9\u3067\u3059\u304c\u3001\u3061\u3087\u3063\u3068\u5e2b\u5320 @kazumihirose \u306b\u30a2\u30c9\u30d0\u30a4\u30b9\u3092\u3044\u305f\u3060\u304d\u3064\u3064\u624b\u9806\u306b\u5023\u3046\u3068\u3059\u3093\u306a\u308a\u3067\u304d\u307e\u3057\u305f\uff01\n\n\u3057\u304b\u3057\u3001\u4eca\u56de\u306f\u308f\u3056\u308f\u3056 AWS IoT \u30dc\u30bf\u30f3\u304b\u3089 PHP \u3092\u52d5\u304b\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u308c\u3001\u7279\u306b\u4f55\u3082\u5f79\u306b\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u6b21\u306f\u3082\u3063\u3068\u5f79\u7acb\u3061\u305d\u3046\u306a\u3082\u306e\u3092\u4f5c\u308a\u305f\u3044\u3067\u3059\u306d(\u7b11)\n\n[cloudpack]:https://cloudpack.jp/ \"cloudpack\uff08\u30af\u30e9\u30a6\u30c9\u30d1\u30c3\u30af\uff09 400\u793e\u3092\u8d85\u3048\u308b\u5c0e\u5165\u5b9f\u7e3e! EC2\u306a\u3069AWS\u30af\u30e9\u30a6\u30c9\u306e\u5c0e\u5165\u8a2d\u8a08\u3001\u69cb\u7bc9\u3001\u904b\u7528\u4fdd\u5b88\u30b5\u30fc\u30d3\u30b9\"\n[cloudpack-blog]:http://blog.cloudpack.jp/ \"cloudpack\u6280\u8853\u60c5\u5831\u30b5\u30a4\u30c8\"\n[\u5927\u5e73\u304b\u3065\u307f]:http://blog.cloudpack.jp/author/oohira/ \"\u5927\u5e73\u304b\u3065\u307f\u306e\u8a18\u4e8b\u4e00\u89a7\"\n", "tags": ["awsIoT", "AWSLambda", "PHP", "PHP7"]}