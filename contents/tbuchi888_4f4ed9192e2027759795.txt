{"tags": ["Jupyter", "Ansible", "pyenv", "vagrant", "CentOS6"], "context": "\n\n\u306f\u3058\u3081\u306b\n\u4e2d\u4e95\u60a6\u53f8\u3055\u3093\u3088\u308a\u7d39\u4ecb\u9802\u304d\u307e\u3057\u305f\u5b9f\u884c\u53ef\u80fd\u306a\u624b\u9806\u66f8\u3068\u3057\u3066\u306e\nAnsible run on Jupyter notebook\u306b\u3064\u3044\u3066\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u69cb\u7bc9\u65b9\u6cd5\u306a\u3069\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4e2d\u4e95\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\nAnsible run on Jupyter notebook\u304c\u3001\u3069\u3093\u306a\u3082\u306e\u306a\u306e\u304b\u306f\u4e2d\u4e95\u3055\u3093\u306e\u3053\u3061\u3089\u306e\u30d6\u30ed\u30b0Literate Automation\uff08\u6587\u82b8\u7684\u81ea\u52d5\u5316\uff09\u306b\u3064\u3044\u3066\u306e\u8003\u5bdf\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u4f7f\u3044\u3069\u3053\u308d\n\u4e2d\u4e95\u3055\u3093\u3088\u308a\u521d\u3081\u3066Jupyter\u304b\u3089Ansible\u3092\u5b9f\u884c\u3059\u308b\u8a71\u3092\u7d39\u4ecb\u3044\u305f\u3060\u3044\u305f\u6642\u306b\u306f\u3001\u6b63\u76f4\u306a\u3068\u3053\u308d\u3042\u307e\u308a\u30d4\u30f3\u3068\u3053\u306a\u304b\u3063\u305f\u3067\u3059\u3002\uff08\u4e2d\u4e95\u3055\u3093\u3059\u307f\u307e\u305b\u3093\u3002\u3002\u3002\uff09\n\u3057\u304b\u3057\u3001\u6700\u8fd1\u3001\u591a\u6570\u306e\u624b\u9806\u66f8\u3092Ansible\u306ePlaybook\u5316\u3057\u69cb\u7bc9\u4f5c\u696d\u7b49\u3092\u81ea\u52d5\u5316\u3059\u308b\u6848\u4ef6\u304c\u3042\u308a\u3001\u8003\u3048\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u69cb\u7bc9\u9014\u4e2d\u306bGUI\u4f5c\u696d\u304c\u5fc5\u8981\u3067\u3042\u3063\u305f\u308a\u3001\u7269\u7406\u7684\u306b\u4e2d\u65ad\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306a\u3069\u3001\u3069\u3046\u3057\u3066\u3082Playbook\u3060\u3051\u3067\u306f\u5168\u3066\u3092\u81ea\u52d5\u5316\u3067\u304d\u306a\u3044\u90e8\u5206\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\u81ea\u52d5\u5316\u3067\u304d\u306a\u3044\u90e8\u5206\u306f\u624b\u9806\u66f8\u3068Jenkins\u304a\u3058\u3055\u3093\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3069\u3046\u306b\u304b\u3057\u3088\u3046\u304b\u3068\u8003\u3048\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\n\u3075\u3068Jupyter\u306e\u5229\u7528\u3092\u601d\u3044\u51fa\u3057\u3001\u8a66\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u5f15\u304d\u7d99\u304e\u3084\u7d50\u679c\u306e\u72b6\u6cc1\u5831\u544a\u30fb\u5171\u6709\u542b\u3081\u3066\u3001\u3068\u3066\u3082\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u74b0\u5883\u69cb\u7bc9\n\u4e2d\u4e95\u3055\u3093\u306e\u30d6\u30ed\u30b0\u3067\u306fCentOS7\u4e0a\u306eDocker\u3067\u52d5\u304b\u3059\u306e\u3067\u3059\u304c\u3001Dockerfile\u306btensorflow\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3068\u3001\n\u8af8\u4e8b\u60c5\u306b\u3088\u308aDocker\u304c\u5229\u7528\u3067\u304d\u306a\u3044\u74b0\u5883\u3067\u3042\u3063\u305f\u305f\u3081\u3001\nDockerfile\u306e\u5185\u5bb9\u3092\u53c2\u8003\u3068\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u3064\u3064\n\u4eca\u56de\u306fCentOS6\u4e0a\u306b\u4ee5\u4e0b\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u69cb\u7bc9\u3057\u3001Vagrant\u306eBox\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u3066\u73fe\u5834\u3067\u5229\u7528\u3057\u307e\u3057\u305f\u3002\nVagrant\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u30af\u30ed\u30fc\u30ba\u30c9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u74b0\u5883\u306e32bit Windows7\u4e0a\u3067Ansible\u306a\u3069\u3092\u52d5\u304b\u3059\u65b9\u6cd5\u306a\u3069\u3082\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nJupyter\u81ea\u4f53\u306fpip install Jupyter\u3067\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u306e\u3067\u3059\u304c\u3001CentOS6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306ePython\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.6.6?\u3067\u306f\u3046\u307e\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u3001\nPyenv\u3067Pyhton\u3092\u30d0\u30fc\u30b8\u30e7\u30f32.7.8\u306b\u4e0a\u3052\u3066\u304b\u3089\u3001Jupyter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\u203bpyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u90e8\u5206\u306e\u307f\u3092\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3078\u5207\u308a\u51fa\u3057\u307e\u3057\u305fpyenv\u3060\u3051\u3067\u826f\u3044\u65b9\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u69cb\u7bc9\u306e\u4e3b\u306a\u624b\u9806\nJupyter\u3068Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044CentOS6\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092root\u3067\u5b9f\u65bd\u3057\u307e\u3059\n1.\u3000pyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2.\u3000python2.7.8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n3.\u3000Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n4.\u3000Jupyter notebook\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n5.\u3000Jupyter notebook\u306e\u8a2d\u5b9a\n6.\u3000Jupyter notebook\u306e\u30dd\u30fc\u30c8\uff088888\uff09\u306e\u7a74\u3042\u3051\n7.\u3000Jupyter notebook\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a(pass)\u3068\u8d77\u52d5\n8.\u3000Vagrant\u306e\u5834\u5408\u3001\u30dd\u30fc\u30c8\uff1a8888\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n\nplaybook \u3084 Vagrantfile\uff08Ansible provisoner)\u7b49\n\u5177\u4f53\u7684\u306a\u74b0\u5883\u69cb\u7bc9\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ngist\u306f\u3053\u3061\u3089\u3068\u306a\u308a\u307e\u3059\u3002\ngit clone https://gist.github.com/tbuchi888/240df64592302bbee9d823c1c36e0692\n\nsite.yml\n---\n - include: install_pyenv_without_proxy.yml\n - include: install_jupyter_ansible_without_proxy.yml\n\n\n\ninstall_pyenv_without_proxy.yml\n---\n- hosts: all\n  gather_facts: no\n  become: yes\n  vars:\n    python_ver: 2.7.8\n  tasks:\n    - name: which pyenv\n      shell:  source ~/.bash_profile; which pyenv\n      register: pyenv_install\n      failed_when: pyenv_install.rc == 0\n    - debug: var=pyenv_install\n\n    - block:\n        - debug: msg=\"---------- block start ----------\"\n        - name: yum install with_items\n          yum:\n            name:  '{{ item.name }}'\n            state: latest\n          register: RESULT\n          with_items:\n            - name: gcc\n            - name: gcc-c++\n            - name: make\n            - name: git\n            - name: openssl-devel\n            - name: bzip2-devel\n            - name: zlib-devel\n            - name: readline-devel\n            - name: sqlite-devel\n            - name: bzip2\n            - name: sqlite\n            - name: patch\n        - name: results\n          debug: var=RESULT.results\n\n        - name: git clone pyenv , pyenv-virtualenv\n          git:\n            repo: '{{ item.repo }}'\n            dest: '{{ item.dest }}'\n          register: RESULT\n          with_items:\n            - repo: git://github.com/yyuu/pyenv.git\n              dest: ~/.pyenv\n            - repo: git://github.com/yyuu/pyenv-virtualenv.git\n              dest: ~/.pyenv/plugins/pyenv-virtualenv\n        - name: results\n          debug: var=RESULT.results\n\n        - name: \"install pyenv and python ver.{{ python_ver }}\"\n          shell: '{{ item.cmd }}'\n          register: RESULT\n          with_items:\n            - cmd: echo 'export PYENV_ROOT=\"${HOME}/.pyenv\"' >> ~/.bash_profile\n            - cmd: echo 'if [ -d \"${PYENV_ROOT}\" ]; then' >> ~/.bash_profile\n            - cmd: echo '    export PATH=${PYENV_ROOT}/bin:$PATH' >> ~/.bash_profile\n            - cmd: echo '    eval \"$(pyenv init -)\"' >> ~/.bash_profile\n            - cmd: echo 'fi' >> ~/.bash_profile\n            - cmd: source ~/.bash_profile; pyenv -v\n            - cmd: source ~/.bash_profile; python -V\n            - cmd: source ~/.bash_profile; pyenv install '{{ python_ver }}'\n            - cmd: source ~/.bash_profile; pyenv global '{{ python_ver }}'\n            - cmd: source ~/.bash_profile; python -V\n        - name: results\n          debug: var=RESULT.results\n\n        - debug: msg=\"---------- block end   ----------\"\n\n      when: pyenv_install.rc == 1\n\n\nJupyter\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0bjupyter_password: pass\n\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u9069\u6642\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ninstall_jupyter_ansible_without_proxy.yml\n---\n# Setting the destination inventory host\n- hosts: all\n  become: yes\n  become_method: sudo\n  become_user: root\n\n# Don't gather hosts facts for performance\n  gather_facts: no\n  vars:\n    jupyter_password: pass\n\n# Setting the task\n  tasks:\n    - name: yum install with_items\n      yum:\n        name: '{{ item.name }}'\n        state: latest\n      with_items:\n        - name: '*' \n        - name: \"@Development Tools\"\n        - name: epel-release\n        - name: python-devel\n        - name: python-pip\n        - name: lapack-devel\n        - name: freetype-devel\n        - name: libpng-devel\n        - name: libjpeg-turbo-devel\n        - name: ansible\n\n    - name: copy init.sh for jupyter notebook \n      template:\n        src: init.sh.j2\n        dest: /usr/local/bin/init.sh\n        mode: u+x\n\n    - name: command by shell module with_items\n      shell: '{{item.cmd}}'\n      register: RESULT\n      with_items:\n        - cmd: source ~/.bash_profile; pip install jupyter\n        - cmd: source ~/.bash_profile; jupyter notebook --generate-config\n        - cmd: source ~/.bash_profile; echo \"c.NotebookApp.ip = '*'\" >>/root/.jupyter/jupyter_notebook_config.py && echo \"c.NotebookApp.open_browser = False\" >>/root/.jupyter/jupyter_notebook_config.py\n        - cmd: source ~/.bash_profile; nohup /usr/local/bin/init.sh &\n        - cmd: lokkit -p 8888:tcp\n    - debug: var=RESULT.results\n\n\nJupyter\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3068\u8d77\u52d5\u7528\u30b7\u30a7\u30eb\u306ejinjya2\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\ninit.sh.j2\n#!/bin/bash\ntrap 'pkill -f jupyter-notebook; sleep 3; exit 0' EXIT\n\nif [ \"${PASSWORD-undef}\" = \"undef\" ]; then\n  export PASSWORD='{{jupyter_password}}'\nfi\n\nif ! grep -qE '^c.NotebookApp.password =' $HOME/.jupyter/jupyter_notebook_config.py; then\n  HASH=$(python -c \"from IPython.lib import passwd; print(passwd('${PASSWORD}'))\")\n  echo \"c.NotebookApp.password = u'${HASH}'\" >>$HOME/.jupyter/jupyter_notebook_config.py\nfi\nunset PASSWORD\nunset HASH\n\nmkdir -p $HOME/notebook\ncd $HOME/notebook\n# Comment out the following line.\n#ipython -c '%matplotlib' # build font cache for matplotlib\njupyter notebook\n\n\n\u4ee5\u4e0b\u306fVagrant\u74b0\u5883\u306e\u5834\u5408\n\u4ee5\u4e0b\u306fvagrant up\u306b\u3066CentOS6\u306eServer\u8d77\u52d5\u3068Ansible provisoner\u3092\u5229\u7528\u3057\u3066pyenv\u74b0\u5883\u3067\u306eJupyter\u3068Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u3055\u3089\u306bjupyter\u3067\u5229\u7528\u3059\u308b8888\u30dd\u30fc\u30c8\u306e\u30d5\u30a9\u30fc\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001box\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3064\u3044\u3066\u306f\u3001\u81ea\u74b0\u5883\u306eCentOS6\u306ebox\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u7279\u306b32bit\u30de\u30b7\u30f3\u74b0\u5883\u306e\u5834\u5408\u306f\u3001\u81ea\u4f5c\u306e32bit\u7248CentOS6\u306ebox\u30d5\u30a1\u30a4\u30eb\u540d\u3078\u306e\u7f6e\u304d\u63db\u3048\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # Every Vagrant development environment requires a box. You can search for\n  # boxes at https://atlas.hashicorp.com/search.\n  # Please replace it with a BOX name of CentOS6 for one's own 32bit when your host is 32bit machine.\n  config.vm.box = \"geerlingguy/centos6\"\n\n  # Add forwarded port to use on Jupyter notebook\n  config.vm.network \"forwarded_port\", guest: 8888, host: 8888, host_ip: \"127.0.0.1\",\n    auto_correct: true\n  # Add ansible provisioner\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"site.yml\"\n  end\nend\n\n\n\u3000\u4f7f\u3044\u65b9\n-\u3000OSX\u7b49\u3067Ansible provisoner\u304c\u5229\u7528\u3067\u304d\u308bVagrant\u74b0\u5883\u306e\u5834\u5408\n\u3000\u3000-\u3000\u4e0a\u8a18playbook\u7b49\u8cc7\u6750\u3092\u7528\u610f\u3057\u305f\u4e0a\u3067vagrant up\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n-\u3000Ansible\u74b0\u5883\u306e\u307f\u306e\u5834\u5408\n\u3000\u3000-\u3000\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30db\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5404\u81ea\u7528\u610f\u3057\u3066CentOS6\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066Playbook\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nansible-playbook -i \u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3000site.yml\n\n\u4e0a\u8a18\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u306e\u5b9f\u884c\u74b0\u5883\n\nAnsible provisioner and Vagrant,Virtulbox Host\n\u3000-\u3000OS\uff1aOSX yosemite\n\u3000-\u3000Virtulbox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.10 r104061\n\u3000-\u3000Vagrant\uff1a Vagrant 1.8.1\n\u3000-\u3000Ansible\uff1a\n$ansible --version\nansible 2.1.0 (devel c600ab81ee) last updated 2016/04/20 11:11:25 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD 98322a777f) last updated 2016/04/20 11:11:54 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 1aecfc1e19) last updated 2016/04/20 11:11:55 (GMT +900)\n  config file = \n  configured module search path = Default w/o overrides\n\n\nJupyter\u3000and\u3000Ansible Server\n-\u3000OS: CentOS6.8\n\n\u53c2\u8003\uff1aJupyter\u306e\u753b\u9762\n\u3000-\u3000\u30d6\u30e9\u30a6\u30b6\u3088\u308aJupyter(http://127.0.0.1:8888/)\u3078\u30a2\u30af\u30bb\u30b9\n\n-\u3000\u30d1\u30b9\u30ef\u30fc\u30c9\uff08pass\uff09\u3092\u5165\u529b\u3057\u3066\u30ed\u30b0\u30a4\u30f3\n\n-\u3000New\u304b\u3089Python \uff12\u3092\u9078\u629e\u3057\u3001notebook\u3092\u65b0\u898f\u4f5c\u6210\n\n-\u3000 Markdown\u306e\u884c\u3068\u3000Code\u306e\u884c\uff08bash\u30b3\u30de\u30f3\u30c9\u3067ansible\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\uff09\u3092\u8ffd\u52a0\n\n-\u3000 Code\u306e\u5b9f\u884c\u7d50\u679c\n\n# \u306f\u3058\u3081\u306b\n\u4e2d\u4e95\u60a6\u53f8\u3055\u3093\u3088\u308a\u7d39\u4ecb\u9802\u304d\u307e\u3057\u305f\u5b9f\u884c\u53ef\u80fd\u306a\u624b\u9806\u66f8\u3068\u3057\u3066\u306e\nAnsible run on Jupyter notebook\u306b\u3064\u3044\u3066\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u69cb\u7bc9\u65b9\u6cd5\u306a\u3069\u3092\u30e1\u30e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4e2d\u4e95\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n\nAnsible run on Jupyter notebook\u304c\u3001\u3069\u3093\u306a\u3082\u306e\u306a\u306e\u304b\u306f\u4e2d\u4e95\u3055\u3093\u306e\u3053\u3061\u3089\u306e\u30d6\u30ed\u30b0[Literate Automation\uff08\u6587\u82b8\u7684\u81ea\u52d5\u5316\uff09\u306b\u3064\u3044\u3066\u306e\u8003\u5bdf](http://enakai00.hatenablog.com/entry/2016/04/22/204125)\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n## \u4f7f\u3044\u3069\u3053\u308d\n\u4e2d\u4e95\u3055\u3093\u3088\u308a\u521d\u3081\u3066Jupyter\u304b\u3089Ansible\u3092\u5b9f\u884c\u3059\u308b\u8a71\u3092\u7d39\u4ecb\u3044\u305f\u3060\u3044\u305f\u6642\u306b\u306f\u3001\u6b63\u76f4\u306a\u3068\u3053\u308d\u3042\u307e\u308a\u30d4\u30f3\u3068\u3053\u306a\u304b\u3063\u305f\u3067\u3059\u3002\uff08\u4e2d\u4e95\u3055\u3093\u3059\u307f\u307e\u305b\u3093\u3002\u3002\u3002\uff09\n\u3057\u304b\u3057\u3001\u6700\u8fd1\u3001\u591a\u6570\u306e\u624b\u9806\u66f8\u3092Ansible\u306ePlaybook\u5316\u3057\u69cb\u7bc9\u4f5c\u696d\u7b49\u3092\u81ea\u52d5\u5316\u3059\u308b\u6848\u4ef6\u304c\u3042\u308a\u3001\u8003\u3048\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u69cb\u7bc9\u9014\u4e2d\u306bGUI\u4f5c\u696d\u304c\u5fc5\u8981\u3067\u3042\u3063\u305f\u308a\u3001\u7269\u7406\u7684\u306b\u4e2d\u65ad\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u306a\u3069\u3001\u3069\u3046\u3057\u3066\u3082Playbook\u3060\u3051\u3067\u306f\u5168\u3066\u3092\u81ea\u52d5\u5316\u3067\u304d\u306a\u3044\u90e8\u5206\u304c\u51fa\u3066\u304d\u307e\u3057\u305f\u3002\n\u81ea\u52d5\u5316\u3067\u304d\u306a\u3044\u90e8\u5206\u306f\u624b\u9806\u66f8\u3068Jenkins\u304a\u3058\u3055\u3093\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u3069\u3046\u306b\u304b\u3057\u3088\u3046\u304b\u3068\u8003\u3048\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\n\u3075\u3068Jupyter\u306e\u5229\u7528\u3092\u601d\u3044\u51fa\u3057\u3001\u8a66\u3057\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u5f15\u304d\u7d99\u304e\u3084\u7d50\u679c\u306e\u72b6\u6cc1\u5831\u544a\u30fb\u5171\u6709\u542b\u3081\u3066\u3001\u3068\u3066\u3082\u4fbf\u5229\u306b\u4f7f\u3048\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n## \u74b0\u5883\u69cb\u7bc9\n\u4e2d\u4e95\u3055\u3093\u306e\u30d6\u30ed\u30b0\u3067\u306fCentOS7\u4e0a\u306eDocker\u3067\u52d5\u304b\u3059\u306e\u3067\u3059\u304c\u3001[Dockerfile](http://enakai00.hatenablog.com/entry/2016/03/28/131157)\u306btensorflow\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3068\u3001\n\u8af8\u4e8b\u60c5\u306b\u3088\u308aDocker\u304c\u5229\u7528\u3067\u304d\u306a\u3044\u74b0\u5883\u3067\u3042\u3063\u305f\u305f\u3081\u3001\nDockerfile\u306e\u5185\u5bb9\u3092\u53c2\u8003\u3068\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u3064\u3064\n\u4eca\u56de\u306fCentOS6\u4e0a\u306b\u4ee5\u4e0b\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u69cb\u7bc9\u3057\u3001Vagrant\u306eBox\u30d5\u30a1\u30a4\u30eb\u5316\u3057\u3066\u73fe\u5834\u3067\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\nVagrant\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b[\u30af\u30ed\u30fc\u30ba\u30c9\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u74b0\u5883\u306e32bit Windows7\u4e0a\u3067Ansible\u306a\u3069\u3092\u52d5\u304b\u3059\u65b9\u6cd5](http://qiita.com/tbuchi888/items/971d42bba2999dd2fee1)\u306a\u3069\u3082\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nJupyter\u81ea\u4f53\u306f`pip install Jupyter`\u3067\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u306e\u3067\u3059\u304c\u3001CentOS6\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306ePython\u306e\u30d0\u30fc\u30b8\u30e7\u30f32.6.6?\u3067\u306f\u3046\u307e\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u3001\nPyenv\u3067Pyhton\u3092\u30d0\u30fc\u30b8\u30e7\u30f32.7.8\u306b\u4e0a\u3052\u3066\u304b\u3089\u3001Jupyter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n\u203bpyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u90e8\u5206\u306e\u307f\u3092[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/tbuchi888/items/d44d15dcc6f63ae440d9)\u3078\u5207\u308a\u51fa\u3057\u307e\u3057\u305fpyenv\u3060\u3051\u3067\u826f\u3044\u65b9\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n### \u69cb\u7bc9\u306e\u4e3b\u306a\u624b\u9806\nJupyter\u3068Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044CentOS6\u306b\u5bfe\u3057\u3066\u4ee5\u4e0b\u3092root\u3067\u5b9f\u65bd\u3057\u307e\u3059\n\n1.\u3000pyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2.\u3000python2.7.8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n3.\u3000Ansible\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n4.\u3000Jupyter notebook\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n5.\u3000Jupyter notebook\u306e\u8a2d\u5b9a\n6.\u3000Jupyter notebook\u306e\u30dd\u30fc\u30c8\uff088888\uff09\u306e\u7a74\u3042\u3051\n7.\u3000Jupyter notebook\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a(`pass`)\u3068\u8d77\u52d5\n8.\u3000Vagrant\u306e\u5834\u5408\u3001\u30dd\u30fc\u30c8\uff1a8888\u306e\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n\n### playbook \u3084 Vagrantfile\uff08Ansible provisoner)\u7b49\n\u5177\u4f53\u7684\u306a\u74b0\u5883\u69cb\u7bc9\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ngist\u306f[\u3053\u3061\u3089](https://gist.github.com/tbuchi888/240df64592302bbee9d823c1c36e0692)\u3068\u306a\u308a\u307e\u3059\u3002\n`git clone https://gist.github.com/tbuchi888/240df64592302bbee9d823c1c36e0692`\n\n\n``` site.yml\n---\n - include: install_pyenv_without_proxy.yml\n - include: install_jupyter_ansible_without_proxy.yml\n```\n\n``` install_pyenv_without_proxy.yml\n---\n- hosts: all\n  gather_facts: no\n  become: yes\n  vars:\n    python_ver: 2.7.8\n  tasks:\n    - name: which pyenv\n      shell:  source ~/.bash_profile; which pyenv\n      register: pyenv_install\n      failed_when: pyenv_install.rc == 0\n    - debug: var=pyenv_install\n\n    - block:\n        - debug: msg=\"---------- block start ----------\"\n        - name: yum install with_items\n          yum:\n            name:  '{{ item.name }}'\n            state: latest\n          register: RESULT\n          with_items:\n            - name: gcc\n            - name: gcc-c++\n            - name: make\n            - name: git\n            - name: openssl-devel\n            - name: bzip2-devel\n            - name: zlib-devel\n            - name: readline-devel\n            - name: sqlite-devel\n            - name: bzip2\n            - name: sqlite\n            - name: patch\n        - name: results\n          debug: var=RESULT.results\n\n        - name: git clone pyenv , pyenv-virtualenv\n          git:\n            repo: '{{ item.repo }}'\n            dest: '{{ item.dest }}'\n          register: RESULT\n          with_items:\n            - repo: git://github.com/yyuu/pyenv.git\n              dest: ~/.pyenv\n            - repo: git://github.com/yyuu/pyenv-virtualenv.git\n              dest: ~/.pyenv/plugins/pyenv-virtualenv\n        - name: results\n          debug: var=RESULT.results\n\n        - name: \"install pyenv and python ver.{{ python_ver }}\"\n          shell: '{{ item.cmd }}'\n          register: RESULT\n          with_items:\n            - cmd: echo 'export PYENV_ROOT=\"${HOME}/.pyenv\"' >> ~/.bash_profile\n            - cmd: echo 'if [ -d \"${PYENV_ROOT}\" ]; then' >> ~/.bash_profile\n            - cmd: echo '    export PATH=${PYENV_ROOT}/bin:$PATH' >> ~/.bash_profile\n            - cmd: echo '    eval \"$(pyenv init -)\"' >> ~/.bash_profile\n            - cmd: echo 'fi' >> ~/.bash_profile\n            - cmd: source ~/.bash_profile; pyenv -v\n            - cmd: source ~/.bash_profile; python -V\n            - cmd: source ~/.bash_profile; pyenv install '{{ python_ver }}'\n            - cmd: source ~/.bash_profile; pyenv global '{{ python_ver }}'\n            - cmd: source ~/.bash_profile; python -V\n        - name: results\n          debug: var=RESULT.results\n\n        - debug: msg=\"---------- block end   ----------\"\n\n      when: pyenv_install.rc == 1\n```\n\nJupyter\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b`jupyter_password: pass\n`\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u9069\u6642\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n``` install_jupyter_ansible_without_proxy.yml\n---\n# Setting the destination inventory host\n- hosts: all\n  become: yes\n  become_method: sudo\n  become_user: root\n\n# Don't gather hosts facts for performance\n  gather_facts: no\n  vars:\n    jupyter_password: pass\n\n# Setting the task\n  tasks:\n    - name: yum install with_items\n      yum:\n        name: '{{ item.name }}'\n        state: latest\n      with_items:\n        - name: '*' \n        - name: \"@Development Tools\"\n        - name: epel-release\n        - name: python-devel\n        - name: python-pip\n        - name: lapack-devel\n        - name: freetype-devel\n        - name: libpng-devel\n        - name: libjpeg-turbo-devel\n        - name: ansible\n\n    - name: copy init.sh for jupyter notebook \n      template:\n        src: init.sh.j2\n        dest: /usr/local/bin/init.sh\n        mode: u+x\n\n    - name: command by shell module with_items\n      shell: '{{item.cmd}}'\n      register: RESULT\n      with_items:\n        - cmd: source ~/.bash_profile; pip install jupyter\n        - cmd: source ~/.bash_profile; jupyter notebook --generate-config\n        - cmd: source ~/.bash_profile; echo \"c.NotebookApp.ip = '*'\" >>/root/.jupyter/jupyter_notebook_config.py && echo \"c.NotebookApp.open_browser = False\" >>/root/.jupyter/jupyter_notebook_config.py\n        - cmd: source ~/.bash_profile; nohup /usr/local/bin/init.sh &\n        - cmd: lokkit -p 8888:tcp\n    - debug: var=RESULT.results\n```\n\nJupyter\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u3068\u8d77\u52d5\u7528\u30b7\u30a7\u30eb\u306ejinjya2\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n\n``` init.sh.j2\n#!/bin/bash\ntrap 'pkill -f jupyter-notebook; sleep 3; exit 0' EXIT\n\nif [ \"${PASSWORD-undef}\" = \"undef\" ]; then\n  export PASSWORD='{{jupyter_password}}'\nfi\n\nif ! grep -qE '^c.NotebookApp.password =' $HOME/.jupyter/jupyter_notebook_config.py; then\n  HASH=$(python -c \"from IPython.lib import passwd; print(passwd('${PASSWORD}'))\")\n  echo \"c.NotebookApp.password = u'${HASH}'\" >>$HOME/.jupyter/jupyter_notebook_config.py\nfi\nunset PASSWORD\nunset HASH\n\nmkdir -p $HOME/notebook\ncd $HOME/notebook\n# Comment out the following line.\n#ipython -c '%matplotlib' # build font cache for matplotlib\njupyter notebook\n```\n\n\u4ee5\u4e0b\u306fVagrant\u74b0\u5883\u306e\u5834\u5408\n\u4ee5\u4e0b\u306f`vagrant up`\u306b\u3066CentOS6\u306eServer\u8d77\u52d5\u3068Ansible provisoner\u3092\u5229\u7528\u3057\u3066pyenv\u74b0\u5883\u3067\u306eJupyter\u3068Ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u3055\u3089\u306bjupyter\u3067\u5229\u7528\u3059\u308b8888\u30dd\u30fc\u30c8\u306e\u30d5\u30a9\u30fc\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001box\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u3064\u3044\u3066\u306f\u3001\u81ea\u74b0\u5883\u306eCentOS6\u306ebox\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u7279\u306b32bit\u30de\u30b7\u30f3\u74b0\u5883\u306e\u5834\u5408\u306f\u3001\u81ea\u4f5c\u306e32bit\u7248CentOS6\u306ebox\u30d5\u30a1\u30a4\u30eb\u540d\u3078\u306e\u7f6e\u304d\u63db\u3048\u3092\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\nVagrantfile\n\n``` Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # Every Vagrant development environment requires a box. You can search for\n  # boxes at https://atlas.hashicorp.com/search.\n  # Please replace it with a BOX name of CentOS6 for one's own 32bit when your host is 32bit machine.\n  config.vm.box = \"geerlingguy/centos6\"\n\n  # Add forwarded port to use on Jupyter notebook\n  config.vm.network \"forwarded_port\", guest: 8888, host: 8888, host_ip: \"127.0.0.1\",\n    auto_correct: true\n  # Add ansible provisioner\n  config.vm.provision \"ansible\" do |ansible|\n    ansible.playbook = \"site.yml\"\n  end\nend\n```\n\n###\u3000\u4f7f\u3044\u65b9\n-\u3000OSX\u7b49\u3067Ansible provisoner\u304c\u5229\u7528\u3067\u304d\u308bVagrant\u74b0\u5883\u306e\u5834\u5408\n\u3000\u3000-\u3000\u4e0a\u8a18playbook\u7b49\u8cc7\u6750\u3092\u7528\u610f\u3057\u305f\u4e0a\u3067`vagrant up`\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n-\u3000Ansible\u74b0\u5883\u306e\u307f\u306e\u5834\u5408\n\u3000\u3000-\u3000\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30db\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u5404\u81ea\u7528\u610f\u3057\u3066CentOS6\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066Playbook\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n`ansible-playbook -i \u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3000site.yml`\n\n### \u4e0a\u8a18\u30d7\u30ec\u30a4\u30d6\u30c3\u30af\u306e\u5b9f\u884c\u74b0\u5883\n#### Ansible provisioner and Vagrant,Virtulbox Host\n\u3000-\u3000OS\uff1aOSX yosemite\n\u3000-\u3000Virtulbox\uff1a\u30d0\u30fc\u30b8\u30e7\u30f3 5.0.10 r104061\n\u3000-\u3000Vagrant\uff1a Vagrant 1.8.1\n\u3000-\u3000Ansible\uff1a\n\n```\n$ansible --version\nansible 2.1.0 (devel c600ab81ee) last updated 2016/04/20 11:11:25 (GMT +900)\n  lib/ansible/modules/core: (detached HEAD 98322a777f) last updated 2016/04/20 11:11:54 (GMT +900)\n  lib/ansible/modules/extras: (detached HEAD 1aecfc1e19) last updated 2016/04/20 11:11:55 (GMT +900)\n  config file = \n  configured module search path = Default w/o overrides\n```\n\n#### Jupyter\u3000and\u3000Ansible Server\n-\u3000OS: CentOS6.8\n\n### \u53c2\u8003\uff1aJupyter\u306e\u753b\u9762\n\u3000-\u3000\u30d6\u30e9\u30a6\u30b6\u3088\u308aJupyter(`http://127.0.0.1:8888/`)\u3078\u30a2\u30af\u30bb\u30b9\n<img width=\"769\" alt=\"jupyter1.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/411487a0-f5d3-e933-6acf-acd2883e2d47.png\">\n\n-\u3000\u30d1\u30b9\u30ef\u30fc\u30c9\uff08`pass`\uff09\u3092\u5165\u529b\u3057\u3066\u30ed\u30b0\u30a4\u30f3\n<img width=\"767\" alt=\"jupyter2.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/319ba15e-9896-7d45-d63f-07357c92be05.png\">\n\n-\u3000`New`\u304b\u3089`Python \uff12`\u3092\u9078\u629e\u3057\u3001notebook\u3092\u65b0\u898f\u4f5c\u6210\n<img width=\"765\" alt=\"jupyter3.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/8c2a2f1b-668a-3f78-181c-d3d8378a5d98.png\">\n\n-\u3000 `Markdown`\u306e\u884c\u3068\u3000`Code`\u306e\u884c\uff08bash\u30b3\u30de\u30f3\u30c9\u3067ansible\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8868\u793a\uff09\u3092\u8ffd\u52a0\n<img width=\"765\" alt=\"jupyter4.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/759166f9-4333-0297-fdc5-6cfded32d26d.png\">\n\n-\u3000 `Code`\u306e\u5b9f\u884c\u7d50\u679c\n<img width=\"731\" alt=\"jupyter5.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/117986/26d9417f-e3ba-1a0d-5bf9-8a5d3e49a0cf.png\">\n"}