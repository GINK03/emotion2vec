{"context": "\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\u3053\u306e\u624b\u9806\u306f\u3001JAWS-UG CLI\u5c02\u9580\u652f\u90e8 #58 KMS\u5165\u9580\u3067\u5b9f\u65bd\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\n\u5fc5\u8981\u306a\u6a29\u9650\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nKMS\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nS3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nSTS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nIAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\naws-cli/1.10.56 Python/2.7.10 Linux/4.4.15-25.57.amzn1.x86_64 botocore/1.4.46\n\n\n\n0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n\n\n\n0.5. \u5909\u6570\u306e\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nADMIN_NAME='jawsug-cli-admin'\nADMINS_PROFILE_NAME=${ADMIN_NAME}\n\nUSER_NAME='jawsug-cli-user'\nUSERS_PROFILE_NAME=${USER_NAME}\n\nDATA_FILE='test.txt'\nDOWNLOADED_DATA_FILE='test_downloaded.txt'\nCIPHER_DATA_KEY_FILE_NAME='ciphertext_blob.txt'\n\nAWS_ID=$(aws sts get-caller-identity \\\n    --query Account \\\n    --output text) \\\n    && echo ${AWS_ID}\n\nBUCKET_NAME=\"kms-test-${AWS_ID}\" \\\n    && echo ${BUCKET_NAME}\n\nALIAS=\"alias/cli-handson0815\"\n\nKEY_ID=$(aws kms list-aliases \\\n    --query \"Aliases[?AliasName == \\`${ALIAS}\\`].TargetKeyId\" \\\n    --output text) \\\n    && echo ${KEY_ID}\n\n\n\n1. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u7121\u52b9\u5316\n\n1.1. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": true,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Enabled\",\n        \"CreationDate\": 1470043623.442,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n\n\n\n1.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    KEY_ID: ${KEY_ID}\n\nETX\n\n\n\n\u7d50\u679c\n\n    KEY_ID: ********-****-****-****-************\n\n\n\n\n1.3. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u7121\u52b9\u5316\n\n\u30b3\u30de\u30f3\u30c9\naws kms disable-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n1.4. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": false,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Disabled\",\n        \"CreationDate\": 1470043623.442,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n\n\n\n2. \u30c7\u30fc\u30bf\u306e\u5fa9\u53f7\u5316\u306e\u8a66\u884c\n\n2.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\nCMK\u3092\u7121\u52b9\u5316\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u306b\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${USERS_PROFILE_NAME}\n\n\n\n2.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************QNVA shared-credentials-file\nsecret_key     ****************fTJ+ shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n2.3. \u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\n\u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u304c\u7121\u52b9\u306a\u305f\u3081\u3001\u5fa9\u53f7\u5316\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws kms decrypt \\\n    --ciphertext-blob fileb://${CIPHER_DATA_KEY_FILE_NAME} \\\n    --query Plaintext \\\n    --output text\n\n\n\n\u7d50\u679c\nAn error occurred (DisabledException) when calling the Decrypt operation: arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************ is disabled.\n\n\n\n3. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a66\u884c\n\u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u304c\u7121\u52b9\u306a\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093\u3002\n\n3.1. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\u30b3\u30de\u30f3\u30c9\naws s3 cp s3://${BUCKET_NAME}/${DATA_FILE} ${DOWNLOADED_DATA_FILE}\n\n\n\n\u7d50\u679c\ndownload failed: s3://kms-test-************/test.txt to ./test_downloaded.txt An error occurred (KMS.DisabledException) when calling the GetObject operation: arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************ is disabled.\n\n\n\n4. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u6709\u52b9\u5316\nCMK\u3092\u518d\u5ea6\u6709\u52b9\u5316\u3057\u3001\u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\u3084S3\u304b\u3089\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n4.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${ADMINS_PROFILE_NAME}\n\n\n\n4.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile         jawsug-cli-admin           manual    --profile\naccess_key     ****************2RPA shared-credentials-file\nsecret_key     ****************cbKk shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n4.3. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": false,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Disabled\",\n        \"CreationDate\": 1470540911.677,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n\n\n\n4.4. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    KEY_ID: ${KEY_ID}\n\nETX\n\n\n\n\u7d50\u679c\n\n    KEY_ID: ********-****-****-****-************\n\n\n\n\n4.5. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u6709\u52b9\u5316\n\n\u30b3\u30de\u30f3\u30c9\naws kms enable-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n\n\n\n4.6. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\u53cd\u6620\u306b\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n\n\n\n\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": true,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Enabled\",\n        \"CreationDate\": 1470540911.677,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n\n\n\n5. \u30c7\u30fc\u30bf\u306e\u5fa9\u53f7\u5316\u306e\u8a66\u884c\n\n5.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${USERS_PROFILE_NAME}\n\n\n\n5.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************ES2A shared-credentials-file\nsecret_key     ****************O85Q shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n5.3. \u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\n\n\u30b3\u30de\u30f3\u30c9\naws kms decrypt \\\n    --ciphertext-blob fileb://${CIPHER_DATA_KEY_FILE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"Plaintext\": \"********************************************\",\n    \"KeyId\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\"\n}\n\n\n\n6. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a66\u884c\n\n6.1. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\u30b3\u30de\u30f3\u30c9\naws s3 cp s3://${BUCKET_NAME}/${DATA_FILE} ${DOWNLOADED_DATA_FILE}\n\n\n\n\u7d50\u679c\ndownload: s3://kms-test-************/test.txt to ./test_downloaded.txt\n\n\n\u4ee5\u4e0a\n# \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\n\u3053\u306e\u624b\u9806\u306f\u3001[JAWS-UG CLI\u5c02\u9580\u652f\u90e8 #58 KMS\u5165\u9580](https://manage.doorkeeper.jp/groups/jawsug-cli/events/41911)\u3067\u5b9f\u65bd\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n\n# \u524d\u63d0\u6761\u4ef6\n\n## \u5fc5\u8981\u306a\u6a29\u9650\n\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- KMS\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- S3\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- STS\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- IAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n# 0. \u6e96\u5099\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n## 0.2. \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3057\u305fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092\u8a2d\u5b9a\u305b\u305a\u306b\u5b9f\u884c\u3057\u305f\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:\u7d50\u679c\nName                    Value             Type    Location\n----                    -----             ----    --------\nprofile                <not set>             None    None\naccess_key     ****************RDPA         iam-role\nsecret_key     ****************9GA8         iam-role\nregion           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n## 0.3. \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```text:\u7d50\u679c\naws-cli/1.10.56 Python/2.7.10 Linux/4.4.15-25.57.amzn1.x86_64 botocore/1.4.46\n```\n\n## 0.4. \u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\uff08\u5fc5\u8981\u306b\u5fdc\u3058\u3066\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\nsudo pip install -U awscli\n```\n\n## 0.5. \u5909\u6570\u306e\u8a2d\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nADMIN_NAME='jawsug-cli-admin'\nADMINS_PROFILE_NAME=${ADMIN_NAME}\n\nUSER_NAME='jawsug-cli-user'\nUSERS_PROFILE_NAME=${USER_NAME}\n\nDATA_FILE='test.txt'\nDOWNLOADED_DATA_FILE='test_downloaded.txt'\nCIPHER_DATA_KEY_FILE_NAME='ciphertext_blob.txt'\n\nAWS_ID=$(aws sts get-caller-identity \\\n    --query Account \\\n    --output text) \\\n    && echo ${AWS_ID}\n\nBUCKET_NAME=\"kms-test-${AWS_ID}\" \\\n    && echo ${BUCKET_NAME}\n\nALIAS=\"alias/cli-handson0815\"\n\nKEY_ID=$(aws kms list-aliases \\\n    --query \"Aliases[?AliasName == \\`${ALIAS}\\`].TargetKeyId\" \\\n    --output text) \\\n    && echo ${KEY_ID}\n```\n\n\n# 1. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u7121\u52b9\u5316\n\n## 1.1. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": true,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Enabled\",\n        \"CreationDate\": 1470043623.442,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n```\n\n## 1.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    KEY_ID: ${KEY_ID}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n    KEY_ID: ********-****-****-****-************\n\n```\n\n## 1.3. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u7121\u52b9\u5316\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms disable-key \\\n    --key-id ${KEY_ID}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n## 1.4. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": false,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Disabled\",\n        \"CreationDate\": 1470043623.442,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n```\n\n\n# 2. \u30c7\u30fc\u30bf\u306e\u5fa9\u53f7\u5316\u306e\u8a66\u884c\n\n## 2.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\n\nCMK\u3092\u7121\u52b9\u5316\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u3001\u4e00\u822c\u30e6\u30fc\u30b6\u306b\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306b\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${USERS_PROFILE_NAME}\n```\n\n## 2.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************QNVA shared-credentials-file\nsecret_key     ****************fTJ+ shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n## 2.3. \u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\n\n\u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u304c\u7121\u52b9\u306a\u305f\u3081\u3001\u5fa9\u53f7\u5316\u3067\u304d\u307e\u305b\u3093\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms decrypt \\\n    --ciphertext-blob fileb://${CIPHER_DATA_KEY_FILE_NAME} \\\n    --query Plaintext \\\n    --output text\n```\n\n```text:\u7d50\u679c\nAn error occurred (DisabledException) when calling the Decrypt operation: arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************ is disabled.\n```\n\n\n# 3. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a66\u884c\n\n\u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u304c\u7121\u52b9\u306a\u305f\u3081\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u307e\u305b\u3093\u3002\n\n## 3.1. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws s3 cp s3://${BUCKET_NAME}/${DATA_FILE} ${DOWNLOADED_DATA_FILE}\n```\n\n```text:\u7d50\u679c\ndownload failed: s3://kms-test-************/test.txt to ./test_downloaded.txt An error occurred (KMS.DisabledException) when calling the GetObject operation: arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************ is disabled.\n```\n\n# 4. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u6709\u52b9\u5316\n\nCMK\u3092\u518d\u5ea6\u6709\u52b9\u5316\u3057\u3001\u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\u3084S3\u304b\u3089\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n## 4.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${ADMINS_PROFILE_NAME}\n```\n\n\n## 4.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile         jawsug-cli-admin           manual    --profile\naccess_key     ****************2RPA shared-credentials-file\nsecret_key     ****************cbKk shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n## 4.3. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": false,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Disabled\",\n        \"CreationDate\": 1470540911.677,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n```\n\n## 4.4. \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    KEY_ID: ${KEY_ID}\n\nETX\n```\n\n```text:\u7d50\u679c\n\n    KEY_ID: ********-****-****-****-************\n\n```\n\n## 4.5. \u30ab\u30b9\u30bf\u30de\u30fc\u30de\u30b9\u30bf\u30fc\u30ad\u30fc\u306e\u6709\u52b9\u5316\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms enable-key \\\n    --key-id ${KEY_ID}\n```\n\n```text:\u7d50\u679c\n\uff08\u623b\u308a\u5024\u7121\u3057\uff09\n```\n\n## 4.6. \u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u78ba\u8a8d\n\n\u53cd\u6620\u306b\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308b\u3088\u3046\u3067\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms describe-key \\\n    --key-id ${KEY_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"KeyMetadata\": {\n        \"KeyId\": \"********-****-****-****-************\",\n        \"Description\": \"JAWS-UG CLI 58 KMS at Co-Edo\",\n        \"Enabled\": true,\n        \"KeyUsage\": \"ENCRYPT_DECRYPT\",\n        \"KeyState\": \"Enabled\",\n        \"CreationDate\": 1470540911.677,\n        \"Arn\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\",\n        \"AWSAccountId\": \"************\"\n    }\n}\n```\n\n\n# 5. \u30c7\u30fc\u30bf\u306e\u5fa9\u53f7\u5316\u306e\u8a66\u884c\n\n## 5.1. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u5207\u308a\u66ff\u3048\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_PROFILE=${USERS_PROFILE_NAME}\n```\n\n\n## 5.2. \u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile          jawsug-cli-user           manual    --profile\naccess_key     ****************ES2A shared-credentials-file\nsecret_key     ****************O85Q shared-credentials-file\n    region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n## 5.3. \u30c7\u30fc\u30bf\u30ad\u30fc\u306e\u5fa9\u53f7\u5316\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws kms decrypt \\\n    --ciphertext-blob fileb://${CIPHER_DATA_KEY_FILE_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"Plaintext\": \"********************************************\",\n    \"KeyId\": \"arn:aws:kms:ap-northeast-1:************:key/********-****-****-****-************\"\n}\n```\n\n\n# 6. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u8a66\u884c\n\n## 6.1. S3\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws s3 cp s3://${BUCKET_NAME}/${DATA_FILE} ${DOWNLOADED_DATA_FILE}\n```\n\n```text:\u7d50\u679c\ndownload: s3://kms-test-************/test.txt to ./test_downloaded.txt\n```\n\n\u4ee5\u4e0a\n", "tags": ["AWS", "aws-cli", "kms"]}