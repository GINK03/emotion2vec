{"context": "\nLINE Login v2\u304c\u3082\u306e\u3059\u3054\u304f\u4fbf\u5229\u306a\u306e\u306b\u89e3\u8aac\u3057\u305f\u8a18\u4e8b\u304c\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u3001LINE Messaging API\u3068\u306e\u9023\u643a\u3092\u4f8b\u3068\u3057\u3066\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002(\u3059\u3044\u307e\u305b\u3093\u3001Salesforce\u7248\u306f\u3042\u308a\u307e\u3057\u305f > http://qiita.com/hhayai/items/c7d1d8e30751871aafc7)\n\u3053\u308c\u304c\u4f7f\u3048\u308b\u3068LINE Bot\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u683c\u6bb5\u306b\u5897\u3048\u308b\u306e\u3067Bot Award\u3068\u304b\u72d9\u3063\u3066\u3044\u308b\u4eba\u306b\u306f\u3082\u306e\u3059\u3054\u304f\u4fbf\u5229\u304b\u3068\u3002\nLINE Bot Awards\n\nLINE Login \u30d0\u30fc\u30b8\u30e7\u30f32\u3068Messaging API\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u51fa\u6765\u308b\u3053\u3068\n\nLINE\u306eIn App\u30d6\u30e9\u30a6\u30b6\u3067\u30e6\u30fc\u30b6\u30fc\u306fLINE\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u5229\u7528\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\n2\u5ea6\u76ee\u4ee5\u964d\u306fID\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u7121\u3057\u306e\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306f\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u3082LINE\u306e\u8868\u793a\u540d\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3001Messaging API\u3068\u5171\u901a\u306euserId\u304c\u53d6\u5f97\u3067\u304d\u308b(\u305d\u308c\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u306ePush\u304c\u3067\u304d\u308b)\n\n\n\u6e96\u5099\n\n\nLINE Business Center\u3067LINE Messaging API\u3068LINE Login\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u958b\u8a2d\nMessaging API\u306eChannel Secret\u3068Channel Access Token\u3001LINE Login\u306eChannel ID\u3068Channel Secret\u3092\u63a7\u3048\u3068\u304f\n\n\n\nLINE Messaging API\u306e\u8a2d\u5b9a\u3092\u7d42\u308f\u3089\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u308f\u304b\u3089\u306a\u3044\u65b9\u306f\u30b0\u30b0\u3063\u3066\u3002\nLINE Login\u306eTechnical Configuration\u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5148\u3092\u5165\u529b \u2190 \u5fd8\u308c\u304c\u3061\n\n\n\n\nCSRF\u5bfe\u7b56\u7528\u306baura/session\u3092\u5165\u308c\u3068\u304d\u307e\u3059\u3002\n\ncomposer require composer require aura/session\n\n\nindex.php(Bot\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8)\n\nindex.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient(getenv('CHANNEL_ACCESS_TOKEN'));\n$bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => getenv('CHANNEL_SECRET')]);\n\n$signature = $_SERVER['HTTP_' . \\LINE\\LINEBot\\Constant\\HTTPHeader::LINE_SIGNATURE];\ntry {\n  $events = $bot->parseEventRequest(file_get_contents('php://input'), $signature);\n} catch(\\LINE\\LINEBot\\Exception\\InvalidSignatureException $e) {\n  error_log('parseEventRequest failed. InvalidSignatureException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownEventTypeException $e) {\n  error_log('parseEventRequest failed. UnknownEventTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownMessageTypeException $e) {\n  error_log('parseEventRequest failed. UnknownMessageTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\InvalidEventRequestException $e) {\n  error_log('parseEventRequest failed. InvalidEventRequestException => '.var_export($e, true));\n}\n\nforeach ($events as $event) {\n  $bot->replyText($event->getReplyToken(), \"https://\" . $_SERVER[\"HTTP_HOST\"] .  \"/line_login.php\");\n}\n\n?>\n\n\n\u30a4\u30d9\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u7528\u306eWeb\u30b5\u30a4\u30c8\u3078\u306e\u30ea\u30f3\u30af\u3092\u8fd4\u4fe1\u3059\u308b\u3060\u3051\u3002\n\nline_login.php(\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308bWeb\u30da\u30fc\u30b8)\n\nline_login.php\n<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' lang='ja' xml:lang='ja'>\n<head>\n<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>\n<title>LINE Login v2 Sample</title>\n</head>\n<body>\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$session_factory = new \\Aura\\Session\\SessionFactory;\n$session = $session_factory->newInstance($_COOKIE);\n$segment = $session->getSegment('Vendor\\Package\\ClassName');\n\n$csrf_value = $session->getCsrfToken()->getValue();\n\n$callback = urlencode('https://' . $_SERVER['HTTP_HOST']  . '/line_callback.php');\n$url = 'https://access.line.me/dialog/oauth/weblogin?response_type=code&client_id=' . getenv('LOGIN_CHANNEL_ID') . '&redirect_uri=' . $callback . '&state=' . $csrf_value;\necho '<a href=' . $url . '><button class=\"contact\">LINE Login v2 Sample</button></a>';\n\n?>\n</body>\n</html>\n\n\n\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308b\u7528\u306e\u30da\u30fc\u30b8\u3002\u3053\u306e\u30da\u30fc\u30b8\u8868\u793a\u305b\u305a\u3044\u304d\u306a\u308a\u30ed\u30b0\u30a4\u30f3API\u53e9\u304f\u306e\u3082\u53ef\u80fd\u3002\n\nline_callback.php(\u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u98db\u3070\u3055\u308c\u308b\u30da\u30fc\u30b8)\n\nline_login.php\n<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' lang='ja' xml:lang='ja'>\n<head>\n<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>\n<title>LINE Login v2 Sample Callback</title>\n</head>\n<body>\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$unsafe = $_SERVER['REQUEST_METHOD'] == 'POST'\n       || $_SERVER['REQUEST_METHOD'] == 'PUT'\n       || $_SERVER['REQUEST_METHOD'] == 'DELETE';\n\n$session_factory = new \\Aura\\Session\\SessionFactory;\n$session = $session_factory->newInstance($_COOKIE);\n$csrf_value = $_GET['state'];\n$csrf_token = $session->getCsrfToken();\nif ($unsafe || !$csrf_token->isValid($csrf_value)) {\n  return;\n}\n\n$callback = 'https://' . $_SERVER['HTTP_HOST']  . '/line_callback.php';\nif (isset($_GET['code'])) {\n  $url = 'https://api.line.me/v2/oauth/accessToken';\n  $data = array(\n    'grant_type' => 'authorization_code',\n    'client_id' => getenv('LOGIN_CHANNEL_ID'),\n    'client_secret' => getenv('LOGIN_CHANNEL_SECRET'),\n    'code' => $_GET['code'],\n    'redirect_uri' => $callback\n  );\n  $data = http_build_query($data, '', '&');\n  $header = array(\n    'Content-Type: application/x-www-form-urlencoded'\n  );\n  $context = array(\n    'http' => array(\n      'method'  => 'POST',\n      'header'  => implode('\\r\\n', $header),\n      'content' => $data\n    )\n  );\n  $resultString = file_get_contents($url, false, stream_context_create($context));\n  $result = json_decode($resultString, true);\n\n  if(isset($result['access_token'])) {\n    $url = 'https://api.line.me/v2/profile';\n    $context = array(\n      'http' => array(\n      'method'  => 'GET',\n      'header'  => 'Authorization: Bearer '. $result['access_token']\n      )\n    );\n    $profileString = file_get_contents($url, false, stream_context_create($context));\n    $profile = json_decode($profileString, true);\n    echo '<img src=\"' . $profile[\"pictureUrl\"] . '\" />';\n    echo '<p>displayName : ' . $profile[\"displayName\"] . '</p>';\n    echo '<p>userId : ' . $profile[\"userId\"] . '</p>';\n\n    $httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient(getenv('CHANNEL_ACCESS_TOKEN'));\n    $bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => getenv('CHANNEL_SECRET')]);\n    $bot->pushMessage($profile[\"userId\"], new \\LINE\\LINEBot\\MessageBuilder\\TextMessageBuilder('Logged in via LINE Login v2.'));\n  }\n}\nelse {\n  echo '<p>Login Failed.</p>';\n}\n?>\n</body>\n</html>\n\n\n\n\u7d50\u679c\n\n\u53cb\u9054\u8ffd\u52a0\u3059\u308b\u3068\u30ea\u30f3\u30af\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u3002\n\n\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3059\u308b\u3068\u30ed\u30b0\u30a4\u30f3\u3092\u8a66\u307f\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3053\u3068\u306a\u3044Login\u5148\u306e\u5834\u5408\u306f\u8a8d\u8a3c\u753b\u9762\u304c\u958b\u304d\u307e\u3059\u3002\u4e00\u5ea6\u540c\u610f\u3059\u308b\u3068\u6b21\u56de\u304b\u3089\u306f\u8868\u793a\u3055\u308c\u305a\u3001\u81ea\u52d5\u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u5b8c\u4e86\u3002Web\u4e0a\u3067LINE\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u8868\u793a\u540d\u3084\u30b5\u30e0\u30cd\u30a4\u30eb\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\u3001\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u3053\u306e\u30e6\u30fc\u30b6\u30fcID\u306fLINE Messaging API\u3068\u5171\u901a\u306a\u306e\u3067\u3001Push API\u3092\u5229\u7528\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u3002Bot\u3068\u306e\u30c8\u30fc\u30af\u753b\u9762\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\nLINE Login\u3092\u4e0a\u624b\u304f\u4f7f\u3046\u3068Bot\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u8003\u3048\u308b\u6642\u3001\u30c8\u30fc\u30af\u753b\u9762\u4e0a\u3067\u306e\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9650\u5b9a\u3055\u308c\u305a\u5fc5\u8981\u306b\u5fdc\u3058\u3066Web\u306b\u9077\u79fb\u3055\u305b\u308c\u3070\u3044\u3044\u306e\u3067\u958b\u767a\u8005\u306b\u3082\u30e6\u30fc\u30b6\u30fc\u306b\u3082\u3068\u3066\u3082\u512a\u3057\u3044\u3067\u3059\u306d\u3002\n\u8a2d\u5b9a\u753b\u9762\u3068\u304b\u306fWeb\u306b\u98db\u3070\u3059\u306e\u304c\u5f53\u305f\u308a\u524d\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n<img src=\"https://cl.ly/2z0J3r1X003U/IMG_7114.PNG\" width=50%>\n\nLINE Login v2\u304c\u3082\u306e\u3059\u3054\u304f\u4fbf\u5229\u306a\u306e\u306b\u89e3\u8aac\u3057\u305f\u8a18\u4e8b\u304c\u898b\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u3001LINE Messaging API\u3068\u306e\u9023\u643a\u3092\u4f8b\u3068\u3057\u3066\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002(\u3059\u3044\u307e\u305b\u3093\u3001Salesforce\u7248\u306f\u3042\u308a\u307e\u3057\u305f > http://qiita.com/hhayai/items/c7d1d8e30751871aafc7)\n\u3053\u308c\u304c\u4f7f\u3048\u308b\u3068LINE Bot\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u683c\u6bb5\u306b\u5897\u3048\u308b\u306e\u3067Bot Award\u3068\u304b\u72d9\u3063\u3066\u3044\u308b\u4eba\u306b\u306f\u3082\u306e\u3059\u3054\u304f\u4fbf\u5229\u304b\u3068\u3002\n\n[LINE Bot Awards](https://botawards.line.me/ja/)\n\n# LINE Login \u30d0\u30fc\u30b8\u30e7\u30f32\u3068Messaging API\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u51fa\u6765\u308b\u3053\u3068\n\n+ LINE\u306eIn App\u30d6\u30e9\u30a6\u30b6\u3067\u30e6\u30fc\u30b6\u30fc\u306fLINE\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u5229\u7528\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\n+ 2\u5ea6\u76ee\u4ee5\u964d\u306fID\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u7121\u3057\u306e\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\n+ \u30ed\u30b0\u30a4\u30f3\u5f8c\u306f\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u3082LINE\u306e\u8868\u793a\u540d\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u3001Messaging API\u3068\u5171\u901a\u306euserId\u304c\u53d6\u5f97\u3067\u304d\u308b(\u305d\u308c\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u306ePush\u304c\u3067\u304d\u308b)\n\n# \u6e96\u5099\n+ [LINE Business Center](https://business.line.me/ja/)\u3067LINE Messaging API\u3068LINE Login\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u958b\u8a2d\n+ Messaging API\u306eChannel Secret\u3068Channel Access Token\u3001LINE Login\u306eChannel ID\u3068Channel Secret\u3092\u63a7\u3048\u3068\u304f\n\n<img src=\"https://cl.ly/0E1x2c2v3t3y/login_bc.png\" width=50%>\n\n+ LINE Messaging API\u306e\u8a2d\u5b9a\u3092\u7d42\u308f\u3089\u305b\u3066\u304a\u304d\u307e\u3059\u3002\u308f\u304b\u3089\u306a\u3044\u65b9\u306f\u30b0\u30b0\u3063\u3066\u3002\n+ LINE Login\u306eTechnical Configuration\u306b\u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5148\u3092\u5165\u529b **\u2190 \u5fd8\u308c\u304c\u3061**\n\n<img src=\"https://cl.ly/421x3M2g0J1y/login_technical.png\" width=50%>\n\n+ CSRF\u5bfe\u7b56\u7528\u306baura/session\u3092\u5165\u308c\u3068\u304d\u307e\u3059\u3002\n\n```shell-session\ncomposer require composer require aura/session\n```\n\n# index.php(Bot\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u53d6\u308b\u30b9\u30af\u30ea\u30d7\u30c8)\n\n```php:index.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient(getenv('CHANNEL_ACCESS_TOKEN'));\n$bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => getenv('CHANNEL_SECRET')]);\n\n$signature = $_SERVER['HTTP_' . \\LINE\\LINEBot\\Constant\\HTTPHeader::LINE_SIGNATURE];\ntry {\n  $events = $bot->parseEventRequest(file_get_contents('php://input'), $signature);\n} catch(\\LINE\\LINEBot\\Exception\\InvalidSignatureException $e) {\n  error_log('parseEventRequest failed. InvalidSignatureException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownEventTypeException $e) {\n  error_log('parseEventRequest failed. UnknownEventTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\UnknownMessageTypeException $e) {\n  error_log('parseEventRequest failed. UnknownMessageTypeException => '.var_export($e, true));\n} catch(\\LINE\\LINEBot\\Exception\\InvalidEventRequestException $e) {\n  error_log('parseEventRequest failed. InvalidEventRequestException => '.var_export($e, true));\n}\n\nforeach ($events as $event) {\n  $bot->replyText($event->getReplyToken(), \"https://\" . $_SERVER[\"HTTP_HOST\"] .  \"/line_login.php\");\n}\n\n?>\n```\n\n\u30a4\u30d9\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u7528\u306eWeb\u30b5\u30a4\u30c8\u3078\u306e\u30ea\u30f3\u30af\u3092\u8fd4\u4fe1\u3059\u308b\u3060\u3051\u3002\n\n# line_login.php(\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308bWeb\u30da\u30fc\u30b8)\n```php:line_login.php\n<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' lang='ja' xml:lang='ja'>\n<head>\n<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>\n<title>LINE Login v2 Sample</title>\n</head>\n<body>\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$session_factory = new \\Aura\\Session\\SessionFactory;\n$session = $session_factory->newInstance($_COOKIE);\n$segment = $session->getSegment('Vendor\\Package\\ClassName');\n\n$csrf_value = $session->getCsrfToken()->getValue();\n\n$callback = urlencode('https://' . $_SERVER['HTTP_HOST']  . '/line_callback.php');\n$url = 'https://access.line.me/dialog/oauth/weblogin?response_type=code&client_id=' . getenv('LOGIN_CHANNEL_ID') . '&redirect_uri=' . $callback . '&state=' . $csrf_value;\necho '<a href=' . $url . '><button class=\"contact\">LINE Login v2 Sample</button></a>';\n\n?>\n</body>\n</html>\n```\n\n\u30ed\u30b0\u30a4\u30f3\u30dc\u30bf\u30f3\u3092\u8868\u793a\u3059\u308b\u7528\u306e\u30da\u30fc\u30b8\u3002\u3053\u306e\u30da\u30fc\u30b8\u8868\u793a\u305b\u305a\u3044\u304d\u306a\u308a\u30ed\u30b0\u30a4\u30f3API\u53e9\u304f\u306e\u3082\u53ef\u80fd\u3002\n\n# line_callback.php(\u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u98db\u3070\u3055\u308c\u308b\u30da\u30fc\u30b8)\n```php:line_login.php\n<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>\n<html xmlns='http://www.w3.org/1999/xhtml' lang='ja' xml:lang='ja'>\n<head>\n<meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>\n<title>LINE Login v2 Sample Callback</title>\n</head>\n<body>\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$unsafe = $_SERVER['REQUEST_METHOD'] == 'POST'\n       || $_SERVER['REQUEST_METHOD'] == 'PUT'\n       || $_SERVER['REQUEST_METHOD'] == 'DELETE';\n\n$session_factory = new \\Aura\\Session\\SessionFactory;\n$session = $session_factory->newInstance($_COOKIE);\n$csrf_value = $_GET['state'];\n$csrf_token = $session->getCsrfToken();\nif ($unsafe || !$csrf_token->isValid($csrf_value)) {\n  return;\n}\n\n$callback = 'https://' . $_SERVER['HTTP_HOST']  . '/line_callback.php';\nif (isset($_GET['code'])) {\n  $url = 'https://api.line.me/v2/oauth/accessToken';\n  $data = array(\n    'grant_type' => 'authorization_code',\n    'client_id' => getenv('LOGIN_CHANNEL_ID'),\n    'client_secret' => getenv('LOGIN_CHANNEL_SECRET'),\n    'code' => $_GET['code'],\n    'redirect_uri' => $callback\n  );\n  $data = http_build_query($data, '', '&');\n  $header = array(\n    'Content-Type: application/x-www-form-urlencoded'\n  );\n  $context = array(\n    'http' => array(\n      'method'  => 'POST',\n      'header'  => implode('\\r\\n', $header),\n      'content' => $data\n    )\n  );\n  $resultString = file_get_contents($url, false, stream_context_create($context));\n  $result = json_decode($resultString, true);\n\n  if(isset($result['access_token'])) {\n    $url = 'https://api.line.me/v2/profile';\n    $context = array(\n      'http' => array(\n      'method'  => 'GET',\n      'header'  => 'Authorization: Bearer '. $result['access_token']\n      )\n    );\n    $profileString = file_get_contents($url, false, stream_context_create($context));\n    $profile = json_decode($profileString, true);\n    echo '<img src=\"' . $profile[\"pictureUrl\"] . '\" />';\n    echo '<p>displayName : ' . $profile[\"displayName\"] . '</p>';\n    echo '<p>userId : ' . $profile[\"userId\"] . '</p>';\n\n    $httpClient = new \\LINE\\LINEBot\\HTTPClient\\CurlHTTPClient(getenv('CHANNEL_ACCESS_TOKEN'));\n    $bot = new \\LINE\\LINEBot($httpClient, ['channelSecret' => getenv('CHANNEL_SECRET')]);\n    $bot->pushMessage($profile[\"userId\"], new \\LINE\\LINEBot\\MessageBuilder\\TextMessageBuilder('Logged in via LINE Login v2.'));\n  }\n}\nelse {\n  echo '<p>Login Failed.</p>';\n}\n?>\n</body>\n</html>\n```\n\n# \u7d50\u679c\n\n<img src=\"https://cl.ly/0o3w1A2L3C0F/IMG_7112.PNG\" width=50%>\n\n\u53cb\u9054\u8ffd\u52a0\u3059\u308b\u3068\u30ea\u30f3\u30af\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\n<img src=\"https://cl.ly/052i1s1M2B0F/IMG_7113.PNG\" width=50%>\n\n\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u3002\n\n<img src=\"https://cl.ly/2z0J3r1X003U/IMG_7114.PNG\" width=50%>\n\n\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3059\u308b\u3068\u30ed\u30b0\u30a4\u30f3\u3092\u8a66\u307f\u307e\u3059\u3002\n\n<img src=\"https://cl.ly/2g3w1K1o470p/IMG_7115.PNG\" width=50%>\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3053\u3068\u306a\u3044Login\u5148\u306e\u5834\u5408\u306f\u8a8d\u8a3c\u753b\u9762\u304c\u958b\u304d\u307e\u3059\u3002\u4e00\u5ea6\u540c\u610f\u3059\u308b\u3068\u6b21\u56de\u304b\u3089\u306f\u8868\u793a\u3055\u308c\u305a\u3001\u81ea\u52d5\u3067\u30ed\u30b0\u30a4\u30f3\u3002\n\n<img src=\"https://cl.ly/1C2R0D383z21/IMG_7118.png\" width=50%>\n\n\u30ed\u30b0\u30a4\u30f3\u5b8c\u4e86\u3002Web\u4e0a\u3067LINE\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u8868\u793a\u540d\u3084\u30b5\u30e0\u30cd\u30a4\u30eb\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\u3001\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u3053\u306e\u30e6\u30fc\u30b6\u30fcID\u306fLINE Messaging API\u3068\u5171\u901a\u306a\u306e\u3067\u3001Push API\u3092\u5229\u7528\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n\n<img src=\"https://cl.ly/1v2f123B3t2b/IMG_7117.PNG\" width=50%>\n\n\u3053\u3093\u306a\u611f\u3058\u3002Bot\u3068\u306e\u30c8\u30fc\u30af\u753b\u9762\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\nLINE Login\u3092\u4e0a\u624b\u304f\u4f7f\u3046\u3068Bot\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u8003\u3048\u308b\u6642\u3001\u30c8\u30fc\u30af\u753b\u9762\u4e0a\u3067\u306e\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9650\u5b9a\u3055\u308c\u305a\u5fc5\u8981\u306b\u5fdc\u3058\u3066Web\u306b\u9077\u79fb\u3055\u305b\u308c\u3070\u3044\u3044\u306e\u3067\u958b\u767a\u8005\u306b\u3082\u30e6\u30fc\u30b6\u30fc\u306b\u3082\u3068\u3066\u3082\u512a\u3057\u3044\u3067\u3059\u306d\u3002\n\n\u8a2d\u5b9a\u753b\u9762\u3068\u304b\u306fWeb\u306b\u98db\u3070\u3059\u306e\u304c\u5f53\u305f\u308a\u524d\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n", "tags": ["linebot", "LINEmessagingAPI", "Line", "PHP", "LineLogin"]}