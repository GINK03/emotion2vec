{"context": " More than 1 year has passed since last update.AWS CLI\u3092\u5229\u7528\u3057\u3066\u3001\u30d5\u30eb\u30a2\u30af\u30bb\u30b9(Administrator)\u304c\u53ef\u80fd\u306aIAM\u30ed\u30fc\u30eb\u3092IAM\u30e6\u30fc\u30b6\u306b\u4ed8\u4e0e\u3057\u3066\u307f\u307e\u3059\u3002\n(AssumeRole\u6a29\u9650\u306e\u3042\u308b\u30e6\u30fc\u30b6\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002)\n\n\u524d\u63d0\u6761\u4ef6\n\nAssumeRole\u3078\u306e\u6a29\u9650\n\nAssumeRole\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.9.15\n\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\n      aws-cli/1.9.15 Python/2.7.5 Darwin/13.4.0 botocore/1.3.15\n\n\n\n0. \u6e96\u5099\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\nexport AWS_DEFAULT_PROFILE='taro-prjZ-mbp13'\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c(\u4f8b)\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile          taro-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. IAM\u30ed\u30fc\u30eb\u540d\u306e\u6307\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nIAM_ROLE_NAME='AdministratorforAssumeRole'\n\n\nIAM\u30ed\u30fc\u30eb\u306eARN\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nIAM_ROLE_ARN=$(\\\n        aws iam get-role \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --query 'Role.Arn' \\\n          --output text \\\n      ) \\\n        && echo ${IAM_ROLE_ARN}\n\n\n\n1.2. \u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9593\u306e\u6307\u5b9a\n15-60\u306e\u9593\u306e\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nEXPIRATION_MINITES='60'\n\n\n\n2. \u30c8\u30fc\u30af\u30f3\u306e\u767a\u884c\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nEXPIRATION_SECONDS=$(expr 60 \\* ${EXPIRATION_MINITES})\nFILE_ASSUME_ROLE_OUTPUT=\"${IAM_ROLE_NAME}-output.json\"\nROLE_SESSION_NAME=\"${IAM_ROLE_NAME}-session\"\n\n\nAssumeRoleToken\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n          IAM_ROLE_ARN:            ${IAM_ROLE_ARN}\n          EXPIRATION_SECONDS:      ${EXPIRATION_SECONDS}\n          FILE_ASSUME_ROLE_OUTPUT: ${FILE_ASSUME_ROLE_OUTPUT}\n          ROLE_SESSION_NAME:       ${ROLE_SESSION_NAME}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws sts assume-role \\\n        --role-arn ${IAM_ROLE_ARN} \\\n        --role-session-name ${ROLE_SESSION_NAME} \\\n        --duration-seconds ${EXPIRATION_SECONDS} \\\n        > ${FILE_ASSUME_ROLE_OUTPUT} \\\n        && cat ${FILE_ASSUME_ROLE_OUTPUT}\n\n\n\u30c8\u30fc\u30af\u30f3\u767a\u884c\u6642\u523b\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\ndate\n\n\n\n3. \u30c8\u30fc\u30af\u30f3\u306e\u5229\u7528\n\n3.1. \u30c8\u30fc\u30af\u30f3\u60c5\u5831\u306e\u62bd\u51fa\n\u3053\u3053\u3067\u306f\u74b0\u5883\u5909\u6570\u3092\u5229\u7528\u3057\u3066AssumeRoleToken\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nFILE_ASSUME_ROLE_ENV=\"${IAM_ROLE_NAME}.env\"\n\n\n\n\u30b3\u30de\u30f3\u30c9\ncat ${FILE_ASSUME_ROLE_OUTPUT} | \\\nawk '\n        $1 == \"\\\"AccessKeyId\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_ACCESS_KEY_ID=\"$2\n        }\n        $1 == \"\\\"SecretAccessKey\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_SECRET_ACCESS_KEY=\"$2\n        }\n        $1 == \"\\\"SessionToken\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_SESSION_TOKEN=\"$2\n        }\n        ' \\\n      > ${FILE_ASSUME_ROLE_ENV} \\\n        && cat ${FILE_ASSUME_ROLE_ENV}\n\n\n\n3.2. \u4e00\u6642\u8a8d\u8a3c\u306e\u5229\u7528\n\n\u30b3\u30de\u30f3\u30c9\nunset AWS_DEFAULT_PROFILE\nsource ${FILE_ASSUME_ROLE_ENV}\n\n\n\n4. (\u4efb\u610f) \u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30ed\u30fc\u30eb\u5207\u308a\u66ff\u3048\n\n\u30e1\u30cb\u30e5\u30fc > \u30a2\u30ab\u30a6\u30f3\u30c8\u540d > \u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048\n\u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048\n\u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048(\u753b\u9762)\n\n\u30a2\u30ab\u30a6\u30f3\u30c8: AWS ID\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u53c2\u8003(\u30b3\u30de\u30f3\u30c9\u3067\u306eAWS-ID\u306e\u53d6\u5f97\u65b9\u6cd5)\nAWS_ID=$( \\\n        aws iam get-role \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --query 'Role.Arn' \\\n          --output text | \\\n          sed 's/^.*:://' | \\\n          sed 's/:.*$//' \\\n      ) \\\n        && echo ${AWS_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\nXXXXXXXXXXXX\n\n\n\u30ed\u30fc\u30eb: \u4ee5\u4e0b\u306e\u30ed\u30fc\u30eb\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n     AdministratorforAssumeRole\n\n\n\u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048(\u30dc\u30bf\u30f3)\u3092\u62bc\u3059\u3002\n\n\n\u53c2\u8003. \u6709\u52b9\u671f\u9593\u7d42\u4e86\u5f8c\n\n\u30b3\u30de\u30f3\u30c9\nunset AWS_ACCESS_KEY_ID\nunset AWS_SECRET_ACCESS_KEY\nunset AWS_SESSION_TOKEN\n\n\n\n\u5b8c\u4e86\nAWS CLI\u3092\u5229\u7528\u3057\u3066\u3001\u30d5\u30eb\u30a2\u30af\u30bb\u30b9(Administrator)\u304c\u53ef\u80fd\u306aIAM\u30ed\u30fc\u30eb\u3092IAM\u30e6\u30fc\u30b6\u306b\u4ed8\u4e0e\u3057\u3066\u307f\u307e\u3059\u3002\n\n(AssumeRole\u6a29\u9650\u306e\u3042\u308b\u30e6\u30fc\u30b6\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002)\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n\nAssumeRole\u3078\u306e\u6a29\u9650\n------------------\n\n* AssumeRole\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n-------------------\n\n* \u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n  * AWS CLI 1.9.15\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws --version\n```\n\n```text:\u7d50\u679c(\u4f8b):\n      aws-cli/1.9.15 Python/2.7.5 Darwin/13.4.0 botocore/1.3.15\n```\n\n\n0. \u6e96\u5099\n=======\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\n----------\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3068\u30ea\u30fc\u30b8\u30e7\u30f3\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\nexport AWS_DEFAULT_PROFILE='taro-prjZ-mbp13'\n```\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\naws configure list\n```\n\n```text:\u7d50\u679c(\u4f8b):\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile          taro-prjZ-mbp13              env    AWS_DEFAULT_PROFILE\n      access_key     ****************LOAQ shared-credentials-file\n      secret_key     ****************I1O1 shared-credentials-file\n          region           ap-northeast-1              env    AWS_DEFAULT_REGION\n```\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n===========\n\n\n1.1. IAM\u30ed\u30fc\u30eb\u540d\u306e\u6307\u5b9a\n----------------------\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nIAM_ROLE_NAME='AdministratorforAssumeRole'\n```\n\nIAM\u30ed\u30fc\u30eb\u306eARN\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nIAM_ROLE_ARN=$(\\\n        aws iam get-role \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --query 'Role.Arn' \\\n          --output text \\\n      ) \\\n        && echo ${IAM_ROLE_ARN}\n```\n\n\n1.2. \u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9593\u306e\u6307\u5b9a\n-----------------------------\n\n15-60\u306e\u9593\u306e\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nEXPIRATION_MINITES='60'\n```\n\n\n2. \u30c8\u30fc\u30af\u30f3\u306e\u767a\u884c\n=================\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nEXPIRATION_SECONDS=$(expr 60 \\* ${EXPIRATION_MINITES})\nFILE_ASSUME_ROLE_OUTPUT=\"${IAM_ROLE_NAME}-output.json\"\nROLE_SESSION_NAME=\"${IAM_ROLE_NAME}-session\"\n```\n\nAssumeRoleToken\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d:\ncat << ETX\n\n          IAM_ROLE_ARN:            ${IAM_ROLE_ARN}\n          EXPIRATION_SECONDS:      ${EXPIRATION_SECONDS}\n          FILE_ASSUME_ROLE_OUTPUT: ${FILE_ASSUME_ROLE_OUTPUT}\n          ROLE_SESSION_NAME:       ${ROLE_SESSION_NAME}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\naws sts assume-role \\\n        --role-arn ${IAM_ROLE_ARN} \\\n        --role-session-name ${ROLE_SESSION_NAME} \\\n        --duration-seconds ${EXPIRATION_SECONDS} \\\n        > ${FILE_ASSUME_ROLE_OUTPUT} \\\n        && cat ${FILE_ASSUME_ROLE_OUTPUT}\n```\n\n\u30c8\u30fc\u30af\u30f3\u767a\u884c\u6642\u523b\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ndate\n```\n\n\n3. \u30c8\u30fc\u30af\u30f3\u306e\u5229\u7528\n=================\n\n\n3.1. \u30c8\u30fc\u30af\u30f3\u60c5\u5831\u306e\u62bd\u51fa\n-----------------------\n\n\u3053\u3053\u3067\u306f\u74b0\u5883\u5909\u6570\u3092\u5229\u7528\u3057\u3066AssumeRoleToken\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a:\nFILE_ASSUME_ROLE_ENV=\"${IAM_ROLE_NAME}.env\"\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9:\ncat ${FILE_ASSUME_ROLE_OUTPUT} | \\\nawk '\n        $1 == \"\\\"AccessKeyId\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_ACCESS_KEY_ID=\"$2\n        }\n        $1 == \"\\\"SecretAccessKey\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_SECRET_ACCESS_KEY=\"$2\n        }\n        $1 == \"\\\"SessionToken\\\":\" {\n          gsub(/\\\"/,\"\"); gsub(/,/,\"\"); print \"export AWS_SESSION_TOKEN=\"$2\n        }\n        ' \\\n      > ${FILE_ASSUME_ROLE_ENV} \\\n        && cat ${FILE_ASSUME_ROLE_ENV}\n```\n\n\n3.2. \u4e00\u6642\u8a8d\u8a3c\u306e\u5229\u7528\n-------------------\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nunset AWS_DEFAULT_PROFILE\nsource ${FILE_ASSUME_ROLE_ENV}\n```\n\n\n\n4. (\u4efb\u610f) \u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u306e\u30ed\u30fc\u30eb\u5207\u308a\u66ff\u3048\n====================================================\n\n1. \u30e1\u30cb\u30e5\u30fc > \u30a2\u30ab\u30a6\u30f3\u30c8\u540d > \u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048\n\n2. [\u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048](\u30dc\u30bf\u30f3)\n\n3. \u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048(\u753b\u9762)\n\n  \u30a2\u30ab\u30a6\u30f3\u30c8: AWS ID\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```bash:\u53c2\u8003(\u30b3\u30de\u30f3\u30c9\u3067\u306eAWS-ID\u306e\u53d6\u5f97\u65b9\u6cd5)\nAWS_ID=$( \\\n        aws iam get-role \\\n          --role-name ${IAM_ROLE_NAME} \\\n          --query 'Role.Arn' \\\n          --output text | \\\n          sed 's/^.*:://' | \\\n          sed 's/:.*$//' \\\n      ) \\\n        && echo ${AWS_ID}\n```\n\n```text:\u7d50\u679c(\u4f8b):\nXXXXXXXXXXXX\n```\n\n  \u30ed\u30fc\u30eb: \u4ee5\u4e0b\u306e\u30ed\u30fc\u30eb\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n```text:\n     AdministratorforAssumeRole\n```\n\n  * \u30ed\u30fc\u30eb\u306e\u5207\u308a\u66ff\u3048(\u30dc\u30bf\u30f3)\u3092\u62bc\u3059\u3002\n\n\n\n\u53c2\u8003. \u6709\u52b9\u671f\u9593\u7d42\u4e86\u5f8c\n=================\n\n```bash:\u30b3\u30de\u30f3\u30c9:\nunset AWS_ACCESS_KEY_ID\nunset AWS_SECRET_ACCESS_KEY\nunset AWS_SESSION_TOKEN\n```\n\n\n\u5b8c\u4e86\n====\n", "tags": ["AWS", "aws-cli", "STS"]}