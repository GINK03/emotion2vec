{"context": "Node.js\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3042\u308bHapi.js\u3067LINE Bot\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3060\u3051\u3067\u8a66\u305b\u308b\u306e\u3067SSL\u3068\u304b\u30b5\u30fc\u30d0\u30fc\u7528\u610f\u3044\u3089\u306a\u3044\u3067\u3059\u3002\nGo\u3068localtunnel\u3067Line Messaging API\u3092\u4f7f\u3063\u3066\u30aa\u30a6\u30e0\u8fd4\u3057LINE Bot\u3092\u8a66\u3059 #golangjp\u3067\u66f8\u3044\u305flocaltunnel\u3092\u4f7f\u3063\u3066\u307e\u3059\u3002\n\nLINE Messaging API\u306e\u5229\u7528\u6e96\u5099\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\nhttps://devdocs.line.me/ja/\n\n\n\u5fc5\u8981\u306a\u5024\u3092\u53d6\u5f97\nLINE Developers\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u307e\u3059\u3002\n\n\nChannel Secret\nChannel Access Token\n\n\u306e\u4e8c\u3064\u306e\u5024\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nBot\u306eWebhook\u5229\u7528\u3092\u8a31\u53ef\nLINE@ MANAGER\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u307e\u3059\u3002\n\nBot\u306eWebhook\u5229\u7528\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u4ed6\u306e\u81ea\u52d5\u5fdc\u7b54\u30e1\u30c3\u30bb\u30fc\u30b8\u306a\u3069\u306f\u30aa\u30d5\u306b\u3057\u305f\u65b9\u304c\u958b\u767a\u6642\u306e\u30a6\u30b6\u3055\u306f\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n(\u30b9\u30af\u30b7\u30e7\u3067)\n\n\u30b3\u30fc\u30c9\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n$ node -v\nv7.0.0\n\n\n\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ npm i --save hapi superagent\n\n\n\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\n\napp.js\n\n'use strict';\n\nconst Hapi = require('hapi');\nconst request = require('superagent');\nconst crypto = require('crypto');\n\nconst REPLY_URL = 'https://api.line.me/v2/bot/message/reply'; //\u30ea\u30d7\u30e9\u30a4\u7528\nconst CH_SECRET = 'xxxxxxxx'; //Channel Secret\u3092\u6307\u5b9a\nconst CH_ACCESS_TOKEN = 'xxxxxx'; //Channel Access Token\u3092\u6307\u5b9a\nconst SIGNATURE = crypto.createHmac('sha256', CH_SECRET);\n\n//\nlet client = (replyToken, SendMessageObject) => {\n    request\n        .post(REPLY_URL)\n        .send({ replyToken: replyToken, messages: SendMessageObject })\n        .set('X-Line-Signature', SIGNATURE)\n        .set('Content-Type', 'application/json')\n        .set('Authorization', `Bearer ${CH_ACCESS_TOKEN}`)\n        .end(function(err, res){\n            console.log(res.body);\n        });\n};\n\nconst server = new Hapi.Server();\nserver.connection({\n    host: 'localhost',\n    port: 3000\n});\n\nserver.route({\n    method: 'POST',\n    path:'/callback',\n    handler: (request, reply) => {\n        console.log(request.payload.events);\n        console.log('-------\\n');\n\n        let WebhookEventObject = request.payload.events[0];\n\n        if(WebhookEventObject.type === 'message'){\n            let SendMessageObject;\n            if(WebhookEventObject.message.type === 'text'){\n                SendMessageObject = [{\n                    type: 'text',\n                    text: WebhookEventObject.message.text\n                }];\n            }\n\n            client(WebhookEventObject.replyToken, SendMessageObject);\n        }\n        return reply('success').code(200);\n    }\n});\n\n// Start the server\nserver.start((err) => {\n    if (err) throw err;\n    console.log('Server running at:', server.info.uri);\n});\n\n\n\n\n\u8a66\u3059\n\n\u30a2\u30d7\u30ea\u3092\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u8d77\u52d5\n\n$ node app.js\n\n\nlocaltunnel\u3092\u8d77\u52d5\u3055\u305b\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n$ lt --port 3000\nyour url is: https://jyyhbdxhwp.localtunnel.me\n\n\n\u8a2d\u5b9a\u753b\u9762\u304b\u3089Webhook URL\u306blocaltunnel\u304c\u751f\u6210\u3057\u305fURL\u3092\u8a2d\u5b9a\u3059\u308b\n\u5b9f\u969b\u306b\u3078\u3044\u3078\u3044\u8a00\u3063\u3066\u307f\u308b\n\n\n\u3061\u3083\u3093\u3068\u30aa\u30a6\u30e0\u8fd4\u3057\u3057\u3066\u304f\u308c\u307e\u3059\u306d :)\nhapi\u3082\u30b5\u30af\u30c3\u3068\u304b\u3051\u308b\u3057\u3001\u3084\u306f\u308alocaltunnel\u304c\u4fbf\u5229\u3059\u304e\u308b\u3002\n\nNode.js\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3042\u308bHapi.js\u3067LINE Bot\u3092\u4f5c\u308a\u307e\u3059\u3002\n**\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3060\u3051\u3067\u8a66\u305b\u308b**\u306e\u3067SSL\u3068\u304b\u30b5\u30fc\u30d0\u30fc\u7528\u610f\u3044\u3089\u306a\u3044\u3067\u3059\u3002\n\n[Go\u3068localtunnel\u3067Line Messaging API\u3092\u4f7f\u3063\u3066\u30aa\u30a6\u30e0\u8fd4\u3057LINE Bot\u3092\u8a66\u3059 #golangjp](http://qiita.com/n0bisuke/items/f0bfa0ead9f59ea81f37)\u3067\u66f8\u3044\u305flocaltunnel\u3092\u4f7f\u3063\u3066\u307e\u3059\u3002\n\n## LINE Messaging API\u306e\u5229\u7528\u6e96\u5099\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3067\u3059\u3002\n\n> https://devdocs.line.me/ja/\n\n### \u5fc5\u8981\u306a\u5024\u3092\u53d6\u5f97\n\nLINE Developers\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u307e\u3059\u3002\n\n![](https://i.gyazo.com/2d5785a51fd27441448fa31afac78e9b.png)\n\n* Channel Secret\n* Channel Access Token\n\n\u306e\u4e8c\u3064\u306e\u5024\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n### Bot\u306eWebhook\u5229\u7528\u3092\u8a31\u53ef\n\nLINE@ MANAGER\u306e\u30da\u30fc\u30b8\u3092\u958b\u304d\u307e\u3059\u3002\n\n\u0010![](https://i.gyazo.com/0f74d370052fcccdc875ff3dee365acb.png)\n\nBot\u306eWebhook\u5229\u7528\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\u4ed6\u306e\u81ea\u52d5\u5fdc\u7b54\u30e1\u30c3\u30bb\u30fc\u30b8\u306a\u3069\u306f\u30aa\u30d5\u306b\u3057\u305f\u65b9\u304c\u958b\u767a\u6642\u306e\u30a6\u30b6\u3055\u306f\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n(\u30b9\u30af\u30b7\u30e7\u3067)\n\n## \u30b3\u30fc\u30c9\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n* \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```\n$ node -v\nv7.0.0\n```\n\n## \u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ npm i --save hapi superagent\n```\n\n## \u5b9f\u969b\u306e\u30b3\u30fc\u30c9\n\n```app.js\n\n'use strict';\n\nconst Hapi = require('hapi');\nconst request = require('superagent');\nconst crypto = require('crypto');\n\nconst REPLY_URL = 'https://api.line.me/v2/bot/message/reply'; //\u30ea\u30d7\u30e9\u30a4\u7528\nconst CH_SECRET = 'xxxxxxxx'; //Channel Secret\u3092\u6307\u5b9a\nconst CH_ACCESS_TOKEN = 'xxxxxx'; //Channel Access Token\u3092\u6307\u5b9a\nconst SIGNATURE = crypto.createHmac('sha256', CH_SECRET);\n\n//\nlet client = (replyToken, SendMessageObject) => {\n    request\n        .post(REPLY_URL)\n        .send({ replyToken: replyToken, messages: SendMessageObject })\n        .set('X-Line-Signature', SIGNATURE)\n        .set('Content-Type', 'application/json')\n        .set('Authorization', `Bearer ${CH_ACCESS_TOKEN}`)\n        .end(function(err, res){\n            console.log(res.body);\n        });\n};\n\nconst server = new Hapi.Server();\nserver.connection({\n    host: 'localhost',\n    port: 3000\n});\n\nserver.route({\n    method: 'POST',\n    path:'/callback',\n    handler: (request, reply) => {\n        console.log(request.payload.events);\n        console.log('-------\\n');\n\n        let WebhookEventObject = request.payload.events[0];\n\n        if(WebhookEventObject.type === 'message'){\n            let SendMessageObject;\n            if(WebhookEventObject.message.type === 'text'){\n                SendMessageObject = [{\n                    type: 'text',\n                    text: WebhookEventObject.message.text\n                }];\n            }\n\n            client(WebhookEventObject.replyToken, SendMessageObject);\n        }\n        return reply('success').code(200);\n    }\n});\n\n// Start the server\nserver.start((err) => {\n    if (err) throw err;\n    console.log('Server running at:', server.info.uri);\n});\n\n```\n\n##\u8a66\u3059\n\n* \u30a2\u30d7\u30ea\u3092\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u3067\u8d77\u52d5\n\n```\n$ node app.js\n```\n\n* localtunnel\u3092\u8d77\u52d5\u3055\u305b\u3066\u30b0\u30ed\u30fc\u30d0\u30eb\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n```\n$ lt --port 3000\nyour url is: https://jyyhbdxhwp.localtunnel.me\n```\n\n* \u8a2d\u5b9a\u753b\u9762\u304b\u3089Webhook URL\u306blocaltunnel\u304c\u751f\u6210\u3057\u305fURL\u3092\u8a2d\u5b9a\u3059\u308b\n\n* \u5b9f\u969b\u306b`\u3078\u3044\u3078\u3044`\u8a00\u3063\u3066\u307f\u308b\n\n![](https://i.gyazo.com/abaf8f06efea5d9b3840c4aa1c8b1932.png)\n\n\u3061\u3083\u3093\u3068\u30aa\u30a6\u30e0\u8fd4\u3057\u3057\u3066\u304f\u308c\u307e\u3059\u306d :)\n\n\nhapi\u3082\u30b5\u30af\u30c3\u3068\u304b\u3051\u308b\u3057\u3001\u3084\u306f\u308alocaltunnel\u304c\u4fbf\u5229\u3059\u304e\u308b\u3002\n", "tags": ["Node.js", "Hapi.js", "LINEmessagingAPI", "JavaScript", "Line"]}