{"context": "\u3053\u306e\u8a18\u4e8b\u306f Grimoire.js Advent Calendar 2016 12\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\u3081\u3063\u3061\u3083\u304a\u304f\u308c\u3066\u3054\u3081\u3093\u306a\u3055\u3044\uff1b\uff1b\ngrimoire.js\u3067\u3001\u30e1\u30c3\u30b7\u30e5\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u52d5\u7684\u306b\u5909\u3048\u305f\u3044\u306e\u306f\u7c21\u5358\u3067\u3059\u3002\ngr(() => {\n  var target = gr('#main')('.target');\n  setTimeout(() => {\n    target.setAttribute('position', '1,2,3');\n  }, 1000);\n});\n\n\u306a\u3093\u3066\u30ce\u30ea\u3067\u66f8\u3051\u3070\u30011\u79d2\u5f8c\u306b#main\u30ad\u30e3\u30f3\u30d0\u30b9\u306e.target\u306a\u30e1\u30c3\u30b7\u30e5\u3092(x,y,z)=(1,2,3)\u306a\u70b9\u306b\u79fb\u52d5\u51fa\u6765\u307e\u3059\u3002\u591a\u5206\u3002\n\u3051\u3069\u3001\u5f62\u72b6\u3092\u5909\u66f4\u3055\u305b\u305f\u3044\u3068\u304d\u306f\u8a71\u304c\u5225\u3067\u3059\u3002\u4f8b\u3048\u3070\u3001\u6700\u521d\u306f\u534a\u5f843,\u9ad8\u30558\u306e\u5186\u67f1\u3060\u3051\u3069\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3067\u534a\u5f848,\u9ad8\u30553\u306a\u611f\u3058\u306b\u5909\u5f62\u3055\u305b\u305f\u3044\u3068\u304d\u306a\u3093\u304b\u306f\u3053\u3093\u306a\u7c21\u5358\u306a\u8a71\u3067\u306f\u306a\u304f\u306a\u3063\u3066\u304d\u3066\u3057\u307e\u3044\u307e\u3059\n\n\u3069\u3046\u89e3\u6c7a\u3059\u308b\u306e\u304b\n\u89e3\u6c7a\u65b9\u6cd5\u306f\u3071\u3063\u3068\u601d\u3044\u3064\u304f\u3060\u3051\u3067\u3082\uff12\u3064\u306f\u3042\u308a\u307e\u3059\u3002\n1\u3064\u306f\u6b63\u76f4\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u66f8\u304f\u3053\u3068\u3067\u3059\u3002gpu\u306b\u3084\u3089\u305b\u308b\u3079\u304d\u3053\u3068\u306f\u6b63\u76f4\u306b\u305d\u3046\u3055\u305b\u308b\u306e\u304c\u3069\u3046\u8003\u3048\u3066\u3082\u826f\u3044\u3067\u3059\u306d\u3002\n\u305f\u3060\u3057\u3001\u4eca\u56de\u306f\u50d5\u304c\u30b7\u30a7\u30fc\u30c0\u30fc\u306b\u95a2\u3059\u308b\u77e5\u8b58\u304c\u7686\u7121\u306a\u306e\u3068\u3001\u30b7\u30a7\u30fc\u30c0\u30fc\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3046\u7e1b\u308a\u306e\u4e0a\u306egrimoire.js\u3067\u305d\u308c\u304c\u5b9f\u73fe\u4e0d\u53ef\u80fd\u3067\u306a\u3044\u3053\u3068\u3092\u793a\u3057\u305f\u3044\u3002\u306a\u306e\u3067\u6bce\u30d5\u30ec\u30fc\u30e0\u306b\u9802\u70b9\u306a\u3069\u306e\u5f62\u72b6\u3092\u5909\u5f62\u3055\u305b\u308b\u65b9\u6cd5\u3092\u63a1\u7528\u3057\u307e\u3059\n\u305d\u306e\u89e3\u6c7a\u7b56\u3067\u3059\u304c\u3001grimoire.js\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3063\u3066\uff1f\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306eTutorial\u306b\u3057\u3063\u304b\u308a\u307e\u3068\u307e\u3063\u3066\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\u304c\u3001\u6700\u65b0\u7248\u306egrimoire\u3067\u306f\u3001\u7834\u58ca\u7684\u306b\u30e1\u30bd\u30c3\u30c9\u540d\u306a\u3069\u3092\u304b\u3048\u307e\u304f\u3063\u305f\u3089\u3057\u3044\u306e\u3067\u3061\u3087\u3063\u3068\u305d\u3053\u306f\u3042\u3066\u306b\u306a\u3089\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u3002\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\u306f\u3001\u4e00\u53e3\u3067\u3044\u3046\u306a\u3089\u300e\u30e1\u30c3\u30b7\u30e5\u306b\u304f\u3063\u3064\u3051\u308b\u6a5f\u80fd\u306e\u90e8\u5206\u300f\u3067\u3059\u3002\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u3042\u308b\u4f8b\u3092\u6319\u3052\u307e\u3059\n\u30ad\u30e5\u30fc\u30d6\u3092\u56de\u8ee2\u3055\u305b\u305f\u3044\u3002\u305d\u3093\u306a\u3068\u304d\u3001\u307e\u305a\u306f\u30ad\u30e5\u30fc\u30d6\u3092\u8868\u793a\u3057\u3066\u304a\u3044\u3066\u3001\u3042\u3089\u304b\u3058\u3081\u300c\u56de\u8ee2\u3055\u305b\u308b\u300d\u3068\u3044\u3046\u6a5f\u80fd\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u304a\u3044\u3066\u304b\u3089\u305d\u306e\u30ad\u30e5\u30fc\u30d6\u306b\u9069\u7528\u3057\u3066\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3064\u304f\u3063\u305f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u518d\u5229\u7528\u53ef\u80fd\u3060\u3057\u3001attribute\u3082\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n\n\u3084\u3063\u3066\u304f\n\u3069\u3046\u305b\u306a\u3089\u898b\u305f\u76ee\u3066\u304d\u306b\u307e\u3042\u307e\u3042\u826f\u3055\u305d\u3046\u306a\u3082\u306e\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067\u3001\u300e\u56db\u89d2\u3044\u30bf\u30f3\u30d0\u30ea\u30f3\u3092\u53e9\u3044\u305f\u8868\u9762\u306e\u72b6\u614b\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u300f\u3068\u304b\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u305f\u3089\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082\u30bd\u30fc\u30b9\u3068\u7d50\u679c\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a\nhttps://grimoiregl.github.io/grimoire.gl-example/#wave-simulation\n\n\u65b9\u91dd\n<mesh class=\"target\" geometry=\"wave\">\n  <mesh.components>\n    <GeometryUpdator />\n  </mesh.components>\n</mesh>\n\n\u3053\u306eGeometryUpdator\u306eattribute\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\ngr('#main')('.target').first()\n  .getComponent(\"GeometryUpdator\")\n  .setAttribute(\"frame\", 50);\n\n\u306a\u611f\u3058\u306b\u66f8\u3051\u3070\u3001frame=50\u306b\u5909\u308f\u308b\u306e\u3067\u3053\u308c\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u8981\u3059\u308b\u306b\u3001\u3042\u3068\u3067setAttribute\u3092\u5229\u7528\u3057\u3066\u6642\u9593\u304c\u7d4c\u3064\u306b\u3064\u308c\u3066frame\u306e\u5024\u3092\u5927\u304d\u304f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3042\u3068\u306f\u9802\u70b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\n\u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8aad\u307f\u8fbc\u307f\n\u3044\u3064\u3082\u306egrimoire-preset-basic.js\u3060\u3051\u8aad\u3081\u3066\u308c\u3070\u3044\u3044\u306e\u3067\u666e\u901a\u3067\u3059\u3002\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>grimoire js</title>\n  <style>\n    html {\n      height: 100%;\n    }\n    body {\n      margin: 0;\n      height: 100%;\n    }\n  </style>\n</head>\n<body>\n  <script type=\"text/javascript\" src=\"./static/grimoire-preset-basic.min.js\"></script>\n  <script type=\"text/goml\" src=\"index.goml\" id=\"main\"></script>\n  <script type=\"text/javascript\" src=\"index.js\"></script>\n</body>\n</html>\n\n\ngoml\u306e\u7528\u610f\n\u3053\u308c\u306b\u95a2\u3057\u3066\u3082\u3055\u3063\u304d\u89e3\u8aac\u3057\u305f\u901a\u308a\u3067\u3059\u306d\n<goml width=\"fit\" height=\"fit\">\n  <geometry type=\"wave-grid\" name=\"wave\" frame=\"3\"></geometry>\n  <scene>\n    <camera rotation=\"-25d,0d,0d\">\n      <camera.components>\n        <MouseCameraControl center=\"0,0,0\" moveSpeed=\"10\"/>\n      </camera.components>\n    </camera>\n    <mesh class=\"target\" geometry=\"wave\" color=\"black\" targetBuffer=\"wireframe\" position=\"0,-4,-10\" scale=\"3\">\n      <mesh.components>\n        <GeometryUpdator/>\n      </mesh.components>\n    </mesh>\n  </scene>\n</goml>\n\n\nmesh\u4f5c\u308b\nGeometryFactory.addType()\u3067\u30b8\u30aa\u30e1\u30c8\u30ea\u3092\u81ea\u4f5c\u3057\u307e\u3059\u3002\n\u7b2c\u4e00\u5f15\u6570\u304cGeometry\u540d\u3001\u7b2c\u4e8c\u5f15\u6570\u304cgeometry\u306b\u4ed8\u3051\u308battribute\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3001\u7b2c\u4e09\u5f15\u6570\u3067\u3069\u3093\u306a\u5f62\u72b6\u304b\u3092\u304d\u3081\u308b\u5f0f\u3092\u5165\u308c\u307e\u3059\n\u5f62\u72b6\u306e\u6c7a\u3081\u65b9\u306b\u3064\u3044\u3066\u306f\u3001\u57fa\u672c\u7684\u306b\u306f\n\n\u624b\u52d5\u3067\u66f8\u304f\nGeometryBuilder.build\u3068\u3044\u3046\u3001\u5358\u7d14\u56f3\u5f62\u3092\u4f5c\u308b\u305f\u3081\u306b\u7528\u610f\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\n\n\u306e\uff12\u3064\u304c\u3042\u308b\u3089\u3057\u3044\u3067\u3059\u3002\u524d\u8005\u3092\u4f7f\u3046\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u4eca\u56de\u306f\u5f8c\u8005\u3067\u3044\u304d\u307e\u3059\u3002\nconst GeometryFactory = gr.lib.fundamental.Geometry.GeometryFactory;\nconst GeometryBuilder = gr.lib.fundamental.Geometry.GeometryBuilder;\nconst GeometryUtility = gr.lib.fundamental.Geometry.GeometryUtility;\n\nGeometryFactory.addType(\"wave-grid\", {}, (gl, attrs) => {\n  const positions = positionsFrames[attrs.frame];\n  const faces = facesFrames[attrs.frame];\n\n  return GeometryBuilder.build(gl, {\n    indices: {\n      default: {\n        generator: function*() {\n          yield* faces;\n        },\n        topology: WebGLRenderingContext.TRIANGLES\n      },\n      wireframe: {\n        generator: function*(){\n          yield* GeometryUtility.linesFromTriangles(faces)\n        },\n        topology: WebGLRenderingContext.LINES\n      }\n    },\n    vertices: {\n      pos: {\n        size: {\n          position: 3\n        },\n        count: positions.length,\n        getGenerators: ()=>{\n          return {\n            position: function*() {\n              for (let i = 0; i < positions.length; i++) {\n                yield* positions[i];\n              }\n            }\n          };\n        }\n      },\n      main: {\n        size: {\n          normal: 3,\n          texCoord: 2\n        },\n        count: positions.length,\n        getGenerators: () => {\n          return {\n            normal: function*() {\n              while (true) {\n                yield 1;\n              }\n            },\n            texCoord: function*() {\n              while (true) yield 0;\n            }\n          };\n        }\n      },\n    },\n  })\n});\n\nindices\u3067\u9802\u70b9\u305f\u3061\u3092\u3069\u3046\u3064\u306a\u3050\u304b\u6c7a\u3081\u307e\u3059\u3002\ntopology: WebGLRenderingContext.TRIANGLES\u3092\u4f7f\u3046\u3068\u4e09\u89d2\u5f62\u3067\u7d50\u307c\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u7d50\u3076\u70b9\u306e\u9806\u3092\u6e21\u3057\u307e\u3059\u3002flatten\u3057\u305f\u914d\u5217\u3092yield*\u3059\u308b\u306e\u304c\u6ce8\u610f\u70b9\u3067\u3059\u306d\n\u3064\u3044\u3067\u306bwireframe\u306b\u3064\u3044\u3066\u3082\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u52dd\u624b\u306b\u4ed8\u3051\u3066\u304f\u308c\u307e\u3059\u3002\n\u6b21\u306bvertices\u3067\u3001\u9802\u70b9\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u6c7a\u3081\u307e\u3059\u3002\npos\u3067\u3069\u3053\u306b\u914d\u7f6e\u3059\u308b\u304b\u6c7a\u3081\u307e\u3059\u3002\u304c\u3001\u5b9f\u969b\u306b\u306fpos\u306f\u3042\u3068\u3067\u66f4\u65b0\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u3001getGenerator\u306f\u9069\u5f53\u306a\u5024\u3092\u5165\u308c\u3066\u3082\u554f\u984c\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u591a\u5206\u3002count\u306f\u307e\u3068\u3082\u306a\u3082\u306e\u3092\u5165\u308c\u306a\u3044\u3068\u3067\u3059\u3051\u3069\u306d\nmain\u3067\u6cd5\u7dda\u3068\u304b\u6c7a\u3081\u307e\u3059\u304c\u6020\u60f0\u3067\u9069\u5f53\u306a\u5024\u3092\u3044\u308c\u3061\u3083\u3063\u3066\u307e\u3059\n\nComponent\u3092\u4f5c\u308b\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306eTutorial\u306b\u3042\u308b\u901a\u308a\u3001gr.registerComponent()\u3092\u4f7f\u3044\u307e\u3059\u3002\ngr.registerComponent(\"GeometryUpdator\", {\n  attributes: {\n    frame: {\n      converter: \"Number\",\n      default: 0\n    }\n  },\n  $awake: function(){\n    this.geometry = this.node.getAttribute(\"geometry\");\n    let positions = positionsFrames.map((positions) => {\n      return new Float32Array(Array.prototype.concat.apply([], positions))\n    });\n    this.getAttributeRaw(\"frame\").watch((v)=>{\n      this.geometry.vertices.pos.update(positions[v]);\n    }, true);\n  }\n});\n\n\u3082\u3061\u308d\u3093\u7b2c\u4e00\u5f15\u6570\u306fcomponent\u540d\u3001\u7b2c\u4e8c\u3067\u5185\u5bb9\u306e\u8a2d\u5b9a\u3067\u3001\nattributes\u3067component\u306eattribute\u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u7b2c\u4e8c\u5f15\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u306f\u3001$awake\u3068$update\u304c\u4f7f\u7528\u51fa\u6765\u307e\u3059\u3002\n$awake\u306f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306einitialize\u6642\u306b\u547c\u3070\u308c\u307e\u3059\u3002\n$update\u306f\u6bce\u30d5\u30ec\u30fc\u30e0\u3067\u547c\u3070\u308c\u307e\u3059\u3002\n$update\u3092\u4f7f\u3063\u3066\u3082\u826f\u3044\u3093\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5916\u90e8\u304b\u3089attribute\u306e\u66f4\u65b0\u3092\u53d6\u3063\u3066\u3001\u66f4\u65b0\u304c\u3042\u308a\u6b21\u7b2c\u306bposition\u306e\u66f4\u65b0\u3092\u3059\u308b\u65b9\u91dd\u3067\u3044\u304d\u305f\u3044\u306e\u3067$awake\u3067\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u30ea\u30b9\u30ca\u3092\u4ed8\u3051\u3066\u307e\u3059\u3002\n\u5b9f\u969b\u306bthis.getAttributeRaw(\"frame\").watch()\u3067\u3001frame\u304c\u66f4\u65b0\u3055\u308c\u305f\u3068\u304d\u304c\u3068\u308c\u307e\u3059\u3002\nthis.geometry.vertices.pos.update()\u304c\u3053\u3053\u3067\u4f7f\u3048\u308b\u306e\u304c\u30dd\u30a4\u30f3\u30c8\u306e\u4e00\u3064\u3067\u3059\u306d\u3002\n\ncomponent\u306eattribute\u3092\u66f4\u65b0\u3059\u308b\ngr(() => {\n  let target = gr('#main')('.target').single().getComponent(\"GeometryUpdator\");\n  renderLoop((i) => {\n    target.setAttribute(\"frame\", i/3|0);\n  });\n});\n\nfunction renderLoop(cb) {\n  let renderCount = 0;\n  (function () {\n    window.requestAnimationFrame(arguments.callee);\n    cb(renderCount++);\n  })();\n}\n\n\u898b\u3066\u306e\u901a\u308a\u3067\u3059\u3002\u3053\u308c\u3067\u6700\u521d\u306b\u3042\u3052\u305f\u554f\u984c\u306f\u30af\u30ea\u30a2\u3057\u304d\u308a\u307e\u3057\u305f\u306d\n\n\u30b8\u30aa\u30e1\u30c8\u30ea\u4f5c\u6210\u306e\u4f5c\u696d\u5de5\u7a0b\n\u8ad6\u70b9\u3067\u306f\u306a\u304b\u3063\u305f\u304b\u3089\u7565\u3057\u3066\u305f\u3051\u3069\u4e00\u5fdc\u30bd\u30fc\u30b9\u3060\u3051\u8cbc\u3063\u3068\u304d\u307e\u3059\nconst waveSimulation = (() => {\n\n  const dx = 0.01;\n  const dt = 0.0005;\n  const conductivity = 5;\n  const mew = conductivity * dt / dx;\n  const lattice = 41;\n  const tMax = 1000;\n\n  const p = (v) => v * v; //pow\n\n  return () => {\n    let mapLog = [];\n    let u0 = createMap(lattice);\n    let u1 = createMap(lattice);\n    let u2;\n\n    for (let k = 0; k < tMax; k++) {\n      u2 = createMap(lattice);\n      for (let i = 1; i < lattice-1; i++) for (let j = 1; j < lattice-1; j++) {\n        u2[i][j] =\n          k === 0 ? (hitSpace(i, j) ? 4 : 0) :\n          k === 1 ? (1-2*mew)*u1[i][j] + p(mew)/2*(u1[i+1][j]+u1[i-1][j]+u1[i][j+1]+u1[i][j-1]) :\n          /*k>=2*/  2*(1-2*p(mew))*u1[i][j] + p(mew)*(u1[i+1][j]+u1[i-1][j]+u1[i][j+1]+u1[i][j-1]) - u0[i][j];\n      }\n      for (let i = 0; i < lattice; i++) {\n        u2[i][0] = 0;\n        u2[i][lattice-1] = 0;\n      }\n      for (var j = 0; j < lattice; j++) {\n        u2[0][j] = 0;\n        u2[lattice-1][j] = 0;\n      }\n      mapLog.push(u2);\n      u0 = u1.concat();\n      u1 = u2.concat();\n    }\n    return mapLog;\n  };\n\n  function hitSpace(x, y) {\n    return p(x-(lattice-1)/2) + p(y-(lattice-1)/2) <= p(lattice/10);\n  }\n\n  function createMap(size, fn) {\n    return Array.from({length:size}).map(_=> Array.from({length:size}).map(_=> 0));\n  }\n})();\n\n\uff13\u6b21\u5143\u914d\u5217\u3092\u8fd4\u3057\u3066\u3044\u3066\u3001waveSimulation[frame][i][j]\u3067frame\u6570\u76ee\u306e(i,j)\u8981\u7d20\u306e\u9ad8\u3055\u304c\u3068\u308c\u307e\u3059\u3002\n\u3053\u306e\u95a2\u6570\u306f\u308f\u3056\u308f\u3056\u6ce2\u52d5\u65b9\u7a0b\u5f0f\u3092\u3082\u3068\u306b\u6bce\u30d5\u30ec\u30fc\u30e0\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u8a08\u7b97\u3057\u3066\u307e\u3059\u3002\n\u3061\u3087\u3063\u3068\u3057\u305f\u6570\u5b66\u7684\u306a\u3053\u3068\u306f\u3053\u3053(http://www.slideshare.net/yusa3)\u306b\u7528\u610f\u3057\u307e\u3057\u305f\nlet positionsFrames = [];\nlet facesFrames = [];\nconst simulation = waveSimulation();\nsimulation.forEach((o, i) => {\n  const data = simulation[i];\n  let faces = [];\n  data.forEach((ary, x) => { if (x !== data.length-1) // x\u306e\u53f3\u7aef\u4ee5\u5916\n    ary.forEach((z, y) => { if (y !== ary.length-1) // y\u306e\u4e0b\u7aef\u4ee5\u5916\n      faces.push([x+y*data.length, x+y*data.length+1, x+(y+1)*data.length]);\n    });\n  });\n  data.forEach((ary, x) => { if (x !== 0) // x\u306e\u5de6\u7aef\u4ee5\u5916\n    ary.forEach((z, y) => { if (y !== ary.length-1) // y\u306e\u4e0b\u7aef\u4ee5\u5916\n      faces.push([x+y*data.length, x+(y+1)*data.length, x+(y+1)*data.length-1]);\n    });\n  });\n  faces = Array.prototype.concat.apply([], faces);\n  let positions = [];\n  data.forEach((ary, x) => ary.forEach((y, z) => {\n    positions.push([(x-20)/10,y/10,-(z-20)/10]);\n  }));\n  positionsFrames.push(positions);\n  facesFrames.push(faces);\n});\n\n\u3081\u3093\u3069\u304f\u3055\u304f\u66f8\u3044\u3066\u308b\u3051\u3069\u3001\u8981\u3059\u308b\u306b\u4e09\u89d2\u5f62\u306e\u7d50\u3073\u65b9\u3068position\u3092\u4f7f\u3044\u3084\u3059\u3044\u5f62\u5f0f\u306b\u306a\u304a\u3057\u3066\u308b\u3060\u3051\u3067\u3059\n\n\u5c55\u671b\n\u8fd1\u3044\u3046\u3061\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u3067\u5b9f\u88c5\u3067\u304d\u305f\u3089advent calendar\u306e\u7d42\u76e4\u3067\u98db\u3073\u5165\u308a\u3057\u3066\u8a18\u4e8b\u66f8\u304f\u304b\u3082\uff1f\n\u3053\u306e\u8a18\u4e8b\u306f [Grimoire.js Advent Calendar 2016](http://qiita.com/advent-calendar/2016/grimoire) 12\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u3081\u3063\u3061\u3083\u304a\u304f\u308c\u3066\u3054\u3081\u3093\u306a\u3055\u3044\uff1b\uff1b\n\ngrimoire.js\u3067\u3001\u30e1\u30c3\u30b7\u30e5\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u52d5\u7684\u306b\u5909\u3048\u305f\u3044\u306e\u306f\u7c21\u5358\u3067\u3059\u3002\n\n```js\ngr(() => {\n  var target = gr('#main')('.target');\n  setTimeout(() => {\n    target.setAttribute('position', '1,2,3');\n  }, 1000);\n});\n```\n\n\u306a\u3093\u3066\u30ce\u30ea\u3067\u66f8\u3051\u3070\u30011\u79d2\u5f8c\u306b#main\u30ad\u30e3\u30f3\u30d0\u30b9\u306e.target\u306a\u30e1\u30c3\u30b7\u30e5\u3092(x,y,z)=(1,2,3)\u306a\u70b9\u306b\u79fb\u52d5\u51fa\u6765\u307e\u3059\u3002\u591a\u5206\u3002\n\n\u3051\u3069\u3001\u5f62\u72b6\u3092\u5909\u66f4\u3055\u305b\u305f\u3044\u3068\u304d\u306f\u8a71\u304c\u5225\u3067\u3059\u3002\u4f8b\u3048\u3070\u3001\u6700\u521d\u306f\u534a\u5f843,\u9ad8\u30558\u306e\u5186\u67f1\u3060\u3051\u3069\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3067\u534a\u5f848,\u9ad8\u30553\u306a\u611f\u3058\u306b\u5909\u5f62\u3055\u305b\u305f\u3044\u3068\u304d\u306a\u3093\u304b\u306f\u3053\u3093\u306a\u7c21\u5358\u306a\u8a71\u3067\u306f\u306a\u304f\u306a\u3063\u3066\u304d\u3066\u3057\u307e\u3044\u307e\u3059\n\n## \u3069\u3046\u89e3\u6c7a\u3059\u308b\u306e\u304b\n\n\u89e3\u6c7a\u65b9\u6cd5\u306f\u3071\u3063\u3068\u601d\u3044\u3064\u304f\u3060\u3051\u3067\u3082\uff12\u3064\u306f\u3042\u308a\u307e\u3059\u3002\n\n1\u3064\u306f\u6b63\u76f4\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u66f8\u304f\u3053\u3068\u3067\u3059\u3002gpu\u306b\u3084\u3089\u305b\u308b\u3079\u304d\u3053\u3068\u306f\u6b63\u76f4\u306b\u305d\u3046\u3055\u305b\u308b\u306e\u304c\u3069\u3046\u8003\u3048\u3066\u3082\u826f\u3044\u3067\u3059\u306d\u3002\n\n\u305f\u3060\u3057\u3001\u4eca\u56de\u306f\u50d5\u304c\u30b7\u30a7\u30fc\u30c0\u30fc\u306b\u95a2\u3059\u308b\u77e5\u8b58\u304c\u7686\u7121\u306a\u306e\u3068\u3001\u30b7\u30a7\u30fc\u30c0\u30fc\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3046\u7e1b\u308a\u306e\u4e0a\u306egrimoire.js\u3067\u305d\u308c\u304c\u5b9f\u73fe\u4e0d\u53ef\u80fd\u3067\u306a\u3044\u3053\u3068\u3092\u793a\u3057\u305f\u3044\u3002\u306a\u306e\u3067\u6bce\u30d5\u30ec\u30fc\u30e0\u306b\u9802\u70b9\u306a\u3069\u306e\u5f62\u72b6\u3092\u5909\u5f62\u3055\u305b\u308b\u65b9\u6cd5\u3092\u63a1\u7528\u3057\u307e\u3059\n\n\u305d\u306e\u89e3\u6c7a\u7b56\u3067\u3059\u304c\u3001grimoire.js\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b **\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8** \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n## \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3063\u3066\uff1f\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306e[Tutorial](https://grimoire.gl/tutorial/)\u306b\u3057\u3063\u304b\u308a\u307e\u3068\u307e\u3063\u3066\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u304c\u3001\u6700\u65b0\u7248\u306egrimoire\u3067\u306f\u3001\u7834\u58ca\u7684\u306b\u30e1\u30bd\u30c3\u30c9\u540d\u306a\u3069\u3092\u304b\u3048\u307e\u304f\u3063\u305f\u3089\u3057\u3044\u306e\u3067\u3061\u3087\u3063\u3068\u305d\u3053\u306f\u3042\u3066\u306b\u306a\u3089\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3067\u3059\u3002\n\n\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3068\u306f\u3001\u4e00\u53e3\u3067\u3044\u3046\u306a\u3089\u300e**\u30e1\u30c3\u30b7\u30e5\u306b\u304f\u3063\u3064\u3051\u308b\u6a5f\u80fd\u306e\u90e8\u5206**\u300f\u3067\u3059\u3002\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u3042\u308b\u4f8b\u3092\u6319\u3052\u307e\u3059\n\n\u30ad\u30e5\u30fc\u30d6\u3092\u56de\u8ee2\u3055\u305b\u305f\u3044\u3002\u305d\u3093\u306a\u3068\u304d\u3001\u307e\u305a\u306f\u30ad\u30e5\u30fc\u30d6\u3092\u8868\u793a\u3057\u3066\u304a\u3044\u3066\u3001\u3042\u3089\u304b\u3058\u3081\u300c\u56de\u8ee2\u3055\u305b\u308b\u300d\u3068\u3044\u3046\u6a5f\u80fd\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u4f5c\u3063\u3066\u304a\u3044\u3066\u304b\u3089\u305d\u306e\u30ad\u30e5\u30fc\u30d6\u306b\u9069\u7528\u3057\u3066\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3064\u304f\u3063\u305f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306f\u518d\u5229\u7528\u53ef\u80fd\u3060\u3057\u3001attribute\u3082\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\n\n## \u3084\u3063\u3066\u304f\n\n\u3069\u3046\u305b\u306a\u3089\u898b\u305f\u76ee\u3066\u304d\u306b\u307e\u3042\u307e\u3042\u826f\u3055\u305d\u3046\u306a\u3082\u306e\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067\u3001\u300e\u56db\u89d2\u3044\u30bf\u30f3\u30d0\u30ea\u30f3\u3092\u53e9\u3044\u305f\u8868\u9762\u306e\u72b6\u614b\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u300f\u3068\u304b\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u5b9f\u969b\u306b\u4f5c\u3063\u3066\u307f\u305f\u3089\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n![](https://media.giphy.com/media/3o7TKsa4iM4b4IRPoc/source.gif)\n\n\u4e0b\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3082\u30bd\u30fc\u30b9\u3068\u7d50\u679c\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a\n\n[https://grimoiregl.github.io/grimoire.gl-example/#wave-simulation](https://grimoiregl.github.io/grimoire.gl-example/#wave-simulation)\n\n### \u65b9\u91dd\n```xml\n<mesh class=\"target\" geometry=\"wave\">\n  <mesh.components>\n    <GeometryUpdator />\n  </mesh.components>\n</mesh>\n```\n\n\u3053\u306eGeometryUpdator\u306eattribute\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\n\n```js\ngr('#main')('.target').first()\n  .getComponent(\"GeometryUpdator\")\n  .setAttribute(\"frame\", 50);\n```\n\n\u306a\u611f\u3058\u306b\u66f8\u3051\u3070\u3001frame=50\u306b\u5909\u308f\u308b\u306e\u3067\u3053\u308c\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u8981\u3059\u308b\u306b\u3001\u3042\u3068\u3067setAttribute\u3092\u5229\u7528\u3057\u3066\u6642\u9593\u304c\u7d4c\u3064\u306b\u3064\u308c\u3066frame\u306e\u5024\u3092\u5927\u304d\u304f\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u3042\u3068\u306f\u9802\u70b9\u306e\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\n### \u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8aad\u307f\u8fbc\u307f\n\n\u3044\u3064\u3082\u306egrimoire-preset-basic.js\u3060\u3051\u8aad\u3081\u3066\u308c\u3070\u3044\u3044\u306e\u3067\u666e\u901a\u3067\u3059\u3002\n\n```html\n<!DOCTYPE html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>grimoire js</title>\n  <style>\n    html {\n      height: 100%;\n    }\n    body {\n      margin: 0;\n      height: 100%;\n    }\n  </style>\n</head>\n<body>\n  <script type=\"text/javascript\" src=\"./static/grimoire-preset-basic.min.js\"></script>\n  <script type=\"text/goml\" src=\"index.goml\" id=\"main\"></script>\n  <script type=\"text/javascript\" src=\"index.js\"></script>\n</body>\n</html>\n```\n\n### goml\u306e\u7528\u610f\n\n\u3053\u308c\u306b\u95a2\u3057\u3066\u3082\u3055\u3063\u304d\u89e3\u8aac\u3057\u305f\u901a\u308a\u3067\u3059\u306d\n\n```xml\n<goml width=\"fit\" height=\"fit\">\n  <geometry type=\"wave-grid\" name=\"wave\" frame=\"3\"></geometry>\n  <scene>\n    <camera rotation=\"-25d,0d,0d\">\n      <camera.components>\n        <MouseCameraControl center=\"0,0,0\" moveSpeed=\"10\"/>\n      </camera.components>\n    </camera>\n    <mesh class=\"target\" geometry=\"wave\" color=\"black\" targetBuffer=\"wireframe\" position=\"0,-4,-10\" scale=\"3\">\n      <mesh.components>\n        <GeometryUpdator/>\n      </mesh.components>\n    </mesh>\n  </scene>\n</goml>\n```\n\n### mesh\u4f5c\u308b\n\n`GeometryFactory.addType()`\u3067\u30b8\u30aa\u30e1\u30c8\u30ea\u3092\u81ea\u4f5c\u3057\u307e\u3059\u3002\n\n\u7b2c\u4e00\u5f15\u6570\u304cGeometry\u540d\u3001\u7b2c\u4e8c\u5f15\u6570\u304cgeometry\u306b\u4ed8\u3051\u308battribute\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u3001\u7b2c\u4e09\u5f15\u6570\u3067\u3069\u3093\u306a\u5f62\u72b6\u304b\u3092\u304d\u3081\u308b\u5f0f\u3092\u5165\u308c\u307e\u3059\n\n\u5f62\u72b6\u306e\u6c7a\u3081\u65b9\u306b\u3064\u3044\u3066\u306f\u3001\u57fa\u672c\u7684\u306b\u306f\n\n* \u624b\u52d5\u3067\u66f8\u304f\n* GeometryBuilder.build\u3068\u3044\u3046\u3001\u5358\u7d14\u56f3\u5f62\u3092\u4f5c\u308b\u305f\u3081\u306b\u7528\u610f\u3055\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\n\n\u306e\uff12\u3064\u304c\u3042\u308b\u3089\u3057\u3044\u3067\u3059\u3002\u524d\u8005\u3092\u4f7f\u3046\u5fc5\u8981\u306f\u306a\u3044\u306e\u3067\u4eca\u56de\u306f\u5f8c\u8005\u3067\u3044\u304d\u307e\u3059\u3002\n\n```js\nconst GeometryFactory = gr.lib.fundamental.Geometry.GeometryFactory;\nconst GeometryBuilder = gr.lib.fundamental.Geometry.GeometryBuilder;\nconst GeometryUtility = gr.lib.fundamental.Geometry.GeometryUtility;\n\nGeometryFactory.addType(\"wave-grid\", {}, (gl, attrs) => {\n  const positions = positionsFrames[attrs.frame];\n  const faces = facesFrames[attrs.frame];\n\n  return GeometryBuilder.build(gl, {\n    indices: {\n      default: {\n        generator: function*() {\n          yield* faces;\n        },\n        topology: WebGLRenderingContext.TRIANGLES\n      },\n      wireframe: {\n        generator: function*(){\n          yield* GeometryUtility.linesFromTriangles(faces)\n        },\n        topology: WebGLRenderingContext.LINES\n      }\n    },\n    vertices: {\n      pos: {\n        size: {\n          position: 3\n        },\n        count: positions.length,\n        getGenerators: ()=>{\n          return {\n            position: function*() {\n              for (let i = 0; i < positions.length; i++) {\n                yield* positions[i];\n              }\n            }\n          };\n        }\n      },\n      main: {\n        size: {\n          normal: 3,\n          texCoord: 2\n        },\n        count: positions.length,\n        getGenerators: () => {\n          return {\n            normal: function*() {\n              while (true) {\n                yield 1;\n              }\n            },\n            texCoord: function*() {\n              while (true) yield 0;\n            }\n          };\n        }\n      },\n    },\n  })\n});\n```\n\nindices\u3067\u9802\u70b9\u305f\u3061\u3092\u3069\u3046\u3064\u306a\u3050\u304b\u6c7a\u3081\u307e\u3059\u3002\n\n`topology: WebGLRenderingContext.TRIANGLES`\u3092\u4f7f\u3046\u3068\u4e09\u89d2\u5f62\u3067\u7d50\u307c\u3046\u3068\u3059\u308b\u306e\u3067\u3001\u7d50\u3076\u70b9\u306e\u9806\u3092\u6e21\u3057\u307e\u3059\u3002flatten\u3057\u305f\u914d\u5217\u3092yield*\u3059\u308b\u306e\u304c\u6ce8\u610f\u70b9\u3067\u3059\u306d\n\n\u3064\u3044\u3067\u306bwireframe\u306b\u3064\u3044\u3066\u3082\u4e0a\u8a18\u306e\u3088\u3046\u306b\u3059\u308b\u3068\u52dd\u624b\u306b\u4ed8\u3051\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u6b21\u306bvertices\u3067\u3001\u9802\u70b9\u306b\u95a2\u3059\u308b\u60c5\u5831\u3092\u6c7a\u3081\u307e\u3059\u3002\n\npos\u3067\u3069\u3053\u306b\u914d\u7f6e\u3059\u308b\u304b\u6c7a\u3081\u307e\u3059\u3002\u304c\u3001\u5b9f\u969b\u306b\u306fpos\u306f\u3042\u3068\u3067\u66f4\u65b0\u51e6\u7406\u3092\u3059\u308b\u306e\u3067\u3001getGenerator\u306f\u9069\u5f53\u306a\u5024\u3092\u5165\u308c\u3066\u3082\u554f\u984c\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u591a\u5206\u3002count\u306f\u307e\u3068\u3082\u306a\u3082\u306e\u3092\u5165\u308c\u306a\u3044\u3068\u3067\u3059\u3051\u3069\u306d\n\nmain\u3067\u6cd5\u7dda\u3068\u304b\u6c7a\u3081\u307e\u3059\u304c\u6020\u60f0\u3067\u9069\u5f53\u306a\u5024\u3092\u3044\u308c\u3061\u3083\u3063\u3066\u307e\u3059\n\n### Component\u3092\u4f5c\u308b\n\n\u516c\u5f0f\u30b5\u30a4\u30c8\u306e[Tutorial](https://grimoire.gl/tutorial/)\u306b\u3042\u308b\u901a\u308a\u3001`gr.registerComponent()`\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```js\ngr.registerComponent(\"GeometryUpdator\", {\n  attributes: {\n    frame: {\n      converter: \"Number\",\n      default: 0\n    }\n  },\n  $awake: function(){\n    this.geometry = this.node.getAttribute(\"geometry\");\n    let positions = positionsFrames.map((positions) => {\n      return new Float32Array(Array.prototype.concat.apply([], positions))\n    });\n    this.getAttributeRaw(\"frame\").watch((v)=>{\n      this.geometry.vertices.pos.update(positions[v]);\n    }, true);\n  }\n});\n```\n\n\u3082\u3061\u308d\u3093\u7b2c\u4e00\u5f15\u6570\u306fcomponent\u540d\u3001\u7b2c\u4e8c\u3067\u5185\u5bb9\u306e\u8a2d\u5b9a\u3067\u3001\n\nattributes\u3067component\u306eattribute\u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u7b2c\u4e8c\u5f15\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u306f\u3001`$awake`\u3068`$update`\u304c\u4f7f\u7528\u51fa\u6765\u307e\u3059\u3002\n\n`$awake`\u306f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306einitialize\u6642\u306b\u547c\u3070\u308c\u307e\u3059\u3002\n\n`$update`\u306f\u6bce\u30d5\u30ec\u30fc\u30e0\u3067\u547c\u3070\u308c\u307e\u3059\u3002\n\n`$update`\u3092\u4f7f\u3063\u3066\u3082\u826f\u3044\u3093\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u5916\u90e8\u304b\u3089attribute\u306e\u66f4\u65b0\u3092\u53d6\u3063\u3066\u3001\u66f4\u65b0\u304c\u3042\u308a\u6b21\u7b2c\u306bposition\u306e\u66f4\u65b0\u3092\u3059\u308b\u65b9\u91dd\u3067\u3044\u304d\u305f\u3044\u306e\u3067`$awake`\u3067\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u30a4\u30d9\u30f3\u30c8\u30ea\u30b9\u30ca\u3092\u4ed8\u3051\u3066\u307e\u3059\u3002\n\n\u5b9f\u969b\u306b`this.getAttributeRaw(\"frame\").watch()`\u3067\u3001frame\u304c\u66f4\u65b0\u3055\u308c\u305f\u3068\u304d\u304c\u3068\u308c\u307e\u3059\u3002\n\n`this.geometry.vertices.pos.update()`\u304c\u3053\u3053\u3067\u4f7f\u3048\u308b\u306e\u304c\u30dd\u30a4\u30f3\u30c8\u306e\u4e00\u3064\u3067\u3059\u306d\u3002\n\n### component\u306eattribute\u3092\u66f4\u65b0\u3059\u308b\n\n```js\ngr(() => {\n  let target = gr('#main')('.target').single().getComponent(\"GeometryUpdator\");\n  renderLoop((i) => {\n    target.setAttribute(\"frame\", i/3|0);\n  });\n});\n\nfunction renderLoop(cb) {\n  let renderCount = 0;\n  (function () {\n    window.requestAnimationFrame(arguments.callee);\n    cb(renderCount++);\n  })();\n}\n```\n\n\u898b\u3066\u306e\u901a\u308a\u3067\u3059\u3002\u3053\u308c\u3067\u6700\u521d\u306b\u3042\u3052\u305f\u554f\u984c\u306f\u30af\u30ea\u30a2\u3057\u304d\u308a\u307e\u3057\u305f\u306d\n\n### \u30b8\u30aa\u30e1\u30c8\u30ea\u4f5c\u6210\u306e\u4f5c\u696d\u5de5\u7a0b\n\n\u8ad6\u70b9\u3067\u306f\u306a\u304b\u3063\u305f\u304b\u3089\u7565\u3057\u3066\u305f\u3051\u3069\u4e00\u5fdc\u30bd\u30fc\u30b9\u3060\u3051\u8cbc\u3063\u3068\u304d\u307e\u3059\n\n```js\nconst waveSimulation = (() => {\n\n  const dx = 0.01;\n  const dt = 0.0005;\n  const conductivity = 5;\n  const mew = conductivity * dt / dx;\n  const lattice = 41;\n  const tMax = 1000;\n\n  const p = (v) => v * v; //pow\n\n  return () => {\n    let mapLog = [];\n    let u0 = createMap(lattice);\n    let u1 = createMap(lattice);\n    let u2;\n\n    for (let k = 0; k < tMax; k++) {\n      u2 = createMap(lattice);\n      for (let i = 1; i < lattice-1; i++) for (let j = 1; j < lattice-1; j++) {\n        u2[i][j] =\n          k === 0 ? (hitSpace(i, j) ? 4 : 0) :\n          k === 1 ? (1-2*mew)*u1[i][j] + p(mew)/2*(u1[i+1][j]+u1[i-1][j]+u1[i][j+1]+u1[i][j-1]) :\n          /*k>=2*/  2*(1-2*p(mew))*u1[i][j] + p(mew)*(u1[i+1][j]+u1[i-1][j]+u1[i][j+1]+u1[i][j-1]) - u0[i][j];\n      }\n      for (let i = 0; i < lattice; i++) {\n        u2[i][0] = 0;\n        u2[i][lattice-1] = 0;\n      }\n      for (var j = 0; j < lattice; j++) {\n        u2[0][j] = 0;\n        u2[lattice-1][j] = 0;\n      }\n      mapLog.push(u2);\n      u0 = u1.concat();\n      u1 = u2.concat();\n    }\n    return mapLog;\n  };\n\n  function hitSpace(x, y) {\n    return p(x-(lattice-1)/2) + p(y-(lattice-1)/2) <= p(lattice/10);\n  }\n\n  function createMap(size, fn) {\n    return Array.from({length:size}).map(_=> Array.from({length:size}).map(_=> 0));\n  }\n})();\n```\n\n\uff13\u6b21\u5143\u914d\u5217\u3092\u8fd4\u3057\u3066\u3044\u3066\u3001`waveSimulation[frame][i][j]`\u3067frame\u6570\u76ee\u306e(i,j)\u8981\u7d20\u306e\u9ad8\u3055\u304c\u3068\u308c\u307e\u3059\u3002\n\n\u3053\u306e\u95a2\u6570\u306f\u308f\u3056\u308f\u3056\u6ce2\u52d5\u65b9\u7a0b\u5f0f\u3092\u3082\u3068\u306b\u6bce\u30d5\u30ec\u30fc\u30e0\u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u8a08\u7b97\u3057\u3066\u307e\u3059\u3002\n\n\u3061\u3087\u3063\u3068\u3057\u305f\u6570\u5b66\u7684\u306a\u3053\u3068\u306f[\u3053\u3053(http://www.slideshare.net/yusa3)](http://www.slideshare.net/yusa3)\u306b\u7528\u610f\u3057\u307e\u3057\u305f\n\n```js\nlet positionsFrames = [];\nlet facesFrames = [];\nconst simulation = waveSimulation();\nsimulation.forEach((o, i) => {\n  const data = simulation[i];\n  let faces = [];\n  data.forEach((ary, x) => { if (x !== data.length-1) // x\u306e\u53f3\u7aef\u4ee5\u5916\n    ary.forEach((z, y) => { if (y !== ary.length-1) // y\u306e\u4e0b\u7aef\u4ee5\u5916\n      faces.push([x+y*data.length, x+y*data.length+1, x+(y+1)*data.length]);\n    });\n  });\n  data.forEach((ary, x) => { if (x !== 0) // x\u306e\u5de6\u7aef\u4ee5\u5916\n    ary.forEach((z, y) => { if (y !== ary.length-1) // y\u306e\u4e0b\u7aef\u4ee5\u5916\n      faces.push([x+y*data.length, x+(y+1)*data.length, x+(y+1)*data.length-1]);\n    });\n  });\n  faces = Array.prototype.concat.apply([], faces);\n  let positions = [];\n  data.forEach((ary, x) => ary.forEach((y, z) => {\n    positions.push([(x-20)/10,y/10,-(z-20)/10]);\n  }));\n  positionsFrames.push(positions);\n  facesFrames.push(faces);\n});\n```\n\u3081\u3093\u3069\u304f\u3055\u304f\u66f8\u3044\u3066\u308b\u3051\u3069\u3001\u8981\u3059\u308b\u306b\u4e09\u89d2\u5f62\u306e\u7d50\u3073\u65b9\u3068position\u3092\u4f7f\u3044\u3084\u3059\u3044\u5f62\u5f0f\u306b\u306a\u304a\u3057\u3066\u308b\u3060\u3051\u3067\u3059\n\n\n## \u5c55\u671b\n\n\u8fd1\u3044\u3046\u3061\u306b\u30b7\u30a7\u30fc\u30c0\u30fc\u3067\u5b9f\u88c5\u3067\u304d\u305f\u3089advent calendar\u306e\u7d42\u76e4\u3067\u98db\u3073\u5165\u308a\u3057\u3066\u8a18\u4e8b\u66f8\u304f\u304b\u3082\uff1f\n", "tags": ["WebGL", "Grimoire.js"]}