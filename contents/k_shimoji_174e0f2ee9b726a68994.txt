{"context": " More than 1 year has passed since last update. \u7b2c5\u56de\u3067users\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u304c\u3001\u524d\u56de\u4e0d\u53c2\u52a0\u306e\u65b9\u306b\u3001\u6700\u521d\u4f1d\u3048\u6f0f\u308c\u3066\u3044\u307e\u3057\u305f\u306e\u3067\u8ffd\u8a18\u3044\u305f\u3057\u307e\u3057\u305f(\u4e8b\u524d\u6e96\u5099\u306e\u3068\u3053\u308d)\u3002\u3059\u3044\u307e\u305b\u3093\u3067\u3057\u305f!\n\n \u306f\u3058\u3081\u306b\n\u672c\u6295\u7a3f\u306f\u30012015/6/26\u306b\u884c\u308f\u308c\u305f\u3001CakePHP\u3067\u30c7\u30fc\u30bf\u64cd\u4f5c\u301c\u62c5\u5f53\u8005\u30a2\u30b5\u30a4\u30f3\u6a5f\u80fd\u306e\u5b9f\u88c5 - connpass\u306e\u5185\u5bb9\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u8cc7\u6599\u3067\u3059\u3002\n\u4eca\u5f8c\u306e\u4e88\u5b9a\nAWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e - connpass\n\u4eca\u56de\u306f\u3001TODO\u306b\u62c5\u5f53\u8005\u3092\u5272\u308a\u5f53\u3066\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u524d\u56de\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4ed8\u3051\u305f\u306e\u3067\u3001\u8907\u6570\u30e6\u30fc\u30b6\u3067\u4f7f\u7528\u3059\u308b\u611f\u3058\u306b\u3057\u3066\u307f\u307e\u3059\uff01\nCakePHP\u306e\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\n\n CakePHP\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3068\u306f\uff1f\n\u524d\u56de\u307e\u3067\u3001\n\nusers\ntodo_lists\n\n\u306e2\u30c6\u30fc\u30d6\u30eb\u3092\u6271\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057\u3001\u30c6\u30fc\u30d6\u30eb1\u3064\u306e\u5358\u7d14\u306aSelect\u3057\u304b\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001users\u3068todo_lists\u3092\u7d50\u5408\u3057\u3066Select\u3057\u305f\u308a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001CakePHP\u3067\u306f\u3053\u3046\u3044\u3063\u305f\u5834\u5408\u306bSQL\u3092\u76f4\u63a5\u66f8\u304f\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u3092\u7d50\u5408\u3057\u305f\u308a\u3059\u308b\u306e\u3092\u3001SQL\u3067\u306f\u306a\u304f\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u5b66\u3076\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\n\u4eca\u56de\u306f\u4e0b\u8a183\u3064\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002\n\nbelongsTo\nhasOne\nhasMany\n\n \u300chasAndBelongsToMany\u300d\u3068\u3044\u3046\u306e\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n1\u3064\u305a\u3064\u8aac\u660e\u3057\u307e\u3059\u3002\n\nbelongsTo\nA belongsTo B\u3001\u3064\u307e\u308a\u3001A\u306fB\u306b\u5c5e\u3057\u3066\u3044\u308b\u3001\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u9593\u306e\u95a2\u4fc2\u304c\u3042\u308b\u5834\u5408\u3001belongsTo\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u300c\u30e6\u30fc\u30b6(users)\u300d\u30c6\u30fc\u30d6\u30eb\u306b\u3001\u300c\u56fd\u7c4d\u300d\u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3042\u308a\u3001\u300c\u56fd\u7c4d\u30de\u30b9\u30bf(countries)\u300d\u30c6\u30fc\u30d6\u30eb\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\ncountries(id, name)\n\n\u3068\u3057\u307e\u3059\u3002\nuser\u306f\u4e00\u3064\u306e\u56fd\u7c4d\u3092\u3082\u3061\u307e\u3059\u306e\u3067\u3001\n\nusers(id, username, country_id)\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\nusers.country_id \u3068 countries.id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\nSQL\u3067\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\nselect users.id, users.username, countries.name as country_name\nfrom users inner join countries on users.country_id = countries.id\n\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u4f7f\u7528\u3059\u308b\u306e\u304c\u300cbelongsTo\u300d\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\nhasOne\nhasOne\u306f\u3001\u76f8\u624b\u5074\u30c6\u30fc\u30d6\u30eb\u304c1\u4ef6\u3001\u3068\u8a00\u3046\u610f\u5473\u3067belongsTo\u306e\u89aa\u621a\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059\u3002\nbelongsTo\u306e\u4f8b\u3067\u306f\u3001users\u5074\u306bcountries\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u793a\u3059country_id\u3092\u6301\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u306e\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u4fdd\u6301\u3059\u308b\u30c6\u30fc\u30d6\u30eb(profiles)\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\nprofiles(id, user_id, \u81ea\u5df1\u7d39\u4ecb\u6587, \u597d\u304d\u306a\u98df\u3079\u7269, etc...)\n\n\u3053\u306e\u5834\u5408\u3001users\u5074\u3067\u306f\u306a\u304f\u3001profiles\u5074\u306buser_id\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\nusers.id \u3068 profiles.user_id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u4f7f\u7528\u3059\u308b\u306e\u304c\u300chasOne\u300d\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n users\u5074\u306bprofile_id\u3092\u3082\u3064\u3001\u3068\u3044\u3046\u5b9f\u88c5\u3082\u51fa\u6765\u307e\u3059\u304c\u3001\u300c\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u672a\u767b\u9332\u300d\u306e\u5834\u5408\u306b\n\nusers.profile_id\u3092null\u306b\u3059\u308b\u5b9f\u88c5\u306b\u3059\u308b\nusers.id = profies.user_id\u3068\u306a\u308bprofiles\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u306a\u3044\u3060\u3051\n\u306e\u3069\u3061\u3089\u306b\u3059\u308b\u304b\u3068\u8a00\u3046\u8a2d\u8a08\u601d\u60f3\u306e\u9055\u3044\u3067\u3059\u306d\u3002\n\nSQL\u3067\u66f8\u304f\u3068\u3053\u3046\u3067\u3059\u3002\nselect users.id, profiles.\u81ea\u5df1\u7d39\u4ecb\u6587, profiles.\u597d\u304d\u306a\u98df\u3079\u7269\nfrom users inner join profiles on users.id = profiles.user_id\n\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\nhasMany\nhasMany\u306f1:n\u306e\u95a2\u4fc2\u3092\u8868\u3059\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u306e\u8077\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c6\u30fc\u30d6\u30eb(careers)\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\ncareers(id, user_id, \u5165\u793e\u5e74\u5ea6, \u4f1a\u793e\u540d, etc...)\n\n\u3053\u306e\u5834\u5408\u3001users\u306f\u8907\u6570\u306e\u8077\u6b74(career)\u30ec\u30b3\u30fc\u30c9\u3092\u6301\u3066\u308b\u306e\u3067\u3001\nusers.id \u3068 careers.user_id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\nhasOne\u3068\u306e\u9055\u3044\u306f\u3001\u3053\u306e\u6642\u8907\u6570\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u3068\u308c\u3066\u304f\u308b\u3001\u3068\u8a00\u3046\u90e8\u5206\u306e\u307f\u3067\u3059\u3002\nSQL\u3067\u66f8\u304f\u3068\u3001\u901a\u5e38\u306f\u3053\u3046\u3067\u3059\u3002\nselect users.id, careers.\u5165\u793e\u5e74\u5ea6, careers.\u4f1a\u793e\u540d\nfrom users inner join careers on users.id = careers.user_id\n\n\u5b9f\u969b\u306b\u306fCakePHP\u306e\u5834\u5408\u3001users\u306eselect\u3068careers\u306eselect\u304c\u305d\u308c\u305e\u308c\u4e00\u56de\u3001\u8a082\u56de\u306eselect\u304c\u767a\u884c\u3055\u308c\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\n \u4eca\u56de\u306e\u5185\u5bb9\n\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\n\u6a5f\u80fd\u30ea\u30b9\u30c8\n\nTodo\u306e\u8ffd\u52a0\n\n\nTODO\u306e\u5185\u5bb9\u306b\u52a0\u3048\u300c\u305d\u306eTODO\u3092\u8ab0\u304c\u62c5\u5f53\u3059\u308b\u304b\u300d\u3092\u5168\u30e6\u30fc\u30b6\u306e\u30ea\u30b9\u30c8\u304b\u3089\u9078\u629e\u3057\u3066\u6307\u5b9a\u3059\u308b\n\u30e6\u30fc\u30b6\u306e\u30ea\u30b9\u30c8\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u3068\u3059\u308b\u3002\n\n\nTODO\u4e00\u89a7\u306e\u8868\u793a\n\n\nTODO\u8ffd\u52a0\u3092\u5b9f\u884c\u3057\u305f\u30e6\u30fc\u30b6\u3092\u300c\u30aa\u30fc\u30ca\u300d\u3001TODO\u3092\u5272\u308a\u5f53\u3066\u305f\u30e6\u30fc\u30b6\u3092\u300c\u62c5\u5f53\u300d\u3068\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u64cd\u4f5c\u5236\u9650\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\n\u300c\u524a\u9664\u300d\u306f\u30aa\u30fc\u30ca\u306e\u307f\u53ef\u80fd\u3002\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u306a\u3044TODO\u306e\u884c\u306e\u300c\u524a\u9664\u300d\u30ea\u30f3\u30af\u306f\u8868\u793a\u3057\u306a\u3044\u3002\n\u300c\u8a73\u7d30\u300d\u306e\u8868\u793a\u306f\u30aa\u30fc\u30ca\u307e\u305f\u306f\u62c5\u5f53\u306e\u307f\u53ef\u80fd\u3002\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u306f\u300c\u8a73\u7d30\u300d\u30ea\u30f3\u30af\u306f\u8868\u793a\u3057\u306a\u3044\u3002\n\n\n\n\nTODO\u8a73\u7d30\n\n\n\u62c5\u5f53\u8005\u306e\u5909\u66f4\u3092\u53ef\u80fd\u3068\u3059\u308b\u3002\n\n\n\n\n\u753b\u9762\n\nTODO\u4e00\u89a7\u753b\u9762\n\n\n\nTODO\u8a73\u7d30\u753b\u9762\n\n\n\n \u4e8b\u524d\u6e96\u5099\n\u4e8b\u524d\u6e96\u5099\u306f\u6bce\u56de\u540c\u3058\u306a\u306e\u3067\u3001\u5225\u30a8\u30f3\u30c8\u30ea\u306b\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\u516812\u56de\u306e\u52c9\u5f37\u4f1a\u3067\u3084\u3063\u3066\u3044\u308bGit\u306e\u4f7f\u3044\u65b9 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e - Qiita\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3084\u308b\u3053\u3068\u306f\u3001\n\ngit\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u6574\u3048\u3066\u4eca\u56de\u7528\u30d6\u30e9\u30f3\u30c1vol/06\u3092\u4f5c\u6210\u3059\u308b\n\n\u3067\u3059\u3002\u307e\u305a\u3053\u308c\u3092\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n\u305d\u308c\u3068\u3001\u524d\u56deusers\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u304c\u3001\u524d\u56de\u4e0d\u53c2\u52a0\u306e\u65b9\u306f\u305d\u3063\u3061\u3082\u3084\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3061\u3089\u3092\u53c2\u7167\u4e0b\u3055\u3044\u3002\n\u4eca\u56de\u306f\u3055\u3089\u306b\u3001\ntodo_lists\u30c6\u30fc\u30d6\u30eb\u306b\u3001\n\n\u30aa\u30fc\u30ca\u306e\u30e6\u30fc\u30b6ID(owner)\n\u62c5\u5f53\u306e\u30e6\u30fc\u30b6ID(assignee)\n\n\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nTODO\u4e00\u89a7\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u5217\u8ffd\u52a0\n\u307e\u305a\u3001phpMyAdmin\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u3087\u3046\u3002\nURL\u306f\u3001http://(PublicIP)/phpMyAdmin/\u3067\u3059\u3002\n\u5909\u66f4\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u30e6\u30fc\u30b6\u540dstudy\u3001\u30d1\u30b9\u30ef\u30fc\u30c9study\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\n\n\u5404\u5217\u306e\u8a2d\u5b9a\n\n\n\n\u540d\u524d\n\u30c7\u30fc\u30bf\u578b\n\u9577\u3055/\u5024\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\n\u7167\u5408\u9806\u5e8f\n\u5c5e\u6027\nNULL\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nA_I(AutoIncrement)\n\u30b3\u30e1\u30f3\u30c8\n\n\n\n\nowner\nINT\n10\n\u306a\u3057\n\u3000\nUNSIGNED\n\u3000\n\u3000\n\u3000\n\u30aa\u30fc\u30ca\n\n\nassignee\nINT\n10\n\u306a\u3057\n\u3000\nUNSIGNED\n\u3000\n\u3000\n\u3000\n\u62c5\u5f53\n\n\n\n\n\u6e96\u5099\n\u3067\u306f\u3001\u6e96\u5099\u3092\u59cb\u3081\u307e\u3057\u3087\u3046\uff01\n\n\n Git\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u6574\u3048\u3066\u3001vol/06\u30d6\u30e9\u30f3\u30c1\u3092\u4f5c\u6210\u3002\n\n TODO\u4e00\u89a7(todo_lists)\u30c6\u30fc\u30d6\u30eb\u306b\u5217\u3092\u8ffd\u52a0\u3002\n\n\u6e96\u5099\u304c\u3067\u304d\u305f\u3089\u3001Lesson1\u3067\u3059\uff01\n\n Lesson1 \u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\nLesson1\u3067\u306f\u3001\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30c6\u30b9\u30c8\u306b\u306f\u3001\u7b2c1\u56de\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u300cPOSTMAN\u300d\u3092\u4f7f\u7528\u3057\u3066API\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30dd\u30a4\u30f3\u30c8\n\u4eca\u56de\u306e\u30c6\u30fc\u30de\u306f\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u3067\u3059\u304c\u3001\u524d\u8ff0\u306e3\u3064\u306e\u3046\u3061\u3001\u5b9f\u306f\u300cbelongsTo\u300d\u3060\u3051\u3067\u4eca\u56de\u306e\u6a5f\u80fd\u306f\u5b9f\u73fe\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u308c\u3060\u3051\u3067\u306f\u9762\u767d\u304f\u7121\u3044\u306e\u3067\u3001\u300chasOne\u300d\u3068\u300chasMany\u300d\u3082\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001belognsTo\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u3092\u3057\u307e\u3059\u3002\n\n\u7de8\u96c6\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n\n\n\n\u7de8\u96c6\nfile\n\u7de8\u96c6\u6982\u8981\n\n\n\n\n\u4fee\u6b63\napp/Controller/TodoListsController.php\nfind\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a2d\u5b9a\n\n\n\u4fee\u6b63\napp/Model/TodoList.php\n\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\n\n\u4fee\u6b63\napp/Controller/UsersController.php\n\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u53d6\u5f97\n\n\n\n\nTodoListsController.php\nTodoList\u30e2\u30c7\u30eb\u306efind\u95a2\u6570\u5b9f\u884c\u3058\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nTodoListsController.php\n\u301c\u7565\u301c\n class TodoListsController extends AppController {\n\n    public function index() {\n-       $res = $this->TodoList->find('all');\n+       $query = array (\n+           'fields' => array (\n+               'TodoList.id',\n+               'TodoList.todo',\n+               'TodoList.status',\n+               'Owner.id',\n+               'Owner.name',\n+               'Assignee.id',\n+               'Assignee.name'\n+           ),\n+           'order' => \"TodoList.id\"\n+       );\n+       $res = $this->TodoList->find('all', $query);\n+       // \u6574\u5f62\n+       if (count($res) > 0) {\n+           $loginUserId = $this->Auth->user()['id'];\n+           foreach ( $res as $key => $row ) {\n+               //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n+               $res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n+               //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n+               $res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n+           }\n+       }\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n    public function view($id = null) {\n        $res = $this->TodoList->findById($id);\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n    public function add() {\n        $data = $this->request->data;\n+       $data['owner'] = $this->Auth->user()['id'];\n        $res = $this->TodoList->save($data);\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nfind\u95a2\u6570\u306b\u5f15\u6570\u8ffd\u52a0\n\n\u7b2c\u4e8c\u5f15\u6570$query\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002$query\u306f\u914d\u5217\u3067\u3001\u4e0b\u8a18\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\nfields\n\n\u53d6\u5f97\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u5217\u3002\u3053\u308c\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u7b49\u3082\u3068\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u5fc5\u8981\u306a\u7269\u306e\u307f\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\norder\n\n\u3064\u3044\u3067\u306b\u30c7\u30fc\u30bf\u306e\u4e26\u3073\u9806\u3082\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002todo_lists\u30c6\u30fc\u30d6\u30eb\u306eid\u306e\u6607\u9806\u3067\u3059\u3002\n\n\n\n\n\n\n\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u6574\u5f62\n\n\u53d6\u5f97\u3057\u305f1\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u306b\u3064\u3044\u3066\u3001\n\n\n\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u5834\u5408\u3001owned = true\u306b\u8a2d\u5b9a\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408owned = false\u306b\u8a2d\u5b9a\u3002\n\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u5834\u5408\u3001assigned = true\u306b\u8a2d\u5b9a\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408assigned = false\u306b\u8a2d\u5b9a\u3002\n\n\n\n\nTodoList.php\n\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\nTodoList.php\n class TodoList extends AppModel {\n+   public $belongsTo = array (\n+       'Owner' => array (\n+           'className' => 'User',\n+           'foreignKey' => 'owner',\n+       ),\n+       'Assignee' => array (\n+           'className' => 'User',\n+           'foreignKey' => 'assignee'\n+       )\n+   );\n }\n\n\n\nbelongsTo\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\n\nTODO\u4e00\u4ef6\u306b\u5bfe\u3059\u308b\u3001\n\n\n\u30aa\u30fc\u30ca\u306e\u30e6\u30fc\u30b6\u60c5\u5831\n\u62c5\u5f53\u306e\u30e6\u30fc\u30b6\u60c5\u5831\n\n\n\n\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n\u30e2\u30c7\u30eb\u306e\u5909\u6570\u306b$belongsTo\u3068\u3044\u3046\u5909\u6570\u540d\u3067\u914d\u5217\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\nOwner(\u30aa\u30fc\u30ca), Assignee(\u62c5\u5f53)\u3068\u3044\u3046\u540d\u524d\u30672\u3064\u306eusers\u30c6\u30fc\u30d6\u30eb\u3092\u7d10\u3064\u3051\u3066\u3044\u307e\u3059\u3002\n\u305d\u306e\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30(Owner)\n\n\n\nclassName -> \u30e2\u30c7\u30eb\u540d(User)\nusers\u306b\u5bfe\u3059\u308b\u5916\u90e8\u30ad\u30fc(todo_lists.owner\u3092\u6307\u5b9a)\n\n\n\u305d\u306e\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30(Assignee)\n\n\n\nclassName -> \u30e2\u30c7\u30eb\u540d(User)\nusers\u306b\u5bfe\u3059\u308b\u5916\u90e8\u30ad\u30fc(todo_lists.assignee\u3092\u6307\u5b9a)\n\n\n\n\n\n\nadd\u30e1\u30bd\u30c3\u30c9\n\n\nowner\u306b\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306eID\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\u3053\u308c\u3067\u3001TODO\u306e\u8ffd\u52a0\u64cd\u4f5c\u3092\u3057\u305f\u969b\u306e\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3068\u3057\u3066\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n\n\n\nUsersController.php\n\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a4\u30f3\u6e08\u307f\u30c1\u30a7\u30c3\u30af\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3001\u30e6\u30fc\u30b6\u767b\u9332\u306e\u5b9f\u88c5\u3067\u3059\u3002\n\nUsersController.php\n class UsersController extends AppController {\n\n+   public function index() {\n+       $res = $this->User->find('all', array (\n+           'fields' => array (\n+               'User.id',\n+               'User.username',\n+               'User.name'\n+           )\n+       ));\n+       $this->set(compact('res'));\n+       $this->set('_serialize', 'res');\n+   }\n+\n    public function login() {\n        $user = $this->Auth->user();\n        $res = array();\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n\n\n\nindex\u95a2\u6570\n\n\nTodoListController.php\u3068\u540c\u3058\u5bb9\u91cf\u3067\u3001find\u95a2\u6570\u3067\u53d6\u5f97\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u7d5e\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u3000\u52d5\u4f5c\u78ba\u8a8d\nPOSTMAN\u3067\u3001TODO\u4e00\u89a7\u53d6\u5f97API(http://(PublicIP)/rest-study/todo_lists.json)\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u53d6\u5f97\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\nbelongsTo\u304c\u52b9\u3044\u3066\u3044\u307e\u3059\u3002\n[\n    {\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"Assignee\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": false\n        },\n        \"Owner\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"Assignee\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owned\": false,\n            \"assigned\": false\n        },\n        \"Owner\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"Assignee\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        }\n    }\n]\n\n\n\u5b9f\u88c5\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u4fee\u6b63\u3057\u3066\u4e0a\u8a18\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n app/Controller/TodoListsController.php \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/Model/TodoList.php \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/Controller/UsersController.php \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n \u52d5\u4f5c\u78ba\u8a8d!\n\n Git\u306b\u30b3\u30df\u30c3\u30c8\n\nGitHub\u3067\u306ediff\u8868\u793a\u3078\u306e\u30ea\u30f3\u30af\n\u7b2c6\u56de Lesson1 \u30b5\u30fc\u30d0\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@d4fe1a4\nLesson1.5\u3078!\n\n Lesson1.5 \u4ed6\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a66\u3059\u3002\n\u4eca\u56de\u5b9f\u88c5\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u306fLesson1\u306e\u5b9f\u88c5\u3067OK\u3067\u3059\u3002\nLesson2\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u5b9f\u88c5\u306b\u5165\u308b\u524d\u306b\u3001hasOne\u3068hasMany\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3082\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u30bd\u30fc\u30b9\u3092\u4fee\u6b63\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u5f8c\u3001\u5143\u306b\u623b\u3057\u3066Lesson2\u3078\u884c\u304d\u307e\u3057\u3087\u3046\u3002\n\u30c6\u30b9\u30c8\u3067\u306f\u3001\u4e0b\u8a18\u306e\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3067\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3092\u8f09\u305b\u3066\u3044\u307e\u3059\u3002\n\n\u30e6\u30fc\u30b6\u306f\u3001\n\n\u5c71\u7530\u592a\u90ce\n\u7530\u4e2d\u82b1\u5b50\n\u4f50\u85e4\u4e00\u90ce\n\n\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4f50\u85e4\u4e00\u90ce\u3055\u3093\u306f\u307e\u3060TODO\u304c1\u4ef6\u3082\u306a\u3044(\u81ea\u5206\u304c\u30aa\u30fc\u30ca\u306e\u3082\u306e\u3082\u3001\u62c5\u5f53\u3068\u3057\u3066\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u305f\u3082\u306e\u3082\uff09\u72b6\u614b\u3067\u3059\u3002\n\nhasOne\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\u3042\u308b\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3068\u306a\u3063\u3066\u3044\u308bTODO\u3092\u53d6\u5f97\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8003\u3048\u307e\u3059\u3002\nuser : todo \u306f 1 : n\u306b\u306a\u308b\u306e\u3067\u672c\u6765\u306fhasMany\u3092\u4f7f\u7528\u3059\u308b\u5834\u9762\u3067\u3059\u3002\n\u3061\u3087\u3063\u3068\u7121\u7406\u77e2\u7406\u3067\u3059\u304c\u3001\u300c\u7530\u4e2d\u82b1\u5b50\u3055\u3093\u300d\u304c\u30aa\u30fc\u30ca\u306eTODO\u306f1\u4ef6\u306a\u306e\u3067\u3001\u7530\u4e2d\u82b1\u5b50\u3055\u3093\u306eTODO\u304c\u3061\u3083\u3093\u3068\u53d6\u308c\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30bd\u30fc\u30b9\u4fee\u6b63\u7b87\u6240\n\napp/Controller/UsersController.php\u306eindex\u95a2\u6570\u3092\u4fee\u6b63\u3002\n\napp/Controller/UsersController.php\n    public function index() {\n        $res = $this->User->find('all');    //fields\u306e\u6307\u5b9a\u3092\u5916\u3059\u3002\u4e0b\u8a18\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n//      $res = $this->User->find('all', array (\n//          'fields' => array (\n//              'User.id',\n//              'User.username',\n//              'User.name'\n//          )\n//      ));\n        $this->set(compact('res'));\n        $this->set('_serialize', 'res');\n    }\n\n\n\n\n\napp/Model/User.php\u306b\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002\n\napp/Model/User.php\nclass User extends AppModel {\n    public $hasOne = array (\n        'TodoList' => array (\n            'className' => 'TodoList',\n            'foreignKey' => 'owner'\n        )\n    );\n}\n\n\n\u3055\u3066\u3001\u30e6\u30fc\u30b6\u53d6\u5f97API(http://(PublicIP)/rest-study/users.json)\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u3087\u3046\uff01\n\n\u5b9f\u884c\u7d50\u679c\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"67\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owner\": \"68\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": null,\n            \"todo\": null,\n            \"status\": null,\n            \"owner\": null,\n            \"assignee\": null\n        }\n    }\n]\n\n\n\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u30661\u4ef6\u306eTODO\u304c\u7d10\u3064\u3044\u3066\u3044\u307e\u3059\u306d\uff01\n1\u4ef6\u3082TODO\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u5404\u9805\u76ee\u304cnull\u306e\u914d\u5217\u304c\u4e00\u500b\u51fa\u6765\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u6642\u5b9f\u884c\u3055\u308c\u305fSQL\u306f\u4e0b\u8a18\u3067\u3059\u3002hasMany\u3067\u306f\u4e00\u56de\u306e\u5b9f\u884c\u3067SQL\u304c2\u56de\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\nSELECT\n    `User`.`id`,\n    `User`.`username`, \n    `User`.`password`, \n    `User`.`name`, \n    `TodoList`.`id`, \n    `TodoList`.`todo`, \n    `TodoList`.`status`, \n    `TodoList`.`owner`, \n    `TodoList`.`assignee` \nFROM `study`.`users` AS `User` \n        LEFT JOIN `study`.`todo_lists` AS `TodoList` ON (`TodoList`.`owner` = `User`.`id`)  \nWHERE 1 = 1\n\n\u8b0e\u306eWHERE 1 = 1\u304c\u3064\u3044\u3066\u307e\u3059\u304c\u3053\u3046\u3044\u3046SQL\u3067\u3059\u3002\u666e\u901a\u306bJOIN\u3057\u3066\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\nhasMany\u3092\u30c6\u30b9\u30c8\u3059\u308b\nuser : todo \u306f 1 : n\u306b\u306a\u308b\u306e\u3067\u672c\u6765\u306ehasMany\u306e\u4f7f\u3044\u30c9\u30b3\u30ed\u3067\u3059\u3002\n\n\u30bd\u30fc\u30ba\u4fee\u6b63\u7b87\u6240\napp/Controller/UsersController.php\u306fhasOne\u3067\u4fee\u6b63\u3057\u305f\u72b6\u614b\u3067\u7f6e\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\napp/Model/User.php\u306b\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002\n\napp/Model/User.php\nclass User extends AppModel {\n    public $hasMany = array (\n        'TodoList' => array (\n            'className' => 'TodoList',\n            'foreignKey' => 'owner'\n        )\n    );\n}\n\n\nhasOne\u3092hasMany\u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\uff01\n\u3067\u306f\u5b9f\u9a13\u3002\n\n\u5b9f\u884c\u7d50\u679c\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"62\",\n                \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"67\"\n            },\n            {\n                \"id\": \"78\",\n                \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"83\",\n                \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n                \"status\": \"1\",\n                \"owner\": \"68\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": []\n    }\n]\n\n\n\u3053\u3046\u306a\u308a\u307e\u3057\u305f\uff01\u3061\u3083\u3093\u3068\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066TODO\u304c\u8907\u6570\u4ef6\u7d10\u3064\u3044\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u304chasMany\u3067\u3059\u306d\u3002\n\u3053\u306e\u6642\u5b9f\u884c\u3055\u308c\u305fSQL\u306f\u4e0b\u8a182\u3064\u3067\u3059\u3002hasMany\u3067\u306f\u4e00\u56de\u306e\u5b9f\u884c\u3067SQL\u304c2\u56de\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n1\u56de\u76ee\nSELECT `User`.`id`, `User`.`username`, `User`.`password`, `User`.`name` FROM `study`.`users` AS `User`   WHERE 1 = 1\n\n\n\n2\u56de\u76ee\nSELECT `TodoList`.`id`, `TodoList`.`todo`, `TodoList`.`status`, `TodoList`.`owner`, `TodoList`.`assignee` FROM `study`.`todo_lists` AS `TodoList`   WHERE `TodoList`.`owner` IN (67, 68, 69)\n\n\n2\u56de\u76ee\u306f\u30011\u56de\u76ee\u3067\u53d6\u5f97\u3057\u305fuser\u306eid\u3092owner\u306b\u6301\u3064TodoList\u3092select\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3046\u3044\u3046\u5b9f\u88c5\u306b\u306a\u3063\u3066\u308b\u3093\u3067\u3059\u306d\u3002\n\u3067\u306f\u3001\u4fee\u6b63\u3057\u305f\u3068\u3053\u308d\u3092\u5143\u306b\u623b\u3057\u3066\u3001lesson2\u3001 \u753b\u9762\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n Lesson2 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\nLesson2\u3067\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\u30dd\u30a4\u30f3\u30c8\n\u524d\u56de\u307e\u3067\u306e\u77e5\u8b58\u3067\u307b\u307c\u958b\u767a\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u3001\u4e0b\u8a18\u306e\u300c\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u8868\u793a\u3059\u308b\u300d\u90e8\u5206\u3060\u3051\u5c11\u3057\u89e3\u8aac\u3057\u307e\u3059\u3002\n\nTODO\u4e00\u89a7\u753b\u9762\u306e\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n\n\nTODO\u8a73\u7d30\u753b\u9762\u306e\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n\n\n\u4eca\u56de\u306e\u5b9f\u88c5\nBackbone\u3001Marionette\u3092\u30d5\u30eb\u6d3b\u7528\u3059\u308b\u306a\u3089\u3001\u672c\u6765\u306f\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u90e8\u5206\u3092View\u306b\u3057\u3001\u300cBehavior\u300d\u6a5f\u80fd\u3092\u4f7f\u3046\u306a\u3069\u3057\u3066\u5171\u901a\u5316\u3059\u308b\u3068\u3044\u3044\u611f\u3058\u306a\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u306f\u300cCakePHP\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u306a\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u7c21\u5358\uff08\u624b\u629c\u304d\uff1f\uff09\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3054\u4e86\u627f\u4e0b\u3055\u3044\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\n\u30e6\u30fc\u30b6\u53d6\u5f97API(http://(PublicIP)/rest-study/users.json)\u3092\u53e9\u3044\u3066collection\u306b\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u53d6\u5f97\n\u305d\u306ecollecton\u3092\u30eb\u30fc\u30d7\u3067\u51e6\u7406\u3057\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u7528\u610f\u3057\u3066\u3044\u308b<select></select>\u30bf\u30b0\u306e\u4e2d\u306b\u3001<option value=\"\u30e6\u30fc\u30b6\u306eid\">\u30e6\u30fc\u30b6\u306e\u6c0f\u540d</option>\u3068\u3044\u3046\u30bf\u30b0\u3092JQuery\u3092\u4f7f\u3063\u3066\u306f\u3081\u8fbc\u3093\u3067\u3044\u304f\u3002\n\n\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3059\u3002\n\u3053\u308c\u3092\u3001TODO\u4e00\u89a7\u3068TODO\u8a73\u7d30\u306e\u4e21\u753b\u9762\u3067\u300c\u30b3\u30d4\u30da\u300d\u3057\u3066\u3044\u307e\u3059\u3002\n(DRY\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u4eca\u56de\u306f\u3054\u52d8\u5f01\uff01)\n\u3067\u306f\u3001\u30bd\u30fc\u30b9\u89e3\u8aac\u3067\u3059\u3002\n\n\u7de8\u96c6\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n\n\n\n\u7de8\u96c6\nfile\n\u7de8\u96c6\u6982\u8981\n\n\n\n\n\u4fee\u6b63\napp/View/Layouts/default.ctp\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4fee\u6b63\n\n\n\u65b0\u898f\napp/webroot/js/collections/user-collection.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u7528collection\n\n\n\u4fee\u6b63\napp/webroot/js/models/todo-model.js\n\u8ffd\u52a0\u9805\u76ee\u306eparse\n\n\n\u4fee\u6b63\napp/webroot/js/views/todo-layout-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\n\n\n\u4fee\u6b63\napp/webroot/js/views/todo-composite-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n\n\u4fee\u6b63\napp/webroot/js/views/todo-item-view.js\n\u524a\u9664\u30fb\u8a73\u7d30\u30dc\u30bf\u30f3\u306e\u8868\u793a\u5236\u5fa1\n\n\n\u4fee\u6b63\napp/webroot/js/views/todo-detail-layout-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\n\n\n\u4fee\u6b63\napp/webroot/js/views/todo-detail-item-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n\n\n\ndefault.ctp\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4fee\u6b63\u3002\n\ndefault.ctp\n\n\u301c\u3000\u7565\u3000\u301c\n  <title>\u30b7\u30f3\u30d7\u30ebTODO\u30a2\u30d7\u30ea</title>\n </head>\n <body>\n    <!-- \u30d8\u30c3\u30c0 -->\n    <div id=\"header\"></div>\n    <!-- \u30b3\u30f3\u30c6\u30f3\u30c4 -->\n    <div id=\"main\"></div>\n\n\u301c\u3000\u7565\u3000\u301c\n\n    <!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-composite-template\">\n    <textarea style=\"width:300px;height:50px\"id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n+   <select name=\"assignee\" id=\"user-list\">\n    <input type=\"button\" id=\"addTodo\" value=\"\u8ffd\u52a0\">\n    <hr>\n    <div>\n        <table border=\"1\" width=\"350px\">\n+           <thead>\n+               <tr>\n+                   <td>\u5b8c\u4e86</td>\n+                   <td>ToDo</td>\n+                   <td>\u30aa\u30fc\u30ca</td>\n+                   <td>\u62c5\u5f53</td>\n+                   <td colspan=\"2\"></td>\n+               </tr>\n+           </thead>\n            <tbody></tbody>\n        </table>\n    </div>\n    </script>\n\n    <!-- TODO\u4e00\u884c\u5206\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08\u4e0a\u306etbody\u90e8\u5206\u306b\u633f\u5165\u3055\u308c\u308b\uff09 -->\n    <script type=\"text/template\" id=\"todo-item-template\">\n    <td><input type=\"checkbox\" class=\"toggle\" <%- status === '1' ? 'checked' : '' %>></td>\n    <td style=\"margin:0px\">\n        <span class=\"todo-edit\" style=\"margin:0px\"><%- todo %></span>\n    </td>\n    <td>\n+       <span><%- Owner.name %></span>\n+   </td>\n+   <td>\n+       <span><%- Assignee.name %></span>\n+   </td>\n+   <td>\n        <a class=\"remove-link\" href=\"#\">\u524a\u9664</a>\n+   </td>\n+   <td>\n        <a class=\"detail-link\" href=\"#todo-lists/<%- id %>\">\u8a73\u7d30</a>\n    </td>\n    </script>\n\n    <!-- \u8a73\u7d30\u753b\u9762\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-detail-layout-template\">\n    <div id=\"todo-item\"></div>\n    </script>\n\n    <!-- \u8a73\u7d30\u753b\u9762\u306e\u8868\u793a\u5185\u5bb9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n    <script type=\"text/template\" id=\"todo-detail-item-template\">\n    <h2>Todo #<%- id %></h2>\n    <div>\n    <textarea style=\"width:300px;height:50px\" id=\"edit-todo\" autofocus placeholder=\"Todo?\"><%- todo %></textarea>\n+   <select name=\"assignee\" id=\"user-list\">\n+   </select>\n    <input type=\"button\" id=\"updateTodo\" value=\"\u66f4\u65b0\"></input>\n    <input type=\"button\" id=\"updateCancel\" value=\"\u30ad\u30e3\u30f3\u30bb\u30eb\"></input>\n    </div>\n    </script>\n\n\u301c\u3000\u7565\u3000\u301c\n\n\n\u4e0b\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\nTODO\u4e00\u89a7\u753b\u9762\n\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u7528<select></select>\u3092\u8ffd\u52a0\ntable\u306b<thead></thead>\u3092\u8ffd\u52a0(\u9805\u76ee\u304c\u5897\u3048\u3066\u304d\u305f\u306e\u3067)\n[\u524a\u9664]\u3068[\u8a73\u7d30]\u3092\u5225\u306e<td></td>\u306b\u5206\u5272\n\n\nTODO\u8a73\u7d30\u753b\u9762\n\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u7528<select></select>\u3092\u8ffd\u52a0\n\n\n\n\nuser-collection.js\n\nuser-collection.js\n//User\u4e00\u89a7\u8868\u793a\u7528\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\ndefine(function(require) {\n    var UserModel = require('models/user-model');\n\n    var UserCollection = Backbone.Collection.extend({\n        url : '/rest-study/users.json',\n        model : UserModel,\n\n        parse : function(response) {\n            return response;\n        }\n    });\n\n    return UserCollection;\n});\n\n\n\u5fc5\u8981\u6700\u4f4e\u9650\u306ecollection\u306e\u5b9f\u88c5\u3067\u3059\u3002\n\u3053\u308c\u306f\u3082\u3046\u8aac\u660e\u4e0d\u8981\u3067\u3059\u306d\uff01\n\ntodo-model.js\n\u8ffd\u52a0\u9805\u76ee\u306eOwner\u3068Assignee\u3092\u30d1\u30fc\u30b9\u3057\u3066\u3044\u307e\u3059\u3002\n\ntodo-model.js\n //Todo\u30c7\u30fc\u30bf\uff11\u4ef6\u3092\u8868\u3059\u30e2\u30c7\u30eb\n define(function() {\n    var TodoModel = Backbone.Model.extend({\n        urlRoot : '/rest-study/todo_lists',\n        parse : function(response) {\n            //\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\n            console.log(\"\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\");\n            console.log(response);\n-           return response.TodoList;\n+           var parsed = response.TodoList;\n+           if (response.Owner) {\n+               parsed.Owner = response.Owner;\n+               parsed.Assignee = response.Assignee;\n+           }\n+           return parsed;\n        },\n        toggle : function() {\n            this.set('status', this.get(\"status\") === '1' ? '0' : '1');\n            this.save();\n        }\n    });\n    return TodoModel;\n });\n\n\n\u30b5\u30fc\u30d0\u304b\u3089\u306fCakePHP\u4efb\u305b\u306e\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067TODO1\u4ef6\u306eJSON\u304c\u6765\u308b\u306e\u3067\u3001\n\n\u30b5\u30fc\u30d0\u304b\u3089\u6765\u305f\u751f\u306e\u72b6\u614b\n{\n    \"TodoList\": {\n        \"id\": \"62\",\n        \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n        \"status\": \"0\",\n        \"owned\": false,\n        \"assigned\": false\n    },\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    }\n}\n\n\n\u3053\u3093\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u51e6\u7406\u3057\u3084\u3059\u3044\u3088\u3046\u6574\u5f62\n{\n    \"id\": \"62\",\n    \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n    \"status\": \"0\",\n    \"owned\": false,\n    \"assigned\": false,\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    }\n}\n\n\n\ntodo-layout-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\ntodo-layout-view.js\n define(function(require){\n    var TodoCompositeView = require('views/todo-composite-view');\n    var TodoCollection = require('collections/todo-collection');\n+   var UserCollection = require('collections/user-collection');\n\n    var TodoLayoutView = Marionette.LayoutView.extend({\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template: '#todo-layout-template',\n\n        regions : {\n            listRegion : '#todo-lists',\n        },\n\n-       onRender : function(){\n+       onRender : function() {\n+           this.userCollection = new UserCollection();\n+           this.listenTo(this.userCollection, 'reset', this.onLoadUsers, this);\n+           this.userCollection.fetch({reset : true});\n+       },\n+\n+       onLoadUsers : function(userCollection) {\n            var todoCollection = new TodoCollection();\n            this.listenTo(todoCollection , 'reset', this.showTodoList, this);\n            todoCollection.fetch({reset : true});\n        },\n\n        showTodoList : function(todoCollection){\n            this.listRegion.show( new TodoCompositeView({\n-               collection : todoCollection\n+               collection : todoCollection,\n+               userList : this.userCollection.models\n            }));\n        },\n\n    });\n    return TodoLayoutView;\n });\n\n\n\n\ncollections/user-collection\u3092require\u3067\u8aad\u307f\u8fbc\u3080\n\nonRender\u95a2\u6570\u5185\u3067\u3001this.userCollection.fetch()\u3067\u30b5\u30fc\u30d0\u304b\u3089\u30e6\u30fc\u30b6\u4e00\u89a7\u53d6\u5f97\u3002\nfetch\u304c\u7d42\u308f\u308b\u3068(ListenTo\u304c\u52b9\u3044\u3066)onLoadUsers\u95a2\u6570\u3092\u5b9f\u884c\u3001\u7d9a\u3044\u3066showTodoList\u304c\u5b9f\u884c\u3055\u308c\u308b\n\nshowTodoList\u95a2\u6570\u5185\u3067\u3001TodoCompositeView\u306e\u521d\u671f\u5316\u6642\u306b\u3001\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u4e00\u89a7\u306ecollection\u3092\u6e21\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\n\n\u3053\u306e\u30e6\u30fc\u30b6\u4e00\u89a7collection\u3092TodoCompositeView\u306e\u51e6\u7406\u3067\u8868\u793a\u3059\u308b\u308f\u3051\u3067\u3059\u3002\n\n\n\n\ntodo-composite-view.js\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\ntodo-composite-view.js\n //Todo\u4e00\u89a7\u8868\u793a\u7528\u30d3\u30e5\u30fc\n define(function(require) {\n    var TodoItemView = require('views/todo-item-view');\n\n    var TodoCompositeView = Marionette.CompositeView.extend({\n        template: '#todo-composite-template',\n\n        childView : TodoItemView,\n\n        childViewContainer : 'tbody',\n\n        ui : {\n            addTodo : '#addTodo',\n-           newTodo : '#new-todo'\n+           newTodo : '#new-todo',\n+           userList : '#user-list'\n        },\n\n        events : {\n            'click @ui.addTodo' : 'onCreateTodo',\n        },\n\n-       initialize: function(){\n+       initialize: function(options){\n            _.bindAll( this, 'onCreatedSuccess' );\n+           this.userList = options.userList;\n        },\n\n+       onRender : function() {\n+           //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+           this.showUserList(this.ui.userList, this.userList);\n+           //\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+           this.ui.userList.val(window.application.loginUser.id);\n+       },\n+                   \n+       //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+       showUserList : function($list, userList){\n+           $.each(userList, function(index, userModel) {\n+               $list.append(\n+                   \"<option value='\" \n+                   + userModel.attributes.id + \"'>\"\n+                   + userModel.attributes.name + \"</option>\");\n+           });\n+       },\n+           \n        onCreateTodo : function() {\n            this.collection.create(this.newAttributes(), {\n                  silent:  true ,\n                  success: this.onCreatedSuccess\n            });\n            this.ui.newTodo.val('');\n        },\n\n        newAttributes : function() {\n            return {\n                todo : this.ui.newTodo.val().trim(),\n-               status : 0\n+               status : 0,\n+               assignee : this.ui.userList.val()\n            };\n        },\n\n        onCreatedSuccess : function(){\n            this.collection.fetch({ reset : true });\n        },\n\n    });\n    return TodoCompositeView;\n });\n\n\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081ui\u5909\u6570\u306buserList\u3092\u8ffd\u52a0\u3002\n\ninitialize\u95a2\u6570\u5185\u3067\u3001todo-layout-view\u304b\u3089\u6e21\u3055\u308c\u305f\u30e6\u30fc\u30b6\u4e00\u89a7collection(options.userList\u306b\u5165\u3063\u3066\u304f\u308b)\u3092\u81ea\u8eab\u306e\u4e2d(this.userList\u306b\u4fdd\u6301)\n\nonRender\u95a2\u6570\u5185\u3067\u3001showUserList\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u3092\u884c\u3046\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u5f8c\u3001\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u7d30\u3093\u3057\u3066\u3044\u308bwindow.application.loginUser\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306eid\u3092\u53d6\u5f97\u3057\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u3067\u81ea\u5206\uff08\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\uff09\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u305f\u72b6\u614b\u306b\u8a2d\u5b9a\u3002\n\nshowUserList\u95a2\u6570\u3067\u306f\u3001jquery\u3092\u4f7f\u7528\u3057\u3001ui\u5909\u6570\u3067\u5b9a\u7fa9\u6e08\u307f\u306e<select></select>\u30bf\u30b0\u306e\u4e2d\u306b<option></option>\u30bf\u30b0\u3092\u57cb\u3081\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\ntodo\u306e\u65b0\u898f\u8ffd\u52a0\u6642(newAttributes\u95a2\u6570)\u306f\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u3067\u9078\u629e\u3057\u305f\u30e6\u30fc\u30b6\u3092\u62c5\u5f53\u8005(assignee)\u3092\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\ntodo-item-view.js\n\u524a\u9664\u30fb\u8a73\u7d30\u30dc\u30bf\u30f3\u306e\u8868\u793a\u5236\u5fa1\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\ntodo-item-view.js\n //Todo\u4e00\u89a7\u306e1\u4ef6\u8868\u793a\u7528\u30d3\u30e5\u30fc\n define(function(){\n    var TodoItemView = Marionette.ItemView.extend({\n        //DOM\u306b\u8981\u7d20\u8ffd\u52a0\u306e\u30bf\u30b0\u540d\n        tagName : 'tr',\n\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template : '#todo-item-template',\n\n        ui : {\n            checkBox : '.toggle',\n-           removeLink : '.remove-link'\n+           removeLink : '.remove-link',\n+           detailLink : '.detail-link'\n        },\n\n        //DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n        events : {\n            //\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.checkBox' : 'onStatusToggleClick',\n            //\u524a\u9664\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.removeLink' : 'onRemoveClick',\n        },\n\n        onStatusToggleClick : function() {\n            this.model.toggle();\n        },\n\n        onRemoveClick : function() {\n            this.model.destroy({\n                wait : true\n            });\n        },\n\n+       onRender : function() {\n+           if (!this.model.attributes.owned) {\n+               //\u30aa\u30fc\u30ca\u3067\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u30ea\u30f3\u30af\u975e\u8868\u793a\n+               this.ui.removeLink.css({\n+                   display : 'none'\n+               });\n+               if (!this.model.attributes.assigned) {\n+                   //\u62c5\u5f53\u8005\u3067\u3082\u306a\u3044\u5834\u5408\u306f\u3001\n+                   //\u8a73\u7d30\u30ea\u30f3\u30af\u3082\u975e\u8868\u793a\n+                   this.ui.detailLink.css({\n+                       display : 'none'\n+                   });\n+                   //\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3082\u5909\u66f4\u4e0d\u53ef\n+                   this.ui.checkBox.prop('disabled', true);\n+               }\n+           }\n+       }\n    });\n    return TodoItemView;\n }); \n\n\n\n\nui\u5909\u6570\u306b\u524a\u9664\u30ea\u30f3\u30af\u7528\u306e\u5909\u6570detailLink\u3092\u8ffd\u52a0\n\nonRender\u95a2\u6570\u3067\u3001\u524a\u9664\u3001\u8a73\u7d30\u306e\u5404\u30ea\u30f3\u30af\u306e\u8868\u793a\u5236\u5fa1\u3092\u4e0b\u8a18\u306e\u4ed5\u69d8\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u30aa\u30fc\u30ca\u3067\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u30ea\u30f3\u30af\u3092\u975e\u8868\u793a\u306b\u3059\u308b\n\n\n\u3055\u3089\u306b\u3001\u62c5\u5f53\u8005\u3067\u3082\u306a\u3044\u5834\u5408\u306f\u3001\n\n\n\u8a73\u7d30\u30ea\u30f3\u30af\u3082\u8868\u793a\u306b\u3059\u308b\n\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092disable\u306b\u3057\u3066\u5909\u66f4\u4e0d\u53ef\u3068\u3059\u308b\n\n\n\n\n\n\n\n\u203b\u8868\u793a\u5236\u5fa1\u306e\u5b9f\u88c5\n\n\u30ea\u30f3\u30af\u306e\u975e\u8868\u793a\n\n\njquery\u306ecss\u95a2\u6570\u3067\u3001display : 'none'\u306e\u30b9\u30bf\u30a4\u30eb\u3092\u8a2d\u5b9a\n\n\n\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306e\u5909\u66f4\u4e0d\u53ef\n\n\njquery\u306eprop\u95a2\u6570\u3067\u3001disabled\u3092true\u306b\u8a2d\u5b9a\n\n\n\n\ntodo-detail-layout-view.js\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u3001todo-layout-view.js\u3068\u307b\u307c\u540c\u3058\u3067\u3059\u3002\n\ntodo-detail-layout-view.js\n define(function(require) {\n     var TodoDetailItemView = require('views/todo-detail-item-view');\n     var TodoModel = require('models/todo-model');\n+    var UserCollection = require('collections/user-collection');\n\n    var TodoDetailLayoutView = Marionette.LayoutView.extend({\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template : '#todo-detail-layout-template',\n\n        regions : {\n            itemRegion : '#todo-item',\n        },\n\n        onRender : function() {\n-           var todoModel = new TodoModel({\n-               id : this.options.modelId\n-           });\n-           //\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n-           this.listenTo(todoModel, 'sync', this.showItem, this);\n-           //\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n-           todoModel.fetch({\n-               wait : true\n+           this.userCollection = new UserCollection();\n+           this.listenToOnce(this.userCollection, 'reset', this.onLoadUsers, this);\n+           this.userCollection.fetch({\n+               reset : true\n            });\n        },\n\n-       showItem : function(todoModel) {\n-           this.itemRegion.show( new TodoDetailItemView({\n-               model : todoModel\n-           }));\n-       },\n+       onLoadUsers : function(userCollection){\n+           var todoModel = new TodoModel({\n+               id : this.options.modelId\n+           });\n+           //\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n+           this.listenToOnce(todoModel, 'sync', this.showItem, this);\n+           //\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n+           todoModel.fetch({\n+               wait : true\n+           });\n+       },\n+\n+       showItem : function(todoModel) {\n+           this.itemRegion.show(new TodoDetailItemView({\n+               model : todoModel,\n+               userList : this.userCollection.models\n+           }));\n+       },\n\n    });\n    return TodoDetailLayoutView;\n });\n\n\n\n\ncollections/user-collection\u3092require\u3067\u8aad\u307f\u8fbc\u3080\n\nonRender\u95a2\u6570\u5185\u3067\u3001this.userCollection.fetch()\u3067\u30b5\u30fc\u30d0\u304b\u3089\u30e6\u30fc\u30b6\u4e00\u89a7\u53d6\u5f97\u3002\n\n\n\u5143\u3005onRender\u5185\u3067\u884c\u3063\u3066\u3044\u305f\u3001model1\u4ef6\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u53d6\u5f97\u51e6\u7406\u306f\u3001onLoadUsers\u5185\u306b\u79fb\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\n-\u3000fetch\u304c\u7d42\u308f\u308b\u3068(ListenTo\u304c\u52b9\u3044\u3066)onLoadUsers\u95a2\u6570\u3092\u5b9f\u884c\u3001todoModel.fetch()\u3067TODO1\u4ef6\u306e\u53d6\u5f97\u3092\u884c\u3046\u3002\n\n\n\nshowItem\u95a2\u6570\u5185\u3067\u3001TodoDetailItemView\u306e\u521d\u671f\u5316\u6642\u306b\u3001\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u4e00\u89a7\u306ecollection\u3092\u6e21\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\n\n\u3053\u306e\u30e6\u30fc\u30b6\u4e00\u89a7collection\u3092TodoDetailItemView\u306e\u51e6\u7406\u3067\u8868\u793a\u3057\u307e\u3059\u3002\n\n\n\n\ntodo-detail-item-view.js\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\ntodo-detail-item-view.js\n //\u8a73\u7d30\u30d3\u30e5\u30fc\n define(function() {\n    var TodoDetailItemView = Marionette.ItemView.extend({\n\n        //\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n        template: \"#todo-detail-item-template\",\n\n        ui : {\n            todoStatus   : '#edit-todo',\n            updateButton : '#updateTodo',\n-           cancelButton : '#updateCancel'\n+           cancelButton : '#updateCancel',\n+           userList     : '#user-list'\n        },\n\n        //DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n        events : {\n            //\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.updateButton' : 'onUpdateClick',\n            //\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n            'click @ui.cancelButton' : 'onCancelClick',\n        },\n\n        //\u521d\u671f\u5316\n-       initialize: function(){\n+       initialize: function(options){\n            _.bindAll( this, 'onSaveSuccess' );\n+           this.userList = options.userList;\n+       },\n+\n+       onRender : function() {\n+           //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+           this.showUserList(this.ui.userList, this.userList);\n+           //\u62c5\u5f53\u8005\u3092\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+           this.ui.userList.val(this.model.attributes.assignee);\n+       },\n+\n+       //\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+       showUserList : function($list, userList){\n+           $.each(userList, function(index, userModel) {\n+           $list.append(\n+               \"<option value='\" \n+               + userModel.attributes.id + \"'>\"\n+               + userModel.attributes.name + \"</option>\");\n+           });\n        },\n\n        //\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n        onUpdateClick : function() {\n            //\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u6587\u5b57\u3092\u53d6\u5f97\n-           var todoString = this.ui.todoStatus.val();\n+           var todoString = this.ui.todoStatus.val();  // Todo\n+           var assigneeId = this.ui.userList.val();    // \u62c5\u5f53\u8005\n            this.model.save({\n-               todo : todoString\n+               todo : todoString,\n+               assignee : assigneeId\n            }, {\n                silent : true,\n                success : this.onSaveSuccess,\n            });\n        },\n\n        //\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n        onCancelClick : function() {\n            this.backTodoLists();\n        },\n\n        //\u66f4\u65b0\u6210\u529f\n        onSaveSuccess : function() {\n            this.backTodoLists();\n        },\n\n        //TODO\u30ea\u30b9\u30c8\u753b\u9762\u306b\u623b\u308b\n        backTodoLists : function() {\n            Backbone.history.navigate('#todo-lists', true);\n        }\n\n    });\n    return TodoDetailItemView;\n });\n\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u306b\u95a2\u3057\u3066\u306f\u3001todo-composite-view.js\u3067\u3084\u3063\u305f\u3053\u3068\u3068\u540c\u69d8\u3067\u3059\u3002\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081ui\u5909\u6570\u306buserList\u3092\u8ffd\u52a0\u3002\n\ninitialize\u95a2\u6570\u5185\u3067\u3001todo-layout-view\u304b\u3089\u6e21\u3055\u308c\u305f\u30e6\u30fc\u30b6\u4e00\u89a7collection(options.userList\u306b\u5165\u3063\u3066\u304f\u308b)\u3092\u81ea\u8eab\u306e\u4e2d(this.userList\u306b\u4fdd\u6301)\n\nonRender\u95a2\u6570\u5185\u3067\u3001showUserList\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u3092\u884c\u3046\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u5f8c\u3001\u8868\u793a\u3059\u308bTODO\u306e\u62c5\u5f53\u8005\u306e\u30e6\u30fc\u30b6ID(model\u306eassignee\u304b\u3089\u53d6\u5f97)\u3092\u9078\u629e\u3055\u308c\u305f\u72b6\u614b\u306b\u8a2d\u5b9a\u3002\n\nshowUserList\u95a2\u6570\u306f\u3001todo-composite-view.js\u5185\u306e\u540c\u95a2\u6570\u306e\u30b3\u30d4\u30da\u3067\u3059\uff01\uff08\u4eca\u56de\u306f\u3053\u308c\u3067\u3054\u4e86\u627f\u3092\uff01\uff09\n\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\u306e\u51e6\u7406(onUpdateClick\u95a2\u6570)\u3067\u306f\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u3067\u9078\u629e\u3057\u305f\u30e6\u30fc\u30b6\u3092\u62c5\u5f53\u8005(assignee)\u3092\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\u5b9f\u88c5\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u4fee\u6b63\u3057\u3066\u753b\u9762\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n app/View/Layouts/default.ctp\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/webroot/js/collections/user-collection.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/webroot/js/models/todo-model.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/webroot/js/views/todo-layout-view.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/webroot/js/views/todo-composite-view.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n app/webroot/js/views/todo-item-view.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n\n app/webroot/js/views/todo-detail-layout-view.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n\n app/webroot/js/views/todo-detail-item-view.js\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n\n \u52d5\u4f5c\u78ba\u8a8d!\n\n Git\u306b\u30b3\u30df\u30c3\u30c8\n\nGitHub\u3067\u306ediff\u8868\u793a\u3078\u306e\u30ea\u30f3\u30af\n\u7b2c6\u56de Lesson1 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@f1623dc\n\u4ee5\u4e0a\u3067\u3059\uff01\n\n\u6b21\u56de\u4e88\u544a\n\u6b21\u56de\u30c6\u30fc\u30de\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4e21\u9762\u304b\u3089\u304b\u3051\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3 - connpass\u3067\u3059\u3002\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u3092\u4ed8\u3051\u3066\u3001\u300c\u3061\u3083\u3093\u3068\u3057\u305f\u300d\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u6210\u9577\u3055\u305b\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305f\u305c\u3072\u3054\u53c2\u52a0\u304f\u3060\u3055\u3044\uff01\n\n\u30b3\u30e1\u30f3\u30c8/\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\u53c2\u52a0\u8005\u306e\u65b9\u3082\u3001\u305d\u3046\u3067\u306a\u3044\u65b9\u3082\u304a\u6c17\u3065\u304d\u306e\u70b9\u304c\u3042\u308c\u3070\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002\n\n\n:warning: \u7b2c5\u56de\u3067users\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u304c\u3001\u524d\u56de\u4e0d\u53c2\u52a0\u306e\u65b9\u306b\u3001\u6700\u521d\u4f1d\u3048\u6f0f\u308c\u3066\u3044\u307e\u3057\u305f\u306e\u3067\u8ffd\u8a18\u3044\u305f\u3057\u307e\u3057\u305f(\u4e8b\u524d\u6e96\u5099\u306e\u3068\u3053\u308d)\u3002\u3059\u3044\u307e\u305b\u3093\u3067\u3057\u305f!\n\n## :large_blue_circle: \u306f\u3058\u3081\u306b\n\n\u672c\u6295\u7a3f\u306f\u30012015/6/26\u306b\u884c\u308f\u308c\u305f\u3001[CakePHP\u3067\u30c7\u30fc\u30bf\u64cd\u4f5c\u301c\u62c5\u5f53\u8005\u30a2\u30b5\u30a4\u30f3\u6a5f\u80fd\u306e\u5b9f\u88c5 - connpass](http://aws-rest-todo.connpass.com/event/12734/)\u306e\u5185\u5bb9\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f\u8cc7\u6599\u3067\u3059\u3002\n\n:warning:\u4eca\u5f8c\u306e\u4e88\u5b9a\n[AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e - connpass](http://aws-rest-todo.connpass.com/)\n\n\u4eca\u56de\u306f\u3001TODO\u306b\u62c5\u5f53\u8005\u3092\u5272\u308a\u5f53\u3066\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u524d\u56de\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4ed8\u3051\u305f\u306e\u3067\u3001\u8907\u6570\u30e6\u30fc\u30b6\u3067\u4f7f\u7528\u3059\u308b\u611f\u3058\u306b\u3057\u3066\u307f\u307e\u3059\uff01\n\nCakePHP\u306e\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\n\n\n## :large_blue_circle: CakePHP\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3068\u306f\uff1f\n\n\u524d\u56de\u307e\u3067\u3001\n\n- users\n- todo_lists\n\n\u306e2\u30c6\u30fc\u30d6\u30eb\u3092\u6271\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u3057\u304b\u3057\u3001\u30c6\u30fc\u30d6\u30eb1\u3064\u306e\u5358\u7d14\u306aSelect\u3057\u304b\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u3001users\u3068todo_lists\u3092\u7d50\u5408\u3057\u3066Select\u3057\u305f\u308a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001CakePHP\u3067\u306f\u3053\u3046\u3044\u3063\u305f\u5834\u5408\u306bSQL\u3092\u76f4\u63a5\u66f8\u304f\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u3068\u3044\u3046\u4ed5\u7d44\u307f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u30c6\u30fc\u30d6\u30eb\u3092\u7d50\u5408\u3057\u305f\u308a\u3059\u308b\u306e\u3092\u3001SQL\u3067\u306f\u306a\u304f\u30b3\u30fc\u30c9\u3067\u8868\u73fe\u3057\u307e\u3059\u3002\n\n### \u4eca\u56de\u5b66\u3076\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\n\n\u4eca\u56de\u306f\u4e0b\u8a183\u3064\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002\n\n- belongsTo\n- hasOne\n- hasMany\n\n:warning: \u300chasAndBelongsToMany\u300d\u3068\u3044\u3046\u306e\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n1\u3064\u305a\u3064\u8aac\u660e\u3057\u307e\u3059\u3002\n\n### belongsTo\n\nA belongsTo B\u3001\u3064\u307e\u308a\u3001A\u306fB\u306b\u5c5e\u3057\u3066\u3044\u308b\u3001\u3068\u3044\u3046\u30c6\u30fc\u30d6\u30eb\u9593\u306e\u95a2\u4fc2\u304c\u3042\u308b\u5834\u5408\u3001belongsTo\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u300c\u30e6\u30fc\u30b6(users)\u300d\u30c6\u30fc\u30d6\u30eb\u306b\u3001\u300c\u56fd\u7c4d\u300d\u3068\u3044\u3046\u30d5\u30a3\u30fc\u30eb\u30c9\u304c\u3042\u308a\u3001\u300c\u56fd\u7c4d\u30de\u30b9\u30bf(countries)\u300d\u30c6\u30fc\u30d6\u30eb\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n- countries(id, name)\n\n\u3068\u3057\u307e\u3059\u3002\n\nuser\u306f\u4e00\u3064\u306e\u56fd\u7c4d\u3092\u3082\u3061\u307e\u3059\u306e\u3067\u3001\n\n- users(id, username, country_id)\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u3059\u3002\nusers.country_id \u3068 countries.id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\nSQL\u3067\u66f8\u304f\u3068\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```sql\nselect users.id, users.username, countries.name as country_name\nfrom users inner join countries on users.country_id = countries.id\n```\n\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u4f7f\u7528\u3059\u308b\u306e\u304c\u300cbelongsTo\u300d\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\n### hasOne\n\nhasOne\u306f\u3001\u76f8\u624b\u5074\u30c6\u30fc\u30d6\u30eb\u304c1\u4ef6\u3001\u3068\u8a00\u3046\u610f\u5473\u3067belongsTo\u306e\u89aa\u621a\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059\u3002\nbelongsTo\u306e\u4f8b\u3067\u306f\u3001users\u5074\u306bcountries\u306e\u30ec\u30b3\u30fc\u30c9\u3092\u793a\u3059`country_id`\u3092\u6301\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u306e\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u4fdd\u6301\u3059\u308b\u30c6\u30fc\u30d6\u30eb(profiles)\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n- profiles(id, user_id, \u81ea\u5df1\u7d39\u4ecb\u6587, \u597d\u304d\u306a\u98df\u3079\u7269, etc...)\n\n\u3053\u306e\u5834\u5408\u3001users\u5074\u3067\u306f\u306a\u304f\u3001profiles\u5074\u306buser_id\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\nusers.id \u3068 profiles.user_id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\n\u3053\u3046\u3044\u3046\u5834\u5408\u306b\u4f7f\u7528\u3059\u308b\u306e\u304c\u300chasOne\u300d\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\n\n:warning: users\u5074\u306bprofile_id\u3092\u3082\u3064\u3001\u3068\u3044\u3046\u5b9f\u88c5\u3082\u51fa\u6765\u307e\u3059\u304c\u3001\u300c\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\u3092\u672a\u767b\u9332\u300d\u306e\u5834\u5408\u306b\n\n- users.profile_id\u3092null\u306b\u3059\u308b\u5b9f\u88c5\u306b\u3059\u308b\n- users.id = profies.user_id\u3068\u306a\u308bprofiles\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u306a\u3044\u3060\u3051\n\u306e\u3069\u3061\u3089\u306b\u3059\u308b\u304b\u3068\u8a00\u3046\u8a2d\u8a08\u601d\u60f3\u306e\u9055\u3044\u3067\u3059\u306d\u3002\n\nSQL\u3067\u66f8\u304f\u3068\u3053\u3046\u3067\u3059\u3002\n\n```sql\nselect users.id, profiles.\u81ea\u5df1\u7d39\u4ecb\u6587, profiles.\u597d\u304d\u306a\u98df\u3079\u7269\nfrom users inner join profiles on users.id = profiles.user_id\n```\n\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\n\n### hasMany\n\nhasMany\u306f1:n\u306e\u95a2\u4fc2\u3092\u8868\u3059\u5834\u5408\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30e6\u30fc\u30b6\u306e\u8077\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c6\u30fc\u30d6\u30eb(careers)\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n- careers(id, user_id, \u5165\u793e\u5e74\u5ea6, \u4f1a\u793e\u540d, etc...)\n\n\u3053\u306e\u5834\u5408\u3001users\u306f\u8907\u6570\u306e\u8077\u6b74(career)\u30ec\u30b3\u30fc\u30c9\u3092\u6301\u3066\u308b\u306e\u3067\u3001\nusers.id \u3068 careers.user_id \u3067 join\u3057\u3066Select\u3059\u308c\u3070\u53d6\u5f97\u3067\u304d\u307e\u3059\u306d\u3002\nhasOne\u3068\u306e\u9055\u3044\u306f\u3001\u3053\u306e\u6642\u8907\u6570\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u3068\u308c\u3066\u304f\u308b\u3001\u3068\u8a00\u3046\u90e8\u5206\u306e\u307f\u3067\u3059\u3002\n\nSQL\u3067\u66f8\u304f\u3068\u3001\u901a\u5e38\u306f\u3053\u3046\u3067\u3059\u3002\n\n```sql\nselect users.id, careers.\u5165\u793e\u5e74\u5ea6, careers.\u4f1a\u793e\u540d\nfrom users inner join careers on users.id = careers.user_id\n```\n\n:warning:\u5b9f\u969b\u306b\u306fCakePHP\u306e\u5834\u5408\u3001users\u306eselect\u3068careers\u306eselect\u304c\u305d\u308c\u305e\u308c\u4e00\u56de\u3001\u8a082\u56de\u306eselect\u304c\u767a\u884c\u3055\u308c\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u30b3\u30fc\u30c9\u306f\u5f8c\u307b\u3069\u898b\u3066\u3044\u304d\u307e\u3059\uff01\n\n\n## :large_blue_circle: \u4eca\u56de\u306e\u5185\u5bb9\n\n\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\n### \u6a5f\u80fd\u30ea\u30b9\u30c8\n\n- Todo\u306e\u8ffd\u52a0\n\t- TODO\u306e\u5185\u5bb9\u306b\u52a0\u3048\u300c\u305d\u306eTODO\u3092\u8ab0\u304c\u62c5\u5f53\u3059\u308b\u304b\u300d\u3092\u5168\u30e6\u30fc\u30b6\u306e\u30ea\u30b9\u30c8\u304b\u3089\u9078\u629e\u3057\u3066\u6307\u5b9a\u3059\u308b\n\t- \u30e6\u30fc\u30b6\u306e\u30ea\u30b9\u30c8\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u3068\u3059\u308b\u3002\n- TODO\u4e00\u89a7\u306e\u8868\u793a\n\t- TODO\u8ffd\u52a0\u3092\u5b9f\u884c\u3057\u305f\u30e6\u30fc\u30b6\u3092\u300c\u30aa\u30fc\u30ca\u300d\u3001TODO\u3092\u5272\u308a\u5f53\u3066\u305f\u30e6\u30fc\u30b6\u3092\u300c\u62c5\u5f53\u300d\u3068\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\t- \u4e0b\u8a18\u306e\u64cd\u4f5c\u5236\u9650\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\t\t- \u300c\u524a\u9664\u300d\u306f\u30aa\u30fc\u30ca\u306e\u307f\u53ef\u80fd\u3002\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u306a\u3044TODO\u306e\u884c\u306e\u300c\u524a\u9664\u300d\u30ea\u30f3\u30af\u306f\u8868\u793a\u3057\u306a\u3044\u3002\n\t\t- \u300c\u8a73\u7d30\u300d\u306e\u8868\u793a\u306f\u30aa\u30fc\u30ca\u307e\u305f\u306f\u62c5\u5f53\u306e\u307f\u53ef\u80fd\u3002\u305d\u308c\u4ee5\u5916\u306e\u5834\u5408\u306f\u300c\u8a73\u7d30\u300d\u30ea\u30f3\u30af\u306f\u8868\u793a\u3057\u306a\u3044\u3002\n- TODO\u8a73\u7d30\n\t- \u62c5\u5f53\u8005\u306e\u5909\u66f4\u3092\u53ef\u80fd\u3068\u3059\u308b\u3002\n\n\n### \u753b\u9762\n\n- TODO\u4e00\u89a7\u753b\u9762\n\n![todo_lists.png](https://qiita-image-store.s3.amazonaws.com/2006/65988/8040158b-824b-0de4-2bf5-bc97bec4c0ec.png \"todo_lists.png\")\n\n- TODO\u8a73\u7d30\u753b\u9762\n\n![todo_detail.png](https://qiita-image-store.s3.amazonaws.com/2006/65988/1545828c-0ff0-cf4e-8df8-26cd3751dd7a.png \"todo_detail.png\")\n\n\n## :large_blue_circle: \u4e8b\u524d\u6e96\u5099\n\n\u4e8b\u524d\u6e96\u5099\u306f\u6bce\u56de\u540c\u3058\u306a\u306e\u3067\u3001\u5225\u30a8\u30f3\u30c8\u30ea\u306b\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n[\u516812\u56de\u306e\u52c9\u5f37\u4f1a\u3067\u3084\u3063\u3066\u3044\u308bGit\u306e\u4f7f\u3044\u65b9 - AWS\u4e0a\u3067\u69cb\u7bc9\u3059\u308bRESTful\u30a2\u30d7\u30ea\u52c9\u5f37\u4f1a\uff5eWeb\u958b\u767a\u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\uff5e - Qiita](http://qiita.com/k_shimoji/items/6a66dbb93b0553fa7c7f)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3084\u308b\u3053\u3068\u306f\u3001\n\n- git\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u6574\u3048\u3066\u4eca\u56de\u7528\u30d6\u30e9\u30f3\u30c1`vol/06`\u3092\u4f5c\u6210\u3059\u308b\n\n\u3067\u3059\u3002\u307e\u305a\u3053\u308c\u3092\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n***\u305d\u308c\u3068\u3001\u524d\u56deusers\u30c6\u30fc\u30d6\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u304c\u3001\u524d\u56de\u4e0d\u53c2\u52a0\u306e\u65b9\u306f\u305d\u3063\u3061\u3082\u3084\u3063\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002[\u3053\u3061\u3089](http://qiita.com/k_shimoji/items/ae5a02bd0c7e03feae52#%E3%83%A6%E3%83%BC%E3%82%B6%E7%99%BB%E9%8C%B2%E7%94%A8%E3%81%AE%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E4%BD%9C%E6%88%90)\u3092\u53c2\u7167\u4e0b\u3055\u3044\u3002***\n\n\u4eca\u56de\u306f\u3055\u3089\u306b\u3001\ntodo_lists\u30c6\u30fc\u30d6\u30eb\u306b\u3001\n\n- \u30aa\u30fc\u30ca\u306e\u30e6\u30fc\u30b6ID(owner)\n- \u62c5\u5f53\u306e\u30e6\u30fc\u30b6ID(assignee)\n\n\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n### TODO\u4e00\u89a7\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u5217\u8ffd\u52a0\n\n\n\u307e\u305a\u3001phpMyAdmin\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u3087\u3046\u3002\n\nURL\u306f\u3001`http://(PublicIP)/phpMyAdmin/`\u3067\u3059\u3002\n\u5909\u66f4\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3001\u30e6\u30fc\u30b6\u540d`study`\u3001\u30d1\u30b9\u30ef\u30fc\u30c9`study`\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\n\n\n##### \u5404\u5217\u306e\u8a2d\u5b9a\n\n|\u540d\u524d|\u30c7\u30fc\u30bf\u578b|\u9577\u3055/\u5024|\u30c7\u30d5\u30a9\u30eb\u30c8\u5024|\u7167\u5408\u9806\u5e8f|\u5c5e\u6027|NULL|\u30a4\u30f3\u30c7\u30c3\u30af\u30b9|A_I(AutoIncrement)|\u30b3\u30e1\u30f3\u30c8|\n|:--|:--|:--|:--|:--|:--|:--|:--|:--|:--\n| owner |INT|10|\u306a\u3057|\u3000|UNSIGNED|\u3000|\u3000| \u3000|\u30aa\u30fc\u30ca\n| assignee |INT|10|\u306a\u3057|\u3000|UNSIGNED|\u3000|\u3000|\u3000|\u62c5\u5f53\n\n#### \u6e96\u5099\n\n\u3067\u306f\u3001\u6e96\u5099\u3092\u59cb\u3081\u307e\u3057\u3087\u3046\uff01\n\n- :white_check_mark: Git\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u6574\u3048\u3066\u3001`vol/06`\u30d6\u30e9\u30f3\u30c1\u3092\u4f5c\u6210\u3002\n- :white_check_mark: TODO\u4e00\u89a7(todo_lists)\u30c6\u30fc\u30d6\u30eb\u306b\u5217\u3092\u8ffd\u52a0\u3002\n\n\u6e96\u5099\u304c\u3067\u304d\u305f\u3089\u3001Lesson1\u3067\u3059\uff01\n\n\n## :large_blue_circle: Lesson1 \u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\n\nLesson1\u3067\u306f\u3001\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30c6\u30b9\u30c8\u306b\u306f\u3001\u7b2c1\u56de\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u300cPOSTMAN\u300d\u3092\u4f7f\u7528\u3057\u3066API\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002\n\n### \u30dd\u30a4\u30f3\u30c8\n\n\u4eca\u56de\u306e\u30c6\u30fc\u30de\u306f\u300c\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u3067\u3059\u304c\u3001\u524d\u8ff0\u306e3\u3064\u306e\u3046\u3061\u3001\u5b9f\u306f\u300cbelongsTo\u300d\u3060\u3051\u3067\u4eca\u56de\u306e\u6a5f\u80fd\u306f\u5b9f\u73fe\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u305d\u308c\u3060\u3051\u3067\u306f\u9762\u767d\u304f\u7121\u3044\u306e\u3067\u3001\u300chasOne\u300d\u3068\u300chasMany\u300d\u3082\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001belognsTo\u3092\u4f7f\u7528\u3057\u3066\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u3092\u3057\u307e\u3059\u3002\n\n### \u7de8\u96c6\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n\n|\u7de8\u96c6|file|\u7de8\u96c6\u6982\u8981|\n|---|:----------------------------------|:----------------------|\n|\u4fee\u6b63| app/Controller/TodoListsController.php |find\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a2d\u5b9a\n|\u4fee\u6b63| app/Model/TodoList.php |\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n|\u4fee\u6b63| app/Controller/UsersController.php   |\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u53d6\u5f97\n\n\n#### TodoListsController.php\n\nTodoList\u30e2\u30c7\u30eb\u306efind\u95a2\u6570\u5b9f\u884c\u3058\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```diff:TodoListsController.php\n\u301c\u7565\u301c\n class TodoListsController extends AppController {\n \n \tpublic function index() {\n-\t\t$res = $this->TodoList->find('all');\n+\t\t$query = array (\n+\t\t\t'fields' => array (\n+\t\t\t\t'TodoList.id',\n+\t\t\t\t'TodoList.todo',\n+\t\t\t\t'TodoList.status',\n+\t\t\t\t'Owner.id',\n+\t\t\t\t'Owner.name',\n+\t\t\t\t'Assignee.id',\n+\t\t\t\t'Assignee.name'\n+\t\t\t),\n+\t\t\t'order' => \"TodoList.id\"\n+\t\t);\n+\t\t$res = $this->TodoList->find('all', $query);\n+\t\t// \u6574\u5f62\n+\t\tif (count($res) > 0) {\n+\t\t    $loginUserId = $this->Auth->user()['id'];\n+\t\t\tforeach ( $res as $key => $row ) {\n+\t\t\t    //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n+\t\t\t\t$res[$key]['TodoList']['owned'] = $row['Owner']['id'] === $loginUserId;\n+\t\t\t    //\u300c\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u300d\u30d5\u30e9\u30b0\n+\t\t\t\t$res[$key]['TodoList']['assigned'] = $row['Assignee']['id'] === $loginUserId;\n+\t\t\t}\n+\t\t}\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n \n \tpublic function view($id = null) {\n \t\t$res = $this->TodoList->findById($id);\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n \n \tpublic function add() {\n \t\t$data = $this->request->data;\n+\t\t$data['owner'] = $this->Auth->user()['id'];\n \t\t$res = $this->TodoList->save($data);\n \t\t$this->set(compact('res'));\n \t\t$this->set('_serialize', 'res');\n \t}\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n```\n\n#### `find`\u95a2\u6570\u306b\u5f15\u6570\u8ffd\u52a0\n\n- \u7b2c\u4e8c\u5f15\u6570`$query`\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002`$query`\u306f\u914d\u5217\u3067\u3001\u4e0b\u8a18\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\t- `fields`\n\t\t- \u53d6\u5f97\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u5217\u3002\u3053\u308c\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001\u30e6\u30fc\u30b6\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u7b49\u3082\u3068\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u5fc5\u8981\u306a\u7269\u306e\u307f\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\t- `order`\n\t\t- \u3064\u3044\u3067\u306b\u30c7\u30fc\u30bf\u306e\u4e26\u3073\u9806\u3082\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002todo_lists\u30c6\u30fc\u30d6\u30eb\u306eid\u306e\u6607\u9806\u3067\u3059\u3002\n\n#### \u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u6574\u5f62\n\n- \u53d6\u5f97\u3057\u305f1\u4ef6\u306e\u30ec\u30b3\u30fc\u30c9\u306b\u3064\u3044\u3066\u3001\n\t- \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3067\u3042\u308b\u5834\u5408\u3001`owned = true`\u306b\u8a2d\u5b9a\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408`owned = false`\u306b\u8a2d\u5b9a\u3002\n\t- \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u62c5\u5f53\u3067\u3042\u308b\u5834\u5408\u3001`assigned = true`\u306b\u8a2d\u5b9a\u3001\u305d\u3046\u3067\u306a\u3044\u5834\u5408`assigned = false`\u306b\u8a2d\u5b9a\u3002\n\n#### TodoList.php\n\n\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\n```diff:TodoList.php\n class TodoList extends AppModel {\n+\tpublic $belongsTo = array (\n+\t\t'Owner' => array (\n+\t\t\t'className' => 'User',\n+\t\t\t'foreignKey' => 'owner',\n+\t\t),\n+\t\t'Assignee' => array (\n+\t\t\t'className' => 'User',\n+\t\t\t'foreignKey' => 'assignee'\n+\t\t)\n+\t);\n }\n```\n\n#### belongsTo\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\n\n- TODO\u4e00\u4ef6\u306b\u5bfe\u3059\u308b\u3001\n\t- \u30aa\u30fc\u30ca\u306e\u30e6\u30fc\u30b6\u60c5\u5831\n\t- \u62c5\u5f53\u306e\u30e6\u30fc\u30b6\u60c5\u5831\n\n\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u8a73\u7d30\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3002\n\n- \u30e2\u30c7\u30eb\u306e\u5909\u6570\u306b`$belongsTo`\u3068\u3044\u3046\u5909\u6570\u540d\u3067\u914d\u5217\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\t- `Owner`(\u30aa\u30fc\u30ca), `Assignee`(\u62c5\u5f53)\u3068\u3044\u3046\u540d\u524d\u30672\u3064\u306eusers\u30c6\u30fc\u30d6\u30eb\u3092\u7d10\u3064\u3051\u3066\u3044\u307e\u3059\u3002\n\t- \u305d\u306e\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30(`Owner`)\n\t\t- `className` -> \u30e2\u30c7\u30eb\u540d(User)\n\t\t- users\u306b\u5bfe\u3059\u308b\u5916\u90e8\u30ad\u30fc(`todo_lists.owner`\u3092\u6307\u5b9a)\n\t- \u305d\u306e\u4e0b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u8a73\u7d30(`Assignee`)\n\t\t- `className` -> \u30e2\u30c7\u30eb\u540d(User)\n\t\t- users\u306b\u5bfe\u3059\u308b\u5916\u90e8\u30ad\u30fc(`todo_lists.assignee`\u3092\u6307\u5b9a)\n\n#### add\u30e1\u30bd\u30c3\u30c9\n\n- `owner`\u306b\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306eID\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\t- \u3053\u308c\u3067\u3001TODO\u306e\u8ffd\u52a0\u64cd\u4f5c\u3092\u3057\u305f\u969b\u306e\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3068\u3057\u3066\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n### UsersController.php\n\n\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a4\u30f3\u6e08\u307f\u30c1\u30a7\u30c3\u30af\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3001\u30e6\u30fc\u30b6\u767b\u9332\u306e\u5b9f\u88c5\u3067\u3059\u3002\n\n```diff:UsersController.php\n class UsersController extends AppController {\n \n+\tpublic function index() {\n+\t\t$res = $this->User->find('all', array (\n+\t\t\t'fields' => array (\n+\t\t\t\t'User.id',\n+\t\t\t\t'User.username',\n+\t\t\t\t'User.name'\n+\t\t\t)\n+\t\t));\n+\t\t$this->set(compact('res'));\n+\t\t$this->set('_serialize', 'res');\n+\t}\n+\n \tpublic function login() {\n \t\t$user = $this->Auth->user();\n \t\t$res = array();\n\n\u301c\u4ee5\u4e0b\u7565\u301c\n```\n\n#### `index`\u95a2\u6570\n\n- `TodoListController.php`\u3068\u540c\u3058\u5bb9\u91cf\u3067\u3001`find`\u95a2\u6570\u3067\u53d6\u5f97\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u7d5e\u3063\u3066\u3044\u307e\u3059\u3002\n\n###\u3000\u52d5\u4f5c\u78ba\u8a8d\n\nPOSTMAN\u3067\u3001TODO\u4e00\u89a7\u53d6\u5f97API(`http://(PublicIP)/rest-study/todo_lists.json`)\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u53d6\u5f97\u3067\u304d\u308c\u3070OK\u3067\u3059\u3002\nbelongsTo\u304c\u52b9\u3044\u3066\u3044\u307e\u3059\u3002\n\n```json\n[\n    {\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": true\n        },\n        \"Owner\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"Assignee\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owned\": true,\n            \"assigned\": false\n        },\n        \"Owner\": {\n            \"id\": \"67\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"Assignee\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        }\n    },\n    {\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owned\": false,\n            \"assigned\": false\n        },\n        \"Owner\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"Assignee\": {\n            \"id\": \"68\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        }\n    }\n]\n```\n\n\n### \u5b9f\u88c5\n\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u4fee\u6b63\u3057\u3066\u4e0a\u8a18\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n- :white_check_mark: `app/Controller/TodoListsController.php` \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/Model/TodoList.php` \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/Controller/UsersController.php` \u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: \u52d5\u4f5c\u78ba\u8a8d!\n- :white_check_mark: Git\u306b\u30b3\u30df\u30c3\u30c8\n\n\n**GitHub\u3067\u306ediff\u8868\u793a\u3078\u306e\u30ea\u30f3\u30af**\n[\u7b2c6\u56de Lesson1 \u30b5\u30fc\u30d0\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@d4fe1a4](https://github.com/suzukishouten-study/rest-study/commit/d4fe1a4c8428b6cf9ecf6b29256537e2741210ca)\n\nLesson1.5\u3078!\n\n## :large_blue_circle: Lesson1.5 \u4ed6\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a66\u3059\u3002\n\n\u4eca\u56de\u5b9f\u88c5\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u306fLesson1\u306e\u5b9f\u88c5\u3067OK\u3067\u3059\u3002\nLesson2\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u5b9f\u88c5\u306b\u5165\u308b\u524d\u306b\u3001`hasOne`\u3068`hasMany`\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3082\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30bd\u30fc\u30b9\u3092\u4fee\u6b63\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u5f8c\u3001\u5143\u306b\u623b\u3057\u3066Lesson2\u3078\u884c\u304d\u307e\u3057\u3087\u3046\u3002\n\n\n\u30c6\u30b9\u30c8\u3067\u306f\u3001\u4e0b\u8a18\u306e\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3067\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3092\u8f09\u305b\u3066\u3044\u307e\u3059\u3002\n\n![testdata.png](https://qiita-image-store.s3.amazonaws.com/2006/65988/53a69baa-57cb-fe9e-47c0-529e6d32fb9d.png \"testdata.png\")\n\n:warning:\u30e6\u30fc\u30b6\u306f\u3001\n\n- \u5c71\u7530\u592a\u90ce\n- \u7530\u4e2d\u82b1\u5b50\n- \u4f50\u85e4\u4e00\u90ce\n\n\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4f50\u85e4\u4e00\u90ce\u3055\u3093\u306f\u307e\u3060TODO\u304c1\u4ef6\u3082\u306a\u3044(\u81ea\u5206\u304c\u30aa\u30fc\u30ca\u306e\u3082\u306e\u3082\u3001\u62c5\u5f53\u3068\u3057\u3066\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u305f\u3082\u306e\u3082\uff09\u72b6\u614b\u3067\u3059\u3002\n\n### hasOne\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n\u3042\u308b\u30e6\u30fc\u30b6\u304c\u30aa\u30fc\u30ca\u3068\u306a\u3063\u3066\u3044\u308bTODO\u3092\u53d6\u5f97\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8003\u3048\u307e\u3059\u3002\n:warning:`user : todo` \u306f `1 : n`\u306b\u306a\u308b\u306e\u3067\u672c\u6765\u306f`hasMany`\u3092\u4f7f\u7528\u3059\u308b\u5834\u9762\u3067\u3059\u3002\n\u3061\u3087\u3063\u3068\u7121\u7406\u77e2\u7406\u3067\u3059\u304c\u3001\u300c\u7530\u4e2d\u82b1\u5b50\u3055\u3093\u300d\u304c\u30aa\u30fc\u30ca\u306eTODO\u306f1\u4ef6\u306a\u306e\u3067\u3001\u7530\u4e2d\u82b1\u5b50\u3055\u3093\u306eTODO\u304c\u3061\u3083\u3093\u3068\u53d6\u308c\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n#### \u30bd\u30fc\u30b9\u4fee\u6b63\u7b87\u6240\n\n#####`app/Controller/UsersController.php`\u306e`index`\u95a2\u6570\u3092\u4fee\u6b63\u3002\n\n```php:app/Controller/UsersController.php\n\tpublic function index() {\n\t    $res = $this->User->find('all');\t//fields\u306e\u6307\u5b9a\u3092\u5916\u3059\u3002\u4e0b\u8a18\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n// \t    $res = $this->User->find('all', array (\n// \t\t\t'fields' => array (\n// \t\t\t\t'User.id',\n// \t\t\t\t'User.username',\n// \t\t\t\t'User.name'\n// \t\t\t)\n// \t\t));\n\t\t$this->set(compact('res'));\n\t\t$this->set('_serialize', 'res');\n\t}\n```\n\n- \n\n\n`app/Model/User.php `\u306b\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002\n\n```php:app/Model/User.php\nclass User extends AppModel {\n\tpublic $hasOne = array (\n\t\t'TodoList' => array (\n\t\t\t'className' => 'TodoList',\n\t\t\t'foreignKey' => 'owner'\n\t\t)\n\t);\n}\n```\n\n\u3055\u3066\u3001\u30e6\u30fc\u30b6\u53d6\u5f97API(`http://(PublicIP)/rest-study/users.json`)\u3092\u53e9\u3044\u3066\u307f\u307e\u3057\u3087\u3046\uff01\n\n```json:\u5b9f\u884c\u7d50\u679c\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"62\",\n            \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"67\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": \"78\",\n            \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n            \"status\": \"0\",\n            \"owner\": \"67\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": {\n            \"id\": \"83\",\n            \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n            \"status\": \"1\",\n            \"owner\": \"68\",\n            \"assignee\": \"68\"\n        }\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": {\n            \"id\": null,\n            \"todo\": null,\n            \"status\": null,\n            \"owner\": null,\n            \"assignee\": null\n        }\n    }\n]\n```\n\n\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u30661\u4ef6\u306eTODO\u304c\u7d10\u3064\u3044\u3066\u3044\u307e\u3059\u306d\uff01\n1\u4ef6\u3082TODO\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u5404\u9805\u76ee\u304cnull\u306e\u914d\u5217\u304c\u4e00\u500b\u51fa\u6765\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u3053\u306e\u6642\u5b9f\u884c\u3055\u308c\u305fSQL\u306f\u4e0b\u8a18\u3067\u3059\u3002hasMany\u3067\u306f\u4e00\u56de\u306e\u5b9f\u884c\u3067SQL\u304c2\u56de\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n```sql\nSELECT\n\t`User`.`id`,\n\t`User`.`username`, \n\t`User`.`password`, \n\t`User`.`name`, \n\t`TodoList`.`id`, \n\t`TodoList`.`todo`, \n\t`TodoList`.`status`, \n\t`TodoList`.`owner`, \n\t`TodoList`.`assignee` \nFROM `study`.`users` AS `User` \n\t\tLEFT JOIN `study`.`todo_lists` AS `TodoList` ON (`TodoList`.`owner` = `User`.`id`)  \nWHERE 1 = 1\n```\n\n\u8b0e\u306e`WHERE 1 = 1`\u304c\u3064\u3044\u3066\u307e\u3059\u304c\u3053\u3046\u3044\u3046SQL\u3067\u3059\u3002\u666e\u901a\u306bJOIN\u3057\u3066\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\n\n### hasMany\u3092\u30c6\u30b9\u30c8\u3059\u308b\n\n`user : todo` \u306f `1 : n`\u306b\u306a\u308b\u306e\u3067\u672c\u6765\u306e`hasMany`\u306e\u4f7f\u3044\u30c9\u30b3\u30ed\u3067\u3059\u3002\n\n### \u30bd\u30fc\u30ba\u4fee\u6b63\u7b87\u6240\n\n`app/Controller/UsersController.php`\u306fhasOne\u3067\u4fee\u6b63\u3057\u305f\u72b6\u614b\u3067\u7f6e\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n`app/Model/User.php `\u306b\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3002\n\n```php:app/Model/User.php\nclass User extends AppModel {\n\tpublic $hasMany = array (\n\t\t'TodoList' => array (\n\t\t\t'className' => 'TodoList',\n\t\t\t'foreignKey' => 'owner'\n\t\t)\n\t);\n}\n```\n\nhasOne\u3092hasMany\u306b\u5909\u3048\u305f\u3060\u3051\u3067\u3059\uff01\n\u3067\u306f\u5b9f\u9a13\u3002\n\n```json:\u5b9f\u884c\u7d50\u679c\n[\n    {\n        \"User\": {\n            \"id\": \"67\",\n            \"username\": \"yamada\",\n            \"password\": \"$2a$10$KQTujh9rcjx7/7b83Hw7jOg8brjOAyT/S.H4VgY7Uknjy5jg1.iD.\",\n            \"name\": \"\u5c71\u7530\u592a\u90ce\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"62\",\n                \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"67\"\n            },\n            {\n                \"id\": \"78\",\n                \"todo\": \"\u72ac\u306e\u6563\u6b69\",\n                \"status\": \"0\",\n                \"owner\": \"67\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"68\",\n            \"username\": \"tanaka\",\n            \"password\": \"$2a$10$ig3ul1GQlZPbQDODLt6.SuYqJVv94wNlZJwMqSPvK5H/p2qEBih6e\",\n            \"name\": \"\u7530\u4e2d\u82b1\u5b50\"\n        },\n        \"TodoList\": [\n            {\n                \"id\": \"83\",\n                \"todo\": \"\u5bb6\u306b\u96fb\u8a71\",\n                \"status\": \"1\",\n                \"owner\": \"68\",\n                \"assignee\": \"68\"\n            }\n        ]\n    },\n    {\n        \"User\": {\n            \"id\": \"69\",\n            \"username\": \"sato\",\n            \"password\": \"$2a$10$rBdmyhZHwlv4h.EvacI34OSRuE9Q3t7pYx1HysS1zxw99NOGLUVBi\",\n            \"name\": \"\u4f50\u85e4\u4e00\u90ce\"\n        },\n        \"TodoList\": []\n    }\n]\n```\n\n\u3053\u3046\u306a\u308a\u307e\u3057\u305f\uff01\u3061\u3083\u3093\u3068\u30e6\u30fc\u30b6\u306b\u5bfe\u3057\u3066TODO\u304c\u8907\u6570\u4ef6\u7d10\u3064\u3044\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u304chasMany\u3067\u3059\u306d\u3002\n\u3053\u306e\u6642\u5b9f\u884c\u3055\u308c\u305fSQL\u306f\u4e0b\u8a182\u3064\u3067\u3059\u3002hasMany\u3067\u306f\u4e00\u56de\u306e\u5b9f\u884c\u3067SQL\u304c2\u56de\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n```sql:1\u56de\u76ee\nSELECT `User`.`id`, `User`.`username`, `User`.`password`, `User`.`name` FROM `study`.`users` AS `User`   WHERE 1 = 1\n```\n\n```sql:2\u56de\u76ee\nSELECT `TodoList`.`id`, `TodoList`.`todo`, `TodoList`.`status`, `TodoList`.`owner`, `TodoList`.`assignee` FROM `study`.`todo_lists` AS `TodoList`   WHERE `TodoList`.`owner` IN (67, 68, 69)\n```\n\n2\u56de\u76ee\u306f\u30011\u56de\u76ee\u3067\u53d6\u5f97\u3057\u305fuser\u306eid\u3092owner\u306b\u6301\u3064TodoList\u3092select\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3046\u3044\u3046\u5b9f\u88c5\u306b\u306a\u3063\u3066\u308b\u3093\u3067\u3059\u306d\u3002\n\n\u3067\u306f\u3001\u4fee\u6b63\u3057\u305f\u3068\u3053\u308d\u3092\u5143\u306b\u623b\u3057\u3066\u3001lesson2\u3001 \u753b\u9762\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n## :large_blue_circle: Lesson2 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\nLesson2\u3067\u306f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n### \u30dd\u30a4\u30f3\u30c8\n\n\u524d\u56de\u307e\u3067\u306e\u77e5\u8b58\u3067\u307b\u307c\u958b\u767a\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u3001\u4e0b\u8a18\u306e\u300c\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u3066\u8868\u793a\u3059\u308b\u300d\u90e8\u5206\u3060\u3051\u5c11\u3057\u89e3\u8aac\u3057\u307e\u3059\u3002\n\n- TODO\u4e00\u89a7\u753b\u9762\u306e\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n![userlist_todo_list.png](https://qiita-image-store.s3.amazonaws.com/2006/65988/431e3918-7146-0264-5695-7e26900b639e.png \"userlist_todo_list.png\")\n\n- TODO\u8a73\u7d30\u753b\u9762\u306e\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n![userlist_todo_detail.png](https://qiita-image-store.s3.amazonaws.com/2006/65988/894b5c3f-77e2-2e75-228b-9f6fefb9971b.png \"userlist_todo_detail.png\")\n\n\n#### \u4eca\u56de\u306e\u5b9f\u88c5\n\nBackbone\u3001Marionette\u3092\u30d5\u30eb\u6d3b\u7528\u3059\u308b\u306a\u3089\u3001\u672c\u6765\u306f\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u90e8\u5206\u3092View\u306b\u3057\u3001\u300cBehavior\u300d\u6a5f\u80fd\u3092\u4f7f\u3046\u306a\u3069\u3057\u3066\u5171\u901a\u5316\u3059\u308b\u3068\u3044\u3044\u611f\u3058\u306a\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u306f\u300cCakePHP\u306e\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3\u300d\u306a\u306e\u3067\u3001\u3061\u3087\u3063\u3068\u7c21\u5358\uff08\u624b\u629c\u304d\uff1f\uff09\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3054\u4e86\u627f\u4e0b\u3055\u3044\u3002\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\n\n- \u30e6\u30fc\u30b6\u53d6\u5f97API(`http://(PublicIP)/rest-study/users.json`)\u3092\u53e9\u3044\u3066collection\u306b\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u53d6\u5f97\n- \u305d\u306ecollecton\u3092\u30eb\u30fc\u30d7\u3067\u51e6\u7406\u3057\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u7528\u610f\u3057\u3066\u3044\u308b`<select></select>`\u30bf\u30b0\u306e\u4e2d\u306b\u3001`<option value=\"\u30e6\u30fc\u30b6\u306eid\">\u30e6\u30fc\u30b6\u306e\u6c0f\u540d</option>`\u3068\u3044\u3046\u30bf\u30b0\u3092JQuery\u3092\u4f7f\u3063\u3066\u306f\u3081\u8fbc\u3093\u3067\u3044\u304f\u3002\n\n\u3068\u3044\u3046\u3084\u308a\u65b9\u3067\u3059\u3002\n\n\u3053\u308c\u3092\u3001TODO\u4e00\u89a7\u3068TODO\u8a73\u7d30\u306e\u4e21\u753b\u9762\u3067\u300c\u30b3\u30d4\u30da\u300d\u3057\u3066\u3044\u307e\u3059\u3002\n(DRY\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u4eca\u56de\u306f\u3054\u52d8\u5f01\uff01)\n\n\u3067\u306f\u3001\u30bd\u30fc\u30b9\u89e3\u8aac\u3067\u3059\u3002\n\n\n### \u7de8\u96c6\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\n\n|\u7de8\u96c6|file|\u7de8\u96c6\u6982\u8981|\n|---|:------------------------------------------------|:----------------------|\n|\u4fee\u6b63|app/View/Layouts/default.ctp                    |\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u4fee\u6b63\n|\u65b0\u898f|app/webroot/js/collections/user-collection.js   |\u30e6\u30fc\u30b6\u4e00\u89a7\u7528collection\n|\u4fee\u6b63|app/webroot/js/models/todo-model.js             |\u8ffd\u52a0\u9805\u76ee\u306eparse\n|\u4fee\u6b63|app/webroot/js/views/todo-layout-view.js        |\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\n|\u4fee\u6b63|app/webroot/js/views/todo-composite-view.js     |\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n|\u4fee\u6b63|app/webroot/js/views/todo-item-view.js          |\u524a\u9664\u30fb\u8a73\u7d30\u30dc\u30bf\u30f3\u306e\u8868\u793a\u5236\u5fa1\n|\u4fee\u6b63|app/webroot/js/views/todo-detail-layout-view.js |\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\n|\u4fee\u6b63|app/webroot/js/views/todo-detail-item-view.js   |\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\n\n\n### default.ctp\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4fee\u6b63\u3002\n\n```diff:default.ctp\n\n\u301c\u3000\u7565\u3000\u301c\n  <title>\u30b7\u30f3\u30d7\u30ebTODO\u30a2\u30d7\u30ea</title>\n </head>\n <body>\n \t<!-- \u30d8\u30c3\u30c0 -->\n \t<div id=\"header\"></div>\n \t<!-- \u30b3\u30f3\u30c6\u30f3\u30c4 -->\n \t<div id=\"main\"></div>\n\n\u301c\u3000\u7565\u3000\u301c\n \n \t<!-- TODO\u4e00\u89a7\u8868\u793a\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-composite-template\">\n \t<textarea style=\"width:300px;height:50px\"id=\"new-todo\" placeholder=\"Todo?\" autofocus></textarea>\n+\t<select name=\"assignee\" id=\"user-list\">\n \t<input type=\"button\" id=\"addTodo\" value=\"\u8ffd\u52a0\">\n \t<hr>\n \t<div>\n \t\t<table border=\"1\" width=\"350px\">\n+\t\t\t<thead>\n+\t\t\t\t<tr>\n+\t\t\t\t\t<td>\u5b8c\u4e86</td>\n+\t\t\t\t\t<td>ToDo</td>\n+\t\t\t\t\t<td>\u30aa\u30fc\u30ca</td>\n+\t\t\t\t\t<td>\u62c5\u5f53</td>\n+\t\t\t\t\t<td colspan=\"2\"></td>\n+\t\t\t\t</tr>\n+\t\t\t</thead>\n \t\t\t<tbody></tbody>\n \t\t</table>\n \t</div>\n \t</script>\n \n \t<!-- TODO\u4e00\u884c\u5206\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff08\u4e0a\u306etbody\u90e8\u5206\u306b\u633f\u5165\u3055\u308c\u308b\uff09 -->\n \t<script type=\"text/template\" id=\"todo-item-template\">\n \t<td><input type=\"checkbox\" class=\"toggle\" <%- status === '1' ? 'checked' : '' %>></td>\n \t<td style=\"margin:0px\">\n \t\t<span class=\"todo-edit\" style=\"margin:0px\"><%- todo %></span>\n \t</td>\n \t<td>\n+\t\t<span><%- Owner.name %></span>\n+\t</td>\n+\t<td>\n+\t\t<span><%- Assignee.name %></span>\n+\t</td>\n+\t<td>\n \t\t<a class=\"remove-link\" href=\"#\">\u524a\u9664</a>\n+\t</td>\n+\t<td>\n \t\t<a class=\"detail-link\" href=\"#todo-lists/<%- id %>\">\u8a73\u7d30</a>\n \t</td>\n \t</script>\n \n \t<!-- \u8a73\u7d30\u753b\u9762\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-detail-layout-template\">\n \t<div id=\"todo-item\"></div>\n \t</script>\n \n \t<!-- \u8a73\u7d30\u753b\u9762\u306e\u8868\u793a\u5185\u5bb9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 -->\n \t<script type=\"text/template\" id=\"todo-detail-item-template\">\n \t<h2>Todo #<%- id %></h2>\n \t<div>\n \t<textarea style=\"width:300px;height:50px\" id=\"edit-todo\" autofocus placeholder=\"Todo?\"><%- todo %></textarea>\n+\t<select name=\"assignee\" id=\"user-list\">\n+\t</select>\n \t<input type=\"button\" id=\"updateTodo\" value=\"\u66f4\u65b0\"></input>\n \t<input type=\"button\" id=\"updateCancel\" value=\"\u30ad\u30e3\u30f3\u30bb\u30eb\"></input>\n \t</div>\n \t</script>\n \n\u301c\u3000\u7565\u3000\u301c\n```\n\n\u4e0b\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n\n- TODO\u4e00\u89a7\u753b\u9762\n\t- \u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u7528`<select></select>`\u3092\u8ffd\u52a0\n\t- table\u306b`<thead></thead>`\u3092\u8ffd\u52a0(\u9805\u76ee\u304c\u5897\u3048\u3066\u304d\u305f\u306e\u3067)\n\t- [\u524a\u9664]\u3068[\u8a73\u7d30]\u3092\u5225\u306e`<td></td>`\u306b\u5206\u5272\n- TODO\u8a73\u7d30\u753b\u9762\n\t- \u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u7528`<select></select>`\u3092\u8ffd\u52a0\n\n### user-collection.js\n\n```js:user-collection.js\n//User\u4e00\u89a7\u8868\u793a\u7528\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\ndefine(function(require) {\n\tvar UserModel = require('models/user-model');\n\n\tvar UserCollection = Backbone.Collection.extend({\n\t\turl : '/rest-study/users.json',\n\t\tmodel : UserModel,\n\n\t\tparse : function(response) {\n\t\t\treturn response;\n\t\t}\n\t});\n\t\n\treturn UserCollection;\n});\n```\n\n\u5fc5\u8981\u6700\u4f4e\u9650\u306ecollection\u306e\u5b9f\u88c5\u3067\u3059\u3002\n\u3053\u308c\u306f\u3082\u3046\u8aac\u660e\u4e0d\u8981\u3067\u3059\u306d\uff01\n\n\n### todo-model.js\n\n\u8ffd\u52a0\u9805\u76ee\u306e`Owner`\u3068`Assignee`\u3092\u30d1\u30fc\u30b9\u3057\u3066\u3044\u307e\u3059\u3002\n\n```diff:todo-model.js\n //Todo\u30c7\u30fc\u30bf\uff11\u4ef6\u3092\u8868\u3059\u30e2\u30c7\u30eb\n define(function() {\n \tvar TodoModel = Backbone.Model.extend({\n \t\turlRoot : '/rest-study/todo_lists',\n \t\tparse : function(response) {\n \t\t\t//\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\n \t\t\tconsole.log(\"\u30e2\u30c7\u30eb\u3092\u30d1\u30fc\u30b9\");\n \t\t\tconsole.log(response);\n-\t\t\treturn response.TodoList;\n+\t\t\tvar parsed = response.TodoList;\n+\t\t\tif (response.Owner) {\n+\t\t\t\tparsed.Owner = response.Owner;\n+\t\t\t\tparsed.Assignee = response.Assignee;\n+\t\t\t}\n+\t\t\treturn parsed;\n \t\t},\n \t\ttoggle : function() {\n \t\t\tthis.set('status', this.get(\"status\") === '1' ? '0' : '1');\n \t\t\tthis.save();\n \t\t}\n \t});\n \treturn TodoModel;\n });\n```\n\n\u30b5\u30fc\u30d0\u304b\u3089\u306fCakePHP\u4efb\u305b\u306e\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3067TODO1\u4ef6\u306eJSON\u304c\u6765\u308b\u306e\u3067\u3001\n\n```json:\u30b5\u30fc\u30d0\u304b\u3089\u6765\u305f\u751f\u306e\u72b6\u614b\n{\n    \"TodoList\": {\n        \"id\": \"62\",\n        \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n        \"status\": \"0\",\n        \"owned\": false,\n        \"assigned\": false\n    },\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    }\n}\n```\n\n\u3053\u3093\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002\n\n```json:\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u51e6\u7406\u3057\u3084\u3059\u3044\u3088\u3046\u6574\u5f62\n{\n    \"id\": \"62\",\n    \"todo\": \"\u725b\u4e73\u3092\u8cb7\u3046\",\n    \"status\": \"0\",\n    \"owned\": false,\n    \"assigned\": false,\n    \"Owner\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    },\n    \"Assignee\": {\n        \"id\": \"67\",\n        \"name\": \"\u5c71\u7530\u592a\u90ce\"\n    }\n}\n```\n\n### todo-layout-view.js\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\n```diff:todo-layout-view.js\n define(function(require){\n \tvar TodoCompositeView = require('views/todo-composite-view');\n \tvar TodoCollection = require('collections/todo-collection');\n+\tvar UserCollection = require('collections/user-collection');\n \n \tvar TodoLayoutView = Marionette.LayoutView.extend({\n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate: '#todo-layout-template',\n \n \t\tregions : {\n \t\t\tlistRegion : '#todo-lists',\n \t\t},\n \n-\t\tonRender : function(){\n+\t\tonRender : function() {\n+\t\t\tthis.userCollection = new UserCollection();\n+\t\t\tthis.listenTo(this.userCollection, 'reset', this.onLoadUsers, this);\n+\t\t\tthis.userCollection.fetch({reset : true});\n+\t\t},\n+\n+\t\tonLoadUsers : function(userCollection) {\n \t\t\tvar todoCollection = new TodoCollection();\n \t\t\tthis.listenTo(todoCollection , 'reset', this.showTodoList, this);\n \t\t\ttodoCollection.fetch({reset : true});\n \t\t},\n \n \t\tshowTodoList : function(todoCollection){\n \t\t\tthis.listRegion.show( new TodoCompositeView({\n-\t\t\t\tcollection : todoCollection\n+\t\t\t\tcollection : todoCollection,\n+\t\t\t\tuserList : this.userCollection.models\n \t\t\t}));\n \t\t},\n \n \t});\n \treturn TodoLayoutView;\n });\n```\n\n- `collections/user-collection`\u3092`require`\u3067\u8aad\u307f\u8fbc\u3080\n- `onRender`\u95a2\u6570\u5185\u3067\u3001`this.userCollection.fetch()`\u3067\u30b5\u30fc\u30d0\u304b\u3089\u30e6\u30fc\u30b6\u4e00\u89a7\u53d6\u5f97\u3002\n- fetch\u304c\u7d42\u308f\u308b\u3068(ListenTo\u304c\u52b9\u3044\u3066)`onLoadUsers`\u95a2\u6570\u3092\u5b9f\u884c\u3001\u7d9a\u3044\u3066`showTodoList`\u304c\u5b9f\u884c\u3055\u308c\u308b\n- `showTodoList`\u95a2\u6570\u5185\u3067\u3001`TodoCompositeView`\u306e\u521d\u671f\u5316\u6642\u306b\u3001\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u4e00\u89a7\u306ecollection\u3092\u6e21\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\t- \u3053\u306e\u30e6\u30fc\u30b6\u4e00\u89a7collection\u3092`TodoCompositeView`\u306e\u51e6\u7406\u3067\u8868\u793a\u3059\u308b\u308f\u3051\u3067\u3059\u3002\n\n\n\n\n### `todo-composite-view.js`\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```diff:todo-composite-view.js\n //Todo\u4e00\u89a7\u8868\u793a\u7528\u30d3\u30e5\u30fc\n define(function(require) {\n \tvar TodoItemView = require('views/todo-item-view');\n \n \tvar TodoCompositeView = Marionette.CompositeView.extend({\n \t\ttemplate: '#todo-composite-template',\n \n \t\tchildView : TodoItemView,\n \n \t\tchildViewContainer : 'tbody',\n \n \t\tui : {\n \t\t\taddTodo : '#addTodo',\n-\t\t\tnewTodo : '#new-todo'\n+\t\t\tnewTodo : '#new-todo',\n+\t\t\tuserList : '#user-list'\n \t\t},\n \n \t\tevents : {\n \t\t\t'click @ui.addTodo' : 'onCreateTodo',\n \t\t},\n \n-\t\tinitialize: function(){\n+\t\tinitialize: function(options){\n \t\t\t_.bindAll( this, 'onCreatedSuccess' );\n+\t\t\tthis.userList = options.userList;\n \t\t},\n \n+\t\tonRender : function() {\n+\t\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\t\tthis.showUserList(this.ui.userList, this.userList);\n+\t\t\t//\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+\t\t\tthis.ui.userList.val(window.application.loginUser.id);\n+\t\t},\n+\t\t\t\t\t\n+\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\tshowUserList : function($list, userList){\n+\t\t\t$.each(userList, function(index, userModel) {\n+\t\t\t\t$list.append(\n+\t\t\t\t\t\"<option value='\" \n+\t\t\t\t\t+ userModel.attributes.id + \"'>\"\n+\t\t\t\t\t+ userModel.attributes.name + \"</option>\");\n+\t\t\t});\n+\t\t},\n+\t\t\t\n \t\tonCreateTodo : function() {\n \t\t\tthis.collection.create(this.newAttributes(), {\n \t\t          silent:  true ,\n \t\t          success: this.onCreatedSuccess\n \t\t\t});\n \t\t\tthis.ui.newTodo.val('');\n \t\t},\n \n \t\tnewAttributes : function() {\n \t\t\treturn {\n \t\t\t\ttodo : this.ui.newTodo.val().trim(),\n-\t\t\t\tstatus : 0\n+\t\t\t\tstatus : 0,\n+\t\t\t\tassignee : this.ui.userList.val()\n \t\t\t};\n \t\t},\n \n \t\tonCreatedSuccess : function(){\n \t\t\tthis.collection.fetch({ reset : true });\n \t\t},\n \n \t});\n \treturn TodoCompositeView;\n });\n```\n\n\n- \u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081`ui`\u5909\u6570\u306b`userList`\u3092\u8ffd\u52a0\u3002\n- `initialize`\u95a2\u6570\u5185\u3067\u3001todo-layout-view\u304b\u3089\u6e21\u3055\u308c\u305f\u30e6\u30fc\u30b6\u4e00\u89a7collection(`options.userList`\u306b\u5165\u3063\u3066\u304f\u308b)\u3092\u81ea\u8eab\u306e\u4e2d(this.userList\u306b\u4fdd\u6301)\n- `onRender`\u95a2\u6570\u5185\u3067\u3001`showUserList`\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u3092\u884c\u3046\n- \u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u5f8c\u3001\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u7d30\u3093\u3057\u3066\u3044\u308b`window.application.loginUser`\u306e\u30e6\u30fc\u30b6\u60c5\u5831\u304b\u3089\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306eid\u3092\u53d6\u5f97\u3057\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u3067\u81ea\u5206\uff08\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\uff09\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u9078\u629e\u3055\u308c\u305f\u72b6\u614b\u306b\u8a2d\u5b9a\u3002\n- `showUserList`\u95a2\u6570\u3067\u306f\u3001jquery\u3092\u4f7f\u7528\u3057\u3001`ui`\u5909\u6570\u3067\u5b9a\u7fa9\u6e08\u307f\u306e`<select></select>`\u30bf\u30b0\u306e\u4e2d\u306b`<option></option>`\u30bf\u30b0\u3092\u57cb\u3081\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n- todo\u306e\u65b0\u898f\u8ffd\u52a0\u6642(`newAttributes`\u95a2\u6570)\u306f\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u3067\u9078\u629e\u3057\u305f\u30e6\u30fc\u30b6\u3092\u62c5\u5f53\u8005(`assignee`)\u3092\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n### todo-item-view.js\n\n\u524a\u9664\u30fb\u8a73\u7d30\u30dc\u30bf\u30f3\u306e\u8868\u793a\u5236\u5fa1\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n```diff:todo-item-view.js\n //Todo\u4e00\u89a7\u306e1\u4ef6\u8868\u793a\u7528\u30d3\u30e5\u30fc\n define(function(){\n \tvar TodoItemView = Marionette.ItemView.extend({\n \t\t//DOM\u306b\u8981\u7d20\u8ffd\u52a0\u306e\u30bf\u30b0\u540d\n \t\ttagName : 'tr',\n \n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate : '#todo-item-template',\n \n \t\tui : {\n \t\t\tcheckBox : '.toggle',\n-\t\t\tremoveLink : '.remove-link'\n+\t\t\tremoveLink : '.remove-link',\n+\t\t\tdetailLink : '.detail-link'\n \t\t},\n \n \t\t//DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n \t\tevents : {\n \t\t\t//\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.checkBox' : 'onStatusToggleClick',\n \t\t\t//\u524a\u9664\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.removeLink' : 'onRemoveClick',\n \t\t},\n \n \t\tonStatusToggleClick : function() {\n \t\t\tthis.model.toggle();\n \t\t},\n \n \t\tonRemoveClick : function() {\n \t\t\tthis.model.destroy({\n \t\t\t\twait : true\n \t\t\t});\n \t\t},\n \n+\t\tonRender : function() {\n+\t\t\tif (!this.model.attributes.owned) {\n+\t\t\t\t//\u30aa\u30fc\u30ca\u3067\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u30ea\u30f3\u30af\u975e\u8868\u793a\n+\t\t\t\tthis.ui.removeLink.css({\n+\t\t\t\t\tdisplay : 'none'\n+\t\t\t\t});\n+\t\t\t\tif (!this.model.attributes.assigned) {\n+\t\t\t\t\t//\u62c5\u5f53\u8005\u3067\u3082\u306a\u3044\u5834\u5408\u306f\u3001\n+\t\t\t\t\t//\u8a73\u7d30\u30ea\u30f3\u30af\u3082\u975e\u8868\u793a\n+\t\t\t\t\tthis.ui.detailLink.css({\n+\t\t\t\t\t\tdisplay : 'none'\n+\t\t\t\t\t});\n+\t\t\t\t\t//\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3082\u5909\u66f4\u4e0d\u53ef\n+\t\t\t\t\tthis.ui.checkBox.prop('disabled', true);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n \t});\n \treturn TodoItemView;\n }); \n```\n\n- `ui`\u5909\u6570\u306b\u524a\u9664\u30ea\u30f3\u30af\u7528\u306e\u5909\u6570`detailLink`\u3092\u8ffd\u52a0\n- `onRender`\u95a2\u6570\u3067\u3001\u524a\u9664\u3001\u8a73\u7d30\u306e\u5404\u30ea\u30f3\u30af\u306e\u8868\u793a\u5236\u5fa1\u3092\u4e0b\u8a18\u306e\u4ed5\u69d8\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\t- \u30aa\u30fc\u30ca\u3067\u306a\u3044\u5834\u5408\u306f\u524a\u9664\u30ea\u30f3\u30af\u3092\u975e\u8868\u793a\u306b\u3059\u308b\n\t\t- \u3055\u3089\u306b\u3001\u62c5\u5f53\u8005\u3067\u3082\u306a\u3044\u5834\u5408\u306f\u3001\n\t\t\t- \u8a73\u7d30\u30ea\u30f3\u30af\u3082\u8868\u793a\u306b\u3059\u308b\n\t\t\t- \u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092disable\u306b\u3057\u3066\u5909\u66f4\u4e0d\u53ef\u3068\u3059\u308b\n\n\u203b\u8868\u793a\u5236\u5fa1\u306e\u5b9f\u88c5\n\n- \u30ea\u30f3\u30af\u306e\u975e\u8868\u793a\n\t- jquery\u306ecss\u95a2\u6570\u3067\u3001`display : 'none'`\u306e\u30b9\u30bf\u30a4\u30eb\u3092\u8a2d\u5b9a\n- \u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u306e\u5909\u66f4\u4e0d\u53ef\n\t- jquery\u306eprop\u95a2\u6570\u3067\u3001`disabled`\u3092`true`\u306b\u8a2d\u5b9a\n\n### todo-detail-layout-view.js\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u8aad\u307f\u8fbc\u307f\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u3066\u3044\u307e\u3059\u3002\n\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u306f\u3001`todo-layout-view.js`\u3068\u307b\u307c\u540c\u3058\u3067\u3059\u3002\n\n```diff:todo-detail-layout-view.js\n define(function(require) {\n     var TodoDetailItemView = require('views/todo-detail-item-view');\n     var TodoModel = require('models/todo-model');\n+    var UserCollection = require('collections/user-collection');\n \n \tvar TodoDetailLayoutView = Marionette.LayoutView.extend({\n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate : '#todo-detail-layout-template',\n \n \t\tregions : {\n \t\t\titemRegion : '#todo-item',\n \t\t},\n \n \t\tonRender : function() {\n-\t\t\tvar todoModel = new TodoModel({\n-\t\t\t\tid : this.options.modelId\n-\t\t\t});\n-\t\t\t//\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n-\t\t\tthis.listenTo(todoModel, 'sync', this.showItem, this);\n-\t\t\t//\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n-\t\t\ttodoModel.fetch({\n-\t\t\t\twait : true\n+\t\t\tthis.userCollection = new UserCollection();\n+\t\t\tthis.listenToOnce(this.userCollection, 'reset', this.onLoadUsers, this);\n+\t\t\tthis.userCollection.fetch({\n+\t\t\t\treset : true\n \t\t\t});\n \t\t},\n \n-\t\tshowItem : function(todoModel) {\n-\t\t\tthis.itemRegion.show( new TodoDetailItemView({\n-\t\t\t\tmodel : todoModel\n-\t\t\t}));\n-\t\t},\n+\t\tonLoadUsers : function(userCollection){\n+ \t\t\tvar todoModel = new TodoModel({\n+ \t\t\t\tid : this.options.modelId\n+ \t\t\t});\n+ \t\t\t//\u30e2\u30c7\u30eb\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u6642\u3001\u63cf\u753b\u3092\u884c\u3046\n+\t\t\tthis.listenToOnce(todoModel, 'sync', this.showItem, this);\n+ \t\t\t//\u30b5\u30fc\u30d0\u304b\u3089\u30c7\u30fc\u30bf\u53d6\u5f97\n+ \t\t\ttodoModel.fetch({\n+ \t\t\t\twait : true\n+ \t\t\t});\n+ \t\t},\n+\n+ \t\tshowItem : function(todoModel) {\n+ \t\t\tthis.itemRegion.show(new TodoDetailItemView({\n+ \t\t\t\tmodel : todoModel,\n+ \t\t\t\tuserList : this.userCollection.models\n+ \t\t\t}));\n+ \t\t},\n \n \t});\n \treturn TodoDetailLayoutView;\n });\n```\n\n- `collections/user-collection`\u3092`require`\u3067\u8aad\u307f\u8fbc\u3080\n- `onRender`\u95a2\u6570\u5185\u3067\u3001`this.userCollection.fetch()`\u3067\u30b5\u30fc\u30d0\u304b\u3089\u30e6\u30fc\u30b6\u4e00\u89a7\u53d6\u5f97\u3002\n\t- \u5143\u3005`onRender`\u5185\u3067\u884c\u3063\u3066\u3044\u305f\u3001model1\u4ef6\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306e\u53d6\u5f97\u51e6\u7406\u306f\u3001`onLoadUsers`\u5185\u306b\u79fb\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\n-\u3000fetch\u304c\u7d42\u308f\u308b\u3068(ListenTo\u304c\u52b9\u3044\u3066)`onLoadUsers`\u95a2\u6570\u3092\u5b9f\u884c\u3001`todoModel.fetch()`\u3067TODO1\u4ef6\u306e\u53d6\u5f97\u3092\u884c\u3046\u3002\n- `showItem`\u95a2\u6570\u5185\u3067\u3001`TodoDetailItemView`\u306e\u521d\u671f\u5316\u6642\u306b\u3001\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u4e00\u89a7\u306ecollection\u3092\u6e21\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u308b\n\t- \u3053\u306e\u30e6\u30fc\u30b6\u4e00\u89a7collection\u3092`TodoDetailItemView`\u306e\u51e6\u7406\u3067\u8868\u793a\u3057\u307e\u3059\u3002\n\n\n### `todo-detail-item-view.js`\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```diff:todo-detail-item-view.js\n //\u8a73\u7d30\u30d3\u30e5\u30fc\n define(function() {\n \tvar TodoDetailItemView = Marionette.ItemView.extend({\n \n \t\t//\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\n \t\ttemplate: \"#todo-detail-item-template\",\n \n \t\tui : {\n \t\t\ttodoStatus   : '#edit-todo',\n \t\t\tupdateButton : '#updateTodo',\n-\t\t\tcancelButton : '#updateCancel'\n+\t\t\tcancelButton : '#updateCancel',\n+\t\t\tuserList     : '#user-list'\n \t\t},\n \n \t\t//DOM\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u8a2d\u5b9a\n \t\tevents : {\n \t\t\t//\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.updateButton' : 'onUpdateClick',\n \t\t\t//\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\n \t\t\t'click @ui.cancelButton' : 'onCancelClick',\n \t\t},\n \n \t\t//\u521d\u671f\u5316\n-\t\tinitialize: function(){\n+\t\tinitialize: function(options){\n \t\t\t_.bindAll( this, 'onSaveSuccess' );\n+\t\t\tthis.userList = options.userList;\n+\t\t},\n+\n+\t\tonRender : function() {\n+\t\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\t\tthis.showUserList(this.ui.userList, this.userList);\n+\t\t\t//\u62c5\u5f53\u8005\u3092\u9078\u629e\u72b6\u614b\u306b\u3059\u308b\n+\t\t\tthis.ui.userList.val(this.model.attributes.assignee);\n+\t\t},\n+\n+\t\t//\u30e6\u30fc\u30b6\u4e00\u89a7\u3092\u8868\u793a\n+\t\tshowUserList : function($list, userList){\n+\t\t\t$.each(userList, function(index, userModel) {\n+\t\t\t$list.append(\n+\t\t\t\t\"<option value='\" \n+\t\t\t\t+ userModel.attributes.id + \"'>\"\n+\t\t\t\t+ userModel.attributes.name + \"</option>\");\n+\t\t\t});\n \t\t},\n \n \t\t//\u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n \t\tonUpdateClick : function() {\n \t\t\t//\u30c6\u30ad\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u6587\u5b57\u3092\u53d6\u5f97\n-\t\t\tvar todoString = this.ui.todoStatus.val();\n+\t\t\tvar todoString = this.ui.todoStatus.val();  // Todo\n+\t\t\tvar assigneeId = this.ui.userList.val();\t// \u62c5\u5f53\u8005\n \t\t\tthis.model.save({\n-\t\t\t\ttodo : todoString\n+\t\t\t\ttodo : todoString,\n+\t\t\t\tassignee : assigneeId\n \t\t\t}, {\n \t\t\t\tsilent : true,\n \t\t\t\tsuccess : this.onSaveSuccess,\n \t\t\t});\n \t\t},\n \n \t\t//\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u306e\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n \t\tonCancelClick : function() {\n \t\t\tthis.backTodoLists();\n \t\t},\n \n \t\t//\u66f4\u65b0\u6210\u529f\n \t\tonSaveSuccess : function() {\n \t\t\tthis.backTodoLists();\n \t\t},\n \n \t\t//TODO\u30ea\u30b9\u30c8\u753b\u9762\u306b\u623b\u308b\n \t\tbackTodoLists : function() {\n \t\t\tBackbone.history.navigate('#todo-lists', true);\n \t\t}\n \n \t});\n \treturn TodoDetailItemView;\n });\n```\n\n\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u306b\u95a2\u3057\u3066\u306f\u3001`todo-composite-view.js`\u3067\u3084\u3063\u305f\u3053\u3068\u3068\u540c\u69d8\u3067\u3059\u3002\n\n\n- \u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u3092\u51e6\u7406\u3059\u308b\u305f\u3081`ui`\u5909\u6570\u306b`userList`\u3092\u8ffd\u52a0\u3002\n- `initialize`\u95a2\u6570\u5185\u3067\u3001todo-layout-view\u304b\u3089\u6e21\u3055\u308c\u305f\u30e6\u30fc\u30b6\u4e00\u89a7collection(`options.userList`\u306b\u5165\u3063\u3066\u304f\u308b)\u3092\u81ea\u8eab\u306e\u4e2d(this.userList\u306b\u4fdd\u6301)\n- `onRender`\u95a2\u6570\u5185\u3067\u3001`showUserList`\u95a2\u6570\u3092\u5b9f\u884c\u3057\u3066\u30e6\u30fc\u30b6\u4e00\u89a7\u306e\u8868\u793a\u3092\u884c\u3046\n- \u30e6\u30fc\u30b6\u4e00\u89a7\u8868\u793a\u5f8c\u3001\u8868\u793a\u3059\u308bTODO\u306e\u62c5\u5f53\u8005\u306e\u30e6\u30fc\u30b6ID(model\u306e`assignee`\u304b\u3089\u53d6\u5f97)\u3092\u9078\u629e\u3055\u308c\u305f\u72b6\u614b\u306b\u8a2d\u5b9a\u3002\n- `showUserList`\u95a2\u6570\u306f\u3001`todo-composite-view.js`\u5185\u306e\u540c\u95a2\u6570\u306e\u30b3\u30d4\u30da\u3067\u3059\uff01\uff08\u4eca\u56de\u306f\u3053\u308c\u3067\u3054\u4e86\u627f\u3092\uff01\uff09\n- \u66f4\u65b0\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af\u6642\u306e\u51e6\u7406(`onUpdateClick`\u95a2\u6570)\u3067\u306f\u3001\u30e6\u30fc\u30b6\u4e00\u89a7\u3067\u9078\u629e\u3057\u305f\u30e6\u30fc\u30b6\u3092\u62c5\u5f53\u8005(`assignee`)\u3092\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\n### \u5b9f\u88c5\n\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u4fee\u6b63\u3057\u3066\u753b\u9762\u306e\u52d5\u4f5c\u78ba\u8a8d\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\n- :white_check_mark: `app/View/Layouts/default.ctp`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/webroot/js/collections/user-collection.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/webroot/js/models/todo-model.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/webroot/js/views/todo-layout-view.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/webroot/js/views/todo-composite-view.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u4fee\u6b63\u3002\n- :white_check_mark: `app/webroot/js/views/todo-item-view.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n- :white_check_mark: `app/webroot/js/views/todo-detail-layout-view.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n- :white_check_mark: `app/webroot/js/views/todo-detail-item-view.js`\u3092\u4e0a\u8a18\u306e\u901a\u308a\u65b0\u898f\u4f5c\u6210\u3002\n- :white_check_mark: \u52d5\u4f5c\u78ba\u8a8d!\n- :white_check_mark: Git\u306b\u30b3\u30df\u30c3\u30c8\n\n\n**GitHub\u3067\u306ediff\u8868\u793a\u3078\u306e\u30ea\u30f3\u30af**\n\n[\u7b2c6\u56de Lesson1 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 \u00b7 suzukishouten-study/rest-study@f1623dc](https://github.com/suzukishouten-study/rest-study/commit/f1623dce75cbd2d38a4b971ffcb5b48ca6d4b91b)\n\n\u4ee5\u4e0a\u3067\u3059\uff01\n\n## \u6b21\u56de\u4e88\u544a\n\n\u6b21\u56de\u30c6\u30fc\u30de\u306f\u3001[\u30b5\u30fc\u30d0\u30fc\u30fb\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4e21\u9762\u304b\u3089\u304b\u3051\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3 - connpass](http://aws-rest-todo.connpass.com/event/12735/)\u3067\u3059\u3002\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6a5f\u80fd\u3092\u4ed8\u3051\u3066\u3001\u300c\u3061\u3083\u3093\u3068\u3057\u305f\u300d\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u6210\u9577\u3055\u305b\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305f\u305c\u3072\u3054\u53c2\u52a0\u304f\u3060\u3055\u3044\uff01\n\n## \u30b3\u30e1\u30f3\u30c8/\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u53c2\u52a0\u8005\u306e\u65b9\u3082\u3001\u305d\u3046\u3067\u306a\u3044\u65b9\u3082\u304a\u6c17\u3065\u304d\u306e\u70b9\u304c\u3042\u308c\u3070\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002\n\n\n\n\n\n\n\n", "tags": ["JavaScript", "\u52c9\u5f37\u4f1a", "CakePHP", "rest", "AWS"]}