{"tags": ["iOS", "Swift", "WKWebView"], "context": "Safari\u3068\u540c\u69d8\u306b\u30b9\u30ef\u30a4\u30d7\u3067\u623b\u308b\u3001\u9032\u3080\u6a5f\u80fd\u3084\u5c06\u6765\u6027\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u8003\u3048\u3066WKWebView\u3092\u5c0e\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nUIWebView\u3068\u306e\u9055\u3044\u304b\u3089\u3001\u3064\u307e\u305a\u3044\u305f\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308b\u306e\u30673\u3064\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u74b0\u5883\nSwift3.0\nXcode8.1 (8B62)\n\n\u3064\u307e\u305a\u304d\u30dd\u30a4\u30f3\u30c8\n\n1. WKWebView\u3067\u306fPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306eHTTP Body\u304c\u7121\u8996\u3055\u308c\u308b\nUIWebView\u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306bPOST\u306eURLRequest\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3057\u305f\u3002\nlet request = URLRequest(url: url)\nrequest.httpMethod = \"POST\"\nrequest.httpBody = ...\n\n// OK\nlet uiWebView = UIWebView()\nuiWebView.loadRequest(request)\n\n// request.httpBody\u306e\u5024\u304c\u7121\u8996\u3055\u308c\u308b\nlet wkWebView = WKWebView()\nwkWebView.load(request)\n\nWKWebView\u3067\u306frequest.httpBody\u306b\u8a2d\u5b9a\u3057\u305f\u5024\u304c\u7121\u8996\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u4eca\u307e\u3067Body\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u4e0e\u3057\u3066\u3044\u305f\u5834\u5408\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u69cb\u9020\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u89e3\u6c7a\u65b9\u6cd5\u3068\u3057\u3066\u306f\u30012\u70b9\u3042\u308a\u307e\u3059\u3002\n\n\nURLSessionDataTask\u3067\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u3092WKWebView\u306e\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3059\u3002\n\n\nfunc loadHTMLString(_ string: String, baseURL: URL?) -> WKNavigation?\n\nfunc load(_ data: Data, mimeType MIMEType: String, characterEncodingName: String, baseURL: URL) -> WKNavigation?(iOS9\u4ee5\u964d\uff09\n\n\nHTTP Header\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u542b\u3081\u308b\n\n1\u306e\u554f\u984c\u70b9\u306f\u3001backForwardList: WKBackForwardList\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\u3053\u3068\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eWKWebView\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3001\u30e1\u30bd\u30c3\u30c9\u304c\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\nvar backForwardList: WKBackForwardList { get }\nvar canGoBack: Bool { get }\nvar canGoForward: Bool { get }\nfunc goBack() -> WKNavigation?\nfunc goForward() -> WKNavigation?\nvar allowsBackForwardNavigationGestures: Bool\n\nSafari\u306e\u3088\u3046\u306a\u30b9\u30ef\u30a4\u30d7\u3067\u623b\u308b\u3001\u9032\u3080\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u30011\u756a\u306f\u8ae6\u3081\u307e\u3057\u305f\u3002\n\u50d5\u306e\u3084\u308a\u305f\u304b\u3063\u305f\u30b1\u30fc\u30b9\u3067\u306f2\u756a\u306eHeader\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u542b\u3081\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\nlet request = URLRequest(url: url)\nrequest.httpMethod = \"POST\"\nrequest.allHTTPHeaderFields = ...\n\n// OK\nlet wkWebView = WKWebView()\nwkWebView.load(request)\n\n\n2. WebView\u5185\u306eTwitter\u3001Facebook\u30dc\u30bf\u30f3\u304c\u52b9\u304b\u306a\u3044\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nWKWebView\u3067target=\"_blank\"\u306a\u30ea\u30f3\u30af\u304c\u958b\u304b\u306a\u3044\u6642\u306e\u5bfe\u51e6\u6cd5 - Qiita\nWhy is WKWebView not opening links with target=\u201c_blank\u201d - stackoverflow\nWKUIDelegate \u306e\u5b9f\u88c5\u3092\u3059\u308b\u306e\u304c\u4e00\u756a\u7c21\u5358\u305d\u3046\u3067\u3059\u3002\n// WKUIDelegate\u306e\u8a2d\u5b9a\nwebView.uiDelegate = self\n\n// WKUIDelegate\u306e\u30e1\u30bd\u30c3\u30c9\nfunc webView(_ webView: WKWebView, createWebViewWith configuration: WKWebViewConfiguration, for navigationAction: WKNavigationAction, windowFeatures: WKWindowFeatures) -> WKWebView? {\n\n\u3000   /*\n     Twitter\u306eTweet\u30dc\u30bf\u30f3\u3001\n     Facebook\u306e\u3044\u3044\u306d\u30dc\u30bf\u30f3\u3001\n     target=\"_blank\"\u306e\u30ea\u30f3\u30af\u306a\u3069\u3001\n     \u65b0\u3057\u3044\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u958b\u304f\u5834\u5408\u3001\u3053\u308c\u3092\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n     */\n    if navigationAction.targetFrame == nil {\n\n        webView.load(navigationAction.request)\n    }\n\n    return nil\n}\n\n\n3. iOS9\u3067scrollView\u306edecelerationRate\u3092\u5909\u66f4\u3067\u304d\u306a\u3044\nCannot change WKWebView's scroll rate on iOS 9 beta / 9.3 - stackoverflow\n\u4e0a\u8a18\u306e\u6295\u7a3f\u306b\u89e3\u6c7a\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3057\u305f\u3002\nwebView.scrollView.delegate = self\n\n\u3068\u3057\u3066\u304a\u3044\u3066\u3001\nextenstion WebViewController: UIScrollViewDelegate {\n\n    func scrollViewWillBeginDragging(scrollView: UIScrollView) {\n\n        scrollView.decelerationRate = UIScrollViewDecelerationRateNormal\n    }\n}\n\n\u3068\u3059\u308b\u3053\u3068\u3067decelerationRate\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001EXC_BAD_ACCESS\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3059\u308b\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u3001ViewController\u306edeinit\u6642\u306b\u4ee5\u4e0b\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\ndeinit {\n\n    webView.scrollView.delegate = nil\n}\n\nSafari\u3068\u540c\u69d8\u306b\u30b9\u30ef\u30a4\u30d7\u3067\u623b\u308b\u3001\u9032\u3080\u6a5f\u80fd\u3084\u5c06\u6765\u6027\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u8003\u3048\u3066WKWebView\u3092\u5c0e\u5165\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nUIWebView\u3068\u306e\u9055\u3044\u304b\u3089\u3001\u3064\u307e\u305a\u3044\u305f\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308b\u306e\u30673\u3064\u7d39\u4ecb\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u74b0\u5883\nSwift3.0\nXcode8.1 (8B62)\n\n## \u3064\u307e\u305a\u304d\u30dd\u30a4\u30f3\u30c8\n### 1. WKWebView\u3067\u306fPOST\u30ea\u30af\u30a8\u30b9\u30c8\u306eHTTP Body\u304c\u7121\u8996\u3055\u308c\u308b\nUIWebView\u3067\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306bPOST\u306e`URLRequest`\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n\n```swift\nlet request = URLRequest(url: url)\nrequest.httpMethod = \"POST\"\nrequest.httpBody = ...\n\n// OK\nlet uiWebView = UIWebView()\nuiWebView.loadRequest(request)\n\n// request.httpBody\u306e\u5024\u304c\u7121\u8996\u3055\u308c\u308b\nlet wkWebView = WKWebView()\nwkWebView.load(request)\n```\n\nWKWebView\u3067\u306f`request.httpBody`\u306b\u8a2d\u5b9a\u3057\u305f\u5024\u304c\u7121\u8996\u3055\u308c\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u4eca\u307e\u3067Body\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u4e0e\u3057\u3066\u3044\u305f\u5834\u5408\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u69cb\u9020\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u89e3\u6c7a\u65b9\u6cd5\u3068\u3057\u3066\u306f\u30012\u70b9\u3042\u308a\u307e\u3059\u3002\n\n1. `URLSessionDataTask`\u3067\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u3092WKWebView\u306e\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u306b\u6e21\u3059\u3002\n    - `func loadHTMLString(_ string: String, baseURL: URL?) -> WKNavigation?`\n    - `func load(_ data: Data, mimeType MIMEType: String, characterEncodingName: String, baseURL: URL) -> WKNavigation?`(iOS9\u4ee5\u964d\uff09\n- HTTP Header\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u542b\u3081\u308b\n\n1\u306e\u554f\u984c\u70b9\u306f\u3001`backForwardList: WKBackForwardList`\u304c\u52b9\u304b\u306a\u304f\u306a\u308b\u3053\u3068\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eWKWebView\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3001\u30e1\u30bd\u30c3\u30c9\u304c\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\n```swift\nvar backForwardList: WKBackForwardList { get }\nvar canGoBack: Bool { get }\nvar canGoForward: Bool { get }\nfunc goBack() -> WKNavigation?\nfunc goForward() -> WKNavigation?\nvar allowsBackForwardNavigationGestures: Bool\n```\n\nSafari\u306e\u3088\u3046\u306a\u30b9\u30ef\u30a4\u30d7\u3067\u623b\u308b\u3001\u9032\u3080\u6a5f\u80fd\u3092\u5b9f\u88c5\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u30011\u756a\u306f\u8ae6\u3081\u307e\u3057\u305f\u3002\n\u50d5\u306e\u3084\u308a\u305f\u304b\u3063\u305f\u30b1\u30fc\u30b9\u3067\u306f2\u756a\u306eHeader\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u542b\u3081\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\n\n```swift\nlet request = URLRequest(url: url)\nrequest.httpMethod = \"POST\"\nrequest.allHTTPHeaderFields = ...\n\n// OK\nlet wkWebView = WKWebView()\nwkWebView.load(request)\n```\n\n## 2. WebView\u5185\u306eTwitter\u3001Facebook\u30dc\u30bf\u30f3\u304c\u52b9\u304b\u306a\u3044\n\n\u4ee5\u4e0b\u306e\u30ea\u30f3\u30af\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n[WKWebView\u3067target=\"_blank\"\u306a\u30ea\u30f3\u30af\u304c\u958b\u304b\u306a\u3044\u6642\u306e\u5bfe\u51e6\u6cd5 - Qiita](http://qiita.com/ShingoFukuyama/items/b3a1441025a36ab7659c)\n[Why is WKWebView not opening links with target=\u201c_blank\u201d - stackoverflow](http://stackoverflow.com/questions/25713069/why-is-wkwebview-not-opening-links-with-target-blank)\n\n`WKUIDelegate` \u306e\u5b9f\u88c5\u3092\u3059\u308b\u306e\u304c\u4e00\u756a\u7c21\u5358\u305d\u3046\u3067\u3059\u3002\n\n```swift\n// WKUIDelegate\u306e\u8a2d\u5b9a\nwebView.uiDelegate = self\n```\n\n```swift\n// WKUIDelegate\u306e\u30e1\u30bd\u30c3\u30c9\nfunc webView(_ webView: WKWebView, createWebViewWith configuration: WKWebViewConfiguration, for navigationAction: WKNavigationAction, windowFeatures: WKWindowFeatures) -> WKWebView? {\n\n\u3000   /*\n     Twitter\u306eTweet\u30dc\u30bf\u30f3\u3001\n     Facebook\u306e\u3044\u3044\u306d\u30dc\u30bf\u30f3\u3001\n     target=\"_blank\"\u306e\u30ea\u30f3\u30af\u306a\u3069\u3001\n     \u65b0\u3057\u3044\u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u958b\u304f\u5834\u5408\u3001\u3053\u308c\u3092\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n     */\n    if navigationAction.targetFrame == nil {\n            \n        webView.load(navigationAction.request)\n    }\n        \n    return nil\n}\n```\n\n## 3. iOS9\u3067scrollView\u306edecelerationRate\u3092\u5909\u66f4\u3067\u304d\u306a\u3044\n\n[Cannot change WKWebView's scroll rate on iOS 9 beta / 9.3 - stackoverflow](\nhttp://stackoverflow.com/questions/31369538/cannot-change-wkwebviews-scroll-rate-on-ios-9-beta-9-3)\n\n\u4e0a\u8a18\u306e\u6295\u7a3f\u306b\u89e3\u6c7a\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n```swift\nwebView.scrollView.delegate = self\n```\n\n\u3068\u3057\u3066\u304a\u3044\u3066\u3001\n\n```swift\nextenstion WebViewController: UIScrollViewDelegate {\n    \n    func scrollViewWillBeginDragging(scrollView: UIScrollView) {\n        \n        scrollView.decelerationRate = UIScrollViewDecelerationRateNormal\n    }\n}\n```\n\n\u3068\u3059\u308b\u3053\u3068\u3067decelerationRate\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001EXC_BAD_ACCESS\u3067\u30af\u30e9\u30c3\u30b7\u30e5\u3059\u308b\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u3001ViewController\u306edeinit\u6642\u306b\u4ee5\u4e0b\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n```swift\ndeinit {\n        \n    webView.scrollView.delegate = nil\n}\n```\n\n"}