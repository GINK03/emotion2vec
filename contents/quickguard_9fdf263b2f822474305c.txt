{"context": " More than 1 year has passed since last update.\n\n\u524d\u63d0\n\nGoogleCloudPlatform \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u53d6\u5f97\u6e08\u307f\nGoogle Cloud SDK \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304a\u3088\u3073\u8a8d\u8a3c\u6e08\u307f\nterraform\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\uff08\u4eca\u56de\u306e\u74b0\u5883\u3067\u306f0.6.8\uff09\n\n\n\u4e8b\u524d\u4f5c\u696d\nGoogleDevelopersConsole \u306b\u3066\u4ee5\u4e0b\u306e\u4f5c\u696d\u3092\u884c\u3063\u3066\u304a\u304f\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\nOAuth \u306e\u540c\u610f\u8a2d\u5b9a\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30ad\u30fc\u306e\u53d6\u5f97\uff08JSON\u5f62\u5f0f\uff09\n\n\n\u624b\u9806\ntf\u30d5\u30a1\u30a4\u30eb\u3068\u540c\u3058\u5834\u6240\u306b\u4e8b\u524d\u306b\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30ad\u30fc\u306eJSON\u3092\u7f6e\u304f\n\u25a0tf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\nvariable \"project\" {}\nvariable \"region\" {\n  default = \"asia-east1\"\n}\nvariable \"cluster_name\" {}\nvariable \"zone\" {}\nvariable \"network\" {}\nvariable \"initial_node_count\" {}\nvariable \"machine_type\" {}\nvariable \"disk_size\" {}\nvariable \"master_auth_username\" {}\nvariable \"master_auth_password\" {}\n\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project     = \"${var.project}\"\n  region      = \"${var.region}\"\n}\n\nresource \"google_container_cluster\" \"default\" {\n  name = \"${var.cluster_name}\"\n  zone = \"${var.zone}\"\n  network = \"${var.network}\"\n  initial_node_count = \"${var.initial_node_count}\"\n\n  node_config {\n    machine_type = \"${var.machine_type}\"\n    disk_size_gb = \"${var.disk_size}\"\n  }\n\n  master_auth {\n    username = \"${var.master_auth_username}\"\n    password = \"${var.master_auth_password}\"\n  }\n\n}\n\n\u25a0terraform.tfvars\u306e\u4e2d\u8eab\nproject = \"************\"\ncluster_name = \"cluster-1\"\nzone = \"asia-east1-b\"\nnetwork = \"default\"\ninitial_node_count = \"3\"\nmachine_type = \"f1-micro\"\ndisk_size = \"10\"\nmaster_auth_username = \"***********\"\nmaster_auth_password = \"***********\"\n\n\u203bf1-micro \u306e\u5834\u5408\u306f\u3001initial_node_count \u306e\u5024\u306f3\u4ee5\u4e0a\u3092\u6307\u5b9a\nterraform apply \u5b9f\u884c\u3059\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b\n\nKubernetes \u306e Web UI \u3078\u306e\u30ed\u30b0\u30a4\u30f3\n\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u306e MASTER IP \u3092\u78ba\u8a8d\n$ gcloud container clusters list\nNAME       ZONE          MASTER_VERSION  MASTER_IP        MACHINE_TYPE  NUM_NODES  STATUS\ncluster-1  asia-east1-b  1.1.3           ***.***.***.***  f1-micro      3          RUNNING\n\nhttps://{\u4e0a\u8a18 MASTER_IP \u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9}/ui/ \u306b\u30a2\u30af\u30bb\u30b9\n\u203bBasic\u8a8d\u8a3c\u306eID\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306f terraform \u306e .tfvars \u306b\u8a2d\u5b9a\u3057\u305f master_auth_username / master_auth_password \u3068\u306a\u308a\u307e\u3059\n\nkubectl \u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u53d6\u5f97\n$ gcloud container clusters get-credentials cluster-1\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     1m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     1m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     1m\n\n\n\u203bTIPS\ncluster\u5185\u306e\u30ce\u30fc\u30c9\u8ffd\u52a0\u30fb\u524a\u9664\u306b\u95a2\u3057\u3066\u306f\u3001terraform\u304b\u3089\u306f\u5909\u66f4\u3067\u304d\u306a\u3044\ninitial_node_count = \"4\" \u306b\u5909\u66f4\u3057\u3066 terraform plan \u5b9f\u884c\u3059\u308b\u3068 cluster \u304c\u518d\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308b\n-/+ google_container_cluster.default\n    cluster_ipv4_cidr:                    \"10.52.0.0/14\" => \"<computed>\"\n    endpoint:                             \"***.***.***.***\" => \"<computed>\"\n    initial_node_count:                   \"3\" => \"4\" (forces new resource)\n\n\n\u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u65b9\u6cd5\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u78ba\u8a8d\u3059\u308b\n$ gcloud compute instance-groups managed list\nNAME                         ZONE         BASE_INSTANCE_NAME          SIZE TARGET_SIZE INSTANCE_TEMPLATE            AUTOSCALED\ngke-cluster-1-e6ff40f6-group asia-east1-b gke-cluster-1-e6ff40f6-node 3    3           gke-cluster-1-e6ff40f6-1-1-3 no\n\ngcloud \u30b3\u30de\u30f3\u30c9\u306b\u3066\u78ba\u8a8d\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u3001\u30b5\u30a4\u30ba\u5909\u66f4\uff08\u30ce\u30fc\u30c9\u6570\u30923\u21924\u306b\u5909\u66f4\uff09\n$ gcloud compute instance-groups managed resize gke-cluster-1-e6ff40f6-group --size 4\n...snip...\ncurrentActions:\n  abandoning: 0\n  creating: 1\n  deleting: 0\n  none: 3\n  recreating: 0\n  refreshing: 0\n  restarting: 0\n...snip...\ntargetSize: 4\nzone: asia-east1-b\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-c723   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-c723   Ready     1m\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     23m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     23m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     23m\n\n\n\u30ce\u30fc\u30c9\u306e\u524a\u9664\n\u30ce\u30fc\u30c9\u6570\u30924\u21923\u306b\u5909\u66f4\n$ gcloud compute instance-groups managed resize gke-cluster-1-e6ff40f6-group --size 3\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     34m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     34m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     34m\n\n# \u524d\u63d0\n- GoogleCloudPlatform \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306f\u53d6\u5f97\u6e08\u307f\n- Google Cloud SDK \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304a\u3088\u3073\u8a8d\u8a3c\u6e08\u307f\n- terraform\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\uff08\u4eca\u56de\u306e\u74b0\u5883\u3067\u306f0.6.8\uff09\n\n# \u4e8b\u524d\u4f5c\u696d\nGoogleDevelopersConsole \u306b\u3066\u4ee5\u4e0b\u306e\u4f5c\u696d\u3092\u884c\u3063\u3066\u304a\u304f\n\n- \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\n- OAuth \u306e\u540c\u610f\u8a2d\u5b9a\n- \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30ad\u30fc\u306e\u53d6\u5f97\uff08JSON\u5f62\u5f0f\uff09\n\n# \u624b\u9806\ntf\u30d5\u30a1\u30a4\u30eb\u3068\u540c\u3058\u5834\u6240\u306b\u4e8b\u524d\u306b\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30ad\u30fc\u306eJSON\u3092\u7f6e\u304f\n\n\u25a0tf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```\nvariable \"project\" {}\nvariable \"region\" {\n  default = \"asia-east1\"\n}\nvariable \"cluster_name\" {}\nvariable \"zone\" {}\nvariable \"network\" {}\nvariable \"initial_node_count\" {}\nvariable \"machine_type\" {}\nvariable \"disk_size\" {}\nvariable \"master_auth_username\" {}\nvariable \"master_auth_password\" {}\n\nprovider \"google\" {\n  credentials = \"${file(\"account.json\")}\"\n  project     = \"${var.project}\"\n  region      = \"${var.region}\"\n}\n\nresource \"google_container_cluster\" \"default\" {\n  name = \"${var.cluster_name}\"\n  zone = \"${var.zone}\"\n  network = \"${var.network}\"\n  initial_node_count = \"${var.initial_node_count}\"\n\n  node_config {\n    machine_type = \"${var.machine_type}\"\n    disk_size_gb = \"${var.disk_size}\"\n  }\n\n  master_auth {\n    username = \"${var.master_auth_username}\"\n    password = \"${var.master_auth_password}\"\n  }\n\n}\n```\n\n\n\u25a0terraform.tfvars\u306e\u4e2d\u8eab\n\n```\nproject = \"************\"\ncluster_name = \"cluster-1\"\nzone = \"asia-east1-b\"\nnetwork = \"default\"\ninitial_node_count = \"3\"\nmachine_type = \"f1-micro\"\ndisk_size = \"10\"\nmaster_auth_username = \"***********\"\nmaster_auth_password = \"***********\"\n```\n\u203bf1-micro \u306e\u5834\u5408\u306f\u3001initial_node_count \u306e\u5024\u306f3\u4ee5\u4e0a\u3092\u6307\u5b9a\n\n\nterraform apply \u5b9f\u884c\u3059\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\n# Kubernetes \u306e Web UI \u3078\u306e\u30ed\u30b0\u30a4\u30f3\n\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u306e MASTER IP \u3092\u78ba\u8a8d\n\n```\n$ gcloud container clusters list\nNAME       ZONE          MASTER_VERSION  MASTER_IP        MACHINE_TYPE  NUM_NODES  STATUS\ncluster-1  asia-east1-b  1.1.3           ***.***.***.***  f1-micro      3          RUNNING\n```\nhttps://{\u4e0a\u8a18 MASTER_IP \u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9}/ui/ \u306b\u30a2\u30af\u30bb\u30b9\n\u203bBasic\u8a8d\u8a3c\u306eID\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306f terraform \u306e .tfvars \u306b\u8a2d\u5b9a\u3057\u305f master_auth_username / master_auth_password \u3068\u306a\u308a\u307e\u3059\n\n![01.png](https://qiita-image-store.s3.amazonaws.com/0/105824/c949e659-92c9-578e-1fe7-e8e3ab0b17c6.png)\n\n\n\n\nkubectl \u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u53d6\u5f97\n\n```\n$ gcloud container clusters get-credentials cluster-1\n```\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n\n```\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     1m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     1m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     1m\n```\n\n\n# \u203bTIPS\ncluster\u5185\u306e\u30ce\u30fc\u30c9\u8ffd\u52a0\u30fb\u524a\u9664\u306b\u95a2\u3057\u3066\u306f\u3001terraform\u304b\u3089\u306f\u5909\u66f4\u3067\u304d\u306a\u3044\n\ninitial_node_count = \"4\" \u306b\u5909\u66f4\u3057\u3066 terraform plan \u5b9f\u884c\u3059\u308b\u3068 cluster \u304c\u518d\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u304c\u5206\u304b\u308b\n\n```\n-/+ google_container_cluster.default\n    cluster_ipv4_cidr:                    \"10.52.0.0/14\" => \"<computed>\"\n    endpoint:                             \"***.***.***.***\" => \"<computed>\"\n    initial_node_count:                   \"3\" => \"4\" (forces new resource)\n```\n\n# \u30ce\u30fc\u30c9\u306e\u8ffd\u52a0\u65b9\u6cd5\n\n\u307e\u305a\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ gcloud compute instance-groups managed list\nNAME                         ZONE         BASE_INSTANCE_NAME          SIZE TARGET_SIZE INSTANCE_TEMPLATE            AUTOSCALED\ngke-cluster-1-e6ff40f6-group asia-east1-b gke-cluster-1-e6ff40f6-node 3    3           gke-cluster-1-e6ff40f6-1-1-3 no\n```\n\ngcloud \u30b3\u30de\u30f3\u30c9\u306b\u3066\u78ba\u8a8d\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u306b\u5bfe\u3057\u3066\u3001\u30b5\u30a4\u30ba\u5909\u66f4\uff08\u30ce\u30fc\u30c9\u6570\u30923\u21924\u306b\u5909\u66f4\uff09\n\n```\n$ gcloud compute instance-groups managed resize gke-cluster-1-e6ff40f6-group --size 4\n...snip...\ncurrentActions:\n  abandoning: 0\n  creating: 1\n  deleting: 0\n  none: 3\n  recreating: 0\n  refreshing: 0\n  restarting: 0\n...snip...\ntargetSize: 4\nzone: asia-east1-b\n```\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n\n```\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-c723   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-c723   Ready     1m\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     23m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     23m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     23m\n```\n\n# \u30ce\u30fc\u30c9\u306e\u524a\u9664\n\u30ce\u30fc\u30c9\u6570\u30924\u21923\u306b\u5909\u66f4\n\n```\n$ gcloud compute instance-groups managed resize gke-cluster-1-e6ff40f6-group --size 3\n```\n\n\u30ce\u30fc\u30c9\u306e\u78ba\u8a8d\n\n```\n$ kubectl get node\nNAME                               LABELS                                                    STATUS    AGE\ngke-cluster-1-e6ff40f6-node-oxvo   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-oxvo   Ready     34m\ngke-cluster-1-e6ff40f6-node-v2rg   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v2rg   Ready     34m\ngke-cluster-1-e6ff40f6-node-v8mt   kubernetes.io/hostname=gke-cluster-1-e6ff40f6-node-v8mt   Ready     34m\n```\n\n\n", "tags": ["Terraform", "GoogleCloudPlatform", "GoogleContainerEngine", "GKE", "\u30e1\u30e2"]}