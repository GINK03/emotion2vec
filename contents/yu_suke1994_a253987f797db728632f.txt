{"context": "\n\nh2o\u3068mruby\n\u3042\u308b\u65e5\u3001\n\u300ch2o\u3068mruby\u4f7f\u3063\u305f\u3089html\u304c\u306a\u304f\u3066\u3082response\u8fd4\u305b\u308b\u3093\u3058\u3083\u306a\u3044\u304b?\u300d\n\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nmruby\u3067\u3069\u306e\u3088\u3046\u306b\u8fd4\u3059\u30c7\u30fc\u30bf\u3092\u6301\u3064\u304b\n\u3055\u3066\u3001response\u306e\u5185\u5bb9\u3092mruby script\u306e\u4e2d\u306b\u30d9\u30bf\u66f8\u304d\u3059\u308b\u306e\u306f\u30ab\u30c3\u30b3\u60aa\u305d\u3046\u306a\u306e\u3067\u3001yaml\u306b\u8a18\u8ff0\u3057\u3066\u3001\u5916\u90e8\u304b\u3089\u8aad\u307f\u3053\u3080\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\nh2o\u306e\u7528\u610f\n\u3072\u3068\u307e\u305a\u3001mruby\u3067\u7c21\u5358\u306aresponse\u3092\u8fd4\u3059h2o\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nDockerfile\nFROM unasuke/h2o-alpine:v2.0.4\n\nCOPY . /etc/h2o\nCMD [\"h2o\", \"--mode=master\", \"-c\", \"h2o.conf\"]\n\n\n\nh2o.conf\nlisten: 80\nhosts:\n  \"127.0.0.1:80\":\n    paths:\n      \"/\":\n        mruby.handler-file: server.rb\naccess-log: /dev/stdout\n\n\n\nserver.rb\nclass Server\n  def call(env)\n    [200,\n     {\n       \"content-type\" => \"text/plain; charset=utf-8\",\n     },\n     [\"Hello mruby in h2o!\"]\n    ]\n  end\nend\n\nServer.new\n\n\nCreate simple server \u00b7 unasuke/mruby_ac2016@27cf7eb\n# build\u3057\u3066run\n% docker build -t h2o_mruby .\n% docker run -it -p 8080:80 h2o_mruby\n\n\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306b8080\u756a\u30dd\u30fc\u30c8\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002mruby\u304cresponse\u3092\u8fd4\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\nmruby\u304cyaml\u3092\u8aad\u307f\u3053\u3080\u305f\u3081\u306b\nmruby script\u306e\u4e2d\u3067yaml\u3092\u8aad\u307f\u3053\u3080\u305f\u3081\u306b\u306f\u3001AndrewBelt/mruby-yaml\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u304c\u3001\u3053\u306emrbgem\u306f\u7d20\u306eh2o\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001mruby-yaml\u3092\u542b\u3093\u3060h2o\u3092build\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067\u3001\u305d\u306e\u3088\u3046\u306ah2o\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\nunasuke/h2o at mruby-yaml\n\u7528\u610f\u3068\u3044\u3063\u3066\u3082\u7c21\u5358\u3067\u3001deps \u4ee5\u4e0b\u306bmruby-yaml\u3092clone\u3057\u3066\u304f\u308b\u3060\u3051\u3067\u3059\u3002\n\u305d\u3057\u3066\u3001Dockerfile\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3001h2o\u3092build\u3057\u307e\u3059\u3002\n\nDockerfile\nFROM alpine\n\nRUN apk add --no-cache --virtual=builddeps \\\n        bison           \\\n        ca-certificates \\\n        cmake           \\\n        curl            \\\n        gcc             \\\n        git             \\\n        g++             \\\n        libc-dev        \\\n        linux-headers   \\\n        make            \\\n        openssl         \\\n        perl            \\\n        ruby            \\\n        ruby-dev        \\\n        wget            \\\n        yaml-dev        \\\n        zlib-dev        \\\n    && git clone https://github.com/unasuke/h2o.git \\\n    && cd h2o \\\n    && git checkout mruby-yaml \\\n    && cmake -DWITH_BUNDLED_SSL=on -DWITH_MRUBY=on . \\\n    && make install \\\n    && cd .. \\\n    && rm -rf h2o-* \\\n    && apk del builddeps \\\n    && apk add --no-cache --virtual=rundeps \\\n        libstdc++ \\\n        perl\n\nRUN mkdir /etc/h2o\n\nWORKDIR /etc/h2o\n\nEXPOSE 80 443\n\nCOPY . /etc/h2o\nCMD [\"h2o\", \"--mode=master\", \"-c\", \"h2o.conf\"]\n\n\nBuild h2o with mruby-yaml \u00b7 unasuke/mruby_ac2016@4a3c552\n\nyaml\u3092\u8aad\u3080\n\u3044\u308d\u3044\u308d\u6e96\u5099\u304c\u6574\u3063\u305f\u306e\u3067\u3001yaml\u3092\u8aad\u307f\u3053\u3093\u3067response\u3092\u8fd4\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306ayaml\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\ndata.yml\nresponses:\n  -\n    path: \"/\"\n    message: \"index\"\n  - \n    path: \"/hoge\"\n    message: \"hoge\"\n  - \n    path: \"/fuga\"\n    message: \"fuga\"\n\n\n\u305d\u3057\u3066\u3001\u305d\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066response\u3092\u8fd4\u3059\u3088\u3046\u306b\u3001mruby script\u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u304b\u3048\u307e\u3059\u3002\n\nserver.rb\nclass Server\n  def call(env)\n    response = fetch_response env['PATH_INFO']\n    if response\n      [200,\n       {\n         \"content-type\" => \"text/plain; charset=utf-8\",\n       },\n       [response]\n      ]\n    else\n      [404,\n       {\n         \"content-type\" => \"text/plain; charset=utf-8\",\n       },\n       [\"Not found\"]\n      ]\n    end\n  end\n\n  def fetch_response(path)\n    yaml = YAML.load(File.open('data.yml').read)\n    message = nil\n    yaml['responses'].each do |res|\n      if res['path'] == path\n        message = res['message']\n      end\n    end\n    message\n  end\nend\n\nServer.new\n\n\nReturn response from yaml \u00b7 unasuke/mruby_ac2016@125a17b\ndocker build\u3057\u3066run\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306byaml\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066response\u304c\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n\n\u4f59\u8ac7\n\u672c\u5f53\u306fhaconiwa\u306e\u306a\u304b\u3067h2o\u3092\u52d5\u4f5c\u3055\u305b\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u306b\u3082\u3046\u307e\u304f\u3067\u304d\u305a\u8ae6\u3081\u307e\u3057\u305f\u3002\n## h2o\u3068mruby\n\u3042\u308b\u65e5\u3001\n\n__\u300ch2o\u3068mruby\u4f7f\u3063\u305f\u3089html\u304c\u306a\u304f\u3066\u3082response\u8fd4\u305b\u308b\u3093\u3058\u3083\u306a\u3044\u304b?\u300d__\n\n\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u3084\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n## mruby\u3067\u3069\u306e\u3088\u3046\u306b\u8fd4\u3059\u30c7\u30fc\u30bf\u3092\u6301\u3064\u304b\n\u3055\u3066\u3001response\u306e\u5185\u5bb9\u3092mruby script\u306e\u4e2d\u306b\u30d9\u30bf\u66f8\u304d\u3059\u308b\u306e\u306f\u30ab\u30c3\u30b3\u60aa\u305d\u3046\u306a\u306e\u3067\u3001yaml\u306b\u8a18\u8ff0\u3057\u3066\u3001\u5916\u90e8\u304b\u3089\u8aad\u307f\u3053\u3080\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n## h2o\u306e\u7528\u610f\n\u3072\u3068\u307e\u305a\u3001mruby\u3067\u7c21\u5358\u306aresponse\u3092\u8fd4\u3059h2o\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n```dockerfile:Dockerfile\nFROM unasuke/h2o-alpine:v2.0.4\n\nCOPY . /etc/h2o\nCMD [\"h2o\", \"--mode=master\", \"-c\", \"h2o.conf\"]\n```\n\n```yaml:h2o.conf\nlisten: 80\nhosts:\n  \"127.0.0.1:80\":\n    paths:\n      \"/\":\n        mruby.handler-file: server.rb\naccess-log: /dev/stdout\n```\n\n```ruby:server.rb\nclass Server\n  def call(env)\n    [200,\n     {\n       \"content-type\" => \"text/plain; charset=utf-8\",\n     },\n     [\"Hello mruby in h2o!\"]\n    ]\n  end\nend\n\nServer.new\n```\n\n[Create simple server \u00b7 unasuke/mruby_ac2016@27cf7eb](https://github.com/unasuke/mruby_ac2016/commit/27cf7ebe265141a0c5180a7b61497b521cdb7e5b)\n\n```s\n# build\u3057\u3066run\n% docker build -t h2o_mruby .\n% docker run -it -p 8080:80 h2o_mruby\n```\n\n\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306b8080\u756a\u30dd\u30fc\u30c8\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002mruby\u304cresponse\u3092\u8fd4\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n![response from server.rb](https://qiita-image-store.s3.amazonaws.com/0/18796/61973ce8-de74-6b4e-bfed-1ec9cc37333b.png)\n\n## mruby\u304cyaml\u3092\u8aad\u307f\u3053\u3080\u305f\u3081\u306b\nmruby script\u306e\u4e2d\u3067yaml\u3092\u8aad\u307f\u3053\u3080\u305f\u3081\u306b\u306f\u3001[AndrewBelt/mruby-yaml](https://github.com/AndrewBelt/mruby-yaml)\u3092\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u304c\u3001\u3053\u306emrbgem\u306f\u7d20\u306eh2o\u306b\u306f\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001mruby-yaml\u3092\u542b\u3093\u3060h2o\u3092build\u3057\u306a\u304f\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067\u3001\u305d\u306e\u3088\u3046\u306ah2o\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n[unasuke/h2o at mruby-yaml](https://github.com/unasuke/h2o/tree/mruby-yaml)\n\n\u7528\u610f\u3068\u3044\u3063\u3066\u3082\u7c21\u5358\u3067\u3001`deps` \u4ee5\u4e0b\u306bmruby-yaml\u3092clone\u3057\u3066\u304f\u308b\u3060\u3051\u3067\u3059\u3002\n\n\u305d\u3057\u3066\u3001Dockerfile\u3092\u6b21\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u3001h2o\u3092build\u3057\u307e\u3059\u3002\n\n```dockerfile:Dockerfile\nFROM alpine\n\nRUN apk add --no-cache --virtual=builddeps \\\n        bison           \\\n        ca-certificates \\\n        cmake           \\\n        curl            \\\n        gcc             \\\n        git             \\\n        g++             \\\n        libc-dev        \\\n        linux-headers   \\\n        make            \\\n        openssl         \\\n        perl            \\\n        ruby            \\\n        ruby-dev        \\\n        wget            \\\n        yaml-dev        \\\n        zlib-dev        \\\n    && git clone https://github.com/unasuke/h2o.git \\\n    && cd h2o \\\n    && git checkout mruby-yaml \\\n    && cmake -DWITH_BUNDLED_SSL=on -DWITH_MRUBY=on . \\\n    && make install \\\n    && cd .. \\\n    && rm -rf h2o-* \\\n    && apk del builddeps \\\n    && apk add --no-cache --virtual=rundeps \\\n        libstdc++ \\\n        perl\n\nRUN mkdir /etc/h2o\n\nWORKDIR /etc/h2o\n\nEXPOSE 80 443\n\nCOPY . /etc/h2o\nCMD [\"h2o\", \"--mode=master\", \"-c\", \"h2o.conf\"]\n```\n\n[Build h2o with mruby-yaml \u00b7 unasuke/mruby_ac2016@4a3c552](https://github.com/unasuke/mruby_ac2016/commit/4a3c5529b107cfb3474cb57a90ff7badc1546736)\n\n## yaml\u3092\u8aad\u3080\n\u3044\u308d\u3044\u308d\u6e96\u5099\u304c\u6574\u3063\u305f\u306e\u3067\u3001yaml\u3092\u8aad\u307f\u3053\u3093\u3067response\u3092\u8fd4\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u3053\u306e\u3088\u3046\u306ayaml\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n```yaml:data.yml\nresponses:\n  -\n    path: \"/\"\n    message: \"index\"\n  - \n    path: \"/hoge\"\n    message: \"hoge\"\n  - \n    path: \"/fuga\"\n    message: \"fuga\"\n```\n\n\u305d\u3057\u3066\u3001\u305d\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066response\u3092\u8fd4\u3059\u3088\u3046\u306b\u3001mruby script\u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u304b\u3048\u307e\u3059\u3002\n\n```ruby:server.rb\nclass Server\n  def call(env)\n    response = fetch_response env['PATH_INFO']\n    if response\n      [200,\n       {\n         \"content-type\" => \"text/plain; charset=utf-8\",\n       },\n       [response]\n      ]\n    else\n      [404,\n       {\n         \"content-type\" => \"text/plain; charset=utf-8\",\n       },\n       [\"Not found\"]\n      ]\n    end\n  end\n\n  def fetch_response(path)\n    yaml = YAML.load(File.open('data.yml').read)\n    message = nil\n    yaml['responses'].each do |res|\n      if res['path'] == path\n        message = res['message']\n      end\n    end\n    message\n  end\nend\n\nServer.new\n```\n\n[Return response from yaml \u00b7 unasuke/mruby_ac2016@125a17b](https://github.com/unasuke/mruby_ac2016/commit/125a17b0e3291451fee4efb126e2412d71c611ee)\n\ndocker build\u3057\u3066run\u3059\u308b\u3068\u3001\u3053\u306e\u3088\u3046\u306byaml\u306e\u5185\u5bb9\u306b\u5f93\u3063\u3066response\u304c\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n![localhost:8080/](https://qiita-image-store.s3.amazonaws.com/0/18796/50f76fa1-3412-08c1-25d0-5b3dc60fe58a.png)\n![localhost:8080/hoge](https://qiita-image-store.s3.amazonaws.com/0/18796/62eba900-cb01-cced-df1e-76a4de05634a.png)\n\n## \u4f59\u8ac7\n\u672c\u5f53\u306fhaconiwa\u306e\u306a\u304b\u3067h2o\u3092\u52d5\u4f5c\u3055\u305b\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u306b\u3082\u3046\u307e\u304f\u3067\u304d\u305a\u8ae6\u3081\u307e\u3057\u305f\u3002\n", "tags": ["h2o", "mruby"]}